<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4626423">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4626478">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4626532">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4626583">package</span>&nbsp;<span class="ident" id="4626591">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626601">import</span>&nbsp;<span class="op" id="4626608">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626611">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626620">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4626630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4626633">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4626712">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4626790">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="4626868">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4626878">var</span>&nbsp;<span class="ident" id="4626882">transitionFunc</span>&nbsp;<span class="op" id="4626897">=</span>&nbsp;<span class="op" id="4626899">[</span><span class="op" id="4626900">...</span><span class="op" id="4626903">]</span><span class="keyword" id="4626904">func</span><span class="op" id="4626908">(</span><span class="ident" id="4626909">context</span><span class="op" id="4626916">,</span>&nbsp;<span class="op" id="4626918">[</span><span class="op" id="4626919">]</span><span class="builtintype" id="4626920">byte</span><span class="op" id="4626924">)</span>&nbsp;<span class="op" id="4626926">(</span><span class="ident" id="4626927">context</span><span class="op" id="4626934">,</span>&nbsp;<span class="builtintype" id="4626936">int</span><span class="op" id="4626939">)</span><span class="op" id="4626940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626943">stateText</span><span class="op" id="4626952">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626961">tText</span><span class="op" id="4626966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626969">stateTag</span><span class="op" id="4626977">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4626987">tTag</span><span class="op" id="4626991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626994">stateAttrName</span><span class="op" id="4627007">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627012">tAttrName</span><span class="op" id="4627021">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627024">stateAfterName</span><span class="op" id="4627038">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4627042">tAfterName</span><span class="op" id="4627052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627055">stateBeforeValue</span><span class="op" id="4627071">:</span>&nbsp;<span class="ident" id="4627073">tBeforeValue</span><span class="op" id="4627085">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627088">stateHTMLCmt</span><span class="op" id="4627100">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627106">tHTMLCmt</span><span class="op" id="4627114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627117">stateRCDATA</span><span class="op" id="4627128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627135">tSpecialTagEnd</span><span class="op" id="4627149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627152">stateAttr</span><span class="op" id="4627161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627170">tAttr</span><span class="op" id="4627175">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627178">stateURL</span><span class="op" id="4627186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627196">tURL</span><span class="op" id="4627200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627203">stateJS</span><span class="op" id="4627210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627221">tJS</span><span class="op" id="4627224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627227">stateJSDqStr</span><span class="op" id="4627239">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627245">tJSDelimited</span><span class="op" id="4627257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627260">stateJSSqStr</span><span class="op" id="4627272">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627278">tJSDelimited</span><span class="op" id="4627290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627293">stateJSRegexp</span><span class="op" id="4627306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627311">tJSDelimited</span><span class="op" id="4627323">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627326">stateJSBlockCmt</span><span class="op" id="4627341">:</span>&nbsp;&nbsp;<span class="ident" id="4627344">tBlockCmt</span><span class="op" id="4627353">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627356">stateJSLineCmt</span><span class="op" id="4627370">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4627374">tLineCmt</span><span class="op" id="4627382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627385">stateCSS</span><span class="op" id="4627393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627403">tCSS</span><span class="op" id="4627407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627410">stateCSSDqStr</span><span class="op" id="4627423">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627428">tCSSStr</span><span class="op" id="4627435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627438">stateCSSSqStr</span><span class="op" id="4627451">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627456">tCSSStr</span><span class="op" id="4627463">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627466">stateCSSDqURL</span><span class="op" id="4627479">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627484">tCSSStr</span><span class="op" id="4627491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627494">stateCSSSqURL</span><span class="op" id="4627507">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627512">tCSSStr</span><span class="op" id="4627519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627522">stateCSSURL</span><span class="op" id="4627533">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627540">tCSSStr</span><span class="op" id="4627547">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627550">stateCSSBlockCmt</span><span class="op" id="4627566">:</span>&nbsp;<span class="ident" id="4627568">tBlockCmt</span><span class="op" id="4627577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627580">stateCSSLineCmt</span><span class="op" id="4627595">:</span>&nbsp;&nbsp;<span class="ident" id="4627598">tLineCmt</span><span class="op" id="4627606">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627609">stateError</span><span class="op" id="4627619">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4627627">tError</span><span class="op" id="4627633">,</span><br>
<span class="lineno"></span><span class="op" id="4627635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4627638">var</span>&nbsp;<span class="ident" id="4627642">commentStart</span>&nbsp;<span class="op" id="4627655">=</span>&nbsp;<span class="op" id="4627657">[</span><span class="op" id="4627658">]</span><span class="builtintype" id="4627659">byte</span><span class="op" id="4627663">(</span><span class="string" id="4627664">&#34;&lt;!--&#34;</span><span class="op" id="4627670">)</span><br>
<span class="lineno"></span><span class="keyword" id="4627672">var</span>&nbsp;<span class="ident" id="4627676">commentEnd</span>&nbsp;<span class="op" id="4627687">=</span>&nbsp;<span class="op" id="4627689">[</span><span class="op" id="4627690">]</span><span class="builtintype" id="4627691">byte</span><span class="op" id="4627695">(</span><span class="string" id="4627696">&#34;--&gt;&#34;</span><span class="op" id="4627701">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4627704">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4627768">func</span>&nbsp;<span class="ident" id="4627773">tText</span><span class="op" id="4627778">(</span><span class="ident" id="4627779">c</span>&nbsp;<span class="ident" id="4627781">context</span><span class="op" id="4627788">,</span>&nbsp;<span class="ident" id="4627790">s</span>&nbsp;<span class="op" id="4627792">[</span><span class="op" id="4627793">]</span><span class="builtintype" id="4627794">byte</span><span class="op" id="4627798">)</span>&nbsp;<span class="op" id="4627800">(</span><span class="ident" id="4627801">context</span><span class="op" id="4627808">,</span>&nbsp;<span class="builtintype" id="4627810">int</span><span class="op" id="4627813">)</span>&nbsp;<span class="op" id="4627815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627818">k</span>&nbsp;<span class="op" id="4627820">:=</span>&nbsp;<span class="num" id="4627823">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627826">for</span>&nbsp;<span class="op" id="4627830">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627834">i</span>&nbsp;<span class="op" id="4627836">:=</span>&nbsp;<span class="ident" id="4627839">k</span>&nbsp;<span class="op" id="4627841">+</span>&nbsp;<span class="ident" id="4627843">bytes</span><span class="op" id="4627848">.</span><span class="ident" id="4627849">IndexByte</span><span class="op" id="4627858">(</span><span class="ident" id="4627859">s</span><span class="op" id="4627860">[</span><span class="ident" id="4627861">k</span><span class="op" id="4627862">:</span><span class="op" id="4627863">]</span><span class="op" id="4627864">,</span>&nbsp;<span class="string" id="4627866">&#39;&lt;&#39;</span><span class="op" id="4627869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627873">if</span>&nbsp;<span class="ident" id="4627876">i</span>&nbsp;<span class="op" id="4627878">&lt;</span>&nbsp;<span class="ident" id="4627880">k</span>&nbsp;<span class="op" id="4627882">||</span>&nbsp;<span class="ident" id="4627885">i</span><span class="op" id="4627886">+</span><span class="num" id="4627887">1</span>&nbsp;<span class="op" id="4627889">==</span>&nbsp;<span class="builtinfunc" id="4627892">len</span><span class="op" id="4627895">(</span><span class="ident" id="4627896">s</span><span class="op" id="4627897">)</span>&nbsp;<span class="op" id="4627899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627904">return</span>&nbsp;<span class="ident" id="4627911">c</span><span class="op" id="4627912">,</span>&nbsp;<span class="builtinfunc" id="4627914">len</span><span class="op" id="4627917">(</span><span class="ident" id="4627918">s</span><span class="op" id="4627919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627923">}</span>&nbsp;<span class="keyword" id="4627925">else</span>&nbsp;<span class="keyword" id="4627930">if</span>&nbsp;<span class="ident" id="4627933">i</span><span class="op" id="4627934">+</span><span class="num" id="4627935">4</span>&nbsp;<span class="op" id="4627937">&lt;=</span>&nbsp;<span class="builtinfunc" id="4627940">len</span><span class="op" id="4627943">(</span><span class="ident" id="4627944">s</span><span class="op" id="4627945">)</span>&nbsp;<span class="op" id="4627947">&amp;&amp;</span>&nbsp;<span class="ident" id="4627950">bytes</span><span class="op" id="4627955">.</span><span class="ident" id="4627956">Equal</span><span class="op" id="4627961">(</span><span class="ident" id="4627962">commentStart</span><span class="op" id="4627974">,</span>&nbsp;<span class="ident" id="4627976">s</span><span class="op" id="4627977">[</span><span class="ident" id="4627978">i</span><span class="op" id="4627979">:</span><span class="ident" id="4627980">i</span><span class="op" id="4627981">+</span><span class="num" id="4627982">4</span><span class="op" id="4627983">]</span><span class="op" id="4627984">)</span>&nbsp;<span class="op" id="4627986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627991">return</span>&nbsp;<span class="ident" id="4627998">context</span><span class="op" id="4628005">{</span><span class="ident" id="4628006">state</span><span class="op" id="4628011">:</span>&nbsp;<span class="ident" id="4628013">stateHTMLCmt</span><span class="op" id="4628025">}</span><span class="op" id="4628026">,</span>&nbsp;<span class="ident" id="4628028">i</span>&nbsp;<span class="op" id="4628030">+</span>&nbsp;<span class="num" id="4628032">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628040">i</span><span class="op" id="4628041">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628046">end</span>&nbsp;<span class="op" id="4628050">:=</span>&nbsp;<span class="builtintype" id="4628053">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628061">if</span>&nbsp;<span class="ident" id="4628064">s</span><span class="op" id="4628065">[</span><span class="ident" id="4628066">i</span><span class="op" id="4628067">]</span>&nbsp;<span class="op" id="4628069">==</span>&nbsp;<span class="string" id="4628072">&#39;/&#39;</span>&nbsp;<span class="op" id="4628076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628081">if</span>&nbsp;<span class="ident" id="4628084">i</span><span class="op" id="4628085">+</span><span class="num" id="4628086">1</span>&nbsp;<span class="op" id="4628088">==</span>&nbsp;<span class="builtinfunc" id="4628091">len</span><span class="op" id="4628094">(</span><span class="ident" id="4628095">s</span><span class="op" id="4628096">)</span>&nbsp;<span class="op" id="4628098">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628104">return</span>&nbsp;<span class="ident" id="4628111">c</span><span class="op" id="4628112">,</span>&nbsp;<span class="builtinfunc" id="4628114">len</span><span class="op" id="4628117">(</span><span class="ident" id="4628118">s</span><span class="op" id="4628119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628129">end</span><span class="op" id="4628132">,</span>&nbsp;<span class="ident" id="4628134">i</span>&nbsp;<span class="op" id="4628136">=</span>&nbsp;<span class="builtintype" id="4628138">true</span><span class="op" id="4628142">,</span>&nbsp;<span class="ident" id="4628144">i</span><span class="op" id="4628145">+</span><span class="num" id="4628146">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628154">j</span><span class="op" id="4628155">,</span>&nbsp;<span class="ident" id="4628157">e</span>&nbsp;<span class="op" id="4628159">:=</span>&nbsp;<span class="ident" id="4628162">eatTagName</span><span class="op" id="4628172">(</span><span class="ident" id="4628173">s</span><span class="op" id="4628174">,</span>&nbsp;<span class="ident" id="4628176">i</span><span class="op" id="4628177">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628181">if</span>&nbsp;<span class="ident" id="4628184">j</span>&nbsp;<span class="op" id="4628186">!=</span>&nbsp;<span class="ident" id="4628189">i</span>&nbsp;<span class="op" id="4628191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628196">if</span>&nbsp;<span class="ident" id="4628199">end</span>&nbsp;<span class="op" id="4628203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628209">e</span>&nbsp;<span class="op" id="4628211">=</span>&nbsp;<span class="ident" id="4628213">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628233">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628264">return</span>&nbsp;<span class="ident" id="4628271">context</span><span class="op" id="4628278">{</span><span class="ident" id="4628279">state</span><span class="op" id="4628284">:</span>&nbsp;<span class="ident" id="4628286">stateTag</span><span class="op" id="4628294">,</span>&nbsp;<span class="ident" id="4628296">element</span><span class="op" id="4628303">:</span>&nbsp;<span class="ident" id="4628305">e</span><span class="op" id="4628306">}</span><span class="op" id="4628307">,</span>&nbsp;<span class="ident" id="4628309">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628317">k</span>&nbsp;<span class="op" id="4628319">=</span>&nbsp;<span class="ident" id="4628321">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628324">}</span><br>
<span class="lineno"></span><span class="op" id="4628326">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="4628329">var</span>&nbsp;<span class="ident" id="4628333">elementContentType</span>&nbsp;<span class="op" id="4628352">=</span>&nbsp;<span class="op" id="4628354">[</span><span class="op" id="4628355">...</span><span class="op" id="4628358">]</span><span class="ident" id="4628359">state</span><span class="op" id="4628364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628367">elementNone</span><span class="op" id="4628378">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628384">stateText</span><span class="op" id="4628393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628396">elementScript</span><span class="op" id="4628409">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4628413">stateJS</span><span class="op" id="4628420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628423">elementStyle</span><span class="op" id="4628435">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628440">stateCSS</span><span class="op" id="4628448">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628451">elementTextarea</span><span class="op" id="4628466">:</span>&nbsp;<span class="ident" id="4628468">stateRCDATA</span><span class="op" id="4628479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628482">elementTitle</span><span class="op" id="4628494">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4628499">stateRCDATA</span><span class="op" id="4628510">,</span><br>
<span class="lineno"></span><span class="op" id="4628512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4628515">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="4628577">func</span>&nbsp;<span class="ident" id="4628582">tTag</span><span class="op" id="4628586">(</span><span class="ident" id="4628587">c</span>&nbsp;<span class="ident" id="4628589">context</span><span class="op" id="4628596">,</span>&nbsp;<span class="ident" id="4628598">s</span>&nbsp;<span class="op" id="4628600">[</span><span class="op" id="4628601">]</span><span class="builtintype" id="4628602">byte</span><span class="op" id="4628606">)</span>&nbsp;<span class="op" id="4628608">(</span><span class="ident" id="4628609">context</span><span class="op" id="4628616">,</span>&nbsp;<span class="builtintype" id="4628618">int</span><span class="op" id="4628621">)</span>&nbsp;<span class="op" id="4628623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628626">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628655">i</span>&nbsp;<span class="op" id="4628657">:=</span>&nbsp;<span class="ident" id="4628660">eatWhiteSpace</span><span class="op" id="4628673">(</span><span class="ident" id="4628674">s</span><span class="op" id="4628675">,</span>&nbsp;<span class="num" id="4628677">0</span><span class="op" id="4628678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628681">if</span>&nbsp;<span class="ident" id="4628684">i</span>&nbsp;<span class="op" id="4628686">==</span>&nbsp;<span class="builtinfunc" id="4628689">len</span><span class="op" id="4628692">(</span><span class="ident" id="4628693">s</span><span class="op" id="4628694">)</span>&nbsp;<span class="op" id="4628696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628700">return</span>&nbsp;<span class="ident" id="4628707">c</span><span class="op" id="4628708">,</span>&nbsp;<span class="builtinfunc" id="4628710">len</span><span class="op" id="4628713">(</span><span class="ident" id="4628714">s</span><span class="op" id="4628715">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628721">if</span>&nbsp;<span class="ident" id="4628724">s</span><span class="op" id="4628725">[</span><span class="ident" id="4628726">i</span><span class="op" id="4628727">]</span>&nbsp;<span class="op" id="4628729">==</span>&nbsp;<span class="string" id="4628732">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4628736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628740">return</span>&nbsp;<span class="ident" id="4628747">context</span><span class="op" id="4628754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628759">state</span><span class="op" id="4628764">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4628768">elementContentType</span><span class="op" id="4628786">[</span><span class="ident" id="4628787">c</span><span class="op" id="4628788">.</span><span class="ident" id="4628789">element</span><span class="op" id="4628796">]</span><span class="op" id="4628797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628802">element</span><span class="op" id="4628809">:</span>&nbsp;<span class="ident" id="4628811">c</span><span class="op" id="4628812">.</span><span class="ident" id="4628813">element</span><span class="op" id="4628820">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628824">}</span><span class="op" id="4628825">,</span>&nbsp;<span class="ident" id="4628827">i</span>&nbsp;<span class="op" id="4628829">+</span>&nbsp;<span class="num" id="4628831">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628837">j</span><span class="op" id="4628838">,</span>&nbsp;<span class="ident" id="4628840">err</span>&nbsp;<span class="op" id="4628844">:=</span>&nbsp;<span class="ident" id="4628847">eatAttrName</span><span class="op" id="4628858">(</span><span class="ident" id="4628859">s</span><span class="op" id="4628860">,</span>&nbsp;<span class="ident" id="4628862">i</span><span class="op" id="4628863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628866">if</span>&nbsp;<span class="ident" id="4628869">err</span>&nbsp;<span class="op" id="4628873">!=</span>&nbsp;<span class="ident" id="4628876">nil</span>&nbsp;<span class="op" id="4628880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628884">return</span>&nbsp;<span class="ident" id="4628891">context</span><span class="op" id="4628898">{</span><span class="ident" id="4628899">state</span><span class="op" id="4628904">:</span>&nbsp;<span class="ident" id="4628906">stateError</span><span class="op" id="4628916">,</span>&nbsp;<span class="ident" id="4628918">err</span><span class="op" id="4628921">:</span>&nbsp;<span class="ident" id="4628923">err</span><span class="op" id="4628926">}</span><span class="op" id="4628927">,</span>&nbsp;<span class="builtinfunc" id="4628929">len</span><span class="op" id="4628932">(</span><span class="ident" id="4628933">s</span><span class="op" id="4628934">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628940">state</span><span class="op" id="4628945">,</span>&nbsp;<span class="ident" id="4628947">attr</span>&nbsp;<span class="op" id="4628952">:=</span>&nbsp;<span class="ident" id="4628955">stateTag</span><span class="op" id="4628963">,</span>&nbsp;<span class="ident" id="4628965">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628975">if</span>&nbsp;<span class="ident" id="4628978">i</span>&nbsp;<span class="op" id="4628980">==</span>&nbsp;<span class="ident" id="4628983">j</span>&nbsp;<span class="op" id="4628985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628989">return</span>&nbsp;<span class="ident" id="4628996">context</span><span class="op" id="4629003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629008">state</span><span class="op" id="4629013">:</span>&nbsp;<span class="ident" id="4629015">stateError</span><span class="op" id="4629025">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629030">err</span><span class="op" id="4629033">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4629037">errorf</span><span class="op" id="4629043">(</span><span class="ident" id="4629044">ErrBadHTML</span><span class="op" id="4629054">,</span>&nbsp;<span class="ident" id="4629056">nil</span><span class="op" id="4629059">,</span>&nbsp;<span class="num" id="4629061">0</span><span class="op" id="4629062">,</span>&nbsp;<span class="string" id="4629064">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="4629118">,</span>&nbsp;<span class="ident" id="4629120">s</span><span class="op" id="4629121">[</span><span class="ident" id="4629122">i</span><span class="op" id="4629123">:</span><span class="op" id="4629124">]</span><span class="op" id="4629125">)</span><span class="op" id="4629126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629130">}</span><span class="op" id="4629131">,</span>&nbsp;<span class="builtinfunc" id="4629133">len</span><span class="op" id="4629136">(</span><span class="ident" id="4629137">s</span><span class="op" id="4629138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629144">switch</span>&nbsp;<span class="ident" id="4629151">attrType</span><span class="op" id="4629159">(</span><span class="builtintype" id="4629160">string</span><span class="op" id="4629166">(</span><span class="ident" id="4629167">s</span><span class="op" id="4629168">[</span><span class="ident" id="4629169">i</span><span class="op" id="4629170">:</span><span class="ident" id="4629171">j</span><span class="op" id="4629172">]</span><span class="op" id="4629173">)</span><span class="op" id="4629174">)</span>&nbsp;<span class="op" id="4629176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629179">case</span>&nbsp;<span class="ident" id="4629184">contentTypeURL</span><span class="op" id="4629198">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629202">attr</span>&nbsp;<span class="op" id="4629207">=</span>&nbsp;<span class="ident" id="4629209">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629218">case</span>&nbsp;<span class="ident" id="4629223">contentTypeCSS</span><span class="op" id="4629237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629241">attr</span>&nbsp;<span class="op" id="4629246">=</span>&nbsp;<span class="ident" id="4629248">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629259">case</span>&nbsp;<span class="ident" id="4629264">contentTypeJS</span><span class="op" id="4629277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629281">attr</span>&nbsp;<span class="op" id="4629286">=</span>&nbsp;<span class="ident" id="4629288">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629303">if</span>&nbsp;<span class="ident" id="4629306">j</span>&nbsp;<span class="op" id="4629308">==</span>&nbsp;<span class="builtinfunc" id="4629311">len</span><span class="op" id="4629314">(</span><span class="ident" id="4629315">s</span><span class="op" id="4629316">)</span>&nbsp;<span class="op" id="4629318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629322">state</span>&nbsp;<span class="op" id="4629328">=</span>&nbsp;<span class="ident" id="4629330">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629345">}</span>&nbsp;<span class="keyword" id="4629347">else</span>&nbsp;<span class="op" id="4629352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629356">state</span>&nbsp;<span class="op" id="4629362">=</span>&nbsp;<span class="ident" id="4629364">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629383">return</span>&nbsp;<span class="ident" id="4629390">context</span><span class="op" id="4629397">{</span><span class="ident" id="4629398">state</span><span class="op" id="4629403">:</span>&nbsp;<span class="ident" id="4629405">state</span><span class="op" id="4629410">,</span>&nbsp;<span class="ident" id="4629412">element</span><span class="op" id="4629419">:</span>&nbsp;<span class="ident" id="4629421">c</span><span class="op" id="4629422">.</span><span class="ident" id="4629423">element</span><span class="op" id="4629430">,</span>&nbsp;<span class="ident" id="4629432">attr</span><span class="op" id="4629436">:</span>&nbsp;<span class="ident" id="4629438">attr</span><span class="op" id="4629442">}</span><span class="op" id="4629443">,</span>&nbsp;<span class="ident" id="4629445">j</span><br>
<span class="lineno"></span><span class="op" id="4629447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4629450">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="4629517">func</span>&nbsp;<span class="ident" id="4629522">tAttrName</span><span class="op" id="4629531">(</span><span class="ident" id="4629532">c</span>&nbsp;<span class="ident" id="4629534">context</span><span class="op" id="4629541">,</span>&nbsp;<span class="ident" id="4629543">s</span>&nbsp;<span class="op" id="4629545">[</span><span class="op" id="4629546">]</span><span class="builtintype" id="4629547">byte</span><span class="op" id="4629551">)</span>&nbsp;<span class="op" id="4629553">(</span><span class="ident" id="4629554">context</span><span class="op" id="4629561">,</span>&nbsp;<span class="builtintype" id="4629563">int</span><span class="op" id="4629566">)</span>&nbsp;<span class="op" id="4629568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629571">i</span><span class="op" id="4629572">,</span>&nbsp;<span class="ident" id="4629574">err</span>&nbsp;<span class="op" id="4629578">:=</span>&nbsp;<span class="ident" id="4629581">eatAttrName</span><span class="op" id="4629592">(</span><span class="ident" id="4629593">s</span><span class="op" id="4629594">,</span>&nbsp;<span class="num" id="4629596">0</span><span class="op" id="4629597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629600">if</span>&nbsp;<span class="ident" id="4629603">err</span>&nbsp;<span class="op" id="4629607">!=</span>&nbsp;<span class="ident" id="4629610">nil</span>&nbsp;<span class="op" id="4629614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629618">return</span>&nbsp;<span class="ident" id="4629625">context</span><span class="op" id="4629632">{</span><span class="ident" id="4629633">state</span><span class="op" id="4629638">:</span>&nbsp;<span class="ident" id="4629640">stateError</span><span class="op" id="4629650">,</span>&nbsp;<span class="ident" id="4629652">err</span><span class="op" id="4629655">:</span>&nbsp;<span class="ident" id="4629657">err</span><span class="op" id="4629660">}</span><span class="op" id="4629661">,</span>&nbsp;<span class="builtinfunc" id="4629663">len</span><span class="op" id="4629666">(</span><span class="ident" id="4629667">s</span><span class="op" id="4629668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629671">}</span>&nbsp;<span class="keyword" id="4629673">else</span>&nbsp;<span class="keyword" id="4629678">if</span>&nbsp;<span class="ident" id="4629681">i</span>&nbsp;<span class="op" id="4629683">!=</span>&nbsp;<span class="builtinfunc" id="4629686">len</span><span class="op" id="4629689">(</span><span class="ident" id="4629690">s</span><span class="op" id="4629691">)</span>&nbsp;<span class="op" id="4629693">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629697">c</span><span class="op" id="4629698">.</span><span class="ident" id="4629699">state</span>&nbsp;<span class="op" id="4629705">=</span>&nbsp;<span class="ident" id="4629707">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629726">return</span>&nbsp;<span class="ident" id="4629733">c</span><span class="op" id="4629734">,</span>&nbsp;<span class="ident" id="4629736">i</span><br>
<span class="lineno"></span><span class="op" id="4629738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="4629741">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="4629810">func</span>&nbsp;<span class="ident" id="4629815">tAfterName</span><span class="op" id="4629825">(</span><span class="ident" id="4629826">c</span>&nbsp;<span class="ident" id="4629828">context</span><span class="op" id="4629835">,</span>&nbsp;<span class="ident" id="4629837">s</span>&nbsp;<span class="op" id="4629839">[</span><span class="op" id="4629840">]</span><span class="builtintype" id="4629841">byte</span><span class="op" id="4629845">)</span>&nbsp;<span class="op" id="4629847">(</span><span class="ident" id="4629848">context</span><span class="op" id="4629855">,</span>&nbsp;<span class="builtintype" id="4629857">int</span><span class="op" id="4629860">)</span>&nbsp;<span class="op" id="4629862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629865">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629902">i</span>&nbsp;<span class="op" id="4629904">:=</span>&nbsp;<span class="ident" id="4629907">eatWhiteSpace</span><span class="op" id="4629920">(</span><span class="ident" id="4629921">s</span><span class="op" id="4629922">,</span>&nbsp;<span class="num" id="4629924">0</span><span class="op" id="4629925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629928">if</span>&nbsp;<span class="ident" id="4629931">i</span>&nbsp;<span class="op" id="4629933">==</span>&nbsp;<span class="builtinfunc" id="4629936">len</span><span class="op" id="4629939">(</span><span class="ident" id="4629940">s</span><span class="op" id="4629941">)</span>&nbsp;<span class="op" id="4629943">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629947">return</span>&nbsp;<span class="ident" id="4629954">c</span><span class="op" id="4629955">,</span>&nbsp;<span class="builtinfunc" id="4629957">len</span><span class="op" id="4629960">(</span><span class="ident" id="4629961">s</span><span class="op" id="4629962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629965">}</span>&nbsp;<span class="keyword" id="4629967">else</span>&nbsp;<span class="keyword" id="4629972">if</span>&nbsp;<span class="ident" id="4629975">s</span><span class="op" id="4629976">[</span><span class="ident" id="4629977">i</span><span class="op" id="4629978">]</span>&nbsp;<span class="op" id="4629980">!=</span>&nbsp;<span class="string" id="4629983">&#39;=&#39;</span>&nbsp;<span class="op" id="4629987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629991">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630051">c</span><span class="op" id="4630052">.</span><span class="ident" id="4630053">state</span>&nbsp;<span class="op" id="4630059">=</span>&nbsp;<span class="ident" id="4630061">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630072">return</span>&nbsp;<span class="ident" id="4630079">c</span><span class="op" id="4630080">,</span>&nbsp;<span class="ident" id="4630082">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630088">c</span><span class="op" id="4630089">.</span><span class="ident" id="4630090">state</span>&nbsp;<span class="op" id="4630096">=</span>&nbsp;<span class="ident" id="4630098">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630116">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630137">return</span>&nbsp;<span class="ident" id="4630144">c</span><span class="op" id="4630145">,</span>&nbsp;<span class="ident" id="4630147">i</span>&nbsp;<span class="op" id="4630149">+</span>&nbsp;<span class="num" id="4630151">1</span><br>
<span class="lineno"></span><span class="op" id="4630153">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="4630156">var</span>&nbsp;<span class="ident" id="4630160">attrStartStates</span>&nbsp;<span class="op" id="4630176">=</span>&nbsp;<span class="op" id="4630178">[</span><span class="op" id="4630179">...</span><span class="op" id="4630182">]</span><span class="ident" id="4630183">state</span><span class="op" id="4630188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630191">attrNone</span><span class="op" id="4630199">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4630203">stateAttr</span><span class="op" id="4630212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630215">attrScript</span><span class="op" id="4630225">:</span>&nbsp;<span class="ident" id="4630227">stateJS</span><span class="op" id="4630234">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630237">attrStyle</span><span class="op" id="4630246">:</span>&nbsp;&nbsp;<span class="ident" id="4630249">stateCSS</span><span class="op" id="4630257">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630260">attrURL</span><span class="op" id="4630267">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4630272">stateURL</span><span class="op" id="4630280">,</span><br>
<span class="lineno"></span><span class="op" id="4630282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4630285">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="4630358">func</span>&nbsp;<span class="ident" id="4630363">tBeforeValue</span><span class="op" id="4630375">(</span><span class="ident" id="4630376">c</span>&nbsp;<span class="ident" id="4630378">context</span><span class="op" id="4630385">,</span>&nbsp;<span class="ident" id="4630387">s</span>&nbsp;<span class="op" id="4630389">[</span><span class="op" id="4630390">]</span><span class="builtintype" id="4630391">byte</span><span class="op" id="4630395">)</span>&nbsp;<span class="op" id="4630397">(</span><span class="ident" id="4630398">context</span><span class="op" id="4630405">,</span>&nbsp;<span class="builtintype" id="4630407">int</span><span class="op" id="4630410">)</span>&nbsp;<span class="op" id="4630412">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630415">i</span>&nbsp;<span class="op" id="4630417">:=</span>&nbsp;<span class="ident" id="4630420">eatWhiteSpace</span><span class="op" id="4630433">(</span><span class="ident" id="4630434">s</span><span class="op" id="4630435">,</span>&nbsp;<span class="num" id="4630437">0</span><span class="op" id="4630438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630441">if</span>&nbsp;<span class="ident" id="4630444">i</span>&nbsp;<span class="op" id="4630446">==</span>&nbsp;<span class="builtinfunc" id="4630449">len</span><span class="op" id="4630452">(</span><span class="ident" id="4630453">s</span><span class="op" id="4630454">)</span>&nbsp;<span class="op" id="4630456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630460">return</span>&nbsp;<span class="ident" id="4630467">c</span><span class="op" id="4630468">,</span>&nbsp;<span class="builtinfunc" id="4630470">len</span><span class="op" id="4630473">(</span><span class="ident" id="4630474">s</span><span class="op" id="4630475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630481">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630515">delim</span>&nbsp;<span class="op" id="4630521">:=</span>&nbsp;<span class="ident" id="4630524">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630544">switch</span>&nbsp;<span class="ident" id="4630551">s</span><span class="op" id="4630552">[</span><span class="ident" id="4630553">i</span><span class="op" id="4630554">]</span>&nbsp;<span class="op" id="4630556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630559">case</span>&nbsp;<span class="string" id="4630564">&#39;\&#39;&#39;</span><span class="op" id="4630568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630572">delim</span><span class="op" id="4630577">,</span>&nbsp;<span class="ident" id="4630579">i</span>&nbsp;<span class="op" id="4630581">=</span>&nbsp;<span class="ident" id="4630583">delimSingleQuote</span><span class="op" id="4630599">,</span>&nbsp;<span class="ident" id="4630601">i</span><span class="op" id="4630602">+</span><span class="num" id="4630603">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630606">case</span>&nbsp;<span class="string" id="4630611">&#39;&#34;&#39;</span><span class="op" id="4630614">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630618">delim</span><span class="op" id="4630623">,</span>&nbsp;<span class="ident" id="4630625">i</span>&nbsp;<span class="op" id="4630627">=</span>&nbsp;<span class="ident" id="4630629">delimDoubleQuote</span><span class="op" id="4630645">,</span>&nbsp;<span class="ident" id="4630647">i</span><span class="op" id="4630648">+</span><span class="num" id="4630649">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630655">c</span><span class="op" id="4630656">.</span><span class="ident" id="4630657">state</span><span class="op" id="4630662">,</span>&nbsp;<span class="ident" id="4630664">c</span><span class="op" id="4630665">.</span><span class="ident" id="4630666">delim</span><span class="op" id="4630671">,</span>&nbsp;<span class="ident" id="4630673">c</span><span class="op" id="4630674">.</span><span class="ident" id="4630675">attr</span>&nbsp;<span class="op" id="4630680">=</span>&nbsp;<span class="ident" id="4630682">attrStartStates</span><span class="op" id="4630697">[</span><span class="ident" id="4630698">c</span><span class="op" id="4630699">.</span><span class="ident" id="4630700">attr</span><span class="op" id="4630704">]</span><span class="op" id="4630705">,</span>&nbsp;<span class="ident" id="4630707">delim</span><span class="op" id="4630712">,</span>&nbsp;<span class="ident" id="4630714">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630724">return</span>&nbsp;<span class="ident" id="4630731">c</span><span class="op" id="4630732">,</span>&nbsp;<span class="ident" id="4630734">i</span><br>
<span class="lineno"></span><span class="op" id="4630736">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4630739">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4630804">func</span>&nbsp;<span class="ident" id="4630809">tHTMLCmt</span><span class="op" id="4630817">(</span><span class="ident" id="4630818">c</span>&nbsp;<span class="ident" id="4630820">context</span><span class="op" id="4630827">,</span>&nbsp;<span class="ident" id="4630829">s</span>&nbsp;<span class="op" id="4630831">[</span><span class="op" id="4630832">]</span><span class="builtintype" id="4630833">byte</span><span class="op" id="4630837">)</span>&nbsp;<span class="op" id="4630839">(</span><span class="ident" id="4630840">context</span><span class="op" id="4630847">,</span>&nbsp;<span class="builtintype" id="4630849">int</span><span class="op" id="4630852">)</span>&nbsp;<span class="op" id="4630854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630857">if</span>&nbsp;<span class="ident" id="4630860">i</span>&nbsp;<span class="op" id="4630862">:=</span>&nbsp;<span class="ident" id="4630865">bytes</span><span class="op" id="4630870">.</span><span class="ident" id="4630871">Index</span><span class="op" id="4630876">(</span><span class="ident" id="4630877">s</span><span class="op" id="4630878">,</span>&nbsp;<span class="ident" id="4630880">commentEnd</span><span class="op" id="4630890">)</span><span class="op" id="4630891">;</span>&nbsp;<span class="ident" id="4630893">i</span>&nbsp;<span class="op" id="4630895">!=</span>&nbsp;<span class="op" id="4630898">-</span><span class="num" id="4630899">1</span>&nbsp;<span class="op" id="4630901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630905">return</span>&nbsp;<span class="ident" id="4630912">context</span><span class="op" id="4630919">{</span><span class="op" id="4630920">}</span><span class="op" id="4630921">,</span>&nbsp;<span class="ident" id="4630923">i</span>&nbsp;<span class="op" id="4630925">+</span>&nbsp;<span class="num" id="4630927">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630933">return</span>&nbsp;<span class="ident" id="4630940">c</span><span class="op" id="4630941">,</span>&nbsp;<span class="builtinfunc" id="4630943">len</span><span class="op" id="4630946">(</span><span class="ident" id="4630947">s</span><span class="op" id="4630948">)</span><br>
<span class="lineno"></span><span class="op" id="4630950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4630953">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="4631027">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4631090">var</span>&nbsp;<span class="ident" id="4631094">specialTagEndMarkers</span>&nbsp;<span class="op" id="4631115">=</span>&nbsp;<span class="op" id="4631117">[</span><span class="op" id="4631118">...</span><span class="op" id="4631121">]</span><span class="builtintype" id="4631122">string</span><span class="op" id="4631128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631131">elementScript</span><span class="op" id="4631144">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4631148">&#34;&lt;/script&#34;</span><span class="op" id="4631158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631161">elementStyle</span><span class="op" id="4631173">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4631178">&#34;&lt;/style&#34;</span><span class="op" id="4631187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631190">elementTextarea</span><span class="op" id="4631205">:</span>&nbsp;<span class="string" id="4631207">&#34;&lt;/textarea&#34;</span><span class="op" id="4631219">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631222">elementTitle</span><span class="op" id="4631234">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4631239">&#34;&lt;/title&#34;</span><span class="op" id="4631248">,</span><br>
<span class="lineno"></span><span class="op" id="4631250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4631253">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="4631330">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="4631349">func</span>&nbsp;<span class="ident" id="4631354">tSpecialTagEnd</span><span class="op" id="4631368">(</span><span class="ident" id="4631369">c</span>&nbsp;<span class="ident" id="4631371">context</span><span class="op" id="4631378">,</span>&nbsp;<span class="ident" id="4631380">s</span>&nbsp;<span class="op" id="4631382">[</span><span class="op" id="4631383">]</span><span class="builtintype" id="4631384">byte</span><span class="op" id="4631388">)</span>&nbsp;<span class="op" id="4631390">(</span><span class="ident" id="4631391">context</span><span class="op" id="4631398">,</span>&nbsp;<span class="builtintype" id="4631400">int</span><span class="op" id="4631403">)</span>&nbsp;<span class="op" id="4631405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631408">if</span>&nbsp;<span class="ident" id="4631411">c</span><span class="op" id="4631412">.</span><span class="ident" id="4631413">element</span>&nbsp;<span class="op" id="4631421">!=</span>&nbsp;<span class="ident" id="4631424">elementNone</span>&nbsp;<span class="op" id="4631436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631440">if</span>&nbsp;<span class="ident" id="4631443">i</span>&nbsp;<span class="op" id="4631445">:=</span>&nbsp;<span class="ident" id="4631448">strings</span><span class="op" id="4631455">.</span><span class="ident" id="4631456">Index</span><span class="op" id="4631461">(</span><span class="ident" id="4631462">strings</span><span class="op" id="4631469">.</span><span class="ident" id="4631470">ToLower</span><span class="op" id="4631477">(</span><span class="builtintype" id="4631478">string</span><span class="op" id="4631484">(</span><span class="ident" id="4631485">s</span><span class="op" id="4631486">)</span><span class="op" id="4631487">)</span><span class="op" id="4631488">,</span>&nbsp;<span class="ident" id="4631490">specialTagEndMarkers</span><span class="op" id="4631510">[</span><span class="ident" id="4631511">c</span><span class="op" id="4631512">.</span><span class="ident" id="4631513">element</span><span class="op" id="4631520">]</span><span class="op" id="4631521">)</span><span class="op" id="4631522">;</span>&nbsp;<span class="ident" id="4631524">i</span>&nbsp;<span class="op" id="4631526">!=</span>&nbsp;<span class="op" id="4631529">-</span><span class="num" id="4631530">1</span>&nbsp;<span class="op" id="4631532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631537">return</span>&nbsp;<span class="ident" id="4631544">context</span><span class="op" id="4631551">{</span><span class="op" id="4631552">}</span><span class="op" id="4631553">,</span>&nbsp;<span class="ident" id="4631555">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631559">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631565">return</span>&nbsp;<span class="ident" id="4631572">c</span><span class="op" id="4631573">,</span>&nbsp;<span class="builtinfunc" id="4631575">len</span><span class="op" id="4631578">(</span><span class="ident" id="4631579">s</span><span class="op" id="4631580">)</span><br>
<span class="lineno"></span><span class="op" id="4631582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4631585">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="4631654">func</span>&nbsp;<span class="ident" id="4631659">tAttr</span><span class="op" id="4631664">(</span><span class="ident" id="4631665">c</span>&nbsp;<span class="ident" id="4631667">context</span><span class="op" id="4631674">,</span>&nbsp;<span class="ident" id="4631676">s</span>&nbsp;<span class="op" id="4631678">[</span><span class="op" id="4631679">]</span><span class="builtintype" id="4631680">byte</span><span class="op" id="4631684">)</span>&nbsp;<span class="op" id="4631686">(</span><span class="ident" id="4631687">context</span><span class="op" id="4631694">,</span>&nbsp;<span class="builtintype" id="4631696">int</span><span class="op" id="4631699">)</span>&nbsp;<span class="op" id="4631701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631704">return</span>&nbsp;<span class="ident" id="4631711">c</span><span class="op" id="4631712">,</span>&nbsp;<span class="builtinfunc" id="4631714">len</span><span class="op" id="4631717">(</span><span class="ident" id="4631718">s</span><span class="op" id="4631719">)</span><br>
<span class="lineno"></span><span class="op" id="4631721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4631724">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="4631786">func</span>&nbsp;<span class="ident" id="4631791">tURL</span><span class="op" id="4631795">(</span><span class="ident" id="4631796">c</span>&nbsp;<span class="ident" id="4631798">context</span><span class="op" id="4631805">,</span>&nbsp;<span class="ident" id="4631807">s</span>&nbsp;<span class="op" id="4631809">[</span><span class="op" id="4631810">]</span><span class="builtintype" id="4631811">byte</span><span class="op" id="4631815">)</span>&nbsp;<span class="op" id="4631817">(</span><span class="ident" id="4631818">context</span><span class="op" id="4631825">,</span>&nbsp;<span class="builtintype" id="4631827">int</span><span class="op" id="4631830">)</span>&nbsp;<span class="op" id="4631832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631835">if</span>&nbsp;<span class="ident" id="4631838">bytes</span><span class="op" id="4631843">.</span><span class="ident" id="4631844">IndexAny</span><span class="op" id="4631852">(</span><span class="ident" id="4631853">s</span><span class="op" id="4631854">,</span>&nbsp;<span class="string" id="4631856">&#34;#?&#34;</span><span class="op" id="4631860">)</span>&nbsp;<span class="op" id="4631862">&gt;=</span>&nbsp;<span class="num" id="4631865">0</span>&nbsp;<span class="op" id="4631867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631871">c</span><span class="op" id="4631872">.</span><span class="ident" id="4631873">urlPart</span>&nbsp;<span class="op" id="4631881">=</span>&nbsp;<span class="ident" id="4631883">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631903">}</span>&nbsp;<span class="keyword" id="4631905">else</span>&nbsp;<span class="keyword" id="4631910">if</span>&nbsp;<span class="builtinfunc" id="4631913">len</span><span class="op" id="4631916">(</span><span class="ident" id="4631917">s</span><span class="op" id="4631918">)</span>&nbsp;<span class="op" id="4631920">!=</span>&nbsp;<span class="ident" id="4631923">eatWhiteSpace</span><span class="op" id="4631936">(</span><span class="ident" id="4631937">s</span><span class="op" id="4631938">,</span>&nbsp;<span class="num" id="4631940">0</span><span class="op" id="4631941">)</span>&nbsp;<span class="op" id="4631943">&amp;&amp;</span>&nbsp;<span class="ident" id="4631946">c</span><span class="op" id="4631947">.</span><span class="ident" id="4631948">urlPart</span>&nbsp;<span class="op" id="4631956">==</span>&nbsp;<span class="ident" id="4631959">urlPartNone</span>&nbsp;<span class="op" id="4631971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631975">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632040">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632103">c</span><span class="op" id="4632104">.</span><span class="ident" id="4632105">urlPart</span>&nbsp;<span class="op" id="4632113">=</span>&nbsp;<span class="ident" id="4632115">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4632132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632135">return</span>&nbsp;<span class="ident" id="4632142">c</span><span class="op" id="4632143">,</span>&nbsp;<span class="builtinfunc" id="4632145">len</span><span class="op" id="4632148">(</span><span class="ident" id="4632149">s</span><span class="op" id="4632150">)</span><br>
<span class="lineno"></span><span class="op" id="4632152">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4632155">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4632215">func</span>&nbsp;<span class="ident" id="4632220">tJS</span><span class="op" id="4632223">(</span><span class="ident" id="4632224">c</span>&nbsp;<span class="ident" id="4632226">context</span><span class="op" id="4632233">,</span>&nbsp;<span class="ident" id="4632235">s</span>&nbsp;<span class="op" id="4632237">[</span><span class="op" id="4632238">]</span><span class="builtintype" id="4632239">byte</span><span class="op" id="4632243">)</span>&nbsp;<span class="op" id="4632245">(</span><span class="ident" id="4632246">context</span><span class="op" id="4632253">,</span>&nbsp;<span class="builtintype" id="4632255">int</span><span class="op" id="4632258">)</span>&nbsp;<span class="op" id="4632260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632263">i</span>&nbsp;<span class="op" id="4632265">:=</span>&nbsp;<span class="ident" id="4632268">bytes</span><span class="op" id="4632273">.</span><span class="ident" id="4632274">IndexAny</span><span class="op" id="4632282">(</span><span class="ident" id="4632283">s</span><span class="op" id="4632284">,</span>&nbsp;<span class="string" id="4632286">`&#34;&#39;/`</span><span class="op" id="4632291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632294">if</span>&nbsp;<span class="ident" id="4632297">i</span>&nbsp;<span class="op" id="4632299">==</span>&nbsp;<span class="op" id="4632302">-</span><span class="num" id="4632303">1</span>&nbsp;<span class="op" id="4632305">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632309">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632366">c</span><span class="op" id="4632367">.</span><span class="ident" id="4632368">jsCtx</span>&nbsp;<span class="op" id="4632374">=</span>&nbsp;<span class="ident" id="4632376">nextJSCtx</span><span class="op" id="4632385">(</span><span class="ident" id="4632386">s</span><span class="op" id="4632387">,</span>&nbsp;<span class="ident" id="4632389">c</span><span class="op" id="4632390">.</span><span class="ident" id="4632391">jsCtx</span><span class="op" id="4632396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632400">return</span>&nbsp;<span class="ident" id="4632407">c</span><span class="op" id="4632408">,</span>&nbsp;<span class="builtinfunc" id="4632410">len</span><span class="op" id="4632413">(</span><span class="ident" id="4632414">s</span><span class="op" id="4632415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4632418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632421">c</span><span class="op" id="4632422">.</span><span class="ident" id="4632423">jsCtx</span>&nbsp;<span class="op" id="4632429">=</span>&nbsp;<span class="ident" id="4632431">nextJSCtx</span><span class="op" id="4632440">(</span><span class="ident" id="4632441">s</span><span class="op" id="4632442">[</span><span class="op" id="4632443">:</span><span class="ident" id="4632444">i</span><span class="op" id="4632445">]</span><span class="op" id="4632446">,</span>&nbsp;<span class="ident" id="4632448">c</span><span class="op" id="4632449">.</span><span class="ident" id="4632450">jsCtx</span><span class="op" id="4632455">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632458">switch</span>&nbsp;<span class="ident" id="4632465">s</span><span class="op" id="4632466">[</span><span class="ident" id="4632467">i</span><span class="op" id="4632468">]</span>&nbsp;<span class="op" id="4632470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632473">case</span>&nbsp;<span class="string" id="4632478">&#39;&#34;&#39;</span><span class="op" id="4632481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632485">c</span><span class="op" id="4632486">.</span><span class="ident" id="4632487">state</span><span class="op" id="4632492">,</span>&nbsp;<span class="ident" id="4632494">c</span><span class="op" id="4632495">.</span><span class="ident" id="4632496">jsCtx</span>&nbsp;<span class="op" id="4632502">=</span>&nbsp;<span class="ident" id="4632504">stateJSDqStr</span><span class="op" id="4632516">,</span>&nbsp;<span class="ident" id="4632518">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632531">case</span>&nbsp;<span class="string" id="4632536">&#39;\&#39;&#39;</span><span class="op" id="4632540">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632544">c</span><span class="op" id="4632545">.</span><span class="ident" id="4632546">state</span><span class="op" id="4632551">,</span>&nbsp;<span class="ident" id="4632553">c</span><span class="op" id="4632554">.</span><span class="ident" id="4632555">jsCtx</span>&nbsp;<span class="op" id="4632561">=</span>&nbsp;<span class="ident" id="4632563">stateJSSqStr</span><span class="op" id="4632575">,</span>&nbsp;<span class="ident" id="4632577">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632590">case</span>&nbsp;<span class="string" id="4632595">&#39;/&#39;</span><span class="op" id="4632598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632602">switch</span>&nbsp;<span class="op" id="4632609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632613">case</span>&nbsp;<span class="ident" id="4632618">i</span><span class="op" id="4632619">+</span><span class="num" id="4632620">1</span>&nbsp;<span class="op" id="4632622">&lt;</span>&nbsp;<span class="builtinfunc" id="4632624">len</span><span class="op" id="4632627">(</span><span class="ident" id="4632628">s</span><span class="op" id="4632629">)</span>&nbsp;<span class="op" id="4632631">&amp;&amp;</span>&nbsp;<span class="ident" id="4632634">s</span><span class="op" id="4632635">[</span><span class="ident" id="4632636">i</span><span class="op" id="4632637">+</span><span class="num" id="4632638">1</span><span class="op" id="4632639">]</span>&nbsp;<span class="op" id="4632641">==</span>&nbsp;<span class="string" id="4632644">&#39;/&#39;</span><span class="op" id="4632647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632652">c</span><span class="op" id="4632653">.</span><span class="ident" id="4632654">state</span><span class="op" id="4632659">,</span>&nbsp;<span class="ident" id="4632661">i</span>&nbsp;<span class="op" id="4632663">=</span>&nbsp;<span class="ident" id="4632665">stateJSLineCmt</span><span class="op" id="4632679">,</span>&nbsp;<span class="ident" id="4632681">i</span><span class="op" id="4632682">+</span><span class="num" id="4632683">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632687">case</span>&nbsp;<span class="ident" id="4632692">i</span><span class="op" id="4632693">+</span><span class="num" id="4632694">1</span>&nbsp;<span class="op" id="4632696">&lt;</span>&nbsp;<span class="builtinfunc" id="4632698">len</span><span class="op" id="4632701">(</span><span class="ident" id="4632702">s</span><span class="op" id="4632703">)</span>&nbsp;<span class="op" id="4632705">&amp;&amp;</span>&nbsp;<span class="ident" id="4632708">s</span><span class="op" id="4632709">[</span><span class="ident" id="4632710">i</span><span class="op" id="4632711">+</span><span class="num" id="4632712">1</span><span class="op" id="4632713">]</span>&nbsp;<span class="op" id="4632715">==</span>&nbsp;<span class="string" id="4632718">&#39;*&#39;</span><span class="op" id="4632721">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632726">c</span><span class="op" id="4632727">.</span><span class="ident" id="4632728">state</span><span class="op" id="4632733">,</span>&nbsp;<span class="ident" id="4632735">i</span>&nbsp;<span class="op" id="4632737">=</span>&nbsp;<span class="ident" id="4632739">stateJSBlockCmt</span><span class="op" id="4632754">,</span>&nbsp;<span class="ident" id="4632756">i</span><span class="op" id="4632757">+</span><span class="num" id="4632758">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632762">case</span>&nbsp;<span class="ident" id="4632767">c</span><span class="op" id="4632768">.</span><span class="ident" id="4632769">jsCtx</span>&nbsp;<span class="op" id="4632775">==</span>&nbsp;<span class="ident" id="4632778">jsCtxRegexp</span><span class="op" id="4632789">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632794">c</span><span class="op" id="4632795">.</span><span class="ident" id="4632796">state</span>&nbsp;<span class="op" id="4632802">=</span>&nbsp;<span class="ident" id="4632804">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632820">case</span>&nbsp;<span class="ident" id="4632825">c</span><span class="op" id="4632826">.</span><span class="ident" id="4632827">jsCtx</span>&nbsp;<span class="op" id="4632833">==</span>&nbsp;<span class="ident" id="4632836">jsCtxDivOp</span><span class="op" id="4632846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632851">c</span><span class="op" id="4632852">.</span><span class="ident" id="4632853">jsCtx</span>&nbsp;<span class="op" id="4632859">=</span>&nbsp;<span class="ident" id="4632861">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632875">default</span><span class="op" id="4632882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632887">return</span>&nbsp;<span class="ident" id="4632894">context</span><span class="op" id="4632901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632907">state</span><span class="op" id="4632912">:</span>&nbsp;<span class="ident" id="4632914">stateError</span><span class="op" id="4632924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4632930">err</span><span class="op" id="4632933">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4632937">errorf</span><span class="op" id="4632943">(</span><span class="ident" id="4632944">ErrSlashAmbig</span><span class="op" id="4632957">,</span>&nbsp;<span class="ident" id="4632959">nil</span><span class="op" id="4632962">,</span>&nbsp;<span class="num" id="4632964">0</span><span class="op" id="4632965">,</span>&nbsp;<span class="string" id="4632967">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="4633012">,</span>&nbsp;<span class="ident" id="4633014">s</span><span class="op" id="4633015">[</span><span class="ident" id="4633016">i</span><span class="op" id="4633017">:</span><span class="op" id="4633018">]</span><span class="op" id="4633019">)</span><span class="op" id="4633020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633025">}</span><span class="op" id="4633026">,</span>&nbsp;<span class="builtinfunc" id="4633028">len</span><span class="op" id="4633031">(</span><span class="ident" id="4633032">s</span><span class="op" id="4633033">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633040">default</span><span class="op" id="4633047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4633051">panic</span><span class="op" id="4633056">(</span><span class="string" id="4633057">&#34;unreachable&#34;</span><span class="op" id="4633070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633076">return</span>&nbsp;<span class="ident" id="4633083">c</span><span class="op" id="4633084">,</span>&nbsp;<span class="ident" id="4633086">i</span>&nbsp;<span class="op" id="4633088">+</span>&nbsp;<span class="num" id="4633090">1</span><br>
<span class="lineno">255</span><span class="op" id="4633092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4633095">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4633175">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4633186">func</span>&nbsp;<span class="ident" id="4633191">tJSDelimited</span><span class="op" id="4633203">(</span><span class="ident" id="4633204">c</span>&nbsp;<span class="ident" id="4633206">context</span><span class="op" id="4633213">,</span>&nbsp;<span class="ident" id="4633215">s</span>&nbsp;<span class="op" id="4633217">[</span><span class="op" id="4633218">]</span><span class="builtintype" id="4633219">byte</span><span class="op" id="4633223">)</span>&nbsp;<span class="op" id="4633225">(</span><span class="ident" id="4633226">context</span><span class="op" id="4633233">,</span>&nbsp;<span class="builtintype" id="4633235">int</span><span class="op" id="4633238">)</span>&nbsp;<span class="op" id="4633240">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633243">specials</span>&nbsp;<span class="op" id="4633252">:=</span>&nbsp;<span class="string" id="4633255">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633261">switch</span>&nbsp;<span class="ident" id="4633268">c</span><span class="op" id="4633269">.</span><span class="ident" id="4633270">state</span>&nbsp;<span class="op" id="4633276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633279">case</span>&nbsp;<span class="ident" id="4633284">stateJSSqStr</span><span class="op" id="4633296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633300">specials</span>&nbsp;<span class="op" id="4633309">=</span>&nbsp;<span class="string" id="4633311">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633317">case</span>&nbsp;<span class="ident" id="4633322">stateJSRegexp</span><span class="op" id="4633335">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633339">specials</span>&nbsp;<span class="op" id="4633348">=</span>&nbsp;<span class="string" id="4633350">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633362">k</span><span class="op" id="4633363">,</span>&nbsp;<span class="ident" id="4633365">inCharset</span>&nbsp;<span class="op" id="4633375">:=</span>&nbsp;<span class="num" id="4633378">0</span><span class="op" id="4633379">,</span>&nbsp;<span class="builtintype" id="4633381">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633388">for</span>&nbsp;<span class="op" id="4633392">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633396">i</span>&nbsp;<span class="op" id="4633398">:=</span>&nbsp;<span class="ident" id="4633401">k</span>&nbsp;<span class="op" id="4633403">+</span>&nbsp;<span class="ident" id="4633405">bytes</span><span class="op" id="4633410">.</span><span class="ident" id="4633411">IndexAny</span><span class="op" id="4633419">(</span><span class="ident" id="4633420">s</span><span class="op" id="4633421">[</span><span class="ident" id="4633422">k</span><span class="op" id="4633423">:</span><span class="op" id="4633424">]</span><span class="op" id="4633425">,</span>&nbsp;<span class="ident" id="4633427">specials</span><span class="op" id="4633435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633439">if</span>&nbsp;<span class="ident" id="4633442">i</span>&nbsp;<span class="op" id="4633444">&lt;</span>&nbsp;<span class="ident" id="4633446">k</span>&nbsp;<span class="op" id="4633448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633453">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633465">switch</span>&nbsp;<span class="ident" id="4633472">s</span><span class="op" id="4633473">[</span><span class="ident" id="4633474">i</span><span class="op" id="4633475">]</span>&nbsp;<span class="op" id="4633477">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633481">case</span>&nbsp;<span class="string" id="4633486">&#39;\\&#39;</span><span class="op" id="4633490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633495">i</span><span class="op" id="4633496">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633502">if</span>&nbsp;<span class="ident" id="4633505">i</span>&nbsp;<span class="op" id="4633507">==</span>&nbsp;<span class="builtinfunc" id="4633510">len</span><span class="op" id="4633513">(</span><span class="ident" id="4633514">s</span><span class="op" id="4633515">)</span>&nbsp;<span class="op" id="4633517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633523">return</span>&nbsp;<span class="ident" id="4633530">context</span><span class="op" id="4633537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633544">state</span><span class="op" id="4633549">:</span>&nbsp;<span class="ident" id="4633551">stateError</span><span class="op" id="4633561">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633568">err</span><span class="op" id="4633571">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4633575">errorf</span><span class="op" id="4633581">(</span><span class="ident" id="4633582">ErrPartialEscape</span><span class="op" id="4633598">,</span>&nbsp;<span class="ident" id="4633600">nil</span><span class="op" id="4633603">,</span>&nbsp;<span class="num" id="4633605">0</span><span class="op" id="4633606">,</span>&nbsp;<span class="string" id="4633608">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4633653">,</span>&nbsp;<span class="ident" id="4633655">s</span><span class="op" id="4633656">)</span><span class="op" id="4633657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633663">}</span><span class="op" id="4633664">,</span>&nbsp;<span class="builtinfunc" id="4633666">len</span><span class="op" id="4633669">(</span><span class="ident" id="4633670">s</span><span class="op" id="4633671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633680">case</span>&nbsp;<span class="string" id="4633685">&#39;[&#39;</span><span class="op" id="4633688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633693">inCharset</span>&nbsp;<span class="op" id="4633703">=</span>&nbsp;<span class="builtintype" id="4633705">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633712">case</span>&nbsp;<span class="string" id="4633717">&#39;]&#39;</span><span class="op" id="4633720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633725">inCharset</span>&nbsp;<span class="op" id="4633735">=</span>&nbsp;<span class="builtintype" id="4633737">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633745">default</span><span class="op" id="4633752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4633757">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633777">if</span>&nbsp;<span class="op" id="4633780">!</span><span class="ident" id="4633781">inCharset</span>&nbsp;<span class="op" id="4633791">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633797">c</span><span class="op" id="4633798">.</span><span class="ident" id="4633799">state</span><span class="op" id="4633804">,</span>&nbsp;<span class="ident" id="4633806">c</span><span class="op" id="4633807">.</span><span class="ident" id="4633808">jsCtx</span>&nbsp;<span class="op" id="4633814">=</span>&nbsp;<span class="ident" id="4633816">stateJS</span><span class="op" id="4633823">,</span>&nbsp;<span class="ident" id="4633825">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633840">return</span>&nbsp;<span class="ident" id="4633847">c</span><span class="op" id="4633848">,</span>&nbsp;<span class="ident" id="4633850">i</span>&nbsp;<span class="op" id="4633852">+</span>&nbsp;<span class="num" id="4633854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633867">k</span>&nbsp;<span class="op" id="4633869">=</span>&nbsp;<span class="ident" id="4633871">i</span>&nbsp;<span class="op" id="4633873">+</span>&nbsp;<span class="num" id="4633875">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633882">if</span>&nbsp;<span class="ident" id="4633885">inCharset</span>&nbsp;<span class="op" id="4633895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4633899">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4633964">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633995">return</span>&nbsp;<span class="ident" id="4634002">context</span><span class="op" id="4634009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634014">state</span><span class="op" id="4634019">:</span>&nbsp;<span class="ident" id="4634021">stateError</span><span class="op" id="4634031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634036">err</span><span class="op" id="4634039">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4634043">errorf</span><span class="op" id="4634049">(</span><span class="ident" id="4634050">ErrPartialCharset</span><span class="op" id="4634067">,</span>&nbsp;<span class="ident" id="4634069">nil</span><span class="op" id="4634072">,</span>&nbsp;<span class="num" id="4634074">0</span><span class="op" id="4634075">,</span>&nbsp;<span class="string" id="4634077">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="4634111">,</span>&nbsp;<span class="ident" id="4634113">s</span><span class="op" id="4634114">)</span><span class="op" id="4634115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634119">}</span><span class="op" id="4634120">,</span>&nbsp;<span class="builtinfunc" id="4634122">len</span><span class="op" id="4634125">(</span><span class="ident" id="4634126">s</span><span class="op" id="4634127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634130">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634134">return</span>&nbsp;<span class="ident" id="4634141">c</span><span class="op" id="4634142">,</span>&nbsp;<span class="builtinfunc" id="4634144">len</span><span class="op" id="4634147">(</span><span class="ident" id="4634148">s</span><span class="op" id="4634149">)</span><br>
<span class="lineno"></span><span class="op" id="4634151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4634154">var</span>&nbsp;<span class="ident" id="4634158">blockCommentEnd</span>&nbsp;<span class="op" id="4634174">=</span>&nbsp;<span class="op" id="4634176">[</span><span class="op" id="4634177">]</span><span class="builtintype" id="4634178">byte</span><span class="op" id="4634182">(</span><span class="string" id="4634183">&#34;*/&#34;</span><span class="op" id="4634187">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="4634190">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4634262">func</span>&nbsp;<span class="ident" id="4634267">tBlockCmt</span><span class="op" id="4634276">(</span><span class="ident" id="4634277">c</span>&nbsp;<span class="ident" id="4634279">context</span><span class="op" id="4634286">,</span>&nbsp;<span class="ident" id="4634288">s</span>&nbsp;<span class="op" id="4634290">[</span><span class="op" id="4634291">]</span><span class="builtintype" id="4634292">byte</span><span class="op" id="4634296">)</span>&nbsp;<span class="op" id="4634298">(</span><span class="ident" id="4634299">context</span><span class="op" id="4634306">,</span>&nbsp;<span class="builtintype" id="4634308">int</span><span class="op" id="4634311">)</span>&nbsp;<span class="op" id="4634313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634316">i</span>&nbsp;<span class="op" id="4634318">:=</span>&nbsp;<span class="ident" id="4634321">bytes</span><span class="op" id="4634326">.</span><span class="ident" id="4634327">Index</span><span class="op" id="4634332">(</span><span class="ident" id="4634333">s</span><span class="op" id="4634334">,</span>&nbsp;<span class="ident" id="4634336">blockCommentEnd</span><span class="op" id="4634351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634354">if</span>&nbsp;<span class="ident" id="4634357">i</span>&nbsp;<span class="op" id="4634359">==</span>&nbsp;<span class="op" id="4634362">-</span><span class="num" id="4634363">1</span>&nbsp;<span class="op" id="4634365">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634369">return</span>&nbsp;<span class="ident" id="4634376">c</span><span class="op" id="4634377">,</span>&nbsp;<span class="builtinfunc" id="4634379">len</span><span class="op" id="4634382">(</span><span class="ident" id="4634383">s</span><span class="op" id="4634384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634390">switch</span>&nbsp;<span class="ident" id="4634397">c</span><span class="op" id="4634398">.</span><span class="ident" id="4634399">state</span>&nbsp;<span class="op" id="4634405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634408">case</span>&nbsp;<span class="ident" id="4634413">stateJSBlockCmt</span><span class="op" id="4634428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634432">c</span><span class="op" id="4634433">.</span><span class="ident" id="4634434">state</span>&nbsp;<span class="op" id="4634440">=</span>&nbsp;<span class="ident" id="4634442">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634451">case</span>&nbsp;<span class="ident" id="4634456">stateCSSBlockCmt</span><span class="op" id="4634472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634476">c</span><span class="op" id="4634477">.</span><span class="ident" id="4634478">state</span>&nbsp;<span class="op" id="4634484">=</span>&nbsp;<span class="ident" id="4634486">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634496">default</span><span class="op" id="4634503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4634507">panic</span><span class="op" id="4634512">(</span><span class="ident" id="4634513">c</span><span class="op" id="4634514">.</span><span class="ident" id="4634515">state</span><span class="op" id="4634520">.</span><span class="ident" id="4634521">String</span><span class="op" id="4634527">(</span><span class="op" id="4634528">)</span><span class="op" id="4634529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634532">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634535">return</span>&nbsp;<span class="ident" id="4634542">c</span><span class="op" id="4634543">,</span>&nbsp;<span class="ident" id="4634545">i</span>&nbsp;<span class="op" id="4634547">+</span>&nbsp;<span class="num" id="4634549">2</span><br>
<span class="lineno"></span><span class="op" id="4634551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4634554">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4634623">func</span>&nbsp;<span class="ident" id="4634628">tLineCmt</span><span class="op" id="4634636">(</span><span class="ident" id="4634637">c</span>&nbsp;<span class="ident" id="4634639">context</span><span class="op" id="4634646">,</span>&nbsp;<span class="ident" id="4634648">s</span>&nbsp;<span class="op" id="4634650">[</span><span class="op" id="4634651">]</span><span class="builtintype" id="4634652">byte</span><span class="op" id="4634656">)</span>&nbsp;<span class="op" id="4634658">(</span><span class="ident" id="4634659">context</span><span class="op" id="4634666">,</span>&nbsp;<span class="builtintype" id="4634668">int</span><span class="op" id="4634671">)</span>&nbsp;<span class="op" id="4634673">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634676">var</span>&nbsp;<span class="ident" id="4634680">lineTerminators</span>&nbsp;<span class="builtintype" id="4634696">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634704">var</span>&nbsp;<span class="ident" id="4634708">endState</span>&nbsp;<span class="ident" id="4634717">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634724">switch</span>&nbsp;<span class="ident" id="4634731">c</span><span class="op" id="4634732">.</span><span class="ident" id="4634733">state</span>&nbsp;<span class="op" id="4634739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634742">case</span>&nbsp;<span class="ident" id="4634747">stateJSLineCmt</span><span class="op" id="4634761">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634765">lineTerminators</span><span class="op" id="4634780">,</span>&nbsp;<span class="ident" id="4634782">endState</span>&nbsp;<span class="op" id="4634791">=</span>&nbsp;<span class="string" id="4634793">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="4634811">,</span>&nbsp;<span class="ident" id="4634813">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634822">case</span>&nbsp;<span class="ident" id="4634827">stateCSSLineCmt</span><span class="op" id="4634842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634846">lineTerminators</span><span class="op" id="4634861">,</span>&nbsp;<span class="ident" id="4634863">endState</span>&nbsp;<span class="op" id="4634872">=</span>&nbsp;<span class="string" id="4634874">&#34;\n\f\r&#34;</span><span class="op" id="4634882">,</span>&nbsp;<span class="ident" id="4634884">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634895">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634961">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635005">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635040">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635081">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635144">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635159">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635200">default</span><span class="op" id="4635207">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4635211">panic</span><span class="op" id="4635216">(</span><span class="ident" id="4635217">c</span><span class="op" id="4635218">.</span><span class="ident" id="4635219">state</span><span class="op" id="4635224">.</span><span class="ident" id="4635225">String</span><span class="op" id="4635231">(</span><span class="op" id="4635232">)</span><span class="op" id="4635233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635240">i</span>&nbsp;<span class="op" id="4635242">:=</span>&nbsp;<span class="ident" id="4635245">bytes</span><span class="op" id="4635250">.</span><span class="ident" id="4635251">IndexAny</span><span class="op" id="4635259">(</span><span class="ident" id="4635260">s</span><span class="op" id="4635261">,</span>&nbsp;<span class="ident" id="4635263">lineTerminators</span><span class="op" id="4635278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635281">if</span>&nbsp;<span class="ident" id="4635284">i</span>&nbsp;<span class="op" id="4635286">==</span>&nbsp;<span class="op" id="4635289">-</span><span class="num" id="4635290">1</span>&nbsp;<span class="op" id="4635292">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635296">return</span>&nbsp;<span class="ident" id="4635303">c</span><span class="op" id="4635304">,</span>&nbsp;<span class="builtinfunc" id="4635306">len</span><span class="op" id="4635309">(</span><span class="ident" id="4635310">s</span><span class="op" id="4635311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635317">c</span><span class="op" id="4635318">.</span><span class="ident" id="4635319">state</span>&nbsp;<span class="op" id="4635325">=</span>&nbsp;<span class="ident" id="4635327">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635337">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635403">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635466">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635526">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635592">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635656">return</span>&nbsp;<span class="ident" id="4635663">c</span><span class="op" id="4635664">,</span>&nbsp;<span class="ident" id="4635666">i</span><br>
<span class="lineno"></span><span class="op" id="4635668">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4635671">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4635733">func</span>&nbsp;<span class="ident" id="4635738">tCSS</span><span class="op" id="4635742">(</span><span class="ident" id="4635743">c</span>&nbsp;<span class="ident" id="4635745">context</span><span class="op" id="4635752">,</span>&nbsp;<span class="ident" id="4635754">s</span>&nbsp;<span class="op" id="4635756">[</span><span class="op" id="4635757">]</span><span class="builtintype" id="4635758">byte</span><span class="op" id="4635762">)</span>&nbsp;<span class="op" id="4635764">(</span><span class="ident" id="4635765">context</span><span class="op" id="4635772">,</span>&nbsp;<span class="builtintype" id="4635774">int</span><span class="op" id="4635777">)</span>&nbsp;<span class="op" id="4635779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635782">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635839">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635881">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4635947">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636009">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636024">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636077">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636123">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636174">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636235">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636251">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636308">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636378">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636382">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636445">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636480">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636484">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636538">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636607">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636679">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636700">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636768">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636838">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636899">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4636970">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637039">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637078">k</span>&nbsp;<span class="op" id="4637080">:=</span>&nbsp;<span class="num" id="4637083">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637086">for</span>&nbsp;<span class="op" id="4637090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637094">i</span>&nbsp;<span class="op" id="4637096">:=</span>&nbsp;<span class="ident" id="4637099">k</span>&nbsp;<span class="op" id="4637101">+</span>&nbsp;<span class="ident" id="4637103">bytes</span><span class="op" id="4637108">.</span><span class="ident" id="4637109">IndexAny</span><span class="op" id="4637117">(</span><span class="ident" id="4637118">s</span><span class="op" id="4637119">[</span><span class="ident" id="4637120">k</span><span class="op" id="4637121">:</span><span class="op" id="4637122">]</span><span class="op" id="4637123">,</span>&nbsp;<span class="string" id="4637125">`(&#34;&#39;/`</span><span class="op" id="4637131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637135">if</span>&nbsp;<span class="ident" id="4637138">i</span>&nbsp;<span class="op" id="4637140">&lt;</span>&nbsp;<span class="ident" id="4637142">k</span>&nbsp;<span class="op" id="4637144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637149">return</span>&nbsp;<span class="ident" id="4637156">c</span><span class="op" id="4637157">,</span>&nbsp;<span class="builtinfunc" id="4637159">len</span><span class="op" id="4637162">(</span><span class="ident" id="4637163">s</span><span class="op" id="4637164">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637172">switch</span>&nbsp;<span class="ident" id="4637179">s</span><span class="op" id="4637180">[</span><span class="ident" id="4637181">i</span><span class="op" id="4637182">]</span>&nbsp;<span class="op" id="4637184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637188">case</span>&nbsp;<span class="string" id="4637193">&#39;(&#39;</span><span class="op" id="4637196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637201">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637233">p</span>&nbsp;<span class="op" id="4637235">:=</span>&nbsp;<span class="ident" id="4637238">bytes</span><span class="op" id="4637243">.</span><span class="ident" id="4637244">TrimRight</span><span class="op" id="4637253">(</span><span class="ident" id="4637254">s</span><span class="op" id="4637255">[</span><span class="op" id="4637256">:</span><span class="ident" id="4637257">i</span><span class="op" id="4637258">]</span><span class="op" id="4637259">,</span>&nbsp;<span class="string" id="4637261">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4637272">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637277">if</span>&nbsp;<span class="ident" id="4637280">endsWithCSSKeyword</span><span class="op" id="4637298">(</span><span class="ident" id="4637299">p</span><span class="op" id="4637300">,</span>&nbsp;<span class="string" id="4637302">&#34;url&#34;</span><span class="op" id="4637307">)</span>&nbsp;<span class="op" id="4637309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637315">j</span>&nbsp;<span class="op" id="4637317">:=</span>&nbsp;<span class="builtinfunc" id="4637320">len</span><span class="op" id="4637323">(</span><span class="ident" id="4637324">s</span><span class="op" id="4637325">)</span>&nbsp;<span class="op" id="4637327">-</span>&nbsp;<span class="builtinfunc" id="4637329">len</span><span class="op" id="4637332">(</span><span class="ident" id="4637333">bytes</span><span class="op" id="4637338">.</span><span class="ident" id="4637339">TrimLeft</span><span class="op" id="4637347">(</span><span class="ident" id="4637348">s</span><span class="op" id="4637349">[</span><span class="ident" id="4637350">i</span><span class="op" id="4637351">+</span><span class="num" id="4637352">1</span><span class="op" id="4637353">:</span><span class="op" id="4637354">]</span><span class="op" id="4637355">,</span>&nbsp;<span class="string" id="4637357">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4637368">)</span><span class="op" id="4637369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637375">switch</span>&nbsp;<span class="op" id="4637382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637388">case</span>&nbsp;<span class="ident" id="4637393">j</span>&nbsp;<span class="op" id="4637395">!=</span>&nbsp;<span class="builtinfunc" id="4637398">len</span><span class="op" id="4637401">(</span><span class="ident" id="4637402">s</span><span class="op" id="4637403">)</span>&nbsp;<span class="op" id="4637405">&amp;&amp;</span>&nbsp;<span class="ident" id="4637408">s</span><span class="op" id="4637409">[</span><span class="ident" id="4637410">j</span><span class="op" id="4637411">]</span>&nbsp;<span class="op" id="4637413">==</span>&nbsp;<span class="string" id="4637416">&#39;&#34;&#39;</span><span class="op" id="4637419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637426">c</span><span class="op" id="4637427">.</span><span class="ident" id="4637428">state</span><span class="op" id="4637433">,</span>&nbsp;<span class="ident" id="4637435">j</span>&nbsp;<span class="op" id="4637437">=</span>&nbsp;<span class="ident" id="4637439">stateCSSDqURL</span><span class="op" id="4637452">,</span>&nbsp;<span class="ident" id="4637454">j</span><span class="op" id="4637455">+</span><span class="num" id="4637456">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637462">case</span>&nbsp;<span class="ident" id="4637467">j</span>&nbsp;<span class="op" id="4637469">!=</span>&nbsp;<span class="builtinfunc" id="4637472">len</span><span class="op" id="4637475">(</span><span class="ident" id="4637476">s</span><span class="op" id="4637477">)</span>&nbsp;<span class="op" id="4637479">&amp;&amp;</span>&nbsp;<span class="ident" id="4637482">s</span><span class="op" id="4637483">[</span><span class="ident" id="4637484">j</span><span class="op" id="4637485">]</span>&nbsp;<span class="op" id="4637487">==</span>&nbsp;<span class="string" id="4637490">&#39;\&#39;&#39;</span><span class="op" id="4637494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637501">c</span><span class="op" id="4637502">.</span><span class="ident" id="4637503">state</span><span class="op" id="4637508">,</span>&nbsp;<span class="ident" id="4637510">j</span>&nbsp;<span class="op" id="4637512">=</span>&nbsp;<span class="ident" id="4637514">stateCSSSqURL</span><span class="op" id="4637527">,</span>&nbsp;<span class="ident" id="4637529">j</span><span class="op" id="4637530">+</span><span class="num" id="4637531">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637537">default</span><span class="op" id="4637544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637551">c</span><span class="op" id="4637552">.</span><span class="ident" id="4637553">state</span>&nbsp;<span class="op" id="4637559">=</span>&nbsp;<span class="ident" id="4637561">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637577">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637583">return</span>&nbsp;<span class="ident" id="4637590">c</span><span class="op" id="4637591">,</span>&nbsp;<span class="ident" id="4637593">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637602">case</span>&nbsp;<span class="string" id="4637607">&#39;/&#39;</span><span class="op" id="4637610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637615">if</span>&nbsp;<span class="ident" id="4637618">i</span><span class="op" id="4637619">+</span><span class="num" id="4637620">1</span>&nbsp;<span class="op" id="4637622">&lt;</span>&nbsp;<span class="builtinfunc" id="4637624">len</span><span class="op" id="4637627">(</span><span class="ident" id="4637628">s</span><span class="op" id="4637629">)</span>&nbsp;<span class="op" id="4637631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637637">switch</span>&nbsp;<span class="ident" id="4637644">s</span><span class="op" id="4637645">[</span><span class="ident" id="4637646">i</span><span class="op" id="4637647">+</span><span class="num" id="4637648">1</span><span class="op" id="4637649">]</span>&nbsp;<span class="op" id="4637651">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637657">case</span>&nbsp;<span class="string" id="4637662">&#39;/&#39;</span><span class="op" id="4637665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637672">c</span><span class="op" id="4637673">.</span><span class="ident" id="4637674">state</span>&nbsp;<span class="op" id="4637680">=</span>&nbsp;<span class="ident" id="4637682">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637703">return</span>&nbsp;<span class="ident" id="4637710">c</span><span class="op" id="4637711">,</span>&nbsp;<span class="ident" id="4637713">i</span>&nbsp;<span class="op" id="4637715">+</span>&nbsp;<span class="num" id="4637717">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637723">case</span>&nbsp;<span class="string" id="4637728">&#39;*&#39;</span><span class="op" id="4637731">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637738">c</span><span class="op" id="4637739">.</span><span class="ident" id="4637740">state</span>&nbsp;<span class="op" id="4637746">=</span>&nbsp;<span class="ident" id="4637748">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637770">return</span>&nbsp;<span class="ident" id="4637777">c</span><span class="op" id="4637778">,</span>&nbsp;<span class="ident" id="4637780">i</span>&nbsp;<span class="op" id="4637782">+</span>&nbsp;<span class="num" id="4637784">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637799">case</span>&nbsp;<span class="string" id="4637804">&#39;&#34;&#39;</span><span class="op" id="4637807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637812">c</span><span class="op" id="4637813">.</span><span class="ident" id="4637814">state</span>&nbsp;<span class="op" id="4637820">=</span>&nbsp;<span class="ident" id="4637822">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637839">return</span>&nbsp;<span class="ident" id="4637846">c</span><span class="op" id="4637847">,</span>&nbsp;<span class="ident" id="4637849">i</span>&nbsp;<span class="op" id="4637851">+</span>&nbsp;<span class="num" id="4637853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637857">case</span>&nbsp;<span class="string" id="4637862">&#39;\&#39;&#39;</span><span class="op" id="4637866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637871">c</span><span class="op" id="4637872">.</span><span class="ident" id="4637873">state</span>&nbsp;<span class="op" id="4637879">=</span>&nbsp;<span class="ident" id="4637881">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637898">return</span>&nbsp;<span class="ident" id="4637905">c</span><span class="op" id="4637906">,</span>&nbsp;<span class="ident" id="4637908">i</span>&nbsp;<span class="op" id="4637910">+</span>&nbsp;<span class="num" id="4637912">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637916">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637920">k</span>&nbsp;<span class="op" id="4637922">=</span>&nbsp;<span class="ident" id="4637924">i</span>&nbsp;<span class="op" id="4637926">+</span>&nbsp;<span class="num" id="4637928">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637931">}</span><br>
<span class="lineno"></span><span class="op" id="4637933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4637936">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="4638017">func</span>&nbsp;<span class="ident" id="4638022">tCSSStr</span><span class="op" id="4638029">(</span><span class="ident" id="4638030">c</span>&nbsp;<span class="ident" id="4638032">context</span><span class="op" id="4638039">,</span>&nbsp;<span class="ident" id="4638041">s</span>&nbsp;<span class="op" id="4638043">[</span><span class="op" id="4638044">]</span><span class="builtintype" id="4638045">byte</span><span class="op" id="4638049">)</span>&nbsp;<span class="op" id="4638051">(</span><span class="ident" id="4638052">context</span><span class="op" id="4638059">,</span>&nbsp;<span class="builtintype" id="4638061">int</span><span class="op" id="4638064">)</span>&nbsp;<span class="op" id="4638066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638069">var</span>&nbsp;<span class="ident" id="4638073">endAndEsc</span>&nbsp;<span class="builtintype" id="4638083">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638091">switch</span>&nbsp;<span class="ident" id="4638098">c</span><span class="op" id="4638099">.</span><span class="ident" id="4638100">state</span>&nbsp;<span class="op" id="4638106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638109">case</span>&nbsp;<span class="ident" id="4638114">stateCSSDqStr</span><span class="op" id="4638127">,</span>&nbsp;<span class="ident" id="4638129">stateCSSDqURL</span><span class="op" id="4638142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638146">endAndEsc</span>&nbsp;<span class="op" id="4638156">=</span>&nbsp;<span class="string" id="4638158">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638164">case</span>&nbsp;<span class="ident" id="4638169">stateCSSSqStr</span><span class="op" id="4638182">,</span>&nbsp;<span class="ident" id="4638184">stateCSSSqURL</span><span class="op" id="4638197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638201">endAndEsc</span>&nbsp;<span class="op" id="4638211">=</span>&nbsp;<span class="string" id="4638213">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638219">case</span>&nbsp;<span class="ident" id="4638224">stateCSSURL</span><span class="op" id="4638235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638239">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638299">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638361">endAndEsc</span>&nbsp;<span class="op" id="4638371">=</span>&nbsp;<span class="string" id="4638373">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638389">default</span><span class="op" id="4638396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4638400">panic</span><span class="op" id="4638405">(</span><span class="ident" id="4638406">c</span><span class="op" id="4638407">.</span><span class="ident" id="4638408">state</span><span class="op" id="4638413">.</span><span class="ident" id="4638414">String</span><span class="op" id="4638420">(</span><span class="op" id="4638421">)</span><span class="op" id="4638422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638429">k</span>&nbsp;<span class="op" id="4638431">:=</span>&nbsp;<span class="num" id="4638434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638437">for</span>&nbsp;<span class="op" id="4638441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638445">i</span>&nbsp;<span class="op" id="4638447">:=</span>&nbsp;<span class="ident" id="4638450">k</span>&nbsp;<span class="op" id="4638452">+</span>&nbsp;<span class="ident" id="4638454">bytes</span><span class="op" id="4638459">.</span><span class="ident" id="4638460">IndexAny</span><span class="op" id="4638468">(</span><span class="ident" id="4638469">s</span><span class="op" id="4638470">[</span><span class="ident" id="4638471">k</span><span class="op" id="4638472">:</span><span class="op" id="4638473">]</span><span class="op" id="4638474">,</span>&nbsp;<span class="ident" id="4638476">endAndEsc</span><span class="op" id="4638485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638489">if</span>&nbsp;<span class="ident" id="4638492">i</span>&nbsp;<span class="op" id="4638494">&lt;</span>&nbsp;<span class="ident" id="4638496">k</span>&nbsp;<span class="op" id="4638498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638503">c</span><span class="op" id="4638504">,</span>&nbsp;<span class="ident" id="4638506">nread</span>&nbsp;<span class="op" id="4638512">:=</span>&nbsp;<span class="ident" id="4638515">tURL</span><span class="op" id="4638519">(</span><span class="ident" id="4638520">c</span><span class="op" id="4638521">,</span>&nbsp;<span class="ident" id="4638523">decodeCSS</span><span class="op" id="4638532">(</span><span class="ident" id="4638533">s</span><span class="op" id="4638534">[</span><span class="ident" id="4638535">k</span><span class="op" id="4638536">:</span><span class="op" id="4638537">]</span><span class="op" id="4638538">)</span><span class="op" id="4638539">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638544">return</span>&nbsp;<span class="ident" id="4638551">c</span><span class="op" id="4638552">,</span>&nbsp;<span class="ident" id="4638554">k</span>&nbsp;<span class="op" id="4638556">+</span>&nbsp;<span class="ident" id="4638558">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638570">if</span>&nbsp;<span class="ident" id="4638573">s</span><span class="op" id="4638574">[</span><span class="ident" id="4638575">i</span><span class="op" id="4638576">]</span>&nbsp;<span class="op" id="4638578">==</span>&nbsp;<span class="string" id="4638581">&#39;\\&#39;</span>&nbsp;<span class="op" id="4638586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638591">i</span><span class="op" id="4638592">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638598">if</span>&nbsp;<span class="ident" id="4638601">i</span>&nbsp;<span class="op" id="4638603">==</span>&nbsp;<span class="builtinfunc" id="4638606">len</span><span class="op" id="4638609">(</span><span class="ident" id="4638610">s</span><span class="op" id="4638611">)</span>&nbsp;<span class="op" id="4638613">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638619">return</span>&nbsp;<span class="ident" id="4638626">context</span><span class="op" id="4638633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638640">state</span><span class="op" id="4638645">:</span>&nbsp;<span class="ident" id="4638647">stateError</span><span class="op" id="4638657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638664">err</span><span class="op" id="4638667">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4638671">errorf</span><span class="op" id="4638677">(</span><span class="ident" id="4638678">ErrPartialEscape</span><span class="op" id="4638694">,</span>&nbsp;<span class="ident" id="4638696">nil</span><span class="op" id="4638699">,</span>&nbsp;<span class="num" id="4638701">0</span><span class="op" id="4638702">,</span>&nbsp;<span class="string" id="4638704">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4638750">,</span>&nbsp;<span class="ident" id="4638752">s</span><span class="op" id="4638753">)</span><span class="op" id="4638754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638760">}</span><span class="op" id="4638761">,</span>&nbsp;<span class="builtinfunc" id="4638763">len</span><span class="op" id="4638766">(</span><span class="ident" id="4638767">s</span><span class="op" id="4638768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638773">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638777">}</span>&nbsp;<span class="keyword" id="4638779">else</span>&nbsp;<span class="op" id="4638784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638789">c</span><span class="op" id="4638790">.</span><span class="ident" id="4638791">state</span>&nbsp;<span class="op" id="4638797">=</span>&nbsp;<span class="ident" id="4638799">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638811">return</span>&nbsp;<span class="ident" id="4638818">c</span><span class="op" id="4638819">,</span>&nbsp;<span class="ident" id="4638821">i</span>&nbsp;<span class="op" id="4638823">+</span>&nbsp;<span class="num" id="4638825">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638833">c</span><span class="op" id="4638834">,</span>&nbsp;<span class="ident" id="4638836">_</span>&nbsp;<span class="op" id="4638838">=</span>&nbsp;<span class="ident" id="4638840">tURL</span><span class="op" id="4638844">(</span><span class="ident" id="4638845">c</span><span class="op" id="4638846">,</span>&nbsp;<span class="ident" id="4638848">decodeCSS</span><span class="op" id="4638857">(</span><span class="ident" id="4638858">s</span><span class="op" id="4638859">[</span><span class="op" id="4638860">:</span><span class="ident" id="4638861">i</span><span class="op" id="4638862">+</span><span class="num" id="4638863">1</span><span class="op" id="4638864">]</span><span class="op" id="4638865">)</span><span class="op" id="4638866">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638870">k</span>&nbsp;<span class="op" id="4638872">=</span>&nbsp;<span class="ident" id="4638874">i</span>&nbsp;<span class="op" id="4638876">+</span>&nbsp;<span class="num" id="4638878">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638881">}</span><br>
<span class="lineno"></span><span class="op" id="4638883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4638886">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="4638952">func</span>&nbsp;<span class="ident" id="4638957">tError</span><span class="op" id="4638963">(</span><span class="ident" id="4638964">c</span>&nbsp;<span class="ident" id="4638966">context</span><span class="op" id="4638973">,</span>&nbsp;<span class="ident" id="4638975">s</span>&nbsp;<span class="op" id="4638977">[</span><span class="op" id="4638978">]</span><span class="builtintype" id="4638979">byte</span><span class="op" id="4638983">)</span>&nbsp;<span class="op" id="4638985">(</span><span class="ident" id="4638986">context</span><span class="op" id="4638993">,</span>&nbsp;<span class="builtintype" id="4638995">int</span><span class="op" id="4638998">)</span>&nbsp;<span class="op" id="4639000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639003">return</span>&nbsp;<span class="ident" id="4639010">c</span><span class="op" id="4639011">,</span>&nbsp;<span class="builtinfunc" id="4639013">len</span><span class="op" id="4639016">(</span><span class="ident" id="4639017">s</span><span class="op" id="4639018">)</span><br>
<span class="lineno"></span><span class="op" id="4639020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4639023">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="4639099">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4639168">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="4639241">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="4639257">func</span>&nbsp;<span class="ident" id="4639262">eatAttrName</span><span class="op" id="4639273">(</span><span class="ident" id="4639274">s</span>&nbsp;<span class="op" id="4639276">[</span><span class="op" id="4639277">]</span><span class="builtintype" id="4639278">byte</span><span class="op" id="4639282">,</span>&nbsp;<span class="ident" id="4639284">i</span>&nbsp;<span class="builtintype" id="4639286">int</span><span class="op" id="4639289">)</span>&nbsp;<span class="op" id="4639291">(</span><span class="builtintype" id="4639292">int</span><span class="op" id="4639295">,</span>&nbsp;<span class="op" id="4639297">*</span><span class="ident" id="4639298">Error</span><span class="op" id="4639303">)</span>&nbsp;<span class="op" id="4639305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639308">for</span>&nbsp;<span class="ident" id="4639312">j</span>&nbsp;<span class="op" id="4639314">:=</span>&nbsp;<span class="ident" id="4639317">i</span><span class="op" id="4639318">;</span>&nbsp;<span class="ident" id="4639320">j</span>&nbsp;<span class="op" id="4639322">&lt;</span>&nbsp;<span class="builtinfunc" id="4639324">len</span><span class="op" id="4639327">(</span><span class="ident" id="4639328">s</span><span class="op" id="4639329">)</span><span class="op" id="4639330">;</span>&nbsp;<span class="ident" id="4639332">j</span><span class="op" id="4639333">++</span>&nbsp;<span class="op" id="4639336">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639340">switch</span>&nbsp;<span class="ident" id="4639347">s</span><span class="op" id="4639348">[</span><span class="ident" id="4639349">j</span><span class="op" id="4639350">]</span>&nbsp;<span class="op" id="4639352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639356">case</span>&nbsp;<span class="string" id="4639361">&#39;&nbsp;&#39;</span><span class="op" id="4639364">,</span>&nbsp;<span class="string" id="4639366">&#39;\t&#39;</span><span class="op" id="4639370">,</span>&nbsp;<span class="string" id="4639372">&#39;\n&#39;</span><span class="op" id="4639376">,</span>&nbsp;<span class="string" id="4639378">&#39;\f&#39;</span><span class="op" id="4639382">,</span>&nbsp;<span class="string" id="4639384">&#39;\r&#39;</span><span class="op" id="4639388">,</span>&nbsp;<span class="string" id="4639390">&#39;=&#39;</span><span class="op" id="4639393">,</span>&nbsp;<span class="string" id="4639395">&#39;&gt;&#39;</span><span class="op" id="4639398">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639403">return</span>&nbsp;<span class="ident" id="4639410">j</span><span class="op" id="4639411">,</span>&nbsp;<span class="ident" id="4639413">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639419">case</span>&nbsp;<span class="string" id="4639424">&#39;\&#39;&#39;</span><span class="op" id="4639428">,</span>&nbsp;<span class="string" id="4639430">&#39;&#34;&#39;</span><span class="op" id="4639433">,</span>&nbsp;<span class="string" id="4639435">&#39;&lt;&#39;</span><span class="op" id="4639438">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639443">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639498">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639554">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639580">return</span>&nbsp;<span class="op" id="4639587">-</span><span class="num" id="4639588">1</span><span class="op" id="4639589">,</span>&nbsp;<span class="ident" id="4639591">errorf</span><span class="op" id="4639597">(</span><span class="ident" id="4639598">ErrBadHTML</span><span class="op" id="4639608">,</span>&nbsp;<span class="ident" id="4639610">nil</span><span class="op" id="4639613">,</span>&nbsp;<span class="num" id="4639615">0</span><span class="op" id="4639616">,</span>&nbsp;<span class="string" id="4639618">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="4639647">,</span>&nbsp;<span class="ident" id="4639649">s</span><span class="op" id="4639650">[</span><span class="ident" id="4639651">j</span><span class="op" id="4639652">:</span><span class="ident" id="4639653">j</span><span class="op" id="4639654">+</span><span class="num" id="4639655">1</span><span class="op" id="4639656">]</span><span class="op" id="4639657">,</span>&nbsp;<span class="ident" id="4639659">s</span><span class="op" id="4639660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639664">default</span><span class="op" id="4639671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639676">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639694">return</span>&nbsp;<span class="builtinfunc" id="4639701">len</span><span class="op" id="4639704">(</span><span class="ident" id="4639705">s</span><span class="op" id="4639706">)</span><span class="op" id="4639707">,</span>&nbsp;<span class="ident" id="4639709">nil</span><br>
<span class="lineno"></span><span class="op" id="4639713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4639716">var</span>&nbsp;<span class="ident" id="4639720">elementNameMap</span>&nbsp;<span class="op" id="4639735">=</span>&nbsp;<span class="keyword" id="4639737">map</span><span class="op" id="4639740">[</span><span class="builtintype" id="4639741">string</span><span class="op" id="4639747">]</span><span class="ident" id="4639748">element</span><span class="op" id="4639755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639758">&#34;script&#34;</span><span class="op" id="4639766">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4639770">elementScript</span><span class="op" id="4639783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639786">&#34;style&#34;</span><span class="op" id="4639793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639798">elementStyle</span><span class="op" id="4639810">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639813">&#34;textarea&#34;</span><span class="op" id="4639823">:</span>&nbsp;<span class="ident" id="4639825">elementTextarea</span><span class="op" id="4639840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639843">&#34;title&#34;</span><span class="op" id="4639850">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4639855">elementTitle</span><span class="op" id="4639867">,</span><br>
<span class="lineno">505</span><span class="op" id="4639869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4639872">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="4639924">func</span>&nbsp;<span class="ident" id="4639929">asciiAlpha</span><span class="op" id="4639939">(</span><span class="ident" id="4639940">c</span>&nbsp;<span class="builtintype" id="4639942">byte</span><span class="op" id="4639946">)</span>&nbsp;<span class="builtintype" id="4639948">bool</span>&nbsp;<span class="op" id="4639953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639956">return</span>&nbsp;<span class="string" id="4639963">&#39;A&#39;</span>&nbsp;<span class="op" id="4639967">&lt;=</span>&nbsp;<span class="ident" id="4639970">c</span>&nbsp;<span class="op" id="4639972">&amp;&amp;</span>&nbsp;<span class="ident" id="4639975">c</span>&nbsp;<span class="op" id="4639977">&lt;=</span>&nbsp;<span class="string" id="4639980">&#39;Z&#39;</span>&nbsp;<span class="op" id="4639984">||</span>&nbsp;<span class="string" id="4639987">&#39;a&#39;</span>&nbsp;<span class="op" id="4639991">&lt;=</span>&nbsp;<span class="ident" id="4639994">c</span>&nbsp;<span class="op" id="4639996">&amp;&amp;</span>&nbsp;<span class="ident" id="4639999">c</span>&nbsp;<span class="op" id="4640001">&lt;=</span>&nbsp;<span class="string" id="4640004">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="4640008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640011">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="4640075">func</span>&nbsp;<span class="ident" id="4640080">asciiAlphaNum</span><span class="op" id="4640093">(</span><span class="ident" id="4640094">c</span>&nbsp;<span class="builtintype" id="4640096">byte</span><span class="op" id="4640100">)</span>&nbsp;<span class="builtintype" id="4640102">bool</span>&nbsp;<span class="op" id="4640107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640110">return</span>&nbsp;<span class="ident" id="4640117">asciiAlpha</span><span class="op" id="4640127">(</span><span class="ident" id="4640128">c</span><span class="op" id="4640129">)</span>&nbsp;<span class="op" id="4640131">||</span>&nbsp;<span class="string" id="4640134">&#39;0&#39;</span>&nbsp;<span class="op" id="4640138">&lt;=</span>&nbsp;<span class="ident" id="4640141">c</span>&nbsp;<span class="op" id="4640143">&amp;&amp;</span>&nbsp;<span class="ident" id="4640146">c</span>&nbsp;<span class="op" id="4640148">&lt;=</span>&nbsp;<span class="string" id="4640151">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="4640155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640158">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4640243">func</span>&nbsp;<span class="ident" id="4640248">eatTagName</span><span class="op" id="4640258">(</span><span class="ident" id="4640259">s</span>&nbsp;<span class="op" id="4640261">[</span><span class="op" id="4640262">]</span><span class="builtintype" id="4640263">byte</span><span class="op" id="4640267">,</span>&nbsp;<span class="ident" id="4640269">i</span>&nbsp;<span class="builtintype" id="4640271">int</span><span class="op" id="4640274">)</span>&nbsp;<span class="op" id="4640276">(</span><span class="builtintype" id="4640277">int</span><span class="op" id="4640280">,</span>&nbsp;<span class="ident" id="4640282">element</span><span class="op" id="4640289">)</span>&nbsp;<span class="op" id="4640291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640294">if</span>&nbsp;<span class="ident" id="4640297">i</span>&nbsp;<span class="op" id="4640299">==</span>&nbsp;<span class="builtinfunc" id="4640302">len</span><span class="op" id="4640305">(</span><span class="ident" id="4640306">s</span><span class="op" id="4640307">)</span>&nbsp;<span class="op" id="4640309">||</span>&nbsp;<span class="op" id="4640312">!</span><span class="ident" id="4640313">asciiAlpha</span><span class="op" id="4640323">(</span><span class="ident" id="4640324">s</span><span class="op" id="4640325">[</span><span class="ident" id="4640326">i</span><span class="op" id="4640327">]</span><span class="op" id="4640328">)</span>&nbsp;<span class="op" id="4640330">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640334">return</span>&nbsp;<span class="ident" id="4640341">i</span><span class="op" id="4640342">,</span>&nbsp;<span class="ident" id="4640344">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640360">j</span>&nbsp;<span class="op" id="4640362">:=</span>&nbsp;<span class="ident" id="4640365">i</span>&nbsp;<span class="op" id="4640367">+</span>&nbsp;<span class="num" id="4640369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640372">for</span>&nbsp;<span class="ident" id="4640376">j</span>&nbsp;<span class="op" id="4640378">&lt;</span>&nbsp;<span class="builtinfunc" id="4640380">len</span><span class="op" id="4640383">(</span><span class="ident" id="4640384">s</span><span class="op" id="4640385">)</span>&nbsp;<span class="op" id="4640387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640391">x</span>&nbsp;<span class="op" id="4640393">:=</span>&nbsp;<span class="ident" id="4640396">s</span><span class="op" id="4640397">[</span><span class="ident" id="4640398">j</span><span class="op" id="4640399">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640403">if</span>&nbsp;<span class="ident" id="4640406">asciiAlphaNum</span><span class="op" id="4640419">(</span><span class="ident" id="4640420">x</span><span class="op" id="4640421">)</span>&nbsp;<span class="op" id="4640423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640428">j</span><span class="op" id="4640429">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640435">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640450">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640507">if</span>&nbsp;<span class="op" id="4640510">(</span><span class="ident" id="4640511">x</span>&nbsp;<span class="op" id="4640513">==</span>&nbsp;<span class="string" id="4640516">&#39;:&#39;</span>&nbsp;<span class="op" id="4640520">||</span>&nbsp;<span class="ident" id="4640523">x</span>&nbsp;<span class="op" id="4640525">==</span>&nbsp;<span class="string" id="4640528">&#39;-&#39;</span><span class="op" id="4640531">)</span>&nbsp;<span class="op" id="4640533">&amp;&amp;</span>&nbsp;<span class="ident" id="4640536">j</span><span class="op" id="4640537">+</span><span class="num" id="4640538">1</span>&nbsp;<span class="op" id="4640540">&lt;</span>&nbsp;<span class="builtinfunc" id="4640542">len</span><span class="op" id="4640545">(</span><span class="ident" id="4640546">s</span><span class="op" id="4640547">)</span>&nbsp;<span class="op" id="4640549">&amp;&amp;</span>&nbsp;<span class="ident" id="4640552">asciiAlphaNum</span><span class="op" id="4640565">(</span><span class="ident" id="4640566">s</span><span class="op" id="4640567">[</span><span class="ident" id="4640568">j</span><span class="op" id="4640569">+</span><span class="num" id="4640570">1</span><span class="op" id="4640571">]</span><span class="op" id="4640572">)</span>&nbsp;<span class="op" id="4640574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640579">j</span>&nbsp;<span class="op" id="4640581">+=</span>&nbsp;<span class="num" id="4640584">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640589">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640604">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640614">return</span>&nbsp;<span class="ident" id="4640621">j</span><span class="op" id="4640622">,</span>&nbsp;<span class="ident" id="4640624">elementNameMap</span><span class="op" id="4640638">[</span><span class="ident" id="4640639">strings</span><span class="op" id="4640646">.</span><span class="ident" id="4640647">ToLower</span><span class="op" id="4640654">(</span><span class="builtintype" id="4640655">string</span><span class="op" id="4640661">(</span><span class="ident" id="4640662">s</span><span class="op" id="4640663">[</span><span class="ident" id="4640664">i</span><span class="op" id="4640665">:</span><span class="ident" id="4640666">j</span><span class="op" id="4640667">]</span><span class="op" id="4640668">)</span><span class="op" id="4640669">)</span><span class="op" id="4640670">]</span><br>
<span class="lineno"></span><span class="op" id="4640672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4640675">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="4640747">func</span>&nbsp;<span class="ident" id="4640752">eatWhiteSpace</span><span class="op" id="4640765">(</span><span class="ident" id="4640766">s</span>&nbsp;<span class="op" id="4640768">[</span><span class="op" id="4640769">]</span><span class="builtintype" id="4640770">byte</span><span class="op" id="4640774">,</span>&nbsp;<span class="ident" id="4640776">i</span>&nbsp;<span class="builtintype" id="4640778">int</span><span class="op" id="4640781">)</span>&nbsp;<span class="builtintype" id="4640783">int</span>&nbsp;<span class="op" id="4640787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640790">for</span>&nbsp;<span class="ident" id="4640794">j</span>&nbsp;<span class="op" id="4640796">:=</span>&nbsp;<span class="ident" id="4640799">i</span><span class="op" id="4640800">;</span>&nbsp;<span class="ident" id="4640802">j</span>&nbsp;<span class="op" id="4640804">&lt;</span>&nbsp;<span class="builtinfunc" id="4640806">len</span><span class="op" id="4640809">(</span><span class="ident" id="4640810">s</span><span class="op" id="4640811">)</span><span class="op" id="4640812">;</span>&nbsp;<span class="ident" id="4640814">j</span><span class="op" id="4640815">++</span>&nbsp;<span class="op" id="4640818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640822">switch</span>&nbsp;<span class="ident" id="4640829">s</span><span class="op" id="4640830">[</span><span class="ident" id="4640831">j</span><span class="op" id="4640832">]</span>&nbsp;<span class="op" id="4640834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640838">case</span>&nbsp;<span class="string" id="4640843">&#39;&nbsp;&#39;</span><span class="op" id="4640846">,</span>&nbsp;<span class="string" id="4640848">&#39;\t&#39;</span><span class="op" id="4640852">,</span>&nbsp;<span class="string" id="4640854">&#39;\n&#39;</span><span class="op" id="4640858">,</span>&nbsp;<span class="string" id="4640860">&#39;\f&#39;</span><span class="op" id="4640864">,</span>&nbsp;<span class="string" id="4640866">&#39;\r&#39;</span><span class="op" id="4640870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640875">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640887">default</span><span class="op" id="4640894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640899">return</span>&nbsp;<span class="ident" id="4640906">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640916">return</span>&nbsp;<span class="builtinfunc" id="4640923">len</span><span class="op" id="4640926">(</span><span class="ident" id="4640927">s</span><span class="op" id="4640928">)</span><br>
<span class="lineno">550</span><span class="op" id="4640930">}</span>
</div>
</body>
</html>
