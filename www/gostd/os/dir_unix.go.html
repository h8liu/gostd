<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2524852">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2524907">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2524961">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2525012">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2525082">package</span>&nbsp;<span class="ident" id="2525090">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2525094">import</span>&nbsp;<span class="op" id="2525101">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2525104">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2525110">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2525120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2525123">const</span>&nbsp;<span class="op" id="2525129">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525132">blockSize</span>&nbsp;<span class="op" id="2525142">=</span>&nbsp;<span class="num" id="2525144">4096</span><br>
<span class="lineno"></span><span class="op" id="2525149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2525152">func</span>&nbsp;<span class="op" id="2525157">(</span><span class="ident" id="2525158">f</span>&nbsp;<span class="op" id="2525160">*</span><span class="ident" id="2525161">File</span><span class="op" id="2525165">)</span>&nbsp;<span class="ident" id="2525167">readdirnames</span><span class="op" id="2525179">(</span><span class="ident" id="2525180">n</span>&nbsp;<span class="builtintype" id="2525182">int</span><span class="op" id="2525185">)</span>&nbsp;<span class="op" id="2525187">(</span><span class="ident" id="2525188">names</span>&nbsp;<span class="op" id="2525194">[</span><span class="op" id="2525195">]</span><span class="builtintype" id="2525196">string</span><span class="op" id="2525202">,</span>&nbsp;<span class="ident" id="2525204">err</span>&nbsp;<span class="builtintype" id="2525208">error</span><span class="op" id="2525213">)</span>&nbsp;<span class="op" id="2525215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2525218">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525263">if</span>&nbsp;<span class="ident" id="2525266">f</span><span class="op" id="2525267">.</span><span class="ident" id="2525268">dirinfo</span>&nbsp;<span class="op" id="2525276">==</span>&nbsp;<span class="ident" id="2525279">nil</span>&nbsp;<span class="op" id="2525283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525287">f</span><span class="op" id="2525288">.</span><span class="ident" id="2525289">dirinfo</span>&nbsp;<span class="op" id="2525297">=</span>&nbsp;<span class="builtinfunc" id="2525299">new</span><span class="op" id="2525302">(</span><span class="ident" id="2525303">dirInfo</span><span class="op" id="2525310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2525314">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525361">f</span><span class="op" id="2525362">.</span><span class="ident" id="2525363">dirinfo</span><span class="op" id="2525370">.</span><span class="ident" id="2525371">buf</span>&nbsp;<span class="op" id="2525375">=</span>&nbsp;<span class="builtinfunc" id="2525377">make</span><span class="op" id="2525381">(</span><span class="op" id="2525382">[</span><span class="op" id="2525383">]</span><span class="builtintype" id="2525384">byte</span><span class="op" id="2525388">,</span>&nbsp;<span class="ident" id="2525390">blockSize</span><span class="op" id="2525399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525402">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525405">d</span>&nbsp;<span class="op" id="2525407">:=</span>&nbsp;<span class="ident" id="2525410">f</span><span class="op" id="2525411">.</span><span class="ident" id="2525412">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525422">size</span>&nbsp;<span class="op" id="2525427">:=</span>&nbsp;<span class="ident" id="2525430">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525433">if</span>&nbsp;<span class="ident" id="2525436">size</span>&nbsp;<span class="op" id="2525441">&lt;=</span>&nbsp;<span class="num" id="2525444">0</span>&nbsp;<span class="op" id="2525446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525450">size</span>&nbsp;<span class="op" id="2525455">=</span>&nbsp;<span class="num" id="2525457">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525463">n</span>&nbsp;<span class="op" id="2525465">=</span>&nbsp;<span class="op" id="2525467">-</span><span class="num" id="2525468">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525475">names</span>&nbsp;<span class="op" id="2525481">=</span>&nbsp;<span class="builtinfunc" id="2525483">make</span><span class="op" id="2525487">(</span><span class="op" id="2525488">[</span><span class="op" id="2525489">]</span><span class="builtintype" id="2525490">string</span><span class="op" id="2525496">,</span>&nbsp;<span class="num" id="2525498">0</span><span class="op" id="2525499">,</span>&nbsp;<span class="ident" id="2525501">size</span><span class="op" id="2525505">)</span>&nbsp;<span class="comment" id="2525507">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525536">for</span>&nbsp;<span class="ident" id="2525540">n</span>&nbsp;<span class="op" id="2525542">!=</span>&nbsp;<span class="num" id="2525545">0</span>&nbsp;<span class="op" id="2525547">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2525551">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525587">if</span>&nbsp;<span class="ident" id="2525590">d</span><span class="op" id="2525591">.</span><span class="ident" id="2525592">bufp</span>&nbsp;<span class="op" id="2525597">&gt;=</span>&nbsp;<span class="ident" id="2525600">d</span><span class="op" id="2525601">.</span><span class="ident" id="2525602">nbuf</span>&nbsp;<span class="op" id="2525607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525612">d</span><span class="op" id="2525613">.</span><span class="ident" id="2525614">bufp</span>&nbsp;<span class="op" id="2525619">=</span>&nbsp;<span class="num" id="2525621">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525626">var</span>&nbsp;<span class="ident" id="2525630">errno</span>&nbsp;<span class="builtintype" id="2525636">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525645">d</span><span class="op" id="2525646">.</span><span class="ident" id="2525647">nbuf</span><span class="op" id="2525651">,</span>&nbsp;<span class="ident" id="2525653">errno</span>&nbsp;<span class="op" id="2525659">=</span>&nbsp;<span class="ident" id="2525661">fixCount</span><span class="op" id="2525669">(</span><span class="ident" id="2525670">syscall</span><span class="op" id="2525677">.</span><span class="ident" id="2525678">ReadDirent</span><span class="op" id="2525688">(</span><span class="ident" id="2525689">f</span><span class="op" id="2525690">.</span><span class="ident" id="2525691">fd</span><span class="op" id="2525693">,</span>&nbsp;<span class="ident" id="2525695">d</span><span class="op" id="2525696">.</span><span class="ident" id="2525697">buf</span><span class="op" id="2525700">)</span><span class="op" id="2525701">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525706">if</span>&nbsp;<span class="ident" id="2525709">errno</span>&nbsp;<span class="op" id="2525715">!=</span>&nbsp;<span class="ident" id="2525718">nil</span>&nbsp;<span class="op" id="2525722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525728">return</span>&nbsp;<span class="ident" id="2525735">names</span><span class="op" id="2525740">,</span>&nbsp;<span class="ident" id="2525742">NewSyscallError</span><span class="op" id="2525757">(</span><span class="string" id="2525758">&#34;readdirent&#34;</span><span class="op" id="2525770">,</span>&nbsp;<span class="ident" id="2525772">errno</span><span class="op" id="2525777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525787">if</span>&nbsp;<span class="ident" id="2525790">d</span><span class="op" id="2525791">.</span><span class="ident" id="2525792">nbuf</span>&nbsp;<span class="op" id="2525797">&lt;=</span>&nbsp;<span class="num" id="2525800">0</span>&nbsp;<span class="op" id="2525802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525808">break</span>&nbsp;<span class="comment" id="2525814">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2525833">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525855">var</span>&nbsp;<span class="ident" id="2525859">nb</span><span class="op" id="2525861">,</span>&nbsp;<span class="ident" id="2525863">nc</span>&nbsp;<span class="builtintype" id="2525866">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525872">nb</span><span class="op" id="2525874">,</span>&nbsp;<span class="ident" id="2525876">nc</span><span class="op" id="2525878">,</span>&nbsp;<span class="ident" id="2525880">names</span>&nbsp;<span class="op" id="2525886">=</span>&nbsp;<span class="ident" id="2525888">syscall</span><span class="op" id="2525895">.</span><span class="ident" id="2525896">ParseDirent</span><span class="op" id="2525907">(</span><span class="ident" id="2525908">d</span><span class="op" id="2525909">.</span><span class="ident" id="2525910">buf</span><span class="op" id="2525913">[</span><span class="ident" id="2525914">d</span><span class="op" id="2525915">.</span><span class="ident" id="2525916">bufp</span><span class="op" id="2525920">:</span><span class="ident" id="2525921">d</span><span class="op" id="2525922">.</span><span class="ident" id="2525923">nbuf</span><span class="op" id="2525927">]</span><span class="op" id="2525928">,</span>&nbsp;<span class="ident" id="2525930">n</span><span class="op" id="2525931">,</span>&nbsp;<span class="ident" id="2525933">names</span><span class="op" id="2525938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525942">d</span><span class="op" id="2525943">.</span><span class="ident" id="2525944">bufp</span>&nbsp;<span class="op" id="2525949">+=</span>&nbsp;<span class="ident" id="2525952">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525957">n</span>&nbsp;<span class="op" id="2525959">-=</span>&nbsp;<span class="ident" id="2525962">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525969">if</span>&nbsp;<span class="ident" id="2525972">n</span>&nbsp;<span class="op" id="2525974">&gt;=</span>&nbsp;<span class="num" id="2525977">0</span>&nbsp;<span class="op" id="2525979">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2525982">len</span><span class="op" id="2525985">(</span><span class="ident" id="2525986">names</span><span class="op" id="2525991">)</span>&nbsp;<span class="op" id="2525993">==</span>&nbsp;<span class="num" id="2525996">0</span>&nbsp;<span class="op" id="2525998">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526002">return</span>&nbsp;<span class="ident" id="2526009">names</span><span class="op" id="2526014">,</span>&nbsp;<span class="ident" id="2526016">io</span><span class="op" id="2526018">.</span><span class="ident" id="2526019">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2526024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2526027">return</span>&nbsp;<span class="ident" id="2526034">names</span><span class="op" id="2526039">,</span>&nbsp;<span class="ident" id="2526041">nil</span><br>
<span class="lineno"></span><span class="op" id="2526045">}</span>
</div>
</body>
</html>
