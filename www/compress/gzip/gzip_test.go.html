<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6977495">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6977550">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6977604">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6977655">package</span>&nbsp;<span class="ident" id="6977663">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6977669">import</span>&nbsp;<span class="op" id="6977676">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6977679">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6977688">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6977697">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6977710">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6977721">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6977728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6977731">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6977805">func</span>&nbsp;<span class="ident" id="6977810">TestEmpty</span><span class="op" id="6977819">(</span><span class="ident" id="6977820">t</span>&nbsp;<span class="op" id="6977822">*</span><span class="ident" id="6977823">testing</span><span class="op" id="6977830">.</span><span class="ident" id="6977831">T</span><span class="op" id="6977832">)</span>&nbsp;<span class="op" id="6977834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977837">buf</span>&nbsp;<span class="op" id="6977841">:=</span>&nbsp;<span class="builtinfunc" id="6977844">new</span><span class="op" id="6977847">(</span><span class="ident" id="6977848">bytes</span><span class="op" id="6977853">.</span><span class="ident" id="6977854">Buffer</span><span class="op" id="6977860">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977864">if</span>&nbsp;<span class="ident" id="6977867">err</span>&nbsp;<span class="op" id="6977871">:=</span>&nbsp;<span class="ident" id="6977874">NewWriter</span><span class="op" id="6977883">(</span><span class="ident" id="6977884">buf</span><span class="op" id="6977887">)</span><span class="op" id="6977888">.</span><span class="ident" id="6977889">Close</span><span class="op" id="6977894">(</span><span class="op" id="6977895">)</span><span class="op" id="6977896">;</span>&nbsp;<span class="ident" id="6977898">err</span>&nbsp;<span class="op" id="6977902">!=</span>&nbsp;<span class="ident" id="6977905">nil</span>&nbsp;<span class="op" id="6977909">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977913">t</span><span class="op" id="6977914">.</span><span class="ident" id="6977915">Fatalf</span><span class="op" id="6977921">(</span><span class="string" id="6977922">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6977940">,</span>&nbsp;<span class="ident" id="6977942">err</span><span class="op" id="6977945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6977948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977952">r</span><span class="op" id="6977953">,</span>&nbsp;<span class="ident" id="6977955">err</span>&nbsp;<span class="op" id="6977959">:=</span>&nbsp;<span class="ident" id="6977962">NewReader</span><span class="op" id="6977971">(</span><span class="ident" id="6977972">buf</span><span class="op" id="6977975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6977978">if</span>&nbsp;<span class="ident" id="6977981">err</span>&nbsp;<span class="op" id="6977985">!=</span>&nbsp;<span class="ident" id="6977988">nil</span>&nbsp;<span class="op" id="6977992">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6977996">t</span><span class="op" id="6977997">.</span><span class="ident" id="6977998">Fatalf</span><span class="op" id="6978004">(</span><span class="string" id="6978005">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6978020">,</span>&nbsp;<span class="ident" id="6978022">err</span><span class="op" id="6978025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978031">b</span><span class="op" id="6978032">,</span>&nbsp;<span class="ident" id="6978034">err</span>&nbsp;<span class="op" id="6978038">:=</span>&nbsp;<span class="ident" id="6978041">ioutil</span><span class="op" id="6978047">.</span><span class="ident" id="6978048">ReadAll</span><span class="op" id="6978055">(</span><span class="ident" id="6978056">r</span><span class="op" id="6978057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978060">if</span>&nbsp;<span class="ident" id="6978063">err</span>&nbsp;<span class="op" id="6978067">!=</span>&nbsp;<span class="ident" id="6978070">nil</span>&nbsp;<span class="op" id="6978074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978078">t</span><span class="op" id="6978079">.</span><span class="ident" id="6978080">Fatalf</span><span class="op" id="6978086">(</span><span class="string" id="6978087">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6978100">,</span>&nbsp;<span class="ident" id="6978102">err</span><span class="op" id="6978105">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978111">if</span>&nbsp;<span class="builtinfunc" id="6978114">len</span><span class="op" id="6978117">(</span><span class="ident" id="6978118">b</span><span class="op" id="6978119">)</span>&nbsp;<span class="op" id="6978121">!=</span>&nbsp;<span class="num" id="6978124">0</span>&nbsp;<span class="op" id="6978126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978130">t</span><span class="op" id="6978131">.</span><span class="ident" id="6978132">Fatalf</span><span class="op" id="6978138">(</span><span class="string" id="6978139">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6978161">,</span>&nbsp;<span class="builtinfunc" id="6978163">len</span><span class="op" id="6978166">(</span><span class="ident" id="6978167">b</span><span class="op" id="6978168">)</span><span class="op" id="6978169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978175">if</span>&nbsp;<span class="ident" id="6978178">err</span>&nbsp;<span class="op" id="6978182">:=</span>&nbsp;<span class="ident" id="6978185">r</span><span class="op" id="6978186">.</span><span class="ident" id="6978187">Close</span><span class="op" id="6978192">(</span><span class="op" id="6978193">)</span><span class="op" id="6978194">;</span>&nbsp;<span class="ident" id="6978196">err</span>&nbsp;<span class="op" id="6978200">!=</span>&nbsp;<span class="ident" id="6978203">nil</span>&nbsp;<span class="op" id="6978207">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978211">t</span><span class="op" id="6978212">.</span><span class="ident" id="6978213">Fatalf</span><span class="op" id="6978219">(</span><span class="string" id="6978220">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6978238">,</span>&nbsp;<span class="ident" id="6978240">err</span><span class="op" id="6978243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978246">}</span><br>
<span class="lineno"></span><span class="op" id="6978248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6978251">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="6978324">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6978337">func</span>&nbsp;<span class="ident" id="6978342">TestRoundTrip</span><span class="op" id="6978355">(</span><span class="ident" id="6978356">t</span>&nbsp;<span class="op" id="6978358">*</span><span class="ident" id="6978359">testing</span><span class="op" id="6978366">.</span><span class="ident" id="6978367">T</span><span class="op" id="6978368">)</span>&nbsp;<span class="op" id="6978370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978373">buf</span>&nbsp;<span class="op" id="6978377">:=</span>&nbsp;<span class="builtinfunc" id="6978380">new</span><span class="op" id="6978383">(</span><span class="ident" id="6978384">bytes</span><span class="op" id="6978389">.</span><span class="ident" id="6978390">Buffer</span><span class="op" id="6978396">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978400">w</span>&nbsp;<span class="op" id="6978402">:=</span>&nbsp;<span class="ident" id="6978405">NewWriter</span><span class="op" id="6978414">(</span><span class="ident" id="6978415">buf</span><span class="op" id="6978418">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978421">w</span><span class="op" id="6978422">.</span><span class="ident" id="6978423">Comment</span>&nbsp;<span class="op" id="6978431">=</span>&nbsp;<span class="string" id="6978433">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978444">w</span><span class="op" id="6978445">.</span><span class="ident" id="6978446">Extra</span>&nbsp;<span class="op" id="6978452">=</span>&nbsp;<span class="op" id="6978454">[</span><span class="op" id="6978455">]</span><span class="builtintype" id="6978456">byte</span><span class="op" id="6978460">(</span><span class="string" id="6978461">&#34;extra&#34;</span><span class="op" id="6978468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978471">w</span><span class="op" id="6978472">.</span><span class="ident" id="6978473">ModTime</span>&nbsp;<span class="op" id="6978481">=</span>&nbsp;<span class="ident" id="6978483">time</span><span class="op" id="6978487">.</span><span class="ident" id="6978488">Unix</span><span class="op" id="6978492">(</span><span class="num" id="6978493">1e8</span><span class="op" id="6978496">,</span>&nbsp;<span class="num" id="6978498">0</span><span class="op" id="6978499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978502">w</span><span class="op" id="6978503">.</span><span class="ident" id="6978504">Name</span>&nbsp;<span class="op" id="6978509">=</span>&nbsp;<span class="string" id="6978511">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978519">if</span>&nbsp;<span class="ident" id="6978522">_</span><span class="op" id="6978523">,</span>&nbsp;<span class="ident" id="6978525">err</span>&nbsp;<span class="op" id="6978529">:=</span>&nbsp;<span class="ident" id="6978532">w</span><span class="op" id="6978533">.</span><span class="ident" id="6978534">Write</span><span class="op" id="6978539">(</span><span class="op" id="6978540">[</span><span class="op" id="6978541">]</span><span class="builtintype" id="6978542">byte</span><span class="op" id="6978546">(</span><span class="string" id="6978547">&#34;payload&#34;</span><span class="op" id="6978556">)</span><span class="op" id="6978557">)</span><span class="op" id="6978558">;</span>&nbsp;<span class="ident" id="6978560">err</span>&nbsp;<span class="op" id="6978564">!=</span>&nbsp;<span class="ident" id="6978567">nil</span>&nbsp;<span class="op" id="6978571">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978575">t</span><span class="op" id="6978576">.</span><span class="ident" id="6978577">Fatalf</span><span class="op" id="6978583">(</span><span class="string" id="6978584">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="6978595">,</span>&nbsp;<span class="ident" id="6978597">err</span><span class="op" id="6978600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978606">if</span>&nbsp;<span class="ident" id="6978609">err</span>&nbsp;<span class="op" id="6978613">:=</span>&nbsp;<span class="ident" id="6978616">w</span><span class="op" id="6978617">.</span><span class="ident" id="6978618">Close</span><span class="op" id="6978623">(</span><span class="op" id="6978624">)</span><span class="op" id="6978625">;</span>&nbsp;<span class="ident" id="6978627">err</span>&nbsp;<span class="op" id="6978631">!=</span>&nbsp;<span class="ident" id="6978634">nil</span>&nbsp;<span class="op" id="6978638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978642">t</span><span class="op" id="6978643">.</span><span class="ident" id="6978644">Fatalf</span><span class="op" id="6978650">(</span><span class="string" id="6978651">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6978669">,</span>&nbsp;<span class="ident" id="6978671">err</span><span class="op" id="6978674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978677">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978681">r</span><span class="op" id="6978682">,</span>&nbsp;<span class="ident" id="6978684">err</span>&nbsp;<span class="op" id="6978688">:=</span>&nbsp;<span class="ident" id="6978691">NewReader</span><span class="op" id="6978700">(</span><span class="ident" id="6978701">buf</span><span class="op" id="6978704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978707">if</span>&nbsp;<span class="ident" id="6978710">err</span>&nbsp;<span class="op" id="6978714">!=</span>&nbsp;<span class="ident" id="6978717">nil</span>&nbsp;<span class="op" id="6978721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978725">t</span><span class="op" id="6978726">.</span><span class="ident" id="6978727">Fatalf</span><span class="op" id="6978733">(</span><span class="string" id="6978734">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6978749">,</span>&nbsp;<span class="ident" id="6978751">err</span><span class="op" id="6978754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978757">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978760">b</span><span class="op" id="6978761">,</span>&nbsp;<span class="ident" id="6978763">err</span>&nbsp;<span class="op" id="6978767">:=</span>&nbsp;<span class="ident" id="6978770">ioutil</span><span class="op" id="6978776">.</span><span class="ident" id="6978777">ReadAll</span><span class="op" id="6978784">(</span><span class="ident" id="6978785">r</span><span class="op" id="6978786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978789">if</span>&nbsp;<span class="ident" id="6978792">err</span>&nbsp;<span class="op" id="6978796">!=</span>&nbsp;<span class="ident" id="6978799">nil</span>&nbsp;<span class="op" id="6978803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978807">t</span><span class="op" id="6978808">.</span><span class="ident" id="6978809">Fatalf</span><span class="op" id="6978815">(</span><span class="string" id="6978816">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6978829">,</span>&nbsp;<span class="ident" id="6978831">err</span><span class="op" id="6978834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978840">if</span>&nbsp;<span class="builtintype" id="6978843">string</span><span class="op" id="6978849">(</span><span class="ident" id="6978850">b</span><span class="op" id="6978851">)</span>&nbsp;<span class="op" id="6978853">!=</span>&nbsp;<span class="string" id="6978856">&#34;payload&#34;</span>&nbsp;<span class="op" id="6978866">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978870">t</span><span class="op" id="6978871">.</span><span class="ident" id="6978872">Fatalf</span><span class="op" id="6978878">(</span><span class="string" id="6978879">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6978903">,</span>&nbsp;<span class="builtintype" id="6978905">string</span><span class="op" id="6978911">(</span><span class="ident" id="6978912">b</span><span class="op" id="6978913">)</span><span class="op" id="6978914">,</span>&nbsp;<span class="string" id="6978916">&#34;payload&#34;</span><span class="op" id="6978925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6978928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6978931">if</span>&nbsp;<span class="ident" id="6978934">r</span><span class="op" id="6978935">.</span><span class="ident" id="6978936">Comment</span>&nbsp;<span class="op" id="6978944">!=</span>&nbsp;<span class="string" id="6978947">&#34;comment&#34;</span>&nbsp;<span class="op" id="6978957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6978961">t</span><span class="op" id="6978962">.</span><span class="ident" id="6978963">Fatalf</span><span class="op" id="6978969">(</span><span class="string" id="6978970">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6978994">,</span>&nbsp;<span class="ident" id="6978996">r</span><span class="op" id="6978997">.</span><span class="ident" id="6978998">Comment</span><span class="op" id="6979005">,</span>&nbsp;<span class="string" id="6979007">&#34;comment&#34;</span><span class="op" id="6979016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979019">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979022">if</span>&nbsp;<span class="builtintype" id="6979025">string</span><span class="op" id="6979031">(</span><span class="ident" id="6979032">r</span><span class="op" id="6979033">.</span><span class="ident" id="6979034">Extra</span><span class="op" id="6979039">)</span>&nbsp;<span class="op" id="6979041">!=</span>&nbsp;<span class="string" id="6979044">&#34;extra&#34;</span>&nbsp;<span class="op" id="6979052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979056">t</span><span class="op" id="6979057">.</span><span class="ident" id="6979058">Fatalf</span><span class="op" id="6979064">(</span><span class="string" id="6979065">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6979087">,</span>&nbsp;<span class="ident" id="6979089">r</span><span class="op" id="6979090">.</span><span class="ident" id="6979091">Extra</span><span class="op" id="6979096">,</span>&nbsp;<span class="string" id="6979098">&#34;extra&#34;</span><span class="op" id="6979105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979111">if</span>&nbsp;<span class="ident" id="6979114">r</span><span class="op" id="6979115">.</span><span class="ident" id="6979116">ModTime</span><span class="op" id="6979123">.</span><span class="ident" id="6979124">Unix</span><span class="op" id="6979128">(</span><span class="op" id="6979129">)</span>&nbsp;<span class="op" id="6979131">!=</span>&nbsp;<span class="num" id="6979134">1e8</span>&nbsp;<span class="op" id="6979138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979142">t</span><span class="op" id="6979143">.</span><span class="ident" id="6979144">Fatalf</span><span class="op" id="6979150">(</span><span class="string" id="6979151">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6979173">,</span>&nbsp;<span class="ident" id="6979175">r</span><span class="op" id="6979176">.</span><span class="ident" id="6979177">ModTime</span><span class="op" id="6979184">.</span><span class="ident" id="6979185">Unix</span><span class="op" id="6979189">(</span><span class="op" id="6979190">)</span><span class="op" id="6979191">,</span>&nbsp;<span class="builtintype" id="6979193">uint32</span><span class="op" id="6979199">(</span><span class="num" id="6979200">1e8</span><span class="op" id="6979203">)</span><span class="op" id="6979204">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979210">if</span>&nbsp;<span class="ident" id="6979213">r</span><span class="op" id="6979214">.</span><span class="ident" id="6979215">Name</span>&nbsp;<span class="op" id="6979220">!=</span>&nbsp;<span class="string" id="6979223">&#34;name&#34;</span>&nbsp;<span class="op" id="6979230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979234">t</span><span class="op" id="6979235">.</span><span class="ident" id="6979236">Fatalf</span><span class="op" id="6979242">(</span><span class="string" id="6979243">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6979264">,</span>&nbsp;<span class="ident" id="6979266">r</span><span class="op" id="6979267">.</span><span class="ident" id="6979268">Name</span><span class="op" id="6979272">,</span>&nbsp;<span class="string" id="6979274">&#34;name&#34;</span><span class="op" id="6979280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979286">if</span>&nbsp;<span class="ident" id="6979289">err</span>&nbsp;<span class="op" id="6979293">:=</span>&nbsp;<span class="ident" id="6979296">r</span><span class="op" id="6979297">.</span><span class="ident" id="6979298">Close</span><span class="op" id="6979303">(</span><span class="op" id="6979304">)</span><span class="op" id="6979305">;</span>&nbsp;<span class="ident" id="6979307">err</span>&nbsp;<span class="op" id="6979311">!=</span>&nbsp;<span class="ident" id="6979314">nil</span>&nbsp;<span class="op" id="6979318">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979322">t</span><span class="op" id="6979323">.</span><span class="ident" id="6979324">Fatalf</span><span class="op" id="6979330">(</span><span class="string" id="6979331">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6979349">,</span>&nbsp;<span class="ident" id="6979351">err</span><span class="op" id="6979354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979357">}</span><br>
<span class="lineno"></span><span class="op" id="6979359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6979362">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="6979441">func</span>&nbsp;<span class="ident" id="6979446">TestLatin1</span><span class="op" id="6979456">(</span><span class="ident" id="6979457">t</span>&nbsp;<span class="op" id="6979459">*</span><span class="ident" id="6979460">testing</span><span class="op" id="6979467">.</span><span class="ident" id="6979468">T</span><span class="op" id="6979469">)</span>&nbsp;<span class="op" id="6979471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979474">latin1</span>&nbsp;<span class="op" id="6979481">:=</span>&nbsp;<span class="op" id="6979484">[</span><span class="op" id="6979485">]</span><span class="builtintype" id="6979486">byte</span><span class="op" id="6979490">{</span><span class="num" id="6979491">0xc4</span><span class="op" id="6979495">,</span>&nbsp;<span class="string" id="6979497">&#39;u&#39;</span><span class="op" id="6979500">,</span>&nbsp;<span class="num" id="6979502">0xdf</span><span class="op" id="6979506">,</span>&nbsp;<span class="string" id="6979508">&#39;e&#39;</span><span class="op" id="6979511">,</span>&nbsp;<span class="string" id="6979513">&#39;r&#39;</span><span class="op" id="6979516">,</span>&nbsp;<span class="string" id="6979518">&#39;u&#39;</span><span class="op" id="6979521">,</span>&nbsp;<span class="string" id="6979523">&#39;n&#39;</span><span class="op" id="6979526">,</span>&nbsp;<span class="string" id="6979528">&#39;g&#39;</span><span class="op" id="6979531">,</span>&nbsp;<span class="num" id="6979533">0</span><span class="op" id="6979534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979537">utf8</span>&nbsp;<span class="op" id="6979542">:=</span>&nbsp;<span class="string" id="6979545">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979559">z</span>&nbsp;<span class="op" id="6979561">:=</span>&nbsp;<span class="ident" id="6979564">Reader</span><span class="op" id="6979570">{</span><span class="ident" id="6979571">r</span><span class="op" id="6979572">:</span>&nbsp;<span class="ident" id="6979574">bufio</span><span class="op" id="6979579">.</span><span class="ident" id="6979580">NewReader</span><span class="op" id="6979589">(</span><span class="ident" id="6979590">bytes</span><span class="op" id="6979595">.</span><span class="ident" id="6979596">NewReader</span><span class="op" id="6979605">(</span><span class="ident" id="6979606">latin1</span><span class="op" id="6979612">)</span><span class="op" id="6979613">)</span><span class="op" id="6979614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979617">s</span><span class="op" id="6979618">,</span>&nbsp;<span class="ident" id="6979620">err</span>&nbsp;<span class="op" id="6979624">:=</span>&nbsp;<span class="ident" id="6979627">z</span><span class="op" id="6979628">.</span><span class="ident" id="6979629">readString</span><span class="op" id="6979639">(</span><span class="op" id="6979640">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979643">if</span>&nbsp;<span class="ident" id="6979646">err</span>&nbsp;<span class="op" id="6979650">!=</span>&nbsp;<span class="ident" id="6979653">nil</span>&nbsp;<span class="op" id="6979657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979661">t</span><span class="op" id="6979662">.</span><span class="ident" id="6979663">Fatalf</span><span class="op" id="6979669">(</span><span class="string" id="6979670">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="6979686">,</span>&nbsp;<span class="ident" id="6979688">err</span><span class="op" id="6979691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979697">if</span>&nbsp;<span class="ident" id="6979700">s</span>&nbsp;<span class="op" id="6979702">!=</span>&nbsp;<span class="ident" id="6979705">utf8</span>&nbsp;<span class="op" id="6979710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979714">t</span><span class="op" id="6979715">.</span><span class="ident" id="6979716">Fatalf</span><span class="op" id="6979722">(</span><span class="string" id="6979723">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6979754">,</span>&nbsp;<span class="ident" id="6979756">s</span><span class="op" id="6979757">,</span>&nbsp;<span class="ident" id="6979759">utf8</span><span class="op" id="6979763">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979770">buf</span>&nbsp;<span class="op" id="6979774">:=</span>&nbsp;<span class="ident" id="6979777">bytes</span><span class="op" id="6979782">.</span><span class="ident" id="6979783">NewBuffer</span><span class="op" id="6979792">(</span><span class="builtinfunc" id="6979793">make</span><span class="op" id="6979797">(</span><span class="op" id="6979798">[</span><span class="op" id="6979799">]</span><span class="builtintype" id="6979800">byte</span><span class="op" id="6979804">,</span>&nbsp;<span class="num" id="6979806">0</span><span class="op" id="6979807">,</span>&nbsp;<span class="builtinfunc" id="6979809">len</span><span class="op" id="6979812">(</span><span class="ident" id="6979813">latin1</span><span class="op" id="6979819">)</span><span class="op" id="6979820">)</span><span class="op" id="6979821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979824">c</span>&nbsp;<span class="op" id="6979826">:=</span>&nbsp;<span class="ident" id="6979829">Writer</span><span class="op" id="6979835">{</span><span class="ident" id="6979836">w</span><span class="op" id="6979837">:</span>&nbsp;<span class="ident" id="6979839">buf</span><span class="op" id="6979842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979845">if</span>&nbsp;<span class="ident" id="6979848">err</span>&nbsp;<span class="op" id="6979852">=</span>&nbsp;<span class="ident" id="6979854">c</span><span class="op" id="6979855">.</span><span class="ident" id="6979856">writeString</span><span class="op" id="6979867">(</span><span class="ident" id="6979868">utf8</span><span class="op" id="6979872">)</span><span class="op" id="6979873">;</span>&nbsp;<span class="ident" id="6979875">err</span>&nbsp;<span class="op" id="6979879">!=</span>&nbsp;<span class="ident" id="6979882">nil</span>&nbsp;<span class="op" id="6979886">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979890">t</span><span class="op" id="6979891">.</span><span class="ident" id="6979892">Fatalf</span><span class="op" id="6979898">(</span><span class="string" id="6979899">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="6979916">,</span>&nbsp;<span class="ident" id="6979918">err</span><span class="op" id="6979921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6979924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979927">s</span>&nbsp;<span class="op" id="6979929">=</span>&nbsp;<span class="ident" id="6979931">buf</span><span class="op" id="6979934">.</span><span class="ident" id="6979935">String</span><span class="op" id="6979941">(</span><span class="op" id="6979942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6979945">if</span>&nbsp;<span class="ident" id="6979948">s</span>&nbsp;<span class="op" id="6979950">!=</span>&nbsp;<span class="builtintype" id="6979953">string</span><span class="op" id="6979959">(</span><span class="ident" id="6979960">latin1</span><span class="op" id="6979966">)</span>&nbsp;<span class="op" id="6979968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6979972">t</span><span class="op" id="6979973">.</span><span class="ident" id="6979974">Fatalf</span><span class="op" id="6979980">(</span><span class="string" id="6979981">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6980011">,</span>&nbsp;<span class="ident" id="6980013">s</span><span class="op" id="6980014">,</span>&nbsp;<span class="builtintype" id="6980016">string</span><span class="op" id="6980022">(</span><span class="ident" id="6980023">latin1</span><span class="op" id="6980029">)</span><span class="op" id="6980030">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980033">}</span><br>
<span class="lineno"></span><span class="op" id="6980035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6980038">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="6980114">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="6980140">func</span>&nbsp;<span class="ident" id="6980145">TestLatin1RoundTrip</span><span class="op" id="6980164">(</span><span class="ident" id="6980165">t</span>&nbsp;<span class="op" id="6980167">*</span><span class="ident" id="6980168">testing</span><span class="op" id="6980175">.</span><span class="ident" id="6980176">T</span><span class="op" id="6980177">)</span>&nbsp;<span class="op" id="6980179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980182">testCases</span>&nbsp;<span class="op" id="6980192">:=</span>&nbsp;<span class="op" id="6980195">[</span><span class="op" id="6980196">]</span><span class="keyword" id="6980197">struct</span>&nbsp;<span class="op" id="6980204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980208">name</span>&nbsp;<span class="builtintype" id="6980213">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980222">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6980227">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980233">}</span><span class="op" id="6980234">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980238">{</span><span class="string" id="6980239">&#34;&#34;</span><span class="op" id="6980241">,</span>&nbsp;<span class="ident" id="6980243">true</span><span class="op" id="6980247">}</span><span class="op" id="6980248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980252">{</span><span class="string" id="6980253">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="6980266">,</span>&nbsp;<span class="ident" id="6980268">true</span><span class="op" id="6980272">}</span><span class="op" id="6980273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980277">{</span><span class="string" id="6980278">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="6980308">,</span>&nbsp;<span class="ident" id="6980310">false</span><span class="op" id="6980315">}</span><span class="op" id="6980316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980320">{</span><span class="string" id="6980321">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="6980350">,</span>&nbsp;<span class="ident" id="6980352">false</span><span class="op" id="6980357">}</span><span class="op" id="6980358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980362">{</span><span class="string" id="6980363">&#34;\x00\x00\x00&#34;</span><span class="op" id="6980377">,</span>&nbsp;<span class="ident" id="6980379">false</span><span class="op" id="6980384">}</span><span class="op" id="6980385">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980389">{</span><span class="string" id="6980390">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="6980421">,</span>&nbsp;<span class="ident" id="6980423">true</span><span class="op" id="6980427">}</span><span class="op" id="6980428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980432">{</span><span class="string" id="6980433">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="6980474">,</span>&nbsp;<span class="ident" id="6980476">false</span><span class="op" id="6980481">}</span><span class="op" id="6980482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980486">{</span><span class="string" id="6980487">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="6980511">,</span>&nbsp;<span class="ident" id="6980513">false</span><span class="op" id="6980518">}</span><span class="op" id="6980519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980523">{</span><span class="string" id="6980524">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="6980553">,</span>&nbsp;<span class="ident" id="6980555">false</span><span class="op" id="6980560">}</span><span class="op" id="6980561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980565">{</span><span class="string" id="6980566">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="6980598">,</span>&nbsp;<span class="ident" id="6980600">false</span><span class="op" id="6980605">}</span><span class="op" id="6980606">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980612">for</span>&nbsp;<span class="ident" id="6980616">_</span><span class="op" id="6980617">,</span>&nbsp;<span class="ident" id="6980619">tc</span>&nbsp;<span class="op" id="6980622">:=</span>&nbsp;<span class="keyword" id="6980625">range</span>&nbsp;<span class="ident" id="6980631">testCases</span>&nbsp;<span class="op" id="6980641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980645">buf</span>&nbsp;<span class="op" id="6980649">:=</span>&nbsp;<span class="builtinfunc" id="6980652">new</span><span class="op" id="6980655">(</span><span class="ident" id="6980656">bytes</span><span class="op" id="6980661">.</span><span class="ident" id="6980662">Buffer</span><span class="op" id="6980668">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980673">w</span>&nbsp;<span class="op" id="6980675">:=</span>&nbsp;<span class="ident" id="6980678">NewWriter</span><span class="op" id="6980687">(</span><span class="ident" id="6980688">buf</span><span class="op" id="6980691">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980695">w</span><span class="op" id="6980696">.</span><span class="ident" id="6980697">Name</span>&nbsp;<span class="op" id="6980702">=</span>&nbsp;<span class="ident" id="6980704">tc</span><span class="op" id="6980706">.</span><span class="ident" id="6980707">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980714">err</span>&nbsp;<span class="op" id="6980718">:=</span>&nbsp;<span class="ident" id="6980721">w</span><span class="op" id="6980722">.</span><span class="ident" id="6980723">Close</span><span class="op" id="6980728">(</span><span class="op" id="6980729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980733">if</span>&nbsp;<span class="op" id="6980736">(</span><span class="ident" id="6980737">err</span>&nbsp;<span class="op" id="6980741">==</span>&nbsp;<span class="ident" id="6980744">nil</span><span class="op" id="6980747">)</span>&nbsp;<span class="op" id="6980749">!=</span>&nbsp;<span class="ident" id="6980752">tc</span><span class="op" id="6980754">.</span><span class="ident" id="6980755">ok</span>&nbsp;<span class="op" id="6980758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980763">t</span><span class="op" id="6980764">.</span><span class="ident" id="6980765">Errorf</span><span class="op" id="6980771">(</span><span class="string" id="6980772">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6980807">,</span>&nbsp;<span class="ident" id="6980809">tc</span><span class="op" id="6980811">.</span><span class="ident" id="6980812">name</span><span class="op" id="6980816">,</span>&nbsp;<span class="ident" id="6980818">err</span><span class="op" id="6980821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980826">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980841">if</span>&nbsp;<span class="op" id="6980844">!</span><span class="ident" id="6980845">tc</span><span class="op" id="6980847">.</span><span class="ident" id="6980848">ok</span>&nbsp;<span class="op" id="6980851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980856">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980872">r</span><span class="op" id="6980873">,</span>&nbsp;<span class="ident" id="6980875">err</span>&nbsp;<span class="op" id="6980879">:=</span>&nbsp;<span class="ident" id="6980882">NewReader</span><span class="op" id="6980891">(</span><span class="ident" id="6980892">buf</span><span class="op" id="6980895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980899">if</span>&nbsp;<span class="ident" id="6980902">err</span>&nbsp;<span class="op" id="6980906">!=</span>&nbsp;<span class="ident" id="6980909">nil</span>&nbsp;<span class="op" id="6980913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980918">t</span><span class="op" id="6980919">.</span><span class="ident" id="6980920">Errorf</span><span class="op" id="6980926">(</span><span class="string" id="6980927">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6980942">,</span>&nbsp;<span class="ident" id="6980944">err</span><span class="op" id="6980947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980952">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6980963">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6980967">_</span><span class="op" id="6980968">,</span>&nbsp;<span class="ident" id="6980970">err</span>&nbsp;<span class="op" id="6980974">=</span>&nbsp;<span class="ident" id="6980976">ioutil</span><span class="op" id="6980982">.</span><span class="ident" id="6980983">ReadAll</span><span class="op" id="6980990">(</span><span class="ident" id="6980991">r</span><span class="op" id="6980992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6980996">if</span>&nbsp;<span class="ident" id="6980999">err</span>&nbsp;<span class="op" id="6981003">!=</span>&nbsp;<span class="ident" id="6981006">nil</span>&nbsp;<span class="op" id="6981010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981015">t</span><span class="op" id="6981016">.</span><span class="ident" id="6981017">Errorf</span><span class="op" id="6981023">(</span><span class="string" id="6981024">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6981037">,</span>&nbsp;<span class="ident" id="6981039">err</span><span class="op" id="6981042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981047">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981058">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981062">if</span>&nbsp;<span class="ident" id="6981065">r</span><span class="op" id="6981066">.</span><span class="ident" id="6981067">Name</span>&nbsp;<span class="op" id="6981072">!=</span>&nbsp;<span class="ident" id="6981075">tc</span><span class="op" id="6981077">.</span><span class="ident" id="6981078">name</span>&nbsp;<span class="op" id="6981083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981088">t</span><span class="op" id="6981089">.</span><span class="ident" id="6981090">Errorf</span><span class="op" id="6981096">(</span><span class="string" id="6981097">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6981118">,</span>&nbsp;<span class="ident" id="6981120">r</span><span class="op" id="6981121">.</span><span class="ident" id="6981122">Name</span><span class="op" id="6981126">,</span>&nbsp;<span class="ident" id="6981128">tc</span><span class="op" id="6981130">.</span><span class="ident" id="6981131">name</span><span class="op" id="6981135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981140">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981155">if</span>&nbsp;<span class="ident" id="6981158">err</span>&nbsp;<span class="op" id="6981162">:=</span>&nbsp;<span class="ident" id="6981165">r</span><span class="op" id="6981166">.</span><span class="ident" id="6981167">Close</span><span class="op" id="6981172">(</span><span class="op" id="6981173">)</span><span class="op" id="6981174">;</span>&nbsp;<span class="ident" id="6981176">err</span>&nbsp;<span class="op" id="6981180">!=</span>&nbsp;<span class="ident" id="6981183">nil</span>&nbsp;<span class="op" id="6981187">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981192">t</span><span class="op" id="6981193">.</span><span class="ident" id="6981194">Errorf</span><span class="op" id="6981200">(</span><span class="string" id="6981201">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6981219">,</span>&nbsp;<span class="ident" id="6981221">err</span><span class="op" id="6981224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981229">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981243">}</span><br>
<span class="lineno"></span><span class="op" id="6981245">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6981248">func</span>&nbsp;<span class="ident" id="6981253">TestWriterFlush</span><span class="op" id="6981268">(</span><span class="ident" id="6981269">t</span>&nbsp;<span class="op" id="6981271">*</span><span class="ident" id="6981272">testing</span><span class="op" id="6981279">.</span><span class="ident" id="6981280">T</span><span class="op" id="6981281">)</span>&nbsp;<span class="op" id="6981283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981286">buf</span>&nbsp;<span class="op" id="6981290">:=</span>&nbsp;<span class="builtinfunc" id="6981293">new</span><span class="op" id="6981296">(</span><span class="ident" id="6981297">bytes</span><span class="op" id="6981302">.</span><span class="ident" id="6981303">Buffer</span><span class="op" id="6981309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981313">w</span>&nbsp;<span class="op" id="6981315">:=</span>&nbsp;<span class="ident" id="6981318">NewWriter</span><span class="op" id="6981327">(</span><span class="ident" id="6981328">buf</span><span class="op" id="6981331">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981334">w</span><span class="op" id="6981335">.</span><span class="ident" id="6981336">Comment</span>&nbsp;<span class="op" id="6981344">=</span>&nbsp;<span class="string" id="6981346">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981357">w</span><span class="op" id="6981358">.</span><span class="ident" id="6981359">Extra</span>&nbsp;<span class="op" id="6981365">=</span>&nbsp;<span class="op" id="6981367">[</span><span class="op" id="6981368">]</span><span class="builtintype" id="6981369">byte</span><span class="op" id="6981373">(</span><span class="string" id="6981374">&#34;extra&#34;</span><span class="op" id="6981381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981384">w</span><span class="op" id="6981385">.</span><span class="ident" id="6981386">ModTime</span>&nbsp;<span class="op" id="6981394">=</span>&nbsp;<span class="ident" id="6981396">time</span><span class="op" id="6981400">.</span><span class="ident" id="6981401">Unix</span><span class="op" id="6981405">(</span><span class="num" id="6981406">1e8</span><span class="op" id="6981409">,</span>&nbsp;<span class="num" id="6981411">0</span><span class="op" id="6981412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981415">w</span><span class="op" id="6981416">.</span><span class="ident" id="6981417">Name</span>&nbsp;<span class="op" id="6981422">=</span>&nbsp;<span class="string" id="6981424">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981433">n0</span>&nbsp;<span class="op" id="6981436">:=</span>&nbsp;<span class="ident" id="6981439">buf</span><span class="op" id="6981442">.</span><span class="ident" id="6981443">Len</span><span class="op" id="6981446">(</span><span class="op" id="6981447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981450">if</span>&nbsp;<span class="ident" id="6981453">n0</span>&nbsp;<span class="op" id="6981456">!=</span>&nbsp;<span class="num" id="6981459">0</span>&nbsp;<span class="op" id="6981461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981465">t</span><span class="op" id="6981466">.</span><span class="ident" id="6981467">Fatalf</span><span class="op" id="6981473">(</span><span class="string" id="6981474">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6981514">,</span>&nbsp;<span class="ident" id="6981516">n0</span><span class="op" id="6981518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981525">if</span>&nbsp;<span class="ident" id="6981528">err</span>&nbsp;<span class="op" id="6981532">:=</span>&nbsp;<span class="ident" id="6981535">w</span><span class="op" id="6981536">.</span><span class="ident" id="6981537">Flush</span><span class="op" id="6981542">(</span><span class="op" id="6981543">)</span><span class="op" id="6981544">;</span>&nbsp;<span class="ident" id="6981546">err</span>&nbsp;<span class="op" id="6981550">!=</span>&nbsp;<span class="ident" id="6981553">nil</span>&nbsp;<span class="op" id="6981557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981561">t</span><span class="op" id="6981562">.</span><span class="ident" id="6981563">Fatal</span><span class="op" id="6981568">(</span><span class="ident" id="6981569">err</span><span class="op" id="6981572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981579">n1</span>&nbsp;<span class="op" id="6981582">:=</span>&nbsp;<span class="ident" id="6981585">buf</span><span class="op" id="6981588">.</span><span class="ident" id="6981589">Len</span><span class="op" id="6981592">(</span><span class="op" id="6981593">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981596">if</span>&nbsp;<span class="ident" id="6981599">n1</span>&nbsp;<span class="op" id="6981602">==</span>&nbsp;<span class="num" id="6981605">0</span>&nbsp;<span class="op" id="6981607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981611">t</span><span class="op" id="6981612">.</span><span class="ident" id="6981613">Fatal</span><span class="op" id="6981618">(</span><span class="string" id="6981619">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="6981646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981653">w</span><span class="op" id="6981654">.</span><span class="ident" id="6981655">Write</span><span class="op" id="6981660">(</span><span class="op" id="6981661">[</span><span class="op" id="6981662">]</span><span class="builtintype" id="6981663">byte</span><span class="op" id="6981667">(</span><span class="string" id="6981668">&#34;x&#34;</span><span class="op" id="6981671">)</span><span class="op" id="6981672">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981676">n2</span>&nbsp;<span class="op" id="6981679">:=</span>&nbsp;<span class="ident" id="6981682">buf</span><span class="op" id="6981685">.</span><span class="ident" id="6981686">Len</span><span class="op" id="6981689">(</span><span class="op" id="6981690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981693">if</span>&nbsp;<span class="ident" id="6981696">n1</span>&nbsp;<span class="op" id="6981699">!=</span>&nbsp;<span class="ident" id="6981702">n2</span>&nbsp;<span class="op" id="6981705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981709">t</span><span class="op" id="6981710">.</span><span class="ident" id="6981711">Fatalf</span><span class="op" id="6981717">(</span><span class="string" id="6981718">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="6981791">,</span>&nbsp;<span class="ident" id="6981793">n1</span><span class="op" id="6981795">,</span>&nbsp;<span class="ident" id="6981797">n2</span><span class="op" id="6981799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981802">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981806">if</span>&nbsp;<span class="ident" id="6981809">err</span>&nbsp;<span class="op" id="6981813">:=</span>&nbsp;<span class="ident" id="6981816">w</span><span class="op" id="6981817">.</span><span class="ident" id="6981818">Flush</span><span class="op" id="6981823">(</span><span class="op" id="6981824">)</span><span class="op" id="6981825">;</span>&nbsp;<span class="ident" id="6981827">err</span>&nbsp;<span class="op" id="6981831">!=</span>&nbsp;<span class="ident" id="6981834">nil</span>&nbsp;<span class="op" id="6981838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981842">t</span><span class="op" id="6981843">.</span><span class="ident" id="6981844">Fatal</span><span class="op" id="6981849">(</span><span class="ident" id="6981850">err</span><span class="op" id="6981853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981860">n3</span>&nbsp;<span class="op" id="6981863">:=</span>&nbsp;<span class="ident" id="6981866">buf</span><span class="op" id="6981869">.</span><span class="ident" id="6981870">Len</span><span class="op" id="6981873">(</span><span class="op" id="6981874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6981877">if</span>&nbsp;<span class="ident" id="6981880">n2</span>&nbsp;<span class="op" id="6981883">==</span>&nbsp;<span class="ident" id="6981886">n3</span>&nbsp;<span class="op" id="6981889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6981893">t</span><span class="op" id="6981894">.</span><span class="ident" id="6981895">Fatal</span><span class="op" id="6981900">(</span><span class="string" id="6981901">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="6981930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6981933">}</span><br>
<span class="lineno"></span><span class="op" id="6981935">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6981938">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6981998">func</span>&nbsp;<span class="ident" id="6982003">TestConcat</span><span class="op" id="6982013">(</span><span class="ident" id="6982014">t</span>&nbsp;<span class="op" id="6982016">*</span><span class="ident" id="6982017">testing</span><span class="op" id="6982024">.</span><span class="ident" id="6982025">T</span><span class="op" id="6982026">)</span>&nbsp;<span class="op" id="6982028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982031">var</span>&nbsp;<span class="ident" id="6982035">buf</span>&nbsp;<span class="ident" id="6982039">bytes</span><span class="op" id="6982044">.</span><span class="ident" id="6982045">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982053">w</span>&nbsp;<span class="op" id="6982055">:=</span>&nbsp;<span class="ident" id="6982058">NewWriter</span><span class="op" id="6982067">(</span><span class="op" id="6982068">&amp;</span><span class="ident" id="6982069">buf</span><span class="op" id="6982072">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982075">w</span><span class="op" id="6982076">.</span><span class="ident" id="6982077">Write</span><span class="op" id="6982082">(</span><span class="op" id="6982083">[</span><span class="op" id="6982084">]</span><span class="builtintype" id="6982085">byte</span><span class="op" id="6982089">(</span><span class="string" id="6982090">&#34;hello&nbsp;&#34;</span><span class="op" id="6982098">)</span><span class="op" id="6982099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982102">w</span><span class="op" id="6982103">.</span><span class="ident" id="6982104">Close</span><span class="op" id="6982109">(</span><span class="op" id="6982110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982113">w</span>&nbsp;<span class="op" id="6982115">=</span>&nbsp;<span class="ident" id="6982117">NewWriter</span><span class="op" id="6982126">(</span><span class="op" id="6982127">&amp;</span><span class="ident" id="6982128">buf</span><span class="op" id="6982131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982134">w</span><span class="op" id="6982135">.</span><span class="ident" id="6982136">Write</span><span class="op" id="6982141">(</span><span class="op" id="6982142">[</span><span class="op" id="6982143">]</span><span class="builtintype" id="6982144">byte</span><span class="op" id="6982148">(</span><span class="string" id="6982149">&#34;world\n&#34;</span><span class="op" id="6982158">)</span><span class="op" id="6982159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982162">w</span><span class="op" id="6982163">.</span><span class="ident" id="6982164">Close</span><span class="op" id="6982169">(</span><span class="op" id="6982170">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982174">r</span><span class="op" id="6982175">,</span>&nbsp;<span class="ident" id="6982177">err</span>&nbsp;<span class="op" id="6982181">:=</span>&nbsp;<span class="ident" id="6982184">NewReader</span><span class="op" id="6982193">(</span><span class="op" id="6982194">&amp;</span><span class="ident" id="6982195">buf</span><span class="op" id="6982198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982201">data</span><span class="op" id="6982205">,</span>&nbsp;<span class="ident" id="6982207">err</span>&nbsp;<span class="op" id="6982211">:=</span>&nbsp;<span class="ident" id="6982214">ioutil</span><span class="op" id="6982220">.</span><span class="ident" id="6982221">ReadAll</span><span class="op" id="6982228">(</span><span class="ident" id="6982229">r</span><span class="op" id="6982230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982233">if</span>&nbsp;<span class="builtintype" id="6982236">string</span><span class="op" id="6982242">(</span><span class="ident" id="6982243">data</span><span class="op" id="6982247">)</span>&nbsp;<span class="op" id="6982249">!=</span>&nbsp;<span class="string" id="6982252">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="6982268">||</span>&nbsp;<span class="ident" id="6982271">err</span>&nbsp;<span class="op" id="6982275">!=</span>&nbsp;<span class="ident" id="6982278">nil</span>&nbsp;<span class="op" id="6982282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982286">t</span><span class="op" id="6982287">.</span><span class="ident" id="6982288">Fatalf</span><span class="op" id="6982294">(</span><span class="string" id="6982295">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="6982327">,</span>&nbsp;<span class="ident" id="6982329">data</span><span class="op" id="6982333">,</span>&nbsp;<span class="ident" id="6982335">err</span><span class="op" id="6982338">,</span>&nbsp;<span class="string" id="6982340">&#34;hello&nbsp;world&#34;</span><span class="op" id="6982353">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982356">}</span><br>
<span class="lineno"></span><span class="op" id="6982358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6982361">func</span>&nbsp;<span class="ident" id="6982366">TestWriterReset</span><span class="op" id="6982381">(</span><span class="ident" id="6982382">t</span>&nbsp;<span class="op" id="6982384">*</span><span class="ident" id="6982385">testing</span><span class="op" id="6982392">.</span><span class="ident" id="6982393">T</span><span class="op" id="6982394">)</span>&nbsp;<span class="op" id="6982396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982399">buf</span>&nbsp;<span class="op" id="6982403">:=</span>&nbsp;<span class="builtinfunc" id="6982406">new</span><span class="op" id="6982409">(</span><span class="ident" id="6982410">bytes</span><span class="op" id="6982415">.</span><span class="ident" id="6982416">Buffer</span><span class="op" id="6982422">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982425">buf2</span>&nbsp;<span class="op" id="6982430">:=</span>&nbsp;<span class="builtinfunc" id="6982433">new</span><span class="op" id="6982436">(</span><span class="ident" id="6982437">bytes</span><span class="op" id="6982442">.</span><span class="ident" id="6982443">Buffer</span><span class="op" id="6982449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982452">z</span>&nbsp;<span class="op" id="6982454">:=</span>&nbsp;<span class="ident" id="6982457">NewWriter</span><span class="op" id="6982466">(</span><span class="ident" id="6982467">buf</span><span class="op" id="6982470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982473">msg</span>&nbsp;<span class="op" id="6982477">:=</span>&nbsp;<span class="op" id="6982480">[</span><span class="op" id="6982481">]</span><span class="builtintype" id="6982482">byte</span><span class="op" id="6982486">(</span><span class="string" id="6982487">&#34;hello&nbsp;world&#34;</span><span class="op" id="6982500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982503">z</span><span class="op" id="6982504">.</span><span class="ident" id="6982505">Write</span><span class="op" id="6982510">(</span><span class="ident" id="6982511">msg</span><span class="op" id="6982514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982517">z</span><span class="op" id="6982518">.</span><span class="ident" id="6982519">Close</span><span class="op" id="6982524">(</span><span class="op" id="6982525">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982528">z</span><span class="op" id="6982529">.</span><span class="ident" id="6982530">Reset</span><span class="op" id="6982535">(</span><span class="ident" id="6982536">buf2</span><span class="op" id="6982540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982543">z</span><span class="op" id="6982544">.</span><span class="ident" id="6982545">Write</span><span class="op" id="6982550">(</span><span class="ident" id="6982551">msg</span><span class="op" id="6982554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982557">z</span><span class="op" id="6982558">.</span><span class="ident" id="6982559">Close</span><span class="op" id="6982564">(</span><span class="op" id="6982565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6982568">if</span>&nbsp;<span class="ident" id="6982571">buf</span><span class="op" id="6982574">.</span><span class="ident" id="6982575">String</span><span class="op" id="6982581">(</span><span class="op" id="6982582">)</span>&nbsp;<span class="op" id="6982584">!=</span>&nbsp;<span class="ident" id="6982587">buf2</span><span class="op" id="6982591">.</span><span class="ident" id="6982592">String</span><span class="op" id="6982598">(</span><span class="op" id="6982599">)</span>&nbsp;<span class="op" id="6982601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6982605">t</span><span class="op" id="6982606">.</span><span class="ident" id="6982607">Errorf</span><span class="op" id="6982613">(</span><span class="string" id="6982614">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6982645">,</span>&nbsp;<span class="ident" id="6982647">buf2</span><span class="op" id="6982651">.</span><span class="ident" id="6982652">String</span><span class="op" id="6982658">(</span><span class="op" id="6982659">)</span><span class="op" id="6982660">,</span>&nbsp;<span class="ident" id="6982662">buf</span><span class="op" id="6982665">.</span><span class="ident" id="6982666">String</span><span class="op" id="6982672">(</span><span class="op" id="6982673">)</span><span class="op" id="6982674">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6982677">}</span><br>
<span class="lineno"></span><span class="op" id="6982679">}</span>
</div>
</body>
</html>
