<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4945154">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4945209">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4945263">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4945314">package</span>&nbsp;<span class="ident" id="4945322">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4945327">import</span>&nbsp;<span class="op" id="4945334">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945337">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945349">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945359">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945366">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945372">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945383">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945391">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945406">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4945417">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4945432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4945435">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="4945517">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="4945596">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4945605">type</span>&nbsp;<span class="ident" id="4945610">userTypeInfo</span>&nbsp;<span class="keyword" id="4945623">struct</span>&nbsp;<span class="op" id="4945630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945633">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945645">reflect</span><span class="op" id="4945652">.</span><span class="ident" id="4945653">Type</span>&nbsp;<span class="comment" id="4945658">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945690">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4945702">reflect</span><span class="op" id="4945709">.</span><span class="ident" id="4945710">Type</span>&nbsp;<span class="comment" id="4945715">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945756">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4945768">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945781">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945831">externalEnc</span>&nbsp;<span class="builtintype" id="4945843">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945856">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945884">externalDec</span>&nbsp;<span class="builtintype" id="4945896">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945909">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4945936">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4945948">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4945961">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946032">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4946044">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946057">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="4946127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4946130">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="4946155">const</span>&nbsp;<span class="op" id="4946161">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946164">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4946172">=</span>&nbsp;<span class="num" id="4946174">1</span>&nbsp;<span class="op" id="4946176">+</span>&nbsp;<span class="ident" id="4946178">iota</span>&nbsp;<span class="comment" id="4946183">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946212">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946231">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946290">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4946309">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="4946363">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4946366">var</span>&nbsp;<span class="op" id="4946370">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4946373">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4946436">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946498">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="4946512">sync</span><span class="op" id="4946516">.</span><span class="ident" id="4946517">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946526">userTypeCache</span>&nbsp;<span class="op" id="4946540">=</span>&nbsp;<span class="builtinfunc" id="4946542">make</span><span class="op" id="4946546">(</span><span class="keyword" id="4946547">map</span><span class="op" id="4946550">[</span><span class="ident" id="4946551">reflect</span><span class="op" id="4946558">.</span><span class="ident" id="4946559">Type</span><span class="op" id="4946563">]</span><span class="op" id="4946564">*</span><span class="ident" id="4946565">userTypeInfo</span><span class="op" id="4946577">)</span><br>
<span class="lineno"></span><span class="op" id="4946579">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4946582">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4946670">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="4946760">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="4946778">func</span>&nbsp;<span class="ident" id="4946783">validUserType</span><span class="op" id="4946796">(</span><span class="ident" id="4946797">rt</span>&nbsp;<span class="ident" id="4946800">reflect</span><span class="op" id="4946807">.</span><span class="ident" id="4946808">Type</span><span class="op" id="4946812">)</span>&nbsp;<span class="op" id="4946814">(</span><span class="ident" id="4946815">ut</span>&nbsp;<span class="op" id="4946818">*</span><span class="ident" id="4946819">userTypeInfo</span><span class="op" id="4946831">,</span>&nbsp;<span class="ident" id="4946833">err</span>&nbsp;<span class="builtintype" id="4946837">error</span><span class="op" id="4946842">)</span>&nbsp;<span class="op" id="4946844">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946847">userTypeLock</span><span class="op" id="4946859">.</span><span class="ident" id="4946860">RLock</span><span class="op" id="4946865">(</span><span class="op" id="4946866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946869">ut</span>&nbsp;<span class="op" id="4946872">=</span>&nbsp;<span class="ident" id="4946874">userTypeCache</span><span class="op" id="4946887">[</span><span class="ident" id="4946888">rt</span><span class="op" id="4946890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946893">userTypeLock</span><span class="op" id="4946905">.</span><span class="ident" id="4946906">RUnlock</span><span class="op" id="4946913">(</span><span class="op" id="4946914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946917">if</span>&nbsp;<span class="ident" id="4946920">ut</span>&nbsp;<span class="op" id="4946923">!=</span>&nbsp;<span class="ident" id="4946926">nil</span>&nbsp;<span class="op" id="4946930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4946934">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4946942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4946945">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4946989">userTypeLock</span><span class="op" id="4947001">.</span><span class="ident" id="4947002">Lock</span><span class="op" id="4947006">(</span><span class="op" id="4947007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947010">defer</span>&nbsp;<span class="ident" id="4947016">userTypeLock</span><span class="op" id="4947028">.</span><span class="ident" id="4947029">Unlock</span><span class="op" id="4947035">(</span><span class="op" id="4947036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947039">if</span>&nbsp;<span class="ident" id="4947042">ut</span>&nbsp;<span class="op" id="4947045">=</span>&nbsp;<span class="ident" id="4947047">userTypeCache</span><span class="op" id="4947060">[</span><span class="ident" id="4947061">rt</span><span class="op" id="4947063">]</span><span class="op" id="4947064">;</span>&nbsp;<span class="ident" id="4947066">ut</span>&nbsp;<span class="op" id="4947069">!=</span>&nbsp;<span class="ident" id="4947072">nil</span>&nbsp;<span class="op" id="4947076">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947080">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947115">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947126">ut</span>&nbsp;<span class="op" id="4947129">=</span>&nbsp;<span class="builtinfunc" id="4947131">new</span><span class="op" id="4947134">(</span><span class="ident" id="4947135">userTypeInfo</span><span class="op" id="4947147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947150">ut</span><span class="op" id="4947152">.</span><span class="ident" id="4947153">base</span>&nbsp;<span class="op" id="4947158">=</span>&nbsp;<span class="ident" id="4947160">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947164">ut</span><span class="op" id="4947166">.</span><span class="ident" id="4947167">user</span>&nbsp;<span class="op" id="4947172">=</span>&nbsp;<span class="ident" id="4947174">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947178">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947249">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947318">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947386">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947456">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947506">slowpoke</span>&nbsp;<span class="op" id="4947515">:=</span>&nbsp;<span class="ident" id="4947518">ut</span><span class="op" id="4947520">.</span><span class="ident" id="4947521">base</span>&nbsp;<span class="comment" id="4947526">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947560">for</span>&nbsp;<span class="op" id="4947564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947568">pt</span>&nbsp;<span class="op" id="4947571">:=</span>&nbsp;<span class="ident" id="4947574">ut</span><span class="op" id="4947576">.</span><span class="ident" id="4947577">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947584">if</span>&nbsp;<span class="ident" id="4947587">pt</span><span class="op" id="4947589">.</span><span class="ident" id="4947590">Kind</span><span class="op" id="4947594">(</span><span class="op" id="4947595">)</span>&nbsp;<span class="op" id="4947597">!=</span>&nbsp;<span class="ident" id="4947600">reflect</span><span class="op" id="4947607">.</span><span class="ident" id="4947608">Ptr</span>&nbsp;<span class="op" id="4947612">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947617">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947629">ut</span><span class="op" id="4947631">.</span><span class="ident" id="4947632">base</span>&nbsp;<span class="op" id="4947637">=</span>&nbsp;<span class="ident" id="4947639">pt</span><span class="op" id="4947641">.</span><span class="ident" id="4947642">Elem</span><span class="op" id="4947646">(</span><span class="op" id="4947647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947651">if</span>&nbsp;<span class="ident" id="4947654">ut</span><span class="op" id="4947656">.</span><span class="ident" id="4947657">base</span>&nbsp;<span class="op" id="4947662">==</span>&nbsp;<span class="ident" id="4947665">slowpoke</span>&nbsp;<span class="op" id="4947674">{</span>&nbsp;<span class="comment" id="4947676">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4947706">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947736">return</span>&nbsp;<span class="ident" id="4947743">nil</span><span class="op" id="4947746">,</span>&nbsp;<span class="ident" id="4947748">errors</span><span class="op" id="4947754">.</span><span class="ident" id="4947755">New</span><span class="op" id="4947758">(</span><span class="string" id="4947759">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4947801">+</span>&nbsp;<span class="ident" id="4947803">ut</span><span class="op" id="4947805">.</span><span class="ident" id="4947806">base</span><span class="op" id="4947810">.</span><span class="ident" id="4947811">String</span><span class="op" id="4947817">(</span><span class="op" id="4947818">)</span><span class="op" id="4947819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947827">if</span>&nbsp;<span class="ident" id="4947830">ut</span><span class="op" id="4947832">.</span><span class="ident" id="4947833">indir</span><span class="op" id="4947838">%</span><span class="num" id="4947839">2</span>&nbsp;<span class="op" id="4947841">==</span>&nbsp;<span class="num" id="4947844">0</span>&nbsp;<span class="op" id="4947846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947851">slowpoke</span>&nbsp;<span class="op" id="4947860">=</span>&nbsp;<span class="ident" id="4947862">slowpoke</span><span class="op" id="4947870">.</span><span class="ident" id="4947871">Elem</span><span class="op" id="4947875">(</span><span class="op" id="4947876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947880">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947884">ut</span><span class="op" id="4947886">.</span><span class="ident" id="4947887">indir</span><span class="op" id="4947892">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4947896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4947900">if</span>&nbsp;<span class="ident" id="4947903">ok</span><span class="op" id="4947905">,</span>&nbsp;<span class="ident" id="4947907">indir</span>&nbsp;<span class="op" id="4947913">:=</span>&nbsp;<span class="ident" id="4947916">implementsInterface</span><span class="op" id="4947935">(</span><span class="ident" id="4947936">ut</span><span class="op" id="4947938">.</span><span class="ident" id="4947939">user</span><span class="op" id="4947943">,</span>&nbsp;<span class="ident" id="4947945">gobEncoderInterfaceType</span><span class="op" id="4947968">)</span><span class="op" id="4947969">;</span>&nbsp;<span class="ident" id="4947971">ok</span>&nbsp;<span class="op" id="4947974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4947978">ut</span><span class="op" id="4947980">.</span><span class="ident" id="4947981">externalEnc</span><span class="op" id="4947992">,</span>&nbsp;<span class="ident" id="4947994">ut</span><span class="op" id="4947996">.</span><span class="ident" id="4947997">encIndir</span>&nbsp;<span class="op" id="4948006">=</span>&nbsp;<span class="ident" id="4948008">xGob</span><span class="op" id="4948012">,</span>&nbsp;<span class="ident" id="4948014">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948021">}</span>&nbsp;<span class="keyword" id="4948023">else</span>&nbsp;<span class="keyword" id="4948028">if</span>&nbsp;<span class="ident" id="4948031">ok</span><span class="op" id="4948033">,</span>&nbsp;<span class="ident" id="4948035">indir</span>&nbsp;<span class="op" id="4948041">:=</span>&nbsp;<span class="ident" id="4948044">implementsInterface</span><span class="op" id="4948063">(</span><span class="ident" id="4948064">ut</span><span class="op" id="4948066">.</span><span class="ident" id="4948067">user</span><span class="op" id="4948071">,</span>&nbsp;<span class="ident" id="4948073">binaryMarshalerInterfaceType</span><span class="op" id="4948101">)</span><span class="op" id="4948102">;</span>&nbsp;<span class="ident" id="4948104">ok</span>&nbsp;<span class="op" id="4948107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948111">ut</span><span class="op" id="4948113">.</span><span class="ident" id="4948114">externalEnc</span><span class="op" id="4948125">,</span>&nbsp;<span class="ident" id="4948127">ut</span><span class="op" id="4948129">.</span><span class="ident" id="4948130">encIndir</span>&nbsp;<span class="op" id="4948139">=</span>&nbsp;<span class="ident" id="4948141">xBinary</span><span class="op" id="4948148">,</span>&nbsp;<span class="ident" id="4948150">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948161">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948245">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948309">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948399">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948447">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948454">if</span>&nbsp;<span class="ident" id="4948457">ok</span><span class="op" id="4948459">,</span>&nbsp;<span class="ident" id="4948461">indir</span>&nbsp;<span class="op" id="4948467">:=</span>&nbsp;<span class="ident" id="4948470">implementsInterface</span><span class="op" id="4948489">(</span><span class="ident" id="4948490">ut</span><span class="op" id="4948492">.</span><span class="ident" id="4948493">user</span><span class="op" id="4948497">,</span>&nbsp;<span class="ident" id="4948499">gobDecoderInterfaceType</span><span class="op" id="4948522">)</span><span class="op" id="4948523">;</span>&nbsp;<span class="ident" id="4948525">ok</span>&nbsp;<span class="op" id="4948528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948532">ut</span><span class="op" id="4948534">.</span><span class="ident" id="4948535">externalDec</span><span class="op" id="4948546">,</span>&nbsp;<span class="ident" id="4948548">ut</span><span class="op" id="4948550">.</span><span class="ident" id="4948551">decIndir</span>&nbsp;<span class="op" id="4948560">=</span>&nbsp;<span class="ident" id="4948562">xGob</span><span class="op" id="4948566">,</span>&nbsp;<span class="ident" id="4948568">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948575">}</span>&nbsp;<span class="keyword" id="4948577">else</span>&nbsp;<span class="keyword" id="4948582">if</span>&nbsp;<span class="ident" id="4948585">ok</span><span class="op" id="4948587">,</span>&nbsp;<span class="ident" id="4948589">indir</span>&nbsp;<span class="op" id="4948595">:=</span>&nbsp;<span class="ident" id="4948598">implementsInterface</span><span class="op" id="4948617">(</span><span class="ident" id="4948618">ut</span><span class="op" id="4948620">.</span><span class="ident" id="4948621">user</span><span class="op" id="4948625">,</span>&nbsp;<span class="ident" id="4948627">binaryUnmarshalerInterfaceType</span><span class="op" id="4948657">)</span><span class="op" id="4948658">;</span>&nbsp;<span class="ident" id="4948660">ok</span>&nbsp;<span class="op" id="4948663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948667">ut</span><span class="op" id="4948669">.</span><span class="ident" id="4948670">externalDec</span><span class="op" id="4948681">,</span>&nbsp;<span class="ident" id="4948683">ut</span><span class="op" id="4948685">.</span><span class="ident" id="4948686">decIndir</span>&nbsp;<span class="op" id="4948695">=</span>&nbsp;<span class="ident" id="4948697">xBinary</span><span class="op" id="4948704">,</span>&nbsp;<span class="ident" id="4948706">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4948713">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948717">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948737">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948829">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4948877">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948884">userTypeCache</span><span class="op" id="4948897">[</span><span class="ident" id="4948898">rt</span><span class="op" id="4948900">]</span>&nbsp;<span class="op" id="4948902">=</span>&nbsp;<span class="ident" id="4948904">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4948908">return</span><br>
<span class="lineno"></span><span class="op" id="4948915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4948918">var</span>&nbsp;<span class="op" id="4948922">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4948925">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4948956">=</span>&nbsp;<span class="ident" id="4948958">reflect</span><span class="op" id="4948965">.</span><span class="ident" id="4948966">TypeOf</span><span class="op" id="4948972">(</span><span class="op" id="4948973">(</span><span class="op" id="4948974">*</span><span class="ident" id="4948975">GobEncoder</span><span class="op" id="4948985">)</span><span class="op" id="4948986">(</span><span class="ident" id="4948987">nil</span><span class="op" id="4948990">)</span><span class="op" id="4948991">)</span><span class="op" id="4948992">.</span><span class="ident" id="4948993">Elem</span><span class="op" id="4948997">(</span><span class="op" id="4948998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949001">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4949032">=</span>&nbsp;<span class="ident" id="4949034">reflect</span><span class="op" id="4949041">.</span><span class="ident" id="4949042">TypeOf</span><span class="op" id="4949048">(</span><span class="op" id="4949049">(</span><span class="op" id="4949050">*</span><span class="ident" id="4949051">GobDecoder</span><span class="op" id="4949061">)</span><span class="op" id="4949062">(</span><span class="ident" id="4949063">nil</span><span class="op" id="4949066">)</span><span class="op" id="4949067">)</span><span class="op" id="4949068">.</span><span class="ident" id="4949069">Elem</span><span class="op" id="4949073">(</span><span class="op" id="4949074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949077">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4949108">=</span>&nbsp;<span class="ident" id="4949110">reflect</span><span class="op" id="4949117">.</span><span class="ident" id="4949118">TypeOf</span><span class="op" id="4949124">(</span><span class="op" id="4949125">(</span><span class="op" id="4949126">*</span><span class="ident" id="4949127">encoding</span><span class="op" id="4949135">.</span><span class="ident" id="4949136">BinaryMarshaler</span><span class="op" id="4949151">)</span><span class="op" id="4949152">(</span><span class="ident" id="4949153">nil</span><span class="op" id="4949156">)</span><span class="op" id="4949157">)</span><span class="op" id="4949158">.</span><span class="ident" id="4949159">Elem</span><span class="op" id="4949163">(</span><span class="op" id="4949164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949167">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="4949198">=</span>&nbsp;<span class="ident" id="4949200">reflect</span><span class="op" id="4949207">.</span><span class="ident" id="4949208">TypeOf</span><span class="op" id="4949214">(</span><span class="op" id="4949215">(</span><span class="op" id="4949216">*</span><span class="ident" id="4949217">encoding</span><span class="op" id="4949225">.</span><span class="ident" id="4949226">BinaryUnmarshaler</span><span class="op" id="4949243">)</span><span class="op" id="4949244">(</span><span class="ident" id="4949245">nil</span><span class="op" id="4949248">)</span><span class="op" id="4949249">)</span><span class="op" id="4949250">.</span><span class="ident" id="4949251">Elem</span><span class="op" id="4949255">(</span><span class="op" id="4949256">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949259">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4949290">=</span>&nbsp;<span class="ident" id="4949292">reflect</span><span class="op" id="4949299">.</span><span class="ident" id="4949300">TypeOf</span><span class="op" id="4949306">(</span><span class="op" id="4949307">(</span><span class="op" id="4949308">*</span><span class="ident" id="4949309">encoding</span><span class="op" id="4949317">.</span><span class="ident" id="4949318">TextMarshaler</span><span class="op" id="4949331">)</span><span class="op" id="4949332">(</span><span class="ident" id="4949333">nil</span><span class="op" id="4949336">)</span><span class="op" id="4949337">)</span><span class="op" id="4949338">.</span><span class="ident" id="4949339">Elem</span><span class="op" id="4949343">(</span><span class="op" id="4949344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949347">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4949378">=</span>&nbsp;<span class="ident" id="4949380">reflect</span><span class="op" id="4949387">.</span><span class="ident" id="4949388">TypeOf</span><span class="op" id="4949394">(</span><span class="op" id="4949395">(</span><span class="op" id="4949396">*</span><span class="ident" id="4949397">encoding</span><span class="op" id="4949405">.</span><span class="ident" id="4949406">TextUnmarshaler</span><span class="op" id="4949421">)</span><span class="op" id="4949422">(</span><span class="ident" id="4949423">nil</span><span class="op" id="4949426">)</span><span class="op" id="4949427">)</span><span class="op" id="4949428">.</span><span class="ident" id="4949429">Elem</span><span class="op" id="4949433">(</span><span class="op" id="4949434">)</span><br>
<span class="lineno"></span><span class="op" id="4949436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4949439">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="4949502">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4949538">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4949607">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="4949626">func</span>&nbsp;<span class="ident" id="4949631">implementsInterface</span><span class="op" id="4949650">(</span><span class="ident" id="4949651">typ</span><span class="op" id="4949654">,</span>&nbsp;<span class="ident" id="4949656">gobEncDecType</span>&nbsp;<span class="ident" id="4949670">reflect</span><span class="op" id="4949677">.</span><span class="ident" id="4949678">Type</span><span class="op" id="4949682">)</span>&nbsp;<span class="op" id="4949684">(</span><span class="ident" id="4949685">success</span>&nbsp;<span class="builtintype" id="4949693">bool</span><span class="op" id="4949697">,</span>&nbsp;<span class="ident" id="4949699">indir</span>&nbsp;<span class="builtintype" id="4949705">int8</span><span class="op" id="4949709">)</span>&nbsp;<span class="op" id="4949711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949714">if</span>&nbsp;<span class="ident" id="4949717">typ</span>&nbsp;<span class="op" id="4949721">==</span>&nbsp;<span class="ident" id="4949724">nil</span>&nbsp;<span class="op" id="4949728">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949732">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949743">rt</span>&nbsp;<span class="op" id="4949746">:=</span>&nbsp;<span class="ident" id="4949749">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4949754">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4949806">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949874">for</span>&nbsp;<span class="op" id="4949878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949882">if</span>&nbsp;<span class="ident" id="4949885">rt</span><span class="op" id="4949887">.</span><span class="ident" id="4949888">Implements</span><span class="op" id="4949898">(</span><span class="ident" id="4949899">gobEncDecType</span><span class="op" id="4949912">)</span>&nbsp;<span class="op" id="4949914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949919">return</span>&nbsp;<span class="builtintype" id="4949926">true</span><span class="op" id="4949930">,</span>&nbsp;<span class="ident" id="4949932">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4949940">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949944">if</span>&nbsp;<span class="ident" id="4949947">p</span>&nbsp;<span class="op" id="4949949">:=</span>&nbsp;<span class="ident" id="4949952">rt</span><span class="op" id="4949954">;</span>&nbsp;<span class="ident" id="4949956">p</span><span class="op" id="4949957">.</span><span class="ident" id="4949958">Kind</span><span class="op" id="4949962">(</span><span class="op" id="4949963">)</span>&nbsp;<span class="op" id="4949965">==</span>&nbsp;<span class="ident" id="4949968">reflect</span><span class="op" id="4949975">.</span><span class="ident" id="4949976">Ptr</span>&nbsp;<span class="op" id="4949980">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4949985">indir</span><span class="op" id="4949990">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4949996">if</span>&nbsp;<span class="ident" id="4949999">indir</span>&nbsp;<span class="op" id="4950005">&gt;</span>&nbsp;<span class="num" id="4950007">100</span>&nbsp;<span class="op" id="4950011">{</span>&nbsp;<span class="comment" id="4950013">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950050">return</span>&nbsp;<span class="builtintype" id="4950057">false</span><span class="op" id="4950062">,</span>&nbsp;<span class="num" id="4950064">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950074">rt</span>&nbsp;<span class="op" id="4950077">=</span>&nbsp;<span class="ident" id="4950079">p</span><span class="op" id="4950080">.</span><span class="ident" id="4950081">Elem</span><span class="op" id="4950085">(</span><span class="op" id="4950086">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950091">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950106">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4950116">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950202">if</span>&nbsp;<span class="ident" id="4950205">typ</span><span class="op" id="4950208">.</span><span class="ident" id="4950209">Kind</span><span class="op" id="4950213">(</span><span class="op" id="4950214">)</span>&nbsp;<span class="op" id="4950216">!=</span>&nbsp;<span class="ident" id="4950219">reflect</span><span class="op" id="4950226">.</span><span class="ident" id="4950227">Ptr</span>&nbsp;<span class="op" id="4950231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4950235">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950282">if</span>&nbsp;<span class="ident" id="4950285">reflect</span><span class="op" id="4950292">.</span><span class="ident" id="4950293">PtrTo</span><span class="op" id="4950298">(</span><span class="ident" id="4950299">typ</span><span class="op" id="4950302">)</span><span class="op" id="4950303">.</span><span class="ident" id="4950304">Implements</span><span class="op" id="4950314">(</span><span class="ident" id="4950315">gobEncDecType</span><span class="op" id="4950328">)</span>&nbsp;<span class="op" id="4950330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950335">return</span>&nbsp;<span class="builtintype" id="4950342">true</span><span class="op" id="4950346">,</span>&nbsp;<span class="op" id="4950348">-</span><span class="num" id="4950349">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950353">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950359">return</span>&nbsp;<span class="builtintype" id="4950366">false</span><span class="op" id="4950371">,</span>&nbsp;<span class="num" id="4950373">0</span><br>
<span class="lineno"></span><span class="op" id="4950375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950378">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="4950465">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4950515">func</span>&nbsp;<span class="ident" id="4950520">userType</span><span class="op" id="4950528">(</span><span class="ident" id="4950529">rt</span>&nbsp;<span class="ident" id="4950532">reflect</span><span class="op" id="4950539">.</span><span class="ident" id="4950540">Type</span><span class="op" id="4950544">)</span>&nbsp;<span class="op" id="4950546">*</span><span class="ident" id="4950547">userTypeInfo</span>&nbsp;<span class="op" id="4950560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950563">ut</span><span class="op" id="4950565">,</span>&nbsp;<span class="ident" id="4950567">err</span>&nbsp;<span class="op" id="4950571">:=</span>&nbsp;<span class="ident" id="4950574">validUserType</span><span class="op" id="4950587">(</span><span class="ident" id="4950588">rt</span><span class="op" id="4950590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950593">if</span>&nbsp;<span class="ident" id="4950596">err</span>&nbsp;<span class="op" id="4950600">!=</span>&nbsp;<span class="ident" id="4950603">nil</span>&nbsp;<span class="op" id="4950607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4950611">error_</span><span class="op" id="4950617">(</span><span class="ident" id="4950618">err</span><span class="op" id="4950621">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4950624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4950627">return</span>&nbsp;<span class="ident" id="4950634">ut</span><br>
<span class="lineno"></span><span class="op" id="4950637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4950640">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="4950720">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="4950806">type</span>&nbsp;<span class="ident" id="4950811">typeId</span>&nbsp;<span class="builtintype" id="4950818">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4950825">var</span>&nbsp;<span class="ident" id="4950829">nextId</span>&nbsp;<span class="ident" id="4950836">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4950849">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="4950891">var</span>&nbsp;<span class="ident" id="4950895">typeLock</span>&nbsp;<span class="ident" id="4950904">sync</span><span class="op" id="4950908">.</span><span class="ident" id="4950909">Mutex</span>&nbsp;<span class="comment" id="4950915">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="4950944">const</span>&nbsp;<span class="ident" id="4950950">firstUserId</span>&nbsp;<span class="op" id="4950962">=</span>&nbsp;<span class="num" id="4950964">64</span>&nbsp;&nbsp;<span class="comment" id="4950968">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4951005">type</span>&nbsp;<span class="ident" id="4951010">gobType</span>&nbsp;<span class="keyword" id="4951018">interface</span>&nbsp;<span class="op" id="4951028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951031">id</span><span class="op" id="4951033">(</span><span class="op" id="4951034">)</span>&nbsp;<span class="ident" id="4951036">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951044">setId</span><span class="op" id="4951049">(</span><span class="ident" id="4951050">id</span>&nbsp;<span class="ident" id="4951053">typeId</span><span class="op" id="4951059">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951062">name</span><span class="op" id="4951066">(</span><span class="op" id="4951067">)</span>&nbsp;<span class="builtintype" id="4951069">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4951077">string</span><span class="op" id="4951083">(</span><span class="op" id="4951084">)</span>&nbsp;<span class="builtintype" id="4951086">string</span>&nbsp;<span class="comment" id="4951093">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951128">safeString</span><span class="op" id="4951138">(</span><span class="ident" id="4951139">seen</span>&nbsp;<span class="keyword" id="4951144">map</span><span class="op" id="4951147">[</span><span class="ident" id="4951148">typeId</span><span class="op" id="4951154">]</span><span class="builtintype" id="4951155">bool</span><span class="op" id="4951159">)</span>&nbsp;<span class="builtintype" id="4951161">string</span><br>
<span class="lineno"></span><span class="op" id="4951168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="4951171">var</span>&nbsp;<span class="ident" id="4951175">types</span>&nbsp;<span class="op" id="4951181">=</span>&nbsp;<span class="builtinfunc" id="4951183">make</span><span class="op" id="4951187">(</span><span class="keyword" id="4951188">map</span><span class="op" id="4951191">[</span><span class="ident" id="4951192">reflect</span><span class="op" id="4951199">.</span><span class="ident" id="4951200">Type</span><span class="op" id="4951204">]</span><span class="ident" id="4951205">gobType</span><span class="op" id="4951212">)</span><br>
<span class="lineno"></span><span class="keyword" id="4951214">var</span>&nbsp;<span class="ident" id="4951218">idToType</span>&nbsp;<span class="op" id="4951227">=</span>&nbsp;<span class="builtinfunc" id="4951229">make</span><span class="op" id="4951233">(</span><span class="keyword" id="4951234">map</span><span class="op" id="4951237">[</span><span class="ident" id="4951238">typeId</span><span class="op" id="4951244">]</span><span class="ident" id="4951245">gobType</span><span class="op" id="4951252">)</span><br>
<span class="lineno"></span><span class="keyword" id="4951254">var</span>&nbsp;<span class="ident" id="4951258">builtinIdToType</span>&nbsp;<span class="keyword" id="4951274">map</span><span class="op" id="4951277">[</span><span class="ident" id="4951278">typeId</span><span class="op" id="4951284">]</span><span class="ident" id="4951285">gobType</span>&nbsp;<span class="comment" id="4951293">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4951342">func</span>&nbsp;<span class="ident" id="4951347">setTypeId</span><span class="op" id="4951356">(</span><span class="ident" id="4951357">typ</span>&nbsp;<span class="ident" id="4951361">gobType</span><span class="op" id="4951368">)</span>&nbsp;<span class="op" id="4951370">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4951373">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951441">if</span>&nbsp;<span class="ident" id="4951444">typ</span><span class="op" id="4951447">.</span><span class="ident" id="4951448">id</span><span class="op" id="4951450">(</span><span class="op" id="4951451">)</span>&nbsp;<span class="op" id="4951453">!=</span>&nbsp;<span class="num" id="4951456">0</span>&nbsp;<span class="op" id="4951458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951462">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951473">nextId</span><span class="op" id="4951479">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951483">typ</span><span class="op" id="4951486">.</span><span class="ident" id="4951487">setId</span><span class="op" id="4951492">(</span><span class="ident" id="4951493">nextId</span><span class="op" id="4951499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4951502">idToType</span><span class="op" id="4951510">[</span><span class="ident" id="4951511">nextId</span><span class="op" id="4951517">]</span>&nbsp;<span class="op" id="4951519">=</span>&nbsp;<span class="ident" id="4951521">typ</span><br>
<span class="lineno"></span><span class="op" id="4951525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4951528">func</span>&nbsp;<span class="op" id="4951533">(</span><span class="ident" id="4951534">t</span>&nbsp;<span class="ident" id="4951536">typeId</span><span class="op" id="4951542">)</span>&nbsp;<span class="ident" id="4951544">gobType</span><span class="op" id="4951551">(</span><span class="op" id="4951552">)</span>&nbsp;<span class="ident" id="4951554">gobType</span>&nbsp;<span class="op" id="4951562">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951565">if</span>&nbsp;<span class="ident" id="4951568">t</span>&nbsp;<span class="op" id="4951570">==</span>&nbsp;<span class="num" id="4951573">0</span>&nbsp;<span class="op" id="4951575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951579">return</span>&nbsp;<span class="ident" id="4951586">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951594">return</span>&nbsp;<span class="ident" id="4951601">idToType</span><span class="op" id="4951609">[</span><span class="ident" id="4951610">t</span><span class="op" id="4951611">]</span><br>
<span class="lineno"></span><span class="op" id="4951613">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4951616">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="4951700">func</span>&nbsp;<span class="op" id="4951705">(</span><span class="ident" id="4951706">t</span>&nbsp;<span class="ident" id="4951708">typeId</span><span class="op" id="4951714">)</span>&nbsp;<span class="builtintype" id="4951716">string</span><span class="op" id="4951722">(</span><span class="op" id="4951723">)</span>&nbsp;<span class="builtintype" id="4951725">string</span>&nbsp;<span class="op" id="4951732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951735">if</span>&nbsp;<span class="ident" id="4951738">t</span><span class="op" id="4951739">.</span><span class="ident" id="4951740">gobType</span><span class="op" id="4951747">(</span><span class="op" id="4951748">)</span>&nbsp;<span class="op" id="4951750">==</span>&nbsp;<span class="ident" id="4951753">nil</span>&nbsp;<span class="op" id="4951757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951761">return</span>&nbsp;<span class="string" id="4951768">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951780">return</span>&nbsp;<span class="ident" id="4951787">t</span><span class="op" id="4951788">.</span><span class="ident" id="4951789">gobType</span><span class="op" id="4951796">(</span><span class="op" id="4951797">)</span><span class="op" id="4951798">.</span><span class="builtintype" id="4951799">string</span><span class="op" id="4951805">(</span><span class="op" id="4951806">)</span><br>
<span class="lineno"></span><span class="op" id="4951808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951811">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="4951876">func</span>&nbsp;<span class="op" id="4951881">(</span><span class="ident" id="4951882">t</span>&nbsp;<span class="ident" id="4951884">typeId</span><span class="op" id="4951890">)</span>&nbsp;<span class="ident" id="4951892">name</span><span class="op" id="4951896">(</span><span class="op" id="4951897">)</span>&nbsp;<span class="builtintype" id="4951899">string</span>&nbsp;<span class="op" id="4951906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951909">if</span>&nbsp;<span class="ident" id="4951912">t</span><span class="op" id="4951913">.</span><span class="ident" id="4951914">gobType</span><span class="op" id="4951921">(</span><span class="op" id="4951922">)</span>&nbsp;<span class="op" id="4951924">==</span>&nbsp;<span class="ident" id="4951927">nil</span>&nbsp;<span class="op" id="4951931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951935">return</span>&nbsp;<span class="string" id="4951942">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4951951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4951954">return</span>&nbsp;<span class="ident" id="4951961">t</span><span class="op" id="4951962">.</span><span class="ident" id="4951963">gobType</span><span class="op" id="4951970">(</span><span class="op" id="4951971">)</span><span class="op" id="4951972">.</span><span class="ident" id="4951973">name</span><span class="op" id="4951977">(</span><span class="op" id="4951978">)</span><br>
<span class="lineno">220</span><span class="op" id="4951980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4951983">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="4952026">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4952101">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="4952178">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4952221">type</span>&nbsp;<span class="ident" id="4952226">CommonType</span>&nbsp;<span class="keyword" id="4952237">struct</span>&nbsp;<span class="op" id="4952244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952247">Name</span>&nbsp;<span class="builtintype" id="4952252">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952260">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4952265">typeId</span><br>
<span class="lineno"></span><span class="op" id="4952272">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="4952275">func</span>&nbsp;<span class="op" id="4952280">(</span><span class="ident" id="4952281">t</span>&nbsp;<span class="op" id="4952283">*</span><span class="ident" id="4952284">CommonType</span><span class="op" id="4952294">)</span>&nbsp;<span class="ident" id="4952296">id</span><span class="op" id="4952298">(</span><span class="op" id="4952299">)</span>&nbsp;<span class="ident" id="4952301">typeId</span>&nbsp;<span class="op" id="4952308">{</span>&nbsp;<span class="keyword" id="4952310">return</span>&nbsp;<span class="ident" id="4952317">t</span><span class="op" id="4952318">.</span><span class="ident" id="4952319">Id</span>&nbsp;<span class="op" id="4952322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952325">func</span>&nbsp;<span class="op" id="4952330">(</span><span class="ident" id="4952331">t</span>&nbsp;<span class="op" id="4952333">*</span><span class="ident" id="4952334">CommonType</span><span class="op" id="4952344">)</span>&nbsp;<span class="ident" id="4952346">setId</span><span class="op" id="4952351">(</span><span class="ident" id="4952352">id</span>&nbsp;<span class="ident" id="4952355">typeId</span><span class="op" id="4952361">)</span>&nbsp;<span class="op" id="4952363">{</span>&nbsp;<span class="ident" id="4952365">t</span><span class="op" id="4952366">.</span><span class="ident" id="4952367">Id</span>&nbsp;<span class="op" id="4952370">=</span>&nbsp;<span class="ident" id="4952372">id</span>&nbsp;<span class="op" id="4952375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4952378">func</span>&nbsp;<span class="op" id="4952383">(</span><span class="ident" id="4952384">t</span>&nbsp;<span class="op" id="4952386">*</span><span class="ident" id="4952387">CommonType</span><span class="op" id="4952397">)</span>&nbsp;<span class="builtintype" id="4952399">string</span><span class="op" id="4952405">(</span><span class="op" id="4952406">)</span>&nbsp;<span class="builtintype" id="4952408">string</span>&nbsp;<span class="op" id="4952415">{</span>&nbsp;<span class="keyword" id="4952417">return</span>&nbsp;<span class="ident" id="4952424">t</span><span class="op" id="4952425">.</span><span class="ident" id="4952426">Name</span>&nbsp;<span class="op" id="4952431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4952434">func</span>&nbsp;<span class="op" id="4952439">(</span><span class="ident" id="4952440">t</span>&nbsp;<span class="op" id="4952442">*</span><span class="ident" id="4952443">CommonType</span><span class="op" id="4952453">)</span>&nbsp;<span class="ident" id="4952455">safeString</span><span class="op" id="4952465">(</span><span class="ident" id="4952466">seen</span>&nbsp;<span class="keyword" id="4952471">map</span><span class="op" id="4952474">[</span><span class="ident" id="4952475">typeId</span><span class="op" id="4952481">]</span><span class="builtintype" id="4952482">bool</span><span class="op" id="4952486">)</span>&nbsp;<span class="builtintype" id="4952488">string</span>&nbsp;<span class="op" id="4952495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4952498">return</span>&nbsp;<span class="ident" id="4952505">t</span><span class="op" id="4952506">.</span><span class="ident" id="4952507">Name</span><br>
<span class="lineno"></span><span class="op" id="4952512">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4952515">func</span>&nbsp;<span class="op" id="4952520">(</span><span class="ident" id="4952521">t</span>&nbsp;<span class="op" id="4952523">*</span><span class="ident" id="4952524">CommonType</span><span class="op" id="4952534">)</span>&nbsp;<span class="ident" id="4952536">name</span><span class="op" id="4952540">(</span><span class="op" id="4952541">)</span>&nbsp;<span class="builtintype" id="4952543">string</span>&nbsp;<span class="op" id="4952550">{</span>&nbsp;<span class="keyword" id="4952552">return</span>&nbsp;<span class="ident" id="4952559">t</span><span class="op" id="4952560">.</span><span class="ident" id="4952561">Name</span>&nbsp;<span class="op" id="4952566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4952569">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="4952606">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4952684">var</span>&nbsp;<span class="op" id="4952688">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952691">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952743">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4952797">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952848">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4952859">=</span>&nbsp;<span class="ident" id="4952861">bootstrapType</span><span class="op" id="4952874">(</span><span class="string" id="4952875">&#34;bool&#34;</span><span class="op" id="4952881">,</span>&nbsp;<span class="op" id="4952883">(</span><span class="op" id="4952884">*</span><span class="builtintype" id="4952885">bool</span><span class="op" id="4952889">)</span><span class="op" id="4952890">(</span><span class="ident" id="4952891">nil</span><span class="op" id="4952894">)</span><span class="op" id="4952895">,</span>&nbsp;<span class="num" id="4952897">1</span><span class="op" id="4952898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952901">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4952912">=</span>&nbsp;<span class="ident" id="4952914">bootstrapType</span><span class="op" id="4952927">(</span><span class="string" id="4952928">&#34;int&#34;</span><span class="op" id="4952933">,</span>&nbsp;<span class="op" id="4952935">(</span><span class="op" id="4952936">*</span><span class="builtintype" id="4952937">int</span><span class="op" id="4952940">)</span><span class="op" id="4952941">(</span><span class="ident" id="4952942">nil</span><span class="op" id="4952945">)</span><span class="op" id="4952946">,</span>&nbsp;<span class="num" id="4952948">2</span><span class="op" id="4952949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4952952">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4952963">=</span>&nbsp;<span class="ident" id="4952965">bootstrapType</span><span class="op" id="4952978">(</span><span class="string" id="4952979">&#34;uint&#34;</span><span class="op" id="4952985">,</span>&nbsp;<span class="op" id="4952987">(</span><span class="op" id="4952988">*</span><span class="builtintype" id="4952989">uint</span><span class="op" id="4952993">)</span><span class="op" id="4952994">(</span><span class="ident" id="4952995">nil</span><span class="op" id="4952998">)</span><span class="op" id="4952999">,</span>&nbsp;<span class="num" id="4953001">3</span><span class="op" id="4953002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953005">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4953016">=</span>&nbsp;<span class="ident" id="4953018">bootstrapType</span><span class="op" id="4953031">(</span><span class="string" id="4953032">&#34;float&#34;</span><span class="op" id="4953039">,</span>&nbsp;<span class="op" id="4953041">(</span><span class="op" id="4953042">*</span><span class="builtintype" id="4953043">float64</span><span class="op" id="4953050">)</span><span class="op" id="4953051">(</span><span class="ident" id="4953052">nil</span><span class="op" id="4953055">)</span><span class="op" id="4953056">,</span>&nbsp;<span class="num" id="4953058">4</span><span class="op" id="4953059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953062">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4953073">=</span>&nbsp;<span class="ident" id="4953075">bootstrapType</span><span class="op" id="4953088">(</span><span class="string" id="4953089">&#34;bytes&#34;</span><span class="op" id="4953096">,</span>&nbsp;<span class="op" id="4953098">(</span><span class="op" id="4953099">*</span><span class="op" id="4953100">[</span><span class="op" id="4953101">]</span><span class="builtintype" id="4953102">byte</span><span class="op" id="4953106">)</span><span class="op" id="4953107">(</span><span class="ident" id="4953108">nil</span><span class="op" id="4953111">)</span><span class="op" id="4953112">,</span>&nbsp;<span class="num" id="4953114">5</span><span class="op" id="4953115">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953118">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4953129">=</span>&nbsp;<span class="ident" id="4953131">bootstrapType</span><span class="op" id="4953144">(</span><span class="string" id="4953145">&#34;string&#34;</span><span class="op" id="4953153">,</span>&nbsp;<span class="op" id="4953155">(</span><span class="op" id="4953156">*</span><span class="builtintype" id="4953157">string</span><span class="op" id="4953163">)</span><span class="op" id="4953164">(</span><span class="ident" id="4953165">nil</span><span class="op" id="4953168">)</span><span class="op" id="4953169">,</span>&nbsp;<span class="num" id="4953171">6</span><span class="op" id="4953172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953175">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4953186">=</span>&nbsp;<span class="ident" id="4953188">bootstrapType</span><span class="op" id="4953201">(</span><span class="string" id="4953202">&#34;complex&#34;</span><span class="op" id="4953211">,</span>&nbsp;<span class="op" id="4953213">(</span><span class="op" id="4953214">*</span><span class="builtintype" id="4953215">complex128</span><span class="op" id="4953225">)</span><span class="op" id="4953226">(</span><span class="ident" id="4953227">nil</span><span class="op" id="4953230">)</span><span class="op" id="4953231">,</span>&nbsp;<span class="num" id="4953233">7</span><span class="op" id="4953234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953237">tInterface</span>&nbsp;<span class="op" id="4953248">=</span>&nbsp;<span class="ident" id="4953250">bootstrapType</span><span class="op" id="4953263">(</span><span class="string" id="4953264">&#34;interface&#34;</span><span class="op" id="4953275">,</span>&nbsp;<span class="op" id="4953277">(</span><span class="op" id="4953278">*</span><span class="keyword" id="4953279">interface</span><span class="op" id="4953288">{</span><span class="op" id="4953289">}</span><span class="op" id="4953290">)</span><span class="op" id="4953291">(</span><span class="ident" id="4953292">nil</span><span class="op" id="4953295">)</span><span class="op" id="4953296">,</span>&nbsp;<span class="num" id="4953298">8</span><span class="op" id="4953299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4953302">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953348">tReserved7</span>&nbsp;<span class="op" id="4953359">=</span>&nbsp;<span class="ident" id="4953361">bootstrapType</span><span class="op" id="4953374">(</span><span class="string" id="4953375">&#34;_reserved1&#34;</span><span class="op" id="4953387">,</span>&nbsp;<span class="op" id="4953389">(</span><span class="op" id="4953390">*</span><span class="keyword" id="4953391">struct</span><span class="op" id="4953397">{</span>&nbsp;<span class="ident" id="4953399">r7</span>&nbsp;<span class="builtintype" id="4953402">int</span>&nbsp;<span class="op" id="4953406">}</span><span class="op" id="4953407">)</span><span class="op" id="4953408">(</span><span class="ident" id="4953409">nil</span><span class="op" id="4953412">)</span><span class="op" id="4953413">,</span>&nbsp;<span class="num" id="4953415">9</span><span class="op" id="4953416">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953419">tReserved6</span>&nbsp;<span class="op" id="4953430">=</span>&nbsp;<span class="ident" id="4953432">bootstrapType</span><span class="op" id="4953445">(</span><span class="string" id="4953446">&#34;_reserved1&#34;</span><span class="op" id="4953458">,</span>&nbsp;<span class="op" id="4953460">(</span><span class="op" id="4953461">*</span><span class="keyword" id="4953462">struct</span><span class="op" id="4953468">{</span>&nbsp;<span class="ident" id="4953470">r6</span>&nbsp;<span class="builtintype" id="4953473">int</span>&nbsp;<span class="op" id="4953477">}</span><span class="op" id="4953478">)</span><span class="op" id="4953479">(</span><span class="ident" id="4953480">nil</span><span class="op" id="4953483">)</span><span class="op" id="4953484">,</span>&nbsp;<span class="num" id="4953486">10</span><span class="op" id="4953488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953491">tReserved5</span>&nbsp;<span class="op" id="4953502">=</span>&nbsp;<span class="ident" id="4953504">bootstrapType</span><span class="op" id="4953517">(</span><span class="string" id="4953518">&#34;_reserved1&#34;</span><span class="op" id="4953530">,</span>&nbsp;<span class="op" id="4953532">(</span><span class="op" id="4953533">*</span><span class="keyword" id="4953534">struct</span><span class="op" id="4953540">{</span>&nbsp;<span class="ident" id="4953542">r5</span>&nbsp;<span class="builtintype" id="4953545">int</span>&nbsp;<span class="op" id="4953549">}</span><span class="op" id="4953550">)</span><span class="op" id="4953551">(</span><span class="ident" id="4953552">nil</span><span class="op" id="4953555">)</span><span class="op" id="4953556">,</span>&nbsp;<span class="num" id="4953558">11</span><span class="op" id="4953560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953563">tReserved4</span>&nbsp;<span class="op" id="4953574">=</span>&nbsp;<span class="ident" id="4953576">bootstrapType</span><span class="op" id="4953589">(</span><span class="string" id="4953590">&#34;_reserved1&#34;</span><span class="op" id="4953602">,</span>&nbsp;<span class="op" id="4953604">(</span><span class="op" id="4953605">*</span><span class="keyword" id="4953606">struct</span><span class="op" id="4953612">{</span>&nbsp;<span class="ident" id="4953614">r4</span>&nbsp;<span class="builtintype" id="4953617">int</span>&nbsp;<span class="op" id="4953621">}</span><span class="op" id="4953622">)</span><span class="op" id="4953623">(</span><span class="ident" id="4953624">nil</span><span class="op" id="4953627">)</span><span class="op" id="4953628">,</span>&nbsp;<span class="num" id="4953630">12</span><span class="op" id="4953632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953635">tReserved3</span>&nbsp;<span class="op" id="4953646">=</span>&nbsp;<span class="ident" id="4953648">bootstrapType</span><span class="op" id="4953661">(</span><span class="string" id="4953662">&#34;_reserved1&#34;</span><span class="op" id="4953674">,</span>&nbsp;<span class="op" id="4953676">(</span><span class="op" id="4953677">*</span><span class="keyword" id="4953678">struct</span><span class="op" id="4953684">{</span>&nbsp;<span class="ident" id="4953686">r3</span>&nbsp;<span class="builtintype" id="4953689">int</span>&nbsp;<span class="op" id="4953693">}</span><span class="op" id="4953694">)</span><span class="op" id="4953695">(</span><span class="ident" id="4953696">nil</span><span class="op" id="4953699">)</span><span class="op" id="4953700">,</span>&nbsp;<span class="num" id="4953702">13</span><span class="op" id="4953704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953707">tReserved2</span>&nbsp;<span class="op" id="4953718">=</span>&nbsp;<span class="ident" id="4953720">bootstrapType</span><span class="op" id="4953733">(</span><span class="string" id="4953734">&#34;_reserved1&#34;</span><span class="op" id="4953746">,</span>&nbsp;<span class="op" id="4953748">(</span><span class="op" id="4953749">*</span><span class="keyword" id="4953750">struct</span><span class="op" id="4953756">{</span>&nbsp;<span class="ident" id="4953758">r2</span>&nbsp;<span class="builtintype" id="4953761">int</span>&nbsp;<span class="op" id="4953765">}</span><span class="op" id="4953766">)</span><span class="op" id="4953767">(</span><span class="ident" id="4953768">nil</span><span class="op" id="4953771">)</span><span class="op" id="4953772">,</span>&nbsp;<span class="num" id="4953774">14</span><span class="op" id="4953776">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4953779">tReserved1</span>&nbsp;<span class="op" id="4953790">=</span>&nbsp;<span class="ident" id="4953792">bootstrapType</span><span class="op" id="4953805">(</span><span class="string" id="4953806">&#34;_reserved1&#34;</span><span class="op" id="4953818">,</span>&nbsp;<span class="op" id="4953820">(</span><span class="op" id="4953821">*</span><span class="keyword" id="4953822">struct</span><span class="op" id="4953828">{</span>&nbsp;<span class="ident" id="4953830">r1</span>&nbsp;<span class="builtintype" id="4953833">int</span>&nbsp;<span class="op" id="4953837">}</span><span class="op" id="4953838">)</span><span class="op" id="4953839">(</span><span class="ident" id="4953840">nil</span><span class="op" id="4953843">)</span><span class="op" id="4953844">,</span>&nbsp;<span class="num" id="4953846">15</span><span class="op" id="4953848">)</span><br>
<span class="lineno"></span><span class="op" id="4953850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4953853">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="4953902">var</span>&nbsp;<span class="ident" id="4953906">tWireType</span>&nbsp;<span class="op" id="4953916">=</span>&nbsp;<span class="ident" id="4953918">mustGetTypeInfo</span><span class="op" id="4953933">(</span><span class="ident" id="4953934">reflect</span><span class="op" id="4953941">.</span><span class="ident" id="4953942">TypeOf</span><span class="op" id="4953948">(</span><span class="ident" id="4953949">wireType</span><span class="op" id="4953957">{</span><span class="op" id="4953958">}</span><span class="op" id="4953959">)</span><span class="op" id="4953960">)</span><span class="op" id="4953961">.</span><span class="ident" id="4953962">id</span><br>
<span class="lineno">270</span><span class="keyword" id="4953965">var</span>&nbsp;<span class="ident" id="4953969">wireTypeUserInfo</span>&nbsp;<span class="op" id="4953986">*</span><span class="ident" id="4953987">userTypeInfo</span>&nbsp;<span class="comment" id="4954000">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4954032">func</span>&nbsp;<span class="ident" id="4954037">init</span><span class="op" id="4954041">(</span><span class="op" id="4954042">)</span>&nbsp;<span class="op" id="4954044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954047">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954107">checkId</span><span class="op" id="4954114">(</span><span class="num" id="4954115">16</span><span class="op" id="4954117">,</span>&nbsp;<span class="ident" id="4954119">tWireType</span><span class="op" id="4954128">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954131">checkId</span><span class="op" id="4954138">(</span><span class="num" id="4954139">17</span><span class="op" id="4954141">,</span>&nbsp;<span class="ident" id="4954143">mustGetTypeInfo</span><span class="op" id="4954158">(</span><span class="ident" id="4954159">reflect</span><span class="op" id="4954166">.</span><span class="ident" id="4954167">TypeOf</span><span class="op" id="4954173">(</span><span class="ident" id="4954174">arrayType</span><span class="op" id="4954183">{</span><span class="op" id="4954184">}</span><span class="op" id="4954185">)</span><span class="op" id="4954186">)</span><span class="op" id="4954187">.</span><span class="ident" id="4954188">id</span><span class="op" id="4954190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954193">checkId</span><span class="op" id="4954200">(</span><span class="num" id="4954201">18</span><span class="op" id="4954203">,</span>&nbsp;<span class="ident" id="4954205">mustGetTypeInfo</span><span class="op" id="4954220">(</span><span class="ident" id="4954221">reflect</span><span class="op" id="4954228">.</span><span class="ident" id="4954229">TypeOf</span><span class="op" id="4954235">(</span><span class="ident" id="4954236">CommonType</span><span class="op" id="4954246">{</span><span class="op" id="4954247">}</span><span class="op" id="4954248">)</span><span class="op" id="4954249">)</span><span class="op" id="4954250">.</span><span class="ident" id="4954251">id</span><span class="op" id="4954253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954256">checkId</span><span class="op" id="4954263">(</span><span class="num" id="4954264">19</span><span class="op" id="4954266">,</span>&nbsp;<span class="ident" id="4954268">mustGetTypeInfo</span><span class="op" id="4954283">(</span><span class="ident" id="4954284">reflect</span><span class="op" id="4954291">.</span><span class="ident" id="4954292">TypeOf</span><span class="op" id="4954298">(</span><span class="ident" id="4954299">sliceType</span><span class="op" id="4954308">{</span><span class="op" id="4954309">}</span><span class="op" id="4954310">)</span><span class="op" id="4954311">)</span><span class="op" id="4954312">.</span><span class="ident" id="4954313">id</span><span class="op" id="4954315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954318">checkId</span><span class="op" id="4954325">(</span><span class="num" id="4954326">20</span><span class="op" id="4954328">,</span>&nbsp;<span class="ident" id="4954330">mustGetTypeInfo</span><span class="op" id="4954345">(</span><span class="ident" id="4954346">reflect</span><span class="op" id="4954353">.</span><span class="ident" id="4954354">TypeOf</span><span class="op" id="4954360">(</span><span class="ident" id="4954361">structType</span><span class="op" id="4954371">{</span><span class="op" id="4954372">}</span><span class="op" id="4954373">)</span><span class="op" id="4954374">)</span><span class="op" id="4954375">.</span><span class="ident" id="4954376">id</span><span class="op" id="4954378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954381">checkId</span><span class="op" id="4954388">(</span><span class="num" id="4954389">21</span><span class="op" id="4954391">,</span>&nbsp;<span class="ident" id="4954393">mustGetTypeInfo</span><span class="op" id="4954408">(</span><span class="ident" id="4954409">reflect</span><span class="op" id="4954416">.</span><span class="ident" id="4954417">TypeOf</span><span class="op" id="4954423">(</span><span class="ident" id="4954424">fieldType</span><span class="op" id="4954433">{</span><span class="op" id="4954434">}</span><span class="op" id="4954435">)</span><span class="op" id="4954436">)</span><span class="op" id="4954437">.</span><span class="ident" id="4954438">id</span><span class="op" id="4954440">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954443">checkId</span><span class="op" id="4954450">(</span><span class="num" id="4954451">23</span><span class="op" id="4954453">,</span>&nbsp;<span class="ident" id="4954455">mustGetTypeInfo</span><span class="op" id="4954470">(</span><span class="ident" id="4954471">reflect</span><span class="op" id="4954478">.</span><span class="ident" id="4954479">TypeOf</span><span class="op" id="4954485">(</span><span class="ident" id="4954486">mapType</span><span class="op" id="4954493">{</span><span class="op" id="4954494">}</span><span class="op" id="4954495">)</span><span class="op" id="4954496">)</span><span class="op" id="4954497">.</span><span class="ident" id="4954498">id</span><span class="op" id="4954500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954504">builtinIdToType</span>&nbsp;<span class="op" id="4954520">=</span>&nbsp;<span class="builtinfunc" id="4954522">make</span><span class="op" id="4954526">(</span><span class="keyword" id="4954527">map</span><span class="op" id="4954530">[</span><span class="ident" id="4954531">typeId</span><span class="op" id="4954537">]</span><span class="ident" id="4954538">gobType</span><span class="op" id="4954545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954548">for</span>&nbsp;<span class="ident" id="4954552">k</span><span class="op" id="4954553">,</span>&nbsp;<span class="ident" id="4954555">v</span>&nbsp;<span class="op" id="4954557">:=</span>&nbsp;<span class="keyword" id="4954560">range</span>&nbsp;<span class="ident" id="4954566">idToType</span>&nbsp;<span class="op" id="4954575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954579">builtinIdToType</span><span class="op" id="4954594">[</span><span class="ident" id="4954595">k</span><span class="op" id="4954596">]</span>&nbsp;<span class="op" id="4954598">=</span>&nbsp;<span class="ident" id="4954600">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954607">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4954681">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4954718">if</span>&nbsp;<span class="ident" id="4954721">nextId</span>&nbsp;<span class="op" id="4954728">&gt;</span>&nbsp;<span class="ident" id="4954730">firstUserId</span>&nbsp;<span class="op" id="4954742">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4954746">panic</span><span class="op" id="4954751">(</span><span class="ident" id="4954752">fmt</span><span class="op" id="4954755">.</span><span class="ident" id="4954756">Sprintln</span><span class="op" id="4954764">(</span><span class="string" id="4954765">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="4954784">,</span>&nbsp;<span class="ident" id="4954786">nextId</span><span class="op" id="4954792">)</span><span class="op" id="4954793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4954796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954799">nextId</span>&nbsp;<span class="op" id="4954806">=</span>&nbsp;<span class="ident" id="4954808">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954821">registerBasics</span><span class="op" id="4954835">(</span><span class="op" id="4954836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954839">wireTypeUserInfo</span>&nbsp;<span class="op" id="4954856">=</span>&nbsp;<span class="ident" id="4954858">userType</span><span class="op" id="4954866">(</span><span class="ident" id="4954867">reflect</span><span class="op" id="4954874">.</span><span class="ident" id="4954875">TypeOf</span><span class="op" id="4954881">(</span><span class="op" id="4954882">(</span><span class="op" id="4954883">*</span><span class="ident" id="4954884">wireType</span><span class="op" id="4954892">)</span><span class="op" id="4954893">(</span><span class="ident" id="4954894">nil</span><span class="op" id="4954897">)</span><span class="op" id="4954898">)</span><span class="op" id="4954899">)</span><br>
<span class="lineno">295</span><span class="op" id="4954901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4954904">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4954918">type</span>&nbsp;<span class="ident" id="4954923">arrayType</span>&nbsp;<span class="keyword" id="4954933">struct</span>&nbsp;<span class="op" id="4954940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954943">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954955">Elem</span>&nbsp;<span class="ident" id="4954960">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4954968">Len</span>&nbsp;&nbsp;<span class="builtintype" id="4954973">int</span><br>
<span class="lineno"></span><span class="op" id="4954977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4954980">func</span>&nbsp;<span class="ident" id="4954985">newArrayType</span><span class="op" id="4954997">(</span><span class="ident" id="4954998">name</span>&nbsp;<span class="builtintype" id="4955003">string</span><span class="op" id="4955009">)</span>&nbsp;<span class="op" id="4955011">*</span><span class="ident" id="4955012">arrayType</span>&nbsp;<span class="op" id="4955022">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955025">a</span>&nbsp;<span class="op" id="4955027">:=</span>&nbsp;<span class="op" id="4955030">&amp;</span><span class="ident" id="4955031">arrayType</span><span class="op" id="4955040">{</span><span class="ident" id="4955041">CommonType</span><span class="op" id="4955051">{</span><span class="ident" id="4955052">Name</span><span class="op" id="4955056">:</span>&nbsp;<span class="ident" id="4955058">name</span><span class="op" id="4955062">}</span><span class="op" id="4955063">,</span>&nbsp;<span class="num" id="4955065">0</span><span class="op" id="4955066">,</span>&nbsp;<span class="num" id="4955068">0</span><span class="op" id="4955069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955072">return</span>&nbsp;<span class="ident" id="4955079">a</span><br>
<span class="lineno"></span><span class="op" id="4955081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955084">func</span>&nbsp;<span class="op" id="4955089">(</span><span class="ident" id="4955090">a</span>&nbsp;<span class="op" id="4955092">*</span><span class="ident" id="4955093">arrayType</span><span class="op" id="4955102">)</span>&nbsp;<span class="ident" id="4955104">init</span><span class="op" id="4955108">(</span><span class="ident" id="4955109">elem</span>&nbsp;<span class="ident" id="4955114">gobType</span><span class="op" id="4955121">,</span>&nbsp;<span class="builtinfunc" id="4955123">len</span>&nbsp;<span class="builtintype" id="4955127">int</span><span class="op" id="4955130">)</span>&nbsp;<span class="op" id="4955132">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4955135">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955210">setTypeId</span><span class="op" id="4955219">(</span><span class="ident" id="4955220">a</span><span class="op" id="4955221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955224">a</span><span class="op" id="4955225">.</span><span class="ident" id="4955226">Elem</span>&nbsp;<span class="op" id="4955231">=</span>&nbsp;<span class="ident" id="4955233">elem</span><span class="op" id="4955237">.</span><span class="ident" id="4955238">id</span><span class="op" id="4955240">(</span><span class="op" id="4955241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955244">a</span><span class="op" id="4955245">.</span><span class="ident" id="4955246">Len</span>&nbsp;<span class="op" id="4955250">=</span>&nbsp;<span class="builtinfunc" id="4955252">len</span><br>
<span class="lineno"></span><span class="op" id="4955256">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4955259">func</span>&nbsp;<span class="op" id="4955264">(</span><span class="ident" id="4955265">a</span>&nbsp;<span class="op" id="4955267">*</span><span class="ident" id="4955268">arrayType</span><span class="op" id="4955277">)</span>&nbsp;<span class="ident" id="4955279">safeString</span><span class="op" id="4955289">(</span><span class="ident" id="4955290">seen</span>&nbsp;<span class="keyword" id="4955295">map</span><span class="op" id="4955298">[</span><span class="ident" id="4955299">typeId</span><span class="op" id="4955305">]</span><span class="builtintype" id="4955306">bool</span><span class="op" id="4955310">)</span>&nbsp;<span class="builtintype" id="4955312">string</span>&nbsp;<span class="op" id="4955319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955322">if</span>&nbsp;<span class="ident" id="4955325">seen</span><span class="op" id="4955329">[</span><span class="ident" id="4955330">a</span><span class="op" id="4955331">.</span><span class="ident" id="4955332">Id</span><span class="op" id="4955334">]</span>&nbsp;<span class="op" id="4955336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955340">return</span>&nbsp;<span class="ident" id="4955347">a</span><span class="op" id="4955348">.</span><span class="ident" id="4955349">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4955355">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955358">seen</span><span class="op" id="4955362">[</span><span class="ident" id="4955363">a</span><span class="op" id="4955364">.</span><span class="ident" id="4955365">Id</span><span class="op" id="4955367">]</span>&nbsp;<span class="op" id="4955369">=</span>&nbsp;<span class="builtintype" id="4955371">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955377">return</span>&nbsp;<span class="ident" id="4955384">fmt</span><span class="op" id="4955387">.</span><span class="ident" id="4955388">Sprintf</span><span class="op" id="4955395">(</span><span class="string" id="4955396">&#34;[%d]%s&#34;</span><span class="op" id="4955404">,</span>&nbsp;<span class="ident" id="4955406">a</span><span class="op" id="4955407">.</span><span class="ident" id="4955408">Len</span><span class="op" id="4955411">,</span>&nbsp;<span class="ident" id="4955413">a</span><span class="op" id="4955414">.</span><span class="ident" id="4955415">Elem</span><span class="op" id="4955419">.</span><span class="ident" id="4955420">gobType</span><span class="op" id="4955427">(</span><span class="op" id="4955428">)</span><span class="op" id="4955429">.</span><span class="ident" id="4955430">safeString</span><span class="op" id="4955440">(</span><span class="ident" id="4955441">seen</span><span class="op" id="4955445">)</span><span class="op" id="4955446">)</span><br>
<span class="lineno"></span><span class="op" id="4955448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955451">func</span>&nbsp;<span class="op" id="4955456">(</span><span class="ident" id="4955457">a</span>&nbsp;<span class="op" id="4955459">*</span><span class="ident" id="4955460">arrayType</span><span class="op" id="4955469">)</span>&nbsp;<span class="builtintype" id="4955471">string</span><span class="op" id="4955477">(</span><span class="op" id="4955478">)</span>&nbsp;<span class="builtintype" id="4955480">string</span>&nbsp;<span class="op" id="4955487">{</span>&nbsp;<span class="keyword" id="4955489">return</span>&nbsp;<span class="ident" id="4955496">a</span><span class="op" id="4955497">.</span><span class="ident" id="4955498">safeString</span><span class="op" id="4955508">(</span><span class="builtinfunc" id="4955509">make</span><span class="op" id="4955513">(</span><span class="keyword" id="4955514">map</span><span class="op" id="4955517">[</span><span class="ident" id="4955518">typeId</span><span class="op" id="4955524">]</span><span class="builtintype" id="4955525">bool</span><span class="op" id="4955529">)</span><span class="op" id="4955530">)</span>&nbsp;<span class="op" id="4955532">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4955535">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="4955607">type</span>&nbsp;<span class="ident" id="4955612">gobEncoderType</span>&nbsp;<span class="keyword" id="4955627">struct</span>&nbsp;<span class="op" id="4955634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955637">CommonType</span><br>
<span class="lineno"></span><span class="op" id="4955648">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4955651">func</span>&nbsp;<span class="ident" id="4955656">newGobEncoderType</span><span class="op" id="4955673">(</span><span class="ident" id="4955674">name</span>&nbsp;<span class="builtintype" id="4955679">string</span><span class="op" id="4955685">)</span>&nbsp;<span class="op" id="4955687">*</span><span class="ident" id="4955688">gobEncoderType</span>&nbsp;<span class="op" id="4955703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955706">g</span>&nbsp;<span class="op" id="4955708">:=</span>&nbsp;<span class="op" id="4955711">&amp;</span><span class="ident" id="4955712">gobEncoderType</span><span class="op" id="4955726">{</span><span class="ident" id="4955727">CommonType</span><span class="op" id="4955737">{</span><span class="ident" id="4955738">Name</span><span class="op" id="4955742">:</span>&nbsp;<span class="ident" id="4955744">name</span><span class="op" id="4955748">}</span><span class="op" id="4955749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955752">setTypeId</span><span class="op" id="4955761">(</span><span class="ident" id="4955762">g</span><span class="op" id="4955763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955766">return</span>&nbsp;<span class="ident" id="4955773">g</span><br>
<span class="lineno">335</span><span class="op" id="4955775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4955778">func</span>&nbsp;<span class="op" id="4955783">(</span><span class="ident" id="4955784">g</span>&nbsp;<span class="op" id="4955786">*</span><span class="ident" id="4955787">gobEncoderType</span><span class="op" id="4955801">)</span>&nbsp;<span class="ident" id="4955803">safeString</span><span class="op" id="4955813">(</span><span class="ident" id="4955814">seen</span>&nbsp;<span class="keyword" id="4955819">map</span><span class="op" id="4955822">[</span><span class="ident" id="4955823">typeId</span><span class="op" id="4955829">]</span><span class="builtintype" id="4955830">bool</span><span class="op" id="4955834">)</span>&nbsp;<span class="builtintype" id="4955836">string</span>&nbsp;<span class="op" id="4955843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4955846">return</span>&nbsp;<span class="ident" id="4955853">g</span><span class="op" id="4955854">.</span><span class="ident" id="4955855">Name</span><br>
<span class="lineno"></span><span class="op" id="4955860">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="4955863">func</span>&nbsp;<span class="op" id="4955868">(</span><span class="ident" id="4955869">g</span>&nbsp;<span class="op" id="4955871">*</span><span class="ident" id="4955872">gobEncoderType</span><span class="op" id="4955886">)</span>&nbsp;<span class="builtintype" id="4955888">string</span><span class="op" id="4955894">(</span><span class="op" id="4955895">)</span>&nbsp;<span class="builtintype" id="4955897">string</span>&nbsp;<span class="op" id="4955904">{</span>&nbsp;<span class="keyword" id="4955906">return</span>&nbsp;<span class="ident" id="4955913">g</span><span class="op" id="4955914">.</span><span class="ident" id="4955915">Name</span>&nbsp;<span class="op" id="4955920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4955923">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4955935">type</span>&nbsp;<span class="ident" id="4955940">mapType</span>&nbsp;<span class="keyword" id="4955948">struct</span>&nbsp;<span class="op" id="4955955">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955958">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955970">Key</span>&nbsp;&nbsp;<span class="ident" id="4955975">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4955983">Elem</span>&nbsp;<span class="ident" id="4955988">typeId</span><br>
<span class="lineno"></span><span class="op" id="4955995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4955998">func</span>&nbsp;<span class="ident" id="4956003">newMapType</span><span class="op" id="4956013">(</span><span class="ident" id="4956014">name</span>&nbsp;<span class="builtintype" id="4956019">string</span><span class="op" id="4956025">)</span>&nbsp;<span class="op" id="4956027">*</span><span class="ident" id="4956028">mapType</span>&nbsp;<span class="op" id="4956036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956039">m</span>&nbsp;<span class="op" id="4956041">:=</span>&nbsp;<span class="op" id="4956044">&amp;</span><span class="ident" id="4956045">mapType</span><span class="op" id="4956052">{</span><span class="ident" id="4956053">CommonType</span><span class="op" id="4956063">{</span><span class="ident" id="4956064">Name</span><span class="op" id="4956068">:</span>&nbsp;<span class="ident" id="4956070">name</span><span class="op" id="4956074">}</span><span class="op" id="4956075">,</span>&nbsp;<span class="num" id="4956077">0</span><span class="op" id="4956078">,</span>&nbsp;<span class="num" id="4956080">0</span><span class="op" id="4956081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956084">return</span>&nbsp;<span class="ident" id="4956091">m</span><br>
<span class="lineno"></span><span class="op" id="4956093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="4956096">func</span>&nbsp;<span class="op" id="4956101">(</span><span class="ident" id="4956102">m</span>&nbsp;<span class="op" id="4956104">*</span><span class="ident" id="4956105">mapType</span><span class="op" id="4956112">)</span>&nbsp;<span class="ident" id="4956114">init</span><span class="op" id="4956118">(</span><span class="ident" id="4956119">key</span><span class="op" id="4956122">,</span>&nbsp;<span class="ident" id="4956124">elem</span>&nbsp;<span class="ident" id="4956129">gobType</span><span class="op" id="4956136">)</span>&nbsp;<span class="op" id="4956138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956141">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956216">setTypeId</span><span class="op" id="4956225">(</span><span class="ident" id="4956226">m</span><span class="op" id="4956227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956230">m</span><span class="op" id="4956231">.</span><span class="ident" id="4956232">Key</span>&nbsp;<span class="op" id="4956236">=</span>&nbsp;<span class="ident" id="4956238">key</span><span class="op" id="4956241">.</span><span class="ident" id="4956242">id</span><span class="op" id="4956244">(</span><span class="op" id="4956245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956248">m</span><span class="op" id="4956249">.</span><span class="ident" id="4956250">Elem</span>&nbsp;<span class="op" id="4956255">=</span>&nbsp;<span class="ident" id="4956257">elem</span><span class="op" id="4956261">.</span><span class="ident" id="4956262">id</span><span class="op" id="4956264">(</span><span class="op" id="4956265">)</span><br>
<span class="lineno">360</span><span class="op" id="4956267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4956270">func</span>&nbsp;<span class="op" id="4956275">(</span><span class="ident" id="4956276">m</span>&nbsp;<span class="op" id="4956278">*</span><span class="ident" id="4956279">mapType</span><span class="op" id="4956286">)</span>&nbsp;<span class="ident" id="4956288">safeString</span><span class="op" id="4956298">(</span><span class="ident" id="4956299">seen</span>&nbsp;<span class="keyword" id="4956304">map</span><span class="op" id="4956307">[</span><span class="ident" id="4956308">typeId</span><span class="op" id="4956314">]</span><span class="builtintype" id="4956315">bool</span><span class="op" id="4956319">)</span>&nbsp;<span class="builtintype" id="4956321">string</span>&nbsp;<span class="op" id="4956328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956331">if</span>&nbsp;<span class="ident" id="4956334">seen</span><span class="op" id="4956338">[</span><span class="ident" id="4956339">m</span><span class="op" id="4956340">.</span><span class="ident" id="4956341">Id</span><span class="op" id="4956343">]</span>&nbsp;<span class="op" id="4956345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956349">return</span>&nbsp;<span class="ident" id="4956356">m</span><span class="op" id="4956357">.</span><span class="ident" id="4956358">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4956364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956367">seen</span><span class="op" id="4956371">[</span><span class="ident" id="4956372">m</span><span class="op" id="4956373">.</span><span class="ident" id="4956374">Id</span><span class="op" id="4956376">]</span>&nbsp;<span class="op" id="4956378">=</span>&nbsp;<span class="builtintype" id="4956380">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956386">key</span>&nbsp;<span class="op" id="4956390">:=</span>&nbsp;<span class="ident" id="4956393">m</span><span class="op" id="4956394">.</span><span class="ident" id="4956395">Key</span><span class="op" id="4956398">.</span><span class="ident" id="4956399">gobType</span><span class="op" id="4956406">(</span><span class="op" id="4956407">)</span><span class="op" id="4956408">.</span><span class="ident" id="4956409">safeString</span><span class="op" id="4956419">(</span><span class="ident" id="4956420">seen</span><span class="op" id="4956424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956427">elem</span>&nbsp;<span class="op" id="4956432">:=</span>&nbsp;<span class="ident" id="4956435">m</span><span class="op" id="4956436">.</span><span class="ident" id="4956437">Elem</span><span class="op" id="4956441">.</span><span class="ident" id="4956442">gobType</span><span class="op" id="4956449">(</span><span class="op" id="4956450">)</span><span class="op" id="4956451">.</span><span class="ident" id="4956452">safeString</span><span class="op" id="4956462">(</span><span class="ident" id="4956463">seen</span><span class="op" id="4956467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956470">return</span>&nbsp;<span class="ident" id="4956477">fmt</span><span class="op" id="4956480">.</span><span class="ident" id="4956481">Sprintf</span><span class="op" id="4956488">(</span><span class="string" id="4956489">&#34;map[%s]%s&#34;</span><span class="op" id="4956500">,</span>&nbsp;<span class="ident" id="4956502">key</span><span class="op" id="4956505">,</span>&nbsp;<span class="ident" id="4956507">elem</span><span class="op" id="4956511">)</span><br>
<span class="lineno">370</span><span class="op" id="4956513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4956516">func</span>&nbsp;<span class="op" id="4956521">(</span><span class="ident" id="4956522">m</span>&nbsp;<span class="op" id="4956524">*</span><span class="ident" id="4956525">mapType</span><span class="op" id="4956532">)</span>&nbsp;<span class="builtintype" id="4956534">string</span><span class="op" id="4956540">(</span><span class="op" id="4956541">)</span>&nbsp;<span class="builtintype" id="4956543">string</span>&nbsp;<span class="op" id="4956550">{</span>&nbsp;<span class="keyword" id="4956552">return</span>&nbsp;<span class="ident" id="4956559">m</span><span class="op" id="4956560">.</span><span class="ident" id="4956561">safeString</span><span class="op" id="4956571">(</span><span class="builtinfunc" id="4956572">make</span><span class="op" id="4956576">(</span><span class="keyword" id="4956577">map</span><span class="op" id="4956580">[</span><span class="ident" id="4956581">typeId</span><span class="op" id="4956587">]</span><span class="builtintype" id="4956588">bool</span><span class="op" id="4956592">)</span><span class="op" id="4956593">)</span>&nbsp;<span class="op" id="4956595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4956598">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="4956612">type</span>&nbsp;<span class="ident" id="4956617">sliceType</span>&nbsp;<span class="keyword" id="4956627">struct</span>&nbsp;<span class="op" id="4956634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956637">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956649">Elem</span>&nbsp;<span class="ident" id="4956654">typeId</span><br>
<span class="lineno"></span><span class="op" id="4956661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4956664">func</span>&nbsp;<span class="ident" id="4956669">newSliceType</span><span class="op" id="4956681">(</span><span class="ident" id="4956682">name</span>&nbsp;<span class="builtintype" id="4956687">string</span><span class="op" id="4956693">)</span>&nbsp;<span class="op" id="4956695">*</span><span class="ident" id="4956696">sliceType</span>&nbsp;<span class="op" id="4956706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956709">s</span>&nbsp;<span class="op" id="4956711">:=</span>&nbsp;<span class="op" id="4956714">&amp;</span><span class="ident" id="4956715">sliceType</span><span class="op" id="4956724">{</span><span class="ident" id="4956725">CommonType</span><span class="op" id="4956735">{</span><span class="ident" id="4956736">Name</span><span class="op" id="4956740">:</span>&nbsp;<span class="ident" id="4956742">name</span><span class="op" id="4956746">}</span><span class="op" id="4956747">,</span>&nbsp;<span class="num" id="4956749">0</span><span class="op" id="4956750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956753">return</span>&nbsp;<span class="ident" id="4956760">s</span><br>
<span class="lineno"></span><span class="op" id="4956762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4956765">func</span>&nbsp;<span class="op" id="4956770">(</span><span class="ident" id="4956771">s</span>&nbsp;<span class="op" id="4956773">*</span><span class="ident" id="4956774">sliceType</span><span class="op" id="4956783">)</span>&nbsp;<span class="ident" id="4956785">init</span><span class="op" id="4956789">(</span><span class="ident" id="4956790">elem</span>&nbsp;<span class="ident" id="4956795">gobType</span><span class="op" id="4956802">)</span>&nbsp;<span class="op" id="4956804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956807">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4956882">setTypeId</span><span class="op" id="4956891">(</span><span class="ident" id="4956892">s</span><span class="op" id="4956893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956896">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4956961">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4956996">if</span>&nbsp;<span class="ident" id="4956999">elem</span><span class="op" id="4957003">.</span><span class="ident" id="4957004">id</span><span class="op" id="4957006">(</span><span class="op" id="4957007">)</span>&nbsp;<span class="op" id="4957009">==</span>&nbsp;<span class="num" id="4957012">0</span>&nbsp;<span class="op" id="4957014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957018">setTypeId</span><span class="op" id="4957027">(</span><span class="ident" id="4957028">elem</span><span class="op" id="4957032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957038">s</span><span class="op" id="4957039">.</span><span class="ident" id="4957040">Elem</span>&nbsp;<span class="op" id="4957045">=</span>&nbsp;<span class="ident" id="4957047">elem</span><span class="op" id="4957051">.</span><span class="ident" id="4957052">id</span><span class="op" id="4957054">(</span><span class="op" id="4957055">)</span><br>
<span class="lineno"></span><span class="op" id="4957057">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="4957060">func</span>&nbsp;<span class="op" id="4957065">(</span><span class="ident" id="4957066">s</span>&nbsp;<span class="op" id="4957068">*</span><span class="ident" id="4957069">sliceType</span><span class="op" id="4957078">)</span>&nbsp;<span class="ident" id="4957080">safeString</span><span class="op" id="4957090">(</span><span class="ident" id="4957091">seen</span>&nbsp;<span class="keyword" id="4957096">map</span><span class="op" id="4957099">[</span><span class="ident" id="4957100">typeId</span><span class="op" id="4957106">]</span><span class="builtintype" id="4957107">bool</span><span class="op" id="4957111">)</span>&nbsp;<span class="builtintype" id="4957113">string</span>&nbsp;<span class="op" id="4957120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957123">if</span>&nbsp;<span class="ident" id="4957126">seen</span><span class="op" id="4957130">[</span><span class="ident" id="4957131">s</span><span class="op" id="4957132">.</span><span class="ident" id="4957133">Id</span><span class="op" id="4957135">]</span>&nbsp;<span class="op" id="4957137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957141">return</span>&nbsp;<span class="ident" id="4957148">s</span><span class="op" id="4957149">.</span><span class="ident" id="4957150">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957156">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957159">seen</span><span class="op" id="4957163">[</span><span class="ident" id="4957164">s</span><span class="op" id="4957165">.</span><span class="ident" id="4957166">Id</span><span class="op" id="4957168">]</span>&nbsp;<span class="op" id="4957170">=</span>&nbsp;<span class="builtintype" id="4957172">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957178">return</span>&nbsp;<span class="ident" id="4957185">fmt</span><span class="op" id="4957188">.</span><span class="ident" id="4957189">Sprintf</span><span class="op" id="4957196">(</span><span class="string" id="4957197">&#34;[]%s&#34;</span><span class="op" id="4957203">,</span>&nbsp;<span class="ident" id="4957205">s</span><span class="op" id="4957206">.</span><span class="ident" id="4957207">Elem</span><span class="op" id="4957211">.</span><span class="ident" id="4957212">gobType</span><span class="op" id="4957219">(</span><span class="op" id="4957220">)</span><span class="op" id="4957221">.</span><span class="ident" id="4957222">safeString</span><span class="op" id="4957232">(</span><span class="ident" id="4957233">seen</span><span class="op" id="4957237">)</span><span class="op" id="4957238">)</span><br>
<span class="lineno"></span><span class="op" id="4957240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957243">func</span>&nbsp;<span class="op" id="4957248">(</span><span class="ident" id="4957249">s</span>&nbsp;<span class="op" id="4957251">*</span><span class="ident" id="4957252">sliceType</span><span class="op" id="4957261">)</span>&nbsp;<span class="builtintype" id="4957263">string</span><span class="op" id="4957269">(</span><span class="op" id="4957270">)</span>&nbsp;<span class="builtintype" id="4957272">string</span>&nbsp;<span class="op" id="4957279">{</span>&nbsp;<span class="keyword" id="4957281">return</span>&nbsp;<span class="ident" id="4957288">s</span><span class="op" id="4957289">.</span><span class="ident" id="4957290">safeString</span><span class="op" id="4957300">(</span><span class="builtinfunc" id="4957301">make</span><span class="op" id="4957305">(</span><span class="keyword" id="4957306">map</span><span class="op" id="4957309">[</span><span class="ident" id="4957310">typeId</span><span class="op" id="4957316">]</span><span class="builtintype" id="4957317">bool</span><span class="op" id="4957321">)</span><span class="op" id="4957322">)</span>&nbsp;<span class="op" id="4957324">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4957327">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4957342">type</span>&nbsp;<span class="ident" id="4957347">fieldType</span>&nbsp;<span class="keyword" id="4957357">struct</span>&nbsp;<span class="op" id="4957364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957367">Name</span>&nbsp;<span class="builtintype" id="4957372">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957380">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4957385">typeId</span><br>
<span class="lineno">410</span><span class="op" id="4957392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957395">type</span>&nbsp;<span class="ident" id="4957400">structType</span>&nbsp;<span class="keyword" id="4957411">struct</span>&nbsp;<span class="op" id="4957418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957421">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957433">Field</span>&nbsp;<span class="op" id="4957439">[</span><span class="op" id="4957440">]</span><span class="op" id="4957441">*</span><span class="ident" id="4957442">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="4957452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957455">func</span>&nbsp;<span class="op" id="4957460">(</span><span class="ident" id="4957461">s</span>&nbsp;<span class="op" id="4957463">*</span><span class="ident" id="4957464">structType</span><span class="op" id="4957474">)</span>&nbsp;<span class="ident" id="4957476">safeString</span><span class="op" id="4957486">(</span><span class="ident" id="4957487">seen</span>&nbsp;<span class="keyword" id="4957492">map</span><span class="op" id="4957495">[</span><span class="ident" id="4957496">typeId</span><span class="op" id="4957502">]</span><span class="builtintype" id="4957503">bool</span><span class="op" id="4957507">)</span>&nbsp;<span class="builtintype" id="4957509">string</span>&nbsp;<span class="op" id="4957516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957519">if</span>&nbsp;<span class="ident" id="4957522">s</span>&nbsp;<span class="op" id="4957524">==</span>&nbsp;<span class="ident" id="4957527">nil</span>&nbsp;<span class="op" id="4957531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957535">return</span>&nbsp;<span class="string" id="4957542">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957554">if</span>&nbsp;<span class="ident" id="4957557">_</span><span class="op" id="4957558">,</span>&nbsp;<span class="ident" id="4957560">ok</span>&nbsp;<span class="op" id="4957563">:=</span>&nbsp;<span class="ident" id="4957566">seen</span><span class="op" id="4957570">[</span><span class="ident" id="4957571">s</span><span class="op" id="4957572">.</span><span class="ident" id="4957573">Id</span><span class="op" id="4957575">]</span><span class="op" id="4957576">;</span>&nbsp;<span class="ident" id="4957578">ok</span>&nbsp;<span class="op" id="4957581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957585">return</span>&nbsp;<span class="ident" id="4957592">s</span><span class="op" id="4957593">.</span><span class="ident" id="4957594">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957603">seen</span><span class="op" id="4957607">[</span><span class="ident" id="4957608">s</span><span class="op" id="4957609">.</span><span class="ident" id="4957610">Id</span><span class="op" id="4957612">]</span>&nbsp;<span class="op" id="4957614">=</span>&nbsp;<span class="builtintype" id="4957616">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957622">str</span>&nbsp;<span class="op" id="4957626">:=</span>&nbsp;<span class="ident" id="4957629">s</span><span class="op" id="4957630">.</span><span class="ident" id="4957631">Name</span>&nbsp;<span class="op" id="4957636">+</span>&nbsp;<span class="string" id="4957638">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957654">for</span>&nbsp;<span class="ident" id="4957658">_</span><span class="op" id="4957659">,</span>&nbsp;<span class="ident" id="4957661">f</span>&nbsp;<span class="op" id="4957663">:=</span>&nbsp;<span class="keyword" id="4957666">range</span>&nbsp;<span class="ident" id="4957672">s</span><span class="op" id="4957673">.</span><span class="ident" id="4957674">Field</span>&nbsp;<span class="op" id="4957680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957684">str</span>&nbsp;<span class="op" id="4957688">+=</span>&nbsp;<span class="ident" id="4957691">fmt</span><span class="op" id="4957694">.</span><span class="ident" id="4957695">Sprintf</span><span class="op" id="4957702">(</span><span class="string" id="4957703">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="4957712">,</span>&nbsp;<span class="ident" id="4957714">f</span><span class="op" id="4957715">.</span><span class="ident" id="4957716">Name</span><span class="op" id="4957720">,</span>&nbsp;<span class="ident" id="4957722">f</span><span class="op" id="4957723">.</span><span class="ident" id="4957724">Id</span><span class="op" id="4957726">.</span><span class="ident" id="4957727">gobType</span><span class="op" id="4957734">(</span><span class="op" id="4957735">)</span><span class="op" id="4957736">.</span><span class="ident" id="4957737">safeString</span><span class="op" id="4957747">(</span><span class="ident" id="4957748">seen</span><span class="op" id="4957752">)</span><span class="op" id="4957753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4957756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957759">str</span>&nbsp;<span class="op" id="4957763">+=</span>&nbsp;<span class="string" id="4957766">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4957771">return</span>&nbsp;<span class="ident" id="4957778">str</span><br>
<span class="lineno"></span><span class="op" id="4957782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4957785">func</span>&nbsp;<span class="op" id="4957790">(</span><span class="ident" id="4957791">s</span>&nbsp;<span class="op" id="4957793">*</span><span class="ident" id="4957794">structType</span><span class="op" id="4957804">)</span>&nbsp;<span class="builtintype" id="4957806">string</span><span class="op" id="4957812">(</span><span class="op" id="4957813">)</span>&nbsp;<span class="builtintype" id="4957815">string</span>&nbsp;<span class="op" id="4957822">{</span>&nbsp;<span class="keyword" id="4957824">return</span>&nbsp;<span class="ident" id="4957831">s</span><span class="op" id="4957832">.</span><span class="ident" id="4957833">safeString</span><span class="op" id="4957843">(</span><span class="builtinfunc" id="4957844">make</span><span class="op" id="4957848">(</span><span class="keyword" id="4957849">map</span><span class="op" id="4957852">[</span><span class="ident" id="4957853">typeId</span><span class="op" id="4957859">]</span><span class="builtintype" id="4957860">bool</span><span class="op" id="4957864">)</span><span class="op" id="4957865">)</span>&nbsp;<span class="op" id="4957867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="4957870">func</span>&nbsp;<span class="ident" id="4957875">newStructType</span><span class="op" id="4957888">(</span><span class="ident" id="4957889">name</span>&nbsp;<span class="builtintype" id="4957894">string</span><span class="op" id="4957900">)</span>&nbsp;<span class="op" id="4957902">*</span><span class="ident" id="4957903">structType</span>&nbsp;<span class="op" id="4957914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4957917">s</span>&nbsp;<span class="op" id="4957919">:=</span>&nbsp;<span class="op" id="4957922">&amp;</span><span class="ident" id="4957923">structType</span><span class="op" id="4957933">{</span><span class="ident" id="4957934">CommonType</span><span class="op" id="4957944">{</span><span class="ident" id="4957945">Name</span><span class="op" id="4957949">:</span>&nbsp;<span class="ident" id="4957951">name</span><span class="op" id="4957955">}</span><span class="op" id="4957956">,</span>&nbsp;<span class="ident" id="4957958">nil</span><span class="op" id="4957961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4957964">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958028">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958078">setTypeId</span><span class="op" id="4958087">(</span><span class="ident" id="4958088">s</span><span class="op" id="4958089">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958092">return</span>&nbsp;<span class="ident" id="4958099">s</span><br>
<span class="lineno"></span><span class="op" id="4958101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4958104">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4958169">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="4958234">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="4958244">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="4958309">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="4958359">func</span>&nbsp;<span class="ident" id="4958364">newTypeObject</span><span class="op" id="4958377">(</span><span class="ident" id="4958378">name</span>&nbsp;<span class="builtintype" id="4958383">string</span><span class="op" id="4958389">,</span>&nbsp;<span class="ident" id="4958391">ut</span>&nbsp;<span class="op" id="4958394">*</span><span class="ident" id="4958395">userTypeInfo</span><span class="op" id="4958407">,</span>&nbsp;<span class="ident" id="4958409">rt</span>&nbsp;<span class="ident" id="4958412">reflect</span><span class="op" id="4958419">.</span><span class="ident" id="4958420">Type</span><span class="op" id="4958424">)</span>&nbsp;<span class="op" id="4958426">(</span><span class="ident" id="4958427">gobType</span><span class="op" id="4958434">,</span>&nbsp;<span class="builtintype" id="4958436">error</span><span class="op" id="4958441">)</span>&nbsp;<span class="op" id="4958443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958446">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958487">if</span>&nbsp;<span class="ident" id="4958490">ut</span><span class="op" id="4958492">.</span><span class="ident" id="4958493">externalEnc</span>&nbsp;<span class="op" id="4958505">!=</span>&nbsp;<span class="num" id="4958508">0</span>&nbsp;<span class="op" id="4958510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958514">return</span>&nbsp;<span class="ident" id="4958521">newGobEncoderType</span><span class="op" id="4958538">(</span><span class="ident" id="4958539">name</span><span class="op" id="4958543">)</span><span class="op" id="4958544">,</span>&nbsp;<span class="ident" id="4958546">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958554">var</span>&nbsp;<span class="ident" id="4958558">err</span>&nbsp;<span class="builtintype" id="4958562">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958569">var</span>&nbsp;<span class="ident" id="4958573">type0</span><span class="op" id="4958578">,</span>&nbsp;<span class="ident" id="4958580">type1</span>&nbsp;<span class="ident" id="4958586">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958595">defer</span>&nbsp;<span class="keyword" id="4958601">func</span><span class="op" id="4958605">(</span><span class="op" id="4958606">)</span>&nbsp;<span class="op" id="4958608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958612">if</span>&nbsp;<span class="ident" id="4958615">err</span>&nbsp;<span class="op" id="4958619">!=</span>&nbsp;<span class="ident" id="4958622">nil</span>&nbsp;<span class="op" id="4958626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4958631">delete</span><span class="op" id="4958637">(</span><span class="ident" id="4958638">types</span><span class="op" id="4958643">,</span>&nbsp;<span class="ident" id="4958645">rt</span><span class="op" id="4958647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958654">}</span><span class="op" id="4958655">(</span><span class="op" id="4958656">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958659">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958730">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958788">switch</span>&nbsp;<span class="ident" id="4958795">t</span>&nbsp;<span class="op" id="4958797">:=</span>&nbsp;<span class="ident" id="4958800">rt</span><span class="op" id="4958802">;</span>&nbsp;<span class="ident" id="4958804">t</span><span class="op" id="4958805">.</span><span class="ident" id="4958806">Kind</span><span class="op" id="4958810">(</span><span class="op" id="4958811">)</span>&nbsp;<span class="op" id="4958813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4958816">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958867">case</span>&nbsp;<span class="ident" id="4958872">reflect</span><span class="op" id="4958879">.</span><span class="ident" id="4958880">Bool</span><span class="op" id="4958884">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958888">return</span>&nbsp;<span class="ident" id="4958895">tBool</span><span class="op" id="4958900">.</span><span class="ident" id="4958901">gobType</span><span class="op" id="4958908">(</span><span class="op" id="4958909">)</span><span class="op" id="4958910">,</span>&nbsp;<span class="ident" id="4958912">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958918">case</span>&nbsp;<span class="ident" id="4958923">reflect</span><span class="op" id="4958930">.</span><span class="ident" id="4958931">Int</span><span class="op" id="4958934">,</span>&nbsp;<span class="ident" id="4958936">reflect</span><span class="op" id="4958943">.</span><span class="ident" id="4958944">Int8</span><span class="op" id="4958948">,</span>&nbsp;<span class="ident" id="4958950">reflect</span><span class="op" id="4958957">.</span><span class="ident" id="4958958">Int16</span><span class="op" id="4958963">,</span>&nbsp;<span class="ident" id="4958965">reflect</span><span class="op" id="4958972">.</span><span class="ident" id="4958973">Int32</span><span class="op" id="4958978">,</span>&nbsp;<span class="ident" id="4958980">reflect</span><span class="op" id="4958987">.</span><span class="ident" id="4958988">Int64</span><span class="op" id="4958993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958997">return</span>&nbsp;<span class="ident" id="4959004">tInt</span><span class="op" id="4959008">.</span><span class="ident" id="4959009">gobType</span><span class="op" id="4959016">(</span><span class="op" id="4959017">)</span><span class="op" id="4959018">,</span>&nbsp;<span class="ident" id="4959020">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959026">case</span>&nbsp;<span class="ident" id="4959031">reflect</span><span class="op" id="4959038">.</span><span class="ident" id="4959039">Uint</span><span class="op" id="4959043">,</span>&nbsp;<span class="ident" id="4959045">reflect</span><span class="op" id="4959052">.</span><span class="ident" id="4959053">Uint8</span><span class="op" id="4959058">,</span>&nbsp;<span class="ident" id="4959060">reflect</span><span class="op" id="4959067">.</span><span class="ident" id="4959068">Uint16</span><span class="op" id="4959074">,</span>&nbsp;<span class="ident" id="4959076">reflect</span><span class="op" id="4959083">.</span><span class="ident" id="4959084">Uint32</span><span class="op" id="4959090">,</span>&nbsp;<span class="ident" id="4959092">reflect</span><span class="op" id="4959099">.</span><span class="ident" id="4959100">Uint64</span><span class="op" id="4959106">,</span>&nbsp;<span class="ident" id="4959108">reflect</span><span class="op" id="4959115">.</span><span class="ident" id="4959116">Uintptr</span><span class="op" id="4959123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959127">return</span>&nbsp;<span class="ident" id="4959134">tUint</span><span class="op" id="4959139">.</span><span class="ident" id="4959140">gobType</span><span class="op" id="4959147">(</span><span class="op" id="4959148">)</span><span class="op" id="4959149">,</span>&nbsp;<span class="ident" id="4959151">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959157">case</span>&nbsp;<span class="ident" id="4959162">reflect</span><span class="op" id="4959169">.</span><span class="ident" id="4959170">Float32</span><span class="op" id="4959177">,</span>&nbsp;<span class="ident" id="4959179">reflect</span><span class="op" id="4959186">.</span><span class="ident" id="4959187">Float64</span><span class="op" id="4959194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959198">return</span>&nbsp;<span class="ident" id="4959205">tFloat</span><span class="op" id="4959211">.</span><span class="ident" id="4959212">gobType</span><span class="op" id="4959219">(</span><span class="op" id="4959220">)</span><span class="op" id="4959221">,</span>&nbsp;<span class="ident" id="4959223">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959229">case</span>&nbsp;<span class="ident" id="4959234">reflect</span><span class="op" id="4959241">.</span><span class="ident" id="4959242">Complex64</span><span class="op" id="4959251">,</span>&nbsp;<span class="ident" id="4959253">reflect</span><span class="op" id="4959260">.</span><span class="ident" id="4959261">Complex128</span><span class="op" id="4959271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959275">return</span>&nbsp;<span class="ident" id="4959282">tComplex</span><span class="op" id="4959290">.</span><span class="ident" id="4959291">gobType</span><span class="op" id="4959298">(</span><span class="op" id="4959299">)</span><span class="op" id="4959300">,</span>&nbsp;<span class="ident" id="4959302">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959308">case</span>&nbsp;<span class="ident" id="4959313">reflect</span><span class="op" id="4959320">.</span><span class="ident" id="4959321">String</span><span class="op" id="4959327">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959331">return</span>&nbsp;<span class="ident" id="4959338">tString</span><span class="op" id="4959345">.</span><span class="ident" id="4959346">gobType</span><span class="op" id="4959353">(</span><span class="op" id="4959354">)</span><span class="op" id="4959355">,</span>&nbsp;<span class="ident" id="4959357">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959363">case</span>&nbsp;<span class="ident" id="4959368">reflect</span><span class="op" id="4959375">.</span><span class="ident" id="4959376">Interface</span><span class="op" id="4959385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959389">return</span>&nbsp;<span class="ident" id="4959396">tInterface</span><span class="op" id="4959406">.</span><span class="ident" id="4959407">gobType</span><span class="op" id="4959414">(</span><span class="op" id="4959415">)</span><span class="op" id="4959416">,</span>&nbsp;<span class="ident" id="4959418">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959424">case</span>&nbsp;<span class="ident" id="4959429">reflect</span><span class="op" id="4959436">.</span><span class="ident" id="4959437">Array</span><span class="op" id="4959442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959446">at</span>&nbsp;<span class="op" id="4959449">:=</span>&nbsp;<span class="ident" id="4959452">newArrayType</span><span class="op" id="4959464">(</span><span class="ident" id="4959465">name</span><span class="op" id="4959469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959473">types</span><span class="op" id="4959478">[</span><span class="ident" id="4959479">rt</span><span class="op" id="4959481">]</span>&nbsp;<span class="op" id="4959483">=</span>&nbsp;<span class="ident" id="4959485">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959490">type0</span><span class="op" id="4959495">,</span>&nbsp;<span class="ident" id="4959497">err</span>&nbsp;<span class="op" id="4959501">=</span>&nbsp;<span class="ident" id="4959503">getBaseType</span><span class="op" id="4959514">(</span><span class="string" id="4959515">&#34;&#34;</span><span class="op" id="4959517">,</span>&nbsp;<span class="ident" id="4959519">t</span><span class="op" id="4959520">.</span><span class="ident" id="4959521">Elem</span><span class="op" id="4959525">(</span><span class="op" id="4959526">)</span><span class="op" id="4959527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959531">if</span>&nbsp;<span class="ident" id="4959534">err</span>&nbsp;<span class="op" id="4959538">!=</span>&nbsp;<span class="ident" id="4959541">nil</span>&nbsp;<span class="op" id="4959545">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959550">return</span>&nbsp;<span class="ident" id="4959557">nil</span><span class="op" id="4959560">,</span>&nbsp;<span class="ident" id="4959562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959572">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959595">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959668">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959746">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959816">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959888">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959959">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960026">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960082">at</span><span class="op" id="4960084">.</span><span class="ident" id="4960085">init</span><span class="op" id="4960089">(</span><span class="ident" id="4960090">type0</span><span class="op" id="4960095">,</span>&nbsp;<span class="ident" id="4960097">t</span><span class="op" id="4960098">.</span><span class="ident" id="4960099">Len</span><span class="op" id="4960102">(</span><span class="op" id="4960103">)</span><span class="op" id="4960104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960108">return</span>&nbsp;<span class="ident" id="4960115">at</span><span class="op" id="4960117">,</span>&nbsp;<span class="ident" id="4960119">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960125">case</span>&nbsp;<span class="ident" id="4960130">reflect</span><span class="op" id="4960137">.</span><span class="ident" id="4960138">Map</span><span class="op" id="4960141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960145">mt</span>&nbsp;<span class="op" id="4960148">:=</span>&nbsp;<span class="ident" id="4960151">newMapType</span><span class="op" id="4960161">(</span><span class="ident" id="4960162">name</span><span class="op" id="4960166">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960170">types</span><span class="op" id="4960175">[</span><span class="ident" id="4960176">rt</span><span class="op" id="4960178">]</span>&nbsp;<span class="op" id="4960180">=</span>&nbsp;<span class="ident" id="4960182">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960187">type0</span><span class="op" id="4960192">,</span>&nbsp;<span class="ident" id="4960194">err</span>&nbsp;<span class="op" id="4960198">=</span>&nbsp;<span class="ident" id="4960200">getBaseType</span><span class="op" id="4960211">(</span><span class="string" id="4960212">&#34;&#34;</span><span class="op" id="4960214">,</span>&nbsp;<span class="ident" id="4960216">t</span><span class="op" id="4960217">.</span><span class="ident" id="4960218">Key</span><span class="op" id="4960221">(</span><span class="op" id="4960222">)</span><span class="op" id="4960223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960227">if</span>&nbsp;<span class="ident" id="4960230">err</span>&nbsp;<span class="op" id="4960234">!=</span>&nbsp;<span class="ident" id="4960237">nil</span>&nbsp;<span class="op" id="4960241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960246">return</span>&nbsp;<span class="ident" id="4960253">nil</span><span class="op" id="4960256">,</span>&nbsp;<span class="ident" id="4960258">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960264">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960268">type1</span><span class="op" id="4960273">,</span>&nbsp;<span class="ident" id="4960275">err</span>&nbsp;<span class="op" id="4960279">=</span>&nbsp;<span class="ident" id="4960281">getBaseType</span><span class="op" id="4960292">(</span><span class="string" id="4960293">&#34;&#34;</span><span class="op" id="4960295">,</span>&nbsp;<span class="ident" id="4960297">t</span><span class="op" id="4960298">.</span><span class="ident" id="4960299">Elem</span><span class="op" id="4960303">(</span><span class="op" id="4960304">)</span><span class="op" id="4960305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960309">if</span>&nbsp;<span class="ident" id="4960312">err</span>&nbsp;<span class="op" id="4960316">!=</span>&nbsp;<span class="ident" id="4960319">nil</span>&nbsp;<span class="op" id="4960323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960328">return</span>&nbsp;<span class="ident" id="4960335">nil</span><span class="op" id="4960338">,</span>&nbsp;<span class="ident" id="4960340">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960350">mt</span><span class="op" id="4960352">.</span><span class="ident" id="4960353">init</span><span class="op" id="4960357">(</span><span class="ident" id="4960358">type0</span><span class="op" id="4960363">,</span>&nbsp;<span class="ident" id="4960365">type1</span><span class="op" id="4960370">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960374">return</span>&nbsp;<span class="ident" id="4960381">mt</span><span class="op" id="4960383">,</span>&nbsp;<span class="ident" id="4960385">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960391">case</span>&nbsp;<span class="ident" id="4960396">reflect</span><span class="op" id="4960403">.</span><span class="ident" id="4960404">Slice</span><span class="op" id="4960409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4960413">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960454">if</span>&nbsp;<span class="ident" id="4960457">t</span><span class="op" id="4960458">.</span><span class="ident" id="4960459">Elem</span><span class="op" id="4960463">(</span><span class="op" id="4960464">)</span><span class="op" id="4960465">.</span><span class="ident" id="4960466">Kind</span><span class="op" id="4960470">(</span><span class="op" id="4960471">)</span>&nbsp;<span class="op" id="4960473">==</span>&nbsp;<span class="ident" id="4960476">reflect</span><span class="op" id="4960483">.</span><span class="ident" id="4960484">Uint8</span>&nbsp;<span class="op" id="4960490">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960495">return</span>&nbsp;<span class="ident" id="4960502">tBytes</span><span class="op" id="4960508">.</span><span class="ident" id="4960509">gobType</span><span class="op" id="4960516">(</span><span class="op" id="4960517">)</span><span class="op" id="4960518">,</span>&nbsp;<span class="ident" id="4960520">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960530">st</span>&nbsp;<span class="op" id="4960533">:=</span>&nbsp;<span class="ident" id="4960536">newSliceType</span><span class="op" id="4960548">(</span><span class="ident" id="4960549">name</span><span class="op" id="4960553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960557">types</span><span class="op" id="4960562">[</span><span class="ident" id="4960563">rt</span><span class="op" id="4960565">]</span>&nbsp;<span class="op" id="4960567">=</span>&nbsp;<span class="ident" id="4960569">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960574">type0</span><span class="op" id="4960579">,</span>&nbsp;<span class="ident" id="4960581">err</span>&nbsp;<span class="op" id="4960585">=</span>&nbsp;<span class="ident" id="4960587">getBaseType</span><span class="op" id="4960598">(</span><span class="ident" id="4960599">t</span><span class="op" id="4960600">.</span><span class="ident" id="4960601">Elem</span><span class="op" id="4960605">(</span><span class="op" id="4960606">)</span><span class="op" id="4960607">.</span><span class="ident" id="4960608">Name</span><span class="op" id="4960612">(</span><span class="op" id="4960613">)</span><span class="op" id="4960614">,</span>&nbsp;<span class="ident" id="4960616">t</span><span class="op" id="4960617">.</span><span class="ident" id="4960618">Elem</span><span class="op" id="4960622">(</span><span class="op" id="4960623">)</span><span class="op" id="4960624">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960628">if</span>&nbsp;<span class="ident" id="4960631">err</span>&nbsp;<span class="op" id="4960635">!=</span>&nbsp;<span class="ident" id="4960638">nil</span>&nbsp;<span class="op" id="4960642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960647">return</span>&nbsp;<span class="ident" id="4960654">nil</span><span class="op" id="4960657">,</span>&nbsp;<span class="ident" id="4960659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960669">st</span><span class="op" id="4960671">.</span><span class="ident" id="4960672">init</span><span class="op" id="4960676">(</span><span class="ident" id="4960677">type0</span><span class="op" id="4960682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960686">return</span>&nbsp;<span class="ident" id="4960693">st</span><span class="op" id="4960695">,</span>&nbsp;<span class="ident" id="4960697">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960703">case</span>&nbsp;<span class="ident" id="4960708">reflect</span><span class="op" id="4960715">.</span><span class="ident" id="4960716">Struct</span><span class="op" id="4960722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960726">st</span>&nbsp;<span class="op" id="4960729">:=</span>&nbsp;<span class="ident" id="4960732">newStructType</span><span class="op" id="4960745">(</span><span class="ident" id="4960746">name</span><span class="op" id="4960750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960754">types</span><span class="op" id="4960759">[</span><span class="ident" id="4960760">rt</span><span class="op" id="4960762">]</span>&nbsp;<span class="op" id="4960764">=</span>&nbsp;<span class="ident" id="4960766">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960771">idToType</span><span class="op" id="4960779">[</span><span class="ident" id="4960780">st</span><span class="op" id="4960782">.</span><span class="ident" id="4960783">id</span><span class="op" id="4960785">(</span><span class="op" id="4960786">)</span><span class="op" id="4960787">]</span>&nbsp;<span class="op" id="4960789">=</span>&nbsp;<span class="ident" id="4960791">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960796">for</span>&nbsp;<span class="ident" id="4960800">i</span>&nbsp;<span class="op" id="4960802">:=</span>&nbsp;<span class="num" id="4960805">0</span><span class="op" id="4960806">;</span>&nbsp;<span class="ident" id="4960808">i</span>&nbsp;<span class="op" id="4960810">&lt;</span>&nbsp;<span class="ident" id="4960812">t</span><span class="op" id="4960813">.</span><span class="ident" id="4960814">NumField</span><span class="op" id="4960822">(</span><span class="op" id="4960823">)</span><span class="op" id="4960824">;</span>&nbsp;<span class="ident" id="4960826">i</span><span class="op" id="4960827">++</span>&nbsp;<span class="op" id="4960830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960835">f</span>&nbsp;<span class="op" id="4960837">:=</span>&nbsp;<span class="ident" id="4960840">t</span><span class="op" id="4960841">.</span><span class="ident" id="4960842">Field</span><span class="op" id="4960847">(</span><span class="ident" id="4960848">i</span><span class="op" id="4960849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960854">if</span>&nbsp;<span class="op" id="4960857">!</span><span class="ident" id="4960858">isSent</span><span class="op" id="4960864">(</span><span class="op" id="4960865">&amp;</span><span class="ident" id="4960866">f</span><span class="op" id="4960867">)</span>&nbsp;<span class="op" id="4960869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960875">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960887">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960892">typ</span>&nbsp;<span class="op" id="4960896">:=</span>&nbsp;<span class="ident" id="4960899">userType</span><span class="op" id="4960907">(</span><span class="ident" id="4960908">f</span><span class="op" id="4960909">.</span><span class="ident" id="4960910">Type</span><span class="op" id="4960914">)</span><span class="op" id="4960915">.</span><span class="ident" id="4960916">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960924">tname</span>&nbsp;<span class="op" id="4960930">:=</span>&nbsp;<span class="ident" id="4960933">typ</span><span class="op" id="4960936">.</span><span class="ident" id="4960937">Name</span><span class="op" id="4960941">(</span><span class="op" id="4960942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960947">if</span>&nbsp;<span class="ident" id="4960950">tname</span>&nbsp;<span class="op" id="4960956">==</span>&nbsp;<span class="string" id="4960959">&#34;&#34;</span>&nbsp;<span class="op" id="4960962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960968">t</span>&nbsp;<span class="op" id="4960970">:=</span>&nbsp;<span class="ident" id="4960973">userType</span><span class="op" id="4960981">(</span><span class="ident" id="4960982">f</span><span class="op" id="4960983">.</span><span class="ident" id="4960984">Type</span><span class="op" id="4960988">)</span><span class="op" id="4960989">.</span><span class="ident" id="4960990">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960999">tname</span>&nbsp;<span class="op" id="4961005">=</span>&nbsp;<span class="ident" id="4961007">t</span><span class="op" id="4961008">.</span><span class="ident" id="4961009">String</span><span class="op" id="4961015">(</span><span class="op" id="4961016">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961026">gt</span><span class="op" id="4961028">,</span>&nbsp;<span class="ident" id="4961030">err</span>&nbsp;<span class="op" id="4961034">:=</span>&nbsp;<span class="ident" id="4961037">getBaseType</span><span class="op" id="4961048">(</span><span class="ident" id="4961049">tname</span><span class="op" id="4961054">,</span>&nbsp;<span class="ident" id="4961056">f</span><span class="op" id="4961057">.</span><span class="ident" id="4961058">Type</span><span class="op" id="4961062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961067">if</span>&nbsp;<span class="ident" id="4961070">err</span>&nbsp;<span class="op" id="4961074">!=</span>&nbsp;<span class="ident" id="4961077">nil</span>&nbsp;<span class="op" id="4961081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961087">return</span>&nbsp;<span class="ident" id="4961094">nil</span><span class="op" id="4961097">,</span>&nbsp;<span class="ident" id="4961099">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961106">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4961111">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4961177">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4961241">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4961310">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961380">if</span>&nbsp;<span class="ident" id="4961383">gt</span><span class="op" id="4961385">.</span><span class="ident" id="4961386">id</span><span class="op" id="4961388">(</span><span class="op" id="4961389">)</span>&nbsp;<span class="op" id="4961391">==</span>&nbsp;<span class="num" id="4961394">0</span>&nbsp;<span class="op" id="4961396">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961402">setTypeId</span><span class="op" id="4961411">(</span><span class="ident" id="4961412">gt</span><span class="op" id="4961414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4961424">st</span><span class="op" id="4961426">.</span><span class="ident" id="4961427">Field</span>&nbsp;<span class="op" id="4961433">=</span>&nbsp;<span class="builtinfunc" id="4961435">append</span><span class="op" id="4961441">(</span><span class="ident" id="4961442">st</span><span class="op" id="4961444">.</span><span class="ident" id="4961445">Field</span><span class="op" id="4961450">,</span>&nbsp;<span class="op" id="4961452">&amp;</span><span class="ident" id="4961453">fieldType</span><span class="op" id="4961462">{</span><span class="ident" id="4961463">f</span><span class="op" id="4961464">.</span><span class="ident" id="4961465">Name</span><span class="op" id="4961469">,</span>&nbsp;<span class="ident" id="4961471">gt</span><span class="op" id="4961473">.</span><span class="ident" id="4961474">id</span><span class="op" id="4961476">(</span><span class="op" id="4961477">)</span><span class="op" id="4961478">}</span><span class="op" id="4961479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961487">return</span>&nbsp;<span class="ident" id="4961494">st</span><span class="op" id="4961496">,</span>&nbsp;<span class="ident" id="4961498">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961504">default</span><span class="op" id="4961511">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961515">return</span>&nbsp;<span class="ident" id="4961522">nil</span><span class="op" id="4961525">,</span>&nbsp;<span class="ident" id="4961527">errors</span><span class="op" id="4961533">.</span><span class="ident" id="4961534">New</span><span class="op" id="4961537">(</span><span class="string" id="4961538">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4961578">+</span>&nbsp;<span class="ident" id="4961580">rt</span><span class="op" id="4961582">.</span><span class="ident" id="4961583">String</span><span class="op" id="4961589">(</span><span class="op" id="4961590">)</span><span class="op" id="4961591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4961594">}</span><br>
<span class="lineno"></span><span class="op" id="4961596">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4961599">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4961670">func</span>&nbsp;<span class="ident" id="4961675">isExported</span><span class="op" id="4961685">(</span><span class="ident" id="4961686">name</span>&nbsp;<span class="builtintype" id="4961691">string</span><span class="op" id="4961697">)</span>&nbsp;<span class="builtintype" id="4961699">bool</span>&nbsp;<span class="op" id="4961704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4961707">rune</span><span class="op" id="4961711">,</span>&nbsp;<span class="ident" id="4961713">_</span>&nbsp;<span class="op" id="4961715">:=</span>&nbsp;<span class="ident" id="4961718">utf8</span><span class="op" id="4961722">.</span><span class="ident" id="4961723">DecodeRuneInString</span><span class="op" id="4961741">(</span><span class="ident" id="4961742">name</span><span class="op" id="4961746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4961749">return</span>&nbsp;<span class="ident" id="4961756">unicode</span><span class="op" id="4961763">.</span><span class="ident" id="4961764">IsUpper</span><span class="op" id="4961771">(</span><span class="builtintype" id="4961772">rune</span><span class="op" id="4961776">)</span><br>
<span class="lineno">570</span><span class="op" id="4961778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4961781">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="4961847">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4961925">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="4961956">func</span>&nbsp;<span class="ident" id="4961961">isSent</span><span class="op" id="4961967">(</span><span class="ident" id="4961968">field</span>&nbsp;<span class="op" id="4961974">*</span><span class="ident" id="4961975">reflect</span><span class="op" id="4961982">.</span><span class="ident" id="4961983">StructField</span><span class="op" id="4961994">)</span>&nbsp;<span class="builtintype" id="4961996">bool</span>&nbsp;<span class="op" id="4962001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962004">if</span>&nbsp;<span class="op" id="4962007">!</span><span class="ident" id="4962008">isExported</span><span class="op" id="4962018">(</span><span class="ident" id="4962019">field</span><span class="op" id="4962024">.</span><span class="ident" id="4962025">Name</span><span class="op" id="4962029">)</span>&nbsp;<span class="op" id="4962031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962035">return</span>&nbsp;<span class="builtintype" id="4962042">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962052">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4962122">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962170">typ</span>&nbsp;<span class="op" id="4962174">:=</span>&nbsp;<span class="ident" id="4962177">field</span><span class="op" id="4962182">.</span><span class="ident" id="4962183">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962189">for</span>&nbsp;<span class="ident" id="4962193">typ</span><span class="op" id="4962196">.</span><span class="ident" id="4962197">Kind</span><span class="op" id="4962201">(</span><span class="op" id="4962202">)</span>&nbsp;<span class="op" id="4962204">==</span>&nbsp;<span class="ident" id="4962207">reflect</span><span class="op" id="4962214">.</span><span class="ident" id="4962215">Ptr</span>&nbsp;<span class="op" id="4962219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962223">typ</span>&nbsp;<span class="op" id="4962227">=</span>&nbsp;<span class="ident" id="4962229">typ</span><span class="op" id="4962232">.</span><span class="ident" id="4962233">Elem</span><span class="op" id="4962237">(</span><span class="op" id="4962238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962241">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962244">if</span>&nbsp;<span class="ident" id="4962247">typ</span><span class="op" id="4962250">.</span><span class="ident" id="4962251">Kind</span><span class="op" id="4962255">(</span><span class="op" id="4962256">)</span>&nbsp;<span class="op" id="4962258">==</span>&nbsp;<span class="ident" id="4962261">reflect</span><span class="op" id="4962268">.</span><span class="ident" id="4962269">Chan</span>&nbsp;<span class="op" id="4962274">||</span>&nbsp;<span class="ident" id="4962277">typ</span><span class="op" id="4962280">.</span><span class="ident" id="4962281">Kind</span><span class="op" id="4962285">(</span><span class="op" id="4962286">)</span>&nbsp;<span class="op" id="4962288">==</span>&nbsp;<span class="ident" id="4962291">reflect</span><span class="op" id="4962298">.</span><span class="ident" id="4962299">Func</span>&nbsp;<span class="op" id="4962304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962308">return</span>&nbsp;<span class="builtintype" id="4962315">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962325">return</span>&nbsp;<span class="builtintype" id="4962332">true</span><br>
<span class="lineno"></span><span class="op" id="4962337">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="4962340">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4962423">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4962449">func</span>&nbsp;<span class="ident" id="4962454">getBaseType</span><span class="op" id="4962465">(</span><span class="ident" id="4962466">name</span>&nbsp;<span class="builtintype" id="4962471">string</span><span class="op" id="4962477">,</span>&nbsp;<span class="ident" id="4962479">rt</span>&nbsp;<span class="ident" id="4962482">reflect</span><span class="op" id="4962489">.</span><span class="ident" id="4962490">Type</span><span class="op" id="4962494">)</span>&nbsp;<span class="op" id="4962496">(</span><span class="ident" id="4962497">gobType</span><span class="op" id="4962504">,</span>&nbsp;<span class="builtintype" id="4962506">error</span><span class="op" id="4962511">)</span>&nbsp;<span class="op" id="4962513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962516">ut</span>&nbsp;<span class="op" id="4962519">:=</span>&nbsp;<span class="ident" id="4962522">userType</span><span class="op" id="4962530">(</span><span class="ident" id="4962531">rt</span><span class="op" id="4962533">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962536">return</span>&nbsp;<span class="ident" id="4962543">getType</span><span class="op" id="4962550">(</span><span class="ident" id="4962551">name</span><span class="op" id="4962555">,</span>&nbsp;<span class="ident" id="4962557">ut</span><span class="op" id="4962559">,</span>&nbsp;<span class="ident" id="4962561">ut</span><span class="op" id="4962563">.</span><span class="ident" id="4962564">base</span><span class="op" id="4962568">)</span><br>
<span class="lineno"></span><span class="op" id="4962570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4962573">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="4962640">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="4962701">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4962768">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="4962799">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4962825">func</span>&nbsp;<span class="ident" id="4962830">getType</span><span class="op" id="4962837">(</span><span class="ident" id="4962838">name</span>&nbsp;<span class="builtintype" id="4962843">string</span><span class="op" id="4962849">,</span>&nbsp;<span class="ident" id="4962851">ut</span>&nbsp;<span class="op" id="4962854">*</span><span class="ident" id="4962855">userTypeInfo</span><span class="op" id="4962867">,</span>&nbsp;<span class="ident" id="4962869">rt</span>&nbsp;<span class="ident" id="4962872">reflect</span><span class="op" id="4962879">.</span><span class="ident" id="4962880">Type</span><span class="op" id="4962884">)</span>&nbsp;<span class="op" id="4962886">(</span><span class="ident" id="4962887">gobType</span><span class="op" id="4962894">,</span>&nbsp;<span class="builtintype" id="4962896">error</span><span class="op" id="4962901">)</span>&nbsp;<span class="op" id="4962903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962906">typ</span><span class="op" id="4962909">,</span>&nbsp;<span class="ident" id="4962911">present</span>&nbsp;<span class="op" id="4962919">:=</span>&nbsp;<span class="ident" id="4962922">types</span><span class="op" id="4962927">[</span><span class="ident" id="4962928">rt</span><span class="op" id="4962930">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962933">if</span>&nbsp;<span class="ident" id="4962936">present</span>&nbsp;<span class="op" id="4962944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4962948">return</span>&nbsp;<span class="ident" id="4962955">typ</span><span class="op" id="4962958">,</span>&nbsp;<span class="ident" id="4962960">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4962965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4962968">typ</span><span class="op" id="4962971">,</span>&nbsp;<span class="ident" id="4962973">err</span>&nbsp;<span class="op" id="4962977">:=</span>&nbsp;<span class="ident" id="4962980">newTypeObject</span><span class="op" id="4962993">(</span><span class="ident" id="4962994">name</span><span class="op" id="4962998">,</span>&nbsp;<span class="ident" id="4963000">ut</span><span class="op" id="4963002">,</span>&nbsp;<span class="ident" id="4963004">rt</span><span class="op" id="4963006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963009">if</span>&nbsp;<span class="ident" id="4963012">err</span>&nbsp;<span class="op" id="4963016">==</span>&nbsp;<span class="ident" id="4963019">nil</span>&nbsp;<span class="op" id="4963023">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963027">types</span><span class="op" id="4963032">[</span><span class="ident" id="4963033">rt</span><span class="op" id="4963035">]</span>&nbsp;<span class="op" id="4963037">=</span>&nbsp;<span class="ident" id="4963039">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963047">return</span>&nbsp;<span class="ident" id="4963054">typ</span><span class="op" id="4963057">,</span>&nbsp;<span class="ident" id="4963059">err</span><br>
<span class="lineno"></span><span class="op" id="4963063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="4963066">func</span>&nbsp;<span class="ident" id="4963071">checkId</span><span class="op" id="4963078">(</span><span class="ident" id="4963079">want</span><span class="op" id="4963083">,</span>&nbsp;<span class="ident" id="4963085">got</span>&nbsp;<span class="ident" id="4963089">typeId</span><span class="op" id="4963095">)</span>&nbsp;<span class="op" id="4963097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963100">if</span>&nbsp;<span class="ident" id="4963103">want</span>&nbsp;<span class="op" id="4963108">!=</span>&nbsp;<span class="ident" id="4963111">got</span>&nbsp;<span class="op" id="4963115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963119">fmt</span><span class="op" id="4963122">.</span><span class="ident" id="4963123">Fprintf</span><span class="op" id="4963130">(</span><span class="ident" id="4963131">os</span><span class="op" id="4963133">.</span><span class="ident" id="4963134">Stderr</span><span class="op" id="4963140">,</span>&nbsp;<span class="string" id="4963142">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="4963170">,</span>&nbsp;<span class="builtintype" id="4963172">int</span><span class="op" id="4963175">(</span><span class="ident" id="4963176">got</span><span class="op" id="4963179">)</span><span class="op" id="4963180">,</span>&nbsp;<span class="builtintype" id="4963182">int</span><span class="op" id="4963185">(</span><span class="ident" id="4963186">want</span><span class="op" id="4963190">)</span><span class="op" id="4963191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4963195">panic</span><span class="op" id="4963200">(</span><span class="string" id="4963201">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="4963229">+</span>&nbsp;<span class="ident" id="4963231">got</span><span class="op" id="4963234">.</span><span class="ident" id="4963235">name</span><span class="op" id="4963239">(</span><span class="op" id="4963240">)</span>&nbsp;<span class="op" id="4963242">+</span>&nbsp;<span class="string" id="4963244">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4963248">+</span>&nbsp;<span class="ident" id="4963250">got</span><span class="op" id="4963253">.</span><span class="builtintype" id="4963254">string</span><span class="op" id="4963260">(</span><span class="op" id="4963261">)</span>&nbsp;<span class="op" id="4963263">+</span>&nbsp;<span class="string" id="4963265">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4963273">+</span>&nbsp;<span class="ident" id="4963275">want</span><span class="op" id="4963279">.</span><span class="builtintype" id="4963280">string</span><span class="op" id="4963286">(</span><span class="op" id="4963287">)</span><span class="op" id="4963288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963291">}</span><br>
<span class="lineno">620</span><span class="op" id="4963293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4963296">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4963373">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="4963414">func</span>&nbsp;<span class="ident" id="4963419">bootstrapType</span><span class="op" id="4963432">(</span><span class="ident" id="4963433">name</span>&nbsp;<span class="builtintype" id="4963438">string</span><span class="op" id="4963444">,</span>&nbsp;<span class="ident" id="4963446">e</span>&nbsp;<span class="keyword" id="4963448">interface</span><span class="op" id="4963457">{</span><span class="op" id="4963458">}</span><span class="op" id="4963459">,</span>&nbsp;<span class="ident" id="4963461">expect</span>&nbsp;<span class="ident" id="4963468">typeId</span><span class="op" id="4963474">)</span>&nbsp;<span class="ident" id="4963476">typeId</span>&nbsp;<span class="op" id="4963483">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963486">rt</span>&nbsp;<span class="op" id="4963489">:=</span>&nbsp;<span class="ident" id="4963492">reflect</span><span class="op" id="4963499">.</span><span class="ident" id="4963500">TypeOf</span><span class="op" id="4963506">(</span><span class="ident" id="4963507">e</span><span class="op" id="4963508">)</span><span class="op" id="4963509">.</span><span class="ident" id="4963510">Elem</span><span class="op" id="4963514">(</span><span class="op" id="4963515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963518">_</span><span class="op" id="4963519">,</span>&nbsp;<span class="ident" id="4963521">present</span>&nbsp;<span class="op" id="4963529">:=</span>&nbsp;<span class="ident" id="4963532">types</span><span class="op" id="4963537">[</span><span class="ident" id="4963538">rt</span><span class="op" id="4963540">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963543">if</span>&nbsp;<span class="ident" id="4963546">present</span>&nbsp;<span class="op" id="4963554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4963558">panic</span><span class="op" id="4963563">(</span><span class="string" id="4963564">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="4963599">+</span>&nbsp;<span class="ident" id="4963601">name</span>&nbsp;<span class="op" id="4963606">+</span>&nbsp;<span class="string" id="4963608">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="4963613">+</span>&nbsp;<span class="ident" id="4963615">rt</span><span class="op" id="4963617">.</span><span class="ident" id="4963618">String</span><span class="op" id="4963624">(</span><span class="op" id="4963625">)</span><span class="op" id="4963626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4963629">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963632">typ</span>&nbsp;<span class="op" id="4963636">:=</span>&nbsp;<span class="op" id="4963639">&amp;</span><span class="ident" id="4963640">CommonType</span><span class="op" id="4963650">{</span><span class="ident" id="4963651">Name</span><span class="op" id="4963655">:</span>&nbsp;<span class="ident" id="4963657">name</span><span class="op" id="4963661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963664">types</span><span class="op" id="4963669">[</span><span class="ident" id="4963670">rt</span><span class="op" id="4963672">]</span>&nbsp;<span class="op" id="4963674">=</span>&nbsp;<span class="ident" id="4963676">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963681">setTypeId</span><span class="op" id="4963690">(</span><span class="ident" id="4963691">typ</span><span class="op" id="4963694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963697">checkId</span><span class="op" id="4963704">(</span><span class="ident" id="4963705">expect</span><span class="op" id="4963711">,</span>&nbsp;<span class="ident" id="4963713">nextId</span><span class="op" id="4963719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4963722">userType</span><span class="op" id="4963730">(</span><span class="ident" id="4963731">rt</span><span class="op" id="4963733">)</span>&nbsp;<span class="comment" id="4963735">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4963766">return</span>&nbsp;<span class="ident" id="4963773">nextId</span><br>
<span class="lineno"></span><span class="op" id="4963780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4963783">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4963857">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="4963931">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="4964005">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="4964025">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="4964095">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="4964172">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="4964246">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="4964318">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4964363">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="4964436">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="4964460">type</span>&nbsp;<span class="ident" id="4964465">wireType</span>&nbsp;<span class="keyword" id="4964474">struct</span>&nbsp;<span class="op" id="4964481">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964484">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964501">*</span><span class="ident" id="4964502">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964513">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964530">*</span><span class="ident" id="4964531">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964542">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964559">*</span><span class="ident" id="4964560">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964572">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964589">*</span><span class="ident" id="4964590">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964599">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4964616">*</span><span class="ident" id="4964617">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964633">BinaryMarshalerT</span>&nbsp;<span class="op" id="4964650">*</span><span class="ident" id="4964651">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4964667">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4964684">*</span><span class="ident" id="4964685">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="4964700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4964703">func</span>&nbsp;<span class="op" id="4964708">(</span><span class="ident" id="4964709">w</span>&nbsp;<span class="op" id="4964711">*</span><span class="ident" id="4964712">wireType</span><span class="op" id="4964720">)</span>&nbsp;<span class="builtintype" id="4964722">string</span><span class="op" id="4964728">(</span><span class="op" id="4964729">)</span>&nbsp;<span class="builtintype" id="4964731">string</span>&nbsp;<span class="op" id="4964738">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964741">const</span>&nbsp;<span class="ident" id="4964747">unknown</span>&nbsp;<span class="op" id="4964755">=</span>&nbsp;<span class="string" id="4964757">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964773">if</span>&nbsp;<span class="ident" id="4964776">w</span>&nbsp;<span class="op" id="4964778">==</span>&nbsp;<span class="ident" id="4964781">nil</span>&nbsp;<span class="op" id="4964785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964789">return</span>&nbsp;<span class="ident" id="4964796">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4964805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964808">switch</span>&nbsp;<span class="op" id="4964815">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964818">case</span>&nbsp;<span class="ident" id="4964823">w</span><span class="op" id="4964824">.</span><span class="ident" id="4964825">ArrayT</span>&nbsp;<span class="op" id="4964832">!=</span>&nbsp;<span class="ident" id="4964835">nil</span><span class="op" id="4964838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964842">return</span>&nbsp;<span class="ident" id="4964849">w</span><span class="op" id="4964850">.</span><span class="ident" id="4964851">ArrayT</span><span class="op" id="4964857">.</span><span class="ident" id="4964858">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964864">case</span>&nbsp;<span class="ident" id="4964869">w</span><span class="op" id="4964870">.</span><span class="ident" id="4964871">SliceT</span>&nbsp;<span class="op" id="4964878">!=</span>&nbsp;<span class="ident" id="4964881">nil</span><span class="op" id="4964884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964888">return</span>&nbsp;<span class="ident" id="4964895">w</span><span class="op" id="4964896">.</span><span class="ident" id="4964897">SliceT</span><span class="op" id="4964903">.</span><span class="ident" id="4964904">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964910">case</span>&nbsp;<span class="ident" id="4964915">w</span><span class="op" id="4964916">.</span><span class="ident" id="4964917">StructT</span>&nbsp;<span class="op" id="4964925">!=</span>&nbsp;<span class="ident" id="4964928">nil</span><span class="op" id="4964931">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964935">return</span>&nbsp;<span class="ident" id="4964942">w</span><span class="op" id="4964943">.</span><span class="ident" id="4964944">StructT</span><span class="op" id="4964951">.</span><span class="ident" id="4964952">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964958">case</span>&nbsp;<span class="ident" id="4964963">w</span><span class="op" id="4964964">.</span><span class="ident" id="4964965">MapT</span>&nbsp;<span class="op" id="4964970">!=</span>&nbsp;<span class="ident" id="4964973">nil</span><span class="op" id="4964976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4964980">return</span>&nbsp;<span class="ident" id="4964987">w</span><span class="op" id="4964988">.</span><span class="ident" id="4964989">MapT</span><span class="op" id="4964993">.</span><span class="ident" id="4964994">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965000">case</span>&nbsp;<span class="ident" id="4965005">w</span><span class="op" id="4965006">.</span><span class="ident" id="4965007">GobEncoderT</span>&nbsp;<span class="op" id="4965019">!=</span>&nbsp;<span class="ident" id="4965022">nil</span><span class="op" id="4965025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965029">return</span>&nbsp;<span class="ident" id="4965036">w</span><span class="op" id="4965037">.</span><span class="ident" id="4965038">GobEncoderT</span><span class="op" id="4965049">.</span><span class="ident" id="4965050">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965056">case</span>&nbsp;<span class="ident" id="4965061">w</span><span class="op" id="4965062">.</span><span class="ident" id="4965063">BinaryMarshalerT</span>&nbsp;<span class="op" id="4965080">!=</span>&nbsp;<span class="ident" id="4965083">nil</span><span class="op" id="4965086">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965090">return</span>&nbsp;<span class="ident" id="4965097">w</span><span class="op" id="4965098">.</span><span class="ident" id="4965099">BinaryMarshalerT</span><span class="op" id="4965115">.</span><span class="ident" id="4965116">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965122">case</span>&nbsp;<span class="ident" id="4965127">w</span><span class="op" id="4965128">.</span><span class="ident" id="4965129">TextMarshalerT</span>&nbsp;<span class="op" id="4965144">!=</span>&nbsp;<span class="ident" id="4965147">nil</span><span class="op" id="4965150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965154">return</span>&nbsp;<span class="ident" id="4965161">w</span><span class="op" id="4965162">.</span><span class="ident" id="4965163">TextMarshalerT</span><span class="op" id="4965177">.</span><span class="ident" id="4965178">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4965184">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965187">return</span>&nbsp;<span class="ident" id="4965194">unknown</span><br>
<span class="lineno"></span><span class="op" id="4965202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4965205">type</span>&nbsp;<span class="ident" id="4965210">typeInfo</span>&nbsp;<span class="keyword" id="4965219">struct</span>&nbsp;<span class="op" id="4965226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965229">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4965237">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965245">encInit</span>&nbsp;<span class="ident" id="4965253">sync</span><span class="op" id="4965257">.</span><span class="ident" id="4965258">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4965266">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965299">encoder</span>&nbsp;<span class="ident" id="4965307">atomic</span><span class="op" id="4965313">.</span><span class="ident" id="4965314">Value</span>&nbsp;<span class="comment" id="4965320">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965335">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4965343">*</span><span class="ident" id="4965344">wireType</span><br>
<span class="lineno"></span><span class="op" id="4965353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="4965356">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="4965423">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="4965485">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4965555">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4965625">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="4965697">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="4965722">var</span>&nbsp;<span class="ident" id="4965726">typeInfoMap</span>&nbsp;<span class="ident" id="4965738">atomic</span><span class="op" id="4965744">.</span><span class="ident" id="4965745">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4965752">func</span>&nbsp;<span class="ident" id="4965757">lookupTypeInfo</span><span class="op" id="4965771">(</span><span class="ident" id="4965772">rt</span>&nbsp;<span class="ident" id="4965775">reflect</span><span class="op" id="4965782">.</span><span class="ident" id="4965783">Type</span><span class="op" id="4965787">)</span>&nbsp;<span class="op" id="4965789">*</span><span class="ident" id="4965790">typeInfo</span>&nbsp;<span class="op" id="4965799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965802">m</span><span class="op" id="4965803">,</span>&nbsp;<span class="ident" id="4965805">_</span>&nbsp;<span class="op" id="4965807">:=</span>&nbsp;<span class="ident" id="4965810">typeInfoMap</span><span class="op" id="4965821">.</span><span class="ident" id="4965822">Load</span><span class="op" id="4965826">(</span><span class="op" id="4965827">)</span><span class="op" id="4965828">.</span><span class="op" id="4965829">(</span><span class="keyword" id="4965830">map</span><span class="op" id="4965833">[</span><span class="ident" id="4965834">reflect</span><span class="op" id="4965841">.</span><span class="ident" id="4965842">Type</span><span class="op" id="4965846">]</span><span class="op" id="4965847">*</span><span class="ident" id="4965848">typeInfo</span><span class="op" id="4965856">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965859">return</span>&nbsp;<span class="ident" id="4965866">m</span><span class="op" id="4965867">[</span><span class="ident" id="4965868">rt</span><span class="op" id="4965870">]</span><br>
<span class="lineno"></span><span class="op" id="4965872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4965875">func</span>&nbsp;<span class="ident" id="4965880">getTypeInfo</span><span class="op" id="4965891">(</span><span class="ident" id="4965892">ut</span>&nbsp;<span class="op" id="4965895">*</span><span class="ident" id="4965896">userTypeInfo</span><span class="op" id="4965908">)</span>&nbsp;<span class="op" id="4965910">(</span><span class="op" id="4965911">*</span><span class="ident" id="4965912">typeInfo</span><span class="op" id="4965920">,</span>&nbsp;<span class="builtintype" id="4965922">error</span><span class="op" id="4965927">)</span>&nbsp;<span class="op" id="4965929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4965932">rt</span>&nbsp;<span class="op" id="4965935">:=</span>&nbsp;<span class="ident" id="4965938">ut</span><span class="op" id="4965940">.</span><span class="ident" id="4965941">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4965947">if</span>&nbsp;<span class="ident" id="4965950">ut</span><span class="op" id="4965952">.</span><span class="ident" id="4965953">externalEnc</span>&nbsp;<span class="op" id="4965965">!=</span>&nbsp;<span class="num" id="4965968">0</span>&nbsp;<span class="op" id="4965970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4965974">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966021">rt</span>&nbsp;<span class="op" id="4966024">=</span>&nbsp;<span class="ident" id="4966026">ut</span><span class="op" id="4966028">.</span><span class="ident" id="4966029">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966038">if</span>&nbsp;<span class="ident" id="4966041">info</span>&nbsp;<span class="op" id="4966046">:=</span>&nbsp;<span class="ident" id="4966049">lookupTypeInfo</span><span class="op" id="4966063">(</span><span class="ident" id="4966064">rt</span><span class="op" id="4966066">)</span><span class="op" id="4966067">;</span>&nbsp;<span class="ident" id="4966069">info</span>&nbsp;<span class="op" id="4966074">!=</span>&nbsp;<span class="ident" id="4966077">nil</span>&nbsp;<span class="op" id="4966081">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966085">return</span>&nbsp;<span class="ident" id="4966092">info</span><span class="op" id="4966096">,</span>&nbsp;<span class="ident" id="4966098">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966106">return</span>&nbsp;<span class="ident" id="4966113">buildTypeInfo</span><span class="op" id="4966126">(</span><span class="ident" id="4966127">ut</span><span class="op" id="4966129">,</span>&nbsp;<span class="ident" id="4966131">rt</span><span class="op" id="4966133">)</span><br>
<span class="lineno"></span><span class="op" id="4966135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="4966138">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4966200">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="4966239">func</span>&nbsp;<span class="ident" id="4966244">buildTypeInfo</span><span class="op" id="4966257">(</span><span class="ident" id="4966258">ut</span>&nbsp;<span class="op" id="4966261">*</span><span class="ident" id="4966262">userTypeInfo</span><span class="op" id="4966274">,</span>&nbsp;<span class="ident" id="4966276">rt</span>&nbsp;<span class="ident" id="4966279">reflect</span><span class="op" id="4966286">.</span><span class="ident" id="4966287">Type</span><span class="op" id="4966291">)</span>&nbsp;<span class="op" id="4966293">(</span><span class="op" id="4966294">*</span><span class="ident" id="4966295">typeInfo</span><span class="op" id="4966303">,</span>&nbsp;<span class="builtintype" id="4966305">error</span><span class="op" id="4966310">)</span>&nbsp;<span class="op" id="4966312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966315">typeLock</span><span class="op" id="4966323">.</span><span class="ident" id="4966324">Lock</span><span class="op" id="4966328">(</span><span class="op" id="4966329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966332">defer</span>&nbsp;<span class="ident" id="4966338">typeLock</span><span class="op" id="4966346">.</span><span class="ident" id="4966347">Unlock</span><span class="op" id="4966353">(</span><span class="op" id="4966354">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966358">if</span>&nbsp;<span class="ident" id="4966361">info</span>&nbsp;<span class="op" id="4966366">:=</span>&nbsp;<span class="ident" id="4966369">lookupTypeInfo</span><span class="op" id="4966383">(</span><span class="ident" id="4966384">rt</span><span class="op" id="4966386">)</span><span class="op" id="4966387">;</span>&nbsp;<span class="ident" id="4966389">info</span>&nbsp;<span class="op" id="4966394">!=</span>&nbsp;<span class="ident" id="4966397">nil</span>&nbsp;<span class="op" id="4966401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966405">return</span>&nbsp;<span class="ident" id="4966412">info</span><span class="op" id="4966416">,</span>&nbsp;<span class="ident" id="4966418">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966427">gt</span><span class="op" id="4966429">,</span>&nbsp;<span class="ident" id="4966431">err</span>&nbsp;<span class="op" id="4966435">:=</span>&nbsp;<span class="ident" id="4966438">getBaseType</span><span class="op" id="4966449">(</span><span class="ident" id="4966450">rt</span><span class="op" id="4966452">.</span><span class="ident" id="4966453">Name</span><span class="op" id="4966457">(</span><span class="op" id="4966458">)</span><span class="op" id="4966459">,</span>&nbsp;<span class="ident" id="4966461">rt</span><span class="op" id="4966463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966466">if</span>&nbsp;<span class="ident" id="4966469">err</span>&nbsp;<span class="op" id="4966473">!=</span>&nbsp;<span class="ident" id="4966476">nil</span>&nbsp;<span class="op" id="4966480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966484">return</span>&nbsp;<span class="ident" id="4966491">nil</span><span class="op" id="4966494">,</span>&nbsp;<span class="ident" id="4966496">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966504">info</span>&nbsp;<span class="op" id="4966509">:=</span>&nbsp;<span class="op" id="4966512">&amp;</span><span class="ident" id="4966513">typeInfo</span><span class="op" id="4966521">{</span><span class="ident" id="4966522">id</span><span class="op" id="4966524">:</span>&nbsp;<span class="ident" id="4966526">gt</span><span class="op" id="4966528">.</span><span class="ident" id="4966529">id</span><span class="op" id="4966531">(</span><span class="op" id="4966532">)</span><span class="op" id="4966533">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966537">if</span>&nbsp;<span class="ident" id="4966540">ut</span><span class="op" id="4966542">.</span><span class="ident" id="4966543">externalEnc</span>&nbsp;<span class="op" id="4966555">!=</span>&nbsp;<span class="num" id="4966558">0</span>&nbsp;<span class="op" id="4966560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966564">userType</span><span class="op" id="4966572">,</span>&nbsp;<span class="ident" id="4966574">err</span>&nbsp;<span class="op" id="4966578">:=</span>&nbsp;<span class="ident" id="4966581">getType</span><span class="op" id="4966588">(</span><span class="ident" id="4966589">rt</span><span class="op" id="4966591">.</span><span class="ident" id="4966592">Name</span><span class="op" id="4966596">(</span><span class="op" id="4966597">)</span><span class="op" id="4966598">,</span>&nbsp;<span class="ident" id="4966600">ut</span><span class="op" id="4966602">,</span>&nbsp;<span class="ident" id="4966604">rt</span><span class="op" id="4966606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966610">if</span>&nbsp;<span class="ident" id="4966613">err</span>&nbsp;<span class="op" id="4966617">!=</span>&nbsp;<span class="ident" id="4966620">nil</span>&nbsp;<span class="op" id="4966624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966629">return</span>&nbsp;<span class="ident" id="4966636">nil</span><span class="op" id="4966639">,</span>&nbsp;<span class="ident" id="4966641">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966651">gt</span>&nbsp;<span class="op" id="4966654">:=</span>&nbsp;<span class="ident" id="4966657">userType</span><span class="op" id="4966665">.</span><span class="ident" id="4966666">id</span><span class="op" id="4966668">(</span><span class="op" id="4966669">)</span><span class="op" id="4966670">.</span><span class="ident" id="4966671">gobType</span><span class="op" id="4966678">(</span><span class="op" id="4966679">)</span><span class="op" id="4966680">.</span><span class="op" id="4966681">(</span><span class="op" id="4966682">*</span><span class="ident" id="4966683">gobEncoderType</span><span class="op" id="4966697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966701">switch</span>&nbsp;<span class="ident" id="4966708">ut</span><span class="op" id="4966710">.</span><span class="ident" id="4966711">externalEnc</span>&nbsp;<span class="op" id="4966723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966727">case</span>&nbsp;<span class="ident" id="4966732">xGob</span><span class="op" id="4966736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966741">info</span><span class="op" id="4966745">.</span><span class="ident" id="4966746">wire</span>&nbsp;<span class="op" id="4966751">=</span>&nbsp;<span class="op" id="4966753">&amp;</span><span class="ident" id="4966754">wireType</span><span class="op" id="4966762">{</span><span class="ident" id="4966763">GobEncoderT</span><span class="op" id="4966774">:</span>&nbsp;<span class="ident" id="4966776">gt</span><span class="op" id="4966778">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966782">case</span>&nbsp;<span class="ident" id="4966787">xBinary</span><span class="op" id="4966794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966799">info</span><span class="op" id="4966803">.</span><span class="ident" id="4966804">wire</span>&nbsp;<span class="op" id="4966809">=</span>&nbsp;<span class="op" id="4966811">&amp;</span><span class="ident" id="4966812">wireType</span><span class="op" id="4966820">{</span><span class="ident" id="4966821">BinaryMarshalerT</span><span class="op" id="4966837">:</span>&nbsp;<span class="ident" id="4966839">gt</span><span class="op" id="4966841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966845">case</span>&nbsp;<span class="ident" id="4966850">xText</span><span class="op" id="4966855">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966860">info</span><span class="op" id="4966864">.</span><span class="ident" id="4966865">wire</span>&nbsp;<span class="op" id="4966870">=</span>&nbsp;<span class="op" id="4966872">&amp;</span><span class="ident" id="4966873">wireType</span><span class="op" id="4966881">{</span><span class="ident" id="4966882">TextMarshalerT</span><span class="op" id="4966896">:</span>&nbsp;<span class="ident" id="4966898">gt</span><span class="op" id="4966900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966904">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966908">rt</span>&nbsp;<span class="op" id="4966911">=</span>&nbsp;<span class="ident" id="4966913">ut</span><span class="op" id="4966915">.</span><span class="ident" id="4966916">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4966922">}</span>&nbsp;<span class="keyword" id="4966924">else</span>&nbsp;<span class="op" id="4966929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4966933">t</span>&nbsp;<span class="op" id="4966935">:=</span>&nbsp;<span class="ident" id="4966938">info</span><span class="op" id="4966942">.</span><span class="ident" id="4966943">id</span><span class="op" id="4966945">.</span><span class="ident" id="4966946">gobType</span><span class="op" id="4966953">(</span><span class="op" id="4966954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966958">switch</span>&nbsp;<span class="ident" id="4966965">typ</span>&nbsp;<span class="op" id="4966969">:=</span>&nbsp;<span class="ident" id="4966972">rt</span><span class="op" id="4966974">;</span>&nbsp;<span class="ident" id="4966976">typ</span><span class="op" id="4966979">.</span><span class="ident" id="4966980">Kind</span><span class="op" id="4966984">(</span><span class="op" id="4966985">)</span>&nbsp;<span class="op" id="4966987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4966991">case</span>&nbsp;<span class="ident" id="4966996">reflect</span><span class="op" id="4967003">.</span><span class="ident" id="4967004">Array</span><span class="op" id="4967009">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967014">info</span><span class="op" id="4967018">.</span><span class="ident" id="4967019">wire</span>&nbsp;<span class="op" id="4967024">=</span>&nbsp;<span class="op" id="4967026">&amp;</span><span class="ident" id="4967027">wireType</span><span class="op" id="4967035">{</span><span class="ident" id="4967036">ArrayT</span><span class="op" id="4967042">:</span>&nbsp;<span class="ident" id="4967044">t</span><span class="op" id="4967045">.</span><span class="op" id="4967046">(</span><span class="op" id="4967047">*</span><span class="ident" id="4967048">arrayType</span><span class="op" id="4967057">)</span><span class="op" id="4967058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967062">case</span>&nbsp;<span class="ident" id="4967067">reflect</span><span class="op" id="4967074">.</span><span class="ident" id="4967075">Map</span><span class="op" id="4967078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967083">info</span><span class="op" id="4967087">.</span><span class="ident" id="4967088">wire</span>&nbsp;<span class="op" id="4967093">=</span>&nbsp;<span class="op" id="4967095">&amp;</span><span class="ident" id="4967096">wireType</span><span class="op" id="4967104">{</span><span class="ident" id="4967105">MapT</span><span class="op" id="4967109">:</span>&nbsp;<span class="ident" id="4967111">t</span><span class="op" id="4967112">.</span><span class="op" id="4967113">(</span><span class="op" id="4967114">*</span><span class="ident" id="4967115">mapType</span><span class="op" id="4967122">)</span><span class="op" id="4967123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967127">case</span>&nbsp;<span class="ident" id="4967132">reflect</span><span class="op" id="4967139">.</span><span class="ident" id="4967140">Slice</span><span class="op" id="4967145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4967150">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967211">if</span>&nbsp;<span class="ident" id="4967214">typ</span><span class="op" id="4967217">.</span><span class="ident" id="4967218">Elem</span><span class="op" id="4967222">(</span><span class="op" id="4967223">)</span><span class="op" id="4967224">.</span><span class="ident" id="4967225">Kind</span><span class="op" id="4967229">(</span><span class="op" id="4967230">)</span>&nbsp;<span class="op" id="4967232">!=</span>&nbsp;<span class="ident" id="4967235">reflect</span><span class="op" id="4967242">.</span><span class="ident" id="4967243">Uint8</span>&nbsp;<span class="op" id="4967249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967255">info</span><span class="op" id="4967259">.</span><span class="ident" id="4967260">wire</span>&nbsp;<span class="op" id="4967265">=</span>&nbsp;<span class="op" id="4967267">&amp;</span><span class="ident" id="4967268">wireType</span><span class="op" id="4967276">{</span><span class="ident" id="4967277">SliceT</span><span class="op" id="4967283">:</span>&nbsp;<span class="ident" id="4967285">t</span><span class="op" id="4967286">.</span><span class="op" id="4967287">(</span><span class="op" id="4967288">*</span><span class="ident" id="4967289">sliceType</span><span class="op" id="4967298">)</span><span class="op" id="4967299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967308">case</span>&nbsp;<span class="ident" id="4967313">reflect</span><span class="op" id="4967320">.</span><span class="ident" id="4967321">Struct</span><span class="op" id="4967327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967332">info</span><span class="op" id="4967336">.</span><span class="ident" id="4967337">wire</span>&nbsp;<span class="op" id="4967342">=</span>&nbsp;<span class="op" id="4967344">&amp;</span><span class="ident" id="4967345">wireType</span><span class="op" id="4967353">{</span><span class="ident" id="4967354">StructT</span><span class="op" id="4967361">:</span>&nbsp;<span class="ident" id="4967363">t</span><span class="op" id="4967364">.</span><span class="op" id="4967365">(</span><span class="op" id="4967366">*</span><span class="ident" id="4967367">structType</span><span class="op" id="4967377">)</span><span class="op" id="4967378">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4967389">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967442">newm</span>&nbsp;<span class="op" id="4967447">:=</span>&nbsp;<span class="builtinfunc" id="4967450">make</span><span class="op" id="4967454">(</span><span class="keyword" id="4967455">map</span><span class="op" id="4967458">[</span><span class="ident" id="4967459">reflect</span><span class="op" id="4967466">.</span><span class="ident" id="4967467">Type</span><span class="op" id="4967471">]</span><span class="op" id="4967472">*</span><span class="ident" id="4967473">typeInfo</span><span class="op" id="4967481">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967484">m</span><span class="op" id="4967485">,</span>&nbsp;<span class="ident" id="4967487">_</span>&nbsp;<span class="op" id="4967489">:=</span>&nbsp;<span class="ident" id="4967492">typeInfoMap</span><span class="op" id="4967503">.</span><span class="ident" id="4967504">Load</span><span class="op" id="4967508">(</span><span class="op" id="4967509">)</span><span class="op" id="4967510">.</span><span class="op" id="4967511">(</span><span class="keyword" id="4967512">map</span><span class="op" id="4967515">[</span><span class="ident" id="4967516">reflect</span><span class="op" id="4967523">.</span><span class="ident" id="4967524">Type</span><span class="op" id="4967528">]</span><span class="op" id="4967529">*</span><span class="ident" id="4967530">typeInfo</span><span class="op" id="4967538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967541">for</span>&nbsp;<span class="ident" id="4967545">k</span><span class="op" id="4967546">,</span>&nbsp;<span class="ident" id="4967548">v</span>&nbsp;<span class="op" id="4967550">:=</span>&nbsp;<span class="keyword" id="4967553">range</span>&nbsp;<span class="ident" id="4967559">m</span>&nbsp;<span class="op" id="4967561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967565">newm</span><span class="op" id="4967569">[</span><span class="ident" id="4967570">k</span><span class="op" id="4967571">]</span>&nbsp;<span class="op" id="4967573">=</span>&nbsp;<span class="ident" id="4967575">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967581">newm</span><span class="op" id="4967585">[</span><span class="ident" id="4967586">rt</span><span class="op" id="4967588">]</span>&nbsp;<span class="op" id="4967590">=</span>&nbsp;<span class="ident" id="4967592">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967598">typeInfoMap</span><span class="op" id="4967609">.</span><span class="ident" id="4967610">Store</span><span class="op" id="4967615">(</span><span class="ident" id="4967616">newm</span><span class="op" id="4967620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967623">return</span>&nbsp;<span class="ident" id="4967630">info</span><span class="op" id="4967634">,</span>&nbsp;<span class="ident" id="4967636">nil</span><br>
<span class="lineno"></span><span class="op" id="4967640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4967643">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="4967701">func</span>&nbsp;<span class="ident" id="4967706">mustGetTypeInfo</span><span class="op" id="4967721">(</span><span class="ident" id="4967722">rt</span>&nbsp;<span class="ident" id="4967725">reflect</span><span class="op" id="4967732">.</span><span class="ident" id="4967733">Type</span><span class="op" id="4967737">)</span>&nbsp;<span class="op" id="4967739">*</span><span class="ident" id="4967740">typeInfo</span>&nbsp;<span class="op" id="4967749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4967752">t</span><span class="op" id="4967753">,</span>&nbsp;<span class="ident" id="4967755">err</span>&nbsp;<span class="op" id="4967759">:=</span>&nbsp;<span class="ident" id="4967762">getTypeInfo</span><span class="op" id="4967773">(</span><span class="ident" id="4967774">userType</span><span class="op" id="4967782">(</span><span class="ident" id="4967783">rt</span><span class="op" id="4967785">)</span><span class="op" id="4967786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967789">if</span>&nbsp;<span class="ident" id="4967792">err</span>&nbsp;<span class="op" id="4967796">!=</span>&nbsp;<span class="ident" id="4967799">nil</span>&nbsp;<span class="op" id="4967803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4967807">panic</span><span class="op" id="4967812">(</span><span class="string" id="4967813">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="4967829">+</span>&nbsp;<span class="ident" id="4967831">err</span><span class="op" id="4967834">.</span><span class="ident" id="4967835">Error</span><span class="op" id="4967840">(</span><span class="op" id="4967841">)</span><span class="op" id="4967842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4967845">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4967848">return</span>&nbsp;<span class="ident" id="4967855">t</span><br>
<span class="lineno"></span><span class="op" id="4967857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4967860">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4967929">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="4968001">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="4968066">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="4968131">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="4968198">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4968253">//</span><br>
<span class="lineno">790</span><span class="comment" id="4968256">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="4968321">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4968388">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="4968458">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4968506">type</span>&nbsp;<span class="ident" id="4968511">GobEncoder</span>&nbsp;<span class="keyword" id="4968522">interface</span>&nbsp;<span class="op" id="4968532">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968535">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968603">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968670">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4968689">GobEncode</span><span class="op" id="4968698">(</span><span class="op" id="4968699">)</span>&nbsp;<span class="op" id="4968701">(</span><span class="op" id="4968702">[</span><span class="op" id="4968703">]</span><span class="builtintype" id="4968704">byte</span><span class="op" id="4968708">,</span>&nbsp;<span class="builtintype" id="4968710">error</span><span class="op" id="4968715">)</span><br>
<span class="lineno"></span><span class="op" id="4968717">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="4968720">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4968789">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4968854">type</span>&nbsp;<span class="ident" id="4968859">GobDecoder</span>&nbsp;<span class="keyword" id="4968870">interface</span>&nbsp;<span class="op" id="4968880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968883">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4968947">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969015">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969069">GobDecode</span><span class="op" id="4969078">(</span><span class="op" id="4969079">[</span><span class="op" id="4969080">]</span><span class="builtintype" id="4969081">byte</span><span class="op" id="4969085">)</span>&nbsp;<span class="builtintype" id="4969087">error</span><br>
<span class="lineno"></span><span class="op" id="4969093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4969096">var</span>&nbsp;<span class="op" id="4969100">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969103">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4969122">sync</span><span class="op" id="4969126">.</span><span class="ident" id="4969127">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969136">nameToConcreteType</span>&nbsp;<span class="op" id="4969155">=</span>&nbsp;<span class="builtinfunc" id="4969157">make</span><span class="op" id="4969161">(</span><span class="keyword" id="4969162">map</span><span class="op" id="4969165">[</span><span class="builtintype" id="4969166">string</span><span class="op" id="4969172">]</span><span class="ident" id="4969173">reflect</span><span class="op" id="4969180">.</span><span class="ident" id="4969181">Type</span><span class="op" id="4969185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969188">concreteTypeToName</span>&nbsp;<span class="op" id="4969207">=</span>&nbsp;<span class="builtinfunc" id="4969209">make</span><span class="op" id="4969213">(</span><span class="keyword" id="4969214">map</span><span class="op" id="4969217">[</span><span class="ident" id="4969218">reflect</span><span class="op" id="4969225">.</span><span class="ident" id="4969226">Type</span><span class="op" id="4969230">]</span><span class="builtintype" id="4969231">string</span><span class="op" id="4969237">)</span><br>
<span class="lineno"></span><span class="op" id="4969239">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="4969242">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4969318">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="4969337">func</span>&nbsp;<span class="ident" id="4969342">RegisterName</span><span class="op" id="4969354">(</span><span class="ident" id="4969355">name</span>&nbsp;<span class="builtintype" id="4969360">string</span><span class="op" id="4969366">,</span>&nbsp;<span class="ident" id="4969368">value</span>&nbsp;<span class="keyword" id="4969374">interface</span><span class="op" id="4969383">{</span><span class="op" id="4969384">}</span><span class="op" id="4969385">)</span>&nbsp;<span class="op" id="4969387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969390">if</span>&nbsp;<span class="ident" id="4969393">name</span>&nbsp;<span class="op" id="4969398">==</span>&nbsp;<span class="string" id="4969401">&#34;&#34;</span>&nbsp;<span class="op" id="4969404">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969408">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4969430">panic</span><span class="op" id="4969435">(</span><span class="string" id="4969436">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4969468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969474">registerLock</span><span class="op" id="4969486">.</span><span class="ident" id="4969487">Lock</span><span class="op" id="4969491">(</span><span class="op" id="4969492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969495">defer</span>&nbsp;<span class="ident" id="4969501">registerLock</span><span class="op" id="4969513">.</span><span class="ident" id="4969514">Unlock</span><span class="op" id="4969520">(</span><span class="op" id="4969521">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4969524">ut</span>&nbsp;<span class="op" id="4969527">:=</span>&nbsp;<span class="ident" id="4969530">userType</span><span class="op" id="4969538">(</span><span class="ident" id="4969539">reflect</span><span class="op" id="4969546">.</span><span class="ident" id="4969547">TypeOf</span><span class="op" id="4969553">(</span><span class="ident" id="4969554">value</span><span class="op" id="4969559">)</span><span class="op" id="4969560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969563">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969629">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969665">if</span>&nbsp;<span class="ident" id="4969668">t</span><span class="op" id="4969669">,</span>&nbsp;<span class="ident" id="4969671">ok</span>&nbsp;<span class="op" id="4969674">:=</span>&nbsp;<span class="ident" id="4969677">nameToConcreteType</span><span class="op" id="4969695">[</span><span class="ident" id="4969696">name</span><span class="op" id="4969700">]</span><span class="op" id="4969701">;</span>&nbsp;<span class="ident" id="4969703">ok</span>&nbsp;<span class="op" id="4969706">&amp;&amp;</span>&nbsp;<span class="ident" id="4969709">t</span>&nbsp;<span class="op" id="4969711">!=</span>&nbsp;<span class="ident" id="4969714">ut</span><span class="op" id="4969716">.</span><span class="ident" id="4969717">user</span>&nbsp;<span class="op" id="4969722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4969726">panic</span><span class="op" id="4969731">(</span><span class="ident" id="4969732">fmt</span><span class="op" id="4969735">.</span><span class="ident" id="4969736">Sprintf</span><span class="op" id="4969743">(</span><span class="string" id="4969744">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="4969795">,</span>&nbsp;<span class="ident" id="4969797">name</span><span class="op" id="4969801">,</span>&nbsp;<span class="ident" id="4969803">t</span><span class="op" id="4969804">,</span>&nbsp;<span class="ident" id="4969806">ut</span><span class="op" id="4969808">.</span><span class="ident" id="4969809">user</span><span class="op" id="4969813">)</span><span class="op" id="4969814">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4969820">if</span>&nbsp;<span class="ident" id="4969823">n</span><span class="op" id="4969824">,</span>&nbsp;<span class="ident" id="4969826">ok</span>&nbsp;<span class="op" id="4969829">:=</span>&nbsp;<span class="ident" id="4969832">concreteTypeToName</span><span class="op" id="4969850">[</span><span class="ident" id="4969851">ut</span><span class="op" id="4969853">.</span><span class="ident" id="4969854">base</span><span class="op" id="4969858">]</span><span class="op" id="4969859">;</span>&nbsp;<span class="ident" id="4969861">ok</span>&nbsp;<span class="op" id="4969864">&amp;&amp;</span>&nbsp;<span class="ident" id="4969867">n</span>&nbsp;<span class="op" id="4969869">!=</span>&nbsp;<span class="ident" id="4969872">name</span>&nbsp;<span class="op" id="4969877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4969881">panic</span><span class="op" id="4969886">(</span><span class="ident" id="4969887">fmt</span><span class="op" id="4969890">.</span><span class="ident" id="4969891">Sprintf</span><span class="op" id="4969898">(</span><span class="string" id="4969899">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="4969950">,</span>&nbsp;<span class="ident" id="4969952">ut</span><span class="op" id="4969954">.</span><span class="ident" id="4969955">user</span><span class="op" id="4969959">,</span>&nbsp;<span class="ident" id="4969961">n</span><span class="op" id="4969962">,</span>&nbsp;<span class="ident" id="4969964">name</span><span class="op" id="4969968">)</span><span class="op" id="4969969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4969972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4969975">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970028">nameToConcreteType</span><span class="op" id="4970046">[</span><span class="ident" id="4970047">name</span><span class="op" id="4970051">]</span>&nbsp;<span class="op" id="4970053">=</span>&nbsp;<span class="ident" id="4970055">reflect</span><span class="op" id="4970062">.</span><span class="ident" id="4970063">TypeOf</span><span class="op" id="4970069">(</span><span class="ident" id="4970070">value</span><span class="op" id="4970075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970078">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970156">concreteTypeToName</span><span class="op" id="4970174">[</span><span class="ident" id="4970175">ut</span><span class="op" id="4970177">.</span><span class="ident" id="4970178">base</span><span class="op" id="4970182">]</span>&nbsp;<span class="op" id="4970184">=</span>&nbsp;<span class="ident" id="4970186">name</span><br>
<span class="lineno"></span><span class="op" id="4970191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="4970194">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4970269">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4970346">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4970417">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="4970494">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="4970571">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="4970618">func</span>&nbsp;<span class="ident" id="4970623">Register</span><span class="op" id="4970631">(</span><span class="ident" id="4970632">value</span>&nbsp;<span class="keyword" id="4970638">interface</span><span class="op" id="4970647">{</span><span class="op" id="4970648">}</span><span class="op" id="4970649">)</span>&nbsp;<span class="op" id="4970651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970654">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970710">rt</span>&nbsp;<span class="op" id="4970713">:=</span>&nbsp;<span class="ident" id="4970716">reflect</span><span class="op" id="4970723">.</span><span class="ident" id="4970724">TypeOf</span><span class="op" id="4970730">(</span><span class="ident" id="4970731">value</span><span class="op" id="4970736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970739">name</span>&nbsp;<span class="op" id="4970744">:=</span>&nbsp;<span class="ident" id="4970747">rt</span><span class="op" id="4970749">.</span><span class="ident" id="4970750">String</span><span class="op" id="4970756">(</span><span class="op" id="4970757">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970761">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4970858">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970912">star</span>&nbsp;<span class="op" id="4970917">:=</span>&nbsp;<span class="string" id="4970920">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970924">if</span>&nbsp;<span class="ident" id="4970927">rt</span><span class="op" id="4970929">.</span><span class="ident" id="4970930">Name</span><span class="op" id="4970934">(</span><span class="op" id="4970935">)</span>&nbsp;<span class="op" id="4970937">==</span>&nbsp;<span class="string" id="4970940">&#34;&#34;</span>&nbsp;<span class="op" id="4970943">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4970947">if</span>&nbsp;<span class="ident" id="4970950">pt</span>&nbsp;<span class="op" id="4970953">:=</span>&nbsp;<span class="ident" id="4970956">rt</span><span class="op" id="4970958">;</span>&nbsp;<span class="ident" id="4970960">pt</span><span class="op" id="4970962">.</span><span class="ident" id="4970963">Kind</span><span class="op" id="4970967">(</span><span class="op" id="4970968">)</span>&nbsp;<span class="op" id="4970970">==</span>&nbsp;<span class="ident" id="4970973">reflect</span><span class="op" id="4970980">.</span><span class="ident" id="4970981">Ptr</span>&nbsp;<span class="op" id="4970985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4970990">star</span>&nbsp;<span class="op" id="4970995">=</span>&nbsp;<span class="string" id="4970997">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971004">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971073">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971150">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971176">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971182">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971249">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971269">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971302">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971372">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971394">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971400">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971449">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971455">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971500">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971541">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4971547">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971631">rt</span>&nbsp;<span class="op" id="4971634">=</span>&nbsp;<span class="ident" id="4971636">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971641">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971647">if</span>&nbsp;<span class="ident" id="4971650">rt</span><span class="op" id="4971652">.</span><span class="ident" id="4971653">Name</span><span class="op" id="4971657">(</span><span class="op" id="4971658">)</span>&nbsp;<span class="op" id="4971660">!=</span>&nbsp;<span class="string" id="4971663">&#34;&#34;</span>&nbsp;<span class="op" id="4971666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4971670">if</span>&nbsp;<span class="ident" id="4971673">rt</span><span class="op" id="4971675">.</span><span class="ident" id="4971676">PkgPath</span><span class="op" id="4971683">(</span><span class="op" id="4971684">)</span>&nbsp;<span class="op" id="4971686">==</span>&nbsp;<span class="string" id="4971689">&#34;&#34;</span>&nbsp;<span class="op" id="4971692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971697">name</span>&nbsp;<span class="op" id="4971702">=</span>&nbsp;<span class="ident" id="4971704">star</span>&nbsp;<span class="op" id="4971709">+</span>&nbsp;<span class="ident" id="4971711">rt</span><span class="op" id="4971713">.</span><span class="ident" id="4971714">Name</span><span class="op" id="4971718">(</span><span class="op" id="4971719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971723">}</span>&nbsp;<span class="keyword" id="4971725">else</span>&nbsp;<span class="op" id="4971730">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971735">name</span>&nbsp;<span class="op" id="4971740">=</span>&nbsp;<span class="ident" id="4971742">star</span>&nbsp;<span class="op" id="4971747">+</span>&nbsp;<span class="ident" id="4971749">rt</span><span class="op" id="4971751">.</span><span class="ident" id="4971752">PkgPath</span><span class="op" id="4971759">(</span><span class="op" id="4971760">)</span>&nbsp;<span class="op" id="4971762">+</span>&nbsp;<span class="string" id="4971764">&#34;.&#34;</span>&nbsp;<span class="op" id="4971768">+</span>&nbsp;<span class="ident" id="4971770">rt</span><span class="op" id="4971772">.</span><span class="ident" id="4971773">Name</span><span class="op" id="4971777">(</span><span class="op" id="4971778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4971785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971789">RegisterName</span><span class="op" id="4971801">(</span><span class="ident" id="4971802">name</span><span class="op" id="4971806">,</span>&nbsp;<span class="ident" id="4971808">value</span><span class="op" id="4971813">)</span><br>
<span class="lineno">885</span><span class="op" id="4971815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4971818">func</span>&nbsp;<span class="ident" id="4971823">registerBasics</span><span class="op" id="4971837">(</span><span class="op" id="4971838">)</span>&nbsp;<span class="op" id="4971840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971843">Register</span><span class="op" id="4971851">(</span><span class="builtintype" id="4971852">int</span><span class="op" id="4971855">(</span><span class="num" id="4971856">0</span><span class="op" id="4971857">)</span><span class="op" id="4971858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971861">Register</span><span class="op" id="4971869">(</span><span class="builtintype" id="4971870">int8</span><span class="op" id="4971874">(</span><span class="num" id="4971875">0</span><span class="op" id="4971876">)</span><span class="op" id="4971877">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971880">Register</span><span class="op" id="4971888">(</span><span class="builtintype" id="4971889">int16</span><span class="op" id="4971894">(</span><span class="num" id="4971895">0</span><span class="op" id="4971896">)</span><span class="op" id="4971897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971900">Register</span><span class="op" id="4971908">(</span><span class="builtintype" id="4971909">int32</span><span class="op" id="4971914">(</span><span class="num" id="4971915">0</span><span class="op" id="4971916">)</span><span class="op" id="4971917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971920">Register</span><span class="op" id="4971928">(</span><span class="ident" id="4971929">int64</span><span class="op" id="4971934">(</span><span class="num" id="4971935">0</span><span class="op" id="4971936">)</span><span class="op" id="4971937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971940">Register</span><span class="op" id="4971948">(</span><span class="builtintype" id="4971949">uint</span><span class="op" id="4971953">(</span><span class="num" id="4971954">0</span><span class="op" id="4971955">)</span><span class="op" id="4971956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971959">Register</span><span class="op" id="4971967">(</span><span class="builtintype" id="4971968">uint8</span><span class="op" id="4971973">(</span><span class="num" id="4971974">0</span><span class="op" id="4971975">)</span><span class="op" id="4971976">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4971979">Register</span><span class="op" id="4971987">(</span><span class="builtintype" id="4971988">uint16</span><span class="op" id="4971994">(</span><span class="num" id="4971995">0</span><span class="op" id="4971996">)</span><span class="op" id="4971997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972000">Register</span><span class="op" id="4972008">(</span><span class="builtintype" id="4972009">uint32</span><span class="op" id="4972015">(</span><span class="num" id="4972016">0</span><span class="op" id="4972017">)</span><span class="op" id="4972018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972021">Register</span><span class="op" id="4972029">(</span><span class="ident" id="4972030">uint64</span><span class="op" id="4972036">(</span><span class="num" id="4972037">0</span><span class="op" id="4972038">)</span><span class="op" id="4972039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972042">Register</span><span class="op" id="4972050">(</span><span class="builtintype" id="4972051">float32</span><span class="op" id="4972058">(</span><span class="num" id="4972059">0</span><span class="op" id="4972060">)</span><span class="op" id="4972061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972064">Register</span><span class="op" id="4972072">(</span><span class="builtintype" id="4972073">float64</span><span class="op" id="4972080">(</span><span class="num" id="4972081">0</span><span class="op" id="4972082">)</span><span class="op" id="4972083">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972086">Register</span><span class="op" id="4972094">(</span><span class="builtintype" id="4972095">complex64</span><span class="op" id="4972104">(</span><span class="num" id="4972105">0i</span><span class="op" id="4972107">)</span><span class="op" id="4972108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972111">Register</span><span class="op" id="4972119">(</span><span class="builtintype" id="4972120">complex128</span><span class="op" id="4972130">(</span><span class="num" id="4972131">0i</span><span class="op" id="4972133">)</span><span class="op" id="4972134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972137">Register</span><span class="op" id="4972145">(</span><span class="builtintype" id="4972146">uintptr</span><span class="op" id="4972153">(</span><span class="num" id="4972154">0</span><span class="op" id="4972155">)</span><span class="op" id="4972156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972159">Register</span><span class="op" id="4972167">(</span><span class="builtintype" id="4972168">false</span><span class="op" id="4972173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972176">Register</span><span class="op" id="4972184">(</span><span class="string" id="4972185">&#34;&#34;</span><span class="op" id="4972187">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972190">Register</span><span class="op" id="4972198">(</span><span class="op" id="4972199">[</span><span class="op" id="4972200">]</span><span class="builtintype" id="4972201">byte</span><span class="op" id="4972205">(</span><span class="ident" id="4972206">nil</span><span class="op" id="4972209">)</span><span class="op" id="4972210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972213">Register</span><span class="op" id="4972221">(</span><span class="op" id="4972222">[</span><span class="op" id="4972223">]</span><span class="builtintype" id="4972224">int</span><span class="op" id="4972227">(</span><span class="ident" id="4972228">nil</span><span class="op" id="4972231">)</span><span class="op" id="4972232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972235">Register</span><span class="op" id="4972243">(</span><span class="op" id="4972244">[</span><span class="op" id="4972245">]</span><span class="builtintype" id="4972246">int8</span><span class="op" id="4972250">(</span><span class="ident" id="4972251">nil</span><span class="op" id="4972254">)</span><span class="op" id="4972255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972258">Register</span><span class="op" id="4972266">(</span><span class="op" id="4972267">[</span><span class="op" id="4972268">]</span><span class="builtintype" id="4972269">int16</span><span class="op" id="4972274">(</span><span class="ident" id="4972275">nil</span><span class="op" id="4972278">)</span><span class="op" id="4972279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972282">Register</span><span class="op" id="4972290">(</span><span class="op" id="4972291">[</span><span class="op" id="4972292">]</span><span class="builtintype" id="4972293">int32</span><span class="op" id="4972298">(</span><span class="ident" id="4972299">nil</span><span class="op" id="4972302">)</span><span class="op" id="4972303">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972306">Register</span><span class="op" id="4972314">(</span><span class="op" id="4972315">[</span><span class="op" id="4972316">]</span><span class="ident" id="4972317">int64</span><span class="op" id="4972322">(</span><span class="ident" id="4972323">nil</span><span class="op" id="4972326">)</span><span class="op" id="4972327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972330">Register</span><span class="op" id="4972338">(</span><span class="op" id="4972339">[</span><span class="op" id="4972340">]</span><span class="builtintype" id="4972341">uint</span><span class="op" id="4972345">(</span><span class="ident" id="4972346">nil</span><span class="op" id="4972349">)</span><span class="op" id="4972350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972353">Register</span><span class="op" id="4972361">(</span><span class="op" id="4972362">[</span><span class="op" id="4972363">]</span><span class="builtintype" id="4972364">uint8</span><span class="op" id="4972369">(</span><span class="ident" id="4972370">nil</span><span class="op" id="4972373">)</span><span class="op" id="4972374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972377">Register</span><span class="op" id="4972385">(</span><span class="op" id="4972386">[</span><span class="op" id="4972387">]</span><span class="builtintype" id="4972388">uint16</span><span class="op" id="4972394">(</span><span class="ident" id="4972395">nil</span><span class="op" id="4972398">)</span><span class="op" id="4972399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972402">Register</span><span class="op" id="4972410">(</span><span class="op" id="4972411">[</span><span class="op" id="4972412">]</span><span class="builtintype" id="4972413">uint32</span><span class="op" id="4972419">(</span><span class="ident" id="4972420">nil</span><span class="op" id="4972423">)</span><span class="op" id="4972424">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972427">Register</span><span class="op" id="4972435">(</span><span class="op" id="4972436">[</span><span class="op" id="4972437">]</span><span class="ident" id="4972438">uint64</span><span class="op" id="4972444">(</span><span class="ident" id="4972445">nil</span><span class="op" id="4972448">)</span><span class="op" id="4972449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972452">Register</span><span class="op" id="4972460">(</span><span class="op" id="4972461">[</span><span class="op" id="4972462">]</span><span class="builtintype" id="4972463">float32</span><span class="op" id="4972470">(</span><span class="ident" id="4972471">nil</span><span class="op" id="4972474">)</span><span class="op" id="4972475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972478">Register</span><span class="op" id="4972486">(</span><span class="op" id="4972487">[</span><span class="op" id="4972488">]</span><span class="builtintype" id="4972489">float64</span><span class="op" id="4972496">(</span><span class="ident" id="4972497">nil</span><span class="op" id="4972500">)</span><span class="op" id="4972501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972504">Register</span><span class="op" id="4972512">(</span><span class="op" id="4972513">[</span><span class="op" id="4972514">]</span><span class="builtintype" id="4972515">complex64</span><span class="op" id="4972524">(</span><span class="ident" id="4972525">nil</span><span class="op" id="4972528">)</span><span class="op" id="4972529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972532">Register</span><span class="op" id="4972540">(</span><span class="op" id="4972541">[</span><span class="op" id="4972542">]</span><span class="builtintype" id="4972543">complex128</span><span class="op" id="4972553">(</span><span class="ident" id="4972554">nil</span><span class="op" id="4972557">)</span><span class="op" id="4972558">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972561">Register</span><span class="op" id="4972569">(</span><span class="op" id="4972570">[</span><span class="op" id="4972571">]</span><span class="builtintype" id="4972572">uintptr</span><span class="op" id="4972579">(</span><span class="ident" id="4972580">nil</span><span class="op" id="4972583">)</span><span class="op" id="4972584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972587">Register</span><span class="op" id="4972595">(</span><span class="op" id="4972596">[</span><span class="op" id="4972597">]</span><span class="builtintype" id="4972598">bool</span><span class="op" id="4972602">(</span><span class="ident" id="4972603">nil</span><span class="op" id="4972606">)</span><span class="op" id="4972607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4972610">Register</span><span class="op" id="4972618">(</span><span class="op" id="4972619">[</span><span class="op" id="4972620">]</span><span class="builtintype" id="4972621">string</span><span class="op" id="4972627">(</span><span class="ident" id="4972628">nil</span><span class="op" id="4972631">)</span><span class="op" id="4972632">)</span><br>
<span class="lineno"></span><span class="op" id="4972634">}</span>
</div>
</body>
</html>
