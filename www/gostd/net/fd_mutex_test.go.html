<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6589423">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6589478">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6589532">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6589583">package</span>&nbsp;<span class="ident" id="6589591">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589596">import</span>&nbsp;<span class="op" id="6589603">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6589606">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6589619">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6589630">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6589641">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6589648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589651">func</span>&nbsp;<span class="ident" id="6589656">TestMutexLock</span><span class="op" id="6589669">(</span><span class="ident" id="6589670">t</span>&nbsp;<span class="op" id="6589672">*</span><span class="ident" id="6589673">testing</span><span class="op" id="6589680">.</span><span class="ident" id="6589681">T</span><span class="op" id="6589682">)</span>&nbsp;<span class="op" id="6589684">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589687">var</span>&nbsp;<span class="ident" id="6589691">mu</span>&nbsp;<span class="ident" id="6589694">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589704">if</span>&nbsp;<span class="op" id="6589707">!</span><span class="ident" id="6589708">mu</span><span class="op" id="6589710">.</span><span class="ident" id="6589711">Incref</span><span class="op" id="6589717">(</span><span class="op" id="6589718">)</span>&nbsp;<span class="op" id="6589720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589724">t</span><span class="op" id="6589725">.</span><span class="ident" id="6589726">Fatal</span><span class="op" id="6589731">(</span><span class="string" id="6589732">&#34;broken&#34;</span><span class="op" id="6589740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589743">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589746">if</span>&nbsp;<span class="ident" id="6589749">mu</span><span class="op" id="6589751">.</span><span class="ident" id="6589752">Decref</span><span class="op" id="6589758">(</span><span class="op" id="6589759">)</span>&nbsp;<span class="op" id="6589761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589765">t</span><span class="op" id="6589766">.</span><span class="ident" id="6589767">Fatal</span><span class="op" id="6589772">(</span><span class="string" id="6589773">&#34;broken&#34;</span><span class="op" id="6589781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589788">if</span>&nbsp;<span class="op" id="6589791">!</span><span class="ident" id="6589792">mu</span><span class="op" id="6589794">.</span><span class="ident" id="6589795">RWLock</span><span class="op" id="6589801">(</span><span class="builtintype" id="6589802">true</span><span class="op" id="6589806">)</span>&nbsp;<span class="op" id="6589808">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589812">t</span><span class="op" id="6589813">.</span><span class="ident" id="6589814">Fatal</span><span class="op" id="6589819">(</span><span class="string" id="6589820">&#34;broken&#34;</span><span class="op" id="6589828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589834">if</span>&nbsp;<span class="ident" id="6589837">mu</span><span class="op" id="6589839">.</span><span class="ident" id="6589840">RWUnlock</span><span class="op" id="6589848">(</span><span class="builtintype" id="6589849">true</span><span class="op" id="6589853">)</span>&nbsp;<span class="op" id="6589855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589859">t</span><span class="op" id="6589860">.</span><span class="ident" id="6589861">Fatal</span><span class="op" id="6589866">(</span><span class="string" id="6589867">&#34;broken&#34;</span><span class="op" id="6589875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589878">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589882">if</span>&nbsp;<span class="op" id="6589885">!</span><span class="ident" id="6589886">mu</span><span class="op" id="6589888">.</span><span class="ident" id="6589889">RWLock</span><span class="op" id="6589895">(</span><span class="builtintype" id="6589896">false</span><span class="op" id="6589901">)</span>&nbsp;<span class="op" id="6589903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589907">t</span><span class="op" id="6589908">.</span><span class="ident" id="6589909">Fatal</span><span class="op" id="6589914">(</span><span class="string" id="6589915">&#34;broken&#34;</span><span class="op" id="6589923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589929">if</span>&nbsp;<span class="ident" id="6589932">mu</span><span class="op" id="6589934">.</span><span class="ident" id="6589935">RWUnlock</span><span class="op" id="6589943">(</span><span class="builtintype" id="6589944">false</span><span class="op" id="6589949">)</span>&nbsp;<span class="op" id="6589951">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589955">t</span><span class="op" id="6589956">.</span><span class="ident" id="6589957">Fatal</span><span class="op" id="6589962">(</span><span class="string" id="6589963">&#34;broken&#34;</span><span class="op" id="6589971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589974">}</span><br>
<span class="lineno"></span><span class="op" id="6589976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589979">func</span>&nbsp;<span class="ident" id="6589984">TestMutexClose</span><span class="op" id="6589998">(</span><span class="ident" id="6589999">t</span>&nbsp;<span class="op" id="6590001">*</span><span class="ident" id="6590002">testing</span><span class="op" id="6590009">.</span><span class="ident" id="6590010">T</span><span class="op" id="6590011">)</span>&nbsp;<span class="op" id="6590013">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590016">var</span>&nbsp;<span class="ident" id="6590020">mu</span>&nbsp;<span class="ident" id="6590023">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590032">if</span>&nbsp;<span class="op" id="6590035">!</span><span class="ident" id="6590036">mu</span><span class="op" id="6590038">.</span><span class="ident" id="6590039">IncrefAndClose</span><span class="op" id="6590053">(</span><span class="op" id="6590054">)</span>&nbsp;<span class="op" id="6590056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590060">t</span><span class="op" id="6590061">.</span><span class="ident" id="6590062">Fatal</span><span class="op" id="6590067">(</span><span class="string" id="6590068">&#34;broken&#34;</span><span class="op" id="6590076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590083">if</span>&nbsp;<span class="ident" id="6590086">mu</span><span class="op" id="6590088">.</span><span class="ident" id="6590089">Incref</span><span class="op" id="6590095">(</span><span class="op" id="6590096">)</span>&nbsp;<span class="op" id="6590098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590102">t</span><span class="op" id="6590103">.</span><span class="ident" id="6590104">Fatal</span><span class="op" id="6590109">(</span><span class="string" id="6590110">&#34;broken&#34;</span><span class="op" id="6590118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590124">if</span>&nbsp;<span class="ident" id="6590127">mu</span><span class="op" id="6590129">.</span><span class="ident" id="6590130">RWLock</span><span class="op" id="6590136">(</span><span class="builtintype" id="6590137">true</span><span class="op" id="6590141">)</span>&nbsp;<span class="op" id="6590143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590147">t</span><span class="op" id="6590148">.</span><span class="ident" id="6590149">Fatal</span><span class="op" id="6590154">(</span><span class="string" id="6590155">&#34;broken&#34;</span><span class="op" id="6590163">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590169">if</span>&nbsp;<span class="ident" id="6590172">mu</span><span class="op" id="6590174">.</span><span class="ident" id="6590175">RWLock</span><span class="op" id="6590181">(</span><span class="builtintype" id="6590182">false</span><span class="op" id="6590187">)</span>&nbsp;<span class="op" id="6590189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590193">t</span><span class="op" id="6590194">.</span><span class="ident" id="6590195">Fatal</span><span class="op" id="6590200">(</span><span class="string" id="6590201">&#34;broken&#34;</span><span class="op" id="6590209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590215">if</span>&nbsp;<span class="ident" id="6590218">mu</span><span class="op" id="6590220">.</span><span class="ident" id="6590221">IncrefAndClose</span><span class="op" id="6590235">(</span><span class="op" id="6590236">)</span>&nbsp;<span class="op" id="6590238">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590242">t</span><span class="op" id="6590243">.</span><span class="ident" id="6590244">Fatal</span><span class="op" id="6590249">(</span><span class="string" id="6590250">&#34;broken&#34;</span><span class="op" id="6590258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590261">}</span><br>
<span class="lineno"></span><span class="op" id="6590263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590266">func</span>&nbsp;<span class="ident" id="6590271">TestMutexCloseUnblock</span><span class="op" id="6590292">(</span><span class="ident" id="6590293">t</span>&nbsp;<span class="op" id="6590295">*</span><span class="ident" id="6590296">testing</span><span class="op" id="6590303">.</span><span class="ident" id="6590304">T</span><span class="op" id="6590305">)</span>&nbsp;<span class="op" id="6590307">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590310">c</span>&nbsp;<span class="op" id="6590312">:=</span>&nbsp;<span class="builtinfunc" id="6590315">make</span><span class="op" id="6590319">(</span><span class="keyword" id="6590320">chan</span>&nbsp;<span class="builtintype" id="6590325">bool</span><span class="op" id="6590329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590332">var</span>&nbsp;<span class="ident" id="6590336">mu</span>&nbsp;<span class="ident" id="6590339">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590348">mu</span><span class="op" id="6590350">.</span><span class="ident" id="6590351">RWLock</span><span class="op" id="6590357">(</span><span class="builtintype" id="6590358">true</span><span class="op" id="6590362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590365">for</span>&nbsp;<span class="ident" id="6590369">i</span>&nbsp;<span class="op" id="6590371">:=</span>&nbsp;<span class="num" id="6590374">0</span><span class="op" id="6590375">;</span>&nbsp;<span class="ident" id="6590377">i</span>&nbsp;<span class="op" id="6590379">&lt;</span>&nbsp;<span class="num" id="6590381">4</span><span class="op" id="6590382">;</span>&nbsp;<span class="ident" id="6590384">i</span><span class="op" id="6590385">++</span>&nbsp;<span class="op" id="6590388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590392">go</span>&nbsp;<span class="keyword" id="6590395">func</span><span class="op" id="6590399">(</span><span class="op" id="6590400">)</span>&nbsp;<span class="op" id="6590402">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590407">if</span>&nbsp;<span class="ident" id="6590410">mu</span><span class="op" id="6590412">.</span><span class="ident" id="6590413">RWLock</span><span class="op" id="6590419">(</span><span class="builtintype" id="6590420">true</span><span class="op" id="6590424">)</span>&nbsp;<span class="op" id="6590426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590432">t</span><span class="op" id="6590433">.</span><span class="ident" id="6590434">Error</span><span class="op" id="6590439">(</span><span class="string" id="6590440">&#34;broken&#34;</span><span class="op" id="6590448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590454">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590469">c</span>&nbsp;<span class="op" id="6590471">&lt;-</span>&nbsp;<span class="builtintype" id="6590474">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590481">}</span><span class="op" id="6590482">(</span><span class="op" id="6590483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6590489">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590556">time</span><span class="op" id="6590560">.</span><span class="ident" id="6590561">Sleep</span><span class="op" id="6590566">(</span><span class="ident" id="6590567">time</span><span class="op" id="6590571">.</span><span class="ident" id="6590572">Millisecond</span><span class="op" id="6590583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590586">select</span>&nbsp;<span class="op" id="6590593">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590596">case</span>&nbsp;<span class="op" id="6590601">&lt;-</span><span class="ident" id="6590603">c</span><span class="op" id="6590604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590608">t</span><span class="op" id="6590609">.</span><span class="ident" id="6590610">Fatal</span><span class="op" id="6590615">(</span><span class="string" id="6590616">&#34;broken&#34;</span><span class="op" id="6590624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590627">default</span><span class="op" id="6590634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590640">mu</span><span class="op" id="6590642">.</span><span class="ident" id="6590643">IncrefAndClose</span><span class="op" id="6590657">(</span><span class="op" id="6590658">)</span>&nbsp;<span class="comment" id="6590660">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590690">for</span>&nbsp;<span class="ident" id="6590694">i</span>&nbsp;<span class="op" id="6590696">:=</span>&nbsp;<span class="num" id="6590699">0</span><span class="op" id="6590700">;</span>&nbsp;<span class="ident" id="6590702">i</span>&nbsp;<span class="op" id="6590704">&lt;</span>&nbsp;<span class="num" id="6590706">4</span><span class="op" id="6590707">;</span>&nbsp;<span class="ident" id="6590709">i</span><span class="op" id="6590710">++</span>&nbsp;<span class="op" id="6590713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590717">select</span>&nbsp;<span class="op" id="6590724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590728">case</span>&nbsp;<span class="op" id="6590733">&lt;-</span><span class="ident" id="6590735">c</span><span class="op" id="6590736">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590740">case</span>&nbsp;<span class="op" id="6590745">&lt;-</span><span class="ident" id="6590747">time</span><span class="op" id="6590751">.</span><span class="ident" id="6590752">After</span><span class="op" id="6590757">(</span><span class="num" id="6590758">10</span>&nbsp;<span class="op" id="6590761">*</span>&nbsp;<span class="ident" id="6590763">time</span><span class="op" id="6590767">.</span><span class="ident" id="6590768">Second</span><span class="op" id="6590774">)</span><span class="op" id="6590775">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590780">t</span><span class="op" id="6590781">.</span><span class="ident" id="6590782">Fatal</span><span class="op" id="6590787">(</span><span class="string" id="6590788">&#34;broken&#34;</span><span class="op" id="6590796">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590806">if</span>&nbsp;<span class="ident" id="6590809">mu</span><span class="op" id="6590811">.</span><span class="ident" id="6590812">Decref</span><span class="op" id="6590818">(</span><span class="op" id="6590819">)</span>&nbsp;<span class="op" id="6590821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590825">t</span><span class="op" id="6590826">.</span><span class="ident" id="6590827">Fatal</span><span class="op" id="6590832">(</span><span class="string" id="6590833">&#34;broken&#34;</span><span class="op" id="6590841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590844">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590847">if</span>&nbsp;<span class="op" id="6590850">!</span><span class="ident" id="6590851">mu</span><span class="op" id="6590853">.</span><span class="ident" id="6590854">RWUnlock</span><span class="op" id="6590862">(</span><span class="builtintype" id="6590863">true</span><span class="op" id="6590867">)</span>&nbsp;<span class="op" id="6590869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590873">t</span><span class="op" id="6590874">.</span><span class="ident" id="6590875">Fatal</span><span class="op" id="6590880">(</span><span class="string" id="6590881">&#34;broken&#34;</span><span class="op" id="6590889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590892">}</span><br>
<span class="lineno"></span><span class="op" id="6590894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6590897">func</span>&nbsp;<span class="ident" id="6590902">TestMutexPanic</span><span class="op" id="6590916">(</span><span class="ident" id="6590917">t</span>&nbsp;<span class="op" id="6590919">*</span><span class="ident" id="6590920">testing</span><span class="op" id="6590927">.</span><span class="ident" id="6590928">T</span><span class="op" id="6590929">)</span>&nbsp;<span class="op" id="6590931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590934">ensurePanics</span>&nbsp;<span class="op" id="6590947">:=</span>&nbsp;<span class="keyword" id="6590950">func</span><span class="op" id="6590954">(</span><span class="ident" id="6590955">f</span>&nbsp;<span class="keyword" id="6590957">func</span><span class="op" id="6590961">(</span><span class="op" id="6590962">)</span><span class="op" id="6590963">)</span>&nbsp;<span class="op" id="6590965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590969">defer</span>&nbsp;<span class="keyword" id="6590975">func</span><span class="op" id="6590979">(</span><span class="op" id="6590980">)</span>&nbsp;<span class="op" id="6590982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590987">if</span>&nbsp;<span class="builtinfunc" id="6590990">recover</span><span class="op" id="6590997">(</span><span class="op" id="6590998">)</span>&nbsp;<span class="op" id="6591000">==</span>&nbsp;<span class="ident" id="6591003">nil</span>&nbsp;<span class="op" id="6591007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591013">t</span><span class="op" id="6591014">.</span><span class="ident" id="6591015">Fatal</span><span class="op" id="6591020">(</span><span class="string" id="6591021">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6591037">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591046">}</span><span class="op" id="6591047">(</span><span class="op" id="6591048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591052">f</span><span class="op" id="6591053">(</span><span class="op" id="6591054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591061">var</span>&nbsp;<span class="ident" id="6591065">mu</span>&nbsp;<span class="ident" id="6591068">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591077">ensurePanics</span><span class="op" id="6591089">(</span><span class="keyword" id="6591090">func</span><span class="op" id="6591094">(</span><span class="op" id="6591095">)</span>&nbsp;<span class="op" id="6591097">{</span>&nbsp;<span class="ident" id="6591099">mu</span><span class="op" id="6591101">.</span><span class="ident" id="6591102">Decref</span><span class="op" id="6591108">(</span><span class="op" id="6591109">)</span>&nbsp;<span class="op" id="6591111">}</span><span class="op" id="6591112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591115">ensurePanics</span><span class="op" id="6591127">(</span><span class="keyword" id="6591128">func</span><span class="op" id="6591132">(</span><span class="op" id="6591133">)</span>&nbsp;<span class="op" id="6591135">{</span>&nbsp;<span class="ident" id="6591137">mu</span><span class="op" id="6591139">.</span><span class="ident" id="6591140">RWUnlock</span><span class="op" id="6591148">(</span><span class="builtintype" id="6591149">true</span><span class="op" id="6591153">)</span>&nbsp;<span class="op" id="6591155">}</span><span class="op" id="6591156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591159">ensurePanics</span><span class="op" id="6591171">(</span><span class="keyword" id="6591172">func</span><span class="op" id="6591176">(</span><span class="op" id="6591177">)</span>&nbsp;<span class="op" id="6591179">{</span>&nbsp;<span class="ident" id="6591181">mu</span><span class="op" id="6591183">.</span><span class="ident" id="6591184">RWUnlock</span><span class="op" id="6591192">(</span><span class="builtintype" id="6591193">false</span><span class="op" id="6591198">)</span>&nbsp;<span class="op" id="6591200">}</span><span class="op" id="6591201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591205">ensurePanics</span><span class="op" id="6591217">(</span><span class="keyword" id="6591218">func</span><span class="op" id="6591222">(</span><span class="op" id="6591223">)</span>&nbsp;<span class="op" id="6591225">{</span>&nbsp;<span class="ident" id="6591227">mu</span><span class="op" id="6591229">.</span><span class="ident" id="6591230">Incref</span><span class="op" id="6591236">(</span><span class="op" id="6591237">)</span><span class="op" id="6591238">;</span>&nbsp;<span class="ident" id="6591240">mu</span><span class="op" id="6591242">.</span><span class="ident" id="6591243">Decref</span><span class="op" id="6591249">(</span><span class="op" id="6591250">)</span><span class="op" id="6591251">;</span>&nbsp;<span class="ident" id="6591253">mu</span><span class="op" id="6591255">.</span><span class="ident" id="6591256">Decref</span><span class="op" id="6591262">(</span><span class="op" id="6591263">)</span>&nbsp;<span class="op" id="6591265">}</span><span class="op" id="6591266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591269">ensurePanics</span><span class="op" id="6591281">(</span><span class="keyword" id="6591282">func</span><span class="op" id="6591286">(</span><span class="op" id="6591287">)</span>&nbsp;<span class="op" id="6591289">{</span>&nbsp;<span class="ident" id="6591291">mu</span><span class="op" id="6591293">.</span><span class="ident" id="6591294">RWLock</span><span class="op" id="6591300">(</span><span class="builtintype" id="6591301">true</span><span class="op" id="6591305">)</span><span class="op" id="6591306">;</span>&nbsp;<span class="ident" id="6591308">mu</span><span class="op" id="6591310">.</span><span class="ident" id="6591311">RWUnlock</span><span class="op" id="6591319">(</span><span class="builtintype" id="6591320">true</span><span class="op" id="6591324">)</span><span class="op" id="6591325">;</span>&nbsp;<span class="ident" id="6591327">mu</span><span class="op" id="6591329">.</span><span class="ident" id="6591330">RWUnlock</span><span class="op" id="6591338">(</span><span class="builtintype" id="6591339">true</span><span class="op" id="6591343">)</span>&nbsp;<span class="op" id="6591345">}</span><span class="op" id="6591346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591349">ensurePanics</span><span class="op" id="6591361">(</span><span class="keyword" id="6591362">func</span><span class="op" id="6591366">(</span><span class="op" id="6591367">)</span>&nbsp;<span class="op" id="6591369">{</span>&nbsp;<span class="ident" id="6591371">mu</span><span class="op" id="6591373">.</span><span class="ident" id="6591374">RWLock</span><span class="op" id="6591380">(</span><span class="builtintype" id="6591381">false</span><span class="op" id="6591386">)</span><span class="op" id="6591387">;</span>&nbsp;<span class="ident" id="6591389">mu</span><span class="op" id="6591391">.</span><span class="ident" id="6591392">RWUnlock</span><span class="op" id="6591400">(</span><span class="builtintype" id="6591401">false</span><span class="op" id="6591406">)</span><span class="op" id="6591407">;</span>&nbsp;<span class="ident" id="6591409">mu</span><span class="op" id="6591411">.</span><span class="ident" id="6591412">RWUnlock</span><span class="op" id="6591420">(</span><span class="builtintype" id="6591421">false</span><span class="op" id="6591426">)</span>&nbsp;<span class="op" id="6591428">}</span><span class="op" id="6591429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591433">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591471">mu</span><span class="op" id="6591473">.</span><span class="ident" id="6591474">Incref</span><span class="op" id="6591480">(</span><span class="op" id="6591481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591484">mu</span><span class="op" id="6591486">.</span><span class="ident" id="6591487">Decref</span><span class="op" id="6591493">(</span><span class="op" id="6591494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591497">mu</span><span class="op" id="6591499">.</span><span class="ident" id="6591500">RWLock</span><span class="op" id="6591506">(</span><span class="builtintype" id="6591507">true</span><span class="op" id="6591511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591514">mu</span><span class="op" id="6591516">.</span><span class="ident" id="6591517">RWUnlock</span><span class="op" id="6591525">(</span><span class="builtintype" id="6591526">true</span><span class="op" id="6591530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591533">mu</span><span class="op" id="6591535">.</span><span class="ident" id="6591536">RWLock</span><span class="op" id="6591542">(</span><span class="builtintype" id="6591543">false</span><span class="op" id="6591548">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591551">mu</span><span class="op" id="6591553">.</span><span class="ident" id="6591554">RWUnlock</span><span class="op" id="6591562">(</span><span class="builtintype" id="6591563">false</span><span class="op" id="6591568">)</span><br>
<span class="lineno"></span><span class="op" id="6591570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6591573">func</span>&nbsp;<span class="ident" id="6591578">TestMutexStress</span><span class="op" id="6591593">(</span><span class="ident" id="6591594">t</span>&nbsp;<span class="op" id="6591596">*</span><span class="ident" id="6591597">testing</span><span class="op" id="6591604">.</span><span class="ident" id="6591605">T</span><span class="op" id="6591606">)</span>&nbsp;<span class="op" id="6591608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591611">P</span>&nbsp;<span class="op" id="6591613">:=</span>&nbsp;<span class="num" id="6591616">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591619">N</span>&nbsp;<span class="op" id="6591621">:=</span>&nbsp;<span class="builtintype" id="6591624">int</span><span class="op" id="6591627">(</span><span class="num" id="6591628">1e6</span><span class="op" id="6591631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591634">if</span>&nbsp;<span class="ident" id="6591637">testing</span><span class="op" id="6591644">.</span><span class="ident" id="6591645">Short</span><span class="op" id="6591650">(</span><span class="op" id="6591651">)</span>&nbsp;<span class="op" id="6591653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591657">P</span>&nbsp;<span class="op" id="6591659">=</span>&nbsp;<span class="num" id="6591661">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591665">N</span>&nbsp;<span class="op" id="6591667">=</span>&nbsp;<span class="num" id="6591669">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591674">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591677">defer</span>&nbsp;<span class="ident" id="6591683">runtime</span><span class="op" id="6591690">.</span><span class="ident" id="6591691">GOMAXPROCS</span><span class="op" id="6591701">(</span><span class="ident" id="6591702">runtime</span><span class="op" id="6591709">.</span><span class="ident" id="6591710">GOMAXPROCS</span><span class="op" id="6591720">(</span><span class="ident" id="6591721">P</span><span class="op" id="6591722">)</span><span class="op" id="6591723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591726">done</span>&nbsp;<span class="op" id="6591731">:=</span>&nbsp;<span class="builtinfunc" id="6591734">make</span><span class="op" id="6591738">(</span><span class="keyword" id="6591739">chan</span>&nbsp;<span class="builtintype" id="6591744">bool</span><span class="op" id="6591748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591751">var</span>&nbsp;<span class="ident" id="6591755">mu</span>&nbsp;<span class="ident" id="6591758">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591767">var</span>&nbsp;<span class="ident" id="6591771">readState</span>&nbsp;<span class="op" id="6591781">[</span><span class="num" id="6591782">2</span><span class="op" id="6591783">]</span><span class="ident" id="6591784">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591792">var</span>&nbsp;<span class="ident" id="6591796">writeState</span>&nbsp;<span class="op" id="6591807">[</span><span class="num" id="6591808">2</span><span class="op" id="6591809">]</span><span class="ident" id="6591810">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591818">for</span>&nbsp;<span class="ident" id="6591822">p</span>&nbsp;<span class="op" id="6591824">:=</span>&nbsp;<span class="num" id="6591827">0</span><span class="op" id="6591828">;</span>&nbsp;<span class="ident" id="6591830">p</span>&nbsp;<span class="op" id="6591832">&lt;</span>&nbsp;<span class="ident" id="6591834">P</span><span class="op" id="6591835">;</span>&nbsp;<span class="ident" id="6591837">p</span><span class="op" id="6591838">++</span>&nbsp;<span class="op" id="6591841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591845">go</span>&nbsp;<span class="keyword" id="6591848">func</span><span class="op" id="6591852">(</span><span class="op" id="6591853">)</span>&nbsp;<span class="op" id="6591855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591860">r</span>&nbsp;<span class="op" id="6591862">:=</span>&nbsp;<span class="ident" id="6591865">rand</span><span class="op" id="6591869">.</span><span class="ident" id="6591870">New</span><span class="op" id="6591873">(</span><span class="ident" id="6591874">rand</span><span class="op" id="6591878">.</span><span class="ident" id="6591879">NewSource</span><span class="op" id="6591888">(</span><span class="ident" id="6591889">rand</span><span class="op" id="6591893">.</span><span class="ident" id="6591894">Int63</span><span class="op" id="6591899">(</span><span class="op" id="6591900">)</span><span class="op" id="6591901">)</span><span class="op" id="6591902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591907">for</span>&nbsp;<span class="ident" id="6591911">i</span>&nbsp;<span class="op" id="6591913">:=</span>&nbsp;<span class="num" id="6591916">0</span><span class="op" id="6591917">;</span>&nbsp;<span class="ident" id="6591919">i</span>&nbsp;<span class="op" id="6591921">&lt;</span>&nbsp;<span class="ident" id="6591923">N</span><span class="op" id="6591924">;</span>&nbsp;<span class="ident" id="6591926">i</span><span class="op" id="6591927">++</span>&nbsp;<span class="op" id="6591930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591936">switch</span>&nbsp;<span class="ident" id="6591943">r</span><span class="op" id="6591944">.</span><span class="ident" id="6591945">Intn</span><span class="op" id="6591949">(</span><span class="num" id="6591950">3</span><span class="op" id="6591951">)</span>&nbsp;<span class="op" id="6591953">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591959">case</span>&nbsp;<span class="num" id="6591964">0</span><span class="op" id="6591965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591972">if</span>&nbsp;<span class="op" id="6591975">!</span><span class="ident" id="6591976">mu</span><span class="op" id="6591978">.</span><span class="ident" id="6591979">Incref</span><span class="op" id="6591985">(</span><span class="op" id="6591986">)</span>&nbsp;<span class="op" id="6591988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591996">t</span><span class="op" id="6591997">.</span><span class="ident" id="6591998">Error</span><span class="op" id="6592003">(</span><span class="string" id="6592004">&#34;broken&#34;</span><span class="op" id="6592012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592020">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592032">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592039">if</span>&nbsp;<span class="ident" id="6592042">mu</span><span class="op" id="6592044">.</span><span class="ident" id="6592045">Decref</span><span class="op" id="6592051">(</span><span class="op" id="6592052">)</span>&nbsp;<span class="op" id="6592054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592062">t</span><span class="op" id="6592063">.</span><span class="ident" id="6592064">Error</span><span class="op" id="6592069">(</span><span class="string" id="6592070">&#34;broken&#34;</span><span class="op" id="6592078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592086">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592104">case</span>&nbsp;<span class="num" id="6592109">1</span><span class="op" id="6592110">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592117">if</span>&nbsp;<span class="op" id="6592120">!</span><span class="ident" id="6592121">mu</span><span class="op" id="6592123">.</span><span class="ident" id="6592124">RWLock</span><span class="op" id="6592130">(</span><span class="builtintype" id="6592131">true</span><span class="op" id="6592135">)</span>&nbsp;<span class="op" id="6592137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592145">t</span><span class="op" id="6592146">.</span><span class="ident" id="6592147">Error</span><span class="op" id="6592152">(</span><span class="string" id="6592153">&#34;broken&#34;</span><span class="op" id="6592161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592169">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592188">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592250">if</span>&nbsp;<span class="ident" id="6592253">readState</span><span class="op" id="6592262">[</span><span class="num" id="6592263">0</span><span class="op" id="6592264">]</span>&nbsp;<span class="op" id="6592266">!=</span>&nbsp;<span class="ident" id="6592269">readState</span><span class="op" id="6592278">[</span><span class="num" id="6592279">1</span><span class="op" id="6592280">]</span>&nbsp;<span class="op" id="6592282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592290">t</span><span class="op" id="6592291">.</span><span class="ident" id="6592292">Error</span><span class="op" id="6592297">(</span><span class="string" id="6592298">&#34;broken&#34;</span><span class="op" id="6592306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592333">readState</span><span class="op" id="6592342">[</span><span class="num" id="6592343">0</span><span class="op" id="6592344">]</span><span class="op" id="6592345">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592353">readState</span><span class="op" id="6592362">[</span><span class="num" id="6592363">1</span><span class="op" id="6592364">]</span><span class="op" id="6592365">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592373">if</span>&nbsp;<span class="ident" id="6592376">mu</span><span class="op" id="6592378">.</span><span class="ident" id="6592379">RWUnlock</span><span class="op" id="6592387">(</span><span class="builtintype" id="6592388">true</span><span class="op" id="6592392">)</span>&nbsp;<span class="op" id="6592394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592402">t</span><span class="op" id="6592403">.</span><span class="ident" id="6592404">Error</span><span class="op" id="6592409">(</span><span class="string" id="6592410">&#34;broken&#34;</span><span class="op" id="6592418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592426">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592438">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592444">case</span>&nbsp;<span class="num" id="6592449">2</span><span class="op" id="6592450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592457">if</span>&nbsp;<span class="op" id="6592460">!</span><span class="ident" id="6592461">mu</span><span class="op" id="6592463">.</span><span class="ident" id="6592464">RWLock</span><span class="op" id="6592470">(</span><span class="builtintype" id="6592471">false</span><span class="op" id="6592476">)</span>&nbsp;<span class="op" id="6592478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592486">t</span><span class="op" id="6592487">.</span><span class="ident" id="6592488">Error</span><span class="op" id="6592493">(</span><span class="string" id="6592494">&#34;broken&#34;</span><span class="op" id="6592502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592510">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592522">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592529">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592591">if</span>&nbsp;<span class="ident" id="6592594">writeState</span><span class="op" id="6592604">[</span><span class="num" id="6592605">0</span><span class="op" id="6592606">]</span>&nbsp;<span class="op" id="6592608">!=</span>&nbsp;<span class="ident" id="6592611">writeState</span><span class="op" id="6592621">[</span><span class="num" id="6592622">1</span><span class="op" id="6592623">]</span>&nbsp;<span class="op" id="6592625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592633">t</span><span class="op" id="6592634">.</span><span class="ident" id="6592635">Error</span><span class="op" id="6592640">(</span><span class="string" id="6592641">&#34;broken&#34;</span><span class="op" id="6592649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592657">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592669">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592676">writeState</span><span class="op" id="6592686">[</span><span class="num" id="6592687">0</span><span class="op" id="6592688">]</span><span class="op" id="6592689">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592697">writeState</span><span class="op" id="6592707">[</span><span class="num" id="6592708">1</span><span class="op" id="6592709">]</span><span class="op" id="6592710">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592718">if</span>&nbsp;<span class="ident" id="6592721">mu</span><span class="op" id="6592723">.</span><span class="ident" id="6592724">RWUnlock</span><span class="op" id="6592732">(</span><span class="builtintype" id="6592733">false</span><span class="op" id="6592738">)</span>&nbsp;<span class="op" id="6592740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592748">t</span><span class="op" id="6592749">.</span><span class="ident" id="6592750">Error</span><span class="op" id="6592755">(</span><span class="string" id="6592756">&#34;broken&#34;</span><span class="op" id="6592764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592772">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592800">done</span>&nbsp;<span class="op" id="6592805">&lt;-</span>&nbsp;<span class="builtintype" id="6592808">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592815">}</span><span class="op" id="6592816">(</span><span class="op" id="6592817">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592823">for</span>&nbsp;<span class="ident" id="6592827">p</span>&nbsp;<span class="op" id="6592829">:=</span>&nbsp;<span class="num" id="6592832">0</span><span class="op" id="6592833">;</span>&nbsp;<span class="ident" id="6592835">p</span>&nbsp;<span class="op" id="6592837">&lt;</span>&nbsp;<span class="ident" id="6592839">P</span><span class="op" id="6592840">;</span>&nbsp;<span class="ident" id="6592842">p</span><span class="op" id="6592843">++</span>&nbsp;<span class="op" id="6592846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592850">&lt;-</span><span class="ident" id="6592852">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592861">if</span>&nbsp;<span class="op" id="6592864">!</span><span class="ident" id="6592865">mu</span><span class="op" id="6592867">.</span><span class="ident" id="6592868">IncrefAndClose</span><span class="op" id="6592882">(</span><span class="op" id="6592883">)</span>&nbsp;<span class="op" id="6592885">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592889">t</span><span class="op" id="6592890">.</span><span class="ident" id="6592891">Fatal</span><span class="op" id="6592896">(</span><span class="string" id="6592897">&#34;broken&#34;</span><span class="op" id="6592905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592911">if</span>&nbsp;<span class="op" id="6592914">!</span><span class="ident" id="6592915">mu</span><span class="op" id="6592917">.</span><span class="ident" id="6592918">Decref</span><span class="op" id="6592924">(</span><span class="op" id="6592925">)</span>&nbsp;<span class="op" id="6592927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592931">t</span><span class="op" id="6592932">.</span><span class="ident" id="6592933">Fatal</span><span class="op" id="6592938">(</span><span class="string" id="6592939">&#34;broken&#34;</span><span class="op" id="6592947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592950">}</span><br>
<span class="lineno">195</span><span class="op" id="6592952">}</span>
</div>
</body>
</html>
