<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3482586">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3482641">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3482695">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3482746">//&nbsp;Package&nbsp;mime&nbsp;implements&nbsp;parts&nbsp;of&nbsp;the&nbsp;MIME&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="3482797">package</span>&nbsp;<span class="ident" id="3482805">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3482811">import</span>&nbsp;<span class="op" id="3482818">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3482821">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3482828">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3482839">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3482846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3482849">var</span>&nbsp;<span class="op" id="3482853">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3482856">mimeLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3482871">sync</span><span class="op" id="3482875">.</span><span class="ident" id="3482876">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3482885">mimeTypesLower</span>&nbsp;<span class="op" id="3482900">=</span>&nbsp;<span class="keyword" id="3482902">map</span><span class="op" id="3482905">[</span><span class="builtintype" id="3482906">string</span><span class="op" id="3482912">]</span><span class="builtintype" id="3482913">string</span><span class="op" id="3482919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3482923">&#34;.css&#34;</span><span class="op" id="3482929">:</span>&nbsp;&nbsp;<span class="string" id="3482932">&#34;text/css;&nbsp;charset=utf-8&#34;</span><span class="op" id="3482957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3482961">&#34;.gif&#34;</span><span class="op" id="3482967">:</span>&nbsp;&nbsp;<span class="string" id="3482970">&#34;image/gif&#34;</span><span class="op" id="3482981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3482985">&#34;.htm&#34;</span><span class="op" id="3482991">:</span>&nbsp;&nbsp;<span class="string" id="3482994">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="3483020">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483024">&#34;.html&#34;</span><span class="op" id="3483031">:</span>&nbsp;<span class="string" id="3483033">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="3483059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483063">&#34;.jpg&#34;</span><span class="op" id="3483069">:</span>&nbsp;&nbsp;<span class="string" id="3483072">&#34;image/jpeg&#34;</span><span class="op" id="3483084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483088">&#34;.js&#34;</span><span class="op" id="3483093">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3483097">&#34;application/x-javascript&#34;</span><span class="op" id="3483123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483127">&#34;.pdf&#34;</span><span class="op" id="3483133">:</span>&nbsp;&nbsp;<span class="string" id="3483136">&#34;application/pdf&#34;</span><span class="op" id="3483153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483157">&#34;.png&#34;</span><span class="op" id="3483163">:</span>&nbsp;&nbsp;<span class="string" id="3483166">&#34;image/png&#34;</span><span class="op" id="3483177">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3483181">&#34;.xml&#34;</span><span class="op" id="3483187">:</span>&nbsp;&nbsp;<span class="string" id="3483190">&#34;text/xml;&nbsp;charset=utf-8&#34;</span><span class="op" id="3483215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3483218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3483221">mimeTypes</span>&nbsp;<span class="op" id="3483231">=</span>&nbsp;<span class="ident" id="3483233">clone</span><span class="op" id="3483238">(</span><span class="ident" id="3483239">mimeTypesLower</span><span class="op" id="3483253">)</span><br>
<span class="lineno"></span><span class="op" id="3483255">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="3483258">func</span>&nbsp;<span class="ident" id="3483263">clone</span><span class="op" id="3483268">(</span><span class="ident" id="3483269">m</span>&nbsp;<span class="keyword" id="3483271">map</span><span class="op" id="3483274">[</span><span class="builtintype" id="3483275">string</span><span class="op" id="3483281">]</span><span class="builtintype" id="3483282">string</span><span class="op" id="3483288">)</span>&nbsp;<span class="keyword" id="3483290">map</span><span class="op" id="3483293">[</span><span class="builtintype" id="3483294">string</span><span class="op" id="3483300">]</span><span class="builtintype" id="3483301">string</span>&nbsp;<span class="op" id="3483308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3483311">m2</span>&nbsp;<span class="op" id="3483314">:=</span>&nbsp;<span class="builtinfunc" id="3483317">make</span><span class="op" id="3483321">(</span><span class="keyword" id="3483322">map</span><span class="op" id="3483325">[</span><span class="builtintype" id="3483326">string</span><span class="op" id="3483332">]</span><span class="builtintype" id="3483333">string</span><span class="op" id="3483339">,</span>&nbsp;<span class="builtinfunc" id="3483341">len</span><span class="op" id="3483344">(</span><span class="ident" id="3483345">m</span><span class="op" id="3483346">)</span><span class="op" id="3483347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3483350">for</span>&nbsp;<span class="ident" id="3483354">k</span><span class="op" id="3483355">,</span>&nbsp;<span class="ident" id="3483357">v</span>&nbsp;<span class="op" id="3483359">:=</span>&nbsp;<span class="keyword" id="3483362">range</span>&nbsp;<span class="ident" id="3483368">m</span>&nbsp;<span class="op" id="3483370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3483374">m2</span><span class="op" id="3483376">[</span><span class="ident" id="3483377">k</span><span class="op" id="3483378">]</span>&nbsp;<span class="op" id="3483380">=</span>&nbsp;<span class="ident" id="3483382">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3483386">if</span>&nbsp;<span class="ident" id="3483389">strings</span><span class="op" id="3483396">.</span><span class="ident" id="3483397">ToLower</span><span class="op" id="3483404">(</span><span class="ident" id="3483405">k</span><span class="op" id="3483406">)</span>&nbsp;<span class="op" id="3483408">!=</span>&nbsp;<span class="ident" id="3483411">k</span>&nbsp;<span class="op" id="3483413">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3483418">panic</span><span class="op" id="3483423">(</span><span class="string" id="3483424">&#34;keys&nbsp;in&nbsp;mimeTypesLower&nbsp;must&nbsp;be&nbsp;lowercase&#34;</span><span class="op" id="3483466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3483470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3483473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3483476">return</span>&nbsp;<span class="ident" id="3483483">m2</span><br>
<span class="lineno"></span><span class="op" id="3483486">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3483489">var</span>&nbsp;<span class="ident" id="3483493">once</span>&nbsp;<span class="ident" id="3483498">sync</span><span class="op" id="3483502">.</span><span class="ident" id="3483503">Once</span>&nbsp;<span class="comment" id="3483508">//&nbsp;guards&nbsp;initMime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3483528">//&nbsp;TypeByExtension&nbsp;returns&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;file&nbsp;extension&nbsp;ext.</span><br>
<span class="lineno"></span><span class="comment" id="3483609">//&nbsp;The&nbsp;extension&nbsp;ext&nbsp;should&nbsp;begin&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno">45</span><span class="comment" id="3483678">//&nbsp;When&nbsp;ext&nbsp;has&nbsp;no&nbsp;associated&nbsp;type,&nbsp;TypeByExtension&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3483742">//</span><br>
<span class="lineno"></span><span class="comment" id="3483745">//&nbsp;Extensions&nbsp;are&nbsp;looked&nbsp;up&nbsp;first&nbsp;case-sensitively,&nbsp;then&nbsp;case-insensitively.</span><br>
<span class="lineno"></span><span class="comment" id="3483822">//</span><br>
<span class="lineno"></span><span class="comment" id="3483825">//&nbsp;The&nbsp;built-in&nbsp;table&nbsp;is&nbsp;small&nbsp;but&nbsp;on&nbsp;unix&nbsp;it&nbsp;is&nbsp;augmented&nbsp;by&nbsp;the&nbsp;local</span><br>
<span class="lineno">50</span><span class="comment" id="3483897">//&nbsp;system&#39;s&nbsp;mime.types&nbsp;file(s)&nbsp;if&nbsp;available&nbsp;under&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;these</span><br>
<span class="lineno"></span><span class="comment" id="3483968">//&nbsp;names:</span><br>
<span class="lineno"></span><span class="comment" id="3483978">//</span><br>
<span class="lineno"></span><span class="comment" id="3483981">//&nbsp;&nbsp;&nbsp;/etc/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="3484002">//&nbsp;&nbsp;&nbsp;/etc/apache2/mime.types</span><br>
<span class="lineno">55</span><span class="comment" id="3484031">//&nbsp;&nbsp;&nbsp;/etc/apache/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="3484059">//</span><br>
<span class="lineno"></span><span class="comment" id="3484062">//&nbsp;On&nbsp;Windows,&nbsp;MIME&nbsp;types&nbsp;are&nbsp;extracted&nbsp;from&nbsp;the&nbsp;registry.</span><br>
<span class="lineno"></span><span class="comment" id="3484121">//</span><br>
<span class="lineno"></span><span class="comment" id="3484124">//&nbsp;Text&nbsp;types&nbsp;have&nbsp;the&nbsp;charset&nbsp;parameter&nbsp;set&nbsp;to&nbsp;&#34;utf-8&#34;&nbsp;by&nbsp;default.</span><br>
<span class="lineno">60</span><span class="keyword" id="3484192">func</span>&nbsp;<span class="ident" id="3484197">TypeByExtension</span><span class="op" id="3484212">(</span><span class="ident" id="3484213">ext</span>&nbsp;<span class="builtintype" id="3484217">string</span><span class="op" id="3484223">)</span>&nbsp;<span class="builtintype" id="3484225">string</span>&nbsp;<span class="op" id="3484232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484235">once</span><span class="op" id="3484239">.</span><span class="ident" id="3484240">Do</span><span class="op" id="3484242">(</span><span class="ident" id="3484243">initMime</span><span class="op" id="3484251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484254">mimeLock</span><span class="op" id="3484262">.</span><span class="ident" id="3484263">RLock</span><span class="op" id="3484268">(</span><span class="op" id="3484269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484272">defer</span>&nbsp;<span class="ident" id="3484278">mimeLock</span><span class="op" id="3484286">.</span><span class="ident" id="3484287">RUnlock</span><span class="op" id="3484294">(</span><span class="op" id="3484295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484299">//&nbsp;Case-sensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484326">v</span>&nbsp;<span class="op" id="3484328">:=</span>&nbsp;<span class="ident" id="3484331">mimeTypes</span><span class="op" id="3484340">[</span><span class="ident" id="3484341">ext</span><span class="op" id="3484344">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484347">if</span>&nbsp;<span class="ident" id="3484350">v</span>&nbsp;<span class="op" id="3484352">!=</span>&nbsp;<span class="string" id="3484355">&#34;&#34;</span>&nbsp;<span class="op" id="3484358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484362">return</span>&nbsp;<span class="ident" id="3484369">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3484372">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484376">//&nbsp;Case-insensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484405">//&nbsp;Optimistically&nbsp;assume&nbsp;a&nbsp;short&nbsp;ASCII&nbsp;extension&nbsp;and&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484462">//&nbsp;allocation-free&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484496">var</span>&nbsp;<span class="ident" id="3484500">buf</span>&nbsp;<span class="op" id="3484504">[</span><span class="num" id="3484505">10</span><span class="op" id="3484507">]</span><span class="builtintype" id="3484508">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484514">lower</span>&nbsp;<span class="op" id="3484520">:=</span>&nbsp;<span class="ident" id="3484523">buf</span><span class="op" id="3484526">[</span><span class="op" id="3484527">:</span><span class="num" id="3484528">0</span><span class="op" id="3484529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484532">const</span>&nbsp;<span class="ident" id="3484538">utf8RuneSelf</span>&nbsp;<span class="op" id="3484551">=</span>&nbsp;<span class="num" id="3484553">0x80</span>&nbsp;<span class="comment" id="3484558">//&nbsp;from&nbsp;utf8&nbsp;package,&nbsp;but&nbsp;not&nbsp;importing&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484603">for</span>&nbsp;<span class="ident" id="3484607">i</span>&nbsp;<span class="op" id="3484609">:=</span>&nbsp;<span class="num" id="3484612">0</span><span class="op" id="3484613">;</span>&nbsp;<span class="ident" id="3484615">i</span>&nbsp;<span class="op" id="3484617">&lt;</span>&nbsp;<span class="builtinfunc" id="3484619">len</span><span class="op" id="3484622">(</span><span class="ident" id="3484623">ext</span><span class="op" id="3484626">)</span><span class="op" id="3484627">;</span>&nbsp;<span class="ident" id="3484629">i</span><span class="op" id="3484630">++</span>&nbsp;<span class="op" id="3484633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484637">c</span>&nbsp;<span class="op" id="3484639">:=</span>&nbsp;<span class="ident" id="3484642">ext</span><span class="op" id="3484645">[</span><span class="ident" id="3484646">i</span><span class="op" id="3484647">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484651">if</span>&nbsp;<span class="ident" id="3484654">c</span>&nbsp;<span class="op" id="3484656">&gt;=</span>&nbsp;<span class="ident" id="3484659">utf8RuneSelf</span>&nbsp;<span class="op" id="3484672">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484677">//&nbsp;Slow&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484694">return</span>&nbsp;<span class="ident" id="3484701">mimeTypesLower</span><span class="op" id="3484715">[</span><span class="ident" id="3484716">strings</span><span class="op" id="3484723">.</span><span class="ident" id="3484724">ToLower</span><span class="op" id="3484731">(</span><span class="ident" id="3484732">ext</span><span class="op" id="3484735">)</span><span class="op" id="3484736">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3484740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484744">if</span>&nbsp;<span class="string" id="3484747">&#39;A&#39;</span>&nbsp;<span class="op" id="3484751">&lt;=</span>&nbsp;<span class="ident" id="3484754">c</span>&nbsp;<span class="op" id="3484756">&amp;&amp;</span>&nbsp;<span class="ident" id="3484759">c</span>&nbsp;<span class="op" id="3484761">&lt;=</span>&nbsp;<span class="string" id="3484764">&#39;Z&#39;</span>&nbsp;<span class="op" id="3484768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484773">lower</span>&nbsp;<span class="op" id="3484779">=</span>&nbsp;<span class="builtinfunc" id="3484781">append</span><span class="op" id="3484787">(</span><span class="ident" id="3484788">lower</span><span class="op" id="3484793">,</span>&nbsp;<span class="ident" id="3484795">c</span><span class="op" id="3484796">+</span><span class="op" id="3484797">(</span><span class="string" id="3484798">&#39;a&#39;</span><span class="op" id="3484801">-</span><span class="string" id="3484802">&#39;A&#39;</span><span class="op" id="3484805">)</span><span class="op" id="3484806">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3484810">}</span>&nbsp;<span class="keyword" id="3484812">else</span>&nbsp;<span class="op" id="3484817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3484822">lower</span>&nbsp;<span class="op" id="3484828">=</span>&nbsp;<span class="builtinfunc" id="3484830">append</span><span class="op" id="3484836">(</span><span class="ident" id="3484837">lower</span><span class="op" id="3484842">,</span>&nbsp;<span class="ident" id="3484844">c</span><span class="op" id="3484845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3484849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3484852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484855">//&nbsp;The&nbsp;conversion&nbsp;from&nbsp;[]byte&nbsp;to&nbsp;string&nbsp;doesn&#39;t&nbsp;allocate&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3484916">//&nbsp;a&nbsp;map&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3484934">return</span>&nbsp;<span class="ident" id="3484941">mimeTypesLower</span><span class="op" id="3484955">[</span><span class="builtintype" id="3484956">string</span><span class="op" id="3484962">(</span><span class="ident" id="3484963">lower</span><span class="op" id="3484968">)</span><span class="op" id="3484969">]</span><br>
<span class="lineno"></span><span class="op" id="3484971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3484974">//&nbsp;AddExtensionType&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with</span><br>
<span class="lineno">95</span><span class="comment" id="3485029">//&nbsp;the&nbsp;extension&nbsp;ext&nbsp;to&nbsp;typ.&nbsp;The&nbsp;extension&nbsp;should&nbsp;begin&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3485090">//&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3485123">func</span>&nbsp;<span class="ident" id="3485128">AddExtensionType</span><span class="op" id="3485144">(</span><span class="ident" id="3485145">ext</span><span class="op" id="3485148">,</span>&nbsp;<span class="ident" id="3485150">typ</span>&nbsp;<span class="builtintype" id="3485154">string</span><span class="op" id="3485160">)</span>&nbsp;<span class="builtintype" id="3485162">error</span>&nbsp;<span class="op" id="3485168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485171">if</span>&nbsp;<span class="op" id="3485174">!</span><span class="ident" id="3485175">strings</span><span class="op" id="3485182">.</span><span class="ident" id="3485183">HasPrefix</span><span class="op" id="3485192">(</span><span class="ident" id="3485193">ext</span><span class="op" id="3485196">,</span>&nbsp;<span class="string" id="3485198">&#34;.&#34;</span><span class="op" id="3485201">)</span>&nbsp;<span class="op" id="3485203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485207">return</span>&nbsp;<span class="ident" id="3485214">fmt</span><span class="op" id="3485217">.</span><span class="ident" id="3485218">Errorf</span><span class="op" id="3485224">(</span><span class="string" id="3485225">`mime:&nbsp;extension&nbsp;%q&nbsp;misses&nbsp;dot`</span><span class="op" id="3485256">,</span>&nbsp;<span class="ident" id="3485258">ext</span><span class="op" id="3485261">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3485264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485267">once</span><span class="op" id="3485271">.</span><span class="ident" id="3485272">Do</span><span class="op" id="3485274">(</span><span class="ident" id="3485275">initMime</span><span class="op" id="3485283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485286">return</span>&nbsp;<span class="ident" id="3485293">setExtensionType</span><span class="op" id="3485309">(</span><span class="ident" id="3485310">ext</span><span class="op" id="3485313">,</span>&nbsp;<span class="ident" id="3485315">typ</span><span class="op" id="3485318">)</span><br>
<span class="lineno"></span><span class="op" id="3485320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="3485323">func</span>&nbsp;<span class="ident" id="3485328">setExtensionType</span><span class="op" id="3485344">(</span><span class="ident" id="3485345">extension</span><span class="op" id="3485354">,</span>&nbsp;<span class="ident" id="3485356">mimeType</span>&nbsp;<span class="builtintype" id="3485365">string</span><span class="op" id="3485371">)</span>&nbsp;<span class="builtintype" id="3485373">error</span>&nbsp;<span class="op" id="3485379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485382">_</span><span class="op" id="3485383">,</span>&nbsp;<span class="ident" id="3485385">param</span><span class="op" id="3485390">,</span>&nbsp;<span class="ident" id="3485392">err</span>&nbsp;<span class="op" id="3485396">:=</span>&nbsp;<span class="ident" id="3485399">ParseMediaType</span><span class="op" id="3485413">(</span><span class="ident" id="3485414">mimeType</span><span class="op" id="3485422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485425">if</span>&nbsp;<span class="ident" id="3485428">err</span>&nbsp;<span class="op" id="3485432">!=</span>&nbsp;<span class="ident" id="3485435">nil</span>&nbsp;<span class="op" id="3485439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485443">return</span>&nbsp;<span class="ident" id="3485450">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3485455">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485458">if</span>&nbsp;<span class="ident" id="3485461">strings</span><span class="op" id="3485468">.</span><span class="ident" id="3485469">HasPrefix</span><span class="op" id="3485478">(</span><span class="ident" id="3485479">mimeType</span><span class="op" id="3485487">,</span>&nbsp;<span class="string" id="3485489">&#34;text/&#34;</span><span class="op" id="3485496">)</span>&nbsp;<span class="op" id="3485498">&amp;&amp;</span>&nbsp;<span class="ident" id="3485501">param</span><span class="op" id="3485506">[</span><span class="string" id="3485507">&#34;charset&#34;</span><span class="op" id="3485516">]</span>&nbsp;<span class="op" id="3485518">==</span>&nbsp;<span class="string" id="3485521">&#34;&#34;</span>&nbsp;<span class="op" id="3485524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485528">param</span><span class="op" id="3485533">[</span><span class="string" id="3485534">&#34;charset&#34;</span><span class="op" id="3485543">]</span>&nbsp;<span class="op" id="3485545">=</span>&nbsp;<span class="string" id="3485547">&#34;utf-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485557">mimeType</span>&nbsp;<span class="op" id="3485566">=</span>&nbsp;<span class="ident" id="3485568">FormatMediaType</span><span class="op" id="3485583">(</span><span class="ident" id="3485584">mimeType</span><span class="op" id="3485592">,</span>&nbsp;<span class="ident" id="3485594">param</span><span class="op" id="3485599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3485602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485605">extLower</span>&nbsp;<span class="op" id="3485614">:=</span>&nbsp;<span class="ident" id="3485617">strings</span><span class="op" id="3485624">.</span><span class="ident" id="3485625">ToLower</span><span class="op" id="3485632">(</span><span class="ident" id="3485633">extension</span><span class="op" id="3485642">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485646">mimeLock</span><span class="op" id="3485654">.</span><span class="ident" id="3485655">Lock</span><span class="op" id="3485659">(</span><span class="op" id="3485660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485663">mimeTypes</span><span class="op" id="3485672">[</span><span class="ident" id="3485673">extension</span><span class="op" id="3485682">]</span>&nbsp;<span class="op" id="3485684">=</span>&nbsp;<span class="ident" id="3485686">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485696">mimeTypesLower</span><span class="op" id="3485710">[</span><span class="ident" id="3485711">extLower</span><span class="op" id="3485719">]</span>&nbsp;<span class="op" id="3485721">=</span>&nbsp;<span class="ident" id="3485723">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3485733">mimeLock</span><span class="op" id="3485741">.</span><span class="ident" id="3485742">Unlock</span><span class="op" id="3485748">(</span><span class="op" id="3485749">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3485752">return</span>&nbsp;<span class="ident" id="3485759">nil</span><br>
<span class="lineno"></span><span class="op" id="3485763">}</span>
</div>
</body>
</html>
