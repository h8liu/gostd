<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6496907">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6496963">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6497017">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6497068">package</span>&nbsp;<span class="ident" id="6497076">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6497083">import</span>&nbsp;<span class="op" id="6497090">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6497093">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6497104">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6497112">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6497119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6497122">//&nbsp;GCStats&nbsp;collect&nbsp;information&nbsp;about&nbsp;recent&nbsp;garbage&nbsp;collections.</span><br>
<span class="lineno"></span><span class="keyword" id="6497187">type</span>&nbsp;<span class="ident" id="6497192">GCStats</span>&nbsp;<span class="keyword" id="6497200">struct</span>&nbsp;<span class="op" id="6497207">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497210">LastGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497225">time</span><span class="op" id="6497229">.</span><span class="ident" id="6497230">Time</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497241">//&nbsp;time&nbsp;of&nbsp;last&nbsp;collection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497269">NumGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497284">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497300">//&nbsp;number&nbsp;of&nbsp;garbage&nbsp;collections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497334">PauseTotal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6497349">time</span><span class="op" id="6497353">.</span><span class="ident" id="6497354">Duration</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6497365">//&nbsp;total&nbsp;pause&nbsp;for&nbsp;all&nbsp;collections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497401">Pause</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497416">[</span><span class="op" id="6497417">]</span><span class="ident" id="6497418">time</span><span class="op" id="6497422">.</span><span class="ident" id="6497423">Duration</span>&nbsp;<span class="comment" id="6497432">//&nbsp;pause&nbsp;history,&nbsp;most&nbsp;recent&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497469">PauseEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6497484">[</span><span class="op" id="6497485">]</span><span class="ident" id="6497486">time</span><span class="op" id="6497490">.</span><span class="ident" id="6497491">Time</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6497500">//&nbsp;pause&nbsp;end&nbsp;times&nbsp;history,&nbsp;most&nbsp;recent&nbsp;first</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6497547">PauseQuantiles</span>&nbsp;<span class="op" id="6497562">[</span><span class="op" id="6497563">]</span><span class="ident" id="6497564">time</span><span class="op" id="6497568">.</span><span class="ident" id="6497569">Duration</span><br>
<span class="lineno"></span><span class="op" id="6497578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6497581">//&nbsp;ReadGCStats&nbsp;reads&nbsp;statistics&nbsp;about&nbsp;garbage&nbsp;collection&nbsp;into&nbsp;stats.</span><br>
<span class="lineno"></span><span class="comment" id="6497650">//&nbsp;The&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;pause&nbsp;history&nbsp;is&nbsp;system-dependent;</span><br>
<span class="lineno">25</span><span class="comment" id="6497717">//&nbsp;stats.Pause&nbsp;slice&nbsp;will&nbsp;be&nbsp;reused&nbsp;if&nbsp;large&nbsp;enough,&nbsp;reallocated&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="6497793">//&nbsp;ReadGCStats&nbsp;may&nbsp;use&nbsp;the&nbsp;full&nbsp;capacity&nbsp;of&nbsp;the&nbsp;stats.Pause&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="6497860">//&nbsp;If&nbsp;stats.PauseQuantiles&nbsp;is&nbsp;non-empty,&nbsp;ReadGCStats&nbsp;fills&nbsp;it&nbsp;with&nbsp;quantiles</span><br>
<span class="lineno"></span><span class="comment" id="6497937">//&nbsp;summarizing&nbsp;the&nbsp;distribution&nbsp;of&nbsp;pause&nbsp;time.&nbsp;For&nbsp;example,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6498000">//&nbsp;len(stats.PauseQuantiles)&nbsp;is&nbsp;5,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with&nbsp;the&nbsp;minimum,</span><br>
<span class="lineno">30</span><span class="comment" id="6498071">//&nbsp;25%,&nbsp;50%,&nbsp;75%,&nbsp;and&nbsp;maximum&nbsp;pause&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="6498114">func</span>&nbsp;<span class="ident" id="6498119">ReadGCStats</span><span class="op" id="6498130">(</span><span class="ident" id="6498131">stats</span>&nbsp;<span class="op" id="6498137">*</span><span class="ident" id="6498138">GCStats</span><span class="op" id="6498145">)</span>&nbsp;<span class="op" id="6498147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498150">//&nbsp;Create&nbsp;a&nbsp;buffer&nbsp;with&nbsp;space&nbsp;for&nbsp;at&nbsp;least&nbsp;two&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498212">//&nbsp;pause&nbsp;history&nbsp;tracked&nbsp;by&nbsp;the&nbsp;runtime.&nbsp;One&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498275">//&nbsp;to&nbsp;the&nbsp;caller&nbsp;and&nbsp;the&nbsp;other&nbsp;will&nbsp;be&nbsp;used&nbsp;as&nbsp;transfer&nbsp;buffer</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498339">//&nbsp;for&nbsp;end&nbsp;times&nbsp;history&nbsp;and&nbsp;as&nbsp;a&nbsp;temporary&nbsp;buffer&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498395">//&nbsp;computing&nbsp;quantiles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498420">const</span>&nbsp;<span class="ident" id="6498426">maxPause</span>&nbsp;<span class="op" id="6498435">=</span>&nbsp;<span class="builtinfunc" id="6498437">len</span><span class="op" id="6498440">(</span><span class="op" id="6498441">(</span><span class="op" id="6498442">(</span><span class="op" id="6498443">*</span><span class="ident" id="6498444">runtime</span><span class="op" id="6498451">.</span><span class="ident" id="6498452">MemStats</span><span class="op" id="6498460">)</span><span class="op" id="6498461">(</span><span class="ident" id="6498462">nil</span><span class="op" id="6498465">)</span><span class="op" id="6498466">)</span><span class="op" id="6498467">.</span><span class="ident" id="6498468">PauseNs</span><span class="op" id="6498475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6498478">if</span>&nbsp;<span class="builtinfunc" id="6498481">cap</span><span class="op" id="6498484">(</span><span class="ident" id="6498485">stats</span><span class="op" id="6498490">.</span><span class="ident" id="6498491">Pause</span><span class="op" id="6498496">)</span>&nbsp;<span class="op" id="6498498">&lt;</span>&nbsp;<span class="num" id="6498500">2</span><span class="op" id="6498501">*</span><span class="ident" id="6498502">maxPause</span><span class="op" id="6498510">+</span><span class="num" id="6498511">3</span>&nbsp;<span class="op" id="6498513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498517">stats</span><span class="op" id="6498522">.</span><span class="ident" id="6498523">Pause</span>&nbsp;<span class="op" id="6498529">=</span>&nbsp;<span class="builtinfunc" id="6498531">make</span><span class="op" id="6498535">(</span><span class="op" id="6498536">[</span><span class="op" id="6498537">]</span><span class="ident" id="6498538">time</span><span class="op" id="6498542">.</span><span class="ident" id="6498543">Duration</span><span class="op" id="6498551">,</span>&nbsp;<span class="num" id="6498553">2</span><span class="op" id="6498554">*</span><span class="ident" id="6498555">maxPause</span><span class="op" id="6498563">+</span><span class="num" id="6498564">3</span><span class="op" id="6498565">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6498568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498572">//&nbsp;readGCStats&nbsp;fills&nbsp;in&nbsp;the&nbsp;pause&nbsp;and&nbsp;end&nbsp;times&nbsp;histories&nbsp;(up&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498638">//&nbsp;maxPause&nbsp;entries)&nbsp;and&nbsp;then&nbsp;three&nbsp;more:&nbsp;Unix&nbsp;ns&nbsp;time&nbsp;of&nbsp;last&nbsp;GC,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498706">//&nbsp;number&nbsp;of&nbsp;GC,&nbsp;and&nbsp;total&nbsp;pause&nbsp;time&nbsp;in&nbsp;nanoseconds.&nbsp;Here&nbsp;we</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498769">//&nbsp;depend&nbsp;on&nbsp;the&nbsp;fact&nbsp;that&nbsp;time.Duration&#39;s&nbsp;native&nbsp;unit&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498828">//&nbsp;nanoseconds,&nbsp;so&nbsp;the&nbsp;pauses&nbsp;and&nbsp;the&nbsp;total&nbsp;pause&nbsp;time&nbsp;do&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6498896">//&nbsp;any&nbsp;conversion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498916">readGCStats</span><span class="op" id="6498927">(</span><span class="op" id="6498928">&amp;</span><span class="ident" id="6498929">stats</span><span class="op" id="6498934">.</span><span class="ident" id="6498935">Pause</span><span class="op" id="6498940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498943">n</span>&nbsp;<span class="op" id="6498945">:=</span>&nbsp;<span class="builtinfunc" id="6498948">len</span><span class="op" id="6498951">(</span><span class="ident" id="6498952">stats</span><span class="op" id="6498957">.</span><span class="ident" id="6498958">Pause</span><span class="op" id="6498963">)</span>&nbsp;<span class="op" id="6498965">-</span>&nbsp;<span class="num" id="6498967">3</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6498970">stats</span><span class="op" id="6498975">.</span><span class="ident" id="6498976">LastGC</span>&nbsp;<span class="op" id="6498983">=</span>&nbsp;<span class="ident" id="6498985">time</span><span class="op" id="6498989">.</span><span class="ident" id="6498990">Unix</span><span class="op" id="6498994">(</span><span class="num" id="6498995">0</span><span class="op" id="6498996">,</span>&nbsp;<span class="ident" id="6498998">int64</span><span class="op" id="6499003">(</span><span class="ident" id="6499004">stats</span><span class="op" id="6499009">.</span><span class="ident" id="6499010">Pause</span><span class="op" id="6499015">[</span><span class="ident" id="6499016">n</span><span class="op" id="6499017">]</span><span class="op" id="6499018">)</span><span class="op" id="6499019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499022">stats</span><span class="op" id="6499027">.</span><span class="ident" id="6499028">NumGC</span>&nbsp;<span class="op" id="6499034">=</span>&nbsp;<span class="ident" id="6499036">int64</span><span class="op" id="6499041">(</span><span class="ident" id="6499042">stats</span><span class="op" id="6499047">.</span><span class="ident" id="6499048">Pause</span><span class="op" id="6499053">[</span><span class="ident" id="6499054">n</span><span class="op" id="6499055">+</span><span class="num" id="6499056">1</span><span class="op" id="6499057">]</span><span class="op" id="6499058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499061">stats</span><span class="op" id="6499066">.</span><span class="ident" id="6499067">PauseTotal</span>&nbsp;<span class="op" id="6499078">=</span>&nbsp;<span class="ident" id="6499080">stats</span><span class="op" id="6499085">.</span><span class="ident" id="6499086">Pause</span><span class="op" id="6499091">[</span><span class="ident" id="6499092">n</span><span class="op" id="6499093">+</span><span class="num" id="6499094">2</span><span class="op" id="6499095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499098">n</span>&nbsp;<span class="op" id="6499100">/=</span>&nbsp;<span class="num" id="6499103">2</span>&nbsp;<span class="comment" id="6499105">//&nbsp;buffer&nbsp;holds&nbsp;pauses&nbsp;and&nbsp;end&nbsp;times</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499143">stats</span><span class="op" id="6499148">.</span><span class="ident" id="6499149">Pause</span>&nbsp;<span class="op" id="6499155">=</span>&nbsp;<span class="ident" id="6499157">stats</span><span class="op" id="6499162">.</span><span class="ident" id="6499163">Pause</span><span class="op" id="6499168">[</span><span class="op" id="6499169">:</span><span class="ident" id="6499170">n</span><span class="op" id="6499171">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499175">if</span>&nbsp;<span class="builtinfunc" id="6499178">cap</span><span class="op" id="6499181">(</span><span class="ident" id="6499182">stats</span><span class="op" id="6499187">.</span><span class="ident" id="6499188">PauseEnd</span><span class="op" id="6499196">)</span>&nbsp;<span class="op" id="6499198">&lt;</span>&nbsp;<span class="ident" id="6499200">maxPause</span>&nbsp;<span class="op" id="6499209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499213">stats</span><span class="op" id="6499218">.</span><span class="ident" id="6499219">PauseEnd</span>&nbsp;<span class="op" id="6499228">=</span>&nbsp;<span class="builtinfunc" id="6499230">make</span><span class="op" id="6499234">(</span><span class="op" id="6499235">[</span><span class="op" id="6499236">]</span><span class="ident" id="6499237">time</span><span class="op" id="6499241">.</span><span class="ident" id="6499242">Time</span><span class="op" id="6499246">,</span>&nbsp;<span class="num" id="6499248">0</span><span class="op" id="6499249">,</span>&nbsp;<span class="ident" id="6499251">maxPause</span><span class="op" id="6499259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499265">stats</span><span class="op" id="6499270">.</span><span class="ident" id="6499271">PauseEnd</span>&nbsp;<span class="op" id="6499280">=</span>&nbsp;<span class="ident" id="6499282">stats</span><span class="op" id="6499287">.</span><span class="ident" id="6499288">PauseEnd</span><span class="op" id="6499296">[</span><span class="op" id="6499297">:</span><span class="num" id="6499298">0</span><span class="op" id="6499299">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499302">for</span>&nbsp;<span class="ident" id="6499306">_</span><span class="op" id="6499307">,</span>&nbsp;<span class="ident" id="6499309">ns</span>&nbsp;<span class="op" id="6499312">:=</span>&nbsp;<span class="keyword" id="6499315">range</span>&nbsp;<span class="ident" id="6499321">stats</span><span class="op" id="6499326">.</span><span class="ident" id="6499327">Pause</span><span class="op" id="6499332">[</span><span class="ident" id="6499333">n</span>&nbsp;<span class="op" id="6499335">:</span>&nbsp;<span class="ident" id="6499337">n</span><span class="op" id="6499338">+</span><span class="ident" id="6499339">n</span><span class="op" id="6499340">]</span>&nbsp;<span class="op" id="6499342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499346">stats</span><span class="op" id="6499351">.</span><span class="ident" id="6499352">PauseEnd</span>&nbsp;<span class="op" id="6499361">=</span>&nbsp;<span class="builtinfunc" id="6499363">append</span><span class="op" id="6499369">(</span><span class="ident" id="6499370">stats</span><span class="op" id="6499375">.</span><span class="ident" id="6499376">PauseEnd</span><span class="op" id="6499384">,</span>&nbsp;<span class="ident" id="6499386">time</span><span class="op" id="6499390">.</span><span class="ident" id="6499391">Unix</span><span class="op" id="6499395">(</span><span class="num" id="6499396">0</span><span class="op" id="6499397">,</span>&nbsp;<span class="ident" id="6499399">int64</span><span class="op" id="6499404">(</span><span class="ident" id="6499405">ns</span><span class="op" id="6499407">)</span><span class="op" id="6499408">)</span><span class="op" id="6499409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499416">if</span>&nbsp;<span class="builtinfunc" id="6499419">len</span><span class="op" id="6499422">(</span><span class="ident" id="6499423">stats</span><span class="op" id="6499428">.</span><span class="ident" id="6499429">PauseQuantiles</span><span class="op" id="6499443">)</span>&nbsp;<span class="op" id="6499445">&gt;</span>&nbsp;<span class="num" id="6499447">0</span>&nbsp;<span class="op" id="6499449">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499453">if</span>&nbsp;<span class="ident" id="6499456">n</span>&nbsp;<span class="op" id="6499458">==</span>&nbsp;<span class="num" id="6499461">0</span>&nbsp;<span class="op" id="6499463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499468">for</span>&nbsp;<span class="ident" id="6499472">i</span>&nbsp;<span class="op" id="6499474">:=</span>&nbsp;<span class="keyword" id="6499477">range</span>&nbsp;<span class="ident" id="6499483">stats</span><span class="op" id="6499488">.</span><span class="ident" id="6499489">PauseQuantiles</span>&nbsp;<span class="op" id="6499504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499510">stats</span><span class="op" id="6499515">.</span><span class="ident" id="6499516">PauseQuantiles</span><span class="op" id="6499530">[</span><span class="ident" id="6499531">i</span><span class="op" id="6499532">]</span>&nbsp;<span class="op" id="6499534">=</span>&nbsp;<span class="num" id="6499536">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499545">}</span>&nbsp;<span class="keyword" id="6499547">else</span>&nbsp;<span class="op" id="6499552">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6499557">//&nbsp;There&#39;s&nbsp;room&nbsp;for&nbsp;a&nbsp;second&nbsp;copy&nbsp;of&nbsp;the&nbsp;data&nbsp;in&nbsp;stats.Pause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6499622">//&nbsp;See&nbsp;the&nbsp;allocation&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499675">sorted</span>&nbsp;<span class="op" id="6499682">:=</span>&nbsp;<span class="ident" id="6499685">stats</span><span class="op" id="6499690">.</span><span class="ident" id="6499691">Pause</span><span class="op" id="6499696">[</span><span class="ident" id="6499697">n</span>&nbsp;<span class="op" id="6499699">:</span>&nbsp;<span class="ident" id="6499701">n</span><span class="op" id="6499702">+</span><span class="ident" id="6499703">n</span><span class="op" id="6499704">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6499709">copy</span><span class="op" id="6499713">(</span><span class="ident" id="6499714">sorted</span><span class="op" id="6499720">,</span>&nbsp;<span class="ident" id="6499722">stats</span><span class="op" id="6499727">.</span><span class="ident" id="6499728">Pause</span><span class="op" id="6499733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499738">sort</span><span class="op" id="6499742">.</span><span class="ident" id="6499743">Sort</span><span class="op" id="6499747">(</span><span class="ident" id="6499748">byDuration</span><span class="op" id="6499758">(</span><span class="ident" id="6499759">sorted</span><span class="op" id="6499765">)</span><span class="op" id="6499766">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499771">nq</span>&nbsp;<span class="op" id="6499774">:=</span>&nbsp;<span class="builtinfunc" id="6499777">len</span><span class="op" id="6499780">(</span><span class="ident" id="6499781">stats</span><span class="op" id="6499786">.</span><span class="ident" id="6499787">PauseQuantiles</span><span class="op" id="6499801">)</span>&nbsp;<span class="op" id="6499803">-</span>&nbsp;<span class="num" id="6499805">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6499810">for</span>&nbsp;<span class="ident" id="6499814">i</span>&nbsp;<span class="op" id="6499816">:=</span>&nbsp;<span class="num" id="6499819">0</span><span class="op" id="6499820">;</span>&nbsp;<span class="ident" id="6499822">i</span>&nbsp;<span class="op" id="6499824">&lt;</span>&nbsp;<span class="ident" id="6499826">nq</span><span class="op" id="6499828">;</span>&nbsp;<span class="ident" id="6499830">i</span><span class="op" id="6499831">++</span>&nbsp;<span class="op" id="6499834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499840">stats</span><span class="op" id="6499845">.</span><span class="ident" id="6499846">PauseQuantiles</span><span class="op" id="6499860">[</span><span class="ident" id="6499861">i</span><span class="op" id="6499862">]</span>&nbsp;<span class="op" id="6499864">=</span>&nbsp;<span class="ident" id="6499866">sorted</span><span class="op" id="6499872">[</span><span class="builtinfunc" id="6499873">len</span><span class="op" id="6499876">(</span><span class="ident" id="6499877">sorted</span><span class="op" id="6499883">)</span><span class="op" id="6499884">*</span><span class="ident" id="6499885">i</span><span class="op" id="6499886">/</span><span class="ident" id="6499887">nq</span><span class="op" id="6499889">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6499899">stats</span><span class="op" id="6499904">.</span><span class="ident" id="6499905">PauseQuantiles</span><span class="op" id="6499919">[</span><span class="ident" id="6499920">nq</span><span class="op" id="6499922">]</span>&nbsp;<span class="op" id="6499924">=</span>&nbsp;<span class="ident" id="6499926">sorted</span><span class="op" id="6499932">[</span><span class="builtinfunc" id="6499933">len</span><span class="op" id="6499936">(</span><span class="ident" id="6499937">sorted</span><span class="op" id="6499943">)</span><span class="op" id="6499944">-</span><span class="num" id="6499945">1</span><span class="op" id="6499946">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6499953">}</span><br>
<span class="lineno"></span><span class="op" id="6499955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6499958">type</span>&nbsp;<span class="ident" id="6499963">byDuration</span>&nbsp;<span class="op" id="6499974">[</span><span class="op" id="6499975">]</span><span class="ident" id="6499976">time</span><span class="op" id="6499980">.</span><span class="ident" id="6499981">Duration</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6499991">func</span>&nbsp;<span class="op" id="6499996">(</span><span class="ident" id="6499997">x</span>&nbsp;<span class="ident" id="6499999">byDuration</span><span class="op" id="6500009">)</span>&nbsp;<span class="ident" id="6500011">Len</span><span class="op" id="6500014">(</span><span class="op" id="6500015">)</span>&nbsp;<span class="builtintype" id="6500017">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500031">{</span>&nbsp;<span class="keyword" id="6500033">return</span>&nbsp;<span class="builtinfunc" id="6500040">len</span><span class="op" id="6500043">(</span><span class="ident" id="6500044">x</span><span class="op" id="6500045">)</span>&nbsp;<span class="op" id="6500047">}</span><br>
<span class="lineno"></span><span class="keyword" id="6500049">func</span>&nbsp;<span class="op" id="6500054">(</span><span class="ident" id="6500055">x</span>&nbsp;<span class="ident" id="6500057">byDuration</span><span class="op" id="6500067">)</span>&nbsp;<span class="ident" id="6500069">Swap</span><span class="op" id="6500073">(</span><span class="ident" id="6500074">i</span><span class="op" id="6500075">,</span>&nbsp;<span class="ident" id="6500077">j</span>&nbsp;<span class="builtintype" id="6500079">int</span><span class="op" id="6500082">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6500089">{</span>&nbsp;<span class="ident" id="6500091">x</span><span class="op" id="6500092">[</span><span class="ident" id="6500093">i</span><span class="op" id="6500094">]</span><span class="op" id="6500095">,</span>&nbsp;<span class="ident" id="6500097">x</span><span class="op" id="6500098">[</span><span class="ident" id="6500099">j</span><span class="op" id="6500100">]</span>&nbsp;<span class="op" id="6500102">=</span>&nbsp;<span class="ident" id="6500104">x</span><span class="op" id="6500105">[</span><span class="ident" id="6500106">j</span><span class="op" id="6500107">]</span><span class="op" id="6500108">,</span>&nbsp;<span class="ident" id="6500110">x</span><span class="op" id="6500111">[</span><span class="ident" id="6500112">i</span><span class="op" id="6500113">]</span>&nbsp;<span class="op" id="6500115">}</span><br>
<span class="lineno"></span><span class="keyword" id="6500117">func</span>&nbsp;<span class="op" id="6500122">(</span><span class="ident" id="6500123">x</span>&nbsp;<span class="ident" id="6500125">byDuration</span><span class="op" id="6500135">)</span>&nbsp;<span class="ident" id="6500137">Less</span><span class="op" id="6500141">(</span><span class="ident" id="6500142">i</span><span class="op" id="6500143">,</span>&nbsp;<span class="ident" id="6500145">j</span>&nbsp;<span class="builtintype" id="6500147">int</span><span class="op" id="6500150">)</span>&nbsp;<span class="builtintype" id="6500152">bool</span>&nbsp;<span class="op" id="6500157">{</span>&nbsp;<span class="keyword" id="6500159">return</span>&nbsp;<span class="ident" id="6500166">x</span><span class="op" id="6500167">[</span><span class="ident" id="6500168">i</span><span class="op" id="6500169">]</span>&nbsp;<span class="op" id="6500171">&lt;</span>&nbsp;<span class="ident" id="6500173">x</span><span class="op" id="6500174">[</span><span class="ident" id="6500175">j</span><span class="op" id="6500176">]</span>&nbsp;<span class="op" id="6500178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6500181">//&nbsp;SetGCPercent&nbsp;sets&nbsp;the&nbsp;garbage&nbsp;collection&nbsp;target&nbsp;percentage:</span><br>
<span class="lineno"></span><span class="comment" id="6500244">//&nbsp;a&nbsp;collection&nbsp;is&nbsp;triggered&nbsp;when&nbsp;the&nbsp;ratio&nbsp;of&nbsp;freshly&nbsp;allocated&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6500314">//&nbsp;to&nbsp;live&nbsp;data&nbsp;remaining&nbsp;after&nbsp;the&nbsp;previous&nbsp;collection&nbsp;reaches&nbsp;this&nbsp;percentage.</span><br>
<span class="lineno"></span><span class="comment" id="6500395">//&nbsp;SetGCPercent&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6500441">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;GOGC&nbsp;environment&nbsp;variable</span><br>
<span class="lineno">95</span><span class="comment" id="6500510">//&nbsp;at&nbsp;startup,&nbsp;or&nbsp;100&nbsp;if&nbsp;the&nbsp;variable&nbsp;is&nbsp;not&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="6500560">//&nbsp;A&nbsp;negative&nbsp;percentage&nbsp;disables&nbsp;garbage&nbsp;collection.</span><br>
<span class="lineno"></span><span class="keyword" id="6500614">func</span>&nbsp;<span class="ident" id="6500619">SetGCPercent</span><span class="op" id="6500631">(</span><span class="ident" id="6500632">percent</span>&nbsp;<span class="builtintype" id="6500640">int</span><span class="op" id="6500643">)</span>&nbsp;<span class="builtintype" id="6500645">int</span>&nbsp;<span class="op" id="6500649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500652">old</span>&nbsp;<span class="op" id="6500656">:=</span>&nbsp;<span class="ident" id="6500659">setGCPercent</span><span class="op" id="6500671">(</span><span class="builtintype" id="6500672">int32</span><span class="op" id="6500677">(</span><span class="ident" id="6500678">percent</span><span class="op" id="6500685">)</span><span class="op" id="6500686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500689">runtime</span><span class="op" id="6500696">.</span><span class="ident" id="6500697">GC</span><span class="op" id="6500699">(</span><span class="op" id="6500700">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6500703">return</span>&nbsp;<span class="builtintype" id="6500710">int</span><span class="op" id="6500713">(</span><span class="ident" id="6500714">old</span><span class="op" id="6500717">)</span><br>
<span class="lineno"></span><span class="op" id="6500719">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6500722">//&nbsp;FreeOSMemory&nbsp;forces&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;followed&nbsp;by&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6500781">//&nbsp;attempt&nbsp;to&nbsp;return&nbsp;as&nbsp;much&nbsp;memory&nbsp;to&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno">105</span><span class="comment" id="6500841">//&nbsp;as&nbsp;possible.&nbsp;(Even&nbsp;if&nbsp;this&nbsp;is&nbsp;not&nbsp;called,&nbsp;the&nbsp;runtime&nbsp;gradually</span><br>
<span class="lineno"></span><span class="comment" id="6500908">//&nbsp;returns&nbsp;memory&nbsp;to&nbsp;the&nbsp;operating&nbsp;system&nbsp;in&nbsp;a&nbsp;background&nbsp;task.)</span><br>
<span class="lineno"></span><span class="keyword" id="6500973">func</span>&nbsp;<span class="ident" id="6500978">FreeOSMemory</span><span class="op" id="6500990">(</span><span class="op" id="6500991">)</span>&nbsp;<span class="op" id="6500993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6500996">freeOSMemory</span><span class="op" id="6501008">(</span><span class="op" id="6501009">)</span><br>
<span class="lineno"></span><span class="op" id="6501011">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="6501014">//&nbsp;SetMaxStack&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;memory&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6501068">//&nbsp;can&nbsp;be&nbsp;used&nbsp;by&nbsp;a&nbsp;single&nbsp;goroutine&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="6501112">//&nbsp;If&nbsp;any&nbsp;goroutine&nbsp;exceeds&nbsp;this&nbsp;limit&nbsp;while&nbsp;growing&nbsp;its&nbsp;stack,</span><br>
<span class="lineno"></span><span class="comment" id="6501176">//&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno">115</span><span class="comment" id="6501200">//&nbsp;SetMaxStack&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6501245">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit&nbsp;systems,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit&nbsp;systems.</span><br>
<span class="lineno"></span><span class="comment" id="6501321">//</span><br>
<span class="lineno"></span><span class="comment" id="6501324">//&nbsp;SetMaxStack&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;limiting&nbsp;the&nbsp;damage&nbsp;done&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6501388">//&nbsp;goroutines&nbsp;that&nbsp;enter&nbsp;an&nbsp;infinite&nbsp;recursion.&nbsp;It&nbsp;only&nbsp;limits&nbsp;future</span><br>
<span class="lineno">120</span><span class="comment" id="6501458">//&nbsp;stack&nbsp;growth.</span><br>
<span class="lineno"></span><span class="keyword" id="6501475">func</span>&nbsp;<span class="ident" id="6501480">SetMaxStack</span><span class="op" id="6501491">(</span><span class="ident" id="6501492">bytes</span>&nbsp;<span class="builtintype" id="6501498">int</span><span class="op" id="6501501">)</span>&nbsp;<span class="builtintype" id="6501503">int</span>&nbsp;<span class="op" id="6501507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6501510">return</span>&nbsp;<span class="ident" id="6501517">setMaxStack</span><span class="op" id="6501528">(</span><span class="ident" id="6501529">bytes</span><span class="op" id="6501534">)</span><br>
<span class="lineno"></span><span class="op" id="6501536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6501539">//&nbsp;SetMaxThreads&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span><span class="comment" id="6501600">//&nbsp;threads&nbsp;that&nbsp;the&nbsp;Go&nbsp;program&nbsp;can&nbsp;use.&nbsp;If&nbsp;it&nbsp;attempts&nbsp;to&nbsp;use&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="6501672">//&nbsp;this&nbsp;many,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="comment" id="6501707">//&nbsp;SetMaxThreads&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="comment" id="6501754">//&nbsp;The&nbsp;initial&nbsp;setting&nbsp;is&nbsp;10,000&nbsp;threads.</span><br>
<span class="lineno">130</span><span class="comment" id="6501796">//</span><br>
<span class="lineno"></span><span class="comment" id="6501799">//&nbsp;The&nbsp;limit&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;operating&nbsp;system&nbsp;threads,&nbsp;not&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6501876">//&nbsp;of&nbsp;goroutines.&nbsp;A&nbsp;Go&nbsp;program&nbsp;creates&nbsp;a&nbsp;new&nbsp;thread&nbsp;only&nbsp;when&nbsp;a&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="6501950">//&nbsp;is&nbsp;ready&nbsp;to&nbsp;run&nbsp;but&nbsp;all&nbsp;the&nbsp;existing&nbsp;threads&nbsp;are&nbsp;blocked&nbsp;in&nbsp;system&nbsp;calls,&nbsp;cgo&nbsp;calls,</span><br>
<span class="lineno"></span><span class="comment" id="6502038">//&nbsp;or&nbsp;are&nbsp;locked&nbsp;to&nbsp;other&nbsp;goroutines&nbsp;due&nbsp;to&nbsp;use&nbsp;of&nbsp;runtime.LockOSThread.</span><br>
<span class="lineno">135</span><span class="comment" id="6502111">//</span><br>
<span class="lineno"></span><span class="comment" id="6502114">//&nbsp;SetMaxThreads&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;limiting&nbsp;the&nbsp;damage&nbsp;done&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6502180">//&nbsp;programs&nbsp;that&nbsp;create&nbsp;an&nbsp;unbounded&nbsp;number&nbsp;of&nbsp;threads.&nbsp;The&nbsp;idea&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6502248">//&nbsp;to&nbsp;take&nbsp;down&nbsp;the&nbsp;program&nbsp;before&nbsp;it&nbsp;takes&nbsp;down&nbsp;the&nbsp;operating&nbsp;system.</span><br>
<span class="lineno"></span><span class="keyword" id="6502319">func</span>&nbsp;<span class="ident" id="6502324">SetMaxThreads</span><span class="op" id="6502337">(</span><span class="ident" id="6502338">threads</span>&nbsp;<span class="builtintype" id="6502346">int</span><span class="op" id="6502349">)</span>&nbsp;<span class="builtintype" id="6502351">int</span>&nbsp;<span class="op" id="6502355">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6502358">return</span>&nbsp;<span class="ident" id="6502365">setMaxThreads</span><span class="op" id="6502378">(</span><span class="ident" id="6502379">threads</span><span class="op" id="6502386">)</span><br>
<span class="lineno"></span><span class="op" id="6502388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6502391">//&nbsp;SetPanicOnFault&nbsp;controls&nbsp;the&nbsp;runtime&#39;s&nbsp;behavior&nbsp;when&nbsp;a&nbsp;program&nbsp;faults</span><br>
<span class="lineno"></span><span class="comment" id="6502464">//&nbsp;at&nbsp;an&nbsp;unexpected&nbsp;(non-nil)&nbsp;address.&nbsp;Such&nbsp;faults&nbsp;are&nbsp;typically&nbsp;caused&nbsp;by</span><br>
<span class="lineno">145</span><span class="comment" id="6502539">//&nbsp;bugs&nbsp;such&nbsp;as&nbsp;runtime&nbsp;memory&nbsp;corruption,&nbsp;so&nbsp;the&nbsp;default&nbsp;response&nbsp;is&nbsp;to&nbsp;crash</span><br>
<span class="lineno"></span><span class="comment" id="6502618">//&nbsp;the&nbsp;program.&nbsp;Programs&nbsp;working&nbsp;with&nbsp;memory-mapped&nbsp;files&nbsp;or&nbsp;unsafe</span><br>
<span class="lineno"></span><span class="comment" id="6502686">//&nbsp;manipulation&nbsp;of&nbsp;memory&nbsp;may&nbsp;cause&nbsp;faults&nbsp;at&nbsp;non-nil&nbsp;addresses&nbsp;in&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="6502758">//&nbsp;dramatic&nbsp;situations;&nbsp;SetPanicOnFault&nbsp;allows&nbsp;such&nbsp;programs&nbsp;to&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="6502830">//&nbsp;that&nbsp;the&nbsp;runtime&nbsp;trigger&nbsp;only&nbsp;a&nbsp;panic,&nbsp;not&nbsp;a&nbsp;crash.</span><br>
<span class="lineno">150</span><span class="comment" id="6502885">//&nbsp;SetPanicOnFault&nbsp;applies&nbsp;only&nbsp;to&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="comment" id="6502943">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;previous&nbsp;setting.</span><br>
<span class="lineno"></span><span class="keyword" id="6502979">func</span>&nbsp;<span class="ident" id="6502984">SetPanicOnFault</span><span class="op" id="6502999">(</span><span class="ident" id="6503000">enabled</span>&nbsp;<span class="builtintype" id="6503008">bool</span><span class="op" id="6503012">)</span>&nbsp;<span class="builtintype" id="6503014">bool</span>&nbsp;<span class="op" id="6503019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6503022">return</span>&nbsp;<span class="ident" id="6503029">setPanicOnFault</span><span class="op" id="6503044">(</span><span class="ident" id="6503045">enabled</span><span class="op" id="6503052">)</span><br>
<span class="lineno"></span><span class="op" id="6503054">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="6503057">//&nbsp;WriteHeapDump&nbsp;writes&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;heap&nbsp;and&nbsp;the&nbsp;objects&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6503126">//&nbsp;it&nbsp;to&nbsp;the&nbsp;given&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="6503162">//&nbsp;The&nbsp;heap&nbsp;dump&nbsp;format&nbsp;is&nbsp;defined&nbsp;at&nbsp;http://golang.org/s/go13heapdump.</span><br>
<span class="lineno"></span><span class="keyword" id="6503234">func</span>&nbsp;<span class="ident" id="6503239">WriteHeapDump</span><span class="op" id="6503252">(</span><span class="ident" id="6503253">fd</span>&nbsp;<span class="builtintype" id="6503256">uintptr</span><span class="op" id="6503263">)</span>
</div>
</body>
</html>
