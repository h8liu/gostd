<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html" class="current">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5832955">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5833010">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5833064">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5833115">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5833170">package</span>&nbsp;<span class="ident" id="5833178">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5833183">import</span>&nbsp;<span class="op" id="5833190">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5833193">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5833205">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5833215">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5833221">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5833229">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5833239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5833242">var</span>&nbsp;<span class="op" id="5833246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833249">errBadUint</span>&nbsp;<span class="op" id="5833260">=</span>&nbsp;<span class="ident" id="5833262">errors</span><span class="op" id="5833268">.</span><span class="ident" id="5833269">New</span><span class="op" id="5833272">(</span><span class="string" id="5833273">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5833317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833320">errBadType</span>&nbsp;<span class="op" id="5833331">=</span>&nbsp;<span class="ident" id="5833333">errors</span><span class="op" id="5833339">.</span><span class="ident" id="5833340">New</span><span class="op" id="5833343">(</span><span class="string" id="5833344">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="5833384">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833387">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5833398">=</span>&nbsp;<span class="ident" id="5833400">errors</span><span class="op" id="5833406">.</span><span class="ident" id="5833407">New</span><span class="op" id="5833410">(</span><span class="string" id="5833411">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="5833455">)</span><br>
<span class="lineno"></span><span class="op" id="5833457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5833460">type</span>&nbsp;<span class="ident" id="5833465">decHelper</span>&nbsp;<span class="keyword" id="5833475">func</span><span class="op" id="5833479">(</span><span class="ident" id="5833480">state</span>&nbsp;<span class="op" id="5833486">*</span><span class="ident" id="5833487">decoderState</span><span class="op" id="5833499">,</span>&nbsp;<span class="ident" id="5833501">v</span>&nbsp;<span class="ident" id="5833503">reflect</span><span class="op" id="5833510">.</span><span class="ident" id="5833511">Value</span><span class="op" id="5833516">,</span>&nbsp;<span class="ident" id="5833518">length</span>&nbsp;<span class="builtintype" id="5833525">int</span><span class="op" id="5833528">,</span>&nbsp;<span class="ident" id="5833530">ovfl</span>&nbsp;<span class="builtintype" id="5833535">error</span><span class="op" id="5833540">)</span>&nbsp;<span class="builtintype" id="5833542">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5833548">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5833630">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="5833664">type</span>&nbsp;<span class="ident" id="5833669">decoderState</span>&nbsp;<span class="keyword" id="5833682">struct</span>&nbsp;<span class="op" id="5833689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833692">dec</span>&nbsp;<span class="op" id="5833696">*</span><span class="ident" id="5833697">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5833706">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5833784">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833855">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833864">*</span><span class="ident" id="5833865">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833876">fieldnum</span>&nbsp;<span class="builtintype" id="5833885">int</span>&nbsp;<span class="comment" id="5833889">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833921">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833930">[</span><span class="op" id="5833931">]</span><span class="builtintype" id="5833932">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5833938">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5833947">*</span><span class="ident" id="5833948">decoderState</span>&nbsp;<span class="comment" id="5833961">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="5833978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5833981">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="5834066">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="5834165">type</span>&nbsp;<span class="ident" id="5834170">decBuffer</span>&nbsp;<span class="keyword" id="5834180">struct</span>&nbsp;<span class="op" id="5834187">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834190">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5834197">[</span><span class="op" id="5834198">]</span><span class="builtintype" id="5834199">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834205">offset</span>&nbsp;<span class="builtintype" id="5834212">int</span>&nbsp;<span class="comment" id="5834216">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="5834232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5834235">func</span>&nbsp;<span class="op" id="5834240">(</span><span class="ident" id="5834241">d</span>&nbsp;<span class="op" id="5834243">*</span><span class="ident" id="5834244">decBuffer</span><span class="op" id="5834253">)</span>&nbsp;<span class="ident" id="5834255">Read</span><span class="op" id="5834259">(</span><span class="ident" id="5834260">p</span>&nbsp;<span class="op" id="5834262">[</span><span class="op" id="5834263">]</span><span class="builtintype" id="5834264">byte</span><span class="op" id="5834268">)</span>&nbsp;<span class="op" id="5834270">(</span><span class="builtintype" id="5834271">int</span><span class="op" id="5834274">,</span>&nbsp;<span class="builtintype" id="5834276">error</span><span class="op" id="5834281">)</span>&nbsp;<span class="op" id="5834283">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834286">n</span>&nbsp;<span class="op" id="5834288">:=</span>&nbsp;<span class="builtinfunc" id="5834291">copy</span><span class="op" id="5834295">(</span><span class="ident" id="5834296">p</span><span class="op" id="5834297">,</span>&nbsp;<span class="ident" id="5834299">d</span><span class="op" id="5834300">.</span><span class="ident" id="5834301">data</span><span class="op" id="5834305">[</span><span class="ident" id="5834306">d</span><span class="op" id="5834307">.</span><span class="ident" id="5834308">offset</span><span class="op" id="5834314">:</span><span class="op" id="5834315">]</span><span class="op" id="5834316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834319">if</span>&nbsp;<span class="ident" id="5834322">n</span>&nbsp;<span class="op" id="5834324">==</span>&nbsp;<span class="num" id="5834327">0</span>&nbsp;<span class="op" id="5834329">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5834332">len</span><span class="op" id="5834335">(</span><span class="ident" id="5834336">p</span><span class="op" id="5834337">)</span>&nbsp;<span class="op" id="5834339">!=</span>&nbsp;<span class="num" id="5834342">0</span>&nbsp;<span class="op" id="5834344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834348">return</span>&nbsp;<span class="num" id="5834355">0</span><span class="op" id="5834356">,</span>&nbsp;<span class="ident" id="5834358">io</span><span class="op" id="5834360">.</span><span class="ident" id="5834361">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834369">d</span><span class="op" id="5834370">.</span><span class="ident" id="5834371">offset</span>&nbsp;<span class="op" id="5834378">+=</span>&nbsp;<span class="ident" id="5834381">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834384">return</span>&nbsp;<span class="ident" id="5834391">n</span><span class="op" id="5834392">,</span>&nbsp;<span class="builtintype" id="5834394">nil</span><br>
<span class="lineno"></span><span class="op" id="5834398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5834401">func</span>&nbsp;<span class="op" id="5834406">(</span><span class="ident" id="5834407">d</span>&nbsp;<span class="op" id="5834409">*</span><span class="ident" id="5834410">decBuffer</span><span class="op" id="5834419">)</span>&nbsp;<span class="ident" id="5834421">Drop</span><span class="op" id="5834425">(</span><span class="ident" id="5834426">n</span>&nbsp;<span class="builtintype" id="5834428">int</span><span class="op" id="5834431">)</span>&nbsp;<span class="op" id="5834433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834436">if</span>&nbsp;<span class="ident" id="5834439">n</span>&nbsp;<span class="op" id="5834441">&gt;</span>&nbsp;<span class="ident" id="5834443">d</span><span class="op" id="5834444">.</span><span class="ident" id="5834445">Len</span><span class="op" id="5834448">(</span><span class="op" id="5834449">)</span>&nbsp;<span class="op" id="5834451">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5834455">panic</span><span class="op" id="5834460">(</span><span class="string" id="5834461">&#34;drop&#34;</span><span class="op" id="5834467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834473">d</span><span class="op" id="5834474">.</span><span class="ident" id="5834475">offset</span>&nbsp;<span class="op" id="5834482">+=</span>&nbsp;<span class="ident" id="5834485">n</span><br>
<span class="lineno"></span><span class="op" id="5834487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5834490">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5834553">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5834618">func</span>&nbsp;<span class="op" id="5834623">(</span><span class="ident" id="5834624">d</span>&nbsp;<span class="op" id="5834626">*</span><span class="ident" id="5834627">decBuffer</span><span class="op" id="5834636">)</span>&nbsp;<span class="ident" id="5834638">Size</span><span class="op" id="5834642">(</span><span class="ident" id="5834643">n</span>&nbsp;<span class="builtintype" id="5834645">int</span><span class="op" id="5834648">)</span>&nbsp;<span class="op" id="5834650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834653">d</span><span class="op" id="5834654">.</span><span class="ident" id="5834655">Reset</span><span class="op" id="5834660">(</span><span class="op" id="5834661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834664">if</span>&nbsp;<span class="builtinfunc" id="5834667">cap</span><span class="op" id="5834670">(</span><span class="ident" id="5834671">d</span><span class="op" id="5834672">.</span><span class="ident" id="5834673">data</span><span class="op" id="5834677">)</span>&nbsp;<span class="op" id="5834679">&lt;</span>&nbsp;<span class="ident" id="5834681">n</span>&nbsp;<span class="op" id="5834683">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834687">d</span><span class="op" id="5834688">.</span><span class="ident" id="5834689">data</span>&nbsp;<span class="op" id="5834694">=</span>&nbsp;<span class="builtinfunc" id="5834696">make</span><span class="op" id="5834700">(</span><span class="op" id="5834701">[</span><span class="op" id="5834702">]</span><span class="builtintype" id="5834703">byte</span><span class="op" id="5834707">,</span>&nbsp;<span class="ident" id="5834709">n</span><span class="op" id="5834710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834713">}</span>&nbsp;<span class="keyword" id="5834715">else</span>&nbsp;<span class="op" id="5834720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834724">d</span><span class="op" id="5834725">.</span><span class="ident" id="5834726">data</span>&nbsp;<span class="op" id="5834731">=</span>&nbsp;<span class="ident" id="5834733">d</span><span class="op" id="5834734">.</span><span class="ident" id="5834735">data</span><span class="op" id="5834739">[</span><span class="num" id="5834740">0</span><span class="op" id="5834741">:</span><span class="ident" id="5834742">n</span><span class="op" id="5834743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834746">}</span><br>
<span class="lineno"></span><span class="op" id="5834748">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5834751">func</span>&nbsp;<span class="op" id="5834756">(</span><span class="ident" id="5834757">d</span>&nbsp;<span class="op" id="5834759">*</span><span class="ident" id="5834760">decBuffer</span><span class="op" id="5834769">)</span>&nbsp;<span class="ident" id="5834771">ReadByte</span><span class="op" id="5834779">(</span><span class="op" id="5834780">)</span>&nbsp;<span class="op" id="5834782">(</span><span class="builtintype" id="5834783">byte</span><span class="op" id="5834787">,</span>&nbsp;<span class="builtintype" id="5834789">error</span><span class="op" id="5834794">)</span>&nbsp;<span class="op" id="5834796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834799">if</span>&nbsp;<span class="ident" id="5834802">d</span><span class="op" id="5834803">.</span><span class="ident" id="5834804">offset</span>&nbsp;<span class="op" id="5834811">&gt;=</span>&nbsp;<span class="builtinfunc" id="5834814">len</span><span class="op" id="5834817">(</span><span class="ident" id="5834818">d</span><span class="op" id="5834819">.</span><span class="ident" id="5834820">data</span><span class="op" id="5834824">)</span>&nbsp;<span class="op" id="5834826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834830">return</span>&nbsp;<span class="num" id="5834837">0</span><span class="op" id="5834838">,</span>&nbsp;<span class="ident" id="5834840">io</span><span class="op" id="5834842">.</span><span class="ident" id="5834843">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5834848">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834851">c</span>&nbsp;<span class="op" id="5834853">:=</span>&nbsp;<span class="ident" id="5834856">d</span><span class="op" id="5834857">.</span><span class="ident" id="5834858">data</span><span class="op" id="5834862">[</span><span class="ident" id="5834863">d</span><span class="op" id="5834864">.</span><span class="ident" id="5834865">offset</span><span class="op" id="5834871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5834874">d</span><span class="op" id="5834875">.</span><span class="ident" id="5834876">offset</span><span class="op" id="5834882">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834886">return</span>&nbsp;<span class="ident" id="5834893">c</span><span class="op" id="5834894">,</span>&nbsp;<span class="builtintype" id="5834896">nil</span><br>
<span class="lineno"></span><span class="op" id="5834900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="5834903">func</span>&nbsp;<span class="op" id="5834908">(</span><span class="ident" id="5834909">d</span>&nbsp;<span class="op" id="5834911">*</span><span class="ident" id="5834912">decBuffer</span><span class="op" id="5834921">)</span>&nbsp;<span class="ident" id="5834923">Len</span><span class="op" id="5834926">(</span><span class="op" id="5834927">)</span>&nbsp;<span class="builtintype" id="5834929">int</span>&nbsp;<span class="op" id="5834933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5834936">return</span>&nbsp;<span class="builtinfunc" id="5834943">len</span><span class="op" id="5834946">(</span><span class="ident" id="5834947">d</span><span class="op" id="5834948">.</span><span class="ident" id="5834949">data</span><span class="op" id="5834953">)</span>&nbsp;<span class="op" id="5834955">-</span>&nbsp;<span class="ident" id="5834957">d</span><span class="op" id="5834958">.</span><span class="ident" id="5834959">offset</span><br>
<span class="lineno"></span><span class="op" id="5834966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5834969">func</span>&nbsp;<span class="op" id="5834974">(</span><span class="ident" id="5834975">d</span>&nbsp;<span class="op" id="5834977">*</span><span class="ident" id="5834978">decBuffer</span><span class="op" id="5834987">)</span>&nbsp;<span class="ident" id="5834989">Bytes</span><span class="op" id="5834994">(</span><span class="op" id="5834995">)</span>&nbsp;<span class="op" id="5834997">[</span><span class="op" id="5834998">]</span><span class="builtintype" id="5834999">byte</span>&nbsp;<span class="op" id="5835004">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835007">return</span>&nbsp;<span class="ident" id="5835014">d</span><span class="op" id="5835015">.</span><span class="ident" id="5835016">data</span><span class="op" id="5835020">[</span><span class="ident" id="5835021">d</span><span class="op" id="5835022">.</span><span class="ident" id="5835023">offset</span><span class="op" id="5835029">:</span><span class="op" id="5835030">]</span><br>
<span class="lineno"></span><span class="op" id="5835032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5835035">func</span>&nbsp;<span class="op" id="5835040">(</span><span class="ident" id="5835041">d</span>&nbsp;<span class="op" id="5835043">*</span><span class="ident" id="5835044">decBuffer</span><span class="op" id="5835053">)</span>&nbsp;<span class="ident" id="5835055">Reset</span><span class="op" id="5835060">(</span><span class="op" id="5835061">)</span>&nbsp;<span class="op" id="5835063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835066">d</span><span class="op" id="5835067">.</span><span class="ident" id="5835068">data</span>&nbsp;<span class="op" id="5835073">=</span>&nbsp;<span class="ident" id="5835075">d</span><span class="op" id="5835076">.</span><span class="ident" id="5835077">data</span><span class="op" id="5835081">[</span><span class="num" id="5835082">0</span><span class="op" id="5835083">:</span><span class="num" id="5835084">0</span><span class="op" id="5835085">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835088">d</span><span class="op" id="5835089">.</span><span class="ident" id="5835090">offset</span>&nbsp;<span class="op" id="5835097">=</span>&nbsp;<span class="num" id="5835099">0</span><br>
<span class="lineno"></span><span class="op" id="5835101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5835104">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="5835184">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="5835221">func</span>&nbsp;<span class="op" id="5835226">(</span><span class="ident" id="5835227">dec</span>&nbsp;<span class="op" id="5835231">*</span><span class="ident" id="5835232">Decoder</span><span class="op" id="5835239">)</span>&nbsp;<span class="ident" id="5835241">newDecoderState</span><span class="op" id="5835256">(</span><span class="ident" id="5835257">buf</span>&nbsp;<span class="op" id="5835261">*</span><span class="ident" id="5835262">decBuffer</span><span class="op" id="5835271">)</span>&nbsp;<span class="op" id="5835273">*</span><span class="ident" id="5835274">decoderState</span>&nbsp;<span class="op" id="5835287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835290">d</span>&nbsp;<span class="op" id="5835292">:=</span>&nbsp;<span class="ident" id="5835295">dec</span><span class="op" id="5835298">.</span><span class="ident" id="5835299">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835309">if</span>&nbsp;<span class="ident" id="5835312">d</span>&nbsp;<span class="op" id="5835314">==</span>&nbsp;<span class="builtintype" id="5835317">nil</span>&nbsp;<span class="op" id="5835321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835325">d</span>&nbsp;<span class="op" id="5835327">=</span>&nbsp;<span class="builtinfunc" id="5835329">new</span><span class="op" id="5835332">(</span><span class="ident" id="5835333">decoderState</span><span class="op" id="5835345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835349">d</span><span class="op" id="5835350">.</span><span class="ident" id="5835351">dec</span>&nbsp;<span class="op" id="5835355">=</span>&nbsp;<span class="ident" id="5835357">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835363">d</span><span class="op" id="5835364">.</span><span class="ident" id="5835365">buf</span>&nbsp;<span class="op" id="5835369">=</span>&nbsp;<span class="builtinfunc" id="5835371">make</span><span class="op" id="5835375">(</span><span class="op" id="5835376">[</span><span class="op" id="5835377">]</span><span class="builtintype" id="5835378">byte</span><span class="op" id="5835382">,</span>&nbsp;<span class="ident" id="5835384">uint64Size</span><span class="op" id="5835394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835397">}</span>&nbsp;<span class="keyword" id="5835399">else</span>&nbsp;<span class="op" id="5835404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835408">dec</span><span class="op" id="5835411">.</span><span class="ident" id="5835412">freeList</span>&nbsp;<span class="op" id="5835421">=</span>&nbsp;<span class="ident" id="5835423">d</span><span class="op" id="5835424">.</span><span class="ident" id="5835425">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835434">d</span><span class="op" id="5835435">.</span><span class="ident" id="5835436">b</span>&nbsp;<span class="op" id="5835438">=</span>&nbsp;<span class="ident" id="5835440">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835445">return</span>&nbsp;<span class="ident" id="5835452">d</span><br>
<span class="lineno"></span><span class="op" id="5835454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5835457">func</span>&nbsp;<span class="op" id="5835462">(</span><span class="ident" id="5835463">dec</span>&nbsp;<span class="op" id="5835467">*</span><span class="ident" id="5835468">Decoder</span><span class="op" id="5835475">)</span>&nbsp;<span class="ident" id="5835477">freeDecoderState</span><span class="op" id="5835493">(</span><span class="ident" id="5835494">d</span>&nbsp;<span class="op" id="5835496">*</span><span class="ident" id="5835497">decoderState</span><span class="op" id="5835509">)</span>&nbsp;<span class="op" id="5835511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835514">d</span><span class="op" id="5835515">.</span><span class="ident" id="5835516">next</span>&nbsp;<span class="op" id="5835521">=</span>&nbsp;<span class="ident" id="5835523">dec</span><span class="op" id="5835526">.</span><span class="ident" id="5835527">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835537">dec</span><span class="op" id="5835540">.</span><span class="ident" id="5835541">freeList</span>&nbsp;<span class="op" id="5835550">=</span>&nbsp;<span class="ident" id="5835552">d</span><br>
<span class="lineno"></span><span class="op" id="5835554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5835557">func</span>&nbsp;<span class="ident" id="5835562">overflow</span><span class="op" id="5835570">(</span><span class="ident" id="5835571">name</span>&nbsp;<span class="builtintype" id="5835576">string</span><span class="op" id="5835582">)</span>&nbsp;<span class="builtintype" id="5835584">error</span>&nbsp;<span class="op" id="5835590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835593">return</span>&nbsp;<span class="ident" id="5835600">errors</span><span class="op" id="5835606">.</span><span class="ident" id="5835607">New</span><span class="op" id="5835610">(</span><span class="string" id="5835611">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5835625">+</span>&nbsp;<span class="ident" id="5835627">name</span>&nbsp;<span class="op" id="5835632">+</span>&nbsp;<span class="string" id="5835634">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5835650">)</span><br>
<span class="lineno">115</span><span class="op" id="5835652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5835655">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="5835728">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5835784">func</span>&nbsp;<span class="ident" id="5835789">decodeUintReader</span><span class="op" id="5835805">(</span><span class="ident" id="5835806">r</span>&nbsp;<span class="ident" id="5835808">io</span><span class="op" id="5835810">.</span><span class="ident" id="5835811">Reader</span><span class="op" id="5835817">,</span>&nbsp;<span class="ident" id="5835819">buf</span>&nbsp;<span class="op" id="5835823">[</span><span class="op" id="5835824">]</span><span class="builtintype" id="5835825">byte</span><span class="op" id="5835829">)</span>&nbsp;<span class="op" id="5835831">(</span><span class="ident" id="5835832">x</span>&nbsp;<span class="ident" id="5835834">uint64</span><span class="op" id="5835840">,</span>&nbsp;<span class="ident" id="5835842">width</span>&nbsp;<span class="builtintype" id="5835848">int</span><span class="op" id="5835851">,</span>&nbsp;<span class="ident" id="5835853">err</span>&nbsp;<span class="builtintype" id="5835857">error</span><span class="op" id="5835862">)</span>&nbsp;<span class="op" id="5835864">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835867">width</span>&nbsp;<span class="op" id="5835873">=</span>&nbsp;<span class="num" id="5835875">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835878">n</span><span class="op" id="5835879">,</span>&nbsp;<span class="ident" id="5835881">err</span>&nbsp;<span class="op" id="5835885">:=</span>&nbsp;<span class="ident" id="5835888">io</span><span class="op" id="5835890">.</span><span class="ident" id="5835891">ReadFull</span><span class="op" id="5835899">(</span><span class="ident" id="5835900">r</span><span class="op" id="5835901">,</span>&nbsp;<span class="ident" id="5835903">buf</span><span class="op" id="5835906">[</span><span class="num" id="5835907">0</span><span class="op" id="5835908">:</span><span class="ident" id="5835909">width</span><span class="op" id="5835914">]</span><span class="op" id="5835915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835918">if</span>&nbsp;<span class="ident" id="5835921">n</span>&nbsp;<span class="op" id="5835923">==</span>&nbsp;<span class="num" id="5835926">0</span>&nbsp;<span class="op" id="5835928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835932">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5835940">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5835943">b</span>&nbsp;<span class="op" id="5835945">:=</span>&nbsp;<span class="ident" id="5835948">buf</span><span class="op" id="5835951">[</span><span class="num" id="5835952">0</span><span class="op" id="5835953">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835956">if</span>&nbsp;<span class="ident" id="5835959">b</span>&nbsp;<span class="op" id="5835961">&lt;=</span>&nbsp;<span class="num" id="5835964">0x7f</span>&nbsp;<span class="op" id="5835969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5835973">return</span>&nbsp;<span class="ident" id="5835980">uint64</span><span class="op" id="5835986">(</span><span class="ident" id="5835987">b</span><span class="op" id="5835988">)</span><span class="op" id="5835989">,</span>&nbsp;<span class="ident" id="5835991">width</span><span class="op" id="5835996">,</span>&nbsp;<span class="builtintype" id="5835998">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836006">n</span>&nbsp;<span class="op" id="5836008">=</span>&nbsp;<span class="op" id="5836010">-</span><span class="builtintype" id="5836011">int</span><span class="op" id="5836014">(</span><span class="builtintype" id="5836015">int8</span><span class="op" id="5836019">(</span><span class="ident" id="5836020">b</span><span class="op" id="5836021">)</span><span class="op" id="5836022">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836025">if</span>&nbsp;<span class="ident" id="5836028">n</span>&nbsp;<span class="op" id="5836030">&gt;</span>&nbsp;<span class="ident" id="5836032">uint64Size</span>&nbsp;<span class="op" id="5836043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836047">err</span>&nbsp;<span class="op" id="5836051">=</span>&nbsp;<span class="ident" id="5836053">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836066">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836077">width</span><span class="op" id="5836082">,</span>&nbsp;<span class="ident" id="5836084">err</span>&nbsp;<span class="op" id="5836088">=</span>&nbsp;<span class="ident" id="5836090">io</span><span class="op" id="5836092">.</span><span class="ident" id="5836093">ReadFull</span><span class="op" id="5836101">(</span><span class="ident" id="5836102">r</span><span class="op" id="5836103">,</span>&nbsp;<span class="ident" id="5836105">buf</span><span class="op" id="5836108">[</span><span class="num" id="5836109">0</span><span class="op" id="5836110">:</span><span class="ident" id="5836111">n</span><span class="op" id="5836112">]</span><span class="op" id="5836113">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836116">if</span>&nbsp;<span class="ident" id="5836119">err</span>&nbsp;<span class="op" id="5836123">!=</span>&nbsp;<span class="builtintype" id="5836126">nil</span>&nbsp;<span class="op" id="5836130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836134">if</span>&nbsp;<span class="ident" id="5836137">err</span>&nbsp;<span class="op" id="5836141">==</span>&nbsp;<span class="ident" id="5836144">io</span><span class="op" id="5836146">.</span><span class="ident" id="5836147">EOF</span>&nbsp;<span class="op" id="5836151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836156">err</span>&nbsp;<span class="op" id="5836160">=</span>&nbsp;<span class="ident" id="5836162">io</span><span class="op" id="5836164">.</span><span class="ident" id="5836165">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836188">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5836199">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836265">for</span>&nbsp;<span class="ident" id="5836269">_</span><span class="op" id="5836270">,</span>&nbsp;<span class="ident" id="5836272">b</span>&nbsp;<span class="op" id="5836274">:=</span>&nbsp;<span class="keyword" id="5836277">range</span>&nbsp;<span class="ident" id="5836283">buf</span><span class="op" id="5836286">[</span><span class="num" id="5836287">0</span><span class="op" id="5836288">:</span><span class="ident" id="5836289">width</span><span class="op" id="5836294">]</span>&nbsp;<span class="op" id="5836296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836300">x</span>&nbsp;<span class="op" id="5836302">=</span>&nbsp;<span class="ident" id="5836304">x</span><span class="op" id="5836305">&lt;&lt;</span><span class="num" id="5836307">8</span>&nbsp;<span class="op" id="5836309">|</span>&nbsp;<span class="ident" id="5836311">uint64</span><span class="op" id="5836317">(</span><span class="ident" id="5836318">b</span><span class="op" id="5836319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836322">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836325">width</span><span class="op" id="5836330">++</span>&nbsp;<span class="comment" id="5836333">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836356">return</span><br>
<span class="lineno"></span><span class="op" id="5836363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5836366">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="5836428">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5836460">func</span>&nbsp;<span class="op" id="5836465">(</span><span class="ident" id="5836466">state</span>&nbsp;<span class="op" id="5836472">*</span><span class="ident" id="5836473">decoderState</span><span class="op" id="5836485">)</span>&nbsp;<span class="ident" id="5836487">decodeUint</span><span class="op" id="5836497">(</span><span class="op" id="5836498">)</span>&nbsp;<span class="op" id="5836500">(</span><span class="ident" id="5836501">x</span>&nbsp;<span class="ident" id="5836503">uint64</span><span class="op" id="5836509">)</span>&nbsp;<span class="op" id="5836511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836514">b</span><span class="op" id="5836515">,</span>&nbsp;<span class="ident" id="5836517">err</span>&nbsp;<span class="op" id="5836521">:=</span>&nbsp;<span class="ident" id="5836524">state</span><span class="op" id="5836529">.</span><span class="ident" id="5836530">b</span><span class="op" id="5836531">.</span><span class="ident" id="5836532">ReadByte</span><span class="op" id="5836540">(</span><span class="op" id="5836541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836544">if</span>&nbsp;<span class="ident" id="5836547">err</span>&nbsp;<span class="op" id="5836551">!=</span>&nbsp;<span class="builtintype" id="5836554">nil</span>&nbsp;<span class="op" id="5836558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836562">error_</span><span class="op" id="5836568">(</span><span class="ident" id="5836569">err</span><span class="op" id="5836572">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836578">if</span>&nbsp;<span class="ident" id="5836581">b</span>&nbsp;<span class="op" id="5836583">&lt;=</span>&nbsp;<span class="num" id="5836586">0x7f</span>&nbsp;<span class="op" id="5836591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836595">return</span>&nbsp;<span class="ident" id="5836602">uint64</span><span class="op" id="5836608">(</span><span class="ident" id="5836609">b</span><span class="op" id="5836610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836616">n</span>&nbsp;<span class="op" id="5836618">:=</span>&nbsp;<span class="op" id="5836621">-</span><span class="builtintype" id="5836622">int</span><span class="op" id="5836625">(</span><span class="builtintype" id="5836626">int8</span><span class="op" id="5836630">(</span><span class="ident" id="5836631">b</span><span class="op" id="5836632">)</span><span class="op" id="5836633">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836636">if</span>&nbsp;<span class="ident" id="5836639">n</span>&nbsp;<span class="op" id="5836641">&gt;</span>&nbsp;<span class="ident" id="5836643">uint64Size</span>&nbsp;<span class="op" id="5836654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836658">error_</span><span class="op" id="5836664">(</span><span class="ident" id="5836665">errBadUint</span><span class="op" id="5836675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836681">width</span><span class="op" id="5836686">,</span>&nbsp;<span class="ident" id="5836688">err</span>&nbsp;<span class="op" id="5836692">:=</span>&nbsp;<span class="ident" id="5836695">state</span><span class="op" id="5836700">.</span><span class="ident" id="5836701">b</span><span class="op" id="5836702">.</span><span class="ident" id="5836703">Read</span><span class="op" id="5836707">(</span><span class="ident" id="5836708">state</span><span class="op" id="5836713">.</span><span class="ident" id="5836714">buf</span><span class="op" id="5836717">[</span><span class="num" id="5836718">0</span><span class="op" id="5836719">:</span><span class="ident" id="5836720">n</span><span class="op" id="5836721">]</span><span class="op" id="5836722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836725">if</span>&nbsp;<span class="ident" id="5836728">err</span>&nbsp;<span class="op" id="5836732">!=</span>&nbsp;<span class="builtintype" id="5836735">nil</span>&nbsp;<span class="op" id="5836739">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836743">error_</span><span class="op" id="5836749">(</span><span class="ident" id="5836750">err</span><span class="op" id="5836753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5836759">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5836820">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836886">for</span>&nbsp;<span class="ident" id="5836890">_</span><span class="op" id="5836891">,</span>&nbsp;<span class="ident" id="5836893">b</span>&nbsp;<span class="op" id="5836895">:=</span>&nbsp;<span class="keyword" id="5836898">range</span>&nbsp;<span class="ident" id="5836904">state</span><span class="op" id="5836909">.</span><span class="ident" id="5836910">buf</span><span class="op" id="5836913">[</span><span class="num" id="5836914">0</span><span class="op" id="5836915">:</span><span class="ident" id="5836916">width</span><span class="op" id="5836921">]</span>&nbsp;<span class="op" id="5836923">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5836927">x</span>&nbsp;<span class="op" id="5836929">=</span>&nbsp;<span class="ident" id="5836931">x</span><span class="op" id="5836932">&lt;&lt;</span><span class="num" id="5836934">8</span>&nbsp;<span class="op" id="5836936">|</span>&nbsp;<span class="ident" id="5836938">uint64</span><span class="op" id="5836944">(</span><span class="ident" id="5836945">b</span><span class="op" id="5836946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5836949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5836952">return</span>&nbsp;<span class="ident" id="5836959">x</span><br>
<span class="lineno"></span><span class="op" id="5836961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5836964">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="5837023">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="5837055">func</span>&nbsp;<span class="op" id="5837060">(</span><span class="ident" id="5837061">state</span>&nbsp;<span class="op" id="5837067">*</span><span class="ident" id="5837068">decoderState</span><span class="op" id="5837080">)</span>&nbsp;<span class="ident" id="5837082">decodeInt</span><span class="op" id="5837091">(</span><span class="op" id="5837092">)</span>&nbsp;<span class="ident" id="5837094">int64</span>&nbsp;<span class="op" id="5837100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837103">x</span>&nbsp;<span class="op" id="5837105">:=</span>&nbsp;<span class="ident" id="5837108">state</span><span class="op" id="5837113">.</span><span class="ident" id="5837114">decodeUint</span><span class="op" id="5837124">(</span><span class="op" id="5837125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5837128">if</span>&nbsp;<span class="ident" id="5837131">x</span><span class="op" id="5837132">&amp;</span><span class="num" id="5837133">1</span>&nbsp;<span class="op" id="5837135">!=</span>&nbsp;<span class="num" id="5837138">0</span>&nbsp;<span class="op" id="5837140">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5837144">return</span>&nbsp;<span class="op" id="5837151">^</span><span class="ident" id="5837152">int64</span><span class="op" id="5837157">(</span><span class="ident" id="5837158">x</span>&nbsp;<span class="op" id="5837160">&gt;&gt;</span>&nbsp;<span class="num" id="5837163">1</span><span class="op" id="5837164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5837167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5837170">return</span>&nbsp;<span class="ident" id="5837177">int64</span><span class="op" id="5837182">(</span><span class="ident" id="5837183">x</span>&nbsp;<span class="op" id="5837185">&gt;&gt;</span>&nbsp;<span class="num" id="5837188">1</span><span class="op" id="5837189">)</span><br>
<span class="lineno"></span><span class="op" id="5837191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5837194">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5837261">type</span>&nbsp;<span class="ident" id="5837266">decOp</span>&nbsp;<span class="keyword" id="5837272">func</span><span class="op" id="5837276">(</span><span class="ident" id="5837277">i</span>&nbsp;<span class="op" id="5837279">*</span><span class="ident" id="5837280">decInstr</span><span class="op" id="5837288">,</span>&nbsp;<span class="ident" id="5837290">state</span>&nbsp;<span class="op" id="5837296">*</span><span class="ident" id="5837297">decoderState</span><span class="op" id="5837309">,</span>&nbsp;<span class="ident" id="5837311">v</span>&nbsp;<span class="ident" id="5837313">reflect</span><span class="op" id="5837320">.</span><span class="ident" id="5837321">Value</span><span class="op" id="5837326">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5837329">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="5837375">type</span>&nbsp;<span class="ident" id="5837380">decInstr</span>&nbsp;<span class="keyword" id="5837389">struct</span>&nbsp;<span class="op" id="5837396">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837399">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837405">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837412">field</span>&nbsp;<span class="builtintype" id="5837418">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5837424">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837458">index</span>&nbsp;<span class="op" id="5837464">[</span><span class="op" id="5837465">]</span><span class="builtintype" id="5837466">int</span>&nbsp;<span class="comment" id="5837470">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837516">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="5837522">error</span>&nbsp;<span class="comment" id="5837528">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="5837598">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="5837601">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5837658">func</span>&nbsp;<span class="ident" id="5837663">ignoreUint</span><span class="op" id="5837673">(</span><span class="ident" id="5837674">i</span>&nbsp;<span class="op" id="5837676">*</span><span class="ident" id="5837677">decInstr</span><span class="op" id="5837685">,</span>&nbsp;<span class="ident" id="5837687">state</span>&nbsp;<span class="op" id="5837693">*</span><span class="ident" id="5837694">decoderState</span><span class="op" id="5837706">,</span>&nbsp;<span class="ident" id="5837708">v</span>&nbsp;<span class="ident" id="5837710">reflect</span><span class="op" id="5837717">.</span><span class="ident" id="5837718">Value</span><span class="op" id="5837723">)</span>&nbsp;<span class="op" id="5837725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837728">state</span><span class="op" id="5837733">.</span><span class="ident" id="5837734">decodeUint</span><span class="op" id="5837744">(</span><span class="op" id="5837745">)</span><br>
<span class="lineno"></span><span class="op" id="5837747">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5837750">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="5837829">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5837848">func</span>&nbsp;<span class="ident" id="5837853">ignoreTwoUints</span><span class="op" id="5837867">(</span><span class="ident" id="5837868">i</span>&nbsp;<span class="op" id="5837870">*</span><span class="ident" id="5837871">decInstr</span><span class="op" id="5837879">,</span>&nbsp;<span class="ident" id="5837881">state</span>&nbsp;<span class="op" id="5837887">*</span><span class="ident" id="5837888">decoderState</span><span class="op" id="5837900">,</span>&nbsp;<span class="ident" id="5837902">v</span>&nbsp;<span class="ident" id="5837904">reflect</span><span class="op" id="5837911">.</span><span class="ident" id="5837912">Value</span><span class="op" id="5837917">)</span>&nbsp;<span class="op" id="5837919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837922">state</span><span class="op" id="5837927">.</span><span class="ident" id="5837928">decodeUint</span><span class="op" id="5837938">(</span><span class="op" id="5837939">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5837942">state</span><span class="op" id="5837947">.</span><span class="ident" id="5837948">decodeUint</span><span class="op" id="5837958">(</span><span class="op" id="5837959">)</span><br>
<span class="lineno"></span><span class="op" id="5837961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5837964">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="5838036">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="5838109">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="5838153">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5838225">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5838304">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5838317">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5838381">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="5838469">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="5838547">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5838592">func</span>&nbsp;<span class="ident" id="5838597">decAlloc</span><span class="op" id="5838605">(</span><span class="ident" id="5838606">v</span>&nbsp;<span class="ident" id="5838608">reflect</span><span class="op" id="5838615">.</span><span class="ident" id="5838616">Value</span><span class="op" id="5838621">)</span>&nbsp;<span class="ident" id="5838623">reflect</span><span class="op" id="5838630">.</span><span class="ident" id="5838631">Value</span>&nbsp;<span class="op" id="5838637">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5838640">for</span>&nbsp;<span class="ident" id="5838644">v</span><span class="op" id="5838645">.</span><span class="ident" id="5838646">Kind</span><span class="op" id="5838650">(</span><span class="op" id="5838651">)</span>&nbsp;<span class="op" id="5838653">==</span>&nbsp;<span class="ident" id="5838656">reflect</span><span class="op" id="5838663">.</span><span class="ident" id="5838664">Ptr</span>&nbsp;<span class="op" id="5838668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5838672">if</span>&nbsp;<span class="ident" id="5838675">v</span><span class="op" id="5838676">.</span><span class="ident" id="5838677">IsNil</span><span class="op" id="5838682">(</span><span class="op" id="5838683">)</span>&nbsp;<span class="op" id="5838685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5838690">v</span><span class="op" id="5838691">.</span><span class="ident" id="5838692">Set</span><span class="op" id="5838695">(</span><span class="ident" id="5838696">reflect</span><span class="op" id="5838703">.</span><span class="ident" id="5838704">New</span><span class="op" id="5838707">(</span><span class="ident" id="5838708">v</span><span class="op" id="5838709">.</span><span class="ident" id="5838710">Type</span><span class="op" id="5838714">(</span><span class="op" id="5838715">)</span><span class="op" id="5838716">.</span><span class="ident" id="5838717">Elem</span><span class="op" id="5838721">(</span><span class="op" id="5838722">)</span><span class="op" id="5838723">)</span><span class="op" id="5838724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5838728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5838732">v</span>&nbsp;<span class="op" id="5838734">=</span>&nbsp;<span class="ident" id="5838736">v</span><span class="op" id="5838737">.</span><span class="ident" id="5838738">Elem</span><span class="op" id="5838742">(</span><span class="op" id="5838743">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5838746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5838749">return</span>&nbsp;<span class="ident" id="5838756">v</span><br>
<span class="lineno"></span><span class="op" id="5838758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5838761">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="5838824">func</span>&nbsp;<span class="ident" id="5838829">decBool</span><span class="op" id="5838836">(</span><span class="ident" id="5838837">i</span>&nbsp;<span class="op" id="5838839">*</span><span class="ident" id="5838840">decInstr</span><span class="op" id="5838848">,</span>&nbsp;<span class="ident" id="5838850">state</span>&nbsp;<span class="op" id="5838856">*</span><span class="ident" id="5838857">decoderState</span><span class="op" id="5838869">,</span>&nbsp;<span class="ident" id="5838871">value</span>&nbsp;<span class="ident" id="5838877">reflect</span><span class="op" id="5838884">.</span><span class="ident" id="5838885">Value</span><span class="op" id="5838890">)</span>&nbsp;<span class="op" id="5838892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5838895">value</span><span class="op" id="5838900">.</span><span class="ident" id="5838901">SetBool</span><span class="op" id="5838908">(</span><span class="ident" id="5838909">state</span><span class="op" id="5838914">.</span><span class="ident" id="5838915">decodeUint</span><span class="op" id="5838925">(</span><span class="op" id="5838926">)</span>&nbsp;<span class="op" id="5838928">!=</span>&nbsp;<span class="num" id="5838931">0</span><span class="op" id="5838932">)</span><br>
<span class="lineno"></span><span class="op" id="5838934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5838937">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="5839002">func</span>&nbsp;<span class="ident" id="5839007">decInt8</span><span class="op" id="5839014">(</span><span class="ident" id="5839015">i</span>&nbsp;<span class="op" id="5839017">*</span><span class="ident" id="5839018">decInstr</span><span class="op" id="5839026">,</span>&nbsp;<span class="ident" id="5839028">state</span>&nbsp;<span class="op" id="5839034">*</span><span class="ident" id="5839035">decoderState</span><span class="op" id="5839047">,</span>&nbsp;<span class="ident" id="5839049">value</span>&nbsp;<span class="ident" id="5839055">reflect</span><span class="op" id="5839062">.</span><span class="ident" id="5839063">Value</span><span class="op" id="5839068">)</span>&nbsp;<span class="op" id="5839070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839073">v</span>&nbsp;<span class="op" id="5839075">:=</span>&nbsp;<span class="ident" id="5839078">state</span><span class="op" id="5839083">.</span><span class="ident" id="5839084">decodeInt</span><span class="op" id="5839093">(</span><span class="op" id="5839094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5839097">if</span>&nbsp;<span class="ident" id="5839100">v</span>&nbsp;<span class="op" id="5839102">&lt;</span>&nbsp;<span class="ident" id="5839104">math</span><span class="op" id="5839108">.</span><span class="ident" id="5839109">MinInt8</span>&nbsp;<span class="op" id="5839117">||</span>&nbsp;<span class="ident" id="5839120">math</span><span class="op" id="5839124">.</span><span class="ident" id="5839125">MaxInt8</span>&nbsp;<span class="op" id="5839133">&lt;</span>&nbsp;<span class="ident" id="5839135">v</span>&nbsp;<span class="op" id="5839137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839141">error_</span><span class="op" id="5839147">(</span><span class="ident" id="5839148">i</span><span class="op" id="5839149">.</span><span class="ident" id="5839150">ovfl</span><span class="op" id="5839154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5839157">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839160">value</span><span class="op" id="5839165">.</span><span class="ident" id="5839166">SetInt</span><span class="op" id="5839172">(</span><span class="ident" id="5839173">v</span><span class="op" id="5839174">)</span><br>
<span class="lineno"></span><span class="op" id="5839176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5839179">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5839254">func</span>&nbsp;<span class="ident" id="5839259">decUint8</span><span class="op" id="5839267">(</span><span class="ident" id="5839268">i</span>&nbsp;<span class="op" id="5839270">*</span><span class="ident" id="5839271">decInstr</span><span class="op" id="5839279">,</span>&nbsp;<span class="ident" id="5839281">state</span>&nbsp;<span class="op" id="5839287">*</span><span class="ident" id="5839288">decoderState</span><span class="op" id="5839300">,</span>&nbsp;<span class="ident" id="5839302">value</span>&nbsp;<span class="ident" id="5839308">reflect</span><span class="op" id="5839315">.</span><span class="ident" id="5839316">Value</span><span class="op" id="5839321">)</span>&nbsp;<span class="op" id="5839323">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839326">v</span>&nbsp;<span class="op" id="5839328">:=</span>&nbsp;<span class="ident" id="5839331">state</span><span class="op" id="5839336">.</span><span class="ident" id="5839337">decodeUint</span><span class="op" id="5839347">(</span><span class="op" id="5839348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5839351">if</span>&nbsp;<span class="ident" id="5839354">math</span><span class="op" id="5839358">.</span><span class="ident" id="5839359">MaxUint8</span>&nbsp;<span class="op" id="5839368">&lt;</span>&nbsp;<span class="ident" id="5839370">v</span>&nbsp;<span class="op" id="5839372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839376">error_</span><span class="op" id="5839382">(</span><span class="ident" id="5839383">i</span><span class="op" id="5839384">.</span><span class="ident" id="5839385">ovfl</span><span class="op" id="5839389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5839392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839395">value</span><span class="op" id="5839400">.</span><span class="ident" id="5839401">SetUint</span><span class="op" id="5839408">(</span><span class="ident" id="5839409">v</span><span class="op" id="5839410">)</span><br>
<span class="lineno">250</span><span class="op" id="5839412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5839415">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5839482">func</span>&nbsp;<span class="ident" id="5839487">decInt16</span><span class="op" id="5839495">(</span><span class="ident" id="5839496">i</span>&nbsp;<span class="op" id="5839498">*</span><span class="ident" id="5839499">decInstr</span><span class="op" id="5839507">,</span>&nbsp;<span class="ident" id="5839509">state</span>&nbsp;<span class="op" id="5839515">*</span><span class="ident" id="5839516">decoderState</span><span class="op" id="5839528">,</span>&nbsp;<span class="ident" id="5839530">value</span>&nbsp;<span class="ident" id="5839536">reflect</span><span class="op" id="5839543">.</span><span class="ident" id="5839544">Value</span><span class="op" id="5839549">)</span>&nbsp;<span class="op" id="5839551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839554">v</span>&nbsp;<span class="op" id="5839556">:=</span>&nbsp;<span class="ident" id="5839559">state</span><span class="op" id="5839564">.</span><span class="ident" id="5839565">decodeInt</span><span class="op" id="5839574">(</span><span class="op" id="5839575">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5839578">if</span>&nbsp;<span class="ident" id="5839581">v</span>&nbsp;<span class="op" id="5839583">&lt;</span>&nbsp;<span class="ident" id="5839585">math</span><span class="op" id="5839589">.</span><span class="ident" id="5839590">MinInt16</span>&nbsp;<span class="op" id="5839599">||</span>&nbsp;<span class="ident" id="5839602">math</span><span class="op" id="5839606">.</span><span class="ident" id="5839607">MaxInt16</span>&nbsp;<span class="op" id="5839616">&lt;</span>&nbsp;<span class="ident" id="5839618">v</span>&nbsp;<span class="op" id="5839620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839624">error_</span><span class="op" id="5839630">(</span><span class="ident" id="5839631">i</span><span class="op" id="5839632">.</span><span class="ident" id="5839633">ovfl</span><span class="op" id="5839637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5839640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839643">value</span><span class="op" id="5839648">.</span><span class="ident" id="5839649">SetInt</span><span class="op" id="5839655">(</span><span class="ident" id="5839656">v</span><span class="op" id="5839657">)</span><br>
<span class="lineno"></span><span class="op" id="5839659">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="5839662">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5839739">func</span>&nbsp;<span class="ident" id="5839744">decUint16</span><span class="op" id="5839753">(</span><span class="ident" id="5839754">i</span>&nbsp;<span class="op" id="5839756">*</span><span class="ident" id="5839757">decInstr</span><span class="op" id="5839765">,</span>&nbsp;<span class="ident" id="5839767">state</span>&nbsp;<span class="op" id="5839773">*</span><span class="ident" id="5839774">decoderState</span><span class="op" id="5839786">,</span>&nbsp;<span class="ident" id="5839788">value</span>&nbsp;<span class="ident" id="5839794">reflect</span><span class="op" id="5839801">.</span><span class="ident" id="5839802">Value</span><span class="op" id="5839807">)</span>&nbsp;<span class="op" id="5839809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839812">v</span>&nbsp;<span class="op" id="5839814">:=</span>&nbsp;<span class="ident" id="5839817">state</span><span class="op" id="5839822">.</span><span class="ident" id="5839823">decodeUint</span><span class="op" id="5839833">(</span><span class="op" id="5839834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5839837">if</span>&nbsp;<span class="ident" id="5839840">math</span><span class="op" id="5839844">.</span><span class="ident" id="5839845">MaxUint16</span>&nbsp;<span class="op" id="5839855">&lt;</span>&nbsp;<span class="ident" id="5839857">v</span>&nbsp;<span class="op" id="5839859">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839863">error_</span><span class="op" id="5839869">(</span><span class="ident" id="5839870">i</span><span class="op" id="5839871">.</span><span class="ident" id="5839872">ovfl</span><span class="op" id="5839876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5839879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5839882">value</span><span class="op" id="5839887">.</span><span class="ident" id="5839888">SetUint</span><span class="op" id="5839895">(</span><span class="ident" id="5839896">v</span><span class="op" id="5839897">)</span><br>
<span class="lineno"></span><span class="op" id="5839899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5839902">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5839969">func</span>&nbsp;<span class="ident" id="5839974">decInt32</span><span class="op" id="5839982">(</span><span class="ident" id="5839983">i</span>&nbsp;<span class="op" id="5839985">*</span><span class="ident" id="5839986">decInstr</span><span class="op" id="5839994">,</span>&nbsp;<span class="ident" id="5839996">state</span>&nbsp;<span class="op" id="5840002">*</span><span class="ident" id="5840003">decoderState</span><span class="op" id="5840015">,</span>&nbsp;<span class="ident" id="5840017">value</span>&nbsp;<span class="ident" id="5840023">reflect</span><span class="op" id="5840030">.</span><span class="ident" id="5840031">Value</span><span class="op" id="5840036">)</span>&nbsp;<span class="op" id="5840038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840041">v</span>&nbsp;<span class="op" id="5840043">:=</span>&nbsp;<span class="ident" id="5840046">state</span><span class="op" id="5840051">.</span><span class="ident" id="5840052">decodeInt</span><span class="op" id="5840061">(</span><span class="op" id="5840062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5840065">if</span>&nbsp;<span class="ident" id="5840068">v</span>&nbsp;<span class="op" id="5840070">&lt;</span>&nbsp;<span class="ident" id="5840072">math</span><span class="op" id="5840076">.</span><span class="ident" id="5840077">MinInt32</span>&nbsp;<span class="op" id="5840086">||</span>&nbsp;<span class="ident" id="5840089">math</span><span class="op" id="5840093">.</span><span class="ident" id="5840094">MaxInt32</span>&nbsp;<span class="op" id="5840103">&lt;</span>&nbsp;<span class="ident" id="5840105">v</span>&nbsp;<span class="op" id="5840107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840111">error_</span><span class="op" id="5840117">(</span><span class="ident" id="5840118">i</span><span class="op" id="5840119">.</span><span class="ident" id="5840120">ovfl</span><span class="op" id="5840124">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5840127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840130">value</span><span class="op" id="5840135">.</span><span class="ident" id="5840136">SetInt</span><span class="op" id="5840142">(</span><span class="ident" id="5840143">v</span><span class="op" id="5840144">)</span><br>
<span class="lineno"></span><span class="op" id="5840146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5840149">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="5840226">func</span>&nbsp;<span class="ident" id="5840231">decUint32</span><span class="op" id="5840240">(</span><span class="ident" id="5840241">i</span>&nbsp;<span class="op" id="5840243">*</span><span class="ident" id="5840244">decInstr</span><span class="op" id="5840252">,</span>&nbsp;<span class="ident" id="5840254">state</span>&nbsp;<span class="op" id="5840260">*</span><span class="ident" id="5840261">decoderState</span><span class="op" id="5840273">,</span>&nbsp;<span class="ident" id="5840275">value</span>&nbsp;<span class="ident" id="5840281">reflect</span><span class="op" id="5840288">.</span><span class="ident" id="5840289">Value</span><span class="op" id="5840294">)</span>&nbsp;<span class="op" id="5840296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840299">v</span>&nbsp;<span class="op" id="5840301">:=</span>&nbsp;<span class="ident" id="5840304">state</span><span class="op" id="5840309">.</span><span class="ident" id="5840310">decodeUint</span><span class="op" id="5840320">(</span><span class="op" id="5840321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5840324">if</span>&nbsp;<span class="ident" id="5840327">math</span><span class="op" id="5840331">.</span><span class="ident" id="5840332">MaxUint32</span>&nbsp;<span class="op" id="5840342">&lt;</span>&nbsp;<span class="ident" id="5840344">v</span>&nbsp;<span class="op" id="5840346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840350">error_</span><span class="op" id="5840356">(</span><span class="ident" id="5840357">i</span><span class="op" id="5840358">.</span><span class="ident" id="5840359">ovfl</span><span class="op" id="5840363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5840366">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840369">value</span><span class="op" id="5840374">.</span><span class="ident" id="5840375">SetUint</span><span class="op" id="5840382">(</span><span class="ident" id="5840383">v</span><span class="op" id="5840384">)</span><br>
<span class="lineno"></span><span class="op" id="5840386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5840389">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5840456">func</span>&nbsp;<span class="ident" id="5840461">decInt64</span><span class="op" id="5840469">(</span><span class="ident" id="5840470">i</span>&nbsp;<span class="op" id="5840472">*</span><span class="ident" id="5840473">decInstr</span><span class="op" id="5840481">,</span>&nbsp;<span class="ident" id="5840483">state</span>&nbsp;<span class="op" id="5840489">*</span><span class="ident" id="5840490">decoderState</span><span class="op" id="5840502">,</span>&nbsp;<span class="ident" id="5840504">value</span>&nbsp;<span class="ident" id="5840510">reflect</span><span class="op" id="5840517">.</span><span class="ident" id="5840518">Value</span><span class="op" id="5840523">)</span>&nbsp;<span class="op" id="5840525">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840528">v</span>&nbsp;<span class="op" id="5840530">:=</span>&nbsp;<span class="ident" id="5840533">state</span><span class="op" id="5840538">.</span><span class="ident" id="5840539">decodeInt</span><span class="op" id="5840548">(</span><span class="op" id="5840549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840552">value</span><span class="op" id="5840557">.</span><span class="ident" id="5840558">SetInt</span><span class="op" id="5840564">(</span><span class="ident" id="5840565">v</span><span class="op" id="5840566">)</span><br>
<span class="lineno"></span><span class="op" id="5840568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5840571">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="5840648">func</span>&nbsp;<span class="ident" id="5840653">decUint64</span><span class="op" id="5840662">(</span><span class="ident" id="5840663">i</span>&nbsp;<span class="op" id="5840665">*</span><span class="ident" id="5840666">decInstr</span><span class="op" id="5840674">,</span>&nbsp;<span class="ident" id="5840676">state</span>&nbsp;<span class="op" id="5840682">*</span><span class="ident" id="5840683">decoderState</span><span class="op" id="5840695">,</span>&nbsp;<span class="ident" id="5840697">value</span>&nbsp;<span class="ident" id="5840703">reflect</span><span class="op" id="5840710">.</span><span class="ident" id="5840711">Value</span><span class="op" id="5840716">)</span>&nbsp;<span class="op" id="5840718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840721">v</span>&nbsp;<span class="op" id="5840723">:=</span>&nbsp;<span class="ident" id="5840726">state</span><span class="op" id="5840731">.</span><span class="ident" id="5840732">decodeUint</span><span class="op" id="5840742">(</span><span class="op" id="5840743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5840746">value</span><span class="op" id="5840751">.</span><span class="ident" id="5840752">SetUint</span><span class="op" id="5840759">(</span><span class="ident" id="5840760">v</span><span class="op" id="5840761">)</span><br>
<span class="lineno"></span><span class="op" id="5840763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="5840766">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5840836">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5840908">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="5840980">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5841045">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="5841061">func</span>&nbsp;<span class="ident" id="5841066">float64FromBits</span><span class="op" id="5841081">(</span><span class="ident" id="5841082">u</span>&nbsp;<span class="ident" id="5841084">uint64</span><span class="op" id="5841090">)</span>&nbsp;<span class="builtintype" id="5841092">float64</span>&nbsp;<span class="op" id="5841100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5841103">var</span>&nbsp;<span class="ident" id="5841107">v</span>&nbsp;<span class="ident" id="5841109">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5841117">for</span>&nbsp;<span class="ident" id="5841121">i</span>&nbsp;<span class="op" id="5841123">:=</span>&nbsp;<span class="num" id="5841126">0</span><span class="op" id="5841127">;</span>&nbsp;<span class="ident" id="5841129">i</span>&nbsp;<span class="op" id="5841131">&lt;</span>&nbsp;<span class="num" id="5841133">8</span><span class="op" id="5841134">;</span>&nbsp;<span class="ident" id="5841136">i</span><span class="op" id="5841137">++</span>&nbsp;<span class="op" id="5841140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841144">v</span>&nbsp;<span class="op" id="5841146">&lt;&lt;=</span>&nbsp;<span class="num" id="5841150">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841154">v</span>&nbsp;<span class="op" id="5841156">|=</span>&nbsp;<span class="ident" id="5841159">u</span>&nbsp;<span class="op" id="5841161">&amp;</span>&nbsp;<span class="num" id="5841163">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841170">u</span>&nbsp;<span class="op" id="5841172">&gt;&gt;=</span>&nbsp;<span class="num" id="5841176">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5841179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5841182">return</span>&nbsp;<span class="ident" id="5841189">math</span><span class="op" id="5841193">.</span><span class="ident" id="5841194">Float64frombits</span><span class="op" id="5841209">(</span><span class="ident" id="5841210">v</span><span class="op" id="5841211">)</span><br>
<span class="lineno"></span><span class="op" id="5841213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5841216">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5841301">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="5841378">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5841455">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="5841518">func</span>&nbsp;<span class="ident" id="5841523">float32FromBits</span><span class="op" id="5841538">(</span><span class="ident" id="5841539">u</span>&nbsp;<span class="ident" id="5841541">uint64</span><span class="op" id="5841547">,</span>&nbsp;<span class="ident" id="5841549">ovfl</span>&nbsp;<span class="builtintype" id="5841554">error</span><span class="op" id="5841559">)</span>&nbsp;<span class="builtintype" id="5841561">float64</span>&nbsp;<span class="op" id="5841569">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841572">v</span>&nbsp;<span class="op" id="5841574">:=</span>&nbsp;<span class="ident" id="5841577">float64FromBits</span><span class="op" id="5841592">(</span><span class="ident" id="5841593">u</span><span class="op" id="5841594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841597">av</span>&nbsp;<span class="op" id="5841600">:=</span>&nbsp;<span class="ident" id="5841603">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5841606">if</span>&nbsp;<span class="ident" id="5841609">av</span>&nbsp;<span class="op" id="5841612">&lt;</span>&nbsp;<span class="num" id="5841614">0</span>&nbsp;<span class="op" id="5841616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841620">av</span>&nbsp;<span class="op" id="5841623">=</span>&nbsp;<span class="op" id="5841625">-</span><span class="ident" id="5841626">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5841630">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5841633">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5841704">if</span>&nbsp;<span class="ident" id="5841707">math</span><span class="op" id="5841711">.</span><span class="ident" id="5841712">MaxFloat32</span>&nbsp;<span class="op" id="5841723">&lt;</span>&nbsp;<span class="ident" id="5841725">av</span>&nbsp;<span class="op" id="5841728">&amp;&amp;</span>&nbsp;<span class="ident" id="5841731">av</span>&nbsp;<span class="op" id="5841734">&lt;=</span>&nbsp;<span class="ident" id="5841737">math</span><span class="op" id="5841741">.</span><span class="ident" id="5841742">MaxFloat64</span>&nbsp;<span class="op" id="5841753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841757">error_</span><span class="op" id="5841763">(</span><span class="ident" id="5841764">ovfl</span><span class="op" id="5841768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5841771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5841774">return</span>&nbsp;<span class="ident" id="5841781">v</span><br>
<span class="lineno">330</span><span class="op" id="5841783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5841786">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5841866">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5841901">func</span>&nbsp;<span class="ident" id="5841906">decFloat32</span><span class="op" id="5841916">(</span><span class="ident" id="5841917">i</span>&nbsp;<span class="op" id="5841919">*</span><span class="ident" id="5841920">decInstr</span><span class="op" id="5841928">,</span>&nbsp;<span class="ident" id="5841930">state</span>&nbsp;<span class="op" id="5841936">*</span><span class="ident" id="5841937">decoderState</span><span class="op" id="5841949">,</span>&nbsp;<span class="ident" id="5841951">value</span>&nbsp;<span class="ident" id="5841957">reflect</span><span class="op" id="5841964">.</span><span class="ident" id="5841965">Value</span><span class="op" id="5841970">)</span>&nbsp;<span class="op" id="5841972">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5841975">value</span><span class="op" id="5841980">.</span><span class="ident" id="5841981">SetFloat</span><span class="op" id="5841989">(</span><span class="ident" id="5841990">float32FromBits</span><span class="op" id="5842005">(</span><span class="ident" id="5842006">state</span><span class="op" id="5842011">.</span><span class="ident" id="5842012">decodeUint</span><span class="op" id="5842022">(</span><span class="op" id="5842023">)</span><span class="op" id="5842024">,</span>&nbsp;<span class="ident" id="5842026">i</span><span class="op" id="5842027">.</span><span class="ident" id="5842028">ovfl</span><span class="op" id="5842032">)</span><span class="op" id="5842033">)</span><br>
<span class="lineno"></span><span class="op" id="5842035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5842038">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="5842118">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="5842153">func</span>&nbsp;<span class="ident" id="5842158">decFloat64</span><span class="op" id="5842168">(</span><span class="ident" id="5842169">i</span>&nbsp;<span class="op" id="5842171">*</span><span class="ident" id="5842172">decInstr</span><span class="op" id="5842180">,</span>&nbsp;<span class="ident" id="5842182">state</span>&nbsp;<span class="op" id="5842188">*</span><span class="ident" id="5842189">decoderState</span><span class="op" id="5842201">,</span>&nbsp;<span class="ident" id="5842203">value</span>&nbsp;<span class="ident" id="5842209">reflect</span><span class="op" id="5842216">.</span><span class="ident" id="5842217">Value</span><span class="op" id="5842222">)</span>&nbsp;<span class="op" id="5842224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5842227">value</span><span class="op" id="5842232">.</span><span class="ident" id="5842233">SetFloat</span><span class="op" id="5842241">(</span><span class="ident" id="5842242">float64FromBits</span><span class="op" id="5842257">(</span><span class="ident" id="5842258">state</span><span class="op" id="5842263">.</span><span class="ident" id="5842264">decodeUint</span><span class="op" id="5842274">(</span><span class="op" id="5842275">)</span><span class="op" id="5842276">)</span><span class="op" id="5842277">)</span><br>
<span class="lineno"></span><span class="op" id="5842279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5842282">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="5842352">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5842428">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5842458">func</span>&nbsp;<span class="ident" id="5842463">decComplex64</span><span class="op" id="5842475">(</span><span class="ident" id="5842476">i</span>&nbsp;<span class="op" id="5842478">*</span><span class="ident" id="5842479">decInstr</span><span class="op" id="5842487">,</span>&nbsp;<span class="ident" id="5842489">state</span>&nbsp;<span class="op" id="5842495">*</span><span class="ident" id="5842496">decoderState</span><span class="op" id="5842508">,</span>&nbsp;<span class="ident" id="5842510">value</span>&nbsp;<span class="ident" id="5842516">reflect</span><span class="op" id="5842523">.</span><span class="ident" id="5842524">Value</span><span class="op" id="5842529">)</span>&nbsp;<span class="op" id="5842531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5842534">real</span>&nbsp;<span class="op" id="5842539">:=</span>&nbsp;<span class="ident" id="5842542">float32FromBits</span><span class="op" id="5842557">(</span><span class="ident" id="5842558">state</span><span class="op" id="5842563">.</span><span class="ident" id="5842564">decodeUint</span><span class="op" id="5842574">(</span><span class="op" id="5842575">)</span><span class="op" id="5842576">,</span>&nbsp;<span class="ident" id="5842578">i</span><span class="op" id="5842579">.</span><span class="ident" id="5842580">ovfl</span><span class="op" id="5842584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5842587">imag</span>&nbsp;<span class="op" id="5842592">:=</span>&nbsp;<span class="ident" id="5842595">float32FromBits</span><span class="op" id="5842610">(</span><span class="ident" id="5842611">state</span><span class="op" id="5842616">.</span><span class="ident" id="5842617">decodeUint</span><span class="op" id="5842627">(</span><span class="op" id="5842628">)</span><span class="op" id="5842629">,</span>&nbsp;<span class="ident" id="5842631">i</span><span class="op" id="5842632">.</span><span class="ident" id="5842633">ovfl</span><span class="op" id="5842637">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5842640">value</span><span class="op" id="5842645">.</span><span class="ident" id="5842646">SetComplex</span><span class="op" id="5842656">(</span><span class="builtinfunc" id="5842657">complex</span><span class="op" id="5842664">(</span><span class="builtinfunc" id="5842665">real</span><span class="op" id="5842669">,</span>&nbsp;<span class="builtinfunc" id="5842671">imag</span><span class="op" id="5842675">)</span><span class="op" id="5842676">)</span><br>
<span class="lineno"></span><span class="op" id="5842678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5842681">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5842752">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="5842829">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5842859">func</span>&nbsp;<span class="ident" id="5842864">decComplex128</span><span class="op" id="5842877">(</span><span class="ident" id="5842878">i</span>&nbsp;<span class="op" id="5842880">*</span><span class="ident" id="5842881">decInstr</span><span class="op" id="5842889">,</span>&nbsp;<span class="ident" id="5842891">state</span>&nbsp;<span class="op" id="5842897">*</span><span class="ident" id="5842898">decoderState</span><span class="op" id="5842910">,</span>&nbsp;<span class="ident" id="5842912">value</span>&nbsp;<span class="ident" id="5842918">reflect</span><span class="op" id="5842925">.</span><span class="ident" id="5842926">Value</span><span class="op" id="5842931">)</span>&nbsp;<span class="op" id="5842933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5842936">real</span>&nbsp;<span class="op" id="5842941">:=</span>&nbsp;<span class="ident" id="5842944">float64FromBits</span><span class="op" id="5842959">(</span><span class="ident" id="5842960">state</span><span class="op" id="5842965">.</span><span class="ident" id="5842966">decodeUint</span><span class="op" id="5842976">(</span><span class="op" id="5842977">)</span><span class="op" id="5842978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5842981">imag</span>&nbsp;<span class="op" id="5842986">:=</span>&nbsp;<span class="ident" id="5842989">float64FromBits</span><span class="op" id="5843004">(</span><span class="ident" id="5843005">state</span><span class="op" id="5843010">.</span><span class="ident" id="5843011">decodeUint</span><span class="op" id="5843021">(</span><span class="op" id="5843022">)</span><span class="op" id="5843023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843026">value</span><span class="op" id="5843031">.</span><span class="ident" id="5843032">SetComplex</span><span class="op" id="5843042">(</span><span class="builtinfunc" id="5843043">complex</span><span class="op" id="5843050">(</span><span class="builtinfunc" id="5843051">real</span><span class="op" id="5843055">,</span>&nbsp;<span class="builtinfunc" id="5843057">imag</span><span class="op" id="5843061">)</span><span class="op" id="5843062">)</span><br>
<span class="lineno">360</span><span class="op" id="5843064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5843067">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5843140">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5843164">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="5843240">func</span>&nbsp;<span class="ident" id="5843245">decUint8Slice</span><span class="op" id="5843258">(</span><span class="ident" id="5843259">i</span>&nbsp;<span class="op" id="5843261">*</span><span class="ident" id="5843262">decInstr</span><span class="op" id="5843270">,</span>&nbsp;<span class="ident" id="5843272">state</span>&nbsp;<span class="op" id="5843278">*</span><span class="ident" id="5843279">decoderState</span><span class="op" id="5843291">,</span>&nbsp;<span class="ident" id="5843293">value</span>&nbsp;<span class="ident" id="5843299">reflect</span><span class="op" id="5843306">.</span><span class="ident" id="5843307">Value</span><span class="op" id="5843312">)</span>&nbsp;<span class="op" id="5843314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843317">u</span>&nbsp;<span class="op" id="5843319">:=</span>&nbsp;<span class="ident" id="5843322">state</span><span class="op" id="5843327">.</span><span class="ident" id="5843328">decodeUint</span><span class="op" id="5843338">(</span><span class="op" id="5843339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843342">n</span>&nbsp;<span class="op" id="5843344">:=</span>&nbsp;<span class="builtintype" id="5843347">int</span><span class="op" id="5843350">(</span><span class="ident" id="5843351">u</span><span class="op" id="5843352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5843355">if</span>&nbsp;<span class="ident" id="5843358">n</span>&nbsp;<span class="op" id="5843360">&lt;</span>&nbsp;<span class="num" id="5843362">0</span>&nbsp;<span class="op" id="5843364">||</span>&nbsp;<span class="ident" id="5843367">uint64</span><span class="op" id="5843373">(</span><span class="ident" id="5843374">n</span><span class="op" id="5843375">)</span>&nbsp;<span class="op" id="5843377">!=</span>&nbsp;<span class="ident" id="5843380">u</span>&nbsp;<span class="op" id="5843382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843386">errorf</span><span class="op" id="5843392">(</span><span class="string" id="5843393">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5843437">,</span>&nbsp;<span class="ident" id="5843439">value</span><span class="op" id="5843444">.</span><span class="ident" id="5843445">Type</span><span class="op" id="5843449">(</span><span class="op" id="5843450">)</span><span class="op" id="5843451">,</span>&nbsp;<span class="ident" id="5843453">u</span><span class="op" id="5843454">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5843457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5843460">if</span>&nbsp;<span class="ident" id="5843463">n</span>&nbsp;<span class="op" id="5843465">&gt;</span>&nbsp;<span class="ident" id="5843467">state</span><span class="op" id="5843472">.</span><span class="ident" id="5843473">b</span><span class="op" id="5843474">.</span><span class="ident" id="5843475">Len</span><span class="op" id="5843478">(</span><span class="op" id="5843479">)</span>&nbsp;<span class="op" id="5843481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843485">errorf</span><span class="op" id="5843491">(</span><span class="string" id="5843492">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5843525">,</span>&nbsp;<span class="ident" id="5843527">value</span><span class="op" id="5843532">.</span><span class="ident" id="5843533">Type</span><span class="op" id="5843537">(</span><span class="op" id="5843538">)</span><span class="op" id="5843539">,</span>&nbsp;<span class="ident" id="5843541">n</span><span class="op" id="5843542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5843545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5843548">if</span>&nbsp;<span class="ident" id="5843551">n</span>&nbsp;<span class="op" id="5843553">&gt;</span>&nbsp;<span class="ident" id="5843555">tooBig</span>&nbsp;<span class="op" id="5843562">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843566">errorf</span><span class="op" id="5843572">(</span><span class="string" id="5843573">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="5843597">,</span>&nbsp;<span class="ident" id="5843599">n</span><span class="op" id="5843600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5843603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5843606">if</span>&nbsp;<span class="ident" id="5843609">value</span><span class="op" id="5843614">.</span><span class="ident" id="5843615">Cap</span><span class="op" id="5843618">(</span><span class="op" id="5843619">)</span>&nbsp;<span class="op" id="5843621">&lt;</span>&nbsp;<span class="ident" id="5843623">n</span>&nbsp;<span class="op" id="5843625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843629">value</span><span class="op" id="5843634">.</span><span class="ident" id="5843635">Set</span><span class="op" id="5843638">(</span><span class="ident" id="5843639">reflect</span><span class="op" id="5843646">.</span><span class="ident" id="5843647">MakeSlice</span><span class="op" id="5843656">(</span><span class="ident" id="5843657">value</span><span class="op" id="5843662">.</span><span class="ident" id="5843663">Type</span><span class="op" id="5843667">(</span><span class="op" id="5843668">)</span><span class="op" id="5843669">,</span>&nbsp;<span class="ident" id="5843671">n</span><span class="op" id="5843672">,</span>&nbsp;<span class="ident" id="5843674">n</span><span class="op" id="5843675">)</span><span class="op" id="5843676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5843679">}</span>&nbsp;<span class="keyword" id="5843681">else</span>&nbsp;<span class="op" id="5843686">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843690">value</span><span class="op" id="5843695">.</span><span class="ident" id="5843696">Set</span><span class="op" id="5843699">(</span><span class="ident" id="5843700">value</span><span class="op" id="5843705">.</span><span class="ident" id="5843706">Slice</span><span class="op" id="5843711">(</span><span class="num" id="5843712">0</span><span class="op" id="5843713">,</span>&nbsp;<span class="ident" id="5843715">n</span><span class="op" id="5843716">)</span><span class="op" id="5843717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5843720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5843723">if</span>&nbsp;<span class="ident" id="5843726">_</span><span class="op" id="5843727">,</span>&nbsp;<span class="ident" id="5843729">err</span>&nbsp;<span class="op" id="5843733">:=</span>&nbsp;<span class="ident" id="5843736">state</span><span class="op" id="5843741">.</span><span class="ident" id="5843742">b</span><span class="op" id="5843743">.</span><span class="ident" id="5843744">Read</span><span class="op" id="5843748">(</span><span class="ident" id="5843749">value</span><span class="op" id="5843754">.</span><span class="ident" id="5843755">Bytes</span><span class="op" id="5843760">(</span><span class="op" id="5843761">)</span><span class="op" id="5843762">)</span><span class="op" id="5843763">;</span>&nbsp;<span class="ident" id="5843765">err</span>&nbsp;<span class="op" id="5843769">!=</span>&nbsp;<span class="builtintype" id="5843772">nil</span>&nbsp;<span class="op" id="5843776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5843780">errorf</span><span class="op" id="5843786">(</span><span class="string" id="5843787">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="5843814">,</span>&nbsp;<span class="ident" id="5843816">err</span><span class="op" id="5843819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5843822">}</span><br>
<span class="lineno">385</span><span class="op" id="5843824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5843827">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5843895">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5843919">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="5843990">func</span>&nbsp;<span class="ident" id="5843995">decString</span><span class="op" id="5844004">(</span><span class="ident" id="5844005">i</span>&nbsp;<span class="op" id="5844007">*</span><span class="ident" id="5844008">decInstr</span><span class="op" id="5844016">,</span>&nbsp;<span class="ident" id="5844018">state</span>&nbsp;<span class="op" id="5844024">*</span><span class="ident" id="5844025">decoderState</span><span class="op" id="5844037">,</span>&nbsp;<span class="ident" id="5844039">value</span>&nbsp;<span class="ident" id="5844045">reflect</span><span class="op" id="5844052">.</span><span class="ident" id="5844053">Value</span><span class="op" id="5844058">)</span>&nbsp;<span class="op" id="5844060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844063">u</span>&nbsp;<span class="op" id="5844065">:=</span>&nbsp;<span class="ident" id="5844068">state</span><span class="op" id="5844073">.</span><span class="ident" id="5844074">decodeUint</span><span class="op" id="5844084">(</span><span class="op" id="5844085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844088">n</span>&nbsp;<span class="op" id="5844090">:=</span>&nbsp;<span class="builtintype" id="5844093">int</span><span class="op" id="5844096">(</span><span class="ident" id="5844097">u</span><span class="op" id="5844098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5844101">if</span>&nbsp;<span class="ident" id="5844104">n</span>&nbsp;<span class="op" id="5844106">&lt;</span>&nbsp;<span class="num" id="5844108">0</span>&nbsp;<span class="op" id="5844110">||</span>&nbsp;<span class="ident" id="5844113">uint64</span><span class="op" id="5844119">(</span><span class="ident" id="5844120">n</span><span class="op" id="5844121">)</span>&nbsp;<span class="op" id="5844123">!=</span>&nbsp;<span class="ident" id="5844126">u</span>&nbsp;<span class="op" id="5844128">||</span>&nbsp;<span class="ident" id="5844131">n</span>&nbsp;<span class="op" id="5844133">&gt;</span>&nbsp;<span class="ident" id="5844135">state</span><span class="op" id="5844140">.</span><span class="ident" id="5844141">b</span><span class="op" id="5844142">.</span><span class="ident" id="5844143">Len</span><span class="op" id="5844146">(</span><span class="op" id="5844147">)</span>&nbsp;<span class="op" id="5844149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844153">errorf</span><span class="op" id="5844159">(</span><span class="string" id="5844160">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="5844204">,</span>&nbsp;<span class="ident" id="5844206">value</span><span class="op" id="5844211">.</span><span class="ident" id="5844212">Type</span><span class="op" id="5844216">(</span><span class="op" id="5844217">)</span><span class="op" id="5844218">,</span>&nbsp;<span class="ident" id="5844220">u</span><span class="op" id="5844221">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5844227">if</span>&nbsp;<span class="ident" id="5844230">n</span>&nbsp;<span class="op" id="5844232">&gt;</span>&nbsp;<span class="ident" id="5844234">state</span><span class="op" id="5844239">.</span><span class="ident" id="5844240">b</span><span class="op" id="5844241">.</span><span class="ident" id="5844242">Len</span><span class="op" id="5844245">(</span><span class="op" id="5844246">)</span>&nbsp;<span class="op" id="5844248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844252">errorf</span><span class="op" id="5844258">(</span><span class="string" id="5844259">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="5844292">,</span>&nbsp;<span class="ident" id="5844294">value</span><span class="op" id="5844299">.</span><span class="ident" id="5844300">Type</span><span class="op" id="5844304">(</span><span class="op" id="5844305">)</span><span class="op" id="5844306">,</span>&nbsp;<span class="ident" id="5844308">n</span><span class="op" id="5844309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5844315">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844334">data</span>&nbsp;<span class="op" id="5844339">:=</span>&nbsp;<span class="builtinfunc" id="5844342">make</span><span class="op" id="5844346">(</span><span class="op" id="5844347">[</span><span class="op" id="5844348">]</span><span class="builtintype" id="5844349">byte</span><span class="op" id="5844353">,</span>&nbsp;<span class="ident" id="5844355">n</span><span class="op" id="5844356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5844359">if</span>&nbsp;<span class="ident" id="5844362">_</span><span class="op" id="5844363">,</span>&nbsp;<span class="ident" id="5844365">err</span>&nbsp;<span class="op" id="5844369">:=</span>&nbsp;<span class="ident" id="5844372">state</span><span class="op" id="5844377">.</span><span class="ident" id="5844378">b</span><span class="op" id="5844379">.</span><span class="ident" id="5844380">Read</span><span class="op" id="5844384">(</span><span class="ident" id="5844385">data</span><span class="op" id="5844389">)</span><span class="op" id="5844390">;</span>&nbsp;<span class="ident" id="5844392">err</span>&nbsp;<span class="op" id="5844396">!=</span>&nbsp;<span class="builtintype" id="5844399">nil</span>&nbsp;<span class="op" id="5844403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844407">errorf</span><span class="op" id="5844413">(</span><span class="string" id="5844414">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="5844441">,</span>&nbsp;<span class="ident" id="5844443">err</span><span class="op" id="5844446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844452">value</span><span class="op" id="5844457">.</span><span class="ident" id="5844458">SetString</span><span class="op" id="5844467">(</span><span class="builtintype" id="5844468">string</span><span class="op" id="5844474">(</span><span class="ident" id="5844475">data</span><span class="op" id="5844479">)</span><span class="op" id="5844480">)</span><br>
<span class="lineno">405</span><span class="op" id="5844482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844485">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5844569">func</span>&nbsp;<span class="ident" id="5844574">ignoreUint8Array</span><span class="op" id="5844590">(</span><span class="ident" id="5844591">i</span>&nbsp;<span class="op" id="5844593">*</span><span class="ident" id="5844594">decInstr</span><span class="op" id="5844602">,</span>&nbsp;<span class="ident" id="5844604">state</span>&nbsp;<span class="op" id="5844610">*</span><span class="ident" id="5844611">decoderState</span><span class="op" id="5844623">,</span>&nbsp;<span class="ident" id="5844625">value</span>&nbsp;<span class="ident" id="5844631">reflect</span><span class="op" id="5844638">.</span><span class="ident" id="5844639">Value</span><span class="op" id="5844644">)</span>&nbsp;<span class="op" id="5844646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844649">b</span>&nbsp;<span class="op" id="5844651">:=</span>&nbsp;<span class="builtinfunc" id="5844654">make</span><span class="op" id="5844658">(</span><span class="op" id="5844659">[</span><span class="op" id="5844660">]</span><span class="builtintype" id="5844661">byte</span><span class="op" id="5844665">,</span>&nbsp;<span class="ident" id="5844667">state</span><span class="op" id="5844672">.</span><span class="ident" id="5844673">decodeUint</span><span class="op" id="5844683">(</span><span class="op" id="5844684">)</span><span class="op" id="5844685">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844688">state</span><span class="op" id="5844693">.</span><span class="ident" id="5844694">b</span><span class="op" id="5844695">.</span><span class="ident" id="5844696">Read</span><span class="op" id="5844700">(</span><span class="ident" id="5844701">b</span><span class="op" id="5844702">)</span><br>
<span class="lineno"></span><span class="op" id="5844704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844707">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5844728">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5844818">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="5844892">type</span>&nbsp;<span class="ident" id="5844897">decEngine</span>&nbsp;<span class="keyword" id="5844907">struct</span>&nbsp;<span class="op" id="5844914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844917">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5844926">[</span><span class="op" id="5844927">]</span><span class="ident" id="5844928">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5844938">numInstr</span>&nbsp;<span class="builtintype" id="5844947">int</span>&nbsp;<span class="comment" id="5844951">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="5844988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5844991">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5845078">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5845157">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="5845214">func</span>&nbsp;<span class="op" id="5845219">(</span><span class="ident" id="5845220">dec</span>&nbsp;<span class="op" id="5845224">*</span><span class="ident" id="5845225">Decoder</span><span class="op" id="5845232">)</span>&nbsp;<span class="ident" id="5845234">decodeSingle</span><span class="op" id="5845246">(</span><span class="ident" id="5845247">engine</span>&nbsp;<span class="op" id="5845254">*</span><span class="ident" id="5845255">decEngine</span><span class="op" id="5845264">,</span>&nbsp;<span class="ident" id="5845266">ut</span>&nbsp;<span class="op" id="5845269">*</span><span class="ident" id="5845270">userTypeInfo</span><span class="op" id="5845282">,</span>&nbsp;<span class="ident" id="5845284">value</span>&nbsp;<span class="ident" id="5845290">reflect</span><span class="op" id="5845297">.</span><span class="ident" id="5845298">Value</span><span class="op" id="5845303">)</span>&nbsp;<span class="op" id="5845305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5845308">state</span>&nbsp;<span class="op" id="5845314">:=</span>&nbsp;<span class="ident" id="5845317">dec</span><span class="op" id="5845320">.</span><span class="ident" id="5845321">newDecoderState</span><span class="op" id="5845336">(</span><span class="op" id="5845337">&amp;</span><span class="ident" id="5845338">dec</span><span class="op" id="5845341">.</span><span class="ident" id="5845342">buf</span><span class="op" id="5845345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5845348">defer</span>&nbsp;<span class="ident" id="5845354">dec</span><span class="op" id="5845357">.</span><span class="ident" id="5845358">freeDecoderState</span><span class="op" id="5845374">(</span><span class="ident" id="5845375">state</span><span class="op" id="5845380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5845383">state</span><span class="op" id="5845388">.</span><span class="ident" id="5845389">fieldnum</span>&nbsp;<span class="op" id="5845398">=</span>&nbsp;<span class="ident" id="5845400">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5845416">if</span>&nbsp;<span class="ident" id="5845419">state</span><span class="op" id="5845424">.</span><span class="ident" id="5845425">decodeUint</span><span class="op" id="5845435">(</span><span class="op" id="5845436">)</span>&nbsp;<span class="op" id="5845438">!=</span>&nbsp;<span class="num" id="5845441">0</span>&nbsp;<span class="op" id="5845443">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5845447">errorf</span><span class="op" id="5845453">(</span><span class="string" id="5845454">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5845508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5845511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5845514">instr</span>&nbsp;<span class="op" id="5845520">:=</span>&nbsp;<span class="op" id="5845523">&amp;</span><span class="ident" id="5845524">engine</span><span class="op" id="5845530">.</span><span class="ident" id="5845531">instr</span><span class="op" id="5845536">[</span><span class="ident" id="5845537">singletonField</span><span class="op" id="5845551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5845554">instr</span><span class="op" id="5845559">.</span><span class="ident" id="5845560">op</span><span class="op" id="5845562">(</span><span class="ident" id="5845563">instr</span><span class="op" id="5845568">,</span>&nbsp;<span class="ident" id="5845570">state</span><span class="op" id="5845575">,</span>&nbsp;<span class="ident" id="5845577">value</span><span class="op" id="5845582">)</span><br>
<span class="lineno"></span><span class="op" id="5845584">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5845587">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5845654">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="5845727">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="5845798">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="5845868">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="5845929">func</span>&nbsp;<span class="op" id="5845934">(</span><span class="ident" id="5845935">dec</span>&nbsp;<span class="op" id="5845939">*</span><span class="ident" id="5845940">Decoder</span><span class="op" id="5845947">)</span>&nbsp;<span class="ident" id="5845949">decodeStruct</span><span class="op" id="5845961">(</span><span class="ident" id="5845962">engine</span>&nbsp;<span class="op" id="5845969">*</span><span class="ident" id="5845970">decEngine</span><span class="op" id="5845979">,</span>&nbsp;<span class="ident" id="5845981">ut</span>&nbsp;<span class="op" id="5845984">*</span><span class="ident" id="5845985">userTypeInfo</span><span class="op" id="5845997">,</span>&nbsp;<span class="ident" id="5845999">value</span>&nbsp;<span class="ident" id="5846005">reflect</span><span class="op" id="5846012">.</span><span class="ident" id="5846013">Value</span><span class="op" id="5846018">)</span>&nbsp;<span class="op" id="5846020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846023">state</span>&nbsp;<span class="op" id="5846029">:=</span>&nbsp;<span class="ident" id="5846032">dec</span><span class="op" id="5846035">.</span><span class="ident" id="5846036">newDecoderState</span><span class="op" id="5846051">(</span><span class="op" id="5846052">&amp;</span><span class="ident" id="5846053">dec</span><span class="op" id="5846056">.</span><span class="ident" id="5846057">buf</span><span class="op" id="5846060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846063">defer</span>&nbsp;<span class="ident" id="5846069">dec</span><span class="op" id="5846072">.</span><span class="ident" id="5846073">freeDecoderState</span><span class="op" id="5846089">(</span><span class="ident" id="5846090">state</span><span class="op" id="5846095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846098">state</span><span class="op" id="5846103">.</span><span class="ident" id="5846104">fieldnum</span>&nbsp;<span class="op" id="5846113">=</span>&nbsp;<span class="op" id="5846115">-</span><span class="num" id="5846116">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846119">for</span>&nbsp;<span class="ident" id="5846123">state</span><span class="op" id="5846128">.</span><span class="ident" id="5846129">b</span><span class="op" id="5846130">.</span><span class="ident" id="5846131">Len</span><span class="op" id="5846134">(</span><span class="op" id="5846135">)</span>&nbsp;<span class="op" id="5846137">&gt;</span>&nbsp;<span class="num" id="5846139">0</span>&nbsp;<span class="op" id="5846141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846145">delta</span>&nbsp;<span class="op" id="5846151">:=</span>&nbsp;<span class="builtintype" id="5846154">int</span><span class="op" id="5846157">(</span><span class="ident" id="5846158">state</span><span class="op" id="5846163">.</span><span class="ident" id="5846164">decodeUint</span><span class="op" id="5846174">(</span><span class="op" id="5846175">)</span><span class="op" id="5846176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846180">if</span>&nbsp;<span class="ident" id="5846183">delta</span>&nbsp;<span class="op" id="5846189">&lt;</span>&nbsp;<span class="num" id="5846191">0</span>&nbsp;<span class="op" id="5846193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846198">errorf</span><span class="op" id="5846204">(</span><span class="string" id="5846205">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5846245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5846249">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846253">if</span>&nbsp;<span class="ident" id="5846256">delta</span>&nbsp;<span class="op" id="5846262">==</span>&nbsp;<span class="num" id="5846265">0</span>&nbsp;<span class="op" id="5846267">{</span>&nbsp;<span class="comment" id="5846269">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846316">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5846324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846328">fieldnum</span>&nbsp;<span class="op" id="5846337">:=</span>&nbsp;<span class="ident" id="5846340">state</span><span class="op" id="5846345">.</span><span class="ident" id="5846346">fieldnum</span>&nbsp;<span class="op" id="5846355">+</span>&nbsp;<span class="ident" id="5846357">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846365">if</span>&nbsp;<span class="ident" id="5846368">fieldnum</span>&nbsp;<span class="op" id="5846377">&gt;=</span>&nbsp;<span class="builtinfunc" id="5846380">len</span><span class="op" id="5846383">(</span><span class="ident" id="5846384">engine</span><span class="op" id="5846390">.</span><span class="ident" id="5846391">instr</span><span class="op" id="5846396">)</span>&nbsp;<span class="op" id="5846398">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846403">error_</span><span class="op" id="5846409">(</span><span class="ident" id="5846410">errRange</span><span class="op" id="5846418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846423">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5846431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846435">instr</span>&nbsp;<span class="op" id="5846441">:=</span>&nbsp;<span class="op" id="5846444">&amp;</span><span class="ident" id="5846445">engine</span><span class="op" id="5846451">.</span><span class="ident" id="5846452">instr</span><span class="op" id="5846457">[</span><span class="ident" id="5846458">fieldnum</span><span class="op" id="5846466">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846470">var</span>&nbsp;<span class="ident" id="5846474">field</span>&nbsp;<span class="ident" id="5846480">reflect</span><span class="op" id="5846487">.</span><span class="ident" id="5846488">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846496">if</span>&nbsp;<span class="ident" id="5846499">instr</span><span class="op" id="5846504">.</span><span class="ident" id="5846505">index</span>&nbsp;<span class="op" id="5846511">!=</span>&nbsp;<span class="builtintype" id="5846514">nil</span>&nbsp;<span class="op" id="5846518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5846523">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846596">field</span>&nbsp;<span class="op" id="5846602">=</span>&nbsp;<span class="ident" id="5846604">value</span><span class="op" id="5846609">.</span><span class="ident" id="5846610">FieldByIndex</span><span class="op" id="5846622">(</span><span class="ident" id="5846623">instr</span><span class="op" id="5846628">.</span><span class="ident" id="5846629">index</span><span class="op" id="5846634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846639">if</span>&nbsp;<span class="ident" id="5846642">field</span><span class="op" id="5846647">.</span><span class="ident" id="5846648">Kind</span><span class="op" id="5846652">(</span><span class="op" id="5846653">)</span>&nbsp;<span class="op" id="5846655">==</span>&nbsp;<span class="ident" id="5846658">reflect</span><span class="op" id="5846665">.</span><span class="ident" id="5846666">Ptr</span>&nbsp;<span class="op" id="5846670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846676">field</span>&nbsp;<span class="op" id="5846682">=</span>&nbsp;<span class="ident" id="5846684">decAlloc</span><span class="op" id="5846692">(</span><span class="ident" id="5846693">field</span><span class="op" id="5846698">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5846703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5846707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846711">instr</span><span class="op" id="5846716">.</span><span class="ident" id="5846717">op</span><span class="op" id="5846719">(</span><span class="ident" id="5846720">instr</span><span class="op" id="5846725">,</span>&nbsp;<span class="ident" id="5846727">state</span><span class="op" id="5846732">,</span>&nbsp;<span class="ident" id="5846734">field</span><span class="op" id="5846739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846743">state</span><span class="op" id="5846748">.</span><span class="ident" id="5846749">fieldnum</span>&nbsp;<span class="op" id="5846758">=</span>&nbsp;<span class="ident" id="5846760">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5846770">}</span><br>
<span class="lineno">470</span><span class="op" id="5846772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5846775">var</span>&nbsp;<span class="ident" id="5846779">noValue</span>&nbsp;<span class="ident" id="5846787">reflect</span><span class="op" id="5846794">.</span><span class="ident" id="5846795">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5846802">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="5846870">func</span>&nbsp;<span class="op" id="5846875">(</span><span class="ident" id="5846876">dec</span>&nbsp;<span class="op" id="5846880">*</span><span class="ident" id="5846881">Decoder</span><span class="op" id="5846888">)</span>&nbsp;<span class="ident" id="5846890">ignoreStruct</span><span class="op" id="5846902">(</span><span class="ident" id="5846903">engine</span>&nbsp;<span class="op" id="5846910">*</span><span class="ident" id="5846911">decEngine</span><span class="op" id="5846920">)</span>&nbsp;<span class="op" id="5846922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5846925">state</span>&nbsp;<span class="op" id="5846931">:=</span>&nbsp;<span class="ident" id="5846934">dec</span><span class="op" id="5846937">.</span><span class="ident" id="5846938">newDecoderState</span><span class="op" id="5846953">(</span><span class="op" id="5846954">&amp;</span><span class="ident" id="5846955">dec</span><span class="op" id="5846958">.</span><span class="ident" id="5846959">buf</span><span class="op" id="5846962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5846965">defer</span>&nbsp;<span class="ident" id="5846971">dec</span><span class="op" id="5846974">.</span><span class="ident" id="5846975">freeDecoderState</span><span class="op" id="5846991">(</span><span class="ident" id="5846992">state</span><span class="op" id="5846997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847000">state</span><span class="op" id="5847005">.</span><span class="ident" id="5847006">fieldnum</span>&nbsp;<span class="op" id="5847015">=</span>&nbsp;<span class="op" id="5847017">-</span><span class="num" id="5847018">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847021">for</span>&nbsp;<span class="ident" id="5847025">state</span><span class="op" id="5847030">.</span><span class="ident" id="5847031">b</span><span class="op" id="5847032">.</span><span class="ident" id="5847033">Len</span><span class="op" id="5847036">(</span><span class="op" id="5847037">)</span>&nbsp;<span class="op" id="5847039">&gt;</span>&nbsp;<span class="num" id="5847041">0</span>&nbsp;<span class="op" id="5847043">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847047">delta</span>&nbsp;<span class="op" id="5847053">:=</span>&nbsp;<span class="builtintype" id="5847056">int</span><span class="op" id="5847059">(</span><span class="ident" id="5847060">state</span><span class="op" id="5847065">.</span><span class="ident" id="5847066">decodeUint</span><span class="op" id="5847076">(</span><span class="op" id="5847077">)</span><span class="op" id="5847078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847082">if</span>&nbsp;<span class="ident" id="5847085">delta</span>&nbsp;<span class="op" id="5847091">&lt;</span>&nbsp;<span class="num" id="5847093">0</span>&nbsp;<span class="op" id="5847095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847100">errorf</span><span class="op" id="5847106">(</span><span class="string" id="5847107">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="5847154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5847158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847162">if</span>&nbsp;<span class="ident" id="5847165">delta</span>&nbsp;<span class="op" id="5847171">==</span>&nbsp;<span class="num" id="5847174">0</span>&nbsp;<span class="op" id="5847176">{</span>&nbsp;<span class="comment" id="5847178">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847225">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5847233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847237">fieldnum</span>&nbsp;<span class="op" id="5847246">:=</span>&nbsp;<span class="ident" id="5847249">state</span><span class="op" id="5847254">.</span><span class="ident" id="5847255">fieldnum</span>&nbsp;<span class="op" id="5847264">+</span>&nbsp;<span class="ident" id="5847266">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847274">if</span>&nbsp;<span class="ident" id="5847277">fieldnum</span>&nbsp;<span class="op" id="5847286">&gt;=</span>&nbsp;<span class="builtinfunc" id="5847289">len</span><span class="op" id="5847292">(</span><span class="ident" id="5847293">engine</span><span class="op" id="5847299">.</span><span class="ident" id="5847300">instr</span><span class="op" id="5847305">)</span>&nbsp;<span class="op" id="5847307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847312">error_</span><span class="op" id="5847318">(</span><span class="ident" id="5847319">errRange</span><span class="op" id="5847327">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5847331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847335">instr</span>&nbsp;<span class="op" id="5847341">:=</span>&nbsp;<span class="op" id="5847344">&amp;</span><span class="ident" id="5847345">engine</span><span class="op" id="5847351">.</span><span class="ident" id="5847352">instr</span><span class="op" id="5847357">[</span><span class="ident" id="5847358">fieldnum</span><span class="op" id="5847366">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847370">instr</span><span class="op" id="5847375">.</span><span class="ident" id="5847376">op</span><span class="op" id="5847378">(</span><span class="ident" id="5847379">instr</span><span class="op" id="5847384">,</span>&nbsp;<span class="ident" id="5847386">state</span><span class="op" id="5847391">,</span>&nbsp;<span class="ident" id="5847393">noValue</span><span class="op" id="5847400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847404">state</span><span class="op" id="5847409">.</span><span class="ident" id="5847410">fieldnum</span>&nbsp;<span class="op" id="5847419">=</span>&nbsp;<span class="ident" id="5847421">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5847431">}</span><br>
<span class="lineno">495</span><span class="op" id="5847433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5847436">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="5847511">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5847575">func</span>&nbsp;<span class="op" id="5847580">(</span><span class="ident" id="5847581">dec</span>&nbsp;<span class="op" id="5847585">*</span><span class="ident" id="5847586">Decoder</span><span class="op" id="5847593">)</span>&nbsp;<span class="ident" id="5847595">ignoreSingle</span><span class="op" id="5847607">(</span><span class="ident" id="5847608">engine</span>&nbsp;<span class="op" id="5847615">*</span><span class="ident" id="5847616">decEngine</span><span class="op" id="5847625">)</span>&nbsp;<span class="op" id="5847627">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847630">state</span>&nbsp;<span class="op" id="5847636">:=</span>&nbsp;<span class="ident" id="5847639">dec</span><span class="op" id="5847642">.</span><span class="ident" id="5847643">newDecoderState</span><span class="op" id="5847658">(</span><span class="op" id="5847659">&amp;</span><span class="ident" id="5847660">dec</span><span class="op" id="5847663">.</span><span class="ident" id="5847664">buf</span><span class="op" id="5847667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847670">defer</span>&nbsp;<span class="ident" id="5847676">dec</span><span class="op" id="5847679">.</span><span class="ident" id="5847680">freeDecoderState</span><span class="op" id="5847696">(</span><span class="ident" id="5847697">state</span><span class="op" id="5847702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847705">state</span><span class="op" id="5847710">.</span><span class="ident" id="5847711">fieldnum</span>&nbsp;<span class="op" id="5847720">=</span>&nbsp;<span class="ident" id="5847722">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847738">delta</span>&nbsp;<span class="op" id="5847744">:=</span>&nbsp;<span class="builtintype" id="5847747">int</span><span class="op" id="5847750">(</span><span class="ident" id="5847751">state</span><span class="op" id="5847756">.</span><span class="ident" id="5847757">decodeUint</span><span class="op" id="5847767">(</span><span class="op" id="5847768">)</span><span class="op" id="5847769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5847772">if</span>&nbsp;<span class="ident" id="5847775">delta</span>&nbsp;<span class="op" id="5847781">!=</span>&nbsp;<span class="num" id="5847784">0</span>&nbsp;<span class="op" id="5847786">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847790">errorf</span><span class="op" id="5847796">(</span><span class="string" id="5847797">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="5847851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5847854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847857">instr</span>&nbsp;<span class="op" id="5847863">:=</span>&nbsp;<span class="op" id="5847866">&amp;</span><span class="ident" id="5847867">engine</span><span class="op" id="5847873">.</span><span class="ident" id="5847874">instr</span><span class="op" id="5847879">[</span><span class="ident" id="5847880">singletonField</span><span class="op" id="5847894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5847897">instr</span><span class="op" id="5847902">.</span><span class="ident" id="5847903">op</span><span class="op" id="5847905">(</span><span class="ident" id="5847906">instr</span><span class="op" id="5847911">,</span>&nbsp;<span class="ident" id="5847913">state</span><span class="op" id="5847918">,</span>&nbsp;<span class="ident" id="5847920">noValue</span><span class="op" id="5847927">)</span><br>
<span class="lineno"></span><span class="op" id="5847929">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="5847932">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5847999">func</span>&nbsp;<span class="op" id="5848004">(</span><span class="ident" id="5848005">dec</span>&nbsp;<span class="op" id="5848009">*</span><span class="ident" id="5848010">Decoder</span><span class="op" id="5848017">)</span>&nbsp;<span class="ident" id="5848019">decodeArrayHelper</span><span class="op" id="5848036">(</span><span class="ident" id="5848037">state</span>&nbsp;<span class="op" id="5848043">*</span><span class="ident" id="5848044">decoderState</span><span class="op" id="5848056">,</span>&nbsp;<span class="ident" id="5848058">value</span>&nbsp;<span class="ident" id="5848064">reflect</span><span class="op" id="5848071">.</span><span class="ident" id="5848072">Value</span><span class="op" id="5848077">,</span>&nbsp;<span class="ident" id="5848079">elemOp</span>&nbsp;<span class="ident" id="5848086">decOp</span><span class="op" id="5848091">,</span>&nbsp;<span class="ident" id="5848093">length</span>&nbsp;<span class="builtintype" id="5848100">int</span><span class="op" id="5848103">,</span>&nbsp;<span class="ident" id="5848105">ovfl</span>&nbsp;<span class="builtintype" id="5848110">error</span><span class="op" id="5848115">,</span>&nbsp;<span class="ident" id="5848117">helper</span>&nbsp;<span class="ident" id="5848124">decHelper</span><span class="op" id="5848133">)</span>&nbsp;<span class="op" id="5848135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5848138">if</span>&nbsp;<span class="ident" id="5848141">helper</span>&nbsp;<span class="op" id="5848148">!=</span>&nbsp;<span class="builtintype" id="5848151">nil</span>&nbsp;<span class="op" id="5848155">&amp;&amp;</span>&nbsp;<span class="ident" id="5848158">helper</span><span class="op" id="5848164">(</span><span class="ident" id="5848165">state</span><span class="op" id="5848170">,</span>&nbsp;<span class="ident" id="5848172">value</span><span class="op" id="5848177">,</span>&nbsp;<span class="ident" id="5848179">length</span><span class="op" id="5848185">,</span>&nbsp;<span class="ident" id="5848187">ovfl</span><span class="op" id="5848191">)</span>&nbsp;<span class="op" id="5848193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5848197">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5848205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848208">instr</span>&nbsp;<span class="op" id="5848214">:=</span>&nbsp;<span class="op" id="5848217">&amp;</span><span class="ident" id="5848218">decInstr</span><span class="op" id="5848226">{</span><span class="ident" id="5848227">elemOp</span><span class="op" id="5848233">,</span>&nbsp;<span class="num" id="5848235">0</span><span class="op" id="5848236">,</span>&nbsp;<span class="builtintype" id="5848238">nil</span><span class="op" id="5848241">,</span>&nbsp;<span class="ident" id="5848243">ovfl</span><span class="op" id="5848247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848250">isPtr</span>&nbsp;<span class="op" id="5848256">:=</span>&nbsp;<span class="ident" id="5848259">value</span><span class="op" id="5848264">.</span><span class="ident" id="5848265">Type</span><span class="op" id="5848269">(</span><span class="op" id="5848270">)</span><span class="op" id="5848271">.</span><span class="ident" id="5848272">Elem</span><span class="op" id="5848276">(</span><span class="op" id="5848277">)</span><span class="op" id="5848278">.</span><span class="ident" id="5848279">Kind</span><span class="op" id="5848283">(</span><span class="op" id="5848284">)</span>&nbsp;<span class="op" id="5848286">==</span>&nbsp;<span class="ident" id="5848289">reflect</span><span class="op" id="5848296">.</span><span class="ident" id="5848297">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5848302">for</span>&nbsp;<span class="ident" id="5848306">i</span>&nbsp;<span class="op" id="5848308">:=</span>&nbsp;<span class="num" id="5848311">0</span><span class="op" id="5848312">;</span>&nbsp;<span class="ident" id="5848314">i</span>&nbsp;<span class="op" id="5848316">&lt;</span>&nbsp;<span class="ident" id="5848318">length</span><span class="op" id="5848324">;</span>&nbsp;<span class="ident" id="5848326">i</span><span class="op" id="5848327">++</span>&nbsp;<span class="op" id="5848330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5848334">if</span>&nbsp;<span class="ident" id="5848337">state</span><span class="op" id="5848342">.</span><span class="ident" id="5848343">b</span><span class="op" id="5848344">.</span><span class="ident" id="5848345">Len</span><span class="op" id="5848348">(</span><span class="op" id="5848349">)</span>&nbsp;<span class="op" id="5848351">==</span>&nbsp;<span class="num" id="5848354">0</span>&nbsp;<span class="op" id="5848356">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848361">errorf</span><span class="op" id="5848367">(</span><span class="string" id="5848368">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="5848434">,</span>&nbsp;<span class="ident" id="5848436">length</span><span class="op" id="5848442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5848446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848450">v</span>&nbsp;<span class="op" id="5848452">:=</span>&nbsp;<span class="ident" id="5848455">value</span><span class="op" id="5848460">.</span><span class="ident" id="5848461">Index</span><span class="op" id="5848466">(</span><span class="ident" id="5848467">i</span><span class="op" id="5848468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5848472">if</span>&nbsp;<span class="ident" id="5848475">isPtr</span>&nbsp;<span class="op" id="5848481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848486">v</span>&nbsp;<span class="op" id="5848488">=</span>&nbsp;<span class="ident" id="5848490">decAlloc</span><span class="op" id="5848498">(</span><span class="ident" id="5848499">v</span><span class="op" id="5848500">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5848504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848508">elemOp</span><span class="op" id="5848514">(</span><span class="ident" id="5848515">instr</span><span class="op" id="5848520">,</span>&nbsp;<span class="ident" id="5848522">state</span><span class="op" id="5848527">,</span>&nbsp;<span class="ident" id="5848529">v</span><span class="op" id="5848530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5848533">}</span><br>
<span class="lineno"></span><span class="op" id="5848535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="5848538">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5848594">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="5848692">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5848773">func</span>&nbsp;<span class="op" id="5848778">(</span><span class="ident" id="5848779">dec</span>&nbsp;<span class="op" id="5848783">*</span><span class="ident" id="5848784">Decoder</span><span class="op" id="5848791">)</span>&nbsp;<span class="ident" id="5848793">decodeArray</span><span class="op" id="5848804">(</span><span class="ident" id="5848805">atyp</span>&nbsp;<span class="ident" id="5848810">reflect</span><span class="op" id="5848817">.</span><span class="ident" id="5848818">Type</span><span class="op" id="5848822">,</span>&nbsp;<span class="ident" id="5848824">state</span>&nbsp;<span class="op" id="5848830">*</span><span class="ident" id="5848831">decoderState</span><span class="op" id="5848843">,</span>&nbsp;<span class="ident" id="5848845">value</span>&nbsp;<span class="ident" id="5848851">reflect</span><span class="op" id="5848858">.</span><span class="ident" id="5848859">Value</span><span class="op" id="5848864">,</span>&nbsp;<span class="ident" id="5848866">elemOp</span>&nbsp;<span class="ident" id="5848873">decOp</span><span class="op" id="5848878">,</span>&nbsp;<span class="ident" id="5848880">length</span>&nbsp;<span class="builtintype" id="5848887">int</span><span class="op" id="5848890">,</span>&nbsp;<span class="ident" id="5848892">ovfl</span>&nbsp;<span class="builtintype" id="5848897">error</span><span class="op" id="5848902">,</span>&nbsp;<span class="ident" id="5848904">helper</span>&nbsp;<span class="ident" id="5848911">decHelper</span><span class="op" id="5848920">)</span>&nbsp;<span class="op" id="5848922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5848925">if</span>&nbsp;<span class="ident" id="5848928">n</span>&nbsp;<span class="op" id="5848930">:=</span>&nbsp;<span class="ident" id="5848933">state</span><span class="op" id="5848938">.</span><span class="ident" id="5848939">decodeUint</span><span class="op" id="5848949">(</span><span class="op" id="5848950">)</span><span class="op" id="5848951">;</span>&nbsp;<span class="ident" id="5848953">n</span>&nbsp;<span class="op" id="5848955">!=</span>&nbsp;<span class="ident" id="5848958">uint64</span><span class="op" id="5848964">(</span><span class="ident" id="5848965">length</span><span class="op" id="5848971">)</span>&nbsp;<span class="op" id="5848973">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5848977">errorf</span><span class="op" id="5848983">(</span><span class="string" id="5848984">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="5849016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5849019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849022">dec</span><span class="op" id="5849025">.</span><span class="ident" id="5849026">decodeArrayHelper</span><span class="op" id="5849043">(</span><span class="ident" id="5849044">state</span><span class="op" id="5849049">,</span>&nbsp;<span class="ident" id="5849051">value</span><span class="op" id="5849056">,</span>&nbsp;<span class="ident" id="5849058">elemOp</span><span class="op" id="5849064">,</span>&nbsp;<span class="ident" id="5849066">length</span><span class="op" id="5849072">,</span>&nbsp;<span class="ident" id="5849074">ovfl</span><span class="op" id="5849078">,</span>&nbsp;<span class="ident" id="5849080">helper</span><span class="op" id="5849086">)</span><br>
<span class="lineno"></span><span class="op" id="5849088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5849091">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5849140">func</span>&nbsp;<span class="ident" id="5849145">decodeIntoValue</span><span class="op" id="5849160">(</span><span class="ident" id="5849161">state</span>&nbsp;<span class="op" id="5849167">*</span><span class="ident" id="5849168">decoderState</span><span class="op" id="5849180">,</span>&nbsp;<span class="ident" id="5849182">op</span>&nbsp;<span class="ident" id="5849185">decOp</span><span class="op" id="5849190">,</span>&nbsp;<span class="ident" id="5849192">isPtr</span>&nbsp;<span class="builtintype" id="5849198">bool</span><span class="op" id="5849202">,</span>&nbsp;<span class="ident" id="5849204">value</span>&nbsp;<span class="ident" id="5849210">reflect</span><span class="op" id="5849217">.</span><span class="ident" id="5849218">Value</span><span class="op" id="5849223">,</span>&nbsp;<span class="ident" id="5849225">ovfl</span>&nbsp;<span class="builtintype" id="5849230">error</span><span class="op" id="5849235">)</span>&nbsp;<span class="ident" id="5849237">reflect</span><span class="op" id="5849244">.</span><span class="ident" id="5849245">Value</span>&nbsp;<span class="op" id="5849251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849254">instr</span>&nbsp;<span class="op" id="5849260">:=</span>&nbsp;<span class="op" id="5849263">&amp;</span><span class="ident" id="5849264">decInstr</span><span class="op" id="5849272">{</span><span class="ident" id="5849273">op</span><span class="op" id="5849275">,</span>&nbsp;<span class="num" id="5849277">0</span><span class="op" id="5849278">,</span>&nbsp;<span class="builtintype" id="5849280">nil</span><span class="op" id="5849283">,</span>&nbsp;<span class="ident" id="5849285">ovfl</span><span class="op" id="5849289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849292">v</span>&nbsp;<span class="op" id="5849294">:=</span>&nbsp;<span class="ident" id="5849297">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5849304">if</span>&nbsp;<span class="ident" id="5849307">isPtr</span>&nbsp;<span class="op" id="5849313">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849317">v</span>&nbsp;<span class="op" id="5849319">=</span>&nbsp;<span class="ident" id="5849321">decAlloc</span><span class="op" id="5849329">(</span><span class="ident" id="5849330">value</span><span class="op" id="5849335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5849338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849341">op</span><span class="op" id="5849343">(</span><span class="ident" id="5849344">instr</span><span class="op" id="5849349">,</span>&nbsp;<span class="ident" id="5849351">state</span><span class="op" id="5849356">,</span>&nbsp;<span class="ident" id="5849358">v</span><span class="op" id="5849359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5849362">return</span>&nbsp;<span class="ident" id="5849369">value</span><br>
<span class="lineno"></span><span class="op" id="5849375">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="5849378">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5849429">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="5849490">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5849554">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="5849599">func</span>&nbsp;<span class="op" id="5849604">(</span><span class="ident" id="5849605">dec</span>&nbsp;<span class="op" id="5849609">*</span><span class="ident" id="5849610">Decoder</span><span class="op" id="5849617">)</span>&nbsp;<span class="ident" id="5849619">decodeMap</span><span class="op" id="5849628">(</span><span class="ident" id="5849629">mtyp</span>&nbsp;<span class="ident" id="5849634">reflect</span><span class="op" id="5849641">.</span><span class="ident" id="5849642">Type</span><span class="op" id="5849646">,</span>&nbsp;<span class="ident" id="5849648">state</span>&nbsp;<span class="op" id="5849654">*</span><span class="ident" id="5849655">decoderState</span><span class="op" id="5849667">,</span>&nbsp;<span class="ident" id="5849669">value</span>&nbsp;<span class="ident" id="5849675">reflect</span><span class="op" id="5849682">.</span><span class="ident" id="5849683">Value</span><span class="op" id="5849688">,</span>&nbsp;<span class="ident" id="5849690">keyOp</span><span class="op" id="5849695">,</span>&nbsp;<span class="ident" id="5849697">elemOp</span>&nbsp;<span class="ident" id="5849704">decOp</span><span class="op" id="5849709">,</span>&nbsp;<span class="ident" id="5849711">ovfl</span>&nbsp;<span class="builtintype" id="5849716">error</span><span class="op" id="5849721">)</span>&nbsp;<span class="op" id="5849723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5849726">if</span>&nbsp;<span class="ident" id="5849729">value</span><span class="op" id="5849734">.</span><span class="ident" id="5849735">IsNil</span><span class="op" id="5849740">(</span><span class="op" id="5849741">)</span>&nbsp;<span class="op" id="5849743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5849747">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849766">value</span><span class="op" id="5849771">.</span><span class="ident" id="5849772">Set</span><span class="op" id="5849775">(</span><span class="ident" id="5849776">reflect</span><span class="op" id="5849783">.</span><span class="ident" id="5849784">MakeMap</span><span class="op" id="5849791">(</span><span class="ident" id="5849792">mtyp</span><span class="op" id="5849796">)</span><span class="op" id="5849797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5849800">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849803">n</span>&nbsp;<span class="op" id="5849805">:=</span>&nbsp;<span class="builtintype" id="5849808">int</span><span class="op" id="5849811">(</span><span class="ident" id="5849812">state</span><span class="op" id="5849817">.</span><span class="ident" id="5849818">decodeUint</span><span class="op" id="5849828">(</span><span class="op" id="5849829">)</span><span class="op" id="5849830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849833">keyIsPtr</span>&nbsp;<span class="op" id="5849842">:=</span>&nbsp;<span class="ident" id="5849845">mtyp</span><span class="op" id="5849849">.</span><span class="ident" id="5849850">Key</span><span class="op" id="5849853">(</span><span class="op" id="5849854">)</span><span class="op" id="5849855">.</span><span class="ident" id="5849856">Kind</span><span class="op" id="5849860">(</span><span class="op" id="5849861">)</span>&nbsp;<span class="op" id="5849863">==</span>&nbsp;<span class="ident" id="5849866">reflect</span><span class="op" id="5849873">.</span><span class="ident" id="5849874">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849879">elemIsPtr</span>&nbsp;<span class="op" id="5849889">:=</span>&nbsp;<span class="ident" id="5849892">mtyp</span><span class="op" id="5849896">.</span><span class="ident" id="5849897">Elem</span><span class="op" id="5849901">(</span><span class="op" id="5849902">)</span><span class="op" id="5849903">.</span><span class="ident" id="5849904">Kind</span><span class="op" id="5849908">(</span><span class="op" id="5849909">)</span>&nbsp;<span class="op" id="5849911">==</span>&nbsp;<span class="ident" id="5849914">reflect</span><span class="op" id="5849921">.</span><span class="ident" id="5849922">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5849927">for</span>&nbsp;<span class="ident" id="5849931">i</span>&nbsp;<span class="op" id="5849933">:=</span>&nbsp;<span class="num" id="5849936">0</span><span class="op" id="5849937">;</span>&nbsp;<span class="ident" id="5849939">i</span>&nbsp;<span class="op" id="5849941">&lt;</span>&nbsp;<span class="ident" id="5849943">n</span><span class="op" id="5849944">;</span>&nbsp;<span class="ident" id="5849946">i</span><span class="op" id="5849947">++</span>&nbsp;<span class="op" id="5849950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5849954">key</span>&nbsp;<span class="op" id="5849958">:=</span>&nbsp;<span class="ident" id="5849961">decodeIntoValue</span><span class="op" id="5849976">(</span><span class="ident" id="5849977">state</span><span class="op" id="5849982">,</span>&nbsp;<span class="ident" id="5849984">keyOp</span><span class="op" id="5849989">,</span>&nbsp;<span class="ident" id="5849991">keyIsPtr</span><span class="op" id="5849999">,</span>&nbsp;<span class="ident" id="5850001">allocValue</span><span class="op" id="5850011">(</span><span class="ident" id="5850012">mtyp</span><span class="op" id="5850016">.</span><span class="ident" id="5850017">Key</span><span class="op" id="5850020">(</span><span class="op" id="5850021">)</span><span class="op" id="5850022">)</span><span class="op" id="5850023">,</span>&nbsp;<span class="ident" id="5850025">ovfl</span><span class="op" id="5850029">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850033">elem</span>&nbsp;<span class="op" id="5850038">:=</span>&nbsp;<span class="ident" id="5850041">decodeIntoValue</span><span class="op" id="5850056">(</span><span class="ident" id="5850057">state</span><span class="op" id="5850062">,</span>&nbsp;<span class="ident" id="5850064">elemOp</span><span class="op" id="5850070">,</span>&nbsp;<span class="ident" id="5850072">elemIsPtr</span><span class="op" id="5850081">,</span>&nbsp;<span class="ident" id="5850083">allocValue</span><span class="op" id="5850093">(</span><span class="ident" id="5850094">mtyp</span><span class="op" id="5850098">.</span><span class="ident" id="5850099">Elem</span><span class="op" id="5850103">(</span><span class="op" id="5850104">)</span><span class="op" id="5850105">)</span><span class="op" id="5850106">,</span>&nbsp;<span class="ident" id="5850108">ovfl</span><span class="op" id="5850112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850116">value</span><span class="op" id="5850121">.</span><span class="ident" id="5850122">SetMapIndex</span><span class="op" id="5850133">(</span><span class="ident" id="5850134">key</span><span class="op" id="5850137">,</span>&nbsp;<span class="ident" id="5850139">elem</span><span class="op" id="5850143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5850146">}</span><br>
<span class="lineno"></span><span class="op" id="5850148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="5850151">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="5850220">func</span>&nbsp;<span class="op" id="5850225">(</span><span class="ident" id="5850226">dec</span>&nbsp;<span class="op" id="5850230">*</span><span class="ident" id="5850231">Decoder</span><span class="op" id="5850238">)</span>&nbsp;<span class="ident" id="5850240">ignoreArrayHelper</span><span class="op" id="5850257">(</span><span class="ident" id="5850258">state</span>&nbsp;<span class="op" id="5850264">*</span><span class="ident" id="5850265">decoderState</span><span class="op" id="5850277">,</span>&nbsp;<span class="ident" id="5850279">elemOp</span>&nbsp;<span class="ident" id="5850286">decOp</span><span class="op" id="5850291">,</span>&nbsp;<span class="ident" id="5850293">length</span>&nbsp;<span class="builtintype" id="5850300">int</span><span class="op" id="5850303">)</span>&nbsp;<span class="op" id="5850305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850308">instr</span>&nbsp;<span class="op" id="5850314">:=</span>&nbsp;<span class="op" id="5850317">&amp;</span><span class="ident" id="5850318">decInstr</span><span class="op" id="5850326">{</span><span class="ident" id="5850327">elemOp</span><span class="op" id="5850333">,</span>&nbsp;<span class="num" id="5850335">0</span><span class="op" id="5850336">,</span>&nbsp;<span class="builtintype" id="5850338">nil</span><span class="op" id="5850341">,</span>&nbsp;<span class="ident" id="5850343">errors</span><span class="op" id="5850349">.</span><span class="ident" id="5850350">New</span><span class="op" id="5850353">(</span><span class="string" id="5850354">&#34;no&nbsp;error&#34;</span><span class="op" id="5850364">)</span><span class="op" id="5850365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5850368">for</span>&nbsp;<span class="ident" id="5850372">i</span>&nbsp;<span class="op" id="5850374">:=</span>&nbsp;<span class="num" id="5850377">0</span><span class="op" id="5850378">;</span>&nbsp;<span class="ident" id="5850380">i</span>&nbsp;<span class="op" id="5850382">&lt;</span>&nbsp;<span class="ident" id="5850384">length</span><span class="op" id="5850390">;</span>&nbsp;<span class="ident" id="5850392">i</span><span class="op" id="5850393">++</span>&nbsp;<span class="op" id="5850396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850400">elemOp</span><span class="op" id="5850406">(</span><span class="ident" id="5850407">instr</span><span class="op" id="5850412">,</span>&nbsp;<span class="ident" id="5850414">state</span><span class="op" id="5850419">,</span>&nbsp;<span class="ident" id="5850421">noValue</span><span class="op" id="5850428">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5850431">}</span><br>
<span class="lineno"></span><span class="op" id="5850433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5850436">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5850509">func</span>&nbsp;<span class="op" id="5850514">(</span><span class="ident" id="5850515">dec</span>&nbsp;<span class="op" id="5850519">*</span><span class="ident" id="5850520">Decoder</span><span class="op" id="5850527">)</span>&nbsp;<span class="ident" id="5850529">ignoreArray</span><span class="op" id="5850540">(</span><span class="ident" id="5850541">state</span>&nbsp;<span class="op" id="5850547">*</span><span class="ident" id="5850548">decoderState</span><span class="op" id="5850560">,</span>&nbsp;<span class="ident" id="5850562">elemOp</span>&nbsp;<span class="ident" id="5850569">decOp</span><span class="op" id="5850574">,</span>&nbsp;<span class="ident" id="5850576">length</span>&nbsp;<span class="builtintype" id="5850583">int</span><span class="op" id="5850586">)</span>&nbsp;<span class="op" id="5850588">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5850591">if</span>&nbsp;<span class="ident" id="5850594">n</span>&nbsp;<span class="op" id="5850596">:=</span>&nbsp;<span class="ident" id="5850599">state</span><span class="op" id="5850604">.</span><span class="ident" id="5850605">decodeUint</span><span class="op" id="5850615">(</span><span class="op" id="5850616">)</span><span class="op" id="5850617">;</span>&nbsp;<span class="ident" id="5850619">n</span>&nbsp;<span class="op" id="5850621">!=</span>&nbsp;<span class="ident" id="5850624">uint64</span><span class="op" id="5850630">(</span><span class="ident" id="5850631">length</span><span class="op" id="5850637">)</span>&nbsp;<span class="op" id="5850639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850643">errorf</span><span class="op" id="5850649">(</span><span class="string" id="5850650">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="5850682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5850685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850688">dec</span><span class="op" id="5850691">.</span><span class="ident" id="5850692">ignoreArrayHelper</span><span class="op" id="5850709">(</span><span class="ident" id="5850710">state</span><span class="op" id="5850715">,</span>&nbsp;<span class="ident" id="5850717">elemOp</span><span class="op" id="5850723">,</span>&nbsp;<span class="ident" id="5850725">length</span><span class="op" id="5850731">)</span><br>
<span class="lineno"></span><span class="op" id="5850733">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="5850736">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5850804">func</span>&nbsp;<span class="op" id="5850809">(</span><span class="ident" id="5850810">dec</span>&nbsp;<span class="op" id="5850814">*</span><span class="ident" id="5850815">Decoder</span><span class="op" id="5850822">)</span>&nbsp;<span class="ident" id="5850824">ignoreMap</span><span class="op" id="5850833">(</span><span class="ident" id="5850834">state</span>&nbsp;<span class="op" id="5850840">*</span><span class="ident" id="5850841">decoderState</span><span class="op" id="5850853">,</span>&nbsp;<span class="ident" id="5850855">keyOp</span><span class="op" id="5850860">,</span>&nbsp;<span class="ident" id="5850862">elemOp</span>&nbsp;<span class="ident" id="5850869">decOp</span><span class="op" id="5850874">)</span>&nbsp;<span class="op" id="5850876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850879">n</span>&nbsp;<span class="op" id="5850881">:=</span>&nbsp;<span class="builtintype" id="5850884">int</span><span class="op" id="5850887">(</span><span class="ident" id="5850888">state</span><span class="op" id="5850893">.</span><span class="ident" id="5850894">decodeUint</span><span class="op" id="5850904">(</span><span class="op" id="5850905">)</span><span class="op" id="5850906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850909">keyInstr</span>&nbsp;<span class="op" id="5850918">:=</span>&nbsp;<span class="op" id="5850921">&amp;</span><span class="ident" id="5850922">decInstr</span><span class="op" id="5850930">{</span><span class="ident" id="5850931">keyOp</span><span class="op" id="5850936">,</span>&nbsp;<span class="num" id="5850938">0</span><span class="op" id="5850939">,</span>&nbsp;<span class="builtintype" id="5850941">nil</span><span class="op" id="5850944">,</span>&nbsp;<span class="ident" id="5850946">errors</span><span class="op" id="5850952">.</span><span class="ident" id="5850953">New</span><span class="op" id="5850956">(</span><span class="string" id="5850957">&#34;no&nbsp;error&#34;</span><span class="op" id="5850967">)</span><span class="op" id="5850968">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5850971">elemInstr</span>&nbsp;<span class="op" id="5850981">:=</span>&nbsp;<span class="op" id="5850984">&amp;</span><span class="ident" id="5850985">decInstr</span><span class="op" id="5850993">{</span><span class="ident" id="5850994">elemOp</span><span class="op" id="5851000">,</span>&nbsp;<span class="num" id="5851002">0</span><span class="op" id="5851003">,</span>&nbsp;<span class="builtintype" id="5851005">nil</span><span class="op" id="5851008">,</span>&nbsp;<span class="ident" id="5851010">errors</span><span class="op" id="5851016">.</span><span class="ident" id="5851017">New</span><span class="op" id="5851020">(</span><span class="string" id="5851021">&#34;no&nbsp;error&#34;</span><span class="op" id="5851031">)</span><span class="op" id="5851032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5851035">for</span>&nbsp;<span class="ident" id="5851039">i</span>&nbsp;<span class="op" id="5851041">:=</span>&nbsp;<span class="num" id="5851044">0</span><span class="op" id="5851045">;</span>&nbsp;<span class="ident" id="5851047">i</span>&nbsp;<span class="op" id="5851049">&lt;</span>&nbsp;<span class="ident" id="5851051">n</span><span class="op" id="5851052">;</span>&nbsp;<span class="ident" id="5851054">i</span><span class="op" id="5851055">++</span>&nbsp;<span class="op" id="5851058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851062">keyOp</span><span class="op" id="5851067">(</span><span class="ident" id="5851068">keyInstr</span><span class="op" id="5851076">,</span>&nbsp;<span class="ident" id="5851078">state</span><span class="op" id="5851083">,</span>&nbsp;<span class="ident" id="5851085">noValue</span><span class="op" id="5851092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851096">elemOp</span><span class="op" id="5851102">(</span><span class="ident" id="5851103">elemInstr</span><span class="op" id="5851112">,</span>&nbsp;<span class="ident" id="5851114">state</span><span class="op" id="5851119">,</span>&nbsp;<span class="ident" id="5851121">noValue</span><span class="op" id="5851128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5851131">}</span><br>
<span class="lineno">595</span><span class="op" id="5851133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5851136">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5851191">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="5851261">func</span>&nbsp;<span class="op" id="5851266">(</span><span class="ident" id="5851267">dec</span>&nbsp;<span class="op" id="5851271">*</span><span class="ident" id="5851272">Decoder</span><span class="op" id="5851279">)</span>&nbsp;<span class="ident" id="5851281">decodeSlice</span><span class="op" id="5851292">(</span><span class="ident" id="5851293">state</span>&nbsp;<span class="op" id="5851299">*</span><span class="ident" id="5851300">decoderState</span><span class="op" id="5851312">,</span>&nbsp;<span class="ident" id="5851314">value</span>&nbsp;<span class="ident" id="5851320">reflect</span><span class="op" id="5851327">.</span><span class="ident" id="5851328">Value</span><span class="op" id="5851333">,</span>&nbsp;<span class="ident" id="5851335">elemOp</span>&nbsp;<span class="ident" id="5851342">decOp</span><span class="op" id="5851347">,</span>&nbsp;<span class="ident" id="5851349">ovfl</span>&nbsp;<span class="builtintype" id="5851354">error</span><span class="op" id="5851359">,</span>&nbsp;<span class="ident" id="5851361">helper</span>&nbsp;<span class="ident" id="5851368">decHelper</span><span class="op" id="5851377">)</span>&nbsp;<span class="op" id="5851379">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851382">u</span>&nbsp;<span class="op" id="5851384">:=</span>&nbsp;<span class="ident" id="5851387">state</span><span class="op" id="5851392">.</span><span class="ident" id="5851393">decodeUint</span><span class="op" id="5851403">(</span><span class="op" id="5851404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851407">typ</span>&nbsp;<span class="op" id="5851411">:=</span>&nbsp;<span class="ident" id="5851414">value</span><span class="op" id="5851419">.</span><span class="ident" id="5851420">Type</span><span class="op" id="5851424">(</span><span class="op" id="5851425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851428">size</span>&nbsp;<span class="op" id="5851433">:=</span>&nbsp;<span class="ident" id="5851436">uint64</span><span class="op" id="5851442">(</span><span class="ident" id="5851443">typ</span><span class="op" id="5851446">.</span><span class="ident" id="5851447">Elem</span><span class="op" id="5851451">(</span><span class="op" id="5851452">)</span><span class="op" id="5851453">.</span><span class="ident" id="5851454">Size</span><span class="op" id="5851458">(</span><span class="op" id="5851459">)</span><span class="op" id="5851460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851463">nBytes</span>&nbsp;<span class="op" id="5851470">:=</span>&nbsp;<span class="ident" id="5851473">u</span>&nbsp;<span class="op" id="5851475">*</span>&nbsp;<span class="ident" id="5851477">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851483">n</span>&nbsp;<span class="op" id="5851485">:=</span>&nbsp;<span class="builtintype" id="5851488">int</span><span class="op" id="5851491">(</span><span class="ident" id="5851492">u</span><span class="op" id="5851493">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5851496">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5851545">if</span>&nbsp;<span class="ident" id="5851548">n</span>&nbsp;<span class="op" id="5851550">&lt;</span>&nbsp;<span class="num" id="5851552">0</span>&nbsp;<span class="op" id="5851554">||</span>&nbsp;<span class="ident" id="5851557">uint64</span><span class="op" id="5851563">(</span><span class="ident" id="5851564">n</span><span class="op" id="5851565">)</span>&nbsp;<span class="op" id="5851567">!=</span>&nbsp;<span class="ident" id="5851570">u</span>&nbsp;<span class="op" id="5851572">||</span>&nbsp;<span class="ident" id="5851575">nBytes</span>&nbsp;<span class="op" id="5851582">&gt;</span>&nbsp;<span class="ident" id="5851584">tooBig</span>&nbsp;<span class="op" id="5851591">||</span>&nbsp;<span class="op" id="5851594">(</span><span class="ident" id="5851595">size</span>&nbsp;<span class="op" id="5851600">&gt;</span>&nbsp;<span class="num" id="5851602">0</span>&nbsp;<span class="op" id="5851604">&amp;&amp;</span>&nbsp;<span class="ident" id="5851607">nBytes</span><span class="op" id="5851613">/</span><span class="ident" id="5851614">size</span>&nbsp;<span class="op" id="5851619">!=</span>&nbsp;<span class="ident" id="5851622">u</span><span class="op" id="5851623">)</span>&nbsp;<span class="op" id="5851625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5851629">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5851702">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851752">errorf</span><span class="op" id="5851758">(</span><span class="string" id="5851759">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5851802">,</span>&nbsp;<span class="ident" id="5851804">typ</span><span class="op" id="5851807">.</span><span class="ident" id="5851808">Elem</span><span class="op" id="5851812">(</span><span class="op" id="5851813">)</span><span class="op" id="5851814">,</span>&nbsp;<span class="ident" id="5851816">u</span><span class="op" id="5851817">,</span>&nbsp;<span class="ident" id="5851819">size</span><span class="op" id="5851823">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5851826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5851829">if</span>&nbsp;<span class="ident" id="5851832">value</span><span class="op" id="5851837">.</span><span class="ident" id="5851838">Cap</span><span class="op" id="5851841">(</span><span class="op" id="5851842">)</span>&nbsp;<span class="op" id="5851844">&lt;</span>&nbsp;<span class="ident" id="5851846">n</span>&nbsp;<span class="op" id="5851848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851852">value</span><span class="op" id="5851857">.</span><span class="ident" id="5851858">Set</span><span class="op" id="5851861">(</span><span class="ident" id="5851862">reflect</span><span class="op" id="5851869">.</span><span class="ident" id="5851870">MakeSlice</span><span class="op" id="5851879">(</span><span class="ident" id="5851880">typ</span><span class="op" id="5851883">,</span>&nbsp;<span class="ident" id="5851885">n</span><span class="op" id="5851886">,</span>&nbsp;<span class="ident" id="5851888">n</span><span class="op" id="5851889">)</span><span class="op" id="5851890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5851893">}</span>&nbsp;<span class="keyword" id="5851895">else</span>&nbsp;<span class="op" id="5851900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851904">value</span><span class="op" id="5851909">.</span><span class="ident" id="5851910">Set</span><span class="op" id="5851913">(</span><span class="ident" id="5851914">value</span><span class="op" id="5851919">.</span><span class="ident" id="5851920">Slice</span><span class="op" id="5851925">(</span><span class="num" id="5851926">0</span><span class="op" id="5851927">,</span>&nbsp;<span class="ident" id="5851929">n</span><span class="op" id="5851930">)</span><span class="op" id="5851931">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5851934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5851937">dec</span><span class="op" id="5851940">.</span><span class="ident" id="5851941">decodeArrayHelper</span><span class="op" id="5851958">(</span><span class="ident" id="5851959">state</span><span class="op" id="5851964">,</span>&nbsp;<span class="ident" id="5851966">value</span><span class="op" id="5851971">,</span>&nbsp;<span class="ident" id="5851973">elemOp</span><span class="op" id="5851979">,</span>&nbsp;<span class="ident" id="5851981">n</span><span class="op" id="5851982">,</span>&nbsp;<span class="ident" id="5851984">ovfl</span><span class="op" id="5851988">,</span>&nbsp;<span class="ident" id="5851990">helper</span><span class="op" id="5851996">)</span><br>
<span class="lineno"></span><span class="op" id="5851998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852001">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="5852075">func</span>&nbsp;<span class="op" id="5852080">(</span><span class="ident" id="5852081">dec</span>&nbsp;<span class="op" id="5852085">*</span><span class="ident" id="5852086">Decoder</span><span class="op" id="5852093">)</span>&nbsp;<span class="ident" id="5852095">ignoreSlice</span><span class="op" id="5852106">(</span><span class="ident" id="5852107">state</span>&nbsp;<span class="op" id="5852113">*</span><span class="ident" id="5852114">decoderState</span><span class="op" id="5852126">,</span>&nbsp;<span class="ident" id="5852128">elemOp</span>&nbsp;<span class="ident" id="5852135">decOp</span><span class="op" id="5852140">)</span>&nbsp;<span class="op" id="5852142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852145">dec</span><span class="op" id="5852148">.</span><span class="ident" id="5852149">ignoreArrayHelper</span><span class="op" id="5852166">(</span><span class="ident" id="5852167">state</span><span class="op" id="5852172">,</span>&nbsp;<span class="ident" id="5852174">elemOp</span><span class="op" id="5852180">,</span>&nbsp;<span class="builtintype" id="5852182">int</span><span class="op" id="5852185">(</span><span class="ident" id="5852186">state</span><span class="op" id="5852191">.</span><span class="ident" id="5852192">decodeUint</span><span class="op" id="5852202">(</span><span class="op" id="5852203">)</span><span class="op" id="5852204">)</span><span class="op" id="5852205">)</span><br>
<span class="lineno"></span><span class="op" id="5852207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852210">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="5852280">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5852358">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5852422">func</span>&nbsp;<span class="op" id="5852427">(</span><span class="ident" id="5852428">dec</span>&nbsp;<span class="op" id="5852432">*</span><span class="ident" id="5852433">Decoder</span><span class="op" id="5852440">)</span>&nbsp;<span class="ident" id="5852442">decodeInterface</span><span class="op" id="5852457">(</span><span class="ident" id="5852458">ityp</span>&nbsp;<span class="ident" id="5852463">reflect</span><span class="op" id="5852470">.</span><span class="ident" id="5852471">Type</span><span class="op" id="5852475">,</span>&nbsp;<span class="ident" id="5852477">state</span>&nbsp;<span class="op" id="5852483">*</span><span class="ident" id="5852484">decoderState</span><span class="op" id="5852496">,</span>&nbsp;<span class="ident" id="5852498">value</span>&nbsp;<span class="ident" id="5852504">reflect</span><span class="op" id="5852511">.</span><span class="ident" id="5852512">Value</span><span class="op" id="5852517">)</span>&nbsp;<span class="op" id="5852519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5852522">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852562">nr</span>&nbsp;<span class="op" id="5852565">:=</span>&nbsp;<span class="ident" id="5852568">state</span><span class="op" id="5852573">.</span><span class="ident" id="5852574">decodeUint</span><span class="op" id="5852584">(</span><span class="op" id="5852585">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5852588">if</span>&nbsp;<span class="ident" id="5852591">nr</span>&nbsp;<span class="op" id="5852594">&lt;</span>&nbsp;<span class="num" id="5852596">0</span>&nbsp;<span class="op" id="5852598">||</span>&nbsp;<span class="ident" id="5852601">nr</span>&nbsp;<span class="op" id="5852604">&gt;</span>&nbsp;<span class="num" id="5852606">1</span><span class="op" id="5852607">&lt;&lt;</span><span class="num" id="5852609">31</span>&nbsp;<span class="op" id="5852612">{</span>&nbsp;<span class="comment" id="5852614">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852659">errorf</span><span class="op" id="5852665">(</span><span class="string" id="5852666">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="5852695">,</span>&nbsp;<span class="ident" id="5852697">nr</span><span class="op" id="5852699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5852702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5852705">if</span>&nbsp;<span class="ident" id="5852708">nr</span>&nbsp;<span class="op" id="5852711">&gt;</span>&nbsp;<span class="ident" id="5852713">uint64</span><span class="op" id="5852719">(</span><span class="ident" id="5852720">state</span><span class="op" id="5852725">.</span><span class="ident" id="5852726">b</span><span class="op" id="5852727">.</span><span class="ident" id="5852728">Len</span><span class="op" id="5852731">(</span><span class="op" id="5852732">)</span><span class="op" id="5852733">)</span>&nbsp;<span class="op" id="5852735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852739">errorf</span><span class="op" id="5852745">(</span><span class="string" id="5852746">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="5852795">,</span>&nbsp;<span class="ident" id="5852797">nr</span><span class="op" id="5852799">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5852802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852805">b</span>&nbsp;<span class="op" id="5852807">:=</span>&nbsp;<span class="builtinfunc" id="5852810">make</span><span class="op" id="5852814">(</span><span class="op" id="5852815">[</span><span class="op" id="5852816">]</span><span class="builtintype" id="5852817">byte</span><span class="op" id="5852821">,</span>&nbsp;<span class="ident" id="5852823">nr</span><span class="op" id="5852825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852828">state</span><span class="op" id="5852833">.</span><span class="ident" id="5852834">b</span><span class="op" id="5852835">.</span><span class="ident" id="5852836">Read</span><span class="op" id="5852840">(</span><span class="ident" id="5852841">b</span><span class="op" id="5852842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852845">name</span>&nbsp;<span class="op" id="5852850">:=</span>&nbsp;<span class="builtintype" id="5852853">string</span><span class="op" id="5852859">(</span><span class="ident" id="5852860">b</span><span class="op" id="5852861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5852864">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5852910">if</span>&nbsp;<span class="ident" id="5852913">name</span>&nbsp;<span class="op" id="5852918">==</span>&nbsp;<span class="string" id="5852921">&#34;&#34;</span>&nbsp;<span class="op" id="5852924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5852928">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5852977">value</span><span class="op" id="5852982">.</span><span class="ident" id="5852983">Set</span><span class="op" id="5852986">(</span><span class="ident" id="5852987">reflect</span><span class="op" id="5852994">.</span><span class="ident" id="5852995">Zero</span><span class="op" id="5852999">(</span><span class="ident" id="5853000">value</span><span class="op" id="5853005">.</span><span class="ident" id="5853006">Type</span><span class="op" id="5853010">(</span><span class="op" id="5853011">)</span><span class="op" id="5853012">)</span><span class="op" id="5853013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853017">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853025">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853028">if</span>&nbsp;<span class="builtinfunc" id="5853031">len</span><span class="op" id="5853034">(</span><span class="ident" id="5853035">name</span><span class="op" id="5853039">)</span>&nbsp;<span class="op" id="5853041">&gt;</span>&nbsp;<span class="num" id="5853043">1024</span>&nbsp;<span class="op" id="5853048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853052">errorf</span><span class="op" id="5853058">(</span><span class="string" id="5853059">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="5853095">,</span>&nbsp;<span class="builtinfunc" id="5853097">len</span><span class="op" id="5853100">(</span><span class="ident" id="5853101">name</span><span class="op" id="5853105">)</span><span class="op" id="5853106">,</span>&nbsp;<span class="ident" id="5853108">name</span><span class="op" id="5853112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853118">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853160">registerLock</span><span class="op" id="5853172">.</span><span class="ident" id="5853173">RLock</span><span class="op" id="5853178">(</span><span class="op" id="5853179">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853182">typ</span><span class="op" id="5853185">,</span>&nbsp;<span class="ident" id="5853187">ok</span>&nbsp;<span class="op" id="5853190">:=</span>&nbsp;<span class="ident" id="5853193">nameToConcreteType</span><span class="op" id="5853211">[</span><span class="ident" id="5853212">name</span><span class="op" id="5853216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853219">registerLock</span><span class="op" id="5853231">.</span><span class="ident" id="5853232">RUnlock</span><span class="op" id="5853239">(</span><span class="op" id="5853240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853243">if</span>&nbsp;<span class="op" id="5853246">!</span><span class="ident" id="5853247">ok</span>&nbsp;<span class="op" id="5853250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853254">errorf</span><span class="op" id="5853260">(</span><span class="string" id="5853261">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="5853300">,</span>&nbsp;<span class="ident" id="5853302">name</span><span class="op" id="5853306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853309">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853312">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853356">concreteId</span>&nbsp;<span class="op" id="5853367">:=</span>&nbsp;<span class="ident" id="5853370">dec</span><span class="op" id="5853373">.</span><span class="ident" id="5853374">decodeTypeSequence</span><span class="op" id="5853392">(</span><span class="builtintype" id="5853393">true</span><span class="op" id="5853397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853400">if</span>&nbsp;<span class="ident" id="5853403">concreteId</span>&nbsp;<span class="op" id="5853414">&lt;</span>&nbsp;<span class="num" id="5853416">0</span>&nbsp;<span class="op" id="5853418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853422">error_</span><span class="op" id="5853428">(</span><span class="ident" id="5853429">dec</span><span class="op" id="5853432">.</span><span class="ident" id="5853433">err</span><span class="op" id="5853436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853439">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853442">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853512">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853580">state</span><span class="op" id="5853585">.</span><span class="ident" id="5853586">decodeUint</span><span class="op" id="5853596">(</span><span class="op" id="5853597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853600">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853629">v</span>&nbsp;<span class="op" id="5853631">:=</span>&nbsp;<span class="ident" id="5853634">allocValue</span><span class="op" id="5853644">(</span><span class="ident" id="5853645">typ</span><span class="op" id="5853648">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853651">dec</span><span class="op" id="5853654">.</span><span class="ident" id="5853655">decodeValue</span><span class="op" id="5853666">(</span><span class="ident" id="5853667">concreteId</span><span class="op" id="5853677">,</span>&nbsp;<span class="ident" id="5853679">v</span><span class="op" id="5853680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853683">if</span>&nbsp;<span class="ident" id="5853686">dec</span><span class="op" id="5853689">.</span><span class="ident" id="5853690">err</span>&nbsp;<span class="op" id="5853694">!=</span>&nbsp;<span class="builtintype" id="5853697">nil</span>&nbsp;<span class="op" id="5853701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853705">error_</span><span class="op" id="5853711">(</span><span class="ident" id="5853712">dec</span><span class="op" id="5853715">.</span><span class="ident" id="5853716">err</span><span class="op" id="5853719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853725">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853773">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5853830">if</span>&nbsp;<span class="op" id="5853833">!</span><span class="ident" id="5853834">typ</span><span class="op" id="5853837">.</span><span class="ident" id="5853838">AssignableTo</span><span class="op" id="5853850">(</span><span class="ident" id="5853851">ityp</span><span class="op" id="5853855">)</span>&nbsp;<span class="op" id="5853857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853861">errorf</span><span class="op" id="5853867">(</span><span class="string" id="5853868">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5853901">,</span>&nbsp;<span class="ident" id="5853903">typ</span><span class="op" id="5853906">,</span>&nbsp;<span class="ident" id="5853908">ityp</span><span class="op" id="5853912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5853915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5853918">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5853962">value</span><span class="op" id="5853967">.</span><span class="ident" id="5853968">Set</span><span class="op" id="5853971">(</span><span class="ident" id="5853972">v</span><span class="op" id="5853973">)</span><br>
<span class="lineno"></span><span class="op" id="5853975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5853978">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5854059">func</span>&nbsp;<span class="op" id="5854064">(</span><span class="ident" id="5854065">dec</span>&nbsp;<span class="op" id="5854069">*</span><span class="ident" id="5854070">Decoder</span><span class="op" id="5854077">)</span>&nbsp;<span class="ident" id="5854079">ignoreInterface</span><span class="op" id="5854094">(</span><span class="ident" id="5854095">state</span>&nbsp;<span class="op" id="5854101">*</span><span class="ident" id="5854102">decoderState</span><span class="op" id="5854114">)</span>&nbsp;<span class="op" id="5854116">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5854119">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854159">b</span>&nbsp;<span class="op" id="5854161">:=</span>&nbsp;<span class="builtinfunc" id="5854164">make</span><span class="op" id="5854168">(</span><span class="op" id="5854169">[</span><span class="op" id="5854170">]</span><span class="builtintype" id="5854171">byte</span><span class="op" id="5854175">,</span>&nbsp;<span class="ident" id="5854177">state</span><span class="op" id="5854182">.</span><span class="ident" id="5854183">decodeUint</span><span class="op" id="5854193">(</span><span class="op" id="5854194">)</span><span class="op" id="5854195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854198">_</span><span class="op" id="5854199">,</span>&nbsp;<span class="ident" id="5854201">err</span>&nbsp;<span class="op" id="5854205">:=</span>&nbsp;<span class="ident" id="5854208">state</span><span class="op" id="5854213">.</span><span class="ident" id="5854214">b</span><span class="op" id="5854215">.</span><span class="ident" id="5854216">Read</span><span class="op" id="5854220">(</span><span class="ident" id="5854221">b</span><span class="op" id="5854222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5854225">if</span>&nbsp;<span class="ident" id="5854228">err</span>&nbsp;<span class="op" id="5854232">!=</span>&nbsp;<span class="builtintype" id="5854235">nil</span>&nbsp;<span class="op" id="5854239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854243">error_</span><span class="op" id="5854249">(</span><span class="ident" id="5854250">err</span><span class="op" id="5854253">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5854256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854259">id</span>&nbsp;<span class="op" id="5854262">:=</span>&nbsp;<span class="ident" id="5854265">dec</span><span class="op" id="5854268">.</span><span class="ident" id="5854269">decodeTypeSequence</span><span class="op" id="5854287">(</span><span class="builtintype" id="5854288">true</span><span class="op" id="5854292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5854295">if</span>&nbsp;<span class="ident" id="5854298">id</span>&nbsp;<span class="op" id="5854301">&lt;</span>&nbsp;<span class="num" id="5854303">0</span>&nbsp;<span class="op" id="5854305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854309">error_</span><span class="op" id="5854315">(</span><span class="ident" id="5854316">dec</span><span class="op" id="5854319">.</span><span class="ident" id="5854320">err</span><span class="op" id="5854323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5854326">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5854329">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854409">state</span><span class="op" id="5854414">.</span><span class="ident" id="5854415">b</span><span class="op" id="5854416">.</span><span class="ident" id="5854417">Drop</span><span class="op" id="5854421">(</span><span class="builtintype" id="5854422">int</span><span class="op" id="5854425">(</span><span class="ident" id="5854426">state</span><span class="op" id="5854431">.</span><span class="ident" id="5854432">decodeUint</span><span class="op" id="5854442">(</span><span class="op" id="5854443">)</span><span class="op" id="5854444">)</span><span class="op" id="5854445">)</span><br>
<span class="lineno"></span><span class="op" id="5854447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5854450">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="5854527">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="5854567">func</span>&nbsp;<span class="op" id="5854572">(</span><span class="ident" id="5854573">dec</span>&nbsp;<span class="op" id="5854577">*</span><span class="ident" id="5854578">Decoder</span><span class="op" id="5854585">)</span>&nbsp;<span class="ident" id="5854587">decodeGobDecoder</span><span class="op" id="5854603">(</span><span class="ident" id="5854604">ut</span>&nbsp;<span class="op" id="5854607">*</span><span class="ident" id="5854608">userTypeInfo</span><span class="op" id="5854620">,</span>&nbsp;<span class="ident" id="5854622">state</span>&nbsp;<span class="op" id="5854628">*</span><span class="ident" id="5854629">decoderState</span><span class="op" id="5854641">,</span>&nbsp;<span class="ident" id="5854643">value</span>&nbsp;<span class="ident" id="5854649">reflect</span><span class="op" id="5854656">.</span><span class="ident" id="5854657">Value</span><span class="op" id="5854662">)</span>&nbsp;<span class="op" id="5854664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5854667">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854701">b</span>&nbsp;<span class="op" id="5854703">:=</span>&nbsp;<span class="builtinfunc" id="5854706">make</span><span class="op" id="5854710">(</span><span class="op" id="5854711">[</span><span class="op" id="5854712">]</span><span class="builtintype" id="5854713">byte</span><span class="op" id="5854717">,</span>&nbsp;<span class="ident" id="5854719">state</span><span class="op" id="5854724">.</span><span class="ident" id="5854725">decodeUint</span><span class="op" id="5854735">(</span><span class="op" id="5854736">)</span><span class="op" id="5854737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854740">_</span><span class="op" id="5854741">,</span>&nbsp;<span class="ident" id="5854743">err</span>&nbsp;<span class="op" id="5854747">:=</span>&nbsp;<span class="ident" id="5854750">state</span><span class="op" id="5854755">.</span><span class="ident" id="5854756">b</span><span class="op" id="5854757">.</span><span class="ident" id="5854758">Read</span><span class="op" id="5854762">(</span><span class="ident" id="5854763">b</span><span class="op" id="5854764">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5854767">if</span>&nbsp;<span class="ident" id="5854770">err</span>&nbsp;<span class="op" id="5854774">!=</span>&nbsp;<span class="builtintype" id="5854777">nil</span>&nbsp;<span class="op" id="5854781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854785">error_</span><span class="op" id="5854791">(</span><span class="ident" id="5854792">err</span><span class="op" id="5854795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5854798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5854801">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5854832">switch</span>&nbsp;<span class="ident" id="5854839">ut</span><span class="op" id="5854841">.</span><span class="ident" id="5854842">externalDec</span>&nbsp;<span class="op" id="5854854">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5854857">case</span>&nbsp;<span class="ident" id="5854862">xGob</span><span class="op" id="5854866">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854870">err</span>&nbsp;<span class="op" id="5854874">=</span>&nbsp;<span class="ident" id="5854876">value</span><span class="op" id="5854881">.</span><span class="ident" id="5854882">Interface</span><span class="op" id="5854891">(</span><span class="op" id="5854892">)</span><span class="op" id="5854893">.</span><span class="op" id="5854894">(</span><span class="ident" id="5854895">GobDecoder</span><span class="op" id="5854905">)</span><span class="op" id="5854906">.</span><span class="ident" id="5854907">GobDecode</span><span class="op" id="5854916">(</span><span class="ident" id="5854917">b</span><span class="op" id="5854918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5854921">case</span>&nbsp;<span class="ident" id="5854926">xBinary</span><span class="op" id="5854933">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5854937">err</span>&nbsp;<span class="op" id="5854941">=</span>&nbsp;<span class="ident" id="5854943">value</span><span class="op" id="5854948">.</span><span class="ident" id="5854949">Interface</span><span class="op" id="5854958">(</span><span class="op" id="5854959">)</span><span class="op" id="5854960">.</span><span class="op" id="5854961">(</span><span class="ident" id="5854962">encoding</span><span class="op" id="5854970">.</span><span class="ident" id="5854971">BinaryUnmarshaler</span><span class="op" id="5854988">)</span><span class="op" id="5854989">.</span><span class="ident" id="5854990">UnmarshalBinary</span><span class="op" id="5855005">(</span><span class="ident" id="5855006">b</span><span class="op" id="5855007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5855010">case</span>&nbsp;<span class="ident" id="5855015">xText</span><span class="op" id="5855020">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855024">err</span>&nbsp;<span class="op" id="5855028">=</span>&nbsp;<span class="ident" id="5855030">value</span><span class="op" id="5855035">.</span><span class="ident" id="5855036">Interface</span><span class="op" id="5855045">(</span><span class="op" id="5855046">)</span><span class="op" id="5855047">.</span><span class="op" id="5855048">(</span><span class="ident" id="5855049">encoding</span><span class="op" id="5855057">.</span><span class="ident" id="5855058">TextUnmarshaler</span><span class="op" id="5855073">)</span><span class="op" id="5855074">.</span><span class="ident" id="5855075">UnmarshalText</span><span class="op" id="5855088">(</span><span class="ident" id="5855089">b</span><span class="op" id="5855090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5855093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5855096">if</span>&nbsp;<span class="ident" id="5855099">err</span>&nbsp;<span class="op" id="5855103">!=</span>&nbsp;<span class="builtintype" id="5855106">nil</span>&nbsp;<span class="op" id="5855110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855114">error_</span><span class="op" id="5855120">(</span><span class="ident" id="5855121">err</span><span class="op" id="5855124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5855127">}</span><br>
<span class="lineno">715</span><span class="op" id="5855129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855132">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5855214">func</span>&nbsp;<span class="op" id="5855219">(</span><span class="ident" id="5855220">dec</span>&nbsp;<span class="op" id="5855224">*</span><span class="ident" id="5855225">Decoder</span><span class="op" id="5855232">)</span>&nbsp;<span class="ident" id="5855234">ignoreGobDecoder</span><span class="op" id="5855250">(</span><span class="ident" id="5855251">state</span>&nbsp;<span class="op" id="5855257">*</span><span class="ident" id="5855258">decoderState</span><span class="op" id="5855270">)</span>&nbsp;<span class="op" id="5855272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5855275">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855309">b</span>&nbsp;<span class="op" id="5855311">:=</span>&nbsp;<span class="builtinfunc" id="5855314">make</span><span class="op" id="5855318">(</span><span class="op" id="5855319">[</span><span class="op" id="5855320">]</span><span class="builtintype" id="5855321">byte</span><span class="op" id="5855325">,</span>&nbsp;<span class="ident" id="5855327">state</span><span class="op" id="5855332">.</span><span class="ident" id="5855333">decodeUint</span><span class="op" id="5855343">(</span><span class="op" id="5855344">)</span><span class="op" id="5855345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855348">_</span><span class="op" id="5855349">,</span>&nbsp;<span class="ident" id="5855351">err</span>&nbsp;<span class="op" id="5855355">:=</span>&nbsp;<span class="ident" id="5855358">state</span><span class="op" id="5855363">.</span><span class="ident" id="5855364">b</span><span class="op" id="5855365">.</span><span class="ident" id="5855366">Read</span><span class="op" id="5855370">(</span><span class="ident" id="5855371">b</span><span class="op" id="5855372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5855375">if</span>&nbsp;<span class="ident" id="5855378">err</span>&nbsp;<span class="op" id="5855382">!=</span>&nbsp;<span class="builtintype" id="5855385">nil</span>&nbsp;<span class="op" id="5855389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855393">error_</span><span class="op" id="5855399">(</span><span class="ident" id="5855400">err</span><span class="op" id="5855403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5855406">}</span><br>
<span class="lineno">725</span><span class="op" id="5855408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855411">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="5855433">var</span>&nbsp;<span class="ident" id="5855437">decOpTable</span>&nbsp;<span class="op" id="5855448">=</span>&nbsp;<span class="op" id="5855450">[</span><span class="op" id="5855451">...</span><span class="op" id="5855454">]</span><span class="ident" id="5855455">decOp</span><span class="op" id="5855460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855463">reflect</span><span class="op" id="5855470">.</span><span class="ident" id="5855471">Bool</span><span class="op" id="5855475">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855483">decBool</span><span class="op" id="5855490">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855493">reflect</span><span class="op" id="5855500">.</span><span class="ident" id="5855501">Int8</span><span class="op" id="5855505">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855513">decInt8</span><span class="op" id="5855520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855523">reflect</span><span class="op" id="5855530">.</span><span class="ident" id="5855531">Int16</span><span class="op" id="5855536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855543">decInt16</span><span class="op" id="5855551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855554">reflect</span><span class="op" id="5855561">.</span><span class="ident" id="5855562">Int32</span><span class="op" id="5855567">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855574">decInt32</span><span class="op" id="5855582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855585">reflect</span><span class="op" id="5855592">.</span><span class="ident" id="5855593">Int64</span><span class="op" id="5855598">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855605">decInt64</span><span class="op" id="5855613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855616">reflect</span><span class="op" id="5855623">.</span><span class="ident" id="5855624">Uint8</span><span class="op" id="5855629">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855636">decUint8</span><span class="op" id="5855644">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855647">reflect</span><span class="op" id="5855654">.</span><span class="ident" id="5855655">Uint16</span><span class="op" id="5855661">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855667">decUint16</span><span class="op" id="5855676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855679">reflect</span><span class="op" id="5855686">.</span><span class="ident" id="5855687">Uint32</span><span class="op" id="5855693">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855699">decUint32</span><span class="op" id="5855708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855711">reflect</span><span class="op" id="5855718">.</span><span class="ident" id="5855719">Uint64</span><span class="op" id="5855725">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855731">decUint64</span><span class="op" id="5855740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855743">reflect</span><span class="op" id="5855750">.</span><span class="ident" id="5855751">Float32</span><span class="op" id="5855758">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855763">decFloat32</span><span class="op" id="5855773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855776">reflect</span><span class="op" id="5855783">.</span><span class="ident" id="5855784">Float64</span><span class="op" id="5855791">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855796">decFloat64</span><span class="op" id="5855806">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855809">reflect</span><span class="op" id="5855816">.</span><span class="ident" id="5855817">Complex64</span><span class="op" id="5855826">:</span>&nbsp;&nbsp;<span class="ident" id="5855829">decComplex64</span><span class="op" id="5855841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855844">reflect</span><span class="op" id="5855851">.</span><span class="ident" id="5855852">Complex128</span><span class="op" id="5855862">:</span>&nbsp;<span class="ident" id="5855864">decComplex128</span><span class="op" id="5855877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855880">reflect</span><span class="op" id="5855887">.</span><span class="ident" id="5855888">String</span><span class="op" id="5855894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5855900">decString</span><span class="op" id="5855909">,</span><br>
<span class="lineno"></span><span class="op" id="5855911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5855914">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="5855983">var</span>&nbsp;<span class="ident" id="5855987">decIgnoreOpMap</span>&nbsp;<span class="op" id="5856002">=</span>&nbsp;<span class="keyword" id="5856004">map</span><span class="op" id="5856007">[</span><span class="ident" id="5856008">typeId</span><span class="op" id="5856014">]</span><span class="ident" id="5856015">decOp</span><span class="op" id="5856020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856023">tBool</span><span class="op" id="5856028">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856033">ignoreUint</span><span class="op" id="5856043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856046">tInt</span><span class="op" id="5856050">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856056">ignoreUint</span><span class="op" id="5856066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856069">tUint</span><span class="op" id="5856074">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856079">ignoreUint</span><span class="op" id="5856089">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856092">tFloat</span><span class="op" id="5856098">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5856102">ignoreUint</span><span class="op" id="5856112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856115">tBytes</span><span class="op" id="5856121">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5856125">ignoreUint8Array</span><span class="op" id="5856141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856144">tString</span><span class="op" id="5856151">:</span>&nbsp;&nbsp;<span class="ident" id="5856154">ignoreUint8Array</span><span class="op" id="5856170">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856173">tComplex</span><span class="op" id="5856181">:</span>&nbsp;<span class="ident" id="5856183">ignoreTwoUints</span><span class="op" id="5856197">,</span><br>
<span class="lineno"></span><span class="op" id="5856199">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="5856202">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5856269">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5856307">func</span>&nbsp;<span class="op" id="5856312">(</span><span class="ident" id="5856313">dec</span>&nbsp;<span class="op" id="5856317">*</span><span class="ident" id="5856318">Decoder</span><span class="op" id="5856325">)</span>&nbsp;<span class="ident" id="5856327">decOpFor</span><span class="op" id="5856335">(</span><span class="ident" id="5856336">wireId</span>&nbsp;<span class="ident" id="5856343">typeId</span><span class="op" id="5856349">,</span>&nbsp;<span class="ident" id="5856351">rt</span>&nbsp;<span class="ident" id="5856354">reflect</span><span class="op" id="5856361">.</span><span class="ident" id="5856362">Type</span><span class="op" id="5856366">,</span>&nbsp;<span class="ident" id="5856368">name</span>&nbsp;<span class="builtintype" id="5856373">string</span><span class="op" id="5856379">,</span>&nbsp;<span class="ident" id="5856381">inProgress</span>&nbsp;<span class="keyword" id="5856392">map</span><span class="op" id="5856395">[</span><span class="ident" id="5856396">reflect</span><span class="op" id="5856403">.</span><span class="ident" id="5856404">Type</span><span class="op" id="5856408">]</span><span class="op" id="5856409">*</span><span class="ident" id="5856410">decOp</span><span class="op" id="5856415">)</span>&nbsp;<span class="op" id="5856417">*</span><span class="ident" id="5856418">decOp</span>&nbsp;<span class="op" id="5856424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856427">ut</span>&nbsp;<span class="op" id="5856430">:=</span>&nbsp;<span class="ident" id="5856433">userType</span><span class="op" id="5856441">(</span><span class="ident" id="5856442">rt</span><span class="op" id="5856444">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5856447">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856527">if</span>&nbsp;<span class="ident" id="5856530">ut</span><span class="op" id="5856532">.</span><span class="ident" id="5856533">externalDec</span>&nbsp;<span class="op" id="5856545">!=</span>&nbsp;<span class="num" id="5856548">0</span>&nbsp;<span class="op" id="5856550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856554">return</span>&nbsp;<span class="ident" id="5856561">dec</span><span class="op" id="5856564">.</span><span class="ident" id="5856565">gobDecodeOpFor</span><span class="op" id="5856579">(</span><span class="ident" id="5856580">ut</span><span class="op" id="5856582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5856585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5856589">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5856674">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856731">if</span>&nbsp;<span class="ident" id="5856734">opPtr</span>&nbsp;<span class="op" id="5856740">:=</span>&nbsp;<span class="ident" id="5856743">inProgress</span><span class="op" id="5856753">[</span><span class="ident" id="5856754">rt</span><span class="op" id="5856756">]</span><span class="op" id="5856757">;</span>&nbsp;<span class="ident" id="5856759">opPtr</span>&nbsp;<span class="op" id="5856765">!=</span>&nbsp;<span class="builtintype" id="5856768">nil</span>&nbsp;<span class="op" id="5856772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856776">return</span>&nbsp;<span class="ident" id="5856783">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5856790">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856793">typ</span>&nbsp;<span class="op" id="5856797">:=</span>&nbsp;<span class="ident" id="5856800">ut</span><span class="op" id="5856802">.</span><span class="ident" id="5856803">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856809">var</span>&nbsp;<span class="ident" id="5856813">op</span>&nbsp;<span class="ident" id="5856816">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856823">k</span>&nbsp;<span class="op" id="5856825">:=</span>&nbsp;<span class="ident" id="5856828">typ</span><span class="op" id="5856831">.</span><span class="ident" id="5856832">Kind</span><span class="op" id="5856836">(</span><span class="op" id="5856837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856840">if</span>&nbsp;<span class="builtintype" id="5856843">int</span><span class="op" id="5856846">(</span><span class="ident" id="5856847">k</span><span class="op" id="5856848">)</span>&nbsp;<span class="op" id="5856850">&lt;</span>&nbsp;<span class="builtinfunc" id="5856852">len</span><span class="op" id="5856855">(</span><span class="ident" id="5856856">decOpTable</span><span class="op" id="5856866">)</span>&nbsp;<span class="op" id="5856868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856872">op</span>&nbsp;<span class="op" id="5856875">=</span>&nbsp;<span class="ident" id="5856877">decOpTable</span><span class="op" id="5856887">[</span><span class="ident" id="5856888">k</span><span class="op" id="5856889">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5856892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856895">if</span>&nbsp;<span class="ident" id="5856898">op</span>&nbsp;<span class="op" id="5856901">==</span>&nbsp;<span class="builtintype" id="5856904">nil</span>&nbsp;<span class="op" id="5856908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5856912">inProgress</span><span class="op" id="5856922">[</span><span class="ident" id="5856923">rt</span><span class="op" id="5856925">]</span>&nbsp;<span class="op" id="5856927">=</span>&nbsp;<span class="op" id="5856929">&amp;</span><span class="ident" id="5856930">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5856935">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856954">switch</span>&nbsp;<span class="ident" id="5856961">t</span>&nbsp;<span class="op" id="5856963">:=</span>&nbsp;<span class="ident" id="5856966">typ</span><span class="op" id="5856969">;</span>&nbsp;<span class="ident" id="5856971">t</span><span class="op" id="5856972">.</span><span class="ident" id="5856973">Kind</span><span class="op" id="5856977">(</span><span class="op" id="5856978">)</span>&nbsp;<span class="op" id="5856980">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5856984">case</span>&nbsp;<span class="ident" id="5856989">reflect</span><span class="op" id="5856996">.</span><span class="ident" id="5856997">Array</span><span class="op" id="5857002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857007">name</span>&nbsp;<span class="op" id="5857012">=</span>&nbsp;<span class="string" id="5857014">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5857028">+</span>&nbsp;<span class="ident" id="5857030">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857038">elemId</span>&nbsp;<span class="op" id="5857045">:=</span>&nbsp;<span class="ident" id="5857048">dec</span><span class="op" id="5857051">.</span><span class="ident" id="5857052">wireType</span><span class="op" id="5857060">[</span><span class="ident" id="5857061">wireId</span><span class="op" id="5857067">]</span><span class="op" id="5857068">.</span><span class="ident" id="5857069">ArrayT</span><span class="op" id="5857075">.</span><span class="ident" id="5857076">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857084">elemOp</span>&nbsp;<span class="op" id="5857091">:=</span>&nbsp;<span class="ident" id="5857094">dec</span><span class="op" id="5857097">.</span><span class="ident" id="5857098">decOpFor</span><span class="op" id="5857106">(</span><span class="ident" id="5857107">elemId</span><span class="op" id="5857113">,</span>&nbsp;<span class="ident" id="5857115">t</span><span class="op" id="5857116">.</span><span class="ident" id="5857117">Elem</span><span class="op" id="5857121">(</span><span class="op" id="5857122">)</span><span class="op" id="5857123">,</span>&nbsp;<span class="ident" id="5857125">name</span><span class="op" id="5857129">,</span>&nbsp;<span class="ident" id="5857131">inProgress</span><span class="op" id="5857141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857146">ovfl</span>&nbsp;<span class="op" id="5857151">:=</span>&nbsp;<span class="ident" id="5857154">overflow</span><span class="op" id="5857162">(</span><span class="ident" id="5857163">name</span><span class="op" id="5857167">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857172">helper</span>&nbsp;<span class="op" id="5857179">:=</span>&nbsp;<span class="ident" id="5857182">decArrayHelper</span><span class="op" id="5857196">[</span><span class="ident" id="5857197">t</span><span class="op" id="5857198">.</span><span class="ident" id="5857199">Elem</span><span class="op" id="5857203">(</span><span class="op" id="5857204">)</span><span class="op" id="5857205">.</span><span class="ident" id="5857206">Kind</span><span class="op" id="5857210">(</span><span class="op" id="5857211">)</span><span class="op" id="5857212">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857217">op</span>&nbsp;<span class="op" id="5857220">=</span>&nbsp;<span class="keyword" id="5857222">func</span><span class="op" id="5857226">(</span><span class="ident" id="5857227">i</span>&nbsp;<span class="op" id="5857229">*</span><span class="ident" id="5857230">decInstr</span><span class="op" id="5857238">,</span>&nbsp;<span class="ident" id="5857240">state</span>&nbsp;<span class="op" id="5857246">*</span><span class="ident" id="5857247">decoderState</span><span class="op" id="5857259">,</span>&nbsp;<span class="ident" id="5857261">value</span>&nbsp;<span class="ident" id="5857267">reflect</span><span class="op" id="5857274">.</span><span class="ident" id="5857275">Value</span><span class="op" id="5857280">)</span>&nbsp;<span class="op" id="5857282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857288">state</span><span class="op" id="5857293">.</span><span class="ident" id="5857294">dec</span><span class="op" id="5857297">.</span><span class="ident" id="5857298">decodeArray</span><span class="op" id="5857309">(</span><span class="ident" id="5857310">t</span><span class="op" id="5857311">,</span>&nbsp;<span class="ident" id="5857313">state</span><span class="op" id="5857318">,</span>&nbsp;<span class="ident" id="5857320">value</span><span class="op" id="5857325">,</span>&nbsp;<span class="op" id="5857327">*</span><span class="ident" id="5857328">elemOp</span><span class="op" id="5857334">,</span>&nbsp;<span class="ident" id="5857336">t</span><span class="op" id="5857337">.</span><span class="ident" id="5857338">Len</span><span class="op" id="5857341">(</span><span class="op" id="5857342">)</span><span class="op" id="5857343">,</span>&nbsp;<span class="ident" id="5857345">ovfl</span><span class="op" id="5857349">,</span>&nbsp;<span class="ident" id="5857351">helper</span><span class="op" id="5857357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5857362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5857367">case</span>&nbsp;<span class="ident" id="5857372">reflect</span><span class="op" id="5857379">.</span><span class="ident" id="5857380">Map</span><span class="op" id="5857383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857388">keyId</span>&nbsp;<span class="op" id="5857394">:=</span>&nbsp;<span class="ident" id="5857397">dec</span><span class="op" id="5857400">.</span><span class="ident" id="5857401">wireType</span><span class="op" id="5857409">[</span><span class="ident" id="5857410">wireId</span><span class="op" id="5857416">]</span><span class="op" id="5857417">.</span><span class="ident" id="5857418">MapT</span><span class="op" id="5857422">.</span><span class="ident" id="5857423">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857430">elemId</span>&nbsp;<span class="op" id="5857437">:=</span>&nbsp;<span class="ident" id="5857440">dec</span><span class="op" id="5857443">.</span><span class="ident" id="5857444">wireType</span><span class="op" id="5857452">[</span><span class="ident" id="5857453">wireId</span><span class="op" id="5857459">]</span><span class="op" id="5857460">.</span><span class="ident" id="5857461">MapT</span><span class="op" id="5857465">.</span><span class="ident" id="5857466">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857474">keyOp</span>&nbsp;<span class="op" id="5857480">:=</span>&nbsp;<span class="ident" id="5857483">dec</span><span class="op" id="5857486">.</span><span class="ident" id="5857487">decOpFor</span><span class="op" id="5857495">(</span><span class="ident" id="5857496">keyId</span><span class="op" id="5857501">,</span>&nbsp;<span class="ident" id="5857503">t</span><span class="op" id="5857504">.</span><span class="ident" id="5857505">Key</span><span class="op" id="5857508">(</span><span class="op" id="5857509">)</span><span class="op" id="5857510">,</span>&nbsp;<span class="string" id="5857512">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="5857521">+</span><span class="ident" id="5857522">name</span><span class="op" id="5857526">,</span>&nbsp;<span class="ident" id="5857528">inProgress</span><span class="op" id="5857538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857543">elemOp</span>&nbsp;<span class="op" id="5857550">:=</span>&nbsp;<span class="ident" id="5857553">dec</span><span class="op" id="5857556">.</span><span class="ident" id="5857557">decOpFor</span><span class="op" id="5857565">(</span><span class="ident" id="5857566">elemId</span><span class="op" id="5857572">,</span>&nbsp;<span class="ident" id="5857574">t</span><span class="op" id="5857575">.</span><span class="ident" id="5857576">Elem</span><span class="op" id="5857580">(</span><span class="op" id="5857581">)</span><span class="op" id="5857582">,</span>&nbsp;<span class="string" id="5857584">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="5857597">+</span><span class="ident" id="5857598">name</span><span class="op" id="5857602">,</span>&nbsp;<span class="ident" id="5857604">inProgress</span><span class="op" id="5857614">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857619">ovfl</span>&nbsp;<span class="op" id="5857624">:=</span>&nbsp;<span class="ident" id="5857627">overflow</span><span class="op" id="5857635">(</span><span class="ident" id="5857636">name</span><span class="op" id="5857640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857645">op</span>&nbsp;<span class="op" id="5857648">=</span>&nbsp;<span class="keyword" id="5857650">func</span><span class="op" id="5857654">(</span><span class="ident" id="5857655">i</span>&nbsp;<span class="op" id="5857657">*</span><span class="ident" id="5857658">decInstr</span><span class="op" id="5857666">,</span>&nbsp;<span class="ident" id="5857668">state</span>&nbsp;<span class="op" id="5857674">*</span><span class="ident" id="5857675">decoderState</span><span class="op" id="5857687">,</span>&nbsp;<span class="ident" id="5857689">value</span>&nbsp;<span class="ident" id="5857695">reflect</span><span class="op" id="5857702">.</span><span class="ident" id="5857703">Value</span><span class="op" id="5857708">)</span>&nbsp;<span class="op" id="5857710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857716">state</span><span class="op" id="5857721">.</span><span class="ident" id="5857722">dec</span><span class="op" id="5857725">.</span><span class="ident" id="5857726">decodeMap</span><span class="op" id="5857735">(</span><span class="ident" id="5857736">t</span><span class="op" id="5857737">,</span>&nbsp;<span class="ident" id="5857739">state</span><span class="op" id="5857744">,</span>&nbsp;<span class="ident" id="5857746">value</span><span class="op" id="5857751">,</span>&nbsp;<span class="op" id="5857753">*</span><span class="ident" id="5857754">keyOp</span><span class="op" id="5857759">,</span>&nbsp;<span class="op" id="5857761">*</span><span class="ident" id="5857762">elemOp</span><span class="op" id="5857768">,</span>&nbsp;<span class="ident" id="5857770">ovfl</span><span class="op" id="5857774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5857779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5857784">case</span>&nbsp;<span class="ident" id="5857789">reflect</span><span class="op" id="5857796">.</span><span class="ident" id="5857797">Slice</span><span class="op" id="5857802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857807">name</span>&nbsp;<span class="op" id="5857812">=</span>&nbsp;<span class="string" id="5857814">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="5857828">+</span>&nbsp;<span class="ident" id="5857830">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5857838">if</span>&nbsp;<span class="ident" id="5857841">t</span><span class="op" id="5857842">.</span><span class="ident" id="5857843">Elem</span><span class="op" id="5857847">(</span><span class="op" id="5857848">)</span><span class="op" id="5857849">.</span><span class="ident" id="5857850">Kind</span><span class="op" id="5857854">(</span><span class="op" id="5857855">)</span>&nbsp;<span class="op" id="5857857">==</span>&nbsp;<span class="ident" id="5857860">reflect</span><span class="op" id="5857867">.</span><span class="ident" id="5857868">Uint8</span>&nbsp;<span class="op" id="5857874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857880">op</span>&nbsp;<span class="op" id="5857883">=</span>&nbsp;<span class="ident" id="5857885">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5857903">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5857912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5857917">var</span>&nbsp;<span class="ident" id="5857921">elemId</span>&nbsp;<span class="ident" id="5857928">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5857938">if</span>&nbsp;<span class="ident" id="5857941">tt</span><span class="op" id="5857943">,</span>&nbsp;<span class="ident" id="5857945">ok</span>&nbsp;<span class="op" id="5857948">:=</span>&nbsp;<span class="ident" id="5857951">builtinIdToType</span><span class="op" id="5857966">[</span><span class="ident" id="5857967">wireId</span><span class="op" id="5857973">]</span><span class="op" id="5857974">;</span>&nbsp;<span class="ident" id="5857976">ok</span>&nbsp;<span class="op" id="5857979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5857985">elemId</span>&nbsp;<span class="op" id="5857992">=</span>&nbsp;<span class="ident" id="5857994">tt</span><span class="op" id="5857996">.</span><span class="op" id="5857997">(</span><span class="op" id="5857998">*</span><span class="ident" id="5857999">sliceType</span><span class="op" id="5858008">)</span><span class="op" id="5858009">.</span><span class="ident" id="5858010">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858018">}</span>&nbsp;<span class="keyword" id="5858020">else</span>&nbsp;<span class="op" id="5858025">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858031">elemId</span>&nbsp;<span class="op" id="5858038">=</span>&nbsp;<span class="ident" id="5858040">dec</span><span class="op" id="5858043">.</span><span class="ident" id="5858044">wireType</span><span class="op" id="5858052">[</span><span class="ident" id="5858053">wireId</span><span class="op" id="5858059">]</span><span class="op" id="5858060">.</span><span class="ident" id="5858061">SliceT</span><span class="op" id="5858067">.</span><span class="ident" id="5858068">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858081">elemOp</span>&nbsp;<span class="op" id="5858088">:=</span>&nbsp;<span class="ident" id="5858091">dec</span><span class="op" id="5858094">.</span><span class="ident" id="5858095">decOpFor</span><span class="op" id="5858103">(</span><span class="ident" id="5858104">elemId</span><span class="op" id="5858110">,</span>&nbsp;<span class="ident" id="5858112">t</span><span class="op" id="5858113">.</span><span class="ident" id="5858114">Elem</span><span class="op" id="5858118">(</span><span class="op" id="5858119">)</span><span class="op" id="5858120">,</span>&nbsp;<span class="ident" id="5858122">name</span><span class="op" id="5858126">,</span>&nbsp;<span class="ident" id="5858128">inProgress</span><span class="op" id="5858138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858143">ovfl</span>&nbsp;<span class="op" id="5858148">:=</span>&nbsp;<span class="ident" id="5858151">overflow</span><span class="op" id="5858159">(</span><span class="ident" id="5858160">name</span><span class="op" id="5858164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858169">helper</span>&nbsp;<span class="op" id="5858176">:=</span>&nbsp;<span class="ident" id="5858179">decSliceHelper</span><span class="op" id="5858193">[</span><span class="ident" id="5858194">t</span><span class="op" id="5858195">.</span><span class="ident" id="5858196">Elem</span><span class="op" id="5858200">(</span><span class="op" id="5858201">)</span><span class="op" id="5858202">.</span><span class="ident" id="5858203">Kind</span><span class="op" id="5858207">(</span><span class="op" id="5858208">)</span><span class="op" id="5858209">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858214">op</span>&nbsp;<span class="op" id="5858217">=</span>&nbsp;<span class="keyword" id="5858219">func</span><span class="op" id="5858223">(</span><span class="ident" id="5858224">i</span>&nbsp;<span class="op" id="5858226">*</span><span class="ident" id="5858227">decInstr</span><span class="op" id="5858235">,</span>&nbsp;<span class="ident" id="5858237">state</span>&nbsp;<span class="op" id="5858243">*</span><span class="ident" id="5858244">decoderState</span><span class="op" id="5858256">,</span>&nbsp;<span class="ident" id="5858258">value</span>&nbsp;<span class="ident" id="5858264">reflect</span><span class="op" id="5858271">.</span><span class="ident" id="5858272">Value</span><span class="op" id="5858277">)</span>&nbsp;<span class="op" id="5858279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858285">state</span><span class="op" id="5858290">.</span><span class="ident" id="5858291">dec</span><span class="op" id="5858294">.</span><span class="ident" id="5858295">decodeSlice</span><span class="op" id="5858306">(</span><span class="ident" id="5858307">state</span><span class="op" id="5858312">,</span>&nbsp;<span class="ident" id="5858314">value</span><span class="op" id="5858319">,</span>&nbsp;<span class="op" id="5858321">*</span><span class="ident" id="5858322">elemOp</span><span class="op" id="5858328">,</span>&nbsp;<span class="ident" id="5858330">ovfl</span><span class="op" id="5858334">,</span>&nbsp;<span class="ident" id="5858336">helper</span><span class="op" id="5858342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858352">case</span>&nbsp;<span class="ident" id="5858357">reflect</span><span class="op" id="5858364">.</span><span class="ident" id="5858365">Struct</span><span class="op" id="5858371">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5858376">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858451">ut</span>&nbsp;<span class="op" id="5858454">:=</span>&nbsp;<span class="ident" id="5858457">userType</span><span class="op" id="5858465">(</span><span class="ident" id="5858466">typ</span><span class="op" id="5858469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858474">enginePtr</span><span class="op" id="5858483">,</span>&nbsp;<span class="ident" id="5858485">err</span>&nbsp;<span class="op" id="5858489">:=</span>&nbsp;<span class="ident" id="5858492">dec</span><span class="op" id="5858495">.</span><span class="ident" id="5858496">getDecEnginePtr</span><span class="op" id="5858511">(</span><span class="ident" id="5858512">wireId</span><span class="op" id="5858518">,</span>&nbsp;<span class="ident" id="5858520">ut</span><span class="op" id="5858522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858527">if</span>&nbsp;<span class="ident" id="5858530">err</span>&nbsp;<span class="op" id="5858534">!=</span>&nbsp;<span class="builtintype" id="5858537">nil</span>&nbsp;<span class="op" id="5858541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858547">error_</span><span class="op" id="5858553">(</span><span class="ident" id="5858554">err</span><span class="op" id="5858557">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858567">op</span>&nbsp;<span class="op" id="5858570">=</span>&nbsp;<span class="keyword" id="5858572">func</span><span class="op" id="5858576">(</span><span class="ident" id="5858577">i</span>&nbsp;<span class="op" id="5858579">*</span><span class="ident" id="5858580">decInstr</span><span class="op" id="5858588">,</span>&nbsp;<span class="ident" id="5858590">state</span>&nbsp;<span class="op" id="5858596">*</span><span class="ident" id="5858597">decoderState</span><span class="op" id="5858609">,</span>&nbsp;<span class="ident" id="5858611">value</span>&nbsp;<span class="ident" id="5858617">reflect</span><span class="op" id="5858624">.</span><span class="ident" id="5858625">Value</span><span class="op" id="5858630">)</span>&nbsp;<span class="op" id="5858632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5858638">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858715">dec</span><span class="op" id="5858718">.</span><span class="ident" id="5858719">decodeStruct</span><span class="op" id="5858731">(</span><span class="op" id="5858732">*</span><span class="ident" id="5858733">enginePtr</span><span class="op" id="5858742">,</span>&nbsp;<span class="ident" id="5858744">ut</span><span class="op" id="5858746">,</span>&nbsp;<span class="ident" id="5858748">value</span><span class="op" id="5858753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858758">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858762">case</span>&nbsp;<span class="ident" id="5858767">reflect</span><span class="op" id="5858774">.</span><span class="ident" id="5858775">Interface</span><span class="op" id="5858784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858789">op</span>&nbsp;<span class="op" id="5858792">=</span>&nbsp;<span class="keyword" id="5858794">func</span><span class="op" id="5858798">(</span><span class="ident" id="5858799">i</span>&nbsp;<span class="op" id="5858801">*</span><span class="ident" id="5858802">decInstr</span><span class="op" id="5858810">,</span>&nbsp;<span class="ident" id="5858812">state</span>&nbsp;<span class="op" id="5858818">*</span><span class="ident" id="5858819">decoderState</span><span class="op" id="5858831">,</span>&nbsp;<span class="ident" id="5858833">value</span>&nbsp;<span class="ident" id="5858839">reflect</span><span class="op" id="5858846">.</span><span class="ident" id="5858847">Value</span><span class="op" id="5858852">)</span>&nbsp;<span class="op" id="5858854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858860">state</span><span class="op" id="5858865">.</span><span class="ident" id="5858866">dec</span><span class="op" id="5858869">.</span><span class="ident" id="5858870">decodeInterface</span><span class="op" id="5858885">(</span><span class="ident" id="5858886">t</span><span class="op" id="5858887">,</span>&nbsp;<span class="ident" id="5858889">state</span><span class="op" id="5858894">,</span>&nbsp;<span class="ident" id="5858896">value</span><span class="op" id="5858901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858910">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858916">if</span>&nbsp;<span class="ident" id="5858919">op</span>&nbsp;<span class="op" id="5858922">==</span>&nbsp;<span class="builtintype" id="5858925">nil</span>&nbsp;<span class="op" id="5858929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5858933">errorf</span><span class="op" id="5858939">(</span><span class="string" id="5858940">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5858969">,</span>&nbsp;<span class="ident" id="5858971">rt</span><span class="op" id="5858973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5858976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5858979">return</span>&nbsp;<span class="op" id="5858986">&amp;</span><span class="ident" id="5858987">op</span><br>
<span class="lineno">840</span><span class="op" id="5858990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5858993">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="5859072">func</span>&nbsp;<span class="op" id="5859077">(</span><span class="ident" id="5859078">dec</span>&nbsp;<span class="op" id="5859082">*</span><span class="ident" id="5859083">Decoder</span><span class="op" id="5859090">)</span>&nbsp;<span class="ident" id="5859092">decIgnoreOpFor</span><span class="op" id="5859106">(</span><span class="ident" id="5859107">wireId</span>&nbsp;<span class="ident" id="5859114">typeId</span><span class="op" id="5859120">)</span>&nbsp;<span class="ident" id="5859122">decOp</span>&nbsp;<span class="op" id="5859128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859131">op</span><span class="op" id="5859133">,</span>&nbsp;<span class="ident" id="5859135">ok</span>&nbsp;<span class="op" id="5859138">:=</span>&nbsp;<span class="ident" id="5859141">decIgnoreOpMap</span><span class="op" id="5859155">[</span><span class="ident" id="5859156">wireId</span><span class="op" id="5859162">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859165">if</span>&nbsp;<span class="op" id="5859168">!</span><span class="ident" id="5859169">ok</span>&nbsp;<span class="op" id="5859172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859176">if</span>&nbsp;<span class="ident" id="5859179">wireId</span>&nbsp;<span class="op" id="5859186">==</span>&nbsp;<span class="ident" id="5859189">tInterface</span>&nbsp;<span class="op" id="5859200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5859205">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5859270">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859339">op</span>&nbsp;<span class="op" id="5859342">=</span>&nbsp;<span class="keyword" id="5859344">func</span><span class="op" id="5859348">(</span><span class="ident" id="5859349">i</span>&nbsp;<span class="op" id="5859351">*</span><span class="ident" id="5859352">decInstr</span><span class="op" id="5859360">,</span>&nbsp;<span class="ident" id="5859362">state</span>&nbsp;<span class="op" id="5859368">*</span><span class="ident" id="5859369">decoderState</span><span class="op" id="5859381">,</span>&nbsp;<span class="ident" id="5859383">value</span>&nbsp;<span class="ident" id="5859389">reflect</span><span class="op" id="5859396">.</span><span class="ident" id="5859397">Value</span><span class="op" id="5859402">)</span>&nbsp;<span class="op" id="5859404">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859410">state</span><span class="op" id="5859415">.</span><span class="ident" id="5859416">dec</span><span class="op" id="5859419">.</span><span class="ident" id="5859420">ignoreInterface</span><span class="op" id="5859435">(</span><span class="ident" id="5859436">state</span><span class="op" id="5859441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859451">return</span>&nbsp;<span class="ident" id="5859458">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5859467">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859486">wire</span>&nbsp;<span class="op" id="5859491">:=</span>&nbsp;<span class="ident" id="5859494">dec</span><span class="op" id="5859497">.</span><span class="ident" id="5859498">wireType</span><span class="op" id="5859506">[</span><span class="ident" id="5859507">wireId</span><span class="op" id="5859513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859517">switch</span>&nbsp;<span class="op" id="5859524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859528">case</span>&nbsp;<span class="ident" id="5859533">wire</span>&nbsp;<span class="op" id="5859538">==</span>&nbsp;<span class="builtintype" id="5859541">nil</span><span class="op" id="5859544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859549">errorf</span><span class="op" id="5859555">(</span><span class="string" id="5859556">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5859585">,</span>&nbsp;<span class="ident" id="5859587">wireId</span><span class="op" id="5859593">.</span><span class="builtintype" id="5859594">string</span><span class="op" id="5859600">(</span><span class="op" id="5859601">)</span><span class="op" id="5859602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859606">case</span>&nbsp;<span class="ident" id="5859611">wire</span><span class="op" id="5859615">.</span><span class="ident" id="5859616">ArrayT</span>&nbsp;<span class="op" id="5859623">!=</span>&nbsp;<span class="builtintype" id="5859626">nil</span><span class="op" id="5859629">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859634">elemId</span>&nbsp;<span class="op" id="5859641">:=</span>&nbsp;<span class="ident" id="5859644">wire</span><span class="op" id="5859648">.</span><span class="ident" id="5859649">ArrayT</span><span class="op" id="5859655">.</span><span class="ident" id="5859656">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859664">elemOp</span>&nbsp;<span class="op" id="5859671">:=</span>&nbsp;<span class="ident" id="5859674">dec</span><span class="op" id="5859677">.</span><span class="ident" id="5859678">decIgnoreOpFor</span><span class="op" id="5859692">(</span><span class="ident" id="5859693">elemId</span><span class="op" id="5859699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859704">op</span>&nbsp;<span class="op" id="5859707">=</span>&nbsp;<span class="keyword" id="5859709">func</span><span class="op" id="5859713">(</span><span class="ident" id="5859714">i</span>&nbsp;<span class="op" id="5859716">*</span><span class="ident" id="5859717">decInstr</span><span class="op" id="5859725">,</span>&nbsp;<span class="ident" id="5859727">state</span>&nbsp;<span class="op" id="5859733">*</span><span class="ident" id="5859734">decoderState</span><span class="op" id="5859746">,</span>&nbsp;<span class="ident" id="5859748">value</span>&nbsp;<span class="ident" id="5859754">reflect</span><span class="op" id="5859761">.</span><span class="ident" id="5859762">Value</span><span class="op" id="5859767">)</span>&nbsp;<span class="op" id="5859769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859775">state</span><span class="op" id="5859780">.</span><span class="ident" id="5859781">dec</span><span class="op" id="5859784">.</span><span class="ident" id="5859785">ignoreArray</span><span class="op" id="5859796">(</span><span class="ident" id="5859797">state</span><span class="op" id="5859802">,</span>&nbsp;<span class="ident" id="5859804">elemOp</span><span class="op" id="5859810">,</span>&nbsp;<span class="ident" id="5859812">wire</span><span class="op" id="5859816">.</span><span class="ident" id="5859817">ArrayT</span><span class="op" id="5859823">.</span><span class="ident" id="5859824">Len</span><span class="op" id="5859827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5859832">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5859837">case</span>&nbsp;<span class="ident" id="5859842">wire</span><span class="op" id="5859846">.</span><span class="ident" id="5859847">MapT</span>&nbsp;<span class="op" id="5859852">!=</span>&nbsp;<span class="builtintype" id="5859855">nil</span><span class="op" id="5859858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859863">keyId</span>&nbsp;<span class="op" id="5859869">:=</span>&nbsp;<span class="ident" id="5859872">dec</span><span class="op" id="5859875">.</span><span class="ident" id="5859876">wireType</span><span class="op" id="5859884">[</span><span class="ident" id="5859885">wireId</span><span class="op" id="5859891">]</span><span class="op" id="5859892">.</span><span class="ident" id="5859893">MapT</span><span class="op" id="5859897">.</span><span class="ident" id="5859898">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859905">elemId</span>&nbsp;<span class="op" id="5859912">:=</span>&nbsp;<span class="ident" id="5859915">dec</span><span class="op" id="5859918">.</span><span class="ident" id="5859919">wireType</span><span class="op" id="5859927">[</span><span class="ident" id="5859928">wireId</span><span class="op" id="5859934">]</span><span class="op" id="5859935">.</span><span class="ident" id="5859936">MapT</span><span class="op" id="5859940">.</span><span class="ident" id="5859941">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859949">keyOp</span>&nbsp;<span class="op" id="5859955">:=</span>&nbsp;<span class="ident" id="5859958">dec</span><span class="op" id="5859961">.</span><span class="ident" id="5859962">decIgnoreOpFor</span><span class="op" id="5859976">(</span><span class="ident" id="5859977">keyId</span><span class="op" id="5859982">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5859987">elemOp</span>&nbsp;<span class="op" id="5859994">:=</span>&nbsp;<span class="ident" id="5859997">dec</span><span class="op" id="5860000">.</span><span class="ident" id="5860001">decIgnoreOpFor</span><span class="op" id="5860015">(</span><span class="ident" id="5860016">elemId</span><span class="op" id="5860022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860027">op</span>&nbsp;<span class="op" id="5860030">=</span>&nbsp;<span class="keyword" id="5860032">func</span><span class="op" id="5860036">(</span><span class="ident" id="5860037">i</span>&nbsp;<span class="op" id="5860039">*</span><span class="ident" id="5860040">decInstr</span><span class="op" id="5860048">,</span>&nbsp;<span class="ident" id="5860050">state</span>&nbsp;<span class="op" id="5860056">*</span><span class="ident" id="5860057">decoderState</span><span class="op" id="5860069">,</span>&nbsp;<span class="ident" id="5860071">value</span>&nbsp;<span class="ident" id="5860077">reflect</span><span class="op" id="5860084">.</span><span class="ident" id="5860085">Value</span><span class="op" id="5860090">)</span>&nbsp;<span class="op" id="5860092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860098">state</span><span class="op" id="5860103">.</span><span class="ident" id="5860104">dec</span><span class="op" id="5860107">.</span><span class="ident" id="5860108">ignoreMap</span><span class="op" id="5860117">(</span><span class="ident" id="5860118">state</span><span class="op" id="5860123">,</span>&nbsp;<span class="ident" id="5860125">keyOp</span><span class="op" id="5860130">,</span>&nbsp;<span class="ident" id="5860132">elemOp</span><span class="op" id="5860138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860148">case</span>&nbsp;<span class="ident" id="5860153">wire</span><span class="op" id="5860157">.</span><span class="ident" id="5860158">SliceT</span>&nbsp;<span class="op" id="5860165">!=</span>&nbsp;<span class="builtintype" id="5860168">nil</span><span class="op" id="5860171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860176">elemId</span>&nbsp;<span class="op" id="5860183">:=</span>&nbsp;<span class="ident" id="5860186">wire</span><span class="op" id="5860190">.</span><span class="ident" id="5860191">SliceT</span><span class="op" id="5860197">.</span><span class="ident" id="5860198">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860206">elemOp</span>&nbsp;<span class="op" id="5860213">:=</span>&nbsp;<span class="ident" id="5860216">dec</span><span class="op" id="5860219">.</span><span class="ident" id="5860220">decIgnoreOpFor</span><span class="op" id="5860234">(</span><span class="ident" id="5860235">elemId</span><span class="op" id="5860241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860246">op</span>&nbsp;<span class="op" id="5860249">=</span>&nbsp;<span class="keyword" id="5860251">func</span><span class="op" id="5860255">(</span><span class="ident" id="5860256">i</span>&nbsp;<span class="op" id="5860258">*</span><span class="ident" id="5860259">decInstr</span><span class="op" id="5860267">,</span>&nbsp;<span class="ident" id="5860269">state</span>&nbsp;<span class="op" id="5860275">*</span><span class="ident" id="5860276">decoderState</span><span class="op" id="5860288">,</span>&nbsp;<span class="ident" id="5860290">value</span>&nbsp;<span class="ident" id="5860296">reflect</span><span class="op" id="5860303">.</span><span class="ident" id="5860304">Value</span><span class="op" id="5860309">)</span>&nbsp;<span class="op" id="5860311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860317">state</span><span class="op" id="5860322">.</span><span class="ident" id="5860323">dec</span><span class="op" id="5860326">.</span><span class="ident" id="5860327">ignoreSlice</span><span class="op" id="5860338">(</span><span class="ident" id="5860339">state</span><span class="op" id="5860344">,</span>&nbsp;<span class="ident" id="5860346">elemOp</span><span class="op" id="5860352">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860362">case</span>&nbsp;<span class="ident" id="5860367">wire</span><span class="op" id="5860371">.</span><span class="ident" id="5860372">StructT</span>&nbsp;<span class="op" id="5860380">!=</span>&nbsp;<span class="builtintype" id="5860383">nil</span><span class="op" id="5860386">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5860391">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860466">enginePtr</span><span class="op" id="5860475">,</span>&nbsp;<span class="ident" id="5860477">err</span>&nbsp;<span class="op" id="5860481">:=</span>&nbsp;<span class="ident" id="5860484">dec</span><span class="op" id="5860487">.</span><span class="ident" id="5860488">getIgnoreEnginePtr</span><span class="op" id="5860506">(</span><span class="ident" id="5860507">wireId</span><span class="op" id="5860513">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860518">if</span>&nbsp;<span class="ident" id="5860521">err</span>&nbsp;<span class="op" id="5860525">!=</span>&nbsp;<span class="builtintype" id="5860528">nil</span>&nbsp;<span class="op" id="5860532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860538">error_</span><span class="op" id="5860544">(</span><span class="ident" id="5860545">err</span><span class="op" id="5860548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860558">op</span>&nbsp;<span class="op" id="5860561">=</span>&nbsp;<span class="keyword" id="5860563">func</span><span class="op" id="5860567">(</span><span class="ident" id="5860568">i</span>&nbsp;<span class="op" id="5860570">*</span><span class="ident" id="5860571">decInstr</span><span class="op" id="5860579">,</span>&nbsp;<span class="ident" id="5860581">state</span>&nbsp;<span class="op" id="5860587">*</span><span class="ident" id="5860588">decoderState</span><span class="op" id="5860600">,</span>&nbsp;<span class="ident" id="5860602">value</span>&nbsp;<span class="ident" id="5860608">reflect</span><span class="op" id="5860615">.</span><span class="ident" id="5860616">Value</span><span class="op" id="5860621">)</span>&nbsp;<span class="op" id="5860623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5860629">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860705">state</span><span class="op" id="5860710">.</span><span class="ident" id="5860711">dec</span><span class="op" id="5860714">.</span><span class="ident" id="5860715">ignoreStruct</span><span class="op" id="5860727">(</span><span class="op" id="5860728">*</span><span class="ident" id="5860729">enginePtr</span><span class="op" id="5860738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860748">case</span>&nbsp;<span class="ident" id="5860753">wire</span><span class="op" id="5860757">.</span><span class="ident" id="5860758">GobEncoderT</span>&nbsp;<span class="op" id="5860770">!=</span>&nbsp;<span class="builtintype" id="5860773">nil</span><span class="op" id="5860776">,</span>&nbsp;<span class="ident" id="5860778">wire</span><span class="op" id="5860782">.</span><span class="ident" id="5860783">BinaryMarshalerT</span>&nbsp;<span class="op" id="5860800">!=</span>&nbsp;<span class="builtintype" id="5860803">nil</span><span class="op" id="5860806">,</span>&nbsp;<span class="ident" id="5860808">wire</span><span class="op" id="5860812">.</span><span class="ident" id="5860813">TextMarshalerT</span>&nbsp;<span class="op" id="5860828">!=</span>&nbsp;<span class="builtintype" id="5860831">nil</span><span class="op" id="5860834">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860839">op</span>&nbsp;<span class="op" id="5860842">=</span>&nbsp;<span class="keyword" id="5860844">func</span><span class="op" id="5860848">(</span><span class="ident" id="5860849">i</span>&nbsp;<span class="op" id="5860851">*</span><span class="ident" id="5860852">decInstr</span><span class="op" id="5860860">,</span>&nbsp;<span class="ident" id="5860862">state</span>&nbsp;<span class="op" id="5860868">*</span><span class="ident" id="5860869">decoderState</span><span class="op" id="5860881">,</span>&nbsp;<span class="ident" id="5860883">value</span>&nbsp;<span class="ident" id="5860889">reflect</span><span class="op" id="5860896">.</span><span class="ident" id="5860897">Value</span><span class="op" id="5860902">)</span>&nbsp;<span class="op" id="5860904">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860910">state</span><span class="op" id="5860915">.</span><span class="ident" id="5860916">dec</span><span class="op" id="5860919">.</span><span class="ident" id="5860920">ignoreGobDecoder</span><span class="op" id="5860936">(</span><span class="ident" id="5860937">state</span><span class="op" id="5860942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5860954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5860957">if</span>&nbsp;<span class="ident" id="5860960">op</span>&nbsp;<span class="op" id="5860963">==</span>&nbsp;<span class="builtintype" id="5860966">nil</span>&nbsp;<span class="op" id="5860970">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5860974">errorf</span><span class="op" id="5860980">(</span><span class="string" id="5860981">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5861020">,</span>&nbsp;<span class="ident" id="5861022">wireId</span><span class="op" id="5861028">.</span><span class="builtintype" id="5861029">string</span><span class="op" id="5861035">(</span><span class="op" id="5861036">)</span><span class="op" id="5861037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861043">return</span>&nbsp;<span class="ident" id="5861050">op</span><br>
<span class="lineno"></span><span class="op" id="5861053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="5861056">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="5861127">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5861142">func</span>&nbsp;<span class="op" id="5861147">(</span><span class="ident" id="5861148">dec</span>&nbsp;<span class="op" id="5861152">*</span><span class="ident" id="5861153">Decoder</span><span class="op" id="5861160">)</span>&nbsp;<span class="ident" id="5861162">gobDecodeOpFor</span><span class="op" id="5861176">(</span><span class="ident" id="5861177">ut</span>&nbsp;<span class="op" id="5861180">*</span><span class="ident" id="5861181">userTypeInfo</span><span class="op" id="5861193">)</span>&nbsp;<span class="op" id="5861195">*</span><span class="ident" id="5861196">decOp</span>&nbsp;<span class="op" id="5861202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861205">rcvrType</span>&nbsp;<span class="op" id="5861214">:=</span>&nbsp;<span class="ident" id="5861217">ut</span><span class="op" id="5861219">.</span><span class="ident" id="5861220">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861226">if</span>&nbsp;<span class="ident" id="5861229">ut</span><span class="op" id="5861231">.</span><span class="ident" id="5861232">decIndir</span>&nbsp;<span class="op" id="5861241">==</span>&nbsp;<span class="op" id="5861244">-</span><span class="num" id="5861245">1</span>&nbsp;<span class="op" id="5861247">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861251">rcvrType</span>&nbsp;<span class="op" id="5861260">=</span>&nbsp;<span class="ident" id="5861262">reflect</span><span class="op" id="5861269">.</span><span class="ident" id="5861270">PtrTo</span><span class="op" id="5861275">(</span><span class="ident" id="5861276">rcvrType</span><span class="op" id="5861284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861287">}</span>&nbsp;<span class="keyword" id="5861289">else</span>&nbsp;<span class="keyword" id="5861294">if</span>&nbsp;<span class="ident" id="5861297">ut</span><span class="op" id="5861299">.</span><span class="ident" id="5861300">decIndir</span>&nbsp;<span class="op" id="5861309">&gt;</span>&nbsp;<span class="num" id="5861311">0</span>&nbsp;<span class="op" id="5861313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861317">for</span>&nbsp;<span class="ident" id="5861321">i</span>&nbsp;<span class="op" id="5861323">:=</span>&nbsp;<span class="builtintype" id="5861326">int8</span><span class="op" id="5861330">(</span><span class="num" id="5861331">0</span><span class="op" id="5861332">)</span><span class="op" id="5861333">;</span>&nbsp;<span class="ident" id="5861335">i</span>&nbsp;<span class="op" id="5861337">&lt;</span>&nbsp;<span class="ident" id="5861339">ut</span><span class="op" id="5861341">.</span><span class="ident" id="5861342">decIndir</span><span class="op" id="5861350">;</span>&nbsp;<span class="ident" id="5861352">i</span><span class="op" id="5861353">++</span>&nbsp;<span class="op" id="5861356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861361">rcvrType</span>&nbsp;<span class="op" id="5861370">=</span>&nbsp;<span class="ident" id="5861372">rcvrType</span><span class="op" id="5861380">.</span><span class="ident" id="5861381">Elem</span><span class="op" id="5861385">(</span><span class="op" id="5861386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861390">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861396">var</span>&nbsp;<span class="ident" id="5861400">op</span>&nbsp;<span class="ident" id="5861403">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861410">op</span>&nbsp;<span class="op" id="5861413">=</span>&nbsp;<span class="keyword" id="5861415">func</span><span class="op" id="5861419">(</span><span class="ident" id="5861420">i</span>&nbsp;<span class="op" id="5861422">*</span><span class="ident" id="5861423">decInstr</span><span class="op" id="5861431">,</span>&nbsp;<span class="ident" id="5861433">state</span>&nbsp;<span class="op" id="5861439">*</span><span class="ident" id="5861440">decoderState</span><span class="op" id="5861452">,</span>&nbsp;<span class="ident" id="5861454">value</span>&nbsp;<span class="ident" id="5861460">reflect</span><span class="op" id="5861467">.</span><span class="ident" id="5861468">Value</span><span class="op" id="5861473">)</span>&nbsp;<span class="op" id="5861475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5861479">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861561">if</span>&nbsp;<span class="ident" id="5861564">value</span><span class="op" id="5861569">.</span><span class="ident" id="5861570">Kind</span><span class="op" id="5861574">(</span><span class="op" id="5861575">)</span>&nbsp;<span class="op" id="5861577">!=</span>&nbsp;<span class="ident" id="5861580">reflect</span><span class="op" id="5861587">.</span><span class="ident" id="5861588">Ptr</span>&nbsp;<span class="op" id="5861592">&amp;&amp;</span>&nbsp;<span class="ident" id="5861595">rcvrType</span><span class="op" id="5861603">.</span><span class="ident" id="5861604">Kind</span><span class="op" id="5861608">(</span><span class="op" id="5861609">)</span>&nbsp;<span class="op" id="5861611">==</span>&nbsp;<span class="ident" id="5861614">reflect</span><span class="op" id="5861621">.</span><span class="ident" id="5861622">Ptr</span>&nbsp;<span class="op" id="5861626">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861631">value</span>&nbsp;<span class="op" id="5861637">=</span>&nbsp;<span class="ident" id="5861639">value</span><span class="op" id="5861644">.</span><span class="ident" id="5861645">Addr</span><span class="op" id="5861649">(</span><span class="op" id="5861650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5861658">state</span><span class="op" id="5861663">.</span><span class="ident" id="5861664">dec</span><span class="op" id="5861667">.</span><span class="ident" id="5861668">decodeGobDecoder</span><span class="op" id="5861684">(</span><span class="ident" id="5861685">ut</span><span class="op" id="5861687">,</span>&nbsp;<span class="ident" id="5861689">state</span><span class="op" id="5861694">,</span>&nbsp;<span class="ident" id="5861696">value</span><span class="op" id="5861701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5861704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5861707">return</span>&nbsp;<span class="op" id="5861714">&amp;</span><span class="ident" id="5861715">op</span><br>
<span class="lineno">925</span><span class="op" id="5861718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5861721">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="5861781">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="5861852">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="5861881">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="5861941">func</span>&nbsp;<span class="op" id="5861946">(</span><span class="ident" id="5861947">dec</span>&nbsp;<span class="op" id="5861951">*</span><span class="ident" id="5861952">Decoder</span><span class="op" id="5861959">)</span>&nbsp;<span class="ident" id="5861961">compatibleType</span><span class="op" id="5861975">(</span><span class="ident" id="5861976">fr</span>&nbsp;<span class="ident" id="5861979">reflect</span><span class="op" id="5861986">.</span><span class="ident" id="5861987">Type</span><span class="op" id="5861991">,</span>&nbsp;<span class="ident" id="5861993">fw</span>&nbsp;<span class="ident" id="5861996">typeId</span><span class="op" id="5862002">,</span>&nbsp;<span class="ident" id="5862004">inProgress</span>&nbsp;<span class="keyword" id="5862015">map</span><span class="op" id="5862018">[</span><span class="ident" id="5862019">reflect</span><span class="op" id="5862026">.</span><span class="ident" id="5862027">Type</span><span class="op" id="5862031">]</span><span class="ident" id="5862032">typeId</span><span class="op" id="5862038">)</span>&nbsp;<span class="builtintype" id="5862040">bool</span>&nbsp;<span class="op" id="5862045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862048">if</span>&nbsp;<span class="ident" id="5862051">rhs</span><span class="op" id="5862054">,</span>&nbsp;<span class="ident" id="5862056">ok</span>&nbsp;<span class="op" id="5862059">:=</span>&nbsp;<span class="ident" id="5862062">inProgress</span><span class="op" id="5862072">[</span><span class="ident" id="5862073">fr</span><span class="op" id="5862075">]</span><span class="op" id="5862076">;</span>&nbsp;<span class="ident" id="5862078">ok</span>&nbsp;<span class="op" id="5862081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862085">return</span>&nbsp;<span class="ident" id="5862092">rhs</span>&nbsp;<span class="op" id="5862096">==</span>&nbsp;<span class="ident" id="5862099">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862103">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862106">inProgress</span><span class="op" id="5862116">[</span><span class="ident" id="5862117">fr</span><span class="op" id="5862119">]</span>&nbsp;<span class="op" id="5862121">=</span>&nbsp;<span class="ident" id="5862123">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862127">ut</span>&nbsp;<span class="op" id="5862130">:=</span>&nbsp;<span class="ident" id="5862133">userType</span><span class="op" id="5862141">(</span><span class="ident" id="5862142">fr</span><span class="op" id="5862144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5862147">wire</span><span class="op" id="5862151">,</span>&nbsp;<span class="ident" id="5862153">ok</span>&nbsp;<span class="op" id="5862156">:=</span>&nbsp;<span class="ident" id="5862159">dec</span><span class="op" id="5862162">.</span><span class="ident" id="5862163">wireType</span><span class="op" id="5862171">[</span><span class="ident" id="5862172">fw</span><span class="op" id="5862174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862177">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862252">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862281">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862327">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862397">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862460">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862506">if</span>&nbsp;<span class="op" id="5862509">(</span><span class="ident" id="5862510">ut</span><span class="op" id="5862512">.</span><span class="ident" id="5862513">externalDec</span>&nbsp;<span class="op" id="5862525">==</span>&nbsp;<span class="ident" id="5862528">xGob</span><span class="op" id="5862532">)</span>&nbsp;<span class="op" id="5862534">!=</span>&nbsp;<span class="op" id="5862537">(</span><span class="ident" id="5862538">ok</span>&nbsp;<span class="op" id="5862541">&amp;&amp;</span>&nbsp;<span class="ident" id="5862544">wire</span><span class="op" id="5862548">.</span><span class="ident" id="5862549">GobEncoderT</span>&nbsp;<span class="op" id="5862561">!=</span>&nbsp;<span class="builtintype" id="5862564">nil</span><span class="op" id="5862567">)</span>&nbsp;<span class="op" id="5862569">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862574">(</span><span class="ident" id="5862575">ut</span><span class="op" id="5862577">.</span><span class="ident" id="5862578">externalDec</span>&nbsp;<span class="op" id="5862590">==</span>&nbsp;<span class="ident" id="5862593">xBinary</span><span class="op" id="5862600">)</span>&nbsp;<span class="op" id="5862602">!=</span>&nbsp;<span class="op" id="5862605">(</span><span class="ident" id="5862606">ok</span>&nbsp;<span class="op" id="5862609">&amp;&amp;</span>&nbsp;<span class="ident" id="5862612">wire</span><span class="op" id="5862616">.</span><span class="ident" id="5862617">BinaryMarshalerT</span>&nbsp;<span class="op" id="5862634">!=</span>&nbsp;<span class="builtintype" id="5862637">nil</span><span class="op" id="5862640">)</span>&nbsp;<span class="op" id="5862642">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862647">(</span><span class="ident" id="5862648">ut</span><span class="op" id="5862650">.</span><span class="ident" id="5862651">externalDec</span>&nbsp;<span class="op" id="5862663">==</span>&nbsp;<span class="ident" id="5862666">xText</span><span class="op" id="5862671">)</span>&nbsp;<span class="op" id="5862673">!=</span>&nbsp;<span class="op" id="5862676">(</span><span class="ident" id="5862677">ok</span>&nbsp;<span class="op" id="5862680">&amp;&amp;</span>&nbsp;<span class="ident" id="5862683">wire</span><span class="op" id="5862687">.</span><span class="ident" id="5862688">TextMarshalerT</span>&nbsp;<span class="op" id="5862703">!=</span>&nbsp;<span class="builtintype" id="5862706">nil</span><span class="op" id="5862709">)</span>&nbsp;<span class="op" id="5862711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862715">return</span>&nbsp;<span class="builtintype" id="5862722">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862732">if</span>&nbsp;<span class="ident" id="5862735">ut</span><span class="op" id="5862737">.</span><span class="ident" id="5862738">externalDec</span>&nbsp;<span class="op" id="5862750">!=</span>&nbsp;<span class="num" id="5862753">0</span>&nbsp;<span class="op" id="5862755">{</span>&nbsp;<span class="comment" id="5862757">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862791">return</span>&nbsp;<span class="builtintype" id="5862798">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5862804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862807">switch</span>&nbsp;<span class="ident" id="5862814">t</span>&nbsp;<span class="op" id="5862816">:=</span>&nbsp;<span class="ident" id="5862819">ut</span><span class="op" id="5862821">.</span><span class="ident" id="5862822">base</span><span class="op" id="5862826">;</span>&nbsp;<span class="ident" id="5862828">t</span><span class="op" id="5862829">.</span><span class="ident" id="5862830">Kind</span><span class="op" id="5862834">(</span><span class="op" id="5862835">)</span>&nbsp;<span class="op" id="5862837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862840">default</span><span class="op" id="5862847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5862851">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862882">return</span>&nbsp;<span class="builtintype" id="5862889">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862896">case</span>&nbsp;<span class="ident" id="5862901">reflect</span><span class="op" id="5862908">.</span><span class="ident" id="5862909">Bool</span><span class="op" id="5862913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862917">return</span>&nbsp;<span class="ident" id="5862924">fw</span>&nbsp;<span class="op" id="5862927">==</span>&nbsp;<span class="ident" id="5862930">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5862937">case</span>&nbsp;<span class="ident" id="5862942">reflect</span><span class="op" id="5862949">.</span><span class="ident" id="5862950">Int</span><span class="op" id="5862953">,</span>&nbsp;<span class="ident" id="5862955">reflect</span><span class="op" id="5862962">.</span><span class="ident" id="5862963">Int8</span><span class="op" id="5862967">,</span>&nbsp;<span class="ident" id="5862969">reflect</span><span class="op" id="5862976">.</span><span class="ident" id="5862977">Int16</span><span class="op" id="5862982">,</span>&nbsp;<span class="ident" id="5862984">reflect</span><span class="op" id="5862991">.</span><span class="ident" id="5862992">Int32</span><span class="op" id="5862997">,</span>&nbsp;<span class="ident" id="5862999">reflect</span><span class="op" id="5863006">.</span><span class="ident" id="5863007">Int64</span><span class="op" id="5863012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863016">return</span>&nbsp;<span class="ident" id="5863023">fw</span>&nbsp;<span class="op" id="5863026">==</span>&nbsp;<span class="ident" id="5863029">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863035">case</span>&nbsp;<span class="ident" id="5863040">reflect</span><span class="op" id="5863047">.</span><span class="ident" id="5863048">Uint</span><span class="op" id="5863052">,</span>&nbsp;<span class="ident" id="5863054">reflect</span><span class="op" id="5863061">.</span><span class="ident" id="5863062">Uint8</span><span class="op" id="5863067">,</span>&nbsp;<span class="ident" id="5863069">reflect</span><span class="op" id="5863076">.</span><span class="ident" id="5863077">Uint16</span><span class="op" id="5863083">,</span>&nbsp;<span class="ident" id="5863085">reflect</span><span class="op" id="5863092">.</span><span class="ident" id="5863093">Uint32</span><span class="op" id="5863099">,</span>&nbsp;<span class="ident" id="5863101">reflect</span><span class="op" id="5863108">.</span><span class="ident" id="5863109">Uint64</span><span class="op" id="5863115">,</span>&nbsp;<span class="ident" id="5863117">reflect</span><span class="op" id="5863124">.</span><span class="ident" id="5863125">Uintptr</span><span class="op" id="5863132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863136">return</span>&nbsp;<span class="ident" id="5863143">fw</span>&nbsp;<span class="op" id="5863146">==</span>&nbsp;<span class="ident" id="5863149">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863156">case</span>&nbsp;<span class="ident" id="5863161">reflect</span><span class="op" id="5863168">.</span><span class="ident" id="5863169">Float32</span><span class="op" id="5863176">,</span>&nbsp;<span class="ident" id="5863178">reflect</span><span class="op" id="5863185">.</span><span class="ident" id="5863186">Float64</span><span class="op" id="5863193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863197">return</span>&nbsp;<span class="ident" id="5863204">fw</span>&nbsp;<span class="op" id="5863207">==</span>&nbsp;<span class="ident" id="5863210">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863218">case</span>&nbsp;<span class="ident" id="5863223">reflect</span><span class="op" id="5863230">.</span><span class="ident" id="5863231">Complex64</span><span class="op" id="5863240">,</span>&nbsp;<span class="ident" id="5863242">reflect</span><span class="op" id="5863249">.</span><span class="ident" id="5863250">Complex128</span><span class="op" id="5863260">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863264">return</span>&nbsp;<span class="ident" id="5863271">fw</span>&nbsp;<span class="op" id="5863274">==</span>&nbsp;<span class="ident" id="5863277">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863287">case</span>&nbsp;<span class="ident" id="5863292">reflect</span><span class="op" id="5863299">.</span><span class="ident" id="5863300">String</span><span class="op" id="5863306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863310">return</span>&nbsp;<span class="ident" id="5863317">fw</span>&nbsp;<span class="op" id="5863320">==</span>&nbsp;<span class="ident" id="5863323">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863332">case</span>&nbsp;<span class="ident" id="5863337">reflect</span><span class="op" id="5863344">.</span><span class="ident" id="5863345">Interface</span><span class="op" id="5863354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863358">return</span>&nbsp;<span class="ident" id="5863365">fw</span>&nbsp;<span class="op" id="5863368">==</span>&nbsp;<span class="ident" id="5863371">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863383">case</span>&nbsp;<span class="ident" id="5863388">reflect</span><span class="op" id="5863395">.</span><span class="ident" id="5863396">Array</span><span class="op" id="5863401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863405">if</span>&nbsp;<span class="op" id="5863408">!</span><span class="ident" id="5863409">ok</span>&nbsp;<span class="op" id="5863412">||</span>&nbsp;<span class="ident" id="5863415">wire</span><span class="op" id="5863419">.</span><span class="ident" id="5863420">ArrayT</span>&nbsp;<span class="op" id="5863427">==</span>&nbsp;<span class="builtintype" id="5863430">nil</span>&nbsp;<span class="op" id="5863434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863439">return</span>&nbsp;<span class="builtintype" id="5863446">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5863458">array</span>&nbsp;<span class="op" id="5863464">:=</span>&nbsp;<span class="ident" id="5863467">wire</span><span class="op" id="5863471">.</span><span class="ident" id="5863472">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863481">return</span>&nbsp;<span class="ident" id="5863488">t</span><span class="op" id="5863489">.</span><span class="ident" id="5863490">Len</span><span class="op" id="5863493">(</span><span class="op" id="5863494">)</span>&nbsp;<span class="op" id="5863496">==</span>&nbsp;<span class="ident" id="5863499">array</span><span class="op" id="5863504">.</span><span class="ident" id="5863505">Len</span>&nbsp;<span class="op" id="5863509">&amp;&amp;</span>&nbsp;<span class="ident" id="5863512">dec</span><span class="op" id="5863515">.</span><span class="ident" id="5863516">compatibleType</span><span class="op" id="5863530">(</span><span class="ident" id="5863531">t</span><span class="op" id="5863532">.</span><span class="ident" id="5863533">Elem</span><span class="op" id="5863537">(</span><span class="op" id="5863538">)</span><span class="op" id="5863539">,</span>&nbsp;<span class="ident" id="5863541">array</span><span class="op" id="5863546">.</span><span class="ident" id="5863547">Elem</span><span class="op" id="5863551">,</span>&nbsp;<span class="ident" id="5863553">inProgress</span><span class="op" id="5863563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863566">case</span>&nbsp;<span class="ident" id="5863571">reflect</span><span class="op" id="5863578">.</span><span class="ident" id="5863579">Map</span><span class="op" id="5863582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863586">if</span>&nbsp;<span class="op" id="5863589">!</span><span class="ident" id="5863590">ok</span>&nbsp;<span class="op" id="5863593">||</span>&nbsp;<span class="ident" id="5863596">wire</span><span class="op" id="5863600">.</span><span class="ident" id="5863601">MapT</span>&nbsp;<span class="op" id="5863606">==</span>&nbsp;<span class="builtintype" id="5863609">nil</span>&nbsp;<span class="op" id="5863613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863618">return</span>&nbsp;<span class="builtintype" id="5863625">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863633">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5863637">MapType</span>&nbsp;<span class="op" id="5863645">:=</span>&nbsp;<span class="ident" id="5863648">wire</span><span class="op" id="5863652">.</span><span class="ident" id="5863653">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863660">return</span>&nbsp;<span class="ident" id="5863667">dec</span><span class="op" id="5863670">.</span><span class="ident" id="5863671">compatibleType</span><span class="op" id="5863685">(</span><span class="ident" id="5863686">t</span><span class="op" id="5863687">.</span><span class="ident" id="5863688">Key</span><span class="op" id="5863691">(</span><span class="op" id="5863692">)</span><span class="op" id="5863693">,</span>&nbsp;<span class="ident" id="5863695">MapType</span><span class="op" id="5863702">.</span><span class="ident" id="5863703">Key</span><span class="op" id="5863706">,</span>&nbsp;<span class="ident" id="5863708">inProgress</span><span class="op" id="5863718">)</span>&nbsp;<span class="op" id="5863720">&amp;&amp;</span>&nbsp;<span class="ident" id="5863723">dec</span><span class="op" id="5863726">.</span><span class="ident" id="5863727">compatibleType</span><span class="op" id="5863741">(</span><span class="ident" id="5863742">t</span><span class="op" id="5863743">.</span><span class="ident" id="5863744">Elem</span><span class="op" id="5863748">(</span><span class="op" id="5863749">)</span><span class="op" id="5863750">,</span>&nbsp;<span class="ident" id="5863752">MapType</span><span class="op" id="5863759">.</span><span class="ident" id="5863760">Elem</span><span class="op" id="5863764">,</span>&nbsp;<span class="ident" id="5863766">inProgress</span><span class="op" id="5863776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863779">case</span>&nbsp;<span class="ident" id="5863784">reflect</span><span class="op" id="5863791">.</span><span class="ident" id="5863792">Slice</span><span class="op" id="5863797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5863801">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863831">if</span>&nbsp;<span class="ident" id="5863834">t</span><span class="op" id="5863835">.</span><span class="ident" id="5863836">Elem</span><span class="op" id="5863840">(</span><span class="op" id="5863841">)</span><span class="op" id="5863842">.</span><span class="ident" id="5863843">Kind</span><span class="op" id="5863847">(</span><span class="op" id="5863848">)</span>&nbsp;<span class="op" id="5863850">==</span>&nbsp;<span class="ident" id="5863853">reflect</span><span class="op" id="5863860">.</span><span class="ident" id="5863861">Uint8</span>&nbsp;<span class="op" id="5863867">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863872">return</span>&nbsp;<span class="ident" id="5863879">fw</span>&nbsp;<span class="op" id="5863882">==</span>&nbsp;<span class="ident" id="5863885">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5863894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5863898">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863938">var</span>&nbsp;<span class="ident" id="5863942">sw</span>&nbsp;<span class="op" id="5863945">*</span><span class="ident" id="5863946">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5863958">if</span>&nbsp;<span class="ident" id="5863961">tt</span><span class="op" id="5863963">,</span>&nbsp;<span class="ident" id="5863965">ok</span>&nbsp;<span class="op" id="5863968">:=</span>&nbsp;<span class="ident" id="5863971">builtinIdToType</span><span class="op" id="5863986">[</span><span class="ident" id="5863987">fw</span><span class="op" id="5863989">]</span><span class="op" id="5863990">;</span>&nbsp;<span class="ident" id="5863992">ok</span>&nbsp;<span class="op" id="5863995">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864000">sw</span><span class="op" id="5864002">,</span>&nbsp;<span class="ident" id="5864004">_</span>&nbsp;<span class="op" id="5864006">=</span>&nbsp;<span class="ident" id="5864008">tt</span><span class="op" id="5864010">.</span><span class="op" id="5864011">(</span><span class="op" id="5864012">*</span><span class="ident" id="5864013">sliceType</span><span class="op" id="5864022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864026">}</span>&nbsp;<span class="keyword" id="5864028">else</span>&nbsp;<span class="keyword" id="5864033">if</span>&nbsp;<span class="ident" id="5864036">wire</span>&nbsp;<span class="op" id="5864041">!=</span>&nbsp;<span class="builtintype" id="5864044">nil</span>&nbsp;<span class="op" id="5864048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864053">sw</span>&nbsp;<span class="op" id="5864056">=</span>&nbsp;<span class="ident" id="5864058">wire</span><span class="op" id="5864062">.</span><span class="ident" id="5864063">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864076">elem</span>&nbsp;<span class="op" id="5864081">:=</span>&nbsp;<span class="ident" id="5864084">userType</span><span class="op" id="5864092">(</span><span class="ident" id="5864093">t</span><span class="op" id="5864094">.</span><span class="ident" id="5864095">Elem</span><span class="op" id="5864099">(</span><span class="op" id="5864100">)</span><span class="op" id="5864101">)</span><span class="op" id="5864102">.</span><span class="ident" id="5864103">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864110">return</span>&nbsp;<span class="ident" id="5864117">sw</span>&nbsp;<span class="op" id="5864120">!=</span>&nbsp;<span class="builtintype" id="5864123">nil</span>&nbsp;<span class="op" id="5864127">&amp;&amp;</span>&nbsp;<span class="ident" id="5864130">dec</span><span class="op" id="5864133">.</span><span class="ident" id="5864134">compatibleType</span><span class="op" id="5864148">(</span><span class="ident" id="5864149">elem</span><span class="op" id="5864153">,</span>&nbsp;<span class="ident" id="5864155">sw</span><span class="op" id="5864157">.</span><span class="ident" id="5864158">Elem</span><span class="op" id="5864162">,</span>&nbsp;<span class="ident" id="5864164">inProgress</span><span class="op" id="5864174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864177">case</span>&nbsp;<span class="ident" id="5864182">reflect</span><span class="op" id="5864189">.</span><span class="ident" id="5864190">Struct</span><span class="op" id="5864196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864200">return</span>&nbsp;<span class="builtintype" id="5864207">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864213">}</span><br>
<span class="lineno"></span><span class="op" id="5864215">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="5864218">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="5864305">func</span>&nbsp;<span class="op" id="5864310">(</span><span class="ident" id="5864311">dec</span>&nbsp;<span class="op" id="5864315">*</span><span class="ident" id="5864316">Decoder</span><span class="op" id="5864323">)</span>&nbsp;<span class="ident" id="5864325">typeString</span><span class="op" id="5864335">(</span><span class="ident" id="5864336">remoteId</span>&nbsp;<span class="ident" id="5864345">typeId</span><span class="op" id="5864351">)</span>&nbsp;<span class="builtintype" id="5864353">string</span>&nbsp;<span class="op" id="5864360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864363">if</span>&nbsp;<span class="ident" id="5864366">t</span>&nbsp;<span class="op" id="5864368">:=</span>&nbsp;<span class="ident" id="5864371">idToType</span><span class="op" id="5864379">[</span><span class="ident" id="5864380">remoteId</span><span class="op" id="5864388">]</span><span class="op" id="5864389">;</span>&nbsp;<span class="ident" id="5864391">t</span>&nbsp;<span class="op" id="5864393">!=</span>&nbsp;<span class="builtintype" id="5864396">nil</span>&nbsp;<span class="op" id="5864400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5864404">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864430">return</span>&nbsp;<span class="ident" id="5864437">t</span><span class="op" id="5864438">.</span><span class="builtintype" id="5864439">string</span><span class="op" id="5864445">(</span><span class="op" id="5864446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5864449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864452">return</span>&nbsp;<span class="ident" id="5864459">dec</span><span class="op" id="5864462">.</span><span class="ident" id="5864463">wireType</span><span class="op" id="5864471">[</span><span class="ident" id="5864472">remoteId</span><span class="op" id="5864480">]</span><span class="op" id="5864481">.</span><span class="builtintype" id="5864482">string</span><span class="op" id="5864488">(</span><span class="op" id="5864489">)</span><br>
<span class="lineno"></span><span class="op" id="5864491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="5864494">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="5864583">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="5864599">func</span>&nbsp;<span class="op" id="5864604">(</span><span class="ident" id="5864605">dec</span>&nbsp;<span class="op" id="5864609">*</span><span class="ident" id="5864610">Decoder</span><span class="op" id="5864617">)</span>&nbsp;<span class="ident" id="5864619">compileSingle</span><span class="op" id="5864632">(</span><span class="ident" id="5864633">remoteId</span>&nbsp;<span class="ident" id="5864642">typeId</span><span class="op" id="5864648">,</span>&nbsp;<span class="ident" id="5864650">ut</span>&nbsp;<span class="op" id="5864653">*</span><span class="ident" id="5864654">userTypeInfo</span><span class="op" id="5864666">)</span>&nbsp;<span class="op" id="5864668">(</span><span class="ident" id="5864669">engine</span>&nbsp;<span class="op" id="5864676">*</span><span class="ident" id="5864677">decEngine</span><span class="op" id="5864686">,</span>&nbsp;<span class="ident" id="5864688">err</span>&nbsp;<span class="builtintype" id="5864692">error</span><span class="op" id="5864697">)</span>&nbsp;<span class="op" id="5864699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864702">rt</span>&nbsp;<span class="op" id="5864705">:=</span>&nbsp;<span class="ident" id="5864708">ut</span><span class="op" id="5864710">.</span><span class="ident" id="5864711">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864717">engine</span>&nbsp;<span class="op" id="5864724">=</span>&nbsp;<span class="builtinfunc" id="5864726">new</span><span class="op" id="5864729">(</span><span class="ident" id="5864730">decEngine</span><span class="op" id="5864739">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864742">engine</span><span class="op" id="5864748">.</span><span class="ident" id="5864749">instr</span>&nbsp;<span class="op" id="5864755">=</span>&nbsp;<span class="builtinfunc" id="5864757">make</span><span class="op" id="5864761">(</span><span class="op" id="5864762">[</span><span class="op" id="5864763">]</span><span class="ident" id="5864764">decInstr</span><span class="op" id="5864772">,</span>&nbsp;<span class="num" id="5864774">1</span><span class="op" id="5864775">)</span>&nbsp;<span class="comment" id="5864777">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864790">name</span>&nbsp;<span class="op" id="5864795">:=</span>&nbsp;<span class="ident" id="5864798">rt</span><span class="op" id="5864800">.</span><span class="ident" id="5864801">String</span><span class="op" id="5864807">(</span><span class="op" id="5864808">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5864825">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5864844">if</span>&nbsp;<span class="op" id="5864847">!</span><span class="ident" id="5864848">dec</span><span class="op" id="5864851">.</span><span class="ident" id="5864852">compatibleType</span><span class="op" id="5864866">(</span><span class="ident" id="5864867">rt</span><span class="op" id="5864869">,</span>&nbsp;<span class="ident" id="5864871">remoteId</span><span class="op" id="5864879">,</span>&nbsp;<span class="builtinfunc" id="5864881">make</span><span class="op" id="5864885">(</span><span class="keyword" id="5864886">map</span><span class="op" id="5864889">[</span><span class="ident" id="5864890">reflect</span><span class="op" id="5864897">.</span><span class="ident" id="5864898">Type</span><span class="op" id="5864902">]</span><span class="ident" id="5864903">typeId</span><span class="op" id="5864909">)</span><span class="op" id="5864910">)</span>&nbsp;<span class="op" id="5864912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5864916">remoteType</span>&nbsp;<span class="op" id="5864927">:=</span>&nbsp;<span class="ident" id="5864930">dec</span><span class="op" id="5864933">.</span><span class="ident" id="5864934">typeString</span><span class="op" id="5864944">(</span><span class="ident" id="5864945">remoteId</span><span class="op" id="5864953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5864957">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865029">if</span>&nbsp;<span class="ident" id="5865032">ut</span><span class="op" id="5865034">.</span><span class="ident" id="5865035">base</span><span class="op" id="5865039">.</span><span class="ident" id="5865040">Kind</span><span class="op" id="5865044">(</span><span class="op" id="5865045">)</span>&nbsp;<span class="op" id="5865047">==</span>&nbsp;<span class="ident" id="5865050">reflect</span><span class="op" id="5865057">.</span><span class="ident" id="5865058">Interface</span>&nbsp;<span class="op" id="5865068">&amp;&amp;</span>&nbsp;<span class="ident" id="5865071">remoteId</span>&nbsp;<span class="op" id="5865080">!=</span>&nbsp;<span class="ident" id="5865083">tInterface</span>&nbsp;<span class="op" id="5865094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865099">return</span>&nbsp;<span class="builtintype" id="5865106">nil</span><span class="op" id="5865109">,</span>&nbsp;<span class="ident" id="5865111">errors</span><span class="op" id="5865117">.</span><span class="ident" id="5865118">New</span><span class="op" id="5865121">(</span><span class="string" id="5865122">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5865151">+</span>&nbsp;<span class="ident" id="5865153">name</span>&nbsp;<span class="op" id="5865158">+</span>&nbsp;<span class="string" id="5865160">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5865235">+</span>&nbsp;<span class="ident" id="5865237">remoteType</span><span class="op" id="5865247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865255">return</span>&nbsp;<span class="builtintype" id="5865262">nil</span><span class="op" id="5865265">,</span>&nbsp;<span class="ident" id="5865267">errors</span><span class="op" id="5865273">.</span><span class="ident" id="5865274">New</span><span class="op" id="5865277">(</span><span class="string" id="5865278">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5865311">+</span>&nbsp;<span class="ident" id="5865313">name</span>&nbsp;<span class="op" id="5865318">+</span>&nbsp;<span class="string" id="5865320">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5865346">+</span>&nbsp;<span class="ident" id="5865348">remoteType</span><span class="op" id="5865358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5865361">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865364">op</span>&nbsp;<span class="op" id="5865367">:=</span>&nbsp;<span class="ident" id="5865370">dec</span><span class="op" id="5865373">.</span><span class="ident" id="5865374">decOpFor</span><span class="op" id="5865382">(</span><span class="ident" id="5865383">remoteId</span><span class="op" id="5865391">,</span>&nbsp;<span class="ident" id="5865393">rt</span><span class="op" id="5865395">,</span>&nbsp;<span class="ident" id="5865397">name</span><span class="op" id="5865401">,</span>&nbsp;<span class="builtinfunc" id="5865403">make</span><span class="op" id="5865407">(</span><span class="keyword" id="5865408">map</span><span class="op" id="5865411">[</span><span class="ident" id="5865412">reflect</span><span class="op" id="5865419">.</span><span class="ident" id="5865420">Type</span><span class="op" id="5865424">]</span><span class="op" id="5865425">*</span><span class="ident" id="5865426">decOp</span><span class="op" id="5865431">)</span><span class="op" id="5865432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865435">ovfl</span>&nbsp;<span class="op" id="5865440">:=</span>&nbsp;<span class="ident" id="5865443">errors</span><span class="op" id="5865449">.</span><span class="ident" id="5865450">New</span><span class="op" id="5865453">(</span><span class="string" id="5865454">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="5865468">+</span>&nbsp;<span class="ident" id="5865470">name</span>&nbsp;<span class="op" id="5865475">+</span>&nbsp;<span class="string" id="5865477">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="5865493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865496">engine</span><span class="op" id="5865502">.</span><span class="ident" id="5865503">instr</span><span class="op" id="5865508">[</span><span class="ident" id="5865509">singletonField</span><span class="op" id="5865523">]</span>&nbsp;<span class="op" id="5865525">=</span>&nbsp;<span class="ident" id="5865527">decInstr</span><span class="op" id="5865535">{</span><span class="op" id="5865536">*</span><span class="ident" id="5865537">op</span><span class="op" id="5865539">,</span>&nbsp;<span class="ident" id="5865541">singletonField</span><span class="op" id="5865555">,</span>&nbsp;<span class="builtintype" id="5865557">nil</span><span class="op" id="5865560">,</span>&nbsp;<span class="ident" id="5865562">ovfl</span><span class="op" id="5865566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865569">engine</span><span class="op" id="5865575">.</span><span class="ident" id="5865576">numInstr</span>&nbsp;<span class="op" id="5865585">=</span>&nbsp;<span class="num" id="5865587">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5865590">return</span><br>
<span class="lineno">1030</span><span class="op" id="5865597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5865600">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5865708">func</span>&nbsp;<span class="op" id="5865713">(</span><span class="ident" id="5865714">dec</span>&nbsp;<span class="op" id="5865718">*</span><span class="ident" id="5865719">Decoder</span><span class="op" id="5865726">)</span>&nbsp;<span class="ident" id="5865728">compileIgnoreSingle</span><span class="op" id="5865747">(</span><span class="ident" id="5865748">remoteId</span>&nbsp;<span class="ident" id="5865757">typeId</span><span class="op" id="5865763">)</span>&nbsp;<span class="op" id="5865765">(</span><span class="ident" id="5865766">engine</span>&nbsp;<span class="op" id="5865773">*</span><span class="ident" id="5865774">decEngine</span><span class="op" id="5865783">,</span>&nbsp;<span class="ident" id="5865785">err</span>&nbsp;<span class="builtintype" id="5865789">error</span><span class="op" id="5865794">)</span>&nbsp;<span class="op" id="5865796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865799">engine</span>&nbsp;<span class="op" id="5865806">=</span>&nbsp;<span class="builtinfunc" id="5865808">new</span><span class="op" id="5865811">(</span><span class="ident" id="5865812">decEngine</span><span class="op" id="5865821">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865824">engine</span><span class="op" id="5865830">.</span><span class="ident" id="5865831">instr</span>&nbsp;<span class="op" id="5865837">=</span>&nbsp;<span class="builtinfunc" id="5865839">make</span><span class="op" id="5865843">(</span><span class="op" id="5865844">[</span><span class="op" id="5865845">]</span><span class="ident" id="5865846">decInstr</span><span class="op" id="5865854">,</span>&nbsp;<span class="num" id="5865856">1</span><span class="op" id="5865857">)</span>&nbsp;<span class="comment" id="5865859">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865872">op</span>&nbsp;<span class="op" id="5865875">:=</span>&nbsp;<span class="ident" id="5865878">dec</span><span class="op" id="5865881">.</span><span class="ident" id="5865882">decIgnoreOpFor</span><span class="op" id="5865896">(</span><span class="ident" id="5865897">remoteId</span><span class="op" id="5865905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865908">ovfl</span>&nbsp;<span class="op" id="5865913">:=</span>&nbsp;<span class="ident" id="5865916">overflow</span><span class="op" id="5865924">(</span><span class="ident" id="5865925">dec</span><span class="op" id="5865928">.</span><span class="ident" id="5865929">typeString</span><span class="op" id="5865939">(</span><span class="ident" id="5865940">remoteId</span><span class="op" id="5865948">)</span><span class="op" id="5865949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865952">engine</span><span class="op" id="5865958">.</span><span class="ident" id="5865959">instr</span><span class="op" id="5865964">[</span><span class="num" id="5865965">0</span><span class="op" id="5865966">]</span>&nbsp;<span class="op" id="5865968">=</span>&nbsp;<span class="ident" id="5865970">decInstr</span><span class="op" id="5865978">{</span><span class="ident" id="5865979">op</span><span class="op" id="5865981">,</span>&nbsp;<span class="num" id="5865983">0</span><span class="op" id="5865984">,</span>&nbsp;<span class="builtintype" id="5865986">nil</span><span class="op" id="5865989">,</span>&nbsp;<span class="ident" id="5865991">ovfl</span><span class="op" id="5865995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5865998">engine</span><span class="op" id="5866004">.</span><span class="ident" id="5866005">numInstr</span>&nbsp;<span class="op" id="5866014">=</span>&nbsp;<span class="num" id="5866016">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866019">return</span><br>
<span class="lineno"></span><span class="op" id="5866026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5866029">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="5866115">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="5866149">func</span>&nbsp;<span class="op" id="5866154">(</span><span class="ident" id="5866155">dec</span>&nbsp;<span class="op" id="5866159">*</span><span class="ident" id="5866160">Decoder</span><span class="op" id="5866167">)</span>&nbsp;<span class="ident" id="5866169">compileDec</span><span class="op" id="5866179">(</span><span class="ident" id="5866180">remoteId</span>&nbsp;<span class="ident" id="5866189">typeId</span><span class="op" id="5866195">,</span>&nbsp;<span class="ident" id="5866197">ut</span>&nbsp;<span class="op" id="5866200">*</span><span class="ident" id="5866201">userTypeInfo</span><span class="op" id="5866213">)</span>&nbsp;<span class="op" id="5866215">(</span><span class="ident" id="5866216">engine</span>&nbsp;<span class="op" id="5866223">*</span><span class="ident" id="5866224">decEngine</span><span class="op" id="5866233">,</span>&nbsp;<span class="ident" id="5866235">err</span>&nbsp;<span class="builtintype" id="5866239">error</span><span class="op" id="5866244">)</span>&nbsp;<span class="op" id="5866246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866249">rt</span>&nbsp;<span class="op" id="5866252">:=</span>&nbsp;<span class="ident" id="5866255">ut</span><span class="op" id="5866257">.</span><span class="ident" id="5866258">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866264">srt</span>&nbsp;<span class="op" id="5866268">:=</span>&nbsp;<span class="ident" id="5866271">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866275">if</span>&nbsp;<span class="ident" id="5866278">srt</span><span class="op" id="5866281">.</span><span class="ident" id="5866282">Kind</span><span class="op" id="5866286">(</span><span class="op" id="5866287">)</span>&nbsp;<span class="op" id="5866289">!=</span>&nbsp;<span class="ident" id="5866292">reflect</span><span class="op" id="5866299">.</span><span class="ident" id="5866300">Struct</span>&nbsp;<span class="op" id="5866307">||</span>&nbsp;<span class="ident" id="5866310">ut</span><span class="op" id="5866312">.</span><span class="ident" id="5866313">externalDec</span>&nbsp;<span class="op" id="5866325">!=</span>&nbsp;<span class="num" id="5866328">0</span>&nbsp;<span class="op" id="5866330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866334">return</span>&nbsp;<span class="ident" id="5866341">dec</span><span class="op" id="5866344">.</span><span class="ident" id="5866345">compileSingle</span><span class="op" id="5866358">(</span><span class="ident" id="5866359">remoteId</span><span class="op" id="5866367">,</span>&nbsp;<span class="ident" id="5866369">ut</span><span class="op" id="5866371">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866377">var</span>&nbsp;<span class="ident" id="5866381">wireStruct</span>&nbsp;<span class="op" id="5866392">*</span><span class="ident" id="5866393">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5866405">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5866491">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866571">if</span>&nbsp;<span class="ident" id="5866574">t</span><span class="op" id="5866575">,</span>&nbsp;<span class="ident" id="5866577">ok</span>&nbsp;<span class="op" id="5866580">:=</span>&nbsp;<span class="ident" id="5866583">builtinIdToType</span><span class="op" id="5866598">[</span><span class="ident" id="5866599">remoteId</span><span class="op" id="5866607">]</span><span class="op" id="5866608">;</span>&nbsp;<span class="ident" id="5866610">ok</span>&nbsp;<span class="op" id="5866613">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866617">wireStruct</span><span class="op" id="5866627">,</span>&nbsp;<span class="ident" id="5866629">_</span>&nbsp;<span class="op" id="5866631">=</span>&nbsp;<span class="ident" id="5866633">t</span><span class="op" id="5866634">.</span><span class="op" id="5866635">(</span><span class="op" id="5866636">*</span><span class="ident" id="5866637">structType</span><span class="op" id="5866647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866650">}</span>&nbsp;<span class="keyword" id="5866652">else</span>&nbsp;<span class="op" id="5866657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866661">wire</span>&nbsp;<span class="op" id="5866666">:=</span>&nbsp;<span class="ident" id="5866669">dec</span><span class="op" id="5866672">.</span><span class="ident" id="5866673">wireType</span><span class="op" id="5866681">[</span><span class="ident" id="5866682">remoteId</span><span class="op" id="5866690">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866694">if</span>&nbsp;<span class="ident" id="5866697">wire</span>&nbsp;<span class="op" id="5866702">==</span>&nbsp;<span class="builtintype" id="5866705">nil</span>&nbsp;<span class="op" id="5866709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866714">error_</span><span class="op" id="5866720">(</span><span class="ident" id="5866721">errBadType</span><span class="op" id="5866731">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866739">wireStruct</span>&nbsp;<span class="op" id="5866750">=</span>&nbsp;<span class="ident" id="5866752">wire</span><span class="op" id="5866756">.</span><span class="ident" id="5866757">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5866769">if</span>&nbsp;<span class="ident" id="5866772">wireStruct</span>&nbsp;<span class="op" id="5866783">==</span>&nbsp;<span class="builtintype" id="5866786">nil</span>&nbsp;<span class="op" id="5866790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866794">errorf</span><span class="op" id="5866800">(</span><span class="string" id="5866801">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="5866864">,</span>&nbsp;<span class="ident" id="5866866">rt</span><span class="op" id="5866868">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5866871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866874">engine</span>&nbsp;<span class="op" id="5866881">=</span>&nbsp;<span class="builtinfunc" id="5866883">new</span><span class="op" id="5866886">(</span><span class="ident" id="5866887">decEngine</span><span class="op" id="5866896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866899">engine</span><span class="op" id="5866905">.</span><span class="ident" id="5866906">instr</span>&nbsp;<span class="op" id="5866912">=</span>&nbsp;<span class="builtinfunc" id="5866914">make</span><span class="op" id="5866918">(</span><span class="op" id="5866919">[</span><span class="op" id="5866920">]</span><span class="ident" id="5866921">decInstr</span><span class="op" id="5866929">,</span>&nbsp;<span class="builtinfunc" id="5866931">len</span><span class="op" id="5866934">(</span><span class="ident" id="5866935">wireStruct</span><span class="op" id="5866945">.</span><span class="ident" id="5866946">Field</span><span class="op" id="5866951">)</span><span class="op" id="5866952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5866955">seen</span>&nbsp;<span class="op" id="5866960">:=</span>&nbsp;<span class="builtinfunc" id="5866963">make</span><span class="op" id="5866967">(</span><span class="keyword" id="5866968">map</span><span class="op" id="5866971">[</span><span class="ident" id="5866972">reflect</span><span class="op" id="5866979">.</span><span class="ident" id="5866980">Type</span><span class="op" id="5866984">]</span><span class="op" id="5866985">*</span><span class="ident" id="5866986">decOp</span><span class="op" id="5866991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5866994">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5867037">for</span>&nbsp;<span class="ident" id="5867041">fieldnum</span>&nbsp;<span class="op" id="5867050">:=</span>&nbsp;<span class="num" id="5867053">0</span><span class="op" id="5867054">;</span>&nbsp;<span class="ident" id="5867056">fieldnum</span>&nbsp;<span class="op" id="5867065">&lt;</span>&nbsp;<span class="builtinfunc" id="5867067">len</span><span class="op" id="5867070">(</span><span class="ident" id="5867071">wireStruct</span><span class="op" id="5867081">.</span><span class="ident" id="5867082">Field</span><span class="op" id="5867087">)</span><span class="op" id="5867088">;</span>&nbsp;<span class="ident" id="5867090">fieldnum</span><span class="op" id="5867098">++</span>&nbsp;<span class="op" id="5867101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867105">wireField</span>&nbsp;<span class="op" id="5867115">:=</span>&nbsp;<span class="ident" id="5867118">wireStruct</span><span class="op" id="5867128">.</span><span class="ident" id="5867129">Field</span><span class="op" id="5867134">[</span><span class="ident" id="5867135">fieldnum</span><span class="op" id="5867143">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5867147">if</span>&nbsp;<span class="ident" id="5867150">wireField</span><span class="op" id="5867159">.</span><span class="ident" id="5867160">Name</span>&nbsp;<span class="op" id="5867165">==</span>&nbsp;<span class="string" id="5867168">&#34;&#34;</span>&nbsp;<span class="op" id="5867171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867176">errorf</span><span class="op" id="5867182">(</span><span class="string" id="5867183">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="5867223">,</span>&nbsp;<span class="ident" id="5867225">wireStruct</span><span class="op" id="5867235">.</span><span class="ident" id="5867236">Name</span><span class="op" id="5867240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5867244">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867248">ovfl</span>&nbsp;<span class="op" id="5867253">:=</span>&nbsp;<span class="ident" id="5867256">overflow</span><span class="op" id="5867264">(</span><span class="ident" id="5867265">wireField</span><span class="op" id="5867274">.</span><span class="ident" id="5867275">Name</span><span class="op" id="5867279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5867283">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867341">localField</span><span class="op" id="5867351">,</span>&nbsp;<span class="ident" id="5867353">present</span>&nbsp;<span class="op" id="5867361">:=</span>&nbsp;<span class="ident" id="5867364">srt</span><span class="op" id="5867367">.</span><span class="ident" id="5867368">FieldByName</span><span class="op" id="5867379">(</span><span class="ident" id="5867380">wireField</span><span class="op" id="5867389">.</span><span class="ident" id="5867390">Name</span><span class="op" id="5867394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5867398">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5867428">if</span>&nbsp;<span class="op" id="5867431">!</span><span class="ident" id="5867432">present</span>&nbsp;<span class="op" id="5867440">||</span>&nbsp;<span class="op" id="5867443">!</span><span class="ident" id="5867444">isExported</span><span class="op" id="5867454">(</span><span class="ident" id="5867455">wireField</span><span class="op" id="5867464">.</span><span class="ident" id="5867465">Name</span><span class="op" id="5867469">)</span>&nbsp;<span class="op" id="5867471">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867476">op</span>&nbsp;<span class="op" id="5867479">:=</span>&nbsp;<span class="ident" id="5867482">dec</span><span class="op" id="5867485">.</span><span class="ident" id="5867486">decIgnoreOpFor</span><span class="op" id="5867500">(</span><span class="ident" id="5867501">wireField</span><span class="op" id="5867510">.</span><span class="ident" id="5867511">Id</span><span class="op" id="5867513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867518">engine</span><span class="op" id="5867524">.</span><span class="ident" id="5867525">instr</span><span class="op" id="5867530">[</span><span class="ident" id="5867531">fieldnum</span><span class="op" id="5867539">]</span>&nbsp;<span class="op" id="5867541">=</span>&nbsp;<span class="ident" id="5867543">decInstr</span><span class="op" id="5867551">{</span><span class="ident" id="5867552">op</span><span class="op" id="5867554">,</span>&nbsp;<span class="ident" id="5867556">fieldnum</span><span class="op" id="5867564">,</span>&nbsp;<span class="builtintype" id="5867566">nil</span><span class="op" id="5867569">,</span>&nbsp;<span class="ident" id="5867571">ovfl</span><span class="op" id="5867575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5867580">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5867591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5867595">if</span>&nbsp;<span class="op" id="5867598">!</span><span class="ident" id="5867599">dec</span><span class="op" id="5867602">.</span><span class="ident" id="5867603">compatibleType</span><span class="op" id="5867617">(</span><span class="ident" id="5867618">localField</span><span class="op" id="5867628">.</span><span class="ident" id="5867629">Type</span><span class="op" id="5867633">,</span>&nbsp;<span class="ident" id="5867635">wireField</span><span class="op" id="5867644">.</span><span class="ident" id="5867645">Id</span><span class="op" id="5867647">,</span>&nbsp;<span class="builtinfunc" id="5867649">make</span><span class="op" id="5867653">(</span><span class="keyword" id="5867654">map</span><span class="op" id="5867657">[</span><span class="ident" id="5867658">reflect</span><span class="op" id="5867665">.</span><span class="ident" id="5867666">Type</span><span class="op" id="5867670">]</span><span class="ident" id="5867671">typeId</span><span class="op" id="5867677">)</span><span class="op" id="5867678">)</span>&nbsp;<span class="op" id="5867680">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867685">errorf</span><span class="op" id="5867691">(</span><span class="string" id="5867692">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="5867734">,</span>&nbsp;<span class="ident" id="5867736">localField</span><span class="op" id="5867746">.</span><span class="ident" id="5867747">Type</span><span class="op" id="5867751">,</span>&nbsp;<span class="ident" id="5867753">wireStruct</span><span class="op" id="5867763">.</span><span class="ident" id="5867764">Name</span><span class="op" id="5867768">,</span>&nbsp;<span class="ident" id="5867770">wireField</span><span class="op" id="5867779">.</span><span class="ident" id="5867780">Name</span><span class="op" id="5867784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5867788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867792">op</span>&nbsp;<span class="op" id="5867795">:=</span>&nbsp;<span class="ident" id="5867798">dec</span><span class="op" id="5867801">.</span><span class="ident" id="5867802">decOpFor</span><span class="op" id="5867810">(</span><span class="ident" id="5867811">wireField</span><span class="op" id="5867820">.</span><span class="ident" id="5867821">Id</span><span class="op" id="5867823">,</span>&nbsp;<span class="ident" id="5867825">localField</span><span class="op" id="5867835">.</span><span class="ident" id="5867836">Type</span><span class="op" id="5867840">,</span>&nbsp;<span class="ident" id="5867842">localField</span><span class="op" id="5867852">.</span><span class="ident" id="5867853">Name</span><span class="op" id="5867857">,</span>&nbsp;<span class="ident" id="5867859">seen</span><span class="op" id="5867863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867867">engine</span><span class="op" id="5867873">.</span><span class="ident" id="5867874">instr</span><span class="op" id="5867879">[</span><span class="ident" id="5867880">fieldnum</span><span class="op" id="5867888">]</span>&nbsp;<span class="op" id="5867890">=</span>&nbsp;<span class="ident" id="5867892">decInstr</span><span class="op" id="5867900">{</span><span class="op" id="5867901">*</span><span class="ident" id="5867902">op</span><span class="op" id="5867904">,</span>&nbsp;<span class="ident" id="5867906">fieldnum</span><span class="op" id="5867914">,</span>&nbsp;<span class="ident" id="5867916">localField</span><span class="op" id="5867926">.</span><span class="ident" id="5867927">Index</span><span class="op" id="5867932">,</span>&nbsp;<span class="ident" id="5867934">ovfl</span><span class="op" id="5867938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5867942">engine</span><span class="op" id="5867948">.</span><span class="ident" id="5867949">numInstr</span><span class="op" id="5867957">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5867961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5867964">return</span><br>
<span class="lineno"></span><span class="op" id="5867971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5867974">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="5868036">func</span>&nbsp;<span class="op" id="5868041">(</span><span class="ident" id="5868042">dec</span>&nbsp;<span class="op" id="5868046">*</span><span class="ident" id="5868047">Decoder</span><span class="op" id="5868054">)</span>&nbsp;<span class="ident" id="5868056">getDecEnginePtr</span><span class="op" id="5868071">(</span><span class="ident" id="5868072">remoteId</span>&nbsp;<span class="ident" id="5868081">typeId</span><span class="op" id="5868087">,</span>&nbsp;<span class="ident" id="5868089">ut</span>&nbsp;<span class="op" id="5868092">*</span><span class="ident" id="5868093">userTypeInfo</span><span class="op" id="5868105">)</span>&nbsp;<span class="op" id="5868107">(</span><span class="ident" id="5868108">enginePtr</span>&nbsp;<span class="op" id="5868118">*</span><span class="op" id="5868119">*</span><span class="ident" id="5868120">decEngine</span><span class="op" id="5868129">,</span>&nbsp;<span class="ident" id="5868131">err</span>&nbsp;<span class="builtintype" id="5868135">error</span><span class="op" id="5868140">)</span>&nbsp;<span class="op" id="5868142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868145">rt</span>&nbsp;<span class="op" id="5868148">:=</span>&nbsp;<span class="ident" id="5868151">ut</span><span class="op" id="5868153">.</span><span class="ident" id="5868154">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868160">decoderMap</span><span class="op" id="5868170">,</span>&nbsp;<span class="ident" id="5868172">ok</span>&nbsp;<span class="op" id="5868175">:=</span>&nbsp;<span class="ident" id="5868178">dec</span><span class="op" id="5868181">.</span><span class="ident" id="5868182">decoderCache</span><span class="op" id="5868194">[</span><span class="ident" id="5868195">rt</span><span class="op" id="5868197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5868200">if</span>&nbsp;<span class="op" id="5868203">!</span><span class="ident" id="5868204">ok</span>&nbsp;<span class="op" id="5868207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868211">decoderMap</span>&nbsp;<span class="op" id="5868222">=</span>&nbsp;<span class="builtinfunc" id="5868224">make</span><span class="op" id="5868228">(</span><span class="keyword" id="5868229">map</span><span class="op" id="5868232">[</span><span class="ident" id="5868233">typeId</span><span class="op" id="5868239">]</span><span class="op" id="5868240">*</span><span class="op" id="5868241">*</span><span class="ident" id="5868242">decEngine</span><span class="op" id="5868251">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868255">dec</span><span class="op" id="5868258">.</span><span class="ident" id="5868259">decoderCache</span><span class="op" id="5868271">[</span><span class="ident" id="5868272">rt</span><span class="op" id="5868274">]</span>&nbsp;<span class="op" id="5868276">=</span>&nbsp;<span class="ident" id="5868278">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5868290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5868293">if</span>&nbsp;<span class="ident" id="5868296">enginePtr</span><span class="op" id="5868305">,</span>&nbsp;<span class="ident" id="5868307">ok</span>&nbsp;<span class="op" id="5868310">=</span>&nbsp;<span class="ident" id="5868312">decoderMap</span><span class="op" id="5868322">[</span><span class="ident" id="5868323">remoteId</span><span class="op" id="5868331">]</span><span class="op" id="5868332">;</span>&nbsp;<span class="op" id="5868334">!</span><span class="ident" id="5868335">ok</span>&nbsp;<span class="op" id="5868338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5868342">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868421">enginePtr</span>&nbsp;<span class="op" id="5868431">=</span>&nbsp;<span class="builtinfunc" id="5868433">new</span><span class="op" id="5868436">(</span><span class="op" id="5868437">*</span><span class="ident" id="5868438">decEngine</span><span class="op" id="5868447">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5868451">decoderMap</span><span class="op" id="5868461">[</span><span class="ident" id="5868462">remoteId</span><span class="op" id="5868470">]</span>&nbsp;<span class="op" id="5868472">=</span>&nbsp;<span class="ident" id="5868474">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5868486">*</span><span class="ident" id="5868487">enginePtr</span><span class="op" id="5868496">,</span>&nbsp;<span class="ident" id="5868498">err</span>&nbsp;<span class="op" id="5868502">=</span>&nbsp;<span class="ident" id="5868504">dec</span><span class="op" id="5868507">.</span><span class="ident" id="5868508">compileDec</span><span class="op" id="5868518">(</span><span class="ident" id="5868519">remoteId</span><span class="op" id="5868527">,</span>&nbsp;<span class="ident" id="5868529">ut</span><span class="op" id="5868531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5868535">if</span>&nbsp;<span class="ident" id="5868538">err</span>&nbsp;<span class="op" id="5868542">!=</span>&nbsp;<span class="builtintype" id="5868545">nil</span>&nbsp;<span class="op" id="5868549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5868554">delete</span><span class="op" id="5868560">(</span><span class="ident" id="5868561">decoderMap</span><span class="op" id="5868571">,</span>&nbsp;<span class="ident" id="5868573">remoteId</span><span class="op" id="5868581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5868585">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5868588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5868591">return</span><br>
<span class="lineno"></span><span class="op" id="5868598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5868601">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5868674">type</span>&nbsp;<span class="ident" id="5868679">emptyStruct</span>&nbsp;<span class="keyword" id="5868691">struct</span><span class="op" id="5868697">{</span><span class="op" id="5868698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5868701">var</span>&nbsp;<span class="ident" id="5868705">emptyStructType</span>&nbsp;<span class="op" id="5868721">=</span>&nbsp;<span class="ident" id="5868723">reflect</span><span class="op" id="5868730">.</span><span class="ident" id="5868731">TypeOf</span><span class="op" id="5868737">(</span><span class="ident" id="5868738">emptyStruct</span><span class="op" id="5868749">{</span><span class="op" id="5868750">}</span><span class="op" id="5868751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5868754">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="5868850">func</span>&nbsp;<span class="op" id="5868855">(</span><span class="ident" id="5868856">dec</span>&nbsp;<span class="op" id="5868860">*</span><span class="ident" id="5868861">Decoder</span><span class="op" id="5868868">)</span>&nbsp;<span class="ident" id="5868870">getIgnoreEnginePtr</span><span class="op" id="5868888">(</span><span class="ident" id="5868889">wireId</span>&nbsp;<span class="ident" id="5868896">typeId</span><span class="op" id="5868902">)</span>&nbsp;<span class="op" id="5868904">(</span><span class="ident" id="5868905">enginePtr</span>&nbsp;<span class="op" id="5868915">*</span><span class="op" id="5868916">*</span><span class="ident" id="5868917">decEngine</span><span class="op" id="5868926">,</span>&nbsp;<span class="ident" id="5868928">err</span>&nbsp;<span class="builtintype" id="5868932">error</span><span class="op" id="5868937">)</span>&nbsp;<span class="op" id="5868939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5868942">var</span>&nbsp;<span class="ident" id="5868946">ok</span>&nbsp;<span class="builtintype" id="5868949">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5868955">if</span>&nbsp;<span class="ident" id="5868958">enginePtr</span><span class="op" id="5868967">,</span>&nbsp;<span class="ident" id="5868969">ok</span>&nbsp;<span class="op" id="5868972">=</span>&nbsp;<span class="ident" id="5868974">dec</span><span class="op" id="5868977">.</span><span class="ident" id="5868978">ignorerCache</span><span class="op" id="5868990">[</span><span class="ident" id="5868991">wireId</span><span class="op" id="5868997">]</span><span class="op" id="5868998">;</span>&nbsp;<span class="op" id="5869000">!</span><span class="ident" id="5869001">ok</span>&nbsp;<span class="op" id="5869004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5869008">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869087">enginePtr</span>&nbsp;<span class="op" id="5869097">=</span>&nbsp;<span class="builtinfunc" id="5869099">new</span><span class="op" id="5869102">(</span><span class="op" id="5869103">*</span><span class="ident" id="5869104">decEngine</span><span class="op" id="5869113">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869117">dec</span><span class="op" id="5869120">.</span><span class="ident" id="5869121">ignorerCache</span><span class="op" id="5869133">[</span><span class="ident" id="5869134">wireId</span><span class="op" id="5869140">]</span>&nbsp;<span class="op" id="5869142">=</span>&nbsp;<span class="ident" id="5869144">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869156">wire</span>&nbsp;<span class="op" id="5869161">:=</span>&nbsp;<span class="ident" id="5869164">dec</span><span class="op" id="5869167">.</span><span class="ident" id="5869168">wireType</span><span class="op" id="5869176">[</span><span class="ident" id="5869177">wireId</span><span class="op" id="5869183">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869187">if</span>&nbsp;<span class="ident" id="5869190">wire</span>&nbsp;<span class="op" id="5869195">!=</span>&nbsp;<span class="builtintype" id="5869198">nil</span>&nbsp;<span class="op" id="5869202">&amp;&amp;</span>&nbsp;<span class="ident" id="5869205">wire</span><span class="op" id="5869209">.</span><span class="ident" id="5869210">StructT</span>&nbsp;<span class="op" id="5869218">!=</span>&nbsp;<span class="builtintype" id="5869221">nil</span>&nbsp;<span class="op" id="5869225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869230">*</span><span class="ident" id="5869231">enginePtr</span><span class="op" id="5869240">,</span>&nbsp;<span class="ident" id="5869242">err</span>&nbsp;<span class="op" id="5869246">=</span>&nbsp;<span class="ident" id="5869248">dec</span><span class="op" id="5869251">.</span><span class="ident" id="5869252">compileDec</span><span class="op" id="5869262">(</span><span class="ident" id="5869263">wireId</span><span class="op" id="5869269">,</span>&nbsp;<span class="ident" id="5869271">userType</span><span class="op" id="5869279">(</span><span class="ident" id="5869280">emptyStructType</span><span class="op" id="5869295">)</span><span class="op" id="5869296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869300">}</span>&nbsp;<span class="keyword" id="5869302">else</span>&nbsp;<span class="op" id="5869307">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869312">*</span><span class="ident" id="5869313">enginePtr</span><span class="op" id="5869322">,</span>&nbsp;<span class="ident" id="5869324">err</span>&nbsp;<span class="op" id="5869328">=</span>&nbsp;<span class="ident" id="5869330">dec</span><span class="op" id="5869333">.</span><span class="ident" id="5869334">compileIgnoreSingle</span><span class="op" id="5869353">(</span><span class="ident" id="5869354">wireId</span><span class="op" id="5869360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869368">if</span>&nbsp;<span class="ident" id="5869371">err</span>&nbsp;<span class="op" id="5869375">!=</span>&nbsp;<span class="builtintype" id="5869378">nil</span>&nbsp;<span class="op" id="5869382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5869387">delete</span><span class="op" id="5869393">(</span><span class="ident" id="5869394">dec</span><span class="op" id="5869397">.</span><span class="ident" id="5869398">ignorerCache</span><span class="op" id="5869410">,</span>&nbsp;<span class="ident" id="5869412">wireId</span><span class="op" id="5869418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869422">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869428">return</span><br>
<span class="lineno"></span><span class="op" id="5869435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5869438">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="5869522">func</span>&nbsp;<span class="op" id="5869527">(</span><span class="ident" id="5869528">dec</span>&nbsp;<span class="op" id="5869532">*</span><span class="ident" id="5869533">Decoder</span><span class="op" id="5869540">)</span>&nbsp;<span class="ident" id="5869542">decodeValue</span><span class="op" id="5869553">(</span><span class="ident" id="5869554">wireId</span>&nbsp;<span class="ident" id="5869561">typeId</span><span class="op" id="5869567">,</span>&nbsp;<span class="ident" id="5869569">value</span>&nbsp;<span class="ident" id="5869575">reflect</span><span class="op" id="5869582">.</span><span class="ident" id="5869583">Value</span><span class="op" id="5869588">)</span>&nbsp;<span class="op" id="5869590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869593">defer</span>&nbsp;<span class="ident" id="5869599">catchError</span><span class="op" id="5869609">(</span><span class="op" id="5869610">&amp;</span><span class="ident" id="5869611">dec</span><span class="op" id="5869614">.</span><span class="ident" id="5869615">err</span><span class="op" id="5869618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5869621">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869688">if</span>&nbsp;<span class="op" id="5869691">!</span><span class="ident" id="5869692">value</span><span class="op" id="5869697">.</span><span class="ident" id="5869698">IsValid</span><span class="op" id="5869705">(</span><span class="op" id="5869706">)</span>&nbsp;<span class="op" id="5869708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869712">dec</span><span class="op" id="5869715">.</span><span class="ident" id="5869716">decodeIgnoredValue</span><span class="op" id="5869734">(</span><span class="ident" id="5869735">wireId</span><span class="op" id="5869741">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869745">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5869756">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869801">ut</span>&nbsp;<span class="op" id="5869804">:=</span>&nbsp;<span class="ident" id="5869807">userType</span><span class="op" id="5869815">(</span><span class="ident" id="5869816">value</span><span class="op" id="5869821">.</span><span class="ident" id="5869822">Type</span><span class="op" id="5869826">(</span><span class="op" id="5869827">)</span><span class="op" id="5869828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869831">base</span>&nbsp;<span class="op" id="5869836">:=</span>&nbsp;<span class="ident" id="5869839">ut</span><span class="op" id="5869841">.</span><span class="ident" id="5869842">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869848">var</span>&nbsp;<span class="ident" id="5869852">enginePtr</span>&nbsp;<span class="op" id="5869862">*</span><span class="op" id="5869863">*</span><span class="ident" id="5869864">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869875">enginePtr</span><span class="op" id="5869884">,</span>&nbsp;<span class="ident" id="5869886">dec</span><span class="op" id="5869889">.</span><span class="ident" id="5869890">err</span>&nbsp;<span class="op" id="5869894">=</span>&nbsp;<span class="ident" id="5869896">dec</span><span class="op" id="5869899">.</span><span class="ident" id="5869900">getDecEnginePtr</span><span class="op" id="5869915">(</span><span class="ident" id="5869916">wireId</span><span class="op" id="5869922">,</span>&nbsp;<span class="ident" id="5869924">ut</span><span class="op" id="5869926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869929">if</span>&nbsp;<span class="ident" id="5869932">dec</span><span class="op" id="5869935">.</span><span class="ident" id="5869936">err</span>&nbsp;<span class="op" id="5869940">!=</span>&nbsp;<span class="builtintype" id="5869943">nil</span>&nbsp;<span class="op" id="5869947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5869951">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5869959">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869962">value</span>&nbsp;<span class="op" id="5869968">=</span>&nbsp;<span class="ident" id="5869970">decAlloc</span><span class="op" id="5869978">(</span><span class="ident" id="5869979">value</span><span class="op" id="5869984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5869987">engine</span>&nbsp;<span class="op" id="5869994">:=</span>&nbsp;<span class="op" id="5869997">*</span><span class="ident" id="5869998">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870009">if</span>&nbsp;<span class="ident" id="5870012">st</span>&nbsp;<span class="op" id="5870015">:=</span>&nbsp;<span class="ident" id="5870018">base</span><span class="op" id="5870022">;</span>&nbsp;<span class="ident" id="5870024">st</span><span class="op" id="5870026">.</span><span class="ident" id="5870027">Kind</span><span class="op" id="5870031">(</span><span class="op" id="5870032">)</span>&nbsp;<span class="op" id="5870034">==</span>&nbsp;<span class="ident" id="5870037">reflect</span><span class="op" id="5870044">.</span><span class="ident" id="5870045">Struct</span>&nbsp;<span class="op" id="5870052">&amp;&amp;</span>&nbsp;<span class="ident" id="5870055">ut</span><span class="op" id="5870057">.</span><span class="ident" id="5870058">externalDec</span>&nbsp;<span class="op" id="5870070">==</span>&nbsp;<span class="num" id="5870073">0</span>&nbsp;<span class="op" id="5870075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870079">if</span>&nbsp;<span class="ident" id="5870082">engine</span><span class="op" id="5870088">.</span><span class="ident" id="5870089">numInstr</span>&nbsp;<span class="op" id="5870098">==</span>&nbsp;<span class="num" id="5870101">0</span>&nbsp;<span class="op" id="5870103">&amp;&amp;</span>&nbsp;<span class="ident" id="5870106">st</span><span class="op" id="5870108">.</span><span class="ident" id="5870109">NumField</span><span class="op" id="5870117">(</span><span class="op" id="5870118">)</span>&nbsp;<span class="op" id="5870120">&gt;</span>&nbsp;<span class="num" id="5870122">0</span>&nbsp;<span class="op" id="5870124">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870130">dec</span><span class="op" id="5870133">.</span><span class="ident" id="5870134">wireType</span><span class="op" id="5870142">[</span><span class="ident" id="5870143">wireId</span><span class="op" id="5870149">]</span>&nbsp;<span class="op" id="5870151">!=</span>&nbsp;<span class="builtintype" id="5870154">nil</span>&nbsp;<span class="op" id="5870158">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5870161">len</span><span class="op" id="5870164">(</span><span class="ident" id="5870165">dec</span><span class="op" id="5870168">.</span><span class="ident" id="5870169">wireType</span><span class="op" id="5870177">[</span><span class="ident" id="5870178">wireId</span><span class="op" id="5870184">]</span><span class="op" id="5870185">.</span><span class="ident" id="5870186">StructT</span><span class="op" id="5870193">.</span><span class="ident" id="5870194">Field</span><span class="op" id="5870199">)</span>&nbsp;<span class="op" id="5870201">&gt;</span>&nbsp;<span class="num" id="5870203">0</span>&nbsp;<span class="op" id="5870205">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870210">name</span>&nbsp;<span class="op" id="5870215">:=</span>&nbsp;<span class="ident" id="5870218">base</span><span class="op" id="5870222">.</span><span class="ident" id="5870223">Name</span><span class="op" id="5870227">(</span><span class="op" id="5870228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870233">errorf</span><span class="op" id="5870239">(</span><span class="string" id="5870240">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="5870299">,</span>&nbsp;<span class="ident" id="5870301">name</span><span class="op" id="5870305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5870309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870313">dec</span><span class="op" id="5870316">.</span><span class="ident" id="5870317">decodeStruct</span><span class="op" id="5870329">(</span><span class="ident" id="5870330">engine</span><span class="op" id="5870336">,</span>&nbsp;<span class="ident" id="5870338">ut</span><span class="op" id="5870340">,</span>&nbsp;<span class="ident" id="5870342">value</span><span class="op" id="5870347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5870350">}</span>&nbsp;<span class="keyword" id="5870352">else</span>&nbsp;<span class="op" id="5870357">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870361">dec</span><span class="op" id="5870364">.</span><span class="ident" id="5870365">decodeSingle</span><span class="op" id="5870377">(</span><span class="ident" id="5870378">engine</span><span class="op" id="5870384">,</span>&nbsp;<span class="ident" id="5870386">ut</span><span class="op" id="5870388">,</span>&nbsp;<span class="ident" id="5870390">value</span><span class="op" id="5870395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5870398">}</span><br>
<span class="lineno"></span><span class="op" id="5870400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5870403">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="5870509">func</span>&nbsp;<span class="op" id="5870514">(</span><span class="ident" id="5870515">dec</span>&nbsp;<span class="op" id="5870519">*</span><span class="ident" id="5870520">Decoder</span><span class="op" id="5870527">)</span>&nbsp;<span class="ident" id="5870529">decodeIgnoredValue</span><span class="op" id="5870547">(</span><span class="ident" id="5870548">wireId</span>&nbsp;<span class="ident" id="5870555">typeId</span><span class="op" id="5870561">)</span>&nbsp;<span class="op" id="5870563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870566">var</span>&nbsp;<span class="ident" id="5870570">enginePtr</span>&nbsp;<span class="op" id="5870580">*</span><span class="op" id="5870581">*</span><span class="ident" id="5870582">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870593">enginePtr</span><span class="op" id="5870602">,</span>&nbsp;<span class="ident" id="5870604">dec</span><span class="op" id="5870607">.</span><span class="ident" id="5870608">err</span>&nbsp;<span class="op" id="5870612">=</span>&nbsp;<span class="ident" id="5870614">dec</span><span class="op" id="5870617">.</span><span class="ident" id="5870618">getIgnoreEnginePtr</span><span class="op" id="5870636">(</span><span class="ident" id="5870637">wireId</span><span class="op" id="5870643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870646">if</span>&nbsp;<span class="ident" id="5870649">dec</span><span class="op" id="5870652">.</span><span class="ident" id="5870653">err</span>&nbsp;<span class="op" id="5870657">!=</span>&nbsp;<span class="builtintype" id="5870660">nil</span>&nbsp;<span class="op" id="5870664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870668">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5870676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870679">wire</span>&nbsp;<span class="op" id="5870684">:=</span>&nbsp;<span class="ident" id="5870687">dec</span><span class="op" id="5870690">.</span><span class="ident" id="5870691">wireType</span><span class="op" id="5870699">[</span><span class="ident" id="5870700">wireId</span><span class="op" id="5870706">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870709">if</span>&nbsp;<span class="ident" id="5870712">wire</span>&nbsp;<span class="op" id="5870717">!=</span>&nbsp;<span class="builtintype" id="5870720">nil</span>&nbsp;<span class="op" id="5870724">&amp;&amp;</span>&nbsp;<span class="ident" id="5870727">wire</span><span class="op" id="5870731">.</span><span class="ident" id="5870732">StructT</span>&nbsp;<span class="op" id="5870740">!=</span>&nbsp;<span class="builtintype" id="5870743">nil</span>&nbsp;<span class="op" id="5870747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870751">dec</span><span class="op" id="5870754">.</span><span class="ident" id="5870755">ignoreStruct</span><span class="op" id="5870767">(</span><span class="op" id="5870768">*</span><span class="ident" id="5870769">enginePtr</span><span class="op" id="5870778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5870781">}</span>&nbsp;<span class="keyword" id="5870783">else</span>&nbsp;<span class="op" id="5870788">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870792">dec</span><span class="op" id="5870795">.</span><span class="ident" id="5870796">ignoreSingle</span><span class="op" id="5870808">(</span><span class="op" id="5870809">*</span><span class="ident" id="5870810">enginePtr</span><span class="op" id="5870819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5870822">}</span><br>
<span class="lineno"></span><span class="op" id="5870824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5870827">func</span>&nbsp;<span class="ident" id="5870832">init</span><span class="op" id="5870836">(</span><span class="op" id="5870837">)</span>&nbsp;<span class="op" id="5870839">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870842">var</span>&nbsp;<span class="ident" id="5870846">iop</span><span class="op" id="5870849">,</span>&nbsp;<span class="ident" id="5870851">uop</span>&nbsp;<span class="ident" id="5870855">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870862">switch</span>&nbsp;<span class="ident" id="5870869">reflect</span><span class="op" id="5870876">.</span><span class="ident" id="5870877">TypeOf</span><span class="op" id="5870883">(</span><span class="builtintype" id="5870884">int</span><span class="op" id="5870887">(</span><span class="num" id="5870888">0</span><span class="op" id="5870889">)</span><span class="op" id="5870890">)</span><span class="op" id="5870891">.</span><span class="ident" id="5870892">Bits</span><span class="op" id="5870896">(</span><span class="op" id="5870897">)</span>&nbsp;<span class="op" id="5870899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870902">case</span>&nbsp;<span class="num" id="5870907">32</span><span class="op" id="5870909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870913">iop</span>&nbsp;<span class="op" id="5870917">=</span>&nbsp;<span class="ident" id="5870919">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870930">uop</span>&nbsp;<span class="op" id="5870934">=</span>&nbsp;<span class="ident" id="5870936">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870947">case</span>&nbsp;<span class="num" id="5870952">64</span><span class="op" id="5870954">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870958">iop</span>&nbsp;<span class="op" id="5870962">=</span>&nbsp;<span class="ident" id="5870964">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5870975">uop</span>&nbsp;<span class="op" id="5870979">=</span>&nbsp;<span class="ident" id="5870981">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5870992">default</span><span class="op" id="5870999">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5871003">panic</span><span class="op" id="5871008">(</span><span class="string" id="5871009">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="5871040">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5871043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5871046">decOpTable</span><span class="op" id="5871056">[</span><span class="ident" id="5871057">reflect</span><span class="op" id="5871064">.</span><span class="ident" id="5871065">Int</span><span class="op" id="5871068">]</span>&nbsp;<span class="op" id="5871070">=</span>&nbsp;<span class="ident" id="5871072">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5871077">decOpTable</span><span class="op" id="5871087">[</span><span class="ident" id="5871088">reflect</span><span class="op" id="5871095">.</span><span class="ident" id="5871096">Uint</span><span class="op" id="5871100">]</span>&nbsp;<span class="op" id="5871102">=</span>&nbsp;<span class="ident" id="5871104">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5871110">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5871130">switch</span>&nbsp;<span class="ident" id="5871137">reflect</span><span class="op" id="5871144">.</span><span class="ident" id="5871145">TypeOf</span><span class="op" id="5871151">(</span><span class="builtintype" id="5871152">uintptr</span><span class="op" id="5871159">(</span><span class="num" id="5871160">0</span><span class="op" id="5871161">)</span><span class="op" id="5871162">)</span><span class="op" id="5871163">.</span><span class="ident" id="5871164">Bits</span><span class="op" id="5871168">(</span><span class="op" id="5871169">)</span>&nbsp;<span class="op" id="5871171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5871174">case</span>&nbsp;<span class="num" id="5871179">32</span><span class="op" id="5871181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5871185">uop</span>&nbsp;<span class="op" id="5871189">=</span>&nbsp;<span class="ident" id="5871191">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5871202">case</span>&nbsp;<span class="num" id="5871207">64</span><span class="op" id="5871209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5871213">uop</span>&nbsp;<span class="op" id="5871217">=</span>&nbsp;<span class="ident" id="5871219">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5871230">default</span><span class="op" id="5871237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5871241">panic</span><span class="op" id="5871246">(</span><span class="string" id="5871247">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="5871277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5871280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5871283">decOpTable</span><span class="op" id="5871293">[</span><span class="ident" id="5871294">reflect</span><span class="op" id="5871301">.</span><span class="ident" id="5871302">Uintptr</span><span class="op" id="5871309">]</span>&nbsp;<span class="op" id="5871311">=</span>&nbsp;<span class="ident" id="5871313">uop</span><br>
<span class="lineno"></span><span class="op" id="5871317">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="5871320">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="5871369">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5871429">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="5871462">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="5871491">func</span>&nbsp;<span class="ident" id="5871496">allocValue</span><span class="op" id="5871506">(</span><span class="ident" id="5871507">t</span>&nbsp;<span class="ident" id="5871509">reflect</span><span class="op" id="5871516">.</span><span class="ident" id="5871517">Type</span><span class="op" id="5871521">)</span>&nbsp;<span class="ident" id="5871523">reflect</span><span class="op" id="5871530">.</span><span class="ident" id="5871531">Value</span>&nbsp;<span class="op" id="5871537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5871540">return</span>&nbsp;<span class="ident" id="5871547">reflect</span><span class="op" id="5871554">.</span><span class="ident" id="5871555">New</span><span class="op" id="5871558">(</span><span class="ident" id="5871559">t</span><span class="op" id="5871560">)</span><span class="op" id="5871561">.</span><span class="ident" id="5871562">Elem</span><span class="op" id="5871566">(</span><span class="op" id="5871567">)</span><br>
<span class="lineno"></span><span class="op" id="5871569">}</span>
</div>
</body>
</html>
