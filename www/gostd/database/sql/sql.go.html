<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>database/sql</h2>
<ul>
<li><a href="/gostd/database/sql/convert.go.html">convert.go</a></li>
<li><a href="/gostd/database/sql/convert_test.go.html">convert_test.go</a></li>
<li><a href="/gostd/database/sql/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/database/sql/fakedb_test.go.html">fakedb_test.go</a></li>
<li><a href="/gostd/database/sql/sql.go.html" class="current">sql.go</a></li>
<li><a href="/gostd/database/sql/sql_test.go.html">sql_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5201579">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5201634">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5201688">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5201739">//&nbsp;Package&nbsp;sql&nbsp;provides&nbsp;a&nbsp;generic&nbsp;interface&nbsp;around&nbsp;SQL&nbsp;(or&nbsp;SQL-like)</span><br>
<span class="lineno"></span><span class="comment" id="5201808">//&nbsp;databases.</span><br>
<span class="lineno"></span><span class="comment" id="5201822">//</span><br>
<span class="lineno"></span><span class="comment" id="5201825">//&nbsp;The&nbsp;sql&nbsp;package&nbsp;must&nbsp;be&nbsp;used&nbsp;in&nbsp;conjunction&nbsp;with&nbsp;a&nbsp;database&nbsp;driver.</span><br>
<span class="lineno"></span><span class="comment" id="5201896">//&nbsp;See&nbsp;http://golang.org/s/sqldrivers&nbsp;for&nbsp;a&nbsp;list&nbsp;of&nbsp;drivers.</span><br>
<span class="lineno">10</span><span class="comment" id="5201957">//</span><br>
<span class="lineno"></span><span class="comment" id="5201960">//&nbsp;For&nbsp;more&nbsp;usage&nbsp;examples,&nbsp;see&nbsp;the&nbsp;wiki&nbsp;page&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="5202009">//&nbsp;http://golang.org/s/sqlwiki.</span><br>
<span class="lineno"></span><span class="keyword" id="5202041">package</span>&nbsp;<span class="ident" id="5202049">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5202054">import</span>&nbsp;<span class="op" id="5202061">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202064">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202087">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202097">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202104">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202110">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202121">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5202129">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5202136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5202139">var</span>&nbsp;<span class="ident" id="5202143">drivers</span>&nbsp;<span class="op" id="5202151">=</span>&nbsp;<span class="builtinfunc" id="5202153">make</span><span class="op" id="5202157">(</span><span class="keyword" id="5202158">map</span><span class="op" id="5202161">[</span><span class="builtintype" id="5202162">string</span><span class="op" id="5202168">]</span><span class="ident" id="5202169"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5202175">.</span><span class="ident" id="5202176"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span><span class="op" id="5202182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5202185">//&nbsp;Register&nbsp;makes&nbsp;a&nbsp;database&nbsp;driver&nbsp;available&nbsp;by&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="5202253">//&nbsp;If&nbsp;Register&nbsp;is&nbsp;called&nbsp;twice&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;or&nbsp;if&nbsp;driver&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="5202324">//&nbsp;it&nbsp;panics.</span><br>
<span class="lineno">30</span><span class="keyword" id="5202338">func</span>&nbsp;<span class="ident" id="5202343">Register</span><span class="op" id="5202351">(</span><span class="ident" id="5202352">name</span>&nbsp;<span class="builtintype" id="5202357">string</span><span class="op" id="5202363">,</span>&nbsp;<span class="ident" id="5202365">driver</span>&nbsp;<span class="ident" id="5202372"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5202378">.</span><span class="ident" id="5202379"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span><span class="op" id="5202385">)</span>&nbsp;<span class="op" id="5202387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202390">if</span>&nbsp;<span class="ident" id="5202393"><a href="/gostd/database/sql/sql.go.html#5202365">driver</a></span>&nbsp;<span class="op" id="5202400">==</span>&nbsp;<span class="builtintype" id="5202403">nil</span>&nbsp;<span class="op" id="5202407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5202411">panic</span><span class="op" id="5202416">(</span><span class="string" id="5202417">&#34;sql:&nbsp;Register&nbsp;driver&nbsp;is&nbsp;nil&#34;</span><span class="op" id="5202446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202452">if</span>&nbsp;<span class="ident" id="5202455">_</span><span class="op" id="5202456">,</span>&nbsp;<span class="ident" id="5202458">dup</span>&nbsp;<span class="op" id="5202462">:=</span>&nbsp;<span class="ident" id="5202465"><a href="/gostd/database/sql/sql.go.html#5202143">drivers</a></span><span class="op" id="5202472">[</span><span class="ident" id="5202473"><a href="/gostd/database/sql/sql.go.html#5202352">name</a></span><span class="op" id="5202477">]</span><span class="op" id="5202478">;</span>&nbsp;<span class="ident" id="5202480"><a href="/gostd/database/sql/sql.go.html#5202458">dup</a></span>&nbsp;<span class="op" id="5202484">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5202488">panic</span><span class="op" id="5202493">(</span><span class="string" id="5202494">&#34;sql:&nbsp;Register&nbsp;called&nbsp;twice&nbsp;for&nbsp;driver&nbsp;&#34;</span>&nbsp;<span class="op" id="5202535">+</span>&nbsp;<span class="ident" id="5202537"><a href="/gostd/database/sql/sql.go.html#5202352">name</a></span><span class="op" id="5202541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202547"><a href="/gostd/database/sql/sql.go.html#5202143">drivers</a></span><span class="op" id="5202554">[</span><span class="ident" id="5202555"><a href="/gostd/database/sql/sql.go.html#5202352">name</a></span><span class="op" id="5202559">]</span>&nbsp;<span class="op" id="5202561">=</span>&nbsp;<span class="ident" id="5202563"><a href="/gostd/database/sql/sql.go.html#5202365">driver</a></span><br>
<span class="lineno"></span><span class="op" id="5202570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="5202573">func</span>&nbsp;<span class="ident" id="5202578">unregisterAllDrivers</span><span class="op" id="5202598">(</span><span class="op" id="5202599">)</span>&nbsp;<span class="op" id="5202601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5202604">//&nbsp;For&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202619"><a href="/gostd/database/sql/sql.go.html#5202143">drivers</a></span>&nbsp;<span class="op" id="5202627">=</span>&nbsp;<span class="builtinfunc" id="5202629">make</span><span class="op" id="5202633">(</span><span class="keyword" id="5202634">map</span><span class="op" id="5202637">[</span><span class="builtintype" id="5202638">string</span><span class="op" id="5202644">]</span><span class="ident" id="5202645"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5202651">.</span><span class="ident" id="5202652"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span><span class="op" id="5202658">)</span><br>
<span class="lineno"></span><span class="op" id="5202660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5202663">//&nbsp;Drivers&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;registered&nbsp;drivers.</span><br>
<span class="lineno"></span><span class="keyword" id="5202736">func</span>&nbsp;<span class="ident" id="5202741">Drivers</span><span class="op" id="5202748">(</span><span class="op" id="5202749">)</span>&nbsp;<span class="op" id="5202751">[</span><span class="op" id="5202752">]</span><span class="builtintype" id="5202753">string</span>&nbsp;<span class="op" id="5202760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202763">var</span>&nbsp;<span class="ident" id="5202767">list</span>&nbsp;<span class="op" id="5202772">[</span><span class="op" id="5202773">]</span><span class="builtintype" id="5202774">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202782">for</span>&nbsp;<span class="ident" id="5202786">name</span>&nbsp;<span class="op" id="5202791">:=</span>&nbsp;<span class="keyword" id="5202794">range</span>&nbsp;<span class="ident" id="5202800"><a href="/gostd/database/sql/sql.go.html#5202143">drivers</a></span>&nbsp;<span class="op" id="5202808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202812"><a href="/gostd/database/sql/sql.go.html#5202767">list</a></span>&nbsp;<span class="op" id="5202817">=</span>&nbsp;<span class="builtinfunc" id="5202819">append</span><span class="op" id="5202825">(</span><span class="ident" id="5202826"><a href="/gostd/database/sql/sql.go.html#5202767">list</a></span><span class="op" id="5202830">,</span>&nbsp;<span class="ident" id="5202832"><a href="/gostd/database/sql/sql.go.html#5202786">name</a></span><span class="op" id="5202836">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5202839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5202842"><a href="/gostd/database/sql/sql.go.html#5202121">sort</a></span><span class="op" id="5202846">.</span><span class="ident" id="5202847"><a href="/gostd/sort/sort.go.html#2017831">Strings</a></span><span class="op" id="5202854">(</span><span class="ident" id="5202855"><a href="/gostd/database/sql/sql.go.html#5202767">list</a></span><span class="op" id="5202859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5202862">return</span>&nbsp;<span class="ident" id="5202869"><a href="/gostd/database/sql/sql.go.html#5202767">list</a></span><br>
<span class="lineno"></span><span class="op" id="5202874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5202877">//&nbsp;RawBytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;slice&nbsp;that&nbsp;holds&nbsp;a&nbsp;reference&nbsp;to&nbsp;memory&nbsp;owned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5202947">//&nbsp;the&nbsp;database&nbsp;itself.&nbsp;After&nbsp;a&nbsp;Scan&nbsp;into&nbsp;a&nbsp;RawBytes,&nbsp;the&nbsp;slice&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="5203019">//&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Next,&nbsp;Scan,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5203073">type</span>&nbsp;<span class="ident" id="5203078">RawBytes</span>&nbsp;<span class="op" id="5203087">[</span><span class="op" id="5203088">]</span><span class="builtintype" id="5203089">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5203095">//&nbsp;NullString&nbsp;represents&nbsp;a&nbsp;string&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5203147">//&nbsp;NullString&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5203197">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination:</span><br>
<span class="lineno"></span><span class="comment" id="5203238">//</span><br>
<span class="lineno"></span><span class="comment" id="5203241">//&nbsp;&nbsp;var&nbsp;s&nbsp;NullString</span><br>
<span class="lineno">65</span><span class="comment" id="5203262">//&nbsp;&nbsp;err&nbsp;:=&nbsp;db.QueryRow(&#34;SELECT&nbsp;name&nbsp;FROM&nbsp;foo&nbsp;WHERE&nbsp;id=?&#34;,&nbsp;id).Scan(&amp;s)</span><br>
<span class="lineno"></span><span class="comment" id="5203333">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5203341">//&nbsp;&nbsp;if&nbsp;s.Valid&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5203358">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;use&nbsp;s.String</span><br>
<span class="lineno"></span><span class="comment" id="5203381">//&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="5203394">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;NULL&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5203415">//&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5203421">//</span><br>
<span class="lineno"></span><span class="keyword" id="5203424">type</span>&nbsp;<span class="ident" id="5203429">NullString</span>&nbsp;<span class="keyword" id="5203440">struct</span>&nbsp;<span class="op" id="5203447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203450">String</span>&nbsp;<span class="builtintype" id="5203457">string</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203465">Valid</span>&nbsp;&nbsp;<span class="builtintype" id="5203472">bool</span>&nbsp;<span class="comment" id="5203477">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;String&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5203516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203519">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5203561">func</span>&nbsp;<span class="op" id="5203566">(</span><span class="ident" id="5203567">ns</span>&nbsp;<span class="op" id="5203570">*</span><span class="ident" id="5203571"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="5203581">)</span>&nbsp;<span class="ident" id="5203583">Scan</span><span class="op" id="5203587">(</span><span class="ident" id="5203588">value</span>&nbsp;<span class="keyword" id="5203594">interface</span><span class="op" id="5203603">{</span><span class="op" id="5203604">}</span><span class="op" id="5203605">)</span>&nbsp;<span class="builtintype" id="5203607">error</span>&nbsp;<span class="op" id="5203613">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203616">if</span>&nbsp;<span class="ident" id="5203619"><a href="/gostd/database/sql/sql.go.html#5203588">value</a></span>&nbsp;<span class="op" id="5203625">==</span>&nbsp;<span class="builtintype" id="5203628">nil</span>&nbsp;<span class="op" id="5203632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203636"><a href="/gostd/database/sql/sql.go.html#5203567">ns</a></span><span class="op" id="5203638">.</span><span class="ident" id="5203639"><a href="/gostd/database/sql/sql.go.html#5203450">String</a></span><span class="op" id="5203645">,</span>&nbsp;<span class="ident" id="5203647"><a href="/gostd/database/sql/sql.go.html#5203567">ns</a></span><span class="op" id="5203649">.</span><span class="ident" id="5203650"><a href="/gostd/database/sql/sql.go.html#5203465">Valid</a></span>&nbsp;<span class="op" id="5203656">=</span>&nbsp;<span class="string" id="5203658">&#34;&#34;</span><span class="op" id="5203660">,</span>&nbsp;<span class="builtintype" id="5203662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203670">return</span>&nbsp;<span class="builtintype" id="5203677">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5203685"><a href="/gostd/database/sql/sql.go.html#5203567">ns</a></span><span class="op" id="5203687">.</span><span class="ident" id="5203688"><a href="/gostd/database/sql/sql.go.html#5203465">Valid</a></span>&nbsp;<span class="op" id="5203694">=</span>&nbsp;<span class="builtintype" id="5203696">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203702">return</span>&nbsp;<span class="ident" id="5203709"><a href="/gostd/database/sql/convert.go.html#5196804">convertAssign</a></span><span class="op" id="5203722">(</span><span class="op" id="5203723">&amp;</span><span class="ident" id="5203724"><a href="/gostd/database/sql/sql.go.html#5203567">ns</a></span><span class="op" id="5203726">.</span><span class="ident" id="5203727"><a href="/gostd/database/sql/sql.go.html#5203450">String</a></span><span class="op" id="5203733">,</span>&nbsp;<span class="ident" id="5203735"><a href="/gostd/database/sql/sql.go.html#5203588">value</a></span><span class="op" id="5203740">)</span><br>
<span class="lineno"></span><span class="op" id="5203742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5203745">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5203794">func</span>&nbsp;<span class="op" id="5203799">(</span><span class="ident" id="5203800">ns</span>&nbsp;<span class="ident" id="5203803"><a href="/gostd/database/sql/sql.go.html#5203429">NullString</a></span><span class="op" id="5203813">)</span>&nbsp;<span class="ident" id="5203815">Value</span><span class="op" id="5203820">(</span><span class="op" id="5203821">)</span>&nbsp;<span class="op" id="5203823">(</span><span class="ident" id="5203824"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5203830">.</span><span class="ident" id="5203831"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="5203836">,</span>&nbsp;<span class="builtintype" id="5203838">error</span><span class="op" id="5203843">)</span>&nbsp;<span class="op" id="5203845">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203848">if</span>&nbsp;<span class="op" id="5203851">!</span><span class="ident" id="5203852"><a href="/gostd/database/sql/sql.go.html#5203800">ns</a></span><span class="op" id="5203854">.</span><span class="ident" id="5203855"><a href="/gostd/database/sql/sql.go.html#5203465">Valid</a></span>&nbsp;<span class="op" id="5203861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203865">return</span>&nbsp;<span class="builtintype" id="5203872">nil</span><span class="op" id="5203875">,</span>&nbsp;<span class="builtintype" id="5203877">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5203882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5203885">return</span>&nbsp;<span class="ident" id="5203892"><a href="/gostd/database/sql/sql.go.html#5203800">ns</a></span><span class="op" id="5203894">.</span><span class="ident" id="5203895"><a href="/gostd/database/sql/sql.go.html#5203450">String</a></span><span class="op" id="5203901">,</span>&nbsp;<span class="builtintype" id="5203903">nil</span><br>
<span class="lineno"></span><span class="op" id="5203907">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="5203910">//&nbsp;NullInt64&nbsp;represents&nbsp;an&nbsp;int64&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5203961">//&nbsp;NullInt64&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5204010">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno"></span><span class="keyword" id="5204074">type</span>&nbsp;<span class="ident" id="5204079">NullInt64</span>&nbsp;<span class="keyword" id="5204089">struct</span>&nbsp;<span class="op" id="5204096">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204099">Int64</span>&nbsp;<span class="builtintype" id="5204105">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204112">Valid</span>&nbsp;<span class="builtintype" id="5204118">bool</span>&nbsp;<span class="comment" id="5204123">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Int64&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5204161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5204164">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno">105</span><span class="keyword" id="5204206">func</span>&nbsp;<span class="op" id="5204211">(</span><span class="ident" id="5204212">n</span>&nbsp;<span class="op" id="5204214">*</span><span class="ident" id="5204215"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="5204224">)</span>&nbsp;<span class="ident" id="5204226">Scan</span><span class="op" id="5204230">(</span><span class="ident" id="5204231">value</span>&nbsp;<span class="keyword" id="5204237">interface</span><span class="op" id="5204246">{</span><span class="op" id="5204247">}</span><span class="op" id="5204248">)</span>&nbsp;<span class="builtintype" id="5204250">error</span>&nbsp;<span class="op" id="5204256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204259">if</span>&nbsp;<span class="ident" id="5204262"><a href="/gostd/database/sql/sql.go.html#5204231">value</a></span>&nbsp;<span class="op" id="5204268">==</span>&nbsp;<span class="builtintype" id="5204271">nil</span>&nbsp;<span class="op" id="5204275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204279"><a href="/gostd/database/sql/sql.go.html#5204212">n</a></span><span class="op" id="5204280">.</span><span class="ident" id="5204281"><a href="/gostd/database/sql/sql.go.html#5204099">Int64</a></span><span class="op" id="5204286">,</span>&nbsp;<span class="ident" id="5204288"><a href="/gostd/database/sql/sql.go.html#5204212">n</a></span><span class="op" id="5204289">.</span><span class="ident" id="5204290"><a href="/gostd/database/sql/sql.go.html#5204112">Valid</a></span>&nbsp;<span class="op" id="5204296">=</span>&nbsp;<span class="num" id="5204298">0</span><span class="op" id="5204299">,</span>&nbsp;<span class="builtintype" id="5204301">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204309">return</span>&nbsp;<span class="builtintype" id="5204316">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204321">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204324"><a href="/gostd/database/sql/sql.go.html#5204212">n</a></span><span class="op" id="5204325">.</span><span class="ident" id="5204326"><a href="/gostd/database/sql/sql.go.html#5204112">Valid</a></span>&nbsp;<span class="op" id="5204332">=</span>&nbsp;<span class="builtintype" id="5204334">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204340">return</span>&nbsp;<span class="ident" id="5204347"><a href="/gostd/database/sql/convert.go.html#5196804">convertAssign</a></span><span class="op" id="5204360">(</span><span class="op" id="5204361">&amp;</span><span class="ident" id="5204362"><a href="/gostd/database/sql/sql.go.html#5204212">n</a></span><span class="op" id="5204363">.</span><span class="ident" id="5204364"><a href="/gostd/database/sql/sql.go.html#5204099">Int64</a></span><span class="op" id="5204369">,</span>&nbsp;<span class="ident" id="5204371"><a href="/gostd/database/sql/sql.go.html#5204231">value</a></span><span class="op" id="5204376">)</span><br>
<span class="lineno"></span><span class="op" id="5204378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5204381">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno">115</span><span class="keyword" id="5204430">func</span>&nbsp;<span class="op" id="5204435">(</span><span class="ident" id="5204436">n</span>&nbsp;<span class="ident" id="5204438"><a href="/gostd/database/sql/sql.go.html#5204079">NullInt64</a></span><span class="op" id="5204447">)</span>&nbsp;<span class="ident" id="5204449">Value</span><span class="op" id="5204454">(</span><span class="op" id="5204455">)</span>&nbsp;<span class="op" id="5204457">(</span><span class="ident" id="5204458"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5204464">.</span><span class="ident" id="5204465"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="5204470">,</span>&nbsp;<span class="builtintype" id="5204472">error</span><span class="op" id="5204477">)</span>&nbsp;<span class="op" id="5204479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204482">if</span>&nbsp;<span class="op" id="5204485">!</span><span class="ident" id="5204486"><a href="/gostd/database/sql/sql.go.html#5204436">n</a></span><span class="op" id="5204487">.</span><span class="ident" id="5204488"><a href="/gostd/database/sql/sql.go.html#5204112">Valid</a></span>&nbsp;<span class="op" id="5204494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204498">return</span>&nbsp;<span class="builtintype" id="5204505">nil</span><span class="op" id="5204508">,</span>&nbsp;<span class="builtintype" id="5204510">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204518">return</span>&nbsp;<span class="ident" id="5204525"><a href="/gostd/database/sql/sql.go.html#5204436">n</a></span><span class="op" id="5204526">.</span><span class="ident" id="5204527"><a href="/gostd/database/sql/sql.go.html#5204099">Int64</a></span><span class="op" id="5204532">,</span>&nbsp;<span class="builtintype" id="5204534">nil</span><br>
<span class="lineno">120</span><span class="op" id="5204538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5204541">//&nbsp;NullFloat64&nbsp;represents&nbsp;a&nbsp;float64&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5204595">//&nbsp;NullFloat64&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5204646">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno">125</span><span class="keyword" id="5204710">type</span>&nbsp;<span class="ident" id="5204715">NullFloat64</span>&nbsp;<span class="keyword" id="5204727">struct</span>&nbsp;<span class="op" id="5204734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204737">Float64</span>&nbsp;<span class="builtintype" id="5204745">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204754">Valid</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5204762">bool</span>&nbsp;<span class="comment" id="5204767">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Float64&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5204807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5204810">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5204852">func</span>&nbsp;<span class="op" id="5204857">(</span><span class="ident" id="5204858">n</span>&nbsp;<span class="op" id="5204860">*</span><span class="ident" id="5204861"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="5204872">)</span>&nbsp;<span class="ident" id="5204874">Scan</span><span class="op" id="5204878">(</span><span class="ident" id="5204879">value</span>&nbsp;<span class="keyword" id="5204885">interface</span><span class="op" id="5204894">{</span><span class="op" id="5204895">}</span><span class="op" id="5204896">)</span>&nbsp;<span class="builtintype" id="5204898">error</span>&nbsp;<span class="op" id="5204904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204907">if</span>&nbsp;<span class="ident" id="5204910"><a href="/gostd/database/sql/sql.go.html#5204879">value</a></span>&nbsp;<span class="op" id="5204916">==</span>&nbsp;<span class="builtintype" id="5204919">nil</span>&nbsp;<span class="op" id="5204923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204927"><a href="/gostd/database/sql/sql.go.html#5204858">n</a></span><span class="op" id="5204928">.</span><span class="ident" id="5204929"><a href="/gostd/database/sql/sql.go.html#5204737">Float64</a></span><span class="op" id="5204936">,</span>&nbsp;<span class="ident" id="5204938"><a href="/gostd/database/sql/sql.go.html#5204858">n</a></span><span class="op" id="5204939">.</span><span class="ident" id="5204940"><a href="/gostd/database/sql/sql.go.html#5204754">Valid</a></span>&nbsp;<span class="op" id="5204946">=</span>&nbsp;<span class="num" id="5204948">0</span><span class="op" id="5204949">,</span>&nbsp;<span class="builtintype" id="5204951">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204959">return</span>&nbsp;<span class="builtintype" id="5204966">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5204971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5204974"><a href="/gostd/database/sql/sql.go.html#5204858">n</a></span><span class="op" id="5204975">.</span><span class="ident" id="5204976"><a href="/gostd/database/sql/sql.go.html#5204754">Valid</a></span>&nbsp;<span class="op" id="5204982">=</span>&nbsp;<span class="builtintype" id="5204984">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5204990">return</span>&nbsp;<span class="ident" id="5204997"><a href="/gostd/database/sql/convert.go.html#5196804">convertAssign</a></span><span class="op" id="5205010">(</span><span class="op" id="5205011">&amp;</span><span class="ident" id="5205012"><a href="/gostd/database/sql/sql.go.html#5204858">n</a></span><span class="op" id="5205013">.</span><span class="ident" id="5205014"><a href="/gostd/database/sql/sql.go.html#5204737">Float64</a></span><span class="op" id="5205021">,</span>&nbsp;<span class="ident" id="5205023"><a href="/gostd/database/sql/sql.go.html#5204879">value</a></span><span class="op" id="5205028">)</span><br>
<span class="lineno"></span><span class="op" id="5205030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="5205033">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5205082">func</span>&nbsp;<span class="op" id="5205087">(</span><span class="ident" id="5205088">n</span>&nbsp;<span class="ident" id="5205090"><a href="/gostd/database/sql/sql.go.html#5204715">NullFloat64</a></span><span class="op" id="5205101">)</span>&nbsp;<span class="ident" id="5205103">Value</span><span class="op" id="5205108">(</span><span class="op" id="5205109">)</span>&nbsp;<span class="op" id="5205111">(</span><span class="ident" id="5205112"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5205118">.</span><span class="ident" id="5205119"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="5205124">,</span>&nbsp;<span class="builtintype" id="5205126">error</span><span class="op" id="5205131">)</span>&nbsp;<span class="op" id="5205133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205136">if</span>&nbsp;<span class="op" id="5205139">!</span><span class="ident" id="5205140"><a href="/gostd/database/sql/sql.go.html#5205088">n</a></span><span class="op" id="5205141">.</span><span class="ident" id="5205142"><a href="/gostd/database/sql/sql.go.html#5204754">Valid</a></span>&nbsp;<span class="op" id="5205148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205152">return</span>&nbsp;<span class="builtintype" id="5205159">nil</span><span class="op" id="5205162">,</span>&nbsp;<span class="builtintype" id="5205164">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205169">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205172">return</span>&nbsp;<span class="ident" id="5205179"><a href="/gostd/database/sql/sql.go.html#5205088">n</a></span><span class="op" id="5205180">.</span><span class="ident" id="5205181"><a href="/gostd/database/sql/sql.go.html#5204737">Float64</a></span><span class="op" id="5205188">,</span>&nbsp;<span class="builtintype" id="5205190">nil</span><br>
<span class="lineno"></span><span class="op" id="5205194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205197">//&nbsp;NullBool&nbsp;represents&nbsp;a&nbsp;bool&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="5205245">//&nbsp;NullBool&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno">150</span><span class="comment" id="5205293">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno"></span><span class="keyword" id="5205357">type</span>&nbsp;<span class="ident" id="5205362">NullBool</span>&nbsp;<span class="keyword" id="5205371">struct</span>&nbsp;<span class="op" id="5205378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205381">Bool</span>&nbsp;&nbsp;<span class="builtintype" id="5205387">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205393">Valid</span>&nbsp;<span class="builtintype" id="5205399">bool</span>&nbsp;<span class="comment" id="5205404">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Bool&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="5205441">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="5205444">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5205486">func</span>&nbsp;<span class="op" id="5205491">(</span><span class="ident" id="5205492">n</span>&nbsp;<span class="op" id="5205494">*</span><span class="ident" id="5205495"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="5205503">)</span>&nbsp;<span class="ident" id="5205505">Scan</span><span class="op" id="5205509">(</span><span class="ident" id="5205510">value</span>&nbsp;<span class="keyword" id="5205516">interface</span><span class="op" id="5205525">{</span><span class="op" id="5205526">}</span><span class="op" id="5205527">)</span>&nbsp;<span class="builtintype" id="5205529">error</span>&nbsp;<span class="op" id="5205535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205538">if</span>&nbsp;<span class="ident" id="5205541"><a href="/gostd/database/sql/sql.go.html#5205510">value</a></span>&nbsp;<span class="op" id="5205547">==</span>&nbsp;<span class="builtintype" id="5205550">nil</span>&nbsp;<span class="op" id="5205554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205558"><a href="/gostd/database/sql/sql.go.html#5205492">n</a></span><span class="op" id="5205559">.</span><span class="ident" id="5205560"><a href="/gostd/database/sql/sql.go.html#5205381">Bool</a></span><span class="op" id="5205564">,</span>&nbsp;<span class="ident" id="5205566"><a href="/gostd/database/sql/sql.go.html#5205492">n</a></span><span class="op" id="5205567">.</span><span class="ident" id="5205568"><a href="/gostd/database/sql/sql.go.html#5205393">Valid</a></span>&nbsp;<span class="op" id="5205574">=</span>&nbsp;<span class="builtintype" id="5205576">false</span><span class="op" id="5205581">,</span>&nbsp;<span class="builtintype" id="5205583">false</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205591">return</span>&nbsp;<span class="builtintype" id="5205598">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5205606"><a href="/gostd/database/sql/sql.go.html#5205492">n</a></span><span class="op" id="5205607">.</span><span class="ident" id="5205608"><a href="/gostd/database/sql/sql.go.html#5205393">Valid</a></span>&nbsp;<span class="op" id="5205614">=</span>&nbsp;<span class="builtintype" id="5205616">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205622">return</span>&nbsp;<span class="ident" id="5205629"><a href="/gostd/database/sql/convert.go.html#5196804">convertAssign</a></span><span class="op" id="5205642">(</span><span class="op" id="5205643">&amp;</span><span class="ident" id="5205644"><a href="/gostd/database/sql/sql.go.html#5205492">n</a></span><span class="op" id="5205645">.</span><span class="ident" id="5205646"><a href="/gostd/database/sql/sql.go.html#5205381">Bool</a></span><span class="op" id="5205650">,</span>&nbsp;<span class="ident" id="5205652"><a href="/gostd/database/sql/sql.go.html#5205510">value</a></span><span class="op" id="5205657">)</span><br>
<span class="lineno"></span><span class="op" id="5205659">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5205662">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="5205711">func</span>&nbsp;<span class="op" id="5205716">(</span><span class="ident" id="5205717">n</span>&nbsp;<span class="ident" id="5205719"><a href="/gostd/database/sql/sql.go.html#5205362">NullBool</a></span><span class="op" id="5205727">)</span>&nbsp;<span class="ident" id="5205729">Value</span><span class="op" id="5205734">(</span><span class="op" id="5205735">)</span>&nbsp;<span class="op" id="5205737">(</span><span class="ident" id="5205738"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5205744">.</span><span class="ident" id="5205745"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="5205750">,</span>&nbsp;<span class="builtintype" id="5205752">error</span><span class="op" id="5205757">)</span>&nbsp;<span class="op" id="5205759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205762">if</span>&nbsp;<span class="op" id="5205765">!</span><span class="ident" id="5205766"><a href="/gostd/database/sql/sql.go.html#5205717">n</a></span><span class="op" id="5205767">.</span><span class="ident" id="5205768"><a href="/gostd/database/sql/sql.go.html#5205393">Valid</a></span>&nbsp;<span class="op" id="5205774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205778">return</span>&nbsp;<span class="builtintype" id="5205785">nil</span><span class="op" id="5205788">,</span>&nbsp;<span class="builtintype" id="5205790">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5205795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5205798">return</span>&nbsp;<span class="ident" id="5205805"><a href="/gostd/database/sql/sql.go.html#5205717">n</a></span><span class="op" id="5205806">.</span><span class="ident" id="5205807"><a href="/gostd/database/sql/sql.go.html#5205381">Bool</a></span><span class="op" id="5205811">,</span>&nbsp;<span class="builtintype" id="5205813">nil</span><br>
<span class="lineno"></span><span class="op" id="5205817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5205820">//&nbsp;Scanner&nbsp;is&nbsp;an&nbsp;interface&nbsp;used&nbsp;by&nbsp;Scan.</span><br>
<span class="lineno">175</span><span class="keyword" id="5205861">type</span>&nbsp;<span class="ident" id="5205866">Scanner</span>&nbsp;<span class="keyword" id="5205874">interface</span>&nbsp;<span class="op" id="5205884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205887">//&nbsp;Scan&nbsp;assigns&nbsp;a&nbsp;value&nbsp;from&nbsp;a&nbsp;database&nbsp;driver.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205936">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5205940">//&nbsp;The&nbsp;src&nbsp;value&nbsp;will&nbsp;be&nbsp;of&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;restricted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206001">//&nbsp;set&nbsp;of&nbsp;types:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206019">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206023">//&nbsp;&nbsp;&nbsp;&nbsp;int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206036">//&nbsp;&nbsp;&nbsp;&nbsp;float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206051">//&nbsp;&nbsp;&nbsp;&nbsp;bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206063">//&nbsp;&nbsp;&nbsp;&nbsp;[]byte</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206077">//&nbsp;&nbsp;&nbsp;&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206091">//&nbsp;&nbsp;&nbsp;&nbsp;time.Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206108">//&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;-&nbsp;for&nbsp;NULL&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206137">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206141">//&nbsp;An&nbsp;error&nbsp;should&nbsp;be&nbsp;returned&nbsp;if&nbsp;the&nbsp;value&nbsp;can&nbsp;not&nbsp;be&nbsp;stored</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5206204">//&nbsp;without&nbsp;loss&nbsp;of&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5206237">Scan</span><span class="op" id="5206241">(</span><span class="ident" id="5206242">src</span>&nbsp;<span class="keyword" id="5206246">interface</span><span class="op" id="5206255">{</span><span class="op" id="5206256">}</span><span class="op" id="5206257">)</span>&nbsp;<span class="builtintype" id="5206259">error</span><br>
<span class="lineno"></span><span class="op" id="5206265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206268">//&nbsp;ErrNoRows&nbsp;is&nbsp;returned&nbsp;by&nbsp;Scan&nbsp;when&nbsp;QueryRow&nbsp;doesn&#39;t&nbsp;return&nbsp;a</span><br>
<span class="lineno">195</span><span class="comment" id="5206332">//&nbsp;row.&nbsp;In&nbsp;such&nbsp;a&nbsp;case,&nbsp;QueryRow&nbsp;returns&nbsp;a&nbsp;placeholder&nbsp;*Row&nbsp;value&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5206403">//&nbsp;defers&nbsp;this&nbsp;error&nbsp;until&nbsp;a&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="keyword" id="5206438">var</span>&nbsp;<span class="ident" id="5206442">ErrNoRows</span>&nbsp;<span class="op" id="5206452">=</span>&nbsp;<span class="ident" id="5206454"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5206460">.</span><span class="ident" id="5206461"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5206464">(</span><span class="string" id="5206465">&#34;sql:&nbsp;no&nbsp;rows&nbsp;in&nbsp;result&nbsp;set&#34;</span><span class="op" id="5206493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5206496">//&nbsp;DB&nbsp;is&nbsp;a&nbsp;database&nbsp;handle&nbsp;representing&nbsp;a&nbsp;pool&nbsp;of&nbsp;zero&nbsp;or&nbsp;more</span><br>
<span class="lineno">200</span><span class="comment" id="5206559">//&nbsp;underlying&nbsp;connections.&nbsp;It&#39;s&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="5206627">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5206642">//</span><br>
<span class="lineno"></span><span class="comment" id="5206645">//&nbsp;The&nbsp;sql&nbsp;package&nbsp;creates&nbsp;and&nbsp;frees&nbsp;connections&nbsp;automatically;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="5206712">//&nbsp;also&nbsp;maintains&nbsp;a&nbsp;free&nbsp;pool&nbsp;of&nbsp;idle&nbsp;connections.&nbsp;If&nbsp;the&nbsp;database&nbsp;has</span><br>
<span class="lineno">205</span><span class="comment" id="5206783">//&nbsp;a&nbsp;concept&nbsp;of&nbsp;per-connection&nbsp;state,&nbsp;such&nbsp;state&nbsp;can&nbsp;only&nbsp;be&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="5206853">//&nbsp;observed&nbsp;within&nbsp;a&nbsp;transaction.&nbsp;Once&nbsp;DB.Begin&nbsp;is&nbsp;called,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5206916">//&nbsp;returned&nbsp;Tx&nbsp;is&nbsp;bound&nbsp;to&nbsp;a&nbsp;single&nbsp;connection.&nbsp;Once&nbsp;Commit&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="5206979">//&nbsp;Rollback&nbsp;is&nbsp;called&nbsp;on&nbsp;the&nbsp;transaction,&nbsp;that&nbsp;transaction&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5207040">//&nbsp;connection&nbsp;is&nbsp;returned&nbsp;to&nbsp;DB&#39;s&nbsp;idle&nbsp;connection&nbsp;pool.&nbsp;The&nbsp;pool&nbsp;size</span><br>
<span class="lineno">210</span><span class="comment" id="5207110">//&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;SetMaxIdleConns.</span><br>
<span class="lineno"></span><span class="keyword" id="5207153">type</span>&nbsp;<span class="ident" id="5207158">DB</span>&nbsp;<span class="keyword" id="5207161">struct</span>&nbsp;<span class="op" id="5207168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207171">driver</span>&nbsp;<span class="ident" id="5207178"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5207184">.</span><span class="ident" id="5207185"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207193">dsn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5207200">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207209">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207222"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5207226">.</span><span class="ident" id="5207227"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="5207233">//&nbsp;protects&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207263">freeConn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5207276">[</span><span class="op" id="5207277">]</span><span class="op" id="5207278">*</span><span class="ident" id="5207279"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207291">connRequests</span>&nbsp;<span class="op" id="5207304">[</span><span class="op" id="5207305">]</span><span class="keyword" id="5207306">chan</span>&nbsp;<span class="ident" id="5207311"><a href="/gostd/database/sql/sql.go.html#5218261">connRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207324">numOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5207337">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207342">pendingOpens</span>&nbsp;<span class="builtintype" id="5207355">int</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207360">//&nbsp;Used&nbsp;to&nbsp;signal&nbsp;the&nbsp;need&nbsp;for&nbsp;new&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207408">//&nbsp;a&nbsp;goroutine&nbsp;running&nbsp;connectionOpener()&nbsp;reads&nbsp;on&nbsp;this&nbsp;chan&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207474">//&nbsp;maybeOpenNewConnections&nbsp;sends&nbsp;on&nbsp;the&nbsp;chan&nbsp;(one&nbsp;send&nbsp;per&nbsp;needed&nbsp;connection)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207553">//&nbsp;It&nbsp;is&nbsp;closed&nbsp;during&nbsp;db.Close().&nbsp;The&nbsp;close&nbsp;tells&nbsp;the&nbsp;connectionOpener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207626">//&nbsp;goroutine&nbsp;to&nbsp;exit.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207649">openerCh</span>&nbsp;<span class="keyword" id="5207658">chan</span>&nbsp;<span class="keyword" id="5207663">struct</span><span class="op" id="5207669">{</span><span class="op" id="5207670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207673">closed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5207682">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207688">dep</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5207697">map</span><span class="op" id="5207700">[</span><span class="ident" id="5207701"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="5207712">]</span><span class="ident" id="5207713"><a href="/gostd/database/sql/sql.go.html#5210867">depSet</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207721">lastPut</span>&nbsp;&nbsp;<span class="keyword" id="5207730">map</span><span class="op" id="5207733">[</span><span class="op" id="5207734">*</span><span class="ident" id="5207735"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5207745">]</span><span class="builtintype" id="5207746">string</span>&nbsp;<span class="comment" id="5207753">//&nbsp;stacktrace&nbsp;of&nbsp;last&nbsp;conn&#39;s&nbsp;put;&nbsp;debug&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207799">maxIdle</span>&nbsp;&nbsp;<span class="builtintype" id="5207808">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207831">//&nbsp;zero&nbsp;means&nbsp;defaultMaxIdleConns;&nbsp;negative&nbsp;means&nbsp;0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5207884">maxOpen</span>&nbsp;&nbsp;<span class="builtintype" id="5207893">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5207916">//&nbsp;&lt;=&nbsp;0&nbsp;means&nbsp;unlimited</span><br>
<span class="lineno"></span><span class="op" id="5207940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5207943">//&nbsp;driverConn&nbsp;wraps&nbsp;a&nbsp;driver.Conn&nbsp;with&nbsp;a&nbsp;mutex,&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5207994">//&nbsp;be&nbsp;held&nbsp;during&nbsp;all&nbsp;calls&nbsp;into&nbsp;the&nbsp;Conn.&nbsp;(including&nbsp;any&nbsp;calls&nbsp;onto</span><br>
<span class="lineno">235</span><span class="comment" id="5208063">//&nbsp;interfaces&nbsp;returned&nbsp;via&nbsp;that&nbsp;Conn,&nbsp;such&nbsp;as&nbsp;calls&nbsp;on&nbsp;Tx,&nbsp;Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="5208128">//&nbsp;Result,&nbsp;Rows)</span><br>
<span class="lineno"></span><span class="keyword" id="5208145">type</span>&nbsp;<span class="ident" id="5208150">driverConn</span>&nbsp;<span class="keyword" id="5208161">struct</span>&nbsp;<span class="op" id="5208168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208171">db</span>&nbsp;<span class="op" id="5208174">*</span><span class="ident" id="5208175"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208180"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5208184">.</span><span class="ident" id="5208185"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;&nbsp;<span class="comment" id="5208192">//&nbsp;guards&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208213">ci</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208225"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5208231">.</span><span class="ident" id="5208232"><a href="/gostd/database/sql/driver/driver.go.html#5250262">Conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208238">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5208250">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208256">finalClosed</span>&nbsp;<span class="builtintype" id="5208268">bool</span>&nbsp;<span class="comment" id="5208273">//&nbsp;ci.Close&nbsp;has&nbsp;been&nbsp;called</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208302">openStmt</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208314">map</span><span class="op" id="5208317">[</span><span class="ident" id="5208318"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5208324">.</span><span class="ident" id="5208325"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="5208329">]</span><span class="builtintype" id="5208330">bool</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208337">//&nbsp;guarded&nbsp;by&nbsp;db.mu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208358">inUse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5208369">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208375">onPut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5208386">[</span><span class="op" id="5208387">]</span><span class="keyword" id="5208388">func</span><span class="op" id="5208392">(</span><span class="op" id="5208393">)</span>&nbsp;<span class="comment" id="5208395">//&nbsp;code&nbsp;(with&nbsp;db.mu&nbsp;held)&nbsp;run&nbsp;when&nbsp;conn&nbsp;is&nbsp;next&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208453">dbmuClosed</span>&nbsp;<span class="builtintype" id="5208464">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208473">//&nbsp;same&nbsp;as&nbsp;closed,&nbsp;but&nbsp;guarded&nbsp;by&nbsp;db.mu,&nbsp;for&nbsp;connIfFree</span><br>
<span class="lineno">250</span><span class="op" id="5208529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5208532">func</span>&nbsp;<span class="op" id="5208537">(</span><span class="ident" id="5208538">dc</span>&nbsp;<span class="op" id="5208541">*</span><span class="ident" id="5208542"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5208552">)</span>&nbsp;<span class="ident" id="5208554">releaseConn</span><span class="op" id="5208565">(</span><span class="ident" id="5208566">err</span>&nbsp;<span class="builtintype" id="5208570">error</span><span class="op" id="5208575">)</span>&nbsp;<span class="op" id="5208577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208580"><a href="/gostd/database/sql/sql.go.html#5208538">dc</a></span><span class="op" id="5208582">.</span><span class="ident" id="5208583"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5208585">.</span><span class="ident" id="5208586"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5208593">(</span><span class="ident" id="5208594"><a href="/gostd/database/sql/sql.go.html#5208538">dc</a></span><span class="op" id="5208596">,</span>&nbsp;<span class="ident" id="5208598"><a href="/gostd/database/sql/sql.go.html#5208566">err</a></span><span class="op" id="5208601">)</span><br>
<span class="lineno"></span><span class="op" id="5208603">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="5208606">func</span>&nbsp;<span class="op" id="5208611">(</span><span class="ident" id="5208612">dc</span>&nbsp;<span class="op" id="5208615">*</span><span class="ident" id="5208616"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5208626">)</span>&nbsp;<span class="ident" id="5208628">removeOpenStmt</span><span class="op" id="5208642">(</span><span class="ident" id="5208643">si</span>&nbsp;<span class="ident" id="5208646"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5208652">.</span><span class="ident" id="5208653"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="5208657">)</span>&nbsp;<span class="op" id="5208659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208662"><a href="/gostd/database/sql/sql.go.html#5208612">dc</a></span><span class="op" id="5208664">.</span><span class="ident" id="5208665"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5208669">(</span><span class="op" id="5208670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208673">defer</span>&nbsp;<span class="ident" id="5208679"><a href="/gostd/database/sql/sql.go.html#5208612">dc</a></span><span class="op" id="5208681">.</span><span class="ident" id="5208682"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5208688">(</span><span class="op" id="5208689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5208692">delete</span><span class="op" id="5208698">(</span><span class="ident" id="5208699"><a href="/gostd/database/sql/sql.go.html#5208612">dc</a></span><span class="op" id="5208701">.</span><span class="ident" id="5208702"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span><span class="op" id="5208710">,</span>&nbsp;<span class="ident" id="5208712"><a href="/gostd/database/sql/sql.go.html#5208643">si</a></span><span class="op" id="5208714">)</span><br>
<span class="lineno">260</span><span class="op" id="5208716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5208719">func</span>&nbsp;<span class="op" id="5208724">(</span><span class="ident" id="5208725">dc</span>&nbsp;<span class="op" id="5208728">*</span><span class="ident" id="5208729"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5208739">)</span>&nbsp;<span class="ident" id="5208741">prepareLocked</span><span class="op" id="5208754">(</span><span class="ident" id="5208755">query</span>&nbsp;<span class="builtintype" id="5208761">string</span><span class="op" id="5208767">)</span>&nbsp;<span class="op" id="5208769">(</span><span class="ident" id="5208770"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5208776">.</span><span class="ident" id="5208777"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="5208781">,</span>&nbsp;<span class="builtintype" id="5208783">error</span><span class="op" id="5208788">)</span>&nbsp;<span class="op" id="5208790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5208793">si</span><span class="op" id="5208795">,</span>&nbsp;<span class="ident" id="5208797">err</span>&nbsp;<span class="op" id="5208801">:=</span>&nbsp;<span class="ident" id="5208804"><a href="/gostd/database/sql/sql.go.html#5208725">dc</a></span><span class="op" id="5208806">.</span><span class="ident" id="5208807"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5208809">.</span><span class="ident" id="5208810"><a href="/gostd/database/sql/driver/driver.go.html#5250348">Prepare</a></span><span class="op" id="5208817">(</span><span class="ident" id="5208818"><a href="/gostd/database/sql/sql.go.html#5208755">query</a></span><span class="op" id="5208823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5208826">if</span>&nbsp;<span class="ident" id="5208829"><a href="/gostd/database/sql/sql.go.html#5208797">err</a></span>&nbsp;<span class="op" id="5208833">==</span>&nbsp;<span class="builtintype" id="5208836">nil</span>&nbsp;<span class="op" id="5208840">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208844">//&nbsp;Track&nbsp;each&nbsp;driverConn&#39;s&nbsp;open&nbsp;statements,&nbsp;so&nbsp;we&nbsp;can&nbsp;close&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208911">//&nbsp;before&nbsp;closing&nbsp;the&nbsp;conn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208941">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5208946">//&nbsp;TODO(bradfitz):&nbsp;let&nbsp;drivers&nbsp;opt&nbsp;out&nbsp;of&nbsp;caring&nbsp;about</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209003">//&nbsp;stmt&nbsp;closes&nbsp;if&nbsp;the&nbsp;conn&nbsp;is&nbsp;about&nbsp;to&nbsp;close&nbsp;anyway?&nbsp;For&nbsp;now</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209066">//&nbsp;do&nbsp;the&nbsp;safe&nbsp;thing,&nbsp;in&nbsp;case&nbsp;stmts&nbsp;need&nbsp;to&nbsp;be&nbsp;closed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209123">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209128">//&nbsp;TODO(bradfitz):&nbsp;after&nbsp;Go&nbsp;1.2,&nbsp;closing&nbsp;driver.Stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209184">//&nbsp;should&nbsp;be&nbsp;moved&nbsp;to&nbsp;driverStmt,&nbsp;using&nbsp;unique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209233">//&nbsp;*driverStmts&nbsp;everywhere&nbsp;(including&nbsp;from</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209278">//&nbsp;*Stmt.connStmt,&nbsp;instead&nbsp;of&nbsp;returning&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209322">//&nbsp;driver.Stmt),&nbsp;using&nbsp;driverStmt&nbsp;as&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5209371">//&nbsp;everywhere,&nbsp;and&nbsp;making&nbsp;it&nbsp;a&nbsp;finalCloser.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209417">if</span>&nbsp;<span class="ident" id="5209420"><a href="/gostd/database/sql/sql.go.html#5208725">dc</a></span><span class="op" id="5209422">.</span><span class="ident" id="5209423"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span>&nbsp;<span class="op" id="5209432">==</span>&nbsp;<span class="builtintype" id="5209435">nil</span>&nbsp;<span class="op" id="5209439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209444"><a href="/gostd/database/sql/sql.go.html#5208725">dc</a></span><span class="op" id="5209446">.</span><span class="ident" id="5209447"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span>&nbsp;<span class="op" id="5209456">=</span>&nbsp;<span class="builtinfunc" id="5209458">make</span><span class="op" id="5209462">(</span><span class="keyword" id="5209463">map</span><span class="op" id="5209466">[</span><span class="ident" id="5209467"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5209473">.</span><span class="ident" id="5209474"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="5209478">]</span><span class="builtintype" id="5209479">bool</span><span class="op" id="5209483">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209491"><a href="/gostd/database/sql/sql.go.html#5208725">dc</a></span><span class="op" id="5209493">.</span><span class="ident" id="5209494"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span><span class="op" id="5209502">[</span><span class="ident" id="5209503"><a href="/gostd/database/sql/sql.go.html#5208793">si</a></span><span class="op" id="5209505">]</span>&nbsp;<span class="op" id="5209507">=</span>&nbsp;<span class="builtintype" id="5209509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209518">return</span>&nbsp;<span class="ident" id="5209525"><a href="/gostd/database/sql/sql.go.html#5208793">si</a></span><span class="op" id="5209527">,</span>&nbsp;<span class="ident" id="5209529"><a href="/gostd/database/sql/sql.go.html#5208797">err</a></span><br>
<span class="lineno"></span><span class="op" id="5209533">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5209536">//&nbsp;the&nbsp;dc.db&#39;s&nbsp;Mutex&nbsp;is&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5209566">func</span>&nbsp;<span class="op" id="5209571">(</span><span class="ident" id="5209572">dc</span>&nbsp;<span class="op" id="5209575">*</span><span class="ident" id="5209576"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5209586">)</span>&nbsp;<span class="ident" id="5209588">closeDBLocked</span><span class="op" id="5209601">(</span><span class="op" id="5209602">)</span>&nbsp;<span class="keyword" id="5209604">func</span><span class="op" id="5209608">(</span><span class="op" id="5209609">)</span>&nbsp;<span class="builtintype" id="5209611">error</span>&nbsp;<span class="op" id="5209617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209620"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209622">.</span><span class="ident" id="5209623"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5209627">(</span><span class="op" id="5209628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209631">defer</span>&nbsp;<span class="ident" id="5209637"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209639">.</span><span class="ident" id="5209640"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5209646">(</span><span class="op" id="5209647">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209650">if</span>&nbsp;<span class="ident" id="5209653"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209655">.</span><span class="ident" id="5209656"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="5209663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209667">return</span>&nbsp;<span class="keyword" id="5209674">func</span><span class="op" id="5209678">(</span><span class="op" id="5209679">)</span>&nbsp;<span class="builtintype" id="5209681">error</span>&nbsp;<span class="op" id="5209687">{</span>&nbsp;<span class="keyword" id="5209689">return</span>&nbsp;<span class="ident" id="5209696"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5209702">.</span><span class="ident" id="5209703"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5209706">(</span><span class="string" id="5209707">&#34;sql:&nbsp;duplicate&nbsp;driverConn&nbsp;close&#34;</span><span class="op" id="5209740">)</span>&nbsp;<span class="op" id="5209742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209748"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209750">.</span><span class="ident" id="5209751"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="5209758">=</span>&nbsp;<span class="builtintype" id="5209760">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209766">return</span>&nbsp;<span class="ident" id="5209773"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209775">.</span><span class="ident" id="5209776"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5209778">.</span><span class="ident" id="5209779"><a href="/gostd/database/sql/sql.go.html#5212113">removeDepLocked</a></span><span class="op" id="5209794">(</span><span class="ident" id="5209795"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209797">,</span>&nbsp;<span class="ident" id="5209799"><a href="/gostd/database/sql/sql.go.html#5209572">dc</a></span><span class="op" id="5209801">)</span><br>
<span class="lineno">295</span><span class="op" id="5209803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5209806">func</span>&nbsp;<span class="op" id="5209811">(</span><span class="ident" id="5209812">dc</span>&nbsp;<span class="op" id="5209815">*</span><span class="ident" id="5209816"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5209826">)</span>&nbsp;<span class="ident" id="5209828">Close</span><span class="op" id="5209833">(</span><span class="op" id="5209834">)</span>&nbsp;<span class="builtintype" id="5209836">error</span>&nbsp;<span class="op" id="5209842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209845"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5209847">.</span><span class="ident" id="5209848"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5209852">(</span><span class="op" id="5209853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209856">if</span>&nbsp;<span class="ident" id="5209859"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5209861">.</span><span class="ident" id="5209862"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="5209869">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209873"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5209875">.</span><span class="ident" id="5209876"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5209882">(</span><span class="op" id="5209883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5209887">return</span>&nbsp;<span class="ident" id="5209894"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5209900">.</span><span class="ident" id="5209901"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5209904">(</span><span class="string" id="5209905">&#34;sql:&nbsp;duplicate&nbsp;driverConn&nbsp;close&#34;</span><span class="op" id="5209938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5209941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209944"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5209946">.</span><span class="ident" id="5209947"><a href="/gostd/database/sql/sql.go.html#5208238">closed</a></span>&nbsp;<span class="op" id="5209954">=</span>&nbsp;<span class="builtintype" id="5209956">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5209962"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5209964">.</span><span class="ident" id="5209965"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5209971">(</span><span class="op" id="5209972">)</span>&nbsp;<span class="comment" id="5209974">//&nbsp;not&nbsp;defer;&nbsp;removeDep&nbsp;finalClose&nbsp;calls&nbsp;may&nbsp;need&nbsp;to&nbsp;lock</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5210034">//&nbsp;And&nbsp;now&nbsp;updates&nbsp;that&nbsp;require&nbsp;holding&nbsp;dc.mu.Lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210087"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5210089">.</span><span class="ident" id="5210090"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210092">.</span><span class="ident" id="5210093"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5210095">.</span><span class="ident" id="5210096"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5210100">(</span><span class="op" id="5210101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210104"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5210106">.</span><span class="ident" id="5210107"><a href="/gostd/database/sql/sql.go.html#5208453">dbmuClosed</a></span>&nbsp;<span class="op" id="5210118">=</span>&nbsp;<span class="builtintype" id="5210120">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210126">fn</span>&nbsp;<span class="op" id="5210129">:=</span>&nbsp;<span class="ident" id="5210132"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5210134">.</span><span class="ident" id="5210135"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210137">.</span><span class="ident" id="5210138"><a href="/gostd/database/sql/sql.go.html#5212113">removeDepLocked</a></span><span class="op" id="5210153">(</span><span class="ident" id="5210154"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5210156">,</span>&nbsp;<span class="ident" id="5210158"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5210160">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210163"><a href="/gostd/database/sql/sql.go.html#5209812">dc</a></span><span class="op" id="5210165">.</span><span class="ident" id="5210166"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210168">.</span><span class="ident" id="5210169"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5210171">.</span><span class="ident" id="5210172"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5210178">(</span><span class="op" id="5210179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210182">return</span>&nbsp;<span class="ident" id="5210189"><a href="/gostd/database/sql/sql.go.html#5210126">fn</a></span><span class="op" id="5210191">(</span><span class="op" id="5210192">)</span><br>
<span class="lineno"></span><span class="op" id="5210194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5210197">func</span>&nbsp;<span class="op" id="5210202">(</span><span class="ident" id="5210203">dc</span>&nbsp;<span class="op" id="5210206">*</span><span class="ident" id="5210207"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5210217">)</span>&nbsp;<span class="ident" id="5210219">finalClose</span><span class="op" id="5210229">(</span><span class="op" id="5210230">)</span>&nbsp;<span class="builtintype" id="5210232">error</span>&nbsp;<span class="op" id="5210238">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210241"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210243">.</span><span class="ident" id="5210244"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5210248">(</span><span class="op" id="5210249">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210253">for</span>&nbsp;<span class="ident" id="5210257">si</span>&nbsp;<span class="op" id="5210260">:=</span>&nbsp;<span class="keyword" id="5210263">range</span>&nbsp;<span class="ident" id="5210269"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210271">.</span><span class="ident" id="5210272"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span>&nbsp;<span class="op" id="5210281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210285"><a href="/gostd/database/sql/sql.go.html#5210257">si</a></span><span class="op" id="5210287">.</span><span class="ident" id="5210288"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5210293">(</span><span class="op" id="5210294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5210297">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210300"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210302">.</span><span class="ident" id="5210303"><a href="/gostd/database/sql/sql.go.html#5208302">openStmt</a></span>&nbsp;<span class="op" id="5210312">=</span>&nbsp;<span class="builtintype" id="5210314">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210320">err</span>&nbsp;<span class="op" id="5210324">:=</span>&nbsp;<span class="ident" id="5210327"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210329">.</span><span class="ident" id="5210330"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5210332">.</span><span class="ident" id="5210333"><a href="/gostd/database/sql/driver/driver.go.html#5250753">Close</a></span><span class="op" id="5210338">(</span><span class="op" id="5210339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210342"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210344">.</span><span class="ident" id="5210345"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span>&nbsp;<span class="op" id="5210348">=</span>&nbsp;<span class="builtintype" id="5210350">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210355"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210357">.</span><span class="ident" id="5210358"><a href="/gostd/database/sql/sql.go.html#5208256">finalClosed</a></span>&nbsp;<span class="op" id="5210370">=</span>&nbsp;<span class="builtintype" id="5210372">true</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210378"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210380">.</span><span class="ident" id="5210381"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5210387">(</span><span class="op" id="5210388">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210392"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210394">.</span><span class="ident" id="5210395"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210397">.</span><span class="ident" id="5210398"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5210400">.</span><span class="ident" id="5210401"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5210405">(</span><span class="op" id="5210406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210409"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210411">.</span><span class="ident" id="5210412"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210414">.</span><span class="ident" id="5210415"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><span class="op" id="5210422">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210426"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210428">.</span><span class="ident" id="5210429"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210431">.</span><span class="ident" id="5210432"><a href="/gostd/database/sql/sql.go.html#5217157">maybeOpenNewConnections</a></span><span class="op" id="5210455">(</span><span class="op" id="5210456">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210459"><a href="/gostd/database/sql/sql.go.html#5210203">dc</a></span><span class="op" id="5210461">.</span><span class="ident" id="5210462"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5210464">.</span><span class="ident" id="5210465"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5210467">.</span><span class="ident" id="5210468"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5210474">(</span><span class="op" id="5210475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210479">return</span>&nbsp;<span class="ident" id="5210486"><a href="/gostd/database/sql/sql.go.html#5210320">err</a></span><br>
<span class="lineno"></span><span class="op" id="5210490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="5210493">//&nbsp;driverStmt&nbsp;associates&nbsp;a&nbsp;driver.Stmt&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5210541">//&nbsp;*driverConn&nbsp;from&nbsp;which&nbsp;it&nbsp;came,&nbsp;so&nbsp;the&nbsp;driverConn&#39;s&nbsp;lock&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5210608">//&nbsp;held&nbsp;during&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5210630">type</span>&nbsp;<span class="ident" id="5210635">driverStmt</span>&nbsp;<span class="keyword" id="5210646">struct</span>&nbsp;<span class="op" id="5210653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210656"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5210660">.</span><span class="ident" id="5210661"><a href="/gostd/sync/mutex.go.html#1444090">Locker</a></span>&nbsp;<span class="comment" id="5210668">//&nbsp;the&nbsp;*driverConn</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210688">si</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210700"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5210706">.</span><span class="ident" id="5210707"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="5210712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5210715">func</span>&nbsp;<span class="op" id="5210720">(</span><span class="ident" id="5210721">ds</span>&nbsp;<span class="op" id="5210724">*</span><span class="ident" id="5210725"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5210735">)</span>&nbsp;<span class="ident" id="5210737">Close</span><span class="op" id="5210742">(</span><span class="op" id="5210743">)</span>&nbsp;<span class="builtintype" id="5210745">error</span>&nbsp;<span class="op" id="5210751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5210754"><a href="/gostd/database/sql/sql.go.html#5210721">ds</a></span><span class="op" id="5210756">.</span><span class="ident" id="5210757"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5210761">(</span><span class="op" id="5210762">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210765">defer</span>&nbsp;<span class="ident" id="5210771"><a href="/gostd/database/sql/sql.go.html#5210721">ds</a></span><span class="op" id="5210773">.</span><span class="ident" id="5210774"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5210780">(</span><span class="op" id="5210781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5210784">return</span>&nbsp;<span class="ident" id="5210791"><a href="/gostd/database/sql/sql.go.html#5210721">ds</a></span><span class="op" id="5210793">.</span><span class="ident" id="5210794"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5210796">.</span><span class="ident" id="5210797"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5210802">(</span><span class="op" id="5210803">)</span><br>
<span class="lineno"></span><span class="op" id="5210805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5210808">//&nbsp;depSet&nbsp;is&nbsp;a&nbsp;finalCloser&#39;s&nbsp;outstanding&nbsp;dependencies</span><br>
<span class="lineno">350</span><span class="keyword" id="5210862">type</span>&nbsp;<span class="ident" id="5210867">depSet</span>&nbsp;<span class="keyword" id="5210874">map</span><span class="op" id="5210877">[</span><span class="keyword" id="5210878">interface</span><span class="op" id="5210887">{</span><span class="op" id="5210888">}</span><span class="op" id="5210889">]</span><span class="builtintype" id="5210890">bool</span>&nbsp;<span class="comment" id="5210895">//&nbsp;set&nbsp;of&nbsp;true&nbsp;bools</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5210917">//&nbsp;The&nbsp;finalCloser&nbsp;interface&nbsp;is&nbsp;used&nbsp;by&nbsp;(*DB).addDep&nbsp;and&nbsp;related</span><br>
<span class="lineno"></span><span class="comment" id="5210982">//&nbsp;dependency&nbsp;reference&nbsp;counting.</span><br>
<span class="lineno"></span><span class="keyword" id="5211016">type</span>&nbsp;<span class="ident" id="5211021">finalCloser</span>&nbsp;<span class="keyword" id="5211033">interface</span>&nbsp;<span class="op" id="5211043">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211046">//&nbsp;finalClose&nbsp;is&nbsp;called&nbsp;when&nbsp;the&nbsp;reference&nbsp;count&nbsp;of&nbsp;an&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211109">//&nbsp;goes&nbsp;to&nbsp;zero.&nbsp;(*DB).mu&nbsp;is&nbsp;not&nbsp;held&nbsp;while&nbsp;calling&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211166">finalClose</span><span class="op" id="5211176">(</span><span class="op" id="5211177">)</span>&nbsp;<span class="builtintype" id="5211179">error</span><br>
<span class="lineno"></span><span class="op" id="5211185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="5211188">//&nbsp;addDep&nbsp;notes&nbsp;that&nbsp;x&nbsp;now&nbsp;depends&nbsp;on&nbsp;dep,&nbsp;and&nbsp;x&#39;s&nbsp;finalClose&nbsp;won&#39;t&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5211259">//&nbsp;called&nbsp;until&nbsp;all&nbsp;of&nbsp;x&#39;s&nbsp;dependencies&nbsp;are&nbsp;removed&nbsp;with&nbsp;removeDep.</span><br>
<span class="lineno"></span><span class="keyword" id="5211327">func</span>&nbsp;<span class="op" id="5211332">(</span><span class="ident" id="5211333">db</span>&nbsp;<span class="op" id="5211336">*</span><span class="ident" id="5211337"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5211339">)</span>&nbsp;<span class="ident" id="5211341">addDep</span><span class="op" id="5211347">(</span><span class="ident" id="5211348">x</span>&nbsp;<span class="ident" id="5211350"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="5211361">,</span>&nbsp;<span class="ident" id="5211363">dep</span>&nbsp;<span class="keyword" id="5211367">interface</span><span class="op" id="5211376">{</span><span class="op" id="5211377">}</span><span class="op" id="5211378">)</span>&nbsp;<span class="op" id="5211380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5211383">//println(fmt.Sprintf(&#34;addDep(%T&nbsp;%p,&nbsp;%T&nbsp;%p)&#34;,&nbsp;x,&nbsp;x,&nbsp;dep,&nbsp;dep))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211447"><a href="/gostd/database/sql/sql.go.html#5211333">db</a></span><span class="op" id="5211449">.</span><span class="ident" id="5211450"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5211452">.</span><span class="ident" id="5211453"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5211457">(</span><span class="op" id="5211458">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5211461">defer</span>&nbsp;<span class="ident" id="5211467"><a href="/gostd/database/sql/sql.go.html#5211333">db</a></span><span class="op" id="5211469">.</span><span class="ident" id="5211470"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5211472">.</span><span class="ident" id="5211473"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5211479">(</span><span class="op" id="5211480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211483"><a href="/gostd/database/sql/sql.go.html#5211333">db</a></span><span class="op" id="5211485">.</span><span class="ident" id="5211486"><a href="/gostd/database/sql/sql.go.html#5211524">addDepLocked</a></span><span class="op" id="5211498">(</span><span class="ident" id="5211499"><a href="/gostd/database/sql/sql.go.html#5211348">x</a></span><span class="op" id="5211500">,</span>&nbsp;<span class="ident" id="5211502"><a href="/gostd/database/sql/sql.go.html#5211363">dep</a></span><span class="op" id="5211505">)</span><br>
<span class="lineno"></span><span class="op" id="5211507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5211510">func</span>&nbsp;<span class="op" id="5211515">(</span><span class="ident" id="5211516">db</span>&nbsp;<span class="op" id="5211519">*</span><span class="ident" id="5211520"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5211522">)</span>&nbsp;<span class="ident" id="5211524">addDepLocked</span><span class="op" id="5211536">(</span><span class="ident" id="5211537">x</span>&nbsp;<span class="ident" id="5211539"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="5211550">,</span>&nbsp;<span class="ident" id="5211552">dep</span>&nbsp;<span class="keyword" id="5211556">interface</span><span class="op" id="5211565">{</span><span class="op" id="5211566">}</span><span class="op" id="5211567">)</span>&nbsp;<span class="op" id="5211569">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5211572">if</span>&nbsp;<span class="ident" id="5211575"><a href="/gostd/database/sql/sql.go.html#5211516">db</a></span><span class="op" id="5211577">.</span><span class="ident" id="5211578"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span>&nbsp;<span class="op" id="5211582">==</span>&nbsp;<span class="builtintype" id="5211585">nil</span>&nbsp;<span class="op" id="5211589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211593"><a href="/gostd/database/sql/sql.go.html#5211516">db</a></span><span class="op" id="5211595">.</span><span class="ident" id="5211596"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span>&nbsp;<span class="op" id="5211600">=</span>&nbsp;<span class="builtinfunc" id="5211602">make</span><span class="op" id="5211606">(</span><span class="keyword" id="5211607">map</span><span class="op" id="5211610">[</span><span class="ident" id="5211611"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="5211622">]</span><span class="ident" id="5211623"><a href="/gostd/database/sql/sql.go.html#5210867">depSet</a></span><span class="op" id="5211629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5211632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211635">xdep</span>&nbsp;<span class="op" id="5211640">:=</span>&nbsp;<span class="ident" id="5211643"><a href="/gostd/database/sql/sql.go.html#5211516">db</a></span><span class="op" id="5211645">.</span><span class="ident" id="5211646"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span><span class="op" id="5211649">[</span><span class="ident" id="5211650"><a href="/gostd/database/sql/sql.go.html#5211537">x</a></span><span class="op" id="5211651">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5211654">if</span>&nbsp;<span class="ident" id="5211657"><a href="/gostd/database/sql/sql.go.html#5211635">xdep</a></span>&nbsp;<span class="op" id="5211662">==</span>&nbsp;<span class="builtintype" id="5211665">nil</span>&nbsp;<span class="op" id="5211669">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211673"><a href="/gostd/database/sql/sql.go.html#5211635">xdep</a></span>&nbsp;<span class="op" id="5211678">=</span>&nbsp;<span class="builtinfunc" id="5211680">make</span><span class="op" id="5211684">(</span><span class="ident" id="5211685"><a href="/gostd/database/sql/sql.go.html#5210867">depSet</a></span><span class="op" id="5211691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211695"><a href="/gostd/database/sql/sql.go.html#5211516">db</a></span><span class="op" id="5211697">.</span><span class="ident" id="5211698"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span><span class="op" id="5211701">[</span><span class="ident" id="5211702"><a href="/gostd/database/sql/sql.go.html#5211537">x</a></span><span class="op" id="5211703">]</span>&nbsp;<span class="op" id="5211705">=</span>&nbsp;<span class="ident" id="5211707"><a href="/gostd/database/sql/sql.go.html#5211635">xdep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5211713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5211716"><a href="/gostd/database/sql/sql.go.html#5211635">xdep</a></span><span class="op" id="5211720">[</span><span class="ident" id="5211721"><a href="/gostd/database/sql/sql.go.html#5211552">dep</a></span><span class="op" id="5211724">]</span>&nbsp;<span class="op" id="5211726">=</span>&nbsp;<span class="builtintype" id="5211728">true</span><br>
<span class="lineno"></span><span class="op" id="5211733">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="5211736">//&nbsp;removeDep&nbsp;notes&nbsp;that&nbsp;x&nbsp;no&nbsp;longer&nbsp;depends&nbsp;on&nbsp;dep.</span><br>
<span class="lineno"></span><span class="comment" id="5211788">//&nbsp;If&nbsp;x&nbsp;still&nbsp;has&nbsp;dependencies,&nbsp;nil&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5211837">//&nbsp;If&nbsp;x&nbsp;no&nbsp;longer&nbsp;has&nbsp;any&nbsp;dependencies,&nbsp;its&nbsp;finalClose&nbsp;method&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5211907">//&nbsp;called&nbsp;and&nbsp;its&nbsp;error&nbsp;value&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno">385</span><span class="keyword" id="5211955">func</span>&nbsp;<span class="op" id="5211960">(</span><span class="ident" id="5211961">db</span>&nbsp;<span class="op" id="5211964">*</span><span class="ident" id="5211965"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5211967">)</span>&nbsp;<span class="ident" id="5211969">removeDep</span><span class="op" id="5211978">(</span><span class="ident" id="5211979">x</span>&nbsp;<span class="ident" id="5211981"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="5211992">,</span>&nbsp;<span class="ident" id="5211994">dep</span>&nbsp;<span class="keyword" id="5211998">interface</span><span class="op" id="5212007">{</span><span class="op" id="5212008">}</span><span class="op" id="5212009">)</span>&nbsp;<span class="builtintype" id="5212011">error</span>&nbsp;<span class="op" id="5212017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212020"><a href="/gostd/database/sql/sql.go.html#5211961">db</a></span><span class="op" id="5212022">.</span><span class="ident" id="5212023"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5212025">.</span><span class="ident" id="5212026"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5212030">(</span><span class="op" id="5212031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212034">fn</span>&nbsp;<span class="op" id="5212037">:=</span>&nbsp;<span class="ident" id="5212040"><a href="/gostd/database/sql/sql.go.html#5211961">db</a></span><span class="op" id="5212042">.</span><span class="ident" id="5212043"><a href="/gostd/database/sql/sql.go.html#5212113">removeDepLocked</a></span><span class="op" id="5212058">(</span><span class="ident" id="5212059"><a href="/gostd/database/sql/sql.go.html#5211979">x</a></span><span class="op" id="5212060">,</span>&nbsp;<span class="ident" id="5212062"><a href="/gostd/database/sql/sql.go.html#5211994">dep</a></span><span class="op" id="5212065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212068"><a href="/gostd/database/sql/sql.go.html#5211961">db</a></span><span class="op" id="5212070">.</span><span class="ident" id="5212071"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5212073">.</span><span class="ident" id="5212074"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5212080">(</span><span class="op" id="5212081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212084">return</span>&nbsp;<span class="ident" id="5212091"><a href="/gostd/database/sql/sql.go.html#5212034">fn</a></span><span class="op" id="5212093">(</span><span class="op" id="5212094">)</span><br>
<span class="lineno">390</span><span class="op" id="5212096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5212099">func</span>&nbsp;<span class="op" id="5212104">(</span><span class="ident" id="5212105">db</span>&nbsp;<span class="op" id="5212108">*</span><span class="ident" id="5212109"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5212111">)</span>&nbsp;<span class="ident" id="5212113">removeDepLocked</span><span class="op" id="5212128">(</span><span class="ident" id="5212129">x</span>&nbsp;<span class="ident" id="5212131"><a href="/gostd/database/sql/sql.go.html#5211021">finalCloser</a></span><span class="op" id="5212142">,</span>&nbsp;<span class="ident" id="5212144">dep</span>&nbsp;<span class="keyword" id="5212148">interface</span><span class="op" id="5212157">{</span><span class="op" id="5212158">}</span><span class="op" id="5212159">)</span>&nbsp;<span class="keyword" id="5212161">func</span><span class="op" id="5212165">(</span><span class="op" id="5212166">)</span>&nbsp;<span class="builtintype" id="5212168">error</span>&nbsp;<span class="op" id="5212174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212177">//println(fmt.Sprintf(&#34;removeDep(%T&nbsp;%p,&nbsp;%T&nbsp;%p)&#34;,&nbsp;x,&nbsp;x,&nbsp;dep,&nbsp;dep))</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212245">xdep</span><span class="op" id="5212249">,</span>&nbsp;<span class="ident" id="5212251">ok</span>&nbsp;<span class="op" id="5212254">:=</span>&nbsp;<span class="ident" id="5212257"><a href="/gostd/database/sql/sql.go.html#5212105">db</a></span><span class="op" id="5212259">.</span><span class="ident" id="5212260"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span><span class="op" id="5212263">[</span><span class="ident" id="5212264"><a href="/gostd/database/sql/sql.go.html#5212129">x</a></span><span class="op" id="5212265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212268">if</span>&nbsp;<span class="op" id="5212271">!</span><span class="ident" id="5212272"><a href="/gostd/database/sql/sql.go.html#5212251">ok</a></span>&nbsp;<span class="op" id="5212275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5212279">panic</span><span class="op" id="5212284">(</span><span class="ident" id="5212285"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5212288">.</span><span class="ident" id="5212289"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5212296">(</span><span class="string" id="5212297">&#34;unpaired&nbsp;removeDep:&nbsp;no&nbsp;deps&nbsp;for&nbsp;%T&#34;</span><span class="op" id="5212333">,</span>&nbsp;<span class="ident" id="5212335"><a href="/gostd/database/sql/sql.go.html#5212129">x</a></span><span class="op" id="5212336">)</span><span class="op" id="5212337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5212340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5212344">l0</span>&nbsp;<span class="op" id="5212347">:=</span>&nbsp;<span class="builtinfunc" id="5212350">len</span><span class="op" id="5212353">(</span><span class="ident" id="5212354"><a href="/gostd/database/sql/sql.go.html#5212245">xdep</a></span><span class="op" id="5212358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5212361">delete</span><span class="op" id="5212367">(</span><span class="ident" id="5212368"><a href="/gostd/database/sql/sql.go.html#5212245">xdep</a></span><span class="op" id="5212372">,</span>&nbsp;<span class="ident" id="5212374"><a href="/gostd/database/sql/sql.go.html#5212144">dep</a></span><span class="op" id="5212377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212381">switch</span>&nbsp;<span class="builtinfunc" id="5212388">len</span><span class="op" id="5212391">(</span><span class="ident" id="5212392"><a href="/gostd/database/sql/sql.go.html#5212245">xdep</a></span><span class="op" id="5212396">)</span>&nbsp;<span class="op" id="5212398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212401">case</span>&nbsp;<span class="ident" id="5212406"><a href="/gostd/database/sql/sql.go.html#5212344">l0</a></span><span class="op" id="5212408">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212412">//&nbsp;Nothing&nbsp;removed.&nbsp;Shouldn&#39;t&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5212452">panic</span><span class="op" id="5212457">(</span><span class="ident" id="5212458"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5212461">.</span><span class="ident" id="5212462"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5212469">(</span><span class="string" id="5212470">&#34;unpaired&nbsp;removeDep:&nbsp;no&nbsp;%T&nbsp;dep&nbsp;on&nbsp;%T&#34;</span><span class="op" id="5212507">,</span>&nbsp;<span class="ident" id="5212509"><a href="/gostd/database/sql/sql.go.html#5212144">dep</a></span><span class="op" id="5212512">,</span>&nbsp;<span class="ident" id="5212514"><a href="/gostd/database/sql/sql.go.html#5212129">x</a></span><span class="op" id="5212515">)</span><span class="op" id="5212516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212519">case</span>&nbsp;<span class="num" id="5212524">0</span><span class="op" id="5212525">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212529">//&nbsp;No&nbsp;more&nbsp;dependencies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5212556">delete</span><span class="op" id="5212562">(</span><span class="ident" id="5212563"><a href="/gostd/database/sql/sql.go.html#5212105">db</a></span><span class="op" id="5212565">.</span><span class="ident" id="5212566"><a href="/gostd/database/sql/sql.go.html#5207688">dep</a></span><span class="op" id="5212569">,</span>&nbsp;<span class="ident" id="5212571"><a href="/gostd/database/sql/sql.go.html#5212129">x</a></span><span class="op" id="5212572">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212576">return</span>&nbsp;<span class="ident" id="5212583"><a href="/gostd/database/sql/sql.go.html#5212129">x</a></span><span class="op" id="5212584">.</span><span class="ident" id="5212585"><a href="/gostd/database/sql/sql.go.html#5211166">finalClose</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212597">default</span><span class="op" id="5212604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5212608">//&nbsp;Dependencies&nbsp;remain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5212634">return</span>&nbsp;<span class="keyword" id="5212641">func</span><span class="op" id="5212645">(</span><span class="op" id="5212646">)</span>&nbsp;<span class="builtintype" id="5212648">error</span>&nbsp;<span class="op" id="5212654">{</span>&nbsp;<span class="keyword" id="5212656">return</span>&nbsp;<span class="builtintype" id="5212663">nil</span>&nbsp;<span class="op" id="5212667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5212670">}</span><br>
<span class="lineno">415</span><span class="op" id="5212672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5212675">//&nbsp;This&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;connectionOpener&nbsp;request&nbsp;chan&nbsp;(dn.openerCh).</span><br>
<span class="lineno"></span><span class="comment" id="5212747">//&nbsp;This&nbsp;value&nbsp;should&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;maximum&nbsp;typical&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5212809">//&nbsp;used&nbsp;for&nbsp;db.maxOpen.&nbsp;If&nbsp;maxOpen&nbsp;is&nbsp;significantly&nbsp;larger&nbsp;than</span><br>
<span class="lineno">420</span><span class="comment" id="5212873">//&nbsp;connectionRequestQueueSize&nbsp;then&nbsp;it&nbsp;is&nbsp;possible&nbsp;for&nbsp;ALL&nbsp;calls&nbsp;into&nbsp;the&nbsp;*DB</span><br>
<span class="lineno"></span><span class="comment" id="5212950">//&nbsp;to&nbsp;block&nbsp;until&nbsp;the&nbsp;connectionOpener&nbsp;can&nbsp;satisfy&nbsp;the&nbsp;backlog&nbsp;of&nbsp;requests.</span><br>
<span class="lineno"></span><span class="keyword" id="5213026">var</span>&nbsp;<span class="ident" id="5213030">connectionRequestQueueSize</span>&nbsp;<span class="op" id="5213057">=</span>&nbsp;<span class="num" id="5213059">1000000</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5213068">//&nbsp;Open&nbsp;opens&nbsp;a&nbsp;database&nbsp;specified&nbsp;by&nbsp;its&nbsp;database&nbsp;driver&nbsp;name&nbsp;and&nbsp;a</span><br>
<span class="lineno">425</span><span class="comment" id="5213137">//&nbsp;driver-specific&nbsp;data&nbsp;source&nbsp;name,&nbsp;usually&nbsp;consisting&nbsp;of&nbsp;at&nbsp;least&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5213207">//&nbsp;database&nbsp;name&nbsp;and&nbsp;connection&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="5213252">//</span><br>
<span class="lineno"></span><span class="comment" id="5213255">//&nbsp;Most&nbsp;users&nbsp;will&nbsp;open&nbsp;a&nbsp;database&nbsp;via&nbsp;a&nbsp;driver-specific&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5213323">//&nbsp;helper&nbsp;function&nbsp;that&nbsp;returns&nbsp;a&nbsp;*DB.&nbsp;No&nbsp;database&nbsp;drivers&nbsp;are&nbsp;included</span><br>
<span class="lineno">430</span><span class="comment" id="5213395">//&nbsp;in&nbsp;the&nbsp;Go&nbsp;standard&nbsp;library.&nbsp;See&nbsp;http://golang.org/s/sqldrivers&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5213465">//&nbsp;a&nbsp;list&nbsp;of&nbsp;third-party&nbsp;drivers.</span><br>
<span class="lineno"></span><span class="comment" id="5213499">//</span><br>
<span class="lineno"></span><span class="comment" id="5213502">//&nbsp;Open&nbsp;may&nbsp;just&nbsp;validate&nbsp;its&nbsp;arguments&nbsp;without&nbsp;creating&nbsp;a&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5213572">//&nbsp;to&nbsp;the&nbsp;database.&nbsp;To&nbsp;verify&nbsp;that&nbsp;the&nbsp;data&nbsp;source&nbsp;name&nbsp;is&nbsp;valid,&nbsp;call</span><br>
<span class="lineno">435</span><span class="comment" id="5213643">//&nbsp;Ping.</span><br>
<span class="lineno"></span><span class="comment" id="5213652">//</span><br>
<span class="lineno"></span><span class="comment" id="5213655">//&nbsp;The&nbsp;returned&nbsp;DB&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="5213724">//&nbsp;and&nbsp;maintains&nbsp;its&nbsp;own&nbsp;pool&nbsp;of&nbsp;idle&nbsp;connections.&nbsp;Thus,&nbsp;the&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="5213790">//&nbsp;function&nbsp;should&nbsp;be&nbsp;called&nbsp;just&nbsp;once.&nbsp;It&nbsp;is&nbsp;rarely&nbsp;necessary&nbsp;to</span><br>
<span class="lineno">440</span><span class="comment" id="5213856">//&nbsp;close&nbsp;a&nbsp;DB.</span><br>
<span class="lineno"></span><span class="keyword" id="5213871">func</span>&nbsp;<span class="ident" id="5213876">Open</span><span class="op" id="5213880">(</span><span class="ident" id="5213881">driverName</span><span class="op" id="5213891">,</span>&nbsp;<span class="ident" id="5213893">dataSourceName</span>&nbsp;<span class="builtintype" id="5213908">string</span><span class="op" id="5213914">)</span>&nbsp;<span class="op" id="5213916">(</span><span class="op" id="5213917">*</span><span class="ident" id="5213918"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5213920">,</span>&nbsp;<span class="builtintype" id="5213922">error</span><span class="op" id="5213927">)</span>&nbsp;<span class="op" id="5213929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5213932">driveri</span><span class="op" id="5213939">,</span>&nbsp;<span class="ident" id="5213941">ok</span>&nbsp;<span class="op" id="5213944">:=</span>&nbsp;<span class="ident" id="5213947"><a href="/gostd/database/sql/sql.go.html#5202143">drivers</a></span><span class="op" id="5213954">[</span><span class="ident" id="5213955"><a href="/gostd/database/sql/sql.go.html#5213881">driverName</a></span><span class="op" id="5213965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213968">if</span>&nbsp;<span class="op" id="5213971">!</span><span class="ident" id="5213972"><a href="/gostd/database/sql/sql.go.html#5213941">ok</a></span>&nbsp;<span class="op" id="5213975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5213979">return</span>&nbsp;<span class="builtintype" id="5213986">nil</span><span class="op" id="5213989">,</span>&nbsp;<span class="ident" id="5213991"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5213994">.</span><span class="ident" id="5213995"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="5214001">(</span><span class="string" id="5214002">&#34;sql:&nbsp;unknown&nbsp;driver&nbsp;%q&nbsp;(forgotten&nbsp;import?)&#34;</span><span class="op" id="5214046">,</span>&nbsp;<span class="ident" id="5214048"><a href="/gostd/database/sql/sql.go.html#5213881">driverName</a></span><span class="op" id="5214058">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214064">db</span>&nbsp;<span class="op" id="5214067">:=</span>&nbsp;<span class="op" id="5214070">&amp;</span><span class="ident" id="5214071"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5214073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214077"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="5214083">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5214087"><a href="/gostd/database/sql/sql.go.html#5213932">driveri</a></span><span class="op" id="5214094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214098"><a href="/gostd/database/sql/sql.go.html#5207193">dsn</a></span><span class="op" id="5214101">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214108"><a href="/gostd/database/sql/sql.go.html#5213893">dataSourceName</a></span><span class="op" id="5214122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214126"><a href="/gostd/database/sql/sql.go.html#5207649">openerCh</a></span><span class="op" id="5214134">:</span>&nbsp;<span class="builtinfunc" id="5214136">make</span><span class="op" id="5214140">(</span><span class="keyword" id="5214141">chan</span>&nbsp;<span class="keyword" id="5214146">struct</span><span class="op" id="5214152">{</span><span class="op" id="5214153">}</span><span class="op" id="5214154">,</span>&nbsp;<span class="ident" id="5214156"><a href="/gostd/database/sql/sql.go.html#5213030">connectionRequestQueueSize</a></span><span class="op" id="5214182">)</span><span class="op" id="5214183">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214187"><a href="/gostd/database/sql/sql.go.html#5207721">lastPut</a></span><span class="op" id="5214194">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="5214197">make</span><span class="op" id="5214201">(</span><span class="keyword" id="5214202">map</span><span class="op" id="5214205">[</span><span class="op" id="5214206">*</span><span class="ident" id="5214207"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5214217">]</span><span class="builtintype" id="5214218">string</span><span class="op" id="5214224">)</span><span class="op" id="5214225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214231">go</span>&nbsp;<span class="ident" id="5214234"><a href="/gostd/database/sql/sql.go.html#5214064">db</a></span><span class="op" id="5214236">.</span><span class="ident" id="5214237"><a href="/gostd/database/sql/sql.go.html#5217566">connectionOpener</a></span><span class="op" id="5214253">(</span><span class="op" id="5214254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214257">return</span>&nbsp;<span class="ident" id="5214264"><a href="/gostd/database/sql/sql.go.html#5214064">db</a></span><span class="op" id="5214266">,</span>&nbsp;<span class="builtintype" id="5214268">nil</span><br>
<span class="lineno"></span><span class="op" id="5214272">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="5214275">//&nbsp;Ping&nbsp;verifies&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;database&nbsp;is&nbsp;still&nbsp;alive,</span><br>
<span class="lineno"></span><span class="comment" id="5214337">//&nbsp;establishing&nbsp;a&nbsp;connection&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5214380">func</span>&nbsp;<span class="op" id="5214385">(</span><span class="ident" id="5214386">db</span>&nbsp;<span class="op" id="5214389">*</span><span class="ident" id="5214390"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5214392">)</span>&nbsp;<span class="ident" id="5214394">Ping</span><span class="op" id="5214398">(</span><span class="op" id="5214399">)</span>&nbsp;<span class="builtintype" id="5214401">error</span>&nbsp;<span class="op" id="5214407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214410">//&nbsp;TODO(bradfitz):&nbsp;give&nbsp;drivers&nbsp;an&nbsp;optional&nbsp;hook&nbsp;to&nbsp;implement</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214473">//&nbsp;this&nbsp;in&nbsp;a&nbsp;more&nbsp;efficient&nbsp;or&nbsp;more&nbsp;reliable&nbsp;way,&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5214532">//&nbsp;have&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214546">dc</span><span class="op" id="5214548">,</span>&nbsp;<span class="ident" id="5214550">err</span>&nbsp;<span class="op" id="5214554">:=</span>&nbsp;<span class="ident" id="5214557"><a href="/gostd/database/sql/sql.go.html#5214386">db</a></span><span class="op" id="5214559">.</span><span class="ident" id="5214560"><a href="/gostd/database/sql/sql.go.html#5218439">conn</a></span><span class="op" id="5214564">(</span><span class="op" id="5214565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214568">if</span>&nbsp;<span class="ident" id="5214571"><a href="/gostd/database/sql/sql.go.html#5214550">err</a></span>&nbsp;<span class="op" id="5214575">!=</span>&nbsp;<span class="builtintype" id="5214578">nil</span>&nbsp;<span class="op" id="5214582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214586">return</span>&nbsp;<span class="ident" id="5214593"><a href="/gostd/database/sql/sql.go.html#5214550">err</a></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214601"><a href="/gostd/database/sql/sql.go.html#5214386">db</a></span><span class="op" id="5214603">.</span><span class="ident" id="5214604"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5214611">(</span><span class="ident" id="5214612"><a href="/gostd/database/sql/sql.go.html#5214546">dc</a></span><span class="op" id="5214614">,</span>&nbsp;<span class="builtintype" id="5214616">nil</span><span class="op" id="5214619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214622">return</span>&nbsp;<span class="builtintype" id="5214629">nil</span><br>
<span class="lineno"></span><span class="op" id="5214633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5214636">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;database,&nbsp;releasing&nbsp;any&nbsp;open&nbsp;resources.</span><br>
<span class="lineno"></span><span class="comment" id="5214696">//</span><br>
<span class="lineno"></span><span class="comment" id="5214699">//&nbsp;It&nbsp;is&nbsp;rare&nbsp;to&nbsp;Close&nbsp;a&nbsp;DB,&nbsp;as&nbsp;the&nbsp;DB&nbsp;handle&nbsp;is&nbsp;meant&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5214760">//&nbsp;long-lived&nbsp;and&nbsp;shared&nbsp;between&nbsp;many&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5214810">func</span>&nbsp;<span class="op" id="5214815">(</span><span class="ident" id="5214816">db</span>&nbsp;<span class="op" id="5214819">*</span><span class="ident" id="5214820"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5214822">)</span>&nbsp;<span class="ident" id="5214824">Close</span><span class="op" id="5214829">(</span><span class="op" id="5214830">)</span>&nbsp;<span class="builtintype" id="5214832">error</span>&nbsp;<span class="op" id="5214838">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214841"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5214843">.</span><span class="ident" id="5214844"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5214846">.</span><span class="ident" id="5214847"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5214851">(</span><span class="op" id="5214852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214855">if</span>&nbsp;<span class="ident" id="5214858"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5214860">.</span><span class="ident" id="5214861"><a href="/gostd/database/sql/sql.go.html#5207673">closed</a></span>&nbsp;<span class="op" id="5214868">{</span>&nbsp;<span class="comment" id="5214870">//&nbsp;Make&nbsp;DB.Close&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214900"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5214902">.</span><span class="ident" id="5214903"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5214905">.</span><span class="ident" id="5214906"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5214912">(</span><span class="op" id="5214913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214917">return</span>&nbsp;<span class="builtintype" id="5214924">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5214929">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5214932">close</span><span class="op" id="5214937">(</span><span class="ident" id="5214938"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5214940">.</span><span class="ident" id="5214941"><a href="/gostd/database/sql/sql.go.html#5207649">openerCh</a></span><span class="op" id="5214949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5214952">var</span>&nbsp;<span class="ident" id="5214956">err</span>&nbsp;<span class="builtintype" id="5214960">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5214967">fns</span>&nbsp;<span class="op" id="5214971">:=</span>&nbsp;<span class="builtinfunc" id="5214974">make</span><span class="op" id="5214978">(</span><span class="op" id="5214979">[</span><span class="op" id="5214980">]</span><span class="keyword" id="5214981">func</span><span class="op" id="5214985">(</span><span class="op" id="5214986">)</span>&nbsp;<span class="builtintype" id="5214988">error</span><span class="op" id="5214993">,</span>&nbsp;<span class="num" id="5214995">0</span><span class="op" id="5214996">,</span>&nbsp;<span class="builtinfunc" id="5214998">len</span><span class="op" id="5215001">(</span><span class="ident" id="5215002"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5215004">.</span><span class="ident" id="5215005"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5215013">)</span><span class="op" id="5215014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215017">for</span>&nbsp;<span class="ident" id="5215021">_</span><span class="op" id="5215022">,</span>&nbsp;<span class="ident" id="5215024">dc</span>&nbsp;<span class="op" id="5215027">:=</span>&nbsp;<span class="keyword" id="5215030">range</span>&nbsp;<span class="ident" id="5215036"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5215038">.</span><span class="ident" id="5215039"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5215048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215052"><a href="/gostd/database/sql/sql.go.html#5214967">fns</a></span>&nbsp;<span class="op" id="5215056">=</span>&nbsp;<span class="builtinfunc" id="5215058">append</span><span class="op" id="5215064">(</span><span class="ident" id="5215065"><a href="/gostd/database/sql/sql.go.html#5214967">fns</a></span><span class="op" id="5215068">,</span>&nbsp;<span class="ident" id="5215070"><a href="/gostd/database/sql/sql.go.html#5215024">dc</a></span><span class="op" id="5215072">.</span><span class="ident" id="5215073"><a href="/gostd/database/sql/sql.go.html#5209588">closeDBLocked</a></span><span class="op" id="5215086">(</span><span class="op" id="5215087">)</span><span class="op" id="5215088">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215094"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5215096">.</span><span class="ident" id="5215097"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5215106">=</span>&nbsp;<span class="builtintype" id="5215108">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215113"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5215115">.</span><span class="ident" id="5215116"><a href="/gostd/database/sql/sql.go.html#5207673">closed</a></span>&nbsp;<span class="op" id="5215123">=</span>&nbsp;<span class="builtintype" id="5215125">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215131">for</span>&nbsp;<span class="ident" id="5215135">_</span><span class="op" id="5215136">,</span>&nbsp;<span class="ident" id="5215138">req</span>&nbsp;<span class="op" id="5215142">:=</span>&nbsp;<span class="keyword" id="5215145">range</span>&nbsp;<span class="ident" id="5215151"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5215153">.</span><span class="ident" id="5215154"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span>&nbsp;<span class="op" id="5215167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5215171">close</span><span class="op" id="5215176">(</span><span class="ident" id="5215177"><a href="/gostd/database/sql/sql.go.html#5215138">req</a></span><span class="op" id="5215180">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215186"><a href="/gostd/database/sql/sql.go.html#5214816">db</a></span><span class="op" id="5215188">.</span><span class="ident" id="5215189"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5215191">.</span><span class="ident" id="5215192"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5215198">(</span><span class="op" id="5215199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215202">for</span>&nbsp;<span class="ident" id="5215206">_</span><span class="op" id="5215207">,</span>&nbsp;<span class="ident" id="5215209">fn</span>&nbsp;<span class="op" id="5215212">:=</span>&nbsp;<span class="keyword" id="5215215">range</span>&nbsp;<span class="ident" id="5215221"><a href="/gostd/database/sql/sql.go.html#5214967">fns</a></span>&nbsp;<span class="op" id="5215225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215229">err1</span>&nbsp;<span class="op" id="5215234">:=</span>&nbsp;<span class="ident" id="5215237"><a href="/gostd/database/sql/sql.go.html#5215209">fn</a></span><span class="op" id="5215239">(</span><span class="op" id="5215240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215244">if</span>&nbsp;<span class="ident" id="5215247"><a href="/gostd/database/sql/sql.go.html#5215229">err1</a></span>&nbsp;<span class="op" id="5215252">!=</span>&nbsp;<span class="builtintype" id="5215255">nil</span>&nbsp;<span class="op" id="5215259">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215264"><a href="/gostd/database/sql/sql.go.html#5214956">err</a></span>&nbsp;<span class="op" id="5215268">=</span>&nbsp;<span class="ident" id="5215270"><a href="/gostd/database/sql/sql.go.html#5215229">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215283">return</span>&nbsp;<span class="ident" id="5215290"><a href="/gostd/database/sql/sql.go.html#5214956">err</a></span><br>
<span class="lineno"></span><span class="op" id="5215294">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="5215297">const</span>&nbsp;<span class="ident" id="5215303">defaultMaxIdleConns</span>&nbsp;<span class="op" id="5215323">=</span>&nbsp;<span class="num" id="5215325">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5215328">func</span>&nbsp;<span class="op" id="5215333">(</span><span class="ident" id="5215334">db</span>&nbsp;<span class="op" id="5215337">*</span><span class="ident" id="5215338"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5215340">)</span>&nbsp;<span class="ident" id="5215342">maxIdleConnsLocked</span><span class="op" id="5215360">(</span><span class="op" id="5215361">)</span>&nbsp;<span class="builtintype" id="5215363">int</span>&nbsp;<span class="op" id="5215367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215370">n</span>&nbsp;<span class="op" id="5215372">:=</span>&nbsp;<span class="ident" id="5215375"><a href="/gostd/database/sql/sql.go.html#5215334">db</a></span><span class="op" id="5215377">.</span><span class="ident" id="5215378"><a href="/gostd/database/sql/sql.go.html#5207799">maxIdle</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215387">switch</span>&nbsp;<span class="op" id="5215394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215397">case</span>&nbsp;<span class="ident" id="5215402"><a href="/gostd/database/sql/sql.go.html#5215370">n</a></span>&nbsp;<span class="op" id="5215404">==</span>&nbsp;<span class="num" id="5215407">0</span><span class="op" id="5215408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215412">//&nbsp;TODO(bradfitz):&nbsp;ask&nbsp;driver,&nbsp;if&nbsp;supported,&nbsp;for&nbsp;its&nbsp;default&nbsp;preference</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215486">return</span>&nbsp;<span class="ident" id="5215493"><a href="/gostd/database/sql/sql.go.html#5215303">defaultMaxIdleConns</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215514">case</span>&nbsp;<span class="ident" id="5215519"><a href="/gostd/database/sql/sql.go.html#5215370">n</a></span>&nbsp;<span class="op" id="5215521">&lt;</span>&nbsp;<span class="num" id="5215523">0</span><span class="op" id="5215524">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215528">return</span>&nbsp;<span class="num" id="5215535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215538">default</span><span class="op" id="5215545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215549">return</span>&nbsp;<span class="ident" id="5215556"><a href="/gostd/database/sql/sql.go.html#5215370">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215559">}</span><br>
<span class="lineno"></span><span class="op" id="5215561">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span><span class="comment" id="5215564">//&nbsp;SetMaxIdleConns&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;connections&nbsp;in&nbsp;the&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="5215634">//&nbsp;connection&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="5215654">//</span><br>
<span class="lineno"></span><span class="comment" id="5215657">//&nbsp;If&nbsp;MaxOpenConns&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;but&nbsp;less&nbsp;than&nbsp;the&nbsp;new&nbsp;MaxIdleConns</span><br>
<span class="lineno">520</span><span class="comment" id="5215729">//&nbsp;then&nbsp;the&nbsp;new&nbsp;MaxIdleConns&nbsp;will&nbsp;be&nbsp;reduced&nbsp;to&nbsp;match&nbsp;the&nbsp;MaxOpenConns&nbsp;limit</span><br>
<span class="lineno"></span><span class="comment" id="5215806">//</span><br>
<span class="lineno"></span><span class="comment" id="5215809">//&nbsp;If&nbsp;n&nbsp;&lt;=&nbsp;0,&nbsp;no&nbsp;idle&nbsp;connections&nbsp;are&nbsp;retained.</span><br>
<span class="lineno"></span><span class="keyword" id="5215857">func</span>&nbsp;<span class="op" id="5215862">(</span><span class="ident" id="5215863">db</span>&nbsp;<span class="op" id="5215866">*</span><span class="ident" id="5215867"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5215869">)</span>&nbsp;<span class="ident" id="5215871">SetMaxIdleConns</span><span class="op" id="5215886">(</span><span class="ident" id="5215887">n</span>&nbsp;<span class="builtintype" id="5215889">int</span><span class="op" id="5215892">)</span>&nbsp;<span class="op" id="5215894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215897"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5215899">.</span><span class="ident" id="5215900"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5215902">.</span><span class="ident" id="5215903"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5215907">(</span><span class="op" id="5215908">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5215911">if</span>&nbsp;<span class="ident" id="5215914"><a href="/gostd/database/sql/sql.go.html#5215887">n</a></span>&nbsp;<span class="op" id="5215916">&gt;</span>&nbsp;<span class="num" id="5215918">0</span>&nbsp;<span class="op" id="5215920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215924"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5215926">.</span><span class="ident" id="5215927"><a href="/gostd/database/sql/sql.go.html#5207799">maxIdle</a></span>&nbsp;<span class="op" id="5215935">=</span>&nbsp;<span class="ident" id="5215937"><a href="/gostd/database/sql/sql.go.html#5215887">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215940">}</span>&nbsp;<span class="keyword" id="5215942">else</span>&nbsp;<span class="op" id="5215947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215951">//&nbsp;No&nbsp;idle&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5215977"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5215979">.</span><span class="ident" id="5215980"><a href="/gostd/database/sql/sql.go.html#5207799">maxIdle</a></span>&nbsp;<span class="op" id="5215988">=</span>&nbsp;<span class="op" id="5215990">-</span><span class="num" id="5215991">1</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5215994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5215997">//&nbsp;Make&nbsp;sure&nbsp;maxIdle&nbsp;doesn&#39;t&nbsp;exceed&nbsp;maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216042">if</span>&nbsp;<span class="ident" id="5216045"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216047">.</span><span class="ident" id="5216048"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5216056">&gt;</span>&nbsp;<span class="num" id="5216058">0</span>&nbsp;<span class="op" id="5216060">&amp;&amp;</span>&nbsp;<span class="ident" id="5216063"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216065">.</span><span class="ident" id="5216066"><a href="/gostd/database/sql/sql.go.html#5215342">maxIdleConnsLocked</a></span><span class="op" id="5216084">(</span><span class="op" id="5216085">)</span>&nbsp;<span class="op" id="5216087">&gt;</span>&nbsp;<span class="ident" id="5216089"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216091">.</span><span class="ident" id="5216092"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5216100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216104"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216106">.</span><span class="ident" id="5216107"><a href="/gostd/database/sql/sql.go.html#5207799">maxIdle</a></span>&nbsp;<span class="op" id="5216115">=</span>&nbsp;<span class="ident" id="5216117"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216119">.</span><span class="ident" id="5216120"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216129">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216132">var</span>&nbsp;<span class="ident" id="5216136">closing</span>&nbsp;<span class="op" id="5216144">[</span><span class="op" id="5216145">]</span><span class="op" id="5216146">*</span><span class="ident" id="5216147"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216159">idleCount</span>&nbsp;<span class="op" id="5216169">:=</span>&nbsp;<span class="builtinfunc" id="5216172">len</span><span class="op" id="5216175">(</span><span class="ident" id="5216176"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216178">.</span><span class="ident" id="5216179"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5216187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216190">maxIdle</span>&nbsp;<span class="op" id="5216198">:=</span>&nbsp;<span class="ident" id="5216201"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216203">.</span><span class="ident" id="5216204"><a href="/gostd/database/sql/sql.go.html#5215342">maxIdleConnsLocked</a></span><span class="op" id="5216222">(</span><span class="op" id="5216223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216226">if</span>&nbsp;<span class="ident" id="5216229"><a href="/gostd/database/sql/sql.go.html#5216159">idleCount</a></span>&nbsp;<span class="op" id="5216239">&gt;</span>&nbsp;<span class="ident" id="5216241"><a href="/gostd/database/sql/sql.go.html#5216190">maxIdle</a></span>&nbsp;<span class="op" id="5216249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216253"><a href="/gostd/database/sql/sql.go.html#5216136">closing</a></span>&nbsp;<span class="op" id="5216261">=</span>&nbsp;<span class="ident" id="5216263"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216265">.</span><span class="ident" id="5216266"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5216274">[</span><span class="ident" id="5216275"><a href="/gostd/database/sql/sql.go.html#5216190">maxIdle</a></span><span class="op" id="5216282">:</span><span class="op" id="5216283">]</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216287"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216289">.</span><span class="ident" id="5216290"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5216299">=</span>&nbsp;<span class="ident" id="5216301"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216303">.</span><span class="ident" id="5216304"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5216312">[</span><span class="op" id="5216313">:</span><span class="ident" id="5216314"><a href="/gostd/database/sql/sql.go.html#5216190">maxIdle</a></span><span class="op" id="5216321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216327"><a href="/gostd/database/sql/sql.go.html#5215863">db</a></span><span class="op" id="5216329">.</span><span class="ident" id="5216330"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5216332">.</span><span class="ident" id="5216333"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5216339">(</span><span class="op" id="5216340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216343">for</span>&nbsp;<span class="ident" id="5216347">_</span><span class="op" id="5216348">,</span>&nbsp;<span class="ident" id="5216350">c</span>&nbsp;<span class="op" id="5216352">:=</span>&nbsp;<span class="keyword" id="5216355">range</span>&nbsp;<span class="ident" id="5216361"><a href="/gostd/database/sql/sql.go.html#5216136">closing</a></span>&nbsp;<span class="op" id="5216369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216373"><a href="/gostd/database/sql/sql.go.html#5216350">c</a></span><span class="op" id="5216374">.</span><span class="ident" id="5216375"><a href="/gostd/database/sql/sql.go.html#5209828">Close</a></span><span class="op" id="5216380">(</span><span class="op" id="5216381">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216384">}</span><br>
<span class="lineno"></span><span class="op" id="5216386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5216389">//&nbsp;SetMaxOpenConns&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;to&nbsp;the&nbsp;database.</span><br>
<span class="lineno"></span><span class="comment" id="5216469">//</span><br>
<span class="lineno">550</span><span class="comment" id="5216472">//&nbsp;If&nbsp;MaxIdleConns&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;and&nbsp;the&nbsp;new&nbsp;MaxOpenConns&nbsp;is&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="5216547">//&nbsp;MaxIdleConns,&nbsp;then&nbsp;MaxIdleConns&nbsp;will&nbsp;be&nbsp;reduced&nbsp;to&nbsp;match&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="5216615">//&nbsp;MaxOpenConns&nbsp;limit</span><br>
<span class="lineno"></span><span class="comment" id="5216637">//</span><br>
<span class="lineno"></span><span class="comment" id="5216640">//&nbsp;If&nbsp;n&nbsp;&lt;=&nbsp;0,&nbsp;then&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections.</span><br>
<span class="lineno">555</span><span class="comment" id="5216712">//&nbsp;The&nbsp;default&nbsp;is&nbsp;0&nbsp;(unlimited).</span><br>
<span class="lineno"></span><span class="keyword" id="5216745">func</span>&nbsp;<span class="op" id="5216750">(</span><span class="ident" id="5216751">db</span>&nbsp;<span class="op" id="5216754">*</span><span class="ident" id="5216755"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5216757">)</span>&nbsp;<span class="ident" id="5216759">SetMaxOpenConns</span><span class="op" id="5216774">(</span><span class="ident" id="5216775">n</span>&nbsp;<span class="builtintype" id="5216777">int</span><span class="op" id="5216780">)</span>&nbsp;<span class="op" id="5216782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216785"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216787">.</span><span class="ident" id="5216788"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5216790">.</span><span class="ident" id="5216791"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5216795">(</span><span class="op" id="5216796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216799"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216801">.</span><span class="ident" id="5216802"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5216810">=</span>&nbsp;<span class="ident" id="5216812"><a href="/gostd/database/sql/sql.go.html#5216775">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216815">if</span>&nbsp;<span class="ident" id="5216818"><a href="/gostd/database/sql/sql.go.html#5216775">n</a></span>&nbsp;<span class="op" id="5216820">&lt;</span>&nbsp;<span class="num" id="5216822">0</span>&nbsp;<span class="op" id="5216824">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216828"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216830">.</span><span class="ident" id="5216831"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5216839">=</span>&nbsp;<span class="num" id="5216841">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216847">syncMaxIdle</span>&nbsp;<span class="op" id="5216859">:=</span>&nbsp;<span class="ident" id="5216862"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216864">.</span><span class="ident" id="5216865"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5216873">&gt;</span>&nbsp;<span class="num" id="5216875">0</span>&nbsp;<span class="op" id="5216877">&amp;&amp;</span>&nbsp;<span class="ident" id="5216880"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216882">.</span><span class="ident" id="5216883"><a href="/gostd/database/sql/sql.go.html#5215342">maxIdleConnsLocked</a></span><span class="op" id="5216901">(</span><span class="op" id="5216902">)</span>&nbsp;<span class="op" id="5216904">&gt;</span>&nbsp;<span class="ident" id="5216906"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216908">.</span><span class="ident" id="5216909"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216918"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216920">.</span><span class="ident" id="5216921"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5216923">.</span><span class="ident" id="5216924"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5216930">(</span><span class="op" id="5216931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5216934">if</span>&nbsp;<span class="ident" id="5216937"><a href="/gostd/database/sql/sql.go.html#5216847">syncMaxIdle</a></span>&nbsp;<span class="op" id="5216949">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5216953"><a href="/gostd/database/sql/sql.go.html#5216751">db</a></span><span class="op" id="5216955">.</span><span class="ident" id="5216956"><a href="/gostd/database/sql/sql.go.html#5215871">SetMaxIdleConns</a></span><span class="op" id="5216971">(</span><span class="ident" id="5216972"><a href="/gostd/database/sql/sql.go.html#5216775">n</a></span><span class="op" id="5216973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5216976">}</span><br>
<span class="lineno"></span><span class="op" id="5216978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5216981">//&nbsp;Assumes&nbsp;db.mu&nbsp;is&nbsp;locked.</span><br>
<span class="lineno">570</span><span class="comment" id="5217009">//&nbsp;If&nbsp;there&nbsp;are&nbsp;connRequests&nbsp;and&nbsp;the&nbsp;connection&nbsp;limit&nbsp;hasn&#39;t&nbsp;been&nbsp;reached,</span><br>
<span class="lineno"></span><span class="comment" id="5217084">//&nbsp;then&nbsp;tell&nbsp;the&nbsp;connectionOpener&nbsp;to&nbsp;open&nbsp;new&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="5217143">func</span>&nbsp;<span class="op" id="5217148">(</span><span class="ident" id="5217149">db</span>&nbsp;<span class="op" id="5217152">*</span><span class="ident" id="5217153"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5217155">)</span>&nbsp;<span class="ident" id="5217157">maybeOpenNewConnections</span><span class="op" id="5217180">(</span><span class="op" id="5217181">)</span>&nbsp;<span class="op" id="5217183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217186">numRequests</span>&nbsp;<span class="op" id="5217198">:=</span>&nbsp;<span class="builtinfunc" id="5217201">len</span><span class="op" id="5217204">(</span><span class="ident" id="5217205"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217207">.</span><span class="ident" id="5217208"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5217220">)</span>&nbsp;<span class="op" id="5217222">-</span>&nbsp;<span class="ident" id="5217224"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217226">.</span><span class="ident" id="5217227"><a href="/gostd/database/sql/sql.go.html#5207342">pendingOpens</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217241">if</span>&nbsp;<span class="ident" id="5217244"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217246">.</span><span class="ident" id="5217247"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5217255">&gt;</span>&nbsp;<span class="num" id="5217257">0</span>&nbsp;<span class="op" id="5217259">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217263">numCanOpen</span>&nbsp;<span class="op" id="5217274">:=</span>&nbsp;<span class="ident" id="5217277"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217279">.</span><span class="ident" id="5217280"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5217288">-</span>&nbsp;<span class="op" id="5217290">(</span><span class="ident" id="5217291"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217293">.</span><span class="ident" id="5217294"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span>&nbsp;<span class="op" id="5217302">+</span>&nbsp;<span class="ident" id="5217304"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217306">.</span><span class="ident" id="5217307"><a href="/gostd/database/sql/sql.go.html#5207342">pendingOpens</a></span><span class="op" id="5217319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217323">if</span>&nbsp;<span class="ident" id="5217326"><a href="/gostd/database/sql/sql.go.html#5217186">numRequests</a></span>&nbsp;<span class="op" id="5217338">&gt;</span>&nbsp;<span class="ident" id="5217340"><a href="/gostd/database/sql/sql.go.html#5217263">numCanOpen</a></span>&nbsp;<span class="op" id="5217351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217356"><a href="/gostd/database/sql/sql.go.html#5217186">numRequests</a></span>&nbsp;<span class="op" id="5217368">=</span>&nbsp;<span class="ident" id="5217370"><a href="/gostd/database/sql/sql.go.html#5217263">numCanOpen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217386">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217389">for</span>&nbsp;<span class="ident" id="5217393"><a href="/gostd/database/sql/sql.go.html#5217186">numRequests</a></span>&nbsp;<span class="op" id="5217405">&gt;</span>&nbsp;<span class="num" id="5217407">0</span>&nbsp;<span class="op" id="5217409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217413"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217415">.</span><span class="ident" id="5217416"><a href="/gostd/database/sql/sql.go.html#5207342">pendingOpens</a></span><span class="op" id="5217428">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217433"><a href="/gostd/database/sql/sql.go.html#5217186">numRequests</a></span><span class="op" id="5217444">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217449"><a href="/gostd/database/sql/sql.go.html#5217149">db</a></span><span class="op" id="5217451">.</span><span class="ident" id="5217452"><a href="/gostd/database/sql/sql.go.html#5207649">openerCh</a></span>&nbsp;<span class="op" id="5217461">&lt;-</span>&nbsp;<span class="keyword" id="5217464">struct</span><span class="op" id="5217470">{</span><span class="op" id="5217471">}</span><span class="op" id="5217472">{</span><span class="op" id="5217473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217476">}</span><br>
<span class="lineno">585</span><span class="op" id="5217478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5217481">//&nbsp;Runs&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine,&nbsp;opens&nbsp;new&nbsp;connections&nbsp;when&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5217552">func</span>&nbsp;<span class="op" id="5217557">(</span><span class="ident" id="5217558">db</span>&nbsp;<span class="op" id="5217561">*</span><span class="ident" id="5217562"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5217564">)</span>&nbsp;<span class="ident" id="5217566">connectionOpener</span><span class="op" id="5217582">(</span><span class="op" id="5217583">)</span>&nbsp;<span class="op" id="5217585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217588">for</span>&nbsp;<span class="keyword" id="5217592">range</span>&nbsp;<span class="ident" id="5217598"><a href="/gostd/database/sql/sql.go.html#5217558">db</a></span><span class="op" id="5217600">.</span><span class="ident" id="5217601"><a href="/gostd/database/sql/sql.go.html#5207649">openerCh</a></span>&nbsp;<span class="op" id="5217610">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217614"><a href="/gostd/database/sql/sql.go.html#5217558">db</a></span><span class="op" id="5217616">.</span><span class="ident" id="5217617"><a href="/gostd/database/sql/sql.go.html#5217684">openNewConnection</a></span><span class="op" id="5217634">(</span><span class="op" id="5217635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217638">}</span><br>
<span class="lineno"></span><span class="op" id="5217640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5217643">//&nbsp;Open&nbsp;one&nbsp;new&nbsp;connection</span><br>
<span class="lineno">595</span><span class="keyword" id="5217670">func</span>&nbsp;<span class="op" id="5217675">(</span><span class="ident" id="5217676">db</span>&nbsp;<span class="op" id="5217679">*</span><span class="ident" id="5217680"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5217682">)</span>&nbsp;<span class="ident" id="5217684">openNewConnection</span><span class="op" id="5217701">(</span><span class="op" id="5217702">)</span>&nbsp;<span class="op" id="5217704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217707">ci</span><span class="op" id="5217709">,</span>&nbsp;<span class="ident" id="5217711">err</span>&nbsp;<span class="op" id="5217715">:=</span>&nbsp;<span class="ident" id="5217718"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217720">.</span><span class="ident" id="5217721"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="5217727">.</span><span class="ident" id="5217728"><a href="/gostd/database/sql/driver/driver.go.html#5248534">Open</a></span><span class="op" id="5217732">(</span><span class="ident" id="5217733"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217735">.</span><span class="ident" id="5217736"><a href="/gostd/database/sql/sql.go.html#5207193">dsn</a></span><span class="op" id="5217739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217742"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217744">.</span><span class="ident" id="5217745"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5217747">.</span><span class="ident" id="5217748"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5217752">(</span><span class="op" id="5217753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217756">defer</span>&nbsp;<span class="ident" id="5217762"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217764">.</span><span class="ident" id="5217765"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5217767">.</span><span class="ident" id="5217768"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5217774">(</span><span class="op" id="5217775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217778">if</span>&nbsp;<span class="ident" id="5217781"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217783">.</span><span class="ident" id="5217784"><a href="/gostd/database/sql/sql.go.html#5207673">closed</a></span>&nbsp;<span class="op" id="5217791">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217795">if</span>&nbsp;<span class="ident" id="5217798"><a href="/gostd/database/sql/sql.go.html#5217711">err</a></span>&nbsp;<span class="op" id="5217802">==</span>&nbsp;<span class="builtintype" id="5217805">nil</span>&nbsp;<span class="op" id="5217809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217814"><a href="/gostd/database/sql/sql.go.html#5217707">ci</a></span><span class="op" id="5217816">.</span><span class="ident" id="5217817"><a href="/gostd/database/sql/driver/driver.go.html#5250753">Close</a></span><span class="op" id="5217822">(</span><span class="op" id="5217823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217831">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217839">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217842"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217844">.</span><span class="ident" id="5217845"><a href="/gostd/database/sql/sql.go.html#5207342">pendingOpens</a></span><span class="op" id="5217857">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217861">if</span>&nbsp;<span class="ident" id="5217864"><a href="/gostd/database/sql/sql.go.html#5217711">err</a></span>&nbsp;<span class="op" id="5217868">!=</span>&nbsp;<span class="builtintype" id="5217871">nil</span>&nbsp;<span class="op" id="5217875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217879"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217881">.</span><span class="ident" id="5217882"><a href="/gostd/database/sql/sql.go.html#5222905">putConnDBLocked</a></span><span class="op" id="5217897">(</span><span class="builtintype" id="5217898">nil</span><span class="op" id="5217901">,</span>&nbsp;<span class="ident" id="5217903"><a href="/gostd/database/sql/sql.go.html#5217711">err</a></span><span class="op" id="5217906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217910">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217918">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217921">dc</span>&nbsp;<span class="op" id="5217924">:=</span>&nbsp;<span class="op" id="5217927">&amp;</span><span class="ident" id="5217928"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5217938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217942"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5217944">:</span>&nbsp;<span class="ident" id="5217946"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217952"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5217954">:</span>&nbsp;<span class="ident" id="5217956"><a href="/gostd/database/sql/sql.go.html#5217707">ci</a></span><span class="op" id="5217958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5217961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5217964">if</span>&nbsp;<span class="ident" id="5217967"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5217969">.</span><span class="ident" id="5217970"><a href="/gostd/database/sql/sql.go.html#5222905">putConnDBLocked</a></span><span class="op" id="5217985">(</span><span class="ident" id="5217986"><a href="/gostd/database/sql/sql.go.html#5217921">dc</a></span><span class="op" id="5217988">,</span>&nbsp;<span class="ident" id="5217990"><a href="/gostd/database/sql/sql.go.html#5217711">err</a></span><span class="op" id="5217993">)</span>&nbsp;<span class="op" id="5217995">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5217999"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5218001">.</span><span class="ident" id="5218002"><a href="/gostd/database/sql/sql.go.html#5211524">addDepLocked</a></span><span class="op" id="5218014">(</span><span class="ident" id="5218015"><a href="/gostd/database/sql/sql.go.html#5217921">dc</a></span><span class="op" id="5218017">,</span>&nbsp;<span class="ident" id="5218019"><a href="/gostd/database/sql/sql.go.html#5217921">dc</a></span><span class="op" id="5218021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218025"><a href="/gostd/database/sql/sql.go.html#5217676">db</a></span><span class="op" id="5218027">.</span><span class="ident" id="5218028"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><span class="op" id="5218035">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218039">}</span>&nbsp;<span class="keyword" id="5218041">else</span>&nbsp;<span class="op" id="5218046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218050"><a href="/gostd/database/sql/sql.go.html#5217707">ci</a></span><span class="op" id="5218052">.</span><span class="ident" id="5218053"><a href="/gostd/database/sql/driver/driver.go.html#5250753">Close</a></span><span class="op" id="5218058">(</span><span class="op" id="5218059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218062">}</span><br>
<span class="lineno">620</span><span class="op" id="5218064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218067">//&nbsp;connRequest&nbsp;represents&nbsp;one&nbsp;request&nbsp;for&nbsp;a&nbsp;new&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5218126">//&nbsp;When&nbsp;there&nbsp;are&nbsp;no&nbsp;idle&nbsp;connections&nbsp;available,&nbsp;DB.conn&nbsp;will&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="5218195">//&nbsp;a&nbsp;new&nbsp;connRequest&nbsp;and&nbsp;put&nbsp;it&nbsp;on&nbsp;the&nbsp;db.connRequests&nbsp;list.</span><br>
<span class="lineno">625</span><span class="keyword" id="5218256">type</span>&nbsp;<span class="ident" id="5218261">connRequest</span>&nbsp;<span class="keyword" id="5218273">struct</span>&nbsp;<span class="op" id="5218280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218283">conn</span>&nbsp;<span class="op" id="5218288">*</span><span class="ident" id="5218289"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218301">err</span>&nbsp;&nbsp;<span class="builtintype" id="5218306">error</span><br>
<span class="lineno"></span><span class="op" id="5218312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="5218315">var</span>&nbsp;<span class="ident" id="5218319">errDBClosed</span>&nbsp;<span class="op" id="5218331">=</span>&nbsp;<span class="ident" id="5218333"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5218339">.</span><span class="ident" id="5218340"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5218343">(</span><span class="string" id="5218344">&#34;sql:&nbsp;database&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5218369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5218372">//&nbsp;conn&nbsp;returns&nbsp;a&nbsp;newly-opened&nbsp;or&nbsp;cached&nbsp;*driverConn</span><br>
<span class="lineno"></span><span class="keyword" id="5218425">func</span>&nbsp;<span class="op" id="5218430">(</span><span class="ident" id="5218431">db</span>&nbsp;<span class="op" id="5218434">*</span><span class="ident" id="5218435"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5218437">)</span>&nbsp;<span class="ident" id="5218439">conn</span><span class="op" id="5218443">(</span><span class="op" id="5218444">)</span>&nbsp;<span class="op" id="5218446">(</span><span class="op" id="5218447">*</span><span class="ident" id="5218448"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5218458">,</span>&nbsp;<span class="builtintype" id="5218460">error</span><span class="op" id="5218465">)</span>&nbsp;<span class="op" id="5218467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218470"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218472">.</span><span class="ident" id="5218473"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5218475">.</span><span class="ident" id="5218476"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5218480">(</span><span class="op" id="5218481">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218484">if</span>&nbsp;<span class="ident" id="5218487"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218489">.</span><span class="ident" id="5218490"><a href="/gostd/database/sql/sql.go.html#5207673">closed</a></span>&nbsp;<span class="op" id="5218497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218501"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218503">.</span><span class="ident" id="5218504"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5218506">.</span><span class="ident" id="5218507"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5218513">(</span><span class="op" id="5218514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218518">return</span>&nbsp;<span class="builtintype" id="5218525">nil</span><span class="op" id="5218528">,</span>&nbsp;<span class="ident" id="5218530"><a href="/gostd/database/sql/sql.go.html#5218319">errDBClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5218543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218547">//&nbsp;If&nbsp;db.maxOpen&nbsp;&gt;&nbsp;0&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;is&nbsp;over&nbsp;the&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218622">//&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;free&nbsp;connection,&nbsp;make&nbsp;a&nbsp;request&nbsp;and&nbsp;wait.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5218685">if</span>&nbsp;<span class="ident" id="5218688"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218690">.</span><span class="ident" id="5218691"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5218699">&gt;</span>&nbsp;<span class="num" id="5218701">0</span>&nbsp;<span class="op" id="5218703">&amp;&amp;</span>&nbsp;<span class="ident" id="5218706"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218708">.</span><span class="ident" id="5218709"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span>&nbsp;<span class="op" id="5218717">&gt;=</span>&nbsp;<span class="ident" id="5218720"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218722">.</span><span class="ident" id="5218723"><a href="/gostd/database/sql/sql.go.html#5207884">maxOpen</a></span>&nbsp;<span class="op" id="5218731">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5218734">len</span><span class="op" id="5218737">(</span><span class="ident" id="5218738"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218740">.</span><span class="ident" id="5218741"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5218749">)</span>&nbsp;<span class="op" id="5218751">==</span>&nbsp;<span class="num" id="5218754">0</span>&nbsp;<span class="op" id="5218756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218760">//&nbsp;Make&nbsp;the&nbsp;connRequest&nbsp;channel.&nbsp;It&#39;s&nbsp;buffered&nbsp;so&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5218821">//&nbsp;connectionOpener&nbsp;doesn&#39;t&nbsp;block&nbsp;while&nbsp;waiting&nbsp;for&nbsp;the&nbsp;req&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218895">req</span>&nbsp;<span class="op" id="5218899">:=</span>&nbsp;<span class="builtinfunc" id="5218902">make</span><span class="op" id="5218906">(</span><span class="keyword" id="5218907">chan</span>&nbsp;<span class="ident" id="5218912"><a href="/gostd/database/sql/sql.go.html#5218261">connRequest</a></span><span class="op" id="5218923">,</span>&nbsp;<span class="num" id="5218925">1</span><span class="op" id="5218926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218930"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218932">.</span><span class="ident" id="5218933"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span>&nbsp;<span class="op" id="5218946">=</span>&nbsp;<span class="builtinfunc" id="5218948">append</span><span class="op" id="5218954">(</span><span class="ident" id="5218955"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218957">.</span><span class="ident" id="5218958"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5218970">,</span>&nbsp;<span class="ident" id="5218972"><a href="/gostd/database/sql/sql.go.html#5218895">req</a></span><span class="op" id="5218975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5218979"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5218981">.</span><span class="ident" id="5218982"><a href="/gostd/database/sql/sql.go.html#5217157">maybeOpenNewConnections</a></span><span class="op" id="5219005">(</span><span class="op" id="5219006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219010"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219012">.</span><span class="ident" id="5219013"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219015">.</span><span class="ident" id="5219016"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5219022">(</span><span class="op" id="5219023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219027">ret</span>&nbsp;<span class="op" id="5219031">:=</span>&nbsp;<span class="op" id="5219034">&lt;-</span><span class="ident" id="5219036"><a href="/gostd/database/sql/sql.go.html#5218895">req</a></span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219042">return</span>&nbsp;<span class="ident" id="5219049"><a href="/gostd/database/sql/sql.go.html#5219027">ret</a></span><span class="op" id="5219052">.</span><span class="ident" id="5219053"><a href="/gostd/database/sql/sql.go.html#5218283">conn</a></span><span class="op" id="5219057">,</span>&nbsp;<span class="ident" id="5219059"><a href="/gostd/database/sql/sql.go.html#5219027">ret</a></span><span class="op" id="5219062">.</span><span class="ident" id="5219063"><a href="/gostd/database/sql/sql.go.html#5218301">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219072">if</span>&nbsp;<span class="ident" id="5219075">c</span>&nbsp;<span class="op" id="5219077">:=</span>&nbsp;<span class="builtinfunc" id="5219080">len</span><span class="op" id="5219083">(</span><span class="ident" id="5219084"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219086">.</span><span class="ident" id="5219087"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5219095">)</span><span class="op" id="5219096">;</span>&nbsp;<span class="ident" id="5219098"><a href="/gostd/database/sql/sql.go.html#5219075">c</a></span>&nbsp;<span class="op" id="5219100">&gt;</span>&nbsp;<span class="num" id="5219102">0</span>&nbsp;<span class="op" id="5219104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219108">conn</span>&nbsp;<span class="op" id="5219113">:=</span>&nbsp;<span class="ident" id="5219116"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219118">.</span><span class="ident" id="5219119"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5219127">[</span><span class="num" id="5219128">0</span><span class="op" id="5219129">]</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5219133">copy</span><span class="op" id="5219137">(</span><span class="ident" id="5219138"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219140">.</span><span class="ident" id="5219141"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5219149">,</span>&nbsp;<span class="ident" id="5219151"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219153">.</span><span class="ident" id="5219154"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5219162">[</span><span class="num" id="5219163">1</span><span class="op" id="5219164">:</span><span class="op" id="5219165">]</span><span class="op" id="5219166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219170"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219172">.</span><span class="ident" id="5219173"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5219182">=</span>&nbsp;<span class="ident" id="5219184"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219186">.</span><span class="ident" id="5219187"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5219195">[</span><span class="op" id="5219196">:</span><span class="ident" id="5219197"><a href="/gostd/database/sql/sql.go.html#5219075">c</a></span><span class="op" id="5219198">-</span><span class="num" id="5219199">1</span><span class="op" id="5219200">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219204"><a href="/gostd/database/sql/sql.go.html#5219108">conn</a></span><span class="op" id="5219208">.</span><span class="ident" id="5219209"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5219215">=</span>&nbsp;<span class="builtintype" id="5219217">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219224"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219226">.</span><span class="ident" id="5219227"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219229">.</span><span class="ident" id="5219230"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5219236">(</span><span class="op" id="5219237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219241">return</span>&nbsp;<span class="ident" id="5219248"><a href="/gostd/database/sql/sql.go.html#5219108">conn</a></span><span class="op" id="5219252">,</span>&nbsp;<span class="builtintype" id="5219254">nil</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219263"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219265">.</span><span class="ident" id="5219266"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><span class="op" id="5219273">++</span>&nbsp;<span class="comment" id="5219276">//&nbsp;optimistically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219295"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219297">.</span><span class="ident" id="5219298"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219300">.</span><span class="ident" id="5219301"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5219307">(</span><span class="op" id="5219308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219311">ci</span><span class="op" id="5219313">,</span>&nbsp;<span class="ident" id="5219315">err</span>&nbsp;<span class="op" id="5219319">:=</span>&nbsp;<span class="ident" id="5219322"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219324">.</span><span class="ident" id="5219325"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><span class="op" id="5219331">.</span><span class="ident" id="5219332"><a href="/gostd/database/sql/driver/driver.go.html#5248534">Open</a></span><span class="op" id="5219336">(</span><span class="ident" id="5219337"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219339">.</span><span class="ident" id="5219340"><a href="/gostd/database/sql/sql.go.html#5207193">dsn</a></span><span class="op" id="5219343">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219346">if</span>&nbsp;<span class="ident" id="5219349"><a href="/gostd/database/sql/sql.go.html#5219315">err</a></span>&nbsp;<span class="op" id="5219353">!=</span>&nbsp;<span class="builtintype" id="5219356">nil</span>&nbsp;<span class="op" id="5219360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219364"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219366">.</span><span class="ident" id="5219367"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219369">.</span><span class="ident" id="5219370"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5219374">(</span><span class="op" id="5219375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219379"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219381">.</span><span class="ident" id="5219382"><a href="/gostd/database/sql/sql.go.html#5207324">numOpen</a></span><span class="op" id="5219389">--</span>&nbsp;<span class="comment" id="5219392">//&nbsp;correct&nbsp;for&nbsp;earlier&nbsp;optimism</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219426"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219428">.</span><span class="ident" id="5219429"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219431">.</span><span class="ident" id="5219432"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5219438">(</span><span class="op" id="5219439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219443">return</span>&nbsp;<span class="builtintype" id="5219450">nil</span><span class="op" id="5219453">,</span>&nbsp;<span class="ident" id="5219455"><a href="/gostd/database/sql/sql.go.html#5219315">err</a></span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219463"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219465">.</span><span class="ident" id="5219466"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219468">.</span><span class="ident" id="5219469"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5219473">(</span><span class="op" id="5219474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219477">dc</span>&nbsp;<span class="op" id="5219480">:=</span>&nbsp;<span class="op" id="5219483">&amp;</span><span class="ident" id="5219484"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5219494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219498"><a href="/gostd/database/sql/sql.go.html#5208171">db</a></span><span class="op" id="5219500">:</span>&nbsp;<span class="ident" id="5219502"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219508"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5219510">:</span>&nbsp;<span class="ident" id="5219512"><a href="/gostd/database/sql/sql.go.html#5219311">ci</a></span><span class="op" id="5219514">,</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5219517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219520"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219522">.</span><span class="ident" id="5219523"><a href="/gostd/database/sql/sql.go.html#5211524">addDepLocked</a></span><span class="op" id="5219535">(</span><span class="ident" id="5219536"><a href="/gostd/database/sql/sql.go.html#5219477">dc</a></span><span class="op" id="5219538">,</span>&nbsp;<span class="ident" id="5219540"><a href="/gostd/database/sql/sql.go.html#5219477">dc</a></span><span class="op" id="5219542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219545"><a href="/gostd/database/sql/sql.go.html#5219477">dc</a></span><span class="op" id="5219547">.</span><span class="ident" id="5219548"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5219554">=</span>&nbsp;<span class="builtintype" id="5219556">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219562"><a href="/gostd/database/sql/sql.go.html#5218431">db</a></span><span class="op" id="5219564">.</span><span class="ident" id="5219565"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5219567">.</span><span class="ident" id="5219568"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5219574">(</span><span class="op" id="5219575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5219578">return</span>&nbsp;<span class="ident" id="5219585"><a href="/gostd/database/sql/sql.go.html#5219477">dc</a></span><span class="op" id="5219587">,</span>&nbsp;<span class="builtintype" id="5219589">nil</span><br>
<span class="lineno">680</span><span class="op" id="5219593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5219596">var</span>&nbsp;<span class="op" id="5219600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219603">errConnClosed</span>&nbsp;<span class="op" id="5219617">=</span>&nbsp;<span class="ident" id="5219619"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5219625">.</span><span class="ident" id="5219626"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5219629">(</span><span class="string" id="5219630">&#34;database/sql:&nbsp;internal&nbsp;sentinel&nbsp;error:&nbsp;conn&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5219685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5219688">errConnBusy</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5219702">=</span>&nbsp;<span class="ident" id="5219704"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5219710">.</span><span class="ident" id="5219711"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5219714">(</span><span class="string" id="5219715">&#34;database/sql:&nbsp;internal&nbsp;sentinel&nbsp;error:&nbsp;conn&nbsp;is&nbsp;busy&#34;</span><span class="op" id="5219768">)</span><br>
<span class="lineno">685</span><span class="op" id="5219770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5219773">//&nbsp;connIfFree&nbsp;returns&nbsp;(wanted,&nbsp;nil)&nbsp;if&nbsp;wanted&nbsp;is&nbsp;still&nbsp;a&nbsp;valid&nbsp;conn&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5219845">//&nbsp;isn&#39;t&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="comment" id="5219862">//</span><br>
<span class="lineno">690</span><span class="comment" id="5219865">//&nbsp;The&nbsp;error&nbsp;is&nbsp;errConnClosed&nbsp;if&nbsp;the&nbsp;connection&nbsp;if&nbsp;the&nbsp;requested&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5219941">//&nbsp;is&nbsp;invalid&nbsp;because&nbsp;it&#39;s&nbsp;been&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="5219981">//</span><br>
<span class="lineno"></span><span class="comment" id="5219984">//&nbsp;The&nbsp;error&nbsp;is&nbsp;errConnBusy&nbsp;if&nbsp;the&nbsp;connection&nbsp;is&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="5220041">func</span>&nbsp;<span class="op" id="5220046">(</span><span class="ident" id="5220047">db</span>&nbsp;<span class="op" id="5220050">*</span><span class="ident" id="5220051"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5220053">)</span>&nbsp;<span class="ident" id="5220055">connIfFree</span><span class="op" id="5220065">(</span><span class="ident" id="5220066">wanted</span>&nbsp;<span class="op" id="5220073">*</span><span class="ident" id="5220074"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5220084">)</span>&nbsp;<span class="op" id="5220086">(</span><span class="op" id="5220087">*</span><span class="ident" id="5220088"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5220098">,</span>&nbsp;<span class="builtintype" id="5220100">error</span><span class="op" id="5220105">)</span>&nbsp;<span class="op" id="5220107">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220110"><a href="/gostd/database/sql/sql.go.html#5220047">db</a></span><span class="op" id="5220112">.</span><span class="ident" id="5220113"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5220115">.</span><span class="ident" id="5220116"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5220120">(</span><span class="op" id="5220121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220124">defer</span>&nbsp;<span class="ident" id="5220130"><a href="/gostd/database/sql/sql.go.html#5220047">db</a></span><span class="op" id="5220132">.</span><span class="ident" id="5220133"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5220135">.</span><span class="ident" id="5220136"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5220142">(</span><span class="op" id="5220143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220146">if</span>&nbsp;<span class="ident" id="5220149"><a href="/gostd/database/sql/sql.go.html#5220066">wanted</a></span><span class="op" id="5220155">.</span><span class="ident" id="5220156"><a href="/gostd/database/sql/sql.go.html#5208453">dbmuClosed</a></span>&nbsp;<span class="op" id="5220167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220171">return</span>&nbsp;<span class="builtintype" id="5220178">nil</span><span class="op" id="5220181">,</span>&nbsp;<span class="ident" id="5220183"><a href="/gostd/database/sql/sql.go.html#5219603">errConnClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220198">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220201">if</span>&nbsp;<span class="ident" id="5220204"><a href="/gostd/database/sql/sql.go.html#5220066">wanted</a></span><span class="op" id="5220210">.</span><span class="ident" id="5220211"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5220217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220221">return</span>&nbsp;<span class="builtintype" id="5220228">nil</span><span class="op" id="5220231">,</span>&nbsp;<span class="ident" id="5220233"><a href="/gostd/database/sql/sql.go.html#5219688">errConnBusy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220249">idx</span>&nbsp;<span class="op" id="5220253">:=</span>&nbsp;<span class="op" id="5220256">-</span><span class="num" id="5220257">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220260">for</span>&nbsp;<span class="ident" id="5220264">ii</span><span class="op" id="5220266">,</span>&nbsp;<span class="ident" id="5220268">v</span>&nbsp;<span class="op" id="5220270">:=</span>&nbsp;<span class="keyword" id="5220273">range</span>&nbsp;<span class="ident" id="5220279"><a href="/gostd/database/sql/sql.go.html#5220047">db</a></span><span class="op" id="5220281">.</span><span class="ident" id="5220282"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5220291">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220295">if</span>&nbsp;<span class="ident" id="5220298"><a href="/gostd/database/sql/sql.go.html#5220268">v</a></span>&nbsp;<span class="op" id="5220300">==</span>&nbsp;<span class="ident" id="5220303"><a href="/gostd/database/sql/sql.go.html#5220066">wanted</a></span>&nbsp;<span class="op" id="5220310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220315"><a href="/gostd/database/sql/sql.go.html#5220249">idx</a></span>&nbsp;<span class="op" id="5220319">=</span>&nbsp;<span class="ident" id="5220321"><a href="/gostd/database/sql/sql.go.html#5220264">ii</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220327">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220338">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220341">if</span>&nbsp;<span class="ident" id="5220344"><a href="/gostd/database/sql/sql.go.html#5220249">idx</a></span>&nbsp;<span class="op" id="5220348">&gt;=</span>&nbsp;<span class="num" id="5220351">0</span>&nbsp;<span class="op" id="5220353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220357"><a href="/gostd/database/sql/sql.go.html#5220047">db</a></span><span class="op" id="5220359">.</span><span class="ident" id="5220360"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5220369">=</span>&nbsp;<span class="builtinfunc" id="5220371">append</span><span class="op" id="5220377">(</span><span class="ident" id="5220378"><a href="/gostd/database/sql/sql.go.html#5220047">db</a></span><span class="op" id="5220380">.</span><span class="ident" id="5220381"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5220389">[</span><span class="op" id="5220390">:</span><span class="ident" id="5220391"><a href="/gostd/database/sql/sql.go.html#5220249">idx</a></span><span class="op" id="5220394">]</span><span class="op" id="5220395">,</span>&nbsp;<span class="ident" id="5220397"><a href="/gostd/database/sql/sql.go.html#5220047">db</a></span><span class="op" id="5220399">.</span><span class="ident" id="5220400"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5220408">[</span><span class="ident" id="5220409"><a href="/gostd/database/sql/sql.go.html#5220249">idx</a></span><span class="op" id="5220412">+</span><span class="num" id="5220413">1</span><span class="op" id="5220414">:</span><span class="op" id="5220415">]</span><span class="op" id="5220416">...</span><span class="op" id="5220419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5220423"><a href="/gostd/database/sql/sql.go.html#5220066">wanted</a></span><span class="op" id="5220429">.</span><span class="ident" id="5220430"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5220436">=</span>&nbsp;<span class="builtintype" id="5220438">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220445">return</span>&nbsp;<span class="ident" id="5220452"><a href="/gostd/database/sql/sql.go.html#5220066">wanted</a></span><span class="op" id="5220458">,</span>&nbsp;<span class="builtintype" id="5220460">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5220465">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220468">//&nbsp;TODO(bradfitz):&nbsp;shouldn&#39;t&nbsp;get&nbsp;here.&nbsp;After&nbsp;Go&nbsp;1.1,&nbsp;change&nbsp;this&nbsp;to:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220538">//&nbsp;panic(&#34;connIfFree&nbsp;call&nbsp;requested&nbsp;a&nbsp;non-closed,&nbsp;non-busy,&nbsp;non-free&nbsp;conn&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220615">//&nbsp;Which&nbsp;passes&nbsp;all&nbsp;the&nbsp;tests,&nbsp;but&nbsp;I&#39;m&nbsp;too&nbsp;paranoid&nbsp;to&nbsp;include&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220684">//&nbsp;late&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5220704">//&nbsp;Instead,&nbsp;treat&nbsp;it&nbsp;like&nbsp;a&nbsp;busy&nbsp;connection:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5220750">return</span>&nbsp;<span class="builtintype" id="5220757">nil</span><span class="op" id="5220760">,</span>&nbsp;<span class="ident" id="5220762"><a href="/gostd/database/sql/sql.go.html#5219688">errConnBusy</a></span><br>
<span class="lineno"></span><span class="op" id="5220774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5220777">//&nbsp;putConnHook&nbsp;is&nbsp;a&nbsp;hook&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="5220815">var</span>&nbsp;<span class="ident" id="5220819">putConnHook</span>&nbsp;<span class="keyword" id="5220831">func</span><span class="op" id="5220835">(</span><span class="op" id="5220836">*</span><span class="ident" id="5220837"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5220839">,</span>&nbsp;<span class="op" id="5220841">*</span><span class="ident" id="5220842"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5220852">)</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5220855">//&nbsp;noteUnusedDriverStatement&nbsp;notes&nbsp;that&nbsp;si&nbsp;is&nbsp;no&nbsp;longer&nbsp;used&nbsp;and&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="5220927">//&nbsp;be&nbsp;closed&nbsp;whenever&nbsp;possible&nbsp;(when&nbsp;c&nbsp;is&nbsp;next&nbsp;not&nbsp;in&nbsp;use),&nbsp;unless&nbsp;c&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5220999">//&nbsp;already&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5221018">func</span>&nbsp;<span class="op" id="5221023">(</span><span class="ident" id="5221024">db</span>&nbsp;<span class="op" id="5221027">*</span><span class="ident" id="5221028"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5221030">)</span>&nbsp;<span class="ident" id="5221032">noteUnusedDriverStatement</span><span class="op" id="5221057">(</span><span class="ident" id="5221058">c</span>&nbsp;<span class="op" id="5221060">*</span><span class="ident" id="5221061"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5221071">,</span>&nbsp;<span class="ident" id="5221073">si</span>&nbsp;<span class="ident" id="5221076"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5221082">.</span><span class="ident" id="5221083"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="5221087">)</span>&nbsp;<span class="op" id="5221089">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221092"><a href="/gostd/database/sql/sql.go.html#5221024">db</a></span><span class="op" id="5221094">.</span><span class="ident" id="5221095"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5221097">.</span><span class="ident" id="5221098"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5221102">(</span><span class="op" id="5221103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221106">defer</span>&nbsp;<span class="ident" id="5221112"><a href="/gostd/database/sql/sql.go.html#5221024">db</a></span><span class="op" id="5221114">.</span><span class="ident" id="5221115"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5221117">.</span><span class="ident" id="5221118"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5221124">(</span><span class="op" id="5221125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221128">if</span>&nbsp;<span class="ident" id="5221131"><a href="/gostd/database/sql/sql.go.html#5221058">c</a></span><span class="op" id="5221132">.</span><span class="ident" id="5221133"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5221139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221143"><a href="/gostd/database/sql/sql.go.html#5221058">c</a></span><span class="op" id="5221144">.</span><span class="ident" id="5221145"><a href="/gostd/database/sql/sql.go.html#5208375">onPut</a></span>&nbsp;<span class="op" id="5221151">=</span>&nbsp;<span class="builtinfunc" id="5221153">append</span><span class="op" id="5221159">(</span><span class="ident" id="5221160"><a href="/gostd/database/sql/sql.go.html#5221058">c</a></span><span class="op" id="5221161">.</span><span class="ident" id="5221162"><a href="/gostd/database/sql/sql.go.html#5208375">onPut</a></span><span class="op" id="5221167">,</span>&nbsp;<span class="keyword" id="5221169">func</span><span class="op" id="5221173">(</span><span class="op" id="5221174">)</span>&nbsp;<span class="op" id="5221176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221181"><a href="/gostd/database/sql/sql.go.html#5221073">si</a></span><span class="op" id="5221183">.</span><span class="ident" id="5221184"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5221189">(</span><span class="op" id="5221190">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221194">}</span><span class="op" id="5221195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221198">}</span>&nbsp;<span class="keyword" id="5221200">else</span>&nbsp;<span class="op" id="5221205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221209"><a href="/gostd/database/sql/sql.go.html#5221058">c</a></span><span class="op" id="5221210">.</span><span class="ident" id="5221211"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5221215">(</span><span class="op" id="5221216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221220">defer</span>&nbsp;<span class="ident" id="5221226"><a href="/gostd/database/sql/sql.go.html#5221058">c</a></span><span class="op" id="5221227">.</span><span class="ident" id="5221228"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5221234">(</span><span class="op" id="5221235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221239">if</span>&nbsp;<span class="op" id="5221242">!</span><span class="ident" id="5221243"><a href="/gostd/database/sql/sql.go.html#5221058">c</a></span><span class="op" id="5221244">.</span><span class="ident" id="5221245"><a href="/gostd/database/sql/sql.go.html#5208256">finalClosed</a></span>&nbsp;<span class="op" id="5221257">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221262"><a href="/gostd/database/sql/sql.go.html#5221073">si</a></span><span class="op" id="5221264">.</span><span class="ident" id="5221265"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5221270">(</span><span class="op" id="5221271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221278">}</span><br>
<span class="lineno"></span><span class="op" id="5221280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="5221283">//&nbsp;debugGetPut&nbsp;determines&nbsp;whether&nbsp;getConn&nbsp;&amp;&nbsp;putConn&nbsp;calls&#39;&nbsp;stack&nbsp;traces</span><br>
<span class="lineno"></span><span class="comment" id="5221355">//&nbsp;are&nbsp;returned&nbsp;for&nbsp;more&nbsp;verbose&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="5221397">const</span>&nbsp;<span class="ident" id="5221403">debugGetPut</span>&nbsp;<span class="op" id="5221415">=</span>&nbsp;<span class="builtintype" id="5221417">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5221424">//&nbsp;putConn&nbsp;adds&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;db&#39;s&nbsp;free&nbsp;pool.</span><br>
<span class="lineno">750</span><span class="comment" id="5221476">//&nbsp;err&nbsp;is&nbsp;optionally&nbsp;the&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;on&nbsp;this&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5221546">func</span>&nbsp;<span class="op" id="5221551">(</span><span class="ident" id="5221552">db</span>&nbsp;<span class="op" id="5221555">*</span><span class="ident" id="5221556"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5221558">)</span>&nbsp;<span class="ident" id="5221560">putConn</span><span class="op" id="5221567">(</span><span class="ident" id="5221568">dc</span>&nbsp;<span class="op" id="5221571">*</span><span class="ident" id="5221572"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5221582">,</span>&nbsp;<span class="ident" id="5221584">err</span>&nbsp;<span class="builtintype" id="5221588">error</span><span class="op" id="5221593">)</span>&nbsp;<span class="op" id="5221595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221598"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5221600">.</span><span class="ident" id="5221601"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5221603">.</span><span class="ident" id="5221604"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5221608">(</span><span class="op" id="5221609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221612">if</span>&nbsp;<span class="op" id="5221615">!</span><span class="ident" id="5221616"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221618">.</span><span class="ident" id="5221619"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5221625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221629">if</span>&nbsp;<span class="ident" id="5221632"><a href="/gostd/database/sql/sql.go.html#5221403">debugGetPut</a></span>&nbsp;<span class="op" id="5221644">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221649"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5221652">.</span><span class="ident" id="5221653"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="5221659">(</span><span class="string" id="5221660">&#34;putConn(%v)&nbsp;DUPLICATE&nbsp;was:&nbsp;%s\n\nPREVIOUS&nbsp;was:&nbsp;%s&#34;</span><span class="op" id="5221711">,</span>&nbsp;<span class="ident" id="5221713"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221715">,</span>&nbsp;<span class="ident" id="5221717"><a href="/gostd/database/sql/sql.go.html#5247274">stack</a></span><span class="op" id="5221722">(</span><span class="op" id="5221723">)</span><span class="op" id="5221724">,</span>&nbsp;<span class="ident" id="5221726"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5221728">.</span><span class="ident" id="5221729"><a href="/gostd/database/sql/sql.go.html#5207721">lastPut</a></span><span class="op" id="5221736">[</span><span class="ident" id="5221737"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221739">]</span><span class="op" id="5221740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5221748">panic</span><span class="op" id="5221753">(</span><span class="string" id="5221754">&#34;sql:&nbsp;connection&nbsp;returned&nbsp;that&nbsp;was&nbsp;never&nbsp;out&#34;</span><span class="op" id="5221799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221805">if</span>&nbsp;<span class="ident" id="5221808"><a href="/gostd/database/sql/sql.go.html#5221403">debugGetPut</a></span>&nbsp;<span class="op" id="5221820">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221824"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5221826">.</span><span class="ident" id="5221827"><a href="/gostd/database/sql/sql.go.html#5207721">lastPut</a></span><span class="op" id="5221834">[</span><span class="ident" id="5221835"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221837">]</span>&nbsp;<span class="op" id="5221839">=</span>&nbsp;<span class="ident" id="5221841"><a href="/gostd/database/sql/sql.go.html#5247274">stack</a></span><span class="op" id="5221846">(</span><span class="op" id="5221847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221853"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221855">.</span><span class="ident" id="5221856"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5221862">=</span>&nbsp;<span class="builtintype" id="5221864">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221872">for</span>&nbsp;<span class="ident" id="5221876">_</span><span class="op" id="5221877">,</span>&nbsp;<span class="ident" id="5221879">fn</span>&nbsp;<span class="op" id="5221882">:=</span>&nbsp;<span class="keyword" id="5221885">range</span>&nbsp;<span class="ident" id="5221891"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221893">.</span><span class="ident" id="5221894"><a href="/gostd/database/sql/sql.go.html#5208375">onPut</a></span>&nbsp;<span class="op" id="5221900">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221904"><a href="/gostd/database/sql/sql.go.html#5221879">fn</a></span><span class="op" id="5221906">(</span><span class="op" id="5221907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5221910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5221913"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5221915">.</span><span class="ident" id="5221916"><a href="/gostd/database/sql/sql.go.html#5208375">onPut</a></span>&nbsp;<span class="op" id="5221922">=</span>&nbsp;<span class="builtintype" id="5221924">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5221930">if</span>&nbsp;<span class="ident" id="5221933"><a href="/gostd/database/sql/sql.go.html#5221584">err</a></span>&nbsp;<span class="op" id="5221937">==</span>&nbsp;<span class="ident" id="5221940"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5221946">.</span><span class="ident" id="5221947"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5221958">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5221962">//&nbsp;Don&#39;t&nbsp;reuse&nbsp;bad&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5221996">//&nbsp;Since&nbsp;the&nbsp;conn&nbsp;is&nbsp;considered&nbsp;bad&nbsp;and&nbsp;is&nbsp;being&nbsp;discarded,&nbsp;treat&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5222067">//&nbsp;as&nbsp;closed.&nbsp;Don&#39;t&nbsp;decrement&nbsp;the&nbsp;open&nbsp;count&nbsp;here,&nbsp;finalClose&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5222136">//&nbsp;take&nbsp;care&nbsp;of&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222160"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5222162">.</span><span class="ident" id="5222163"><a href="/gostd/database/sql/sql.go.html#5217157">maybeOpenNewConnections</a></span><span class="op" id="5222186">(</span><span class="op" id="5222187">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222191"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5222193">.</span><span class="ident" id="5222194"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5222196">.</span><span class="ident" id="5222197"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5222203">(</span><span class="op" id="5222204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222208"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5222210">.</span><span class="ident" id="5222211"><a href="/gostd/database/sql/sql.go.html#5209828">Close</a></span><span class="op" id="5222216">(</span><span class="op" id="5222217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222221">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222232">if</span>&nbsp;<span class="ident" id="5222235"><a href="/gostd/database/sql/sql.go.html#5220819">putConnHook</a></span>&nbsp;<span class="op" id="5222247">!=</span>&nbsp;<span class="builtintype" id="5222250">nil</span>&nbsp;<span class="op" id="5222254">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222258"><a href="/gostd/database/sql/sql.go.html#5220819">putConnHook</a></span><span class="op" id="5222269">(</span><span class="ident" id="5222270"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5222272">,</span>&nbsp;<span class="ident" id="5222274"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5222276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222282">added</span>&nbsp;<span class="op" id="5222288">:=</span>&nbsp;<span class="ident" id="5222291"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5222293">.</span><span class="ident" id="5222294"><a href="/gostd/database/sql/sql.go.html#5222905">putConnDBLocked</a></span><span class="op" id="5222309">(</span><span class="ident" id="5222310"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5222312">,</span>&nbsp;<span class="builtintype" id="5222314">nil</span><span class="op" id="5222317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222320"><a href="/gostd/database/sql/sql.go.html#5221552">db</a></span><span class="op" id="5222322">.</span><span class="ident" id="5222323"><a href="/gostd/database/sql/sql.go.html#5207209">mu</a></span><span class="op" id="5222325">.</span><span class="ident" id="5222326"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5222332">(</span><span class="op" id="5222333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222337">if</span>&nbsp;<span class="op" id="5222340">!</span><span class="ident" id="5222341"><a href="/gostd/database/sql/sql.go.html#5222282">added</a></span>&nbsp;<span class="op" id="5222347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222351"><a href="/gostd/database/sql/sql.go.html#5221568">dc</a></span><span class="op" id="5222353">.</span><span class="ident" id="5222354"><a href="/gostd/database/sql/sql.go.html#5209828">Close</a></span><span class="op" id="5222359">(</span><span class="op" id="5222360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5222363">}</span><br>
<span class="lineno"></span><span class="op" id="5222365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="comment" id="5222368">//&nbsp;Satisfy&nbsp;a&nbsp;connRequest&nbsp;or&nbsp;put&nbsp;the&nbsp;driverConn&nbsp;in&nbsp;the&nbsp;idle&nbsp;pool&nbsp;and&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="5222448">//&nbsp;or&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5222468">//&nbsp;putConnDBLocked&nbsp;will&nbsp;satisfy&nbsp;a&nbsp;connRequest&nbsp;if&nbsp;there&nbsp;is&nbsp;one,&nbsp;or&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5222542">//&nbsp;return&nbsp;the&nbsp;*driverConn&nbsp;to&nbsp;the&nbsp;freeConn&nbsp;list&nbsp;if&nbsp;err&nbsp;==&nbsp;nil&nbsp;and&nbsp;the&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="5222616">//&nbsp;connection&nbsp;limit&nbsp;will&nbsp;not&nbsp;be&nbsp;exceeded.</span><br>
<span class="lineno">795</span><span class="comment" id="5222658">//&nbsp;If&nbsp;err&nbsp;!=&nbsp;nil,&nbsp;the&nbsp;value&nbsp;of&nbsp;dc&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5222704">//&nbsp;If&nbsp;err&nbsp;==&nbsp;nil,&nbsp;then&nbsp;dc&nbsp;must&nbsp;not&nbsp;equal&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5222750">//&nbsp;If&nbsp;a&nbsp;connRequest&nbsp;was&nbsp;fulfilled&nbsp;or&nbsp;the&nbsp;*driverConn&nbsp;was&nbsp;placed&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5222821">//&nbsp;freeConn&nbsp;list,&nbsp;then&nbsp;true&nbsp;is&nbsp;returned,&nbsp;otherwise&nbsp;false&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="5222891">func</span>&nbsp;<span class="op" id="5222896">(</span><span class="ident" id="5222897">db</span>&nbsp;<span class="op" id="5222900">*</span><span class="ident" id="5222901"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5222903">)</span>&nbsp;<span class="ident" id="5222905">putConnDBLocked</span><span class="op" id="5222920">(</span><span class="ident" id="5222921">dc</span>&nbsp;<span class="op" id="5222924">*</span><span class="ident" id="5222925"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5222935">,</span>&nbsp;<span class="ident" id="5222937">err</span>&nbsp;<span class="builtintype" id="5222941">error</span><span class="op" id="5222946">)</span>&nbsp;<span class="builtintype" id="5222948">bool</span>&nbsp;<span class="op" id="5222953">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5222956">if</span>&nbsp;<span class="ident" id="5222959">c</span>&nbsp;<span class="op" id="5222961">:=</span>&nbsp;<span class="builtinfunc" id="5222964">len</span><span class="op" id="5222967">(</span><span class="ident" id="5222968"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5222970">.</span><span class="ident" id="5222971"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5222983">)</span><span class="op" id="5222984">;</span>&nbsp;<span class="ident" id="5222986"><a href="/gostd/database/sql/sql.go.html#5222959">c</a></span>&nbsp;<span class="op" id="5222988">&gt;</span>&nbsp;<span class="num" id="5222990">0</span>&nbsp;<span class="op" id="5222992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5222996">req</span>&nbsp;<span class="op" id="5223000">:=</span>&nbsp;<span class="ident" id="5223003"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223005">.</span><span class="ident" id="5223006"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5223018">[</span><span class="num" id="5223019">0</span><span class="op" id="5223020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223024">//&nbsp;This&nbsp;copy&nbsp;is&nbsp;O(n)&nbsp;but&nbsp;in&nbsp;practice&nbsp;faster&nbsp;than&nbsp;a&nbsp;linked&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223090">//&nbsp;TODO:&nbsp;consider&nbsp;compacting&nbsp;it&nbsp;down&nbsp;less&nbsp;often&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5223144">//&nbsp;moving&nbsp;the&nbsp;base&nbsp;instead?</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5223174">copy</span><span class="op" id="5223178">(</span><span class="ident" id="5223179"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223181">.</span><span class="ident" id="5223182"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5223194">,</span>&nbsp;<span class="ident" id="5223196"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223198">.</span><span class="ident" id="5223199"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5223211">[</span><span class="num" id="5223212">1</span><span class="op" id="5223213">:</span><span class="op" id="5223214">]</span><span class="op" id="5223215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223219"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223221">.</span><span class="ident" id="5223222"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span>&nbsp;<span class="op" id="5223235">=</span>&nbsp;<span class="ident" id="5223237"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223239">.</span><span class="ident" id="5223240"><a href="/gostd/database/sql/sql.go.html#5207291">connRequests</a></span><span class="op" id="5223252">[</span><span class="op" id="5223253">:</span><span class="ident" id="5223254"><a href="/gostd/database/sql/sql.go.html#5222959">c</a></span><span class="op" id="5223255">-</span><span class="num" id="5223256">1</span><span class="op" id="5223257">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223261">if</span>&nbsp;<span class="ident" id="5223264"><a href="/gostd/database/sql/sql.go.html#5222937">err</a></span>&nbsp;<span class="op" id="5223268">==</span>&nbsp;<span class="builtintype" id="5223271">nil</span>&nbsp;<span class="op" id="5223275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223280"><a href="/gostd/database/sql/sql.go.html#5222921">dc</a></span><span class="op" id="5223282">.</span><span class="ident" id="5223283"><a href="/gostd/database/sql/sql.go.html#5208358">inUse</a></span>&nbsp;<span class="op" id="5223289">=</span>&nbsp;<span class="builtintype" id="5223291">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223298">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223302"><a href="/gostd/database/sql/sql.go.html#5222996">req</a></span>&nbsp;<span class="op" id="5223306">&lt;-</span>&nbsp;<span class="ident" id="5223309"><a href="/gostd/database/sql/sql.go.html#5218261">connRequest</a></span><span class="op" id="5223320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223325"><a href="/gostd/database/sql/sql.go.html#5218283">conn</a></span><span class="op" id="5223329">:</span>&nbsp;<span class="ident" id="5223331"><a href="/gostd/database/sql/sql.go.html#5222921">dc</a></span><span class="op" id="5223333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223338"><a href="/gostd/database/sql/sql.go.html#5218301">err</a></span><span class="op" id="5223341">:</span>&nbsp;&nbsp;<span class="ident" id="5223344"><a href="/gostd/database/sql/sql.go.html#5222937">err</a></span><span class="op" id="5223347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223355">return</span>&nbsp;<span class="builtintype" id="5223362">true</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223368">}</span>&nbsp;<span class="keyword" id="5223370">else</span>&nbsp;<span class="keyword" id="5223375">if</span>&nbsp;<span class="ident" id="5223378"><a href="/gostd/database/sql/sql.go.html#5222937">err</a></span>&nbsp;<span class="op" id="5223382">==</span>&nbsp;<span class="builtintype" id="5223385">nil</span>&nbsp;<span class="op" id="5223389">&amp;&amp;</span>&nbsp;<span class="op" id="5223392">!</span><span class="ident" id="5223393"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223395">.</span><span class="ident" id="5223396"><a href="/gostd/database/sql/sql.go.html#5207673">closed</a></span>&nbsp;<span class="op" id="5223403">&amp;&amp;</span>&nbsp;<span class="ident" id="5223406"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223408">.</span><span class="ident" id="5223409"><a href="/gostd/database/sql/sql.go.html#5215342">maxIdleConnsLocked</a></span><span class="op" id="5223427">(</span><span class="op" id="5223428">)</span>&nbsp;<span class="op" id="5223430">&gt;</span>&nbsp;<span class="builtinfunc" id="5223432">len</span><span class="op" id="5223435">(</span><span class="ident" id="5223436"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223438">.</span><span class="ident" id="5223439"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5223447">)</span>&nbsp;<span class="op" id="5223449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223453"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223455">.</span><span class="ident" id="5223456"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span>&nbsp;<span class="op" id="5223465">=</span>&nbsp;<span class="builtinfunc" id="5223467">append</span><span class="op" id="5223473">(</span><span class="ident" id="5223474"><a href="/gostd/database/sql/sql.go.html#5222897">db</a></span><span class="op" id="5223476">.</span><span class="ident" id="5223477"><a href="/gostd/database/sql/sql.go.html#5207263">freeConn</a></span><span class="op" id="5223485">,</span>&nbsp;<span class="ident" id="5223487"><a href="/gostd/database/sql/sql.go.html#5222921">dc</a></span><span class="op" id="5223489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223493">return</span>&nbsp;<span class="builtintype" id="5223500">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5223506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223509">return</span>&nbsp;<span class="builtintype" id="5223516">false</span><br>
<span class="lineno">820</span><span class="op" id="5223522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5223525">//&nbsp;maxBadConnRetries&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;maximum&nbsp;retries&nbsp;if&nbsp;the&nbsp;driver&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5223601">//&nbsp;driver.ErrBadConn&nbsp;to&nbsp;signal&nbsp;a&nbsp;broken&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5223653">const</span>&nbsp;<span class="ident" id="5223659">maxBadConnRetries</span>&nbsp;<span class="op" id="5223677">=</span>&nbsp;<span class="num" id="5223679">10</span><br>
<span class="lineno">825</span><br>
<span class="lineno"></span><span class="comment" id="5223683">//&nbsp;Prepare&nbsp;creates&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;for&nbsp;later&nbsp;queries&nbsp;or&nbsp;executions.</span><br>
<span class="lineno"></span><span class="comment" id="5223756">//&nbsp;Multiple&nbsp;queries&nbsp;or&nbsp;executions&nbsp;may&nbsp;be&nbsp;run&nbsp;concurrently&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5223823">//&nbsp;returned&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5223846">func</span>&nbsp;<span class="op" id="5223851">(</span><span class="ident" id="5223852">db</span>&nbsp;<span class="op" id="5223855">*</span><span class="ident" id="5223856"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5223858">)</span>&nbsp;<span class="ident" id="5223860">Prepare</span><span class="op" id="5223867">(</span><span class="ident" id="5223868">query</span>&nbsp;<span class="builtintype" id="5223874">string</span><span class="op" id="5223880">)</span>&nbsp;<span class="op" id="5223882">(</span><span class="op" id="5223883">*</span><span class="ident" id="5223884"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5223888">,</span>&nbsp;<span class="builtintype" id="5223890">error</span><span class="op" id="5223895">)</span>&nbsp;<span class="op" id="5223897">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223900">var</span>&nbsp;<span class="ident" id="5223904">stmt</span>&nbsp;<span class="op" id="5223909">*</span><span class="ident" id="5223910"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223916">var</span>&nbsp;<span class="ident" id="5223920">err</span>&nbsp;<span class="builtintype" id="5223924">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5223931">for</span>&nbsp;<span class="ident" id="5223935">i</span>&nbsp;<span class="op" id="5223937">:=</span>&nbsp;<span class="num" id="5223940">0</span><span class="op" id="5223941">;</span>&nbsp;<span class="ident" id="5223943"><a href="/gostd/database/sql/sql.go.html#5223935">i</a></span>&nbsp;<span class="op" id="5223945">&lt;</span>&nbsp;<span class="ident" id="5223947"><a href="/gostd/database/sql/sql.go.html#5223659">maxBadConnRetries</a></span><span class="op" id="5223964">;</span>&nbsp;<span class="ident" id="5223966"><a href="/gostd/database/sql/sql.go.html#5223935">i</a></span><span class="op" id="5223967">++</span>&nbsp;<span class="op" id="5223970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5223974"><a href="/gostd/database/sql/sql.go.html#5223904">stmt</a></span><span class="op" id="5223978">,</span>&nbsp;<span class="ident" id="5223980"><a href="/gostd/database/sql/sql.go.html#5223920">err</a></span>&nbsp;<span class="op" id="5223984">=</span>&nbsp;<span class="ident" id="5223986"><a href="/gostd/database/sql/sql.go.html#5223852">db</a></span><span class="op" id="5223988">.</span><span class="ident" id="5223989"><a href="/gostd/database/sql/sql.go.html#5224087">prepare</a></span><span class="op" id="5223996">(</span><span class="ident" id="5223997"><a href="/gostd/database/sql/sql.go.html#5223868">query</a></span><span class="op" id="5224002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224006">if</span>&nbsp;<span class="ident" id="5224009"><a href="/gostd/database/sql/sql.go.html#5223920">err</a></span>&nbsp;<span class="op" id="5224013">!=</span>&nbsp;<span class="ident" id="5224016"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5224022">.</span><span class="ident" id="5224023"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5224034">{</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224039">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224053">return</span>&nbsp;<span class="ident" id="5224060"><a href="/gostd/database/sql/sql.go.html#5223904">stmt</a></span><span class="op" id="5224064">,</span>&nbsp;<span class="ident" id="5224066"><a href="/gostd/database/sql/sql.go.html#5223920">err</a></span><br>
<span class="lineno"></span><span class="op" id="5224070">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="5224073">func</span>&nbsp;<span class="op" id="5224078">(</span><span class="ident" id="5224079">db</span>&nbsp;<span class="op" id="5224082">*</span><span class="ident" id="5224083"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5224085">)</span>&nbsp;<span class="ident" id="5224087">prepare</span><span class="op" id="5224094">(</span><span class="ident" id="5224095">query</span>&nbsp;<span class="builtintype" id="5224101">string</span><span class="op" id="5224107">)</span>&nbsp;<span class="op" id="5224109">(</span><span class="op" id="5224110">*</span><span class="ident" id="5224111"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5224115">,</span>&nbsp;<span class="builtintype" id="5224117">error</span><span class="op" id="5224122">)</span>&nbsp;<span class="op" id="5224124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224127">//&nbsp;TODO:&nbsp;check&nbsp;if&nbsp;db.driver&nbsp;supports&nbsp;an&nbsp;optional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224177">//&nbsp;driver.Preparer&nbsp;interface&nbsp;and&nbsp;call&nbsp;that&nbsp;instead,&nbsp;if&nbsp;so,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224237">//&nbsp;otherwise&nbsp;we&nbsp;make&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;that&#39;s&nbsp;bound</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224293">//&nbsp;to&nbsp;a&nbsp;connection,&nbsp;and&nbsp;to&nbsp;execute&nbsp;this&nbsp;prepared&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224353">//&nbsp;we&nbsp;either&nbsp;need&nbsp;to&nbsp;use&nbsp;this&nbsp;connection&nbsp;(if&nbsp;it&#39;s&nbsp;free),&nbsp;else</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5224416">//&nbsp;get&nbsp;a&nbsp;new&nbsp;connection&nbsp;+&nbsp;re-prepare&nbsp;+&nbsp;execute&nbsp;on&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224477">dc</span><span class="op" id="5224479">,</span>&nbsp;<span class="ident" id="5224481">err</span>&nbsp;<span class="op" id="5224485">:=</span>&nbsp;<span class="ident" id="5224488"><a href="/gostd/database/sql/sql.go.html#5224079">db</a></span><span class="op" id="5224490">.</span><span class="ident" id="5224491"><a href="/gostd/database/sql/sql.go.html#5218439">conn</a></span><span class="op" id="5224495">(</span><span class="op" id="5224496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224499">if</span>&nbsp;<span class="ident" id="5224502"><a href="/gostd/database/sql/sql.go.html#5224481">err</a></span>&nbsp;<span class="op" id="5224506">!=</span>&nbsp;<span class="builtintype" id="5224509">nil</span>&nbsp;<span class="op" id="5224513">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224517">return</span>&nbsp;<span class="builtintype" id="5224524">nil</span><span class="op" id="5224527">,</span>&nbsp;<span class="ident" id="5224529"><a href="/gostd/database/sql/sql.go.html#5224481">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224537"><a href="/gostd/database/sql/sql.go.html#5224477">dc</a></span><span class="op" id="5224539">.</span><span class="ident" id="5224540"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5224544">(</span><span class="op" id="5224545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224548">si</span><span class="op" id="5224550">,</span>&nbsp;<span class="ident" id="5224552"><a href="/gostd/database/sql/sql.go.html#5224481">err</a></span>&nbsp;<span class="op" id="5224556">:=</span>&nbsp;<span class="ident" id="5224559"><a href="/gostd/database/sql/sql.go.html#5224477">dc</a></span><span class="op" id="5224561">.</span><span class="ident" id="5224562"><a href="/gostd/database/sql/sql.go.html#5208741">prepareLocked</a></span><span class="op" id="5224575">(</span><span class="ident" id="5224576"><a href="/gostd/database/sql/sql.go.html#5224095">query</a></span><span class="op" id="5224581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224584"><a href="/gostd/database/sql/sql.go.html#5224477">dc</a></span><span class="op" id="5224586">.</span><span class="ident" id="5224587"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5224593">(</span><span class="op" id="5224594">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224597">if</span>&nbsp;<span class="ident" id="5224600"><a href="/gostd/database/sql/sql.go.html#5224481">err</a></span>&nbsp;<span class="op" id="5224604">!=</span>&nbsp;<span class="builtintype" id="5224607">nil</span>&nbsp;<span class="op" id="5224611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224615"><a href="/gostd/database/sql/sql.go.html#5224079">db</a></span><span class="op" id="5224617">.</span><span class="ident" id="5224618"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5224625">(</span><span class="ident" id="5224626"><a href="/gostd/database/sql/sql.go.html#5224477">dc</a></span><span class="op" id="5224628">,</span>&nbsp;<span class="ident" id="5224630"><a href="/gostd/database/sql/sql.go.html#5224481">err</a></span><span class="op" id="5224633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224637">return</span>&nbsp;<span class="builtintype" id="5224644">nil</span><span class="op" id="5224647">,</span>&nbsp;<span class="ident" id="5224649"><a href="/gostd/database/sql/sql.go.html#5224481">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224657">stmt</span>&nbsp;<span class="op" id="5224662">:=</span>&nbsp;<span class="op" id="5224665">&amp;</span><span class="ident" id="5224666"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5224670">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224674"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5224676">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224681"><a href="/gostd/database/sql/sql.go.html#5224079">db</a></span><span class="op" id="5224683">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224687"><a href="/gostd/database/sql/sql.go.html#5234521">query</a></span><span class="op" id="5224692">:</span>&nbsp;<span class="ident" id="5224694"><a href="/gostd/database/sql/sql.go.html#5224095">query</a></span><span class="op" id="5224699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224703"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5224706">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5224710">[</span><span class="op" id="5224711">]</span><span class="ident" id="5224712"><a href="/gostd/database/sql/sql.go.html#5234304">connStmt</a></span><span class="op" id="5224720">{</span><span class="op" id="5224721">{</span><span class="ident" id="5224722"><a href="/gostd/database/sql/sql.go.html#5224477">dc</a></span><span class="op" id="5224724">,</span>&nbsp;<span class="ident" id="5224726"><a href="/gostd/database/sql/sql.go.html#5224548">si</a></span><span class="op" id="5224728">}</span><span class="op" id="5224729">}</span><span class="op" id="5224730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5224733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224736"><a href="/gostd/database/sql/sql.go.html#5224079">db</a></span><span class="op" id="5224738">.</span><span class="ident" id="5224739"><a href="/gostd/database/sql/sql.go.html#5211341">addDep</a></span><span class="op" id="5224745">(</span><span class="ident" id="5224746"><a href="/gostd/database/sql/sql.go.html#5224657">stmt</a></span><span class="op" id="5224750">,</span>&nbsp;<span class="ident" id="5224752"><a href="/gostd/database/sql/sql.go.html#5224657">stmt</a></span><span class="op" id="5224756">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5224759"><a href="/gostd/database/sql/sql.go.html#5224079">db</a></span><span class="op" id="5224761">.</span><span class="ident" id="5224762"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5224769">(</span><span class="ident" id="5224770"><a href="/gostd/database/sql/sql.go.html#5224477">dc</a></span><span class="op" id="5224772">,</span>&nbsp;<span class="builtintype" id="5224774">nil</span><span class="op" id="5224777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224780">return</span>&nbsp;<span class="ident" id="5224787"><a href="/gostd/database/sql/sql.go.html#5224657">stmt</a></span><span class="op" id="5224791">,</span>&nbsp;<span class="builtintype" id="5224793">nil</span><br>
<span class="lineno"></span><span class="op" id="5224797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5224800">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;query&nbsp;without&nbsp;returning&nbsp;any&nbsp;rows.</span><br>
<span class="lineno">870</span><span class="comment" id="5224853">//&nbsp;The&nbsp;args&nbsp;are&nbsp;for&nbsp;any&nbsp;placeholder&nbsp;parameters&nbsp;in&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="5224914">func</span>&nbsp;<span class="op" id="5224919">(</span><span class="ident" id="5224920">db</span>&nbsp;<span class="op" id="5224923">*</span><span class="ident" id="5224924"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5224926">)</span>&nbsp;<span class="ident" id="5224928">Exec</span><span class="op" id="5224932">(</span><span class="ident" id="5224933">query</span>&nbsp;<span class="builtintype" id="5224939">string</span><span class="op" id="5224945">,</span>&nbsp;<span class="ident" id="5224947">args</span>&nbsp;<span class="op" id="5224952">...</span><span class="keyword" id="5224955">interface</span><span class="op" id="5224964">{</span><span class="op" id="5224965">}</span><span class="op" id="5224966">)</span>&nbsp;<span class="op" id="5224968">(</span><span class="ident" id="5224969"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><span class="op" id="5224975">,</span>&nbsp;<span class="builtintype" id="5224977">error</span><span class="op" id="5224982">)</span>&nbsp;<span class="op" id="5224984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5224987">var</span>&nbsp;<span class="ident" id="5224991">res</span>&nbsp;<span class="ident" id="5224995"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225003">var</span>&nbsp;<span class="ident" id="5225007">err</span>&nbsp;<span class="builtintype" id="5225011">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225018">for</span>&nbsp;<span class="ident" id="5225022">i</span>&nbsp;<span class="op" id="5225024">:=</span>&nbsp;<span class="num" id="5225027">0</span><span class="op" id="5225028">;</span>&nbsp;<span class="ident" id="5225030"><a href="/gostd/database/sql/sql.go.html#5225022">i</a></span>&nbsp;<span class="op" id="5225032">&lt;</span>&nbsp;<span class="ident" id="5225034"><a href="/gostd/database/sql/sql.go.html#5223659">maxBadConnRetries</a></span><span class="op" id="5225051">;</span>&nbsp;<span class="ident" id="5225053"><a href="/gostd/database/sql/sql.go.html#5225022">i</a></span><span class="op" id="5225054">++</span>&nbsp;<span class="op" id="5225057">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225061"><a href="/gostd/database/sql/sql.go.html#5224991">res</a></span><span class="op" id="5225064">,</span>&nbsp;<span class="ident" id="5225066"><a href="/gostd/database/sql/sql.go.html#5225007">err</a></span>&nbsp;<span class="op" id="5225070">=</span>&nbsp;<span class="ident" id="5225072"><a href="/gostd/database/sql/sql.go.html#5224920">db</a></span><span class="op" id="5225074">.</span><span class="ident" id="5225075"><a href="/gostd/database/sql/sql.go.html#5225175">exec</a></span><span class="op" id="5225079">(</span><span class="ident" id="5225080"><a href="/gostd/database/sql/sql.go.html#5224933">query</a></span><span class="op" id="5225085">,</span>&nbsp;<span class="ident" id="5225087"><a href="/gostd/database/sql/sql.go.html#5224947">args</a></span><span class="op" id="5225091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225095">if</span>&nbsp;<span class="ident" id="5225098"><a href="/gostd/database/sql/sql.go.html#5225007">err</a></span>&nbsp;<span class="op" id="5225102">!=</span>&nbsp;<span class="ident" id="5225105"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5225111">.</span><span class="ident" id="5225112"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5225123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225128">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225139">}</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225142">return</span>&nbsp;<span class="ident" id="5225149"><a href="/gostd/database/sql/sql.go.html#5224991">res</a></span><span class="op" id="5225152">,</span>&nbsp;<span class="ident" id="5225154"><a href="/gostd/database/sql/sql.go.html#5225007">err</a></span><br>
<span class="lineno"></span><span class="op" id="5225158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5225161">func</span>&nbsp;<span class="op" id="5225166">(</span><span class="ident" id="5225167">db</span>&nbsp;<span class="op" id="5225170">*</span><span class="ident" id="5225171"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5225173">)</span>&nbsp;<span class="ident" id="5225175">exec</span><span class="op" id="5225179">(</span><span class="ident" id="5225180">query</span>&nbsp;<span class="builtintype" id="5225186">string</span><span class="op" id="5225192">,</span>&nbsp;<span class="ident" id="5225194">args</span>&nbsp;<span class="op" id="5225199">[</span><span class="op" id="5225200">]</span><span class="keyword" id="5225201">interface</span><span class="op" id="5225210">{</span><span class="op" id="5225211">}</span><span class="op" id="5225212">)</span>&nbsp;<span class="op" id="5225214">(</span><span class="ident" id="5225215">res</span>&nbsp;<span class="ident" id="5225219"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><span class="op" id="5225225">,</span>&nbsp;<span class="ident" id="5225227">err</span>&nbsp;<span class="builtintype" id="5225231">error</span><span class="op" id="5225236">)</span>&nbsp;<span class="op" id="5225238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225241">dc</span><span class="op" id="5225243">,</span>&nbsp;<span class="ident" id="5225245"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span>&nbsp;<span class="op" id="5225249">:=</span>&nbsp;<span class="ident" id="5225252"><a href="/gostd/database/sql/sql.go.html#5225167">db</a></span><span class="op" id="5225254">.</span><span class="ident" id="5225255"><a href="/gostd/database/sql/sql.go.html#5218439">conn</a></span><span class="op" id="5225259">(</span><span class="op" id="5225260">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225263">if</span>&nbsp;<span class="ident" id="5225266"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span>&nbsp;<span class="op" id="5225270">!=</span>&nbsp;<span class="builtintype" id="5225273">nil</span>&nbsp;<span class="op" id="5225277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225281">return</span>&nbsp;<span class="builtintype" id="5225288">nil</span><span class="op" id="5225291">,</span>&nbsp;<span class="ident" id="5225293"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225301">defer</span>&nbsp;<span class="keyword" id="5225307">func</span><span class="op" id="5225311">(</span><span class="op" id="5225312">)</span>&nbsp;<span class="op" id="5225314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225318"><a href="/gostd/database/sql/sql.go.html#5225167">db</a></span><span class="op" id="5225320">.</span><span class="ident" id="5225321"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5225328">(</span><span class="ident" id="5225329"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225331">,</span>&nbsp;<span class="ident" id="5225333"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span><span class="op" id="5225336">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225339">}</span><span class="op" id="5225340">(</span><span class="op" id="5225341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225345">if</span>&nbsp;<span class="ident" id="5225348">execer</span><span class="op" id="5225354">,</span>&nbsp;<span class="ident" id="5225356">ok</span>&nbsp;<span class="op" id="5225359">:=</span>&nbsp;<span class="ident" id="5225362"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225364">.</span><span class="ident" id="5225365"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5225367">.</span><span class="op" id="5225368">(</span><span class="ident" id="5225369"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5225375">.</span><span class="ident" id="5225376"><a href="/gostd/database/sql/driver/driver.go.html#5249715">Execer</a></span><span class="op" id="5225382">)</span><span class="op" id="5225383">;</span>&nbsp;<span class="ident" id="5225385"><a href="/gostd/database/sql/sql.go.html#5225356">ok</a></span>&nbsp;<span class="op" id="5225388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225392">dargs</span><span class="op" id="5225397">,</span>&nbsp;<span class="ident" id="5225399">err</span>&nbsp;<span class="op" id="5225403">:=</span>&nbsp;<span class="ident" id="5225406"><a href="/gostd/database/sql/convert.go.html#5194818">driverArgs</a></span><span class="op" id="5225416">(</span><span class="builtintype" id="5225417">nil</span><span class="op" id="5225420">,</span>&nbsp;<span class="ident" id="5225422"><a href="/gostd/database/sql/sql.go.html#5225194">args</a></span><span class="op" id="5225426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225430">if</span>&nbsp;<span class="ident" id="5225433"><a href="/gostd/database/sql/sql.go.html#5225399">err</a></span>&nbsp;<span class="op" id="5225437">!=</span>&nbsp;<span class="builtintype" id="5225440">nil</span>&nbsp;<span class="op" id="5225444">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225449">return</span>&nbsp;<span class="builtintype" id="5225456">nil</span><span class="op" id="5225459">,</span>&nbsp;<span class="ident" id="5225461"><a href="/gostd/database/sql/sql.go.html#5225399">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225471"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225473">.</span><span class="ident" id="5225474"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5225478">(</span><span class="op" id="5225479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225483">resi</span><span class="op" id="5225487">,</span>&nbsp;<span class="ident" id="5225489"><a href="/gostd/database/sql/sql.go.html#5225399">err</a></span>&nbsp;<span class="op" id="5225493">:=</span>&nbsp;<span class="ident" id="5225496"><a href="/gostd/database/sql/sql.go.html#5225348">execer</a></span><span class="op" id="5225502">.</span><span class="ident" id="5225503"><a href="/gostd/database/sql/driver/driver.go.html#5249735">Exec</a></span><span class="op" id="5225507">(</span><span class="ident" id="5225508"><a href="/gostd/database/sql/sql.go.html#5225180">query</a></span><span class="op" id="5225513">,</span>&nbsp;<span class="ident" id="5225515"><a href="/gostd/database/sql/sql.go.html#5225392">dargs</a></span><span class="op" id="5225520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225524"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225526">.</span><span class="ident" id="5225527"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5225533">(</span><span class="op" id="5225534">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225538">if</span>&nbsp;<span class="ident" id="5225541"><a href="/gostd/database/sql/sql.go.html#5225399">err</a></span>&nbsp;<span class="op" id="5225545">!=</span>&nbsp;<span class="ident" id="5225548"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5225554">.</span><span class="ident" id="5225555"><a href="/gostd/database/sql/driver/driver.go.html#5248847">ErrSkip</a></span>&nbsp;<span class="op" id="5225563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225568">if</span>&nbsp;<span class="ident" id="5225571"><a href="/gostd/database/sql/sql.go.html#5225399">err</a></span>&nbsp;<span class="op" id="5225575">!=</span>&nbsp;<span class="builtintype" id="5225578">nil</span>&nbsp;<span class="op" id="5225582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225588">return</span>&nbsp;<span class="builtintype" id="5225595">nil</span><span class="op" id="5225598">,</span>&nbsp;<span class="ident" id="5225600"><a href="/gostd/database/sql/sql.go.html#5225399">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225612">return</span>&nbsp;<span class="ident" id="5225619"><a href="/gostd/database/sql/sql.go.html#5246947">driverResult</a></span><span class="op" id="5225631">{</span><span class="ident" id="5225632"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225634">,</span>&nbsp;<span class="ident" id="5225636"><a href="/gostd/database/sql/sql.go.html#5225483">resi</a></span><span class="op" id="5225640">}</span><span class="op" id="5225641">,</span>&nbsp;<span class="builtintype" id="5225643">nil</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225656"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225658">.</span><span class="ident" id="5225659"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5225663">(</span><span class="op" id="5225664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225667">si</span><span class="op" id="5225669">,</span>&nbsp;<span class="ident" id="5225671"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span>&nbsp;<span class="op" id="5225675">:=</span>&nbsp;<span class="ident" id="5225678"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225680">.</span><span class="ident" id="5225681"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5225683">.</span><span class="ident" id="5225684"><a href="/gostd/database/sql/driver/driver.go.html#5250348">Prepare</a></span><span class="op" id="5225691">(</span><span class="ident" id="5225692"><a href="/gostd/database/sql/sql.go.html#5225180">query</a></span><span class="op" id="5225697">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5225700"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225702">.</span><span class="ident" id="5225703"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5225709">(</span><span class="op" id="5225710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225713">if</span>&nbsp;<span class="ident" id="5225716"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span>&nbsp;<span class="op" id="5225720">!=</span>&nbsp;<span class="builtintype" id="5225723">nil</span>&nbsp;<span class="op" id="5225727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225731">return</span>&nbsp;<span class="builtintype" id="5225738">nil</span><span class="op" id="5225741">,</span>&nbsp;<span class="ident" id="5225743"><a href="/gostd/database/sql/sql.go.html#5225227">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5225748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225751">defer</span>&nbsp;<span class="ident" id="5225757"><a href="/gostd/database/sql/sql.go.html#5247408">withLock</a></span><span class="op" id="5225765">(</span><span class="ident" id="5225766"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225768">,</span>&nbsp;<span class="keyword" id="5225770">func</span><span class="op" id="5225774">(</span><span class="op" id="5225775">)</span>&nbsp;<span class="op" id="5225777">{</span>&nbsp;<span class="ident" id="5225779"><a href="/gostd/database/sql/sql.go.html#5225667">si</a></span><span class="op" id="5225781">.</span><span class="ident" id="5225782"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5225787">(</span><span class="op" id="5225788">)</span>&nbsp;<span class="op" id="5225790">}</span><span class="op" id="5225791">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5225794">return</span>&nbsp;<span class="ident" id="5225801"><a href="/gostd/database/sql/sql.go.html#5235704">resultFromStatement</a></span><span class="op" id="5225820">(</span><span class="ident" id="5225821"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5225831">{</span><span class="ident" id="5225832"><a href="/gostd/database/sql/sql.go.html#5225241">dc</a></span><span class="op" id="5225834">,</span>&nbsp;<span class="ident" id="5225836"><a href="/gostd/database/sql/sql.go.html#5225667">si</a></span><span class="op" id="5225838">}</span><span class="op" id="5225839">,</span>&nbsp;<span class="ident" id="5225841"><a href="/gostd/database/sql/sql.go.html#5225194">args</a></span><span class="op" id="5225845">...</span><span class="op" id="5225848">)</span><br>
<span class="lineno"></span><span class="op" id="5225850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5225853">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;returns&nbsp;rows,&nbsp;typically&nbsp;a&nbsp;SELECT.</span><br>
<span class="lineno"></span><span class="comment" id="5225918">//&nbsp;The&nbsp;args&nbsp;are&nbsp;for&nbsp;any&nbsp;placeholder&nbsp;parameters&nbsp;in&nbsp;the&nbsp;query.</span><br>
<span class="lineno">920</span><span class="keyword" id="5225979">func</span>&nbsp;<span class="op" id="5225984">(</span><span class="ident" id="5225985">db</span>&nbsp;<span class="op" id="5225988">*</span><span class="ident" id="5225989"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5225991">)</span>&nbsp;<span class="ident" id="5225993">Query</span><span class="op" id="5225998">(</span><span class="ident" id="5225999">query</span>&nbsp;<span class="builtintype" id="5226005">string</span><span class="op" id="5226011">,</span>&nbsp;<span class="ident" id="5226013">args</span>&nbsp;<span class="op" id="5226018">...</span><span class="keyword" id="5226021">interface</span><span class="op" id="5226030">{</span><span class="op" id="5226031">}</span><span class="op" id="5226032">)</span>&nbsp;<span class="op" id="5226034">(</span><span class="op" id="5226035">*</span><span class="ident" id="5226036"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5226040">,</span>&nbsp;<span class="builtintype" id="5226042">error</span><span class="op" id="5226047">)</span>&nbsp;<span class="op" id="5226049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226052">var</span>&nbsp;<span class="ident" id="5226056">rows</span>&nbsp;<span class="op" id="5226061">*</span><span class="ident" id="5226062"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226068">var</span>&nbsp;<span class="ident" id="5226072">err</span>&nbsp;<span class="builtintype" id="5226076">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226083">for</span>&nbsp;<span class="ident" id="5226087">i</span>&nbsp;<span class="op" id="5226089">:=</span>&nbsp;<span class="num" id="5226092">0</span><span class="op" id="5226093">;</span>&nbsp;<span class="ident" id="5226095"><a href="/gostd/database/sql/sql.go.html#5226087">i</a></span>&nbsp;<span class="op" id="5226097">&lt;</span>&nbsp;<span class="ident" id="5226099"><a href="/gostd/database/sql/sql.go.html#5223659">maxBadConnRetries</a></span><span class="op" id="5226116">;</span>&nbsp;<span class="ident" id="5226118"><a href="/gostd/database/sql/sql.go.html#5226087">i</a></span><span class="op" id="5226119">++</span>&nbsp;<span class="op" id="5226122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226126"><a href="/gostd/database/sql/sql.go.html#5226056">rows</a></span><span class="op" id="5226130">,</span>&nbsp;<span class="ident" id="5226132"><a href="/gostd/database/sql/sql.go.html#5226072">err</a></span>&nbsp;<span class="op" id="5226136">=</span>&nbsp;<span class="ident" id="5226138"><a href="/gostd/database/sql/sql.go.html#5225985">db</a></span><span class="op" id="5226140">.</span><span class="ident" id="5226141"><a href="/gostd/database/sql/sql.go.html#5226243">query</a></span><span class="op" id="5226146">(</span><span class="ident" id="5226147"><a href="/gostd/database/sql/sql.go.html#5225999">query</a></span><span class="op" id="5226152">,</span>&nbsp;<span class="ident" id="5226154"><a href="/gostd/database/sql/sql.go.html#5226013">args</a></span><span class="op" id="5226158">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226162">if</span>&nbsp;<span class="ident" id="5226165"><a href="/gostd/database/sql/sql.go.html#5226072">err</a></span>&nbsp;<span class="op" id="5226169">!=</span>&nbsp;<span class="ident" id="5226172"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5226178">.</span><span class="ident" id="5226179"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5226190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226195">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226209">return</span>&nbsp;<span class="ident" id="5226216"><a href="/gostd/database/sql/sql.go.html#5226056">rows</a></span><span class="op" id="5226220">,</span>&nbsp;<span class="ident" id="5226222"><a href="/gostd/database/sql/sql.go.html#5226072">err</a></span><br>
<span class="lineno">930</span><span class="op" id="5226226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226229">func</span>&nbsp;<span class="op" id="5226234">(</span><span class="ident" id="5226235">db</span>&nbsp;<span class="op" id="5226238">*</span><span class="ident" id="5226239"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5226241">)</span>&nbsp;<span class="ident" id="5226243">query</span><span class="op" id="5226248">(</span><span class="ident" id="5226249">query</span>&nbsp;<span class="builtintype" id="5226255">string</span><span class="op" id="5226261">,</span>&nbsp;<span class="ident" id="5226263">args</span>&nbsp;<span class="op" id="5226268">[</span><span class="op" id="5226269">]</span><span class="keyword" id="5226270">interface</span><span class="op" id="5226279">{</span><span class="op" id="5226280">}</span><span class="op" id="5226281">)</span>&nbsp;<span class="op" id="5226283">(</span><span class="op" id="5226284">*</span><span class="ident" id="5226285"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5226289">,</span>&nbsp;<span class="builtintype" id="5226291">error</span><span class="op" id="5226296">)</span>&nbsp;<span class="op" id="5226298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226301">ci</span><span class="op" id="5226303">,</span>&nbsp;<span class="ident" id="5226305">err</span>&nbsp;<span class="op" id="5226309">:=</span>&nbsp;<span class="ident" id="5226312"><a href="/gostd/database/sql/sql.go.html#5226235">db</a></span><span class="op" id="5226314">.</span><span class="ident" id="5226315"><a href="/gostd/database/sql/sql.go.html#5218439">conn</a></span><span class="op" id="5226319">(</span><span class="op" id="5226320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226323">if</span>&nbsp;<span class="ident" id="5226326"><a href="/gostd/database/sql/sql.go.html#5226305">err</a></span>&nbsp;<span class="op" id="5226330">!=</span>&nbsp;<span class="builtintype" id="5226333">nil</span>&nbsp;<span class="op" id="5226337">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226341">return</span>&nbsp;<span class="builtintype" id="5226348">nil</span><span class="op" id="5226351">,</span>&nbsp;<span class="ident" id="5226353"><a href="/gostd/database/sql/sql.go.html#5226305">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226362">return</span>&nbsp;<span class="ident" id="5226369"><a href="/gostd/database/sql/sql.go.html#5226235">db</a></span><span class="op" id="5226371">.</span><span class="ident" id="5226372"><a href="/gostd/database/sql/sql.go.html#5226548">queryConn</a></span><span class="op" id="5226381">(</span><span class="ident" id="5226382"><a href="/gostd/database/sql/sql.go.html#5226301">ci</a></span><span class="op" id="5226384">,</span>&nbsp;<span class="ident" id="5226386"><a href="/gostd/database/sql/sql.go.html#5226301">ci</a></span><span class="op" id="5226388">.</span><span class="ident" id="5226389"><a href="/gostd/database/sql/sql.go.html#5208554">releaseConn</a></span><span class="op" id="5226400">,</span>&nbsp;<span class="ident" id="5226402"><a href="/gostd/database/sql/sql.go.html#5226249">query</a></span><span class="op" id="5226407">,</span>&nbsp;<span class="ident" id="5226409"><a href="/gostd/database/sql/sql.go.html#5226263">args</a></span><span class="op" id="5226413">)</span><br>
<span class="lineno"></span><span class="op" id="5226415">}</span><br>
<span class="lineno">940</span><br>
<span class="lineno"></span><span class="comment" id="5226418">//&nbsp;queryConn&nbsp;executes&nbsp;a&nbsp;query&nbsp;on&nbsp;the&nbsp;given&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5226473">//&nbsp;The&nbsp;connection&nbsp;gets&nbsp;released&nbsp;by&nbsp;the&nbsp;releaseConn&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5226534">func</span>&nbsp;<span class="op" id="5226539">(</span><span class="ident" id="5226540">db</span>&nbsp;<span class="op" id="5226543">*</span><span class="ident" id="5226544"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5226546">)</span>&nbsp;<span class="ident" id="5226548">queryConn</span><span class="op" id="5226557">(</span><span class="ident" id="5226558">dc</span>&nbsp;<span class="op" id="5226561">*</span><span class="ident" id="5226562"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5226572">,</span>&nbsp;<span class="ident" id="5226574">releaseConn</span>&nbsp;<span class="keyword" id="5226586">func</span><span class="op" id="5226590">(</span><span class="builtintype" id="5226591">error</span><span class="op" id="5226596">)</span><span class="op" id="5226597">,</span>&nbsp;<span class="ident" id="5226599">query</span>&nbsp;<span class="builtintype" id="5226605">string</span><span class="op" id="5226611">,</span>&nbsp;<span class="ident" id="5226613">args</span>&nbsp;<span class="op" id="5226618">[</span><span class="op" id="5226619">]</span><span class="keyword" id="5226620">interface</span><span class="op" id="5226629">{</span><span class="op" id="5226630">}</span><span class="op" id="5226631">)</span>&nbsp;<span class="op" id="5226633">(</span><span class="op" id="5226634">*</span><span class="ident" id="5226635"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5226639">,</span>&nbsp;<span class="builtintype" id="5226641">error</span><span class="op" id="5226646">)</span>&nbsp;<span class="op" id="5226648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226651">if</span>&nbsp;<span class="ident" id="5226654">queryer</span><span class="op" id="5226661">,</span>&nbsp;<span class="ident" id="5226663">ok</span>&nbsp;<span class="op" id="5226666">:=</span>&nbsp;<span class="ident" id="5226669"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5226671">.</span><span class="ident" id="5226672"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5226674">.</span><span class="op" id="5226675">(</span><span class="ident" id="5226676"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5226682">.</span><span class="ident" id="5226683"><a href="/gostd/database/sql/driver/driver.go.html#5250053">Queryer</a></span><span class="op" id="5226690">)</span><span class="op" id="5226691">;</span>&nbsp;<span class="ident" id="5226693"><a href="/gostd/database/sql/sql.go.html#5226663">ok</a></span>&nbsp;<span class="op" id="5226696">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226700">dargs</span><span class="op" id="5226705">,</span>&nbsp;<span class="ident" id="5226707">err</span>&nbsp;<span class="op" id="5226711">:=</span>&nbsp;<span class="ident" id="5226714"><a href="/gostd/database/sql/convert.go.html#5194818">driverArgs</a></span><span class="op" id="5226724">(</span><span class="builtintype" id="5226725">nil</span><span class="op" id="5226728">,</span>&nbsp;<span class="ident" id="5226730"><a href="/gostd/database/sql/sql.go.html#5226613">args</a></span><span class="op" id="5226734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226738">if</span>&nbsp;<span class="ident" id="5226741"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span>&nbsp;<span class="op" id="5226745">!=</span>&nbsp;<span class="builtintype" id="5226748">nil</span>&nbsp;<span class="op" id="5226752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226757"><a href="/gostd/database/sql/sql.go.html#5226574">releaseConn</a></span><span class="op" id="5226768">(</span><span class="ident" id="5226769"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span><span class="op" id="5226772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226777">return</span>&nbsp;<span class="builtintype" id="5226784">nil</span><span class="op" id="5226787">,</span>&nbsp;<span class="ident" id="5226789"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226795">}</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226799"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5226801">.</span><span class="ident" id="5226802"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5226806">(</span><span class="op" id="5226807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226811">rowsi</span><span class="op" id="5226816">,</span>&nbsp;<span class="ident" id="5226818"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span>&nbsp;<span class="op" id="5226822">:=</span>&nbsp;<span class="ident" id="5226825"><a href="/gostd/database/sql/sql.go.html#5226654">queryer</a></span><span class="op" id="5226832">.</span><span class="ident" id="5226833"><a href="/gostd/database/sql/driver/driver.go.html#5250074">Query</a></span><span class="op" id="5226838">(</span><span class="ident" id="5226839"><a href="/gostd/database/sql/sql.go.html#5226599">query</a></span><span class="op" id="5226844">,</span>&nbsp;<span class="ident" id="5226846"><a href="/gostd/database/sql/sql.go.html#5226700">dargs</a></span><span class="op" id="5226851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226855"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5226857">.</span><span class="ident" id="5226858"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5226864">(</span><span class="op" id="5226865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226869">if</span>&nbsp;<span class="ident" id="5226872"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span>&nbsp;<span class="op" id="5226876">!=</span>&nbsp;<span class="ident" id="5226879"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5226885">.</span><span class="ident" id="5226886"><a href="/gostd/database/sql/driver/driver.go.html#5248847">ErrSkip</a></span>&nbsp;<span class="op" id="5226894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226899">if</span>&nbsp;<span class="ident" id="5226902"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span>&nbsp;<span class="op" id="5226906">!=</span>&nbsp;<span class="builtintype" id="5226909">nil</span>&nbsp;<span class="op" id="5226913">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5226919"><a href="/gostd/database/sql/sql.go.html#5226574">releaseConn</a></span><span class="op" id="5226930">(</span><span class="ident" id="5226931"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span><span class="op" id="5226934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5226940">return</span>&nbsp;<span class="builtintype" id="5226947">nil</span><span class="op" id="5226950">,</span>&nbsp;<span class="ident" id="5226952"><a href="/gostd/database/sql/sql.go.html#5226707">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5226964">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;dc&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227025">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227049">rows</span>&nbsp;<span class="op" id="5227054">:=</span>&nbsp;<span class="op" id="5227057">&amp;</span><span class="ident" id="5227058"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5227062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227068"><a href="/gostd/database/sql/sql.go.html#5241514">dc</a></span><span class="op" id="5227070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227081"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227089"><a href="/gostd/database/sql/sql.go.html#5241594">releaseConn</a></span><span class="op" id="5227100">:</span>&nbsp;<span class="ident" id="5227102"><a href="/gostd/database/sql/sql.go.html#5226574">releaseConn</a></span><span class="op" id="5227113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227119"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5227124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227132"><a href="/gostd/database/sql/sql.go.html#5226811">rowsi</a></span><span class="op" id="5227137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227142">}</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227147">return</span>&nbsp;<span class="ident" id="5227154"><a href="/gostd/database/sql/sql.go.html#5227049">rows</a></span><span class="op" id="5227158">,</span>&nbsp;<span class="builtintype" id="5227160">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227173"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227175">.</span><span class="ident" id="5227176"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5227180">(</span><span class="op" id="5227181">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227184">si</span><span class="op" id="5227186">,</span>&nbsp;<span class="ident" id="5227188">err</span>&nbsp;<span class="op" id="5227192">:=</span>&nbsp;<span class="ident" id="5227195"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227197">.</span><span class="ident" id="5227198"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5227200">.</span><span class="ident" id="5227201"><a href="/gostd/database/sql/driver/driver.go.html#5250348">Prepare</a></span><span class="op" id="5227208">(</span><span class="ident" id="5227209"><a href="/gostd/database/sql/sql.go.html#5226599">query</a></span><span class="op" id="5227214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227217"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227219">.</span><span class="ident" id="5227220"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5227226">(</span><span class="op" id="5227227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227230">if</span>&nbsp;<span class="ident" id="5227233"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span>&nbsp;<span class="op" id="5227237">!=</span>&nbsp;<span class="builtintype" id="5227240">nil</span>&nbsp;<span class="op" id="5227244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227248"><a href="/gostd/database/sql/sql.go.html#5226574">releaseConn</a></span><span class="op" id="5227259">(</span><span class="ident" id="5227260"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span><span class="op" id="5227263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227267">return</span>&nbsp;<span class="builtintype" id="5227274">nil</span><span class="op" id="5227277">,</span>&nbsp;<span class="ident" id="5227279"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227288">ds</span>&nbsp;<span class="op" id="5227291">:=</span>&nbsp;<span class="ident" id="5227294"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5227304">{</span><span class="ident" id="5227305"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227307">,</span>&nbsp;<span class="ident" id="5227309"><a href="/gostd/database/sql/sql.go.html#5227184">si</a></span><span class="op" id="5227311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227314">rowsi</span><span class="op" id="5227319">,</span>&nbsp;<span class="ident" id="5227321"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span>&nbsp;<span class="op" id="5227325">:=</span>&nbsp;<span class="ident" id="5227328"><a href="/gostd/database/sql/sql.go.html#5239225">rowsiFromStatement</a></span><span class="op" id="5227346">(</span><span class="ident" id="5227347"><a href="/gostd/database/sql/sql.go.html#5227288">ds</a></span><span class="op" id="5227349">,</span>&nbsp;<span class="ident" id="5227351"><a href="/gostd/database/sql/sql.go.html#5226613">args</a></span><span class="op" id="5227355">...</span><span class="op" id="5227358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227361">if</span>&nbsp;<span class="ident" id="5227364"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span>&nbsp;<span class="op" id="5227368">!=</span>&nbsp;<span class="builtintype" id="5227371">nil</span>&nbsp;<span class="op" id="5227375">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227379"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227381">.</span><span class="ident" id="5227382"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5227386">(</span><span class="op" id="5227387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227391"><a href="/gostd/database/sql/sql.go.html#5227184">si</a></span><span class="op" id="5227393">.</span><span class="ident" id="5227394"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5227399">(</span><span class="op" id="5227400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227404"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227406">.</span><span class="ident" id="5227407"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5227413">(</span><span class="op" id="5227414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227418"><a href="/gostd/database/sql/sql.go.html#5226574">releaseConn</a></span><span class="op" id="5227429">(</span><span class="ident" id="5227430"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span><span class="op" id="5227433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227437">return</span>&nbsp;<span class="builtintype" id="5227444">nil</span><span class="op" id="5227447">,</span>&nbsp;<span class="ident" id="5227449"><a href="/gostd/database/sql/sql.go.html#5227188">err</a></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227458">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;ci&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227517">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227539">rows</span>&nbsp;<span class="op" id="5227544">:=</span>&nbsp;<span class="op" id="5227547">&amp;</span><span class="ident" id="5227548"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5227552">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227556"><a href="/gostd/database/sql/sql.go.html#5241514">dc</a></span><span class="op" id="5227558">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227569"><a href="/gostd/database/sql/sql.go.html#5226558">dc</a></span><span class="op" id="5227571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227575"><a href="/gostd/database/sql/sql.go.html#5241594">releaseConn</a></span><span class="op" id="5227586">:</span>&nbsp;<span class="ident" id="5227588"><a href="/gostd/database/sql/sql.go.html#5226574">releaseConn</a></span><span class="op" id="5227599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227603"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5227608">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227616"><a href="/gostd/database/sql/sql.go.html#5227314">rowsi</a></span><span class="op" id="5227621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227625"><a href="/gostd/database/sql/sql.go.html#5241744">closeStmt</a></span><span class="op" id="5227634">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5227638"><a href="/gostd/database/sql/sql.go.html#5227184">si</a></span><span class="op" id="5227640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227643">}</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227646">return</span>&nbsp;<span class="ident" id="5227653"><a href="/gostd/database/sql/sql.go.html#5227539">rows</a></span><span class="op" id="5227657">,</span>&nbsp;<span class="builtintype" id="5227659">nil</span><br>
<span class="lineno"></span><span class="op" id="5227663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5227666">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;return&nbsp;at&nbsp;most&nbsp;one&nbsp;row.</span><br>
<span class="lineno"></span><span class="comment" id="5227739">//&nbsp;QueryRow&nbsp;always&nbsp;return&nbsp;a&nbsp;non-nil&nbsp;value.&nbsp;Errors&nbsp;are&nbsp;deferred&nbsp;until</span><br>
<span class="lineno">1000</span><span class="comment" id="5227808">//&nbsp;Row&#39;s&nbsp;Scan&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="keyword" id="5227840">func</span>&nbsp;<span class="op" id="5227845">(</span><span class="ident" id="5227846">db</span>&nbsp;<span class="op" id="5227849">*</span><span class="ident" id="5227850"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5227852">)</span>&nbsp;<span class="ident" id="5227854">QueryRow</span><span class="op" id="5227862">(</span><span class="ident" id="5227863">query</span>&nbsp;<span class="builtintype" id="5227869">string</span><span class="op" id="5227875">,</span>&nbsp;<span class="ident" id="5227877">args</span>&nbsp;<span class="op" id="5227882">...</span><span class="keyword" id="5227885">interface</span><span class="op" id="5227894">{</span><span class="op" id="5227895">}</span><span class="op" id="5227896">)</span>&nbsp;<span class="op" id="5227898">*</span><span class="ident" id="5227899"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span>&nbsp;<span class="op" id="5227903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227906">rows</span><span class="op" id="5227910">,</span>&nbsp;<span class="ident" id="5227912">err</span>&nbsp;<span class="op" id="5227916">:=</span>&nbsp;<span class="ident" id="5227919"><a href="/gostd/database/sql/sql.go.html#5227846">db</a></span><span class="op" id="5227921">.</span><span class="ident" id="5227922"><a href="/gostd/database/sql/sql.go.html#5225993">Query</a></span><span class="op" id="5227927">(</span><span class="ident" id="5227928"><a href="/gostd/database/sql/sql.go.html#5227863">query</a></span><span class="op" id="5227933">,</span>&nbsp;<span class="ident" id="5227935"><a href="/gostd/database/sql/sql.go.html#5227877">args</a></span><span class="op" id="5227939">...</span><span class="op" id="5227942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5227945">return</span>&nbsp;<span class="op" id="5227952">&amp;</span><span class="ident" id="5227953"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span><span class="op" id="5227956">{</span><span class="ident" id="5227957"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5227961">:</span>&nbsp;<span class="ident" id="5227963"><a href="/gostd/database/sql/sql.go.html#5227906">rows</a></span><span class="op" id="5227967">,</span>&nbsp;<span class="ident" id="5227969"><a href="/gostd/database/sql/sql.go.html#5244803">err</a></span><span class="op" id="5227972">:</span>&nbsp;<span class="ident" id="5227974"><a href="/gostd/database/sql/sql.go.html#5227912">err</a></span><span class="op" id="5227977">}</span><br>
<span class="lineno"></span><span class="op" id="5227979">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5227982">//&nbsp;Begin&nbsp;starts&nbsp;a&nbsp;transaction.&nbsp;The&nbsp;isolation&nbsp;level&nbsp;is&nbsp;dependent&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="5228049">//&nbsp;the&nbsp;driver.</span><br>
<span class="lineno"></span><span class="keyword" id="5228064">func</span>&nbsp;<span class="op" id="5228069">(</span><span class="ident" id="5228070">db</span>&nbsp;<span class="op" id="5228073">*</span><span class="ident" id="5228074"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5228076">)</span>&nbsp;<span class="ident" id="5228078">Begin</span><span class="op" id="5228083">(</span><span class="op" id="5228084">)</span>&nbsp;<span class="op" id="5228086">(</span><span class="op" id="5228087">*</span><span class="ident" id="5228088"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5228090">,</span>&nbsp;<span class="builtintype" id="5228092">error</span><span class="op" id="5228097">)</span>&nbsp;<span class="op" id="5228099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228102">var</span>&nbsp;<span class="ident" id="5228106">tx</span>&nbsp;<span class="op" id="5228109">*</span><span class="ident" id="5228110"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228114">var</span>&nbsp;<span class="ident" id="5228118">err</span>&nbsp;<span class="builtintype" id="5228122">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228129">for</span>&nbsp;<span class="ident" id="5228133">i</span>&nbsp;<span class="op" id="5228135">:=</span>&nbsp;<span class="num" id="5228138">0</span><span class="op" id="5228139">;</span>&nbsp;<span class="ident" id="5228141"><a href="/gostd/database/sql/sql.go.html#5228133">i</a></span>&nbsp;<span class="op" id="5228143">&lt;</span>&nbsp;<span class="ident" id="5228145"><a href="/gostd/database/sql/sql.go.html#5223659">maxBadConnRetries</a></span><span class="op" id="5228162">;</span>&nbsp;<span class="ident" id="5228164"><a href="/gostd/database/sql/sql.go.html#5228133">i</a></span><span class="op" id="5228165">++</span>&nbsp;<span class="op" id="5228168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228172"><a href="/gostd/database/sql/sql.go.html#5228106">tx</a></span><span class="op" id="5228174">,</span>&nbsp;<span class="ident" id="5228176"><a href="/gostd/database/sql/sql.go.html#5228118">err</a></span>&nbsp;<span class="op" id="5228180">=</span>&nbsp;<span class="ident" id="5228182"><a href="/gostd/database/sql/sql.go.html#5228070">db</a></span><span class="op" id="5228184">.</span><span class="ident" id="5228185"><a href="/gostd/database/sql/sql.go.html#5228274">begin</a></span><span class="op" id="5228190">(</span><span class="op" id="5228191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228195">if</span>&nbsp;<span class="ident" id="5228198"><a href="/gostd/database/sql/sql.go.html#5228118">err</a></span>&nbsp;<span class="op" id="5228202">!=</span>&nbsp;<span class="ident" id="5228205"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5228211">.</span><span class="ident" id="5228212"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5228223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228228">break</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228242">return</span>&nbsp;<span class="ident" id="5228249"><a href="/gostd/database/sql/sql.go.html#5228106">tx</a></span><span class="op" id="5228251">,</span>&nbsp;<span class="ident" id="5228253"><a href="/gostd/database/sql/sql.go.html#5228118">err</a></span><br>
<span class="lineno"></span><span class="op" id="5228257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1020</span><span class="keyword" id="5228260">func</span>&nbsp;<span class="op" id="5228265">(</span><span class="ident" id="5228266">db</span>&nbsp;<span class="op" id="5228269">*</span><span class="ident" id="5228270"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5228272">)</span>&nbsp;<span class="ident" id="5228274">begin</span><span class="op" id="5228279">(</span><span class="op" id="5228280">)</span>&nbsp;<span class="op" id="5228282">(</span><span class="ident" id="5228283">tx</span>&nbsp;<span class="op" id="5228286">*</span><span class="ident" id="5228287"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5228289">,</span>&nbsp;<span class="ident" id="5228291">err</span>&nbsp;<span class="builtintype" id="5228295">error</span><span class="op" id="5228300">)</span>&nbsp;<span class="op" id="5228302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228305">dc</span><span class="op" id="5228307">,</span>&nbsp;<span class="ident" id="5228309"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span>&nbsp;<span class="op" id="5228313">:=</span>&nbsp;<span class="ident" id="5228316"><a href="/gostd/database/sql/sql.go.html#5228266">db</a></span><span class="op" id="5228318">.</span><span class="ident" id="5228319"><a href="/gostd/database/sql/sql.go.html#5218439">conn</a></span><span class="op" id="5228323">(</span><span class="op" id="5228324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228327">if</span>&nbsp;<span class="ident" id="5228330"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span>&nbsp;<span class="op" id="5228334">!=</span>&nbsp;<span class="builtintype" id="5228337">nil</span>&nbsp;<span class="op" id="5228341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228345">return</span>&nbsp;<span class="builtintype" id="5228352">nil</span><span class="op" id="5228355">,</span>&nbsp;<span class="ident" id="5228357"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228362">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228365"><a href="/gostd/database/sql/sql.go.html#5228305">dc</a></span><span class="op" id="5228367">.</span><span class="ident" id="5228368"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5228372">(</span><span class="op" id="5228373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228376">txi</span><span class="op" id="5228379">,</span>&nbsp;<span class="ident" id="5228381"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span>&nbsp;<span class="op" id="5228385">:=</span>&nbsp;<span class="ident" id="5228388"><a href="/gostd/database/sql/sql.go.html#5228305">dc</a></span><span class="op" id="5228390">.</span><span class="ident" id="5228391"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5228393">.</span><span class="ident" id="5228394"><a href="/gostd/database/sql/driver/driver.go.html#5250817">Begin</a></span><span class="op" id="5228399">(</span><span class="op" id="5228400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228403"><a href="/gostd/database/sql/sql.go.html#5228305">dc</a></span><span class="op" id="5228405">.</span><span class="ident" id="5228406"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5228412">(</span><span class="op" id="5228413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228416">if</span>&nbsp;<span class="ident" id="5228419"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span>&nbsp;<span class="op" id="5228423">!=</span>&nbsp;<span class="builtintype" id="5228426">nil</span>&nbsp;<span class="op" id="5228430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228434"><a href="/gostd/database/sql/sql.go.html#5228266">db</a></span><span class="op" id="5228436">.</span><span class="ident" id="5228437"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5228444">(</span><span class="ident" id="5228445"><a href="/gostd/database/sql/sql.go.html#5228305">dc</a></span><span class="op" id="5228447">,</span>&nbsp;<span class="ident" id="5228449"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span><span class="op" id="5228452">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228456">return</span>&nbsp;<span class="builtintype" id="5228463">nil</span><span class="op" id="5228466">,</span>&nbsp;<span class="ident" id="5228468"><a href="/gostd/database/sql/sql.go.html#5228291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228476">return</span>&nbsp;<span class="op" id="5228483">&amp;</span><span class="ident" id="5228484"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5228486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228490"><a href="/gostd/database/sql/sql.go.html#5228873">db</a></span><span class="op" id="5228492">:</span>&nbsp;&nbsp;<span class="ident" id="5228495"><a href="/gostd/database/sql/sql.go.html#5228266">db</a></span><span class="op" id="5228497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228501"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5228503">:</span>&nbsp;&nbsp;<span class="ident" id="5228506"><a href="/gostd/database/sql/sql.go.html#5228305">dc</a></span><span class="op" id="5228508">,</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228512"><a href="/gostd/database/sql/sql.go.html#5229000">txi</a></span><span class="op" id="5228515">:</span>&nbsp;<span class="ident" id="5228517"><a href="/gostd/database/sql/sql.go.html#5228376">txi</a></span><span class="op" id="5228520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5228523">}</span><span class="op" id="5228524">,</span>&nbsp;<span class="builtintype" id="5228526">nil</span><br>
<span class="lineno"></span><span class="op" id="5228530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228533">//&nbsp;Driver&nbsp;returns&nbsp;the&nbsp;database&#39;s&nbsp;underlying&nbsp;driver.</span><br>
<span class="lineno">1040</span><span class="keyword" id="5228585">func</span>&nbsp;<span class="op" id="5228590">(</span><span class="ident" id="5228591">db</span>&nbsp;<span class="op" id="5228594">*</span><span class="ident" id="5228595"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><span class="op" id="5228597">)</span>&nbsp;<span class="ident" id="5228599">Driver</span><span class="op" id="5228605">(</span><span class="op" id="5228606">)</span>&nbsp;<span class="ident" id="5228608"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5228614">.</span><span class="ident" id="5228615"><a href="/gostd/database/sql/driver/driver.go.html#5248151">Driver</a></span>&nbsp;<span class="op" id="5228622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5228625">return</span>&nbsp;<span class="ident" id="5228632"><a href="/gostd/database/sql/sql.go.html#5228591">db</a></span><span class="op" id="5228634">.</span><span class="ident" id="5228635"><a href="/gostd/database/sql/sql.go.html#5207171">driver</a></span><br>
<span class="lineno"></span><span class="op" id="5228642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228645">//&nbsp;Tx&nbsp;is&nbsp;an&nbsp;in-progress&nbsp;database&nbsp;transaction.</span><br>
<span class="lineno">1045</span><span class="comment" id="5228691">//</span><br>
<span class="lineno"></span><span class="comment" id="5228694">//&nbsp;A&nbsp;transaction&nbsp;must&nbsp;end&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Commit&nbsp;or&nbsp;Rollback.</span><br>
<span class="lineno"></span><span class="comment" id="5228755">//</span><br>
<span class="lineno"></span><span class="comment" id="5228758">//&nbsp;After&nbsp;a&nbsp;call&nbsp;to&nbsp;Commit&nbsp;or&nbsp;Rollback,&nbsp;all&nbsp;operations&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5228819">//&nbsp;transaction&nbsp;fail&nbsp;with&nbsp;ErrTxDone.</span><br>
<span class="lineno">1050</span><span class="keyword" id="5228855">type</span>&nbsp;<span class="ident" id="5228860">Tx</span>&nbsp;<span class="keyword" id="5228863">struct</span>&nbsp;<span class="op" id="5228870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228873">db</span>&nbsp;<span class="op" id="5228876">*</span><span class="ident" id="5228877"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228882">//&nbsp;dc&nbsp;is&nbsp;owned&nbsp;exclusively&nbsp;until&nbsp;Commit&nbsp;or&nbsp;Rollback,&nbsp;at&nbsp;which&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5228951">//&nbsp;it&#39;s&nbsp;returned&nbsp;with&nbsp;putConn.</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5228983">dc</span>&nbsp;&nbsp;<span class="op" id="5228987">*</span><span class="ident" id="5228988"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229000">txi</span>&nbsp;<span class="ident" id="5229004"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5229010">.</span><span class="ident" id="5229011"><a href="/gostd/database/sql/driver/driver.go.html#5253371">Tx</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229016">//&nbsp;done&nbsp;transitions&nbsp;from&nbsp;false&nbsp;to&nbsp;true&nbsp;exactly&nbsp;once,&nbsp;on&nbsp;Commit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229080">//&nbsp;or&nbsp;Rollback.&nbsp;once&nbsp;done,&nbsp;all&nbsp;operations&nbsp;fail&nbsp;with</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229133">//&nbsp;ErrTxDone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229148">done</span>&nbsp;<span class="builtintype" id="5229153">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229160">//&nbsp;All&nbsp;Stmts&nbsp;prepared&nbsp;for&nbsp;this&nbsp;transaction.&nbsp;&nbsp;These&nbsp;will&nbsp;be&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5229237">//&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229288">stmts</span>&nbsp;<span class="keyword" id="5229294">struct</span>&nbsp;<span class="op" id="5229301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229305"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5229309">.</span><span class="ident" id="5229310"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229318">v</span>&nbsp;<span class="op" id="5229320">[</span><span class="op" id="5229321">]</span><span class="op" id="5229322">*</span><span class="ident" id="5229323"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229329">}</span><br>
<span class="lineno"></span><span class="op" id="5229331">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="5229334">var</span>&nbsp;<span class="ident" id="5229338">ErrTxDone</span>&nbsp;<span class="op" id="5229348">=</span>&nbsp;<span class="ident" id="5229350"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5229356">.</span><span class="ident" id="5229357"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5229360">(</span><span class="string" id="5229361">&#34;sql:&nbsp;Transaction&nbsp;has&nbsp;already&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back&#34;</span><span class="op" id="5229421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5229424">func</span>&nbsp;<span class="op" id="5229429">(</span><span class="ident" id="5229430">tx</span>&nbsp;<span class="op" id="5229433">*</span><span class="ident" id="5229434"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5229436">)</span>&nbsp;<span class="builtinfunc" id="5229438">close</span><span class="op" id="5229443">(</span><span class="op" id="5229444">)</span>&nbsp;<span class="op" id="5229446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229449">if</span>&nbsp;<span class="ident" id="5229452"><a href="/gostd/database/sql/sql.go.html#5229430">tx</a></span><span class="op" id="5229454">.</span><span class="ident" id="5229455"><a href="/gostd/database/sql/sql.go.html#5229148">done</a></span>&nbsp;<span class="op" id="5229460">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5229464">panic</span><span class="op" id="5229469">(</span><span class="string" id="5229470">&#34;double&nbsp;close&#34;</span><span class="op" id="5229484">)</span>&nbsp;<span class="comment" id="5229486">//&nbsp;internal&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229508"><a href="/gostd/database/sql/sql.go.html#5229430">tx</a></span><span class="op" id="5229510">.</span><span class="ident" id="5229511"><a href="/gostd/database/sql/sql.go.html#5229148">done</a></span>&nbsp;<span class="op" id="5229516">=</span>&nbsp;<span class="builtintype" id="5229518">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229524"><a href="/gostd/database/sql/sql.go.html#5229430">tx</a></span><span class="op" id="5229526">.</span><span class="ident" id="5229527"><a href="/gostd/database/sql/sql.go.html#5228873">db</a></span><span class="op" id="5229529">.</span><span class="ident" id="5229530"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5229537">(</span><span class="ident" id="5229538"><a href="/gostd/database/sql/sql.go.html#5229430">tx</a></span><span class="op" id="5229540">.</span><span class="ident" id="5229541"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5229543">,</span>&nbsp;<span class="builtintype" id="5229545">nil</span><span class="op" id="5229548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229551"><a href="/gostd/database/sql/sql.go.html#5229430">tx</a></span><span class="op" id="5229553">.</span><span class="ident" id="5229554"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span>&nbsp;<span class="op" id="5229557">=</span>&nbsp;<span class="builtintype" id="5229559">nil</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229564"><a href="/gostd/database/sql/sql.go.html#5229430">tx</a></span><span class="op" id="5229566">.</span><span class="ident" id="5229567"><a href="/gostd/database/sql/sql.go.html#5229000">txi</a></span>&nbsp;<span class="op" id="5229571">=</span>&nbsp;<span class="builtintype" id="5229573">nil</span><br>
<span class="lineno"></span><span class="op" id="5229577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5229580">func</span>&nbsp;<span class="op" id="5229585">(</span><span class="ident" id="5229586">tx</span>&nbsp;<span class="op" id="5229589">*</span><span class="ident" id="5229590"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5229592">)</span>&nbsp;<span class="ident" id="5229594">grabConn</span><span class="op" id="5229602">(</span><span class="op" id="5229603">)</span>&nbsp;<span class="op" id="5229605">(</span><span class="op" id="5229606">*</span><span class="ident" id="5229607"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5229617">,</span>&nbsp;<span class="builtintype" id="5229619">error</span><span class="op" id="5229624">)</span>&nbsp;<span class="op" id="5229626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229629">if</span>&nbsp;<span class="ident" id="5229632"><a href="/gostd/database/sql/sql.go.html#5229586">tx</a></span><span class="op" id="5229634">.</span><span class="ident" id="5229635"><a href="/gostd/database/sql/sql.go.html#5229148">done</a></span>&nbsp;<span class="op" id="5229640">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229644">return</span>&nbsp;<span class="builtintype" id="5229651">nil</span><span class="op" id="5229654">,</span>&nbsp;<span class="ident" id="5229656"><a href="/gostd/database/sql/sql.go.html#5229338">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229670">return</span>&nbsp;<span class="ident" id="5229677"><a href="/gostd/database/sql/sql.go.html#5229586">tx</a></span><span class="op" id="5229679">.</span><span class="ident" id="5229680"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5229682">,</span>&nbsp;<span class="builtintype" id="5229684">nil</span><br>
<span class="lineno"></span><span class="op" id="5229688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span><span class="comment" id="5229691">//&nbsp;Closes&nbsp;all&nbsp;Stmts&nbsp;prepared&nbsp;for&nbsp;this&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5229742">func</span>&nbsp;<span class="op" id="5229747">(</span><span class="ident" id="5229748">tx</span>&nbsp;<span class="op" id="5229751">*</span><span class="ident" id="5229752"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5229754">)</span>&nbsp;<span class="ident" id="5229756">closePrepared</span><span class="op" id="5229769">(</span><span class="op" id="5229770">)</span>&nbsp;<span class="op" id="5229772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229775"><a href="/gostd/database/sql/sql.go.html#5229748">tx</a></span><span class="op" id="5229777">.</span><span class="ident" id="5229778"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5229783">.</span><span class="ident" id="5229784"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5229788">(</span><span class="op" id="5229789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229792">for</span>&nbsp;<span class="ident" id="5229796">_</span><span class="op" id="5229797">,</span>&nbsp;<span class="ident" id="5229799">stmt</span>&nbsp;<span class="op" id="5229804">:=</span>&nbsp;<span class="keyword" id="5229807">range</span>&nbsp;<span class="ident" id="5229813"><a href="/gostd/database/sql/sql.go.html#5229748">tx</a></span><span class="op" id="5229815">.</span><span class="ident" id="5229816"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5229821">.</span><span class="ident" id="5229822"><a href="/gostd/database/sql/sql.go.html#5229318">v</a></span>&nbsp;<span class="op" id="5229824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229828"><a href="/gostd/database/sql/sql.go.html#5229799">stmt</a></span><span class="op" id="5229832">.</span><span class="ident" id="5229833"><a href="/gostd/database/sql/sql.go.html#5240529">Close</a></span><span class="op" id="5229838">(</span><span class="op" id="5229839">)</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229845"><a href="/gostd/database/sql/sql.go.html#5229748">tx</a></span><span class="op" id="5229847">.</span><span class="ident" id="5229848"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5229853">.</span><span class="ident" id="5229854"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5229860">(</span><span class="op" id="5229861">)</span><br>
<span class="lineno"></span><span class="op" id="5229863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5229866">//&nbsp;Commit&nbsp;commits&nbsp;the&nbsp;transaction.</span><br>
<span class="lineno">1100</span><span class="keyword" id="5229901">func</span>&nbsp;<span class="op" id="5229906">(</span><span class="ident" id="5229907">tx</span>&nbsp;<span class="op" id="5229910">*</span><span class="ident" id="5229911"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5229913">)</span>&nbsp;<span class="ident" id="5229915">Commit</span><span class="op" id="5229921">(</span><span class="op" id="5229922">)</span>&nbsp;<span class="builtintype" id="5229924">error</span>&nbsp;<span class="op" id="5229930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229933">if</span>&nbsp;<span class="ident" id="5229936"><a href="/gostd/database/sql/sql.go.html#5229907">tx</a></span><span class="op" id="5229938">.</span><span class="ident" id="5229939"><a href="/gostd/database/sql/sql.go.html#5229148">done</a></span>&nbsp;<span class="op" id="5229944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229948">return</span>&nbsp;<span class="ident" id="5229955"><a href="/gostd/database/sql/sql.go.html#5229338">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5229966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5229969">defer</span>&nbsp;<span class="ident" id="5229975"><a href="/gostd/database/sql/sql.go.html#5229907">tx</a></span><span class="op" id="5229977">.</span><span class="builtinfunc" id="5229978"><a href="/gostd/database/sql/sql.go.html#5229438">close</a></span><span class="op" id="5229983">(</span><span class="op" id="5229984">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5229987"><a href="/gostd/database/sql/sql.go.html#5229907">tx</a></span><span class="op" id="5229989">.</span><span class="ident" id="5229990"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5229992">.</span><span class="ident" id="5229993"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5229997">(</span><span class="op" id="5229998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230001">err</span>&nbsp;<span class="op" id="5230005">:=</span>&nbsp;<span class="ident" id="5230008"><a href="/gostd/database/sql/sql.go.html#5229907">tx</a></span><span class="op" id="5230010">.</span><span class="ident" id="5230011"><a href="/gostd/database/sql/sql.go.html#5229000">txi</a></span><span class="op" id="5230014">.</span><span class="ident" id="5230015"><a href="/gostd/database/sql/driver/driver.go.html#5253387">Commit</a></span><span class="op" id="5230021">(</span><span class="op" id="5230022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230025"><a href="/gostd/database/sql/sql.go.html#5229907">tx</a></span><span class="op" id="5230027">.</span><span class="ident" id="5230028"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5230030">.</span><span class="ident" id="5230031"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5230037">(</span><span class="op" id="5230038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230041">if</span>&nbsp;<span class="ident" id="5230044"><a href="/gostd/database/sql/sql.go.html#5230001">err</a></span>&nbsp;<span class="op" id="5230048">!=</span>&nbsp;<span class="ident" id="5230051"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5230057">.</span><span class="ident" id="5230058"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5230069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230073"><a href="/gostd/database/sql/sql.go.html#5229907">tx</a></span><span class="op" id="5230075">.</span><span class="ident" id="5230076"><a href="/gostd/database/sql/sql.go.html#5229756">closePrepared</a></span><span class="op" id="5230089">(</span><span class="op" id="5230090">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230096">return</span>&nbsp;<span class="ident" id="5230103"><a href="/gostd/database/sql/sql.go.html#5230001">err</a></span><br>
<span class="lineno"></span><span class="op" id="5230107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5230110">//&nbsp;Rollback&nbsp;aborts&nbsp;the&nbsp;transaction.</span><br>
<span class="lineno">1115</span><span class="keyword" id="5230146">func</span>&nbsp;<span class="op" id="5230151">(</span><span class="ident" id="5230152">tx</span>&nbsp;<span class="op" id="5230155">*</span><span class="ident" id="5230156"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5230158">)</span>&nbsp;<span class="ident" id="5230160">Rollback</span><span class="op" id="5230168">(</span><span class="op" id="5230169">)</span>&nbsp;<span class="builtintype" id="5230171">error</span>&nbsp;<span class="op" id="5230177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230180">if</span>&nbsp;<span class="ident" id="5230183"><a href="/gostd/database/sql/sql.go.html#5230152">tx</a></span><span class="op" id="5230185">.</span><span class="ident" id="5230186"><a href="/gostd/database/sql/sql.go.html#5229148">done</a></span>&nbsp;<span class="op" id="5230191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230195">return</span>&nbsp;<span class="ident" id="5230202"><a href="/gostd/database/sql/sql.go.html#5229338">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230216">defer</span>&nbsp;<span class="ident" id="5230222"><a href="/gostd/database/sql/sql.go.html#5230152">tx</a></span><span class="op" id="5230224">.</span><span class="builtinfunc" id="5230225"><a href="/gostd/database/sql/sql.go.html#5229438">close</a></span><span class="op" id="5230230">(</span><span class="op" id="5230231">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230234"><a href="/gostd/database/sql/sql.go.html#5230152">tx</a></span><span class="op" id="5230236">.</span><span class="ident" id="5230237"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5230239">.</span><span class="ident" id="5230240"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5230244">(</span><span class="op" id="5230245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230248">err</span>&nbsp;<span class="op" id="5230252">:=</span>&nbsp;<span class="ident" id="5230255"><a href="/gostd/database/sql/sql.go.html#5230152">tx</a></span><span class="op" id="5230257">.</span><span class="ident" id="5230258"><a href="/gostd/database/sql/sql.go.html#5229000">txi</a></span><span class="op" id="5230261">.</span><span class="ident" id="5230262"><a href="/gostd/database/sql/driver/driver.go.html#5253403">Rollback</a></span><span class="op" id="5230270">(</span><span class="op" id="5230271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230274"><a href="/gostd/database/sql/sql.go.html#5230152">tx</a></span><span class="op" id="5230276">.</span><span class="ident" id="5230277"><a href="/gostd/database/sql/sql.go.html#5228983">dc</a></span><span class="op" id="5230279">.</span><span class="ident" id="5230280"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5230286">(</span><span class="op" id="5230287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230290">if</span>&nbsp;<span class="ident" id="5230293"><a href="/gostd/database/sql/sql.go.html#5230248">err</a></span>&nbsp;<span class="op" id="5230297">!=</span>&nbsp;<span class="ident" id="5230300"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5230306">.</span><span class="ident" id="5230307"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5230318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5230322"><a href="/gostd/database/sql/sql.go.html#5230152">tx</a></span><span class="op" id="5230324">.</span><span class="ident" id="5230325"><a href="/gostd/database/sql/sql.go.html#5229756">closePrepared</a></span><span class="op" id="5230338">(</span><span class="op" id="5230339">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5230342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5230345">return</span>&nbsp;<span class="ident" id="5230352"><a href="/gostd/database/sql/sql.go.html#5230248">err</a></span><br>
<span class="lineno"></span><span class="op" id="5230356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5230359">//&nbsp;Prepare&nbsp;creates&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;for&nbsp;use&nbsp;within&nbsp;a&nbsp;transaction.</span><br>
<span class="lineno">1130</span><span class="comment" id="5230429">//</span><br>
<span class="lineno"></span><span class="comment" id="5230432">//&nbsp;The&nbsp;returned&nbsp;statement&nbsp;operates&nbsp;within&nbsp;the&nbsp;transaction&nbsp;and&nbsp;can&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="5230508">//&nbsp;be&nbsp;used&nbsp;once&nbsp;the&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back.</span><br>
<span class="lineno"></span><span class="comment" id="5230575">//</span><br>
<span class="lineno"></span><span class="comment" id="5230578">//&nbsp;To&nbsp;use&nbsp;an&nbsp;existing&nbsp;prepared&nbsp;statement&nbsp;on&nbsp;this&nbsp;transaction,&nbsp;see&nbsp;Tx.Stmt.</span><br>
<span class="lineno">1135</span><span class="keyword" id="5230653">func</span>&nbsp;<span class="op" id="5230658">(</span><span class="ident" id="5230659">tx</span>&nbsp;<span class="op" id="5230662">*</span><span class="ident" id="5230663"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5230665">)</span>&nbsp;<span class="ident" id="5230667">Prepare</span><span class="op" id="5230674">(</span><span class="ident" id="5230675">query</span>&nbsp;<span class="builtintype" id="5230681">string</span><span class="op" id="5230687">)</span>&nbsp;<span class="op" id="5230689">(</span><span class="op" id="5230690">*</span><span class="ident" id="5230691"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5230695">,</span>&nbsp;<span class="builtintype" id="5230697">error</span><span class="op" id="5230702">)</span>&nbsp;<span class="op" id="5230704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230707">//&nbsp;TODO(bradfitz):&nbsp;We&nbsp;could&nbsp;be&nbsp;more&nbsp;efficient&nbsp;here&nbsp;and&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230770">//&nbsp;provide&nbsp;a&nbsp;method&nbsp;to&nbsp;take&nbsp;an&nbsp;existing&nbsp;Stmt&nbsp;(created&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230828">//&nbsp;perhaps&nbsp;a&nbsp;different&nbsp;Conn),&nbsp;and&nbsp;re-create&nbsp;it&nbsp;on&nbsp;this&nbsp;Conn&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230892">//&nbsp;necessary.&nbsp;Or,&nbsp;better:&nbsp;keep&nbsp;a&nbsp;map&nbsp;in&nbsp;DB&nbsp;of&nbsp;query&nbsp;string&nbsp;to</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5230955">//&nbsp;Stmts,&nbsp;and&nbsp;have&nbsp;Stmt.Execute&nbsp;do&nbsp;the&nbsp;right&nbsp;thing&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231011">//&nbsp;re-prepare&nbsp;if&nbsp;the&nbsp;Conn&nbsp;in&nbsp;use&nbsp;doesn&#39;t&nbsp;have&nbsp;that&nbsp;prepared</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231072">//&nbsp;statement.&nbsp;&nbsp;But&nbsp;we&#39;ll&nbsp;want&nbsp;to&nbsp;avoid&nbsp;caching&nbsp;the&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231134">//&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;only&nbsp;call&nbsp;conn.Prepare&nbsp;implicitly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231193">//&nbsp;(such&nbsp;as&nbsp;in&nbsp;db.Exec&nbsp;or&nbsp;tx.Exec),&nbsp;but&nbsp;the&nbsp;caller&nbsp;package</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231253">//&nbsp;can&#39;t&nbsp;be&nbsp;holding&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;returned&nbsp;statement.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231313">//&nbsp;Perhaps&nbsp;just&nbsp;looking&nbsp;at&nbsp;the&nbsp;reference&nbsp;count&nbsp;(by&nbsp;noting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231372">//&nbsp;Stmt.Close)&nbsp;would&nbsp;be&nbsp;enough.&nbsp;We&nbsp;might&nbsp;also&nbsp;want&nbsp;a&nbsp;finalizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5231436">//&nbsp;on&nbsp;Stmt&nbsp;to&nbsp;drop&nbsp;the&nbsp;reference&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231477">dc</span><span class="op" id="5231479">,</span>&nbsp;<span class="ident" id="5231481">err</span>&nbsp;<span class="op" id="5231485">:=</span>&nbsp;<span class="ident" id="5231488"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231490">.</span><span class="ident" id="5231491"><a href="/gostd/database/sql/sql.go.html#5229594">grabConn</a></span><span class="op" id="5231499">(</span><span class="op" id="5231500">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231503">if</span>&nbsp;<span class="ident" id="5231506"><a href="/gostd/database/sql/sql.go.html#5231481">err</a></span>&nbsp;<span class="op" id="5231510">!=</span>&nbsp;<span class="builtintype" id="5231513">nil</span>&nbsp;<span class="op" id="5231517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231521">return</span>&nbsp;<span class="builtintype" id="5231528">nil</span><span class="op" id="5231531">,</span>&nbsp;<span class="ident" id="5231533"><a href="/gostd/database/sql/sql.go.html#5231481">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231542"><a href="/gostd/database/sql/sql.go.html#5231477">dc</a></span><span class="op" id="5231544">.</span><span class="ident" id="5231545"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5231549">(</span><span class="op" id="5231550">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231553">si</span><span class="op" id="5231555">,</span>&nbsp;<span class="ident" id="5231557"><a href="/gostd/database/sql/sql.go.html#5231481">err</a></span>&nbsp;<span class="op" id="5231561">:=</span>&nbsp;<span class="ident" id="5231564"><a href="/gostd/database/sql/sql.go.html#5231477">dc</a></span><span class="op" id="5231566">.</span><span class="ident" id="5231567"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5231569">.</span><span class="ident" id="5231570"><a href="/gostd/database/sql/driver/driver.go.html#5250348">Prepare</a></span><span class="op" id="5231577">(</span><span class="ident" id="5231578"><a href="/gostd/database/sql/sql.go.html#5230675">query</a></span><span class="op" id="5231583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231586"><a href="/gostd/database/sql/sql.go.html#5231477">dc</a></span><span class="op" id="5231588">.</span><span class="ident" id="5231589"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5231595">(</span><span class="op" id="5231596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231599">if</span>&nbsp;<span class="ident" id="5231602"><a href="/gostd/database/sql/sql.go.html#5231481">err</a></span>&nbsp;<span class="op" id="5231606">!=</span>&nbsp;<span class="builtintype" id="5231609">nil</span>&nbsp;<span class="op" id="5231613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231617">return</span>&nbsp;<span class="builtintype" id="5231624">nil</span><span class="op" id="5231627">,</span>&nbsp;<span class="ident" id="5231629"><a href="/gostd/database/sql/sql.go.html#5231481">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231634">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231638">stmt</span>&nbsp;<span class="op" id="5231643">:=</span>&nbsp;<span class="op" id="5231646">&amp;</span><span class="ident" id="5231647"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5231651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231655"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5231657">:</span>&nbsp;<span class="ident" id="5231659"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231661">.</span><span class="ident" id="5231662"><a href="/gostd/database/sql/sql.go.html#5228873">db</a></span><span class="op" id="5231664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231668"><a href="/gostd/database/sql/sql.go.html#5234757">tx</a></span><span class="op" id="5231670">:</span>&nbsp;<span class="ident" id="5231672"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231678"><a href="/gostd/database/sql/sql.go.html#5234767">txsi</a></span><span class="op" id="5231682">:</span>&nbsp;<span class="op" id="5231684">&amp;</span><span class="ident" id="5231685"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5231695">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231700"><a href="/gostd/database/sql/sql.go.html#5210656">Locker</a></span><span class="op" id="5231706">:</span>&nbsp;<span class="ident" id="5231708"><a href="/gostd/database/sql/sql.go.html#5231477">dc</a></span><span class="op" id="5231710">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231715"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5231717">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231723"><a href="/gostd/database/sql/sql.go.html#5231553">si</a></span><span class="op" id="5231725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231729">}</span><span class="op" id="5231730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231734"><a href="/gostd/database/sql/sql.go.html#5234521">query</a></span><span class="op" id="5231739">:</span>&nbsp;<span class="ident" id="5231741"><a href="/gostd/database/sql/sql.go.html#5230675">query</a></span><span class="op" id="5231746">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5231749">}</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231752"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231754">.</span><span class="ident" id="5231755"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5231760">.</span><span class="ident" id="5231761"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5231765">(</span><span class="op" id="5231766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231769"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231771">.</span><span class="ident" id="5231772"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5231777">.</span><span class="ident" id="5231778"><a href="/gostd/database/sql/sql.go.html#5229318">v</a></span>&nbsp;<span class="op" id="5231780">=</span>&nbsp;<span class="builtinfunc" id="5231782">append</span><span class="op" id="5231788">(</span><span class="ident" id="5231789"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231791">.</span><span class="ident" id="5231792"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5231797">.</span><span class="ident" id="5231798"><a href="/gostd/database/sql/sql.go.html#5229318">v</a></span><span class="op" id="5231799">,</span>&nbsp;<span class="ident" id="5231801"><a href="/gostd/database/sql/sql.go.html#5231638">stmt</a></span><span class="op" id="5231805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5231808"><a href="/gostd/database/sql/sql.go.html#5230659">tx</a></span><span class="op" id="5231810">.</span><span class="ident" id="5231811"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5231816">.</span><span class="ident" id="5231817"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5231823">(</span><span class="op" id="5231824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5231827">return</span>&nbsp;<span class="ident" id="5231834"><a href="/gostd/database/sql/sql.go.html#5231638">stmt</a></span><span class="op" id="5231838">,</span>&nbsp;<span class="builtintype" id="5231840">nil</span><br>
<span class="lineno"></span><span class="op" id="5231844">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span><span class="comment" id="5231847">//&nbsp;Stmt&nbsp;returns&nbsp;a&nbsp;transaction-specific&nbsp;prepared&nbsp;statement&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5231910">//&nbsp;an&nbsp;existing&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5231936">//</span><br>
<span class="lineno"></span><span class="comment" id="5231939">//&nbsp;Example:</span><br>
<span class="lineno">1180</span><span class="comment" id="5231951">//&nbsp;&nbsp;updateMoney,&nbsp;err&nbsp;:=&nbsp;db.Prepare(&#34;UPDATE&nbsp;balance&nbsp;SET&nbsp;money=money+?&nbsp;WHERE&nbsp;id=?&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5232033">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5232041">//&nbsp;&nbsp;tx,&nbsp;err&nbsp;:=&nbsp;db.Begin()</span><br>
<span class="lineno"></span><span class="comment" id="5232067">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5232075">//&nbsp;&nbsp;res,&nbsp;err&nbsp;:=&nbsp;tx.Stmt(updateMoney).Exec(123.45,&nbsp;98293203)</span><br>
<span class="lineno">1185</span><span class="keyword" id="5232135">func</span>&nbsp;<span class="op" id="5232140">(</span><span class="ident" id="5232141">tx</span>&nbsp;<span class="op" id="5232144">*</span><span class="ident" id="5232145"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5232147">)</span>&nbsp;<span class="ident" id="5232149">Stmt</span><span class="op" id="5232153">(</span><span class="ident" id="5232154">stmt</span>&nbsp;<span class="op" id="5232159">*</span><span class="ident" id="5232160"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5232164">)</span>&nbsp;<span class="op" id="5232166">*</span><span class="ident" id="5232167"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span>&nbsp;<span class="op" id="5232172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232175">//&nbsp;TODO(bradfitz):&nbsp;optimize&nbsp;this.&nbsp;Currently&nbsp;this&nbsp;re-prepares</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232237">//&nbsp;each&nbsp;time.&nbsp;&nbsp;This&nbsp;is&nbsp;fine&nbsp;for&nbsp;now&nbsp;to&nbsp;illustrate&nbsp;the&nbsp;API&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232300">//&nbsp;we&nbsp;should&nbsp;really&nbsp;cache&nbsp;already-prepared&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232355">//&nbsp;per-Conn.&nbsp;See&nbsp;also&nbsp;the&nbsp;big&nbsp;comment&nbsp;in&nbsp;Tx.Prepare.</span><br>
<span class="lineno">1190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232410">if</span>&nbsp;<span class="ident" id="5232413"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232415">.</span><span class="ident" id="5232416"><a href="/gostd/database/sql/sql.go.html#5228873">db</a></span>&nbsp;<span class="op" id="5232419">!=</span>&nbsp;<span class="ident" id="5232422"><a href="/gostd/database/sql/sql.go.html#5232154">stmt</a></span><span class="op" id="5232426">.</span><span class="ident" id="5232427"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span>&nbsp;<span class="op" id="5232430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232434">return</span>&nbsp;<span class="op" id="5232441">&amp;</span><span class="ident" id="5232442"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5232446">{</span><span class="ident" id="5232447"><a href="/gostd/database/sql/sql.go.html#5234564">stickyErr</a></span><span class="op" id="5232456">:</span>&nbsp;<span class="ident" id="5232458"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5232464">.</span><span class="ident" id="5232465"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5232468">(</span><span class="string" id="5232469">&#34;sql:&nbsp;Tx.Stmt:&nbsp;statement&nbsp;from&nbsp;different&nbsp;database&nbsp;used&#34;</span><span class="op" id="5232523">)</span><span class="op" id="5232524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232530">dc</span><span class="op" id="5232532">,</span>&nbsp;<span class="ident" id="5232534">err</span>&nbsp;<span class="op" id="5232538">:=</span>&nbsp;<span class="ident" id="5232541"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232543">.</span><span class="ident" id="5232544"><a href="/gostd/database/sql/sql.go.html#5229594">grabConn</a></span><span class="op" id="5232552">(</span><span class="op" id="5232553">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232556">if</span>&nbsp;<span class="ident" id="5232559"><a href="/gostd/database/sql/sql.go.html#5232534">err</a></span>&nbsp;<span class="op" id="5232563">!=</span>&nbsp;<span class="builtintype" id="5232566">nil</span>&nbsp;<span class="op" id="5232570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232574">return</span>&nbsp;<span class="op" id="5232581">&amp;</span><span class="ident" id="5232582"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5232586">{</span><span class="ident" id="5232587"><a href="/gostd/database/sql/sql.go.html#5234564">stickyErr</a></span><span class="op" id="5232596">:</span>&nbsp;<span class="ident" id="5232598"><a href="/gostd/database/sql/sql.go.html#5232534">err</a></span><span class="op" id="5232601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232607"><a href="/gostd/database/sql/sql.go.html#5232530">dc</a></span><span class="op" id="5232609">.</span><span class="ident" id="5232610"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5232614">(</span><span class="op" id="5232615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232618">si</span><span class="op" id="5232620">,</span>&nbsp;<span class="ident" id="5232622"><a href="/gostd/database/sql/sql.go.html#5232534">err</a></span>&nbsp;<span class="op" id="5232626">:=</span>&nbsp;<span class="ident" id="5232629"><a href="/gostd/database/sql/sql.go.html#5232530">dc</a></span><span class="op" id="5232631">.</span><span class="ident" id="5232632"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5232634">.</span><span class="ident" id="5232635"><a href="/gostd/database/sql/driver/driver.go.html#5250348">Prepare</a></span><span class="op" id="5232642">(</span><span class="ident" id="5232643"><a href="/gostd/database/sql/sql.go.html#5232154">stmt</a></span><span class="op" id="5232647">.</span><span class="ident" id="5232648"><a href="/gostd/database/sql/sql.go.html#5234521">query</a></span><span class="op" id="5232653">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232656"><a href="/gostd/database/sql/sql.go.html#5232530">dc</a></span><span class="op" id="5232658">.</span><span class="ident" id="5232659"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5232665">(</span><span class="op" id="5232666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232669">txs</span>&nbsp;<span class="op" id="5232673">:=</span>&nbsp;<span class="op" id="5232676">&amp;</span><span class="ident" id="5232677"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5232681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232685"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5232687">:</span>&nbsp;<span class="ident" id="5232689"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232691">.</span><span class="ident" id="5232692"><a href="/gostd/database/sql/sql.go.html#5228873">db</a></span><span class="op" id="5232694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232698"><a href="/gostd/database/sql/sql.go.html#5234757">tx</a></span><span class="op" id="5232700">:</span>&nbsp;<span class="ident" id="5232702"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232708"><a href="/gostd/database/sql/sql.go.html#5234767">txsi</a></span><span class="op" id="5232712">:</span>&nbsp;<span class="op" id="5232714">&amp;</span><span class="ident" id="5232715"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5232725">{</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232730"><a href="/gostd/database/sql/sql.go.html#5210656">Locker</a></span><span class="op" id="5232736">:</span>&nbsp;<span class="ident" id="5232738"><a href="/gostd/database/sql/sql.go.html#5232530">dc</a></span><span class="op" id="5232740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232745"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5232747">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232753"><a href="/gostd/database/sql/sql.go.html#5232618">si</a></span><span class="op" id="5232755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232759">}</span><span class="op" id="5232760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232764"><a href="/gostd/database/sql/sql.go.html#5234521">query</a></span><span class="op" id="5232769">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232775"><a href="/gostd/database/sql/sql.go.html#5232154">stmt</a></span><span class="op" id="5232779">.</span><span class="ident" id="5232780"><a href="/gostd/database/sql/sql.go.html#5234521">query</a></span><span class="op" id="5232785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232789"><a href="/gostd/database/sql/sql.go.html#5234564">stickyErr</a></span><span class="op" id="5232798">:</span>&nbsp;<span class="ident" id="5232800"><a href="/gostd/database/sql/sql.go.html#5232534">err</a></span><span class="op" id="5232803">,</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5232806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232809"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232811">.</span><span class="ident" id="5232812"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5232817">.</span><span class="ident" id="5232818"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5232822">(</span><span class="op" id="5232823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232826"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232828">.</span><span class="ident" id="5232829"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5232834">.</span><span class="ident" id="5232835"><a href="/gostd/database/sql/sql.go.html#5229318">v</a></span>&nbsp;<span class="op" id="5232837">=</span>&nbsp;<span class="builtinfunc" id="5232839">append</span><span class="op" id="5232845">(</span><span class="ident" id="5232846"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232848">.</span><span class="ident" id="5232849"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5232854">.</span><span class="ident" id="5232855"><a href="/gostd/database/sql/sql.go.html#5229318">v</a></span><span class="op" id="5232856">,</span>&nbsp;<span class="ident" id="5232858"><a href="/gostd/database/sql/sql.go.html#5232669">txs</a></span><span class="op" id="5232861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5232864"><a href="/gostd/database/sql/sql.go.html#5232141">tx</a></span><span class="op" id="5232866">.</span><span class="ident" id="5232867"><a href="/gostd/database/sql/sql.go.html#5229288">stmts</a></span><span class="op" id="5232872">.</span><span class="ident" id="5232873"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5232879">(</span><span class="op" id="5232880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5232883">return</span>&nbsp;<span class="ident" id="5232890"><a href="/gostd/database/sql/sql.go.html#5232669">txs</a></span><br>
<span class="lineno">1215</span><span class="op" id="5232894">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5232897">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;doesn&#39;t&nbsp;return&nbsp;rows.</span><br>
<span class="lineno"></span><span class="comment" id="5232948">//&nbsp;For&nbsp;example:&nbsp;an&nbsp;INSERT&nbsp;and&nbsp;UPDATE.</span><br>
<span class="lineno"></span><span class="keyword" id="5232986">func</span>&nbsp;<span class="op" id="5232991">(</span><span class="ident" id="5232992">tx</span>&nbsp;<span class="op" id="5232995">*</span><span class="ident" id="5232996"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5232998">)</span>&nbsp;<span class="ident" id="5233000">Exec</span><span class="op" id="5233004">(</span><span class="ident" id="5233005">query</span>&nbsp;<span class="builtintype" id="5233011">string</span><span class="op" id="5233017">,</span>&nbsp;<span class="ident" id="5233019">args</span>&nbsp;<span class="op" id="5233024">...</span><span class="keyword" id="5233027">interface</span><span class="op" id="5233036">{</span><span class="op" id="5233037">}</span><span class="op" id="5233038">)</span>&nbsp;<span class="op" id="5233040">(</span><span class="ident" id="5233041"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><span class="op" id="5233047">,</span>&nbsp;<span class="builtintype" id="5233049">error</span><span class="op" id="5233054">)</span>&nbsp;<span class="op" id="5233056">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233059">dc</span><span class="op" id="5233061">,</span>&nbsp;<span class="ident" id="5233063">err</span>&nbsp;<span class="op" id="5233067">:=</span>&nbsp;<span class="ident" id="5233070"><a href="/gostd/database/sql/sql.go.html#5232992">tx</a></span><span class="op" id="5233072">.</span><span class="ident" id="5233073"><a href="/gostd/database/sql/sql.go.html#5229594">grabConn</a></span><span class="op" id="5233081">(</span><span class="op" id="5233082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233085">if</span>&nbsp;<span class="ident" id="5233088"><a href="/gostd/database/sql/sql.go.html#5233063">err</a></span>&nbsp;<span class="op" id="5233092">!=</span>&nbsp;<span class="builtintype" id="5233095">nil</span>&nbsp;<span class="op" id="5233099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233103">return</span>&nbsp;<span class="builtintype" id="5233110">nil</span><span class="op" id="5233113">,</span>&nbsp;<span class="ident" id="5233115"><a href="/gostd/database/sql/sql.go.html#5233063">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233124">if</span>&nbsp;<span class="ident" id="5233127">execer</span><span class="op" id="5233133">,</span>&nbsp;<span class="ident" id="5233135">ok</span>&nbsp;<span class="op" id="5233138">:=</span>&nbsp;<span class="ident" id="5233141"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233143">.</span><span class="ident" id="5233144"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5233146">.</span><span class="op" id="5233147">(</span><span class="ident" id="5233148"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5233154">.</span><span class="ident" id="5233155"><a href="/gostd/database/sql/driver/driver.go.html#5249715">Execer</a></span><span class="op" id="5233161">)</span><span class="op" id="5233162">;</span>&nbsp;<span class="ident" id="5233164"><a href="/gostd/database/sql/sql.go.html#5233135">ok</a></span>&nbsp;<span class="op" id="5233167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233171">dargs</span><span class="op" id="5233176">,</span>&nbsp;<span class="ident" id="5233178">err</span>&nbsp;<span class="op" id="5233182">:=</span>&nbsp;<span class="ident" id="5233185"><a href="/gostd/database/sql/convert.go.html#5194818">driverArgs</a></span><span class="op" id="5233195">(</span><span class="builtintype" id="5233196">nil</span><span class="op" id="5233199">,</span>&nbsp;<span class="ident" id="5233201"><a href="/gostd/database/sql/sql.go.html#5233019">args</a></span><span class="op" id="5233205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233209">if</span>&nbsp;<span class="ident" id="5233212"><a href="/gostd/database/sql/sql.go.html#5233178">err</a></span>&nbsp;<span class="op" id="5233216">!=</span>&nbsp;<span class="builtintype" id="5233219">nil</span>&nbsp;<span class="op" id="5233223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233228">return</span>&nbsp;<span class="builtintype" id="5233235">nil</span><span class="op" id="5233238">,</span>&nbsp;<span class="ident" id="5233240"><a href="/gostd/database/sql/sql.go.html#5233178">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233246">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233250"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233252">.</span><span class="ident" id="5233253"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5233257">(</span><span class="op" id="5233258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233262">resi</span><span class="op" id="5233266">,</span>&nbsp;<span class="ident" id="5233268"><a href="/gostd/database/sql/sql.go.html#5233178">err</a></span>&nbsp;<span class="op" id="5233272">:=</span>&nbsp;<span class="ident" id="5233275"><a href="/gostd/database/sql/sql.go.html#5233127">execer</a></span><span class="op" id="5233281">.</span><span class="ident" id="5233282"><a href="/gostd/database/sql/driver/driver.go.html#5249735">Exec</a></span><span class="op" id="5233286">(</span><span class="ident" id="5233287"><a href="/gostd/database/sql/sql.go.html#5233005">query</a></span><span class="op" id="5233292">,</span>&nbsp;<span class="ident" id="5233294"><a href="/gostd/database/sql/sql.go.html#5233171">dargs</a></span><span class="op" id="5233299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233303"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233305">.</span><span class="ident" id="5233306"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5233312">(</span><span class="op" id="5233313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233317">if</span>&nbsp;<span class="ident" id="5233320"><a href="/gostd/database/sql/sql.go.html#5233178">err</a></span>&nbsp;<span class="op" id="5233324">==</span>&nbsp;<span class="builtintype" id="5233327">nil</span>&nbsp;<span class="op" id="5233331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233336">return</span>&nbsp;<span class="ident" id="5233343"><a href="/gostd/database/sql/sql.go.html#5246947">driverResult</a></span><span class="op" id="5233355">{</span><span class="ident" id="5233356"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233358">,</span>&nbsp;<span class="ident" id="5233360"><a href="/gostd/database/sql/sql.go.html#5233262">resi</a></span><span class="op" id="5233364">}</span><span class="op" id="5233365">,</span>&nbsp;<span class="builtintype" id="5233367">nil</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233377">if</span>&nbsp;<span class="ident" id="5233380"><a href="/gostd/database/sql/sql.go.html#5233178">err</a></span>&nbsp;<span class="op" id="5233384">!=</span>&nbsp;<span class="ident" id="5233387"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5233393">.</span><span class="ident" id="5233394"><a href="/gostd/database/sql/driver/driver.go.html#5248847">ErrSkip</a></span>&nbsp;<span class="op" id="5233402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233407">return</span>&nbsp;<span class="builtintype" id="5233414">nil</span><span class="op" id="5233417">,</span>&nbsp;<span class="ident" id="5233419"><a href="/gostd/database/sql/sql.go.html#5233178">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233428">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233432"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233434">.</span><span class="ident" id="5233435"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5233439">(</span><span class="op" id="5233440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233443">si</span><span class="op" id="5233445">,</span>&nbsp;<span class="ident" id="5233447"><a href="/gostd/database/sql/sql.go.html#5233063">err</a></span>&nbsp;<span class="op" id="5233451">:=</span>&nbsp;<span class="ident" id="5233454"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233456">.</span><span class="ident" id="5233457"><a href="/gostd/database/sql/sql.go.html#5208213">ci</a></span><span class="op" id="5233459">.</span><span class="ident" id="5233460"><a href="/gostd/database/sql/driver/driver.go.html#5250348">Prepare</a></span><span class="op" id="5233467">(</span><span class="ident" id="5233468"><a href="/gostd/database/sql/sql.go.html#5233005">query</a></span><span class="op" id="5233473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233476"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233478">.</span><span class="ident" id="5233479"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5233485">(</span><span class="op" id="5233486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233489">if</span>&nbsp;<span class="ident" id="5233492"><a href="/gostd/database/sql/sql.go.html#5233063">err</a></span>&nbsp;<span class="op" id="5233496">!=</span>&nbsp;<span class="builtintype" id="5233499">nil</span>&nbsp;<span class="op" id="5233503">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233507">return</span>&nbsp;<span class="builtintype" id="5233514">nil</span><span class="op" id="5233517">,</span>&nbsp;<span class="ident" id="5233519"><a href="/gostd/database/sql/sql.go.html#5233063">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233527">defer</span>&nbsp;<span class="ident" id="5233533"><a href="/gostd/database/sql/sql.go.html#5247408">withLock</a></span><span class="op" id="5233541">(</span><span class="ident" id="5233542"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233544">,</span>&nbsp;<span class="keyword" id="5233546">func</span><span class="op" id="5233550">(</span><span class="op" id="5233551">)</span>&nbsp;<span class="op" id="5233553">{</span>&nbsp;<span class="ident" id="5233555"><a href="/gostd/database/sql/sql.go.html#5233443">si</a></span><span class="op" id="5233557">.</span><span class="ident" id="5233558"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5233563">(</span><span class="op" id="5233564">)</span>&nbsp;<span class="op" id="5233566">}</span><span class="op" id="5233567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233571">return</span>&nbsp;<span class="ident" id="5233578"><a href="/gostd/database/sql/sql.go.html#5235704">resultFromStatement</a></span><span class="op" id="5233597">(</span><span class="ident" id="5233598"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5233608">{</span><span class="ident" id="5233609"><a href="/gostd/database/sql/sql.go.html#5233059">dc</a></span><span class="op" id="5233611">,</span>&nbsp;<span class="ident" id="5233613"><a href="/gostd/database/sql/sql.go.html#5233443">si</a></span><span class="op" id="5233615">}</span><span class="op" id="5233616">,</span>&nbsp;<span class="ident" id="5233618"><a href="/gostd/database/sql/sql.go.html#5233019">args</a></span><span class="op" id="5233622">...</span><span class="op" id="5233625">)</span><br>
<span class="lineno">1250</span><span class="op" id="5233627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5233630">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;returns&nbsp;rows,&nbsp;typically&nbsp;a&nbsp;SELECT.</span><br>
<span class="lineno"></span><span class="keyword" id="5233695">func</span>&nbsp;<span class="op" id="5233700">(</span><span class="ident" id="5233701">tx</span>&nbsp;<span class="op" id="5233704">*</span><span class="ident" id="5233705"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5233707">)</span>&nbsp;<span class="ident" id="5233709">Query</span><span class="op" id="5233714">(</span><span class="ident" id="5233715">query</span>&nbsp;<span class="builtintype" id="5233721">string</span><span class="op" id="5233727">,</span>&nbsp;<span class="ident" id="5233729">args</span>&nbsp;<span class="op" id="5233734">...</span><span class="keyword" id="5233737">interface</span><span class="op" id="5233746">{</span><span class="op" id="5233747">}</span><span class="op" id="5233748">)</span>&nbsp;<span class="op" id="5233750">(</span><span class="op" id="5233751">*</span><span class="ident" id="5233752"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5233756">,</span>&nbsp;<span class="builtintype" id="5233758">error</span><span class="op" id="5233763">)</span>&nbsp;<span class="op" id="5233765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233768">dc</span><span class="op" id="5233770">,</span>&nbsp;<span class="ident" id="5233772">err</span>&nbsp;<span class="op" id="5233776">:=</span>&nbsp;<span class="ident" id="5233779"><a href="/gostd/database/sql/sql.go.html#5233701">tx</a></span><span class="op" id="5233781">.</span><span class="ident" id="5233782"><a href="/gostd/database/sql/sql.go.html#5229594">grabConn</a></span><span class="op" id="5233790">(</span><span class="op" id="5233791">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233794">if</span>&nbsp;<span class="ident" id="5233797"><a href="/gostd/database/sql/sql.go.html#5233772">err</a></span>&nbsp;<span class="op" id="5233801">!=</span>&nbsp;<span class="builtintype" id="5233804">nil</span>&nbsp;<span class="op" id="5233808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233812">return</span>&nbsp;<span class="builtintype" id="5233819">nil</span><span class="op" id="5233822">,</span>&nbsp;<span class="ident" id="5233824"><a href="/gostd/database/sql/sql.go.html#5233772">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5233829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5233832">releaseConn</span>&nbsp;<span class="op" id="5233844">:=</span>&nbsp;<span class="keyword" id="5233847">func</span><span class="op" id="5233851">(</span><span class="builtintype" id="5233852">error</span><span class="op" id="5233857">)</span>&nbsp;<span class="op" id="5233859">{</span><span class="op" id="5233860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5233863">return</span>&nbsp;<span class="ident" id="5233870"><a href="/gostd/database/sql/sql.go.html#5233701">tx</a></span><span class="op" id="5233872">.</span><span class="ident" id="5233873"><a href="/gostd/database/sql/sql.go.html#5228873">db</a></span><span class="op" id="5233875">.</span><span class="ident" id="5233876"><a href="/gostd/database/sql/sql.go.html#5226548">queryConn</a></span><span class="op" id="5233885">(</span><span class="ident" id="5233886"><a href="/gostd/database/sql/sql.go.html#5233768">dc</a></span><span class="op" id="5233888">,</span>&nbsp;<span class="ident" id="5233890"><a href="/gostd/database/sql/sql.go.html#5233832">releaseConn</a></span><span class="op" id="5233901">,</span>&nbsp;<span class="ident" id="5233903"><a href="/gostd/database/sql/sql.go.html#5233715">query</a></span><span class="op" id="5233908">,</span>&nbsp;<span class="ident" id="5233910"><a href="/gostd/database/sql/sql.go.html#5233729">args</a></span><span class="op" id="5233914">)</span><br>
<span class="lineno">1260</span><span class="op" id="5233916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5233919">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;return&nbsp;at&nbsp;most&nbsp;one&nbsp;row.</span><br>
<span class="lineno"></span><span class="comment" id="5233992">//&nbsp;QueryRow&nbsp;always&nbsp;return&nbsp;a&nbsp;non-nil&nbsp;value.&nbsp;Errors&nbsp;are&nbsp;deferred&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5234061">//&nbsp;Row&#39;s&nbsp;Scan&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno">1265</span><span class="keyword" id="5234093">func</span>&nbsp;<span class="op" id="5234098">(</span><span class="ident" id="5234099">tx</span>&nbsp;<span class="op" id="5234102">*</span><span class="ident" id="5234103"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><span class="op" id="5234105">)</span>&nbsp;<span class="ident" id="5234107">QueryRow</span><span class="op" id="5234115">(</span><span class="ident" id="5234116">query</span>&nbsp;<span class="builtintype" id="5234122">string</span><span class="op" id="5234128">,</span>&nbsp;<span class="ident" id="5234130">args</span>&nbsp;<span class="op" id="5234135">...</span><span class="keyword" id="5234138">interface</span><span class="op" id="5234147">{</span><span class="op" id="5234148">}</span><span class="op" id="5234149">)</span>&nbsp;<span class="op" id="5234151">*</span><span class="ident" id="5234152"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span>&nbsp;<span class="op" id="5234156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234159">rows</span><span class="op" id="5234163">,</span>&nbsp;<span class="ident" id="5234165">err</span>&nbsp;<span class="op" id="5234169">:=</span>&nbsp;<span class="ident" id="5234172"><a href="/gostd/database/sql/sql.go.html#5234099">tx</a></span><span class="op" id="5234174">.</span><span class="ident" id="5234175"><a href="/gostd/database/sql/sql.go.html#5233709">Query</a></span><span class="op" id="5234180">(</span><span class="ident" id="5234181"><a href="/gostd/database/sql/sql.go.html#5234116">query</a></span><span class="op" id="5234186">,</span>&nbsp;<span class="ident" id="5234188"><a href="/gostd/database/sql/sql.go.html#5234130">args</a></span><span class="op" id="5234192">...</span><span class="op" id="5234195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5234198">return</span>&nbsp;<span class="op" id="5234205">&amp;</span><span class="ident" id="5234206"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span><span class="op" id="5234209">{</span><span class="ident" id="5234210"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5234214">:</span>&nbsp;<span class="ident" id="5234216"><a href="/gostd/database/sql/sql.go.html#5234159">rows</a></span><span class="op" id="5234220">,</span>&nbsp;<span class="ident" id="5234222"><a href="/gostd/database/sql/sql.go.html#5244803">err</a></span><span class="op" id="5234225">:</span>&nbsp;<span class="ident" id="5234227"><a href="/gostd/database/sql/sql.go.html#5234165">err</a></span><span class="op" id="5234230">}</span><br>
<span class="lineno"></span><span class="op" id="5234232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="5234235">//&nbsp;connStmt&nbsp;is&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;on&nbsp;a&nbsp;particular&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5234299">type</span>&nbsp;<span class="ident" id="5234304">connStmt</span>&nbsp;<span class="keyword" id="5234313">struct</span>&nbsp;<span class="op" id="5234320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234323">dc</span>&nbsp;<span class="op" id="5234326">*</span><span class="ident" id="5234327"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234339">si</span>&nbsp;<span class="ident" id="5234342"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5234348">.</span><span class="ident" id="5234349"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><br>
<span class="lineno"></span><span class="op" id="5234354">}</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span><span class="comment" id="5234357">//&nbsp;Stmt&nbsp;is&nbsp;a&nbsp;prepared&nbsp;statement.&nbsp;Stmt&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5234446">type</span>&nbsp;<span class="ident" id="5234451">Stmt</span>&nbsp;<span class="keyword" id="5234456">struct</span>&nbsp;<span class="op" id="5234463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234466">//&nbsp;Immutable:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234481">db</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5234491">*</span><span class="ident" id="5234492"><a href="/gostd/database/sql/sql.go.html#5207158">DB</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234498">//&nbsp;where&nbsp;we&nbsp;came&nbsp;from</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234521">query</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5234531">string</span>&nbsp;<span class="comment" id="5234538">//&nbsp;that&nbsp;created&nbsp;the&nbsp;Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234564">stickyErr</span>&nbsp;<span class="builtintype" id="5234574">error</span>&nbsp;&nbsp;<span class="comment" id="5234581">//&nbsp;if&nbsp;non-nil,&nbsp;this&nbsp;error&nbsp;is&nbsp;returned&nbsp;for&nbsp;all&nbsp;operations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234640">closemu</span>&nbsp;<span class="ident" id="5234648"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5234652">.</span><span class="ident" id="5234653"><a href="/gostd/sync/rwmutex.go.html#1456076">RWMutex</a></span>&nbsp;<span class="comment" id="5234661">//&nbsp;held&nbsp;exclusively&nbsp;during&nbsp;close,&nbsp;for&nbsp;read&nbsp;otherwise.</span><br>
<span class="lineno"></span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234717">//&nbsp;If&nbsp;in&nbsp;a&nbsp;transaction,&nbsp;else&nbsp;both&nbsp;nil:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234757">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5234762">*</span><span class="ident" id="5234763"><a href="/gostd/database/sql/sql.go.html#5228860">Tx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234767">txsi</span>&nbsp;<span class="op" id="5234772">*</span><span class="ident" id="5234773"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234786">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234793"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5234797">.</span><span class="ident" id="5234798"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="5234804">//&nbsp;protects&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;fields</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5234840">closed</span>&nbsp;<span class="builtintype" id="5234847">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234854">//&nbsp;css&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;underlying&nbsp;driver&nbsp;statement&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234914">//&nbsp;that&nbsp;are&nbsp;valid&nbsp;on&nbsp;particular&nbsp;connections.&nbsp;&nbsp;This&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5234974">//&nbsp;used&nbsp;if&nbsp;tx&nbsp;==&nbsp;nil&nbsp;and&nbsp;one&nbsp;is&nbsp;found&nbsp;that&nbsp;has&nbsp;idle</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5235027">//&nbsp;connections.&nbsp;&nbsp;If&nbsp;tx&nbsp;!=&nbsp;nil,&nbsp;txsi&nbsp;is&nbsp;always&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235080">css</span>&nbsp;<span class="op" id="5235084">[</span><span class="op" id="5235085">]</span><span class="ident" id="5235086"><a href="/gostd/database/sql/sql.go.html#5234304">connStmt</a></span><br>
<span class="lineno"></span><span class="op" id="5235095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5235098">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments&nbsp;and</span><br>
<span class="lineno">1300</span><span class="comment" id="5235165">//&nbsp;returns&nbsp;a&nbsp;Result&nbsp;summarizing&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5235226">func</span>&nbsp;<span class="op" id="5235231">(</span><span class="ident" id="5235232">s</span>&nbsp;<span class="op" id="5235234">*</span><span class="ident" id="5235235"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5235239">)</span>&nbsp;<span class="ident" id="5235241">Exec</span><span class="op" id="5235245">(</span><span class="ident" id="5235246">args</span>&nbsp;<span class="op" id="5235251">...</span><span class="keyword" id="5235254">interface</span><span class="op" id="5235263">{</span><span class="op" id="5235264">}</span><span class="op" id="5235265">)</span>&nbsp;<span class="op" id="5235267">(</span><span class="ident" id="5235268"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><span class="op" id="5235274">,</span>&nbsp;<span class="builtintype" id="5235276">error</span><span class="op" id="5235281">)</span>&nbsp;<span class="op" id="5235283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235286"><a href="/gostd/database/sql/sql.go.html#5235232">s</a></span><span class="op" id="5235287">.</span><span class="ident" id="5235288"><a href="/gostd/database/sql/sql.go.html#5234640">closemu</a></span><span class="op" id="5235295">.</span><span class="ident" id="5235296"><a href="/gostd/sync/rwmutex.go.html#1456490">RLock</a></span><span class="op" id="5235301">(</span><span class="op" id="5235302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235305">defer</span>&nbsp;<span class="ident" id="5235311"><a href="/gostd/database/sql/sql.go.html#5235232">s</a></span><span class="op" id="5235312">.</span><span class="ident" id="5235313"><a href="/gostd/database/sql/sql.go.html#5234640">closemu</a></span><span class="op" id="5235320">.</span><span class="ident" id="5235321"><a href="/gostd/sync/rwmutex.go.html#1456952">RUnlock</a></span><span class="op" id="5235328">(</span><span class="op" id="5235329">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235333">var</span>&nbsp;<span class="ident" id="5235337">res</span>&nbsp;<span class="ident" id="5235341"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235349">for</span>&nbsp;<span class="ident" id="5235353">i</span>&nbsp;<span class="op" id="5235355">:=</span>&nbsp;<span class="num" id="5235358">0</span><span class="op" id="5235359">;</span>&nbsp;<span class="ident" id="5235361"><a href="/gostd/database/sql/sql.go.html#5235353">i</a></span>&nbsp;<span class="op" id="5235363">&lt;</span>&nbsp;<span class="ident" id="5235365"><a href="/gostd/database/sql/sql.go.html#5223659">maxBadConnRetries</a></span><span class="op" id="5235382">;</span>&nbsp;<span class="ident" id="5235384"><a href="/gostd/database/sql/sql.go.html#5235353">i</a></span><span class="op" id="5235385">++</span>&nbsp;<span class="op" id="5235388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235392">dc</span><span class="op" id="5235394">,</span>&nbsp;<span class="ident" id="5235396">releaseConn</span><span class="op" id="5235407">,</span>&nbsp;<span class="ident" id="5235409">si</span><span class="op" id="5235411">,</span>&nbsp;<span class="ident" id="5235413">err</span>&nbsp;<span class="op" id="5235417">:=</span>&nbsp;<span class="ident" id="5235420"><a href="/gostd/database/sql/sql.go.html#5235232">s</a></span><span class="op" id="5235421">.</span><span class="ident" id="5235422"><a href="/gostd/database/sql/sql.go.html#5236523">connStmt</a></span><span class="op" id="5235430">(</span><span class="op" id="5235431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235435">if</span>&nbsp;<span class="ident" id="5235438"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span>&nbsp;<span class="op" id="5235442">!=</span>&nbsp;<span class="builtintype" id="5235445">nil</span>&nbsp;<span class="op" id="5235449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235454">if</span>&nbsp;<span class="ident" id="5235457"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span>&nbsp;<span class="op" id="5235461">==</span>&nbsp;<span class="ident" id="5235464"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5235470">.</span><span class="ident" id="5235471"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5235482">{</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235488">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235505">return</span>&nbsp;<span class="builtintype" id="5235512">nil</span><span class="op" id="5235515">,</span>&nbsp;<span class="ident" id="5235517"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235528"><a href="/gostd/database/sql/sql.go.html#5235337">res</a></span><span class="op" id="5235531">,</span>&nbsp;<span class="ident" id="5235533"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span>&nbsp;<span class="op" id="5235537">=</span>&nbsp;<span class="ident" id="5235539"><a href="/gostd/database/sql/sql.go.html#5235704">resultFromStatement</a></span><span class="op" id="5235558">(</span><span class="ident" id="5235559"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5235569">{</span><span class="ident" id="5235570"><a href="/gostd/database/sql/sql.go.html#5235392">dc</a></span><span class="op" id="5235572">,</span>&nbsp;<span class="ident" id="5235574"><a href="/gostd/database/sql/sql.go.html#5235409">si</a></span><span class="op" id="5235576">}</span><span class="op" id="5235577">,</span>&nbsp;<span class="ident" id="5235579"><a href="/gostd/database/sql/sql.go.html#5235246">args</a></span><span class="op" id="5235583">...</span><span class="op" id="5235586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235590"><a href="/gostd/database/sql/sql.go.html#5235396">releaseConn</a></span><span class="op" id="5235601">(</span><span class="ident" id="5235602"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span><span class="op" id="5235605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235609">if</span>&nbsp;<span class="ident" id="5235612"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span>&nbsp;<span class="op" id="5235616">!=</span>&nbsp;<span class="ident" id="5235619"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5235625">.</span><span class="ident" id="5235626"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5235637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235642">return</span>&nbsp;<span class="ident" id="5235649"><a href="/gostd/database/sql/sql.go.html#5235337">res</a></span><span class="op" id="5235652">,</span>&nbsp;<span class="ident" id="5235654"><a href="/gostd/database/sql/sql.go.html#5235413">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235660">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5235663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235666">return</span>&nbsp;<span class="builtintype" id="5235673">nil</span><span class="op" id="5235676">,</span>&nbsp;<span class="ident" id="5235678"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5235684">.</span><span class="ident" id="5235685"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span><span class="op" id="5235696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5235699">func</span>&nbsp;<span class="ident" id="5235704">resultFromStatement</span><span class="op" id="5235723">(</span><span class="ident" id="5235724">ds</span>&nbsp;<span class="ident" id="5235727"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5235737">,</span>&nbsp;<span class="ident" id="5235739">args</span>&nbsp;<span class="op" id="5235744">...</span><span class="keyword" id="5235747">interface</span><span class="op" id="5235756">{</span><span class="op" id="5235757">}</span><span class="op" id="5235758">)</span>&nbsp;<span class="op" id="5235760">(</span><span class="ident" id="5235761"><a href="/gostd/database/sql/sql.go.html#5246439">Result</a></span><span class="op" id="5235767">,</span>&nbsp;<span class="builtintype" id="5235769">error</span><span class="op" id="5235774">)</span>&nbsp;<span class="op" id="5235776">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235779"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5235781">.</span><span class="ident" id="5235782"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5235786">(</span><span class="op" id="5235787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235790">want</span>&nbsp;<span class="op" id="5235795">:=</span>&nbsp;<span class="ident" id="5235798"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5235800">.</span><span class="ident" id="5235801"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5235803">.</span><span class="ident" id="5235804"><a href="/gostd/database/sql/driver/driver.go.html#5251872">NumInput</a></span><span class="op" id="5235812">(</span><span class="op" id="5235813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5235816"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5235818">.</span><span class="ident" id="5235819"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5235825">(</span><span class="op" id="5235826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5235830">//&nbsp;-1&nbsp;means&nbsp;the&nbsp;driver&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;count&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5235894">//&nbsp;placeholders,&nbsp;so&nbsp;we&nbsp;won&#39;t&nbsp;sanity&nbsp;check&nbsp;input&nbsp;here&nbsp;and&nbsp;instead&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5235968">//&nbsp;driver&nbsp;deal&nbsp;with&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5235997">if</span>&nbsp;<span class="ident" id="5236000"><a href="/gostd/database/sql/sql.go.html#5235790">want</a></span>&nbsp;<span class="op" id="5236005">!=</span>&nbsp;<span class="op" id="5236008">-</span><span class="num" id="5236009">1</span>&nbsp;<span class="op" id="5236011">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5236014">len</span><span class="op" id="5236017">(</span><span class="ident" id="5236018"><a href="/gostd/database/sql/sql.go.html#5235739">args</a></span><span class="op" id="5236022">)</span>&nbsp;<span class="op" id="5236024">!=</span>&nbsp;<span class="ident" id="5236027"><a href="/gostd/database/sql/sql.go.html#5235790">want</a></span>&nbsp;<span class="op" id="5236032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236036">return</span>&nbsp;<span class="builtintype" id="5236043">nil</span><span class="op" id="5236046">,</span>&nbsp;<span class="ident" id="5236048"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5236051">.</span><span class="ident" id="5236052"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="5236058">(</span><span class="string" id="5236059">&#34;sql:&nbsp;expected&nbsp;%d&nbsp;arguments,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="5236095">,</span>&nbsp;<span class="ident" id="5236097"><a href="/gostd/database/sql/sql.go.html#5235790">want</a></span><span class="op" id="5236101">,</span>&nbsp;<span class="builtinfunc" id="5236103">len</span><span class="op" id="5236106">(</span><span class="ident" id="5236107"><a href="/gostd/database/sql/sql.go.html#5235739">args</a></span><span class="op" id="5236111">)</span><span class="op" id="5236112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236115">}</span><br>
<span class="lineno">1335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236119">dargs</span><span class="op" id="5236124">,</span>&nbsp;<span class="ident" id="5236126">err</span>&nbsp;<span class="op" id="5236130">:=</span>&nbsp;<span class="ident" id="5236133"><a href="/gostd/database/sql/convert.go.html#5194818">driverArgs</a></span><span class="op" id="5236143">(</span><span class="op" id="5236144">&amp;</span><span class="ident" id="5236145"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5236147">,</span>&nbsp;<span class="ident" id="5236149"><a href="/gostd/database/sql/sql.go.html#5235739">args</a></span><span class="op" id="5236153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236156">if</span>&nbsp;<span class="ident" id="5236159"><a href="/gostd/database/sql/sql.go.html#5236126">err</a></span>&nbsp;<span class="op" id="5236163">!=</span>&nbsp;<span class="builtintype" id="5236166">nil</span>&nbsp;<span class="op" id="5236170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236174">return</span>&nbsp;<span class="builtintype" id="5236181">nil</span><span class="op" id="5236184">,</span>&nbsp;<span class="ident" id="5236186"><a href="/gostd/database/sql/sql.go.html#5236126">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236191">}</span><br>
<span class="lineno">1340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236195"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5236197">.</span><span class="ident" id="5236198"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5236202">(</span><span class="op" id="5236203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236206">resi</span><span class="op" id="5236210">,</span>&nbsp;<span class="ident" id="5236212"><a href="/gostd/database/sql/sql.go.html#5236126">err</a></span>&nbsp;<span class="op" id="5236216">:=</span>&nbsp;<span class="ident" id="5236219"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5236221">.</span><span class="ident" id="5236222"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5236224">.</span><span class="ident" id="5236225"><a href="/gostd/database/sql/driver/driver.go.html#5251974">Exec</a></span><span class="op" id="5236229">(</span><span class="ident" id="5236230"><a href="/gostd/database/sql/sql.go.html#5236119">dargs</a></span><span class="op" id="5236235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236238"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5236240">.</span><span class="ident" id="5236241"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5236247">(</span><span class="op" id="5236248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236251">if</span>&nbsp;<span class="ident" id="5236254"><a href="/gostd/database/sql/sql.go.html#5236126">err</a></span>&nbsp;<span class="op" id="5236258">!=</span>&nbsp;<span class="builtintype" id="5236261">nil</span>&nbsp;<span class="op" id="5236265">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236269">return</span>&nbsp;<span class="builtintype" id="5236276">nil</span><span class="op" id="5236279">,</span>&nbsp;<span class="ident" id="5236281"><a href="/gostd/database/sql/sql.go.html#5236126">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236289">return</span>&nbsp;<span class="ident" id="5236296"><a href="/gostd/database/sql/sql.go.html#5246947">driverResult</a></span><span class="op" id="5236308">{</span><span class="ident" id="5236309"><a href="/gostd/database/sql/sql.go.html#5235724">ds</a></span><span class="op" id="5236311">.</span><span class="ident" id="5236312"><a href="/gostd/database/sql/sql.go.html#5210656">Locker</a></span><span class="op" id="5236318">,</span>&nbsp;<span class="ident" id="5236320"><a href="/gostd/database/sql/sql.go.html#5236206">resi</a></span><span class="op" id="5236324">}</span><span class="op" id="5236325">,</span>&nbsp;<span class="builtintype" id="5236327">nil</span><br>
<span class="lineno"></span><span class="op" id="5236331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1350</span><span class="comment" id="5236334">//&nbsp;connStmt&nbsp;returns&nbsp;a&nbsp;free&nbsp;driver&nbsp;connection&nbsp;on&nbsp;which&nbsp;to&nbsp;execute&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5236403">//&nbsp;statement,&nbsp;a&nbsp;function&nbsp;to&nbsp;call&nbsp;to&nbsp;release&nbsp;the&nbsp;connection,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5236469">//&nbsp;statement&nbsp;bound&nbsp;to&nbsp;that&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5236508">func</span>&nbsp;<span class="op" id="5236513">(</span><span class="ident" id="5236514">s</span>&nbsp;<span class="op" id="5236516">*</span><span class="ident" id="5236517"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5236521">)</span>&nbsp;<span class="ident" id="5236523">connStmt</span><span class="op" id="5236531">(</span><span class="op" id="5236532">)</span>&nbsp;<span class="op" id="5236534">(</span><span class="ident" id="5236535">ci</span>&nbsp;<span class="op" id="5236538">*</span><span class="ident" id="5236539"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span><span class="op" id="5236549">,</span>&nbsp;<span class="ident" id="5236551">releaseConn</span>&nbsp;<span class="keyword" id="5236563">func</span><span class="op" id="5236567">(</span><span class="builtintype" id="5236568">error</span><span class="op" id="5236573">)</span><span class="op" id="5236574">,</span>&nbsp;<span class="ident" id="5236576">si</span>&nbsp;<span class="ident" id="5236579"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5236585">.</span><span class="ident" id="5236586"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span><span class="op" id="5236590">,</span>&nbsp;<span class="ident" id="5236592">err</span>&nbsp;<span class="builtintype" id="5236596">error</span><span class="op" id="5236601">)</span>&nbsp;<span class="op" id="5236603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236606">if</span>&nbsp;<span class="ident" id="5236609"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5236613">=</span>&nbsp;<span class="ident" id="5236615"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236616">.</span><span class="ident" id="5236617"><a href="/gostd/database/sql/sql.go.html#5234564">stickyErr</a></span><span class="op" id="5236626">;</span>&nbsp;<span class="ident" id="5236628"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5236632">!=</span>&nbsp;<span class="builtintype" id="5236635">nil</span>&nbsp;<span class="op" id="5236639">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236643">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236654"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236655">.</span><span class="ident" id="5236656"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5236658">.</span><span class="ident" id="5236659"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5236663">(</span><span class="op" id="5236664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236667">if</span>&nbsp;<span class="ident" id="5236670"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236671">.</span><span class="ident" id="5236672"><a href="/gostd/database/sql/sql.go.html#5234840">closed</a></span>&nbsp;<span class="op" id="5236679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236683"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236684">.</span><span class="ident" id="5236685"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5236687">.</span><span class="ident" id="5236688"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5236694">(</span><span class="op" id="5236695">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236699"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5236703">=</span>&nbsp;<span class="ident" id="5236705"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5236711">.</span><span class="ident" id="5236712"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5236715">(</span><span class="string" id="5236716">&#34;sql:&nbsp;statement&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5236742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236746">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5236758">//&nbsp;In&nbsp;a&nbsp;transaction,&nbsp;we&nbsp;always&nbsp;use&nbsp;the&nbsp;connection&nbsp;that&nbsp;the</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5236818">//&nbsp;transaction&nbsp;was&nbsp;created&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236850">if</span>&nbsp;<span class="ident" id="5236853"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236854">.</span><span class="ident" id="5236855"><a href="/gostd/database/sql/sql.go.html#5234757">tx</a></span>&nbsp;<span class="op" id="5236858">!=</span>&nbsp;<span class="builtintype" id="5236861">nil</span>&nbsp;<span class="op" id="5236865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236869"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236870">.</span><span class="ident" id="5236871"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5236873">.</span><span class="ident" id="5236874"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5236880">(</span><span class="op" id="5236881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236885"><a href="/gostd/database/sql/sql.go.html#5236535">ci</a></span><span class="op" id="5236887">,</span>&nbsp;<span class="ident" id="5236889"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5236893">=</span>&nbsp;<span class="ident" id="5236895"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5236896">.</span><span class="ident" id="5236897"><a href="/gostd/database/sql/sql.go.html#5234757">tx</a></span><span class="op" id="5236899">.</span><span class="ident" id="5236900"><a href="/gostd/database/sql/sql.go.html#5229594">grabConn</a></span><span class="op" id="5236908">(</span><span class="op" id="5236909">)</span>&nbsp;<span class="comment" id="5236911">//&nbsp;blocks,&nbsp;waiting&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236952">if</span>&nbsp;<span class="ident" id="5236955"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5236959">!=</span>&nbsp;<span class="builtintype" id="5236962">nil</span>&nbsp;<span class="op" id="5236966">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5236971">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5236980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5236984"><a href="/gostd/database/sql/sql.go.html#5236551">releaseConn</a></span>&nbsp;<span class="op" id="5236996">=</span>&nbsp;<span class="keyword" id="5236998">func</span><span class="op" id="5237002">(</span><span class="builtintype" id="5237003">error</span><span class="op" id="5237008">)</span>&nbsp;<span class="op" id="5237010">{</span><span class="op" id="5237011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237015">return</span>&nbsp;<span class="ident" id="5237022"><a href="/gostd/database/sql/sql.go.html#5236535">ci</a></span><span class="op" id="5237024">,</span>&nbsp;<span class="ident" id="5237026"><a href="/gostd/database/sql/sql.go.html#5236551">releaseConn</a></span><span class="op" id="5237037">,</span>&nbsp;<span class="ident" id="5237039"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237040">.</span><span class="ident" id="5237041"><a href="/gostd/database/sql/sql.go.html#5234767">txsi</a></span><span class="op" id="5237045">.</span><span class="ident" id="5237046"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5237048">,</span>&nbsp;<span class="builtintype" id="5237050">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237055">}</span><br>
<span class="lineno">1375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237059">for</span>&nbsp;<span class="ident" id="5237063">i</span>&nbsp;<span class="op" id="5237065">:=</span>&nbsp;<span class="num" id="5237068">0</span><span class="op" id="5237069">;</span>&nbsp;<span class="ident" id="5237071"><a href="/gostd/database/sql/sql.go.html#5237063">i</a></span>&nbsp;<span class="op" id="5237073">&lt;</span>&nbsp;<span class="builtinfunc" id="5237075">len</span><span class="op" id="5237078">(</span><span class="ident" id="5237079"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237080">.</span><span class="ident" id="5237081"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237084">)</span><span class="op" id="5237085">;</span>&nbsp;<span class="ident" id="5237087"><a href="/gostd/database/sql/sql.go.html#5237063">i</a></span><span class="op" id="5237088">++</span>&nbsp;<span class="op" id="5237091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237095">v</span>&nbsp;<span class="op" id="5237097">:=</span>&nbsp;<span class="ident" id="5237100"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237101">.</span><span class="ident" id="5237102"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237105">[</span><span class="ident" id="5237106"><a href="/gostd/database/sql/sql.go.html#5237063">i</a></span><span class="op" id="5237107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237111">_</span><span class="op" id="5237112">,</span>&nbsp;<span class="ident" id="5237114">err</span>&nbsp;<span class="op" id="5237118">:=</span>&nbsp;<span class="ident" id="5237121"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237122">.</span><span class="ident" id="5237123"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5237125">.</span><span class="ident" id="5237126"><a href="/gostd/database/sql/sql.go.html#5220055">connIfFree</a></span><span class="op" id="5237136">(</span><span class="ident" id="5237137"><a href="/gostd/database/sql/sql.go.html#5237095">v</a></span><span class="op" id="5237138">.</span><span class="ident" id="5237139"><a href="/gostd/database/sql/sql.go.html#5234323">dc</a></span><span class="op" id="5237141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237145">if</span>&nbsp;<span class="ident" id="5237148"><a href="/gostd/database/sql/sql.go.html#5237114">err</a></span>&nbsp;<span class="op" id="5237152">==</span>&nbsp;<span class="builtintype" id="5237155">nil</span>&nbsp;<span class="op" id="5237159">{</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237164"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237165">.</span><span class="ident" id="5237166"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5237168">.</span><span class="ident" id="5237169"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5237175">(</span><span class="op" id="5237176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237181">return</span>&nbsp;<span class="ident" id="5237188"><a href="/gostd/database/sql/sql.go.html#5237095">v</a></span><span class="op" id="5237189">.</span><span class="ident" id="5237190"><a href="/gostd/database/sql/sql.go.html#5234323">dc</a></span><span class="op" id="5237192">,</span>&nbsp;<span class="ident" id="5237194"><a href="/gostd/database/sql/sql.go.html#5237095">v</a></span><span class="op" id="5237195">.</span><span class="ident" id="5237196"><a href="/gostd/database/sql/sql.go.html#5234323">dc</a></span><span class="op" id="5237198">.</span><span class="ident" id="5237199"><a href="/gostd/database/sql/sql.go.html#5208554">releaseConn</a></span><span class="op" id="5237210">,</span>&nbsp;<span class="ident" id="5237212"><a href="/gostd/database/sql/sql.go.html#5237095">v</a></span><span class="op" id="5237213">.</span><span class="ident" id="5237214"><a href="/gostd/database/sql/sql.go.html#5234339">si</a></span><span class="op" id="5237216">,</span>&nbsp;<span class="builtintype" id="5237218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237228">if</span>&nbsp;<span class="ident" id="5237231"><a href="/gostd/database/sql/sql.go.html#5237114">err</a></span>&nbsp;<span class="op" id="5237235">==</span>&nbsp;<span class="ident" id="5237238"><a href="/gostd/database/sql/sql.go.html#5219603">errConnClosed</a></span>&nbsp;<span class="op" id="5237252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237257">//&nbsp;Lazily&nbsp;remove&nbsp;dead&nbsp;conn&nbsp;from&nbsp;our&nbsp;freelist.</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237306"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237307">.</span><span class="ident" id="5237308"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237311">[</span><span class="ident" id="5237312"><a href="/gostd/database/sql/sql.go.html#5237063">i</a></span><span class="op" id="5237313">]</span>&nbsp;<span class="op" id="5237315">=</span>&nbsp;<span class="ident" id="5237317"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237318">.</span><span class="ident" id="5237319"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237322">[</span><span class="builtinfunc" id="5237323">len</span><span class="op" id="5237326">(</span><span class="ident" id="5237327"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237328">.</span><span class="ident" id="5237329"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237332">)</span><span class="op" id="5237333">-</span><span class="num" id="5237334">1</span><span class="op" id="5237335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237340"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237341">.</span><span class="ident" id="5237342"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="5237346">=</span>&nbsp;<span class="ident" id="5237348"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237349">.</span><span class="ident" id="5237350"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237353">[</span><span class="op" id="5237354">:</span><span class="builtinfunc" id="5237355">len</span><span class="op" id="5237358">(</span><span class="ident" id="5237359"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237360">.</span><span class="ident" id="5237361"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5237364">)</span><span class="op" id="5237365">-</span><span class="num" id="5237366">1</span><span class="op" id="5237367">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237372"><a href="/gostd/database/sql/sql.go.html#5237063">i</a></span><span class="op" id="5237373">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237385"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237386">.</span><span class="ident" id="5237387"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5237389">.</span><span class="ident" id="5237390"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5237396">(</span><span class="op" id="5237397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237401">//&nbsp;If&nbsp;all&nbsp;connections&nbsp;are&nbsp;busy,&nbsp;either&nbsp;wait&nbsp;for&nbsp;one&nbsp;to&nbsp;become&nbsp;available&nbsp;(if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237478">//&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;open&nbsp;connections)&nbsp;or&nbsp;create&nbsp;a</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237552">//&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237565">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237569">//&nbsp;TODO(bradfitz):&nbsp;or&nbsp;always&nbsp;wait&nbsp;for&nbsp;one?&nbsp;make&nbsp;configurable&nbsp;later?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237638">dc</span><span class="op" id="5237640">,</span>&nbsp;<span class="ident" id="5237642"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5237646">:=</span>&nbsp;<span class="ident" id="5237649"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237650">.</span><span class="ident" id="5237651"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5237653">.</span><span class="ident" id="5237654"><a href="/gostd/database/sql/sql.go.html#5218439">conn</a></span><span class="op" id="5237658">(</span><span class="op" id="5237659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237662">if</span>&nbsp;<span class="ident" id="5237665"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5237669">!=</span>&nbsp;<span class="builtintype" id="5237672">nil</span>&nbsp;<span class="op" id="5237676">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237680">return</span>&nbsp;<span class="builtintype" id="5237687">nil</span><span class="op" id="5237690">,</span>&nbsp;<span class="builtintype" id="5237692">nil</span><span class="op" id="5237695">,</span>&nbsp;<span class="builtintype" id="5237697">nil</span><span class="op" id="5237700">,</span>&nbsp;<span class="ident" id="5237702"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237711">//&nbsp;Do&nbsp;another&nbsp;pass&nbsp;over&nbsp;the&nbsp;list&nbsp;to&nbsp;see&nbsp;whether&nbsp;this&nbsp;statement&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237779">//&nbsp;already&nbsp;been&nbsp;prepared&nbsp;on&nbsp;the&nbsp;connection&nbsp;assigned&nbsp;to&nbsp;us.</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237839"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237840">.</span><span class="ident" id="5237841"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5237843">.</span><span class="ident" id="5237844"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5237848">(</span><span class="op" id="5237849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237852">for</span>&nbsp;<span class="ident" id="5237856">_</span><span class="op" id="5237857">,</span>&nbsp;<span class="ident" id="5237859">v</span>&nbsp;<span class="op" id="5237861">:=</span>&nbsp;<span class="keyword" id="5237864">range</span>&nbsp;<span class="ident" id="5237870"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237871">.</span><span class="ident" id="5237872"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="5237876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237880">if</span>&nbsp;<span class="ident" id="5237883"><a href="/gostd/database/sql/sql.go.html#5237859">v</a></span><span class="op" id="5237884">.</span><span class="ident" id="5237885"><a href="/gostd/database/sql/sql.go.html#5234323">dc</a></span>&nbsp;<span class="op" id="5237888">==</span>&nbsp;<span class="ident" id="5237891"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span>&nbsp;<span class="op" id="5237894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237899"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237900">.</span><span class="ident" id="5237901"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5237903">.</span><span class="ident" id="5237904"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5237910">(</span><span class="op" id="5237911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5237916">return</span>&nbsp;<span class="ident" id="5237923"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5237925">,</span>&nbsp;<span class="ident" id="5237927"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5237929">.</span><span class="ident" id="5237930"><a href="/gostd/database/sql/sql.go.html#5208554">releaseConn</a></span><span class="op" id="5237941">,</span>&nbsp;<span class="ident" id="5237943"><a href="/gostd/database/sql/sql.go.html#5237859">v</a></span><span class="op" id="5237944">.</span><span class="ident" id="5237945"><a href="/gostd/database/sql/sql.go.html#5234339">si</a></span><span class="op" id="5237947">,</span>&nbsp;<span class="builtintype" id="5237949">nil</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5237958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5237961"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5237962">.</span><span class="ident" id="5237963"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5237965">.</span><span class="ident" id="5237966"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5237972">(</span><span class="op" id="5237973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5237977">//&nbsp;No&nbsp;luck;&nbsp;we&nbsp;need&nbsp;to&nbsp;prepare&nbsp;the&nbsp;statement&nbsp;on&nbsp;this&nbsp;connection</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238042"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238044">.</span><span class="ident" id="5238045"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5238049">(</span><span class="op" id="5238050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238053"><a href="/gostd/database/sql/sql.go.html#5236576">si</a></span><span class="op" id="5238055">,</span>&nbsp;<span class="ident" id="5238057"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5238061">=</span>&nbsp;<span class="ident" id="5238063"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238065">.</span><span class="ident" id="5238066"><a href="/gostd/database/sql/sql.go.html#5208741">prepareLocked</a></span><span class="op" id="5238079">(</span><span class="ident" id="5238080"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5238081">.</span><span class="ident" id="5238082"><a href="/gostd/database/sql/sql.go.html#5234521">query</a></span><span class="op" id="5238087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238090"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238092">.</span><span class="ident" id="5238093"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5238099">(</span><span class="op" id="5238100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238103">if</span>&nbsp;<span class="ident" id="5238106"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span>&nbsp;<span class="op" id="5238110">!=</span>&nbsp;<span class="builtintype" id="5238113">nil</span>&nbsp;<span class="op" id="5238117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238121"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5238122">.</span><span class="ident" id="5238123"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5238125">.</span><span class="ident" id="5238126"><a href="/gostd/database/sql/sql.go.html#5221560">putConn</a></span><span class="op" id="5238133">(</span><span class="ident" id="5238134"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238136">,</span>&nbsp;<span class="ident" id="5238138"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span><span class="op" id="5238141">)</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238145">return</span>&nbsp;<span class="builtintype" id="5238152">nil</span><span class="op" id="5238155">,</span>&nbsp;<span class="builtintype" id="5238157">nil</span><span class="op" id="5238160">,</span>&nbsp;<span class="builtintype" id="5238162">nil</span><span class="op" id="5238165">,</span>&nbsp;<span class="ident" id="5238167"><a href="/gostd/database/sql/sql.go.html#5236592">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5238172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238175"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5238176">.</span><span class="ident" id="5238177"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5238179">.</span><span class="ident" id="5238180"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5238184">(</span><span class="op" id="5238185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238188">cs</span>&nbsp;<span class="op" id="5238191">:=</span>&nbsp;<span class="ident" id="5238194"><a href="/gostd/database/sql/sql.go.html#5234304">connStmt</a></span><span class="op" id="5238202">{</span><span class="ident" id="5238203"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238205">,</span>&nbsp;<span class="ident" id="5238207"><a href="/gostd/database/sql/sql.go.html#5236576">si</a></span><span class="op" id="5238209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238212"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5238213">.</span><span class="ident" id="5238214"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="5238218">=</span>&nbsp;<span class="builtinfunc" id="5238220">append</span><span class="op" id="5238226">(</span><span class="ident" id="5238227"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5238228">.</span><span class="ident" id="5238229"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span><span class="op" id="5238232">,</span>&nbsp;<span class="ident" id="5238234"><a href="/gostd/database/sql/sql.go.html#5238188">cs</a></span><span class="op" id="5238236">)</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238239"><a href="/gostd/database/sql/sql.go.html#5236514">s</a></span><span class="op" id="5238240">.</span><span class="ident" id="5238241"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5238243">.</span><span class="ident" id="5238244"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5238250">(</span><span class="op" id="5238251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238255">return</span>&nbsp;<span class="ident" id="5238262"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238264">,</span>&nbsp;<span class="ident" id="5238266"><a href="/gostd/database/sql/sql.go.html#5237638">dc</a></span><span class="op" id="5238268">.</span><span class="ident" id="5238269"><a href="/gostd/database/sql/sql.go.html#5208554">releaseConn</a></span><span class="op" id="5238280">,</span>&nbsp;<span class="ident" id="5238282"><a href="/gostd/database/sql/sql.go.html#5236576">si</a></span><span class="op" id="5238284">,</span>&nbsp;<span class="builtintype" id="5238286">nil</span><br>
<span class="lineno"></span><span class="op" id="5238290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span><span class="comment" id="5238293">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;query&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments</span><br>
<span class="lineno"></span><span class="comment" id="5238363">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;query&nbsp;results&nbsp;as&nbsp;a&nbsp;*Rows.</span><br>
<span class="lineno"></span><span class="keyword" id="5238408">func</span>&nbsp;<span class="op" id="5238413">(</span><span class="ident" id="5238414">s</span>&nbsp;<span class="op" id="5238416">*</span><span class="ident" id="5238417"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5238421">)</span>&nbsp;<span class="ident" id="5238423">Query</span><span class="op" id="5238428">(</span><span class="ident" id="5238429">args</span>&nbsp;<span class="op" id="5238434">...</span><span class="keyword" id="5238437">interface</span><span class="op" id="5238446">{</span><span class="op" id="5238447">}</span><span class="op" id="5238448">)</span>&nbsp;<span class="op" id="5238450">(</span><span class="op" id="5238451">*</span><span class="ident" id="5238452"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5238456">,</span>&nbsp;<span class="builtintype" id="5238458">error</span><span class="op" id="5238463">)</span>&nbsp;<span class="op" id="5238465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238468"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5238469">.</span><span class="ident" id="5238470"><a href="/gostd/database/sql/sql.go.html#5234640">closemu</a></span><span class="op" id="5238477">.</span><span class="ident" id="5238478"><a href="/gostd/sync/rwmutex.go.html#1456490">RLock</a></span><span class="op" id="5238483">(</span><span class="op" id="5238484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238487">defer</span>&nbsp;<span class="ident" id="5238493"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5238494">.</span><span class="ident" id="5238495"><a href="/gostd/database/sql/sql.go.html#5234640">closemu</a></span><span class="op" id="5238502">.</span><span class="ident" id="5238503"><a href="/gostd/sync/rwmutex.go.html#1456952">RUnlock</a></span><span class="op" id="5238510">(</span><span class="op" id="5238511">)</span><br>
<span class="lineno">1435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238515">var</span>&nbsp;<span class="ident" id="5238519">rowsi</span>&nbsp;<span class="ident" id="5238525"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5238531">.</span><span class="ident" id="5238532"><a href="/gostd/database/sql/driver/driver.go.html#5252630">Rows</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238538">for</span>&nbsp;<span class="ident" id="5238542">i</span>&nbsp;<span class="op" id="5238544">:=</span>&nbsp;<span class="num" id="5238547">0</span><span class="op" id="5238548">;</span>&nbsp;<span class="ident" id="5238550"><a href="/gostd/database/sql/sql.go.html#5238542">i</a></span>&nbsp;<span class="op" id="5238552">&lt;</span>&nbsp;<span class="ident" id="5238554"><a href="/gostd/database/sql/sql.go.html#5223659">maxBadConnRetries</a></span><span class="op" id="5238571">;</span>&nbsp;<span class="ident" id="5238573"><a href="/gostd/database/sql/sql.go.html#5238542">i</a></span><span class="op" id="5238574">++</span>&nbsp;<span class="op" id="5238577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238581">dc</span><span class="op" id="5238583">,</span>&nbsp;<span class="ident" id="5238585">releaseConn</span><span class="op" id="5238596">,</span>&nbsp;<span class="ident" id="5238598">si</span><span class="op" id="5238600">,</span>&nbsp;<span class="ident" id="5238602">err</span>&nbsp;<span class="op" id="5238606">:=</span>&nbsp;<span class="ident" id="5238609"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5238610">.</span><span class="ident" id="5238611"><a href="/gostd/database/sql/sql.go.html#5236523">connStmt</a></span><span class="op" id="5238619">(</span><span class="op" id="5238620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238624">if</span>&nbsp;<span class="ident" id="5238627"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span>&nbsp;<span class="op" id="5238631">!=</span>&nbsp;<span class="builtintype" id="5238634">nil</span>&nbsp;<span class="op" id="5238638">{</span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238643">if</span>&nbsp;<span class="ident" id="5238646"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span>&nbsp;<span class="op" id="5238650">==</span>&nbsp;<span class="ident" id="5238653"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5238659">.</span><span class="ident" id="5238660"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5238671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238677">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5238689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238694">return</span>&nbsp;<span class="builtintype" id="5238701">nil</span><span class="op" id="5238704">,</span>&nbsp;<span class="ident" id="5238706"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5238712">}</span><br>
<span class="lineno">1445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238717"><a href="/gostd/database/sql/sql.go.html#5238519">rowsi</a></span><span class="op" id="5238722">,</span>&nbsp;<span class="ident" id="5238724"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span>&nbsp;<span class="op" id="5238728">=</span>&nbsp;<span class="ident" id="5238730"><a href="/gostd/database/sql/sql.go.html#5239225">rowsiFromStatement</a></span><span class="op" id="5238748">(</span><span class="ident" id="5238749"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5238759">{</span><span class="ident" id="5238760"><a href="/gostd/database/sql/sql.go.html#5238581">dc</a></span><span class="op" id="5238762">,</span>&nbsp;<span class="ident" id="5238764"><a href="/gostd/database/sql/sql.go.html#5238598">si</a></span><span class="op" id="5238766">}</span><span class="op" id="5238767">,</span>&nbsp;<span class="ident" id="5238769"><a href="/gostd/database/sql/sql.go.html#5238429">args</a></span><span class="op" id="5238773">...</span><span class="op" id="5238776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5238780">if</span>&nbsp;<span class="ident" id="5238783"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span>&nbsp;<span class="op" id="5238787">==</span>&nbsp;<span class="builtintype" id="5238790">nil</span>&nbsp;<span class="op" id="5238794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238799">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;ci&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238860">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238884">rows</span>&nbsp;<span class="op" id="5238889">:=</span>&nbsp;<span class="op" id="5238892">&amp;</span><span class="ident" id="5238893"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5238897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238903"><a href="/gostd/database/sql/sql.go.html#5241514">dc</a></span><span class="op" id="5238905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238910"><a href="/gostd/database/sql/sql.go.html#5238581">dc</a></span><span class="op" id="5238912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238918"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5238923">:</span>&nbsp;<span class="ident" id="5238925"><a href="/gostd/database/sql/sql.go.html#5238519">rowsi</a></span><span class="op" id="5238930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5238936">//&nbsp;releaseConn&nbsp;set&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5238964">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238969"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5238970">.</span><span class="ident" id="5238971"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5238973">.</span><span class="ident" id="5238974"><a href="/gostd/database/sql/sql.go.html#5211341">addDep</a></span><span class="op" id="5238980">(</span><span class="ident" id="5238981"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5238982">,</span>&nbsp;<span class="ident" id="5238984"><a href="/gostd/database/sql/sql.go.html#5238884">rows</a></span><span class="op" id="5238988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5238993"><a href="/gostd/database/sql/sql.go.html#5238884">rows</a></span><span class="op" id="5238997">.</span><span class="ident" id="5238998"><a href="/gostd/database/sql/sql.go.html#5241594">releaseConn</a></span>&nbsp;<span class="op" id="5239010">=</span>&nbsp;<span class="keyword" id="5239012">func</span><span class="op" id="5239016">(</span><span class="ident" id="5239017">err</span>&nbsp;<span class="builtintype" id="5239021">error</span><span class="op" id="5239026">)</span>&nbsp;<span class="op" id="5239028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239034"><a href="/gostd/database/sql/sql.go.html#5238585">releaseConn</a></span><span class="op" id="5239045">(</span><span class="ident" id="5239046"><a href="/gostd/database/sql/sql.go.html#5239017">err</a></span><span class="op" id="5239049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239055"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5239056">.</span><span class="ident" id="5239057"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5239059">.</span><span class="ident" id="5239060"><a href="/gostd/database/sql/sql.go.html#5211969">removeDep</a></span><span class="op" id="5239069">(</span><span class="ident" id="5239070"><a href="/gostd/database/sql/sql.go.html#5238414">s</a></span><span class="op" id="5239071">,</span>&nbsp;<span class="ident" id="5239073"><a href="/gostd/database/sql/sql.go.html#5238884">rows</a></span><span class="op" id="5239077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239082">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239087">return</span>&nbsp;<span class="ident" id="5239094"><a href="/gostd/database/sql/sql.go.html#5238884">rows</a></span><span class="op" id="5239098">,</span>&nbsp;<span class="builtintype" id="5239100">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239111"><a href="/gostd/database/sql/sql.go.html#5238585">releaseConn</a></span><span class="op" id="5239122">(</span><span class="ident" id="5239123"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span><span class="op" id="5239126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239130">if</span>&nbsp;<span class="ident" id="5239133"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span>&nbsp;<span class="op" id="5239137">!=</span>&nbsp;<span class="ident" id="5239140"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5239146">.</span><span class="ident" id="5239147"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span>&nbsp;<span class="op" id="5239158">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239163">return</span>&nbsp;<span class="builtintype" id="5239170">nil</span><span class="op" id="5239173">,</span>&nbsp;<span class="ident" id="5239175"><a href="/gostd/database/sql/sql.go.html#5238602">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239187">return</span>&nbsp;<span class="builtintype" id="5239194">nil</span><span class="op" id="5239197">,</span>&nbsp;<span class="ident" id="5239199"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5239205">.</span><span class="ident" id="5239206"><a href="/gostd/database/sql/driver/driver.go.html#5249402">ErrBadConn</a></span><br>
<span class="lineno"></span><span class="op" id="5239217">}</span><br>
<span class="lineno">1470</span><br>
<span class="lineno"></span><span class="keyword" id="5239220">func</span>&nbsp;<span class="ident" id="5239225">rowsiFromStatement</span><span class="op" id="5239243">(</span><span class="ident" id="5239244">ds</span>&nbsp;<span class="ident" id="5239247"><a href="/gostd/database/sql/sql.go.html#5210635">driverStmt</a></span><span class="op" id="5239257">,</span>&nbsp;<span class="ident" id="5239259">args</span>&nbsp;<span class="op" id="5239264">...</span><span class="keyword" id="5239267">interface</span><span class="op" id="5239276">{</span><span class="op" id="5239277">}</span><span class="op" id="5239278">)</span>&nbsp;<span class="op" id="5239280">(</span><span class="ident" id="5239281"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5239287">.</span><span class="ident" id="5239288"><a href="/gostd/database/sql/driver/driver.go.html#5252630">Rows</a></span><span class="op" id="5239292">,</span>&nbsp;<span class="builtintype" id="5239294">error</span><span class="op" id="5239299">)</span>&nbsp;<span class="op" id="5239301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239304"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239306">.</span><span class="ident" id="5239307"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5239311">(</span><span class="op" id="5239312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239315">want</span>&nbsp;<span class="op" id="5239320">:=</span>&nbsp;<span class="ident" id="5239323"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239325">.</span><span class="ident" id="5239326"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5239328">.</span><span class="ident" id="5239329"><a href="/gostd/database/sql/driver/driver.go.html#5251872">NumInput</a></span><span class="op" id="5239337">(</span><span class="op" id="5239338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239341"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239343">.</span><span class="ident" id="5239344"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5239350">(</span><span class="op" id="5239351">)</span><br>
<span class="lineno">1475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239355">//&nbsp;-1&nbsp;means&nbsp;the&nbsp;driver&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;count&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239419">//&nbsp;placeholders,&nbsp;so&nbsp;we&nbsp;won&#39;t&nbsp;sanity&nbsp;check&nbsp;input&nbsp;here&nbsp;and&nbsp;instead&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5239493">//&nbsp;driver&nbsp;deal&nbsp;with&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239522">if</span>&nbsp;<span class="ident" id="5239525"><a href="/gostd/database/sql/sql.go.html#5239315">want</a></span>&nbsp;<span class="op" id="5239530">!=</span>&nbsp;<span class="op" id="5239533">-</span><span class="num" id="5239534">1</span>&nbsp;<span class="op" id="5239536">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5239539">len</span><span class="op" id="5239542">(</span><span class="ident" id="5239543"><a href="/gostd/database/sql/sql.go.html#5239259">args</a></span><span class="op" id="5239547">)</span>&nbsp;<span class="op" id="5239549">!=</span>&nbsp;<span class="ident" id="5239552"><a href="/gostd/database/sql/sql.go.html#5239315">want</a></span>&nbsp;<span class="op" id="5239557">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239561">return</span>&nbsp;<span class="builtintype" id="5239568">nil</span><span class="op" id="5239571">,</span>&nbsp;<span class="ident" id="5239573"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5239576">.</span><span class="ident" id="5239577"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="5239583">(</span><span class="string" id="5239584">&#34;sql:&nbsp;statement&nbsp;expects&nbsp;%d&nbsp;inputs;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="5239626">,</span>&nbsp;<span class="ident" id="5239628"><a href="/gostd/database/sql/sql.go.html#5239315">want</a></span><span class="op" id="5239632">,</span>&nbsp;<span class="builtinfunc" id="5239634">len</span><span class="op" id="5239637">(</span><span class="ident" id="5239638"><a href="/gostd/database/sql/sql.go.html#5239259">args</a></span><span class="op" id="5239642">)</span><span class="op" id="5239643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239650">dargs</span><span class="op" id="5239655">,</span>&nbsp;<span class="ident" id="5239657">err</span>&nbsp;<span class="op" id="5239661">:=</span>&nbsp;<span class="ident" id="5239664"><a href="/gostd/database/sql/convert.go.html#5194818">driverArgs</a></span><span class="op" id="5239674">(</span><span class="op" id="5239675">&amp;</span><span class="ident" id="5239676"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239678">,</span>&nbsp;<span class="ident" id="5239680"><a href="/gostd/database/sql/sql.go.html#5239259">args</a></span><span class="op" id="5239684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239687">if</span>&nbsp;<span class="ident" id="5239690"><a href="/gostd/database/sql/sql.go.html#5239657">err</a></span>&nbsp;<span class="op" id="5239694">!=</span>&nbsp;<span class="builtintype" id="5239697">nil</span>&nbsp;<span class="op" id="5239701">{</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239705">return</span>&nbsp;<span class="builtintype" id="5239712">nil</span><span class="op" id="5239715">,</span>&nbsp;<span class="ident" id="5239717"><a href="/gostd/database/sql/sql.go.html#5239657">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239726"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239728">.</span><span class="ident" id="5239729"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5239733">(</span><span class="op" id="5239734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239737">rowsi</span><span class="op" id="5239742">,</span>&nbsp;<span class="ident" id="5239744"><a href="/gostd/database/sql/sql.go.html#5239657">err</a></span>&nbsp;<span class="op" id="5239748">:=</span>&nbsp;<span class="ident" id="5239751"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239753">.</span><span class="ident" id="5239754"><a href="/gostd/database/sql/sql.go.html#5210688">si</a></span><span class="op" id="5239756">.</span><span class="ident" id="5239757"><a href="/gostd/database/sql/driver/driver.go.html#5252082">Query</a></span><span class="op" id="5239762">(</span><span class="ident" id="5239763"><a href="/gostd/database/sql/sql.go.html#5239650">dargs</a></span><span class="op" id="5239768">)</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5239771"><a href="/gostd/database/sql/sql.go.html#5239244">ds</a></span><span class="op" id="5239773">.</span><span class="ident" id="5239774"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5239780">(</span><span class="op" id="5239781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239784">if</span>&nbsp;<span class="ident" id="5239787"><a href="/gostd/database/sql/sql.go.html#5239657">err</a></span>&nbsp;<span class="op" id="5239791">!=</span>&nbsp;<span class="builtintype" id="5239794">nil</span>&nbsp;<span class="op" id="5239798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239802">return</span>&nbsp;<span class="builtintype" id="5239809">nil</span><span class="op" id="5239812">,</span>&nbsp;<span class="ident" id="5239814"><a href="/gostd/database/sql/sql.go.html#5239657">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5239819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5239822">return</span>&nbsp;<span class="ident" id="5239829"><a href="/gostd/database/sql/sql.go.html#5239737">rowsi</a></span><span class="op" id="5239834">,</span>&nbsp;<span class="builtintype" id="5239836">nil</span><br>
<span class="lineno">1495</span><span class="op" id="5239840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5239843">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;query&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="5239917">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;statement,&nbsp;that&nbsp;error&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="5239994">//&nbsp;be&nbsp;returned&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan&nbsp;on&nbsp;the&nbsp;returned&nbsp;*Row,&nbsp;which&nbsp;is&nbsp;always&nbsp;non-nil.</span><br>
<span class="lineno">1500</span><span class="comment" id="5240074">//&nbsp;If&nbsp;the&nbsp;query&nbsp;selects&nbsp;no&nbsp;rows,&nbsp;the&nbsp;*Row&#39;s&nbsp;Scan&nbsp;will&nbsp;return&nbsp;ErrNoRows.</span><br>
<span class="lineno"></span><span class="comment" id="5240146">//&nbsp;Otherwise,&nbsp;the&nbsp;*Row&#39;s&nbsp;Scan&nbsp;scans&nbsp;the&nbsp;first&nbsp;selected&nbsp;row&nbsp;and&nbsp;discards</span><br>
<span class="lineno"></span><span class="comment" id="5240218">//&nbsp;the&nbsp;rest.</span><br>
<span class="lineno"></span><span class="comment" id="5240231">//</span><br>
<span class="lineno"></span><span class="comment" id="5240234">//&nbsp;Example&nbsp;usage:</span><br>
<span class="lineno">1505</span><span class="comment" id="5240252">//</span><br>
<span class="lineno"></span><span class="comment" id="5240255">//&nbsp;&nbsp;var&nbsp;name&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5240275">//&nbsp;&nbsp;err&nbsp;:=&nbsp;nameByUseridStmt.QueryRow(id).Scan(&amp;name)</span><br>
<span class="lineno"></span><span class="keyword" id="5240328">func</span>&nbsp;<span class="op" id="5240333">(</span><span class="ident" id="5240334">s</span>&nbsp;<span class="op" id="5240336">*</span><span class="ident" id="5240337"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5240341">)</span>&nbsp;<span class="ident" id="5240343">QueryRow</span><span class="op" id="5240351">(</span><span class="ident" id="5240352">args</span>&nbsp;<span class="op" id="5240357">...</span><span class="keyword" id="5240360">interface</span><span class="op" id="5240369">{</span><span class="op" id="5240370">}</span><span class="op" id="5240371">)</span>&nbsp;<span class="op" id="5240373">*</span><span class="ident" id="5240374"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span>&nbsp;<span class="op" id="5240378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240381">rows</span><span class="op" id="5240385">,</span>&nbsp;<span class="ident" id="5240387">err</span>&nbsp;<span class="op" id="5240391">:=</span>&nbsp;<span class="ident" id="5240394"><a href="/gostd/database/sql/sql.go.html#5240334">s</a></span><span class="op" id="5240395">.</span><span class="ident" id="5240396"><a href="/gostd/database/sql/sql.go.html#5238423">Query</a></span><span class="op" id="5240401">(</span><span class="ident" id="5240402"><a href="/gostd/database/sql/sql.go.html#5240352">args</a></span><span class="op" id="5240406">...</span><span class="op" id="5240409">)</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240412">if</span>&nbsp;<span class="ident" id="5240415"><a href="/gostd/database/sql/sql.go.html#5240387">err</a></span>&nbsp;<span class="op" id="5240419">!=</span>&nbsp;<span class="builtintype" id="5240422">nil</span>&nbsp;<span class="op" id="5240426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240430">return</span>&nbsp;<span class="op" id="5240437">&amp;</span><span class="ident" id="5240438"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span><span class="op" id="5240441">{</span><span class="ident" id="5240442"><a href="/gostd/database/sql/sql.go.html#5244803">err</a></span><span class="op" id="5240445">:</span>&nbsp;<span class="ident" id="5240447"><a href="/gostd/database/sql/sql.go.html#5240387">err</a></span><span class="op" id="5240450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240456">return</span>&nbsp;<span class="op" id="5240463">&amp;</span><span class="ident" id="5240464"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span><span class="op" id="5240467">{</span><span class="ident" id="5240468"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5240472">:</span>&nbsp;<span class="ident" id="5240474"><a href="/gostd/database/sql/sql.go.html#5240381">rows</a></span><span class="op" id="5240478">}</span><br>
<span class="lineno"></span><span class="op" id="5240480">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5240483">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="5240514">func</span>&nbsp;<span class="op" id="5240519">(</span><span class="ident" id="5240520">s</span>&nbsp;<span class="op" id="5240522">*</span><span class="ident" id="5240523"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5240527">)</span>&nbsp;<span class="ident" id="5240529">Close</span><span class="op" id="5240534">(</span><span class="op" id="5240535">)</span>&nbsp;<span class="builtintype" id="5240537">error</span>&nbsp;<span class="op" id="5240543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240546"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240547">.</span><span class="ident" id="5240548"><a href="/gostd/database/sql/sql.go.html#5234640">closemu</a></span><span class="op" id="5240555">.</span><span class="ident" id="5240556"><a href="/gostd/sync/rwmutex.go.html#1457713">Lock</a></span><span class="op" id="5240560">(</span><span class="op" id="5240561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240564">defer</span>&nbsp;<span class="ident" id="5240570"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240571">.</span><span class="ident" id="5240572"><a href="/gostd/database/sql/sql.go.html#5234640">closemu</a></span><span class="op" id="5240579">.</span><span class="ident" id="5240580"><a href="/gostd/sync/rwmutex.go.html#1458554">Unlock</a></span><span class="op" id="5240586">(</span><span class="op" id="5240587">)</span><br>
<span class="lineno">1520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240591">if</span>&nbsp;<span class="ident" id="5240594"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240595">.</span><span class="ident" id="5240596"><a href="/gostd/database/sql/sql.go.html#5234564">stickyErr</a></span>&nbsp;<span class="op" id="5240606">!=</span>&nbsp;<span class="builtintype" id="5240609">nil</span>&nbsp;<span class="op" id="5240613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240617">return</span>&nbsp;<span class="ident" id="5240624"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240625">.</span><span class="ident" id="5240626"><a href="/gostd/database/sql/sql.go.html#5234564">stickyErr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240640"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240641">.</span><span class="ident" id="5240642"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5240644">.</span><span class="ident" id="5240645"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5240649">(</span><span class="op" id="5240650">)</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240653">if</span>&nbsp;<span class="ident" id="5240656"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240657">.</span><span class="ident" id="5240658"><a href="/gostd/database/sql/sql.go.html#5234840">closed</a></span>&nbsp;<span class="op" id="5240665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240669"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240670">.</span><span class="ident" id="5240671"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5240673">.</span><span class="ident" id="5240674"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5240680">(</span><span class="op" id="5240681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240685">return</span>&nbsp;<span class="builtintype" id="5240692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240700"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240701">.</span><span class="ident" id="5240702"><a href="/gostd/database/sql/sql.go.html#5234840">closed</a></span>&nbsp;<span class="op" id="5240709">=</span>&nbsp;<span class="builtintype" id="5240711">true</span><br>
<span class="lineno">1530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240718">if</span>&nbsp;<span class="ident" id="5240721"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240722">.</span><span class="ident" id="5240723"><a href="/gostd/database/sql/sql.go.html#5234757">tx</a></span>&nbsp;<span class="op" id="5240726">!=</span>&nbsp;<span class="builtintype" id="5240729">nil</span>&nbsp;<span class="op" id="5240733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240737"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240738">.</span><span class="ident" id="5240739"><a href="/gostd/database/sql/sql.go.html#5234767">txsi</a></span><span class="op" id="5240743">.</span><span class="ident" id="5240744"><a href="/gostd/database/sql/sql.go.html#5210737">Close</a></span><span class="op" id="5240749">(</span><span class="op" id="5240750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240754"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240755">.</span><span class="ident" id="5240756"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5240758">.</span><span class="ident" id="5240759"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5240765">(</span><span class="op" id="5240766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240770">return</span>&nbsp;<span class="builtintype" id="5240777">nil</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5240782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240785"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240786">.</span><span class="ident" id="5240787"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5240789">.</span><span class="ident" id="5240790"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5240796">(</span><span class="op" id="5240797">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240801">return</span>&nbsp;<span class="ident" id="5240808"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240809">.</span><span class="ident" id="5240810"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5240812">.</span><span class="ident" id="5240813"><a href="/gostd/database/sql/sql.go.html#5211969">removeDep</a></span><span class="op" id="5240822">(</span><span class="ident" id="5240823"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240824">,</span>&nbsp;<span class="ident" id="5240826"><a href="/gostd/database/sql/sql.go.html#5240520">s</a></span><span class="op" id="5240827">)</span><br>
<span class="lineno"></span><span class="op" id="5240829">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span><span class="keyword" id="5240832">func</span>&nbsp;<span class="op" id="5240837">(</span><span class="ident" id="5240838">s</span>&nbsp;<span class="op" id="5240840">*</span><span class="ident" id="5240841"><a href="/gostd/database/sql/sql.go.html#5234451">Stmt</a></span><span class="op" id="5240845">)</span>&nbsp;<span class="ident" id="5240847">finalClose</span><span class="op" id="5240857">(</span><span class="op" id="5240858">)</span>&nbsp;<span class="builtintype" id="5240860">error</span>&nbsp;<span class="op" id="5240866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240869"><a href="/gostd/database/sql/sql.go.html#5240838">s</a></span><span class="op" id="5240870">.</span><span class="ident" id="5240871"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5240873">.</span><span class="ident" id="5240874"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5240878">(</span><span class="op" id="5240879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240882">defer</span>&nbsp;<span class="ident" id="5240888"><a href="/gostd/database/sql/sql.go.html#5240838">s</a></span><span class="op" id="5240889">.</span><span class="ident" id="5240890"><a href="/gostd/database/sql/sql.go.html#5234786">mu</a></span><span class="op" id="5240892">.</span><span class="ident" id="5240893"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5240899">(</span><span class="op" id="5240900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240903">if</span>&nbsp;<span class="ident" id="5240906"><a href="/gostd/database/sql/sql.go.html#5240838">s</a></span><span class="op" id="5240907">.</span><span class="ident" id="5240908"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="5240912">!=</span>&nbsp;<span class="builtintype" id="5240915">nil</span>&nbsp;<span class="op" id="5240919">{</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5240923">for</span>&nbsp;<span class="ident" id="5240927">_</span><span class="op" id="5240928">,</span>&nbsp;<span class="ident" id="5240930">v</span>&nbsp;<span class="op" id="5240932">:=</span>&nbsp;<span class="keyword" id="5240935">range</span>&nbsp;<span class="ident" id="5240941"><a href="/gostd/database/sql/sql.go.html#5240838">s</a></span><span class="op" id="5240942">.</span><span class="ident" id="5240943"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="5240947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240952"><a href="/gostd/database/sql/sql.go.html#5240838">s</a></span><span class="op" id="5240953">.</span><span class="ident" id="5240954"><a href="/gostd/database/sql/sql.go.html#5234481">db</a></span><span class="op" id="5240956">.</span><span class="ident" id="5240957"><a href="/gostd/database/sql/sql.go.html#5221032">noteUnusedDriverStatement</a></span><span class="op" id="5240982">(</span><span class="ident" id="5240983"><a href="/gostd/database/sql/sql.go.html#5240930">v</a></span><span class="op" id="5240984">.</span><span class="ident" id="5240985"><a href="/gostd/database/sql/sql.go.html#5234323">dc</a></span><span class="op" id="5240987">,</span>&nbsp;<span class="ident" id="5240989"><a href="/gostd/database/sql/sql.go.html#5240930">v</a></span><span class="op" id="5240990">.</span><span class="ident" id="5240991"><a href="/gostd/database/sql/sql.go.html#5234339">si</a></span><span class="op" id="5240993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5240998"><a href="/gostd/database/sql/sql.go.html#5240930">v</a></span><span class="op" id="5240999">.</span><span class="ident" id="5241000"><a href="/gostd/database/sql/sql.go.html#5234323">dc</a></span><span class="op" id="5241002">.</span><span class="ident" id="5241003"><a href="/gostd/database/sql/sql.go.html#5208628">removeOpenStmt</a></span><span class="op" id="5241017">(</span><span class="ident" id="5241018"><a href="/gostd/database/sql/sql.go.html#5240930">v</a></span><span class="op" id="5241019">.</span><span class="ident" id="5241020"><a href="/gostd/database/sql/sql.go.html#5234339">si</a></span><span class="op" id="5241022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241030"><a href="/gostd/database/sql/sql.go.html#5240838">s</a></span><span class="op" id="5241031">.</span><span class="ident" id="5241032"><a href="/gostd/database/sql/sql.go.html#5235080">css</a></span>&nbsp;<span class="op" id="5241036">=</span>&nbsp;<span class="builtintype" id="5241038">nil</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5241046">return</span>&nbsp;<span class="builtintype" id="5241053">nil</span><br>
<span class="lineno"></span><span class="op" id="5241057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241060">//&nbsp;Rows&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;a&nbsp;query.&nbsp;Its&nbsp;cursor&nbsp;starts&nbsp;before&nbsp;the&nbsp;first&nbsp;row</span><br>
<span class="lineno">1555</span><span class="comment" id="5241133">//&nbsp;of&nbsp;the&nbsp;result&nbsp;set.&nbsp;Use&nbsp;Next&nbsp;to&nbsp;advance&nbsp;through&nbsp;the&nbsp;rows:</span><br>
<span class="lineno"></span><span class="comment" id="5241193">//</span><br>
<span class="lineno"></span><span class="comment" id="5241196">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows,&nbsp;err&nbsp;:=&nbsp;db.Query(&#34;SELECT&nbsp;...&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="5241239">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="5241250">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer&nbsp;rows.Close()</span><br>
<span class="lineno">1560</span><span class="comment" id="5241276">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;rows.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5241301">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;id&nbsp;int</span><br>
<span class="lineno"></span><span class="comment" id="5241323">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="5241350">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;rows.Scan(&amp;id,&nbsp;&amp;name)</span><br>
<span class="lineno"></span><span class="comment" id="5241389">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno">1565</span><span class="comment" id="5241404">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="5241413">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;rows.Err()&nbsp;//&nbsp;get&nbsp;any&nbsp;error&nbsp;encountered&nbsp;during&nbsp;iteration</span><br>
<span class="lineno"></span><span class="comment" id="5241483">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="keyword" id="5241494">type</span>&nbsp;<span class="ident" id="5241499">Rows</span>&nbsp;<span class="keyword" id="5241504">struct</span>&nbsp;<span class="op" id="5241511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241514">dc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5241526">*</span><span class="ident" id="5241527"><a href="/gostd/database/sql/sql.go.html#5208150">driverConn</a></span>&nbsp;<span class="comment" id="5241538">//&nbsp;owned;&nbsp;must&nbsp;call&nbsp;releaseConn&nbsp;when&nbsp;closed&nbsp;to&nbsp;release</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241594">releaseConn</span>&nbsp;<span class="keyword" id="5241606">func</span><span class="op" id="5241610">(</span><span class="builtintype" id="5241611">error</span><span class="op" id="5241616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241619">rowsi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241631"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5241637">.</span><span class="ident" id="5241638"><a href="/gostd/database/sql/driver/driver.go.html#5252630">Rows</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241645">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5241655">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241661">lastcols</span>&nbsp;&nbsp;<span class="op" id="5241671">[</span><span class="op" id="5241672">]</span><span class="ident" id="5241673"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5241679">.</span><span class="ident" id="5241680"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241687">lasterr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5241697">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5241709">//&nbsp;non-nil&nbsp;only&nbsp;if&nbsp;closed&nbsp;is&nbsp;true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5241744">closeStmt</span>&nbsp;<span class="ident" id="5241754"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5241760">.</span><span class="ident" id="5241761"><a href="/gostd/database/sql/driver/driver.go.html#5251287">Stmt</a></span>&nbsp;<span class="comment" id="5241766">//&nbsp;if&nbsp;non-nil,&nbsp;statement&nbsp;to&nbsp;Close&nbsp;on&nbsp;close</span><br>
<span class="lineno"></span><span class="op" id="5241809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5241812">//&nbsp;Next&nbsp;prepares&nbsp;the&nbsp;next&nbsp;result&nbsp;row&nbsp;for&nbsp;reading&nbsp;with&nbsp;the&nbsp;Scan&nbsp;method.&nbsp;&nbsp;It</span><br>
<span class="lineno">1580</span><span class="comment" id="5241887">//&nbsp;returns&nbsp;true&nbsp;on&nbsp;success,&nbsp;or&nbsp;false&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;result&nbsp;row&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5241967">//&nbsp;happened&nbsp;while&nbsp;preparing&nbsp;it.&nbsp;&nbsp;Err&nbsp;should&nbsp;be&nbsp;consulted&nbsp;to&nbsp;distinguish&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="5242047">//&nbsp;the&nbsp;two&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="5242065">//</span><br>
<span class="lineno"></span><span class="comment" id="5242068">//&nbsp;Every&nbsp;call&nbsp;to&nbsp;Scan,&nbsp;even&nbsp;the&nbsp;first&nbsp;one,&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Next.</span><br>
<span class="lineno">1585</span><span class="keyword" id="5242147">func</span>&nbsp;<span class="op" id="5242152">(</span><span class="ident" id="5242153">rs</span>&nbsp;<span class="op" id="5242156">*</span><span class="ident" id="5242157"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5242161">)</span>&nbsp;<span class="ident" id="5242163">Next</span><span class="op" id="5242167">(</span><span class="op" id="5242168">)</span>&nbsp;<span class="builtintype" id="5242170">bool</span>&nbsp;<span class="op" id="5242175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242178">if</span>&nbsp;<span class="ident" id="5242181"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242183">.</span><span class="ident" id="5242184"><a href="/gostd/database/sql/sql.go.html#5241645">closed</a></span>&nbsp;<span class="op" id="5242191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242195">return</span>&nbsp;<span class="builtintype" id="5242202">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242212">if</span>&nbsp;<span class="ident" id="5242215"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242217">.</span><span class="ident" id="5242218"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span>&nbsp;<span class="op" id="5242227">==</span>&nbsp;<span class="builtintype" id="5242230">nil</span>&nbsp;<span class="op" id="5242234">{</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242238"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242240">.</span><span class="ident" id="5242241"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span>&nbsp;<span class="op" id="5242250">=</span>&nbsp;<span class="builtinfunc" id="5242252">make</span><span class="op" id="5242256">(</span><span class="op" id="5242257">[</span><span class="op" id="5242258">]</span><span class="ident" id="5242259"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5242265">.</span><span class="ident" id="5242266"><a href="/gostd/database/sql/driver/driver.go.html#5248050">Value</a></span><span class="op" id="5242271">,</span>&nbsp;<span class="builtinfunc" id="5242273">len</span><span class="op" id="5242276">(</span><span class="ident" id="5242277"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242279">.</span><span class="ident" id="5242280"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5242285">.</span><span class="ident" id="5242286"><a href="/gostd/database/sql/driver/driver.go.html#5252877">Columns</a></span><span class="op" id="5242293">(</span><span class="op" id="5242294">)</span><span class="op" id="5242295">)</span><span class="op" id="5242296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242302"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242304">.</span><span class="ident" id="5242305"><a href="/gostd/database/sql/sql.go.html#5241687">lasterr</a></span>&nbsp;<span class="op" id="5242313">=</span>&nbsp;<span class="ident" id="5242315"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242317">.</span><span class="ident" id="5242318"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5242323">.</span><span class="ident" id="5242324"><a href="/gostd/database/sql/driver/driver.go.html#5253314">Next</a></span><span class="op" id="5242328">(</span><span class="ident" id="5242329"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242331">.</span><span class="ident" id="5242332"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span><span class="op" id="5242340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242343">if</span>&nbsp;<span class="ident" id="5242346"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242348">.</span><span class="ident" id="5242349"><a href="/gostd/database/sql/sql.go.html#5241687">lasterr</a></span>&nbsp;<span class="op" id="5242357">!=</span>&nbsp;<span class="builtintype" id="5242360">nil</span>&nbsp;<span class="op" id="5242364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5242368"><a href="/gostd/database/sql/sql.go.html#5242153">rs</a></span><span class="op" id="5242370">.</span><span class="ident" id="5242371"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="5242376">(</span><span class="op" id="5242377">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242381">return</span>&nbsp;<span class="builtintype" id="5242388">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242398">return</span>&nbsp;<span class="builtintype" id="5242405">true</span><br>
<span class="lineno"></span><span class="op" id="5242410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="comment" id="5242413">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;error,&nbsp;if&nbsp;any,&nbsp;that&nbsp;was&nbsp;encountered&nbsp;during&nbsp;iteration.</span><br>
<span class="lineno"></span><span class="comment" id="5242486">//&nbsp;Err&nbsp;may&nbsp;be&nbsp;called&nbsp;after&nbsp;an&nbsp;explicit&nbsp;or&nbsp;implicit&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5242544">func</span>&nbsp;<span class="op" id="5242549">(</span><span class="ident" id="5242550">rs</span>&nbsp;<span class="op" id="5242553">*</span><span class="ident" id="5242554"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5242558">)</span>&nbsp;<span class="ident" id="5242560">Err</span><span class="op" id="5242563">(</span><span class="op" id="5242564">)</span>&nbsp;<span class="builtintype" id="5242566">error</span>&nbsp;<span class="op" id="5242572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242575">if</span>&nbsp;<span class="ident" id="5242578"><a href="/gostd/database/sql/sql.go.html#5242550">rs</a></span><span class="op" id="5242580">.</span><span class="ident" id="5242581"><a href="/gostd/database/sql/sql.go.html#5241687">lasterr</a></span>&nbsp;<span class="op" id="5242589">==</span>&nbsp;<span class="ident" id="5242592"><a href="/gostd/database/sql/sql.go.html#5202104">io</a></span><span class="op" id="5242594">.</span><span class="ident" id="5242595"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="5242599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242603">return</span>&nbsp;<span class="builtintype" id="5242610">nil</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242618">return</span>&nbsp;<span class="ident" id="5242625"><a href="/gostd/database/sql/sql.go.html#5242550">rs</a></span><span class="op" id="5242627">.</span><span class="ident" id="5242628"><a href="/gostd/database/sql/sql.go.html#5241687">lasterr</a></span><br>
<span class="lineno"></span><span class="op" id="5242636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5242639">//&nbsp;Columns&nbsp;returns&nbsp;the&nbsp;column&nbsp;names.</span><br>
<span class="lineno">1610</span><span class="comment" id="5242676">//&nbsp;Columns&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;rows&nbsp;are&nbsp;closed,&nbsp;or&nbsp;if&nbsp;the&nbsp;rows</span><br>
<span class="lineno"></span><span class="comment" id="5242743">//&nbsp;are&nbsp;from&nbsp;QueryRow&nbsp;and&nbsp;there&nbsp;was&nbsp;a&nbsp;deferred&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="5242796">func</span>&nbsp;<span class="op" id="5242801">(</span><span class="ident" id="5242802">rs</span>&nbsp;<span class="op" id="5242805">*</span><span class="ident" id="5242806"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5242810">)</span>&nbsp;<span class="ident" id="5242812">Columns</span><span class="op" id="5242819">(</span><span class="op" id="5242820">)</span>&nbsp;<span class="op" id="5242822">(</span><span class="op" id="5242823">[</span><span class="op" id="5242824">]</span><span class="builtintype" id="5242825">string</span><span class="op" id="5242831">,</span>&nbsp;<span class="builtintype" id="5242833">error</span><span class="op" id="5242838">)</span>&nbsp;<span class="op" id="5242840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242843">if</span>&nbsp;<span class="ident" id="5242846"><a href="/gostd/database/sql/sql.go.html#5242802">rs</a></span><span class="op" id="5242848">.</span><span class="ident" id="5242849"><a href="/gostd/database/sql/sql.go.html#5241645">closed</a></span>&nbsp;<span class="op" id="5242856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242860">return</span>&nbsp;<span class="builtintype" id="5242867">nil</span><span class="op" id="5242870">,</span>&nbsp;<span class="ident" id="5242872"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5242878">.</span><span class="ident" id="5242879"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5242882">(</span><span class="string" id="5242883">&#34;sql:&nbsp;Rows&nbsp;are&nbsp;closed&#34;</span><span class="op" id="5242905">)</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242911">if</span>&nbsp;<span class="ident" id="5242914"><a href="/gostd/database/sql/sql.go.html#5242802">rs</a></span><span class="op" id="5242916">.</span><span class="ident" id="5242917"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span>&nbsp;<span class="op" id="5242923">==</span>&nbsp;<span class="builtintype" id="5242926">nil</span>&nbsp;<span class="op" id="5242930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242934">return</span>&nbsp;<span class="builtintype" id="5242941">nil</span><span class="op" id="5242944">,</span>&nbsp;<span class="ident" id="5242946"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5242952">.</span><span class="ident" id="5242953"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5242956">(</span><span class="string" id="5242957">&#34;sql:&nbsp;no&nbsp;Rows&nbsp;available&#34;</span><span class="op" id="5242981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5242984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5242987">return</span>&nbsp;<span class="ident" id="5242994"><a href="/gostd/database/sql/sql.go.html#5242802">rs</a></span><span class="op" id="5242996">.</span><span class="ident" id="5242997"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5243002">.</span><span class="ident" id="5243003"><a href="/gostd/database/sql/driver/driver.go.html#5252877">Columns</a></span><span class="op" id="5243010">(</span><span class="op" id="5243011">)</span><span class="op" id="5243012">,</span>&nbsp;<span class="builtintype" id="5243014">nil</span><br>
<span class="lineno">1620</span><span class="op" id="5243018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5243021">//&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;row&nbsp;into&nbsp;the&nbsp;values&nbsp;pointed</span><br>
<span class="lineno"></span><span class="comment" id="5243091">//&nbsp;at&nbsp;by&nbsp;dest.</span><br>
<span class="lineno"></span><span class="comment" id="5243106">//</span><br>
<span class="lineno">1625</span><span class="comment" id="5243109">//&nbsp;If&nbsp;an&nbsp;argument&nbsp;has&nbsp;type&nbsp;*[]byte,&nbsp;Scan&nbsp;saves&nbsp;in&nbsp;that&nbsp;argument&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="5243180">//&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;data.&nbsp;The&nbsp;copy&nbsp;is&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5243250">//&nbsp;be&nbsp;modified&nbsp;and&nbsp;held&nbsp;indefinitely.&nbsp;The&nbsp;copy&nbsp;can&nbsp;be&nbsp;avoided&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5243321">//&nbsp;an&nbsp;argument&nbsp;of&nbsp;type&nbsp;*RawBytes&nbsp;instead;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5243389">//&nbsp;RawBytes&nbsp;for&nbsp;restrictions&nbsp;on&nbsp;its&nbsp;use.</span><br>
<span class="lineno">1630</span><span class="comment" id="5243430">//</span><br>
<span class="lineno"></span><span class="comment" id="5243433">//&nbsp;If&nbsp;an&nbsp;argument&nbsp;has&nbsp;type&nbsp;*interface{},&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5243496">//&nbsp;provided&nbsp;by&nbsp;the&nbsp;underlying&nbsp;driver&nbsp;without&nbsp;conversion.&nbsp;If&nbsp;the&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5243566">//&nbsp;is&nbsp;of&nbsp;type&nbsp;[]byte,&nbsp;a&nbsp;copy&nbsp;is&nbsp;made&nbsp;and&nbsp;the&nbsp;caller&nbsp;owns&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="5243635">func</span>&nbsp;<span class="op" id="5243640">(</span><span class="ident" id="5243641">rs</span>&nbsp;<span class="op" id="5243644">*</span><span class="ident" id="5243645"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5243649">)</span>&nbsp;<span class="ident" id="5243651">Scan</span><span class="op" id="5243655">(</span><span class="ident" id="5243656">dest</span>&nbsp;<span class="op" id="5243661">...</span><span class="keyword" id="5243664">interface</span><span class="op" id="5243673">{</span><span class="op" id="5243674">}</span><span class="op" id="5243675">)</span>&nbsp;<span class="builtintype" id="5243677">error</span>&nbsp;<span class="op" id="5243683">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243686">if</span>&nbsp;<span class="ident" id="5243689"><a href="/gostd/database/sql/sql.go.html#5243641">rs</a></span><span class="op" id="5243691">.</span><span class="ident" id="5243692"><a href="/gostd/database/sql/sql.go.html#5241645">closed</a></span>&nbsp;<span class="op" id="5243699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243703">return</span>&nbsp;<span class="ident" id="5243710"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5243716">.</span><span class="ident" id="5243717"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5243720">(</span><span class="string" id="5243721">&#34;sql:&nbsp;Rows&nbsp;are&nbsp;closed&#34;</span><span class="op" id="5243743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243749">if</span>&nbsp;<span class="ident" id="5243752"><a href="/gostd/database/sql/sql.go.html#5243641">rs</a></span><span class="op" id="5243754">.</span><span class="ident" id="5243755"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span>&nbsp;<span class="op" id="5243764">==</span>&nbsp;<span class="builtintype" id="5243767">nil</span>&nbsp;<span class="op" id="5243771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243775">return</span>&nbsp;<span class="ident" id="5243782"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5243788">.</span><span class="ident" id="5243789"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5243792">(</span><span class="string" id="5243793">&#34;sql:&nbsp;Scan&nbsp;called&nbsp;without&nbsp;calling&nbsp;Next&#34;</span><span class="op" id="5243832">)</span><br>
<span class="lineno">1640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243838">if</span>&nbsp;<span class="builtinfunc" id="5243841">len</span><span class="op" id="5243844">(</span><span class="ident" id="5243845"><a href="/gostd/database/sql/sql.go.html#5243656">dest</a></span><span class="op" id="5243849">)</span>&nbsp;<span class="op" id="5243851">!=</span>&nbsp;<span class="builtinfunc" id="5243854">len</span><span class="op" id="5243857">(</span><span class="ident" id="5243858"><a href="/gostd/database/sql/sql.go.html#5243641">rs</a></span><span class="op" id="5243860">.</span><span class="ident" id="5243861"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span><span class="op" id="5243869">)</span>&nbsp;<span class="op" id="5243871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243875">return</span>&nbsp;<span class="ident" id="5243882"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5243885">.</span><span class="ident" id="5243886"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="5243892">(</span><span class="string" id="5243893">&#34;sql:&nbsp;expected&nbsp;%d&nbsp;destination&nbsp;arguments&nbsp;in&nbsp;Scan,&nbsp;not&nbsp;%d&#34;</span><span class="op" id="5243949">,</span>&nbsp;<span class="builtinfunc" id="5243951">len</span><span class="op" id="5243954">(</span><span class="ident" id="5243955"><a href="/gostd/database/sql/sql.go.html#5243641">rs</a></span><span class="op" id="5243957">.</span><span class="ident" id="5243958"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span><span class="op" id="5243966">)</span><span class="op" id="5243967">,</span>&nbsp;<span class="builtinfunc" id="5243969">len</span><span class="op" id="5243972">(</span><span class="ident" id="5243973"><a href="/gostd/database/sql/sql.go.html#5243656">dest</a></span><span class="op" id="5243977">)</span><span class="op" id="5243978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5243981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5243984">for</span>&nbsp;<span class="ident" id="5243988">i</span><span class="op" id="5243989">,</span>&nbsp;<span class="ident" id="5243991">sv</span>&nbsp;<span class="op" id="5243994">:=</span>&nbsp;<span class="keyword" id="5243997">range</span>&nbsp;<span class="ident" id="5244003"><a href="/gostd/database/sql/sql.go.html#5243641">rs</a></span><span class="op" id="5244005">.</span><span class="ident" id="5244006"><a href="/gostd/database/sql/sql.go.html#5241661">lastcols</a></span>&nbsp;<span class="op" id="5244015">{</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244019">err</span>&nbsp;<span class="op" id="5244023">:=</span>&nbsp;<span class="ident" id="5244026"><a href="/gostd/database/sql/convert.go.html#5196804">convertAssign</a></span><span class="op" id="5244039">(</span><span class="ident" id="5244040"><a href="/gostd/database/sql/sql.go.html#5243656">dest</a></span><span class="op" id="5244044">[</span><span class="ident" id="5244045"><a href="/gostd/database/sql/sql.go.html#5243988">i</a></span><span class="op" id="5244046">]</span><span class="op" id="5244047">,</span>&nbsp;<span class="ident" id="5244049"><a href="/gostd/database/sql/sql.go.html#5243991">sv</a></span><span class="op" id="5244051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244055">if</span>&nbsp;<span class="ident" id="5244058"><a href="/gostd/database/sql/sql.go.html#5244019">err</a></span>&nbsp;<span class="op" id="5244062">!=</span>&nbsp;<span class="builtintype" id="5244065">nil</span>&nbsp;<span class="op" id="5244069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244074">return</span>&nbsp;<span class="ident" id="5244081"><a href="/gostd/database/sql/sql.go.html#5202097">fmt</a></span><span class="op" id="5244084">.</span><span class="ident" id="5244085"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="5244091">(</span><span class="string" id="5244092">&#34;sql:&nbsp;Scan&nbsp;error&nbsp;on&nbsp;column&nbsp;index&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="5244132">,</span>&nbsp;<span class="ident" id="5244134"><a href="/gostd/database/sql/sql.go.html#5243988">i</a></span><span class="op" id="5244135">,</span>&nbsp;<span class="ident" id="5244137"><a href="/gostd/database/sql/sql.go.html#5244019">err</a></span><span class="op" id="5244140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244147">}</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244150">return</span>&nbsp;<span class="builtintype" id="5244157">nil</span><br>
<span class="lineno"></span><span class="op" id="5244161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5244164">var</span>&nbsp;<span class="ident" id="5244168">rowsCloseHook</span>&nbsp;<span class="keyword" id="5244182">func</span><span class="op" id="5244186">(</span><span class="op" id="5244187">*</span><span class="ident" id="5244188"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5244192">,</span>&nbsp;<span class="op" id="5244194">*</span><span class="builtintype" id="5244195">error</span><span class="op" id="5244200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1655</span><span class="comment" id="5244203">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Rows,&nbsp;preventing&nbsp;further&nbsp;enumeration.&nbsp;If&nbsp;Next&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5244277">//&nbsp;false,&nbsp;the&nbsp;Rows&nbsp;are&nbsp;closed&nbsp;automatically&nbsp;and&nbsp;it&nbsp;will&nbsp;suffice&nbsp;to&nbsp;check&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5244354">//&nbsp;result&nbsp;of&nbsp;Err.&nbsp;Close&nbsp;is&nbsp;idempotent&nbsp;and&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;result&nbsp;of&nbsp;Err.</span><br>
<span class="lineno"></span><span class="keyword" id="5244431">func</span>&nbsp;<span class="op" id="5244436">(</span><span class="ident" id="5244437">rs</span>&nbsp;<span class="op" id="5244440">*</span><span class="ident" id="5244441"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><span class="op" id="5244445">)</span>&nbsp;<span class="ident" id="5244447">Close</span><span class="op" id="5244452">(</span><span class="op" id="5244453">)</span>&nbsp;<span class="builtintype" id="5244455">error</span>&nbsp;<span class="op" id="5244461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244464">if</span>&nbsp;<span class="ident" id="5244467"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244469">.</span><span class="ident" id="5244470"><a href="/gostd/database/sql/sql.go.html#5241645">closed</a></span>&nbsp;<span class="op" id="5244477">{</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244481">return</span>&nbsp;<span class="builtintype" id="5244488">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244496"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244498">.</span><span class="ident" id="5244499"><a href="/gostd/database/sql/sql.go.html#5241645">closed</a></span>&nbsp;<span class="op" id="5244506">=</span>&nbsp;<span class="builtintype" id="5244508">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244514">err</span>&nbsp;<span class="op" id="5244518">:=</span>&nbsp;<span class="ident" id="5244521"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244523">.</span><span class="ident" id="5244524"><a href="/gostd/database/sql/sql.go.html#5241619">rowsi</a></span><span class="op" id="5244529">.</span><span class="ident" id="5244530"><a href="/gostd/database/sql/driver/driver.go.html#5252934">Close</a></span><span class="op" id="5244535">(</span><span class="op" id="5244536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244539">if</span>&nbsp;<span class="ident" id="5244542">fn</span>&nbsp;<span class="op" id="5244545">:=</span>&nbsp;<span class="ident" id="5244548"><a href="/gostd/database/sql/sql.go.html#5244168">rowsCloseHook</a></span><span class="op" id="5244561">;</span>&nbsp;<span class="ident" id="5244563"><a href="/gostd/database/sql/sql.go.html#5244542">fn</a></span>&nbsp;<span class="op" id="5244566">!=</span>&nbsp;<span class="builtintype" id="5244569">nil</span>&nbsp;<span class="op" id="5244573">{</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244577"><a href="/gostd/database/sql/sql.go.html#5244542">fn</a></span><span class="op" id="5244579">(</span><span class="ident" id="5244580"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244582">,</span>&nbsp;<span class="op" id="5244584">&amp;</span><span class="ident" id="5244585"><a href="/gostd/database/sql/sql.go.html#5244514">err</a></span><span class="op" id="5244588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244594">if</span>&nbsp;<span class="ident" id="5244597"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244599">.</span><span class="ident" id="5244600"><a href="/gostd/database/sql/sql.go.html#5241744">closeStmt</a></span>&nbsp;<span class="op" id="5244610">!=</span>&nbsp;<span class="builtintype" id="5244613">nil</span>&nbsp;<span class="op" id="5244617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244621"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244623">.</span><span class="ident" id="5244624"><a href="/gostd/database/sql/sql.go.html#5241744">closeStmt</a></span><span class="op" id="5244633">.</span><span class="ident" id="5244634"><a href="/gostd/database/sql/driver/driver.go.html#5251420">Close</a></span><span class="op" id="5244639">(</span><span class="op" id="5244640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5244643">}</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244646"><a href="/gostd/database/sql/sql.go.html#5244437">rs</a></span><span class="op" id="5244648">.</span><span class="ident" id="5244649"><a href="/gostd/database/sql/sql.go.html#5241594">releaseConn</a></span><span class="op" id="5244660">(</span><span class="ident" id="5244661"><a href="/gostd/database/sql/sql.go.html#5244514">err</a></span><span class="op" id="5244664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5244667">return</span>&nbsp;<span class="ident" id="5244674"><a href="/gostd/database/sql/sql.go.html#5244514">err</a></span><br>
<span class="lineno"></span><span class="op" id="5244678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5244681">//&nbsp;Row&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;calling&nbsp;QueryRow&nbsp;to&nbsp;select&nbsp;a&nbsp;single&nbsp;row.</span><br>
<span class="lineno">1675</span><span class="keyword" id="5244746">type</span>&nbsp;<span class="ident" id="5244751">Row</span>&nbsp;<span class="keyword" id="5244755">struct</span>&nbsp;<span class="op" id="5244762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5244765">//&nbsp;One&nbsp;of&nbsp;these&nbsp;two&nbsp;will&nbsp;be&nbsp;non-nil:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244803">err</span>&nbsp;&nbsp;<span class="builtintype" id="5244808">error</span>&nbsp;<span class="comment" id="5244814">//&nbsp;deferred&nbsp;error&nbsp;for&nbsp;easy&nbsp;chaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5244851">rows</span>&nbsp;<span class="op" id="5244856">*</span><span class="ident" id="5244857"><a href="/gostd/database/sql/sql.go.html#5241499">Rows</a></span><br>
<span class="lineno"></span><span class="op" id="5244862">}</span><br>
<span class="lineno">1680</span><br>
<span class="lineno"></span><span class="comment" id="5244865">//&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;columns&nbsp;from&nbsp;the&nbsp;matched&nbsp;row&nbsp;into&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5244929">//&nbsp;pointed&nbsp;at&nbsp;by&nbsp;dest.&nbsp;&nbsp;If&nbsp;more&nbsp;than&nbsp;one&nbsp;row&nbsp;matches&nbsp;the&nbsp;query,</span><br>
<span class="lineno"></span><span class="comment" id="5244993">//&nbsp;Scan&nbsp;uses&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;discards&nbsp;the&nbsp;rest.&nbsp;&nbsp;If&nbsp;no&nbsp;row&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="5245062">//&nbsp;the&nbsp;query,&nbsp;Scan&nbsp;returns&nbsp;ErrNoRows.</span><br>
<span class="lineno">1685</span><span class="keyword" id="5245100">func</span>&nbsp;<span class="op" id="5245105">(</span><span class="ident" id="5245106">r</span>&nbsp;<span class="op" id="5245108">*</span><span class="ident" id="5245109"><a href="/gostd/database/sql/sql.go.html#5244751">Row</a></span><span class="op" id="5245112">)</span>&nbsp;<span class="ident" id="5245114">Scan</span><span class="op" id="5245118">(</span><span class="ident" id="5245119">dest</span>&nbsp;<span class="op" id="5245124">...</span><span class="keyword" id="5245127">interface</span><span class="op" id="5245136">{</span><span class="op" id="5245137">}</span><span class="op" id="5245138">)</span>&nbsp;<span class="builtintype" id="5245140">error</span>&nbsp;<span class="op" id="5245146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245149">if</span>&nbsp;<span class="ident" id="5245152"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5245153">.</span><span class="ident" id="5245154"><a href="/gostd/database/sql/sql.go.html#5244803">err</a></span>&nbsp;<span class="op" id="5245158">!=</span>&nbsp;<span class="builtintype" id="5245161">nil</span>&nbsp;<span class="op" id="5245165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245169">return</span>&nbsp;<span class="ident" id="5245176"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5245177">.</span><span class="ident" id="5245178"><a href="/gostd/database/sql/sql.go.html#5244803">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5245183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245187">//&nbsp;TODO(bradfitz):&nbsp;for&nbsp;now&nbsp;we&nbsp;need&nbsp;to&nbsp;defensively&nbsp;clone&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245248">//&nbsp;[]byte&nbsp;that&nbsp;the&nbsp;driver&nbsp;returned&nbsp;(not&nbsp;permitting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245300">//&nbsp;*RawBytes&nbsp;in&nbsp;Rows.Scan),&nbsp;since&nbsp;we&#39;re&nbsp;about&nbsp;to&nbsp;close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245356">//&nbsp;the&nbsp;Rows&nbsp;in&nbsp;our&nbsp;defer,&nbsp;when&nbsp;we&nbsp;return&nbsp;from&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245418">//&nbsp;the&nbsp;contract&nbsp;with&nbsp;the&nbsp;driver.Next(...)&nbsp;interface&nbsp;is&nbsp;that&nbsp;it</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245482">//&nbsp;can&nbsp;return&nbsp;slices&nbsp;into&nbsp;read-only&nbsp;temporary&nbsp;memory&nbsp;that&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245543">//&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;Scan/Close.&nbsp;&nbsp;But&nbsp;the&nbsp;TODO&nbsp;is&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245607">//&nbsp;for&nbsp;a&nbsp;lot&nbsp;of&nbsp;drivers,&nbsp;this&nbsp;copy&nbsp;will&nbsp;be&nbsp;unnecessary.&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245668">//&nbsp;should&nbsp;provide&nbsp;an&nbsp;optional&nbsp;interface&nbsp;for&nbsp;drivers&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245724">//&nbsp;implement&nbsp;to&nbsp;say,&nbsp;&#34;don&#39;t&nbsp;worry,&nbsp;the&nbsp;[]bytes&nbsp;that&nbsp;I&nbsp;return</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245786">//&nbsp;from&nbsp;Next&nbsp;will&nbsp;not&nbsp;be&nbsp;modified&nbsp;again.&#34;&nbsp;(for&nbsp;instance,&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245847">//&nbsp;they&nbsp;were&nbsp;obtained&nbsp;from&nbsp;the&nbsp;network&nbsp;anyway)&nbsp;But&nbsp;for&nbsp;now&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5245910">//&nbsp;don&#39;t&nbsp;care.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245926">defer</span>&nbsp;<span class="ident" id="5245932"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5245933">.</span><span class="ident" id="5245934"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5245938">.</span><span class="ident" id="5245939"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="5245944">(</span><span class="op" id="5245945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245948">for</span>&nbsp;<span class="ident" id="5245952">_</span><span class="op" id="5245953">,</span>&nbsp;<span class="ident" id="5245955">dp</span>&nbsp;<span class="op" id="5245958">:=</span>&nbsp;<span class="keyword" id="5245961">range</span>&nbsp;<span class="ident" id="5245967"><a href="/gostd/database/sql/sql.go.html#5245119">dest</a></span>&nbsp;<span class="op" id="5245972">{</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5245976">if</span>&nbsp;<span class="ident" id="5245979">_</span><span class="op" id="5245980">,</span>&nbsp;<span class="ident" id="5245982">ok</span>&nbsp;<span class="op" id="5245985">:=</span>&nbsp;<span class="ident" id="5245988"><a href="/gostd/database/sql/sql.go.html#5245955">dp</a></span><span class="op" id="5245990">.</span><span class="op" id="5245991">(</span><span class="op" id="5245992">*</span><span class="ident" id="5245993"><a href="/gostd/database/sql/sql.go.html#5203078">RawBytes</a></span><span class="op" id="5246001">)</span><span class="op" id="5246002">;</span>&nbsp;<span class="ident" id="5246004"><a href="/gostd/database/sql/sql.go.html#5245982">ok</a></span>&nbsp;<span class="op" id="5246007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246012">return</span>&nbsp;<span class="ident" id="5246019"><a href="/gostd/database/sql/sql.go.html#5202087">errors</a></span><span class="op" id="5246025">.</span><span class="ident" id="5246026"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="5246029">(</span><span class="string" id="5246030">&#34;sql:&nbsp;RawBytes&nbsp;isn&#39;t&nbsp;allowed&nbsp;on&nbsp;Row.Scan&#34;</span><span class="op" id="5246071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246082">if</span>&nbsp;<span class="op" id="5246085">!</span><span class="ident" id="5246086"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5246087">.</span><span class="ident" id="5246088"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5246092">.</span><span class="ident" id="5246093"><a href="/gostd/database/sql/sql.go.html#5242163">Next</a></span><span class="op" id="5246097">(</span><span class="op" id="5246098">)</span>&nbsp;<span class="op" id="5246100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246104">if</span>&nbsp;<span class="ident" id="5246107">err</span>&nbsp;<span class="op" id="5246111">:=</span>&nbsp;<span class="ident" id="5246114"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5246115">.</span><span class="ident" id="5246116"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5246120">.</span><span class="ident" id="5246121"><a href="/gostd/database/sql/sql.go.html#5242560">Err</a></span><span class="op" id="5246124">(</span><span class="op" id="5246125">)</span><span class="op" id="5246126">;</span>&nbsp;<span class="ident" id="5246128"><a href="/gostd/database/sql/sql.go.html#5246107">err</a></span>&nbsp;<span class="op" id="5246132">!=</span>&nbsp;<span class="builtintype" id="5246135">nil</span>&nbsp;<span class="op" id="5246139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246144">return</span>&nbsp;<span class="ident" id="5246151"><a href="/gostd/database/sql/sql.go.html#5246107">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246161">return</span>&nbsp;<span class="ident" id="5246168"><a href="/gostd/database/sql/sql.go.html#5206442">ErrNoRows</a></span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246182">err</span>&nbsp;<span class="op" id="5246186">:=</span>&nbsp;<span class="ident" id="5246189"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5246190">.</span><span class="ident" id="5246191"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5246195">.</span><span class="ident" id="5246196"><a href="/gostd/database/sql/sql.go.html#5243651">Scan</a></span><span class="op" id="5246200">(</span><span class="ident" id="5246201"><a href="/gostd/database/sql/sql.go.html#5245119">dest</a></span><span class="op" id="5246205">...</span><span class="op" id="5246208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246211">if</span>&nbsp;<span class="ident" id="5246214"><a href="/gostd/database/sql/sql.go.html#5246182">err</a></span>&nbsp;<span class="op" id="5246218">!=</span>&nbsp;<span class="builtintype" id="5246221">nil</span>&nbsp;<span class="op" id="5246225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246229">return</span>&nbsp;<span class="ident" id="5246236"><a href="/gostd/database/sql/sql.go.html#5246182">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246241">}</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246244">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;query&nbsp;can&nbsp;be&nbsp;processed&nbsp;to&nbsp;completion&nbsp;with&nbsp;no&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246315">if</span>&nbsp;<span class="ident" id="5246318">err</span>&nbsp;<span class="op" id="5246322">:=</span>&nbsp;<span class="ident" id="5246325"><a href="/gostd/database/sql/sql.go.html#5245106">r</a></span><span class="op" id="5246326">.</span><span class="ident" id="5246327"><a href="/gostd/database/sql/sql.go.html#5244851">rows</a></span><span class="op" id="5246331">.</span><span class="ident" id="5246332"><a href="/gostd/database/sql/sql.go.html#5244447">Close</a></span><span class="op" id="5246337">(</span><span class="op" id="5246338">)</span><span class="op" id="5246339">;</span>&nbsp;<span class="ident" id="5246341"><a href="/gostd/database/sql/sql.go.html#5246318">err</a></span>&nbsp;<span class="op" id="5246345">!=</span>&nbsp;<span class="builtintype" id="5246348">nil</span>&nbsp;<span class="op" id="5246352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246356">return</span>&nbsp;<span class="ident" id="5246363"><a href="/gostd/database/sql/sql.go.html#5246318">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5246368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5246372">return</span>&nbsp;<span class="builtintype" id="5246379">nil</span><br>
<span class="lineno"></span><span class="op" id="5246383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5246386">//&nbsp;A&nbsp;Result&nbsp;summarizes&nbsp;an&nbsp;executed&nbsp;SQL&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5246434">type</span>&nbsp;<span class="ident" id="5246439">Result</span>&nbsp;<span class="keyword" id="5246446">interface</span>&nbsp;<span class="op" id="5246456">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246459">//&nbsp;LastInsertId&nbsp;returns&nbsp;the&nbsp;integer&nbsp;generated&nbsp;by&nbsp;the&nbsp;database</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246522">//&nbsp;in&nbsp;response&nbsp;to&nbsp;a&nbsp;command.&nbsp;Typically&nbsp;this&nbsp;will&nbsp;be&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246583">//&nbsp;&#34;auto&nbsp;increment&#34;&nbsp;column&nbsp;when&nbsp;inserting&nbsp;a&nbsp;new&nbsp;row.&nbsp;Not&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246645">//&nbsp;databases&nbsp;support&nbsp;this&nbsp;feature,&nbsp;and&nbsp;the&nbsp;syntax&nbsp;of&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246704">//&nbsp;statements&nbsp;varies.</span><br>
<span class="lineno">1735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246727">LastInsertId</span><span class="op" id="5246739">(</span><span class="op" id="5246740">)</span>&nbsp;<span class="op" id="5246742">(</span><span class="builtintype" id="5246743">int64</span><span class="op" id="5246748">,</span>&nbsp;<span class="builtintype" id="5246750">error</span><span class="op" id="5246755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246759">//&nbsp;RowsAffected&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;affected&nbsp;by&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246818">//&nbsp;update,&nbsp;insert,&nbsp;or&nbsp;delete.&nbsp;Not&nbsp;every&nbsp;database&nbsp;or&nbsp;database</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5246880">//&nbsp;driver&nbsp;may&nbsp;support&nbsp;this.</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246909">RowsAffected</span><span class="op" id="5246921">(</span><span class="op" id="5246922">)</span>&nbsp;<span class="op" id="5246924">(</span><span class="builtintype" id="5246925">int64</span><span class="op" id="5246930">,</span>&nbsp;<span class="builtintype" id="5246932">error</span><span class="op" id="5246937">)</span><br>
<span class="lineno"></span><span class="op" id="5246939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5246942">type</span>&nbsp;<span class="ident" id="5246947">driverResult</span>&nbsp;<span class="keyword" id="5246960">struct</span>&nbsp;<span class="op" id="5246967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5246970"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5246974">.</span><span class="ident" id="5246975"><a href="/gostd/sync/mutex.go.html#1444090">Locker</a></span>&nbsp;<span class="comment" id="5246982">//&nbsp;the&nbsp;*driverConn</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247002">resi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247014"><a href="/gostd/database/sql/sql.go.html#5202064">driver</a></span><span class="op" id="5247020">.</span><span class="ident" id="5247021"><a href="/gostd/database/sql/driver/driver.go.html#5250891">Result</a></span><br>
<span class="lineno"></span><span class="op" id="5247028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5247031">func</span>&nbsp;<span class="op" id="5247036">(</span><span class="ident" id="5247037">dr</span>&nbsp;<span class="ident" id="5247040"><a href="/gostd/database/sql/sql.go.html#5246947">driverResult</a></span><span class="op" id="5247052">)</span>&nbsp;<span class="ident" id="5247054">LastInsertId</span><span class="op" id="5247066">(</span><span class="op" id="5247067">)</span>&nbsp;<span class="op" id="5247069">(</span><span class="builtintype" id="5247070">int64</span><span class="op" id="5247075">,</span>&nbsp;<span class="builtintype" id="5247077">error</span><span class="op" id="5247082">)</span>&nbsp;<span class="op" id="5247084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247087"><a href="/gostd/database/sql/sql.go.html#5247037">dr</a></span><span class="op" id="5247089">.</span><span class="ident" id="5247090"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5247094">(</span><span class="op" id="5247095">)</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247098">defer</span>&nbsp;<span class="ident" id="5247104"><a href="/gostd/database/sql/sql.go.html#5247037">dr</a></span><span class="op" id="5247106">.</span><span class="ident" id="5247107"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5247113">(</span><span class="op" id="5247114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247117">return</span>&nbsp;<span class="ident" id="5247124"><a href="/gostd/database/sql/sql.go.html#5247037">dr</a></span><span class="op" id="5247126">.</span><span class="ident" id="5247127"><a href="/gostd/database/sql/sql.go.html#5247002">resi</a></span><span class="op" id="5247131">.</span><span class="ident" id="5247132"><a href="/gostd/database/sql/driver/driver.go.html#5251038">LastInsertId</a></span><span class="op" id="5247144">(</span><span class="op" id="5247145">)</span><br>
<span class="lineno"></span><span class="op" id="5247147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5247150">func</span>&nbsp;<span class="op" id="5247155">(</span><span class="ident" id="5247156">dr</span>&nbsp;<span class="ident" id="5247159"><a href="/gostd/database/sql/sql.go.html#5246947">driverResult</a></span><span class="op" id="5247171">)</span>&nbsp;<span class="ident" id="5247173">RowsAffected</span><span class="op" id="5247185">(</span><span class="op" id="5247186">)</span>&nbsp;<span class="op" id="5247188">(</span><span class="builtintype" id="5247189">int64</span><span class="op" id="5247194">,</span>&nbsp;<span class="builtintype" id="5247196">error</span><span class="op" id="5247201">)</span>&nbsp;<span class="op" id="5247203">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247206"><a href="/gostd/database/sql/sql.go.html#5247156">dr</a></span><span class="op" id="5247208">.</span><span class="ident" id="5247209"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5247213">(</span><span class="op" id="5247214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247217">defer</span>&nbsp;<span class="ident" id="5247223"><a href="/gostd/database/sql/sql.go.html#5247156">dr</a></span><span class="op" id="5247225">.</span><span class="ident" id="5247226"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5247232">(</span><span class="op" id="5247233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247236">return</span>&nbsp;<span class="ident" id="5247243"><a href="/gostd/database/sql/sql.go.html#5247156">dr</a></span><span class="op" id="5247245">.</span><span class="ident" id="5247246"><a href="/gostd/database/sql/sql.go.html#5247002">resi</a></span><span class="op" id="5247250">.</span><span class="ident" id="5247251"><a href="/gostd/database/sql/driver/driver.go.html#5251141">RowsAffected</a></span><span class="op" id="5247263">(</span><span class="op" id="5247264">)</span><br>
<span class="lineno"></span><span class="op" id="5247266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1760</span><span class="keyword" id="5247269">func</span>&nbsp;<span class="ident" id="5247274">stack</span><span class="op" id="5247279">(</span><span class="op" id="5247280">)</span>&nbsp;<span class="builtintype" id="5247282">string</span>&nbsp;<span class="op" id="5247289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247292">var</span>&nbsp;<span class="ident" id="5247296">buf</span>&nbsp;<span class="op" id="5247300">[</span><span class="num" id="5247301">2</span>&nbsp;<span class="op" id="5247303">&lt;&lt;</span>&nbsp;<span class="num" id="5247306">10</span><span class="op" id="5247308">]</span><span class="builtintype" id="5247309">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5247315">return</span>&nbsp;<span class="builtintype" id="5247322">string</span><span class="op" id="5247328">(</span><span class="ident" id="5247329"><a href="/gostd/database/sql/sql.go.html#5247296">buf</a></span><span class="op" id="5247332">[</span><span class="op" id="5247333">:</span><span class="ident" id="5247334"><a href="/gostd/database/sql/sql.go.html#5202110">runtime</a></span><span class="op" id="5247341">.</span><span class="ident" id="5247342"><a href="/gostd/runtime/mprof.go.html#1634979">Stack</a></span><span class="op" id="5247347">(</span><span class="ident" id="5247348"><a href="/gostd/database/sql/sql.go.html#5247296">buf</a></span><span class="op" id="5247351">[</span><span class="op" id="5247352">:</span><span class="op" id="5247353">]</span><span class="op" id="5247354">,</span>&nbsp;<span class="builtintype" id="5247356">false</span><span class="op" id="5247361">)</span><span class="op" id="5247362">]</span><span class="op" id="5247363">)</span><br>
<span class="lineno"></span><span class="op" id="5247365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1765</span><span class="comment" id="5247368">//&nbsp;withLock&nbsp;runs&nbsp;while&nbsp;holding&nbsp;lk.</span><br>
<span class="lineno"></span><span class="keyword" id="5247403">func</span>&nbsp;<span class="ident" id="5247408">withLock</span><span class="op" id="5247416">(</span><span class="ident" id="5247417">lk</span>&nbsp;<span class="ident" id="5247420"><a href="/gostd/database/sql/sql.go.html#5202129">sync</a></span><span class="op" id="5247424">.</span><span class="ident" id="5247425"><a href="/gostd/sync/mutex.go.html#1444090">Locker</a></span><span class="op" id="5247431">,</span>&nbsp;<span class="ident" id="5247433">fn</span>&nbsp;<span class="keyword" id="5247436">func</span><span class="op" id="5247440">(</span><span class="op" id="5247441">)</span><span class="op" id="5247442">)</span>&nbsp;<span class="op" id="5247444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247447"><a href="/gostd/database/sql/sql.go.html#5247417">lk</a></span><span class="op" id="5247449">.</span><span class="ident" id="5247450"><a href="/gostd/sync/mutex.go.html#1444110">Lock</a></span><span class="op" id="5247454">(</span><span class="op" id="5247455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247458"><a href="/gostd/database/sql/sql.go.html#5247433">fn</a></span><span class="op" id="5247460">(</span><span class="op" id="5247461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5247464"><a href="/gostd/database/sql/sql.go.html#5247417">lk</a></span><span class="op" id="5247466">.</span><span class="ident" id="5247467"><a href="/gostd/sync/mutex.go.html#1444118">Unlock</a></span><span class="op" id="5247473">(</span><span class="op" id="5247474">)</span><br>
<span class="lineno">1770</span><span class="op" id="5247476">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
