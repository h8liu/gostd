<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6297392">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6297447">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6297501">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6297552">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6297608">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6297685">package</span>&nbsp;<span class="ident" id="6297693">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6297702">import</span>&nbsp;<span class="op" id="6297709">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297712">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6297718">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6297728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297731">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6297750">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6297809">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6297872">//</span><br>
<span class="lineno"></span><span class="comment" id="6297875">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6297939">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6298005">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6298077">//</span><br>
<span class="lineno">25</span><span class="comment" id="6298080">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6298144">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6298174">func</span>&nbsp;<span class="ident" id="6298179">Encode</span><span class="op" id="6298185">(</span><span class="ident" id="6298186">dst</span><span class="op" id="6298189">,</span>&nbsp;<span class="ident" id="6298191">src</span>&nbsp;<span class="op" id="6298195">[</span><span class="op" id="6298196">]</span><span class="builtintype" id="6298197">byte</span><span class="op" id="6298201">)</span>&nbsp;<span class="builtintype" id="6298203">int</span>&nbsp;<span class="op" id="6298207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298210">if</span>&nbsp;<span class="builtinfunc" id="6298213">len</span><span class="op" id="6298216">(</span><span class="ident" id="6298217">src</span><span class="op" id="6298220">)</span>&nbsp;<span class="op" id="6298222">==</span>&nbsp;<span class="num" id="6298225">0</span>&nbsp;<span class="op" id="6298227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298231">return</span>&nbsp;<span class="num" id="6298238">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298245">n</span>&nbsp;<span class="op" id="6298247">:=</span>&nbsp;<span class="num" id="6298250">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298253">for</span>&nbsp;<span class="builtinfunc" id="6298257">len</span><span class="op" id="6298260">(</span><span class="ident" id="6298261">src</span><span class="op" id="6298264">)</span>&nbsp;<span class="op" id="6298266">&gt;</span>&nbsp;<span class="num" id="6298268">0</span>&nbsp;<span class="op" id="6298270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298274">dst</span><span class="op" id="6298277">[</span><span class="num" id="6298278">0</span><span class="op" id="6298279">]</span>&nbsp;<span class="op" id="6298281">=</span>&nbsp;<span class="num" id="6298283">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298287">dst</span><span class="op" id="6298290">[</span><span class="num" id="6298291">1</span><span class="op" id="6298292">]</span>&nbsp;<span class="op" id="6298294">=</span>&nbsp;<span class="num" id="6298296">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298300">dst</span><span class="op" id="6298303">[</span><span class="num" id="6298304">2</span><span class="op" id="6298305">]</span>&nbsp;<span class="op" id="6298307">=</span>&nbsp;<span class="num" id="6298309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298313">dst</span><span class="op" id="6298316">[</span><span class="num" id="6298317">3</span><span class="op" id="6298318">]</span>&nbsp;<span class="op" id="6298320">=</span>&nbsp;<span class="num" id="6298322">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298326">dst</span><span class="op" id="6298329">[</span><span class="num" id="6298330">4</span><span class="op" id="6298331">]</span>&nbsp;<span class="op" id="6298333">=</span>&nbsp;<span class="num" id="6298335">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6298340">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298403">var</span>&nbsp;<span class="ident" id="6298407">v</span>&nbsp;<span class="builtintype" id="6298409">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298418">switch</span>&nbsp;<span class="builtinfunc" id="6298425">len</span><span class="op" id="6298428">(</span><span class="ident" id="6298429">src</span><span class="op" id="6298432">)</span>&nbsp;<span class="op" id="6298434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298438">default</span><span class="op" id="6298445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298450">v</span>&nbsp;<span class="op" id="6298452">|=</span>&nbsp;<span class="builtintype" id="6298455">uint32</span><span class="op" id="6298461">(</span><span class="ident" id="6298462">src</span><span class="op" id="6298465">[</span><span class="num" id="6298466">3</span><span class="op" id="6298467">]</span><span class="op" id="6298468">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298473">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298487">case</span>&nbsp;<span class="num" id="6298492">3</span><span class="op" id="6298493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298498">v</span>&nbsp;<span class="op" id="6298500">|=</span>&nbsp;<span class="builtintype" id="6298503">uint32</span><span class="op" id="6298509">(</span><span class="ident" id="6298510">src</span><span class="op" id="6298513">[</span><span class="num" id="6298514">2</span><span class="op" id="6298515">]</span><span class="op" id="6298516">)</span>&nbsp;<span class="op" id="6298518">&lt;&lt;</span>&nbsp;<span class="num" id="6298521">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298526">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298540">case</span>&nbsp;<span class="num" id="6298545">2</span><span class="op" id="6298546">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298551">v</span>&nbsp;<span class="op" id="6298553">|=</span>&nbsp;<span class="builtintype" id="6298556">uint32</span><span class="op" id="6298562">(</span><span class="ident" id="6298563">src</span><span class="op" id="6298566">[</span><span class="num" id="6298567">1</span><span class="op" id="6298568">]</span><span class="op" id="6298569">)</span>&nbsp;<span class="op" id="6298571">&lt;&lt;</span>&nbsp;<span class="num" id="6298574">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298580">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298594">case</span>&nbsp;<span class="num" id="6298599">1</span><span class="op" id="6298600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298605">v</span>&nbsp;<span class="op" id="6298607">|=</span>&nbsp;<span class="builtintype" id="6298610">uint32</span><span class="op" id="6298616">(</span><span class="ident" id="6298617">src</span><span class="op" id="6298620">[</span><span class="num" id="6298621">0</span><span class="op" id="6298622">]</span><span class="op" id="6298623">)</span>&nbsp;<span class="op" id="6298625">&lt;&lt;</span>&nbsp;<span class="num" id="6298628">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298633">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6298638">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298685">if</span>&nbsp;<span class="ident" id="6298688">v</span>&nbsp;<span class="op" id="6298690">==</span>&nbsp;<span class="num" id="6298693">0</span>&nbsp;<span class="op" id="6298695">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6298698">len</span><span class="op" id="6298701">(</span><span class="ident" id="6298702">src</span><span class="op" id="6298705">)</span>&nbsp;<span class="op" id="6298707">&gt;=</span>&nbsp;<span class="num" id="6298710">4</span>&nbsp;<span class="op" id="6298712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298717">dst</span><span class="op" id="6298720">[</span><span class="num" id="6298721">0</span><span class="op" id="6298722">]</span>&nbsp;<span class="op" id="6298724">=</span>&nbsp;<span class="string" id="6298726">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298733">dst</span>&nbsp;<span class="op" id="6298737">=</span>&nbsp;<span class="ident" id="6298739">dst</span><span class="op" id="6298742">[</span><span class="num" id="6298743">1</span><span class="op" id="6298744">:</span><span class="op" id="6298745">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298750">src</span>&nbsp;<span class="op" id="6298754">=</span>&nbsp;<span class="ident" id="6298756">src</span><span class="op" id="6298759">[</span><span class="num" id="6298760">4</span><span class="op" id="6298761">:</span><span class="op" id="6298762">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298767">n</span><span class="op" id="6298768">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298774">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6298790">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298838">for</span>&nbsp;<span class="ident" id="6298842">i</span>&nbsp;<span class="op" id="6298844">:=</span>&nbsp;<span class="num" id="6298847">4</span><span class="op" id="6298848">;</span>&nbsp;<span class="ident" id="6298850">i</span>&nbsp;<span class="op" id="6298852">&gt;=</span>&nbsp;<span class="num" id="6298855">0</span><span class="op" id="6298856">;</span>&nbsp;<span class="ident" id="6298858">i</span><span class="op" id="6298859">--</span>&nbsp;<span class="op" id="6298862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298867">dst</span><span class="op" id="6298870">[</span><span class="ident" id="6298871">i</span><span class="op" id="6298872">]</span>&nbsp;<span class="op" id="6298874">=</span>&nbsp;<span class="string" id="6298876">&#39;!&#39;</span>&nbsp;<span class="op" id="6298880">+</span>&nbsp;<span class="builtintype" id="6298882">byte</span><span class="op" id="6298886">(</span><span class="ident" id="6298887">v</span><span class="op" id="6298888">%</span><span class="num" id="6298889">85</span><span class="op" id="6298891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298896">v</span>&nbsp;<span class="op" id="6298898">/=</span>&nbsp;<span class="num" id="6298901">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298906">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6298911">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298969">m</span>&nbsp;<span class="op" id="6298971">:=</span>&nbsp;<span class="num" id="6298974">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298978">if</span>&nbsp;<span class="builtinfunc" id="6298981">len</span><span class="op" id="6298984">(</span><span class="ident" id="6298985">src</span><span class="op" id="6298988">)</span>&nbsp;<span class="op" id="6298990">&lt;</span>&nbsp;<span class="num" id="6298992">4</span>&nbsp;<span class="op" id="6298994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298999">m</span>&nbsp;<span class="op" id="6299001">-=</span>&nbsp;<span class="num" id="6299004">4</span>&nbsp;<span class="op" id="6299006">-</span>&nbsp;<span class="builtinfunc" id="6299008">len</span><span class="op" id="6299011">(</span><span class="ident" id="6299012">src</span><span class="op" id="6299015">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299020">src</span>&nbsp;<span class="op" id="6299024">=</span>&nbsp;<span class="ident" id="6299026">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299032">}</span>&nbsp;<span class="keyword" id="6299034">else</span>&nbsp;<span class="op" id="6299039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299044">src</span>&nbsp;<span class="op" id="6299048">=</span>&nbsp;<span class="ident" id="6299050">src</span><span class="op" id="6299053">[</span><span class="num" id="6299054">4</span><span class="op" id="6299055">:</span><span class="op" id="6299056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299064">dst</span>&nbsp;<span class="op" id="6299068">=</span>&nbsp;<span class="ident" id="6299070">dst</span><span class="op" id="6299073">[</span><span class="ident" id="6299074">m</span><span class="op" id="6299075">:</span><span class="op" id="6299076">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299080">n</span>&nbsp;<span class="op" id="6299082">+=</span>&nbsp;<span class="ident" id="6299085">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299091">return</span>&nbsp;<span class="ident" id="6299098">n</span><br>
<span class="lineno"></span><span class="op" id="6299100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6299103">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6299181">func</span>&nbsp;<span class="ident" id="6299186">MaxEncodedLen</span><span class="op" id="6299199">(</span><span class="ident" id="6299200">n</span>&nbsp;<span class="builtintype" id="6299202">int</span><span class="op" id="6299205">)</span>&nbsp;<span class="builtintype" id="6299207">int</span>&nbsp;<span class="op" id="6299211">{</span>&nbsp;<span class="keyword" id="6299213">return</span>&nbsp;<span class="op" id="6299220">(</span><span class="ident" id="6299221">n</span>&nbsp;<span class="op" id="6299223">+</span>&nbsp;<span class="num" id="6299225">3</span><span class="op" id="6299226">)</span>&nbsp;<span class="op" id="6299228">/</span>&nbsp;<span class="num" id="6299230">4</span>&nbsp;<span class="op" id="6299232">*</span>&nbsp;<span class="num" id="6299234">5</span>&nbsp;<span class="op" id="6299236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299239">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6299308">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6299370">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6299431">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6299499">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6299526">func</span>&nbsp;<span class="ident" id="6299531">NewEncoder</span><span class="op" id="6299541">(</span><span class="ident" id="6299542">w</span>&nbsp;<span class="ident" id="6299544">io</span><span class="op" id="6299546">.</span><span class="ident" id="6299547">Writer</span><span class="op" id="6299553">)</span>&nbsp;<span class="ident" id="6299555">io</span><span class="op" id="6299557">.</span><span class="ident" id="6299558">WriteCloser</span>&nbsp;<span class="op" id="6299570">{</span>&nbsp;<span class="keyword" id="6299572">return</span>&nbsp;<span class="op" id="6299579">&amp;</span><span class="ident" id="6299580">encoder</span><span class="op" id="6299587">{</span><span class="ident" id="6299588">w</span><span class="op" id="6299589">:</span>&nbsp;<span class="ident" id="6299591">w</span><span class="op" id="6299592">}</span>&nbsp;<span class="op" id="6299594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6299597">type</span>&nbsp;<span class="ident" id="6299602">encoder</span>&nbsp;<span class="keyword" id="6299610">struct</span>&nbsp;<span class="op" id="6299617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299620">err</span>&nbsp;&nbsp;<span class="builtintype" id="6299625">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299632">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299637">io</span><span class="op" id="6299639">.</span><span class="ident" id="6299640">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299648">buf</span>&nbsp;&nbsp;<span class="op" id="6299653">[</span><span class="num" id="6299654">4</span><span class="op" id="6299655">]</span><span class="builtintype" id="6299656">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299664">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299704">nbuf</span>&nbsp;<span class="builtintype" id="6299709">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299720">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299747">out</span>&nbsp;&nbsp;<span class="op" id="6299752">[</span><span class="num" id="6299753">1024</span><span class="op" id="6299757">]</span><span class="builtintype" id="6299758">byte</span>&nbsp;<span class="comment" id="6299763">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6299780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6299783">func</span>&nbsp;<span class="op" id="6299788">(</span><span class="ident" id="6299789">e</span>&nbsp;<span class="op" id="6299791">*</span><span class="ident" id="6299792">encoder</span><span class="op" id="6299799">)</span>&nbsp;<span class="ident" id="6299801">Write</span><span class="op" id="6299806">(</span><span class="ident" id="6299807">p</span>&nbsp;<span class="op" id="6299809">[</span><span class="op" id="6299810">]</span><span class="builtintype" id="6299811">byte</span><span class="op" id="6299815">)</span>&nbsp;<span class="op" id="6299817">(</span><span class="ident" id="6299818">n</span>&nbsp;<span class="builtintype" id="6299820">int</span><span class="op" id="6299823">,</span>&nbsp;<span class="ident" id="6299825">err</span>&nbsp;<span class="builtintype" id="6299829">error</span><span class="op" id="6299834">)</span>&nbsp;<span class="op" id="6299836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299839">if</span>&nbsp;<span class="ident" id="6299842">e</span><span class="op" id="6299843">.</span><span class="ident" id="6299844">err</span>&nbsp;<span class="op" id="6299848">!=</span>&nbsp;<span class="ident" id="6299851">nil</span>&nbsp;<span class="op" id="6299855">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299859">return</span>&nbsp;<span class="num" id="6299866">0</span><span class="op" id="6299867">,</span>&nbsp;<span class="ident" id="6299869">e</span><span class="op" id="6299870">.</span><span class="ident" id="6299871">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6299880">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299900">if</span>&nbsp;<span class="ident" id="6299903">e</span><span class="op" id="6299904">.</span><span class="ident" id="6299905">nbuf</span>&nbsp;<span class="op" id="6299910">&gt;</span>&nbsp;<span class="num" id="6299912">0</span>&nbsp;<span class="op" id="6299914">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299918">var</span>&nbsp;<span class="ident" id="6299922">i</span>&nbsp;<span class="builtintype" id="6299924">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299930">for</span>&nbsp;<span class="ident" id="6299934">i</span>&nbsp;<span class="op" id="6299936">=</span>&nbsp;<span class="num" id="6299938">0</span><span class="op" id="6299939">;</span>&nbsp;<span class="ident" id="6299941">i</span>&nbsp;<span class="op" id="6299943">&lt;</span>&nbsp;<span class="builtinfunc" id="6299945">len</span><span class="op" id="6299948">(</span><span class="ident" id="6299949">p</span><span class="op" id="6299950">)</span>&nbsp;<span class="op" id="6299952">&amp;&amp;</span>&nbsp;<span class="ident" id="6299955">e</span><span class="op" id="6299956">.</span><span class="ident" id="6299957">nbuf</span>&nbsp;<span class="op" id="6299962">&lt;</span>&nbsp;<span class="num" id="6299964">4</span><span class="op" id="6299965">;</span>&nbsp;<span class="ident" id="6299967">i</span><span class="op" id="6299968">++</span>&nbsp;<span class="op" id="6299971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299976">e</span><span class="op" id="6299977">.</span><span class="ident" id="6299978">buf</span><span class="op" id="6299981">[</span><span class="ident" id="6299982">e</span><span class="op" id="6299983">.</span><span class="ident" id="6299984">nbuf</span><span class="op" id="6299988">]</span>&nbsp;<span class="op" id="6299990">=</span>&nbsp;<span class="ident" id="6299992">p</span><span class="op" id="6299993">[</span><span class="ident" id="6299994">i</span><span class="op" id="6299995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300000">e</span><span class="op" id="6300001">.</span><span class="ident" id="6300002">nbuf</span><span class="op" id="6300006">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300011">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300015">n</span>&nbsp;<span class="op" id="6300017">+=</span>&nbsp;<span class="ident" id="6300020">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300024">p</span>&nbsp;<span class="op" id="6300026">=</span>&nbsp;<span class="ident" id="6300028">p</span><span class="op" id="6300029">[</span><span class="ident" id="6300030">i</span><span class="op" id="6300031">:</span><span class="op" id="6300032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300036">if</span>&nbsp;<span class="ident" id="6300039">e</span><span class="op" id="6300040">.</span><span class="ident" id="6300041">nbuf</span>&nbsp;<span class="op" id="6300046">&lt;</span>&nbsp;<span class="num" id="6300048">4</span>&nbsp;<span class="op" id="6300050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300055">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300064">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300068">nout</span>&nbsp;<span class="op" id="6300073">:=</span>&nbsp;<span class="ident" id="6300076">Encode</span><span class="op" id="6300082">(</span><span class="ident" id="6300083">e</span><span class="op" id="6300084">.</span><span class="ident" id="6300085">out</span><span class="op" id="6300088">[</span><span class="num" id="6300089">0</span><span class="op" id="6300090">:</span><span class="op" id="6300091">]</span><span class="op" id="6300092">,</span>&nbsp;<span class="ident" id="6300094">e</span><span class="op" id="6300095">.</span><span class="ident" id="6300096">buf</span><span class="op" id="6300099">[</span><span class="num" id="6300100">0</span><span class="op" id="6300101">:</span><span class="op" id="6300102">]</span><span class="op" id="6300103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300107">if</span>&nbsp;<span class="ident" id="6300110">_</span><span class="op" id="6300111">,</span>&nbsp;<span class="ident" id="6300113">e</span><span class="op" id="6300114">.</span><span class="ident" id="6300115">err</span>&nbsp;<span class="op" id="6300119">=</span>&nbsp;<span class="ident" id="6300121">e</span><span class="op" id="6300122">.</span><span class="ident" id="6300123">w</span><span class="op" id="6300124">.</span><span class="ident" id="6300125">Write</span><span class="op" id="6300130">(</span><span class="ident" id="6300131">e</span><span class="op" id="6300132">.</span><span class="ident" id="6300133">out</span><span class="op" id="6300136">[</span><span class="num" id="6300137">0</span><span class="op" id="6300138">:</span><span class="ident" id="6300139">nout</span><span class="op" id="6300143">]</span><span class="op" id="6300144">)</span><span class="op" id="6300145">;</span>&nbsp;<span class="ident" id="6300147">e</span><span class="op" id="6300148">.</span><span class="ident" id="6300149">err</span>&nbsp;<span class="op" id="6300153">!=</span>&nbsp;<span class="ident" id="6300156">nil</span>&nbsp;<span class="op" id="6300160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300165">return</span>&nbsp;<span class="ident" id="6300172">n</span><span class="op" id="6300173">,</span>&nbsp;<span class="ident" id="6300175">e</span><span class="op" id="6300176">.</span><span class="ident" id="6300177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300187">e</span><span class="op" id="6300188">.</span><span class="ident" id="6300189">nbuf</span>&nbsp;<span class="op" id="6300194">=</span>&nbsp;<span class="num" id="6300196">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300203">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300230">for</span>&nbsp;<span class="builtinfunc" id="6300234">len</span><span class="op" id="6300237">(</span><span class="ident" id="6300238">p</span><span class="op" id="6300239">)</span>&nbsp;<span class="op" id="6300241">&gt;=</span>&nbsp;<span class="num" id="6300244">4</span>&nbsp;<span class="op" id="6300246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300250">nn</span>&nbsp;<span class="op" id="6300253">:=</span>&nbsp;<span class="builtinfunc" id="6300256">len</span><span class="op" id="6300259">(</span><span class="ident" id="6300260">e</span><span class="op" id="6300261">.</span><span class="ident" id="6300262">out</span><span class="op" id="6300265">)</span>&nbsp;<span class="op" id="6300267">/</span>&nbsp;<span class="num" id="6300269">5</span>&nbsp;<span class="op" id="6300271">*</span>&nbsp;<span class="num" id="6300273">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300277">if</span>&nbsp;<span class="ident" id="6300280">nn</span>&nbsp;<span class="op" id="6300283">&gt;</span>&nbsp;<span class="builtinfunc" id="6300285">len</span><span class="op" id="6300288">(</span><span class="ident" id="6300289">p</span><span class="op" id="6300290">)</span>&nbsp;<span class="op" id="6300292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300297">nn</span>&nbsp;<span class="op" id="6300300">=</span>&nbsp;<span class="builtinfunc" id="6300302">len</span><span class="op" id="6300305">(</span><span class="ident" id="6300306">p</span><span class="op" id="6300307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300315">nn</span>&nbsp;<span class="op" id="6300318">-=</span>&nbsp;<span class="ident" id="6300321">nn</span>&nbsp;<span class="op" id="6300324">%</span>&nbsp;<span class="num" id="6300326">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300330">if</span>&nbsp;<span class="ident" id="6300333">nn</span>&nbsp;<span class="op" id="6300336">&gt;</span>&nbsp;<span class="num" id="6300338">0</span>&nbsp;<span class="op" id="6300340">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300345">nout</span>&nbsp;<span class="op" id="6300350">:=</span>&nbsp;<span class="ident" id="6300353">Encode</span><span class="op" id="6300359">(</span><span class="ident" id="6300360">e</span><span class="op" id="6300361">.</span><span class="ident" id="6300362">out</span><span class="op" id="6300365">[</span><span class="num" id="6300366">0</span><span class="op" id="6300367">:</span><span class="op" id="6300368">]</span><span class="op" id="6300369">,</span>&nbsp;<span class="ident" id="6300371">p</span><span class="op" id="6300372">[</span><span class="num" id="6300373">0</span><span class="op" id="6300374">:</span><span class="ident" id="6300375">nn</span><span class="op" id="6300377">]</span><span class="op" id="6300378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300383">if</span>&nbsp;<span class="ident" id="6300386">_</span><span class="op" id="6300387">,</span>&nbsp;<span class="ident" id="6300389">e</span><span class="op" id="6300390">.</span><span class="ident" id="6300391">err</span>&nbsp;<span class="op" id="6300395">=</span>&nbsp;<span class="ident" id="6300397">e</span><span class="op" id="6300398">.</span><span class="ident" id="6300399">w</span><span class="op" id="6300400">.</span><span class="ident" id="6300401">Write</span><span class="op" id="6300406">(</span><span class="ident" id="6300407">e</span><span class="op" id="6300408">.</span><span class="ident" id="6300409">out</span><span class="op" id="6300412">[</span><span class="num" id="6300413">0</span><span class="op" id="6300414">:</span><span class="ident" id="6300415">nout</span><span class="op" id="6300419">]</span><span class="op" id="6300420">)</span><span class="op" id="6300421">;</span>&nbsp;<span class="ident" id="6300423">e</span><span class="op" id="6300424">.</span><span class="ident" id="6300425">err</span>&nbsp;<span class="op" id="6300429">!=</span>&nbsp;<span class="ident" id="6300432">nil</span>&nbsp;<span class="op" id="6300436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300442">return</span>&nbsp;<span class="ident" id="6300449">n</span><span class="op" id="6300450">,</span>&nbsp;<span class="ident" id="6300452">e</span><span class="op" id="6300453">.</span><span class="ident" id="6300454">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300465">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300469">n</span>&nbsp;<span class="op" id="6300471">+=</span>&nbsp;<span class="ident" id="6300474">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300479">p</span>&nbsp;<span class="op" id="6300481">=</span>&nbsp;<span class="ident" id="6300483">p</span><span class="op" id="6300484">[</span><span class="ident" id="6300485">nn</span><span class="op" id="6300487">:</span><span class="op" id="6300488">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300495">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300516">for</span>&nbsp;<span class="ident" id="6300520">i</span>&nbsp;<span class="op" id="6300522">:=</span>&nbsp;<span class="num" id="6300525">0</span><span class="op" id="6300526">;</span>&nbsp;<span class="ident" id="6300528">i</span>&nbsp;<span class="op" id="6300530">&lt;</span>&nbsp;<span class="builtinfunc" id="6300532">len</span><span class="op" id="6300535">(</span><span class="ident" id="6300536">p</span><span class="op" id="6300537">)</span><span class="op" id="6300538">;</span>&nbsp;<span class="ident" id="6300540">i</span><span class="op" id="6300541">++</span>&nbsp;<span class="op" id="6300544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300548">e</span><span class="op" id="6300549">.</span><span class="ident" id="6300550">buf</span><span class="op" id="6300553">[</span><span class="ident" id="6300554">i</span><span class="op" id="6300555">]</span>&nbsp;<span class="op" id="6300557">=</span>&nbsp;<span class="ident" id="6300559">p</span><span class="op" id="6300560">[</span><span class="ident" id="6300561">i</span><span class="op" id="6300562">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300568">e</span><span class="op" id="6300569">.</span><span class="ident" id="6300570">nbuf</span>&nbsp;<span class="op" id="6300575">=</span>&nbsp;<span class="builtinfunc" id="6300577">len</span><span class="op" id="6300580">(</span><span class="ident" id="6300581">p</span><span class="op" id="6300582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300585">n</span>&nbsp;<span class="op" id="6300587">+=</span>&nbsp;<span class="builtinfunc" id="6300590">len</span><span class="op" id="6300593">(</span><span class="ident" id="6300594">p</span><span class="op" id="6300595">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300598">return</span><br>
<span class="lineno"></span><span class="op" id="6300605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300608">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6300662">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6300715">func</span>&nbsp;<span class="op" id="6300720">(</span><span class="ident" id="6300721">e</span>&nbsp;<span class="op" id="6300723">*</span><span class="ident" id="6300724">encoder</span><span class="op" id="6300731">)</span>&nbsp;<span class="ident" id="6300733">Close</span><span class="op" id="6300738">(</span><span class="op" id="6300739">)</span>&nbsp;<span class="builtintype" id="6300741">error</span>&nbsp;<span class="op" id="6300747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300750">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300807">if</span>&nbsp;<span class="ident" id="6300810">e</span><span class="op" id="6300811">.</span><span class="ident" id="6300812">err</span>&nbsp;<span class="op" id="6300816">==</span>&nbsp;<span class="ident" id="6300819">nil</span>&nbsp;<span class="op" id="6300823">&amp;&amp;</span>&nbsp;<span class="ident" id="6300826">e</span><span class="op" id="6300827">.</span><span class="ident" id="6300828">nbuf</span>&nbsp;<span class="op" id="6300833">&gt;</span>&nbsp;<span class="num" id="6300835">0</span>&nbsp;<span class="op" id="6300837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300841">nout</span>&nbsp;<span class="op" id="6300846">:=</span>&nbsp;<span class="ident" id="6300849">Encode</span><span class="op" id="6300855">(</span><span class="ident" id="6300856">e</span><span class="op" id="6300857">.</span><span class="ident" id="6300858">out</span><span class="op" id="6300861">[</span><span class="num" id="6300862">0</span><span class="op" id="6300863">:</span><span class="op" id="6300864">]</span><span class="op" id="6300865">,</span>&nbsp;<span class="ident" id="6300867">e</span><span class="op" id="6300868">.</span><span class="ident" id="6300869">buf</span><span class="op" id="6300872">[</span><span class="num" id="6300873">0</span><span class="op" id="6300874">:</span><span class="ident" id="6300875">e</span><span class="op" id="6300876">.</span><span class="ident" id="6300877">nbuf</span><span class="op" id="6300881">]</span><span class="op" id="6300882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300886">e</span><span class="op" id="6300887">.</span><span class="ident" id="6300888">nbuf</span>&nbsp;<span class="op" id="6300893">=</span>&nbsp;<span class="num" id="6300895">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300899">_</span><span class="op" id="6300900">,</span>&nbsp;<span class="ident" id="6300902">e</span><span class="op" id="6300903">.</span><span class="ident" id="6300904">err</span>&nbsp;<span class="op" id="6300908">=</span>&nbsp;<span class="ident" id="6300910">e</span><span class="op" id="6300911">.</span><span class="ident" id="6300912">w</span><span class="op" id="6300913">.</span><span class="ident" id="6300914">Write</span><span class="op" id="6300919">(</span><span class="ident" id="6300920">e</span><span class="op" id="6300921">.</span><span class="ident" id="6300922">out</span><span class="op" id="6300925">[</span><span class="num" id="6300926">0</span><span class="op" id="6300927">:</span><span class="ident" id="6300928">nout</span><span class="op" id="6300932">]</span><span class="op" id="6300933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300939">return</span>&nbsp;<span class="ident" id="6300946">e</span><span class="op" id="6300947">.</span><span class="ident" id="6300948">err</span><br>
<span class="lineno"></span><span class="op" id="6300952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6300955">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300974">type</span>&nbsp;<span class="ident" id="6300979">CorruptInputError</span>&nbsp;<span class="ident" id="6300997">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6301004">func</span>&nbsp;<span class="op" id="6301009">(</span><span class="ident" id="6301010">e</span>&nbsp;<span class="ident" id="6301012">CorruptInputError</span><span class="op" id="6301029">)</span>&nbsp;<span class="ident" id="6301031">Error</span><span class="op" id="6301036">(</span><span class="op" id="6301037">)</span>&nbsp;<span class="builtintype" id="6301039">string</span>&nbsp;<span class="op" id="6301046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301049">return</span>&nbsp;<span class="string" id="6301056">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6301094">+</span>&nbsp;<span class="ident" id="6301096">strconv</span><span class="op" id="6301103">.</span><span class="ident" id="6301104">FormatInt</span><span class="op" id="6301113">(</span><span class="ident" id="6301114">int64</span><span class="op" id="6301119">(</span><span class="ident" id="6301120">e</span><span class="op" id="6301121">)</span><span class="op" id="6301122">,</span>&nbsp;<span class="num" id="6301124">10</span><span class="op" id="6301126">)</span><br>
<span class="lineno"></span><span class="op" id="6301128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6301131">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6301189">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6301250">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6301314">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6301379">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6301434">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6301498">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6301559">//</span><br>
<span class="lineno"></span><span class="comment" id="6301562">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6301622">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6301684">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6301741">//</span><br>
<span class="lineno"></span><span class="comment" id="6301744">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6301802">//</span><br>
<span class="lineno"></span><span class="keyword" id="6301805">func</span>&nbsp;<span class="ident" id="6301810">Decode</span><span class="op" id="6301816">(</span><span class="ident" id="6301817">dst</span><span class="op" id="6301820">,</span>&nbsp;<span class="ident" id="6301822">src</span>&nbsp;<span class="op" id="6301826">[</span><span class="op" id="6301827">]</span><span class="builtintype" id="6301828">byte</span><span class="op" id="6301832">,</span>&nbsp;<span class="ident" id="6301834">flush</span>&nbsp;<span class="builtintype" id="6301840">bool</span><span class="op" id="6301844">)</span>&nbsp;<span class="op" id="6301846">(</span><span class="ident" id="6301847">ndst</span><span class="op" id="6301851">,</span>&nbsp;<span class="ident" id="6301853">nsrc</span>&nbsp;<span class="builtintype" id="6301858">int</span><span class="op" id="6301861">,</span>&nbsp;<span class="ident" id="6301863">err</span>&nbsp;<span class="builtintype" id="6301867">error</span><span class="op" id="6301872">)</span>&nbsp;<span class="op" id="6301874">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301877">var</span>&nbsp;<span class="ident" id="6301881">v</span>&nbsp;<span class="builtintype" id="6301883">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301891">var</span>&nbsp;<span class="ident" id="6301895">nb</span>&nbsp;<span class="builtintype" id="6301898">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301903">for</span>&nbsp;<span class="ident" id="6301907">i</span><span class="op" id="6301908">,</span>&nbsp;<span class="ident" id="6301910">b</span>&nbsp;<span class="op" id="6301912">:=</span>&nbsp;<span class="keyword" id="6301915">range</span>&nbsp;<span class="ident" id="6301921">src</span>&nbsp;<span class="op" id="6301925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301929">if</span>&nbsp;<span class="builtinfunc" id="6301932">len</span><span class="op" id="6301935">(</span><span class="ident" id="6301936">dst</span><span class="op" id="6301939">)</span><span class="op" id="6301940">-</span><span class="ident" id="6301941">ndst</span>&nbsp;<span class="op" id="6301946">&lt;</span>&nbsp;<span class="num" id="6301948">4</span>&nbsp;<span class="op" id="6301950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301955">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6301964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301968">switch</span>&nbsp;<span class="op" id="6301975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301979">case</span>&nbsp;<span class="ident" id="6301984">b</span>&nbsp;<span class="op" id="6301986">&lt;=</span>&nbsp;<span class="string" id="6301989">&#39;&nbsp;&#39;</span><span class="op" id="6301992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301997">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302008">case</span>&nbsp;<span class="ident" id="6302013">b</span>&nbsp;<span class="op" id="6302015">==</span>&nbsp;<span class="string" id="6302018">&#39;z&#39;</span>&nbsp;<span class="op" id="6302022">&amp;&amp;</span>&nbsp;<span class="ident" id="6302025">nb</span>&nbsp;<span class="op" id="6302028">==</span>&nbsp;<span class="num" id="6302031">0</span><span class="op" id="6302032">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302037">nb</span>&nbsp;<span class="op" id="6302040">=</span>&nbsp;<span class="num" id="6302042">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302047">v</span>&nbsp;<span class="op" id="6302049">=</span>&nbsp;<span class="num" id="6302051">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302055">case</span>&nbsp;<span class="string" id="6302060">&#39;!&#39;</span>&nbsp;<span class="op" id="6302064">&lt;=</span>&nbsp;<span class="ident" id="6302067">b</span>&nbsp;<span class="op" id="6302069">&amp;&amp;</span>&nbsp;<span class="ident" id="6302072">b</span>&nbsp;<span class="op" id="6302074">&lt;=</span>&nbsp;<span class="string" id="6302077">&#39;u&#39;</span><span class="op" id="6302080">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302085">v</span>&nbsp;<span class="op" id="6302087">=</span>&nbsp;<span class="ident" id="6302089">v</span><span class="op" id="6302090">*</span><span class="num" id="6302091">85</span>&nbsp;<span class="op" id="6302094">+</span>&nbsp;<span class="builtintype" id="6302096">uint32</span><span class="op" id="6302102">(</span><span class="ident" id="6302103">b</span><span class="op" id="6302104">-</span><span class="string" id="6302105">&#39;!&#39;</span><span class="op" id="6302108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302113">nb</span><span class="op" id="6302115">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302120">default</span><span class="op" id="6302127">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302132">return</span>&nbsp;<span class="num" id="6302139">0</span><span class="op" id="6302140">,</span>&nbsp;<span class="num" id="6302142">0</span><span class="op" id="6302143">,</span>&nbsp;<span class="ident" id="6302145">CorruptInputError</span><span class="op" id="6302162">(</span><span class="ident" id="6302163">i</span><span class="op" id="6302164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302172">if</span>&nbsp;<span class="ident" id="6302175">nb</span>&nbsp;<span class="op" id="6302178">==</span>&nbsp;<span class="num" id="6302181">5</span>&nbsp;<span class="op" id="6302183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302188">nsrc</span>&nbsp;<span class="op" id="6302193">=</span>&nbsp;<span class="ident" id="6302195">i</span>&nbsp;<span class="op" id="6302197">+</span>&nbsp;<span class="num" id="6302199">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302204">dst</span><span class="op" id="6302207">[</span><span class="ident" id="6302208">ndst</span><span class="op" id="6302212">]</span>&nbsp;<span class="op" id="6302214">=</span>&nbsp;<span class="builtintype" id="6302216">byte</span><span class="op" id="6302220">(</span><span class="ident" id="6302221">v</span>&nbsp;<span class="op" id="6302223">&gt;&gt;</span>&nbsp;<span class="num" id="6302226">24</span><span class="op" id="6302228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302233">dst</span><span class="op" id="6302236">[</span><span class="ident" id="6302237">ndst</span><span class="op" id="6302241">+</span><span class="num" id="6302242">1</span><span class="op" id="6302243">]</span>&nbsp;<span class="op" id="6302245">=</span>&nbsp;<span class="builtintype" id="6302247">byte</span><span class="op" id="6302251">(</span><span class="ident" id="6302252">v</span>&nbsp;<span class="op" id="6302254">&gt;&gt;</span>&nbsp;<span class="num" id="6302257">16</span><span class="op" id="6302259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302264">dst</span><span class="op" id="6302267">[</span><span class="ident" id="6302268">ndst</span><span class="op" id="6302272">+</span><span class="num" id="6302273">2</span><span class="op" id="6302274">]</span>&nbsp;<span class="op" id="6302276">=</span>&nbsp;<span class="builtintype" id="6302278">byte</span><span class="op" id="6302282">(</span><span class="ident" id="6302283">v</span>&nbsp;<span class="op" id="6302285">&gt;&gt;</span>&nbsp;<span class="num" id="6302288">8</span><span class="op" id="6302289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302294">dst</span><span class="op" id="6302297">[</span><span class="ident" id="6302298">ndst</span><span class="op" id="6302302">+</span><span class="num" id="6302303">3</span><span class="op" id="6302304">]</span>&nbsp;<span class="op" id="6302306">=</span>&nbsp;<span class="builtintype" id="6302308">byte</span><span class="op" id="6302312">(</span><span class="ident" id="6302313">v</span><span class="op" id="6302314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302319">ndst</span>&nbsp;<span class="op" id="6302324">+=</span>&nbsp;<span class="num" id="6302327">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302332">nb</span>&nbsp;<span class="op" id="6302335">=</span>&nbsp;<span class="num" id="6302337">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302342">v</span>&nbsp;<span class="op" id="6302344">=</span>&nbsp;<span class="num" id="6302346">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302356">if</span>&nbsp;<span class="ident" id="6302359">flush</span>&nbsp;<span class="op" id="6302365">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302369">nsrc</span>&nbsp;<span class="op" id="6302374">=</span>&nbsp;<span class="builtinfunc" id="6302376">len</span><span class="op" id="6302379">(</span><span class="ident" id="6302380">src</span><span class="op" id="6302383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302387">if</span>&nbsp;<span class="ident" id="6302390">nb</span>&nbsp;<span class="op" id="6302393">&gt;</span>&nbsp;<span class="num" id="6302395">0</span>&nbsp;<span class="op" id="6302397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302402">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302456">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302505">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302556">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302610">if</span>&nbsp;<span class="ident" id="6302613">nb</span>&nbsp;<span class="op" id="6302616">==</span>&nbsp;<span class="num" id="6302619">1</span>&nbsp;<span class="op" id="6302621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302627">return</span>&nbsp;<span class="num" id="6302634">0</span><span class="op" id="6302635">,</span>&nbsp;<span class="num" id="6302637">0</span><span class="op" id="6302638">,</span>&nbsp;<span class="ident" id="6302640">CorruptInputError</span><span class="op" id="6302657">(</span><span class="builtinfunc" id="6302658">len</span><span class="op" id="6302661">(</span><span class="ident" id="6302662">src</span><span class="op" id="6302665">)</span><span class="op" id="6302666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302676">for</span>&nbsp;<span class="ident" id="6302680">i</span>&nbsp;<span class="op" id="6302682">:=</span>&nbsp;<span class="ident" id="6302685">nb</span><span class="op" id="6302687">;</span>&nbsp;<span class="ident" id="6302689">i</span>&nbsp;<span class="op" id="6302691">&lt;</span>&nbsp;<span class="num" id="6302693">5</span><span class="op" id="6302694">;</span>&nbsp;<span class="ident" id="6302696">i</span><span class="op" id="6302697">++</span>&nbsp;<span class="op" id="6302700">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302706">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302760">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302818">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302875">v</span>&nbsp;<span class="op" id="6302877">=</span>&nbsp;<span class="ident" id="6302879">v</span><span class="op" id="6302880">*</span><span class="num" id="6302881">85</span>&nbsp;<span class="op" id="6302884">+</span>&nbsp;<span class="num" id="6302886">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302892">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302897">for</span>&nbsp;<span class="ident" id="6302901">i</span>&nbsp;<span class="op" id="6302903">:=</span>&nbsp;<span class="num" id="6302906">0</span><span class="op" id="6302907">;</span>&nbsp;<span class="ident" id="6302909">i</span>&nbsp;<span class="op" id="6302911">&lt;</span>&nbsp;<span class="ident" id="6302913">nb</span><span class="op" id="6302915">-</span><span class="num" id="6302916">1</span><span class="op" id="6302917">;</span>&nbsp;<span class="ident" id="6302919">i</span><span class="op" id="6302920">++</span>&nbsp;<span class="op" id="6302923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302929">dst</span><span class="op" id="6302932">[</span><span class="ident" id="6302933">ndst</span><span class="op" id="6302937">]</span>&nbsp;<span class="op" id="6302939">=</span>&nbsp;<span class="builtintype" id="6302941">byte</span><span class="op" id="6302945">(</span><span class="ident" id="6302946">v</span>&nbsp;<span class="op" id="6302948">&gt;&gt;</span>&nbsp;<span class="num" id="6302951">24</span><span class="op" id="6302953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302959">v</span>&nbsp;<span class="op" id="6302961">&lt;&lt;=</span>&nbsp;<span class="num" id="6302965">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302971">ndst</span><span class="op" id="6302975">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302981">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302991">return</span><br>
<span class="lineno"></span><span class="op" id="6302998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6303001">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6303056">func</span>&nbsp;<span class="ident" id="6303061">NewDecoder</span><span class="op" id="6303071">(</span><span class="ident" id="6303072">r</span>&nbsp;<span class="ident" id="6303074">io</span><span class="op" id="6303076">.</span><span class="ident" id="6303077">Reader</span><span class="op" id="6303083">)</span>&nbsp;<span class="ident" id="6303085">io</span><span class="op" id="6303087">.</span><span class="ident" id="6303088">Reader</span>&nbsp;<span class="op" id="6303095">{</span>&nbsp;<span class="keyword" id="6303097">return</span>&nbsp;<span class="op" id="6303104">&amp;</span><span class="ident" id="6303105">decoder</span><span class="op" id="6303112">{</span><span class="ident" id="6303113">r</span><span class="op" id="6303114">:</span>&nbsp;<span class="ident" id="6303116">r</span><span class="op" id="6303117">}</span>&nbsp;<span class="op" id="6303119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6303122">type</span>&nbsp;<span class="ident" id="6303127">decoder</span>&nbsp;<span class="keyword" id="6303135">struct</span>&nbsp;<span class="op" id="6303142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303145">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6303153">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303160">readErr</span>&nbsp;<span class="builtintype" id="6303168">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303175">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303183">io</span><span class="op" id="6303185">.</span><span class="ident" id="6303186">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303194">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303202">[</span><span class="num" id="6303203">1024</span><span class="op" id="6303207">]</span><span class="builtintype" id="6303208">byte</span>&nbsp;<span class="comment" id="6303213">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303232">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6303240">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303245">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303253">[</span><span class="op" id="6303254">]</span><span class="builtintype" id="6303255">byte</span>&nbsp;<span class="comment" id="6303260">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303288">outbuf</span>&nbsp;&nbsp;<span class="op" id="6303296">[</span><span class="num" id="6303297">1024</span><span class="op" id="6303301">]</span><span class="builtintype" id="6303302">byte</span><br>
<span class="lineno"></span><span class="op" id="6303307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6303310">func</span>&nbsp;<span class="op" id="6303315">(</span><span class="ident" id="6303316">d</span>&nbsp;<span class="op" id="6303318">*</span><span class="ident" id="6303319">decoder</span><span class="op" id="6303326">)</span>&nbsp;<span class="ident" id="6303328">Read</span><span class="op" id="6303332">(</span><span class="ident" id="6303333">p</span>&nbsp;<span class="op" id="6303335">[</span><span class="op" id="6303336">]</span><span class="builtintype" id="6303337">byte</span><span class="op" id="6303341">)</span>&nbsp;<span class="op" id="6303343">(</span><span class="ident" id="6303344">n</span>&nbsp;<span class="builtintype" id="6303346">int</span><span class="op" id="6303349">,</span>&nbsp;<span class="ident" id="6303351">err</span>&nbsp;<span class="builtintype" id="6303355">error</span><span class="op" id="6303360">)</span>&nbsp;<span class="op" id="6303362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303365">if</span>&nbsp;<span class="builtinfunc" id="6303368">len</span><span class="op" id="6303371">(</span><span class="ident" id="6303372">p</span><span class="op" id="6303373">)</span>&nbsp;<span class="op" id="6303375">==</span>&nbsp;<span class="num" id="6303378">0</span>&nbsp;<span class="op" id="6303380">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303384">return</span>&nbsp;<span class="num" id="6303391">0</span><span class="op" id="6303392">,</span>&nbsp;<span class="ident" id="6303394">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303402">if</span>&nbsp;<span class="ident" id="6303405">d</span><span class="op" id="6303406">.</span><span class="ident" id="6303407">err</span>&nbsp;<span class="op" id="6303411">!=</span>&nbsp;<span class="ident" id="6303414">nil</span>&nbsp;<span class="op" id="6303418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303422">return</span>&nbsp;<span class="num" id="6303429">0</span><span class="op" id="6303430">,</span>&nbsp;<span class="ident" id="6303432">d</span><span class="op" id="6303433">.</span><span class="ident" id="6303434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303439">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303443">for</span>&nbsp;<span class="op" id="6303447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6303451">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303495">if</span>&nbsp;<span class="builtinfunc" id="6303498">len</span><span class="op" id="6303501">(</span><span class="ident" id="6303502">d</span><span class="op" id="6303503">.</span><span class="ident" id="6303504">out</span><span class="op" id="6303507">)</span>&nbsp;<span class="op" id="6303509">&gt;</span>&nbsp;<span class="num" id="6303511">0</span>&nbsp;<span class="op" id="6303513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303518">n</span>&nbsp;<span class="op" id="6303520">=</span>&nbsp;<span class="builtinfunc" id="6303522">copy</span><span class="op" id="6303526">(</span><span class="ident" id="6303527">p</span><span class="op" id="6303528">,</span>&nbsp;<span class="ident" id="6303530">d</span><span class="op" id="6303531">.</span><span class="ident" id="6303532">out</span><span class="op" id="6303535">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303540">d</span><span class="op" id="6303541">.</span><span class="ident" id="6303542">out</span>&nbsp;<span class="op" id="6303546">=</span>&nbsp;<span class="ident" id="6303548">d</span><span class="op" id="6303549">.</span><span class="ident" id="6303550">out</span><span class="op" id="6303553">[</span><span class="ident" id="6303554">n</span><span class="op" id="6303555">:</span><span class="op" id="6303556">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303561">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6303575">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303618">var</span>&nbsp;<span class="ident" id="6303622">nn</span><span class="op" id="6303624">,</span>&nbsp;<span class="ident" id="6303626">nsrc</span><span class="op" id="6303630">,</span>&nbsp;<span class="ident" id="6303632">ndst</span>&nbsp;<span class="builtintype" id="6303637">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303643">if</span>&nbsp;<span class="ident" id="6303646">d</span><span class="op" id="6303647">.</span><span class="ident" id="6303648">nbuf</span>&nbsp;<span class="op" id="6303653">&gt;</span>&nbsp;<span class="num" id="6303655">0</span>&nbsp;<span class="op" id="6303657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303662">ndst</span><span class="op" id="6303666">,</span>&nbsp;<span class="ident" id="6303668">nsrc</span><span class="op" id="6303672">,</span>&nbsp;<span class="ident" id="6303674">d</span><span class="op" id="6303675">.</span><span class="ident" id="6303676">err</span>&nbsp;<span class="op" id="6303680">=</span>&nbsp;<span class="ident" id="6303682">Decode</span><span class="op" id="6303688">(</span><span class="ident" id="6303689">d</span><span class="op" id="6303690">.</span><span class="ident" id="6303691">outbuf</span><span class="op" id="6303697">[</span><span class="num" id="6303698">0</span><span class="op" id="6303699">:</span><span class="op" id="6303700">]</span><span class="op" id="6303701">,</span>&nbsp;<span class="ident" id="6303703">d</span><span class="op" id="6303704">.</span><span class="ident" id="6303705">buf</span><span class="op" id="6303708">[</span><span class="num" id="6303709">0</span><span class="op" id="6303710">:</span><span class="ident" id="6303711">d</span><span class="op" id="6303712">.</span><span class="ident" id="6303713">nbuf</span><span class="op" id="6303717">]</span><span class="op" id="6303718">,</span>&nbsp;<span class="ident" id="6303720">d</span><span class="op" id="6303721">.</span><span class="ident" id="6303722">readErr</span>&nbsp;<span class="op" id="6303730">!=</span>&nbsp;<span class="ident" id="6303733">nil</span><span class="op" id="6303736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303741">if</span>&nbsp;<span class="ident" id="6303744">ndst</span>&nbsp;<span class="op" id="6303749">&gt;</span>&nbsp;<span class="num" id="6303751">0</span>&nbsp;<span class="op" id="6303753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303759">d</span><span class="op" id="6303760">.</span><span class="ident" id="6303761">out</span>&nbsp;<span class="op" id="6303765">=</span>&nbsp;<span class="ident" id="6303767">d</span><span class="op" id="6303768">.</span><span class="ident" id="6303769">outbuf</span><span class="op" id="6303775">[</span><span class="num" id="6303776">0</span><span class="op" id="6303777">:</span><span class="ident" id="6303778">ndst</span><span class="op" id="6303782">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303788">d</span><span class="op" id="6303789">.</span><span class="ident" id="6303790">nbuf</span>&nbsp;<span class="op" id="6303795">=</span>&nbsp;<span class="builtinfunc" id="6303797">copy</span><span class="op" id="6303801">(</span><span class="ident" id="6303802">d</span><span class="op" id="6303803">.</span><span class="ident" id="6303804">buf</span><span class="op" id="6303807">[</span><span class="num" id="6303808">0</span><span class="op" id="6303809">:</span><span class="op" id="6303810">]</span><span class="op" id="6303811">,</span>&nbsp;<span class="ident" id="6303813">d</span><span class="op" id="6303814">.</span><span class="ident" id="6303815">buf</span><span class="op" id="6303818">[</span><span class="ident" id="6303819">nsrc</span><span class="op" id="6303823">:</span><span class="ident" id="6303824">d</span><span class="op" id="6303825">.</span><span class="ident" id="6303826">nbuf</span><span class="op" id="6303830">]</span><span class="op" id="6303831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303837">continue</span>&nbsp;<span class="comment" id="6303846">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303877">if</span>&nbsp;<span class="ident" id="6303880">ndst</span>&nbsp;<span class="op" id="6303885">==</span>&nbsp;<span class="num" id="6303888">0</span>&nbsp;<span class="op" id="6303890">&amp;&amp;</span>&nbsp;<span class="ident" id="6303893">d</span><span class="op" id="6303894">.</span><span class="ident" id="6303895">err</span>&nbsp;<span class="op" id="6303899">==</span>&nbsp;<span class="ident" id="6303902">nil</span>&nbsp;<span class="op" id="6303906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6303912">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6303984">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304042">off</span>&nbsp;<span class="op" id="6304046">:=</span>&nbsp;<span class="num" id="6304049">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304055">for</span>&nbsp;<span class="ident" id="6304059">i</span>&nbsp;<span class="op" id="6304061">:=</span>&nbsp;<span class="num" id="6304064">0</span><span class="op" id="6304065">;</span>&nbsp;<span class="ident" id="6304067">i</span>&nbsp;<span class="op" id="6304069">&lt;</span>&nbsp;<span class="ident" id="6304071">d</span><span class="op" id="6304072">.</span><span class="ident" id="6304073">nbuf</span><span class="op" id="6304077">;</span>&nbsp;<span class="ident" id="6304079">i</span><span class="op" id="6304080">++</span>&nbsp;<span class="op" id="6304083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304090">if</span>&nbsp;<span class="ident" id="6304093">d</span><span class="op" id="6304094">.</span><span class="ident" id="6304095">buf</span><span class="op" id="6304098">[</span><span class="ident" id="6304099">i</span><span class="op" id="6304100">]</span>&nbsp;<span class="op" id="6304102">&gt;</span>&nbsp;<span class="string" id="6304104">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6304108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304116">d</span><span class="op" id="6304117">.</span><span class="ident" id="6304118">buf</span><span class="op" id="6304121">[</span><span class="ident" id="6304122">off</span><span class="op" id="6304125">]</span>&nbsp;<span class="op" id="6304127">=</span>&nbsp;<span class="ident" id="6304129">d</span><span class="op" id="6304130">.</span><span class="ident" id="6304131">buf</span><span class="op" id="6304134">[</span><span class="ident" id="6304135">i</span><span class="op" id="6304136">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304144">off</span><span class="op" id="6304147">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304167">d</span><span class="op" id="6304168">.</span><span class="ident" id="6304169">nbuf</span>&nbsp;<span class="op" id="6304174">=</span>&nbsp;<span class="ident" id="6304176">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304183">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6304192">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304249">if</span>&nbsp;<span class="ident" id="6304252">d</span><span class="op" id="6304253">.</span><span class="ident" id="6304254">err</span>&nbsp;<span class="op" id="6304258">!=</span>&nbsp;<span class="ident" id="6304261">nil</span>&nbsp;<span class="op" id="6304265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304270">return</span>&nbsp;<span class="num" id="6304277">0</span><span class="op" id="6304278">,</span>&nbsp;<span class="ident" id="6304280">d</span><span class="op" id="6304281">.</span><span class="ident" id="6304282">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304292">if</span>&nbsp;<span class="ident" id="6304295">d</span><span class="op" id="6304296">.</span><span class="ident" id="6304297">readErr</span>&nbsp;<span class="op" id="6304305">!=</span>&nbsp;<span class="ident" id="6304308">nil</span>&nbsp;<span class="op" id="6304312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304317">d</span><span class="op" id="6304318">.</span><span class="ident" id="6304319">err</span>&nbsp;<span class="op" id="6304323">=</span>&nbsp;<span class="ident" id="6304325">d</span><span class="op" id="6304326">.</span><span class="ident" id="6304327">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304338">return</span>&nbsp;<span class="num" id="6304345">0</span><span class="op" id="6304346">,</span>&nbsp;<span class="ident" id="6304348">d</span><span class="op" id="6304349">.</span><span class="ident" id="6304350">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304356">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6304361">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304382">nn</span><span class="op" id="6304384">,</span>&nbsp;<span class="ident" id="6304386">d</span><span class="op" id="6304387">.</span><span class="ident" id="6304388">readErr</span>&nbsp;<span class="op" id="6304396">=</span>&nbsp;<span class="ident" id="6304398">d</span><span class="op" id="6304399">.</span><span class="ident" id="6304400">r</span><span class="op" id="6304401">.</span><span class="ident" id="6304402">Read</span><span class="op" id="6304406">(</span><span class="ident" id="6304407">d</span><span class="op" id="6304408">.</span><span class="ident" id="6304409">buf</span><span class="op" id="6304412">[</span><span class="ident" id="6304413">d</span><span class="op" id="6304414">.</span><span class="ident" id="6304415">nbuf</span><span class="op" id="6304419">:</span><span class="op" id="6304420">]</span><span class="op" id="6304421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304425">d</span><span class="op" id="6304426">.</span><span class="ident" id="6304427">nbuf</span>&nbsp;<span class="op" id="6304432">+=</span>&nbsp;<span class="ident" id="6304435">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304439">}</span><br>
<span class="lineno">310</span><span class="op" id="6304441">}</span>
</div>
</body>
</html>
