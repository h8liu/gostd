<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6638895">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6638950">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6639004">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6639055">package</span>&nbsp;<span class="ident" id="6639063">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6639072">import</span>&nbsp;<span class="op" id="6639079">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639082">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639091">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639101">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639109">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639116">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639126">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639139">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639151">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639164">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639181">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6639192">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6639199">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6639202">const</span>&nbsp;<span class="op" id="6639208">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639211">dataDir</span>&nbsp;&nbsp;<span class="op" id="6639220">=</span>&nbsp;<span class="string" id="6639222">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639234">tabwidth</span>&nbsp;<span class="op" id="6639243">=</span>&nbsp;<span class="num" id="6639245">8</span><br>
<span class="lineno"></span><span class="op" id="6639247">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6639250">var</span>&nbsp;<span class="ident" id="6639254">update</span>&nbsp;<span class="op" id="6639261">=</span>&nbsp;<span class="ident" id="6639263">flag</span><span class="op" id="6639267">.</span><span class="ident" id="6639268">Bool</span><span class="op" id="6639272">(</span><span class="string" id="6639273">&#34;update&#34;</span><span class="op" id="6639281">,</span>&nbsp;<span class="builtintype" id="6639283">false</span><span class="op" id="6639288">,</span>&nbsp;<span class="string" id="6639290">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="6639311">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6639314">var</span>&nbsp;<span class="ident" id="6639318">fset</span>&nbsp;<span class="op" id="6639323">=</span>&nbsp;<span class="ident" id="6639325">token</span><span class="op" id="6639330">.</span><span class="ident" id="6639331">NewFileSet</span><span class="op" id="6639341">(</span><span class="op" id="6639342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6639345">type</span>&nbsp;<span class="ident" id="6639350">checkMode</span>&nbsp;<span class="builtintype" id="6639360">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6639366">const</span>&nbsp;<span class="op" id="6639372">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639375">export</span>&nbsp;<span class="ident" id="6639382">checkMode</span>&nbsp;<span class="op" id="6639392">=</span>&nbsp;<span class="num" id="6639394">1</span>&nbsp;<span class="op" id="6639396">&lt;&lt;</span>&nbsp;<span class="ident" id="6639399">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639405">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639416">idempotent</span><br>
<span class="lineno"></span><span class="op" id="6639427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6639430">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="6639505">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="6639580">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="6639591">func</span>&nbsp;<span class="ident" id="6639596">format</span><span class="op" id="6639602">(</span><span class="ident" id="6639603">src</span>&nbsp;<span class="op" id="6639607">[</span><span class="op" id="6639608">]</span><span class="builtintype" id="6639609">byte</span><span class="op" id="6639613">,</span>&nbsp;<span class="ident" id="6639615">mode</span>&nbsp;<span class="ident" id="6639620">checkMode</span><span class="op" id="6639629">)</span>&nbsp;<span class="op" id="6639631">(</span><span class="op" id="6639632">[</span><span class="op" id="6639633">]</span><span class="builtintype" id="6639634">byte</span><span class="op" id="6639638">,</span>&nbsp;<span class="builtintype" id="6639640">error</span><span class="op" id="6639645">)</span>&nbsp;<span class="op" id="6639647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6639650">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639664">f</span><span class="op" id="6639665">,</span>&nbsp;<span class="ident" id="6639667">err</span>&nbsp;<span class="op" id="6639671">:=</span>&nbsp;<span class="ident" id="6639674">parser</span><span class="op" id="6639680">.</span><span class="ident" id="6639681">ParseFile</span><span class="op" id="6639690">(</span><span class="ident" id="6639691">fset</span><span class="op" id="6639695">,</span>&nbsp;<span class="string" id="6639697">&#34;&#34;</span><span class="op" id="6639699">,</span>&nbsp;<span class="ident" id="6639701">src</span><span class="op" id="6639704">,</span>&nbsp;<span class="ident" id="6639706">parser</span><span class="op" id="6639712">.</span><span class="ident" id="6639713">ParseComments</span><span class="op" id="6639726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6639729">if</span>&nbsp;<span class="ident" id="6639732">err</span>&nbsp;<span class="op" id="6639736">!=</span>&nbsp;<span class="ident" id="6639739">nil</span>&nbsp;<span class="op" id="6639743">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6639747">return</span>&nbsp;<span class="ident" id="6639754">nil</span><span class="op" id="6639757">,</span>&nbsp;<span class="ident" id="6639759">fmt</span><span class="op" id="6639762">.</span><span class="ident" id="6639763">Errorf</span><span class="op" id="6639769">(</span><span class="string" id="6639770">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="6639785">,</span>&nbsp;<span class="ident" id="6639787">err</span><span class="op" id="6639790">,</span>&nbsp;<span class="ident" id="6639792">src</span><span class="op" id="6639795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6639798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6639802">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6639834">if</span>&nbsp;<span class="ident" id="6639837">mode</span><span class="op" id="6639841">&amp;</span><span class="ident" id="6639842">export</span>&nbsp;<span class="op" id="6639849">!=</span>&nbsp;<span class="num" id="6639852">0</span>&nbsp;<span class="op" id="6639854">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639858">ast</span><span class="op" id="6639861">.</span><span class="ident" id="6639862">FileExports</span><span class="op" id="6639873">(</span><span class="ident" id="6639874">f</span><span class="op" id="6639875">)</span>&nbsp;<span class="comment" id="6639877">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6639896">f</span><span class="op" id="6639897">.</span><span class="ident" id="6639898">Comments</span>&nbsp;<span class="op" id="6639907">=</span>&nbsp;<span class="ident" id="6639909">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6639915">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6639960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6639964">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640000">cfg</span>&nbsp;<span class="op" id="6640004">:=</span>&nbsp;<span class="ident" id="6640007">Config</span><span class="op" id="6640013">{</span><span class="ident" id="6640014">Tabwidth</span><span class="op" id="6640022">:</span>&nbsp;<span class="ident" id="6640024">tabwidth</span><span class="op" id="6640032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640035">if</span>&nbsp;<span class="ident" id="6640038">mode</span><span class="op" id="6640042">&amp;</span><span class="ident" id="6640043">rawFormat</span>&nbsp;<span class="op" id="6640053">!=</span>&nbsp;<span class="num" id="6640056">0</span>&nbsp;<span class="op" id="6640058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640062">cfg</span><span class="op" id="6640065">.</span><span class="ident" id="6640066">Mode</span>&nbsp;<span class="op" id="6640071">|=</span>&nbsp;<span class="ident" id="6640074">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6640085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6640089">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640103">var</span>&nbsp;<span class="ident" id="6640107">buf</span>&nbsp;<span class="ident" id="6640111">bytes</span><span class="op" id="6640116">.</span><span class="ident" id="6640117">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640125">if</span>&nbsp;<span class="ident" id="6640128">err</span>&nbsp;<span class="op" id="6640132">:=</span>&nbsp;<span class="ident" id="6640135">cfg</span><span class="op" id="6640138">.</span><span class="ident" id="6640139">Fprint</span><span class="op" id="6640145">(</span><span class="op" id="6640146">&amp;</span><span class="ident" id="6640147">buf</span><span class="op" id="6640150">,</span>&nbsp;<span class="ident" id="6640152">fset</span><span class="op" id="6640156">,</span>&nbsp;<span class="ident" id="6640158">f</span><span class="op" id="6640159">)</span><span class="op" id="6640160">;</span>&nbsp;<span class="ident" id="6640162">err</span>&nbsp;<span class="op" id="6640166">!=</span>&nbsp;<span class="ident" id="6640169">nil</span>&nbsp;<span class="op" id="6640173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640177">return</span>&nbsp;<span class="ident" id="6640184">nil</span><span class="op" id="6640187">,</span>&nbsp;<span class="ident" id="6640189">fmt</span><span class="op" id="6640192">.</span><span class="ident" id="6640193">Errorf</span><span class="op" id="6640199">(</span><span class="string" id="6640200">&#34;print:&nbsp;%s&#34;</span><span class="op" id="6640211">,</span>&nbsp;<span class="ident" id="6640213">err</span><span class="op" id="6640216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6640219">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6640223">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640279">res</span>&nbsp;<span class="op" id="6640283">:=</span>&nbsp;<span class="ident" id="6640286">buf</span><span class="op" id="6640289">.</span><span class="ident" id="6640290">Bytes</span><span class="op" id="6640295">(</span><span class="op" id="6640296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640299">if</span>&nbsp;<span class="ident" id="6640302">_</span><span class="op" id="6640303">,</span>&nbsp;<span class="ident" id="6640305">err</span>&nbsp;<span class="op" id="6640309">:=</span>&nbsp;<span class="ident" id="6640312">parser</span><span class="op" id="6640318">.</span><span class="ident" id="6640319">ParseFile</span><span class="op" id="6640328">(</span><span class="ident" id="6640329">fset</span><span class="op" id="6640333">,</span>&nbsp;<span class="string" id="6640335">&#34;&#34;</span><span class="op" id="6640337">,</span>&nbsp;<span class="ident" id="6640339">res</span><span class="op" id="6640342">,</span>&nbsp;<span class="num" id="6640344">0</span><span class="op" id="6640345">)</span><span class="op" id="6640346">;</span>&nbsp;<span class="ident" id="6640348">err</span>&nbsp;<span class="op" id="6640352">!=</span>&nbsp;<span class="ident" id="6640355">nil</span>&nbsp;<span class="op" id="6640359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640363">return</span>&nbsp;<span class="ident" id="6640370">nil</span><span class="op" id="6640373">,</span>&nbsp;<span class="ident" id="6640375">fmt</span><span class="op" id="6640378">.</span><span class="ident" id="6640379">Errorf</span><span class="op" id="6640385">(</span><span class="string" id="6640386">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="6640404">,</span>&nbsp;<span class="ident" id="6640406">err</span><span class="op" id="6640409">,</span>&nbsp;<span class="ident" id="6640411">buf</span><span class="op" id="6640414">.</span><span class="ident" id="6640415">Bytes</span><span class="op" id="6640420">(</span><span class="op" id="6640421">)</span><span class="op" id="6640422">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6640425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640429">return</span>&nbsp;<span class="ident" id="6640436">res</span><span class="op" id="6640439">,</span>&nbsp;<span class="ident" id="6640441">nil</span><br>
<span class="lineno"></span><span class="op" id="6640445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6640448">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="6640508">func</span>&nbsp;<span class="ident" id="6640513">lineAt</span><span class="op" id="6640519">(</span><span class="ident" id="6640520">text</span>&nbsp;<span class="op" id="6640525">[</span><span class="op" id="6640526">]</span><span class="builtintype" id="6640527">byte</span><span class="op" id="6640531">,</span>&nbsp;<span class="ident" id="6640533">offs</span>&nbsp;<span class="builtintype" id="6640538">int</span><span class="op" id="6640541">)</span>&nbsp;<span class="op" id="6640543">[</span><span class="op" id="6640544">]</span><span class="builtintype" id="6640545">byte</span>&nbsp;<span class="op" id="6640550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640553">i</span>&nbsp;<span class="op" id="6640555">:=</span>&nbsp;<span class="ident" id="6640558">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640564">for</span>&nbsp;<span class="ident" id="6640568">i</span>&nbsp;<span class="op" id="6640570">&lt;</span>&nbsp;<span class="builtinfunc" id="6640572">len</span><span class="op" id="6640575">(</span><span class="ident" id="6640576">text</span><span class="op" id="6640580">)</span>&nbsp;<span class="op" id="6640582">&amp;&amp;</span>&nbsp;<span class="ident" id="6640585">text</span><span class="op" id="6640589">[</span><span class="ident" id="6640590">i</span><span class="op" id="6640591">]</span>&nbsp;<span class="op" id="6640593">!=</span>&nbsp;<span class="string" id="6640596">&#39;\n&#39;</span>&nbsp;<span class="op" id="6640601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640605">i</span><span class="op" id="6640606">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6640610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640613">return</span>&nbsp;<span class="ident" id="6640620">text</span><span class="op" id="6640624">[</span><span class="ident" id="6640625">offs</span><span class="op" id="6640629">:</span><span class="ident" id="6640630">i</span><span class="op" id="6640631">]</span><br>
<span class="lineno"></span><span class="op" id="6640633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6640636">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="6640662">func</span>&nbsp;<span class="ident" id="6640667">diff</span><span class="op" id="6640671">(</span><span class="ident" id="6640672">aname</span><span class="op" id="6640677">,</span>&nbsp;<span class="ident" id="6640679">bname</span>&nbsp;<span class="builtintype" id="6640685">string</span><span class="op" id="6640691">,</span>&nbsp;<span class="ident" id="6640693">a</span><span class="op" id="6640694">,</span>&nbsp;<span class="ident" id="6640696">b</span>&nbsp;<span class="op" id="6640698">[</span><span class="op" id="6640699">]</span><span class="builtintype" id="6640700">byte</span><span class="op" id="6640704">)</span>&nbsp;<span class="builtintype" id="6640706">error</span>&nbsp;<span class="op" id="6640712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640715">var</span>&nbsp;<span class="ident" id="6640719">buf</span>&nbsp;<span class="ident" id="6640723">bytes</span><span class="op" id="6640728">.</span><span class="ident" id="6640729">Buffer</span>&nbsp;<span class="comment" id="6640736">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6640768">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640788">if</span>&nbsp;<span class="builtinfunc" id="6640791">len</span><span class="op" id="6640794">(</span><span class="ident" id="6640795">a</span><span class="op" id="6640796">)</span>&nbsp;<span class="op" id="6640798">!=</span>&nbsp;<span class="builtinfunc" id="6640801">len</span><span class="op" id="6640804">(</span><span class="ident" id="6640805">b</span><span class="op" id="6640806">)</span>&nbsp;<span class="op" id="6640808">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640812">fmt</span><span class="op" id="6640815">.</span><span class="ident" id="6640816">Fprintf</span><span class="op" id="6640823">(</span><span class="op" id="6640824">&amp;</span><span class="ident" id="6640825">buf</span><span class="op" id="6640828">,</span>&nbsp;<span class="string" id="6640830">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6640876">,</span>&nbsp;<span class="ident" id="6640878">aname</span><span class="op" id="6640883">,</span>&nbsp;<span class="builtinfunc" id="6640885">len</span><span class="op" id="6640888">(</span><span class="ident" id="6640889">a</span><span class="op" id="6640890">)</span><span class="op" id="6640891">,</span>&nbsp;<span class="ident" id="6640893">bname</span><span class="op" id="6640898">,</span>&nbsp;<span class="builtinfunc" id="6640900">len</span><span class="op" id="6640903">(</span><span class="ident" id="6640904">b</span><span class="op" id="6640905">)</span><span class="op" id="6640906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6640909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6640913">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640934">line</span>&nbsp;<span class="op" id="6640939">:=</span>&nbsp;<span class="num" id="6640942">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6640945">offs</span>&nbsp;<span class="op" id="6640950">:=</span>&nbsp;<span class="num" id="6640953">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6640956">for</span>&nbsp;<span class="ident" id="6640960">i</span>&nbsp;<span class="op" id="6640962">:=</span>&nbsp;<span class="num" id="6640965">0</span><span class="op" id="6640966">;</span>&nbsp;<span class="ident" id="6640968">i</span>&nbsp;<span class="op" id="6640970">&lt;</span>&nbsp;<span class="builtinfunc" id="6640972">len</span><span class="op" id="6640975">(</span><span class="ident" id="6640976">a</span><span class="op" id="6640977">)</span>&nbsp;<span class="op" id="6640979">&amp;&amp;</span>&nbsp;<span class="ident" id="6640982">i</span>&nbsp;<span class="op" id="6640984">&lt;</span>&nbsp;<span class="builtinfunc" id="6640986">len</span><span class="op" id="6640989">(</span><span class="ident" id="6640990">b</span><span class="op" id="6640991">)</span><span class="op" id="6640992">;</span>&nbsp;<span class="ident" id="6640994">i</span><span class="op" id="6640995">++</span>&nbsp;<span class="op" id="6640998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641002">ch</span>&nbsp;<span class="op" id="6641005">:=</span>&nbsp;<span class="ident" id="6641008">a</span><span class="op" id="6641009">[</span><span class="ident" id="6641010">i</span><span class="op" id="6641011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641015">if</span>&nbsp;<span class="ident" id="6641018">ch</span>&nbsp;<span class="op" id="6641021">!=</span>&nbsp;<span class="ident" id="6641024">b</span><span class="op" id="6641025">[</span><span class="ident" id="6641026">i</span><span class="op" id="6641027">]</span>&nbsp;<span class="op" id="6641029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641034">fmt</span><span class="op" id="6641037">.</span><span class="ident" id="6641038">Fprintf</span><span class="op" id="6641045">(</span><span class="op" id="6641046">&amp;</span><span class="ident" id="6641047">buf</span><span class="op" id="6641050">,</span>&nbsp;<span class="string" id="6641052">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="6641068">,</span>&nbsp;<span class="ident" id="6641070">aname</span><span class="op" id="6641075">,</span>&nbsp;<span class="ident" id="6641077">line</span><span class="op" id="6641081">,</span>&nbsp;<span class="ident" id="6641083">i</span><span class="op" id="6641084">-</span><span class="ident" id="6641085">offs</span><span class="op" id="6641089">+</span><span class="num" id="6641090">1</span><span class="op" id="6641091">,</span>&nbsp;<span class="ident" id="6641093">lineAt</span><span class="op" id="6641099">(</span><span class="ident" id="6641100">a</span><span class="op" id="6641101">,</span>&nbsp;<span class="ident" id="6641103">offs</span><span class="op" id="6641107">)</span><span class="op" id="6641108">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641113">fmt</span><span class="op" id="6641116">.</span><span class="ident" id="6641117">Fprintf</span><span class="op" id="6641124">(</span><span class="op" id="6641125">&amp;</span><span class="ident" id="6641126">buf</span><span class="op" id="6641129">,</span>&nbsp;<span class="string" id="6641131">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="6641147">,</span>&nbsp;<span class="ident" id="6641149">bname</span><span class="op" id="6641154">,</span>&nbsp;<span class="ident" id="6641156">line</span><span class="op" id="6641160">,</span>&nbsp;<span class="ident" id="6641162">i</span><span class="op" id="6641163">-</span><span class="ident" id="6641164">offs</span><span class="op" id="6641168">+</span><span class="num" id="6641169">1</span><span class="op" id="6641170">,</span>&nbsp;<span class="ident" id="6641172">lineAt</span><span class="op" id="6641178">(</span><span class="ident" id="6641179">b</span><span class="op" id="6641180">,</span>&nbsp;<span class="ident" id="6641182">offs</span><span class="op" id="6641186">)</span><span class="op" id="6641187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641192">fmt</span><span class="op" id="6641195">.</span><span class="ident" id="6641196">Fprintf</span><span class="op" id="6641203">(</span><span class="op" id="6641204">&amp;</span><span class="ident" id="6641205">buf</span><span class="op" id="6641208">,</span>&nbsp;<span class="string" id="6641210">&#34;\n\n&#34;</span><span class="op" id="6641216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641221">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641233">if</span>&nbsp;<span class="ident" id="6641236">ch</span>&nbsp;<span class="op" id="6641239">==</span>&nbsp;<span class="string" id="6641242">&#39;\n&#39;</span>&nbsp;<span class="op" id="6641247">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641252">line</span><span class="op" id="6641256">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641262">offs</span>&nbsp;<span class="op" id="6641267">=</span>&nbsp;<span class="ident" id="6641269">i</span>&nbsp;<span class="op" id="6641271">+</span>&nbsp;<span class="num" id="6641273">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641284">if</span>&nbsp;<span class="ident" id="6641287">buf</span><span class="op" id="6641290">.</span><span class="ident" id="6641291">Len</span><span class="op" id="6641294">(</span><span class="op" id="6641295">)</span>&nbsp;<span class="op" id="6641297">&gt;</span>&nbsp;<span class="num" id="6641299">0</span>&nbsp;<span class="op" id="6641301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641305">return</span>&nbsp;<span class="ident" id="6641312">errors</span><span class="op" id="6641318">.</span><span class="ident" id="6641319">New</span><span class="op" id="6641322">(</span><span class="ident" id="6641323">buf</span><span class="op" id="6641326">.</span><span class="ident" id="6641327">String</span><span class="op" id="6641333">(</span><span class="op" id="6641334">)</span><span class="op" id="6641335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641341">return</span>&nbsp;<span class="ident" id="6641348">nil</span><br>
<span class="lineno"></span><span class="op" id="6641352">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6641355">func</span>&nbsp;<span class="ident" id="6641360">runcheck</span><span class="op" id="6641368">(</span><span class="ident" id="6641369">t</span>&nbsp;<span class="op" id="6641371">*</span><span class="ident" id="6641372">testing</span><span class="op" id="6641379">.</span><span class="ident" id="6641380">T</span><span class="op" id="6641381">,</span>&nbsp;<span class="ident" id="6641383">source</span><span class="op" id="6641389">,</span>&nbsp;<span class="ident" id="6641391">golden</span>&nbsp;<span class="builtintype" id="6641398">string</span><span class="op" id="6641404">,</span>&nbsp;<span class="ident" id="6641406">mode</span>&nbsp;<span class="ident" id="6641411">checkMode</span><span class="op" id="6641420">)</span>&nbsp;<span class="op" id="6641422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641425">src</span><span class="op" id="6641428">,</span>&nbsp;<span class="ident" id="6641430">err</span>&nbsp;<span class="op" id="6641434">:=</span>&nbsp;<span class="ident" id="6641437">ioutil</span><span class="op" id="6641443">.</span><span class="ident" id="6641444">ReadFile</span><span class="op" id="6641452">(</span><span class="ident" id="6641453">source</span><span class="op" id="6641459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641462">if</span>&nbsp;<span class="ident" id="6641465">err</span>&nbsp;<span class="op" id="6641469">!=</span>&nbsp;<span class="ident" id="6641472">nil</span>&nbsp;<span class="op" id="6641476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641480">t</span><span class="op" id="6641481">.</span><span class="ident" id="6641482">Error</span><span class="op" id="6641487">(</span><span class="ident" id="6641488">err</span><span class="op" id="6641491">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641495">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641507">res</span><span class="op" id="6641510">,</span>&nbsp;<span class="ident" id="6641512">err</span>&nbsp;<span class="op" id="6641516">:=</span>&nbsp;<span class="ident" id="6641519">format</span><span class="op" id="6641525">(</span><span class="ident" id="6641526">src</span><span class="op" id="6641529">,</span>&nbsp;<span class="ident" id="6641531">mode</span><span class="op" id="6641535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641538">if</span>&nbsp;<span class="ident" id="6641541">err</span>&nbsp;<span class="op" id="6641545">!=</span>&nbsp;<span class="ident" id="6641548">nil</span>&nbsp;<span class="op" id="6641552">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641556">t</span><span class="op" id="6641557">.</span><span class="ident" id="6641558">Error</span><span class="op" id="6641563">(</span><span class="ident" id="6641564">err</span><span class="op" id="6641567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641571">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6641583">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641620">if</span>&nbsp;<span class="op" id="6641623">*</span><span class="ident" id="6641624">update</span>&nbsp;<span class="op" id="6641631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641635">if</span>&nbsp;<span class="ident" id="6641638">err</span>&nbsp;<span class="op" id="6641642">:=</span>&nbsp;<span class="ident" id="6641645">ioutil</span><span class="op" id="6641651">.</span><span class="ident" id="6641652">WriteFile</span><span class="op" id="6641661">(</span><span class="ident" id="6641662">golden</span><span class="op" id="6641668">,</span>&nbsp;<span class="ident" id="6641670">res</span><span class="op" id="6641673">,</span>&nbsp;<span class="num" id="6641675">0644</span><span class="op" id="6641679">)</span><span class="op" id="6641680">;</span>&nbsp;<span class="ident" id="6641682">err</span>&nbsp;<span class="op" id="6641686">!=</span>&nbsp;<span class="ident" id="6641689">nil</span>&nbsp;<span class="op" id="6641693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641698">t</span><span class="op" id="6641699">.</span><span class="ident" id="6641700">Error</span><span class="op" id="6641705">(</span><span class="ident" id="6641706">err</span><span class="op" id="6641709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641717">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6641729">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641744">gld</span><span class="op" id="6641747">,</span>&nbsp;<span class="ident" id="6641749">err</span>&nbsp;<span class="op" id="6641753">:=</span>&nbsp;<span class="ident" id="6641756">ioutil</span><span class="op" id="6641762">.</span><span class="ident" id="6641763">ReadFile</span><span class="op" id="6641771">(</span><span class="ident" id="6641772">golden</span><span class="op" id="6641778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641781">if</span>&nbsp;<span class="ident" id="6641784">err</span>&nbsp;<span class="op" id="6641788">!=</span>&nbsp;<span class="ident" id="6641791">nil</span>&nbsp;<span class="op" id="6641795">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641799">t</span><span class="op" id="6641800">.</span><span class="ident" id="6641801">Error</span><span class="op" id="6641806">(</span><span class="ident" id="6641807">err</span><span class="op" id="6641810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641814">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6641826">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641875">if</span>&nbsp;<span class="ident" id="6641878">err</span>&nbsp;<span class="op" id="6641882">:=</span>&nbsp;<span class="ident" id="6641885">diff</span><span class="op" id="6641889">(</span><span class="ident" id="6641890">source</span><span class="op" id="6641896">,</span>&nbsp;<span class="ident" id="6641898">golden</span><span class="op" id="6641904">,</span>&nbsp;<span class="ident" id="6641906">res</span><span class="op" id="6641909">,</span>&nbsp;<span class="ident" id="6641911">gld</span><span class="op" id="6641914">)</span><span class="op" id="6641915">;</span>&nbsp;<span class="ident" id="6641917">err</span>&nbsp;<span class="op" id="6641921">!=</span>&nbsp;<span class="ident" id="6641924">nil</span>&nbsp;<span class="op" id="6641928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6641932">t</span><span class="op" id="6641933">.</span><span class="ident" id="6641934">Error</span><span class="op" id="6641939">(</span><span class="ident" id="6641940">err</span><span class="op" id="6641943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641947">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6641955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6641959">if</span>&nbsp;<span class="ident" id="6641962">mode</span><span class="op" id="6641966">&amp;</span><span class="ident" id="6641967">idempotent</span>&nbsp;<span class="op" id="6641978">!=</span>&nbsp;<span class="num" id="6641981">0</span>&nbsp;<span class="op" id="6641983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6641987">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6642029">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6642092">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642154">res</span><span class="op" id="6642157">,</span>&nbsp;<span class="ident" id="6642159">err</span>&nbsp;<span class="op" id="6642163">=</span>&nbsp;<span class="ident" id="6642165">format</span><span class="op" id="6642171">(</span><span class="ident" id="6642172">gld</span><span class="op" id="6642175">,</span>&nbsp;<span class="ident" id="6642177">mode</span><span class="op" id="6642181">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6642185">if</span>&nbsp;<span class="ident" id="6642188">err</span>&nbsp;<span class="op" id="6642192">:=</span>&nbsp;<span class="ident" id="6642195">diff</span><span class="op" id="6642199">(</span><span class="ident" id="6642200">golden</span><span class="op" id="6642206">,</span>&nbsp;<span class="ident" id="6642208">fmt</span><span class="op" id="6642211">.</span><span class="ident" id="6642212">Sprintf</span><span class="op" id="6642219">(</span><span class="string" id="6642220">&#34;format(%s)&#34;</span><span class="op" id="6642232">,</span>&nbsp;<span class="ident" id="6642234">golden</span><span class="op" id="6642240">)</span><span class="op" id="6642241">,</span>&nbsp;<span class="ident" id="6642243">gld</span><span class="op" id="6642246">,</span>&nbsp;<span class="ident" id="6642248">res</span><span class="op" id="6642251">)</span><span class="op" id="6642252">;</span>&nbsp;<span class="ident" id="6642254">err</span>&nbsp;<span class="op" id="6642258">!=</span>&nbsp;<span class="ident" id="6642261">nil</span>&nbsp;<span class="op" id="6642265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642270">t</span><span class="op" id="6642271">.</span><span class="ident" id="6642272">Errorf</span><span class="op" id="6642278">(</span><span class="string" id="6642279">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="6642309">,</span>&nbsp;<span class="ident" id="6642311">err</span><span class="op" id="6642314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6642318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6642321">}</span><br>
<span class="lineno"></span><span class="op" id="6642323">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6642326">func</span>&nbsp;<span class="ident" id="6642331">check</span><span class="op" id="6642336">(</span><span class="ident" id="6642337">t</span>&nbsp;<span class="op" id="6642339">*</span><span class="ident" id="6642340">testing</span><span class="op" id="6642347">.</span><span class="ident" id="6642348">T</span><span class="op" id="6642349">,</span>&nbsp;<span class="ident" id="6642351">source</span><span class="op" id="6642357">,</span>&nbsp;<span class="ident" id="6642359">golden</span>&nbsp;<span class="builtintype" id="6642366">string</span><span class="op" id="6642372">,</span>&nbsp;<span class="ident" id="6642374">mode</span>&nbsp;<span class="ident" id="6642379">checkMode</span><span class="op" id="6642388">)</span>&nbsp;<span class="op" id="6642390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6642393">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642410">cc</span>&nbsp;<span class="op" id="6642413">:=</span>&nbsp;<span class="builtinfunc" id="6642416">make</span><span class="op" id="6642420">(</span><span class="keyword" id="6642421">chan</span>&nbsp;<span class="builtintype" id="6642426">int</span><span class="op" id="6642429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6642432">go</span>&nbsp;<span class="keyword" id="6642435">func</span><span class="op" id="6642439">(</span><span class="op" id="6642440">)</span>&nbsp;<span class="op" id="6642442">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642446">runcheck</span><span class="op" id="6642454">(</span><span class="ident" id="6642455">t</span><span class="op" id="6642456">,</span>&nbsp;<span class="ident" id="6642458">source</span><span class="op" id="6642464">,</span>&nbsp;<span class="ident" id="6642466">golden</span><span class="op" id="6642472">,</span>&nbsp;<span class="ident" id="6642474">mode</span><span class="op" id="6642478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642482">cc</span>&nbsp;<span class="op" id="6642485">&lt;-</span>&nbsp;<span class="num" id="6642488">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6642491">}</span><span class="op" id="6642492">(</span><span class="op" id="6642493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6642497">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6642519">select</span>&nbsp;<span class="op" id="6642526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6642529">case</span>&nbsp;<span class="op" id="6642534">&lt;-</span><span class="ident" id="6642536">time</span><span class="op" id="6642540">.</span><span class="ident" id="6642541">After</span><span class="op" id="6642546">(</span><span class="num" id="6642547">10</span>&nbsp;<span class="op" id="6642550">*</span>&nbsp;<span class="ident" id="6642552">time</span><span class="op" id="6642556">.</span><span class="ident" id="6642557">Second</span><span class="op" id="6642563">)</span><span class="op" id="6642564">:</span>&nbsp;<span class="comment" id="6642566">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6642626">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642658">t</span><span class="op" id="6642659">.</span><span class="ident" id="6642660">Errorf</span><span class="op" id="6642666">(</span><span class="string" id="6642667">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="6642691">,</span>&nbsp;<span class="ident" id="6642693">source</span><span class="op" id="6642699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6642702">case</span>&nbsp;<span class="op" id="6642707">&lt;-</span><span class="ident" id="6642709">cc</span><span class="op" id="6642711">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6642715">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6642761">}</span><br>
<span class="lineno"></span><span class="op" id="6642763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6642766">type</span>&nbsp;<span class="ident" id="6642771">entry</span>&nbsp;<span class="keyword" id="6642777">struct</span>&nbsp;<span class="op" id="6642784">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642787">source</span><span class="op" id="6642793">,</span>&nbsp;<span class="ident" id="6642795">golden</span>&nbsp;<span class="builtintype" id="6642802">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6642810">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6642825">checkMode</span><br>
<span class="lineno"></span><span class="op" id="6642835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6642838">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="6642907">var</span>&nbsp;<span class="ident" id="6642911">data</span>&nbsp;<span class="op" id="6642916">=</span>&nbsp;<span class="op" id="6642918">[</span><span class="op" id="6642919">]</span><span class="ident" id="6642920">entry</span><span class="op" id="6642925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6642928">{</span><span class="string" id="6642929">&#34;empty.input&#34;</span><span class="op" id="6642942">,</span>&nbsp;<span class="string" id="6642944">&#34;empty.golden&#34;</span><span class="op" id="6642958">,</span>&nbsp;<span class="ident" id="6642960">idempotent</span><span class="op" id="6642970">}</span><span class="op" id="6642971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6642974">{</span><span class="string" id="6642975">&#34;comments.input&#34;</span><span class="op" id="6642991">,</span>&nbsp;<span class="string" id="6642993">&#34;comments.golden&#34;</span><span class="op" id="6643010">,</span>&nbsp;<span class="num" id="6643012">0</span><span class="op" id="6643013">}</span><span class="op" id="6643014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643017">{</span><span class="string" id="6643018">&#34;comments.input&#34;</span><span class="op" id="6643034">,</span>&nbsp;<span class="string" id="6643036">&#34;comments.x&#34;</span><span class="op" id="6643048">,</span>&nbsp;<span class="ident" id="6643050">export</span><span class="op" id="6643056">}</span><span class="op" id="6643057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643060">{</span><span class="string" id="6643061">&#34;comments2.input&#34;</span><span class="op" id="6643078">,</span>&nbsp;<span class="string" id="6643080">&#34;comments2.golden&#34;</span><span class="op" id="6643098">,</span>&nbsp;<span class="ident" id="6643100">idempotent</span><span class="op" id="6643110">}</span><span class="op" id="6643111">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643114">{</span><span class="string" id="6643115">&#34;linebreaks.input&#34;</span><span class="op" id="6643133">,</span>&nbsp;<span class="string" id="6643135">&#34;linebreaks.golden&#34;</span><span class="op" id="6643154">,</span>&nbsp;<span class="ident" id="6643156">idempotent</span><span class="op" id="6643166">}</span><span class="op" id="6643167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643170">{</span><span class="string" id="6643171">&#34;expressions.input&#34;</span><span class="op" id="6643190">,</span>&nbsp;<span class="string" id="6643192">&#34;expressions.golden&#34;</span><span class="op" id="6643212">,</span>&nbsp;<span class="ident" id="6643214">idempotent</span><span class="op" id="6643224">}</span><span class="op" id="6643225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643228">{</span><span class="string" id="6643229">&#34;expressions.input&#34;</span><span class="op" id="6643248">,</span>&nbsp;<span class="string" id="6643250">&#34;expressions.raw&#34;</span><span class="op" id="6643267">,</span>&nbsp;<span class="ident" id="6643269">rawFormat</span>&nbsp;<span class="op" id="6643279">|</span>&nbsp;<span class="ident" id="6643281">idempotent</span><span class="op" id="6643291">}</span><span class="op" id="6643292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643295">{</span><span class="string" id="6643296">&#34;declarations.input&#34;</span><span class="op" id="6643316">,</span>&nbsp;<span class="string" id="6643318">&#34;declarations.golden&#34;</span><span class="op" id="6643339">,</span>&nbsp;<span class="num" id="6643341">0</span><span class="op" id="6643342">}</span><span class="op" id="6643343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643346">{</span><span class="string" id="6643347">&#34;statements.input&#34;</span><span class="op" id="6643365">,</span>&nbsp;<span class="string" id="6643367">&#34;statements.golden&#34;</span><span class="op" id="6643386">,</span>&nbsp;<span class="num" id="6643388">0</span><span class="op" id="6643389">}</span><span class="op" id="6643390">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643393">{</span><span class="string" id="6643394">&#34;slow.input&#34;</span><span class="op" id="6643406">,</span>&nbsp;<span class="string" id="6643408">&#34;slow.golden&#34;</span><span class="op" id="6643421">,</span>&nbsp;<span class="ident" id="6643423">idempotent</span><span class="op" id="6643433">}</span><span class="op" id="6643434">,</span><br>
<span class="lineno"></span><span class="op" id="6643436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6643439">func</span>&nbsp;<span class="ident" id="6643444">TestFiles</span><span class="op" id="6643453">(</span><span class="ident" id="6643454">t</span>&nbsp;<span class="op" id="6643456">*</span><span class="ident" id="6643457">testing</span><span class="op" id="6643464">.</span><span class="ident" id="6643465">T</span><span class="op" id="6643466">)</span>&nbsp;<span class="op" id="6643468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6643471">for</span>&nbsp;<span class="ident" id="6643475">_</span><span class="op" id="6643476">,</span>&nbsp;<span class="ident" id="6643478">e</span>&nbsp;<span class="op" id="6643480">:=</span>&nbsp;<span class="keyword" id="6643483">range</span>&nbsp;<span class="ident" id="6643489">data</span>&nbsp;<span class="op" id="6643494">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6643498">source</span>&nbsp;<span class="op" id="6643505">:=</span>&nbsp;<span class="ident" id="6643508">filepath</span><span class="op" id="6643516">.</span><span class="ident" id="6643517">Join</span><span class="op" id="6643521">(</span><span class="ident" id="6643522">dataDir</span><span class="op" id="6643529">,</span>&nbsp;<span class="ident" id="6643531">e</span><span class="op" id="6643532">.</span><span class="ident" id="6643533">source</span><span class="op" id="6643539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6643543">golden</span>&nbsp;<span class="op" id="6643550">:=</span>&nbsp;<span class="ident" id="6643553">filepath</span><span class="op" id="6643561">.</span><span class="ident" id="6643562">Join</span><span class="op" id="6643566">(</span><span class="ident" id="6643567">dataDir</span><span class="op" id="6643574">,</span>&nbsp;<span class="ident" id="6643576">e</span><span class="op" id="6643577">.</span><span class="ident" id="6643578">golden</span><span class="op" id="6643584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6643588">check</span><span class="op" id="6643593">(</span><span class="ident" id="6643594">t</span><span class="op" id="6643595">,</span>&nbsp;<span class="ident" id="6643597">source</span><span class="op" id="6643603">,</span>&nbsp;<span class="ident" id="6643605">golden</span><span class="op" id="6643611">,</span>&nbsp;<span class="ident" id="6643613">e</span><span class="op" id="6643614">.</span><span class="ident" id="6643615">mode</span><span class="op" id="6643619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6643623">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6643670">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6643706">}</span><br>
<span class="lineno"></span><span class="op" id="6643708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6643711">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="6643787">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="6643863">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="6643892">//</span><br>
<span class="lineno"></span><span class="keyword" id="6643895">func</span>&nbsp;<span class="ident" id="6643900">TestLineComments</span><span class="op" id="6643916">(</span><span class="ident" id="6643917">t</span>&nbsp;<span class="op" id="6643919">*</span><span class="ident" id="6643920">testing</span><span class="op" id="6643927">.</span><span class="ident" id="6643928">T</span><span class="op" id="6643929">)</span>&nbsp;<span class="op" id="6643931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6643934">const</span>&nbsp;<span class="ident" id="6643940">src</span>&nbsp;<span class="op" id="6643944">=</span>&nbsp;<span class="string" id="6643946">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644007">fset</span>&nbsp;<span class="op" id="6644012">:=</span>&nbsp;<span class="ident" id="6644015">token</span><span class="op" id="6644020">.</span><span class="ident" id="6644021">NewFileSet</span><span class="op" id="6644031">(</span><span class="op" id="6644032">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644035">f</span><span class="op" id="6644036">,</span>&nbsp;<span class="ident" id="6644038">err</span>&nbsp;<span class="op" id="6644042">:=</span>&nbsp;<span class="ident" id="6644045">parser</span><span class="op" id="6644051">.</span><span class="ident" id="6644052">ParseFile</span><span class="op" id="6644061">(</span><span class="ident" id="6644062">fset</span><span class="op" id="6644066">,</span>&nbsp;<span class="string" id="6644068">&#34;&#34;</span><span class="op" id="6644070">,</span>&nbsp;<span class="ident" id="6644072">src</span><span class="op" id="6644075">,</span>&nbsp;<span class="ident" id="6644077">parser</span><span class="op" id="6644083">.</span><span class="ident" id="6644084">ParseComments</span><span class="op" id="6644097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644100">if</span>&nbsp;<span class="ident" id="6644103">err</span>&nbsp;<span class="op" id="6644107">!=</span>&nbsp;<span class="ident" id="6644110">nil</span>&nbsp;<span class="op" id="6644114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6644118">panic</span><span class="op" id="6644123">(</span><span class="ident" id="6644124">err</span><span class="op" id="6644127">)</span>&nbsp;<span class="comment" id="6644129">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644151">var</span>&nbsp;<span class="ident" id="6644155">buf</span>&nbsp;<span class="ident" id="6644159">bytes</span><span class="op" id="6644164">.</span><span class="ident" id="6644165">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644173">fset</span>&nbsp;<span class="op" id="6644178">=</span>&nbsp;<span class="ident" id="6644180">token</span><span class="op" id="6644185">.</span><span class="ident" id="6644186">NewFileSet</span><span class="op" id="6644196">(</span><span class="op" id="6644197">)</span>&nbsp;<span class="comment" id="6644199">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644226">Fprint</span><span class="op" id="6644232">(</span><span class="op" id="6644233">&amp;</span><span class="ident" id="6644234">buf</span><span class="op" id="6644237">,</span>&nbsp;<span class="ident" id="6644239">fset</span><span class="op" id="6644243">,</span>&nbsp;<span class="ident" id="6644245">f</span><span class="op" id="6644246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644250">nlines</span>&nbsp;<span class="op" id="6644257">:=</span>&nbsp;<span class="num" id="6644260">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644263">for</span>&nbsp;<span class="ident" id="6644267">_</span><span class="op" id="6644268">,</span>&nbsp;<span class="ident" id="6644270">ch</span>&nbsp;<span class="op" id="6644273">:=</span>&nbsp;<span class="keyword" id="6644276">range</span>&nbsp;<span class="ident" id="6644282">buf</span><span class="op" id="6644285">.</span><span class="ident" id="6644286">Bytes</span><span class="op" id="6644291">(</span><span class="op" id="6644292">)</span>&nbsp;<span class="op" id="6644294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644298">if</span>&nbsp;<span class="ident" id="6644301">ch</span>&nbsp;<span class="op" id="6644304">==</span>&nbsp;<span class="string" id="6644307">&#39;\n&#39;</span>&nbsp;<span class="op" id="6644312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644317">nlines</span><span class="op" id="6644323">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644331">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644335">const</span>&nbsp;<span class="ident" id="6644341">expected</span>&nbsp;<span class="op" id="6644350">=</span>&nbsp;<span class="num" id="6644352">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644355">if</span>&nbsp;<span class="ident" id="6644358">nlines</span>&nbsp;<span class="op" id="6644365">&lt;</span>&nbsp;<span class="ident" id="6644367">expected</span>&nbsp;<span class="op" id="6644376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644380">t</span><span class="op" id="6644381">.</span><span class="ident" id="6644382">Errorf</span><span class="op" id="6644388">(</span><span class="string" id="6644389">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="6644412">,</span>&nbsp;<span class="ident" id="6644414">nlines</span><span class="op" id="6644420">,</span>&nbsp;<span class="ident" id="6644422">expected</span><span class="op" id="6644430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6644434">t</span><span class="op" id="6644435">.</span><span class="ident" id="6644436">Errorf</span><span class="op" id="6644442">(</span><span class="string" id="6644443">&#34;result:\n%s&#34;</span><span class="op" id="6644456">,</span>&nbsp;<span class="ident" id="6644458">buf</span><span class="op" id="6644461">.</span><span class="ident" id="6644462">Bytes</span><span class="op" id="6644467">(</span><span class="op" id="6644468">)</span><span class="op" id="6644469">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644472">}</span><br>
<span class="lineno"></span><span class="op" id="6644474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6644477">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="6644542">func</span>&nbsp;<span class="ident" id="6644547">init</span><span class="op" id="6644551">(</span><span class="op" id="6644552">)</span>&nbsp;<span class="op" id="6644554">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644557">const</span>&nbsp;<span class="ident" id="6644563">name</span>&nbsp;<span class="op" id="6644568">=</span>&nbsp;<span class="string" id="6644570">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644580">var</span>&nbsp;<span class="ident" id="6644584">buf</span>&nbsp;<span class="ident" id="6644588">bytes</span><span class="op" id="6644593">.</span><span class="ident" id="6644594">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644602">if</span>&nbsp;<span class="ident" id="6644605">err</span>&nbsp;<span class="op" id="6644609">:=</span>&nbsp;<span class="ident" id="6644612">Fprint</span><span class="op" id="6644618">(</span><span class="op" id="6644619">&amp;</span><span class="ident" id="6644620">buf</span><span class="op" id="6644623">,</span>&nbsp;<span class="ident" id="6644625">fset</span><span class="op" id="6644629">,</span>&nbsp;<span class="op" id="6644631">&amp;</span><span class="ident" id="6644632">ast</span><span class="op" id="6644635">.</span><span class="ident" id="6644636">Ident</span><span class="op" id="6644641">{</span><span class="ident" id="6644642">Name</span><span class="op" id="6644646">:</span>&nbsp;<span class="ident" id="6644648">name</span><span class="op" id="6644652">}</span><span class="op" id="6644653">)</span><span class="op" id="6644654">;</span>&nbsp;<span class="ident" id="6644656">err</span>&nbsp;<span class="op" id="6644660">!=</span>&nbsp;<span class="ident" id="6644663">nil</span>&nbsp;<span class="op" id="6644667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6644671">panic</span><span class="op" id="6644676">(</span><span class="ident" id="6644677">err</span><span class="op" id="6644680">)</span>&nbsp;<span class="comment" id="6644682">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644700">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6644703">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6644766">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644780">if</span>&nbsp;<span class="ident" id="6644783">s</span>&nbsp;<span class="op" id="6644785">:=</span>&nbsp;<span class="ident" id="6644788">buf</span><span class="op" id="6644791">.</span><span class="ident" id="6644792">String</span><span class="op" id="6644798">(</span><span class="op" id="6644799">)</span><span class="op" id="6644800">;</span>&nbsp;<span class="op" id="6644802">!</span><span class="ident" id="6644803">debug</span>&nbsp;<span class="op" id="6644809">&amp;&amp;</span>&nbsp;<span class="ident" id="6644812">s</span>&nbsp;<span class="op" id="6644814">!=</span>&nbsp;<span class="ident" id="6644817">name</span>&nbsp;<span class="op" id="6644822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6644826">panic</span><span class="op" id="6644831">(</span><span class="string" id="6644832">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="6644839">+</span>&nbsp;<span class="ident" id="6644841">s</span>&nbsp;<span class="op" id="6644843">+</span>&nbsp;<span class="string" id="6644845">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="6644855">+</span>&nbsp;<span class="ident" id="6644857">name</span><span class="op" id="6644861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6644864">}</span><br>
<span class="lineno">255</span><span class="op" id="6644866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6644869">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="6644944">func</span>&nbsp;<span class="ident" id="6644949">TestBadNodes</span><span class="op" id="6644961">(</span><span class="ident" id="6644962">t</span>&nbsp;<span class="op" id="6644964">*</span><span class="ident" id="6644965">testing</span><span class="op" id="6644972">.</span><span class="ident" id="6644973">T</span><span class="op" id="6644974">)</span>&nbsp;<span class="op" id="6644976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6644979">const</span>&nbsp;<span class="ident" id="6644985">src</span>&nbsp;<span class="op" id="6644989">=</span>&nbsp;<span class="string" id="6644991">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645007">const</span>&nbsp;<span class="ident" id="6645013">res</span>&nbsp;<span class="op" id="6645017">=</span>&nbsp;<span class="string" id="6645019">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645043">f</span><span class="op" id="6645044">,</span>&nbsp;<span class="ident" id="6645046">err</span>&nbsp;<span class="op" id="6645050">:=</span>&nbsp;<span class="ident" id="6645053">parser</span><span class="op" id="6645059">.</span><span class="ident" id="6645060">ParseFile</span><span class="op" id="6645069">(</span><span class="ident" id="6645070">fset</span><span class="op" id="6645074">,</span>&nbsp;<span class="string" id="6645076">&#34;&#34;</span><span class="op" id="6645078">,</span>&nbsp;<span class="ident" id="6645080">src</span><span class="op" id="6645083">,</span>&nbsp;<span class="ident" id="6645085">parser</span><span class="op" id="6645091">.</span><span class="ident" id="6645092">ParseComments</span><span class="op" id="6645105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645108">if</span>&nbsp;<span class="ident" id="6645111">err</span>&nbsp;<span class="op" id="6645115">==</span>&nbsp;<span class="ident" id="6645118">nil</span>&nbsp;<span class="op" id="6645122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645126">t</span><span class="op" id="6645127">.</span><span class="ident" id="6645128">Error</span><span class="op" id="6645133">(</span><span class="string" id="6645134">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="6645160">)</span>&nbsp;<span class="comment" id="6645162">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645180">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645183">var</span>&nbsp;<span class="ident" id="6645187">buf</span>&nbsp;<span class="ident" id="6645191">bytes</span><span class="op" id="6645196">.</span><span class="ident" id="6645197">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645205">Fprint</span><span class="op" id="6645211">(</span><span class="op" id="6645212">&amp;</span><span class="ident" id="6645213">buf</span><span class="op" id="6645216">,</span>&nbsp;<span class="ident" id="6645218">fset</span><span class="op" id="6645222">,</span>&nbsp;<span class="ident" id="6645224">f</span><span class="op" id="6645225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645228">if</span>&nbsp;<span class="ident" id="6645231">buf</span><span class="op" id="6645234">.</span><span class="ident" id="6645235">String</span><span class="op" id="6645241">(</span><span class="op" id="6645242">)</span>&nbsp;<span class="op" id="6645244">!=</span>&nbsp;<span class="ident" id="6645247">res</span>&nbsp;<span class="op" id="6645251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645255">t</span><span class="op" id="6645256">.</span><span class="ident" id="6645257">Errorf</span><span class="op" id="6645263">(</span><span class="string" id="6645264">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6645285">,</span>&nbsp;<span class="ident" id="6645287">buf</span><span class="op" id="6645290">.</span><span class="ident" id="6645291">String</span><span class="op" id="6645297">(</span><span class="op" id="6645298">)</span><span class="op" id="6645299">,</span>&nbsp;<span class="ident" id="6645301">res</span><span class="op" id="6645304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645307">}</span><br>
<span class="lineno">270</span><span class="op" id="6645309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6645312">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="6645381">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6645453">func</span>&nbsp;<span class="ident" id="6645458">testComment</span><span class="op" id="6645469">(</span><span class="ident" id="6645470">t</span>&nbsp;<span class="op" id="6645472">*</span><span class="ident" id="6645473">testing</span><span class="op" id="6645480">.</span><span class="ident" id="6645481">T</span><span class="op" id="6645482">,</span>&nbsp;<span class="ident" id="6645484">f</span>&nbsp;<span class="op" id="6645486">*</span><span class="ident" id="6645487">ast</span><span class="op" id="6645490">.</span><span class="ident" id="6645491">File</span><span class="op" id="6645495">,</span>&nbsp;<span class="ident" id="6645497">srclen</span>&nbsp;<span class="builtintype" id="6645504">int</span><span class="op" id="6645507">,</span>&nbsp;<span class="ident" id="6645509">comment</span>&nbsp;<span class="op" id="6645517">*</span><span class="ident" id="6645518">ast</span><span class="op" id="6645521">.</span><span class="ident" id="6645522">Comment</span><span class="op" id="6645529">)</span>&nbsp;<span class="op" id="6645531">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645534">f</span><span class="op" id="6645535">.</span><span class="ident" id="6645536">Comments</span><span class="op" id="6645544">[</span><span class="num" id="6645545">0</span><span class="op" id="6645546">]</span><span class="op" id="6645547">.</span><span class="ident" id="6645548">List</span><span class="op" id="6645552">[</span><span class="num" id="6645553">0</span><span class="op" id="6645554">]</span>&nbsp;<span class="op" id="6645556">=</span>&nbsp;<span class="ident" id="6645558">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645567">var</span>&nbsp;<span class="ident" id="6645571">buf</span>&nbsp;<span class="ident" id="6645575">bytes</span><span class="op" id="6645580">.</span><span class="ident" id="6645581">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645589">for</span>&nbsp;<span class="ident" id="6645593">offs</span>&nbsp;<span class="op" id="6645598">:=</span>&nbsp;<span class="num" id="6645601">0</span><span class="op" id="6645602">;</span>&nbsp;<span class="ident" id="6645604">offs</span>&nbsp;<span class="op" id="6645609">&lt;=</span>&nbsp;<span class="ident" id="6645612">srclen</span><span class="op" id="6645618">;</span>&nbsp;<span class="ident" id="6645620">offs</span><span class="op" id="6645624">++</span>&nbsp;<span class="op" id="6645627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645631">buf</span><span class="op" id="6645634">.</span><span class="ident" id="6645635">Reset</span><span class="op" id="6645640">(</span><span class="op" id="6645641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6645645">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6645699">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645753">if</span>&nbsp;<span class="ident" id="6645756">err</span>&nbsp;<span class="op" id="6645760">:=</span>&nbsp;<span class="ident" id="6645763">Fprint</span><span class="op" id="6645769">(</span><span class="op" id="6645770">&amp;</span><span class="ident" id="6645771">buf</span><span class="op" id="6645774">,</span>&nbsp;<span class="ident" id="6645776">fset</span><span class="op" id="6645780">,</span>&nbsp;<span class="ident" id="6645782">f</span><span class="op" id="6645783">)</span><span class="op" id="6645784">;</span>&nbsp;<span class="ident" id="6645786">err</span>&nbsp;<span class="op" id="6645790">!=</span>&nbsp;<span class="ident" id="6645793">nil</span>&nbsp;<span class="op" id="6645797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645802">t</span><span class="op" id="6645803">.</span><span class="ident" id="6645804">Error</span><span class="op" id="6645809">(</span><span class="ident" id="6645810">err</span><span class="op" id="6645813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6645821">if</span>&nbsp;<span class="ident" id="6645824">_</span><span class="op" id="6645825">,</span>&nbsp;<span class="ident" id="6645827">err</span>&nbsp;<span class="op" id="6645831">:=</span>&nbsp;<span class="ident" id="6645834">parser</span><span class="op" id="6645840">.</span><span class="ident" id="6645841">ParseFile</span><span class="op" id="6645850">(</span><span class="ident" id="6645851">fset</span><span class="op" id="6645855">,</span>&nbsp;<span class="string" id="6645857">&#34;&#34;</span><span class="op" id="6645859">,</span>&nbsp;<span class="ident" id="6645861">buf</span><span class="op" id="6645864">.</span><span class="ident" id="6645865">Bytes</span><span class="op" id="6645870">(</span><span class="op" id="6645871">)</span><span class="op" id="6645872">,</span>&nbsp;<span class="num" id="6645874">0</span><span class="op" id="6645875">)</span><span class="op" id="6645876">;</span>&nbsp;<span class="ident" id="6645878">err</span>&nbsp;<span class="op" id="6645882">!=</span>&nbsp;<span class="ident" id="6645885">nil</span>&nbsp;<span class="op" id="6645889">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6645894">t</span><span class="op" id="6645895">.</span><span class="ident" id="6645896">Fatalf</span><span class="op" id="6645902">(</span><span class="string" id="6645903">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="6645940">,</span>&nbsp;<span class="ident" id="6645942">comment</span><span class="op" id="6645949">.</span><span class="ident" id="6645950">Slash</span><span class="op" id="6645955">,</span>&nbsp;<span class="ident" id="6645957">buf</span><span class="op" id="6645960">.</span><span class="ident" id="6645961">String</span><span class="op" id="6645967">(</span><span class="op" id="6645968">)</span><span class="op" id="6645969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6645973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6645977">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6646022">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646069">comment</span><span class="op" id="6646076">.</span><span class="ident" id="6646077">Slash</span><span class="op" id="6646082">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646086">}</span><br>
<span class="lineno"></span><span class="op" id="6646088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6646091">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="6646145">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="6646214">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="6646231">func</span>&nbsp;<span class="ident" id="6646236">TestBadComments</span><span class="op" id="6646251">(</span><span class="ident" id="6646252">t</span>&nbsp;<span class="op" id="6646254">*</span><span class="ident" id="6646255">testing</span><span class="op" id="6646262">.</span><span class="ident" id="6646263">T</span><span class="op" id="6646264">)</span>&nbsp;<span class="op" id="6646266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646269">const</span>&nbsp;<span class="ident" id="6646275">src</span>&nbsp;<span class="op" id="6646279">=</span>&nbsp;<span class="string" id="6646281">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646535">f</span><span class="op" id="6646536">,</span>&nbsp;<span class="ident" id="6646538">err</span>&nbsp;<span class="op" id="6646542">:=</span>&nbsp;<span class="ident" id="6646545">parser</span><span class="op" id="6646551">.</span><span class="ident" id="6646552">ParseFile</span><span class="op" id="6646561">(</span><span class="ident" id="6646562">fset</span><span class="op" id="6646566">,</span>&nbsp;<span class="string" id="6646568">&#34;&#34;</span><span class="op" id="6646570">,</span>&nbsp;<span class="ident" id="6646572">src</span><span class="op" id="6646575">,</span>&nbsp;<span class="ident" id="6646577">parser</span><span class="op" id="6646583">.</span><span class="ident" id="6646584">ParseComments</span><span class="op" id="6646597">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646600">if</span>&nbsp;<span class="ident" id="6646603">err</span>&nbsp;<span class="op" id="6646607">!=</span>&nbsp;<span class="ident" id="6646610">nil</span>&nbsp;<span class="op" id="6646614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646618">t</span><span class="op" id="6646619">.</span><span class="ident" id="6646620">Error</span><span class="op" id="6646625">(</span><span class="ident" id="6646626">err</span><span class="op" id="6646629">)</span>&nbsp;<span class="comment" id="6646631">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646653">comment</span>&nbsp;<span class="op" id="6646661">:=</span>&nbsp;<span class="ident" id="6646664">f</span><span class="op" id="6646665">.</span><span class="ident" id="6646666">Comments</span><span class="op" id="6646674">[</span><span class="num" id="6646675">0</span><span class="op" id="6646676">]</span><span class="op" id="6646677">.</span><span class="ident" id="6646678">List</span><span class="op" id="6646682">[</span><span class="num" id="6646683">0</span><span class="op" id="6646684">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646687">pos</span>&nbsp;<span class="op" id="6646691">:=</span>&nbsp;<span class="ident" id="6646694">comment</span><span class="op" id="6646701">.</span><span class="ident" id="6646702">Pos</span><span class="op" id="6646705">(</span><span class="op" id="6646706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6646709">if</span>&nbsp;<span class="ident" id="6646712">fset</span><span class="op" id="6646716">.</span><span class="ident" id="6646717">Position</span><span class="op" id="6646725">(</span><span class="ident" id="6646726">pos</span><span class="op" id="6646729">)</span><span class="op" id="6646730">.</span><span class="ident" id="6646731">Offset</span>&nbsp;<span class="op" id="6646738">!=</span>&nbsp;<span class="num" id="6646741">1</span>&nbsp;<span class="op" id="6646743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646747">t</span><span class="op" id="6646748">.</span><span class="ident" id="6646749">Error</span><span class="op" id="6646754">(</span><span class="string" id="6646755">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="6646774">)</span>&nbsp;<span class="comment" id="6646776">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6646794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646798">testComment</span><span class="op" id="6646809">(</span><span class="ident" id="6646810">t</span><span class="op" id="6646811">,</span>&nbsp;<span class="ident" id="6646813">f</span><span class="op" id="6646814">,</span>&nbsp;<span class="builtinfunc" id="6646816">len</span><span class="op" id="6646819">(</span><span class="ident" id="6646820">src</span><span class="op" id="6646823">)</span><span class="op" id="6646824">,</span>&nbsp;<span class="op" id="6646826">&amp;</span><span class="ident" id="6646827">ast</span><span class="op" id="6646830">.</span><span class="ident" id="6646831">Comment</span><span class="op" id="6646838">{</span><span class="ident" id="6646839">Slash</span><span class="op" id="6646844">:</span>&nbsp;<span class="ident" id="6646846">pos</span><span class="op" id="6646849">,</span>&nbsp;<span class="ident" id="6646851">Text</span><span class="op" id="6646855">:</span>&nbsp;<span class="string" id="6646857">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="6646875">}</span><span class="op" id="6646876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646879">testComment</span><span class="op" id="6646890">(</span><span class="ident" id="6646891">t</span><span class="op" id="6646892">,</span>&nbsp;<span class="ident" id="6646894">f</span><span class="op" id="6646895">,</span>&nbsp;<span class="builtinfunc" id="6646897">len</span><span class="op" id="6646900">(</span><span class="ident" id="6646901">src</span><span class="op" id="6646904">)</span><span class="op" id="6646905">,</span>&nbsp;<span class="op" id="6646907">&amp;</span><span class="ident" id="6646908">ast</span><span class="op" id="6646911">.</span><span class="ident" id="6646912">Comment</span><span class="op" id="6646919">{</span><span class="ident" id="6646920">Slash</span><span class="op" id="6646925">:</span>&nbsp;<span class="ident" id="6646927">pos</span><span class="op" id="6646930">,</span>&nbsp;<span class="ident" id="6646932">Text</span><span class="op" id="6646936">:</span>&nbsp;<span class="string" id="6646938">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="6646959">}</span><span class="op" id="6646960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6646963">testComment</span><span class="op" id="6646974">(</span><span class="ident" id="6646975">t</span><span class="op" id="6646976">,</span>&nbsp;<span class="ident" id="6646978">f</span><span class="op" id="6646979">,</span>&nbsp;<span class="builtinfunc" id="6646981">len</span><span class="op" id="6646984">(</span><span class="ident" id="6646985">src</span><span class="op" id="6646988">)</span><span class="op" id="6646989">,</span>&nbsp;<span class="op" id="6646991">&amp;</span><span class="ident" id="6646992">ast</span><span class="op" id="6646995">.</span><span class="ident" id="6646996">Comment</span><span class="op" id="6647003">{</span><span class="ident" id="6647004">Slash</span><span class="op" id="6647009">:</span>&nbsp;<span class="ident" id="6647011">pos</span><span class="op" id="6647014">,</span>&nbsp;<span class="ident" id="6647016">Text</span><span class="op" id="6647020">:</span>&nbsp;<span class="string" id="6647022">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="6647046">}</span><span class="op" id="6647047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647050">testComment</span><span class="op" id="6647061">(</span><span class="ident" id="6647062">t</span><span class="op" id="6647063">,</span>&nbsp;<span class="ident" id="6647065">f</span><span class="op" id="6647066">,</span>&nbsp;<span class="builtinfunc" id="6647068">len</span><span class="op" id="6647071">(</span><span class="ident" id="6647072">src</span><span class="op" id="6647075">)</span><span class="op" id="6647076">,</span>&nbsp;<span class="op" id="6647078">&amp;</span><span class="ident" id="6647079">ast</span><span class="op" id="6647082">.</span><span class="ident" id="6647083">Comment</span><span class="op" id="6647090">{</span><span class="ident" id="6647091">Slash</span><span class="op" id="6647096">:</span>&nbsp;<span class="ident" id="6647098">pos</span><span class="op" id="6647101">,</span>&nbsp;<span class="ident" id="6647103">Text</span><span class="op" id="6647107">:</span>&nbsp;<span class="string" id="6647109">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="6647137">}</span><span class="op" id="6647138">)</span><br>
<span class="lineno"></span><span class="op" id="6647140">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="6647143">type</span>&nbsp;<span class="ident" id="6647148">visitor</span>&nbsp;<span class="keyword" id="6647156">chan</span>&nbsp;<span class="op" id="6647161">*</span><span class="ident" id="6647162">ast</span><span class="op" id="6647165">.</span><span class="ident" id="6647166">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6647173">func</span>&nbsp;<span class="op" id="6647178">(</span><span class="ident" id="6647179">v</span>&nbsp;<span class="ident" id="6647181">visitor</span><span class="op" id="6647188">)</span>&nbsp;<span class="ident" id="6647190">Visit</span><span class="op" id="6647195">(</span><span class="ident" id="6647196">n</span>&nbsp;<span class="ident" id="6647198">ast</span><span class="op" id="6647201">.</span><span class="ident" id="6647202">Node</span><span class="op" id="6647206">)</span>&nbsp;<span class="op" id="6647208">(</span><span class="ident" id="6647209">w</span>&nbsp;<span class="ident" id="6647211">ast</span><span class="op" id="6647214">.</span><span class="ident" id="6647215">Visitor</span><span class="op" id="6647222">)</span>&nbsp;<span class="op" id="6647224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647227">if</span>&nbsp;<span class="ident" id="6647230">ident</span><span class="op" id="6647235">,</span>&nbsp;<span class="ident" id="6647237">ok</span>&nbsp;<span class="op" id="6647240">:=</span>&nbsp;<span class="ident" id="6647243">n</span><span class="op" id="6647244">.</span><span class="op" id="6647245">(</span><span class="op" id="6647246">*</span><span class="ident" id="6647247">ast</span><span class="op" id="6647250">.</span><span class="ident" id="6647251">Ident</span><span class="op" id="6647256">)</span><span class="op" id="6647257">;</span>&nbsp;<span class="ident" id="6647259">ok</span>&nbsp;<span class="op" id="6647262">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647266">v</span>&nbsp;<span class="op" id="6647268">&lt;-</span>&nbsp;<span class="ident" id="6647271">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647281">return</span>&nbsp;<span class="ident" id="6647288">v</span><br>
<span class="lineno"></span><span class="op" id="6647290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6647293">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="6647371">func</span>&nbsp;<span class="ident" id="6647376">idents</span><span class="op" id="6647382">(</span><span class="ident" id="6647383">f</span>&nbsp;<span class="op" id="6647385">*</span><span class="ident" id="6647386">ast</span><span class="op" id="6647389">.</span><span class="ident" id="6647390">File</span><span class="op" id="6647394">)</span>&nbsp;<span class="op" id="6647396">&lt;-</span><span class="keyword" id="6647398">chan</span>&nbsp;<span class="op" id="6647403">*</span><span class="ident" id="6647404">ast</span><span class="op" id="6647407">.</span><span class="ident" id="6647408">Ident</span>&nbsp;<span class="op" id="6647414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647417">v</span>&nbsp;<span class="op" id="6647419">:=</span>&nbsp;<span class="builtinfunc" id="6647422">make</span><span class="op" id="6647426">(</span><span class="ident" id="6647427">visitor</span><span class="op" id="6647434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647437">go</span>&nbsp;<span class="keyword" id="6647440">func</span><span class="op" id="6647444">(</span><span class="op" id="6647445">)</span>&nbsp;<span class="op" id="6647447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647451">ast</span><span class="op" id="6647454">.</span><span class="ident" id="6647455">Walk</span><span class="op" id="6647459">(</span><span class="ident" id="6647460">v</span><span class="op" id="6647461">,</span>&nbsp;<span class="ident" id="6647463">f</span><span class="op" id="6647464">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6647468">close</span><span class="op" id="6647473">(</span><span class="ident" id="6647474">v</span><span class="op" id="6647475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647478">}</span><span class="op" id="6647479">(</span><span class="op" id="6647480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647483">return</span>&nbsp;<span class="ident" id="6647490">v</span><br>
<span class="lineno"></span><span class="op" id="6647492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="6647495">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6647555">func</span>&nbsp;<span class="ident" id="6647560">identCount</span><span class="op" id="6647570">(</span><span class="ident" id="6647571">f</span>&nbsp;<span class="op" id="6647573">*</span><span class="ident" id="6647574">ast</span><span class="op" id="6647577">.</span><span class="ident" id="6647578">File</span><span class="op" id="6647582">)</span>&nbsp;<span class="builtintype" id="6647584">int</span>&nbsp;<span class="op" id="6647588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647591">n</span>&nbsp;<span class="op" id="6647593">:=</span>&nbsp;<span class="num" id="6647596">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647599">for</span>&nbsp;<span class="keyword" id="6647603">range</span>&nbsp;<span class="ident" id="6647609">idents</span><span class="op" id="6647615">(</span><span class="ident" id="6647616">f</span><span class="op" id="6647617">)</span>&nbsp;<span class="op" id="6647619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6647623">n</span><span class="op" id="6647624">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6647628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647631">return</span>&nbsp;<span class="ident" id="6647638">n</span><br>
<span class="lineno"></span><span class="op" id="6647640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6647643">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="6647707">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="6647772">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="6647790">func</span>&nbsp;<span class="ident" id="6647795">TestSourcePos</span><span class="op" id="6647808">(</span><span class="ident" id="6647809">t</span>&nbsp;<span class="op" id="6647811">*</span><span class="ident" id="6647812">testing</span><span class="op" id="6647819">.</span><span class="ident" id="6647820">T</span><span class="op" id="6647821">)</span>&nbsp;<span class="op" id="6647823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6647826">const</span>&nbsp;<span class="ident" id="6647832">src</span>&nbsp;<span class="op" id="6647836">=</span>&nbsp;<span class="string" id="6647838">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648063">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648082">f1</span><span class="op" id="6648084">,</span>&nbsp;<span class="ident" id="6648086">err</span>&nbsp;<span class="op" id="6648090">:=</span>&nbsp;<span class="ident" id="6648093">parser</span><span class="op" id="6648099">.</span><span class="ident" id="6648100">ParseFile</span><span class="op" id="6648109">(</span><span class="ident" id="6648110">fset</span><span class="op" id="6648114">,</span>&nbsp;<span class="string" id="6648116">&#34;src&#34;</span><span class="op" id="6648121">,</span>&nbsp;<span class="ident" id="6648123">src</span><span class="op" id="6648126">,</span>&nbsp;<span class="ident" id="6648128">parser</span><span class="op" id="6648134">.</span><span class="ident" id="6648135">ParseComments</span><span class="op" id="6648148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648151">if</span>&nbsp;<span class="ident" id="6648154">err</span>&nbsp;<span class="op" id="6648158">!=</span>&nbsp;<span class="ident" id="6648161">nil</span>&nbsp;<span class="op" id="6648165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648169">t</span><span class="op" id="6648170">.</span><span class="ident" id="6648171">Fatal</span><span class="op" id="6648176">(</span><span class="ident" id="6648177">err</span><span class="op" id="6648180">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648187">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648213">var</span>&nbsp;<span class="ident" id="6648217">buf</span>&nbsp;<span class="ident" id="6648221">bytes</span><span class="op" id="6648226">.</span><span class="ident" id="6648227">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648235">err</span>&nbsp;<span class="op" id="6648239">=</span>&nbsp;<span class="op" id="6648241">(</span><span class="op" id="6648242">&amp;</span><span class="ident" id="6648243">Config</span><span class="op" id="6648249">{</span><span class="ident" id="6648250">Mode</span><span class="op" id="6648254">:</span>&nbsp;<span class="ident" id="6648256">UseSpaces</span>&nbsp;<span class="op" id="6648266">|</span>&nbsp;<span class="ident" id="6648268">SourcePos</span><span class="op" id="6648277">,</span>&nbsp;<span class="ident" id="6648279">Tabwidth</span><span class="op" id="6648287">:</span>&nbsp;<span class="num" id="6648289">8</span><span class="op" id="6648290">}</span><span class="op" id="6648291">)</span><span class="op" id="6648292">.</span><span class="ident" id="6648293">Fprint</span><span class="op" id="6648299">(</span><span class="op" id="6648300">&amp;</span><span class="ident" id="6648301">buf</span><span class="op" id="6648304">,</span>&nbsp;<span class="ident" id="6648306">fset</span><span class="op" id="6648310">,</span>&nbsp;<span class="ident" id="6648312">f1</span><span class="op" id="6648314">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648317">if</span>&nbsp;<span class="ident" id="6648320">err</span>&nbsp;<span class="op" id="6648324">!=</span>&nbsp;<span class="ident" id="6648327">nil</span>&nbsp;<span class="op" id="6648331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648335">t</span><span class="op" id="6648336">.</span><span class="ident" id="6648337">Fatal</span><span class="op" id="6648342">(</span><span class="ident" id="6648343">err</span><span class="op" id="6648346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648353">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648387">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648463">f2</span><span class="op" id="6648465">,</span>&nbsp;<span class="ident" id="6648467">err</span>&nbsp;<span class="op" id="6648471">:=</span>&nbsp;<span class="ident" id="6648474">parser</span><span class="op" id="6648480">.</span><span class="ident" id="6648481">ParseFile</span><span class="op" id="6648490">(</span><span class="ident" id="6648491">fset</span><span class="op" id="6648495">,</span>&nbsp;<span class="string" id="6648497">&#34;&#34;</span><span class="op" id="6648499">,</span>&nbsp;<span class="ident" id="6648501">buf</span><span class="op" id="6648504">.</span><span class="ident" id="6648505">Bytes</span><span class="op" id="6648510">(</span><span class="op" id="6648511">)</span><span class="op" id="6648512">,</span>&nbsp;<span class="num" id="6648514">0</span><span class="op" id="6648515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648518">if</span>&nbsp;<span class="ident" id="6648521">err</span>&nbsp;<span class="op" id="6648525">!=</span>&nbsp;<span class="ident" id="6648528">nil</span>&nbsp;<span class="op" id="6648532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648536">t</span><span class="op" id="6648537">.</span><span class="ident" id="6648538">Fatalf</span><span class="op" id="6648544">(</span><span class="string" id="6648545">&#34;%s\n%s&#34;</span><span class="op" id="6648553">,</span>&nbsp;<span class="ident" id="6648555">err</span><span class="op" id="6648558">,</span>&nbsp;<span class="ident" id="6648560">buf</span><span class="op" id="6648563">.</span><span class="ident" id="6648564">Bytes</span><span class="op" id="6648569">(</span><span class="op" id="6648570">)</span><span class="op" id="6648571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648574">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648578">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648649">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648721">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648792">n1</span>&nbsp;<span class="op" id="6648795">:=</span>&nbsp;<span class="ident" id="6648798">identCount</span><span class="op" id="6648808">(</span><span class="ident" id="6648809">f1</span><span class="op" id="6648811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648814">n2</span>&nbsp;<span class="op" id="6648817">:=</span>&nbsp;<span class="ident" id="6648820">identCount</span><span class="op" id="6648830">(</span><span class="ident" id="6648831">f2</span><span class="op" id="6648833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648836">if</span>&nbsp;<span class="ident" id="6648839">n1</span>&nbsp;<span class="op" id="6648842">==</span>&nbsp;<span class="num" id="6648845">0</span>&nbsp;<span class="op" id="6648847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648851">t</span><span class="op" id="6648852">.</span><span class="ident" id="6648853">Fatal</span><span class="op" id="6648858">(</span><span class="string" id="6648859">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="6648874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648877">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6648880">if</span>&nbsp;<span class="ident" id="6648883">n2</span>&nbsp;<span class="op" id="6648886">!=</span>&nbsp;<span class="ident" id="6648889">n1</span>&nbsp;<span class="op" id="6648892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6648896">t</span><span class="op" id="6648897">.</span><span class="ident" id="6648898">Errorf</span><span class="op" id="6648904">(</span><span class="string" id="6648905">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6648929">,</span>&nbsp;<span class="ident" id="6648931">n2</span><span class="op" id="6648933">,</span>&nbsp;<span class="ident" id="6648935">n1</span><span class="op" id="6648937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6648940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6648944">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649006">i2range</span>&nbsp;<span class="op" id="6649014">:=</span>&nbsp;<span class="ident" id="6649017">idents</span><span class="op" id="6649023">(</span><span class="ident" id="6649024">f2</span><span class="op" id="6649026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649029">for</span>&nbsp;<span class="ident" id="6649033">i1</span>&nbsp;<span class="op" id="6649036">:=</span>&nbsp;<span class="keyword" id="6649039">range</span>&nbsp;<span class="ident" id="6649045">idents</span><span class="op" id="6649051">(</span><span class="ident" id="6649052">f1</span><span class="op" id="6649054">)</span>&nbsp;<span class="op" id="6649056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649060">i2</span>&nbsp;<span class="op" id="6649063">:=</span>&nbsp;<span class="op" id="6649066">&lt;-</span><span class="ident" id="6649068">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649079">if</span>&nbsp;<span class="ident" id="6649082">i2</span><span class="op" id="6649084">.</span><span class="ident" id="6649085">Name</span>&nbsp;<span class="op" id="6649090">!=</span>&nbsp;<span class="ident" id="6649093">i1</span><span class="op" id="6649095">.</span><span class="ident" id="6649096">Name</span>&nbsp;<span class="op" id="6649101">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649106">t</span><span class="op" id="6649107">.</span><span class="ident" id="6649108">Errorf</span><span class="op" id="6649114">(</span><span class="string" id="6649115">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6649138">,</span>&nbsp;<span class="ident" id="6649140">i2</span><span class="op" id="6649142">.</span><span class="ident" id="6649143">Name</span><span class="op" id="6649147">,</span>&nbsp;<span class="ident" id="6649149">i1</span><span class="op" id="6649151">.</span><span class="ident" id="6649152">Name</span><span class="op" id="6649156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649165">l1</span>&nbsp;<span class="op" id="6649168">:=</span>&nbsp;<span class="ident" id="6649171">fset</span><span class="op" id="6649175">.</span><span class="ident" id="6649176">Position</span><span class="op" id="6649184">(</span><span class="ident" id="6649185">i1</span><span class="op" id="6649187">.</span><span class="ident" id="6649188">Pos</span><span class="op" id="6649191">(</span><span class="op" id="6649192">)</span><span class="op" id="6649193">)</span><span class="op" id="6649194">.</span><span class="ident" id="6649195">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649202">l2</span>&nbsp;<span class="op" id="6649205">:=</span>&nbsp;<span class="ident" id="6649208">fset</span><span class="op" id="6649212">.</span><span class="ident" id="6649213">Position</span><span class="op" id="6649221">(</span><span class="ident" id="6649222">i2</span><span class="op" id="6649224">.</span><span class="ident" id="6649225">Pos</span><span class="op" id="6649228">(</span><span class="op" id="6649229">)</span><span class="op" id="6649230">)</span><span class="op" id="6649231">.</span><span class="ident" id="6649232">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649239">if</span>&nbsp;<span class="ident" id="6649242">l2</span>&nbsp;<span class="op" id="6649245">!=</span>&nbsp;<span class="ident" id="6649248">l1</span>&nbsp;<span class="op" id="6649251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649256">t</span><span class="op" id="6649257">.</span><span class="ident" id="6649258">Errorf</span><span class="op" id="6649264">(</span><span class="string" id="6649265">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="6649294">,</span>&nbsp;<span class="ident" id="6649296">l2</span><span class="op" id="6649298">,</span>&nbsp;<span class="ident" id="6649300">l1</span><span class="op" id="6649302">,</span>&nbsp;<span class="ident" id="6649304">i1</span><span class="op" id="6649306">.</span><span class="ident" id="6649307">Name</span><span class="op" id="6649311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649322">if</span>&nbsp;<span class="ident" id="6649325">t</span><span class="op" id="6649326">.</span><span class="ident" id="6649327">Failed</span><span class="op" id="6649333">(</span><span class="op" id="6649334">)</span>&nbsp;<span class="op" id="6649336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649340">t</span><span class="op" id="6649341">.</span><span class="ident" id="6649342">Logf</span><span class="op" id="6649346">(</span><span class="string" id="6649347">&#34;\n%s&#34;</span><span class="op" id="6649353">,</span>&nbsp;<span class="ident" id="6649355">buf</span><span class="op" id="6649358">.</span><span class="ident" id="6649359">Bytes</span><span class="op" id="6649364">(</span><span class="op" id="6649365">)</span><span class="op" id="6649366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649369">}</span><br>
<span class="lineno"></span><span class="op" id="6649371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6649374">var</span>&nbsp;<span class="ident" id="6649378">decls</span>&nbsp;<span class="op" id="6649384">=</span>&nbsp;<span class="op" id="6649386">[</span><span class="op" id="6649387">]</span><span class="builtintype" id="6649388">string</span><span class="op" id="6649394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6649397">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="6649411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6649414">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="6649466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6649469">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="6649511">,</span><br>
<span class="lineno"></span><span class="op" id="6649513">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="6649516">func</span>&nbsp;<span class="ident" id="6649521">TestDeclLists</span><span class="op" id="6649534">(</span><span class="ident" id="6649535">t</span>&nbsp;<span class="op" id="6649537">*</span><span class="ident" id="6649538">testing</span><span class="op" id="6649545">.</span><span class="ident" id="6649546">T</span><span class="op" id="6649547">)</span>&nbsp;<span class="op" id="6649549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649552">for</span>&nbsp;<span class="ident" id="6649556">_</span><span class="op" id="6649557">,</span>&nbsp;<span class="ident" id="6649559">src</span>&nbsp;<span class="op" id="6649563">:=</span>&nbsp;<span class="keyword" id="6649566">range</span>&nbsp;<span class="ident" id="6649572">decls</span>&nbsp;<span class="op" id="6649578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649582">file</span><span class="op" id="6649586">,</span>&nbsp;<span class="ident" id="6649588">err</span>&nbsp;<span class="op" id="6649592">:=</span>&nbsp;<span class="ident" id="6649595">parser</span><span class="op" id="6649601">.</span><span class="ident" id="6649602">ParseFile</span><span class="op" id="6649611">(</span><span class="ident" id="6649612">fset</span><span class="op" id="6649616">,</span>&nbsp;<span class="string" id="6649618">&#34;&#34;</span><span class="op" id="6649620">,</span>&nbsp;<span class="string" id="6649622">&#34;package&nbsp;p;&#34;</span><span class="op" id="6649634">+</span><span class="ident" id="6649635">src</span><span class="op" id="6649638">,</span>&nbsp;<span class="ident" id="6649640">parser</span><span class="op" id="6649646">.</span><span class="ident" id="6649647">ParseComments</span><span class="op" id="6649660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649664">if</span>&nbsp;<span class="ident" id="6649667">err</span>&nbsp;<span class="op" id="6649671">!=</span>&nbsp;<span class="ident" id="6649674">nil</span>&nbsp;<span class="op" id="6649678">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6649683">panic</span><span class="op" id="6649688">(</span><span class="ident" id="6649689">err</span><span class="op" id="6649692">)</span>&nbsp;<span class="comment" id="6649694">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649718">var</span>&nbsp;<span class="ident" id="6649722">buf</span>&nbsp;<span class="ident" id="6649726">bytes</span><span class="op" id="6649731">.</span><span class="ident" id="6649732">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649741">err</span>&nbsp;<span class="op" id="6649745">=</span>&nbsp;<span class="ident" id="6649747">Fprint</span><span class="op" id="6649753">(</span><span class="op" id="6649754">&amp;</span><span class="ident" id="6649755">buf</span><span class="op" id="6649758">,</span>&nbsp;<span class="ident" id="6649760">fset</span><span class="op" id="6649764">,</span>&nbsp;<span class="ident" id="6649766">file</span><span class="op" id="6649770">.</span><span class="ident" id="6649771">Decls</span><span class="op" id="6649776">)</span>&nbsp;<span class="comment" id="6649778">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649807">if</span>&nbsp;<span class="ident" id="6649810">err</span>&nbsp;<span class="op" id="6649814">!=</span>&nbsp;<span class="ident" id="6649817">nil</span>&nbsp;<span class="op" id="6649821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6649826">panic</span><span class="op" id="6649831">(</span><span class="ident" id="6649832">err</span><span class="op" id="6649835">)</span>&nbsp;<span class="comment" id="6649837">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649861">out</span>&nbsp;<span class="op" id="6649865">:=</span>&nbsp;<span class="ident" id="6649868">buf</span><span class="op" id="6649871">.</span><span class="ident" id="6649872">String</span><span class="op" id="6649878">(</span><span class="op" id="6649879">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6649883">if</span>&nbsp;<span class="ident" id="6649886">out</span>&nbsp;<span class="op" id="6649890">!=</span>&nbsp;<span class="ident" id="6649893">src</span>&nbsp;<span class="op" id="6649897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6649902">t</span><span class="op" id="6649903">.</span><span class="ident" id="6649904">Errorf</span><span class="op" id="6649910">(</span><span class="string" id="6649911">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6649935">,</span>&nbsp;<span class="ident" id="6649937">out</span><span class="op" id="6649940">,</span>&nbsp;<span class="ident" id="6649942">src</span><span class="op" id="6649945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6649952">}</span><br>
<span class="lineno"></span><span class="op" id="6649954">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="6649957">var</span>&nbsp;<span class="ident" id="6649961">stmts</span>&nbsp;<span class="op" id="6649967">=</span>&nbsp;<span class="op" id="6649969">[</span><span class="op" id="6649970">]</span><span class="builtintype" id="6649971">string</span><span class="op" id="6649977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6649980">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="6649988">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6649991">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="6650033">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6650036">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="6650063">,</span><br>
<span class="lineno">460</span><span class="op" id="6650065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6650068">func</span>&nbsp;<span class="ident" id="6650073">TestStmtLists</span><span class="op" id="6650086">(</span><span class="ident" id="6650087">t</span>&nbsp;<span class="op" id="6650089">*</span><span class="ident" id="6650090">testing</span><span class="op" id="6650097">.</span><span class="ident" id="6650098">T</span><span class="op" id="6650099">)</span>&nbsp;<span class="op" id="6650101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650104">for</span>&nbsp;<span class="ident" id="6650108">_</span><span class="op" id="6650109">,</span>&nbsp;<span class="ident" id="6650111">src</span>&nbsp;<span class="op" id="6650115">:=</span>&nbsp;<span class="keyword" id="6650118">range</span>&nbsp;<span class="ident" id="6650124">stmts</span>&nbsp;<span class="op" id="6650130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650134">file</span><span class="op" id="6650138">,</span>&nbsp;<span class="ident" id="6650140">err</span>&nbsp;<span class="op" id="6650144">:=</span>&nbsp;<span class="ident" id="6650147">parser</span><span class="op" id="6650153">.</span><span class="ident" id="6650154">ParseFile</span><span class="op" id="6650163">(</span><span class="ident" id="6650164">fset</span><span class="op" id="6650168">,</span>&nbsp;<span class="string" id="6650170">&#34;&#34;</span><span class="op" id="6650172">,</span>&nbsp;<span class="string" id="6650174">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6650197">+</span><span class="ident" id="6650198">src</span><span class="op" id="6650201">+</span><span class="string" id="6650202">&#34;}&#34;</span><span class="op" id="6650205">,</span>&nbsp;<span class="ident" id="6650207">parser</span><span class="op" id="6650213">.</span><span class="ident" id="6650214">ParseComments</span><span class="op" id="6650227">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650231">if</span>&nbsp;<span class="ident" id="6650234">err</span>&nbsp;<span class="op" id="6650238">!=</span>&nbsp;<span class="ident" id="6650241">nil</span>&nbsp;<span class="op" id="6650245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6650250">panic</span><span class="op" id="6650255">(</span><span class="ident" id="6650256">err</span><span class="op" id="6650259">)</span>&nbsp;<span class="comment" id="6650261">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650285">var</span>&nbsp;<span class="ident" id="6650289">buf</span>&nbsp;<span class="ident" id="6650293">bytes</span><span class="op" id="6650298">.</span><span class="ident" id="6650299">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650308">err</span>&nbsp;<span class="op" id="6650312">=</span>&nbsp;<span class="ident" id="6650314">Fprint</span><span class="op" id="6650320">(</span><span class="op" id="6650321">&amp;</span><span class="ident" id="6650322">buf</span><span class="op" id="6650325">,</span>&nbsp;<span class="ident" id="6650327">fset</span><span class="op" id="6650331">,</span>&nbsp;<span class="ident" id="6650333">file</span><span class="op" id="6650337">.</span><span class="ident" id="6650338">Decls</span><span class="op" id="6650343">[</span><span class="num" id="6650344">0</span><span class="op" id="6650345">]</span><span class="op" id="6650346">.</span><span class="op" id="6650347">(</span><span class="op" id="6650348">*</span><span class="ident" id="6650349">ast</span><span class="op" id="6650352">.</span><span class="ident" id="6650353">FuncDecl</span><span class="op" id="6650361">)</span><span class="op" id="6650362">.</span><span class="ident" id="6650363">Body</span><span class="op" id="6650367">.</span><span class="ident" id="6650368">List</span><span class="op" id="6650372">)</span>&nbsp;<span class="comment" id="6650374">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650401">if</span>&nbsp;<span class="ident" id="6650404">err</span>&nbsp;<span class="op" id="6650408">!=</span>&nbsp;<span class="ident" id="6650411">nil</span>&nbsp;<span class="op" id="6650415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6650420">panic</span><span class="op" id="6650425">(</span><span class="ident" id="6650426">err</span><span class="op" id="6650429">)</span>&nbsp;<span class="comment" id="6650431">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650455">out</span>&nbsp;<span class="op" id="6650459">:=</span>&nbsp;<span class="ident" id="6650462">buf</span><span class="op" id="6650465">.</span><span class="ident" id="6650466">String</span><span class="op" id="6650472">(</span><span class="op" id="6650473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650477">if</span>&nbsp;<span class="ident" id="6650480">out</span>&nbsp;<span class="op" id="6650484">!=</span>&nbsp;<span class="ident" id="6650487">src</span>&nbsp;<span class="op" id="6650491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650496">t</span><span class="op" id="6650497">.</span><span class="ident" id="6650498">Errorf</span><span class="op" id="6650504">(</span><span class="string" id="6650505">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6650529">,</span>&nbsp;<span class="ident" id="6650531">out</span><span class="op" id="6650534">,</span>&nbsp;<span class="ident" id="6650536">src</span><span class="op" id="6650539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650546">}</span><br>
<span class="lineno">480</span><span class="op" id="6650548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6650551">func</span>&nbsp;<span class="ident" id="6650556">TestBaseIndent</span><span class="op" id="6650570">(</span><span class="ident" id="6650571">t</span>&nbsp;<span class="op" id="6650573">*</span><span class="ident" id="6650574">testing</span><span class="op" id="6650581">.</span><span class="ident" id="6650582">T</span><span class="op" id="6650583">)</span>&nbsp;<span class="op" id="6650585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6650588">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6650657">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6650726">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650746">const</span>&nbsp;<span class="ident" id="6650752">filename</span>&nbsp;<span class="op" id="6650761">=</span>&nbsp;<span class="string" id="6650763">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650777">src</span><span class="op" id="6650780">,</span>&nbsp;<span class="ident" id="6650782">err</span>&nbsp;<span class="op" id="6650786">:=</span>&nbsp;<span class="ident" id="6650789">ioutil</span><span class="op" id="6650795">.</span><span class="ident" id="6650796">ReadFile</span><span class="op" id="6650804">(</span><span class="ident" id="6650805">filename</span><span class="op" id="6650813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650816">if</span>&nbsp;<span class="ident" id="6650819">err</span>&nbsp;<span class="op" id="6650823">!=</span>&nbsp;<span class="ident" id="6650826">nil</span>&nbsp;<span class="op" id="6650830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6650834">panic</span><span class="op" id="6650839">(</span><span class="ident" id="6650840">err</span><span class="op" id="6650843">)</span>&nbsp;<span class="comment" id="6650845">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6650867">file</span><span class="op" id="6650871">,</span>&nbsp;<span class="ident" id="6650873">err</span>&nbsp;<span class="op" id="6650877">:=</span>&nbsp;<span class="ident" id="6650880">parser</span><span class="op" id="6650886">.</span><span class="ident" id="6650887">ParseFile</span><span class="op" id="6650896">(</span><span class="ident" id="6650897">fset</span><span class="op" id="6650901">,</span>&nbsp;<span class="ident" id="6650903">filename</span><span class="op" id="6650911">,</span>&nbsp;<span class="ident" id="6650913">src</span><span class="op" id="6650916">,</span>&nbsp;<span class="num" id="6650918">0</span><span class="op" id="6650919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650922">if</span>&nbsp;<span class="ident" id="6650925">err</span>&nbsp;<span class="op" id="6650929">!=</span>&nbsp;<span class="ident" id="6650932">nil</span>&nbsp;<span class="op" id="6650936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6650940">panic</span><span class="op" id="6650945">(</span><span class="ident" id="6650946">err</span><span class="op" id="6650949">)</span>&nbsp;<span class="comment" id="6650951">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6650969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650973">var</span>&nbsp;<span class="ident" id="6650977">buf</span>&nbsp;<span class="ident" id="6650981">bytes</span><span class="op" id="6650986">.</span><span class="ident" id="6650987">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6650995">for</span>&nbsp;<span class="ident" id="6650999">indent</span>&nbsp;<span class="op" id="6651006">:=</span>&nbsp;<span class="num" id="6651009">0</span><span class="op" id="6651010">;</span>&nbsp;<span class="ident" id="6651012">indent</span>&nbsp;<span class="op" id="6651019">&lt;</span>&nbsp;<span class="num" id="6651021">4</span><span class="op" id="6651022">;</span>&nbsp;<span class="ident" id="6651024">indent</span><span class="op" id="6651030">++</span>&nbsp;<span class="op" id="6651033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651037">buf</span><span class="op" id="6651040">.</span><span class="ident" id="6651041">Reset</span><span class="op" id="6651046">(</span><span class="op" id="6651047">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651051">(</span><span class="op" id="6651052">&amp;</span><span class="ident" id="6651053">Config</span><span class="op" id="6651059">{</span><span class="ident" id="6651060">Tabwidth</span><span class="op" id="6651068">:</span>&nbsp;<span class="ident" id="6651070">tabwidth</span><span class="op" id="6651078">,</span>&nbsp;<span class="ident" id="6651080">Indent</span><span class="op" id="6651086">:</span>&nbsp;<span class="ident" id="6651088">indent</span><span class="op" id="6651094">}</span><span class="op" id="6651095">)</span><span class="op" id="6651096">.</span><span class="ident" id="6651097">Fprint</span><span class="op" id="6651103">(</span><span class="op" id="6651104">&amp;</span><span class="ident" id="6651105">buf</span><span class="op" id="6651108">,</span>&nbsp;<span class="ident" id="6651110">fset</span><span class="op" id="6651114">,</span>&nbsp;<span class="ident" id="6651116">file</span><span class="op" id="6651120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6651124">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651181">lines</span>&nbsp;<span class="op" id="6651187">:=</span>&nbsp;<span class="ident" id="6651190">bytes</span><span class="op" id="6651195">.</span><span class="ident" id="6651196">Split</span><span class="op" id="6651201">(</span><span class="ident" id="6651202">buf</span><span class="op" id="6651205">.</span><span class="ident" id="6651206">Bytes</span><span class="op" id="6651211">(</span><span class="op" id="6651212">)</span><span class="op" id="6651213">,</span>&nbsp;<span class="op" id="6651215">[</span><span class="op" id="6651216">]</span><span class="builtintype" id="6651217">byte</span><span class="op" id="6651221">{</span><span class="string" id="6651222">&#39;\n&#39;</span><span class="op" id="6651226">}</span><span class="op" id="6651227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651231">for</span>&nbsp;<span class="ident" id="6651235">i</span><span class="op" id="6651236">,</span>&nbsp;<span class="ident" id="6651238">line</span>&nbsp;<span class="op" id="6651243">:=</span>&nbsp;<span class="keyword" id="6651246">range</span>&nbsp;<span class="ident" id="6651252">lines</span>&nbsp;<span class="op" id="6651258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651263">if</span>&nbsp;<span class="builtinfunc" id="6651266">len</span><span class="op" id="6651269">(</span><span class="ident" id="6651270">line</span><span class="op" id="6651274">)</span>&nbsp;<span class="op" id="6651276">==</span>&nbsp;<span class="num" id="6651279">0</span>&nbsp;<span class="op" id="6651281">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651287">continue</span>&nbsp;<span class="comment" id="6651296">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651342">n</span>&nbsp;<span class="op" id="6651344">:=</span>&nbsp;<span class="num" id="6651347">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651352">for</span>&nbsp;<span class="ident" id="6651356">j</span><span class="op" id="6651357">,</span>&nbsp;<span class="ident" id="6651359">b</span>&nbsp;<span class="op" id="6651361">:=</span>&nbsp;<span class="keyword" id="6651364">range</span>&nbsp;<span class="ident" id="6651370">line</span>&nbsp;<span class="op" id="6651375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651381">if</span>&nbsp;<span class="ident" id="6651384">b</span>&nbsp;<span class="op" id="6651386">!=</span>&nbsp;<span class="string" id="6651389">&#39;\t&#39;</span>&nbsp;<span class="op" id="6651394">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6651401">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651428">n</span>&nbsp;<span class="op" id="6651430">=</span>&nbsp;<span class="ident" id="6651432">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651439">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651454">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651459">if</span>&nbsp;<span class="ident" id="6651462">n</span>&nbsp;<span class="op" id="6651464">&lt;</span>&nbsp;<span class="ident" id="6651466">indent</span>&nbsp;<span class="op" id="6651473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651479">t</span><span class="op" id="6651480">.</span><span class="ident" id="6651481">Errorf</span><span class="op" id="6651487">(</span><span class="string" id="6651488">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="6651537">,</span>&nbsp;<span class="ident" id="6651539">i</span><span class="op" id="6651540">,</span>&nbsp;<span class="ident" id="6651542">n</span><span class="op" id="6651543">,</span>&nbsp;<span class="ident" id="6651545">indent</span><span class="op" id="6651551">,</span>&nbsp;<span class="ident" id="6651553">line</span><span class="op" id="6651557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651569">}</span><br>
<span class="lineno">520</span><span class="op" id="6651571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6651574">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6651641">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="6651713">func</span>&nbsp;<span class="ident" id="6651718">TestFuncType</span><span class="op" id="6651730">(</span><span class="ident" id="6651731">t</span>&nbsp;<span class="op" id="6651733">*</span><span class="ident" id="6651734">testing</span><span class="op" id="6651741">.</span><span class="ident" id="6651742">T</span><span class="op" id="6651743">)</span>&nbsp;<span class="op" id="6651745">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651748">src</span>&nbsp;<span class="op" id="6651752">:=</span>&nbsp;<span class="op" id="6651755">&amp;</span><span class="ident" id="6651756">ast</span><span class="op" id="6651759">.</span><span class="ident" id="6651760">File</span><span class="op" id="6651764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651768">Name</span><span class="op" id="6651772">:</span>&nbsp;<span class="op" id="6651774">&amp;</span><span class="ident" id="6651775">ast</span><span class="op" id="6651778">.</span><span class="ident" id="6651779">Ident</span><span class="op" id="6651784">{</span><span class="ident" id="6651785">Name</span><span class="op" id="6651789">:</span>&nbsp;<span class="string" id="6651791">&#34;p&#34;</span><span class="op" id="6651794">}</span><span class="op" id="6651795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651799">Decls</span><span class="op" id="6651804">:</span>&nbsp;<span class="op" id="6651806">[</span><span class="op" id="6651807">]</span><span class="ident" id="6651808">ast</span><span class="op" id="6651811">.</span><span class="ident" id="6651812">Decl</span><span class="op" id="6651816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651821">&amp;</span><span class="ident" id="6651822">ast</span><span class="op" id="6651825">.</span><span class="ident" id="6651826">FuncDecl</span><span class="op" id="6651834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651840">Name</span><span class="op" id="6651844">:</span>&nbsp;<span class="op" id="6651846">&amp;</span><span class="ident" id="6651847">ast</span><span class="op" id="6651850">.</span><span class="ident" id="6651851">Ident</span><span class="op" id="6651856">{</span><span class="ident" id="6651857">Name</span><span class="op" id="6651861">:</span>&nbsp;<span class="string" id="6651863">&#34;f&#34;</span><span class="op" id="6651866">}</span><span class="op" id="6651867">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651873">Type</span><span class="op" id="6651877">:</span>&nbsp;<span class="op" id="6651879">&amp;</span><span class="ident" id="6651880">ast</span><span class="op" id="6651883">.</span><span class="ident" id="6651884">FuncType</span><span class="op" id="6651892">{</span><span class="op" id="6651893">}</span><span class="op" id="6651894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651899">}</span><span class="op" id="6651900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651904">}</span><span class="op" id="6651905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651912">var</span>&nbsp;<span class="ident" id="6651916">buf</span>&nbsp;<span class="ident" id="6651920">bytes</span><span class="op" id="6651925">.</span><span class="ident" id="6651926">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6651934">if</span>&nbsp;<span class="ident" id="6651937">err</span>&nbsp;<span class="op" id="6651941">:=</span>&nbsp;<span class="ident" id="6651944">Fprint</span><span class="op" id="6651950">(</span><span class="op" id="6651951">&amp;</span><span class="ident" id="6651952">buf</span><span class="op" id="6651955">,</span>&nbsp;<span class="ident" id="6651957">fset</span><span class="op" id="6651961">,</span>&nbsp;<span class="ident" id="6651963">src</span><span class="op" id="6651966">)</span><span class="op" id="6651967">;</span>&nbsp;<span class="ident" id="6651969">err</span>&nbsp;<span class="op" id="6651973">!=</span>&nbsp;<span class="ident" id="6651976">nil</span>&nbsp;<span class="op" id="6651980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6651984">t</span><span class="op" id="6651985">.</span><span class="ident" id="6651986">Fatal</span><span class="op" id="6651991">(</span><span class="ident" id="6651992">err</span><span class="op" id="6651995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6651998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652001">got</span>&nbsp;<span class="op" id="6652005">:=</span>&nbsp;<span class="ident" id="6652008">buf</span><span class="op" id="6652011">.</span><span class="ident" id="6652012">String</span><span class="op" id="6652018">(</span><span class="op" id="6652019">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652023">const</span>&nbsp;<span class="ident" id="6652029">want</span>&nbsp;<span class="op" id="6652034">=</span>&nbsp;<span class="string" id="6652036">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652061">if</span>&nbsp;<span class="ident" id="6652064">got</span>&nbsp;<span class="op" id="6652068">!=</span>&nbsp;<span class="ident" id="6652071">want</span>&nbsp;<span class="op" id="6652076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652080">t</span><span class="op" id="6652081">.</span><span class="ident" id="6652082">Fatalf</span><span class="op" id="6652088">(</span><span class="string" id="6652089">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="6652112">,</span>&nbsp;<span class="ident" id="6652114">got</span><span class="op" id="6652117">,</span>&nbsp;<span class="ident" id="6652119">want</span><span class="op" id="6652123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6652126">}</span><br>
<span class="lineno"></span><span class="op" id="6652128">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="6652131">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="6652210">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="6652228">func</span>&nbsp;<span class="ident" id="6652233">TestX</span><span class="op" id="6652238">(</span><span class="ident" id="6652239">t</span>&nbsp;<span class="op" id="6652241">*</span><span class="ident" id="6652242">testing</span><span class="op" id="6652249">.</span><span class="ident" id="6652250">T</span><span class="op" id="6652251">)</span>&nbsp;<span class="op" id="6652253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652256">const</span>&nbsp;<span class="ident" id="6652262">src</span>&nbsp;<span class="op" id="6652266">=</span>&nbsp;<span class="string" id="6652268">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652295">_</span><span class="op" id="6652296">,</span>&nbsp;<span class="ident" id="6652298">err</span>&nbsp;<span class="op" id="6652302">:=</span>&nbsp;<span class="ident" id="6652305">format</span><span class="op" id="6652311">(</span><span class="op" id="6652312">[</span><span class="op" id="6652313">]</span><span class="builtintype" id="6652314">byte</span><span class="op" id="6652318">(</span><span class="ident" id="6652319">src</span><span class="op" id="6652322">)</span><span class="op" id="6652323">,</span>&nbsp;<span class="num" id="6652325">0</span><span class="op" id="6652326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6652329">if</span>&nbsp;<span class="ident" id="6652332">err</span>&nbsp;<span class="op" id="6652336">!=</span>&nbsp;<span class="ident" id="6652339">nil</span>&nbsp;<span class="op" id="6652343">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6652347">t</span><span class="op" id="6652348">.</span><span class="ident" id="6652349">Error</span><span class="op" id="6652354">(</span><span class="ident" id="6652355">err</span><span class="op" id="6652358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6652361">}</span><br>
<span class="lineno"></span><span class="op" id="6652363">}</span>
</div>
</body>
</html>
