<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4702210">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4702265">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4702319">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4702370">package</span>&nbsp;<span class="ident" id="4702378">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4702388">import</span>&nbsp;<span class="op" id="4702395">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4702398">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4702405">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4702416">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="4702438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702441">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="4702502">type</span>&nbsp;<span class="ident" id="4702507">common</span>&nbsp;<span class="keyword" id="4702514">struct</span>&nbsp;<span class="op" id="4702521">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702524">tmpl</span>&nbsp;<span class="keyword" id="4702529">map</span><span class="op" id="4702532">[</span><span class="builtintype" id="4702533">string</span><span class="op" id="4702539">]</span><span class="op" id="4702540">*</span><span class="ident" id="4702541">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702551">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702611">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4702670">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702707">parseFuncs</span>&nbsp;<span class="ident" id="4702718">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702727">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="4702738">map</span><span class="op" id="4702741">[</span><span class="builtintype" id="4702742">string</span><span class="op" id="4702748">]</span><span class="ident" id="4702749">reflect</span><span class="op" id="4702756">.</span><span class="ident" id="4702757">Value</span><br>
<span class="lineno"></span><span class="op" id="4702763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4702766">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="4702838">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="4702911">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4702950">type</span>&nbsp;<span class="ident" id="4702955">Template</span>&nbsp;<span class="keyword" id="4702964">struct</span>&nbsp;<span class="op" id="4702971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4702974">name</span>&nbsp;<span class="builtintype" id="4702979">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4702987">*</span><span class="ident" id="4702988">parse</span><span class="op" id="4702993">.</span><span class="ident" id="4702994">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703000">*</span><span class="ident" id="4703001">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703009">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="4703020">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703028">rightDelim</span>&nbsp;<span class="builtintype" id="4703039">string</span><br>
<span class="lineno"></span><span class="op" id="4703046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703049">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="4703102">func</span>&nbsp;<span class="ident" id="4703107">New</span><span class="op" id="4703110">(</span><span class="ident" id="4703111">name</span>&nbsp;<span class="builtintype" id="4703116">string</span><span class="op" id="4703122">)</span>&nbsp;<span class="op" id="4703124">*</span><span class="ident" id="4703125">Template</span>&nbsp;<span class="op" id="4703134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703137">return</span>&nbsp;<span class="op" id="4703144">&amp;</span><span class="ident" id="4703145">Template</span><span class="op" id="4703153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703157">name</span><span class="op" id="4703161">:</span>&nbsp;<span class="ident" id="4703163">name</span><span class="op" id="4703167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703170">}</span><br>
<span class="lineno"></span><span class="op" id="4703172">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4703175">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="4703217">func</span>&nbsp;<span class="op" id="4703222">(</span><span class="ident" id="4703223">t</span>&nbsp;<span class="op" id="4703225">*</span><span class="ident" id="4703226">Template</span><span class="op" id="4703234">)</span>&nbsp;<span class="ident" id="4703236">Name</span><span class="op" id="4703240">(</span><span class="op" id="4703241">)</span>&nbsp;<span class="builtintype" id="4703243">string</span>&nbsp;<span class="op" id="4703250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703253">return</span>&nbsp;<span class="ident" id="4703260">t</span><span class="op" id="4703261">.</span><span class="ident" id="4703262">name</span><br>
<span class="lineno"></span><span class="op" id="4703267">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4703270">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4703350">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4703426">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="4703472">func</span>&nbsp;<span class="op" id="4703477">(</span><span class="ident" id="4703478">t</span>&nbsp;<span class="op" id="4703480">*</span><span class="ident" id="4703481">Template</span><span class="op" id="4703489">)</span>&nbsp;<span class="ident" id="4703491">New</span><span class="op" id="4703494">(</span><span class="ident" id="4703495">name</span>&nbsp;<span class="builtintype" id="4703500">string</span><span class="op" id="4703506">)</span>&nbsp;<span class="op" id="4703508">*</span><span class="ident" id="4703509">Template</span>&nbsp;<span class="op" id="4703518">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703521">t</span><span class="op" id="4703522">.</span><span class="ident" id="4703523">init</span><span class="op" id="4703527">(</span><span class="op" id="4703528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703531">return</span>&nbsp;<span class="op" id="4703538">&amp;</span><span class="ident" id="4703539">Template</span><span class="op" id="4703547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703551">name</span><span class="op" id="4703555">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4703563">name</span><span class="op" id="4703567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703571">common</span><span class="op" id="4703577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4703583">t</span><span class="op" id="4703584">.</span><span class="ident" id="4703585">common</span><span class="op" id="4703591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703595">leftDelim</span><span class="op" id="4703604">:</span>&nbsp;&nbsp;<span class="ident" id="4703607">t</span><span class="op" id="4703608">.</span><span class="ident" id="4703609">leftDelim</span><span class="op" id="4703618">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703622">rightDelim</span><span class="op" id="4703632">:</span>&nbsp;<span class="ident" id="4703634">t</span><span class="op" id="4703635">.</span><span class="ident" id="4703636">rightDelim</span><span class="op" id="4703646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703649">}</span><br>
<span class="lineno"></span><span class="op" id="4703651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4703654">func</span>&nbsp;<span class="op" id="4703659">(</span><span class="ident" id="4703660">t</span>&nbsp;<span class="op" id="4703662">*</span><span class="ident" id="4703663">Template</span><span class="op" id="4703671">)</span>&nbsp;<span class="ident" id="4703673">init</span><span class="op" id="4703677">(</span><span class="op" id="4703678">)</span>&nbsp;<span class="op" id="4703680">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4703683">if</span>&nbsp;<span class="ident" id="4703686">t</span><span class="op" id="4703687">.</span><span class="ident" id="4703688">common</span>&nbsp;<span class="op" id="4703695">==</span>&nbsp;<span class="ident" id="4703698">nil</span>&nbsp;<span class="op" id="4703702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703706">t</span><span class="op" id="4703707">.</span><span class="ident" id="4703708">common</span>&nbsp;<span class="op" id="4703715">=</span>&nbsp;<span class="builtinfunc" id="4703717">new</span><span class="op" id="4703720">(</span><span class="ident" id="4703721">common</span><span class="op" id="4703727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703731">t</span><span class="op" id="4703732">.</span><span class="ident" id="4703733">tmpl</span>&nbsp;<span class="op" id="4703738">=</span>&nbsp;<span class="builtinfunc" id="4703740">make</span><span class="op" id="4703744">(</span><span class="keyword" id="4703745">map</span><span class="op" id="4703748">[</span><span class="builtintype" id="4703749">string</span><span class="op" id="4703755">]</span><span class="op" id="4703756">*</span><span class="ident" id="4703757">Template</span><span class="op" id="4703765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703769">t</span><span class="op" id="4703770">.</span><span class="ident" id="4703771">parseFuncs</span>&nbsp;<span class="op" id="4703782">=</span>&nbsp;<span class="builtinfunc" id="4703784">make</span><span class="op" id="4703788">(</span><span class="ident" id="4703789">FuncMap</span><span class="op" id="4703796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4703800">t</span><span class="op" id="4703801">.</span><span class="ident" id="4703802">execFuncs</span>&nbsp;<span class="op" id="4703812">=</span>&nbsp;<span class="builtinfunc" id="4703814">make</span><span class="op" id="4703818">(</span><span class="keyword" id="4703819">map</span><span class="op" id="4703822">[</span><span class="builtintype" id="4703823">string</span><span class="op" id="4703829">]</span><span class="ident" id="4703830">reflect</span><span class="op" id="4703837">.</span><span class="ident" id="4703838">Value</span><span class="op" id="4703843">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4703846">}</span><br>
<span class="lineno"></span><span class="op" id="4703848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4703851">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4703922">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="4703999">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="4704074">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="4704153">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="4704231">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="4704282">func</span>&nbsp;<span class="op" id="4704287">(</span><span class="ident" id="4704288">t</span>&nbsp;<span class="op" id="4704290">*</span><span class="ident" id="4704291">Template</span><span class="op" id="4704299">)</span>&nbsp;<span class="ident" id="4704301">Clone</span><span class="op" id="4704306">(</span><span class="op" id="4704307">)</span>&nbsp;<span class="op" id="4704309">(</span><span class="op" id="4704310">*</span><span class="ident" id="4704311">Template</span><span class="op" id="4704319">,</span>&nbsp;<span class="builtintype" id="4704321">error</span><span class="op" id="4704326">)</span>&nbsp;<span class="op" id="4704328">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704331">nt</span>&nbsp;<span class="op" id="4704334">:=</span>&nbsp;<span class="ident" id="4704337">t</span><span class="op" id="4704338">.</span><span class="builtinfunc" id="4704339">copy</span><span class="op" id="4704343">(</span><span class="ident" id="4704344">nil</span><span class="op" id="4704347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704350">nt</span><span class="op" id="4704352">.</span><span class="ident" id="4704353">init</span><span class="op" id="4704357">(</span><span class="op" id="4704358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704361">nt</span><span class="op" id="4704363">.</span><span class="ident" id="4704364">tmpl</span><span class="op" id="4704368">[</span><span class="ident" id="4704369">t</span><span class="op" id="4704370">.</span><span class="ident" id="4704371">name</span><span class="op" id="4704375">]</span>&nbsp;<span class="op" id="4704377">=</span>&nbsp;<span class="ident" id="4704379">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704383">for</span>&nbsp;<span class="ident" id="4704387">k</span><span class="op" id="4704388">,</span>&nbsp;<span class="ident" id="4704390">v</span>&nbsp;<span class="op" id="4704392">:=</span>&nbsp;<span class="keyword" id="4704395">range</span>&nbsp;<span class="ident" id="4704401">t</span><span class="op" id="4704402">.</span><span class="ident" id="4704403">tmpl</span>&nbsp;<span class="op" id="4704408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704412">if</span>&nbsp;<span class="ident" id="4704415">k</span>&nbsp;<span class="op" id="4704417">==</span>&nbsp;<span class="ident" id="4704420">t</span><span class="op" id="4704421">.</span><span class="ident" id="4704422">name</span>&nbsp;<span class="op" id="4704427">{</span>&nbsp;<span class="comment" id="4704429">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704454">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4704469">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704528">tmpl</span>&nbsp;<span class="op" id="4704533">:=</span>&nbsp;<span class="ident" id="4704536">v</span><span class="op" id="4704537">.</span><span class="builtinfunc" id="4704538">copy</span><span class="op" id="4704542">(</span><span class="ident" id="4704543">nt</span><span class="op" id="4704545">.</span><span class="ident" id="4704546">common</span><span class="op" id="4704552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704556">nt</span><span class="op" id="4704558">.</span><span class="ident" id="4704559">tmpl</span><span class="op" id="4704563">[</span><span class="ident" id="4704564">k</span><span class="op" id="4704565">]</span>&nbsp;<span class="op" id="4704567">=</span>&nbsp;<span class="ident" id="4704569">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704578">for</span>&nbsp;<span class="ident" id="4704582">k</span><span class="op" id="4704583">,</span>&nbsp;<span class="ident" id="4704585">v</span>&nbsp;<span class="op" id="4704587">:=</span>&nbsp;<span class="keyword" id="4704590">range</span>&nbsp;<span class="ident" id="4704596">t</span><span class="op" id="4704597">.</span><span class="ident" id="4704598">parseFuncs</span>&nbsp;<span class="op" id="4704609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704613">nt</span><span class="op" id="4704615">.</span><span class="ident" id="4704616">parseFuncs</span><span class="op" id="4704626">[</span><span class="ident" id="4704627">k</span><span class="op" id="4704628">]</span>&nbsp;<span class="op" id="4704630">=</span>&nbsp;<span class="ident" id="4704632">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704638">for</span>&nbsp;<span class="ident" id="4704642">k</span><span class="op" id="4704643">,</span>&nbsp;<span class="ident" id="4704645">v</span>&nbsp;<span class="op" id="4704647">:=</span>&nbsp;<span class="keyword" id="4704650">range</span>&nbsp;<span class="ident" id="4704656">t</span><span class="op" id="4704657">.</span><span class="ident" id="4704658">execFuncs</span>&nbsp;<span class="op" id="4704668">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704672">nt</span><span class="op" id="4704674">.</span><span class="ident" id="4704675">execFuncs</span><span class="op" id="4704684">[</span><span class="ident" id="4704685">k</span><span class="op" id="4704686">]</span>&nbsp;<span class="op" id="4704688">=</span>&nbsp;<span class="ident" id="4704690">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4704693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704696">return</span>&nbsp;<span class="ident" id="4704703">nt</span><span class="op" id="4704705">,</span>&nbsp;<span class="ident" id="4704707">nil</span><br>
<span class="lineno"></span><span class="op" id="4704711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4704714">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4704784">func</span>&nbsp;<span class="op" id="4704789">(</span><span class="ident" id="4704790">t</span>&nbsp;<span class="op" id="4704792">*</span><span class="ident" id="4704793">Template</span><span class="op" id="4704801">)</span>&nbsp;<span class="builtinfunc" id="4704803">copy</span><span class="op" id="4704807">(</span><span class="ident" id="4704808">c</span>&nbsp;<span class="op" id="4704810">*</span><span class="ident" id="4704811">common</span><span class="op" id="4704817">)</span>&nbsp;<span class="op" id="4704819">*</span><span class="ident" id="4704820">Template</span>&nbsp;<span class="op" id="4704829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704832">nt</span>&nbsp;<span class="op" id="4704835">:=</span>&nbsp;<span class="ident" id="4704838">New</span><span class="op" id="4704841">(</span><span class="ident" id="4704842">t</span><span class="op" id="4704843">.</span><span class="ident" id="4704844">name</span><span class="op" id="4704848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704851">nt</span><span class="op" id="4704853">.</span><span class="ident" id="4704854">Tree</span>&nbsp;<span class="op" id="4704859">=</span>&nbsp;<span class="ident" id="4704861">t</span><span class="op" id="4704862">.</span><span class="ident" id="4704863">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704869">nt</span><span class="op" id="4704871">.</span><span class="ident" id="4704872">common</span>&nbsp;<span class="op" id="4704879">=</span>&nbsp;<span class="ident" id="4704881">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704884">nt</span><span class="op" id="4704886">.</span><span class="ident" id="4704887">leftDelim</span>&nbsp;<span class="op" id="4704897">=</span>&nbsp;<span class="ident" id="4704899">t</span><span class="op" id="4704900">.</span><span class="ident" id="4704901">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4704912">nt</span><span class="op" id="4704914">.</span><span class="ident" id="4704915">rightDelim</span>&nbsp;<span class="op" id="4704926">=</span>&nbsp;<span class="ident" id="4704928">t</span><span class="op" id="4704929">.</span><span class="ident" id="4704930">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4704942">return</span>&nbsp;<span class="ident" id="4704949">nt</span><br>
<span class="lineno"></span><span class="op" id="4704952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4704955">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="4705023">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="4705052">func</span>&nbsp;<span class="op" id="4705057">(</span><span class="ident" id="4705058">t</span>&nbsp;<span class="op" id="4705060">*</span><span class="ident" id="4705061">Template</span><span class="op" id="4705069">)</span>&nbsp;<span class="ident" id="4705071">AddParseTree</span><span class="op" id="4705083">(</span><span class="ident" id="4705084">name</span>&nbsp;<span class="builtintype" id="4705089">string</span><span class="op" id="4705095">,</span>&nbsp;<span class="ident" id="4705097">tree</span>&nbsp;<span class="op" id="4705102">*</span><span class="ident" id="4705103">parse</span><span class="op" id="4705108">.</span><span class="ident" id="4705109">Tree</span><span class="op" id="4705113">)</span>&nbsp;<span class="op" id="4705115">(</span><span class="op" id="4705116">*</span><span class="ident" id="4705117">Template</span><span class="op" id="4705125">,</span>&nbsp;<span class="builtintype" id="4705127">error</span><span class="op" id="4705132">)</span>&nbsp;<span class="op" id="4705134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705137">if</span>&nbsp;<span class="ident" id="4705140">t</span><span class="op" id="4705141">.</span><span class="ident" id="4705142">common</span>&nbsp;<span class="op" id="4705149">!=</span>&nbsp;<span class="ident" id="4705152">nil</span>&nbsp;<span class="op" id="4705156">&amp;&amp;</span>&nbsp;<span class="ident" id="4705159">t</span><span class="op" id="4705160">.</span><span class="ident" id="4705161">tmpl</span><span class="op" id="4705165">[</span><span class="ident" id="4705166">name</span><span class="op" id="4705170">]</span>&nbsp;<span class="op" id="4705172">!=</span>&nbsp;<span class="ident" id="4705175">nil</span>&nbsp;<span class="op" id="4705179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705183">return</span>&nbsp;<span class="ident" id="4705190">nil</span><span class="op" id="4705193">,</span>&nbsp;<span class="ident" id="4705195">fmt</span><span class="op" id="4705198">.</span><span class="ident" id="4705199">Errorf</span><span class="op" id="4705205">(</span><span class="string" id="4705206">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4705245">,</span>&nbsp;<span class="ident" id="4705247">name</span><span class="op" id="4705251">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705257">nt</span>&nbsp;<span class="op" id="4705260">:=</span>&nbsp;<span class="ident" id="4705263">t</span><span class="op" id="4705264">.</span><span class="ident" id="4705265">New</span><span class="op" id="4705268">(</span><span class="ident" id="4705269">name</span><span class="op" id="4705273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705276">nt</span><span class="op" id="4705278">.</span><span class="ident" id="4705279">Tree</span>&nbsp;<span class="op" id="4705284">=</span>&nbsp;<span class="ident" id="4705286">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705292">t</span><span class="op" id="4705293">.</span><span class="ident" id="4705294">tmpl</span><span class="op" id="4705298">[</span><span class="ident" id="4705299">name</span><span class="op" id="4705303">]</span>&nbsp;<span class="op" id="4705305">=</span>&nbsp;<span class="ident" id="4705307">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705311">return</span>&nbsp;<span class="ident" id="4705318">nt</span><span class="op" id="4705320">,</span>&nbsp;<span class="ident" id="4705322">nil</span><br>
<span class="lineno">115</span><span class="op" id="4705326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4705329">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="4705406">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4705417">func</span>&nbsp;<span class="op" id="4705422">(</span><span class="ident" id="4705423">t</span>&nbsp;<span class="op" id="4705425">*</span><span class="ident" id="4705426">Template</span><span class="op" id="4705434">)</span>&nbsp;<span class="ident" id="4705436">Templates</span><span class="op" id="4705445">(</span><span class="op" id="4705446">)</span>&nbsp;<span class="op" id="4705448">[</span><span class="op" id="4705449">]</span><span class="op" id="4705450">*</span><span class="ident" id="4705451">Template</span>&nbsp;<span class="op" id="4705460">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705463">if</span>&nbsp;<span class="ident" id="4705466">t</span><span class="op" id="4705467">.</span><span class="ident" id="4705468">common</span>&nbsp;<span class="op" id="4705475">==</span>&nbsp;<span class="ident" id="4705478">nil</span>&nbsp;<span class="op" id="4705482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705486">return</span>&nbsp;<span class="ident" id="4705493">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4705501">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705548">m</span>&nbsp;<span class="op" id="4705550">:=</span>&nbsp;<span class="builtinfunc" id="4705553">make</span><span class="op" id="4705557">(</span><span class="op" id="4705558">[</span><span class="op" id="4705559">]</span><span class="op" id="4705560">*</span><span class="ident" id="4705561">Template</span><span class="op" id="4705569">,</span>&nbsp;<span class="num" id="4705571">0</span><span class="op" id="4705572">,</span>&nbsp;<span class="builtinfunc" id="4705574">len</span><span class="op" id="4705577">(</span><span class="ident" id="4705578">t</span><span class="op" id="4705579">.</span><span class="ident" id="4705580">tmpl</span><span class="op" id="4705584">)</span><span class="op" id="4705585">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705588">for</span>&nbsp;<span class="ident" id="4705592">_</span><span class="op" id="4705593">,</span>&nbsp;<span class="ident" id="4705595">v</span>&nbsp;<span class="op" id="4705597">:=</span>&nbsp;<span class="keyword" id="4705600">range</span>&nbsp;<span class="ident" id="4705606">t</span><span class="op" id="4705607">.</span><span class="ident" id="4705608">tmpl</span>&nbsp;<span class="op" id="4705613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4705617">m</span>&nbsp;<span class="op" id="4705619">=</span>&nbsp;<span class="builtinfunc" id="4705621">append</span><span class="op" id="4705627">(</span><span class="ident" id="4705628">m</span><span class="op" id="4705629">,</span>&nbsp;<span class="ident" id="4705631">v</span><span class="op" id="4705632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4705635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4705638">return</span>&nbsp;<span class="ident" id="4705645">m</span><br>
<span class="lineno"></span><span class="op" id="4705647">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4705650">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4705727">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4705799">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4705875">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="4705911">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4705973">func</span>&nbsp;<span class="op" id="4705978">(</span><span class="ident" id="4705979">t</span>&nbsp;<span class="op" id="4705981">*</span><span class="ident" id="4705982">Template</span><span class="op" id="4705990">)</span>&nbsp;<span class="ident" id="4705992">Delims</span><span class="op" id="4705998">(</span><span class="ident" id="4705999">left</span><span class="op" id="4706003">,</span>&nbsp;<span class="ident" id="4706005">right</span>&nbsp;<span class="builtintype" id="4706011">string</span><span class="op" id="4706017">)</span>&nbsp;<span class="op" id="4706019">*</span><span class="ident" id="4706020">Template</span>&nbsp;<span class="op" id="4706029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706032">t</span><span class="op" id="4706033">.</span><span class="ident" id="4706034">leftDelim</span>&nbsp;<span class="op" id="4706044">=</span>&nbsp;<span class="ident" id="4706046">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706052">t</span><span class="op" id="4706053">.</span><span class="ident" id="4706054">rightDelim</span>&nbsp;<span class="op" id="4706065">=</span>&nbsp;<span class="ident" id="4706067">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706074">return</span>&nbsp;<span class="ident" id="4706081">t</span><br>
<span class="lineno">140</span><span class="op" id="4706083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4706086">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4706165">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4706242">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="4706317">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4706368">func</span>&nbsp;<span class="op" id="4706373">(</span><span class="ident" id="4706374">t</span>&nbsp;<span class="op" id="4706376">*</span><span class="ident" id="4706377">Template</span><span class="op" id="4706385">)</span>&nbsp;<span class="ident" id="4706387">Funcs</span><span class="op" id="4706392">(</span><span class="ident" id="4706393">funcMap</span>&nbsp;<span class="ident" id="4706401">FuncMap</span><span class="op" id="4706408">)</span>&nbsp;<span class="op" id="4706410">*</span><span class="ident" id="4706411">Template</span>&nbsp;<span class="op" id="4706420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706423">t</span><span class="op" id="4706424">.</span><span class="ident" id="4706425">init</span><span class="op" id="4706429">(</span><span class="op" id="4706430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706433">addValueFuncs</span><span class="op" id="4706446">(</span><span class="ident" id="4706447">t</span><span class="op" id="4706448">.</span><span class="ident" id="4706449">execFuncs</span><span class="op" id="4706458">,</span>&nbsp;<span class="ident" id="4706460">funcMap</span><span class="op" id="4706467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4706470">addFuncs</span><span class="op" id="4706478">(</span><span class="ident" id="4706479">t</span><span class="op" id="4706480">.</span><span class="ident" id="4706481">parseFuncs</span><span class="op" id="4706491">,</span>&nbsp;<span class="ident" id="4706493">funcMap</span><span class="op" id="4706500">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706503">return</span>&nbsp;<span class="ident" id="4706510">t</span><br>
<span class="lineno"></span><span class="op" id="4706512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4706515">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="4706593">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="4706633">func</span>&nbsp;<span class="op" id="4706638">(</span><span class="ident" id="4706639">t</span>&nbsp;<span class="op" id="4706641">*</span><span class="ident" id="4706642">Template</span><span class="op" id="4706650">)</span>&nbsp;<span class="ident" id="4706652">Lookup</span><span class="op" id="4706658">(</span><span class="ident" id="4706659">name</span>&nbsp;<span class="builtintype" id="4706664">string</span><span class="op" id="4706670">)</span>&nbsp;<span class="op" id="4706672">*</span><span class="ident" id="4706673">Template</span>&nbsp;<span class="op" id="4706682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706685">if</span>&nbsp;<span class="ident" id="4706688">t</span><span class="op" id="4706689">.</span><span class="ident" id="4706690">common</span>&nbsp;<span class="op" id="4706697">==</span>&nbsp;<span class="ident" id="4706700">nil</span>&nbsp;<span class="op" id="4706704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706708">return</span>&nbsp;<span class="ident" id="4706715">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4706720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4706723">return</span>&nbsp;<span class="ident" id="4706730">t</span><span class="op" id="4706731">.</span><span class="ident" id="4706732">tmpl</span><span class="op" id="4706736">[</span><span class="ident" id="4706737">name</span><span class="op" id="4706741">]</span><br>
<span class="lineno">160</span><span class="op" id="4706743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4706746">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4706824">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="4706904">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="4706982">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4707055">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4707130">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4707208">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="4707283">func</span>&nbsp;<span class="op" id="4707288">(</span><span class="ident" id="4707289">t</span>&nbsp;<span class="op" id="4707291">*</span><span class="ident" id="4707292">Template</span><span class="op" id="4707300">)</span>&nbsp;<span class="ident" id="4707302">Parse</span><span class="op" id="4707307">(</span><span class="ident" id="4707308">text</span>&nbsp;<span class="builtintype" id="4707313">string</span><span class="op" id="4707319">)</span>&nbsp;<span class="op" id="4707321">(</span><span class="op" id="4707322">*</span><span class="ident" id="4707323">Template</span><span class="op" id="4707331">,</span>&nbsp;<span class="builtintype" id="4707333">error</span><span class="op" id="4707338">)</span>&nbsp;<span class="op" id="4707340">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707343">t</span><span class="op" id="4707344">.</span><span class="ident" id="4707345">init</span><span class="op" id="4707349">(</span><span class="op" id="4707350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707353">trees</span><span class="op" id="4707358">,</span>&nbsp;<span class="ident" id="4707360">err</span>&nbsp;<span class="op" id="4707364">:=</span>&nbsp;<span class="ident" id="4707367">parse</span><span class="op" id="4707372">.</span><span class="ident" id="4707373">Parse</span><span class="op" id="4707378">(</span><span class="ident" id="4707379">t</span><span class="op" id="4707380">.</span><span class="ident" id="4707381">name</span><span class="op" id="4707385">,</span>&nbsp;<span class="ident" id="4707387">text</span><span class="op" id="4707391">,</span>&nbsp;<span class="ident" id="4707393">t</span><span class="op" id="4707394">.</span><span class="ident" id="4707395">leftDelim</span><span class="op" id="4707404">,</span>&nbsp;<span class="ident" id="4707406">t</span><span class="op" id="4707407">.</span><span class="ident" id="4707408">rightDelim</span><span class="op" id="4707418">,</span>&nbsp;<span class="ident" id="4707420">t</span><span class="op" id="4707421">.</span><span class="ident" id="4707422">parseFuncs</span><span class="op" id="4707432">,</span>&nbsp;<span class="ident" id="4707434">builtins</span><span class="op" id="4707442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707445">if</span>&nbsp;<span class="ident" id="4707448">err</span>&nbsp;<span class="op" id="4707452">!=</span>&nbsp;<span class="ident" id="4707455">nil</span>&nbsp;<span class="op" id="4707459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707463">return</span>&nbsp;<span class="ident" id="4707470">nil</span><span class="op" id="4707473">,</span>&nbsp;<span class="ident" id="4707475">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707480">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707483">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707567">for</span>&nbsp;<span class="ident" id="4707571">name</span><span class="op" id="4707575">,</span>&nbsp;<span class="ident" id="4707577">tree</span>&nbsp;<span class="op" id="4707582">:=</span>&nbsp;<span class="keyword" id="4707585">range</span>&nbsp;<span class="ident" id="4707591">trees</span>&nbsp;<span class="op" id="4707597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707601">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707683">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707741">tmpl</span>&nbsp;<span class="op" id="4707746">:=</span>&nbsp;<span class="ident" id="4707749">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707753">if</span>&nbsp;<span class="ident" id="4707756">name</span>&nbsp;<span class="op" id="4707761">!=</span>&nbsp;<span class="ident" id="4707764">t</span><span class="op" id="4707765">.</span><span class="ident" id="4707766">name</span>&nbsp;<span class="op" id="4707771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707776">tmpl</span>&nbsp;<span class="op" id="4707781">=</span>&nbsp;<span class="ident" id="4707783">t</span><span class="op" id="4707784">.</span><span class="ident" id="4707785">New</span><span class="op" id="4707788">(</span><span class="ident" id="4707789">name</span><span class="op" id="4707793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4707801">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707871">if</span>&nbsp;<span class="ident" id="4707874">replace</span><span class="op" id="4707881">,</span>&nbsp;<span class="ident" id="4707883">err</span>&nbsp;<span class="op" id="4707887">:=</span>&nbsp;<span class="ident" id="4707890">t</span><span class="op" id="4707891">.</span><span class="ident" id="4707892">associate</span><span class="op" id="4707901">(</span><span class="ident" id="4707902">tmpl</span><span class="op" id="4707906">,</span>&nbsp;<span class="ident" id="4707908">tree</span><span class="op" id="4707912">)</span><span class="op" id="4707913">;</span>&nbsp;<span class="ident" id="4707915">err</span>&nbsp;<span class="op" id="4707919">!=</span>&nbsp;<span class="ident" id="4707922">nil</span>&nbsp;<span class="op" id="4707926">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4707931">return</span>&nbsp;<span class="ident" id="4707938">nil</span><span class="op" id="4707941">,</span>&nbsp;<span class="ident" id="4707943">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707949">}</span>&nbsp;<span class="keyword" id="4707951">else</span>&nbsp;<span class="keyword" id="4707956">if</span>&nbsp;<span class="ident" id="4707959">replace</span>&nbsp;<span class="op" id="4707967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707972">tmpl</span><span class="op" id="4707976">.</span><span class="ident" id="4707977">Tree</span>&nbsp;<span class="op" id="4707982">=</span>&nbsp;<span class="ident" id="4707984">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4707991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4707995">tmpl</span><span class="op" id="4707999">.</span><span class="ident" id="4708000">leftDelim</span>&nbsp;<span class="op" id="4708010">=</span>&nbsp;<span class="ident" id="4708012">t</span><span class="op" id="4708013">.</span><span class="ident" id="4708014">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708026">tmpl</span><span class="op" id="4708030">.</span><span class="ident" id="4708031">rightDelim</span>&nbsp;<span class="op" id="4708042">=</span>&nbsp;<span class="ident" id="4708044">t</span><span class="op" id="4708045">.</span><span class="ident" id="4708046">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708061">return</span>&nbsp;<span class="ident" id="4708068">t</span><span class="op" id="4708069">,</span>&nbsp;<span class="ident" id="4708071">nil</span><br>
<span class="lineno"></span><span class="op" id="4708075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="4708078">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4708156">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="4708227">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4708297">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="4708370">func</span>&nbsp;<span class="op" id="4708375">(</span><span class="ident" id="4708376">t</span>&nbsp;<span class="op" id="4708378">*</span><span class="ident" id="4708379">Template</span><span class="op" id="4708387">)</span>&nbsp;<span class="ident" id="4708389">associate</span><span class="op" id="4708398">(</span><span class="builtinfunc" id="4708399">new</span>&nbsp;<span class="op" id="4708403">*</span><span class="ident" id="4708404">Template</span><span class="op" id="4708412">,</span>&nbsp;<span class="ident" id="4708414">tree</span>&nbsp;<span class="op" id="4708419">*</span><span class="ident" id="4708420">parse</span><span class="op" id="4708425">.</span><span class="ident" id="4708426">Tree</span><span class="op" id="4708430">)</span>&nbsp;<span class="op" id="4708432">(</span><span class="builtintype" id="4708433">bool</span><span class="op" id="4708437">,</span>&nbsp;<span class="builtintype" id="4708439">error</span><span class="op" id="4708444">)</span>&nbsp;<span class="op" id="4708446">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708449">if</span>&nbsp;<span class="builtinfunc" id="4708452">new</span><span class="op" id="4708455">.</span><span class="ident" id="4708456">common</span>&nbsp;<span class="op" id="4708463">!=</span>&nbsp;<span class="ident" id="4708466">t</span><span class="op" id="4708467">.</span><span class="ident" id="4708468">common</span>&nbsp;<span class="op" id="4708475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4708479">panic</span><span class="op" id="4708484">(</span><span class="string" id="4708485">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="4708523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708529">name</span>&nbsp;<span class="op" id="4708534">:=</span>&nbsp;<span class="builtinfunc" id="4708537">new</span><span class="op" id="4708540">.</span><span class="ident" id="4708541">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708547">if</span>&nbsp;<span class="ident" id="4708550">old</span>&nbsp;<span class="op" id="4708554">:=</span>&nbsp;<span class="ident" id="4708557">t</span><span class="op" id="4708558">.</span><span class="ident" id="4708559">tmpl</span><span class="op" id="4708563">[</span><span class="ident" id="4708564">name</span><span class="op" id="4708568">]</span><span class="op" id="4708569">;</span>&nbsp;<span class="ident" id="4708571">old</span>&nbsp;<span class="op" id="4708575">!=</span>&nbsp;<span class="ident" id="4708578">nil</span>&nbsp;<span class="op" id="4708582">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708586">oldIsEmpty</span>&nbsp;<span class="op" id="4708597">:=</span>&nbsp;<span class="ident" id="4708600">parse</span><span class="op" id="4708605">.</span><span class="ident" id="4708606">IsEmptyTree</span><span class="op" id="4708617">(</span><span class="ident" id="4708618">old</span><span class="op" id="4708621">.</span><span class="ident" id="4708622">Root</span><span class="op" id="4708626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708630">newIsEmpty</span>&nbsp;<span class="op" id="4708641">:=</span>&nbsp;<span class="ident" id="4708644">parse</span><span class="op" id="4708649">.</span><span class="ident" id="4708650">IsEmptyTree</span><span class="op" id="4708661">(</span><span class="ident" id="4708662">tree</span><span class="op" id="4708666">.</span><span class="ident" id="4708667">Root</span><span class="op" id="4708671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708675">if</span>&nbsp;<span class="ident" id="4708678">newIsEmpty</span>&nbsp;<span class="op" id="4708689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4708694">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708769">return</span>&nbsp;<span class="ident" id="4708776">false</span><span class="op" id="4708781">,</span>&nbsp;<span class="ident" id="4708783">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708793">if</span>&nbsp;<span class="op" id="4708796">!</span><span class="ident" id="4708797">oldIsEmpty</span>&nbsp;<span class="op" id="4708808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708813">return</span>&nbsp;<span class="ident" id="4708820">false</span><span class="op" id="4708825">,</span>&nbsp;<span class="ident" id="4708827">fmt</span><span class="op" id="4708830">.</span><span class="ident" id="4708831">Errorf</span><span class="op" id="4708837">(</span><span class="string" id="4708838">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4708877">,</span>&nbsp;<span class="ident" id="4708879">name</span><span class="op" id="4708883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4708890">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4708893">t</span><span class="op" id="4708894">.</span><span class="ident" id="4708895">tmpl</span><span class="op" id="4708899">[</span><span class="ident" id="4708900">name</span><span class="op" id="4708904">]</span>&nbsp;<span class="op" id="4708906">=</span>&nbsp;<span class="builtinfunc" id="4708908">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4708913">return</span>&nbsp;<span class="ident" id="4708920">true</span><span class="op" id="4708924">,</span>&nbsp;<span class="ident" id="4708926">nil</span><br>
<span class="lineno"></span><span class="op" id="4708930">}</span>
</div>
</body>
</html>
