<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8479721">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8479777">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8479831">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8479882">package</span>&nbsp;<span class="ident" id="8479890">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8479901">import</span>&nbsp;<span class="op" id="8479908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8479911">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8479920">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8479929">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8479935">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8479946">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8479957">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8479967">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8479970">type</span>&nbsp;<span class="ident" id="8479975">canonicalHeaderKeyTest</span>&nbsp;<span class="keyword" id="8479998">struct</span>&nbsp;<span class="op" id="8480005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480008">in</span><span class="op" id="8480010">,</span>&nbsp;<span class="ident" id="8480012">out</span>&nbsp;<span class="builtintype" id="8480016">string</span><br>
<span class="lineno"></span><span class="op" id="8480023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8480026">var</span>&nbsp;<span class="ident" id="8480030">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8480054">=</span>&nbsp;<span class="op" id="8480056">[</span><span class="op" id="8480057">]</span><span class="ident" id="8480058">canonicalHeaderKeyTest</span><span class="op" id="8480080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480083">{</span><span class="string" id="8480084">&#34;a-b-c&#34;</span><span class="op" id="8480091">,</span>&nbsp;<span class="string" id="8480093">&#34;A-B-C&#34;</span><span class="op" id="8480100">}</span><span class="op" id="8480101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480104">{</span><span class="string" id="8480105">&#34;a-1-c&#34;</span><span class="op" id="8480112">,</span>&nbsp;<span class="string" id="8480114">&#34;A-1-C&#34;</span><span class="op" id="8480121">}</span><span class="op" id="8480122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480125">{</span><span class="string" id="8480126">&#34;User-Agent&#34;</span><span class="op" id="8480138">,</span>&nbsp;<span class="string" id="8480140">&#34;User-Agent&#34;</span><span class="op" id="8480152">}</span><span class="op" id="8480153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480156">{</span><span class="string" id="8480157">&#34;uSER-aGENT&#34;</span><span class="op" id="8480169">,</span>&nbsp;<span class="string" id="8480171">&#34;User-Agent&#34;</span><span class="op" id="8480183">}</span><span class="op" id="8480184">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480187">{</span><span class="string" id="8480188">&#34;user-agent&#34;</span><span class="op" id="8480200">,</span>&nbsp;<span class="string" id="8480202">&#34;User-Agent&#34;</span><span class="op" id="8480214">}</span><span class="op" id="8480215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480218">{</span><span class="string" id="8480219">&#34;USER-AGENT&#34;</span><span class="op" id="8480231">,</span>&nbsp;<span class="string" id="8480233">&#34;User-Agent&#34;</span><span class="op" id="8480245">}</span><span class="op" id="8480246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480249">{</span><span class="string" id="8480250">&#34;üser-agenT&#34;</span><span class="op" id="8480263">,</span>&nbsp;<span class="string" id="8480265">&#34;üser-Agent&#34;</span><span class="op" id="8480278">}</span><span class="op" id="8480279">,</span>&nbsp;<span class="comment" id="8480281">//&nbsp;non-ASCII&nbsp;unchanged</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8480306">//&nbsp;This&nbsp;caused&nbsp;a&nbsp;panic&nbsp;due&nbsp;to&nbsp;mishandling&nbsp;of&nbsp;a&nbsp;space:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480361">{</span><span class="string" id="8480362">&#34;C&nbsp;Ontent-Transfer-Encoding&#34;</span><span class="op" id="8480390">,</span>&nbsp;<span class="string" id="8480392">&#34;C-Ontent-Transfer-Encoding&#34;</span><span class="op" id="8480420">}</span><span class="op" id="8480421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480424">{</span><span class="string" id="8480425">&#34;foo&nbsp;bar&#34;</span><span class="op" id="8480434">,</span>&nbsp;<span class="string" id="8480436">&#34;Foo-Bar&#34;</span><span class="op" id="8480445">}</span><span class="op" id="8480446">,</span><br>
<span class="lineno"></span><span class="op" id="8480448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480451">func</span>&nbsp;<span class="ident" id="8480456">TestCanonicalMIMEHeaderKey</span><span class="op" id="8480482">(</span><span class="ident" id="8480483">t</span>&nbsp;<span class="op" id="8480485">*</span><span class="ident" id="8480486">testing</span><span class="op" id="8480493">.</span><span class="ident" id="8480494">T</span><span class="op" id="8480495">)</span>&nbsp;<span class="op" id="8480497">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480500">for</span>&nbsp;<span class="ident" id="8480504">_</span><span class="op" id="8480505">,</span>&nbsp;<span class="ident" id="8480507">tt</span>&nbsp;<span class="op" id="8480510">:=</span>&nbsp;<span class="keyword" id="8480513">range</span>&nbsp;<span class="ident" id="8480519">canonicalHeaderKeyTests</span>&nbsp;<span class="op" id="8480543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480547">if</span>&nbsp;<span class="ident" id="8480550">s</span>&nbsp;<span class="op" id="8480552">:=</span>&nbsp;<span class="ident" id="8480555">CanonicalMIMEHeaderKey</span><span class="op" id="8480577">(</span><span class="ident" id="8480578">tt</span><span class="op" id="8480580">.</span><span class="ident" id="8480581">in</span><span class="op" id="8480583">)</span><span class="op" id="8480584">;</span>&nbsp;<span class="ident" id="8480586">s</span>&nbsp;<span class="op" id="8480588">!=</span>&nbsp;<span class="ident" id="8480591">tt</span><span class="op" id="8480593">.</span><span class="ident" id="8480594">out</span>&nbsp;<span class="op" id="8480598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480603">t</span><span class="op" id="8480604">.</span><span class="ident" id="8480605">Errorf</span><span class="op" id="8480611">(</span><span class="string" id="8480612">&#34;CanonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8480654">,</span>&nbsp;<span class="ident" id="8480656">tt</span><span class="op" id="8480658">.</span><span class="ident" id="8480659">in</span><span class="op" id="8480661">,</span>&nbsp;<span class="ident" id="8480663">s</span><span class="op" id="8480664">,</span>&nbsp;<span class="ident" id="8480666">tt</span><span class="op" id="8480668">.</span><span class="ident" id="8480669">out</span><span class="op" id="8480672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480679">}</span><br>
<span class="lineno">40</span><span class="op" id="8480681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480684">func</span>&nbsp;<span class="ident" id="8480689">reader</span><span class="op" id="8480695">(</span><span class="ident" id="8480696">s</span>&nbsp;<span class="builtintype" id="8480698">string</span><span class="op" id="8480704">)</span>&nbsp;<span class="op" id="8480706">*</span><span class="ident" id="8480707">Reader</span>&nbsp;<span class="op" id="8480714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480717">return</span>&nbsp;<span class="ident" id="8480724">NewReader</span><span class="op" id="8480733">(</span><span class="ident" id="8480734">bufio</span><span class="op" id="8480739">.</span><span class="ident" id="8480740">NewReader</span><span class="op" id="8480749">(</span><span class="ident" id="8480750">strings</span><span class="op" id="8480757">.</span><span class="ident" id="8480758">NewReader</span><span class="op" id="8480767">(</span><span class="ident" id="8480768">s</span><span class="op" id="8480769">)</span><span class="op" id="8480770">)</span><span class="op" id="8480771">)</span><br>
<span class="lineno"></span><span class="op" id="8480773">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8480776">func</span>&nbsp;<span class="ident" id="8480781">TestReadLine</span><span class="op" id="8480793">(</span><span class="ident" id="8480794">t</span>&nbsp;<span class="op" id="8480796">*</span><span class="ident" id="8480797">testing</span><span class="op" id="8480804">.</span><span class="ident" id="8480805">T</span><span class="op" id="8480806">)</span>&nbsp;<span class="op" id="8480808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480811">r</span>&nbsp;<span class="op" id="8480813">:=</span>&nbsp;<span class="ident" id="8480816">reader</span><span class="op" id="8480822">(</span><span class="string" id="8480823">&#34;line1\nline2\n&#34;</span><span class="op" id="8480839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480842">s</span><span class="op" id="8480843">,</span>&nbsp;<span class="ident" id="8480845">err</span>&nbsp;<span class="op" id="8480849">:=</span>&nbsp;<span class="ident" id="8480852">r</span><span class="op" id="8480853">.</span><span class="ident" id="8480854">ReadLine</span><span class="op" id="8480862">(</span><span class="op" id="8480863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480866">if</span>&nbsp;<span class="ident" id="8480869">s</span>&nbsp;<span class="op" id="8480871">!=</span>&nbsp;<span class="string" id="8480874">&#34;line1&#34;</span>&nbsp;<span class="op" id="8480882">||</span>&nbsp;<span class="ident" id="8480885">err</span>&nbsp;<span class="op" id="8480889">!=</span>&nbsp;<span class="ident" id="8480892">nil</span>&nbsp;<span class="op" id="8480896">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480900">t</span><span class="op" id="8480901">.</span><span class="ident" id="8480902">Fatalf</span><span class="op" id="8480908">(</span><span class="string" id="8480909">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8480925">,</span>&nbsp;<span class="ident" id="8480927">s</span><span class="op" id="8480928">,</span>&nbsp;<span class="ident" id="8480930">err</span><span class="op" id="8480933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480939">s</span><span class="op" id="8480940">,</span>&nbsp;<span class="ident" id="8480942">err</span>&nbsp;<span class="op" id="8480946">=</span>&nbsp;<span class="ident" id="8480948">r</span><span class="op" id="8480949">.</span><span class="ident" id="8480950">ReadLine</span><span class="op" id="8480958">(</span><span class="op" id="8480959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8480962">if</span>&nbsp;<span class="ident" id="8480965">s</span>&nbsp;<span class="op" id="8480967">!=</span>&nbsp;<span class="string" id="8480970">&#34;line2&#34;</span>&nbsp;<span class="op" id="8480978">||</span>&nbsp;<span class="ident" id="8480981">err</span>&nbsp;<span class="op" id="8480985">!=</span>&nbsp;<span class="ident" id="8480988">nil</span>&nbsp;<span class="op" id="8480992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8480996">t</span><span class="op" id="8480997">.</span><span class="ident" id="8480998">Fatalf</span><span class="op" id="8481004">(</span><span class="string" id="8481005">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481021">,</span>&nbsp;<span class="ident" id="8481023">s</span><span class="op" id="8481024">,</span>&nbsp;<span class="ident" id="8481026">err</span><span class="op" id="8481029">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481035">s</span><span class="op" id="8481036">,</span>&nbsp;<span class="ident" id="8481038">err</span>&nbsp;<span class="op" id="8481042">=</span>&nbsp;<span class="ident" id="8481044">r</span><span class="op" id="8481045">.</span><span class="ident" id="8481046">ReadLine</span><span class="op" id="8481054">(</span><span class="op" id="8481055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481058">if</span>&nbsp;<span class="ident" id="8481061">s</span>&nbsp;<span class="op" id="8481063">!=</span>&nbsp;<span class="string" id="8481066">&#34;&#34;</span>&nbsp;<span class="op" id="8481069">||</span>&nbsp;<span class="ident" id="8481072">err</span>&nbsp;<span class="op" id="8481076">!=</span>&nbsp;<span class="ident" id="8481079">io</span><span class="op" id="8481081">.</span><span class="ident" id="8481082">EOF</span>&nbsp;<span class="op" id="8481086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481090">t</span><span class="op" id="8481091">.</span><span class="ident" id="8481092">Fatalf</span><span class="op" id="8481098">(</span><span class="string" id="8481099">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481112">,</span>&nbsp;<span class="ident" id="8481114">s</span><span class="op" id="8481115">,</span>&nbsp;<span class="ident" id="8481117">err</span><span class="op" id="8481120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481123">}</span><br>
<span class="lineno">60</span><span class="op" id="8481125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481128">func</span>&nbsp;<span class="ident" id="8481133">TestReadContinuedLine</span><span class="op" id="8481154">(</span><span class="ident" id="8481155">t</span>&nbsp;<span class="op" id="8481157">*</span><span class="ident" id="8481158">testing</span><span class="op" id="8481165">.</span><span class="ident" id="8481166">T</span><span class="op" id="8481167">)</span>&nbsp;<span class="op" id="8481169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481172">r</span>&nbsp;<span class="op" id="8481174">:=</span>&nbsp;<span class="ident" id="8481177">reader</span><span class="op" id="8481183">(</span><span class="string" id="8481184">&#34;line1\nline\n&nbsp;2\nline3\n&#34;</span><span class="op" id="8481210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481213">s</span><span class="op" id="8481214">,</span>&nbsp;<span class="ident" id="8481216">err</span>&nbsp;<span class="op" id="8481220">:=</span>&nbsp;<span class="ident" id="8481223">r</span><span class="op" id="8481224">.</span><span class="ident" id="8481225">ReadContinuedLine</span><span class="op" id="8481242">(</span><span class="op" id="8481243">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481246">if</span>&nbsp;<span class="ident" id="8481249">s</span>&nbsp;<span class="op" id="8481251">!=</span>&nbsp;<span class="string" id="8481254">&#34;line1&#34;</span>&nbsp;<span class="op" id="8481262">||</span>&nbsp;<span class="ident" id="8481265">err</span>&nbsp;<span class="op" id="8481269">!=</span>&nbsp;<span class="ident" id="8481272">nil</span>&nbsp;<span class="op" id="8481276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481280">t</span><span class="op" id="8481281">.</span><span class="ident" id="8481282">Fatalf</span><span class="op" id="8481288">(</span><span class="string" id="8481289">&#34;Line&nbsp;1:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481305">,</span>&nbsp;<span class="ident" id="8481307">s</span><span class="op" id="8481308">,</span>&nbsp;<span class="ident" id="8481310">err</span><span class="op" id="8481313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481319">s</span><span class="op" id="8481320">,</span>&nbsp;<span class="ident" id="8481322">err</span>&nbsp;<span class="op" id="8481326">=</span>&nbsp;<span class="ident" id="8481328">r</span><span class="op" id="8481329">.</span><span class="ident" id="8481330">ReadContinuedLine</span><span class="op" id="8481347">(</span><span class="op" id="8481348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481351">if</span>&nbsp;<span class="ident" id="8481354">s</span>&nbsp;<span class="op" id="8481356">!=</span>&nbsp;<span class="string" id="8481359">&#34;line&nbsp;2&#34;</span>&nbsp;<span class="op" id="8481368">||</span>&nbsp;<span class="ident" id="8481371">err</span>&nbsp;<span class="op" id="8481375">!=</span>&nbsp;<span class="ident" id="8481378">nil</span>&nbsp;<span class="op" id="8481382">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481386">t</span><span class="op" id="8481387">.</span><span class="ident" id="8481388">Fatalf</span><span class="op" id="8481394">(</span><span class="string" id="8481395">&#34;Line&nbsp;2:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481411">,</span>&nbsp;<span class="ident" id="8481413">s</span><span class="op" id="8481414">,</span>&nbsp;<span class="ident" id="8481416">err</span><span class="op" id="8481419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481425">s</span><span class="op" id="8481426">,</span>&nbsp;<span class="ident" id="8481428">err</span>&nbsp;<span class="op" id="8481432">=</span>&nbsp;<span class="ident" id="8481434">r</span><span class="op" id="8481435">.</span><span class="ident" id="8481436">ReadContinuedLine</span><span class="op" id="8481453">(</span><span class="op" id="8481454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481457">if</span>&nbsp;<span class="ident" id="8481460">s</span>&nbsp;<span class="op" id="8481462">!=</span>&nbsp;<span class="string" id="8481465">&#34;line3&#34;</span>&nbsp;<span class="op" id="8481473">||</span>&nbsp;<span class="ident" id="8481476">err</span>&nbsp;<span class="op" id="8481480">!=</span>&nbsp;<span class="ident" id="8481483">nil</span>&nbsp;<span class="op" id="8481487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481491">t</span><span class="op" id="8481492">.</span><span class="ident" id="8481493">Fatalf</span><span class="op" id="8481499">(</span><span class="string" id="8481500">&#34;Line&nbsp;3:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481516">,</span>&nbsp;<span class="ident" id="8481518">s</span><span class="op" id="8481519">,</span>&nbsp;<span class="ident" id="8481521">err</span><span class="op" id="8481524">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481530">s</span><span class="op" id="8481531">,</span>&nbsp;<span class="ident" id="8481533">err</span>&nbsp;<span class="op" id="8481537">=</span>&nbsp;<span class="ident" id="8481539">r</span><span class="op" id="8481540">.</span><span class="ident" id="8481541">ReadContinuedLine</span><span class="op" id="8481558">(</span><span class="op" id="8481559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481562">if</span>&nbsp;<span class="ident" id="8481565">s</span>&nbsp;<span class="op" id="8481567">!=</span>&nbsp;<span class="string" id="8481570">&#34;&#34;</span>&nbsp;<span class="op" id="8481573">||</span>&nbsp;<span class="ident" id="8481576">err</span>&nbsp;<span class="op" id="8481580">!=</span>&nbsp;<span class="ident" id="8481583">io</span><span class="op" id="8481585">.</span><span class="ident" id="8481586">EOF</span>&nbsp;<span class="op" id="8481590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481594">t</span><span class="op" id="8481595">.</span><span class="ident" id="8481596">Fatalf</span><span class="op" id="8481602">(</span><span class="string" id="8481603">&#34;EOF:&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481616">,</span>&nbsp;<span class="ident" id="8481618">s</span><span class="op" id="8481619">,</span>&nbsp;<span class="ident" id="8481621">err</span><span class="op" id="8481624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481627">}</span><br>
<span class="lineno">80</span><span class="op" id="8481629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8481632">func</span>&nbsp;<span class="ident" id="8481637">TestReadCodeLine</span><span class="op" id="8481653">(</span><span class="ident" id="8481654">t</span>&nbsp;<span class="op" id="8481656">*</span><span class="ident" id="8481657">testing</span><span class="op" id="8481664">.</span><span class="ident" id="8481665">T</span><span class="op" id="8481666">)</span>&nbsp;<span class="op" id="8481668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481671">r</span>&nbsp;<span class="op" id="8481673">:=</span>&nbsp;<span class="ident" id="8481676">reader</span><span class="op" id="8481682">(</span><span class="string" id="8481683">&#34;123&nbsp;hi\n234&nbsp;bye\n345&nbsp;no&nbsp;way\n&#34;</span><span class="op" id="8481714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481717">code</span><span class="op" id="8481721">,</span>&nbsp;<span class="ident" id="8481723">msg</span><span class="op" id="8481726">,</span>&nbsp;<span class="ident" id="8481728">err</span>&nbsp;<span class="op" id="8481732">:=</span>&nbsp;<span class="ident" id="8481735">r</span><span class="op" id="8481736">.</span><span class="ident" id="8481737">ReadCodeLine</span><span class="op" id="8481749">(</span><span class="num" id="8481750">0</span><span class="op" id="8481751">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481754">if</span>&nbsp;<span class="ident" id="8481757">code</span>&nbsp;<span class="op" id="8481762">!=</span>&nbsp;<span class="num" id="8481765">123</span>&nbsp;<span class="op" id="8481769">||</span>&nbsp;<span class="ident" id="8481772">msg</span>&nbsp;<span class="op" id="8481776">!=</span>&nbsp;<span class="string" id="8481779">&#34;hi&#34;</span>&nbsp;<span class="op" id="8481784">||</span>&nbsp;<span class="ident" id="8481787">err</span>&nbsp;<span class="op" id="8481791">!=</span>&nbsp;<span class="ident" id="8481794">nil</span>&nbsp;<span class="op" id="8481798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481802">t</span><span class="op" id="8481803">.</span><span class="ident" id="8481804">Fatalf</span><span class="op" id="8481810">(</span><span class="string" id="8481811">&#34;Line&nbsp;1:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481831">,</span>&nbsp;<span class="ident" id="8481833">code</span><span class="op" id="8481837">,</span>&nbsp;<span class="ident" id="8481839">msg</span><span class="op" id="8481842">,</span>&nbsp;<span class="ident" id="8481844">err</span><span class="op" id="8481847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481853">code</span><span class="op" id="8481857">,</span>&nbsp;<span class="ident" id="8481859">msg</span><span class="op" id="8481862">,</span>&nbsp;<span class="ident" id="8481864">err</span>&nbsp;<span class="op" id="8481868">=</span>&nbsp;<span class="ident" id="8481870">r</span><span class="op" id="8481871">.</span><span class="ident" id="8481872">ReadCodeLine</span><span class="op" id="8481884">(</span><span class="num" id="8481885">23</span><span class="op" id="8481887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8481890">if</span>&nbsp;<span class="ident" id="8481893">code</span>&nbsp;<span class="op" id="8481898">!=</span>&nbsp;<span class="num" id="8481901">234</span>&nbsp;<span class="op" id="8481905">||</span>&nbsp;<span class="ident" id="8481908">msg</span>&nbsp;<span class="op" id="8481912">!=</span>&nbsp;<span class="string" id="8481915">&#34;bye&#34;</span>&nbsp;<span class="op" id="8481921">||</span>&nbsp;<span class="ident" id="8481924">err</span>&nbsp;<span class="op" id="8481928">!=</span>&nbsp;<span class="ident" id="8481931">nil</span>&nbsp;<span class="op" id="8481935">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481939">t</span><span class="op" id="8481940">.</span><span class="ident" id="8481941">Fatalf</span><span class="op" id="8481947">(</span><span class="string" id="8481948">&#34;Line&nbsp;2:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8481968">,</span>&nbsp;<span class="ident" id="8481970">code</span><span class="op" id="8481974">,</span>&nbsp;<span class="ident" id="8481976">msg</span><span class="op" id="8481979">,</span>&nbsp;<span class="ident" id="8481981">err</span><span class="op" id="8481984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8481987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8481990">code</span><span class="op" id="8481994">,</span>&nbsp;<span class="ident" id="8481996">msg</span><span class="op" id="8481999">,</span>&nbsp;<span class="ident" id="8482001">err</span>&nbsp;<span class="op" id="8482005">=</span>&nbsp;<span class="ident" id="8482007">r</span><span class="op" id="8482008">.</span><span class="ident" id="8482009">ReadCodeLine</span><span class="op" id="8482021">(</span><span class="num" id="8482022">346</span><span class="op" id="8482025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482028">if</span>&nbsp;<span class="ident" id="8482031">code</span>&nbsp;<span class="op" id="8482036">!=</span>&nbsp;<span class="num" id="8482039">345</span>&nbsp;<span class="op" id="8482043">||</span>&nbsp;<span class="ident" id="8482046">msg</span>&nbsp;<span class="op" id="8482050">!=</span>&nbsp;<span class="string" id="8482053">&#34;no&nbsp;way&#34;</span>&nbsp;<span class="op" id="8482062">||</span>&nbsp;<span class="ident" id="8482065">err</span>&nbsp;<span class="op" id="8482069">==</span>&nbsp;<span class="ident" id="8482072">nil</span>&nbsp;<span class="op" id="8482076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482080">t</span><span class="op" id="8482081">.</span><span class="ident" id="8482082">Fatalf</span><span class="op" id="8482088">(</span><span class="string" id="8482089">&#34;Line&nbsp;3:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8482109">,</span>&nbsp;<span class="ident" id="8482111">code</span><span class="op" id="8482115">,</span>&nbsp;<span class="ident" id="8482117">msg</span><span class="op" id="8482120">,</span>&nbsp;<span class="ident" id="8482122">err</span><span class="op" id="8482125">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482131">if</span>&nbsp;<span class="ident" id="8482134">e</span><span class="op" id="8482135">,</span>&nbsp;<span class="ident" id="8482137">ok</span>&nbsp;<span class="op" id="8482140">:=</span>&nbsp;<span class="ident" id="8482143">err</span><span class="op" id="8482146">.</span><span class="op" id="8482147">(</span><span class="op" id="8482148">*</span><span class="ident" id="8482149">Error</span><span class="op" id="8482154">)</span><span class="op" id="8482155">;</span>&nbsp;<span class="op" id="8482157">!</span><span class="ident" id="8482158">ok</span>&nbsp;<span class="op" id="8482161">||</span>&nbsp;<span class="ident" id="8482164">e</span><span class="op" id="8482165">.</span><span class="ident" id="8482166">Code</span>&nbsp;<span class="op" id="8482171">!=</span>&nbsp;<span class="ident" id="8482174">code</span>&nbsp;<span class="op" id="8482179">||</span>&nbsp;<span class="ident" id="8482182">e</span><span class="op" id="8482183">.</span><span class="ident" id="8482184">Msg</span>&nbsp;<span class="op" id="8482188">!=</span>&nbsp;<span class="ident" id="8482191">msg</span>&nbsp;<span class="op" id="8482195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482199">t</span><span class="op" id="8482200">.</span><span class="ident" id="8482201">Fatalf</span><span class="op" id="8482207">(</span><span class="string" id="8482208">&#34;Line&nbsp;3:&nbsp;wrong&nbsp;error&nbsp;%v\n&#34;</span><span class="op" id="8482234">,</span>&nbsp;<span class="ident" id="8482236">err</span><span class="op" id="8482239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482245">code</span><span class="op" id="8482249">,</span>&nbsp;<span class="ident" id="8482251">msg</span><span class="op" id="8482254">,</span>&nbsp;<span class="ident" id="8482256">err</span>&nbsp;<span class="op" id="8482260">=</span>&nbsp;<span class="ident" id="8482262">r</span><span class="op" id="8482263">.</span><span class="ident" id="8482264">ReadCodeLine</span><span class="op" id="8482276">(</span><span class="num" id="8482277">1</span><span class="op" id="8482278">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482281">if</span>&nbsp;<span class="ident" id="8482284">code</span>&nbsp;<span class="op" id="8482289">!=</span>&nbsp;<span class="num" id="8482292">0</span>&nbsp;<span class="op" id="8482294">||</span>&nbsp;<span class="ident" id="8482297">msg</span>&nbsp;<span class="op" id="8482301">!=</span>&nbsp;<span class="string" id="8482304">&#34;&#34;</span>&nbsp;<span class="op" id="8482307">||</span>&nbsp;<span class="ident" id="8482310">err</span>&nbsp;<span class="op" id="8482314">!=</span>&nbsp;<span class="ident" id="8482317">io</span><span class="op" id="8482319">.</span><span class="ident" id="8482320">EOF</span>&nbsp;<span class="op" id="8482324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482328">t</span><span class="op" id="8482329">.</span><span class="ident" id="8482330">Fatalf</span><span class="op" id="8482336">(</span><span class="string" id="8482337">&#34;EOF:&nbsp;%d,&nbsp;%s,&nbsp;%v&#34;</span><span class="op" id="8482354">,</span>&nbsp;<span class="ident" id="8482356">code</span><span class="op" id="8482360">,</span>&nbsp;<span class="ident" id="8482362">msg</span><span class="op" id="8482365">,</span>&nbsp;<span class="ident" id="8482367">err</span><span class="op" id="8482370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482373">}</span><br>
<span class="lineno"></span><span class="op" id="8482375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8482378">func</span>&nbsp;<span class="ident" id="8482383">TestReadDotLines</span><span class="op" id="8482399">(</span><span class="ident" id="8482400">t</span>&nbsp;<span class="op" id="8482402">*</span><span class="ident" id="8482403">testing</span><span class="op" id="8482410">.</span><span class="ident" id="8482411">T</span><span class="op" id="8482412">)</span>&nbsp;<span class="op" id="8482414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482417">r</span>&nbsp;<span class="op" id="8482419">:=</span>&nbsp;<span class="ident" id="8482422">reader</span><span class="op" id="8482428">(</span><span class="string" id="8482429">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanother\n&#34;</span><span class="op" id="8482492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482495">s</span><span class="op" id="8482496">,</span>&nbsp;<span class="ident" id="8482498">err</span>&nbsp;<span class="op" id="8482502">:=</span>&nbsp;<span class="ident" id="8482505">r</span><span class="op" id="8482506">.</span><span class="ident" id="8482507">ReadDotLines</span><span class="op" id="8482519">(</span><span class="op" id="8482520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482523">want</span>&nbsp;<span class="op" id="8482528">:=</span>&nbsp;<span class="op" id="8482531">[</span><span class="op" id="8482532">]</span><span class="builtintype" id="8482533">string</span><span class="op" id="8482539">{</span><span class="string" id="8482540">&#34;dotlines&#34;</span><span class="op" id="8482550">,</span>&nbsp;<span class="string" id="8482552">&#34;foo&#34;</span><span class="op" id="8482557">,</span>&nbsp;<span class="string" id="8482559">&#34;.bar&#34;</span><span class="op" id="8482565">,</span>&nbsp;<span class="string" id="8482567">&#34;..baz&#34;</span><span class="op" id="8482574">,</span>&nbsp;<span class="string" id="8482576">&#34;quux&#34;</span><span class="op" id="8482582">,</span>&nbsp;<span class="string" id="8482584">&#34;&#34;</span><span class="op" id="8482586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482589">if</span>&nbsp;<span class="op" id="8482592">!</span><span class="ident" id="8482593">reflect</span><span class="op" id="8482600">.</span><span class="ident" id="8482601">DeepEqual</span><span class="op" id="8482610">(</span><span class="ident" id="8482611">s</span><span class="op" id="8482612">,</span>&nbsp;<span class="ident" id="8482614">want</span><span class="op" id="8482618">)</span>&nbsp;<span class="op" id="8482620">||</span>&nbsp;<span class="ident" id="8482623">err</span>&nbsp;<span class="op" id="8482627">!=</span>&nbsp;<span class="ident" id="8482630">nil</span>&nbsp;<span class="op" id="8482634">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482638">t</span><span class="op" id="8482639">.</span><span class="ident" id="8482640">Fatalf</span><span class="op" id="8482646">(</span><span class="string" id="8482647">&#34;ReadDotLines:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8482669">,</span>&nbsp;<span class="ident" id="8482671">s</span><span class="op" id="8482672">,</span>&nbsp;<span class="ident" id="8482674">err</span><span class="op" id="8482677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482684">s</span><span class="op" id="8482685">,</span>&nbsp;<span class="ident" id="8482687">err</span>&nbsp;<span class="op" id="8482691">=</span>&nbsp;<span class="ident" id="8482693">r</span><span class="op" id="8482694">.</span><span class="ident" id="8482695">ReadDotLines</span><span class="op" id="8482707">(</span><span class="op" id="8482708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482711">want</span>&nbsp;<span class="op" id="8482716">=</span>&nbsp;<span class="op" id="8482718">[</span><span class="op" id="8482719">]</span><span class="builtintype" id="8482720">string</span><span class="op" id="8482726">{</span><span class="string" id="8482727">&#34;another&#34;</span><span class="op" id="8482736">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8482739">if</span>&nbsp;<span class="op" id="8482742">!</span><span class="ident" id="8482743">reflect</span><span class="op" id="8482750">.</span><span class="ident" id="8482751">DeepEqual</span><span class="op" id="8482760">(</span><span class="ident" id="8482761">s</span><span class="op" id="8482762">,</span>&nbsp;<span class="ident" id="8482764">want</span><span class="op" id="8482768">)</span>&nbsp;<span class="op" id="8482770">||</span>&nbsp;<span class="ident" id="8482773">err</span>&nbsp;<span class="op" id="8482777">!=</span>&nbsp;<span class="ident" id="8482780">io</span><span class="op" id="8482782">.</span><span class="ident" id="8482783">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8482800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482804">t</span><span class="op" id="8482805">.</span><span class="ident" id="8482806">Fatalf</span><span class="op" id="8482812">(</span><span class="string" id="8482813">&#34;ReadDotLines2:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8482836">,</span>&nbsp;<span class="ident" id="8482838">s</span><span class="op" id="8482839">,</span>&nbsp;<span class="ident" id="8482841">err</span><span class="op" id="8482844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8482847">}</span><br>
<span class="lineno"></span><span class="op" id="8482849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8482852">func</span>&nbsp;<span class="ident" id="8482857">TestReadDotBytes</span><span class="op" id="8482873">(</span><span class="ident" id="8482874">t</span>&nbsp;<span class="op" id="8482876">*</span><span class="ident" id="8482877">testing</span><span class="op" id="8482884">.</span><span class="ident" id="8482885">T</span><span class="op" id="8482886">)</span>&nbsp;<span class="op" id="8482888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482891">r</span>&nbsp;<span class="op" id="8482893">:=</span>&nbsp;<span class="ident" id="8482896">reader</span><span class="op" id="8482902">(</span><span class="string" id="8482903">&#34;dotlines\r\n.foo\r\n..bar\n...baz\nquux\r\n\r\n.\r\nanot.her\r\n&#34;</span><span class="op" id="8482969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8482972">b</span><span class="op" id="8482973">,</span>&nbsp;<span class="ident" id="8482975">err</span>&nbsp;<span class="op" id="8482979">:=</span>&nbsp;<span class="ident" id="8482982">r</span><span class="op" id="8482983">.</span><span class="ident" id="8482984">ReadDotBytes</span><span class="op" id="8482996">(</span><span class="op" id="8482997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483000">want</span>&nbsp;<span class="op" id="8483005">:=</span>&nbsp;<span class="op" id="8483008">[</span><span class="op" id="8483009">]</span><span class="builtintype" id="8483010">byte</span><span class="op" id="8483014">(</span><span class="string" id="8483015">&#34;dotlines\nfoo\n.bar\n..baz\nquux\n\n&#34;</span><span class="op" id="8483053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483056">if</span>&nbsp;<span class="op" id="8483059">!</span><span class="ident" id="8483060">reflect</span><span class="op" id="8483067">.</span><span class="ident" id="8483068">DeepEqual</span><span class="op" id="8483077">(</span><span class="ident" id="8483078">b</span><span class="op" id="8483079">,</span>&nbsp;<span class="ident" id="8483081">want</span><span class="op" id="8483085">)</span>&nbsp;<span class="op" id="8483087">||</span>&nbsp;<span class="ident" id="8483090">err</span>&nbsp;<span class="op" id="8483094">!=</span>&nbsp;<span class="ident" id="8483097">nil</span>&nbsp;<span class="op" id="8483101">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483105">t</span><span class="op" id="8483106">.</span><span class="ident" id="8483107">Fatalf</span><span class="op" id="8483113">(</span><span class="string" id="8483114">&#34;ReadDotBytes:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8483136">,</span>&nbsp;<span class="ident" id="8483138">b</span><span class="op" id="8483139">,</span>&nbsp;<span class="ident" id="8483141">err</span><span class="op" id="8483144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483151">b</span><span class="op" id="8483152">,</span>&nbsp;<span class="ident" id="8483154">err</span>&nbsp;<span class="op" id="8483158">=</span>&nbsp;<span class="ident" id="8483160">r</span><span class="op" id="8483161">.</span><span class="ident" id="8483162">ReadDotBytes</span><span class="op" id="8483174">(</span><span class="op" id="8483175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483178">want</span>&nbsp;<span class="op" id="8483183">=</span>&nbsp;<span class="op" id="8483185">[</span><span class="op" id="8483186">]</span><span class="builtintype" id="8483187">byte</span><span class="op" id="8483191">(</span><span class="string" id="8483192">&#34;anot.her\n&#34;</span><span class="op" id="8483204">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483207">if</span>&nbsp;<span class="op" id="8483210">!</span><span class="ident" id="8483211">reflect</span><span class="op" id="8483218">.</span><span class="ident" id="8483219">DeepEqual</span><span class="op" id="8483228">(</span><span class="ident" id="8483229">b</span><span class="op" id="8483230">,</span>&nbsp;<span class="ident" id="8483232">want</span><span class="op" id="8483236">)</span>&nbsp;<span class="op" id="8483238">||</span>&nbsp;<span class="ident" id="8483241">err</span>&nbsp;<span class="op" id="8483245">!=</span>&nbsp;<span class="ident" id="8483248">io</span><span class="op" id="8483250">.</span><span class="ident" id="8483251">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8483268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483272">t</span><span class="op" id="8483273">.</span><span class="ident" id="8483274">Fatalf</span><span class="op" id="8483280">(</span><span class="string" id="8483281">&#34;ReadDotBytes2:&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="8483304">,</span>&nbsp;<span class="ident" id="8483306">b</span><span class="op" id="8483307">,</span>&nbsp;<span class="ident" id="8483309">err</span><span class="op" id="8483312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483315">}</span><br>
<span class="lineno"></span><span class="op" id="8483317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="8483320">func</span>&nbsp;<span class="ident" id="8483325">TestReadMIMEHeader</span><span class="op" id="8483343">(</span><span class="ident" id="8483344">t</span>&nbsp;<span class="op" id="8483346">*</span><span class="ident" id="8483347">testing</span><span class="op" id="8483354">.</span><span class="ident" id="8483355">T</span><span class="op" id="8483356">)</span>&nbsp;<span class="op" id="8483358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483361">r</span>&nbsp;<span class="op" id="8483363">:=</span>&nbsp;<span class="ident" id="8483366">reader</span><span class="op" id="8483372">(</span><span class="string" id="8483373">&#34;my-key:&nbsp;Value&nbsp;1&nbsp;&nbsp;\r\nLong-key:&nbsp;Even&nbsp;\n&nbsp;Longer&nbsp;Value\r\nmy-Key:&nbsp;Value&nbsp;2\r\n\n&#34;</span><span class="op" id="8483451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483454">m</span><span class="op" id="8483455">,</span>&nbsp;<span class="ident" id="8483457">err</span>&nbsp;<span class="op" id="8483461">:=</span>&nbsp;<span class="ident" id="8483464">r</span><span class="op" id="8483465">.</span><span class="ident" id="8483466">ReadMIMEHeader</span><span class="op" id="8483480">(</span><span class="op" id="8483481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483484">want</span>&nbsp;<span class="op" id="8483489">:=</span>&nbsp;<span class="ident" id="8483492">MIMEHeader</span><span class="op" id="8483502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483506">&#34;My-Key&#34;</span><span class="op" id="8483514">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8483518">{</span><span class="string" id="8483519">&#34;Value&nbsp;1&#34;</span><span class="op" id="8483528">,</span>&nbsp;<span class="string" id="8483530">&#34;Value&nbsp;2&#34;</span><span class="op" id="8483539">}</span><span class="op" id="8483540">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8483544">&#34;Long-Key&#34;</span><span class="op" id="8483554">:</span>&nbsp;<span class="op" id="8483556">{</span><span class="string" id="8483557">&#34;Even&nbsp;Longer&nbsp;Value&#34;</span><span class="op" id="8483576">}</span><span class="op" id="8483577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483583">if</span>&nbsp;<span class="op" id="8483586">!</span><span class="ident" id="8483587">reflect</span><span class="op" id="8483594">.</span><span class="ident" id="8483595">DeepEqual</span><span class="op" id="8483604">(</span><span class="ident" id="8483605">m</span><span class="op" id="8483606">,</span>&nbsp;<span class="ident" id="8483608">want</span><span class="op" id="8483612">)</span>&nbsp;<span class="op" id="8483614">||</span>&nbsp;<span class="ident" id="8483617">err</span>&nbsp;<span class="op" id="8483621">!=</span>&nbsp;<span class="ident" id="8483624">nil</span>&nbsp;<span class="op" id="8483628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483632">t</span><span class="op" id="8483633">.</span><span class="ident" id="8483634">Fatalf</span><span class="op" id="8483640">(</span><span class="string" id="8483641">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8483674">,</span>&nbsp;<span class="ident" id="8483676">m</span><span class="op" id="8483677">,</span>&nbsp;<span class="ident" id="8483679">err</span><span class="op" id="8483682">,</span>&nbsp;<span class="ident" id="8483684">want</span><span class="op" id="8483688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483691">}</span><br>
<span class="lineno">145</span><span class="op" id="8483693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8483696">func</span>&nbsp;<span class="ident" id="8483701">TestReadMIMEHeaderSingle</span><span class="op" id="8483725">(</span><span class="ident" id="8483726">t</span>&nbsp;<span class="op" id="8483728">*</span><span class="ident" id="8483729">testing</span><span class="op" id="8483736">.</span><span class="ident" id="8483737">T</span><span class="op" id="8483738">)</span>&nbsp;<span class="op" id="8483740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483743">r</span>&nbsp;<span class="op" id="8483745">:=</span>&nbsp;<span class="ident" id="8483748">reader</span><span class="op" id="8483754">(</span><span class="string" id="8483755">&#34;Foo:&nbsp;bar\n\n&#34;</span><span class="op" id="8483769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483772">m</span><span class="op" id="8483773">,</span>&nbsp;<span class="ident" id="8483775">err</span>&nbsp;<span class="op" id="8483779">:=</span>&nbsp;<span class="ident" id="8483782">r</span><span class="op" id="8483783">.</span><span class="ident" id="8483784">ReadMIMEHeader</span><span class="op" id="8483798">(</span><span class="op" id="8483799">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483802">want</span>&nbsp;<span class="op" id="8483807">:=</span>&nbsp;<span class="ident" id="8483810">MIMEHeader</span><span class="op" id="8483820">{</span><span class="string" id="8483821">&#34;Foo&#34;</span><span class="op" id="8483826">:</span>&nbsp;<span class="op" id="8483828">{</span><span class="string" id="8483829">&#34;bar&#34;</span><span class="op" id="8483834">}</span><span class="op" id="8483835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8483838">if</span>&nbsp;<span class="op" id="8483841">!</span><span class="ident" id="8483842">reflect</span><span class="op" id="8483849">.</span><span class="ident" id="8483850">DeepEqual</span><span class="op" id="8483859">(</span><span class="ident" id="8483860">m</span><span class="op" id="8483861">,</span>&nbsp;<span class="ident" id="8483863">want</span><span class="op" id="8483867">)</span>&nbsp;<span class="op" id="8483869">||</span>&nbsp;<span class="ident" id="8483872">err</span>&nbsp;<span class="op" id="8483876">!=</span>&nbsp;<span class="ident" id="8483879">nil</span>&nbsp;<span class="op" id="8483883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483887">t</span><span class="op" id="8483888">.</span><span class="ident" id="8483889">Fatalf</span><span class="op" id="8483895">(</span><span class="string" id="8483896">&#34;ReadMIMEHeader:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8483929">,</span>&nbsp;<span class="ident" id="8483931">m</span><span class="op" id="8483932">,</span>&nbsp;<span class="ident" id="8483934">err</span><span class="op" id="8483937">,</span>&nbsp;<span class="ident" id="8483939">want</span><span class="op" id="8483943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8483946">}</span><br>
<span class="lineno"></span><span class="op" id="8483948">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8483951">func</span>&nbsp;<span class="ident" id="8483956">TestLargeReadMIMEHeader</span><span class="op" id="8483979">(</span><span class="ident" id="8483980">t</span>&nbsp;<span class="op" id="8483982">*</span><span class="ident" id="8483983">testing</span><span class="op" id="8483990">.</span><span class="ident" id="8483991">T</span><span class="op" id="8483992">)</span>&nbsp;<span class="op" id="8483994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8483997">data</span>&nbsp;<span class="op" id="8484002">:=</span>&nbsp;<span class="builtinfunc" id="8484005">make</span><span class="op" id="8484009">(</span><span class="op" id="8484010">[</span><span class="op" id="8484011">]</span><span class="builtintype" id="8484012">byte</span><span class="op" id="8484016">,</span>&nbsp;<span class="num" id="8484018">16</span><span class="op" id="8484020">*</span><span class="num" id="8484021">1024</span><span class="op" id="8484025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484028">for</span>&nbsp;<span class="ident" id="8484032">i</span>&nbsp;<span class="op" id="8484034">:=</span>&nbsp;<span class="num" id="8484037">0</span><span class="op" id="8484038">;</span>&nbsp;<span class="ident" id="8484040">i</span>&nbsp;<span class="op" id="8484042">&lt;</span>&nbsp;<span class="builtinfunc" id="8484044">len</span><span class="op" id="8484047">(</span><span class="ident" id="8484048">data</span><span class="op" id="8484052">)</span><span class="op" id="8484053">;</span>&nbsp;<span class="ident" id="8484055">i</span><span class="op" id="8484056">++</span>&nbsp;<span class="op" id="8484059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484063">data</span><span class="op" id="8484067">[</span><span class="ident" id="8484068">i</span><span class="op" id="8484069">]</span>&nbsp;<span class="op" id="8484071">=</span>&nbsp;<span class="string" id="8484073">&#39;x&#39;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484081">sdata</span>&nbsp;<span class="op" id="8484087">:=</span>&nbsp;<span class="builtintype" id="8484090">string</span><span class="op" id="8484096">(</span><span class="ident" id="8484097">data</span><span class="op" id="8484101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484104">r</span>&nbsp;<span class="op" id="8484106">:=</span>&nbsp;<span class="ident" id="8484109">reader</span><span class="op" id="8484115">(</span><span class="string" id="8484116">&#34;Cookie:&nbsp;&#34;</span>&nbsp;<span class="op" id="8484127">+</span>&nbsp;<span class="ident" id="8484129">sdata</span>&nbsp;<span class="op" id="8484135">+</span>&nbsp;<span class="string" id="8484137">&#34;\r\n\n&#34;</span><span class="op" id="8484145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484148">m</span><span class="op" id="8484149">,</span>&nbsp;<span class="ident" id="8484151">err</span>&nbsp;<span class="op" id="8484155">:=</span>&nbsp;<span class="ident" id="8484158">r</span><span class="op" id="8484159">.</span><span class="ident" id="8484160">ReadMIMEHeader</span><span class="op" id="8484174">(</span><span class="op" id="8484175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484178">if</span>&nbsp;<span class="ident" id="8484181">err</span>&nbsp;<span class="op" id="8484185">!=</span>&nbsp;<span class="ident" id="8484188">nil</span>&nbsp;<span class="op" id="8484192">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484196">t</span><span class="op" id="8484197">.</span><span class="ident" id="8484198">Fatalf</span><span class="op" id="8484204">(</span><span class="string" id="8484205">&#34;ReadMIMEHeader:&nbsp;%v&#34;</span><span class="op" id="8484225">,</span>&nbsp;<span class="ident" id="8484227">err</span><span class="op" id="8484230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484236">cookie</span>&nbsp;<span class="op" id="8484243">:=</span>&nbsp;<span class="ident" id="8484246">m</span><span class="op" id="8484247">.</span><span class="ident" id="8484248">Get</span><span class="op" id="8484251">(</span><span class="string" id="8484252">&#34;Cookie&#34;</span><span class="op" id="8484260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8484263">if</span>&nbsp;<span class="ident" id="8484266">cookie</span>&nbsp;<span class="op" id="8484273">!=</span>&nbsp;<span class="ident" id="8484276">sdata</span>&nbsp;<span class="op" id="8484282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484286">t</span><span class="op" id="8484287">.</span><span class="ident" id="8484288">Fatalf</span><span class="op" id="8484294">(</span><span class="string" id="8484295">&#34;ReadMIMEHeader:&nbsp;%v&nbsp;bytes,&nbsp;want&nbsp;%v&nbsp;bytes&#34;</span><span class="op" id="8484336">,</span>&nbsp;<span class="builtinfunc" id="8484338">len</span><span class="op" id="8484341">(</span><span class="ident" id="8484342">cookie</span><span class="op" id="8484348">)</span><span class="op" id="8484349">,</span>&nbsp;<span class="builtinfunc" id="8484351">len</span><span class="op" id="8484354">(</span><span class="ident" id="8484355">sdata</span><span class="op" id="8484360">)</span><span class="op" id="8484361">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484364">}</span><br>
<span class="lineno"></span><span class="op" id="8484366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8484369">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;read&nbsp;slightly-bogus&nbsp;MIME&nbsp;headers&nbsp;seen&nbsp;in&nbsp;the&nbsp;wild,</span><br>
<span class="lineno"></span><span class="comment" id="8484436">//&nbsp;with&nbsp;spaces&nbsp;before&nbsp;colons,&nbsp;and&nbsp;spaces&nbsp;in&nbsp;keys.</span><br>
<span class="lineno">175</span><span class="keyword" id="8484486">func</span>&nbsp;<span class="ident" id="8484491">TestReadMIMEHeaderNonCompliant</span><span class="op" id="8484521">(</span><span class="ident" id="8484522">t</span>&nbsp;<span class="op" id="8484524">*</span><span class="ident" id="8484525">testing</span><span class="op" id="8484532">.</span><span class="ident" id="8484533">T</span><span class="op" id="8484534">)</span>&nbsp;<span class="op" id="8484536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8484539">//&nbsp;Invalid&nbsp;HTTP&nbsp;response&nbsp;header&nbsp;as&nbsp;sent&nbsp;by&nbsp;an&nbsp;Axis&nbsp;security</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8484600">//&nbsp;camera:&nbsp;(this&nbsp;is&nbsp;handled&nbsp;by&nbsp;IE,&nbsp;Firefox,&nbsp;Chrome,&nbsp;curl,&nbsp;etc.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484665">r</span>&nbsp;<span class="op" id="8484667">:=</span>&nbsp;<span class="ident" id="8484670">reader</span><span class="op" id="8484676">(</span><span class="string" id="8484677">&#34;Foo:&nbsp;bar\r\n&#34;</span>&nbsp;<span class="op" id="8484692">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484696">&#34;Content-Language:&nbsp;en\r\n&#34;</span>&nbsp;<span class="op" id="8484723">+</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484727">&#34;SID&nbsp;:&nbsp;0\r\n&#34;</span>&nbsp;<span class="op" id="8484741">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484745">&#34;Audio&nbsp;Mode&nbsp;:&nbsp;None\r\n&#34;</span>&nbsp;<span class="op" id="8484769">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484773">&#34;Privilege&nbsp;:&nbsp;127\r\n\r\n&#34;</span><span class="op" id="8484798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484801">m</span><span class="op" id="8484802">,</span>&nbsp;<span class="ident" id="8484804">err</span>&nbsp;<span class="op" id="8484808">:=</span>&nbsp;<span class="ident" id="8484811">r</span><span class="op" id="8484812">.</span><span class="ident" id="8484813">ReadMIMEHeader</span><span class="op" id="8484827">(</span><span class="op" id="8484828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8484831">want</span>&nbsp;<span class="op" id="8484836">:=</span>&nbsp;<span class="ident" id="8484839">MIMEHeader</span><span class="op" id="8484849">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484853">&#34;Foo&#34;</span><span class="op" id="8484858">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484873">{</span><span class="string" id="8484874">&#34;bar&#34;</span><span class="op" id="8484879">}</span><span class="op" id="8484880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484884">&#34;Content-Language&#34;</span><span class="op" id="8484902">:</span>&nbsp;<span class="op" id="8484904">{</span><span class="string" id="8484905">&#34;en&#34;</span><span class="op" id="8484909">}</span><span class="op" id="8484910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484914">&#34;Sid&#34;</span><span class="op" id="8484919">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484934">{</span><span class="string" id="8484935">&#34;0&#34;</span><span class="op" id="8484938">}</span><span class="op" id="8484939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484943">&#34;Audio-Mode&#34;</span><span class="op" id="8484955">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484963">{</span><span class="string" id="8484964">&#34;None&#34;</span><span class="op" id="8484970">}</span><span class="op" id="8484971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8484975">&#34;Privilege&#34;</span><span class="op" id="8484986">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8484995">{</span><span class="string" id="8484996">&#34;127&#34;</span><span class="op" id="8485001">}</span><span class="op" id="8485002">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8485008">if</span>&nbsp;<span class="op" id="8485011">!</span><span class="ident" id="8485012">reflect</span><span class="op" id="8485019">.</span><span class="ident" id="8485020">DeepEqual</span><span class="op" id="8485029">(</span><span class="ident" id="8485030">m</span><span class="op" id="8485031">,</span>&nbsp;<span class="ident" id="8485033">want</span><span class="op" id="8485037">)</span>&nbsp;<span class="op" id="8485039">||</span>&nbsp;<span class="ident" id="8485042">err</span>&nbsp;<span class="op" id="8485046">!=</span>&nbsp;<span class="ident" id="8485049">nil</span>&nbsp;<span class="op" id="8485053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485057">t</span><span class="op" id="8485058">.</span><span class="ident" id="8485059">Fatalf</span><span class="op" id="8485065">(</span><span class="string" id="8485066">&#34;ReadMIMEHeader&nbsp;=\n%v,&nbsp;%v;&nbsp;want:\n%v&#34;</span><span class="op" id="8485103">,</span>&nbsp;<span class="ident" id="8485105">m</span><span class="op" id="8485106">,</span>&nbsp;<span class="ident" id="8485108">err</span><span class="op" id="8485111">,</span>&nbsp;<span class="ident" id="8485113">want</span><span class="op" id="8485117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485120">}</span><br>
<span class="lineno"></span><span class="op" id="8485122">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="8485125">type</span>&nbsp;<span class="ident" id="8485130">readResponseTest</span>&nbsp;<span class="keyword" id="8485147">struct</span>&nbsp;<span class="op" id="8485154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485157">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8485166">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485174">inCode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8485183">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485188">wantCode</span>&nbsp;<span class="builtintype" id="8485197">int</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485202">wantMsg</span>&nbsp;&nbsp;<span class="builtintype" id="8485211">string</span><br>
<span class="lineno"></span><span class="op" id="8485218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8485221">var</span>&nbsp;<span class="ident" id="8485225">readResponseTests</span>&nbsp;<span class="op" id="8485243">=</span>&nbsp;<span class="op" id="8485245">[</span><span class="op" id="8485246">]</span><span class="ident" id="8485247">readResponseTest</span><span class="op" id="8485263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485266">{</span><span class="string" id="8485267">&#34;230-Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span>&nbsp;<span class="op" id="8485320">+</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8485324">&#34;Read&nbsp;the&nbsp;file&nbsp;README.txt,\n&#34;</span>&nbsp;<span class="op" id="8485354">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8485358">&#34;230&nbsp;&nbsp;please&#34;</span><span class="op" id="8485371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485375">23</span><span class="op" id="8485377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485381">230</span><span class="op" id="8485384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8485388">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\nRead&nbsp;the&nbsp;file&nbsp;README.txt,\n&nbsp;please&#34;</span><span class="op" id="8485470">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485473">}</span><span class="op" id="8485474">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485478">{</span><span class="string" id="8485479">&#34;230&nbsp;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply\n&#34;</span><span class="op" id="8485531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485535">23</span><span class="op" id="8485537">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485541">230</span><span class="op" id="8485544">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8485548">&#34;Anonymous&nbsp;access&nbsp;granted,&nbsp;restrictions&nbsp;apply&#34;</span><span class="op" id="8485594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485597">}</span><span class="op" id="8485598">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485602">{</span><span class="string" id="8485603">&#34;400-A\n400-B\n400&nbsp;C&#34;</span><span class="op" id="8485624">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485628">4</span><span class="op" id="8485629">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485633">400</span><span class="op" id="8485636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8485640">&#34;A\nB\nC&#34;</span><span class="op" id="8485649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485652">}</span><span class="op" id="8485653">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485657">{</span><span class="string" id="8485658">&#34;400-A\r\n400-B\r\n400&nbsp;C\r\n&#34;</span><span class="op" id="8485687">,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485691">4</span><span class="op" id="8485692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8485696">400</span><span class="op" id="8485699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8485703">&#34;A\nB\nC&#34;</span><span class="op" id="8485712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8485715">}</span><span class="op" id="8485716">,</span><br>
<span class="lineno"></span><span class="op" id="8485718">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="8485721">//&nbsp;See&nbsp;http://www.ietf.org/rfc/rfc959.txt&nbsp;page&nbsp;36.</span><br>
<span class="lineno"></span><span class="keyword" id="8485772">func</span>&nbsp;<span class="ident" id="8485777">TestRFC959Lines</span><span class="op" id="8485792">(</span><span class="ident" id="8485793">t</span>&nbsp;<span class="op" id="8485795">*</span><span class="ident" id="8485796">testing</span><span class="op" id="8485803">.</span><span class="ident" id="8485804">T</span><span class="op" id="8485805">)</span>&nbsp;<span class="op" id="8485807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8485810">for</span>&nbsp;<span class="ident" id="8485814">i</span><span class="op" id="8485815">,</span>&nbsp;<span class="ident" id="8485817">tt</span>&nbsp;<span class="op" id="8485820">:=</span>&nbsp;<span class="keyword" id="8485823">range</span>&nbsp;<span class="ident" id="8485829">readResponseTests</span>&nbsp;<span class="op" id="8485847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485851">r</span>&nbsp;<span class="op" id="8485853">:=</span>&nbsp;<span class="ident" id="8485856">reader</span><span class="op" id="8485862">(</span><span class="ident" id="8485863">tt</span><span class="op" id="8485865">.</span><span class="ident" id="8485866">in</span>&nbsp;<span class="op" id="8485869">+</span>&nbsp;<span class="string" id="8485871">&#34;\nFOLLOWING&nbsp;DATA&#34;</span><span class="op" id="8485889">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485893">code</span><span class="op" id="8485897">,</span>&nbsp;<span class="ident" id="8485899">msg</span><span class="op" id="8485902">,</span>&nbsp;<span class="ident" id="8485904">err</span>&nbsp;<span class="op" id="8485908">:=</span>&nbsp;<span class="ident" id="8485911">r</span><span class="op" id="8485912">.</span><span class="ident" id="8485913">ReadResponse</span><span class="op" id="8485925">(</span><span class="ident" id="8485926">tt</span><span class="op" id="8485928">.</span><span class="ident" id="8485929">inCode</span><span class="op" id="8485935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8485939">if</span>&nbsp;<span class="ident" id="8485942">err</span>&nbsp;<span class="op" id="8485946">!=</span>&nbsp;<span class="ident" id="8485949">nil</span>&nbsp;<span class="op" id="8485953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8485958">t</span><span class="op" id="8485959">.</span><span class="ident" id="8485960">Errorf</span><span class="op" id="8485966">(</span><span class="string" id="8485967">&#34;#%d:&nbsp;ReadResponse:&nbsp;%v&#34;</span><span class="op" id="8485990">,</span>&nbsp;<span class="ident" id="8485992">i</span><span class="op" id="8485993">,</span>&nbsp;<span class="ident" id="8485995">err</span><span class="op" id="8485998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486003">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486014">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486018">if</span>&nbsp;<span class="ident" id="8486021">code</span>&nbsp;<span class="op" id="8486026">!=</span>&nbsp;<span class="ident" id="8486029">tt</span><span class="op" id="8486031">.</span><span class="ident" id="8486032">wantCode</span>&nbsp;<span class="op" id="8486041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486046">t</span><span class="op" id="8486047">.</span><span class="ident" id="8486048">Errorf</span><span class="op" id="8486054">(</span><span class="string" id="8486055">&#34;#%d:&nbsp;code=%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8486078">,</span>&nbsp;<span class="ident" id="8486080">i</span><span class="op" id="8486081">,</span>&nbsp;<span class="ident" id="8486083">code</span><span class="op" id="8486087">,</span>&nbsp;<span class="ident" id="8486089">tt</span><span class="op" id="8486091">.</span><span class="ident" id="8486092">wantCode</span><span class="op" id="8486100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486108">if</span>&nbsp;<span class="ident" id="8486111">msg</span>&nbsp;<span class="op" id="8486115">!=</span>&nbsp;<span class="ident" id="8486118">tt</span><span class="op" id="8486120">.</span><span class="ident" id="8486121">wantMsg</span>&nbsp;<span class="op" id="8486129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486134">t</span><span class="op" id="8486135">.</span><span class="ident" id="8486136">Errorf</span><span class="op" id="8486142">(</span><span class="string" id="8486143">&#34;#%d:&nbsp;msg=%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8486165">,</span>&nbsp;<span class="ident" id="8486167">i</span><span class="op" id="8486168">,</span>&nbsp;<span class="ident" id="8486170">msg</span><span class="op" id="8486173">,</span>&nbsp;<span class="ident" id="8486175">tt</span><span class="op" id="8486177">.</span><span class="ident" id="8486178">wantMsg</span><span class="op" id="8486185">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486192">}</span><br>
<span class="lineno"></span><span class="op" id="8486194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486197">func</span>&nbsp;<span class="ident" id="8486202">TestCommonHeaders</span><span class="op" id="8486219">(</span><span class="ident" id="8486220">t</span>&nbsp;<span class="op" id="8486222">*</span><span class="ident" id="8486223">testing</span><span class="op" id="8486230">.</span><span class="ident" id="8486231">T</span><span class="op" id="8486232">)</span>&nbsp;<span class="op" id="8486234">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486237">for</span>&nbsp;<span class="ident" id="8486241">h</span>&nbsp;<span class="op" id="8486243">:=</span>&nbsp;<span class="keyword" id="8486246">range</span>&nbsp;<span class="ident" id="8486252">commonHeader</span>&nbsp;<span class="op" id="8486265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486269">if</span>&nbsp;<span class="ident" id="8486272">h</span>&nbsp;<span class="op" id="8486274">!=</span>&nbsp;<span class="ident" id="8486277">CanonicalMIMEHeaderKey</span><span class="op" id="8486299">(</span><span class="ident" id="8486300">h</span><span class="op" id="8486301">)</span>&nbsp;<span class="op" id="8486303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486308">t</span><span class="op" id="8486309">.</span><span class="ident" id="8486310">Errorf</span><span class="op" id="8486316">(</span><span class="string" id="8486317">&#34;Non-canonical&nbsp;header&nbsp;%q&nbsp;in&nbsp;commonHeader&#34;</span><span class="op" id="8486358">,</span>&nbsp;<span class="ident" id="8486360">h</span><span class="op" id="8486361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486368">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486371">b</span>&nbsp;<span class="op" id="8486373">:=</span>&nbsp;<span class="op" id="8486376">[</span><span class="op" id="8486377">]</span><span class="builtintype" id="8486378">byte</span><span class="op" id="8486382">(</span><span class="string" id="8486383">&#34;content-Length&#34;</span><span class="op" id="8486399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486402">want</span>&nbsp;<span class="op" id="8486407">:=</span>&nbsp;<span class="string" id="8486410">&#34;Content-Length&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486428">n</span>&nbsp;<span class="op" id="8486430">:=</span>&nbsp;<span class="ident" id="8486433">testing</span><span class="op" id="8486440">.</span><span class="ident" id="8486441">AllocsPerRun</span><span class="op" id="8486453">(</span><span class="num" id="8486454">200</span><span class="op" id="8486457">,</span>&nbsp;<span class="keyword" id="8486459">func</span><span class="op" id="8486463">(</span><span class="op" id="8486464">)</span>&nbsp;<span class="op" id="8486466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486470">if</span>&nbsp;<span class="ident" id="8486473">x</span>&nbsp;<span class="op" id="8486475">:=</span>&nbsp;<span class="ident" id="8486478">canonicalMIMEHeaderKey</span><span class="op" id="8486500">(</span><span class="ident" id="8486501">b</span><span class="op" id="8486502">)</span><span class="op" id="8486503">;</span>&nbsp;<span class="ident" id="8486505">x</span>&nbsp;<span class="op" id="8486507">!=</span>&nbsp;<span class="ident" id="8486510">want</span>&nbsp;<span class="op" id="8486515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486520">t</span><span class="op" id="8486521">.</span><span class="ident" id="8486522">Fatalf</span><span class="op" id="8486528">(</span><span class="string" id="8486529">&#34;canonicalMIMEHeaderKey(%q)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8486571">,</span>&nbsp;<span class="ident" id="8486573">b</span><span class="op" id="8486574">,</span>&nbsp;<span class="ident" id="8486576">x</span><span class="op" id="8486577">,</span>&nbsp;<span class="ident" id="8486579">want</span><span class="op" id="8486583">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486590">}</span><span class="op" id="8486591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8486594">if</span>&nbsp;<span class="ident" id="8486597">n</span>&nbsp;<span class="op" id="8486599">&gt;</span>&nbsp;<span class="num" id="8486601">0</span>&nbsp;<span class="op" id="8486603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8486607">t</span><span class="op" id="8486608">.</span><span class="ident" id="8486609">Errorf</span><span class="op" id="8486615">(</span><span class="string" id="8486616">&#34;canonicalMIMEHeaderKey&nbsp;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8486660">,</span>&nbsp;<span class="ident" id="8486662">n</span><span class="op" id="8486663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8486666">}</span><br>
<span class="lineno">265</span><span class="op" id="8486668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8486671">var</span>&nbsp;<span class="ident" id="8486675">clientHeaders</span>&nbsp;<span class="op" id="8486689">=</span>&nbsp;<span class="ident" id="8486691">strings</span><span class="op" id="8486698">.</span><span class="ident" id="8486699">Replace</span><span class="op" id="8486706">(</span><span class="string" id="8486707">`Host:&nbsp;golang.org<br>
<span class="lineno"></span>Connection:&nbsp;keep-alive<br>
<span class="lineno"></span>Cache-Control:&nbsp;max-age=0<br>
<span class="lineno">270</span>Accept:&nbsp;application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,*/*;q=0.5<br>
<span class="lineno"></span>User-Agent:&nbsp;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;x86_64;&nbsp;en-US)&nbsp;AppleWebKit/534.3&nbsp;(KHTML,&nbsp;like&nbsp;Gecko)&nbsp;Chrome/6.0.472.63&nbsp;Safari/534.3<br>
<span class="lineno"></span>Accept-Encoding:&nbsp;gzip,deflate,sdch<br>
<span class="lineno"></span>Accept-Language:&nbsp;en-US,en;q=0.8,fr-CH;q=0.6<br>
<span class="lineno"></span>Accept-Charset:&nbsp;ISO-8859-1,utf-8;q=0.7,*;q=0.3<br>
<span class="lineno">275</span>COOKIE:&nbsp;__utma=000000000.0000000000.0000000000.0000000000.0000000000.00;&nbsp;__utmb=000000000.0.00.0000000000;&nbsp;__utmc=000000000;&nbsp;__utmz=000000000.0000000000.00.0.utmcsr=code.google.com|utmccn=(referral)|utmcmd=referral|utmcct=/p/go/issues/detail<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno"></span>`</span><span class="op" id="8487384">,</span>&nbsp;<span class="string" id="8487386">&#34;\n&#34;</span><span class="op" id="8487390">,</span>&nbsp;<span class="string" id="8487392">&#34;\r\n&#34;</span><span class="op" id="8487398">,</span>&nbsp;<span class="op" id="8487400">-</span><span class="num" id="8487401">1</span><span class="op" id="8487402">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="8487405">var</span>&nbsp;<span class="ident" id="8487409">serverHeaders</span>&nbsp;<span class="op" id="8487423">=</span>&nbsp;<span class="ident" id="8487425">strings</span><span class="op" id="8487432">.</span><span class="ident" id="8487433">Replace</span><span class="op" id="8487440">(</span><span class="string" id="8487441">`Content-Type:&nbsp;text/html;&nbsp;charset=utf-8<br>
<span class="lineno"></span>Content-Encoding:&nbsp;gzip<br>
<span class="lineno"></span>Date:&nbsp;Thu,&nbsp;27&nbsp;Sep&nbsp;2012&nbsp;09:03:33&nbsp;GMT<br>
<span class="lineno"></span>Server:&nbsp;Google&nbsp;Frontend<br>
<span class="lineno"></span>Cache-Control:&nbsp;private<br>
<span class="lineno">285</span>Content-Length:&nbsp;2298<br>
<span class="lineno"></span>VIA:&nbsp;1.1&nbsp;proxy.example.com:80&nbsp;(XXX/n.n.n-nnn)<br>
<span class="lineno"></span>Connection:&nbsp;Close<br>
<span class="lineno"></span>Non-Interned:&nbsp;test<br>
<span class="lineno"></span><br>
<span class="lineno">290</span>`</span><span class="op" id="8487693">,</span>&nbsp;<span class="string" id="8487695">&#34;\n&#34;</span><span class="op" id="8487699">,</span>&nbsp;<span class="string" id="8487701">&#34;\r\n&#34;</span><span class="op" id="8487707">,</span>&nbsp;<span class="op" id="8487709">-</span><span class="num" id="8487710">1</span><span class="op" id="8487711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487714">func</span>&nbsp;<span class="ident" id="8487719">BenchmarkReadMIMEHeader</span><span class="op" id="8487742">(</span><span class="ident" id="8487743">b</span>&nbsp;<span class="op" id="8487745">*</span><span class="ident" id="8487746">testing</span><span class="op" id="8487753">.</span><span class="ident" id="8487754">B</span><span class="op" id="8487755">)</span>&nbsp;<span class="op" id="8487757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487760">b</span><span class="op" id="8487761">.</span><span class="ident" id="8487762">ReportAllocs</span><span class="op" id="8487774">(</span><span class="op" id="8487775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487778">var</span>&nbsp;<span class="ident" id="8487782">buf</span>&nbsp;<span class="ident" id="8487786">bytes</span><span class="op" id="8487791">.</span><span class="ident" id="8487792">Buffer</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487800">br</span>&nbsp;<span class="op" id="8487803">:=</span>&nbsp;<span class="ident" id="8487806">bufio</span><span class="op" id="8487811">.</span><span class="ident" id="8487812">NewReader</span><span class="op" id="8487821">(</span><span class="op" id="8487822">&amp;</span><span class="ident" id="8487823">buf</span><span class="op" id="8487826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487829">r</span>&nbsp;<span class="op" id="8487831">:=</span>&nbsp;<span class="ident" id="8487834">NewReader</span><span class="op" id="8487843">(</span><span class="ident" id="8487844">br</span><span class="op" id="8487846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487849">for</span>&nbsp;<span class="ident" id="8487853">i</span>&nbsp;<span class="op" id="8487855">:=</span>&nbsp;<span class="num" id="8487858">0</span><span class="op" id="8487859">;</span>&nbsp;<span class="ident" id="8487861">i</span>&nbsp;<span class="op" id="8487863">&lt;</span>&nbsp;<span class="ident" id="8487865">b</span><span class="op" id="8487866">.</span><span class="ident" id="8487867">N</span><span class="op" id="8487868">;</span>&nbsp;<span class="ident" id="8487870">i</span><span class="op" id="8487871">++</span>&nbsp;<span class="op" id="8487874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487878">var</span>&nbsp;<span class="ident" id="8487882">want</span>&nbsp;<span class="builtintype" id="8487887">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487893">var</span>&nbsp;<span class="ident" id="8487897">find</span>&nbsp;<span class="builtintype" id="8487902">string</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8487911">if</span>&nbsp;<span class="op" id="8487914">(</span><span class="ident" id="8487915">i</span>&nbsp;<span class="op" id="8487917">&amp;</span>&nbsp;<span class="num" id="8487919">1</span><span class="op" id="8487920">)</span>&nbsp;<span class="op" id="8487922">==</span>&nbsp;<span class="num" id="8487925">1</span>&nbsp;<span class="op" id="8487927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487932">buf</span><span class="op" id="8487935">.</span><span class="ident" id="8487936">WriteString</span><span class="op" id="8487947">(</span><span class="ident" id="8487948">clientHeaders</span><span class="op" id="8487961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487966">want</span>&nbsp;<span class="op" id="8487971">=</span>&nbsp;<span class="num" id="8487973">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8487979">find</span>&nbsp;<span class="op" id="8487984">=</span>&nbsp;<span class="string" id="8487986">&#34;Cookie&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8487997">}</span>&nbsp;<span class="keyword" id="8487999">else</span>&nbsp;<span class="op" id="8488004">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488009">buf</span><span class="op" id="8488012">.</span><span class="ident" id="8488013">WriteString</span><span class="op" id="8488024">(</span><span class="ident" id="8488025">serverHeaders</span><span class="op" id="8488038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488043">want</span>&nbsp;<span class="op" id="8488048">=</span>&nbsp;<span class="num" id="8488050">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488055">find</span>&nbsp;<span class="op" id="8488060">=</span>&nbsp;<span class="string" id="8488062">&#34;Via&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488074">h</span><span class="op" id="8488075">,</span>&nbsp;<span class="ident" id="8488077">err</span>&nbsp;<span class="op" id="8488081">:=</span>&nbsp;<span class="ident" id="8488084">r</span><span class="op" id="8488085">.</span><span class="ident" id="8488086">ReadMIMEHeader</span><span class="op" id="8488100">(</span><span class="op" id="8488101">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488105">if</span>&nbsp;<span class="ident" id="8488108">err</span>&nbsp;<span class="op" id="8488112">!=</span>&nbsp;<span class="ident" id="8488115">nil</span>&nbsp;<span class="op" id="8488119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488124">b</span><span class="op" id="8488125">.</span><span class="ident" id="8488126">Fatal</span><span class="op" id="8488131">(</span><span class="ident" id="8488132">err</span><span class="op" id="8488135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488143">if</span>&nbsp;<span class="builtinfunc" id="8488146">len</span><span class="op" id="8488149">(</span><span class="ident" id="8488150">h</span><span class="op" id="8488151">)</span>&nbsp;<span class="op" id="8488153">!=</span>&nbsp;<span class="ident" id="8488156">want</span>&nbsp;<span class="op" id="8488161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488166">b</span><span class="op" id="8488167">.</span><span class="ident" id="8488168">Fatalf</span><span class="op" id="8488174">(</span><span class="string" id="8488175">&#34;wrong&nbsp;number&nbsp;of&nbsp;headers:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8488217">,</span>&nbsp;<span class="builtinfunc" id="8488219">len</span><span class="op" id="8488222">(</span><span class="ident" id="8488223">h</span><span class="op" id="8488224">)</span><span class="op" id="8488225">,</span>&nbsp;<span class="ident" id="8488227">want</span><span class="op" id="8488231">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488239">if</span>&nbsp;<span class="ident" id="8488242">_</span><span class="op" id="8488243">,</span>&nbsp;<span class="ident" id="8488245">ok</span>&nbsp;<span class="op" id="8488248">:=</span>&nbsp;<span class="ident" id="8488251">h</span><span class="op" id="8488252">[</span><span class="ident" id="8488253">find</span><span class="op" id="8488257">]</span><span class="op" id="8488258">;</span>&nbsp;<span class="op" id="8488260">!</span><span class="ident" id="8488261">ok</span>&nbsp;<span class="op" id="8488264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488269">b</span><span class="op" id="8488270">.</span><span class="ident" id="8488271">Fatalf</span><span class="op" id="8488277">(</span><span class="string" id="8488278">&#34;did&nbsp;not&nbsp;find&nbsp;key&nbsp;%s&#34;</span><span class="op" id="8488299">,</span>&nbsp;<span class="ident" id="8488301">find</span><span class="op" id="8488305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488312">}</span><br>
<span class="lineno">320</span><span class="op" id="8488314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8488317">func</span>&nbsp;<span class="ident" id="8488322">BenchmarkUncommon</span><span class="op" id="8488339">(</span><span class="ident" id="8488340">b</span>&nbsp;<span class="op" id="8488342">*</span><span class="ident" id="8488343">testing</span><span class="op" id="8488350">.</span><span class="ident" id="8488351">B</span><span class="op" id="8488352">)</span>&nbsp;<span class="op" id="8488354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488357">b</span><span class="op" id="8488358">.</span><span class="ident" id="8488359">ReportAllocs</span><span class="op" id="8488371">(</span><span class="op" id="8488372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488375">var</span>&nbsp;<span class="ident" id="8488379">buf</span>&nbsp;<span class="ident" id="8488383">bytes</span><span class="op" id="8488388">.</span><span class="ident" id="8488389">Buffer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488397">br</span>&nbsp;<span class="op" id="8488400">:=</span>&nbsp;<span class="ident" id="8488403">bufio</span><span class="op" id="8488408">.</span><span class="ident" id="8488409">NewReader</span><span class="op" id="8488418">(</span><span class="op" id="8488419">&amp;</span><span class="ident" id="8488420">buf</span><span class="op" id="8488423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488426">r</span>&nbsp;<span class="op" id="8488428">:=</span>&nbsp;<span class="ident" id="8488431">NewReader</span><span class="op" id="8488440">(</span><span class="ident" id="8488441">br</span><span class="op" id="8488443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488446">for</span>&nbsp;<span class="ident" id="8488450">i</span>&nbsp;<span class="op" id="8488452">:=</span>&nbsp;<span class="num" id="8488455">0</span><span class="op" id="8488456">;</span>&nbsp;<span class="ident" id="8488458">i</span>&nbsp;<span class="op" id="8488460">&lt;</span>&nbsp;<span class="ident" id="8488462">b</span><span class="op" id="8488463">.</span><span class="ident" id="8488464">N</span><span class="op" id="8488465">;</span>&nbsp;<span class="ident" id="8488467">i</span><span class="op" id="8488468">++</span>&nbsp;<span class="op" id="8488471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488475">buf</span><span class="op" id="8488478">.</span><span class="ident" id="8488479">WriteString</span><span class="op" id="8488490">(</span><span class="string" id="8488491">&#34;uncommon-header-for-benchmark:&nbsp;foo\r\n\r\n&#34;</span><span class="op" id="8488535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488539">h</span><span class="op" id="8488540">,</span>&nbsp;<span class="ident" id="8488542">err</span>&nbsp;<span class="op" id="8488546">:=</span>&nbsp;<span class="ident" id="8488549">r</span><span class="op" id="8488550">.</span><span class="ident" id="8488551">ReadMIMEHeader</span><span class="op" id="8488565">(</span><span class="op" id="8488566">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488570">if</span>&nbsp;<span class="ident" id="8488573">err</span>&nbsp;<span class="op" id="8488577">!=</span>&nbsp;<span class="ident" id="8488580">nil</span>&nbsp;<span class="op" id="8488584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488589">b</span><span class="op" id="8488590">.</span><span class="ident" id="8488591">Fatal</span><span class="op" id="8488596">(</span><span class="ident" id="8488597">err</span><span class="op" id="8488600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8488608">if</span>&nbsp;<span class="ident" id="8488611">_</span><span class="op" id="8488612">,</span>&nbsp;<span class="ident" id="8488614">ok</span>&nbsp;<span class="op" id="8488617">:=</span>&nbsp;<span class="ident" id="8488620">h</span><span class="op" id="8488621">[</span><span class="string" id="8488622">&#34;Uncommon-Header-For-Benchmark&#34;</span><span class="op" id="8488653">]</span><span class="op" id="8488654">;</span>&nbsp;<span class="op" id="8488656">!</span><span class="ident" id="8488657">ok</span>&nbsp;<span class="op" id="8488660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8488665">b</span><span class="op" id="8488666">.</span><span class="ident" id="8488667">Fatal</span><span class="op" id="8488672">(</span><span class="string" id="8488673">&#34;Missing&nbsp;result&nbsp;header.&#34;</span><span class="op" id="8488697">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8488704">}</span><br>
<span class="lineno"></span><span class="op" id="8488706">}</span>
</div>
</body>
</html>
