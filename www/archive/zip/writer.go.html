<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6075295">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6075350">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6075404">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6075455">package</span>&nbsp;<span class="ident" id="6075463">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6075468">import</span>&nbsp;<span class="op" id="6075475">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075478">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075487">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075506">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075516">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075524">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6075538">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6075543">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6075546">//&nbsp;TODO(adg):&nbsp;support&nbsp;zip&nbsp;file&nbsp;comments</span><br>
<span class="lineno"></span><span class="comment" id="6075586">//&nbsp;TODO(adg):&nbsp;support&nbsp;specifying&nbsp;deflate&nbsp;level</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075634">//&nbsp;Writer&nbsp;implements&nbsp;a&nbsp;zip&nbsp;file&nbsp;writer.</span><br>
<span class="lineno">20</span><span class="keyword" id="6075674">type</span>&nbsp;<span class="ident" id="6075679">Writer</span>&nbsp;<span class="keyword" id="6075686">struct</span>&nbsp;<span class="op" id="6075693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075696">cw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075703">*</span><span class="ident" id="6075704">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075717">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6075724">[</span><span class="op" id="6075725">]</span><span class="op" id="6075726">*</span><span class="ident" id="6075727">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075735">last</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6075742">*</span><span class="ident" id="6075743">fileWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075755">closed</span>&nbsp;<span class="builtintype" id="6075762">bool</span><br>
<span class="lineno">25</span><span class="op" id="6075767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6075770">type</span>&nbsp;<span class="ident" id="6075775">header</span>&nbsp;<span class="keyword" id="6075782">struct</span>&nbsp;<span class="op" id="6075789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6075792">*</span><span class="ident" id="6075793">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6075805">offset</span>&nbsp;<span class="ident" id="6075812">uint64</span><br>
<span class="lineno">30</span><span class="op" id="6075819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075822">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;a&nbsp;zip&nbsp;file&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6075881">func</span>&nbsp;<span class="ident" id="6075886">NewWriter</span><span class="op" id="6075895">(</span><span class="ident" id="6075896">w</span>&nbsp;<span class="ident" id="6075898">io</span><span class="op" id="6075900">.</span><span class="ident" id="6075901">Writer</span><span class="op" id="6075907">)</span>&nbsp;<span class="op" id="6075909">*</span><span class="ident" id="6075910">Writer</span>&nbsp;<span class="op" id="6075917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6075920">return</span>&nbsp;<span class="op" id="6075927">&amp;</span><span class="ident" id="6075928">Writer</span><span class="op" id="6075934">{</span><span class="ident" id="6075935">cw</span><span class="op" id="6075937">:</span>&nbsp;<span class="op" id="6075939">&amp;</span><span class="ident" id="6075940">countWriter</span><span class="op" id="6075951">{</span><span class="ident" id="6075952">w</span><span class="op" id="6075953">:</span>&nbsp;<span class="ident" id="6075955">bufio</span><span class="op" id="6075960">.</span><span class="ident" id="6075961">NewWriter</span><span class="op" id="6075970">(</span><span class="ident" id="6075971">w</span><span class="op" id="6075972">)</span><span class="op" id="6075973">}</span><span class="op" id="6075974">}</span><br>
<span class="lineno">35</span><span class="op" id="6075976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6075979">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="6076040">//&nbsp;Calling&nbsp;Flush&nbsp;is&nbsp;not&nbsp;normally&nbsp;necessary;&nbsp;calling&nbsp;Close&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="keyword" id="6076113">func</span>&nbsp;<span class="op" id="6076118">(</span><span class="ident" id="6076119">w</span>&nbsp;<span class="op" id="6076121">*</span><span class="ident" id="6076122">Writer</span><span class="op" id="6076128">)</span>&nbsp;<span class="ident" id="6076130">Flush</span><span class="op" id="6076135">(</span><span class="op" id="6076136">)</span>&nbsp;<span class="builtintype" id="6076138">error</span>&nbsp;<span class="op" id="6076144">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076147">return</span>&nbsp;<span class="ident" id="6076154">w</span><span class="op" id="6076155">.</span><span class="ident" id="6076156">cw</span><span class="op" id="6076158">.</span><span class="ident" id="6076159">w</span><span class="op" id="6076160">.</span><span class="op" id="6076161">(</span><span class="op" id="6076162">*</span><span class="ident" id="6076163">bufio</span><span class="op" id="6076168">.</span><span class="ident" id="6076169">Writer</span><span class="op" id="6076175">)</span><span class="op" id="6076176">.</span><span class="ident" id="6076177">Flush</span><span class="op" id="6076182">(</span><span class="op" id="6076183">)</span><br>
<span class="lineno"></span><span class="op" id="6076185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6076188">//&nbsp;Close&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;zip&nbsp;file&nbsp;by&nbsp;writing&nbsp;the&nbsp;central&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="6076261">//&nbsp;It&nbsp;does&nbsp;not&nbsp;(and&nbsp;can&nbsp;not)&nbsp;close&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">45</span><span class="keyword" id="6076319">func</span>&nbsp;<span class="op" id="6076324">(</span><span class="ident" id="6076325">w</span>&nbsp;<span class="op" id="6076327">*</span><span class="ident" id="6076328">Writer</span><span class="op" id="6076334">)</span>&nbsp;<span class="ident" id="6076336">Close</span><span class="op" id="6076341">(</span><span class="op" id="6076342">)</span>&nbsp;<span class="builtintype" id="6076344">error</span>&nbsp;<span class="op" id="6076350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076353">if</span>&nbsp;<span class="ident" id="6076356">w</span><span class="op" id="6076357">.</span><span class="ident" id="6076358">last</span>&nbsp;<span class="op" id="6076363">!=</span>&nbsp;<span class="ident" id="6076366">nil</span>&nbsp;<span class="op" id="6076370">&amp;&amp;</span>&nbsp;<span class="op" id="6076373">!</span><span class="ident" id="6076374">w</span><span class="op" id="6076375">.</span><span class="ident" id="6076376">last</span><span class="op" id="6076380">.</span><span class="ident" id="6076381">closed</span>&nbsp;<span class="op" id="6076388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076392">if</span>&nbsp;<span class="ident" id="6076395">err</span>&nbsp;<span class="op" id="6076399">:=</span>&nbsp;<span class="ident" id="6076402">w</span><span class="op" id="6076403">.</span><span class="ident" id="6076404">last</span><span class="op" id="6076408">.</span><span class="builtinfunc" id="6076409">close</span><span class="op" id="6076414">(</span><span class="op" id="6076415">)</span><span class="op" id="6076416">;</span>&nbsp;<span class="ident" id="6076418">err</span>&nbsp;<span class="op" id="6076422">!=</span>&nbsp;<span class="ident" id="6076425">nil</span>&nbsp;<span class="op" id="6076429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076434">return</span>&nbsp;<span class="ident" id="6076441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076447">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076451">w</span><span class="op" id="6076452">.</span><span class="ident" id="6076453">last</span>&nbsp;<span class="op" id="6076458">=</span>&nbsp;<span class="ident" id="6076460">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076468">if</span>&nbsp;<span class="ident" id="6076471">w</span><span class="op" id="6076472">.</span><span class="ident" id="6076473">closed</span>&nbsp;<span class="op" id="6076480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076484">return</span>&nbsp;<span class="ident" id="6076491">errors</span><span class="op" id="6076497">.</span><span class="ident" id="6076498">New</span><span class="op" id="6076501">(</span><span class="string" id="6076502">&#34;zip:&nbsp;writer&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6076528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6076531">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076534">w</span><span class="op" id="6076535">.</span><span class="ident" id="6076536">closed</span>&nbsp;<span class="op" id="6076543">=</span>&nbsp;<span class="ident" id="6076545">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6076552">//&nbsp;write&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076580">start</span>&nbsp;<span class="op" id="6076586">:=</span>&nbsp;<span class="ident" id="6076589">w</span><span class="op" id="6076590">.</span><span class="ident" id="6076591">cw</span><span class="op" id="6076593">.</span><span class="ident" id="6076594">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076601">for</span>&nbsp;<span class="ident" id="6076605">_</span><span class="op" id="6076606">,</span>&nbsp;<span class="ident" id="6076608">h</span>&nbsp;<span class="op" id="6076610">:=</span>&nbsp;<span class="keyword" id="6076613">range</span>&nbsp;<span class="ident" id="6076619">w</span><span class="op" id="6076620">.</span><span class="ident" id="6076621">dir</span>&nbsp;<span class="op" id="6076625">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076629">var</span>&nbsp;<span class="ident" id="6076633">buf</span>&nbsp;<span class="op" id="6076637">[</span><span class="ident" id="6076638">directoryHeaderLen</span><span class="op" id="6076656">]</span><span class="builtintype" id="6076657">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076664">b</span>&nbsp;<span class="op" id="6076666">:=</span>&nbsp;<span class="ident" id="6076669">writeBuf</span><span class="op" id="6076677">(</span><span class="ident" id="6076678">buf</span><span class="op" id="6076681">[</span><span class="op" id="6076682">:</span><span class="op" id="6076683">]</span><span class="op" id="6076684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076688">b</span><span class="op" id="6076689">.</span><span class="builtintype" id="6076690">uint32</span><span class="op" id="6076696">(</span><span class="builtintype" id="6076697">uint32</span><span class="op" id="6076703">(</span><span class="ident" id="6076704">directoryHeaderSignature</span><span class="op" id="6076728">)</span><span class="op" id="6076729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076733">b</span><span class="op" id="6076734">.</span><span class="builtintype" id="6076735">uint16</span><span class="op" id="6076741">(</span><span class="ident" id="6076742">h</span><span class="op" id="6076743">.</span><span class="ident" id="6076744">CreatorVersion</span><span class="op" id="6076758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076762">b</span><span class="op" id="6076763">.</span><span class="builtintype" id="6076764">uint16</span><span class="op" id="6076770">(</span><span class="ident" id="6076771">h</span><span class="op" id="6076772">.</span><span class="ident" id="6076773">ReaderVersion</span><span class="op" id="6076786">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076790">b</span><span class="op" id="6076791">.</span><span class="builtintype" id="6076792">uint16</span><span class="op" id="6076798">(</span><span class="ident" id="6076799">h</span><span class="op" id="6076800">.</span><span class="ident" id="6076801">Flags</span><span class="op" id="6076806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076810">b</span><span class="op" id="6076811">.</span><span class="builtintype" id="6076812">uint16</span><span class="op" id="6076818">(</span><span class="ident" id="6076819">h</span><span class="op" id="6076820">.</span><span class="ident" id="6076821">Method</span><span class="op" id="6076827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076831">b</span><span class="op" id="6076832">.</span><span class="builtintype" id="6076833">uint16</span><span class="op" id="6076839">(</span><span class="ident" id="6076840">h</span><span class="op" id="6076841">.</span><span class="ident" id="6076842">ModifiedTime</span><span class="op" id="6076854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076858">b</span><span class="op" id="6076859">.</span><span class="builtintype" id="6076860">uint16</span><span class="op" id="6076866">(</span><span class="ident" id="6076867">h</span><span class="op" id="6076868">.</span><span class="ident" id="6076869">ModifiedDate</span><span class="op" id="6076881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6076885">b</span><span class="op" id="6076886">.</span><span class="builtintype" id="6076887">uint32</span><span class="op" id="6076893">(</span><span class="ident" id="6076894">h</span><span class="op" id="6076895">.</span><span class="ident" id="6076896">CRC32</span><span class="op" id="6076901">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6076905">if</span>&nbsp;<span class="ident" id="6076908">h</span><span class="op" id="6076909">.</span><span class="ident" id="6076910">isZip64</span><span class="op" id="6076917">(</span><span class="op" id="6076918">)</span>&nbsp;<span class="op" id="6076920">||</span>&nbsp;<span class="ident" id="6076923">h</span><span class="op" id="6076924">.</span><span class="ident" id="6076925">offset</span>&nbsp;<span class="op" id="6076932">&gt;</span>&nbsp;<span class="ident" id="6076934">uint32max</span>&nbsp;<span class="op" id="6076944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6076949">//&nbsp;the&nbsp;file&nbsp;needs&nbsp;a&nbsp;zip64&nbsp;header.&nbsp;store&nbsp;maxint&nbsp;in&nbsp;both</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077007">//&nbsp;32&nbsp;bit&nbsp;size&nbsp;fields&nbsp;(and&nbsp;offset&nbsp;later)&nbsp;to&nbsp;signal&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077070">//&nbsp;zip64&nbsp;extra&nbsp;header&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077111">b</span><span class="op" id="6077112">.</span><span class="builtintype" id="6077113">uint32</span><span class="op" id="6077119">(</span><span class="ident" id="6077120">uint32max</span><span class="op" id="6077129">)</span>&nbsp;<span class="comment" id="6077131">//&nbsp;compressed&nbsp;size</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077153">b</span><span class="op" id="6077154">.</span><span class="builtintype" id="6077155">uint32</span><span class="op" id="6077161">(</span><span class="ident" id="6077162">uint32max</span><span class="op" id="6077171">)</span>&nbsp;<span class="comment" id="6077173">//&nbsp;uncompressed&nbsp;size</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6077198">//&nbsp;append&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;block&nbsp;to&nbsp;Extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077240">var</span>&nbsp;<span class="ident" id="6077244">buf</span>&nbsp;<span class="op" id="6077248">[</span><span class="num" id="6077249">28</span><span class="op" id="6077251">]</span><span class="builtintype" id="6077252">byte</span>&nbsp;<span class="comment" id="6077257">//&nbsp;2x&nbsp;uint16&nbsp;+&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077285">eb</span>&nbsp;<span class="op" id="6077288">:=</span>&nbsp;<span class="ident" id="6077291">writeBuf</span><span class="op" id="6077299">(</span><span class="ident" id="6077300">buf</span><span class="op" id="6077303">[</span><span class="op" id="6077304">:</span><span class="op" id="6077305">]</span><span class="op" id="6077306">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077311">eb</span><span class="op" id="6077313">.</span><span class="builtintype" id="6077314">uint16</span><span class="op" id="6077320">(</span><span class="ident" id="6077321">zip64ExtraId</span><span class="op" id="6077333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077338">eb</span><span class="op" id="6077340">.</span><span class="builtintype" id="6077341">uint16</span><span class="op" id="6077347">(</span><span class="num" id="6077348">24</span><span class="op" id="6077350">)</span>&nbsp;<span class="comment" id="6077352">//&nbsp;size&nbsp;=&nbsp;3x&nbsp;uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077375">eb</span><span class="op" id="6077377">.</span><span class="ident" id="6077378">uint64</span><span class="op" id="6077384">(</span><span class="ident" id="6077385">h</span><span class="op" id="6077386">.</span><span class="ident" id="6077387">UncompressedSize64</span><span class="op" id="6077405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077410">eb</span><span class="op" id="6077412">.</span><span class="ident" id="6077413">uint64</span><span class="op" id="6077419">(</span><span class="ident" id="6077420">h</span><span class="op" id="6077421">.</span><span class="ident" id="6077422">CompressedSize64</span><span class="op" id="6077438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077443">eb</span><span class="op" id="6077445">.</span><span class="ident" id="6077446">uint64</span><span class="op" id="6077452">(</span><span class="ident" id="6077453">h</span><span class="op" id="6077454">.</span><span class="ident" id="6077455">offset</span><span class="op" id="6077461">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077466">h</span><span class="op" id="6077467">.</span><span class="ident" id="6077468">Extra</span>&nbsp;<span class="op" id="6077474">=</span>&nbsp;<span class="builtinfunc" id="6077476">append</span><span class="op" id="6077482">(</span><span class="ident" id="6077483">h</span><span class="op" id="6077484">.</span><span class="ident" id="6077485">Extra</span><span class="op" id="6077490">,</span>&nbsp;<span class="ident" id="6077492">buf</span><span class="op" id="6077495">[</span><span class="op" id="6077496">:</span><span class="op" id="6077497">]</span><span class="op" id="6077498">...</span><span class="op" id="6077501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077505">}</span>&nbsp;<span class="keyword" id="6077507">else</span>&nbsp;<span class="op" id="6077512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077517">b</span><span class="op" id="6077518">.</span><span class="builtintype" id="6077519">uint32</span><span class="op" id="6077525">(</span><span class="ident" id="6077526">h</span><span class="op" id="6077527">.</span><span class="ident" id="6077528">CompressedSize</span><span class="op" id="6077542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077547">b</span><span class="op" id="6077548">.</span><span class="builtintype" id="6077549">uint32</span><span class="op" id="6077555">(</span><span class="ident" id="6077556">h</span><span class="op" id="6077557">.</span><span class="ident" id="6077558">UncompressedSize</span><span class="op" id="6077574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077578">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077582">b</span><span class="op" id="6077583">.</span><span class="builtintype" id="6077584">uint16</span><span class="op" id="6077590">(</span><span class="builtintype" id="6077591">uint16</span><span class="op" id="6077597">(</span><span class="builtinfunc" id="6077598">len</span><span class="op" id="6077601">(</span><span class="ident" id="6077602">h</span><span class="op" id="6077603">.</span><span class="ident" id="6077604">Name</span><span class="op" id="6077608">)</span><span class="op" id="6077609">)</span><span class="op" id="6077610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077614">b</span><span class="op" id="6077615">.</span><span class="builtintype" id="6077616">uint16</span><span class="op" id="6077622">(</span><span class="builtintype" id="6077623">uint16</span><span class="op" id="6077629">(</span><span class="builtinfunc" id="6077630">len</span><span class="op" id="6077633">(</span><span class="ident" id="6077634">h</span><span class="op" id="6077635">.</span><span class="ident" id="6077636">Extra</span><span class="op" id="6077641">)</span><span class="op" id="6077642">)</span><span class="op" id="6077643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077647">b</span><span class="op" id="6077648">.</span><span class="builtintype" id="6077649">uint16</span><span class="op" id="6077655">(</span><span class="builtintype" id="6077656">uint16</span><span class="op" id="6077662">(</span><span class="builtinfunc" id="6077663">len</span><span class="op" id="6077666">(</span><span class="ident" id="6077667">h</span><span class="op" id="6077668">.</span><span class="ident" id="6077669">Comment</span><span class="op" id="6077676">)</span><span class="op" id="6077677">)</span><span class="op" id="6077678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077682">b</span>&nbsp;<span class="op" id="6077684">=</span>&nbsp;<span class="ident" id="6077686">b</span><span class="op" id="6077687">[</span><span class="num" id="6077688">4</span><span class="op" id="6077689">:</span><span class="op" id="6077690">]</span>&nbsp;<span class="comment" id="6077692">//&nbsp;skip&nbsp;disk&nbsp;number&nbsp;start&nbsp;and&nbsp;internal&nbsp;file&nbsp;attr&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077755">b</span><span class="op" id="6077756">.</span><span class="builtintype" id="6077757">uint32</span><span class="op" id="6077763">(</span><span class="ident" id="6077764">h</span><span class="op" id="6077765">.</span><span class="ident" id="6077766">ExternalAttrs</span><span class="op" id="6077779">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077783">if</span>&nbsp;<span class="ident" id="6077786">h</span><span class="op" id="6077787">.</span><span class="ident" id="6077788">offset</span>&nbsp;<span class="op" id="6077795">&gt;</span>&nbsp;<span class="ident" id="6077797">uint32max</span>&nbsp;<span class="op" id="6077807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077812">b</span><span class="op" id="6077813">.</span><span class="builtintype" id="6077814">uint32</span><span class="op" id="6077820">(</span><span class="ident" id="6077821">uint32max</span><span class="op" id="6077830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077834">}</span>&nbsp;<span class="keyword" id="6077836">else</span>&nbsp;<span class="op" id="6077841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6077846">b</span><span class="op" id="6077847">.</span><span class="builtintype" id="6077848">uint32</span><span class="op" id="6077854">(</span><span class="builtintype" id="6077855">uint32</span><span class="op" id="6077861">(</span><span class="ident" id="6077862">h</span><span class="op" id="6077863">.</span><span class="ident" id="6077864">offset</span><span class="op" id="6077870">)</span><span class="op" id="6077871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077875">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077879">if</span>&nbsp;<span class="ident" id="6077882">_</span><span class="op" id="6077883">,</span>&nbsp;<span class="ident" id="6077885">err</span>&nbsp;<span class="op" id="6077889">:=</span>&nbsp;<span class="ident" id="6077892">w</span><span class="op" id="6077893">.</span><span class="ident" id="6077894">cw</span><span class="op" id="6077896">.</span><span class="ident" id="6077897">Write</span><span class="op" id="6077902">(</span><span class="ident" id="6077903">buf</span><span class="op" id="6077906">[</span><span class="op" id="6077907">:</span><span class="op" id="6077908">]</span><span class="op" id="6077909">)</span><span class="op" id="6077910">;</span>&nbsp;<span class="ident" id="6077912">err</span>&nbsp;<span class="op" id="6077916">!=</span>&nbsp;<span class="ident" id="6077919">nil</span>&nbsp;<span class="op" id="6077923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077928">return</span>&nbsp;<span class="ident" id="6077935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6077941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6077945">if</span>&nbsp;<span class="ident" id="6077948">_</span><span class="op" id="6077949">,</span>&nbsp;<span class="ident" id="6077951">err</span>&nbsp;<span class="op" id="6077955">:=</span>&nbsp;<span class="ident" id="6077958">io</span><span class="op" id="6077960">.</span><span class="ident" id="6077961">WriteString</span><span class="op" id="6077972">(</span><span class="ident" id="6077973">w</span><span class="op" id="6077974">.</span><span class="ident" id="6077975">cw</span><span class="op" id="6077977">,</span>&nbsp;<span class="ident" id="6077979">h</span><span class="op" id="6077980">.</span><span class="ident" id="6077981">Name</span><span class="op" id="6077985">)</span><span class="op" id="6077986">;</span>&nbsp;<span class="ident" id="6077988">err</span>&nbsp;<span class="op" id="6077992">!=</span>&nbsp;<span class="ident" id="6077995">nil</span>&nbsp;<span class="op" id="6077999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078004">return</span>&nbsp;<span class="ident" id="6078011">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078021">if</span>&nbsp;<span class="ident" id="6078024">_</span><span class="op" id="6078025">,</span>&nbsp;<span class="ident" id="6078027">err</span>&nbsp;<span class="op" id="6078031">:=</span>&nbsp;<span class="ident" id="6078034">w</span><span class="op" id="6078035">.</span><span class="ident" id="6078036">cw</span><span class="op" id="6078038">.</span><span class="ident" id="6078039">Write</span><span class="op" id="6078044">(</span><span class="ident" id="6078045">h</span><span class="op" id="6078046">.</span><span class="ident" id="6078047">Extra</span><span class="op" id="6078052">)</span><span class="op" id="6078053">;</span>&nbsp;<span class="ident" id="6078055">err</span>&nbsp;<span class="op" id="6078059">!=</span>&nbsp;<span class="ident" id="6078062">nil</span>&nbsp;<span class="op" id="6078066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078071">return</span>&nbsp;<span class="ident" id="6078078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078088">if</span>&nbsp;<span class="ident" id="6078091">_</span><span class="op" id="6078092">,</span>&nbsp;<span class="ident" id="6078094">err</span>&nbsp;<span class="op" id="6078098">:=</span>&nbsp;<span class="ident" id="6078101">io</span><span class="op" id="6078103">.</span><span class="ident" id="6078104">WriteString</span><span class="op" id="6078115">(</span><span class="ident" id="6078116">w</span><span class="op" id="6078117">.</span><span class="ident" id="6078118">cw</span><span class="op" id="6078120">,</span>&nbsp;<span class="ident" id="6078122">h</span><span class="op" id="6078123">.</span><span class="ident" id="6078124">Comment</span><span class="op" id="6078131">)</span><span class="op" id="6078132">;</span>&nbsp;<span class="ident" id="6078134">err</span>&nbsp;<span class="op" id="6078138">!=</span>&nbsp;<span class="ident" id="6078141">nil</span>&nbsp;<span class="op" id="6078145">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078150">return</span>&nbsp;<span class="ident" id="6078157">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6078166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078169">end</span>&nbsp;<span class="op" id="6078173">:=</span>&nbsp;<span class="ident" id="6078176">w</span><span class="op" id="6078177">.</span><span class="ident" id="6078178">cw</span><span class="op" id="6078180">.</span><span class="ident" id="6078181">count</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078189">records</span>&nbsp;<span class="op" id="6078197">:=</span>&nbsp;<span class="ident" id="6078200">uint64</span><span class="op" id="6078206">(</span><span class="builtinfunc" id="6078207">len</span><span class="op" id="6078210">(</span><span class="ident" id="6078211">w</span><span class="op" id="6078212">.</span><span class="ident" id="6078213">dir</span><span class="op" id="6078216">)</span><span class="op" id="6078217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078220">size</span>&nbsp;<span class="op" id="6078225">:=</span>&nbsp;<span class="ident" id="6078228">uint64</span><span class="op" id="6078234">(</span><span class="ident" id="6078235">end</span>&nbsp;<span class="op" id="6078239">-</span>&nbsp;<span class="ident" id="6078241">start</span><span class="op" id="6078246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078249">offset</span>&nbsp;<span class="op" id="6078256">:=</span>&nbsp;<span class="ident" id="6078259">uint64</span><span class="op" id="6078265">(</span><span class="ident" id="6078266">start</span><span class="op" id="6078271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078275">if</span>&nbsp;<span class="ident" id="6078278">records</span>&nbsp;<span class="op" id="6078286">&gt;</span>&nbsp;<span class="ident" id="6078288">uint16max</span>&nbsp;<span class="op" id="6078298">||</span>&nbsp;<span class="ident" id="6078301">size</span>&nbsp;<span class="op" id="6078306">&gt;</span>&nbsp;<span class="ident" id="6078308">uint32max</span>&nbsp;<span class="op" id="6078318">||</span>&nbsp;<span class="ident" id="6078321">offset</span>&nbsp;<span class="op" id="6078328">&gt;</span>&nbsp;<span class="ident" id="6078330">uint32max</span>&nbsp;<span class="op" id="6078340">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6078344">var</span>&nbsp;<span class="ident" id="6078348">buf</span>&nbsp;<span class="op" id="6078352">[</span><span class="ident" id="6078353">directory64EndLen</span>&nbsp;<span class="op" id="6078371">+</span>&nbsp;<span class="ident" id="6078373">directory64LocLen</span><span class="op" id="6078390">]</span><span class="builtintype" id="6078391">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078398">b</span>&nbsp;<span class="op" id="6078400">:=</span>&nbsp;<span class="ident" id="6078403">writeBuf</span><span class="op" id="6078411">(</span><span class="ident" id="6078412">buf</span><span class="op" id="6078415">[</span><span class="op" id="6078416">:</span><span class="op" id="6078417">]</span><span class="op" id="6078418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6078423">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078466">b</span><span class="op" id="6078467">.</span><span class="builtintype" id="6078468">uint32</span><span class="op" id="6078474">(</span><span class="ident" id="6078475">directory64EndSignature</span><span class="op" id="6078498">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078502">b</span><span class="op" id="6078503">.</span><span class="ident" id="6078504">uint64</span><span class="op" id="6078510">(</span><span class="ident" id="6078511">directory64EndLen</span><span class="op" id="6078528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078532">b</span><span class="op" id="6078533">.</span><span class="builtintype" id="6078534">uint16</span><span class="op" id="6078540">(</span><span class="ident" id="6078541">zipVersion45</span><span class="op" id="6078553">)</span>&nbsp;<span class="comment" id="6078555">//&nbsp;version&nbsp;made&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078576">b</span><span class="op" id="6078577">.</span><span class="builtintype" id="6078578">uint16</span><span class="op" id="6078584">(</span><span class="ident" id="6078585">zipVersion45</span><span class="op" id="6078597">)</span>&nbsp;<span class="comment" id="6078599">//&nbsp;version&nbsp;needed&nbsp;to&nbsp;extract</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078630">b</span><span class="op" id="6078631">.</span><span class="builtintype" id="6078632">uint32</span><span class="op" id="6078638">(</span><span class="num" id="6078639">0</span><span class="op" id="6078640">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6078653">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078678">b</span><span class="op" id="6078679">.</span><span class="builtintype" id="6078680">uint32</span><span class="op" id="6078686">(</span><span class="num" id="6078687">0</span><span class="op" id="6078688">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6078701">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078765">b</span><span class="op" id="6078766">.</span><span class="ident" id="6078767">uint64</span><span class="op" id="6078773">(</span><span class="ident" id="6078774">records</span><span class="op" id="6078781">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6078788">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078855">b</span><span class="op" id="6078856">.</span><span class="ident" id="6078857">uint64</span><span class="op" id="6078863">(</span><span class="ident" id="6078864">records</span><span class="op" id="6078871">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6078878">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078932">b</span><span class="op" id="6078933">.</span><span class="ident" id="6078934">uint64</span><span class="op" id="6078940">(</span><span class="ident" id="6078941">size</span><span class="op" id="6078945">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6078955">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6078990">b</span><span class="op" id="6078991">.</span><span class="ident" id="6078992">uint64</span><span class="op" id="6078998">(</span><span class="ident" id="6078999">offset</span><span class="op" id="6079005">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079013">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079097">//&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;locator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079141">b</span><span class="op" id="6079142">.</span><span class="builtintype" id="6079143">uint32</span><span class="op" id="6079149">(</span><span class="ident" id="6079150">directory64LocSignature</span><span class="op" id="6079173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079177">b</span><span class="op" id="6079178">.</span><span class="builtintype" id="6079179">uint32</span><span class="op" id="6079185">(</span><span class="num" id="6079186">0</span><span class="op" id="6079187">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079199">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079276">b</span><span class="op" id="6079277">.</span><span class="ident" id="6079278">uint64</span><span class="op" id="6079284">(</span><span class="ident" id="6079285">uint64</span><span class="op" id="6079291">(</span><span class="ident" id="6079292">end</span><span class="op" id="6079295">)</span><span class="op" id="6079296">)</span>&nbsp;<span class="comment" id="6079298">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079364">b</span><span class="op" id="6079365">.</span><span class="builtintype" id="6079366">uint32</span><span class="op" id="6079372">(</span><span class="num" id="6079373">1</span><span class="op" id="6079374">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079386">//&nbsp;total&nbsp;number&nbsp;of&nbsp;disks</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079414">if</span>&nbsp;<span class="ident" id="6079417">_</span><span class="op" id="6079418">,</span>&nbsp;<span class="ident" id="6079420">err</span>&nbsp;<span class="op" id="6079424">:=</span>&nbsp;<span class="ident" id="6079427">w</span><span class="op" id="6079428">.</span><span class="ident" id="6079429">cw</span><span class="op" id="6079431">.</span><span class="ident" id="6079432">Write</span><span class="op" id="6079437">(</span><span class="ident" id="6079438">buf</span><span class="op" id="6079441">[</span><span class="op" id="6079442">:</span><span class="op" id="6079443">]</span><span class="op" id="6079444">)</span><span class="op" id="6079445">;</span>&nbsp;<span class="ident" id="6079447">err</span>&nbsp;<span class="op" id="6079451">!=</span>&nbsp;<span class="ident" id="6079454">nil</span>&nbsp;<span class="op" id="6079458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079463">return</span>&nbsp;<span class="ident" id="6079470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079481">//&nbsp;store&nbsp;max&nbsp;values&nbsp;in&nbsp;the&nbsp;regular&nbsp;end&nbsp;record&nbsp;to&nbsp;signal&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079544">//&nbsp;that&nbsp;the&nbsp;zip64&nbsp;values&nbsp;should&nbsp;be&nbsp;used&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079594">records</span>&nbsp;<span class="op" id="6079602">=</span>&nbsp;<span class="ident" id="6079604">uint16max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079616">size</span>&nbsp;<span class="op" id="6079621">=</span>&nbsp;<span class="ident" id="6079623">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079635">offset</span>&nbsp;<span class="op" id="6079642">=</span>&nbsp;<span class="ident" id="6079644">uint32max</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6079655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6079659">//&nbsp;write&nbsp;end&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6079680">var</span>&nbsp;<span class="ident" id="6079684">buf</span>&nbsp;<span class="op" id="6079688">[</span><span class="ident" id="6079689">directoryEndLen</span><span class="op" id="6079704">]</span><span class="builtintype" id="6079705">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079711">b</span>&nbsp;<span class="op" id="6079713">:=</span>&nbsp;<span class="ident" id="6079716">writeBuf</span><span class="op" id="6079724">(</span><span class="ident" id="6079725">buf</span><span class="op" id="6079728">[</span><span class="op" id="6079729">:</span><span class="op" id="6079730">]</span><span class="op" id="6079731">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079734">b</span><span class="op" id="6079735">.</span><span class="builtintype" id="6079736">uint32</span><span class="op" id="6079742">(</span><span class="builtintype" id="6079743">uint32</span><span class="op" id="6079749">(</span><span class="ident" id="6079750">directoryEndSignature</span><span class="op" id="6079771">)</span><span class="op" id="6079772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079775">b</span>&nbsp;<span class="op" id="6079777">=</span>&nbsp;<span class="ident" id="6079779">b</span><span class="op" id="6079780">[</span><span class="num" id="6079781">4</span><span class="op" id="6079782">:</span><span class="op" id="6079783">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079801">//&nbsp;skip&nbsp;over&nbsp;disk&nbsp;number&nbsp;and&nbsp;first&nbsp;disk&nbsp;number&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079861">b</span><span class="op" id="6079862">.</span><span class="builtintype" id="6079863">uint16</span><span class="op" id="6079869">(</span><span class="builtintype" id="6079870">uint16</span><span class="op" id="6079876">(</span><span class="ident" id="6079877">records</span><span class="op" id="6079884">)</span><span class="op" id="6079885">)</span>&nbsp;<span class="comment" id="6079887">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079919">b</span><span class="op" id="6079920">.</span><span class="builtintype" id="6079921">uint16</span><span class="op" id="6079927">(</span><span class="builtintype" id="6079928">uint16</span><span class="op" id="6079934">(</span><span class="ident" id="6079935">records</span><span class="op" id="6079942">)</span><span class="op" id="6079943">)</span>&nbsp;<span class="comment" id="6079945">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;total</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6079973">b</span><span class="op" id="6079974">.</span><span class="builtintype" id="6079975">uint32</span><span class="op" id="6079981">(</span><span class="builtintype" id="6079982">uint32</span><span class="op" id="6079988">(</span><span class="ident" id="6079989">size</span><span class="op" id="6079993">)</span><span class="op" id="6079994">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6079999">//&nbsp;size&nbsp;of&nbsp;directory</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080021">b</span><span class="op" id="6080022">.</span><span class="builtintype" id="6080023">uint32</span><span class="op" id="6080029">(</span><span class="builtintype" id="6080030">uint32</span><span class="op" id="6080036">(</span><span class="ident" id="6080037">offset</span><span class="op" id="6080043">)</span><span class="op" id="6080044">)</span>&nbsp;&nbsp;<span class="comment" id="6080047">//&nbsp;start&nbsp;of&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6080070">//&nbsp;skipped&nbsp;size&nbsp;of&nbsp;comment&nbsp;(always&nbsp;zero)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080112">if</span>&nbsp;<span class="ident" id="6080115">_</span><span class="op" id="6080116">,</span>&nbsp;<span class="ident" id="6080118">err</span>&nbsp;<span class="op" id="6080122">:=</span>&nbsp;<span class="ident" id="6080125">w</span><span class="op" id="6080126">.</span><span class="ident" id="6080127">cw</span><span class="op" id="6080129">.</span><span class="ident" id="6080130">Write</span><span class="op" id="6080135">(</span><span class="ident" id="6080136">buf</span><span class="op" id="6080139">[</span><span class="op" id="6080140">:</span><span class="op" id="6080141">]</span><span class="op" id="6080142">)</span><span class="op" id="6080143">;</span>&nbsp;<span class="ident" id="6080145">err</span>&nbsp;<span class="op" id="6080149">!=</span>&nbsp;<span class="ident" id="6080152">nil</span>&nbsp;<span class="op" id="6080156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080160">return</span>&nbsp;<span class="ident" id="6080167">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080172">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080176">return</span>&nbsp;<span class="ident" id="6080183">w</span><span class="op" id="6080184">.</span><span class="ident" id="6080185">cw</span><span class="op" id="6080187">.</span><span class="ident" id="6080188">w</span><span class="op" id="6080189">.</span><span class="op" id="6080190">(</span><span class="op" id="6080191">*</span><span class="ident" id="6080192">bufio</span><span class="op" id="6080197">.</span><span class="ident" id="6080198">Writer</span><span class="op" id="6080204">)</span><span class="op" id="6080205">.</span><span class="ident" id="6080206">Flush</span><span class="op" id="6080211">(</span><span class="op" id="6080212">)</span><br>
<span class="lineno"></span><span class="op" id="6080214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080217">//&nbsp;Create&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno">170</span><span class="comment" id="6080280">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6080349">//&nbsp;The&nbsp;name&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span><span class="comment" id="6080417">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="6080484">//&nbsp;allowed.</span><br>
<span class="lineno"></span><span class="comment" id="6080496">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno">175</span><span class="comment" id="6080568">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6080611">func</span>&nbsp;<span class="op" id="6080616">(</span><span class="ident" id="6080617">w</span>&nbsp;<span class="op" id="6080619">*</span><span class="ident" id="6080620">Writer</span><span class="op" id="6080626">)</span>&nbsp;<span class="ident" id="6080628">Create</span><span class="op" id="6080634">(</span><span class="ident" id="6080635">name</span>&nbsp;<span class="builtintype" id="6080640">string</span><span class="op" id="6080646">)</span>&nbsp;<span class="op" id="6080648">(</span><span class="ident" id="6080649">io</span><span class="op" id="6080651">.</span><span class="ident" id="6080652">Writer</span><span class="op" id="6080658">,</span>&nbsp;<span class="builtintype" id="6080660">error</span><span class="op" id="6080665">)</span>&nbsp;<span class="op" id="6080667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080670">header</span>&nbsp;<span class="op" id="6080677">:=</span>&nbsp;<span class="op" id="6080680">&amp;</span><span class="ident" id="6080681">FileHeader</span><span class="op" id="6080691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080695">Name</span><span class="op" id="6080699">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6080703">name</span><span class="op" id="6080707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080711">Method</span><span class="op" id="6080717">:</span>&nbsp;<span class="ident" id="6080719">Deflate</span><span class="op" id="6080726">,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6080729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6080732">return</span>&nbsp;<span class="ident" id="6080739">w</span><span class="op" id="6080740">.</span><span class="ident" id="6080741">CreateHeader</span><span class="op" id="6080753">(</span><span class="ident" id="6080754">header</span><span class="op" id="6080760">)</span><br>
<span class="lineno"></span><span class="op" id="6080762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080765">//&nbsp;CreateHeader&nbsp;adds&nbsp;a&nbsp;file&nbsp;to&nbsp;the&nbsp;zip&nbsp;file&nbsp;using&nbsp;the&nbsp;provided&nbsp;FileHeader</span><br>
<span class="lineno">185</span><span class="comment" id="6080839">//&nbsp;for&nbsp;the&nbsp;file&nbsp;metadata.</span><br>
<span class="lineno"></span><span class="comment" id="6080865">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;to&nbsp;which&nbsp;the&nbsp;file&nbsp;contents&nbsp;should&nbsp;be&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="6080934">//&nbsp;The&nbsp;file&#39;s&nbsp;contents&nbsp;must&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;io.Writer&nbsp;before&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6081006">//&nbsp;call&nbsp;to&nbsp;Create,&nbsp;CreateHeader,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6081049">func</span>&nbsp;<span class="op" id="6081054">(</span><span class="ident" id="6081055">w</span>&nbsp;<span class="op" id="6081057">*</span><span class="ident" id="6081058">Writer</span><span class="op" id="6081064">)</span>&nbsp;<span class="ident" id="6081066">CreateHeader</span><span class="op" id="6081078">(</span><span class="ident" id="6081079">fh</span>&nbsp;<span class="op" id="6081082">*</span><span class="ident" id="6081083">FileHeader</span><span class="op" id="6081093">)</span>&nbsp;<span class="op" id="6081095">(</span><span class="ident" id="6081096">io</span><span class="op" id="6081098">.</span><span class="ident" id="6081099">Writer</span><span class="op" id="6081105">,</span>&nbsp;<span class="builtintype" id="6081107">error</span><span class="op" id="6081112">)</span>&nbsp;<span class="op" id="6081114">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081117">if</span>&nbsp;<span class="ident" id="6081120">w</span><span class="op" id="6081121">.</span><span class="ident" id="6081122">last</span>&nbsp;<span class="op" id="6081127">!=</span>&nbsp;<span class="ident" id="6081130">nil</span>&nbsp;<span class="op" id="6081134">&amp;&amp;</span>&nbsp;<span class="op" id="6081137">!</span><span class="ident" id="6081138">w</span><span class="op" id="6081139">.</span><span class="ident" id="6081140">last</span><span class="op" id="6081144">.</span><span class="ident" id="6081145">closed</span>&nbsp;<span class="op" id="6081152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081156">if</span>&nbsp;<span class="ident" id="6081159">err</span>&nbsp;<span class="op" id="6081163">:=</span>&nbsp;<span class="ident" id="6081166">w</span><span class="op" id="6081167">.</span><span class="ident" id="6081168">last</span><span class="op" id="6081172">.</span><span class="builtinfunc" id="6081173">close</span><span class="op" id="6081178">(</span><span class="op" id="6081179">)</span><span class="op" id="6081180">;</span>&nbsp;<span class="ident" id="6081182">err</span>&nbsp;<span class="op" id="6081186">!=</span>&nbsp;<span class="ident" id="6081189">nil</span>&nbsp;<span class="op" id="6081193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081198">return</span>&nbsp;<span class="ident" id="6081205">nil</span><span class="op" id="6081208">,</span>&nbsp;<span class="ident" id="6081210">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081219">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081223">fh</span><span class="op" id="6081225">.</span><span class="ident" id="6081226">Flags</span>&nbsp;<span class="op" id="6081232">|=</span>&nbsp;<span class="num" id="6081235">0x8</span>&nbsp;<span class="comment" id="6081239">//&nbsp;we&nbsp;will&nbsp;write&nbsp;a&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081276">fh</span><span class="op" id="6081278">.</span><span class="ident" id="6081279">CreatorVersion</span>&nbsp;<span class="op" id="6081294">=</span>&nbsp;<span class="ident" id="6081296">fh</span><span class="op" id="6081298">.</span><span class="ident" id="6081299">CreatorVersion</span><span class="op" id="6081313">&amp;</span><span class="num" id="6081314">0xff00</span>&nbsp;<span class="op" id="6081321">|</span>&nbsp;<span class="ident" id="6081323">zipVersion20</span>&nbsp;<span class="comment" id="6081336">//&nbsp;preserve&nbsp;compatibility&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081368">fh</span><span class="op" id="6081370">.</span><span class="ident" id="6081371">ReaderVersion</span>&nbsp;<span class="op" id="6081385">=</span>&nbsp;<span class="ident" id="6081387">zipVersion20</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081402">fw</span>&nbsp;<span class="op" id="6081405">:=</span>&nbsp;<span class="op" id="6081408">&amp;</span><span class="ident" id="6081409">fileWriter</span><span class="op" id="6081419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081423">zipw</span><span class="op" id="6081427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081434">w</span><span class="op" id="6081435">.</span><span class="ident" id="6081436">cw</span><span class="op" id="6081438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081442">compCount</span><span class="op" id="6081451">:</span>&nbsp;<span class="op" id="6081453">&amp;</span><span class="ident" id="6081454">countWriter</span><span class="op" id="6081465">{</span><span class="ident" id="6081466">w</span><span class="op" id="6081467">:</span>&nbsp;<span class="ident" id="6081469">w</span><span class="op" id="6081470">.</span><span class="ident" id="6081471">cw</span><span class="op" id="6081473">}</span><span class="op" id="6081474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081478">crc32</span><span class="op" id="6081483">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081489">crc32</span><span class="op" id="6081494">.</span><span class="ident" id="6081495">NewIEEE</span><span class="op" id="6081502">(</span><span class="op" id="6081503">)</span><span class="op" id="6081504">,</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081510">comp</span>&nbsp;<span class="op" id="6081515">:=</span>&nbsp;<span class="ident" id="6081518">compressor</span><span class="op" id="6081528">(</span><span class="ident" id="6081529">fh</span><span class="op" id="6081531">.</span><span class="ident" id="6081532">Method</span><span class="op" id="6081538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081541">if</span>&nbsp;<span class="ident" id="6081544">comp</span>&nbsp;<span class="op" id="6081549">==</span>&nbsp;<span class="ident" id="6081552">nil</span>&nbsp;<span class="op" id="6081556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081560">return</span>&nbsp;<span class="ident" id="6081567">nil</span><span class="op" id="6081570">,</span>&nbsp;<span class="ident" id="6081572">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081586">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081589">var</span>&nbsp;<span class="ident" id="6081593">err</span>&nbsp;<span class="builtintype" id="6081597">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081604">fw</span><span class="op" id="6081606">.</span><span class="ident" id="6081607">comp</span><span class="op" id="6081611">,</span>&nbsp;<span class="ident" id="6081613">err</span>&nbsp;<span class="op" id="6081617">=</span>&nbsp;<span class="ident" id="6081619">comp</span><span class="op" id="6081623">(</span><span class="ident" id="6081624">fw</span><span class="op" id="6081626">.</span><span class="ident" id="6081627">compCount</span><span class="op" id="6081636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081639">if</span>&nbsp;<span class="ident" id="6081642">err</span>&nbsp;<span class="op" id="6081646">!=</span>&nbsp;<span class="ident" id="6081649">nil</span>&nbsp;<span class="op" id="6081653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081657">return</span>&nbsp;<span class="ident" id="6081664">nil</span><span class="op" id="6081667">,</span>&nbsp;<span class="ident" id="6081669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081674">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081677">fw</span><span class="op" id="6081679">.</span><span class="ident" id="6081680">rawCount</span>&nbsp;<span class="op" id="6081689">=</span>&nbsp;<span class="op" id="6081691">&amp;</span><span class="ident" id="6081692">countWriter</span><span class="op" id="6081703">{</span><span class="ident" id="6081704">w</span><span class="op" id="6081705">:</span>&nbsp;<span class="ident" id="6081707">fw</span><span class="op" id="6081709">.</span><span class="ident" id="6081710">comp</span><span class="op" id="6081714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081718">h</span>&nbsp;<span class="op" id="6081720">:=</span>&nbsp;<span class="op" id="6081723">&amp;</span><span class="ident" id="6081724">header</span><span class="op" id="6081730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081734">FileHeader</span><span class="op" id="6081744">:</span>&nbsp;<span class="ident" id="6081746">fh</span><span class="op" id="6081748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081752">offset</span><span class="op" id="6081758">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081764">uint64</span><span class="op" id="6081770">(</span><span class="ident" id="6081771">w</span><span class="op" id="6081772">.</span><span class="ident" id="6081773">cw</span><span class="op" id="6081775">.</span><span class="ident" id="6081776">count</span><span class="op" id="6081781">)</span><span class="op" id="6081782">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081788">w</span><span class="op" id="6081789">.</span><span class="ident" id="6081790">dir</span>&nbsp;<span class="op" id="6081794">=</span>&nbsp;<span class="builtinfunc" id="6081796">append</span><span class="op" id="6081802">(</span><span class="ident" id="6081803">w</span><span class="op" id="6081804">.</span><span class="ident" id="6081805">dir</span><span class="op" id="6081808">,</span>&nbsp;<span class="ident" id="6081810">h</span><span class="op" id="6081811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081814">fw</span><span class="op" id="6081816">.</span><span class="ident" id="6081817">header</span>&nbsp;<span class="op" id="6081824">=</span>&nbsp;<span class="ident" id="6081826">h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081830">if</span>&nbsp;<span class="ident" id="6081833">err</span>&nbsp;<span class="op" id="6081837">:=</span>&nbsp;<span class="ident" id="6081840">writeHeader</span><span class="op" id="6081851">(</span><span class="ident" id="6081852">w</span><span class="op" id="6081853">.</span><span class="ident" id="6081854">cw</span><span class="op" id="6081856">,</span>&nbsp;<span class="ident" id="6081858">fh</span><span class="op" id="6081860">)</span><span class="op" id="6081861">;</span>&nbsp;<span class="ident" id="6081863">err</span>&nbsp;<span class="op" id="6081867">!=</span>&nbsp;<span class="ident" id="6081870">nil</span>&nbsp;<span class="op" id="6081874">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081878">return</span>&nbsp;<span class="ident" id="6081885">nil</span><span class="op" id="6081888">,</span>&nbsp;<span class="ident" id="6081890">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081899">w</span><span class="op" id="6081900">.</span><span class="ident" id="6081901">last</span>&nbsp;<span class="op" id="6081906">=</span>&nbsp;<span class="ident" id="6081908">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081912">return</span>&nbsp;<span class="ident" id="6081919">fw</span><span class="op" id="6081921">,</span>&nbsp;<span class="ident" id="6081923">nil</span><br>
<span class="lineno">230</span><span class="op" id="6081927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6081930">func</span>&nbsp;<span class="ident" id="6081935">writeHeader</span><span class="op" id="6081946">(</span><span class="ident" id="6081947">w</span>&nbsp;<span class="ident" id="6081949">io</span><span class="op" id="6081951">.</span><span class="ident" id="6081952">Writer</span><span class="op" id="6081958">,</span>&nbsp;<span class="ident" id="6081960">h</span>&nbsp;<span class="op" id="6081962">*</span><span class="ident" id="6081963">FileHeader</span><span class="op" id="6081973">)</span>&nbsp;<span class="builtintype" id="6081975">error</span>&nbsp;<span class="op" id="6081981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081984">var</span>&nbsp;<span class="ident" id="6081988">buf</span>&nbsp;<span class="op" id="6081992">[</span><span class="ident" id="6081993">fileHeaderLen</span><span class="op" id="6082006">]</span><span class="builtintype" id="6082007">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082013">b</span>&nbsp;<span class="op" id="6082015">:=</span>&nbsp;<span class="ident" id="6082018">writeBuf</span><span class="op" id="6082026">(</span><span class="ident" id="6082027">buf</span><span class="op" id="6082030">[</span><span class="op" id="6082031">:</span><span class="op" id="6082032">]</span><span class="op" id="6082033">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082036">b</span><span class="op" id="6082037">.</span><span class="builtintype" id="6082038">uint32</span><span class="op" id="6082044">(</span><span class="builtintype" id="6082045">uint32</span><span class="op" id="6082051">(</span><span class="ident" id="6082052">fileHeaderSignature</span><span class="op" id="6082071">)</span><span class="op" id="6082072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082075">b</span><span class="op" id="6082076">.</span><span class="builtintype" id="6082077">uint16</span><span class="op" id="6082083">(</span><span class="ident" id="6082084">h</span><span class="op" id="6082085">.</span><span class="ident" id="6082086">ReaderVersion</span><span class="op" id="6082099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082102">b</span><span class="op" id="6082103">.</span><span class="builtintype" id="6082104">uint16</span><span class="op" id="6082110">(</span><span class="ident" id="6082111">h</span><span class="op" id="6082112">.</span><span class="ident" id="6082113">Flags</span><span class="op" id="6082118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082121">b</span><span class="op" id="6082122">.</span><span class="builtintype" id="6082123">uint16</span><span class="op" id="6082129">(</span><span class="ident" id="6082130">h</span><span class="op" id="6082131">.</span><span class="ident" id="6082132">Method</span><span class="op" id="6082138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082141">b</span><span class="op" id="6082142">.</span><span class="builtintype" id="6082143">uint16</span><span class="op" id="6082149">(</span><span class="ident" id="6082150">h</span><span class="op" id="6082151">.</span><span class="ident" id="6082152">ModifiedTime</span><span class="op" id="6082164">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082167">b</span><span class="op" id="6082168">.</span><span class="builtintype" id="6082169">uint16</span><span class="op" id="6082175">(</span><span class="ident" id="6082176">h</span><span class="op" id="6082177">.</span><span class="ident" id="6082178">ModifiedDate</span><span class="op" id="6082190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082193">b</span><span class="op" id="6082194">.</span><span class="builtintype" id="6082195">uint32</span><span class="op" id="6082201">(</span><span class="num" id="6082202">0</span><span class="op" id="6082203">)</span>&nbsp;<span class="comment" id="6082205">//&nbsp;since&nbsp;we&nbsp;are&nbsp;writing&nbsp;a&nbsp;data&nbsp;descriptor&nbsp;crc32,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082255">b</span><span class="op" id="6082256">.</span><span class="builtintype" id="6082257">uint32</span><span class="op" id="6082263">(</span><span class="num" id="6082264">0</span><span class="op" id="6082265">)</span>&nbsp;<span class="comment" id="6082267">//&nbsp;compressed&nbsp;size,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082288">b</span><span class="op" id="6082289">.</span><span class="builtintype" id="6082290">uint32</span><span class="op" id="6082296">(</span><span class="num" id="6082297">0</span><span class="op" id="6082298">)</span>&nbsp;<span class="comment" id="6082300">//&nbsp;and&nbsp;uncompressed&nbsp;size&nbsp;should&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082341">b</span><span class="op" id="6082342">.</span><span class="builtintype" id="6082343">uint16</span><span class="op" id="6082349">(</span><span class="builtintype" id="6082350">uint16</span><span class="op" id="6082356">(</span><span class="builtinfunc" id="6082357">len</span><span class="op" id="6082360">(</span><span class="ident" id="6082361">h</span><span class="op" id="6082362">.</span><span class="ident" id="6082363">Name</span><span class="op" id="6082367">)</span><span class="op" id="6082368">)</span><span class="op" id="6082369">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082372">b</span><span class="op" id="6082373">.</span><span class="builtintype" id="6082374">uint16</span><span class="op" id="6082380">(</span><span class="builtintype" id="6082381">uint16</span><span class="op" id="6082387">(</span><span class="builtinfunc" id="6082388">len</span><span class="op" id="6082391">(</span><span class="ident" id="6082392">h</span><span class="op" id="6082393">.</span><span class="ident" id="6082394">Extra</span><span class="op" id="6082399">)</span><span class="op" id="6082400">)</span><span class="op" id="6082401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082404">if</span>&nbsp;<span class="ident" id="6082407">_</span><span class="op" id="6082408">,</span>&nbsp;<span class="ident" id="6082410">err</span>&nbsp;<span class="op" id="6082414">:=</span>&nbsp;<span class="ident" id="6082417">w</span><span class="op" id="6082418">.</span><span class="ident" id="6082419">Write</span><span class="op" id="6082424">(</span><span class="ident" id="6082425">buf</span><span class="op" id="6082428">[</span><span class="op" id="6082429">:</span><span class="op" id="6082430">]</span><span class="op" id="6082431">)</span><span class="op" id="6082432">;</span>&nbsp;<span class="ident" id="6082434">err</span>&nbsp;<span class="op" id="6082438">!=</span>&nbsp;<span class="ident" id="6082441">nil</span>&nbsp;<span class="op" id="6082445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082449">return</span>&nbsp;<span class="ident" id="6082456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082464">if</span>&nbsp;<span class="ident" id="6082467">_</span><span class="op" id="6082468">,</span>&nbsp;<span class="ident" id="6082470">err</span>&nbsp;<span class="op" id="6082474">:=</span>&nbsp;<span class="ident" id="6082477">io</span><span class="op" id="6082479">.</span><span class="ident" id="6082480">WriteString</span><span class="op" id="6082491">(</span><span class="ident" id="6082492">w</span><span class="op" id="6082493">,</span>&nbsp;<span class="ident" id="6082495">h</span><span class="op" id="6082496">.</span><span class="ident" id="6082497">Name</span><span class="op" id="6082501">)</span><span class="op" id="6082502">;</span>&nbsp;<span class="ident" id="6082504">err</span>&nbsp;<span class="op" id="6082508">!=</span>&nbsp;<span class="ident" id="6082511">nil</span>&nbsp;<span class="op" id="6082515">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082519">return</span>&nbsp;<span class="ident" id="6082526">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082534">_</span><span class="op" id="6082535">,</span>&nbsp;<span class="ident" id="6082537">err</span>&nbsp;<span class="op" id="6082541">:=</span>&nbsp;<span class="ident" id="6082544">w</span><span class="op" id="6082545">.</span><span class="ident" id="6082546">Write</span><span class="op" id="6082551">(</span><span class="ident" id="6082552">h</span><span class="op" id="6082553">.</span><span class="ident" id="6082554">Extra</span><span class="op" id="6082559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082562">return</span>&nbsp;<span class="ident" id="6082569">err</span><br>
<span class="lineno"></span><span class="op" id="6082573">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6082576">type</span>&nbsp;<span class="ident" id="6082581">fileWriter</span>&nbsp;<span class="keyword" id="6082592">struct</span>&nbsp;<span class="op" id="6082599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082602">*</span><span class="ident" id="6082603">header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082611">zipw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082621">io</span><span class="op" id="6082623">.</span><span class="ident" id="6082624">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082632">rawCount</span>&nbsp;&nbsp;<span class="op" id="6082642">*</span><span class="ident" id="6082643">countWriter</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082656">comp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082666">io</span><span class="op" id="6082668">.</span><span class="ident" id="6082669">WriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082682">compCount</span>&nbsp;<span class="op" id="6082692">*</span><span class="ident" id="6082693">countWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082706">crc32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6082716">hash</span><span class="op" id="6082720">.</span><span class="ident" id="6082721">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082729">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6082739">bool</span><br>
<span class="lineno"></span><span class="op" id="6082744">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="6082747">func</span>&nbsp;<span class="op" id="6082752">(</span><span class="ident" id="6082753">w</span>&nbsp;<span class="op" id="6082755">*</span><span class="ident" id="6082756">fileWriter</span><span class="op" id="6082766">)</span>&nbsp;<span class="ident" id="6082768">Write</span><span class="op" id="6082773">(</span><span class="ident" id="6082774">p</span>&nbsp;<span class="op" id="6082776">[</span><span class="op" id="6082777">]</span><span class="builtintype" id="6082778">byte</span><span class="op" id="6082782">)</span>&nbsp;<span class="op" id="6082784">(</span><span class="builtintype" id="6082785">int</span><span class="op" id="6082788">,</span>&nbsp;<span class="builtintype" id="6082790">error</span><span class="op" id="6082795">)</span>&nbsp;<span class="op" id="6082797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082800">if</span>&nbsp;<span class="ident" id="6082803">w</span><span class="op" id="6082804">.</span><span class="ident" id="6082805">closed</span>&nbsp;<span class="op" id="6082812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082816">return</span>&nbsp;<span class="num" id="6082823">0</span><span class="op" id="6082824">,</span>&nbsp;<span class="ident" id="6082826">errors</span><span class="op" id="6082832">.</span><span class="ident" id="6082833">New</span><span class="op" id="6082836">(</span><span class="string" id="6082837">&#34;zip:&nbsp;write&nbsp;to&nbsp;closed&nbsp;file&#34;</span><span class="op" id="6082864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082867">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082870">w</span><span class="op" id="6082871">.</span><span class="ident" id="6082872">crc32</span><span class="op" id="6082877">.</span><span class="ident" id="6082878">Write</span><span class="op" id="6082883">(</span><span class="ident" id="6082884">p</span><span class="op" id="6082885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082888">return</span>&nbsp;<span class="ident" id="6082895">w</span><span class="op" id="6082896">.</span><span class="ident" id="6082897">rawCount</span><span class="op" id="6082905">.</span><span class="ident" id="6082906">Write</span><span class="op" id="6082911">(</span><span class="ident" id="6082912">p</span><span class="op" id="6082913">)</span><br>
<span class="lineno"></span><span class="op" id="6082915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6082918">func</span>&nbsp;<span class="op" id="6082923">(</span><span class="ident" id="6082924">w</span>&nbsp;<span class="op" id="6082926">*</span><span class="ident" id="6082927">fileWriter</span><span class="op" id="6082937">)</span>&nbsp;<span class="builtinfunc" id="6082939">close</span><span class="op" id="6082944">(</span><span class="op" id="6082945">)</span>&nbsp;<span class="builtintype" id="6082947">error</span>&nbsp;<span class="op" id="6082953">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082956">if</span>&nbsp;<span class="ident" id="6082959">w</span><span class="op" id="6082960">.</span><span class="ident" id="6082961">closed</span>&nbsp;<span class="op" id="6082968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082972">return</span>&nbsp;<span class="ident" id="6082979">errors</span><span class="op" id="6082985">.</span><span class="ident" id="6082986">New</span><span class="op" id="6082989">(</span><span class="string" id="6082990">&#34;zip:&nbsp;file&nbsp;closed&nbsp;twice&#34;</span><span class="op" id="6083014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083020">w</span><span class="op" id="6083021">.</span><span class="ident" id="6083022">closed</span>&nbsp;<span class="op" id="6083029">=</span>&nbsp;<span class="ident" id="6083031">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083037">if</span>&nbsp;<span class="ident" id="6083040">err</span>&nbsp;<span class="op" id="6083044">:=</span>&nbsp;<span class="ident" id="6083047">w</span><span class="op" id="6083048">.</span><span class="ident" id="6083049">comp</span><span class="op" id="6083053">.</span><span class="ident" id="6083054">Close</span><span class="op" id="6083059">(</span><span class="op" id="6083060">)</span><span class="op" id="6083061">;</span>&nbsp;<span class="ident" id="6083063">err</span>&nbsp;<span class="op" id="6083067">!=</span>&nbsp;<span class="ident" id="6083070">nil</span>&nbsp;<span class="op" id="6083074">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083078">return</span>&nbsp;<span class="ident" id="6083085">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083094">//&nbsp;update&nbsp;FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083116">fh</span>&nbsp;<span class="op" id="6083119">:=</span>&nbsp;<span class="ident" id="6083122">w</span><span class="op" id="6083123">.</span><span class="ident" id="6083124">header</span><span class="op" id="6083130">.</span><span class="ident" id="6083131">FileHeader</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083143">fh</span><span class="op" id="6083145">.</span><span class="ident" id="6083146">CRC32</span>&nbsp;<span class="op" id="6083152">=</span>&nbsp;<span class="ident" id="6083154">w</span><span class="op" id="6083155">.</span><span class="ident" id="6083156">crc32</span><span class="op" id="6083161">.</span><span class="ident" id="6083162">Sum32</span><span class="op" id="6083167">(</span><span class="op" id="6083168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083171">fh</span><span class="op" id="6083173">.</span><span class="ident" id="6083174">CompressedSize64</span>&nbsp;<span class="op" id="6083191">=</span>&nbsp;<span class="ident" id="6083193">uint64</span><span class="op" id="6083199">(</span><span class="ident" id="6083200">w</span><span class="op" id="6083201">.</span><span class="ident" id="6083202">compCount</span><span class="op" id="6083211">.</span><span class="ident" id="6083212">count</span><span class="op" id="6083217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083220">fh</span><span class="op" id="6083222">.</span><span class="ident" id="6083223">UncompressedSize64</span>&nbsp;<span class="op" id="6083242">=</span>&nbsp;<span class="ident" id="6083244">uint64</span><span class="op" id="6083250">(</span><span class="ident" id="6083251">w</span><span class="op" id="6083252">.</span><span class="ident" id="6083253">rawCount</span><span class="op" id="6083261">.</span><span class="ident" id="6083262">count</span><span class="op" id="6083267">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083271">if</span>&nbsp;<span class="ident" id="6083274">fh</span><span class="op" id="6083276">.</span><span class="ident" id="6083277">isZip64</span><span class="op" id="6083284">(</span><span class="op" id="6083285">)</span>&nbsp;<span class="op" id="6083287">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083291">fh</span><span class="op" id="6083293">.</span><span class="ident" id="6083294">CompressedSize</span>&nbsp;<span class="op" id="6083309">=</span>&nbsp;<span class="ident" id="6083311">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083323">fh</span><span class="op" id="6083325">.</span><span class="ident" id="6083326">UncompressedSize</span>&nbsp;<span class="op" id="6083343">=</span>&nbsp;<span class="ident" id="6083345">uint32max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083357">fh</span><span class="op" id="6083359">.</span><span class="ident" id="6083360">ReaderVersion</span>&nbsp;<span class="op" id="6083374">=</span>&nbsp;<span class="ident" id="6083376">zipVersion45</span>&nbsp;<span class="comment" id="6083389">//&nbsp;requires&nbsp;4.5&nbsp;-&nbsp;File&nbsp;uses&nbsp;ZIP64&nbsp;format&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083442">}</span>&nbsp;<span class="keyword" id="6083444">else</span>&nbsp;<span class="op" id="6083449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083453">fh</span><span class="op" id="6083455">.</span><span class="ident" id="6083456">CompressedSize</span>&nbsp;<span class="op" id="6083471">=</span>&nbsp;<span class="builtintype" id="6083473">uint32</span><span class="op" id="6083479">(</span><span class="ident" id="6083480">fh</span><span class="op" id="6083482">.</span><span class="ident" id="6083483">CompressedSize64</span><span class="op" id="6083499">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083503">fh</span><span class="op" id="6083505">.</span><span class="ident" id="6083506">UncompressedSize</span>&nbsp;<span class="op" id="6083523">=</span>&nbsp;<span class="builtintype" id="6083525">uint32</span><span class="op" id="6083531">(</span><span class="ident" id="6083532">fh</span><span class="op" id="6083534">.</span><span class="ident" id="6083535">UncompressedSize64</span><span class="op" id="6083553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083560">//&nbsp;Write&nbsp;data&nbsp;descriptor.&nbsp;This&nbsp;is&nbsp;more&nbsp;complicated&nbsp;than&nbsp;one&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083627">//&nbsp;think,&nbsp;see&nbsp;e.g.&nbsp;comments&nbsp;in&nbsp;zipfile.c:putextended()&nbsp;and</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083687">//&nbsp;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7073588.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083751">//&nbsp;The&nbsp;approach&nbsp;here&nbsp;is&nbsp;to&nbsp;write&nbsp;8&nbsp;byte&nbsp;sizes&nbsp;if&nbsp;needed&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083816">//&nbsp;adding&nbsp;a&nbsp;zip64&nbsp;extra&nbsp;in&nbsp;the&nbsp;local&nbsp;header&nbsp;(too&nbsp;late&nbsp;anyway).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083880">var</span>&nbsp;<span class="ident" id="6083884">buf</span>&nbsp;<span class="op" id="6083888">[</span><span class="op" id="6083889">]</span><span class="builtintype" id="6083890">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083896">if</span>&nbsp;<span class="ident" id="6083899">fh</span><span class="op" id="6083901">.</span><span class="ident" id="6083902">isZip64</span><span class="op" id="6083909">(</span><span class="op" id="6083910">)</span>&nbsp;<span class="op" id="6083912">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083916">buf</span>&nbsp;<span class="op" id="6083920">=</span>&nbsp;<span class="builtinfunc" id="6083922">make</span><span class="op" id="6083926">(</span><span class="op" id="6083927">[</span><span class="op" id="6083928">]</span><span class="builtintype" id="6083929">byte</span><span class="op" id="6083933">,</span>&nbsp;<span class="ident" id="6083935">dataDescriptor64Len</span><span class="op" id="6083954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083957">}</span>&nbsp;<span class="keyword" id="6083959">else</span>&nbsp;<span class="op" id="6083964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083968">buf</span>&nbsp;<span class="op" id="6083972">=</span>&nbsp;<span class="builtinfunc" id="6083974">make</span><span class="op" id="6083978">(</span><span class="op" id="6083979">[</span><span class="op" id="6083980">]</span><span class="builtintype" id="6083981">byte</span><span class="op" id="6083985">,</span>&nbsp;<span class="ident" id="6083987">dataDescriptorLen</span><span class="op" id="6084004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084010">b</span>&nbsp;<span class="op" id="6084012">:=</span>&nbsp;<span class="ident" id="6084015">writeBuf</span><span class="op" id="6084023">(</span><span class="ident" id="6084024">buf</span><span class="op" id="6084027">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084030">b</span><span class="op" id="6084031">.</span><span class="builtintype" id="6084032">uint32</span><span class="op" id="6084038">(</span><span class="ident" id="6084039">dataDescriptorSignature</span><span class="op" id="6084062">)</span>&nbsp;<span class="comment" id="6084064">//&nbsp;de-facto&nbsp;standard,&nbsp;required&nbsp;by&nbsp;OS&nbsp;X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084104">b</span><span class="op" id="6084105">.</span><span class="builtintype" id="6084106">uint32</span><span class="op" id="6084112">(</span><span class="ident" id="6084113">fh</span><span class="op" id="6084115">.</span><span class="ident" id="6084116">CRC32</span><span class="op" id="6084121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084124">if</span>&nbsp;<span class="ident" id="6084127">fh</span><span class="op" id="6084129">.</span><span class="ident" id="6084130">isZip64</span><span class="op" id="6084137">(</span><span class="op" id="6084138">)</span>&nbsp;<span class="op" id="6084140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084144">b</span><span class="op" id="6084145">.</span><span class="ident" id="6084146">uint64</span><span class="op" id="6084152">(</span><span class="ident" id="6084153">fh</span><span class="op" id="6084155">.</span><span class="ident" id="6084156">CompressedSize64</span><span class="op" id="6084172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084176">b</span><span class="op" id="6084177">.</span><span class="ident" id="6084178">uint64</span><span class="op" id="6084184">(</span><span class="ident" id="6084185">fh</span><span class="op" id="6084187">.</span><span class="ident" id="6084188">UncompressedSize64</span><span class="op" id="6084206">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084209">}</span>&nbsp;<span class="keyword" id="6084211">else</span>&nbsp;<span class="op" id="6084216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084220">b</span><span class="op" id="6084221">.</span><span class="builtintype" id="6084222">uint32</span><span class="op" id="6084228">(</span><span class="ident" id="6084229">fh</span><span class="op" id="6084231">.</span><span class="ident" id="6084232">CompressedSize</span><span class="op" id="6084246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084250">b</span><span class="op" id="6084251">.</span><span class="builtintype" id="6084252">uint32</span><span class="op" id="6084258">(</span><span class="ident" id="6084259">fh</span><span class="op" id="6084261">.</span><span class="ident" id="6084262">UncompressedSize</span><span class="op" id="6084278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084284">_</span><span class="op" id="6084285">,</span>&nbsp;<span class="ident" id="6084287">err</span>&nbsp;<span class="op" id="6084291">:=</span>&nbsp;<span class="ident" id="6084294">w</span><span class="op" id="6084295">.</span><span class="ident" id="6084296">zipw</span><span class="op" id="6084300">.</span><span class="ident" id="6084301">Write</span><span class="op" id="6084306">(</span><span class="ident" id="6084307">buf</span><span class="op" id="6084310">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084313">return</span>&nbsp;<span class="ident" id="6084320">err</span><br>
<span class="lineno"></span><span class="op" id="6084324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084327">type</span>&nbsp;<span class="ident" id="6084332">countWriter</span>&nbsp;<span class="keyword" id="6084344">struct</span>&nbsp;<span class="op" id="6084351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084354">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6084360">io</span><span class="op" id="6084362">.</span><span class="ident" id="6084363">Writer</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084371">count</span>&nbsp;<span class="ident" id="6084377">int64</span><br>
<span class="lineno"></span><span class="op" id="6084383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084386">func</span>&nbsp;<span class="op" id="6084391">(</span><span class="ident" id="6084392">w</span>&nbsp;<span class="op" id="6084394">*</span><span class="ident" id="6084395">countWriter</span><span class="op" id="6084406">)</span>&nbsp;<span class="ident" id="6084408">Write</span><span class="op" id="6084413">(</span><span class="ident" id="6084414">p</span>&nbsp;<span class="op" id="6084416">[</span><span class="op" id="6084417">]</span><span class="builtintype" id="6084418">byte</span><span class="op" id="6084422">)</span>&nbsp;<span class="op" id="6084424">(</span><span class="builtintype" id="6084425">int</span><span class="op" id="6084428">,</span>&nbsp;<span class="builtintype" id="6084430">error</span><span class="op" id="6084435">)</span>&nbsp;<span class="op" id="6084437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084440">n</span><span class="op" id="6084441">,</span>&nbsp;<span class="ident" id="6084443">err</span>&nbsp;<span class="op" id="6084447">:=</span>&nbsp;<span class="ident" id="6084450">w</span><span class="op" id="6084451">.</span><span class="ident" id="6084452">w</span><span class="op" id="6084453">.</span><span class="ident" id="6084454">Write</span><span class="op" id="6084459">(</span><span class="ident" id="6084460">p</span><span class="op" id="6084461">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084464">w</span><span class="op" id="6084465">.</span><span class="ident" id="6084466">count</span>&nbsp;<span class="op" id="6084472">+=</span>&nbsp;<span class="ident" id="6084475">int64</span><span class="op" id="6084480">(</span><span class="ident" id="6084481">n</span><span class="op" id="6084482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084485">return</span>&nbsp;<span class="ident" id="6084492">n</span><span class="op" id="6084493">,</span>&nbsp;<span class="ident" id="6084495">err</span><br>
<span class="lineno"></span><span class="op" id="6084499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084502">type</span>&nbsp;<span class="ident" id="6084507">nopCloser</span>&nbsp;<span class="keyword" id="6084517">struct</span>&nbsp;<span class="op" id="6084524">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084527">io</span><span class="op" id="6084529">.</span><span class="ident" id="6084530">Writer</span><br>
<span class="lineno"></span><span class="op" id="6084537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084540">func</span>&nbsp;<span class="op" id="6084545">(</span><span class="ident" id="6084546">w</span>&nbsp;<span class="ident" id="6084548">nopCloser</span><span class="op" id="6084557">)</span>&nbsp;<span class="ident" id="6084559">Close</span><span class="op" id="6084564">(</span><span class="op" id="6084565">)</span>&nbsp;<span class="builtintype" id="6084567">error</span>&nbsp;<span class="op" id="6084573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084576">return</span>&nbsp;<span class="ident" id="6084583">nil</span><br>
<span class="lineno">340</span><span class="op" id="6084587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084590">type</span>&nbsp;<span class="ident" id="6084595">writeBuf</span>&nbsp;<span class="op" id="6084604">[</span><span class="op" id="6084605">]</span><span class="builtintype" id="6084606">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084612">func</span>&nbsp;<span class="op" id="6084617">(</span><span class="ident" id="6084618">b</span>&nbsp;<span class="op" id="6084620">*</span><span class="ident" id="6084621">writeBuf</span><span class="op" id="6084629">)</span>&nbsp;<span class="builtintype" id="6084631">uint16</span><span class="op" id="6084637">(</span><span class="ident" id="6084638">v</span>&nbsp;<span class="builtintype" id="6084640">uint16</span><span class="op" id="6084646">)</span>&nbsp;<span class="op" id="6084648">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084651">binary</span><span class="op" id="6084657">.</span><span class="ident" id="6084658">LittleEndian</span><span class="op" id="6084670">.</span><span class="ident" id="6084671">PutUint16</span><span class="op" id="6084680">(</span><span class="op" id="6084681">*</span><span class="ident" id="6084682">b</span><span class="op" id="6084683">,</span>&nbsp;<span class="ident" id="6084685">v</span><span class="op" id="6084686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084689">*</span><span class="ident" id="6084690">b</span>&nbsp;<span class="op" id="6084692">=</span>&nbsp;<span class="op" id="6084694">(</span><span class="op" id="6084695">*</span><span class="ident" id="6084696">b</span><span class="op" id="6084697">)</span><span class="op" id="6084698">[</span><span class="num" id="6084699">2</span><span class="op" id="6084700">:</span><span class="op" id="6084701">]</span><br>
<span class="lineno"></span><span class="op" id="6084703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084706">func</span>&nbsp;<span class="op" id="6084711">(</span><span class="ident" id="6084712">b</span>&nbsp;<span class="op" id="6084714">*</span><span class="ident" id="6084715">writeBuf</span><span class="op" id="6084723">)</span>&nbsp;<span class="builtintype" id="6084725">uint32</span><span class="op" id="6084731">(</span><span class="ident" id="6084732">v</span>&nbsp;<span class="builtintype" id="6084734">uint32</span><span class="op" id="6084740">)</span>&nbsp;<span class="op" id="6084742">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084745">binary</span><span class="op" id="6084751">.</span><span class="ident" id="6084752">LittleEndian</span><span class="op" id="6084764">.</span><span class="ident" id="6084765">PutUint32</span><span class="op" id="6084774">(</span><span class="op" id="6084775">*</span><span class="ident" id="6084776">b</span><span class="op" id="6084777">,</span>&nbsp;<span class="ident" id="6084779">v</span><span class="op" id="6084780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084783">*</span><span class="ident" id="6084784">b</span>&nbsp;<span class="op" id="6084786">=</span>&nbsp;<span class="op" id="6084788">(</span><span class="op" id="6084789">*</span><span class="ident" id="6084790">b</span><span class="op" id="6084791">)</span><span class="op" id="6084792">[</span><span class="num" id="6084793">4</span><span class="op" id="6084794">:</span><span class="op" id="6084795">]</span><br>
<span class="lineno"></span><span class="op" id="6084797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6084800">func</span>&nbsp;<span class="op" id="6084805">(</span><span class="ident" id="6084806">b</span>&nbsp;<span class="op" id="6084808">*</span><span class="ident" id="6084809">writeBuf</span><span class="op" id="6084817">)</span>&nbsp;<span class="ident" id="6084819">uint64</span><span class="op" id="6084825">(</span><span class="ident" id="6084826">v</span>&nbsp;<span class="ident" id="6084828">uint64</span><span class="op" id="6084834">)</span>&nbsp;<span class="op" id="6084836">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084839">binary</span><span class="op" id="6084845">.</span><span class="ident" id="6084846">LittleEndian</span><span class="op" id="6084858">.</span><span class="ident" id="6084859">PutUint64</span><span class="op" id="6084868">(</span><span class="op" id="6084869">*</span><span class="ident" id="6084870">b</span><span class="op" id="6084871">,</span>&nbsp;<span class="ident" id="6084873">v</span><span class="op" id="6084874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084877">*</span><span class="ident" id="6084878">b</span>&nbsp;<span class="op" id="6084880">=</span>&nbsp;<span class="op" id="6084882">(</span><span class="op" id="6084883">*</span><span class="ident" id="6084884">b</span><span class="op" id="6084885">)</span><span class="op" id="6084886">[</span><span class="num" id="6084887">8</span><span class="op" id="6084888">:</span><span class="op" id="6084889">]</span><br>
<span class="lineno"></span><span class="op" id="6084891">}</span>
</div>
</body>
</html>
