<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5104132">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5104187">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5104241">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5104292">package</span>&nbsp;<span class="ident" id="5104300">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5104307">type</span>&nbsp;<span class="ident" id="5104312">serializedFile</span>&nbsp;<span class="keyword" id="5104327">struct</span>&nbsp;<span class="op" id="5104334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5104337">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104409">Name</span>&nbsp;&nbsp;<span class="builtintype" id="5104415">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104423">Base</span>&nbsp;&nbsp;<span class="builtintype" id="5104429">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104434">Size</span>&nbsp;&nbsp;<span class="builtintype" id="5104440">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104445">Lines</span>&nbsp;<span class="op" id="5104451">[</span><span class="op" id="5104452">]</span><span class="builtintype" id="5104453">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104458">Infos</span>&nbsp;<span class="op" id="5104464">[</span><span class="op" id="5104465">]</span><span class="ident" id="5104466">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="5104475">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5104478">type</span>&nbsp;<span class="ident" id="5104483">serializedFileSet</span>&nbsp;<span class="keyword" id="5104501">struct</span>&nbsp;<span class="op" id="5104508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104511">Base</span>&nbsp;&nbsp;<span class="builtintype" id="5104517">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104522">Files</span>&nbsp;<span class="op" id="5104528">[</span><span class="op" id="5104529">]</span><span class="ident" id="5104530">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="5104545">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5104548">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5104622">func</span>&nbsp;<span class="op" id="5104627">(</span><span class="ident" id="5104628">s</span>&nbsp;<span class="op" id="5104630">*</span><span class="ident" id="5104631">FileSet</span><span class="op" id="5104638">)</span>&nbsp;<span class="ident" id="5104640">Read</span><span class="op" id="5104644">(</span><span class="ident" id="5104645">decode</span>&nbsp;<span class="keyword" id="5104652">func</span><span class="op" id="5104656">(</span><span class="keyword" id="5104657">interface</span><span class="op" id="5104666">{</span><span class="op" id="5104667">}</span><span class="op" id="5104668">)</span>&nbsp;<span class="builtintype" id="5104670">error</span><span class="op" id="5104675">)</span>&nbsp;<span class="builtintype" id="5104677">error</span>&nbsp;<span class="op" id="5104683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104686">var</span>&nbsp;<span class="ident" id="5104690">ss</span>&nbsp;<span class="ident" id="5104693">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104712">if</span>&nbsp;<span class="ident" id="5104715">err</span>&nbsp;<span class="op" id="5104719">:=</span>&nbsp;<span class="ident" id="5104722">decode</span><span class="op" id="5104728">(</span><span class="op" id="5104729">&amp;</span><span class="ident" id="5104730">ss</span><span class="op" id="5104732">)</span><span class="op" id="5104733">;</span>&nbsp;<span class="ident" id="5104735">err</span>&nbsp;<span class="op" id="5104739">!=</span>&nbsp;<span class="ident" id="5104742">nil</span>&nbsp;<span class="op" id="5104746">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104750">return</span>&nbsp;<span class="ident" id="5104757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104766">s</span><span class="op" id="5104767">.</span><span class="ident" id="5104768">mutex</span><span class="op" id="5104773">.</span><span class="ident" id="5104774">Lock</span><span class="op" id="5104778">(</span><span class="op" id="5104779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104782">s</span><span class="op" id="5104783">.</span><span class="ident" id="5104784">base</span>&nbsp;<span class="op" id="5104789">=</span>&nbsp;<span class="ident" id="5104791">ss</span><span class="op" id="5104793">.</span><span class="ident" id="5104794">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104800">files</span>&nbsp;<span class="op" id="5104806">:=</span>&nbsp;<span class="builtinfunc" id="5104809">make</span><span class="op" id="5104813">(</span><span class="op" id="5104814">[</span><span class="op" id="5104815">]</span><span class="op" id="5104816">*</span><span class="ident" id="5104817">File</span><span class="op" id="5104821">,</span>&nbsp;<span class="builtinfunc" id="5104823">len</span><span class="op" id="5104826">(</span><span class="ident" id="5104827">ss</span><span class="op" id="5104829">.</span><span class="ident" id="5104830">Files</span><span class="op" id="5104835">)</span><span class="op" id="5104836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5104839">for</span>&nbsp;<span class="ident" id="5104843">i</span>&nbsp;<span class="op" id="5104845">:=</span>&nbsp;<span class="num" id="5104848">0</span><span class="op" id="5104849">;</span>&nbsp;<span class="ident" id="5104851">i</span>&nbsp;<span class="op" id="5104853">&lt;</span>&nbsp;<span class="builtinfunc" id="5104855">len</span><span class="op" id="5104858">(</span><span class="ident" id="5104859">ss</span><span class="op" id="5104861">.</span><span class="ident" id="5104862">Files</span><span class="op" id="5104867">)</span><span class="op" id="5104868">;</span>&nbsp;<span class="ident" id="5104870">i</span><span class="op" id="5104871">++</span>&nbsp;<span class="op" id="5104874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104878">f</span>&nbsp;<span class="op" id="5104880">:=</span>&nbsp;<span class="op" id="5104883">&amp;</span><span class="ident" id="5104884">ss</span><span class="op" id="5104886">.</span><span class="ident" id="5104887">Files</span><span class="op" id="5104892">[</span><span class="ident" id="5104893">i</span><span class="op" id="5104894">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104898">files</span><span class="op" id="5104903">[</span><span class="ident" id="5104904">i</span><span class="op" id="5104905">]</span>&nbsp;<span class="op" id="5104907">=</span>&nbsp;<span class="op" id="5104909">&amp;</span><span class="ident" id="5104910">File</span><span class="op" id="5104914">{</span><span class="ident" id="5104915">s</span><span class="op" id="5104916">,</span>&nbsp;<span class="ident" id="5104918">f</span><span class="op" id="5104919">.</span><span class="ident" id="5104920">Name</span><span class="op" id="5104924">,</span>&nbsp;<span class="ident" id="5104926">f</span><span class="op" id="5104927">.</span><span class="ident" id="5104928">Base</span><span class="op" id="5104932">,</span>&nbsp;<span class="ident" id="5104934">f</span><span class="op" id="5104935">.</span><span class="ident" id="5104936">Size</span><span class="op" id="5104940">,</span>&nbsp;<span class="ident" id="5104942">f</span><span class="op" id="5104943">.</span><span class="ident" id="5104944">Lines</span><span class="op" id="5104949">,</span>&nbsp;<span class="ident" id="5104951">f</span><span class="op" id="5104952">.</span><span class="ident" id="5104953">Infos</span><span class="op" id="5104958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5104961">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104964">s</span><span class="op" id="5104965">.</span><span class="ident" id="5104966">files</span>&nbsp;<span class="op" id="5104972">=</span>&nbsp;<span class="ident" id="5104974">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104981">s</span><span class="op" id="5104982">.</span><span class="ident" id="5104983">last</span>&nbsp;<span class="op" id="5104988">=</span>&nbsp;<span class="ident" id="5104990">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5104995">s</span><span class="op" id="5104996">.</span><span class="ident" id="5104997">mutex</span><span class="op" id="5105002">.</span><span class="ident" id="5105003">Unlock</span><span class="op" id="5105009">(</span><span class="op" id="5105010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105014">return</span>&nbsp;<span class="ident" id="5105021">nil</span><br>
<span class="lineno">40</span><span class="op" id="5105025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5105028">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="5105079">func</span>&nbsp;<span class="op" id="5105084">(</span><span class="ident" id="5105085">s</span>&nbsp;<span class="op" id="5105087">*</span><span class="ident" id="5105088">FileSet</span><span class="op" id="5105095">)</span>&nbsp;<span class="ident" id="5105097">Write</span><span class="op" id="5105102">(</span><span class="ident" id="5105103">encode</span>&nbsp;<span class="keyword" id="5105110">func</span><span class="op" id="5105114">(</span><span class="keyword" id="5105115">interface</span><span class="op" id="5105124">{</span><span class="op" id="5105125">}</span><span class="op" id="5105126">)</span>&nbsp;<span class="builtintype" id="5105128">error</span><span class="op" id="5105133">)</span>&nbsp;<span class="builtintype" id="5105135">error</span>&nbsp;<span class="op" id="5105141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105144">var</span>&nbsp;<span class="ident" id="5105148">ss</span>&nbsp;<span class="ident" id="5105151">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105171">s</span><span class="op" id="5105172">.</span><span class="ident" id="5105173">mutex</span><span class="op" id="5105178">.</span><span class="ident" id="5105179">Lock</span><span class="op" id="5105183">(</span><span class="op" id="5105184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105187">ss</span><span class="op" id="5105189">.</span><span class="ident" id="5105190">Base</span>&nbsp;<span class="op" id="5105195">=</span>&nbsp;<span class="ident" id="5105197">s</span><span class="op" id="5105198">.</span><span class="ident" id="5105199">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105205">files</span>&nbsp;<span class="op" id="5105211">:=</span>&nbsp;<span class="builtinfunc" id="5105214">make</span><span class="op" id="5105218">(</span><span class="op" id="5105219">[</span><span class="op" id="5105220">]</span><span class="ident" id="5105221">serializedFile</span><span class="op" id="5105235">,</span>&nbsp;<span class="builtinfunc" id="5105237">len</span><span class="op" id="5105240">(</span><span class="ident" id="5105241">s</span><span class="op" id="5105242">.</span><span class="ident" id="5105243">files</span><span class="op" id="5105248">)</span><span class="op" id="5105249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105252">for</span>&nbsp;<span class="ident" id="5105256">i</span><span class="op" id="5105257">,</span>&nbsp;<span class="ident" id="5105259">f</span>&nbsp;<span class="op" id="5105261">:=</span>&nbsp;<span class="keyword" id="5105264">range</span>&nbsp;<span class="ident" id="5105270">s</span><span class="op" id="5105271">.</span><span class="ident" id="5105272">files</span>&nbsp;<span class="op" id="5105278">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105282">files</span><span class="op" id="5105287">[</span><span class="ident" id="5105288">i</span><span class="op" id="5105289">]</span>&nbsp;<span class="op" id="5105291">=</span>&nbsp;<span class="ident" id="5105293">serializedFile</span><span class="op" id="5105307">{</span><span class="ident" id="5105308">f</span><span class="op" id="5105309">.</span><span class="ident" id="5105310">name</span><span class="op" id="5105314">,</span>&nbsp;<span class="ident" id="5105316">f</span><span class="op" id="5105317">.</span><span class="ident" id="5105318">base</span><span class="op" id="5105322">,</span>&nbsp;<span class="ident" id="5105324">f</span><span class="op" id="5105325">.</span><span class="ident" id="5105326">size</span><span class="op" id="5105330">,</span>&nbsp;<span class="ident" id="5105332">f</span><span class="op" id="5105333">.</span><span class="ident" id="5105334">lines</span><span class="op" id="5105339">,</span>&nbsp;<span class="ident" id="5105341">f</span><span class="op" id="5105342">.</span><span class="ident" id="5105343">infos</span><span class="op" id="5105348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5105351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105354">ss</span><span class="op" id="5105356">.</span><span class="ident" id="5105357">Files</span>&nbsp;<span class="op" id="5105363">=</span>&nbsp;<span class="ident" id="5105365">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5105372">s</span><span class="op" id="5105373">.</span><span class="ident" id="5105374">mutex</span><span class="op" id="5105379">.</span><span class="ident" id="5105380">Unlock</span><span class="op" id="5105386">(</span><span class="op" id="5105387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5105391">return</span>&nbsp;<span class="ident" id="5105398">encode</span><span class="op" id="5105404">(</span><span class="ident" id="5105405">ss</span><span class="op" id="5105407">)</span><br>
<span class="lineno"></span><span class="op" id="5105409">}</span>
</div>
</body>
</html>
