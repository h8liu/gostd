<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httputil</h2>
<ul>
<li><a href="/gostd/net/http/httputil/dump.go.html" class="current">dump.go</a></li>
<li><a href="/gostd/net/http/httputil/dump_test.go.html">dump_test.go</a></li>
<li><a href="/gostd/net/http/httputil/httputil.go.html">httputil.go</a></li>
<li><a href="/gostd/net/http/httputil/persist.go.html">persist.go</a></li>
<li><a href="/gostd/net/http/httputil/reverseproxy.go.html">reverseproxy.go</a></li>
<li><a href="/gostd/net/http/httputil/reverseproxy_test.go.html">reverseproxy_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6378664">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6378719">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6378773">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6378824">package</span>&nbsp;<span class="ident" id="6378832">httputil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6378842">import</span>&nbsp;<span class="op" id="6378849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378852">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378861">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378870">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378880">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378887">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378893">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378906">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378913">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378925">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378936">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6378947">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6378954">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6378957">//&nbsp;One&nbsp;of&nbsp;the&nbsp;copies,&nbsp;say&nbsp;from&nbsp;b&nbsp;to&nbsp;r2,&nbsp;could&nbsp;be&nbsp;avoided&nbsp;by&nbsp;using&nbsp;a&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="6379030">//&nbsp;elaborate&nbsp;trick&nbsp;where&nbsp;the&nbsp;other&nbsp;copy&nbsp;is&nbsp;made&nbsp;during&nbsp;Request/Response.Write.</span><br>
<span class="lineno"></span><span class="comment" id="6379109">//&nbsp;This&nbsp;would&nbsp;complicate&nbsp;things&nbsp;too&nbsp;much,&nbsp;given&nbsp;that&nbsp;these&nbsp;functions&nbsp;are&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6379186">//&nbsp;debugging&nbsp;only.</span><br>
<span class="lineno">25</span><span class="keyword" id="6379205">func</span>&nbsp;<span class="ident" id="6379210">drainBody</span><span class="op" id="6379219">(</span><span class="ident" id="6379220">b</span>&nbsp;<span class="ident" id="6379222"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6379224">.</span><span class="ident" id="6379225"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><span class="op" id="6379235">)</span>&nbsp;<span class="op" id="6379237">(</span><span class="ident" id="6379238">r1</span><span class="op" id="6379240">,</span>&nbsp;<span class="ident" id="6379242">r2</span>&nbsp;<span class="ident" id="6379245"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6379247">.</span><span class="ident" id="6379248"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><span class="op" id="6379258">,</span>&nbsp;<span class="ident" id="6379260">err</span>&nbsp;<span class="builtintype" id="6379264">error</span><span class="op" id="6379269">)</span>&nbsp;<span class="op" id="6379271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379274">var</span>&nbsp;<span class="ident" id="6379278">buf</span>&nbsp;<span class="ident" id="6379282"><a href="/gostd/net/http/httputil/dump.go.html#6378861">bytes</a></span><span class="op" id="6379287">.</span><span class="ident" id="6379288"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379296">if</span>&nbsp;<span class="ident" id="6379299">_</span><span class="op" id="6379300">,</span>&nbsp;<span class="ident" id="6379302"><a href="/gostd/net/http/httputil/dump.go.html#6379260">err</a></span>&nbsp;<span class="op" id="6379306">=</span>&nbsp;<span class="ident" id="6379308"><a href="/gostd/net/http/httputil/dump.go.html#6379278">buf</a></span><span class="op" id="6379311">.</span><span class="ident" id="6379312"><a href="/gostd/bytes/buffer.go.html#1388068">ReadFrom</a></span><span class="op" id="6379320">(</span><span class="ident" id="6379321"><a href="/gostd/net/http/httputil/dump.go.html#6379220">b</a></span><span class="op" id="6379322">)</span><span class="op" id="6379323">;</span>&nbsp;<span class="ident" id="6379325"><a href="/gostd/net/http/httputil/dump.go.html#6379260">err</a></span>&nbsp;<span class="op" id="6379329">!=</span>&nbsp;<span class="builtintype" id="6379332">nil</span>&nbsp;<span class="op" id="6379336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379340">return</span>&nbsp;<span class="builtintype" id="6379347">nil</span><span class="op" id="6379350">,</span>&nbsp;<span class="builtintype" id="6379352">nil</span><span class="op" id="6379355">,</span>&nbsp;<span class="ident" id="6379357"><a href="/gostd/net/http/httputil/dump.go.html#6379260">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379362">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379365">if</span>&nbsp;<span class="ident" id="6379368"><a href="/gostd/net/http/httputil/dump.go.html#6379260">err</a></span>&nbsp;<span class="op" id="6379372">=</span>&nbsp;<span class="ident" id="6379374"><a href="/gostd/net/http/httputil/dump.go.html#6379220">b</a></span><span class="op" id="6379375">.</span><span class="ident" id="6379376"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6379381">(</span><span class="op" id="6379382">)</span><span class="op" id="6379383">;</span>&nbsp;<span class="ident" id="6379385"><a href="/gostd/net/http/httputil/dump.go.html#6379260">err</a></span>&nbsp;<span class="op" id="6379389">!=</span>&nbsp;<span class="builtintype" id="6379392">nil</span>&nbsp;<span class="op" id="6379396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379400">return</span>&nbsp;<span class="builtintype" id="6379407">nil</span><span class="op" id="6379410">,</span>&nbsp;<span class="builtintype" id="6379412">nil</span><span class="op" id="6379415">,</span>&nbsp;<span class="ident" id="6379417"><a href="/gostd/net/http/httputil/dump.go.html#6379260">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6379425">return</span>&nbsp;<span class="ident" id="6379432"><a href="/gostd/net/http/httputil/dump.go.html#6378893">ioutil</a></span><span class="op" id="6379438">.</span><span class="ident" id="6379439"><a href="/gostd/io/ioutil/ioutil.go.html#3767601">NopCloser</a></span><span class="op" id="6379448">(</span><span class="op" id="6379449">&amp;</span><span class="ident" id="6379450"><a href="/gostd/net/http/httputil/dump.go.html#6379278">buf</a></span><span class="op" id="6379453">)</span><span class="op" id="6379454">,</span>&nbsp;<span class="ident" id="6379456"><a href="/gostd/net/http/httputil/dump.go.html#6378893">ioutil</a></span><span class="op" id="6379462">.</span><span class="ident" id="6379463"><a href="/gostd/io/ioutil/ioutil.go.html#3767601">NopCloser</a></span><span class="op" id="6379472">(</span><span class="ident" id="6379473"><a href="/gostd/net/http/httputil/dump.go.html#6378861">bytes</a></span><span class="op" id="6379478">.</span><span class="ident" id="6379479"><a href="/gostd/bytes/reader.go.html#1418136">NewReader</a></span><span class="op" id="6379488">(</span><span class="ident" id="6379489"><a href="/gostd/net/http/httputil/dump.go.html#6379278">buf</a></span><span class="op" id="6379492">.</span><span class="ident" id="6379493"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6379498">(</span><span class="op" id="6379499">)</span><span class="op" id="6379500">)</span><span class="op" id="6379501">)</span><span class="op" id="6379502">,</span>&nbsp;<span class="builtintype" id="6379504">nil</span><br>
<span class="lineno"></span><span class="op" id="6379508">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="6379511">//&nbsp;dumpConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;which&nbsp;writes&nbsp;to&nbsp;Writer&nbsp;and&nbsp;reads&nbsp;from&nbsp;Reader</span><br>
<span class="lineno"></span><span class="keyword" id="6379582">type</span>&nbsp;<span class="ident" id="6379587">dumpConn</span>&nbsp;<span class="keyword" id="6379596">struct</span>&nbsp;<span class="op" id="6379603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379606"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6379608">.</span><span class="ident" id="6379609"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379617"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6379619">.</span><span class="ident" id="6379620"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno">40</span><span class="op" id="6379627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6379630">func</span>&nbsp;<span class="op" id="6379635">(</span><span class="ident" id="6379636">c</span>&nbsp;<span class="op" id="6379638">*</span><span class="ident" id="6379639"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6379647">)</span>&nbsp;<span class="ident" id="6379649">Close</span><span class="op" id="6379654">(</span><span class="op" id="6379655">)</span>&nbsp;<span class="builtintype" id="6379657">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379685">{</span>&nbsp;<span class="keyword" id="6379687">return</span>&nbsp;<span class="builtintype" id="6379694">nil</span>&nbsp;<span class="op" id="6379698">}</span><br>
<span class="lineno"></span><span class="keyword" id="6379700">func</span>&nbsp;<span class="op" id="6379705">(</span><span class="ident" id="6379706">c</span>&nbsp;<span class="op" id="6379708">*</span><span class="ident" id="6379709"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6379717">)</span>&nbsp;<span class="ident" id="6379719">LocalAddr</span><span class="op" id="6379728">(</span><span class="op" id="6379729">)</span>&nbsp;<span class="ident" id="6379731"><a href="/gostd/net/http/httputil/dump.go.html#6378906">net</a></span><span class="op" id="6379734">.</span><span class="ident" id="6379735"><a href="/gostd/net/net.go.html#3334179">Addr</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379755">{</span>&nbsp;<span class="keyword" id="6379757">return</span>&nbsp;<span class="builtintype" id="6379764">nil</span>&nbsp;<span class="op" id="6379768">}</span><br>
<span class="lineno"></span><span class="keyword" id="6379770">func</span>&nbsp;<span class="op" id="6379775">(</span><span class="ident" id="6379776">c</span>&nbsp;<span class="op" id="6379778">*</span><span class="ident" id="6379779"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6379787">)</span>&nbsp;<span class="ident" id="6379789">RemoteAddr</span><span class="op" id="6379799">(</span><span class="op" id="6379800">)</span>&nbsp;<span class="ident" id="6379802"><a href="/gostd/net/http/httputil/dump.go.html#6378906">net</a></span><span class="op" id="6379805">.</span><span class="ident" id="6379806"><a href="/gostd/net/net.go.html#3334179">Addr</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379825">{</span>&nbsp;<span class="keyword" id="6379827">return</span>&nbsp;<span class="builtintype" id="6379834">nil</span>&nbsp;<span class="op" id="6379838">}</span><br>
<span class="lineno">45</span><span class="keyword" id="6379840">func</span>&nbsp;<span class="op" id="6379845">(</span><span class="ident" id="6379846">c</span>&nbsp;<span class="op" id="6379848">*</span><span class="ident" id="6379849"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6379857">)</span>&nbsp;<span class="ident" id="6379859">SetDeadline</span><span class="op" id="6379870">(</span><span class="ident" id="6379871">t</span>&nbsp;<span class="ident" id="6379873"><a href="/gostd/net/http/httputil/dump.go.html#6378947">time</a></span><span class="op" id="6379877">.</span><span class="ident" id="6379878"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="6379882">)</span>&nbsp;<span class="builtintype" id="6379884">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6379895">{</span>&nbsp;<span class="keyword" id="6379897">return</span>&nbsp;<span class="builtintype" id="6379904">nil</span>&nbsp;<span class="op" id="6379908">}</span><br>
<span class="lineno"></span><span class="keyword" id="6379910">func</span>&nbsp;<span class="op" id="6379915">(</span><span class="ident" id="6379916">c</span>&nbsp;<span class="op" id="6379918">*</span><span class="ident" id="6379919"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6379927">)</span>&nbsp;<span class="ident" id="6379929">SetReadDeadline</span><span class="op" id="6379944">(</span><span class="ident" id="6379945">t</span>&nbsp;<span class="ident" id="6379947"><a href="/gostd/net/http/httputil/dump.go.html#6378947">time</a></span><span class="op" id="6379951">.</span><span class="ident" id="6379952"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="6379956">)</span>&nbsp;<span class="builtintype" id="6379958">error</span>&nbsp;&nbsp;<span class="op" id="6379965">{</span>&nbsp;<span class="keyword" id="6379967">return</span>&nbsp;<span class="builtintype" id="6379974">nil</span>&nbsp;<span class="op" id="6379978">}</span><br>
<span class="lineno"></span><span class="keyword" id="6379980">func</span>&nbsp;<span class="op" id="6379985">(</span><span class="ident" id="6379986">c</span>&nbsp;<span class="op" id="6379988">*</span><span class="ident" id="6379989"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6379997">)</span>&nbsp;<span class="ident" id="6379999">SetWriteDeadline</span><span class="op" id="6380015">(</span><span class="ident" id="6380016">t</span>&nbsp;<span class="ident" id="6380018"><a href="/gostd/net/http/httputil/dump.go.html#6378947">time</a></span><span class="op" id="6380022">.</span><span class="ident" id="6380023"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="6380027">)</span>&nbsp;<span class="builtintype" id="6380029">error</span>&nbsp;<span class="op" id="6380035">{</span>&nbsp;<span class="keyword" id="6380037">return</span>&nbsp;<span class="builtintype" id="6380044">nil</span>&nbsp;<span class="op" id="6380048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6380051">type</span>&nbsp;<span class="ident" id="6380056">neverEnding</span>&nbsp;<span class="builtintype" id="6380068">byte</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6380074">func</span>&nbsp;<span class="op" id="6380079">(</span><span class="ident" id="6380080">b</span>&nbsp;<span class="ident" id="6380082"><a href="/gostd/net/http/httputil/dump.go.html#6380056">neverEnding</a></span><span class="op" id="6380093">)</span>&nbsp;<span class="ident" id="6380095">Read</span><span class="op" id="6380099">(</span><span class="ident" id="6380100">p</span>&nbsp;<span class="op" id="6380102">[</span><span class="op" id="6380103">]</span><span class="builtintype" id="6380104">byte</span><span class="op" id="6380108">)</span>&nbsp;<span class="op" id="6380110">(</span><span class="ident" id="6380111">n</span>&nbsp;<span class="builtintype" id="6380113">int</span><span class="op" id="6380116">,</span>&nbsp;<span class="ident" id="6380118">err</span>&nbsp;<span class="builtintype" id="6380122">error</span><span class="op" id="6380127">)</span>&nbsp;<span class="op" id="6380129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380132">for</span>&nbsp;<span class="ident" id="6380136">i</span>&nbsp;<span class="op" id="6380138">:=</span>&nbsp;<span class="keyword" id="6380141">range</span>&nbsp;<span class="ident" id="6380147"><a href="/gostd/net/http/httputil/dump.go.html#6380100">p</a></span>&nbsp;<span class="op" id="6380149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380153"><a href="/gostd/net/http/httputil/dump.go.html#6380100">p</a></span><span class="op" id="6380154">[</span><span class="ident" id="6380155"><a href="/gostd/net/http/httputil/dump.go.html#6380136">i</a></span><span class="op" id="6380156">]</span>&nbsp;<span class="op" id="6380158">=</span>&nbsp;<span class="builtintype" id="6380160">byte</span><span class="op" id="6380164">(</span><span class="ident" id="6380165"><a href="/gostd/net/http/httputil/dump.go.html#6380080">b</a></span><span class="op" id="6380166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380169">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380172">return</span>&nbsp;<span class="builtinfunc" id="6380179">len</span><span class="op" id="6380182">(</span><span class="ident" id="6380183"><a href="/gostd/net/http/httputil/dump.go.html#6380100">p</a></span><span class="op" id="6380184">)</span><span class="op" id="6380185">,</span>&nbsp;<span class="builtintype" id="6380187">nil</span><br>
<span class="lineno"></span><span class="op" id="6380191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6380194">//&nbsp;DumpRequestOut&nbsp;is&nbsp;like&nbsp;DumpRequest&nbsp;but&nbsp;includes</span><br>
<span class="lineno"></span><span class="comment" id="6380245">//&nbsp;headers&nbsp;that&nbsp;the&nbsp;standard&nbsp;http.Transport&nbsp;adds,</span><br>
<span class="lineno">60</span><span class="comment" id="6380295">//&nbsp;such&nbsp;as&nbsp;User-Agent.</span><br>
<span class="lineno"></span><span class="keyword" id="6380318">func</span>&nbsp;<span class="ident" id="6380323">DumpRequestOut</span><span class="op" id="6380337">(</span><span class="ident" id="6380338">req</span>&nbsp;<span class="op" id="6380342">*</span><span class="ident" id="6380343"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6380347">.</span><span class="ident" id="6380348"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6380355">,</span>&nbsp;<span class="ident" id="6380357">body</span>&nbsp;<span class="builtintype" id="6380362">bool</span><span class="op" id="6380366">)</span>&nbsp;<span class="op" id="6380368">(</span><span class="op" id="6380369">[</span><span class="op" id="6380370">]</span><span class="builtintype" id="6380371">byte</span><span class="op" id="6380375">,</span>&nbsp;<span class="builtintype" id="6380377">error</span><span class="op" id="6380382">)</span>&nbsp;<span class="op" id="6380384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380387">save</span>&nbsp;<span class="op" id="6380392">:=</span>&nbsp;<span class="ident" id="6380395"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380398">.</span><span class="ident" id="6380399"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380405">dummyBody</span>&nbsp;<span class="op" id="6380415">:=</span>&nbsp;<span class="builtintype" id="6380418">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380425">if</span>&nbsp;<span class="op" id="6380428">!</span><span class="ident" id="6380429"><a href="/gostd/net/http/httputil/dump.go.html#6380357">body</a></span>&nbsp;<span class="op" id="6380434">||</span>&nbsp;<span class="ident" id="6380437"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380440">.</span><span class="ident" id="6380441"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6380446">==</span>&nbsp;<span class="builtintype" id="6380449">nil</span>&nbsp;<span class="op" id="6380453">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380457"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380460">.</span><span class="ident" id="6380461"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6380466">=</span>&nbsp;<span class="builtintype" id="6380468">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380474">if</span>&nbsp;<span class="ident" id="6380477"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380480">.</span><span class="ident" id="6380481"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span>&nbsp;<span class="op" id="6380495">!=</span>&nbsp;<span class="num" id="6380498">0</span>&nbsp;<span class="op" id="6380500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380505"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380508">.</span><span class="ident" id="6380509"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6380514">=</span>&nbsp;<span class="ident" id="6380516"><a href="/gostd/net/http/httputil/dump.go.html#6378893">ioutil</a></span><span class="op" id="6380522">.</span><span class="ident" id="6380523"><a href="/gostd/io/ioutil/ioutil.go.html#3767601">NopCloser</a></span><span class="op" id="6380532">(</span><span class="ident" id="6380533"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6380535">.</span><span class="ident" id="6380536"><a href="/gostd/io/io.go.html#1431815">LimitReader</a></span><span class="op" id="6380547">(</span><span class="ident" id="6380548"><a href="/gostd/net/http/httputil/dump.go.html#6380056">neverEnding</a></span><span class="op" id="6380559">(</span><span class="string" id="6380560">&#39;x&#39;</span><span class="op" id="6380563">)</span><span class="op" id="6380564">,</span>&nbsp;<span class="ident" id="6380566"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380569">.</span><span class="ident" id="6380570"><a href="/gostd/net/http/request.go.html#4138292">ContentLength</a></span><span class="op" id="6380583">)</span><span class="op" id="6380584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380589"><a href="/gostd/net/http/httputil/dump.go.html#6380405">dummyBody</a></span>&nbsp;<span class="op" id="6380599">=</span>&nbsp;<span class="builtintype" id="6380601">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380608">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380611">}</span>&nbsp;<span class="keyword" id="6380613">else</span>&nbsp;<span class="op" id="6380618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380622">var</span>&nbsp;<span class="ident" id="6380626">err</span>&nbsp;<span class="builtintype" id="6380630">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380638"><a href="/gostd/net/http/httputil/dump.go.html#6380387">save</a></span><span class="op" id="6380642">,</span>&nbsp;<span class="ident" id="6380644"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380647">.</span><span class="ident" id="6380648"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6380652">,</span>&nbsp;<span class="ident" id="6380654"><a href="/gostd/net/http/httputil/dump.go.html#6380626">err</a></span>&nbsp;<span class="op" id="6380658">=</span>&nbsp;<span class="ident" id="6380660"><a href="/gostd/net/http/httputil/dump.go.html#6379210">drainBody</a></span><span class="op" id="6380669">(</span><span class="ident" id="6380670"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6380673">.</span><span class="ident" id="6380674"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6380678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380682">if</span>&nbsp;<span class="ident" id="6380685"><a href="/gostd/net/http/httputil/dump.go.html#6380626">err</a></span>&nbsp;<span class="op" id="6380689">!=</span>&nbsp;<span class="builtintype" id="6380692">nil</span>&nbsp;<span class="op" id="6380696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380701">return</span>&nbsp;<span class="builtintype" id="6380708">nil</span><span class="op" id="6380711">,</span>&nbsp;<span class="ident" id="6380713"><a href="/gostd/net/http/httputil/dump.go.html#6380626">err</a></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6380722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380726">//&nbsp;Since&nbsp;we&#39;re&nbsp;using&nbsp;the&nbsp;actual&nbsp;Transport&nbsp;code&nbsp;to&nbsp;write&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380796">//&nbsp;switch&nbsp;to&nbsp;http&nbsp;so&nbsp;the&nbsp;Transport&nbsp;doesn&#39;t&nbsp;try&nbsp;to&nbsp;do&nbsp;an&nbsp;SSL</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380857">//&nbsp;negotiation&nbsp;with&nbsp;our&nbsp;dumpConn&nbsp;and&nbsp;its&nbsp;bytes.Buffer&nbsp;&amp;&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6380920">//&nbsp;The&nbsp;wire&nbsp;format&nbsp;for&nbsp;https&nbsp;and&nbsp;http&nbsp;are&nbsp;the&nbsp;same,&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6380981">reqSend</span>&nbsp;<span class="op" id="6380989">:=</span>&nbsp;<span class="ident" id="6380992"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6380997">if</span>&nbsp;<span class="ident" id="6381000"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6381003">.</span><span class="ident" id="6381004"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="6381007">.</span><span class="ident" id="6381008"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span>&nbsp;<span class="op" id="6381015">==</span>&nbsp;<span class="string" id="6381018">&#34;https&#34;</span>&nbsp;<span class="op" id="6381026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381030"><a href="/gostd/net/http/httputil/dump.go.html#6380981">reqSend</a></span>&nbsp;<span class="op" id="6381038">=</span>&nbsp;<span class="builtinfunc" id="6381040">new</span><span class="op" id="6381043">(</span><span class="ident" id="6381044"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6381048">.</span><span class="ident" id="6381049"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6381056">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381060">*</span><span class="ident" id="6381061"><a href="/gostd/net/http/httputil/dump.go.html#6380981">reqSend</a></span>&nbsp;<span class="op" id="6381069">=</span>&nbsp;<span class="op" id="6381071">*</span><span class="ident" id="6381072"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381078"><a href="/gostd/net/http/httputil/dump.go.html#6380981">reqSend</a></span><span class="op" id="6381085">.</span><span class="ident" id="6381086"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="6381090">=</span>&nbsp;<span class="builtinfunc" id="6381092">new</span><span class="op" id="6381095">(</span><span class="ident" id="6381096"><a href="/gostd/net/http/httputil/dump.go.html#6378925">url</a></span><span class="op" id="6381099">.</span><span class="ident" id="6381100"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="6381103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381107">*</span><span class="ident" id="6381108"><a href="/gostd/net/http/httputil/dump.go.html#6380981">reqSend</a></span><span class="op" id="6381115">.</span><span class="ident" id="6381116"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="6381120">=</span>&nbsp;<span class="op" id="6381122">*</span><span class="ident" id="6381123"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6381126">.</span><span class="ident" id="6381127"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381133"><a href="/gostd/net/http/httputil/dump.go.html#6380981">reqSend</a></span><span class="op" id="6381140">.</span><span class="ident" id="6381141"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="6381144">.</span><span class="ident" id="6381145"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span>&nbsp;<span class="op" id="6381152">=</span>&nbsp;<span class="string" id="6381154">&#34;http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381162">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381166">//&nbsp;Use&nbsp;the&nbsp;actual&nbsp;Transport&nbsp;code&nbsp;to&nbsp;record&nbsp;what&nbsp;we&nbsp;would&nbsp;send</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381229">//&nbsp;on&nbsp;the&nbsp;wire,&nbsp;but&nbsp;not&nbsp;using&nbsp;TCP.&nbsp;&nbsp;Use&nbsp;a&nbsp;Transport&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381289">//&nbsp;custom&nbsp;dialer&nbsp;that&nbsp;returns&nbsp;a&nbsp;fake&nbsp;net.Conn&nbsp;that&nbsp;waits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381347">//&nbsp;for&nbsp;the&nbsp;full&nbsp;input&nbsp;(and&nbsp;recording&nbsp;it),&nbsp;and&nbsp;then&nbsp;responds</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381408">//&nbsp;with&nbsp;a&nbsp;dummy&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381435">var</span>&nbsp;<span class="ident" id="6381439">buf</span>&nbsp;<span class="ident" id="6381443"><a href="/gostd/net/http/httputil/dump.go.html#6378861">bytes</a></span><span class="op" id="6381448">.</span><span class="ident" id="6381449"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span>&nbsp;<span class="comment" id="6381456">//&nbsp;records&nbsp;the&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381479">pr</span><span class="op" id="6381481">,</span>&nbsp;<span class="ident" id="6381483">pw</span>&nbsp;<span class="op" id="6381486">:=</span>&nbsp;<span class="ident" id="6381489"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6381491">.</span><span class="ident" id="6381492"><a href="/gostd/io/pipe.go.html#1440333">Pipe</a></span><span class="op" id="6381496">(</span><span class="op" id="6381497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381500">defer</span>&nbsp;<span class="ident" id="6381506"><a href="/gostd/net/http/httputil/dump.go.html#6381479">pr</a></span><span class="op" id="6381508">.</span><span class="ident" id="6381509"><a href="/gostd/io/pipe.go.html#1438720">Close</a></span><span class="op" id="6381514">(</span><span class="op" id="6381515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381518">defer</span>&nbsp;<span class="ident" id="6381524"><a href="/gostd/net/http/httputil/dump.go.html#6381483">pw</a></span><span class="op" id="6381526">.</span><span class="ident" id="6381527"><a href="/gostd/io/pipe.go.html#1439540">Close</a></span><span class="op" id="6381532">(</span><span class="op" id="6381533">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381536">dr</span>&nbsp;<span class="op" id="6381539">:=</span>&nbsp;<span class="op" id="6381542">&amp;</span><span class="ident" id="6381543"><a href="/gostd/net/http/httputil/dump.go.html#6382722">delegateReader</a></span><span class="op" id="6381557">{</span><span class="ident" id="6381558"><a href="/gostd/net/http/httputil/dump.go.html#6382747">c</a></span><span class="op" id="6381559">:</span>&nbsp;<span class="builtinfunc" id="6381561">make</span><span class="op" id="6381565">(</span><span class="keyword" id="6381566">chan</span>&nbsp;<span class="ident" id="6381571"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6381573">.</span><span class="ident" id="6381574"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="6381580">)</span><span class="op" id="6381581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381584">//&nbsp;Wait&nbsp;for&nbsp;the&nbsp;request&nbsp;before&nbsp;replying&nbsp;with&nbsp;a&nbsp;dummy&nbsp;response:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381648">go</span>&nbsp;<span class="keyword" id="6381651">func</span><span class="op" id="6381655">(</span><span class="op" id="6381656">)</span>&nbsp;<span class="op" id="6381658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381662">req</span><span class="op" id="6381665">,</span>&nbsp;<span class="ident" id="6381667">err</span>&nbsp;<span class="op" id="6381671">:=</span>&nbsp;<span class="ident" id="6381674"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6381678">.</span><span class="ident" id="6381679"><a href="/gostd/net/http/request.go.html#4152095">ReadRequest</a></span><span class="op" id="6381690">(</span><span class="ident" id="6381691"><a href="/gostd/net/http/httputil/dump.go.html#6378852">bufio</a></span><span class="op" id="6381696">.</span><span class="ident" id="6381697"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="6381706">(</span><span class="ident" id="6381707"><a href="/gostd/net/http/httputil/dump.go.html#6381479">pr</a></span><span class="op" id="6381709">)</span><span class="op" id="6381710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6381714">if</span>&nbsp;<span class="ident" id="6381717"><a href="/gostd/net/http/httputil/dump.go.html#6381667">err</a></span>&nbsp;<span class="op" id="6381721">==</span>&nbsp;<span class="builtintype" id="6381724">nil</span>&nbsp;<span class="op" id="6381728">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381733">//&nbsp;Ensure&nbsp;all&nbsp;the&nbsp;body&nbsp;is&nbsp;read;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381778">//&nbsp;we&#39;ll&nbsp;get&nbsp;a&nbsp;partial&nbsp;dump.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381810"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6381812">.</span><span class="ident" id="6381813"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="6381817">(</span><span class="ident" id="6381818"><a href="/gostd/net/http/httputil/dump.go.html#6378893">ioutil</a></span><span class="op" id="6381824">.</span><span class="ident" id="6381825"><a href="/gostd/io/ioutil/ioutil.go.html#3768458">Discard</a></span><span class="op" id="6381832">,</span>&nbsp;<span class="ident" id="6381834"><a href="/gostd/net/http/httputil/dump.go.html#6381662">req</a></span><span class="op" id="6381837">.</span><span class="ident" id="6381838"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6381842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381847"><a href="/gostd/net/http/httputil/dump.go.html#6381662">req</a></span><span class="op" id="6381850">.</span><span class="ident" id="6381851"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6381855">.</span><span class="ident" id="6381856"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6381861">(</span><span class="op" id="6381862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381866">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381870"><a href="/gostd/net/http/httputil/dump.go.html#6381536">dr</a></span><span class="op" id="6381872">.</span><span class="ident" id="6381873"><a href="/gostd/net/http/httputil/dump.go.html#6382747">c</a></span>&nbsp;<span class="op" id="6381875">&lt;-</span>&nbsp;<span class="ident" id="6381878"><a href="/gostd/net/http/httputil/dump.go.html#6378936">strings</a></span><span class="op" id="6381885">.</span><span class="ident" id="6381886"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="6381895">(</span><span class="string" id="6381896">&#34;HTTP/1.1&nbsp;204&nbsp;No&nbsp;Content\r\n\r\n&#34;</span><span class="op" id="6381929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381932">}</span><span class="op" id="6381933">(</span><span class="op" id="6381934">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381938">t</span>&nbsp;<span class="op" id="6381940">:=</span>&nbsp;<span class="op" id="6381943">&amp;</span><span class="ident" id="6381944"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6381948">.</span><span class="ident" id="6381949"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="6381958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381962"><a href="/gostd/net/http/transport.go.html#4262473">DisableKeepAlives</a></span><span class="op" id="6381979">:</span>&nbsp;<span class="builtintype" id="6381981">true</span><span class="op" id="6381985">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381989"><a href="/gostd/net/http/transport.go.html#4261557">Dial</a></span><span class="op" id="6381993">:</span>&nbsp;<span class="keyword" id="6381995">func</span><span class="op" id="6381999">(</span><span class="ident" id="6382000">net</span><span class="op" id="6382003">,</span>&nbsp;<span class="ident" id="6382005">addr</span>&nbsp;<span class="builtintype" id="6382010">string</span><span class="op" id="6382016">)</span>&nbsp;<span class="op" id="6382018">(</span><span class="ident" id="6382019"><a href="/gostd/net/http/httputil/dump.go.html#6378906">net</a></span><span class="op" id="6382022">.</span><span class="ident" id="6382023"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="6382027">,</span>&nbsp;<span class="builtintype" id="6382029">error</span><span class="op" id="6382034">)</span>&nbsp;<span class="op" id="6382036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382041">return</span>&nbsp;<span class="op" id="6382048">&amp;</span><span class="ident" id="6382049"><a href="/gostd/net/http/httputil/dump.go.html#6379587">dumpConn</a></span><span class="op" id="6382057">{</span><span class="ident" id="6382058"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6382060">.</span><span class="ident" id="6382061"><a href="/gostd/io/multi.go.html#1435788">MultiWriter</a></span><span class="op" id="6382072">(</span><span class="op" id="6382073">&amp;</span><span class="ident" id="6382074"><a href="/gostd/net/http/httputil/dump.go.html#6381439">buf</a></span><span class="op" id="6382077">,</span>&nbsp;<span class="ident" id="6382079"><a href="/gostd/net/http/httputil/dump.go.html#6381483">pw</a></span><span class="op" id="6382081">)</span><span class="op" id="6382082">,</span>&nbsp;<span class="ident" id="6382084"><a href="/gostd/net/http/httputil/dump.go.html#6381536">dr</a></span><span class="op" id="6382086">}</span><span class="op" id="6382087">,</span>&nbsp;<span class="builtintype" id="6382089">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382095">}</span><span class="op" id="6382096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382103">_</span><span class="op" id="6382104">,</span>&nbsp;<span class="ident" id="6382106">err</span>&nbsp;<span class="op" id="6382110">:=</span>&nbsp;<span class="ident" id="6382113"><a href="/gostd/net/http/httputil/dump.go.html#6381938">t</a></span><span class="op" id="6382114">.</span><span class="ident" id="6382115"><a href="/gostd/net/http/transport.go.html#4265836">RoundTrip</a></span><span class="op" id="6382124">(</span><span class="ident" id="6382125"><a href="/gostd/net/http/httputil/dump.go.html#6380981">reqSend</a></span><span class="op" id="6382132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382136"><a href="/gostd/net/http/httputil/dump.go.html#6380338">req</a></span><span class="op" id="6382139">.</span><span class="ident" id="6382140"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6382145">=</span>&nbsp;<span class="ident" id="6382147"><a href="/gostd/net/http/httputil/dump.go.html#6380387">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382153">if</span>&nbsp;<span class="ident" id="6382156"><a href="/gostd/net/http/httputil/dump.go.html#6382106">err</a></span>&nbsp;<span class="op" id="6382160">!=</span>&nbsp;<span class="builtintype" id="6382163">nil</span>&nbsp;<span class="op" id="6382167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382171">return</span>&nbsp;<span class="builtintype" id="6382178">nil</span><span class="op" id="6382181">,</span>&nbsp;<span class="ident" id="6382183"><a href="/gostd/net/http/httputil/dump.go.html#6382106">err</a></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382191">dump</span>&nbsp;<span class="op" id="6382196">:=</span>&nbsp;<span class="ident" id="6382199"><a href="/gostd/net/http/httputil/dump.go.html#6381439">buf</a></span><span class="op" id="6382202">.</span><span class="ident" id="6382203"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6382208">(</span><span class="op" id="6382209">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6382213">//&nbsp;If&nbsp;we&nbsp;used&nbsp;a&nbsp;dummy&nbsp;body&nbsp;above,&nbsp;remove&nbsp;it&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6382263">//&nbsp;TODO:&nbsp;if&nbsp;the&nbsp;req.ContentLength&nbsp;is&nbsp;large,&nbsp;we&nbsp;allocate&nbsp;memory</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6382327">//&nbsp;unnecessarily&nbsp;just&nbsp;to&nbsp;slice&nbsp;it&nbsp;off&nbsp;here.&nbsp;&nbsp;But&nbsp;this&nbsp;is&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6382390">//&nbsp;a&nbsp;debug&nbsp;function,&nbsp;so&nbsp;this&nbsp;is&nbsp;acceptable&nbsp;for&nbsp;now.&nbsp;We&nbsp;could</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6382452">//&nbsp;discard&nbsp;the&nbsp;body&nbsp;earlier&nbsp;if&nbsp;this&nbsp;matters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382498">if</span>&nbsp;<span class="ident" id="6382501"><a href="/gostd/net/http/httputil/dump.go.html#6380405">dummyBody</a></span>&nbsp;<span class="op" id="6382511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382515">if</span>&nbsp;<span class="ident" id="6382518">i</span>&nbsp;<span class="op" id="6382520">:=</span>&nbsp;<span class="ident" id="6382523"><a href="/gostd/net/http/httputil/dump.go.html#6378861">bytes</a></span><span class="op" id="6382528">.</span><span class="ident" id="6382529"><a href="/gostd/bytes/bytes.go.html#1397659">Index</a></span><span class="op" id="6382534">(</span><span class="ident" id="6382535"><a href="/gostd/net/http/httputil/dump.go.html#6382191">dump</a></span><span class="op" id="6382539">,</span>&nbsp;<span class="op" id="6382541">[</span><span class="op" id="6382542">]</span><span class="builtintype" id="6382543">byte</span><span class="op" id="6382547">(</span><span class="string" id="6382548">&#34;\r\n\r\n&#34;</span><span class="op" id="6382558">)</span><span class="op" id="6382559">)</span><span class="op" id="6382560">;</span>&nbsp;<span class="ident" id="6382562"><a href="/gostd/net/http/httputil/dump.go.html#6382518">i</a></span>&nbsp;<span class="op" id="6382564">&gt;=</span>&nbsp;<span class="num" id="6382567">0</span>&nbsp;<span class="op" id="6382569">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382574"><a href="/gostd/net/http/httputil/dump.go.html#6382191">dump</a></span>&nbsp;<span class="op" id="6382579">=</span>&nbsp;<span class="ident" id="6382581"><a href="/gostd/net/http/httputil/dump.go.html#6382191">dump</a></span><span class="op" id="6382585">[</span><span class="op" id="6382586">:</span><span class="ident" id="6382587"><a href="/gostd/net/http/httputil/dump.go.html#6382518">i</a></span><span class="op" id="6382588">+</span><span class="num" id="6382589">4</span><span class="op" id="6382590">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382600">return</span>&nbsp;<span class="ident" id="6382607"><a href="/gostd/net/http/httputil/dump.go.html#6382191">dump</a></span><span class="op" id="6382611">,</span>&nbsp;<span class="builtintype" id="6382613">nil</span><br>
<span class="lineno"></span><span class="op" id="6382617">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="6382620">//&nbsp;delegateReader&nbsp;is&nbsp;a&nbsp;reader&nbsp;that&nbsp;delegates&nbsp;to&nbsp;another&nbsp;reader,</span><br>
<span class="lineno"></span><span class="comment" id="6382684">//&nbsp;once&nbsp;it&nbsp;arrives&nbsp;on&nbsp;a&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="6382717">type</span>&nbsp;<span class="ident" id="6382722">delegateReader</span>&nbsp;<span class="keyword" id="6382737">struct</span>&nbsp;<span class="op" id="6382744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382747">c</span>&nbsp;<span class="keyword" id="6382749">chan</span>&nbsp;<span class="ident" id="6382754"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6382756">.</span><span class="ident" id="6382757"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382765">r</span>&nbsp;<span class="ident" id="6382767"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6382769">.</span><span class="ident" id="6382770"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="comment" id="6382777">//&nbsp;nil&nbsp;until&nbsp;received&nbsp;from&nbsp;c</span><br>
<span class="lineno"></span><span class="op" id="6382806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6382809">func</span>&nbsp;<span class="op" id="6382814">(</span><span class="ident" id="6382815">r</span>&nbsp;<span class="op" id="6382817">*</span><span class="ident" id="6382818"><a href="/gostd/net/http/httputil/dump.go.html#6382722">delegateReader</a></span><span class="op" id="6382832">)</span>&nbsp;<span class="ident" id="6382834">Read</span><span class="op" id="6382838">(</span><span class="ident" id="6382839">p</span>&nbsp;<span class="op" id="6382841">[</span><span class="op" id="6382842">]</span><span class="builtintype" id="6382843">byte</span><span class="op" id="6382847">)</span>&nbsp;<span class="op" id="6382849">(</span><span class="builtintype" id="6382850">int</span><span class="op" id="6382853">,</span>&nbsp;<span class="builtintype" id="6382855">error</span><span class="op" id="6382860">)</span>&nbsp;<span class="op" id="6382862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382865">if</span>&nbsp;<span class="ident" id="6382868"><a href="/gostd/net/http/httputil/dump.go.html#6382815">r</a></span><span class="op" id="6382869">.</span><span class="ident" id="6382870"><a href="/gostd/net/http/httputil/dump.go.html#6382765">r</a></span>&nbsp;<span class="op" id="6382872">==</span>&nbsp;<span class="builtintype" id="6382875">nil</span>&nbsp;<span class="op" id="6382879">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6382883"><a href="/gostd/net/http/httputil/dump.go.html#6382815">r</a></span><span class="op" id="6382884">.</span><span class="ident" id="6382885"><a href="/gostd/net/http/httputil/dump.go.html#6382765">r</a></span>&nbsp;<span class="op" id="6382887">=</span>&nbsp;<span class="op" id="6382889">&lt;-</span><span class="ident" id="6382891"><a href="/gostd/net/http/httputil/dump.go.html#6382815">r</a></span><span class="op" id="6382892">.</span><span class="ident" id="6382893"><a href="/gostd/net/http/httputil/dump.go.html#6382747">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6382896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6382899">return</span>&nbsp;<span class="ident" id="6382906"><a href="/gostd/net/http/httputil/dump.go.html#6382815">r</a></span><span class="op" id="6382907">.</span><span class="ident" id="6382908"><a href="/gostd/net/http/httputil/dump.go.html#6382765">r</a></span><span class="op" id="6382909">.</span><span class="ident" id="6382910"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="6382914">(</span><span class="ident" id="6382915"><a href="/gostd/net/http/httputil/dump.go.html#6382839">p</a></span><span class="op" id="6382916">)</span><br>
<span class="lineno"></span><span class="op" id="6382918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="6382921">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="6382965">func</span>&nbsp;<span class="ident" id="6382970">valueOrDefault</span><span class="op" id="6382984">(</span><span class="ident" id="6382985">value</span><span class="op" id="6382990">,</span>&nbsp;<span class="ident" id="6382992">def</span>&nbsp;<span class="builtintype" id="6382996">string</span><span class="op" id="6383002">)</span>&nbsp;<span class="builtintype" id="6383004">string</span>&nbsp;<span class="op" id="6383011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383014">if</span>&nbsp;<span class="ident" id="6383017"><a href="/gostd/net/http/httputil/dump.go.html#6382985">value</a></span>&nbsp;<span class="op" id="6383023">!=</span>&nbsp;<span class="string" id="6383026">&#34;&#34;</span>&nbsp;<span class="op" id="6383029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383033">return</span>&nbsp;<span class="ident" id="6383040"><a href="/gostd/net/http/httputil/dump.go.html#6382985">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6383047">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383050">return</span>&nbsp;<span class="ident" id="6383057"><a href="/gostd/net/http/httputil/dump.go.html#6382992">def</a></span><br>
<span class="lineno"></span><span class="op" id="6383061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6383064">var</span>&nbsp;<span class="ident" id="6383068">reqWriteExcludeHeaderDump</span>&nbsp;<span class="op" id="6383094">=</span>&nbsp;<span class="keyword" id="6383096">map</span><span class="op" id="6383099">[</span><span class="builtintype" id="6383100">string</span><span class="op" id="6383106">]</span><span class="builtintype" id="6383107">bool</span><span class="op" id="6383111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6383114">&#34;Host&#34;</span><span class="op" id="6383120">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6383135">true</span><span class="op" id="6383139">,</span>&nbsp;<span class="comment" id="6383141">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6383170">&#34;Content-Length&#34;</span><span class="op" id="6383186">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6383191">true</span><span class="op" id="6383195">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6383198">&#34;Transfer-Encoding&#34;</span><span class="op" id="6383217">:</span>&nbsp;<span class="builtintype" id="6383219">true</span><span class="op" id="6383223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6383226">&#34;Trailer&#34;</span><span class="op" id="6383235">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6383247">true</span><span class="op" id="6383251">,</span><br>
<span class="lineno"></span><span class="op" id="6383253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="6383256">//&nbsp;dumpAsReceived&nbsp;writes&nbsp;req&nbsp;to&nbsp;w&nbsp;in&nbsp;the&nbsp;form&nbsp;as&nbsp;it&nbsp;was&nbsp;received,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6383325">//&nbsp;at&nbsp;least&nbsp;as&nbsp;accurately&nbsp;as&nbsp;possible&nbsp;from&nbsp;the&nbsp;information&nbsp;retained&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6383396">//&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="6383412">func</span>&nbsp;<span class="ident" id="6383417">dumpAsReceived</span><span class="op" id="6383431">(</span><span class="ident" id="6383432">req</span>&nbsp;<span class="op" id="6383436">*</span><span class="ident" id="6383437"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6383441">.</span><span class="ident" id="6383442"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6383449">,</span>&nbsp;<span class="ident" id="6383451">w</span>&nbsp;<span class="ident" id="6383453"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6383455">.</span><span class="ident" id="6383456"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="6383462">)</span>&nbsp;<span class="builtintype" id="6383464">error</span>&nbsp;<span class="op" id="6383470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383473">return</span>&nbsp;<span class="builtintype" id="6383480">nil</span><br>
<span class="lineno">175</span><span class="op" id="6383484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6383487">//&nbsp;DumpRequest&nbsp;returns&nbsp;the&nbsp;as-received&nbsp;wire&nbsp;representation&nbsp;of&nbsp;req,</span><br>
<span class="lineno"></span><span class="comment" id="6383554">//&nbsp;optionally&nbsp;including&nbsp;the&nbsp;request&nbsp;body,&nbsp;for&nbsp;debugging.</span><br>
<span class="lineno"></span><span class="comment" id="6383611">//&nbsp;DumpRequest&nbsp;is&nbsp;semantically&nbsp;a&nbsp;no-op,&nbsp;but&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">180</span><span class="comment" id="6383667">//&nbsp;dump&nbsp;the&nbsp;body,&nbsp;it&nbsp;reads&nbsp;the&nbsp;body&nbsp;data&nbsp;into&nbsp;memory&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6383724">//&nbsp;changes&nbsp;req.Body&nbsp;to&nbsp;refer&nbsp;to&nbsp;the&nbsp;in-memory&nbsp;copy.</span><br>
<span class="lineno"></span><span class="comment" id="6383776">//&nbsp;The&nbsp;documentation&nbsp;for&nbsp;http.Request.Write&nbsp;details&nbsp;which&nbsp;fields</span><br>
<span class="lineno"></span><span class="comment" id="6383841">//&nbsp;of&nbsp;req&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="6383861">func</span>&nbsp;<span class="ident" id="6383866">DumpRequest</span><span class="op" id="6383877">(</span><span class="ident" id="6383878">req</span>&nbsp;<span class="op" id="6383882">*</span><span class="ident" id="6383883"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6383887">.</span><span class="ident" id="6383888"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="6383895">,</span>&nbsp;<span class="ident" id="6383897">body</span>&nbsp;<span class="builtintype" id="6383902">bool</span><span class="op" id="6383906">)</span>&nbsp;<span class="op" id="6383908">(</span><span class="ident" id="6383909">dump</span>&nbsp;<span class="op" id="6383914">[</span><span class="op" id="6383915">]</span><span class="builtintype" id="6383916">byte</span><span class="op" id="6383920">,</span>&nbsp;<span class="ident" id="6383922">err</span>&nbsp;<span class="builtintype" id="6383926">error</span><span class="op" id="6383931">)</span>&nbsp;<span class="op" id="6383933">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383936">save</span>&nbsp;<span class="op" id="6383941">:=</span>&nbsp;<span class="ident" id="6383944"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6383947">.</span><span class="ident" id="6383948"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6383954">if</span>&nbsp;<span class="op" id="6383957">!</span><span class="ident" id="6383958"><a href="/gostd/net/http/httputil/dump.go.html#6383897">body</a></span>&nbsp;<span class="op" id="6383963">||</span>&nbsp;<span class="ident" id="6383966"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6383969">.</span><span class="ident" id="6383970"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6383975">==</span>&nbsp;<span class="builtintype" id="6383978">nil</span>&nbsp;<span class="op" id="6383982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6383986"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6383989">.</span><span class="ident" id="6383990"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6383995">=</span>&nbsp;<span class="builtintype" id="6383997">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384002">}</span>&nbsp;<span class="keyword" id="6384004">else</span>&nbsp;<span class="op" id="6384009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384013"><a href="/gostd/net/http/httputil/dump.go.html#6383936">save</a></span><span class="op" id="6384017">,</span>&nbsp;<span class="ident" id="6384019"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384022">.</span><span class="ident" id="6384023"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6384027">,</span>&nbsp;<span class="ident" id="6384029"><a href="/gostd/net/http/httputil/dump.go.html#6383922">err</a></span>&nbsp;<span class="op" id="6384033">=</span>&nbsp;<span class="ident" id="6384035"><a href="/gostd/net/http/httputil/dump.go.html#6379210">drainBody</a></span><span class="op" id="6384044">(</span><span class="ident" id="6384045"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384048">.</span><span class="ident" id="6384049"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6384053">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384057">if</span>&nbsp;<span class="ident" id="6384060"><a href="/gostd/net/http/httputil/dump.go.html#6383922">err</a></span>&nbsp;<span class="op" id="6384064">!=</span>&nbsp;<span class="builtintype" id="6384067">nil</span>&nbsp;<span class="op" id="6384071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384076">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384092">var</span>&nbsp;<span class="ident" id="6384096">b</span>&nbsp;<span class="ident" id="6384098"><a href="/gostd/net/http/httputil/dump.go.html#6378861">bytes</a></span><span class="op" id="6384103">.</span><span class="ident" id="6384104"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384113"><a href="/gostd/net/http/httputil/dump.go.html#6378880">fmt</a></span><span class="op" id="6384116">.</span><span class="ident" id="6384117"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="6384124">(</span><span class="op" id="6384125">&amp;</span><span class="ident" id="6384126"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384127">,</span>&nbsp;<span class="string" id="6384129">&#34;%s&nbsp;%s&nbsp;HTTP/%d.%d\r\n&#34;</span><span class="op" id="6384151">,</span>&nbsp;<span class="ident" id="6384153"><a href="/gostd/net/http/httputil/dump.go.html#6382970">valueOrDefault</a></span><span class="op" id="6384167">(</span><span class="ident" id="6384168"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384171">.</span><span class="ident" id="6384172"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span><span class="op" id="6384178">,</span>&nbsp;<span class="string" id="6384180">&#34;GET&#34;</span><span class="op" id="6384185">)</span><span class="op" id="6384186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384190"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384193">.</span><span class="ident" id="6384194"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="6384197">.</span><span class="ident" id="6384198"><a href="/gostd/net/url/url.go.html#3763661">RequestURI</a></span><span class="op" id="6384208">(</span><span class="op" id="6384209">)</span><span class="op" id="6384210">,</span>&nbsp;<span class="ident" id="6384212"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384215">.</span><span class="ident" id="6384216"><a href="/gostd/net/http/request.go.html#4136777">ProtoMajor</a></span><span class="op" id="6384226">,</span>&nbsp;<span class="ident" id="6384228"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384231">.</span><span class="ident" id="6384232"><a href="/gostd/net/http/request.go.html#4136801">ProtoMinor</a></span><span class="op" id="6384242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384246">host</span>&nbsp;<span class="op" id="6384251">:=</span>&nbsp;<span class="ident" id="6384254"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384257">.</span><span class="ident" id="6384258"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384264">if</span>&nbsp;<span class="ident" id="6384267"><a href="/gostd/net/http/httputil/dump.go.html#6384246">host</a></span>&nbsp;<span class="op" id="6384272">==</span>&nbsp;<span class="string" id="6384275">&#34;&#34;</span>&nbsp;<span class="op" id="6384278">&amp;&amp;</span>&nbsp;<span class="ident" id="6384281"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384284">.</span><span class="ident" id="6384285"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="6384289">!=</span>&nbsp;<span class="builtintype" id="6384292">nil</span>&nbsp;<span class="op" id="6384296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384300"><a href="/gostd/net/http/httputil/dump.go.html#6384246">host</a></span>&nbsp;<span class="op" id="6384305">=</span>&nbsp;<span class="ident" id="6384307"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384310">.</span><span class="ident" id="6384311"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="6384314">.</span><span class="ident" id="6384315"><a href="/gostd/net/url/url.go.html#3751325">Host</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384324">if</span>&nbsp;<span class="ident" id="6384327"><a href="/gostd/net/http/httputil/dump.go.html#6384246">host</a></span>&nbsp;<span class="op" id="6384332">!=</span>&nbsp;<span class="string" id="6384335">&#34;&#34;</span>&nbsp;<span class="op" id="6384338">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384342"><a href="/gostd/net/http/httputil/dump.go.html#6378880">fmt</a></span><span class="op" id="6384345">.</span><span class="ident" id="6384346"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="6384353">(</span><span class="op" id="6384354">&amp;</span><span class="ident" id="6384355"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384356">,</span>&nbsp;<span class="string" id="6384358">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="6384372">,</span>&nbsp;<span class="ident" id="6384374"><a href="/gostd/net/http/httputil/dump.go.html#6384246">host</a></span><span class="op" id="6384378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384385">chunked</span>&nbsp;<span class="op" id="6384393">:=</span>&nbsp;<span class="builtinfunc" id="6384396">len</span><span class="op" id="6384399">(</span><span class="ident" id="6384400"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384403">.</span><span class="ident" id="6384404"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><span class="op" id="6384420">)</span>&nbsp;<span class="op" id="6384422">&gt;</span>&nbsp;<span class="num" id="6384424">0</span>&nbsp;<span class="op" id="6384426">&amp;&amp;</span>&nbsp;<span class="ident" id="6384429"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384432">.</span><span class="ident" id="6384433"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><span class="op" id="6384449">[</span><span class="num" id="6384450">0</span><span class="op" id="6384451">]</span>&nbsp;<span class="op" id="6384453">==</span>&nbsp;<span class="string" id="6384456">&#34;chunked&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384467">if</span>&nbsp;<span class="builtinfunc" id="6384470">len</span><span class="op" id="6384473">(</span><span class="ident" id="6384474"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384477">.</span><span class="ident" id="6384478"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><span class="op" id="6384494">)</span>&nbsp;<span class="op" id="6384496">&gt;</span>&nbsp;<span class="num" id="6384498">0</span>&nbsp;<span class="op" id="6384500">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384504"><a href="/gostd/net/http/httputil/dump.go.html#6378880">fmt</a></span><span class="op" id="6384507">.</span><span class="ident" id="6384508"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="6384515">(</span><span class="op" id="6384516">&amp;</span><span class="ident" id="6384517"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384518">,</span>&nbsp;<span class="string" id="6384520">&#34;Transfer-Encoding:&nbsp;%s\r\n&#34;</span><span class="op" id="6384547">,</span>&nbsp;<span class="ident" id="6384549"><a href="/gostd/net/http/httputil/dump.go.html#6378936">strings</a></span><span class="op" id="6384556">.</span><span class="ident" id="6384557"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="6384561">(</span><span class="ident" id="6384562"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384565">.</span><span class="ident" id="6384566"><a href="/gostd/net/http/request.go.html#4138599">TransferEncoding</a></span><span class="op" id="6384582">,</span>&nbsp;<span class="string" id="6384584">&#34;,&#34;</span><span class="op" id="6384587">)</span><span class="op" id="6384588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384594">if</span>&nbsp;<span class="ident" id="6384597"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384600">.</span><span class="ident" id="6384601"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="6384607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384611"><a href="/gostd/net/http/httputil/dump.go.html#6378880">fmt</a></span><span class="op" id="6384614">.</span><span class="ident" id="6384615"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="6384622">(</span><span class="op" id="6384623">&amp;</span><span class="ident" id="6384624"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384625">,</span>&nbsp;<span class="string" id="6384627">&#34;Connection:&nbsp;close\r\n&#34;</span><span class="op" id="6384650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384653">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384657"><a href="/gostd/net/http/httputil/dump.go.html#6383922">err</a></span>&nbsp;<span class="op" id="6384661">=</span>&nbsp;<span class="ident" id="6384663"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384666">.</span><span class="ident" id="6384667"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="6384673">.</span><span class="ident" id="6384674"><a href="/gostd/net/http/header.go.html#4129454">WriteSubset</a></span><span class="op" id="6384685">(</span><span class="op" id="6384686">&amp;</span><span class="ident" id="6384687"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384688">,</span>&nbsp;<span class="ident" id="6384690"><a href="/gostd/net/http/httputil/dump.go.html#6383068">reqWriteExcludeHeaderDump</a></span><span class="op" id="6384715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384718">if</span>&nbsp;<span class="ident" id="6384721"><a href="/gostd/net/http/httputil/dump.go.html#6383922">err</a></span>&nbsp;<span class="op" id="6384725">!=</span>&nbsp;<span class="builtintype" id="6384728">nil</span>&nbsp;<span class="op" id="6384732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384736">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384744">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384748"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6384750">.</span><span class="ident" id="6384751"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="6384762">(</span><span class="op" id="6384763">&amp;</span><span class="ident" id="6384764"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384765">,</span>&nbsp;<span class="string" id="6384767">&#34;\r\n&#34;</span><span class="op" id="6384773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384777">if</span>&nbsp;<span class="ident" id="6384780"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384783">.</span><span class="ident" id="6384784"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6384789">!=</span>&nbsp;<span class="builtintype" id="6384792">nil</span>&nbsp;<span class="op" id="6384796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384800">var</span>&nbsp;<span class="ident" id="6384804">dest</span>&nbsp;<span class="ident" id="6384809"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6384811">.</span><span class="ident" id="6384812"><a href="/gostd/io/io.go.html#1422314">Writer</a></span>&nbsp;<span class="op" id="6384819">=</span>&nbsp;<span class="op" id="6384821">&amp;</span><span class="ident" id="6384822"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384826">if</span>&nbsp;<span class="ident" id="6384829"><a href="/gostd/net/http/httputil/dump.go.html#6384385">chunked</a></span>&nbsp;<span class="op" id="6384837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384842"><a href="/gostd/net/http/httputil/dump.go.html#6384804">dest</a></span>&nbsp;<span class="op" id="6384847">=</span>&nbsp;<span class="ident" id="6384849"><a href="/gostd/net/http/httputil/httputil.go.html#6387595">NewChunkedWriter</a></span><span class="op" id="6384865">(</span><span class="ident" id="6384866"><a href="/gostd/net/http/httputil/dump.go.html#6384804">dest</a></span><span class="op" id="6384870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384878">_</span><span class="op" id="6384879">,</span>&nbsp;<span class="ident" id="6384881"><a href="/gostd/net/http/httputil/dump.go.html#6383922">err</a></span>&nbsp;<span class="op" id="6384885">=</span>&nbsp;<span class="ident" id="6384887"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6384889">.</span><span class="ident" id="6384890"><a href="/gostd/io/io.go.html#1430946">Copy</a></span><span class="op" id="6384894">(</span><span class="ident" id="6384895"><a href="/gostd/net/http/httputil/dump.go.html#6384804">dest</a></span><span class="op" id="6384899">,</span>&nbsp;<span class="ident" id="6384901"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384904">.</span><span class="ident" id="6384905"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span><span class="op" id="6384909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6384913">if</span>&nbsp;<span class="ident" id="6384916"><a href="/gostd/net/http/httputil/dump.go.html#6384385">chunked</a></span>&nbsp;<span class="op" id="6384924">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384929"><a href="/gostd/net/http/httputil/dump.go.html#6384804">dest</a></span><span class="op" id="6384933">.</span><span class="op" id="6384934">(</span><span class="ident" id="6384935"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6384937">.</span><span class="ident" id="6384938"><a href="/gostd/io/io.go.html#1422563">Closer</a></span><span class="op" id="6384944">)</span><span class="op" id="6384945">.</span><span class="ident" id="6384946"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="6384951">(</span><span class="op" id="6384952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384957"><a href="/gostd/net/http/httputil/dump.go.html#6378887">io</a></span><span class="op" id="6384959">.</span><span class="ident" id="6384960"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="6384971">(</span><span class="op" id="6384972">&amp;</span><span class="ident" id="6384973"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6384974">,</span>&nbsp;<span class="string" id="6384976">&#34;\r\n&#34;</span><span class="op" id="6384982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6384989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6384993"><a href="/gostd/net/http/httputil/dump.go.html#6383878">req</a></span><span class="op" id="6384996">.</span><span class="ident" id="6384997"><a href="/gostd/net/http/request.go.html#4137997">Body</a></span>&nbsp;<span class="op" id="6385002">=</span>&nbsp;<span class="ident" id="6385004"><a href="/gostd/net/http/httputil/dump.go.html#6383936">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6385010">if</span>&nbsp;<span class="ident" id="6385013"><a href="/gostd/net/http/httputil/dump.go.html#6383922">err</a></span>&nbsp;<span class="op" id="6385017">!=</span>&nbsp;<span class="builtintype" id="6385020">nil</span>&nbsp;<span class="op" id="6385024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6385028">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385039"><a href="/gostd/net/http/httputil/dump.go.html#6383909">dump</a></span>&nbsp;<span class="op" id="6385044">=</span>&nbsp;<span class="ident" id="6385046"><a href="/gostd/net/http/httputil/dump.go.html#6384096">b</a></span><span class="op" id="6385047">.</span><span class="ident" id="6385048"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6385053">(</span><span class="op" id="6385054">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6385057">return</span><br>
<span class="lineno"></span><span class="op" id="6385064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385067">//&nbsp;errNoBody&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;error&nbsp;value&nbsp;used&nbsp;by&nbsp;failureToReadBody&nbsp;so&nbsp;we&nbsp;can&nbsp;detect</span><br>
<span class="lineno"></span><span class="comment" id="6385149">//&nbsp;that&nbsp;the&nbsp;lack&nbsp;of&nbsp;body&nbsp;was&nbsp;intentional.</span><br>
<span class="lineno">245</span><span class="keyword" id="6385191">var</span>&nbsp;<span class="ident" id="6385195">errNoBody</span>&nbsp;<span class="op" id="6385205">=</span>&nbsp;<span class="ident" id="6385207"><a href="/gostd/net/http/httputil/dump.go.html#6378870">errors</a></span><span class="op" id="6385213">.</span><span class="ident" id="6385214"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="6385217">(</span><span class="string" id="6385218">&#34;sentinel&nbsp;error&nbsp;value&#34;</span><span class="op" id="6385240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385243">//&nbsp;failureToReadBody&nbsp;is&nbsp;a&nbsp;io.ReadCloser&nbsp;that&nbsp;just&nbsp;returns&nbsp;errNoBody&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6385314">//&nbsp;Read.&nbsp;&nbsp;It&#39;s&nbsp;swapped&nbsp;in&nbsp;when&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;want&nbsp;to&nbsp;consume&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6385383">//&nbsp;body,&nbsp;but&nbsp;need&nbsp;a&nbsp;non-nil&nbsp;one,&nbsp;and&nbsp;want&nbsp;to&nbsp;distinguish&nbsp;the&nbsp;error</span><br>
<span class="lineno">250</span><span class="comment" id="6385450">//&nbsp;from&nbsp;reading&nbsp;the&nbsp;dummy&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="6385482">type</span>&nbsp;<span class="ident" id="6385487">failureToReadBody</span>&nbsp;<span class="keyword" id="6385505">struct</span><span class="op" id="6385511">{</span><span class="op" id="6385512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6385515">func</span>&nbsp;<span class="op" id="6385520">(</span><span class="ident" id="6385521"><a href="/gostd/net/http/httputil/dump.go.html#6385487">failureToReadBody</a></span><span class="op" id="6385538">)</span>&nbsp;<span class="ident" id="6385540">Read</span><span class="op" id="6385544">(</span><span class="op" id="6385545">[</span><span class="op" id="6385546">]</span><span class="builtintype" id="6385547">byte</span><span class="op" id="6385551">)</span>&nbsp;<span class="op" id="6385553">(</span><span class="builtintype" id="6385554">int</span><span class="op" id="6385557">,</span>&nbsp;<span class="builtintype" id="6385559">error</span><span class="op" id="6385564">)</span>&nbsp;<span class="op" id="6385566">{</span>&nbsp;<span class="keyword" id="6385568">return</span>&nbsp;<span class="num" id="6385575">0</span><span class="op" id="6385576">,</span>&nbsp;<span class="ident" id="6385578"><a href="/gostd/net/http/httputil/dump.go.html#6385195">errNoBody</a></span>&nbsp;<span class="op" id="6385588">}</span><br>
<span class="lineno"></span><span class="keyword" id="6385590">func</span>&nbsp;<span class="op" id="6385595">(</span><span class="ident" id="6385596"><a href="/gostd/net/http/httputil/dump.go.html#6385487">failureToReadBody</a></span><span class="op" id="6385613">)</span>&nbsp;<span class="ident" id="6385615">Close</span><span class="op" id="6385620">(</span><span class="op" id="6385621">)</span>&nbsp;<span class="builtintype" id="6385623">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385641">{</span>&nbsp;<span class="keyword" id="6385643">return</span>&nbsp;<span class="builtintype" id="6385650">nil</span>&nbsp;<span class="op" id="6385654">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6385657">var</span>&nbsp;<span class="ident" id="6385661">emptyBody</span>&nbsp;<span class="op" id="6385671">=</span>&nbsp;<span class="ident" id="6385673"><a href="/gostd/net/http/httputil/dump.go.html#6378893">ioutil</a></span><span class="op" id="6385679">.</span><span class="ident" id="6385680"><a href="/gostd/io/ioutil/ioutil.go.html#3767601">NopCloser</a></span><span class="op" id="6385689">(</span><span class="ident" id="6385690"><a href="/gostd/net/http/httputil/dump.go.html#6378936">strings</a></span><span class="op" id="6385697">.</span><span class="ident" id="6385698"><a href="/gostd/strings/reader.go.html#2948317">NewReader</a></span><span class="op" id="6385707">(</span><span class="string" id="6385708">&#34;&#34;</span><span class="op" id="6385710">)</span><span class="op" id="6385711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385714">//&nbsp;DumpResponse&nbsp;is&nbsp;like&nbsp;DumpRequest&nbsp;but&nbsp;dumps&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span><span class="keyword" id="6385772">func</span>&nbsp;<span class="ident" id="6385777">DumpResponse</span><span class="op" id="6385789">(</span><span class="ident" id="6385790">resp</span>&nbsp;<span class="op" id="6385795">*</span><span class="ident" id="6385796"><a href="/gostd/net/http/httputil/dump.go.html#6378913">http</a></span><span class="op" id="6385800">.</span><span class="ident" id="6385801"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="6385809">,</span>&nbsp;<span class="ident" id="6385811">body</span>&nbsp;<span class="builtintype" id="6385816">bool</span><span class="op" id="6385820">)</span>&nbsp;<span class="op" id="6385822">(</span><span class="ident" id="6385823">dump</span>&nbsp;<span class="op" id="6385828">[</span><span class="op" id="6385829">]</span><span class="builtintype" id="6385830">byte</span><span class="op" id="6385834">,</span>&nbsp;<span class="ident" id="6385836">err</span>&nbsp;<span class="builtintype" id="6385840">error</span><span class="op" id="6385845">)</span>&nbsp;<span class="op" id="6385847">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6385850">var</span>&nbsp;<span class="ident" id="6385854">b</span>&nbsp;<span class="ident" id="6385856"><a href="/gostd/net/http/httputil/dump.go.html#6378861">bytes</a></span><span class="op" id="6385861">.</span><span class="ident" id="6385862"><a href="/gostd/bytes/buffer.go.html#1383251">Buffer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385870">save</span>&nbsp;<span class="op" id="6385875">:=</span>&nbsp;<span class="ident" id="6385878"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6385882">.</span><span class="ident" id="6385883"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385889">savecl</span>&nbsp;<span class="op" id="6385896">:=</span>&nbsp;<span class="ident" id="6385899"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6385903">.</span><span class="ident" id="6385904"><a href="/gostd/net/http/response.go.html#4162765">ContentLength</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6385920">if</span>&nbsp;<span class="op" id="6385923">!</span><span class="ident" id="6385924"><a href="/gostd/net/http/httputil/dump.go.html#6385811">body</a></span>&nbsp;<span class="op" id="6385929">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385933"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6385937">.</span><span class="ident" id="6385938"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="6385943">=</span>&nbsp;<span class="ident" id="6385945"><a href="/gostd/net/http/httputil/dump.go.html#6385487">failureToReadBody</a></span><span class="op" id="6385962">{</span><span class="op" id="6385963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6385966">}</span>&nbsp;<span class="keyword" id="6385968">else</span>&nbsp;<span class="keyword" id="6385973">if</span>&nbsp;<span class="ident" id="6385976"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6385980">.</span><span class="ident" id="6385981"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="6385986">==</span>&nbsp;<span class="builtintype" id="6385989">nil</span>&nbsp;<span class="op" id="6385993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385997"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6386001">.</span><span class="ident" id="6386002"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="6386007">=</span>&nbsp;<span class="ident" id="6386009"><a href="/gostd/net/http/httputil/dump.go.html#6385661">emptyBody</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6386020">}</span>&nbsp;<span class="keyword" id="6386022">else</span>&nbsp;<span class="op" id="6386027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386031"><a href="/gostd/net/http/httputil/dump.go.html#6385870">save</a></span><span class="op" id="6386035">,</span>&nbsp;<span class="ident" id="6386037"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6386041">.</span><span class="ident" id="6386042"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6386046">,</span>&nbsp;<span class="ident" id="6386048"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span>&nbsp;<span class="op" id="6386052">=</span>&nbsp;<span class="ident" id="6386054"><a href="/gostd/net/http/httputil/dump.go.html#6379210">drainBody</a></span><span class="op" id="6386063">(</span><span class="ident" id="6386064"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6386068">.</span><span class="ident" id="6386069"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="6386073">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386077">if</span>&nbsp;<span class="ident" id="6386080"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span>&nbsp;<span class="op" id="6386084">!=</span>&nbsp;<span class="builtintype" id="6386087">nil</span>&nbsp;<span class="op" id="6386091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386096">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6386105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6386108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386111"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span>&nbsp;<span class="op" id="6386115">=</span>&nbsp;<span class="ident" id="6386117"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6386121">.</span><span class="ident" id="6386122"><a href="/gostd/net/http/response.go.html#4166814">Write</a></span><span class="op" id="6386127">(</span><span class="op" id="6386128">&amp;</span><span class="ident" id="6386129"><a href="/gostd/net/http/httputil/dump.go.html#6385854">b</a></span><span class="op" id="6386130">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386133">if</span>&nbsp;<span class="ident" id="6386136"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span>&nbsp;<span class="op" id="6386140">==</span>&nbsp;<span class="ident" id="6386143"><a href="/gostd/net/http/httputil/dump.go.html#6385195">errNoBody</a></span>&nbsp;<span class="op" id="6386153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386157"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span>&nbsp;<span class="op" id="6386161">=</span>&nbsp;<span class="builtintype" id="6386163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6386168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386171"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6386175">.</span><span class="ident" id="6386176"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="6386181">=</span>&nbsp;<span class="ident" id="6386183"><a href="/gostd/net/http/httputil/dump.go.html#6385870">save</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6386189"><a href="/gostd/net/http/httputil/dump.go.html#6385790">resp</a></span><span class="op" id="6386193">.</span><span class="ident" id="6386194"><a href="/gostd/net/http/response.go.html#4162765">ContentLength</a></span>&nbsp;<span class="op" id="6386208">=</span>&nbsp;<span class="ident" id="6386210"><a href="/gostd/net/http/httputil/dump.go.html#6385889">savecl</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386218">if</span>&nbsp;<span class="ident" id="6386221"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span>&nbsp;<span class="op" id="6386225">!=</span>&nbsp;<span class="builtintype" id="6386228">nil</span>&nbsp;<span class="op" id="6386232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386236">return</span>&nbsp;<span class="builtintype" id="6386243">nil</span><span class="op" id="6386246">,</span>&nbsp;<span class="ident" id="6386248"><a href="/gostd/net/http/httputil/dump.go.html#6385836">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6386253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6386256">return</span>&nbsp;<span class="ident" id="6386263"><a href="/gostd/net/http/httputil/dump.go.html#6385854">b</a></span><span class="op" id="6386264">.</span><span class="ident" id="6386265"><a href="/gostd/bytes/buffer.go.html#1384454">Bytes</a></span><span class="op" id="6386270">(</span><span class="op" id="6386271">)</span><span class="op" id="6386272">,</span>&nbsp;<span class="builtintype" id="6386274">nil</span><br>
<span class="lineno"></span><span class="op" id="6386278">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
