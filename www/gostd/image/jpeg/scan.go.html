<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6169681">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6169736">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6169790">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6169841">package</span>&nbsp;<span class="ident" id="6169849">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169855">import</span>&nbsp;<span class="op" id="6169862">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169865">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="6169873">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="6169876">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6169936">func</span>&nbsp;<span class="op" id="6169941">(</span><span class="ident" id="6169942">d</span>&nbsp;<span class="op" id="6169944">*</span><span class="ident" id="6169945">decoder</span><span class="op" id="6169952">)</span>&nbsp;<span class="ident" id="6169954">makeImg</span><span class="op" id="6169961">(</span><span class="ident" id="6169962">h0</span><span class="op" id="6169964">,</span>&nbsp;<span class="ident" id="6169966">v0</span><span class="op" id="6169968">,</span>&nbsp;<span class="ident" id="6169970">mxx</span><span class="op" id="6169973">,</span>&nbsp;<span class="ident" id="6169975">myy</span>&nbsp;<span class="builtintype" id="6169979">int</span><span class="op" id="6169982">)</span>&nbsp;<span class="op" id="6169984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6169987">if</span>&nbsp;<span class="ident" id="6169990">d</span><span class="op" id="6169991">.</span><span class="ident" id="6169992">nComp</span>&nbsp;<span class="op" id="6169998">==</span>&nbsp;<span class="ident" id="6170001">nGrayComponent</span>&nbsp;<span class="op" id="6170016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170020">m</span>&nbsp;<span class="op" id="6170022">:=</span>&nbsp;<span class="ident" id="6170025">image</span><span class="op" id="6170030">.</span><span class="ident" id="6170031">NewGray</span><span class="op" id="6170038">(</span><span class="ident" id="6170039">image</span><span class="op" id="6170044">.</span><span class="ident" id="6170045">Rect</span><span class="op" id="6170049">(</span><span class="num" id="6170050">0</span><span class="op" id="6170051">,</span>&nbsp;<span class="num" id="6170053">0</span><span class="op" id="6170054">,</span>&nbsp;<span class="num" id="6170056">8</span><span class="op" id="6170057">*</span><span class="ident" id="6170058">mxx</span><span class="op" id="6170061">,</span>&nbsp;<span class="num" id="6170063">8</span><span class="op" id="6170064">*</span><span class="ident" id="6170065">myy</span><span class="op" id="6170068">)</span><span class="op" id="6170069">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170073">d</span><span class="op" id="6170074">.</span><span class="ident" id="6170075">img1</span>&nbsp;<span class="op" id="6170080">=</span>&nbsp;<span class="ident" id="6170082">m</span><span class="op" id="6170083">.</span><span class="ident" id="6170084">SubImage</span><span class="op" id="6170092">(</span><span class="ident" id="6170093">image</span><span class="op" id="6170098">.</span><span class="ident" id="6170099">Rect</span><span class="op" id="6170103">(</span><span class="num" id="6170104">0</span><span class="op" id="6170105">,</span>&nbsp;<span class="num" id="6170107">0</span><span class="op" id="6170108">,</span>&nbsp;<span class="ident" id="6170110">d</span><span class="op" id="6170111">.</span><span class="ident" id="6170112">width</span><span class="op" id="6170117">,</span>&nbsp;<span class="ident" id="6170119">d</span><span class="op" id="6170120">.</span><span class="ident" id="6170121">height</span><span class="op" id="6170127">)</span><span class="op" id="6170128">)</span><span class="op" id="6170129">.</span><span class="op" id="6170130">(</span><span class="op" id="6170131">*</span><span class="ident" id="6170132">image</span><span class="op" id="6170137">.</span><span class="ident" id="6170138">Gray</span><span class="op" id="6170142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170146">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170157">var</span>&nbsp;<span class="ident" id="6170161">subsampleRatio</span>&nbsp;<span class="ident" id="6170176">image</span><span class="op" id="6170181">.</span><span class="ident" id="6170182">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170203">switch</span>&nbsp;<span class="op" id="6170210">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170213">case</span>&nbsp;<span class="ident" id="6170218">h0</span>&nbsp;<span class="op" id="6170221">==</span>&nbsp;<span class="num" id="6170224">1</span>&nbsp;<span class="op" id="6170226">&amp;&amp;</span>&nbsp;<span class="ident" id="6170229">v0</span>&nbsp;<span class="op" id="6170232">==</span>&nbsp;<span class="num" id="6170235">1</span><span class="op" id="6170236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170240">subsampleRatio</span>&nbsp;<span class="op" id="6170255">=</span>&nbsp;<span class="ident" id="6170257">image</span><span class="op" id="6170262">.</span><span class="ident" id="6170263">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170287">case</span>&nbsp;<span class="ident" id="6170292">h0</span>&nbsp;<span class="op" id="6170295">==</span>&nbsp;<span class="num" id="6170298">1</span>&nbsp;<span class="op" id="6170300">&amp;&amp;</span>&nbsp;<span class="ident" id="6170303">v0</span>&nbsp;<span class="op" id="6170306">==</span>&nbsp;<span class="num" id="6170309">2</span><span class="op" id="6170310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170314">subsampleRatio</span>&nbsp;<span class="op" id="6170329">=</span>&nbsp;<span class="ident" id="6170331">image</span><span class="op" id="6170336">.</span><span class="ident" id="6170337">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170361">case</span>&nbsp;<span class="ident" id="6170366">h0</span>&nbsp;<span class="op" id="6170369">==</span>&nbsp;<span class="num" id="6170372">2</span>&nbsp;<span class="op" id="6170374">&amp;&amp;</span>&nbsp;<span class="ident" id="6170377">v0</span>&nbsp;<span class="op" id="6170380">==</span>&nbsp;<span class="num" id="6170383">1</span><span class="op" id="6170384">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170388">subsampleRatio</span>&nbsp;<span class="op" id="6170403">=</span>&nbsp;<span class="ident" id="6170405">image</span><span class="op" id="6170410">.</span><span class="ident" id="6170411">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170435">case</span>&nbsp;<span class="ident" id="6170440">h0</span>&nbsp;<span class="op" id="6170443">==</span>&nbsp;<span class="num" id="6170446">2</span>&nbsp;<span class="op" id="6170448">&amp;&amp;</span>&nbsp;<span class="ident" id="6170451">v0</span>&nbsp;<span class="op" id="6170454">==</span>&nbsp;<span class="num" id="6170457">2</span><span class="op" id="6170458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170462">subsampleRatio</span>&nbsp;<span class="op" id="6170477">=</span>&nbsp;<span class="ident" id="6170479">image</span><span class="op" id="6170484">.</span><span class="ident" id="6170485">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170509">default</span><span class="op" id="6170516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6170520">panic</span><span class="op" id="6170525">(</span><span class="string" id="6170526">&#34;unreachable&#34;</span><span class="op" id="6170539">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170545">m</span>&nbsp;<span class="op" id="6170547">:=</span>&nbsp;<span class="ident" id="6170550">image</span><span class="op" id="6170555">.</span><span class="ident" id="6170556">NewYCbCr</span><span class="op" id="6170564">(</span><span class="ident" id="6170565">image</span><span class="op" id="6170570">.</span><span class="ident" id="6170571">Rect</span><span class="op" id="6170575">(</span><span class="num" id="6170576">0</span><span class="op" id="6170577">,</span>&nbsp;<span class="num" id="6170579">0</span><span class="op" id="6170580">,</span>&nbsp;<span class="num" id="6170582">8</span><span class="op" id="6170583">*</span><span class="ident" id="6170584">h0</span><span class="op" id="6170586">*</span><span class="ident" id="6170587">mxx</span><span class="op" id="6170590">,</span>&nbsp;<span class="num" id="6170592">8</span><span class="op" id="6170593">*</span><span class="ident" id="6170594">v0</span><span class="op" id="6170596">*</span><span class="ident" id="6170597">myy</span><span class="op" id="6170600">)</span><span class="op" id="6170601">,</span>&nbsp;<span class="ident" id="6170603">subsampleRatio</span><span class="op" id="6170617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170620">d</span><span class="op" id="6170621">.</span><span class="ident" id="6170622">img3</span>&nbsp;<span class="op" id="6170627">=</span>&nbsp;<span class="ident" id="6170629">m</span><span class="op" id="6170630">.</span><span class="ident" id="6170631">SubImage</span><span class="op" id="6170639">(</span><span class="ident" id="6170640">image</span><span class="op" id="6170645">.</span><span class="ident" id="6170646">Rect</span><span class="op" id="6170650">(</span><span class="num" id="6170651">0</span><span class="op" id="6170652">,</span>&nbsp;<span class="num" id="6170654">0</span><span class="op" id="6170655">,</span>&nbsp;<span class="ident" id="6170657">d</span><span class="op" id="6170658">.</span><span class="ident" id="6170659">width</span><span class="op" id="6170664">,</span>&nbsp;<span class="ident" id="6170666">d</span><span class="op" id="6170667">.</span><span class="ident" id="6170668">height</span><span class="op" id="6170674">)</span><span class="op" id="6170675">)</span><span class="op" id="6170676">.</span><span class="op" id="6170677">(</span><span class="op" id="6170678">*</span><span class="ident" id="6170679">image</span><span class="op" id="6170684">.</span><span class="ident" id="6170685">YCbCr</span><span class="op" id="6170690">)</span><br>
<span class="lineno"></span><span class="op" id="6170692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6170695">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6170726">func</span>&nbsp;<span class="op" id="6170731">(</span><span class="ident" id="6170732">d</span>&nbsp;<span class="op" id="6170734">*</span><span class="ident" id="6170735">decoder</span><span class="op" id="6170742">)</span>&nbsp;<span class="ident" id="6170744">processSOS</span><span class="op" id="6170754">(</span><span class="ident" id="6170755">n</span>&nbsp;<span class="builtintype" id="6170757">int</span><span class="op" id="6170760">)</span>&nbsp;<span class="builtintype" id="6170762">error</span>&nbsp;<span class="op" id="6170768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170771">if</span>&nbsp;<span class="ident" id="6170774">d</span><span class="op" id="6170775">.</span><span class="ident" id="6170776">nComp</span>&nbsp;<span class="op" id="6170782">==</span>&nbsp;<span class="num" id="6170785">0</span>&nbsp;<span class="op" id="6170787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170791">return</span>&nbsp;<span class="ident" id="6170798">FormatError</span><span class="op" id="6170809">(</span><span class="string" id="6170810">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="6170830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170833">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170836">if</span>&nbsp;<span class="ident" id="6170839">n</span>&nbsp;<span class="op" id="6170841">&lt;</span>&nbsp;<span class="num" id="6170843">6</span>&nbsp;<span class="op" id="6170845">||</span>&nbsp;<span class="num" id="6170848">4</span><span class="op" id="6170849">+</span><span class="num" id="6170850">2</span><span class="op" id="6170851">*</span><span class="ident" id="6170852">d</span><span class="op" id="6170853">.</span><span class="ident" id="6170854">nComp</span>&nbsp;<span class="op" id="6170860">&lt;</span>&nbsp;<span class="ident" id="6170862">n</span>&nbsp;<span class="op" id="6170864">||</span>&nbsp;<span class="ident" id="6170867">n</span><span class="op" id="6170868">%</span><span class="num" id="6170869">2</span>&nbsp;<span class="op" id="6170871">!=</span>&nbsp;<span class="num" id="6170874">0</span>&nbsp;<span class="op" id="6170876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170880">return</span>&nbsp;<span class="ident" id="6170887">FormatError</span><span class="op" id="6170898">(</span><span class="string" id="6170899">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6170921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170927">if</span>&nbsp;<span class="ident" id="6170930">err</span>&nbsp;<span class="op" id="6170934">:=</span>&nbsp;<span class="ident" id="6170937">d</span><span class="op" id="6170938">.</span><span class="ident" id="6170939">readFull</span><span class="op" id="6170947">(</span><span class="ident" id="6170948">d</span><span class="op" id="6170949">.</span><span class="ident" id="6170950">tmp</span><span class="op" id="6170953">[</span><span class="op" id="6170954">:</span><span class="ident" id="6170955">n</span><span class="op" id="6170956">]</span><span class="op" id="6170957">)</span><span class="op" id="6170958">;</span>&nbsp;<span class="ident" id="6170960">err</span>&nbsp;<span class="op" id="6170964">!=</span>&nbsp;<span class="ident" id="6170967">nil</span>&nbsp;<span class="op" id="6170971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170975">return</span>&nbsp;<span class="ident" id="6170982">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170990">nComp</span>&nbsp;<span class="op" id="6170996">:=</span>&nbsp;<span class="builtintype" id="6170999">int</span><span class="op" id="6171002">(</span><span class="ident" id="6171003">d</span><span class="op" id="6171004">.</span><span class="ident" id="6171005">tmp</span><span class="op" id="6171008">[</span><span class="num" id="6171009">0</span><span class="op" id="6171010">]</span><span class="op" id="6171011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171014">if</span>&nbsp;<span class="ident" id="6171017">n</span>&nbsp;<span class="op" id="6171019">!=</span>&nbsp;<span class="num" id="6171022">4</span><span class="op" id="6171023">+</span><span class="num" id="6171024">2</span><span class="op" id="6171025">*</span><span class="ident" id="6171026">nComp</span>&nbsp;<span class="op" id="6171032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171036">return</span>&nbsp;<span class="ident" id="6171043">FormatError</span><span class="op" id="6171054">(</span><span class="string" id="6171055">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="6171106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171109">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171112">var</span>&nbsp;<span class="ident" id="6171116">scan</span>&nbsp;<span class="op" id="6171121">[</span><span class="ident" id="6171122">nColorComponent</span><span class="op" id="6171137">]</span><span class="keyword" id="6171138">struct</span>&nbsp;<span class="op" id="6171145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171149">compIndex</span>&nbsp;<span class="builtintype" id="6171159">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171167">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6171177">uint8</span>&nbsp;<span class="comment" id="6171183">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171207">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6171217">uint8</span>&nbsp;<span class="comment" id="6171223">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171246">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171249">for</span>&nbsp;<span class="ident" id="6171253">i</span>&nbsp;<span class="op" id="6171255">:=</span>&nbsp;<span class="num" id="6171258">0</span><span class="op" id="6171259">;</span>&nbsp;<span class="ident" id="6171261">i</span>&nbsp;<span class="op" id="6171263">&lt;</span>&nbsp;<span class="ident" id="6171265">nComp</span><span class="op" id="6171270">;</span>&nbsp;<span class="ident" id="6171272">i</span><span class="op" id="6171273">++</span>&nbsp;<span class="op" id="6171276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171280">cs</span>&nbsp;<span class="op" id="6171283">:=</span>&nbsp;<span class="ident" id="6171286">d</span><span class="op" id="6171287">.</span><span class="ident" id="6171288">tmp</span><span class="op" id="6171291">[</span><span class="num" id="6171292">1</span><span class="op" id="6171293">+</span><span class="num" id="6171294">2</span><span class="op" id="6171295">*</span><span class="ident" id="6171296">i</span><span class="op" id="6171297">]</span>&nbsp;<span class="comment" id="6171299">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171324">compIndex</span>&nbsp;<span class="op" id="6171334">:=</span>&nbsp;<span class="op" id="6171337">-</span><span class="num" id="6171338">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171342">for</span>&nbsp;<span class="ident" id="6171346">j</span><span class="op" id="6171347">,</span>&nbsp;<span class="ident" id="6171349">comp</span>&nbsp;<span class="op" id="6171354">:=</span>&nbsp;<span class="keyword" id="6171357">range</span>&nbsp;<span class="ident" id="6171363">d</span><span class="op" id="6171364">.</span><span class="ident" id="6171365">comp</span>&nbsp;<span class="op" id="6171370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171375">if</span>&nbsp;<span class="ident" id="6171378">cs</span>&nbsp;<span class="op" id="6171381">==</span>&nbsp;<span class="ident" id="6171384">comp</span><span class="op" id="6171388">.</span><span class="ident" id="6171389">c</span>&nbsp;<span class="op" id="6171391">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171397">compIndex</span>&nbsp;<span class="op" id="6171407">=</span>&nbsp;<span class="ident" id="6171409">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171422">if</span>&nbsp;<span class="ident" id="6171425">compIndex</span>&nbsp;<span class="op" id="6171435">&lt;</span>&nbsp;<span class="num" id="6171437">0</span>&nbsp;<span class="op" id="6171439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171444">return</span>&nbsp;<span class="ident" id="6171451">FormatError</span><span class="op" id="6171462">(</span><span class="string" id="6171463">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="6171491">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171499">scan</span><span class="op" id="6171503">[</span><span class="ident" id="6171504">i</span><span class="op" id="6171505">]</span><span class="op" id="6171506">.</span><span class="ident" id="6171507">compIndex</span>&nbsp;<span class="op" id="6171517">=</span>&nbsp;<span class="builtintype" id="6171519">uint8</span><span class="op" id="6171524">(</span><span class="ident" id="6171525">compIndex</span><span class="op" id="6171534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171538">scan</span><span class="op" id="6171542">[</span><span class="ident" id="6171543">i</span><span class="op" id="6171544">]</span><span class="op" id="6171545">.</span><span class="ident" id="6171546">td</span>&nbsp;<span class="op" id="6171549">=</span>&nbsp;<span class="ident" id="6171551">d</span><span class="op" id="6171552">.</span><span class="ident" id="6171553">tmp</span><span class="op" id="6171556">[</span><span class="num" id="6171557">2</span><span class="op" id="6171558">+</span><span class="num" id="6171559">2</span><span class="op" id="6171560">*</span><span class="ident" id="6171561">i</span><span class="op" id="6171562">]</span>&nbsp;<span class="op" id="6171564">&gt;&gt;</span>&nbsp;<span class="num" id="6171567">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171571">if</span>&nbsp;<span class="ident" id="6171574">scan</span><span class="op" id="6171578">[</span><span class="ident" id="6171579">i</span><span class="op" id="6171580">]</span><span class="op" id="6171581">.</span><span class="ident" id="6171582">td</span>&nbsp;<span class="op" id="6171585">&gt;</span>&nbsp;<span class="ident" id="6171587">maxTh</span>&nbsp;<span class="op" id="6171593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171598">return</span>&nbsp;<span class="ident" id="6171605">FormatError</span><span class="op" id="6171616">(</span><span class="string" id="6171617">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="6171631">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171639">scan</span><span class="op" id="6171643">[</span><span class="ident" id="6171644">i</span><span class="op" id="6171645">]</span><span class="op" id="6171646">.</span><span class="ident" id="6171647">ta</span>&nbsp;<span class="op" id="6171650">=</span>&nbsp;<span class="ident" id="6171652">d</span><span class="op" id="6171653">.</span><span class="ident" id="6171654">tmp</span><span class="op" id="6171657">[</span><span class="num" id="6171658">2</span><span class="op" id="6171659">+</span><span class="num" id="6171660">2</span><span class="op" id="6171661">*</span><span class="ident" id="6171662">i</span><span class="op" id="6171663">]</span>&nbsp;<span class="op" id="6171665">&amp;</span>&nbsp;<span class="num" id="6171667">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171674">if</span>&nbsp;<span class="ident" id="6171677">scan</span><span class="op" id="6171681">[</span><span class="ident" id="6171682">i</span><span class="op" id="6171683">]</span><span class="op" id="6171684">.</span><span class="ident" id="6171685">ta</span>&nbsp;<span class="op" id="6171688">&gt;</span>&nbsp;<span class="ident" id="6171690">maxTh</span>&nbsp;<span class="op" id="6171696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171701">return</span>&nbsp;<span class="ident" id="6171708">FormatError</span><span class="op" id="6171719">(</span><span class="string" id="6171720">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="6171734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171738">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171745">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171804">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171872">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171923">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171927">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171997">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172068">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172138">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172205">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172273">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172342">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172409">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172479">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172542">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172563">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6172567">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172636">zigStart</span><span class="op" id="6172644">,</span>&nbsp;<span class="ident" id="6172646">zigEnd</span><span class="op" id="6172652">,</span>&nbsp;<span class="ident" id="6172654">ah</span><span class="op" id="6172656">,</span>&nbsp;<span class="ident" id="6172658">al</span>&nbsp;<span class="op" id="6172661">:=</span>&nbsp;<span class="builtintype" id="6172664">int32</span><span class="op" id="6172669">(</span><span class="num" id="6172670">0</span><span class="op" id="6172671">)</span><span class="op" id="6172672">,</span>&nbsp;<span class="builtintype" id="6172674">int32</span><span class="op" id="6172679">(</span><span class="ident" id="6172680">blockSize</span><span class="op" id="6172689">-</span><span class="num" id="6172690">1</span><span class="op" id="6172691">)</span><span class="op" id="6172692">,</span>&nbsp;<span class="builtintype" id="6172694">uint32</span><span class="op" id="6172700">(</span><span class="num" id="6172701">0</span><span class="op" id="6172702">)</span><span class="op" id="6172703">,</span>&nbsp;<span class="builtintype" id="6172705">uint32</span><span class="op" id="6172711">(</span><span class="num" id="6172712">0</span><span class="op" id="6172713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172716">if</span>&nbsp;<span class="ident" id="6172719">d</span><span class="op" id="6172720">.</span><span class="ident" id="6172721">progressive</span>&nbsp;<span class="op" id="6172733">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172737">zigStart</span>&nbsp;<span class="op" id="6172746">=</span>&nbsp;<span class="builtintype" id="6172748">int32</span><span class="op" id="6172753">(</span><span class="ident" id="6172754">d</span><span class="op" id="6172755">.</span><span class="ident" id="6172756">tmp</span><span class="op" id="6172759">[</span><span class="num" id="6172760">1</span><span class="op" id="6172761">+</span><span class="num" id="6172762">2</span><span class="op" id="6172763">*</span><span class="ident" id="6172764">nComp</span><span class="op" id="6172769">]</span><span class="op" id="6172770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172774">zigEnd</span>&nbsp;<span class="op" id="6172781">=</span>&nbsp;<span class="builtintype" id="6172783">int32</span><span class="op" id="6172788">(</span><span class="ident" id="6172789">d</span><span class="op" id="6172790">.</span><span class="ident" id="6172791">tmp</span><span class="op" id="6172794">[</span><span class="num" id="6172795">2</span><span class="op" id="6172796">+</span><span class="num" id="6172797">2</span><span class="op" id="6172798">*</span><span class="ident" id="6172799">nComp</span><span class="op" id="6172804">]</span><span class="op" id="6172805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172809">ah</span>&nbsp;<span class="op" id="6172812">=</span>&nbsp;<span class="builtintype" id="6172814">uint32</span><span class="op" id="6172820">(</span><span class="ident" id="6172821">d</span><span class="op" id="6172822">.</span><span class="ident" id="6172823">tmp</span><span class="op" id="6172826">[</span><span class="num" id="6172827">3</span><span class="op" id="6172828">+</span><span class="num" id="6172829">2</span><span class="op" id="6172830">*</span><span class="ident" id="6172831">nComp</span><span class="op" id="6172836">]</span>&nbsp;<span class="op" id="6172838">&gt;&gt;</span>&nbsp;<span class="num" id="6172841">4</span><span class="op" id="6172842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172846">al</span>&nbsp;<span class="op" id="6172849">=</span>&nbsp;<span class="builtintype" id="6172851">uint32</span><span class="op" id="6172857">(</span><span class="ident" id="6172858">d</span><span class="op" id="6172859">.</span><span class="ident" id="6172860">tmp</span><span class="op" id="6172863">[</span><span class="num" id="6172864">3</span><span class="op" id="6172865">+</span><span class="num" id="6172866">2</span><span class="op" id="6172867">*</span><span class="ident" id="6172868">nComp</span><span class="op" id="6172873">]</span>&nbsp;<span class="op" id="6172875">&amp;</span>&nbsp;<span class="num" id="6172877">0x0f</span><span class="op" id="6172881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172885">if</span>&nbsp;<span class="op" id="6172888">(</span><span class="ident" id="6172889">zigStart</span>&nbsp;<span class="op" id="6172898">==</span>&nbsp;<span class="num" id="6172901">0</span>&nbsp;<span class="op" id="6172903">&amp;&amp;</span>&nbsp;<span class="ident" id="6172906">zigEnd</span>&nbsp;<span class="op" id="6172913">!=</span>&nbsp;<span class="num" id="6172916">0</span><span class="op" id="6172917">)</span>&nbsp;<span class="op" id="6172919">||</span>&nbsp;<span class="ident" id="6172922">zigStart</span>&nbsp;<span class="op" id="6172931">&gt;</span>&nbsp;<span class="ident" id="6172933">zigEnd</span>&nbsp;<span class="op" id="6172940">||</span>&nbsp;<span class="ident" id="6172943">blockSize</span>&nbsp;<span class="op" id="6172953">&lt;=</span>&nbsp;<span class="ident" id="6172956">zigEnd</span>&nbsp;<span class="op" id="6172963">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172968">return</span>&nbsp;<span class="ident" id="6172975">FormatError</span><span class="op" id="6172986">(</span><span class="string" id="6172987">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="6173018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173026">if</span>&nbsp;<span class="ident" id="6173029">zigStart</span>&nbsp;<span class="op" id="6173038">!=</span>&nbsp;<span class="num" id="6173041">0</span>&nbsp;<span class="op" id="6173043">&amp;&amp;</span>&nbsp;<span class="ident" id="6173046">nComp</span>&nbsp;<span class="op" id="6173052">!=</span>&nbsp;<span class="num" id="6173055">1</span>&nbsp;<span class="op" id="6173057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173062">return</span>&nbsp;<span class="ident" id="6173069">FormatError</span><span class="op" id="6173080">(</span><span class="string" id="6173081">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="6173138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173142">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173146">if</span>&nbsp;<span class="ident" id="6173149">ah</span>&nbsp;<span class="op" id="6173152">!=</span>&nbsp;<span class="num" id="6173155">0</span>&nbsp;<span class="op" id="6173157">&amp;&amp;</span>&nbsp;<span class="ident" id="6173160">ah</span>&nbsp;<span class="op" id="6173163">!=</span>&nbsp;<span class="ident" id="6173166">al</span><span class="op" id="6173168">+</span><span class="num" id="6173169">1</span>&nbsp;<span class="op" id="6173171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173176">return</span>&nbsp;<span class="ident" id="6173183">FormatError</span><span class="op" id="6173194">(</span><span class="string" id="6173195">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="6173232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173243">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173318">h0</span><span class="op" id="6173320">,</span>&nbsp;<span class="ident" id="6173322">v0</span>&nbsp;<span class="op" id="6173325">:=</span>&nbsp;<span class="ident" id="6173328">d</span><span class="op" id="6173329">.</span><span class="ident" id="6173330">comp</span><span class="op" id="6173334">[</span><span class="num" id="6173335">0</span><span class="op" id="6173336">]</span><span class="op" id="6173337">.</span><span class="ident" id="6173338">h</span><span class="op" id="6173339">,</span>&nbsp;<span class="ident" id="6173341">d</span><span class="op" id="6173342">.</span><span class="ident" id="6173343">comp</span><span class="op" id="6173347">[</span><span class="num" id="6173348">0</span><span class="op" id="6173349">]</span><span class="op" id="6173350">.</span><span class="ident" id="6173351">v</span>&nbsp;<span class="comment" id="6173353">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173399">mxx</span>&nbsp;<span class="op" id="6173403">:=</span>&nbsp;<span class="op" id="6173406">(</span><span class="ident" id="6173407">d</span><span class="op" id="6173408">.</span><span class="ident" id="6173409">width</span>&nbsp;<span class="op" id="6173415">+</span>&nbsp;<span class="num" id="6173417">8</span><span class="op" id="6173418">*</span><span class="ident" id="6173419">h0</span>&nbsp;<span class="op" id="6173422">-</span>&nbsp;<span class="num" id="6173424">1</span><span class="op" id="6173425">)</span>&nbsp;<span class="op" id="6173427">/</span>&nbsp;<span class="op" id="6173429">(</span><span class="num" id="6173430">8</span>&nbsp;<span class="op" id="6173432">*</span>&nbsp;<span class="ident" id="6173434">h0</span><span class="op" id="6173436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173439">myy</span>&nbsp;<span class="op" id="6173443">:=</span>&nbsp;<span class="op" id="6173446">(</span><span class="ident" id="6173447">d</span><span class="op" id="6173448">.</span><span class="ident" id="6173449">height</span>&nbsp;<span class="op" id="6173456">+</span>&nbsp;<span class="num" id="6173458">8</span><span class="op" id="6173459">*</span><span class="ident" id="6173460">v0</span>&nbsp;<span class="op" id="6173463">-</span>&nbsp;<span class="num" id="6173465">1</span><span class="op" id="6173466">)</span>&nbsp;<span class="op" id="6173468">/</span>&nbsp;<span class="op" id="6173470">(</span><span class="num" id="6173471">8</span>&nbsp;<span class="op" id="6173473">*</span>&nbsp;<span class="ident" id="6173475">v0</span><span class="op" id="6173477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173480">if</span>&nbsp;<span class="ident" id="6173483">d</span><span class="op" id="6173484">.</span><span class="ident" id="6173485">img1</span>&nbsp;<span class="op" id="6173490">==</span>&nbsp;<span class="ident" id="6173493">nil</span>&nbsp;<span class="op" id="6173497">&amp;&amp;</span>&nbsp;<span class="ident" id="6173500">d</span><span class="op" id="6173501">.</span><span class="ident" id="6173502">img3</span>&nbsp;<span class="op" id="6173507">==</span>&nbsp;<span class="ident" id="6173510">nil</span>&nbsp;<span class="op" id="6173514">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173518">d</span><span class="op" id="6173519">.</span><span class="ident" id="6173520">makeImg</span><span class="op" id="6173527">(</span><span class="ident" id="6173528">h0</span><span class="op" id="6173530">,</span>&nbsp;<span class="ident" id="6173532">v0</span><span class="op" id="6173534">,</span>&nbsp;<span class="ident" id="6173536">mxx</span><span class="op" id="6173539">,</span>&nbsp;<span class="ident" id="6173541">myy</span><span class="op" id="6173544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173550">if</span>&nbsp;<span class="ident" id="6173553">d</span><span class="op" id="6173554">.</span><span class="ident" id="6173555">progressive</span>&nbsp;<span class="op" id="6173567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173571">for</span>&nbsp;<span class="ident" id="6173575">i</span>&nbsp;<span class="op" id="6173577">:=</span>&nbsp;<span class="num" id="6173580">0</span><span class="op" id="6173581">;</span>&nbsp;<span class="ident" id="6173583">i</span>&nbsp;<span class="op" id="6173585">&lt;</span>&nbsp;<span class="ident" id="6173587">nComp</span><span class="op" id="6173592">;</span>&nbsp;<span class="ident" id="6173594">i</span><span class="op" id="6173595">++</span>&nbsp;<span class="op" id="6173598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173603">compIndex</span>&nbsp;<span class="op" id="6173613">:=</span>&nbsp;<span class="ident" id="6173616">scan</span><span class="op" id="6173620">[</span><span class="ident" id="6173621">i</span><span class="op" id="6173622">]</span><span class="op" id="6173623">.</span><span class="ident" id="6173624">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173637">if</span>&nbsp;<span class="ident" id="6173640">d</span><span class="op" id="6173641">.</span><span class="ident" id="6173642">progCoeffs</span><span class="op" id="6173652">[</span><span class="ident" id="6173653">compIndex</span><span class="op" id="6173662">]</span>&nbsp;<span class="op" id="6173664">==</span>&nbsp;<span class="ident" id="6173667">nil</span>&nbsp;<span class="op" id="6173671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173677">d</span><span class="op" id="6173678">.</span><span class="ident" id="6173679">progCoeffs</span><span class="op" id="6173689">[</span><span class="ident" id="6173690">compIndex</span><span class="op" id="6173699">]</span>&nbsp;<span class="op" id="6173701">=</span>&nbsp;<span class="builtinfunc" id="6173703">make</span><span class="op" id="6173707">(</span><span class="op" id="6173708">[</span><span class="op" id="6173709">]</span><span class="ident" id="6173710">block</span><span class="op" id="6173715">,</span>&nbsp;<span class="ident" id="6173717">mxx</span><span class="op" id="6173720">*</span><span class="ident" id="6173721">myy</span><span class="op" id="6173724">*</span><span class="ident" id="6173725">d</span><span class="op" id="6173726">.</span><span class="ident" id="6173727">comp</span><span class="op" id="6173731">[</span><span class="ident" id="6173732">compIndex</span><span class="op" id="6173741">]</span><span class="op" id="6173742">.</span><span class="ident" id="6173743">h</span><span class="op" id="6173744">*</span><span class="ident" id="6173745">d</span><span class="op" id="6173746">.</span><span class="ident" id="6173747">comp</span><span class="op" id="6173751">[</span><span class="ident" id="6173752">compIndex</span><span class="op" id="6173761">]</span><span class="op" id="6173762">.</span><span class="ident" id="6173763">v</span><span class="op" id="6173764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173776">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173780">d</span><span class="op" id="6173781">.</span><span class="ident" id="6173782">bits</span>&nbsp;<span class="op" id="6173787">=</span>&nbsp;<span class="ident" id="6173789">bits</span><span class="op" id="6173793">{</span><span class="op" id="6173794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173797">mcu</span><span class="op" id="6173800">,</span>&nbsp;<span class="ident" id="6173802">expectedRST</span>&nbsp;<span class="op" id="6173814">:=</span>&nbsp;<span class="num" id="6173817">0</span><span class="op" id="6173818">,</span>&nbsp;<span class="builtintype" id="6173820">uint8</span><span class="op" id="6173825">(</span><span class="ident" id="6173826">rst0Marker</span><span class="op" id="6173836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173839">var</span>&nbsp;<span class="op" id="6173843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173847">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173915">b</span>&nbsp;&nbsp;<span class="ident" id="6173918">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173926">dc</span>&nbsp;<span class="op" id="6173929">[</span><span class="ident" id="6173930">nColorComponent</span><span class="op" id="6173945">]</span><span class="builtintype" id="6173946">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173954">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174027">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174101">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174174">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174244">bx</span><span class="op" id="6174246">,</span>&nbsp;<span class="ident" id="6174248">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6174255">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174261">blockCount</span>&nbsp;<span class="builtintype" id="6174272">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174280">for</span>&nbsp;<span class="ident" id="6174284">my</span>&nbsp;<span class="op" id="6174287">:=</span>&nbsp;<span class="num" id="6174290">0</span><span class="op" id="6174291">;</span>&nbsp;<span class="ident" id="6174293">my</span>&nbsp;<span class="op" id="6174296">&lt;</span>&nbsp;<span class="ident" id="6174298">myy</span><span class="op" id="6174301">;</span>&nbsp;<span class="ident" id="6174303">my</span><span class="op" id="6174305">++</span>&nbsp;<span class="op" id="6174308">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174312">for</span>&nbsp;<span class="ident" id="6174316">mx</span>&nbsp;<span class="op" id="6174319">:=</span>&nbsp;<span class="num" id="6174322">0</span><span class="op" id="6174323">;</span>&nbsp;<span class="ident" id="6174325">mx</span>&nbsp;<span class="op" id="6174328">&lt;</span>&nbsp;<span class="ident" id="6174330">mxx</span><span class="op" id="6174333">;</span>&nbsp;<span class="ident" id="6174335">mx</span><span class="op" id="6174337">++</span>&nbsp;<span class="op" id="6174340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174345">for</span>&nbsp;<span class="ident" id="6174349">i</span>&nbsp;<span class="op" id="6174351">:=</span>&nbsp;<span class="num" id="6174354">0</span><span class="op" id="6174355">;</span>&nbsp;<span class="ident" id="6174357">i</span>&nbsp;<span class="op" id="6174359">&lt;</span>&nbsp;<span class="ident" id="6174361">nComp</span><span class="op" id="6174366">;</span>&nbsp;<span class="ident" id="6174368">i</span><span class="op" id="6174369">++</span>&nbsp;<span class="op" id="6174372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174378">compIndex</span>&nbsp;<span class="op" id="6174388">:=</span>&nbsp;<span class="ident" id="6174391">scan</span><span class="op" id="6174395">[</span><span class="ident" id="6174396">i</span><span class="op" id="6174397">]</span><span class="op" id="6174398">.</span><span class="ident" id="6174399">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174413">qt</span>&nbsp;<span class="op" id="6174416">:=</span>&nbsp;<span class="op" id="6174419">&amp;</span><span class="ident" id="6174420">d</span><span class="op" id="6174421">.</span><span class="ident" id="6174422">quant</span><span class="op" id="6174427">[</span><span class="ident" id="6174428">d</span><span class="op" id="6174429">.</span><span class="ident" id="6174430">comp</span><span class="op" id="6174434">[</span><span class="ident" id="6174435">compIndex</span><span class="op" id="6174444">]</span><span class="op" id="6174445">.</span><span class="ident" id="6174446">tq</span><span class="op" id="6174448">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174454">for</span>&nbsp;<span class="ident" id="6174458">j</span>&nbsp;<span class="op" id="6174460">:=</span>&nbsp;<span class="num" id="6174463">0</span><span class="op" id="6174464">;</span>&nbsp;<span class="ident" id="6174466">j</span>&nbsp;<span class="op" id="6174468">&lt;</span>&nbsp;<span class="ident" id="6174470">d</span><span class="op" id="6174471">.</span><span class="ident" id="6174472">comp</span><span class="op" id="6174476">[</span><span class="ident" id="6174477">compIndex</span><span class="op" id="6174486">]</span><span class="op" id="6174487">.</span><span class="ident" id="6174488">h</span><span class="op" id="6174489">*</span><span class="ident" id="6174490">d</span><span class="op" id="6174491">.</span><span class="ident" id="6174492">comp</span><span class="op" id="6174496">[</span><span class="ident" id="6174497">compIndex</span><span class="op" id="6174506">]</span><span class="op" id="6174507">.</span><span class="ident" id="6174508">v</span><span class="op" id="6174509">;</span>&nbsp;<span class="ident" id="6174511">j</span><span class="op" id="6174512">++</span>&nbsp;<span class="op" id="6174515">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174522">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174591">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174660">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174668">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174742">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174758">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174774">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174782">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174859">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174936">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174969">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174985">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175001">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175078">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175106">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175114">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175192">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175267">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175346">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175422">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175455">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175471">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175487">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175551">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175565">//&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175579">if</span>&nbsp;<span class="ident" id="6175582">nComp</span>&nbsp;<span class="op" id="6175588">!=</span>&nbsp;<span class="num" id="6175591">1</span>&nbsp;<span class="op" id="6175593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175601">bx</span><span class="op" id="6175603">,</span>&nbsp;<span class="ident" id="6175605">by</span>&nbsp;<span class="op" id="6175608">=</span>&nbsp;<span class="ident" id="6175610">d</span><span class="op" id="6175611">.</span><span class="ident" id="6175612">comp</span><span class="op" id="6175616">[</span><span class="ident" id="6175617">compIndex</span><span class="op" id="6175626">]</span><span class="op" id="6175627">.</span><span class="ident" id="6175628">h</span><span class="op" id="6175629">*</span><span class="ident" id="6175630">mx</span><span class="op" id="6175632">,</span>&nbsp;<span class="ident" id="6175634">d</span><span class="op" id="6175635">.</span><span class="ident" id="6175636">comp</span><span class="op" id="6175640">[</span><span class="ident" id="6175641">compIndex</span><span class="op" id="6175650">]</span><span class="op" id="6175651">.</span><span class="ident" id="6175652">v</span><span class="op" id="6175653">*</span><span class="ident" id="6175654">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175663">if</span>&nbsp;<span class="ident" id="6175666">h0</span>&nbsp;<span class="op" id="6175669">==</span>&nbsp;<span class="num" id="6175672">1</span>&nbsp;<span class="op" id="6175674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175683">by</span>&nbsp;<span class="op" id="6175686">+=</span>&nbsp;<span class="ident" id="6175689">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175697">}</span>&nbsp;<span class="keyword" id="6175699">else</span>&nbsp;<span class="op" id="6175704">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175713">bx</span>&nbsp;<span class="op" id="6175716">+=</span>&nbsp;<span class="ident" id="6175719">j</span>&nbsp;<span class="op" id="6175721">%</span>&nbsp;<span class="num" id="6175723">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175732">by</span>&nbsp;<span class="op" id="6175735">+=</span>&nbsp;<span class="ident" id="6175738">j</span>&nbsp;<span class="op" id="6175740">/</span>&nbsp;<span class="num" id="6175742">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175757">}</span>&nbsp;<span class="keyword" id="6175759">else</span>&nbsp;<span class="op" id="6175764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175772">q</span>&nbsp;<span class="op" id="6175774">:=</span>&nbsp;<span class="ident" id="6175777">mxx</span>&nbsp;<span class="op" id="6175781">*</span>&nbsp;<span class="ident" id="6175783">d</span><span class="op" id="6175784">.</span><span class="ident" id="6175785">comp</span><span class="op" id="6175789">[</span><span class="ident" id="6175790">compIndex</span><span class="op" id="6175799">]</span><span class="op" id="6175800">.</span><span class="ident" id="6175801">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175809">bx</span>&nbsp;<span class="op" id="6175812">=</span>&nbsp;<span class="ident" id="6175814">blockCount</span>&nbsp;<span class="op" id="6175825">%</span>&nbsp;<span class="ident" id="6175827">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175835">by</span>&nbsp;<span class="op" id="6175838">=</span>&nbsp;<span class="ident" id="6175840">blockCount</span>&nbsp;<span class="op" id="6175851">/</span>&nbsp;<span class="ident" id="6175853">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175861">blockCount</span><span class="op" id="6175871">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175880">if</span>&nbsp;<span class="ident" id="6175883">bx</span><span class="op" id="6175885">*</span><span class="num" id="6175886">8</span>&nbsp;<span class="op" id="6175888">&gt;=</span>&nbsp;<span class="ident" id="6175891">d</span><span class="op" id="6175892">.</span><span class="ident" id="6175893">width</span>&nbsp;<span class="op" id="6175899">||</span>&nbsp;<span class="ident" id="6175902">by</span><span class="op" id="6175904">*</span><span class="num" id="6175905">8</span>&nbsp;<span class="op" id="6175907">&gt;=</span>&nbsp;<span class="ident" id="6175910">d</span><span class="op" id="6175911">.</span><span class="ident" id="6175912">height</span>&nbsp;<span class="op" id="6175919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175928">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175958">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176031">if</span>&nbsp;<span class="ident" id="6176034">d</span><span class="op" id="6176035">.</span><span class="ident" id="6176036">progressive</span>&nbsp;<span class="op" id="6176048">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176056">b</span>&nbsp;<span class="op" id="6176058">=</span>&nbsp;<span class="ident" id="6176060">d</span><span class="op" id="6176061">.</span><span class="ident" id="6176062">progCoeffs</span><span class="op" id="6176072">[</span><span class="ident" id="6176073">compIndex</span><span class="op" id="6176082">]</span><span class="op" id="6176083">[</span><span class="ident" id="6176084">by</span><span class="op" id="6176086">*</span><span class="ident" id="6176087">mxx</span><span class="op" id="6176090">*</span><span class="ident" id="6176091">d</span><span class="op" id="6176092">.</span><span class="ident" id="6176093">comp</span><span class="op" id="6176097">[</span><span class="ident" id="6176098">compIndex</span><span class="op" id="6176107">]</span><span class="op" id="6176108">.</span><span class="ident" id="6176109">h</span><span class="op" id="6176110">+</span><span class="ident" id="6176111">bx</span><span class="op" id="6176113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176120">}</span>&nbsp;<span class="keyword" id="6176122">else</span>&nbsp;<span class="op" id="6176127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176135">b</span>&nbsp;<span class="op" id="6176137">=</span>&nbsp;<span class="ident" id="6176139">block</span><span class="op" id="6176144">{</span><span class="op" id="6176145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176160">if</span>&nbsp;<span class="ident" id="6176163">ah</span>&nbsp;<span class="op" id="6176166">!=</span>&nbsp;<span class="num" id="6176169">0</span>&nbsp;<span class="op" id="6176171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176179">if</span>&nbsp;<span class="ident" id="6176182">err</span>&nbsp;<span class="op" id="6176186">:=</span>&nbsp;<span class="ident" id="6176189">d</span><span class="op" id="6176190">.</span><span class="ident" id="6176191">refine</span><span class="op" id="6176197">(</span><span class="op" id="6176198">&amp;</span><span class="ident" id="6176199">b</span><span class="op" id="6176200">,</span>&nbsp;<span class="op" id="6176202">&amp;</span><span class="ident" id="6176203">d</span><span class="op" id="6176204">.</span><span class="ident" id="6176205">huff</span><span class="op" id="6176209">[</span><span class="ident" id="6176210">acTable</span><span class="op" id="6176217">]</span><span class="op" id="6176218">[</span><span class="ident" id="6176219">scan</span><span class="op" id="6176223">[</span><span class="ident" id="6176224">i</span><span class="op" id="6176225">]</span><span class="op" id="6176226">.</span><span class="ident" id="6176227">ta</span><span class="op" id="6176229">]</span><span class="op" id="6176230">,</span>&nbsp;<span class="ident" id="6176232">zigStart</span><span class="op" id="6176240">,</span>&nbsp;<span class="ident" id="6176242">zigEnd</span><span class="op" id="6176248">,</span>&nbsp;<span class="num" id="6176250">1</span><span class="op" id="6176251">&lt;&lt;</span><span class="ident" id="6176253">al</span><span class="op" id="6176255">)</span><span class="op" id="6176256">;</span>&nbsp;<span class="ident" id="6176258">err</span>&nbsp;<span class="op" id="6176262">!=</span>&nbsp;<span class="ident" id="6176265">nil</span>&nbsp;<span class="op" id="6176269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176278">return</span>&nbsp;<span class="ident" id="6176285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176302">}</span>&nbsp;<span class="keyword" id="6176304">else</span>&nbsp;<span class="op" id="6176309">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176317">zig</span>&nbsp;<span class="op" id="6176321">:=</span>&nbsp;<span class="ident" id="6176324">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176339">if</span>&nbsp;<span class="ident" id="6176342">zig</span>&nbsp;<span class="op" id="6176346">==</span>&nbsp;<span class="num" id="6176349">0</span>&nbsp;<span class="op" id="6176351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176360">zig</span><span class="op" id="6176363">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6176373">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176443">value</span><span class="op" id="6176448">,</span>&nbsp;<span class="ident" id="6176450">err</span>&nbsp;<span class="op" id="6176454">:=</span>&nbsp;<span class="ident" id="6176457">d</span><span class="op" id="6176458">.</span><span class="ident" id="6176459">decodeHuffman</span><span class="op" id="6176472">(</span><span class="op" id="6176473">&amp;</span><span class="ident" id="6176474">d</span><span class="op" id="6176475">.</span><span class="ident" id="6176476">huff</span><span class="op" id="6176480">[</span><span class="ident" id="6176481">dcTable</span><span class="op" id="6176488">]</span><span class="op" id="6176489">[</span><span class="ident" id="6176490">scan</span><span class="op" id="6176494">[</span><span class="ident" id="6176495">i</span><span class="op" id="6176496">]</span><span class="op" id="6176497">.</span><span class="ident" id="6176498">td</span><span class="op" id="6176500">]</span><span class="op" id="6176501">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176510">if</span>&nbsp;<span class="ident" id="6176513">err</span>&nbsp;<span class="op" id="6176517">!=</span>&nbsp;<span class="ident" id="6176520">nil</span>&nbsp;<span class="op" id="6176524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176534">return</span>&nbsp;<span class="ident" id="6176541">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176561">if</span>&nbsp;<span class="ident" id="6176564">value</span>&nbsp;<span class="op" id="6176570">&gt;</span>&nbsp;<span class="num" id="6176572">16</span>&nbsp;<span class="op" id="6176575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176585">return</span>&nbsp;<span class="ident" id="6176592">UnsupportedError</span><span class="op" id="6176608">(</span><span class="string" id="6176609">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="6176633">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176651">dcDelta</span><span class="op" id="6176658">,</span>&nbsp;<span class="ident" id="6176660">err</span>&nbsp;<span class="op" id="6176664">:=</span>&nbsp;<span class="ident" id="6176667">d</span><span class="op" id="6176668">.</span><span class="ident" id="6176669">receiveExtend</span><span class="op" id="6176682">(</span><span class="ident" id="6176683">value</span><span class="op" id="6176688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176697">if</span>&nbsp;<span class="ident" id="6176700">err</span>&nbsp;<span class="op" id="6176704">!=</span>&nbsp;<span class="ident" id="6176707">nil</span>&nbsp;<span class="op" id="6176711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176721">return</span>&nbsp;<span class="ident" id="6176728">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176739">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176748">dc</span><span class="op" id="6176750">[</span><span class="ident" id="6176751">compIndex</span><span class="op" id="6176760">]</span>&nbsp;<span class="op" id="6176762">+=</span>&nbsp;<span class="ident" id="6176765">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176780">b</span><span class="op" id="6176781">[</span><span class="num" id="6176782">0</span><span class="op" id="6176783">]</span>&nbsp;<span class="op" id="6176785">=</span>&nbsp;<span class="ident" id="6176787">dc</span><span class="op" id="6176789">[</span><span class="ident" id="6176790">compIndex</span><span class="op" id="6176799">]</span>&nbsp;<span class="op" id="6176801">&lt;&lt;</span>&nbsp;<span class="ident" id="6176804">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176822">if</span>&nbsp;<span class="ident" id="6176825">zig</span>&nbsp;<span class="op" id="6176829">&lt;=</span>&nbsp;<span class="ident" id="6176832">zigEnd</span>&nbsp;<span class="op" id="6176839">&amp;&amp;</span>&nbsp;<span class="ident" id="6176842">d</span><span class="op" id="6176843">.</span><span class="ident" id="6176844">eobRun</span>&nbsp;<span class="op" id="6176851">&gt;</span>&nbsp;<span class="num" id="6176853">0</span>&nbsp;<span class="op" id="6176855">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176864">d</span><span class="op" id="6176865">.</span><span class="ident" id="6176866">eobRun</span><span class="op" id="6176872">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176881">}</span>&nbsp;<span class="keyword" id="6176883">else</span>&nbsp;<span class="op" id="6176888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6176897">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176968">huff</span>&nbsp;<span class="op" id="6176973">:=</span>&nbsp;<span class="op" id="6176976">&amp;</span><span class="ident" id="6176977">d</span><span class="op" id="6176978">.</span><span class="ident" id="6176979">huff</span><span class="op" id="6176983">[</span><span class="ident" id="6176984">acTable</span><span class="op" id="6176991">]</span><span class="op" id="6176992">[</span><span class="ident" id="6176993">scan</span><span class="op" id="6176997">[</span><span class="ident" id="6176998">i</span><span class="op" id="6176999">]</span><span class="op" id="6177000">.</span><span class="ident" id="6177001">ta</span><span class="op" id="6177003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177012">for</span>&nbsp;<span class="op" id="6177016">;</span>&nbsp;<span class="ident" id="6177018">zig</span>&nbsp;<span class="op" id="6177022">&lt;=</span>&nbsp;<span class="ident" id="6177025">zigEnd</span><span class="op" id="6177031">;</span>&nbsp;<span class="ident" id="6177033">zig</span><span class="op" id="6177036">++</span>&nbsp;<span class="op" id="6177039">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177049">value</span><span class="op" id="6177054">,</span>&nbsp;<span class="ident" id="6177056">err</span>&nbsp;<span class="op" id="6177060">:=</span>&nbsp;<span class="ident" id="6177063">d</span><span class="op" id="6177064">.</span><span class="ident" id="6177065">decodeHuffman</span><span class="op" id="6177078">(</span><span class="ident" id="6177079">huff</span><span class="op" id="6177083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177093">if</span>&nbsp;<span class="ident" id="6177096">err</span>&nbsp;<span class="op" id="6177100">!=</span>&nbsp;<span class="ident" id="6177103">nil</span>&nbsp;<span class="op" id="6177107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177118">return</span>&nbsp;<span class="ident" id="6177125">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177147">val0</span>&nbsp;<span class="op" id="6177152">:=</span>&nbsp;<span class="ident" id="6177155">value</span>&nbsp;<span class="op" id="6177161">&gt;&gt;</span>&nbsp;<span class="num" id="6177164">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177174">val1</span>&nbsp;<span class="op" id="6177179">:=</span>&nbsp;<span class="ident" id="6177182">value</span>&nbsp;<span class="op" id="6177188">&amp;</span>&nbsp;<span class="num" id="6177190">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177203">if</span>&nbsp;<span class="ident" id="6177206">val1</span>&nbsp;<span class="op" id="6177211">!=</span>&nbsp;<span class="num" id="6177214">0</span>&nbsp;<span class="op" id="6177216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177227">zig</span>&nbsp;<span class="op" id="6177231">+=</span>&nbsp;<span class="builtintype" id="6177234">int32</span><span class="op" id="6177239">(</span><span class="ident" id="6177240">val0</span><span class="op" id="6177244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177255">if</span>&nbsp;<span class="ident" id="6177258">zig</span>&nbsp;<span class="op" id="6177262">&gt;</span>&nbsp;<span class="ident" id="6177264">zigEnd</span>&nbsp;<span class="op" id="6177271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177283">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177309">ac</span><span class="op" id="6177311">,</span>&nbsp;<span class="ident" id="6177313">err</span>&nbsp;<span class="op" id="6177317">:=</span>&nbsp;<span class="ident" id="6177320">d</span><span class="op" id="6177321">.</span><span class="ident" id="6177322">receiveExtend</span><span class="op" id="6177335">(</span><span class="ident" id="6177336">val1</span><span class="op" id="6177340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177351">if</span>&nbsp;<span class="ident" id="6177354">err</span>&nbsp;<span class="op" id="6177358">!=</span>&nbsp;<span class="ident" id="6177361">nil</span>&nbsp;<span class="op" id="6177365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177377">return</span>&nbsp;<span class="ident" id="6177384">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177397">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177408">b</span><span class="op" id="6177409">[</span><span class="ident" id="6177410">unzig</span><span class="op" id="6177415">[</span><span class="ident" id="6177416">zig</span><span class="op" id="6177419">]</span><span class="op" id="6177420">]</span>&nbsp;<span class="op" id="6177422">=</span>&nbsp;<span class="ident" id="6177424">ac</span>&nbsp;<span class="op" id="6177427">&lt;&lt;</span>&nbsp;<span class="ident" id="6177430">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177441">}</span>&nbsp;<span class="keyword" id="6177443">else</span>&nbsp;<span class="op" id="6177448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177459">if</span>&nbsp;<span class="ident" id="6177462">val0</span>&nbsp;<span class="op" id="6177467">!=</span>&nbsp;<span class="num" id="6177470">0x0f</span>&nbsp;<span class="op" id="6177475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177487">d</span><span class="op" id="6177488">.</span><span class="ident" id="6177489">eobRun</span>&nbsp;<span class="op" id="6177496">=</span>&nbsp;<span class="builtintype" id="6177498">uint16</span><span class="op" id="6177504">(</span><span class="num" id="6177505">1</span>&nbsp;<span class="op" id="6177507">&lt;&lt;</span>&nbsp;<span class="ident" id="6177510">val0</span><span class="op" id="6177514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177526">if</span>&nbsp;<span class="ident" id="6177529">val0</span>&nbsp;<span class="op" id="6177534">!=</span>&nbsp;<span class="num" id="6177537">0</span>&nbsp;<span class="op" id="6177539">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177552">bits</span><span class="op" id="6177556">,</span>&nbsp;<span class="ident" id="6177558">err</span>&nbsp;<span class="op" id="6177562">:=</span>&nbsp;<span class="ident" id="6177565">d</span><span class="op" id="6177566">.</span><span class="ident" id="6177567">decodeBits</span><span class="op" id="6177577">(</span><span class="builtintype" id="6177578">int32</span><span class="op" id="6177583">(</span><span class="ident" id="6177584">val0</span><span class="op" id="6177588">)</span><span class="op" id="6177589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177602">if</span>&nbsp;<span class="ident" id="6177605">err</span>&nbsp;<span class="op" id="6177609">!=</span>&nbsp;<span class="ident" id="6177612">nil</span>&nbsp;<span class="op" id="6177616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177630">return</span>&nbsp;<span class="ident" id="6177637">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177665">d</span><span class="op" id="6177666">.</span><span class="ident" id="6177667">eobRun</span>&nbsp;<span class="op" id="6177674">|=</span>&nbsp;<span class="builtintype" id="6177677">uint16</span><span class="op" id="6177683">(</span><span class="ident" id="6177684">bits</span><span class="op" id="6177688">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177712">d</span><span class="op" id="6177713">.</span><span class="ident" id="6177714">eobRun</span><span class="op" id="6177720">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177733">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177759">zig</span>&nbsp;<span class="op" id="6177763">+=</span>&nbsp;<span class="num" id="6177766">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177811">if</span>&nbsp;<span class="ident" id="6177814">d</span><span class="op" id="6177815">.</span><span class="ident" id="6177816">progressive</span>&nbsp;<span class="op" id="6177828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177836">if</span>&nbsp;<span class="ident" id="6177839">zigEnd</span>&nbsp;<span class="op" id="6177846">!=</span>&nbsp;<span class="ident" id="6177849">blockSize</span><span class="op" id="6177858">-</span><span class="num" id="6177859">1</span>&nbsp;<span class="op" id="6177861">||</span>&nbsp;<span class="ident" id="6177864">al</span>&nbsp;<span class="op" id="6177867">!=</span>&nbsp;<span class="num" id="6177870">0</span>&nbsp;<span class="op" id="6177872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6177881">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177960">d</span><span class="op" id="6177961">.</span><span class="ident" id="6177962">progCoeffs</span><span class="op" id="6177972">[</span><span class="ident" id="6177973">compIndex</span><span class="op" id="6177982">]</span><span class="op" id="6177983">[</span><span class="ident" id="6177984">by</span><span class="op" id="6177986">*</span><span class="ident" id="6177987">mxx</span><span class="op" id="6177990">*</span><span class="ident" id="6177991">d</span><span class="op" id="6177992">.</span><span class="ident" id="6177993">comp</span><span class="op" id="6177997">[</span><span class="ident" id="6177998">compIndex</span><span class="op" id="6178007">]</span><span class="op" id="6178008">.</span><span class="ident" id="6178009">h</span><span class="op" id="6178010">+</span><span class="ident" id="6178011">bx</span><span class="op" id="6178013">]</span>&nbsp;<span class="op" id="6178015">=</span>&nbsp;<span class="ident" id="6178017">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178026">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178112">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178198">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178283">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178369">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178430">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178460">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178538">for</span>&nbsp;<span class="ident" id="6178542">zig</span>&nbsp;<span class="op" id="6178546">:=</span>&nbsp;<span class="num" id="6178549">0</span><span class="op" id="6178550">;</span>&nbsp;<span class="ident" id="6178552">zig</span>&nbsp;<span class="op" id="6178556">&lt;</span>&nbsp;<span class="ident" id="6178558">blockSize</span><span class="op" id="6178567">;</span>&nbsp;<span class="ident" id="6178569">zig</span><span class="op" id="6178572">++</span>&nbsp;<span class="op" id="6178575">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178583">b</span><span class="op" id="6178584">[</span><span class="ident" id="6178585">unzig</span><span class="op" id="6178590">[</span><span class="ident" id="6178591">zig</span><span class="op" id="6178594">]</span><span class="op" id="6178595">]</span>&nbsp;<span class="op" id="6178597">*=</span>&nbsp;<span class="ident" id="6178600">qt</span><span class="op" id="6178602">[</span><span class="ident" id="6178603">zig</span><span class="op" id="6178606">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178620">idct</span><span class="op" id="6178624">(</span><span class="op" id="6178625">&amp;</span><span class="ident" id="6178626">b</span><span class="op" id="6178627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178634">dst</span><span class="op" id="6178637">,</span>&nbsp;<span class="ident" id="6178639">stride</span>&nbsp;<span class="op" id="6178646">:=</span>&nbsp;<span class="op" id="6178649">[</span><span class="op" id="6178650">]</span><span class="builtintype" id="6178651">byte</span><span class="op" id="6178655">(</span><span class="ident" id="6178656">nil</span><span class="op" id="6178659">)</span><span class="op" id="6178660">,</span>&nbsp;<span class="num" id="6178662">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178669">if</span>&nbsp;<span class="ident" id="6178672">d</span><span class="op" id="6178673">.</span><span class="ident" id="6178674">nComp</span>&nbsp;<span class="op" id="6178680">==</span>&nbsp;<span class="ident" id="6178683">nGrayComponent</span>&nbsp;<span class="op" id="6178698">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178706">dst</span><span class="op" id="6178709">,</span>&nbsp;<span class="ident" id="6178711">stride</span>&nbsp;<span class="op" id="6178718">=</span>&nbsp;<span class="ident" id="6178720">d</span><span class="op" id="6178721">.</span><span class="ident" id="6178722">img1</span><span class="op" id="6178726">.</span><span class="ident" id="6178727">Pix</span><span class="op" id="6178730">[</span><span class="num" id="6178731">8</span><span class="op" id="6178732">*</span><span class="op" id="6178733">(</span><span class="ident" id="6178734">by</span><span class="op" id="6178736">*</span><span class="ident" id="6178737">d</span><span class="op" id="6178738">.</span><span class="ident" id="6178739">img1</span><span class="op" id="6178743">.</span><span class="ident" id="6178744">Stride</span><span class="op" id="6178750">+</span><span class="ident" id="6178751">bx</span><span class="op" id="6178753">)</span><span class="op" id="6178754">:</span><span class="op" id="6178755">]</span><span class="op" id="6178756">,</span>&nbsp;<span class="ident" id="6178758">d</span><span class="op" id="6178759">.</span><span class="ident" id="6178760">img1</span><span class="op" id="6178764">.</span><span class="ident" id="6178765">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178777">}</span>&nbsp;<span class="keyword" id="6178779">else</span>&nbsp;<span class="op" id="6178784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178792">switch</span>&nbsp;<span class="ident" id="6178799">compIndex</span>&nbsp;<span class="op" id="6178809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178817">case</span>&nbsp;<span class="num" id="6178822">0</span><span class="op" id="6178823">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178832">dst</span><span class="op" id="6178835">,</span>&nbsp;<span class="ident" id="6178837">stride</span>&nbsp;<span class="op" id="6178844">=</span>&nbsp;<span class="ident" id="6178846">d</span><span class="op" id="6178847">.</span><span class="ident" id="6178848">img3</span><span class="op" id="6178852">.</span><span class="ident" id="6178853">Y</span><span class="op" id="6178854">[</span><span class="num" id="6178855">8</span><span class="op" id="6178856">*</span><span class="op" id="6178857">(</span><span class="ident" id="6178858">by</span><span class="op" id="6178860">*</span><span class="ident" id="6178861">d</span><span class="op" id="6178862">.</span><span class="ident" id="6178863">img3</span><span class="op" id="6178867">.</span><span class="ident" id="6178868">YStride</span><span class="op" id="6178875">+</span><span class="ident" id="6178876">bx</span><span class="op" id="6178878">)</span><span class="op" id="6178879">:</span><span class="op" id="6178880">]</span><span class="op" id="6178881">,</span>&nbsp;<span class="ident" id="6178883">d</span><span class="op" id="6178884">.</span><span class="ident" id="6178885">img3</span><span class="op" id="6178889">.</span><span class="ident" id="6178890">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178904">case</span>&nbsp;<span class="num" id="6178909">1</span><span class="op" id="6178910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178919">dst</span><span class="op" id="6178922">,</span>&nbsp;<span class="ident" id="6178924">stride</span>&nbsp;<span class="op" id="6178931">=</span>&nbsp;<span class="ident" id="6178933">d</span><span class="op" id="6178934">.</span><span class="ident" id="6178935">img3</span><span class="op" id="6178939">.</span><span class="ident" id="6178940">Cb</span><span class="op" id="6178942">[</span><span class="num" id="6178943">8</span><span class="op" id="6178944">*</span><span class="op" id="6178945">(</span><span class="ident" id="6178946">by</span><span class="op" id="6178948">*</span><span class="ident" id="6178949">d</span><span class="op" id="6178950">.</span><span class="ident" id="6178951">img3</span><span class="op" id="6178955">.</span><span class="ident" id="6178956">CStride</span><span class="op" id="6178963">+</span><span class="ident" id="6178964">bx</span><span class="op" id="6178966">)</span><span class="op" id="6178967">:</span><span class="op" id="6178968">]</span><span class="op" id="6178969">,</span>&nbsp;<span class="ident" id="6178971">d</span><span class="op" id="6178972">.</span><span class="ident" id="6178973">img3</span><span class="op" id="6178977">.</span><span class="ident" id="6178978">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178992">case</span>&nbsp;<span class="num" id="6178997">2</span><span class="op" id="6178998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179007">dst</span><span class="op" id="6179010">,</span>&nbsp;<span class="ident" id="6179012">stride</span>&nbsp;<span class="op" id="6179019">=</span>&nbsp;<span class="ident" id="6179021">d</span><span class="op" id="6179022">.</span><span class="ident" id="6179023">img3</span><span class="op" id="6179027">.</span><span class="ident" id="6179028">Cr</span><span class="op" id="6179030">[</span><span class="num" id="6179031">8</span><span class="op" id="6179032">*</span><span class="op" id="6179033">(</span><span class="ident" id="6179034">by</span><span class="op" id="6179036">*</span><span class="ident" id="6179037">d</span><span class="op" id="6179038">.</span><span class="ident" id="6179039">img3</span><span class="op" id="6179043">.</span><span class="ident" id="6179044">CStride</span><span class="op" id="6179051">+</span><span class="ident" id="6179052">bx</span><span class="op" id="6179054">)</span><span class="op" id="6179055">:</span><span class="op" id="6179056">]</span><span class="op" id="6179057">,</span>&nbsp;<span class="ident" id="6179059">d</span><span class="op" id="6179060">.</span><span class="ident" id="6179061">img3</span><span class="op" id="6179065">.</span><span class="ident" id="6179066">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179080">default</span><span class="op" id="6179087">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179096">return</span>&nbsp;<span class="ident" id="6179103">UnsupportedError</span><span class="op" id="6179119">(</span><span class="string" id="6179120">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="6179141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6179163">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179228">for</span>&nbsp;<span class="ident" id="6179232">y</span>&nbsp;<span class="op" id="6179234">:=</span>&nbsp;<span class="num" id="6179237">0</span><span class="op" id="6179238">;</span>&nbsp;<span class="ident" id="6179240">y</span>&nbsp;<span class="op" id="6179242">&lt;</span>&nbsp;<span class="num" id="6179244">8</span><span class="op" id="6179245">;</span>&nbsp;<span class="ident" id="6179247">y</span><span class="op" id="6179248">++</span>&nbsp;<span class="op" id="6179251">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179259">y8</span>&nbsp;<span class="op" id="6179262">:=</span>&nbsp;<span class="ident" id="6179265">y</span>&nbsp;<span class="op" id="6179267">*</span>&nbsp;<span class="num" id="6179269">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179277">yStride</span>&nbsp;<span class="op" id="6179285">:=</span>&nbsp;<span class="ident" id="6179288">y</span>&nbsp;<span class="op" id="6179290">*</span>&nbsp;<span class="ident" id="6179292">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179305">for</span>&nbsp;<span class="ident" id="6179309">x</span>&nbsp;<span class="op" id="6179311">:=</span>&nbsp;<span class="num" id="6179314">0</span><span class="op" id="6179315">;</span>&nbsp;<span class="ident" id="6179317">x</span>&nbsp;<span class="op" id="6179319">&lt;</span>&nbsp;<span class="num" id="6179321">8</span><span class="op" id="6179322">;</span>&nbsp;<span class="ident" id="6179324">x</span><span class="op" id="6179325">++</span>&nbsp;<span class="op" id="6179328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179337">c</span>&nbsp;<span class="op" id="6179339">:=</span>&nbsp;<span class="ident" id="6179342">b</span><span class="op" id="6179343">[</span><span class="ident" id="6179344">y8</span><span class="op" id="6179346">+</span><span class="ident" id="6179347">x</span><span class="op" id="6179348">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179357">if</span>&nbsp;<span class="ident" id="6179360">c</span>&nbsp;<span class="op" id="6179362">&lt;</span>&nbsp;<span class="op" id="6179364">-</span><span class="num" id="6179365">128</span>&nbsp;<span class="op" id="6179369">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179379">c</span>&nbsp;<span class="op" id="6179381">=</span>&nbsp;<span class="num" id="6179383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179392">}</span>&nbsp;<span class="keyword" id="6179394">else</span>&nbsp;<span class="keyword" id="6179399">if</span>&nbsp;<span class="ident" id="6179402">c</span>&nbsp;<span class="op" id="6179404">&gt;</span>&nbsp;<span class="num" id="6179406">127</span>&nbsp;<span class="op" id="6179410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179420">c</span>&nbsp;<span class="op" id="6179422">=</span>&nbsp;<span class="num" id="6179424">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179435">}</span>&nbsp;<span class="keyword" id="6179437">else</span>&nbsp;<span class="op" id="6179442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179452">c</span>&nbsp;<span class="op" id="6179454">+=</span>&nbsp;<span class="num" id="6179457">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179477">dst</span><span class="op" id="6179480">[</span><span class="ident" id="6179481">yStride</span><span class="op" id="6179488">+</span><span class="ident" id="6179489">x</span><span class="op" id="6179490">]</span>&nbsp;<span class="op" id="6179492">=</span>&nbsp;<span class="builtintype" id="6179494">uint8</span><span class="op" id="6179499">(</span><span class="ident" id="6179500">c</span><span class="op" id="6179501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179522">}</span>&nbsp;<span class="comment" id="6179524">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179536">}</span>&nbsp;<span class="comment" id="6179538">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179550">mcu</span><span class="op" id="6179553">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179559">if</span>&nbsp;<span class="ident" id="6179562">d</span><span class="op" id="6179563">.</span><span class="ident" id="6179564">ri</span>&nbsp;<span class="op" id="6179567">&gt;</span>&nbsp;<span class="num" id="6179569">0</span>&nbsp;<span class="op" id="6179571">&amp;&amp;</span>&nbsp;<span class="ident" id="6179574">mcu</span><span class="op" id="6179577">%</span><span class="ident" id="6179578">d</span><span class="op" id="6179579">.</span><span class="ident" id="6179580">ri</span>&nbsp;<span class="op" id="6179583">==</span>&nbsp;<span class="num" id="6179586">0</span>&nbsp;<span class="op" id="6179588">&amp;&amp;</span>&nbsp;<span class="ident" id="6179591">mcu</span>&nbsp;<span class="op" id="6179595">&lt;</span>&nbsp;<span class="ident" id="6179597">mxx</span><span class="op" id="6179600">*</span><span class="ident" id="6179601">myy</span>&nbsp;<span class="op" id="6179605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6179611">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6179711">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179808">if</span>&nbsp;<span class="ident" id="6179811">err</span>&nbsp;<span class="op" id="6179815">:=</span>&nbsp;<span class="ident" id="6179818">d</span><span class="op" id="6179819">.</span><span class="ident" id="6179820">readFull</span><span class="op" id="6179828">(</span><span class="ident" id="6179829">d</span><span class="op" id="6179830">.</span><span class="ident" id="6179831">tmp</span><span class="op" id="6179834">[</span><span class="op" id="6179835">:</span><span class="num" id="6179836">2</span><span class="op" id="6179837">]</span><span class="op" id="6179838">)</span><span class="op" id="6179839">;</span>&nbsp;<span class="ident" id="6179841">err</span>&nbsp;<span class="op" id="6179845">!=</span>&nbsp;<span class="ident" id="6179848">nil</span>&nbsp;<span class="op" id="6179852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179859">return</span>&nbsp;<span class="ident" id="6179866">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179880">if</span>&nbsp;<span class="ident" id="6179883">d</span><span class="op" id="6179884">.</span><span class="ident" id="6179885">tmp</span><span class="op" id="6179888">[</span><span class="num" id="6179889">0</span><span class="op" id="6179890">]</span>&nbsp;<span class="op" id="6179892">!=</span>&nbsp;<span class="num" id="6179895">0xff</span>&nbsp;<span class="op" id="6179900">||</span>&nbsp;<span class="ident" id="6179903">d</span><span class="op" id="6179904">.</span><span class="ident" id="6179905">tmp</span><span class="op" id="6179908">[</span><span class="num" id="6179909">1</span><span class="op" id="6179910">]</span>&nbsp;<span class="op" id="6179912">!=</span>&nbsp;<span class="ident" id="6179915">expectedRST</span>&nbsp;<span class="op" id="6179927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179934">return</span>&nbsp;<span class="ident" id="6179941">FormatError</span><span class="op" id="6179952">(</span><span class="string" id="6179953">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="6179969">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179981">expectedRST</span><span class="op" id="6179992">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179999">if</span>&nbsp;<span class="ident" id="6180002">expectedRST</span>&nbsp;<span class="op" id="6180014">==</span>&nbsp;<span class="ident" id="6180017">rst7Marker</span><span class="op" id="6180027">+</span><span class="num" id="6180028">1</span>&nbsp;<span class="op" id="6180030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180037">expectedRST</span>&nbsp;<span class="op" id="6180049">=</span>&nbsp;<span class="ident" id="6180051">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180066">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180072">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180106">d</span><span class="op" id="6180107">.</span><span class="ident" id="6180108">bits</span>&nbsp;<span class="op" id="6180113">=</span>&nbsp;<span class="ident" id="6180115">bits</span><span class="op" id="6180119">{</span><span class="op" id="6180120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180126">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180184">dc</span>&nbsp;<span class="op" id="6180187">=</span>&nbsp;<span class="op" id="6180189">[</span><span class="ident" id="6180190">nColorComponent</span><span class="op" id="6180205">]</span><span class="builtintype" id="6180206">int32</span><span class="op" id="6180211">{</span><span class="op" id="6180212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180218">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180286">d</span><span class="op" id="6180287">.</span><span class="ident" id="6180288">eobRun</span>&nbsp;<span class="op" id="6180295">=</span>&nbsp;<span class="num" id="6180297">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180306">}</span>&nbsp;<span class="comment" id="6180308">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180319">}</span>&nbsp;<span class="comment" id="6180321">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180333">return</span>&nbsp;<span class="ident" id="6180340">nil</span><br>
<span class="lineno"></span><span class="op" id="6180344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6180347">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6180426">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="6180444">func</span>&nbsp;<span class="op" id="6180449">(</span><span class="ident" id="6180450">d</span>&nbsp;<span class="op" id="6180452">*</span><span class="ident" id="6180453">decoder</span><span class="op" id="6180460">)</span>&nbsp;<span class="ident" id="6180462">refine</span><span class="op" id="6180468">(</span><span class="ident" id="6180469">b</span>&nbsp;<span class="op" id="6180471">*</span><span class="ident" id="6180472">block</span><span class="op" id="6180477">,</span>&nbsp;<span class="ident" id="6180479">h</span>&nbsp;<span class="op" id="6180481">*</span><span class="ident" id="6180482">huffman</span><span class="op" id="6180489">,</span>&nbsp;<span class="ident" id="6180491">zigStart</span><span class="op" id="6180499">,</span>&nbsp;<span class="ident" id="6180501">zigEnd</span><span class="op" id="6180507">,</span>&nbsp;<span class="ident" id="6180509">delta</span>&nbsp;<span class="builtintype" id="6180515">int32</span><span class="op" id="6180520">)</span>&nbsp;<span class="builtintype" id="6180522">error</span>&nbsp;<span class="op" id="6180528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180531">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180571">if</span>&nbsp;<span class="ident" id="6180574">zigStart</span>&nbsp;<span class="op" id="6180583">==</span>&nbsp;<span class="num" id="6180586">0</span>&nbsp;<span class="op" id="6180588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180592">if</span>&nbsp;<span class="ident" id="6180595">zigEnd</span>&nbsp;<span class="op" id="6180602">!=</span>&nbsp;<span class="num" id="6180605">0</span>&nbsp;<span class="op" id="6180607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6180612">panic</span><span class="op" id="6180617">(</span><span class="string" id="6180618">&#34;unreachable&#34;</span><span class="op" id="6180631">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180639">bit</span><span class="op" id="6180642">,</span>&nbsp;<span class="ident" id="6180644">err</span>&nbsp;<span class="op" id="6180648">:=</span>&nbsp;<span class="ident" id="6180651">d</span><span class="op" id="6180652">.</span><span class="ident" id="6180653">decodeBit</span><span class="op" id="6180662">(</span><span class="op" id="6180663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180667">if</span>&nbsp;<span class="ident" id="6180670">err</span>&nbsp;<span class="op" id="6180674">!=</span>&nbsp;<span class="ident" id="6180677">nil</span>&nbsp;<span class="op" id="6180681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180686">return</span>&nbsp;<span class="ident" id="6180693">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180699">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180703">if</span>&nbsp;<span class="ident" id="6180706">bit</span>&nbsp;<span class="op" id="6180710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180715">b</span><span class="op" id="6180716">[</span><span class="num" id="6180717">0</span><span class="op" id="6180718">]</span>&nbsp;<span class="op" id="6180720">|=</span>&nbsp;<span class="ident" id="6180723">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180735">return</span>&nbsp;<span class="ident" id="6180742">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180747">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180751">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180833">zig</span>&nbsp;<span class="op" id="6180837">:=</span>&nbsp;<span class="ident" id="6180840">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180850">if</span>&nbsp;<span class="ident" id="6180853">d</span><span class="op" id="6180854">.</span><span class="ident" id="6180855">eobRun</span>&nbsp;<span class="op" id="6180862">==</span>&nbsp;<span class="num" id="6180865">0</span>&nbsp;<span class="op" id="6180867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180870">loop</span><span class="op" id="6180874">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180878">for</span>&nbsp;<span class="op" id="6180882">;</span>&nbsp;<span class="ident" id="6180884">zig</span>&nbsp;<span class="op" id="6180888">&lt;=</span>&nbsp;<span class="ident" id="6180891">zigEnd</span><span class="op" id="6180897">;</span>&nbsp;<span class="ident" id="6180899">zig</span><span class="op" id="6180902">++</span>&nbsp;<span class="op" id="6180905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180910">z</span>&nbsp;<span class="op" id="6180912">:=</span>&nbsp;<span class="builtintype" id="6180915">int32</span><span class="op" id="6180920">(</span><span class="num" id="6180921">0</span><span class="op" id="6180922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180927">value</span><span class="op" id="6180932">,</span>&nbsp;<span class="ident" id="6180934">err</span>&nbsp;<span class="op" id="6180938">:=</span>&nbsp;<span class="ident" id="6180941">d</span><span class="op" id="6180942">.</span><span class="ident" id="6180943">decodeHuffman</span><span class="op" id="6180956">(</span><span class="ident" id="6180957">h</span><span class="op" id="6180958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180963">if</span>&nbsp;<span class="ident" id="6180966">err</span>&nbsp;<span class="op" id="6180970">!=</span>&nbsp;<span class="ident" id="6180973">nil</span>&nbsp;<span class="op" id="6180977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180983">return</span>&nbsp;<span class="ident" id="6180990">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181002">val0</span>&nbsp;<span class="op" id="6181007">:=</span>&nbsp;<span class="ident" id="6181010">value</span>&nbsp;<span class="op" id="6181016">&gt;&gt;</span>&nbsp;<span class="num" id="6181019">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181024">val1</span>&nbsp;<span class="op" id="6181029">:=</span>&nbsp;<span class="ident" id="6181032">value</span>&nbsp;<span class="op" id="6181038">&amp;</span>&nbsp;<span class="num" id="6181040">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181049">switch</span>&nbsp;<span class="ident" id="6181056">val1</span>&nbsp;<span class="op" id="6181061">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181066">case</span>&nbsp;<span class="num" id="6181071">0</span><span class="op" id="6181072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181078">if</span>&nbsp;<span class="ident" id="6181081">val0</span>&nbsp;<span class="op" id="6181086">!=</span>&nbsp;<span class="num" id="6181089">0x0f</span>&nbsp;<span class="op" id="6181094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181101">d</span><span class="op" id="6181102">.</span><span class="ident" id="6181103">eobRun</span>&nbsp;<span class="op" id="6181110">=</span>&nbsp;<span class="builtintype" id="6181112">uint16</span><span class="op" id="6181118">(</span><span class="num" id="6181119">1</span>&nbsp;<span class="op" id="6181121">&lt;&lt;</span>&nbsp;<span class="ident" id="6181124">val0</span><span class="op" id="6181128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181135">if</span>&nbsp;<span class="ident" id="6181138">val0</span>&nbsp;<span class="op" id="6181143">!=</span>&nbsp;<span class="num" id="6181146">0</span>&nbsp;<span class="op" id="6181148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181156">bits</span><span class="op" id="6181160">,</span>&nbsp;<span class="ident" id="6181162">err</span>&nbsp;<span class="op" id="6181166">:=</span>&nbsp;<span class="ident" id="6181169">d</span><span class="op" id="6181170">.</span><span class="ident" id="6181171">decodeBits</span><span class="op" id="6181181">(</span><span class="builtintype" id="6181182">int32</span><span class="op" id="6181187">(</span><span class="ident" id="6181188">val0</span><span class="op" id="6181192">)</span><span class="op" id="6181193">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181201">if</span>&nbsp;<span class="ident" id="6181204">err</span>&nbsp;<span class="op" id="6181208">!=</span>&nbsp;<span class="ident" id="6181211">nil</span>&nbsp;<span class="op" id="6181215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181224">return</span>&nbsp;<span class="ident" id="6181231">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181249">d</span><span class="op" id="6181250">.</span><span class="ident" id="6181251">eobRun</span>&nbsp;<span class="op" id="6181258">|=</span>&nbsp;<span class="builtintype" id="6181261">uint16</span><span class="op" id="6181267">(</span><span class="ident" id="6181268">bits</span><span class="op" id="6181272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181279">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181286">break</span>&nbsp;<span class="ident" id="6181292">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181306">case</span>&nbsp;<span class="num" id="6181311">1</span><span class="op" id="6181312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181318">z</span>&nbsp;<span class="op" id="6181320">=</span>&nbsp;<span class="ident" id="6181322">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181332">bit</span><span class="op" id="6181335">,</span>&nbsp;<span class="ident" id="6181337">err</span>&nbsp;<span class="op" id="6181341">:=</span>&nbsp;<span class="ident" id="6181344">d</span><span class="op" id="6181345">.</span><span class="ident" id="6181346">decodeBit</span><span class="op" id="6181355">(</span><span class="op" id="6181356">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181362">if</span>&nbsp;<span class="ident" id="6181365">err</span>&nbsp;<span class="op" id="6181369">!=</span>&nbsp;<span class="ident" id="6181372">nil</span>&nbsp;<span class="op" id="6181376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181383">return</span>&nbsp;<span class="ident" id="6181390">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181404">if</span>&nbsp;<span class="op" id="6181407">!</span><span class="ident" id="6181408">bit</span>&nbsp;<span class="op" id="6181412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181419">z</span>&nbsp;<span class="op" id="6181421">=</span>&nbsp;<span class="op" id="6181423">-</span><span class="ident" id="6181424">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181435">default</span><span class="op" id="6181442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181448">return</span>&nbsp;<span class="ident" id="6181455">FormatError</span><span class="op" id="6181466">(</span><span class="string" id="6181467">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="6181492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181503">zig</span><span class="op" id="6181506">,</span>&nbsp;<span class="ident" id="6181508">err</span>&nbsp;<span class="op" id="6181512">=</span>&nbsp;<span class="ident" id="6181514">d</span><span class="op" id="6181515">.</span><span class="ident" id="6181516">refineNonZeroes</span><span class="op" id="6181531">(</span><span class="ident" id="6181532">b</span><span class="op" id="6181533">,</span>&nbsp;<span class="ident" id="6181535">zig</span><span class="op" id="6181538">,</span>&nbsp;<span class="ident" id="6181540">zigEnd</span><span class="op" id="6181546">,</span>&nbsp;<span class="builtintype" id="6181548">int32</span><span class="op" id="6181553">(</span><span class="ident" id="6181554">val0</span><span class="op" id="6181558">)</span><span class="op" id="6181559">,</span>&nbsp;<span class="ident" id="6181561">delta</span><span class="op" id="6181566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181571">if</span>&nbsp;<span class="ident" id="6181574">err</span>&nbsp;<span class="op" id="6181578">!=</span>&nbsp;<span class="ident" id="6181581">nil</span>&nbsp;<span class="op" id="6181585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181591">return</span>&nbsp;<span class="ident" id="6181598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181610">if</span>&nbsp;<span class="ident" id="6181613">zig</span>&nbsp;<span class="op" id="6181617">&gt;</span>&nbsp;<span class="ident" id="6181619">zigEnd</span>&nbsp;<span class="op" id="6181626">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181632">return</span>&nbsp;<span class="ident" id="6181639">FormatError</span><span class="op" id="6181650">(</span><span class="string" id="6181651">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="6181674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181684">if</span>&nbsp;<span class="ident" id="6181687">z</span>&nbsp;<span class="op" id="6181689">!=</span>&nbsp;<span class="num" id="6181692">0</span>&nbsp;<span class="op" id="6181694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181700">b</span><span class="op" id="6181701">[</span><span class="ident" id="6181702">unzig</span><span class="op" id="6181707">[</span><span class="ident" id="6181708">zig</span><span class="op" id="6181711">]</span><span class="op" id="6181712">]</span>&nbsp;<span class="op" id="6181714">=</span>&nbsp;<span class="ident" id="6181716">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181721">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181731">if</span>&nbsp;<span class="ident" id="6181734">d</span><span class="op" id="6181735">.</span><span class="ident" id="6181736">eobRun</span>&nbsp;<span class="op" id="6181743">&gt;</span>&nbsp;<span class="num" id="6181745">0</span>&nbsp;<span class="op" id="6181747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181751">d</span><span class="op" id="6181752">.</span><span class="ident" id="6181753">eobRun</span><span class="op" id="6181759">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181764">if</span>&nbsp;<span class="ident" id="6181767">_</span><span class="op" id="6181768">,</span>&nbsp;<span class="ident" id="6181770">err</span>&nbsp;<span class="op" id="6181774">:=</span>&nbsp;<span class="ident" id="6181777">d</span><span class="op" id="6181778">.</span><span class="ident" id="6181779">refineNonZeroes</span><span class="op" id="6181794">(</span><span class="ident" id="6181795">b</span><span class="op" id="6181796">,</span>&nbsp;<span class="ident" id="6181798">zig</span><span class="op" id="6181801">,</span>&nbsp;<span class="ident" id="6181803">zigEnd</span><span class="op" id="6181809">,</span>&nbsp;<span class="op" id="6181811">-</span><span class="num" id="6181812">1</span><span class="op" id="6181813">,</span>&nbsp;<span class="ident" id="6181815">delta</span><span class="op" id="6181820">)</span><span class="op" id="6181821">;</span>&nbsp;<span class="ident" id="6181823">err</span>&nbsp;<span class="op" id="6181827">!=</span>&nbsp;<span class="ident" id="6181830">nil</span>&nbsp;<span class="op" id="6181834">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181839">return</span>&nbsp;<span class="ident" id="6181846">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181858">return</span>&nbsp;<span class="ident" id="6181865">nil</span><br>
<span class="lineno"></span><span class="op" id="6181869">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="6181872">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="6181951">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="6181998">func</span>&nbsp;<span class="op" id="6182003">(</span><span class="ident" id="6182004">d</span>&nbsp;<span class="op" id="6182006">*</span><span class="ident" id="6182007">decoder</span><span class="op" id="6182014">)</span>&nbsp;<span class="ident" id="6182016">refineNonZeroes</span><span class="op" id="6182031">(</span><span class="ident" id="6182032">b</span>&nbsp;<span class="op" id="6182034">*</span><span class="ident" id="6182035">block</span><span class="op" id="6182040">,</span>&nbsp;<span class="ident" id="6182042">zig</span><span class="op" id="6182045">,</span>&nbsp;<span class="ident" id="6182047">zigEnd</span><span class="op" id="6182053">,</span>&nbsp;<span class="ident" id="6182055">nz</span><span class="op" id="6182057">,</span>&nbsp;<span class="ident" id="6182059">delta</span>&nbsp;<span class="builtintype" id="6182065">int32</span><span class="op" id="6182070">)</span>&nbsp;<span class="op" id="6182072">(</span><span class="builtintype" id="6182073">int32</span><span class="op" id="6182078">,</span>&nbsp;<span class="builtintype" id="6182080">error</span><span class="op" id="6182085">)</span>&nbsp;<span class="op" id="6182087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182090">for</span>&nbsp;<span class="op" id="6182094">;</span>&nbsp;<span class="ident" id="6182096">zig</span>&nbsp;<span class="op" id="6182100">&lt;=</span>&nbsp;<span class="ident" id="6182103">zigEnd</span><span class="op" id="6182109">;</span>&nbsp;<span class="ident" id="6182111">zig</span><span class="op" id="6182114">++</span>&nbsp;<span class="op" id="6182117">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182121">u</span>&nbsp;<span class="op" id="6182123">:=</span>&nbsp;<span class="ident" id="6182126">unzig</span><span class="op" id="6182131">[</span><span class="ident" id="6182132">zig</span><span class="op" id="6182135">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182139">if</span>&nbsp;<span class="ident" id="6182142">b</span><span class="op" id="6182143">[</span><span class="ident" id="6182144">u</span><span class="op" id="6182145">]</span>&nbsp;<span class="op" id="6182147">==</span>&nbsp;<span class="num" id="6182150">0</span>&nbsp;<span class="op" id="6182152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182157">if</span>&nbsp;<span class="ident" id="6182160">nz</span>&nbsp;<span class="op" id="6182163">==</span>&nbsp;<span class="num" id="6182166">0</span>&nbsp;<span class="op" id="6182168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182183">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182188">nz</span><span class="op" id="6182190">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182196">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182211">bit</span><span class="op" id="6182214">,</span>&nbsp;<span class="ident" id="6182216">err</span>&nbsp;<span class="op" id="6182220">:=</span>&nbsp;<span class="ident" id="6182223">d</span><span class="op" id="6182224">.</span><span class="ident" id="6182225">decodeBit</span><span class="op" id="6182234">(</span><span class="op" id="6182235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182239">if</span>&nbsp;<span class="ident" id="6182242">err</span>&nbsp;<span class="op" id="6182246">!=</span>&nbsp;<span class="ident" id="6182249">nil</span>&nbsp;<span class="op" id="6182253">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182258">return</span>&nbsp;<span class="num" id="6182265">0</span><span class="op" id="6182266">,</span>&nbsp;<span class="ident" id="6182268">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182278">if</span>&nbsp;<span class="op" id="6182281">!</span><span class="ident" id="6182282">bit</span>&nbsp;<span class="op" id="6182286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182291">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182302">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182306">if</span>&nbsp;<span class="ident" id="6182309">b</span><span class="op" id="6182310">[</span><span class="ident" id="6182311">u</span><span class="op" id="6182312">]</span>&nbsp;<span class="op" id="6182314">&gt;=</span>&nbsp;<span class="num" id="6182317">0</span>&nbsp;<span class="op" id="6182319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182324">b</span><span class="op" id="6182325">[</span><span class="ident" id="6182326">u</span><span class="op" id="6182327">]</span>&nbsp;<span class="op" id="6182329">+=</span>&nbsp;<span class="ident" id="6182332">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182340">}</span>&nbsp;<span class="keyword" id="6182342">else</span>&nbsp;<span class="op" id="6182347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6182352">b</span><span class="op" id="6182353">[</span><span class="ident" id="6182354">u</span><span class="op" id="6182355">]</span>&nbsp;<span class="op" id="6182357">-=</span>&nbsp;<span class="ident" id="6182360">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182368">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6182371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6182374">return</span>&nbsp;<span class="ident" id="6182381">zig</span><span class="op" id="6182384">,</span>&nbsp;<span class="ident" id="6182386">nil</span><br>
<span class="lineno"></span><span class="op" id="6182390">}</span>
</div>
</body>
</html>
