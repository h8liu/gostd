<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4807523">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4807579">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4807633">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4807684">package</span>&nbsp;<span class="ident" id="4807692">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4807700">//&nbsp;Simplify&nbsp;returns&nbsp;a&nbsp;regexp&nbsp;equivalent&nbsp;to&nbsp;re&nbsp;but&nbsp;without&nbsp;counted&nbsp;repetitions</span><br>
<span class="lineno"></span><span class="comment" id="4807778">//&nbsp;and&nbsp;with&nbsp;various&nbsp;other&nbsp;simplifications,&nbsp;such&nbsp;as&nbsp;rewriting&nbsp;/(?:a+)+/&nbsp;to&nbsp;/a+/.</span><br>
<span class="lineno"></span><span class="comment" id="4807858">//&nbsp;The&nbsp;resulting&nbsp;regexp&nbsp;will&nbsp;execute&nbsp;correctly&nbsp;but&nbsp;its&nbsp;string&nbsp;representation</span><br>
<span class="lineno">10</span><span class="comment" id="4807935">//&nbsp;will&nbsp;not&nbsp;produce&nbsp;the&nbsp;same&nbsp;parse&nbsp;tree,&nbsp;because&nbsp;capturing&nbsp;parentheses</span><br>
<span class="lineno"></span><span class="comment" id="4808006">//&nbsp;may&nbsp;have&nbsp;been&nbsp;duplicated&nbsp;or&nbsp;removed.&nbsp;&nbsp;For&nbsp;example,&nbsp;the&nbsp;simplified&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4808080">//&nbsp;for&nbsp;/(x){1,2}/&nbsp;is&nbsp;/(x)(x)?/&nbsp;but&nbsp;both&nbsp;parentheses&nbsp;capture&nbsp;as&nbsp;$1.</span><br>
<span class="lineno"></span><span class="comment" id="4808147">//&nbsp;The&nbsp;returned&nbsp;regexp&nbsp;may&nbsp;share&nbsp;structure&nbsp;with&nbsp;or&nbsp;be&nbsp;the&nbsp;original.</span><br>
<span class="lineno"></span><span class="keyword" id="4808215">func</span>&nbsp;<span class="op" id="4808220">(</span><span class="ident" id="4808221">re</span>&nbsp;<span class="op" id="4808224">*</span><span class="ident" id="4808225"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4808231">)</span>&nbsp;<span class="ident" id="4808233">Simplify</span><span class="op" id="4808241">(</span><span class="op" id="4808242">)</span>&nbsp;<span class="op" id="4808244">*</span><span class="ident" id="4808245"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span>&nbsp;<span class="op" id="4808252">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808255">if</span>&nbsp;<span class="ident" id="4808258"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span>&nbsp;<span class="op" id="4808261">==</span>&nbsp;<span class="ident" id="4808264">nil</span>&nbsp;<span class="op" id="4808268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808272">return</span>&nbsp;<span class="ident" id="4808279">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808287">switch</span>&nbsp;<span class="ident" id="4808294"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808296">.</span><span class="ident" id="4808297">Op</span>&nbsp;<span class="op" id="4808300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808303">case</span>&nbsp;<span class="ident" id="4808308"><a href="/regexp/syntax/regexp.go.html#4801626">OpCapture</a></span><span class="op" id="4808317">,</span>&nbsp;<span class="ident" id="4808319"><a href="/regexp/syntax/regexp.go.html#4802031">OpConcat</a></span><span class="op" id="4808327">,</span>&nbsp;<span class="ident" id="4808329"><a href="/regexp/syntax/regexp.go.html#4802096">OpAlternate</a></span><span class="op" id="4808340">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808344">//&nbsp;Simplify&nbsp;children,&nbsp;building&nbsp;new&nbsp;Regexp&nbsp;if&nbsp;children&nbsp;change.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808408">nre</span>&nbsp;<span class="op" id="4808412">:=</span>&nbsp;<span class="ident" id="4808415"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808420">for</span>&nbsp;<span class="ident" id="4808424">i</span><span class="op" id="4808425">,</span>&nbsp;<span class="ident" id="4808427">sub</span>&nbsp;<span class="op" id="4808431">:=</span>&nbsp;<span class="keyword" id="4808434">range</span>&nbsp;<span class="ident" id="4808440"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808442">.</span><span class="ident" id="4808443">Sub</span>&nbsp;<span class="op" id="4808447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808452">nsub</span>&nbsp;<span class="op" id="4808457">:=</span>&nbsp;<span class="ident" id="4808460"><a href="/regexp/syntax/simplify.go.html#4808427">sub</a></span><span class="op" id="4808463">.</span><span class="ident" id="4808464">Simplify</span><span class="op" id="4808472">(</span><span class="op" id="4808473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808478">if</span>&nbsp;<span class="ident" id="4808481"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span>&nbsp;<span class="op" id="4808485">==</span>&nbsp;<span class="ident" id="4808488"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span>&nbsp;<span class="op" id="4808491">&amp;&amp;</span>&nbsp;<span class="ident" id="4808494"><a href="/regexp/syntax/simplify.go.html#4808452">nsub</a></span>&nbsp;<span class="op" id="4808499">!=</span>&nbsp;<span class="ident" id="4808502"><a href="/regexp/syntax/simplify.go.html#4808427">sub</a></span>&nbsp;<span class="op" id="4808506">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808512">//&nbsp;Start&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808533"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span>&nbsp;<span class="op" id="4808537">=</span>&nbsp;<span class="builtinfunc" id="4808539">new</span><span class="op" id="4808542">(</span><span class="ident" id="4808543"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4808549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808555">*</span><span class="ident" id="4808556"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span>&nbsp;<span class="op" id="4808560">=</span>&nbsp;<span class="op" id="4808562">*</span><span class="ident" id="4808563"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808570"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span><span class="op" id="4808573">.</span><span class="ident" id="4808574">Rune</span>&nbsp;<span class="op" id="4808579">=</span>&nbsp;<span class="ident" id="4808581">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808589"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span><span class="op" id="4808592">.</span><span class="ident" id="4808593">Sub</span>&nbsp;<span class="op" id="4808597">=</span>&nbsp;<span class="builtinfunc" id="4808599">append</span><span class="op" id="4808605">(</span><span class="ident" id="4808606"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span><span class="op" id="4808609">.</span><span class="ident" id="4808610">Sub0</span><span class="op" id="4808614">[</span><span class="op" id="4808615">:</span><span class="num" id="4808616">0</span><span class="op" id="4808617">]</span><span class="op" id="4808618">,</span>&nbsp;<span class="ident" id="4808620"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808622">.</span><span class="ident" id="4808623">Sub</span><span class="op" id="4808626">[</span><span class="op" id="4808627">:</span><span class="ident" id="4808628"><a href="/regexp/syntax/simplify.go.html#4808424">i</a></span><span class="op" id="4808629">]</span><span class="op" id="4808630">...</span><span class="op" id="4808633">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808643">if</span>&nbsp;<span class="ident" id="4808646"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span>&nbsp;<span class="op" id="4808650">!=</span>&nbsp;<span class="ident" id="4808653"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span>&nbsp;<span class="op" id="4808656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808662"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span><span class="op" id="4808665">.</span><span class="ident" id="4808666">Sub</span>&nbsp;<span class="op" id="4808670">=</span>&nbsp;<span class="builtinfunc" id="4808672">append</span><span class="op" id="4808678">(</span><span class="ident" id="4808679"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span><span class="op" id="4808682">.</span><span class="ident" id="4808683">Sub</span><span class="op" id="4808686">,</span>&nbsp;<span class="ident" id="4808688"><a href="/regexp/syntax/simplify.go.html#4808452">nsub</a></span><span class="op" id="4808692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4808701">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808705">return</span>&nbsp;<span class="ident" id="4808712"><a href="/regexp/syntax/simplify.go.html#4808408">nre</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808718">case</span>&nbsp;<span class="ident" id="4808723"><a href="/regexp/syntax/regexp.go.html#4801720">OpStar</a></span><span class="op" id="4808729">,</span>&nbsp;<span class="ident" id="4808731"><a href="/regexp/syntax/regexp.go.html#4801789">OpPlus</a></span><span class="op" id="4808737">,</span>&nbsp;<span class="ident" id="4808739"><a href="/regexp/syntax/regexp.go.html#4801857">OpQuest</a></span><span class="op" id="4808746">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4808750">sub</span>&nbsp;<span class="op" id="4808754">:=</span>&nbsp;<span class="ident" id="4808757"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808759">.</span><span class="ident" id="4808760">Sub</span><span class="op" id="4808763">[</span><span class="num" id="4808764">0</span><span class="op" id="4808765">]</span><span class="op" id="4808766">.</span><span class="ident" id="4808767">Simplify</span><span class="op" id="4808775">(</span><span class="op" id="4808776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808780">return</span>&nbsp;<span class="ident" id="4808787"><a href="/regexp/syntax/simplify.go.html#4811302">simplify1</a></span><span class="op" id="4808796">(</span><span class="ident" id="4808797"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808799">.</span><span class="ident" id="4808800">Op</span><span class="op" id="4808802">,</span>&nbsp;<span class="ident" id="4808804"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808806">.</span><span class="ident" id="4808807">Flags</span><span class="op" id="4808812">,</span>&nbsp;<span class="ident" id="4808814"><a href="/regexp/syntax/simplify.go.html#4808750">sub</a></span><span class="op" id="4808817">,</span>&nbsp;<span class="ident" id="4808819"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808821">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808825">case</span>&nbsp;<span class="ident" id="4808830"><a href="/regexp/syntax/regexp.go.html#4801925">OpRepeat</a></span><span class="op" id="4808838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808842">//&nbsp;Special&nbsp;special&nbsp;case:&nbsp;x{0}&nbsp;matches&nbsp;the&nbsp;empty&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4808899">//&nbsp;and&nbsp;doesn&#39;t&nbsp;even&nbsp;need&nbsp;to&nbsp;consider&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808941">if</span>&nbsp;<span class="ident" id="4808944"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808946">.</span><span class="ident" id="4808947">Min</span>&nbsp;<span class="op" id="4808951">==</span>&nbsp;<span class="num" id="4808954">0</span>&nbsp;<span class="op" id="4808956">&amp;&amp;</span>&nbsp;<span class="ident" id="4808959"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4808961">.</span><span class="ident" id="4808962">Max</span>&nbsp;<span class="op" id="4808966">==</span>&nbsp;<span class="num" id="4808969">0</span>&nbsp;<span class="op" id="4808971">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4808976">return</span>&nbsp;<span class="op" id="4808983">&amp;</span><span class="ident" id="4808984"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4808990">{</span><span class="ident" id="4808991">Op</span><span class="op" id="4808993">:</span>&nbsp;<span class="ident" id="4808995"><a href="/regexp/syntax/regexp.go.html#4800879">OpEmptyMatch</a></span><span class="op" id="4809007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809016">//&nbsp;The&nbsp;fun&nbsp;begins.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809037">sub</span>&nbsp;<span class="op" id="4809041">:=</span>&nbsp;<span class="ident" id="4809044"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809046">.</span><span class="ident" id="4809047">Sub</span><span class="op" id="4809050">[</span><span class="num" id="4809051">0</span><span class="op" id="4809052">]</span><span class="op" id="4809053">.</span><span class="ident" id="4809054">Simplify</span><span class="op" id="4809062">(</span><span class="op" id="4809063">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809068">//&nbsp;x{n,}&nbsp;means&nbsp;at&nbsp;least&nbsp;n&nbsp;matches&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809110">if</span>&nbsp;<span class="ident" id="4809113"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809115">.</span><span class="ident" id="4809116">Max</span>&nbsp;<span class="op" id="4809120">==</span>&nbsp;<span class="op" id="4809123">-</span><span class="num" id="4809124">1</span>&nbsp;<span class="op" id="4809126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809131">//&nbsp;Special&nbsp;case:&nbsp;x{0,}&nbsp;is&nbsp;x*.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809164">if</span>&nbsp;<span class="ident" id="4809167"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809169">.</span><span class="ident" id="4809170">Min</span>&nbsp;<span class="op" id="4809174">==</span>&nbsp;<span class="num" id="4809177">0</span>&nbsp;<span class="op" id="4809179">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809185">return</span>&nbsp;<span class="ident" id="4809192"><a href="/regexp/syntax/simplify.go.html#4811302">simplify1</a></span><span class="op" id="4809201">(</span><span class="ident" id="4809202"><a href="/regexp/syntax/regexp.go.html#4801720">OpStar</a></span><span class="op" id="4809208">,</span>&nbsp;<span class="ident" id="4809210"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809212">.</span><span class="ident" id="4809213">Flags</span><span class="op" id="4809218">,</span>&nbsp;<span class="ident" id="4809220"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4809223">,</span>&nbsp;<span class="ident" id="4809225">nil</span><span class="op" id="4809228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809239">//&nbsp;Special&nbsp;case:&nbsp;x{1,}&nbsp;is&nbsp;x+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809272">if</span>&nbsp;<span class="ident" id="4809275"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809277">.</span><span class="ident" id="4809278">Min</span>&nbsp;<span class="op" id="4809282">==</span>&nbsp;<span class="num" id="4809285">1</span>&nbsp;<span class="op" id="4809287">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809293">return</span>&nbsp;<span class="ident" id="4809300"><a href="/regexp/syntax/simplify.go.html#4811302">simplify1</a></span><span class="op" id="4809309">(</span><span class="ident" id="4809310"><a href="/regexp/syntax/regexp.go.html#4801789">OpPlus</a></span><span class="op" id="4809316">,</span>&nbsp;<span class="ident" id="4809318"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809320">.</span><span class="ident" id="4809321">Flags</span><span class="op" id="4809326">,</span>&nbsp;<span class="ident" id="4809328"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4809331">,</span>&nbsp;<span class="ident" id="4809333">nil</span><span class="op" id="4809336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809347">//&nbsp;General&nbsp;case:&nbsp;x{4,}&nbsp;is&nbsp;xxxx+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809383">nre</span>&nbsp;<span class="op" id="4809387">:=</span>&nbsp;<span class="op" id="4809390">&amp;</span><span class="ident" id="4809391"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4809397">{</span><span class="ident" id="4809398">Op</span><span class="op" id="4809400">:</span>&nbsp;<span class="ident" id="4809402"><a href="/regexp/syntax/regexp.go.html#4802031">OpConcat</a></span><span class="op" id="4809410">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809415"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><span class="op" id="4809418">.</span><span class="ident" id="4809419">Sub</span>&nbsp;<span class="op" id="4809423">=</span>&nbsp;<span class="ident" id="4809425"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><span class="op" id="4809428">.</span><span class="ident" id="4809429">Sub0</span><span class="op" id="4809433">[</span><span class="op" id="4809434">:</span><span class="num" id="4809435">0</span><span class="op" id="4809436">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809441">for</span>&nbsp;<span class="ident" id="4809445">i</span>&nbsp;<span class="op" id="4809447">:=</span>&nbsp;<span class="num" id="4809450">0</span><span class="op" id="4809451">;</span>&nbsp;<span class="ident" id="4809453"><a href="/regexp/syntax/simplify.go.html#4809445">i</a></span>&nbsp;<span class="op" id="4809455">&lt;</span>&nbsp;<span class="ident" id="4809457"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809459">.</span><span class="ident" id="4809460">Min</span><span class="op" id="4809463">-</span><span class="num" id="4809464">1</span><span class="op" id="4809465">;</span>&nbsp;<span class="ident" id="4809467"><a href="/regexp/syntax/simplify.go.html#4809445">i</a></span><span class="op" id="4809468">++</span>&nbsp;<span class="op" id="4809471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809477"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><span class="op" id="4809480">.</span><span class="ident" id="4809481">Sub</span>&nbsp;<span class="op" id="4809485">=</span>&nbsp;<span class="builtinfunc" id="4809487">append</span><span class="op" id="4809493">(</span><span class="ident" id="4809494"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><span class="op" id="4809497">.</span><span class="ident" id="4809498">Sub</span><span class="op" id="4809501">,</span>&nbsp;<span class="ident" id="4809503"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4809506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809516"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><span class="op" id="4809519">.</span><span class="ident" id="4809520">Sub</span>&nbsp;<span class="op" id="4809524">=</span>&nbsp;<span class="builtinfunc" id="4809526">append</span><span class="op" id="4809532">(</span><span class="ident" id="4809533"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><span class="op" id="4809536">.</span><span class="ident" id="4809537">Sub</span><span class="op" id="4809540">,</span>&nbsp;<span class="ident" id="4809542"><a href="/regexp/syntax/simplify.go.html#4811302">simplify1</a></span><span class="op" id="4809551">(</span><span class="ident" id="4809552"><a href="/regexp/syntax/regexp.go.html#4801789">OpPlus</a></span><span class="op" id="4809558">,</span>&nbsp;<span class="ident" id="4809560"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809562">.</span><span class="ident" id="4809563">Flags</span><span class="op" id="4809568">,</span>&nbsp;<span class="ident" id="4809570"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4809573">,</span>&nbsp;<span class="ident" id="4809575">nil</span><span class="op" id="4809578">)</span><span class="op" id="4809579">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809584">return</span>&nbsp;<span class="ident" id="4809591"><a href="/regexp/syntax/simplify.go.html#4809383">nre</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809602">//&nbsp;Special&nbsp;case&nbsp;x{0}&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809641">//&nbsp;Special&nbsp;case:&nbsp;x{1}&nbsp;is&nbsp;just&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809676">if</span>&nbsp;<span class="ident" id="4809679"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809681">.</span><span class="ident" id="4809682">Min</span>&nbsp;<span class="op" id="4809686">==</span>&nbsp;<span class="num" id="4809689">1</span>&nbsp;<span class="op" id="4809691">&amp;&amp;</span>&nbsp;<span class="ident" id="4809694"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809696">.</span><span class="ident" id="4809697">Max</span>&nbsp;<span class="op" id="4809701">==</span>&nbsp;<span class="num" id="4809704">1</span>&nbsp;<span class="op" id="4809706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809711">return</span>&nbsp;<span class="ident" id="4809718"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4809724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809729">//&nbsp;General&nbsp;case:&nbsp;x{n,m}&nbsp;means&nbsp;n&nbsp;copies&nbsp;of&nbsp;x&nbsp;and&nbsp;m&nbsp;copies&nbsp;of&nbsp;x?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809794">//&nbsp;The&nbsp;machine&nbsp;will&nbsp;do&nbsp;less&nbsp;work&nbsp;if&nbsp;we&nbsp;nest&nbsp;the&nbsp;final&nbsp;m&nbsp;copies,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809860">//&nbsp;so&nbsp;that&nbsp;x{2,5}&nbsp;=&nbsp;xx(x(x(x)?)?)?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4809898">//&nbsp;Build&nbsp;leading&nbsp;prefix:&nbsp;xx.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809929">var</span>&nbsp;<span class="ident" id="4809933">prefix</span>&nbsp;<span class="op" id="4809940">*</span><span class="ident" id="4809941"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4809950">if</span>&nbsp;<span class="ident" id="4809953"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4809955">.</span><span class="ident" id="4809956">Min</span>&nbsp;<span class="op" id="4809960">&gt;</span>&nbsp;<span class="num" id="4809962">0</span>&nbsp;<span class="op" id="4809964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4809969"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span>&nbsp;<span class="op" id="4809976">=</span>&nbsp;<span class="op" id="4809978">&amp;</span><span class="ident" id="4809979"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4809985">{</span><span class="ident" id="4809986">Op</span><span class="op" id="4809988">:</span>&nbsp;<span class="ident" id="4809990"><a href="/regexp/syntax/regexp.go.html#4802031">OpConcat</a></span><span class="op" id="4809998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810003"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><span class="op" id="4810009">.</span><span class="ident" id="4810010">Sub</span>&nbsp;<span class="op" id="4810014">=</span>&nbsp;<span class="ident" id="4810016"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><span class="op" id="4810022">.</span><span class="ident" id="4810023">Sub0</span><span class="op" id="4810027">[</span><span class="op" id="4810028">:</span><span class="num" id="4810029">0</span><span class="op" id="4810030">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810035">for</span>&nbsp;<span class="ident" id="4810039">i</span>&nbsp;<span class="op" id="4810041">:=</span>&nbsp;<span class="num" id="4810044">0</span><span class="op" id="4810045">;</span>&nbsp;<span class="ident" id="4810047"><a href="/regexp/syntax/simplify.go.html#4810039">i</a></span>&nbsp;<span class="op" id="4810049">&lt;</span>&nbsp;<span class="ident" id="4810051"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810053">.</span><span class="ident" id="4810054">Min</span><span class="op" id="4810057">;</span>&nbsp;<span class="ident" id="4810059"><a href="/regexp/syntax/simplify.go.html#4810039">i</a></span><span class="op" id="4810060">++</span>&nbsp;<span class="op" id="4810063">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810069"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><span class="op" id="4810075">.</span><span class="ident" id="4810076">Sub</span>&nbsp;<span class="op" id="4810080">=</span>&nbsp;<span class="builtinfunc" id="4810082">append</span><span class="op" id="4810088">(</span><span class="ident" id="4810089"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><span class="op" id="4810095">.</span><span class="ident" id="4810096">Sub</span><span class="op" id="4810099">,</span>&nbsp;<span class="ident" id="4810101"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4810104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810118">//&nbsp;Build&nbsp;and&nbsp;attach&nbsp;suffix:&nbsp;(x(x(x)?)?)?</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810161">if</span>&nbsp;<span class="ident" id="4810164"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810166">.</span><span class="ident" id="4810167">Max</span>&nbsp;<span class="op" id="4810171">&gt;</span>&nbsp;<span class="ident" id="4810173"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810175">.</span><span class="ident" id="4810176">Min</span>&nbsp;<span class="op" id="4810180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810185">suffix</span>&nbsp;<span class="op" id="4810192">:=</span>&nbsp;<span class="ident" id="4810195"><a href="/regexp/syntax/simplify.go.html#4811302">simplify1</a></span><span class="op" id="4810204">(</span><span class="ident" id="4810205"><a href="/regexp/syntax/regexp.go.html#4801857">OpQuest</a></span><span class="op" id="4810212">,</span>&nbsp;<span class="ident" id="4810214"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810216">.</span><span class="ident" id="4810217">Flags</span><span class="op" id="4810222">,</span>&nbsp;<span class="ident" id="4810224"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4810227">,</span>&nbsp;<span class="ident" id="4810229">nil</span><span class="op" id="4810232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810237">for</span>&nbsp;<span class="ident" id="4810241">i</span>&nbsp;<span class="op" id="4810243">:=</span>&nbsp;<span class="ident" id="4810246"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810248">.</span><span class="ident" id="4810249">Min</span>&nbsp;<span class="op" id="4810253">+</span>&nbsp;<span class="num" id="4810255">1</span><span class="op" id="4810256">;</span>&nbsp;<span class="ident" id="4810258"><a href="/regexp/syntax/simplify.go.html#4810241">i</a></span>&nbsp;<span class="op" id="4810260">&lt;</span>&nbsp;<span class="ident" id="4810262"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810264">.</span><span class="ident" id="4810265">Max</span><span class="op" id="4810268">;</span>&nbsp;<span class="ident" id="4810270"><a href="/regexp/syntax/simplify.go.html#4810241">i</a></span><span class="op" id="4810271">++</span>&nbsp;<span class="op" id="4810274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810280">nre2</span>&nbsp;<span class="op" id="4810285">:=</span>&nbsp;<span class="op" id="4810288">&amp;</span><span class="ident" id="4810289"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4810295">{</span><span class="ident" id="4810296">Op</span><span class="op" id="4810298">:</span>&nbsp;<span class="ident" id="4810300"><a href="/regexp/syntax/regexp.go.html#4802031">OpConcat</a></span><span class="op" id="4810308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810314"><a href="/regexp/syntax/simplify.go.html#4810280">nre2</a></span><span class="op" id="4810318">.</span><span class="ident" id="4810319">Sub</span>&nbsp;<span class="op" id="4810323">=</span>&nbsp;<span class="builtinfunc" id="4810325">append</span><span class="op" id="4810331">(</span><span class="ident" id="4810332"><a href="/regexp/syntax/simplify.go.html#4810280">nre2</a></span><span class="op" id="4810336">.</span><span class="ident" id="4810337">Sub0</span><span class="op" id="4810341">[</span><span class="op" id="4810342">:</span><span class="num" id="4810343">0</span><span class="op" id="4810344">]</span><span class="op" id="4810345">,</span>&nbsp;<span class="ident" id="4810347"><a href="/regexp/syntax/simplify.go.html#4809037">sub</a></span><span class="op" id="4810350">,</span>&nbsp;<span class="ident" id="4810352"><a href="/regexp/syntax/simplify.go.html#4810185">suffix</a></span><span class="op" id="4810358">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810364"><a href="/regexp/syntax/simplify.go.html#4810185">suffix</a></span>&nbsp;<span class="op" id="4810371">=</span>&nbsp;<span class="ident" id="4810373"><a href="/regexp/syntax/simplify.go.html#4811302">simplify1</a></span><span class="op" id="4810382">(</span><span class="ident" id="4810383"><a href="/regexp/syntax/regexp.go.html#4801857">OpQuest</a></span><span class="op" id="4810390">,</span>&nbsp;<span class="ident" id="4810392"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><span class="op" id="4810394">.</span><span class="ident" id="4810395">Flags</span><span class="op" id="4810400">,</span>&nbsp;<span class="ident" id="4810402"><a href="/regexp/syntax/simplify.go.html#4810280">nre2</a></span><span class="op" id="4810406">,</span>&nbsp;<span class="ident" id="4810408">nil</span><span class="op" id="4810411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810421">if</span>&nbsp;<span class="ident" id="4810424"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span>&nbsp;<span class="op" id="4810431">==</span>&nbsp;<span class="ident" id="4810434">nil</span>&nbsp;<span class="op" id="4810438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810444">return</span>&nbsp;<span class="ident" id="4810451"><a href="/regexp/syntax/simplify.go.html#4810185">suffix</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810461">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4810466"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><span class="op" id="4810472">.</span><span class="ident" id="4810473">Sub</span>&nbsp;<span class="op" id="4810477">=</span>&nbsp;<span class="builtinfunc" id="4810479">append</span><span class="op" id="4810485">(</span><span class="ident" id="4810486"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><span class="op" id="4810492">.</span><span class="ident" id="4810493">Sub</span><span class="op" id="4810496">,</span>&nbsp;<span class="ident" id="4810498"><a href="/regexp/syntax/simplify.go.html#4810185">suffix</a></span><span class="op" id="4810504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810512">if</span>&nbsp;<span class="ident" id="4810515"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span>&nbsp;<span class="op" id="4810522">!=</span>&nbsp;<span class="ident" id="4810525">nil</span>&nbsp;<span class="op" id="4810529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810534">return</span>&nbsp;<span class="ident" id="4810541"><a href="/regexp/syntax/simplify.go.html#4809933">prefix</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810550">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810555">//&nbsp;Some&nbsp;degenerate&nbsp;case&nbsp;like&nbsp;min&nbsp;&gt;&nbsp;max&nbsp;or&nbsp;min&nbsp;&lt;&nbsp;max&nbsp;&lt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4810614">//&nbsp;Handle&nbsp;as&nbsp;impossible&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810647">return</span>&nbsp;<span class="op" id="4810654">&amp;</span><span class="ident" id="4810655"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4810661">{</span><span class="ident" id="4810662">Op</span><span class="op" id="4810664">:</span>&nbsp;<span class="ident" id="4810666"><a href="/regexp/syntax/regexp.go.html#4800825">OpNoMatch</a></span><span class="op" id="4810675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4810678">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4810682">return</span>&nbsp;<span class="ident" id="4810689"><a href="/regexp/syntax/simplify.go.html#4808221">re</a></span><br>
<span class="lineno"></span><span class="op" id="4810692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4810695">//&nbsp;simplify1&nbsp;implements&nbsp;Simplify&nbsp;for&nbsp;the&nbsp;unary&nbsp;OpStar,</span><br>
<span class="lineno">120</span><span class="comment" id="4810750">//&nbsp;OpPlus,&nbsp;and&nbsp;OpQuest&nbsp;operators.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;simple&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4810814">//&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4810831">//</span><br>
<span class="lineno"></span><span class="comment" id="4810834">//&nbsp;&nbsp;&nbsp;&nbspRegexp{Op:&nbsp;op,&nbsp;Flags:&nbsp;flags,&nbsp;Sub:&nbsp;{sub}}</span><br>
<span class="lineno"></span><span class="comment" id="4810878">//</span><br>
<span class="lineno">125</span><span class="comment" id="4810881">//&nbsp;under&nbsp;the&nbsp;assumption&nbsp;that&nbsp;sub&nbsp;is&nbsp;already&nbsp;simple,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4810937">//&nbsp;without&nbsp;first&nbsp;allocating&nbsp;that&nbsp;structure.&nbsp;&nbsp;If&nbsp;the&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4810996">//&nbsp;to&nbsp;be&nbsp;returned&nbsp;turns&nbsp;out&nbsp;to&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;re,&nbsp;simplify1</span><br>
<span class="lineno"></span><span class="comment" id="4811058">//&nbsp;returns&nbsp;re&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4811081">//</span><br>
<span class="lineno">130</span><span class="comment" id="4811084">//&nbsp;simplify1&nbsp;is&nbsp;factored&nbsp;out&nbsp;of&nbsp;Simplify&nbsp;because&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="4811152">//&nbsp;for&nbsp;other&nbsp;operators&nbsp;generates&nbsp;these&nbsp;unary&nbsp;expressions.</span><br>
<span class="lineno"></span><span class="comment" id="4811210">//&nbsp;Letting&nbsp;them&nbsp;call&nbsp;simplify1&nbsp;makes&nbsp;sure&nbsp;the&nbsp;expressions&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4811273">//&nbsp;generate&nbsp;are&nbsp;simple.</span><br>
<span class="lineno"></span><span class="keyword" id="4811297">func</span>&nbsp;<span class="ident" id="4811302">simplify1</span><span class="op" id="4811311">(</span><span class="ident" id="4811312">op</span>&nbsp;<span class="ident" id="4811315"><a href="/regexp/syntax/regexp.go.html#4800610">Op</a></span><span class="op" id="4811317">,</span>&nbsp;<span class="ident" id="4811319">flags</span>&nbsp;<span class="ident" id="4811325"><a href="/regexp/syntax/parse.go.html#4744412">Flags</a></span><span class="op" id="4811330">,</span>&nbsp;<span class="ident" id="4811332">sub</span><span class="op" id="4811335">,</span>&nbsp;<span class="ident" id="4811337">re</span>&nbsp;<span class="op" id="4811340">*</span><span class="ident" id="4811341"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4811347">)</span>&nbsp;<span class="op" id="4811349">*</span><span class="ident" id="4811350"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span>&nbsp;<span class="op" id="4811357">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811360">//&nbsp;Special&nbsp;case:&nbsp;repeat&nbsp;the&nbsp;empty&nbsp;string&nbsp;as&nbsp;much&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811413">//&nbsp;you&nbsp;want,&nbsp;but&nbsp;it&#39;s&nbsp;still&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811460">if</span>&nbsp;<span class="ident" id="4811463"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span><span class="op" id="4811466">.</span><span class="ident" id="4811467">Op</span>&nbsp;<span class="op" id="4811470">==</span>&nbsp;<span class="ident" id="4811473"><a href="/regexp/syntax/regexp.go.html#4800879">OpEmptyMatch</a></span>&nbsp;<span class="op" id="4811486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811490">return</span>&nbsp;<span class="ident" id="4811497"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811502">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4811505">//&nbsp;The&nbsp;operators&nbsp;are&nbsp;idempotent&nbsp;if&nbsp;the&nbsp;flags&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811558">if</span>&nbsp;<span class="ident" id="4811561"><a href="/regexp/syntax/simplify.go.html#4811312">op</a></span>&nbsp;<span class="op" id="4811564">==</span>&nbsp;<span class="ident" id="4811567"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span><span class="op" id="4811570">.</span><span class="ident" id="4811571">Op</span>&nbsp;<span class="op" id="4811574">&amp;&amp;</span>&nbsp;<span class="ident" id="4811577"><a href="/regexp/syntax/simplify.go.html#4811319">flags</a></span><span class="op" id="4811582">&amp;</span><span class="ident" id="4811583"><a href="/regexp/syntax/parse.go.html#4744824">NonGreedy</a></span>&nbsp;<span class="op" id="4811593">==</span>&nbsp;<span class="ident" id="4811596"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span><span class="op" id="4811599">.</span><span class="ident" id="4811600">Flags</span><span class="op" id="4811605">&amp;</span><span class="ident" id="4811606"><a href="/regexp/syntax/parse.go.html#4744824">NonGreedy</a></span>&nbsp;<span class="op" id="4811616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811620">return</span>&nbsp;<span class="ident" id="4811627"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811635">if</span>&nbsp;<span class="ident" id="4811638"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span>&nbsp;<span class="op" id="4811641">!=</span>&nbsp;<span class="ident" id="4811644">nil</span>&nbsp;<span class="op" id="4811648">&amp;&amp;</span>&nbsp;<span class="ident" id="4811651"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><span class="op" id="4811653">.</span><span class="ident" id="4811654">Op</span>&nbsp;<span class="op" id="4811657">==</span>&nbsp;<span class="ident" id="4811660"><a href="/regexp/syntax/simplify.go.html#4811312">op</a></span>&nbsp;<span class="op" id="4811663">&amp;&amp;</span>&nbsp;<span class="ident" id="4811666"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><span class="op" id="4811668">.</span><span class="ident" id="4811669">Flags</span><span class="op" id="4811674">&amp;</span><span class="ident" id="4811675"><a href="/regexp/syntax/parse.go.html#4744824">NonGreedy</a></span>&nbsp;<span class="op" id="4811685">==</span>&nbsp;<span class="ident" id="4811688"><a href="/regexp/syntax/simplify.go.html#4811319">flags</a></span><span class="op" id="4811693">&amp;</span><span class="ident" id="4811694"><a href="/regexp/syntax/parse.go.html#4744824">NonGreedy</a></span>&nbsp;<span class="op" id="4811704">&amp;&amp;</span>&nbsp;<span class="ident" id="4811707"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span>&nbsp;<span class="op" id="4811711">==</span>&nbsp;<span class="ident" id="4811714"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><span class="op" id="4811716">.</span><span class="ident" id="4811717">Sub</span><span class="op" id="4811720">[</span><span class="num" id="4811721">0</span><span class="op" id="4811722">]</span>&nbsp;<span class="op" id="4811724">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811728">return</span>&nbsp;<span class="ident" id="4811735"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4811739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811743"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span>&nbsp;<span class="op" id="4811746">=</span>&nbsp;<span class="op" id="4811748">&amp;</span><span class="ident" id="4811749"><a href="/regexp/syntax/regexp.go.html#4800134">Regexp</a></span><span class="op" id="4811755">{</span><span class="ident" id="4811756">Op</span><span class="op" id="4811758">:</span>&nbsp;<span class="ident" id="4811760"><a href="/regexp/syntax/simplify.go.html#4811312">op</a></span><span class="op" id="4811762">,</span>&nbsp;<span class="ident" id="4811764">Flags</span><span class="op" id="4811769">:</span>&nbsp;<span class="ident" id="4811771"><a href="/regexp/syntax/simplify.go.html#4811319">flags</a></span><span class="op" id="4811776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4811779"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><span class="op" id="4811781">.</span><span class="ident" id="4811782">Sub</span>&nbsp;<span class="op" id="4811786">=</span>&nbsp;<span class="builtinfunc" id="4811788">append</span><span class="op" id="4811794">(</span><span class="ident" id="4811795"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><span class="op" id="4811797">.</span><span class="ident" id="4811798">Sub0</span><span class="op" id="4811802">[</span><span class="op" id="4811803">:</span><span class="num" id="4811804">0</span><span class="op" id="4811805">]</span><span class="op" id="4811806">,</span>&nbsp;<span class="ident" id="4811808"><a href="/regexp/syntax/simplify.go.html#4811332">sub</a></span><span class="op" id="4811811">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4811814">return</span>&nbsp;<span class="ident" id="4811821"><a href="/regexp/syntax/simplify.go.html#4811337">re</a></span><br>
<span class="lineno"></span><span class="op" id="4811824">}</span>
</div>
</body>
</html>
