<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6822842">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6822898">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6822952">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6823003">//&nbsp;Bridge&nbsp;package&nbsp;to&nbsp;expose&nbsp;http&nbsp;internals&nbsp;to&nbsp;tests&nbsp;in&nbsp;the&nbsp;http_test</span><br>
<span class="lineno"></span><span class="comment" id="6823072">//&nbsp;package.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823085">package</span>&nbsp;<span class="ident" id="6823093">http</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6823099">import</span>&nbsp;<span class="op" id="6823106">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6823109">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6823116">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6823127">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6823134">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6823137">func</span>&nbsp;<span class="ident" id="6823142">NewLoggingConn</span><span class="op" id="6823156">(</span><span class="ident" id="6823157">baseName</span>&nbsp;<span class="builtintype" id="6823166">string</span><span class="op" id="6823172">,</span>&nbsp;<span class="ident" id="6823174">c</span>&nbsp;<span class="ident" id="6823176">net</span><span class="op" id="6823179">.</span><span class="ident" id="6823180">Conn</span><span class="op" id="6823184">)</span>&nbsp;<span class="ident" id="6823186">net</span><span class="op" id="6823189">.</span><span class="ident" id="6823190">Conn</span>&nbsp;<span class="op" id="6823195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823198">return</span>&nbsp;<span class="ident" id="6823205">newLoggingConn</span><span class="op" id="6823219">(</span><span class="ident" id="6823220">baseName</span><span class="op" id="6823228">,</span>&nbsp;<span class="ident" id="6823230">c</span><span class="op" id="6823231">)</span><br>
<span class="lineno"></span><span class="op" id="6823233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6823236">var</span>&nbsp;<span class="ident" id="6823240">ExportAppendTime</span>&nbsp;<span class="op" id="6823257">=</span>&nbsp;<span class="ident" id="6823259">appendTime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823271">func</span>&nbsp;<span class="op" id="6823276">(</span><span class="ident" id="6823277">t</span>&nbsp;<span class="op" id="6823279">*</span><span class="ident" id="6823280">Transport</span><span class="op" id="6823289">)</span>&nbsp;<span class="ident" id="6823291">NumPendingRequestsForTesting</span><span class="op" id="6823319">(</span><span class="op" id="6823320">)</span>&nbsp;<span class="builtintype" id="6823322">int</span>&nbsp;<span class="op" id="6823326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823329">t</span><span class="op" id="6823330">.</span><span class="ident" id="6823331">reqMu</span><span class="op" id="6823336">.</span><span class="ident" id="6823337">Lock</span><span class="op" id="6823341">(</span><span class="op" id="6823342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823345">defer</span>&nbsp;<span class="ident" id="6823351">t</span><span class="op" id="6823352">.</span><span class="ident" id="6823353">reqMu</span><span class="op" id="6823358">.</span><span class="ident" id="6823359">Unlock</span><span class="op" id="6823365">(</span><span class="op" id="6823366">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823369">return</span>&nbsp;<span class="builtinfunc" id="6823376">len</span><span class="op" id="6823379">(</span><span class="ident" id="6823380">t</span><span class="op" id="6823381">.</span><span class="ident" id="6823382">reqCanceler</span><span class="op" id="6823393">)</span><br>
<span class="lineno"></span><span class="op" id="6823395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6823398">func</span>&nbsp;<span class="op" id="6823403">(</span><span class="ident" id="6823404">t</span>&nbsp;<span class="op" id="6823406">*</span><span class="ident" id="6823407">Transport</span><span class="op" id="6823416">)</span>&nbsp;<span class="ident" id="6823418">IdleConnKeysForTesting</span><span class="op" id="6823440">(</span><span class="op" id="6823441">)</span>&nbsp;<span class="op" id="6823443">(</span><span class="ident" id="6823444">keys</span>&nbsp;<span class="op" id="6823449">[</span><span class="op" id="6823450">]</span><span class="builtintype" id="6823451">string</span><span class="op" id="6823457">)</span>&nbsp;<span class="op" id="6823459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823462">keys</span>&nbsp;<span class="op" id="6823467">=</span>&nbsp;<span class="builtinfunc" id="6823469">make</span><span class="op" id="6823473">(</span><span class="op" id="6823474">[</span><span class="op" id="6823475">]</span><span class="builtintype" id="6823476">string</span><span class="op" id="6823482">,</span>&nbsp;<span class="num" id="6823484">0</span><span class="op" id="6823485">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823488">t</span><span class="op" id="6823489">.</span><span class="ident" id="6823490">idleMu</span><span class="op" id="6823496">.</span><span class="ident" id="6823497">Lock</span><span class="op" id="6823501">(</span><span class="op" id="6823502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823505">defer</span>&nbsp;<span class="ident" id="6823511">t</span><span class="op" id="6823512">.</span><span class="ident" id="6823513">idleMu</span><span class="op" id="6823519">.</span><span class="ident" id="6823520">Unlock</span><span class="op" id="6823526">(</span><span class="op" id="6823527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823530">if</span>&nbsp;<span class="ident" id="6823533">t</span><span class="op" id="6823534">.</span><span class="ident" id="6823535">idleConn</span>&nbsp;<span class="op" id="6823544">==</span>&nbsp;<span class="ident" id="6823547">nil</span>&nbsp;<span class="op" id="6823551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823555">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823563">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823566">for</span>&nbsp;<span class="ident" id="6823570">key</span>&nbsp;<span class="op" id="6823574">:=</span>&nbsp;<span class="keyword" id="6823577">range</span>&nbsp;<span class="ident" id="6823583">t</span><span class="op" id="6823584">.</span><span class="ident" id="6823585">idleConn</span>&nbsp;<span class="op" id="6823594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823598">keys</span>&nbsp;<span class="op" id="6823603">=</span>&nbsp;<span class="builtinfunc" id="6823605">append</span><span class="op" id="6823611">(</span><span class="ident" id="6823612">keys</span><span class="op" id="6823616">,</span>&nbsp;<span class="ident" id="6823618">key</span><span class="op" id="6823621">.</span><span class="ident" id="6823622">String</span><span class="op" id="6823628">(</span><span class="op" id="6823629">)</span><span class="op" id="6823630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823636">return</span><br>
<span class="lineno"></span><span class="op" id="6823643">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6823646">func</span>&nbsp;<span class="op" id="6823651">(</span><span class="ident" id="6823652">t</span>&nbsp;<span class="op" id="6823654">*</span><span class="ident" id="6823655">Transport</span><span class="op" id="6823664">)</span>&nbsp;<span class="ident" id="6823666">IdleConnCountForTesting</span><span class="op" id="6823689">(</span><span class="ident" id="6823690">cacheKey</span>&nbsp;<span class="builtintype" id="6823699">string</span><span class="op" id="6823705">)</span>&nbsp;<span class="builtintype" id="6823707">int</span>&nbsp;<span class="op" id="6823711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823714">t</span><span class="op" id="6823715">.</span><span class="ident" id="6823716">idleMu</span><span class="op" id="6823722">.</span><span class="ident" id="6823723">Lock</span><span class="op" id="6823727">(</span><span class="op" id="6823728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823731">defer</span>&nbsp;<span class="ident" id="6823737">t</span><span class="op" id="6823738">.</span><span class="ident" id="6823739">idleMu</span><span class="op" id="6823745">.</span><span class="ident" id="6823746">Unlock</span><span class="op" id="6823752">(</span><span class="op" id="6823753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823756">if</span>&nbsp;<span class="ident" id="6823759">t</span><span class="op" id="6823760">.</span><span class="ident" id="6823761">idleConn</span>&nbsp;<span class="op" id="6823770">==</span>&nbsp;<span class="ident" id="6823773">nil</span>&nbsp;<span class="op" id="6823777">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823781">return</span>&nbsp;<span class="num" id="6823788">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823794">for</span>&nbsp;<span class="ident" id="6823798">k</span><span class="op" id="6823799">,</span>&nbsp;<span class="ident" id="6823801">conns</span>&nbsp;<span class="op" id="6823807">:=</span>&nbsp;<span class="keyword" id="6823810">range</span>&nbsp;<span class="ident" id="6823816">t</span><span class="op" id="6823817">.</span><span class="ident" id="6823818">idleConn</span>&nbsp;<span class="op" id="6823827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823831">if</span>&nbsp;<span class="ident" id="6823834">k</span><span class="op" id="6823835">.</span><span class="ident" id="6823836">String</span><span class="op" id="6823842">(</span><span class="op" id="6823843">)</span>&nbsp;<span class="op" id="6823845">==</span>&nbsp;<span class="ident" id="6823848">cacheKey</span>&nbsp;<span class="op" id="6823857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823862">return</span>&nbsp;<span class="builtinfunc" id="6823869">len</span><span class="op" id="6823872">(</span><span class="ident" id="6823873">conns</span><span class="op" id="6823878">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6823885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823888">return</span>&nbsp;<span class="num" id="6823895">0</span><br>
<span class="lineno"></span><span class="op" id="6823897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6823900">func</span>&nbsp;<span class="op" id="6823905">(</span><span class="ident" id="6823906">t</span>&nbsp;<span class="op" id="6823908">*</span><span class="ident" id="6823909">Transport</span><span class="op" id="6823918">)</span>&nbsp;<span class="ident" id="6823920">IdleConnChMapSizeForTesting</span><span class="op" id="6823947">(</span><span class="op" id="6823948">)</span>&nbsp;<span class="builtintype" id="6823950">int</span>&nbsp;<span class="op" id="6823954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6823957">t</span><span class="op" id="6823958">.</span><span class="ident" id="6823959">idleMu</span><span class="op" id="6823965">.</span><span class="ident" id="6823966">Lock</span><span class="op" id="6823970">(</span><span class="op" id="6823971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823974">defer</span>&nbsp;<span class="ident" id="6823980">t</span><span class="op" id="6823981">.</span><span class="ident" id="6823982">idleMu</span><span class="op" id="6823988">.</span><span class="ident" id="6823989">Unlock</span><span class="op" id="6823995">(</span><span class="op" id="6823996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6823999">return</span>&nbsp;<span class="builtinfunc" id="6824006">len</span><span class="op" id="6824009">(</span><span class="ident" id="6824010">t</span><span class="op" id="6824011">.</span><span class="ident" id="6824012">idleConnCh</span><span class="op" id="6824022">)</span><br>
<span class="lineno"></span><span class="op" id="6824024">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6824027">func</span>&nbsp;<span class="op" id="6824032">(</span><span class="ident" id="6824033">t</span>&nbsp;<span class="op" id="6824035">*</span><span class="ident" id="6824036">Transport</span><span class="op" id="6824045">)</span>&nbsp;<span class="ident" id="6824047">IsIdleForTesting</span><span class="op" id="6824063">(</span><span class="op" id="6824064">)</span>&nbsp;<span class="builtintype" id="6824066">bool</span>&nbsp;<span class="op" id="6824071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824074">t</span><span class="op" id="6824075">.</span><span class="ident" id="6824076">idleMu</span><span class="op" id="6824082">.</span><span class="ident" id="6824083">Lock</span><span class="op" id="6824087">(</span><span class="op" id="6824088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824091">defer</span>&nbsp;<span class="ident" id="6824097">t</span><span class="op" id="6824098">.</span><span class="ident" id="6824099">idleMu</span><span class="op" id="6824105">.</span><span class="ident" id="6824106">Unlock</span><span class="op" id="6824112">(</span><span class="op" id="6824113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824116">return</span>&nbsp;<span class="ident" id="6824123">t</span><span class="op" id="6824124">.</span><span class="ident" id="6824125">wantIdle</span><br>
<span class="lineno">65</span><span class="op" id="6824134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824137">func</span>&nbsp;<span class="op" id="6824142">(</span><span class="ident" id="6824143">t</span>&nbsp;<span class="op" id="6824145">*</span><span class="ident" id="6824146">Transport</span><span class="op" id="6824155">)</span>&nbsp;<span class="ident" id="6824157">RequestIdleConnChForTesting</span><span class="op" id="6824184">(</span><span class="op" id="6824185">)</span>&nbsp;<span class="op" id="6824187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824190">t</span><span class="op" id="6824191">.</span><span class="ident" id="6824192">getIdleConnCh</span><span class="op" id="6824205">(</span><span class="ident" id="6824206">connectMethod</span><span class="op" id="6824219">{</span><span class="ident" id="6824220">nil</span><span class="op" id="6824223">,</span>&nbsp;<span class="string" id="6824225">&#34;http&#34;</span><span class="op" id="6824231">,</span>&nbsp;<span class="string" id="6824233">&#34;example.com&#34;</span><span class="op" id="6824246">}</span><span class="op" id="6824247">)</span><br>
<span class="lineno"></span><span class="op" id="6824249">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="6824252">func</span>&nbsp;<span class="op" id="6824257">(</span><span class="ident" id="6824258">t</span>&nbsp;<span class="op" id="6824260">*</span><span class="ident" id="6824261">Transport</span><span class="op" id="6824270">)</span>&nbsp;<span class="ident" id="6824272">PutIdleTestConn</span><span class="op" id="6824287">(</span><span class="op" id="6824288">)</span>&nbsp;<span class="builtintype" id="6824290">bool</span>&nbsp;<span class="op" id="6824295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824298">c</span><span class="op" id="6824299">,</span>&nbsp;<span class="ident" id="6824301">_</span>&nbsp;<span class="op" id="6824303">:=</span>&nbsp;<span class="ident" id="6824306">net</span><span class="op" id="6824309">.</span><span class="ident" id="6824310">Pipe</span><span class="op" id="6824314">(</span><span class="op" id="6824315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824318">return</span>&nbsp;<span class="ident" id="6824325">t</span><span class="op" id="6824326">.</span><span class="ident" id="6824327">putIdleConn</span><span class="op" id="6824338">(</span><span class="op" id="6824339">&amp;</span><span class="ident" id="6824340">persistConn</span><span class="op" id="6824351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824355">t</span><span class="op" id="6824356">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824365">t</span><span class="op" id="6824366">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824370">conn</span><span class="op" id="6824374">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6824380">c</span><span class="op" id="6824381">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6824401">//&nbsp;dummy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824412">closech</span><span class="op" id="6824419">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="6824422">make</span><span class="op" id="6824426">(</span><span class="keyword" id="6824427">chan</span>&nbsp;<span class="keyword" id="6824432">struct</span><span class="op" id="6824438">{</span><span class="op" id="6824439">}</span><span class="op" id="6824440">)</span><span class="op" id="6824441">,</span>&nbsp;<span class="comment" id="6824443">//&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824468">cacheKey</span><span class="op" id="6824476">:</span>&nbsp;<span class="ident" id="6824478">connectMethodKey</span><span class="op" id="6824494">{</span><span class="string" id="6824495">&#34;&#34;</span><span class="op" id="6824497">,</span>&nbsp;<span class="string" id="6824499">&#34;http&#34;</span><span class="op" id="6824505">,</span>&nbsp;<span class="string" id="6824507">&#34;example.com&#34;</span><span class="op" id="6824520">}</span><span class="op" id="6824521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824524">}</span><span class="op" id="6824525">)</span><br>
<span class="lineno"></span><span class="op" id="6824527">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="6824530">func</span>&nbsp;<span class="ident" id="6824535">NewTestTimeoutHandler</span><span class="op" id="6824556">(</span><span class="ident" id="6824557">handler</span>&nbsp;<span class="ident" id="6824565">Handler</span><span class="op" id="6824572">,</span>&nbsp;<span class="ident" id="6824574">ch</span>&nbsp;<span class="op" id="6824577">&lt;-</span><span class="keyword" id="6824579">chan</span>&nbsp;<span class="ident" id="6824584">time</span><span class="op" id="6824588">.</span><span class="ident" id="6824589">Time</span><span class="op" id="6824593">)</span>&nbsp;<span class="ident" id="6824595">Handler</span>&nbsp;<span class="op" id="6824603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824606">f</span>&nbsp;<span class="op" id="6824608">:=</span>&nbsp;<span class="keyword" id="6824611">func</span><span class="op" id="6824615">(</span><span class="op" id="6824616">)</span>&nbsp;<span class="op" id="6824618">&lt;-</span><span class="keyword" id="6824620">chan</span>&nbsp;<span class="ident" id="6824625">time</span><span class="op" id="6824629">.</span><span class="ident" id="6824630">Time</span>&nbsp;<span class="op" id="6824635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824639">return</span>&nbsp;<span class="ident" id="6824646">ch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6824650">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824653">return</span>&nbsp;<span class="op" id="6824660">&amp;</span><span class="ident" id="6824661">timeoutHandler</span><span class="op" id="6824675">{</span><span class="ident" id="6824676">handler</span><span class="op" id="6824683">,</span>&nbsp;<span class="ident" id="6824685">f</span><span class="op" id="6824686">,</span>&nbsp;<span class="string" id="6824688">&#34;&#34;</span><span class="op" id="6824690">}</span><br>
<span class="lineno"></span><span class="op" id="6824692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824695">func</span>&nbsp;<span class="ident" id="6824700">ResetCachedEnvironment</span><span class="op" id="6824722">(</span><span class="op" id="6824723">)</span>&nbsp;<span class="op" id="6824725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824728">httpProxyEnv</span><span class="op" id="6824740">.</span><span class="ident" id="6824741">reset</span><span class="op" id="6824746">(</span><span class="op" id="6824747">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824750">httpsProxyEnv</span><span class="op" id="6824763">.</span><span class="ident" id="6824764">reset</span><span class="op" id="6824769">(</span><span class="op" id="6824770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6824773">noProxyEnv</span><span class="op" id="6824783">.</span><span class="ident" id="6824784">reset</span><span class="op" id="6824789">(</span><span class="op" id="6824790">)</span><br>
<span class="lineno"></span><span class="op" id="6824792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6824795">var</span>&nbsp;<span class="ident" id="6824799">DefaultUserAgent</span>&nbsp;<span class="op" id="6824816">=</span>&nbsp;<span class="ident" id="6824818">defaultUserAgent</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="6824836">func</span>&nbsp;<span class="ident" id="6824841">ExportRefererForURL</span><span class="op" id="6824860">(</span><span class="ident" id="6824861">lastReq</span><span class="op" id="6824868">,</span>&nbsp;<span class="ident" id="6824870">newReq</span>&nbsp;<span class="op" id="6824877">*</span><span class="ident" id="6824878">url</span><span class="op" id="6824881">.</span><span class="ident" id="6824882">URL</span><span class="op" id="6824885">)</span>&nbsp;<span class="builtintype" id="6824887">string</span>&nbsp;<span class="op" id="6824894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6824897">return</span>&nbsp;<span class="ident" id="6824904">refererForURL</span><span class="op" id="6824917">(</span><span class="ident" id="6824918">lastReq</span><span class="op" id="6824925">,</span>&nbsp;<span class="ident" id="6824927">newReq</span><span class="op" id="6824933">)</span><br>
<span class="lineno"></span><span class="op" id="6824935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="6824938">//&nbsp;SetPendingDialHooks&nbsp;sets&nbsp;the&nbsp;hooks&nbsp;that&nbsp;run&nbsp;before&nbsp;and&nbsp;after&nbsp;handling</span><br>
<span class="lineno"></span><span class="comment" id="6825011">//&nbsp;pending&nbsp;dials.</span><br>
<span class="lineno"></span><span class="keyword" id="6825029">func</span>&nbsp;<span class="ident" id="6825034">SetPendingDialHooks</span><span class="op" id="6825053">(</span><span class="ident" id="6825054">before</span><span class="op" id="6825060">,</span>&nbsp;<span class="ident" id="6825062">after</span>&nbsp;<span class="keyword" id="6825068">func</span><span class="op" id="6825072">(</span><span class="op" id="6825073">)</span><span class="op" id="6825074">)</span>&nbsp;<span class="op" id="6825076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6825079">prePendingDial</span><span class="op" id="6825093">,</span>&nbsp;<span class="ident" id="6825095">postPendingDial</span>&nbsp;<span class="op" id="6825111">=</span>&nbsp;<span class="ident" id="6825113">before</span><span class="op" id="6825119">,</span>&nbsp;<span class="ident" id="6825121">after</span><br>
<span class="lineno"></span><span class="op" id="6825127">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6825130">var</span>&nbsp;<span class="ident" id="6825134">ExportServerNewConn</span>&nbsp;<span class="op" id="6825154">=</span>&nbsp;<span class="op" id="6825156">(</span><span class="op" id="6825157">*</span><span class="ident" id="6825158">Server</span><span class="op" id="6825164">)</span><span class="op" id="6825165">.</span><span class="ident" id="6825166">newConn</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6825175">var</span>&nbsp;<span class="ident" id="6825179">ExportCloseWriteAndWait</span>&nbsp;<span class="op" id="6825203">=</span>&nbsp;<span class="op" id="6825205">(</span><span class="op" id="6825206">*</span><span class="ident" id="6825207">conn</span><span class="op" id="6825211">)</span><span class="op" id="6825212">.</span><span class="ident" id="6825213">closeWriteAndWait</span>
</div>
</body>
</html>
