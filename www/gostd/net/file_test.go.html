<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7863225">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7863280">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7863334">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7863385">package</span>&nbsp;<span class="ident" id="7863393">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863398">import</span>&nbsp;<span class="op" id="7863405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863408">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863414">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863425">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7863436">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7863446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863449">type</span>&nbsp;<span class="ident" id="7863454">listenerFile</span>&nbsp;<span class="keyword" id="7863467">interface</span>&nbsp;<span class="op" id="7863477">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863480">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863490">File</span><span class="op" id="7863494">(</span><span class="op" id="7863495">)</span>&nbsp;<span class="op" id="7863497">(</span><span class="ident" id="7863498">f</span>&nbsp;<span class="op" id="7863500">*</span><span class="ident" id="7863501">os</span><span class="op" id="7863503">.</span><span class="ident" id="7863504">File</span><span class="op" id="7863508">,</span>&nbsp;<span class="ident" id="7863510">err</span>&nbsp;<span class="builtintype" id="7863514">error</span><span class="op" id="7863519">)</span><br>
<span class="lineno"></span><span class="op" id="7863521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863524">type</span>&nbsp;<span class="ident" id="7863529">packetConnFile</span>&nbsp;<span class="keyword" id="7863544">interface</span>&nbsp;<span class="op" id="7863554">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863557">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863569">File</span><span class="op" id="7863573">(</span><span class="op" id="7863574">)</span>&nbsp;<span class="op" id="7863576">(</span><span class="ident" id="7863577">f</span>&nbsp;<span class="op" id="7863579">*</span><span class="ident" id="7863580">os</span><span class="op" id="7863582">.</span><span class="ident" id="7863583">File</span><span class="op" id="7863587">,</span>&nbsp;<span class="ident" id="7863589">err</span>&nbsp;<span class="builtintype" id="7863593">error</span><span class="op" id="7863598">)</span><br>
<span class="lineno"></span><span class="op" id="7863600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863603">type</span>&nbsp;<span class="ident" id="7863608">connFile</span>&nbsp;<span class="keyword" id="7863617">interface</span>&nbsp;<span class="op" id="7863627">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863630">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863636">File</span><span class="op" id="7863640">(</span><span class="op" id="7863641">)</span>&nbsp;<span class="op" id="7863643">(</span><span class="ident" id="7863644">f</span>&nbsp;<span class="op" id="7863646">*</span><span class="ident" id="7863647">os</span><span class="op" id="7863649">.</span><span class="ident" id="7863650">File</span><span class="op" id="7863654">,</span>&nbsp;<span class="ident" id="7863656">err</span>&nbsp;<span class="builtintype" id="7863660">error</span><span class="op" id="7863665">)</span><br>
<span class="lineno"></span><span class="op" id="7863667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7863670">func</span>&nbsp;<span class="ident" id="7863675">testFileListener</span><span class="op" id="7863691">(</span><span class="ident" id="7863692">t</span>&nbsp;<span class="op" id="7863694">*</span><span class="ident" id="7863695">testing</span><span class="op" id="7863702">.</span><span class="ident" id="7863703">T</span><span class="op" id="7863704">,</span>&nbsp;<span class="ident" id="7863706">net</span><span class="op" id="7863709">,</span>&nbsp;<span class="ident" id="7863711">laddr</span>&nbsp;<span class="builtintype" id="7863717">string</span><span class="op" id="7863723">)</span>&nbsp;<span class="op" id="7863725">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863728">switch</span>&nbsp;<span class="ident" id="7863735">net</span>&nbsp;<span class="op" id="7863739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863742">case</span>&nbsp;<span class="string" id="7863747">&#34;tcp&#34;</span><span class="op" id="7863752">,</span>&nbsp;<span class="string" id="7863754">&#34;tcp4&#34;</span><span class="op" id="7863760">,</span>&nbsp;<span class="string" id="7863762">&#34;tcp6&#34;</span><span class="op" id="7863768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863772">laddr</span>&nbsp;<span class="op" id="7863778">+=</span>&nbsp;<span class="string" id="7863781">&#34;:0&#34;</span>&nbsp;<span class="comment" id="7863786">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863812">l</span><span class="op" id="7863813">,</span>&nbsp;<span class="ident" id="7863815">err</span>&nbsp;<span class="op" id="7863819">:=</span>&nbsp;<span class="ident" id="7863822">Listen</span><span class="op" id="7863828">(</span><span class="ident" id="7863829">net</span><span class="op" id="7863832">,</span>&nbsp;<span class="ident" id="7863834">laddr</span><span class="op" id="7863839">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863842">if</span>&nbsp;<span class="ident" id="7863845">err</span>&nbsp;<span class="op" id="7863849">!=</span>&nbsp;<span class="ident" id="7863852">nil</span>&nbsp;<span class="op" id="7863856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863860">t</span><span class="op" id="7863861">.</span><span class="ident" id="7863862">Fatalf</span><span class="op" id="7863868">(</span><span class="string" id="7863869">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7863888">,</span>&nbsp;<span class="ident" id="7863890">err</span><span class="op" id="7863893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7863896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863899">defer</span>&nbsp;<span class="ident" id="7863905">l</span><span class="op" id="7863906">.</span><span class="ident" id="7863907">Close</span><span class="op" id="7863912">(</span><span class="op" id="7863913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863916">lf</span>&nbsp;<span class="op" id="7863919">:=</span>&nbsp;<span class="ident" id="7863922">l</span><span class="op" id="7863923">.</span><span class="op" id="7863924">(</span><span class="ident" id="7863925">listenerFile</span><span class="op" id="7863937">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863940">f</span><span class="op" id="7863941">,</span>&nbsp;<span class="ident" id="7863943">err</span>&nbsp;<span class="op" id="7863947">:=</span>&nbsp;<span class="ident" id="7863950">lf</span><span class="op" id="7863952">.</span><span class="ident" id="7863953">File</span><span class="op" id="7863957">(</span><span class="op" id="7863958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7863961">if</span>&nbsp;<span class="ident" id="7863964">err</span>&nbsp;<span class="op" id="7863968">!=</span>&nbsp;<span class="ident" id="7863971">nil</span>&nbsp;<span class="op" id="7863975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7863979">t</span><span class="op" id="7863980">.</span><span class="ident" id="7863981">Fatalf</span><span class="op" id="7863987">(</span><span class="string" id="7863988">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864005">,</span>&nbsp;<span class="ident" id="7864007">err</span><span class="op" id="7864010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864016">c</span><span class="op" id="7864017">,</span>&nbsp;<span class="ident" id="7864019">err</span>&nbsp;<span class="op" id="7864023">:=</span>&nbsp;<span class="ident" id="7864026">FileListener</span><span class="op" id="7864038">(</span><span class="ident" id="7864039">f</span><span class="op" id="7864040">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864043">if</span>&nbsp;<span class="ident" id="7864046">err</span>&nbsp;<span class="op" id="7864050">!=</span>&nbsp;<span class="ident" id="7864053">nil</span>&nbsp;<span class="op" id="7864057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864061">t</span><span class="op" id="7864062">.</span><span class="ident" id="7864063">Fatalf</span><span class="op" id="7864069">(</span><span class="string" id="7864070">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864095">,</span>&nbsp;<span class="ident" id="7864097">err</span><span class="op" id="7864100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864106">if</span>&nbsp;<span class="op" id="7864109">!</span><span class="ident" id="7864110">reflect</span><span class="op" id="7864117">.</span><span class="ident" id="7864118">DeepEqual</span><span class="op" id="7864127">(</span><span class="ident" id="7864128">l</span><span class="op" id="7864129">.</span><span class="ident" id="7864130">Addr</span><span class="op" id="7864134">(</span><span class="op" id="7864135">)</span><span class="op" id="7864136">,</span>&nbsp;<span class="ident" id="7864138">c</span><span class="op" id="7864139">.</span><span class="ident" id="7864140">Addr</span><span class="op" id="7864144">(</span><span class="op" id="7864145">)</span><span class="op" id="7864146">)</span>&nbsp;<span class="op" id="7864148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864152">t</span><span class="op" id="7864153">.</span><span class="ident" id="7864154">Fatalf</span><span class="op" id="7864160">(</span><span class="string" id="7864161">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="7864190">,</span>&nbsp;<span class="ident" id="7864192">l</span><span class="op" id="7864193">.</span><span class="ident" id="7864194">Addr</span><span class="op" id="7864198">(</span><span class="op" id="7864199">)</span><span class="op" id="7864200">,</span>&nbsp;<span class="ident" id="7864202">c</span><span class="op" id="7864203">.</span><span class="ident" id="7864204">Addr</span><span class="op" id="7864208">(</span><span class="op" id="7864209">)</span><span class="op" id="7864210">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864216">if</span>&nbsp;<span class="ident" id="7864219">err</span>&nbsp;<span class="op" id="7864223">:=</span>&nbsp;<span class="ident" id="7864226">c</span><span class="op" id="7864227">.</span><span class="ident" id="7864228">Close</span><span class="op" id="7864233">(</span><span class="op" id="7864234">)</span><span class="op" id="7864235">;</span>&nbsp;<span class="ident" id="7864237">err</span>&nbsp;<span class="op" id="7864241">!=</span>&nbsp;<span class="ident" id="7864244">nil</span>&nbsp;<span class="op" id="7864248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864252">t</span><span class="op" id="7864253">.</span><span class="ident" id="7864254">Fatalf</span><span class="op" id="7864260">(</span><span class="string" id="7864261">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864279">,</span>&nbsp;<span class="ident" id="7864281">err</span><span class="op" id="7864284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7864290">if</span>&nbsp;<span class="ident" id="7864293">err</span>&nbsp;<span class="op" id="7864297">:=</span>&nbsp;<span class="ident" id="7864300">f</span><span class="op" id="7864301">.</span><span class="ident" id="7864302">Close</span><span class="op" id="7864307">(</span><span class="op" id="7864308">)</span><span class="op" id="7864309">;</span>&nbsp;<span class="ident" id="7864311">err</span>&nbsp;<span class="op" id="7864315">!=</span>&nbsp;<span class="ident" id="7864318">nil</span>&nbsp;<span class="op" id="7864322">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864326">t</span><span class="op" id="7864327">.</span><span class="ident" id="7864328">Fatalf</span><span class="op" id="7864334">(</span><span class="string" id="7864335">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7864353">,</span>&nbsp;<span class="ident" id="7864355">err</span><span class="op" id="7864358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864361">}</span><br>
<span class="lineno"></span><span class="op" id="7864363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7864366">var</span>&nbsp;<span class="ident" id="7864370">fileListenerTests</span>&nbsp;<span class="op" id="7864388">=</span>&nbsp;<span class="op" id="7864390">[</span><span class="op" id="7864391">]</span><span class="keyword" id="7864392">struct</span>&nbsp;<span class="op" id="7864399">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864402">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7864408">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864416">laddr</span>&nbsp;<span class="builtintype" id="7864422">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864430">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="7864436">bool</span>&nbsp;<span class="comment" id="7864441">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7864482">linux</span>&nbsp;<span class="builtintype" id="7864488">bool</span>&nbsp;<span class="comment" id="7864493">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7864547">}</span><span class="op" id="7864548">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864551">{</span><span class="ident" id="7864552">net</span><span class="op" id="7864555">:</span>&nbsp;<span class="string" id="7864557">&#34;tcp&#34;</span><span class="op" id="7864562">,</span>&nbsp;<span class="ident" id="7864564">laddr</span><span class="op" id="7864569">:</span>&nbsp;<span class="string" id="7864571">&#34;&#34;</span><span class="op" id="7864573">}</span><span class="op" id="7864574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864577">{</span><span class="ident" id="7864578">net</span><span class="op" id="7864581">:</span>&nbsp;<span class="string" id="7864583">&#34;tcp&#34;</span><span class="op" id="7864588">,</span>&nbsp;<span class="ident" id="7864590">laddr</span><span class="op" id="7864595">:</span>&nbsp;<span class="string" id="7864597">&#34;0.0.0.0&#34;</span><span class="op" id="7864606">}</span><span class="op" id="7864607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864610">{</span><span class="ident" id="7864611">net</span><span class="op" id="7864614">:</span>&nbsp;<span class="string" id="7864616">&#34;tcp&#34;</span><span class="op" id="7864621">,</span>&nbsp;<span class="ident" id="7864623">laddr</span><span class="op" id="7864628">:</span>&nbsp;<span class="string" id="7864630">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7864648">}</span><span class="op" id="7864649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864652">{</span><span class="ident" id="7864653">net</span><span class="op" id="7864656">:</span>&nbsp;<span class="string" id="7864658">&#34;tcp&#34;</span><span class="op" id="7864663">,</span>&nbsp;<span class="ident" id="7864665">laddr</span><span class="op" id="7864670">:</span>&nbsp;<span class="string" id="7864672">&#34;[::]&#34;</span><span class="op" id="7864678">,</span>&nbsp;<span class="ident" id="7864680">ipv6</span><span class="op" id="7864684">:</span>&nbsp;<span class="builtintype" id="7864686">true</span><span class="op" id="7864690">}</span><span class="op" id="7864691">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864695">{</span><span class="ident" id="7864696">net</span><span class="op" id="7864699">:</span>&nbsp;<span class="string" id="7864701">&#34;tcp&#34;</span><span class="op" id="7864706">,</span>&nbsp;<span class="ident" id="7864708">laddr</span><span class="op" id="7864713">:</span>&nbsp;<span class="string" id="7864715">&#34;127.0.0.1&#34;</span><span class="op" id="7864726">}</span><span class="op" id="7864727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864730">{</span><span class="ident" id="7864731">net</span><span class="op" id="7864734">:</span>&nbsp;<span class="string" id="7864736">&#34;tcp&#34;</span><span class="op" id="7864741">,</span>&nbsp;<span class="ident" id="7864743">laddr</span><span class="op" id="7864748">:</span>&nbsp;<span class="string" id="7864750">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7864770">}</span><span class="op" id="7864771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864774">{</span><span class="ident" id="7864775">net</span><span class="op" id="7864778">:</span>&nbsp;<span class="string" id="7864780">&#34;tcp&#34;</span><span class="op" id="7864785">,</span>&nbsp;<span class="ident" id="7864787">laddr</span><span class="op" id="7864792">:</span>&nbsp;<span class="string" id="7864794">&#34;[::1]&#34;</span><span class="op" id="7864801">,</span>&nbsp;<span class="ident" id="7864803">ipv6</span><span class="op" id="7864807">:</span>&nbsp;<span class="builtintype" id="7864809">true</span><span class="op" id="7864813">}</span><span class="op" id="7864814">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864818">{</span><span class="ident" id="7864819">net</span><span class="op" id="7864822">:</span>&nbsp;<span class="string" id="7864824">&#34;tcp4&#34;</span><span class="op" id="7864830">,</span>&nbsp;<span class="ident" id="7864832">laddr</span><span class="op" id="7864837">:</span>&nbsp;<span class="string" id="7864839">&#34;&#34;</span><span class="op" id="7864841">}</span><span class="op" id="7864842">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864845">{</span><span class="ident" id="7864846">net</span><span class="op" id="7864849">:</span>&nbsp;<span class="string" id="7864851">&#34;tcp4&#34;</span><span class="op" id="7864857">,</span>&nbsp;<span class="ident" id="7864859">laddr</span><span class="op" id="7864864">:</span>&nbsp;<span class="string" id="7864866">&#34;0.0.0.0&#34;</span><span class="op" id="7864875">}</span><span class="op" id="7864876">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864879">{</span><span class="ident" id="7864880">net</span><span class="op" id="7864883">:</span>&nbsp;<span class="string" id="7864885">&#34;tcp4&#34;</span><span class="op" id="7864891">,</span>&nbsp;<span class="ident" id="7864893">laddr</span><span class="op" id="7864898">:</span>&nbsp;<span class="string" id="7864900">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7864918">}</span><span class="op" id="7864919">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864923">{</span><span class="ident" id="7864924">net</span><span class="op" id="7864927">:</span>&nbsp;<span class="string" id="7864929">&#34;tcp4&#34;</span><span class="op" id="7864935">,</span>&nbsp;<span class="ident" id="7864937">laddr</span><span class="op" id="7864942">:</span>&nbsp;<span class="string" id="7864944">&#34;127.0.0.1&#34;</span><span class="op" id="7864955">}</span><span class="op" id="7864956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7864959">{</span><span class="ident" id="7864960">net</span><span class="op" id="7864963">:</span>&nbsp;<span class="string" id="7864965">&#34;tcp4&#34;</span><span class="op" id="7864971">,</span>&nbsp;<span class="ident" id="7864973">laddr</span><span class="op" id="7864978">:</span>&nbsp;<span class="string" id="7864980">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7865000">}</span><span class="op" id="7865001">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865005">{</span><span class="ident" id="7865006">net</span><span class="op" id="7865009">:</span>&nbsp;<span class="string" id="7865011">&#34;tcp6&#34;</span><span class="op" id="7865017">,</span>&nbsp;<span class="ident" id="7865019">laddr</span><span class="op" id="7865024">:</span>&nbsp;<span class="string" id="7865026">&#34;&#34;</span><span class="op" id="7865028">,</span>&nbsp;<span class="ident" id="7865030">ipv6</span><span class="op" id="7865034">:</span>&nbsp;<span class="builtintype" id="7865036">true</span><span class="op" id="7865040">}</span><span class="op" id="7865041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865044">{</span><span class="ident" id="7865045">net</span><span class="op" id="7865048">:</span>&nbsp;<span class="string" id="7865050">&#34;tcp6&#34;</span><span class="op" id="7865056">,</span>&nbsp;<span class="ident" id="7865058">laddr</span><span class="op" id="7865063">:</span>&nbsp;<span class="string" id="7865065">&#34;[::]&#34;</span><span class="op" id="7865071">,</span>&nbsp;<span class="ident" id="7865073">ipv6</span><span class="op" id="7865077">:</span>&nbsp;<span class="builtintype" id="7865079">true</span><span class="op" id="7865083">}</span><span class="op" id="7865084">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865088">{</span><span class="ident" id="7865089">net</span><span class="op" id="7865092">:</span>&nbsp;<span class="string" id="7865094">&#34;tcp6&#34;</span><span class="op" id="7865100">,</span>&nbsp;<span class="ident" id="7865102">laddr</span><span class="op" id="7865107">:</span>&nbsp;<span class="string" id="7865109">&#34;[::1]&#34;</span><span class="op" id="7865116">,</span>&nbsp;<span class="ident" id="7865118">ipv6</span><span class="op" id="7865122">:</span>&nbsp;<span class="builtintype" id="7865124">true</span><span class="op" id="7865128">}</span><span class="op" id="7865129">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865133">{</span><span class="ident" id="7865134">net</span><span class="op" id="7865137">:</span>&nbsp;<span class="string" id="7865139">&#34;unix&#34;</span><span class="op" id="7865145">,</span>&nbsp;<span class="ident" id="7865147">laddr</span><span class="op" id="7865152">:</span>&nbsp;<span class="string" id="7865154">&#34;@gotest/net&#34;</span><span class="op" id="7865167">,</span>&nbsp;<span class="ident" id="7865169">linux</span><span class="op" id="7865174">:</span>&nbsp;<span class="builtintype" id="7865176">true</span><span class="op" id="7865180">}</span><span class="op" id="7865181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865184">{</span><span class="ident" id="7865185">net</span><span class="op" id="7865188">:</span>&nbsp;<span class="string" id="7865190">&#34;unixpacket&#34;</span><span class="op" id="7865202">,</span>&nbsp;<span class="ident" id="7865204">laddr</span><span class="op" id="7865209">:</span>&nbsp;<span class="string" id="7865211">&#34;@gotest/net&#34;</span><span class="op" id="7865224">,</span>&nbsp;<span class="ident" id="7865226">linux</span><span class="op" id="7865231">:</span>&nbsp;<span class="builtintype" id="7865233">true</span><span class="op" id="7865237">}</span><span class="op" id="7865238">,</span><br>
<span class="lineno"></span><span class="op" id="7865240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7865243">func</span>&nbsp;<span class="ident" id="7865248">TestFileListener</span><span class="op" id="7865264">(</span><span class="ident" id="7865265">t</span>&nbsp;<span class="op" id="7865267">*</span><span class="ident" id="7865268">testing</span><span class="op" id="7865275">.</span><span class="ident" id="7865276">T</span><span class="op" id="7865277">)</span>&nbsp;<span class="op" id="7865279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865282">switch</span>&nbsp;<span class="ident" id="7865289">runtime</span><span class="op" id="7865296">.</span><span class="ident" id="7865297">GOOS</span>&nbsp;<span class="op" id="7865302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865305">case</span>&nbsp;<span class="string" id="7865310">&#34;nacl&#34;</span><span class="op" id="7865316">,</span>&nbsp;<span class="string" id="7865318">&#34;windows&#34;</span><span class="op" id="7865327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865331">t</span><span class="op" id="7865332">.</span><span class="ident" id="7865333">Skipf</span><span class="op" id="7865338">(</span><span class="string" id="7865339">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7865360">,</span>&nbsp;<span class="ident" id="7865362">runtime</span><span class="op" id="7865369">.</span><span class="ident" id="7865370">GOOS</span><span class="op" id="7865374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865377">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865381">for</span>&nbsp;<span class="ident" id="7865385">_</span><span class="op" id="7865386">,</span>&nbsp;<span class="ident" id="7865388">tt</span>&nbsp;<span class="op" id="7865391">:=</span>&nbsp;<span class="keyword" id="7865394">range</span>&nbsp;<span class="ident" id="7865400">fileListenerTests</span>&nbsp;<span class="op" id="7865418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865422">if</span>&nbsp;<span class="ident" id="7865425">skipServerTest</span><span class="op" id="7865439">(</span><span class="ident" id="7865440">tt</span><span class="op" id="7865442">.</span><span class="ident" id="7865443">net</span><span class="op" id="7865446">,</span>&nbsp;<span class="string" id="7865448">&#34;unix&#34;</span><span class="op" id="7865454">,</span>&nbsp;<span class="ident" id="7865456">tt</span><span class="op" id="7865458">.</span><span class="ident" id="7865459">laddr</span><span class="op" id="7865464">,</span>&nbsp;<span class="ident" id="7865466">tt</span><span class="op" id="7865468">.</span><span class="ident" id="7865469">ipv6</span><span class="op" id="7865473">,</span>&nbsp;<span class="builtintype" id="7865475">false</span><span class="op" id="7865480">,</span>&nbsp;<span class="ident" id="7865482">tt</span><span class="op" id="7865484">.</span><span class="ident" id="7865485">linux</span><span class="op" id="7865490">)</span>&nbsp;<span class="op" id="7865492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865497">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865508">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865512">if</span>&nbsp;<span class="ident" id="7865515">skipServerTest</span><span class="op" id="7865529">(</span><span class="ident" id="7865530">tt</span><span class="op" id="7865532">.</span><span class="ident" id="7865533">net</span><span class="op" id="7865536">,</span>&nbsp;<span class="string" id="7865538">&#34;unixpacket&#34;</span><span class="op" id="7865550">,</span>&nbsp;<span class="ident" id="7865552">tt</span><span class="op" id="7865554">.</span><span class="ident" id="7865555">laddr</span><span class="op" id="7865560">,</span>&nbsp;<span class="ident" id="7865562">tt</span><span class="op" id="7865564">.</span><span class="ident" id="7865565">ipv6</span><span class="op" id="7865569">,</span>&nbsp;<span class="builtintype" id="7865571">false</span><span class="op" id="7865576">,</span>&nbsp;<span class="ident" id="7865578">tt</span><span class="op" id="7865580">.</span><span class="ident" id="7865581">linux</span><span class="op" id="7865586">)</span>&nbsp;<span class="op" id="7865588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865593">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865608">testFileListener</span><span class="op" id="7865624">(</span><span class="ident" id="7865625">t</span><span class="op" id="7865626">,</span>&nbsp;<span class="ident" id="7865628">tt</span><span class="op" id="7865630">.</span><span class="ident" id="7865631">net</span><span class="op" id="7865634">,</span>&nbsp;<span class="ident" id="7865636">tt</span><span class="op" id="7865638">.</span><span class="ident" id="7865639">laddr</span><span class="op" id="7865644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865647">}</span><br>
<span class="lineno">105</span><span class="op" id="7865649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7865652">func</span>&nbsp;<span class="ident" id="7865657">testFilePacketConn</span><span class="op" id="7865675">(</span><span class="ident" id="7865676">t</span>&nbsp;<span class="op" id="7865678">*</span><span class="ident" id="7865679">testing</span><span class="op" id="7865686">.</span><span class="ident" id="7865687">T</span><span class="op" id="7865688">,</span>&nbsp;<span class="ident" id="7865690">pcf</span>&nbsp;<span class="ident" id="7865694">packetConnFile</span><span class="op" id="7865708">,</span>&nbsp;<span class="ident" id="7865710">listen</span>&nbsp;<span class="builtintype" id="7865717">bool</span><span class="op" id="7865721">)</span>&nbsp;<span class="op" id="7865723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865726">f</span><span class="op" id="7865727">,</span>&nbsp;<span class="ident" id="7865729">err</span>&nbsp;<span class="op" id="7865733">:=</span>&nbsp;<span class="ident" id="7865736">pcf</span><span class="op" id="7865739">.</span><span class="ident" id="7865740">File</span><span class="op" id="7865744">(</span><span class="op" id="7865745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865748">if</span>&nbsp;<span class="ident" id="7865751">err</span>&nbsp;<span class="op" id="7865755">!=</span>&nbsp;<span class="ident" id="7865758">nil</span>&nbsp;<span class="op" id="7865762">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865766">t</span><span class="op" id="7865767">.</span><span class="ident" id="7865768">Fatalf</span><span class="op" id="7865774">(</span><span class="string" id="7865775">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865792">,</span>&nbsp;<span class="ident" id="7865794">err</span><span class="op" id="7865797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865803">c</span><span class="op" id="7865804">,</span>&nbsp;<span class="ident" id="7865806">err</span>&nbsp;<span class="op" id="7865810">:=</span>&nbsp;<span class="ident" id="7865813">FilePacketConn</span><span class="op" id="7865827">(</span><span class="ident" id="7865828">f</span><span class="op" id="7865829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865832">if</span>&nbsp;<span class="ident" id="7865835">err</span>&nbsp;<span class="op" id="7865839">!=</span>&nbsp;<span class="ident" id="7865842">nil</span>&nbsp;<span class="op" id="7865846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865850">t</span><span class="op" id="7865851">.</span><span class="ident" id="7865852">Fatalf</span><span class="op" id="7865858">(</span><span class="string" id="7865859">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7865886">,</span>&nbsp;<span class="ident" id="7865888">err</span><span class="op" id="7865891">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7865894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7865897">if</span>&nbsp;<span class="op" id="7865900">!</span><span class="ident" id="7865901">reflect</span><span class="op" id="7865908">.</span><span class="ident" id="7865909">DeepEqual</span><span class="op" id="7865918">(</span><span class="ident" id="7865919">pcf</span><span class="op" id="7865922">.</span><span class="ident" id="7865923">LocalAddr</span><span class="op" id="7865932">(</span><span class="op" id="7865933">)</span><span class="op" id="7865934">,</span>&nbsp;<span class="ident" id="7865936">c</span><span class="op" id="7865937">.</span><span class="ident" id="7865938">LocalAddr</span><span class="op" id="7865947">(</span><span class="op" id="7865948">)</span><span class="op" id="7865949">)</span>&nbsp;<span class="op" id="7865951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7865955">t</span><span class="op" id="7865956">.</span><span class="ident" id="7865957">Fatalf</span><span class="op" id="7865963">(</span><span class="string" id="7865964">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="7865998">,</span>&nbsp;<span class="ident" id="7866000">pcf</span><span class="op" id="7866003">.</span><span class="ident" id="7866004">LocalAddr</span><span class="op" id="7866013">(</span><span class="op" id="7866014">)</span><span class="op" id="7866015">,</span>&nbsp;<span class="ident" id="7866017">c</span><span class="op" id="7866018">.</span><span class="ident" id="7866019">LocalAddr</span><span class="op" id="7866028">(</span><span class="op" id="7866029">)</span><span class="op" id="7866030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866036">if</span>&nbsp;<span class="ident" id="7866039">listen</span>&nbsp;<span class="op" id="7866046">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866050">if</span>&nbsp;<span class="ident" id="7866053">_</span><span class="op" id="7866054">,</span>&nbsp;<span class="ident" id="7866056">err</span>&nbsp;<span class="op" id="7866060">:=</span>&nbsp;<span class="ident" id="7866063">c</span><span class="op" id="7866064">.</span><span class="ident" id="7866065">WriteTo</span><span class="op" id="7866072">(</span><span class="op" id="7866073">[</span><span class="op" id="7866074">]</span><span class="builtintype" id="7866075">byte</span><span class="op" id="7866079">{</span><span class="op" id="7866080">}</span><span class="op" id="7866081">,</span>&nbsp;<span class="ident" id="7866083">c</span><span class="op" id="7866084">.</span><span class="ident" id="7866085">LocalAddr</span><span class="op" id="7866094">(</span><span class="op" id="7866095">)</span><span class="op" id="7866096">)</span><span class="op" id="7866097">;</span>&nbsp;<span class="ident" id="7866099">err</span>&nbsp;<span class="op" id="7866103">!=</span>&nbsp;<span class="ident" id="7866106">nil</span>&nbsp;<span class="op" id="7866110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866115">t</span><span class="op" id="7866116">.</span><span class="ident" id="7866117">Fatalf</span><span class="op" id="7866123">(</span><span class="string" id="7866124">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866144">,</span>&nbsp;<span class="ident" id="7866146">err</span><span class="op" id="7866149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866159">if</span>&nbsp;<span class="ident" id="7866162">err</span>&nbsp;<span class="op" id="7866166">:=</span>&nbsp;<span class="ident" id="7866169">c</span><span class="op" id="7866170">.</span><span class="ident" id="7866171">Close</span><span class="op" id="7866176">(</span><span class="op" id="7866177">)</span><span class="op" id="7866178">;</span>&nbsp;<span class="ident" id="7866180">err</span>&nbsp;<span class="op" id="7866184">!=</span>&nbsp;<span class="ident" id="7866187">nil</span>&nbsp;<span class="op" id="7866191">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866195">t</span><span class="op" id="7866196">.</span><span class="ident" id="7866197">Fatalf</span><span class="op" id="7866203">(</span><span class="string" id="7866204">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866222">,</span>&nbsp;<span class="ident" id="7866224">err</span><span class="op" id="7866227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866233">if</span>&nbsp;<span class="ident" id="7866236">err</span>&nbsp;<span class="op" id="7866240">:=</span>&nbsp;<span class="ident" id="7866243">f</span><span class="op" id="7866244">.</span><span class="ident" id="7866245">Close</span><span class="op" id="7866250">(</span><span class="op" id="7866251">)</span><span class="op" id="7866252">;</span>&nbsp;<span class="ident" id="7866254">err</span>&nbsp;<span class="op" id="7866258">!=</span>&nbsp;<span class="ident" id="7866261">nil</span>&nbsp;<span class="op" id="7866265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866269">t</span><span class="op" id="7866270">.</span><span class="ident" id="7866271">Fatalf</span><span class="op" id="7866277">(</span><span class="string" id="7866278">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866296">,</span>&nbsp;<span class="ident" id="7866298">err</span><span class="op" id="7866301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866304">}</span><br>
<span class="lineno">130</span><span class="op" id="7866306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866309">func</span>&nbsp;<span class="ident" id="7866314">testFilePacketConnListen</span><span class="op" id="7866338">(</span><span class="ident" id="7866339">t</span>&nbsp;<span class="op" id="7866341">*</span><span class="ident" id="7866342">testing</span><span class="op" id="7866349">.</span><span class="ident" id="7866350">T</span><span class="op" id="7866351">,</span>&nbsp;<span class="ident" id="7866353">net</span><span class="op" id="7866356">,</span>&nbsp;<span class="ident" id="7866358">laddr</span>&nbsp;<span class="builtintype" id="7866364">string</span><span class="op" id="7866370">)</span>&nbsp;<span class="op" id="7866372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866375">switch</span>&nbsp;<span class="ident" id="7866382">net</span>&nbsp;<span class="op" id="7866386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866389">case</span>&nbsp;<span class="string" id="7866394">&#34;udp&#34;</span><span class="op" id="7866399">,</span>&nbsp;<span class="string" id="7866401">&#34;udp4&#34;</span><span class="op" id="7866407">,</span>&nbsp;<span class="string" id="7866409">&#34;udp6&#34;</span><span class="op" id="7866415">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866419">laddr</span>&nbsp;<span class="op" id="7866425">+=</span>&nbsp;<span class="string" id="7866428">&#34;:0&#34;</span>&nbsp;<span class="comment" id="7866433">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866459">l</span><span class="op" id="7866460">,</span>&nbsp;<span class="ident" id="7866462">err</span>&nbsp;<span class="op" id="7866466">:=</span>&nbsp;<span class="ident" id="7866469">ListenPacket</span><span class="op" id="7866481">(</span><span class="ident" id="7866482">net</span><span class="op" id="7866485">,</span>&nbsp;<span class="ident" id="7866487">laddr</span><span class="op" id="7866492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866495">if</span>&nbsp;<span class="ident" id="7866498">err</span>&nbsp;<span class="op" id="7866502">!=</span>&nbsp;<span class="ident" id="7866505">nil</span>&nbsp;<span class="op" id="7866509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866513">t</span><span class="op" id="7866514">.</span><span class="ident" id="7866515">Fatalf</span><span class="op" id="7866521">(</span><span class="string" id="7866522">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866547">,</span>&nbsp;<span class="ident" id="7866549">err</span><span class="op" id="7866552">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866558">testFilePacketConn</span><span class="op" id="7866576">(</span><span class="ident" id="7866577">t</span><span class="op" id="7866578">,</span>&nbsp;<span class="ident" id="7866580">l</span><span class="op" id="7866581">.</span><span class="op" id="7866582">(</span><span class="ident" id="7866583">packetConnFile</span><span class="op" id="7866597">)</span><span class="op" id="7866598">,</span>&nbsp;<span class="builtintype" id="7866600">true</span><span class="op" id="7866604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866607">if</span>&nbsp;<span class="ident" id="7866610">err</span>&nbsp;<span class="op" id="7866614">:=</span>&nbsp;<span class="ident" id="7866617">l</span><span class="op" id="7866618">.</span><span class="ident" id="7866619">Close</span><span class="op" id="7866624">(</span><span class="op" id="7866625">)</span><span class="op" id="7866626">;</span>&nbsp;<span class="ident" id="7866628">err</span>&nbsp;<span class="op" id="7866632">!=</span>&nbsp;<span class="ident" id="7866635">nil</span>&nbsp;<span class="op" id="7866639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866643">t</span><span class="op" id="7866644">.</span><span class="ident" id="7866645">Fatalf</span><span class="op" id="7866651">(</span><span class="string" id="7866652">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866670">,</span>&nbsp;<span class="ident" id="7866672">err</span><span class="op" id="7866675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866678">}</span><br>
<span class="lineno">145</span><span class="op" id="7866680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7866683">func</span>&nbsp;<span class="ident" id="7866688">testFilePacketConnDial</span><span class="op" id="7866710">(</span><span class="ident" id="7866711">t</span>&nbsp;<span class="op" id="7866713">*</span><span class="ident" id="7866714">testing</span><span class="op" id="7866721">.</span><span class="ident" id="7866722">T</span><span class="op" id="7866723">,</span>&nbsp;<span class="ident" id="7866725">net</span><span class="op" id="7866728">,</span>&nbsp;<span class="ident" id="7866730">raddr</span>&nbsp;<span class="builtintype" id="7866736">string</span><span class="op" id="7866742">)</span>&nbsp;<span class="op" id="7866744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866747">switch</span>&nbsp;<span class="ident" id="7866754">net</span>&nbsp;<span class="op" id="7866758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866761">case</span>&nbsp;<span class="string" id="7866766">&#34;udp&#34;</span><span class="op" id="7866771">,</span>&nbsp;<span class="string" id="7866773">&#34;udp4&#34;</span><span class="op" id="7866779">,</span>&nbsp;<span class="string" id="7866781">&#34;udp6&#34;</span><span class="op" id="7866787">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866791">raddr</span>&nbsp;<span class="op" id="7866797">+=</span>&nbsp;<span class="string" id="7866800">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866813">c</span><span class="op" id="7866814">,</span>&nbsp;<span class="ident" id="7866816">err</span>&nbsp;<span class="op" id="7866820">:=</span>&nbsp;<span class="ident" id="7866823">Dial</span><span class="op" id="7866827">(</span><span class="ident" id="7866828">net</span><span class="op" id="7866831">,</span>&nbsp;<span class="ident" id="7866833">raddr</span><span class="op" id="7866838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866841">if</span>&nbsp;<span class="ident" id="7866844">err</span>&nbsp;<span class="op" id="7866848">!=</span>&nbsp;<span class="ident" id="7866851">nil</span>&nbsp;<span class="op" id="7866855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866859">t</span><span class="op" id="7866860">.</span><span class="ident" id="7866861">Fatalf</span><span class="op" id="7866867">(</span><span class="string" id="7866868">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7866885">,</span>&nbsp;<span class="ident" id="7866887">err</span><span class="op" id="7866890">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7866893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866896">testFilePacketConn</span><span class="op" id="7866914">(</span><span class="ident" id="7866915">t</span><span class="op" id="7866916">,</span>&nbsp;<span class="ident" id="7866918">c</span><span class="op" id="7866919">.</span><span class="op" id="7866920">(</span><span class="ident" id="7866921">packetConnFile</span><span class="op" id="7866935">)</span><span class="op" id="7866936">,</span>&nbsp;<span class="builtintype" id="7866938">false</span><span class="op" id="7866943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7866946">if</span>&nbsp;<span class="ident" id="7866949">err</span>&nbsp;<span class="op" id="7866953">:=</span>&nbsp;<span class="ident" id="7866956">c</span><span class="op" id="7866957">.</span><span class="ident" id="7866958">Close</span><span class="op" id="7866963">(</span><span class="op" id="7866964">)</span><span class="op" id="7866965">;</span>&nbsp;<span class="ident" id="7866967">err</span>&nbsp;<span class="op" id="7866971">!=</span>&nbsp;<span class="ident" id="7866974">nil</span>&nbsp;<span class="op" id="7866978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7866982">t</span><span class="op" id="7866983">.</span><span class="ident" id="7866984">Fatalf</span><span class="op" id="7866990">(</span><span class="string" id="7866991">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7867009">,</span>&nbsp;<span class="ident" id="7867011">err</span><span class="op" id="7867014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867017">}</span><br>
<span class="lineno">160</span><span class="op" id="7867019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867022">var</span>&nbsp;<span class="ident" id="7867026">filePacketConnTests</span>&nbsp;<span class="op" id="7867046">=</span>&nbsp;<span class="op" id="7867048">[</span><span class="op" id="7867049">]</span><span class="keyword" id="7867050">struct</span>&nbsp;<span class="op" id="7867057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867060">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7867066">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867074">addr</span>&nbsp;&nbsp;<span class="builtintype" id="7867080">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867088">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="7867094">bool</span>&nbsp;<span class="comment" id="7867099">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867140">linux</span>&nbsp;<span class="builtintype" id="7867146">bool</span>&nbsp;<span class="comment" id="7867151">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7867205">}</span><span class="op" id="7867206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867209">{</span><span class="ident" id="7867210">net</span><span class="op" id="7867213">:</span>&nbsp;<span class="string" id="7867215">&#34;udp&#34;</span><span class="op" id="7867220">,</span>&nbsp;<span class="ident" id="7867222">addr</span><span class="op" id="7867226">:</span>&nbsp;<span class="string" id="7867228">&#34;127.0.0.1&#34;</span><span class="op" id="7867239">}</span><span class="op" id="7867240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867243">{</span><span class="ident" id="7867244">net</span><span class="op" id="7867247">:</span>&nbsp;<span class="string" id="7867249">&#34;udp&#34;</span><span class="op" id="7867254">,</span>&nbsp;<span class="ident" id="7867256">addr</span><span class="op" id="7867260">:</span>&nbsp;<span class="string" id="7867262">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7867282">}</span><span class="op" id="7867283">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867286">{</span><span class="ident" id="7867287">net</span><span class="op" id="7867290">:</span>&nbsp;<span class="string" id="7867292">&#34;udp&#34;</span><span class="op" id="7867297">,</span>&nbsp;<span class="ident" id="7867299">addr</span><span class="op" id="7867303">:</span>&nbsp;<span class="string" id="7867305">&#34;[::1]&#34;</span><span class="op" id="7867312">,</span>&nbsp;<span class="ident" id="7867314">ipv6</span><span class="op" id="7867318">:</span>&nbsp;<span class="builtintype" id="7867320">true</span><span class="op" id="7867324">}</span><span class="op" id="7867325">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867329">{</span><span class="ident" id="7867330">net</span><span class="op" id="7867333">:</span>&nbsp;<span class="string" id="7867335">&#34;udp4&#34;</span><span class="op" id="7867341">,</span>&nbsp;<span class="ident" id="7867343">addr</span><span class="op" id="7867347">:</span>&nbsp;<span class="string" id="7867349">&#34;127.0.0.1&#34;</span><span class="op" id="7867360">}</span><span class="op" id="7867361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867364">{</span><span class="ident" id="7867365">net</span><span class="op" id="7867368">:</span>&nbsp;<span class="string" id="7867370">&#34;udp4&#34;</span><span class="op" id="7867376">,</span>&nbsp;<span class="ident" id="7867378">addr</span><span class="op" id="7867382">:</span>&nbsp;<span class="string" id="7867384">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7867404">}</span><span class="op" id="7867405">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867409">{</span><span class="ident" id="7867410">net</span><span class="op" id="7867413">:</span>&nbsp;<span class="string" id="7867415">&#34;udp6&#34;</span><span class="op" id="7867421">,</span>&nbsp;<span class="ident" id="7867423">addr</span><span class="op" id="7867427">:</span>&nbsp;<span class="string" id="7867429">&#34;[::1]&#34;</span><span class="op" id="7867436">,</span>&nbsp;<span class="ident" id="7867438">ipv6</span><span class="op" id="7867442">:</span>&nbsp;<span class="builtintype" id="7867444">true</span><span class="op" id="7867448">}</span><span class="op" id="7867449">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867453">{</span><span class="ident" id="7867454">net</span><span class="op" id="7867457">:</span>&nbsp;<span class="string" id="7867459">&#34;ip4:icmp&#34;</span><span class="op" id="7867469">,</span>&nbsp;<span class="ident" id="7867471">addr</span><span class="op" id="7867475">:</span>&nbsp;<span class="string" id="7867477">&#34;127.0.0.1&#34;</span><span class="op" id="7867488">}</span><span class="op" id="7867489">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867493">{</span><span class="ident" id="7867494">net</span><span class="op" id="7867497">:</span>&nbsp;<span class="string" id="7867499">&#34;unixgram&#34;</span><span class="op" id="7867509">,</span>&nbsp;<span class="ident" id="7867511">addr</span><span class="op" id="7867515">:</span>&nbsp;<span class="string" id="7867517">&#34;@gotest3/net&#34;</span><span class="op" id="7867531">,</span>&nbsp;<span class="ident" id="7867533">linux</span><span class="op" id="7867538">:</span>&nbsp;<span class="builtintype" id="7867540">true</span><span class="op" id="7867544">}</span><span class="op" id="7867545">,</span><br>
<span class="lineno">180</span><span class="op" id="7867547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7867550">func</span>&nbsp;<span class="ident" id="7867555">TestFilePacketConn</span><span class="op" id="7867573">(</span><span class="ident" id="7867574">t</span>&nbsp;<span class="op" id="7867576">*</span><span class="ident" id="7867577">testing</span><span class="op" id="7867584">.</span><span class="ident" id="7867585">T</span><span class="op" id="7867586">)</span>&nbsp;<span class="op" id="7867588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867591">switch</span>&nbsp;<span class="ident" id="7867598">runtime</span><span class="op" id="7867605">.</span><span class="ident" id="7867606">GOOS</span>&nbsp;<span class="op" id="7867611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867614">case</span>&nbsp;<span class="string" id="7867619">&#34;nacl&#34;</span><span class="op" id="7867625">,</span>&nbsp;<span class="string" id="7867627">&#34;plan9&#34;</span><span class="op" id="7867634">,</span>&nbsp;<span class="string" id="7867636">&#34;windows&#34;</span><span class="op" id="7867645">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867649">t</span><span class="op" id="7867650">.</span><span class="ident" id="7867651">Skipf</span><span class="op" id="7867656">(</span><span class="string" id="7867657">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7867678">,</span>&nbsp;<span class="ident" id="7867680">runtime</span><span class="op" id="7867687">.</span><span class="ident" id="7867688">GOOS</span><span class="op" id="7867692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867699">for</span>&nbsp;<span class="ident" id="7867703">_</span><span class="op" id="7867704">,</span>&nbsp;<span class="ident" id="7867706">tt</span>&nbsp;<span class="op" id="7867709">:=</span>&nbsp;<span class="keyword" id="7867712">range</span>&nbsp;<span class="ident" id="7867718">filePacketConnTests</span>&nbsp;<span class="op" id="7867738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867742">if</span>&nbsp;<span class="ident" id="7867745">skipServerTest</span><span class="op" id="7867759">(</span><span class="ident" id="7867760">tt</span><span class="op" id="7867762">.</span><span class="ident" id="7867763">net</span><span class="op" id="7867766">,</span>&nbsp;<span class="string" id="7867768">&#34;unixgram&#34;</span><span class="op" id="7867778">,</span>&nbsp;<span class="ident" id="7867780">tt</span><span class="op" id="7867782">.</span><span class="ident" id="7867783">addr</span><span class="op" id="7867787">,</span>&nbsp;<span class="ident" id="7867789">tt</span><span class="op" id="7867791">.</span><span class="ident" id="7867792">ipv6</span><span class="op" id="7867796">,</span>&nbsp;<span class="builtintype" id="7867798">false</span><span class="op" id="7867803">,</span>&nbsp;<span class="ident" id="7867805">tt</span><span class="op" id="7867807">.</span><span class="ident" id="7867808">linux</span><span class="op" id="7867813">)</span>&nbsp;<span class="op" id="7867815">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867820">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867835">if</span>&nbsp;<span class="ident" id="7867838">os</span><span class="op" id="7867840">.</span><span class="ident" id="7867841">Getuid</span><span class="op" id="7867847">(</span><span class="op" id="7867848">)</span>&nbsp;<span class="op" id="7867850">!=</span>&nbsp;<span class="num" id="7867853">0</span>&nbsp;<span class="op" id="7867855">&amp;&amp;</span>&nbsp;<span class="ident" id="7867858">tt</span><span class="op" id="7867860">.</span><span class="ident" id="7867861">net</span>&nbsp;<span class="op" id="7867865">==</span>&nbsp;<span class="string" id="7867868">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="7867879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867884">t</span><span class="op" id="7867885">.</span><span class="ident" id="7867886">Log</span><span class="op" id="7867889">(</span><span class="string" id="7867890">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="7867919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867924">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7867935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7867939">testFilePacketConnListen</span><span class="op" id="7867963">(</span><span class="ident" id="7867964">t</span><span class="op" id="7867965">,</span>&nbsp;<span class="ident" id="7867967">tt</span><span class="op" id="7867969">.</span><span class="ident" id="7867970">net</span><span class="op" id="7867973">,</span>&nbsp;<span class="ident" id="7867975">tt</span><span class="op" id="7867977">.</span><span class="ident" id="7867978">addr</span><span class="op" id="7867982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7867986">switch</span>&nbsp;<span class="ident" id="7867993">tt</span><span class="op" id="7867995">.</span><span class="ident" id="7867996">addr</span>&nbsp;<span class="op" id="7868001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868005">case</span>&nbsp;<span class="string" id="7868010">&#34;&#34;</span><span class="op" id="7868012">,</span>&nbsp;<span class="string" id="7868014">&#34;0.0.0.0&#34;</span><span class="op" id="7868023">,</span>&nbsp;<span class="string" id="7868025">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7868043">,</span>&nbsp;<span class="string" id="7868045">&#34;[::]&#34;</span><span class="op" id="7868051">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868055">default</span><span class="op" id="7868062">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7868067">if</span>&nbsp;<span class="ident" id="7868070">tt</span><span class="op" id="7868072">.</span><span class="ident" id="7868073">net</span>&nbsp;<span class="op" id="7868077">!=</span>&nbsp;<span class="string" id="7868080">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="7868091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7868097">testFilePacketConnDial</span><span class="op" id="7868119">(</span><span class="ident" id="7868120">t</span><span class="op" id="7868121">,</span>&nbsp;<span class="ident" id="7868123">tt</span><span class="op" id="7868125">.</span><span class="ident" id="7868126">net</span><span class="op" id="7868129">,</span>&nbsp;<span class="ident" id="7868131">tt</span><span class="op" id="7868133">.</span><span class="ident" id="7868134">addr</span><span class="op" id="7868138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7868150">}</span><br>
<span class="lineno">205</span><span class="op" id="7868152">}</span>
</div>
</body>
</html>
