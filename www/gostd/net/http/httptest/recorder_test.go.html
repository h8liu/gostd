<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html" class="current">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7345669">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7345724">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7345778">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7345829">package</span>&nbsp;<span class="ident" id="7345837">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7345847">import</span>&nbsp;<span class="op" id="7345854">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7345857">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7345864">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7345876">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7345886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7345889">func</span>&nbsp;<span class="ident" id="7345894">TestRecorder</span><span class="op" id="7345906">(</span><span class="ident" id="7345907">t</span>&nbsp;<span class="op" id="7345909">*</span><span class="ident" id="7345910">testing</span><span class="op" id="7345917">.</span><span class="ident" id="7345918">T</span><span class="op" id="7345919">)</span>&nbsp;<span class="op" id="7345921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7345924">type</span>&nbsp;<span class="ident" id="7345929">checkFunc</span>&nbsp;<span class="keyword" id="7345939">func</span><span class="op" id="7345943">(</span><span class="op" id="7345944">*</span><span class="ident" id="7345945">ResponseRecorder</span><span class="op" id="7345961">)</span>&nbsp;<span class="builtintype" id="7345963">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7345970">check</span>&nbsp;<span class="op" id="7345976">:=</span>&nbsp;<span class="keyword" id="7345979">func</span><span class="op" id="7345983">(</span><span class="ident" id="7345984">fns</span>&nbsp;<span class="op" id="7345988">...</span><span class="ident" id="7345991">checkFunc</span><span class="op" id="7346000">)</span>&nbsp;<span class="op" id="7346002">[</span><span class="op" id="7346003">]</span><span class="ident" id="7346004">checkFunc</span>&nbsp;<span class="op" id="7346014">{</span>&nbsp;<span class="keyword" id="7346016">return</span>&nbsp;<span class="ident" id="7346023">fns</span>&nbsp;<span class="op" id="7346027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346031">hasStatus</span>&nbsp;<span class="op" id="7346041">:=</span>&nbsp;<span class="keyword" id="7346044">func</span><span class="op" id="7346048">(</span><span class="ident" id="7346049">wantCode</span>&nbsp;<span class="builtintype" id="7346058">int</span><span class="op" id="7346061">)</span>&nbsp;<span class="ident" id="7346063">checkFunc</span>&nbsp;<span class="op" id="7346073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346077">return</span>&nbsp;<span class="keyword" id="7346084">func</span><span class="op" id="7346088">(</span><span class="ident" id="7346089">rec</span>&nbsp;<span class="op" id="7346093">*</span><span class="ident" id="7346094">ResponseRecorder</span><span class="op" id="7346110">)</span>&nbsp;<span class="builtintype" id="7346112">error</span>&nbsp;<span class="op" id="7346118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346123">if</span>&nbsp;<span class="ident" id="7346126">rec</span><span class="op" id="7346129">.</span><span class="ident" id="7346130">Code</span>&nbsp;<span class="op" id="7346135">!=</span>&nbsp;<span class="ident" id="7346138">wantCode</span>&nbsp;<span class="op" id="7346147">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346153">return</span>&nbsp;<span class="ident" id="7346160">fmt</span><span class="op" id="7346163">.</span><span class="ident" id="7346164">Errorf</span><span class="op" id="7346170">(</span><span class="string" id="7346171">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7346193">,</span>&nbsp;<span class="ident" id="7346195">rec</span><span class="op" id="7346198">.</span><span class="ident" id="7346199">Code</span><span class="op" id="7346203">,</span>&nbsp;<span class="ident" id="7346205">wantCode</span><span class="op" id="7346213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346223">return</span>&nbsp;<span class="ident" id="7346230">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346239">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346242">hasContents</span>&nbsp;<span class="op" id="7346254">:=</span>&nbsp;<span class="keyword" id="7346257">func</span><span class="op" id="7346261">(</span><span class="ident" id="7346262">want</span>&nbsp;<span class="builtintype" id="7346267">string</span><span class="op" id="7346273">)</span>&nbsp;<span class="ident" id="7346275">checkFunc</span>&nbsp;<span class="op" id="7346285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346289">return</span>&nbsp;<span class="keyword" id="7346296">func</span><span class="op" id="7346300">(</span><span class="ident" id="7346301">rec</span>&nbsp;<span class="op" id="7346305">*</span><span class="ident" id="7346306">ResponseRecorder</span><span class="op" id="7346322">)</span>&nbsp;<span class="builtintype" id="7346324">error</span>&nbsp;<span class="op" id="7346330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346335">if</span>&nbsp;<span class="ident" id="7346338">rec</span><span class="op" id="7346341">.</span><span class="ident" id="7346342">Body</span><span class="op" id="7346346">.</span><span class="ident" id="7346347">String</span><span class="op" id="7346353">(</span><span class="op" id="7346354">)</span>&nbsp;<span class="op" id="7346356">!=</span>&nbsp;<span class="ident" id="7346359">want</span>&nbsp;<span class="op" id="7346364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346370">return</span>&nbsp;<span class="ident" id="7346377">fmt</span><span class="op" id="7346380">.</span><span class="ident" id="7346381">Errorf</span><span class="op" id="7346387">(</span><span class="string" id="7346388">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7346409">,</span>&nbsp;<span class="ident" id="7346411">rec</span><span class="op" id="7346414">.</span><span class="ident" id="7346415">Body</span><span class="op" id="7346419">.</span><span class="ident" id="7346420">String</span><span class="op" id="7346426">(</span><span class="op" id="7346427">)</span><span class="op" id="7346428">,</span>&nbsp;<span class="ident" id="7346430">want</span><span class="op" id="7346434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346439">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346444">return</span>&nbsp;<span class="ident" id="7346451">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346463">hasFlush</span>&nbsp;<span class="op" id="7346472">:=</span>&nbsp;<span class="keyword" id="7346475">func</span><span class="op" id="7346479">(</span><span class="ident" id="7346480">want</span>&nbsp;<span class="builtintype" id="7346485">bool</span><span class="op" id="7346489">)</span>&nbsp;<span class="ident" id="7346491">checkFunc</span>&nbsp;<span class="op" id="7346501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346505">return</span>&nbsp;<span class="keyword" id="7346512">func</span><span class="op" id="7346516">(</span><span class="ident" id="7346517">rec</span>&nbsp;<span class="op" id="7346521">*</span><span class="ident" id="7346522">ResponseRecorder</span><span class="op" id="7346538">)</span>&nbsp;<span class="builtintype" id="7346540">error</span>&nbsp;<span class="op" id="7346546">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346551">if</span>&nbsp;<span class="ident" id="7346554">rec</span><span class="op" id="7346557">.</span><span class="ident" id="7346558">Flushed</span>&nbsp;<span class="op" id="7346566">!=</span>&nbsp;<span class="ident" id="7346569">want</span>&nbsp;<span class="op" id="7346574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346580">return</span>&nbsp;<span class="ident" id="7346587">fmt</span><span class="op" id="7346590">.</span><span class="ident" id="7346591">Errorf</span><span class="op" id="7346597">(</span><span class="string" id="7346598">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7346621">,</span>&nbsp;<span class="ident" id="7346623">rec</span><span class="op" id="7346626">.</span><span class="ident" id="7346627">Flushed</span><span class="op" id="7346634">,</span>&nbsp;<span class="ident" id="7346636">want</span><span class="op" id="7346640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346650">return</span>&nbsp;<span class="ident" id="7346657">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346663">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346670">tests</span>&nbsp;<span class="op" id="7346676">:=</span>&nbsp;<span class="op" id="7346679">[</span><span class="op" id="7346680">]</span><span class="keyword" id="7346681">struct</span>&nbsp;<span class="op" id="7346688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346692">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7346699">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346708">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7346715">func</span><span class="op" id="7346719">(</span><span class="ident" id="7346720">w</span>&nbsp;<span class="ident" id="7346722">http</span><span class="op" id="7346726">.</span><span class="ident" id="7346727">ResponseWriter</span><span class="op" id="7346741">,</span>&nbsp;<span class="ident" id="7346743">r</span>&nbsp;<span class="op" id="7346745">*</span><span class="ident" id="7346746">http</span><span class="op" id="7346750">.</span><span class="ident" id="7346751">Request</span><span class="op" id="7346758">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346762">checks</span>&nbsp;<span class="op" id="7346769">[</span><span class="op" id="7346770">]</span><span class="ident" id="7346771">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346782">}</span><span class="op" id="7346783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7346792">&#34;200&nbsp;default&#34;</span><span class="op" id="7346805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346810">func</span><span class="op" id="7346814">(</span><span class="ident" id="7346815">w</span>&nbsp;<span class="ident" id="7346817">http</span><span class="op" id="7346821">.</span><span class="ident" id="7346822">ResponseWriter</span><span class="op" id="7346836">,</span>&nbsp;<span class="ident" id="7346838">r</span>&nbsp;<span class="op" id="7346840">*</span><span class="ident" id="7346841">http</span><span class="op" id="7346845">.</span><span class="ident" id="7346846">Request</span><span class="op" id="7346853">)</span>&nbsp;<span class="op" id="7346855">{</span><span class="op" id="7346856">}</span><span class="op" id="7346857">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346862">check</span><span class="op" id="7346867">(</span><span class="ident" id="7346868">hasStatus</span><span class="op" id="7346877">(</span><span class="num" id="7346878">200</span><span class="op" id="7346881">)</span><span class="op" id="7346882">,</span>&nbsp;<span class="ident" id="7346884">hasContents</span><span class="op" id="7346895">(</span><span class="string" id="7346896">&#34;&#34;</span><span class="op" id="7346898">)</span><span class="op" id="7346899">)</span><span class="op" id="7346900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346904">}</span><span class="op" id="7346905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7346909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7346914">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="7346931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7346936">func</span><span class="op" id="7346940">(</span><span class="ident" id="7346941">w</span>&nbsp;<span class="ident" id="7346943">http</span><span class="op" id="7346947">.</span><span class="ident" id="7346948">ResponseWriter</span><span class="op" id="7346962">,</span>&nbsp;<span class="ident" id="7346964">r</span>&nbsp;<span class="op" id="7346966">*</span><span class="ident" id="7346967">http</span><span class="op" id="7346971">.</span><span class="ident" id="7346972">Request</span><span class="op" id="7346979">)</span>&nbsp;<span class="op" id="7346981">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7346987">w</span><span class="op" id="7346988">.</span><span class="ident" id="7346989">WriteHeader</span><span class="op" id="7347000">(</span><span class="num" id="7347001">201</span><span class="op" id="7347004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347010">w</span><span class="op" id="7347011">.</span><span class="ident" id="7347012">WriteHeader</span><span class="op" id="7347023">(</span><span class="num" id="7347024">202</span><span class="op" id="7347027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347033">w</span><span class="op" id="7347034">.</span><span class="ident" id="7347035">Write</span><span class="op" id="7347040">(</span><span class="op" id="7347041">[</span><span class="op" id="7347042">]</span><span class="builtintype" id="7347043">byte</span><span class="op" id="7347047">(</span><span class="string" id="7347048">&#34;hi&#34;</span><span class="op" id="7347052">)</span><span class="op" id="7347053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347058">}</span><span class="op" id="7347059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347064">check</span><span class="op" id="7347069">(</span><span class="ident" id="7347070">hasStatus</span><span class="op" id="7347079">(</span><span class="num" id="7347080">201</span><span class="op" id="7347083">)</span><span class="op" id="7347084">,</span>&nbsp;<span class="ident" id="7347086">hasContents</span><span class="op" id="7347097">(</span><span class="string" id="7347098">&#34;hi&#34;</span><span class="op" id="7347102">)</span><span class="op" id="7347103">)</span><span class="op" id="7347104">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347108">}</span><span class="op" id="7347109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347118">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="7347135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347140">func</span><span class="op" id="7347144">(</span><span class="ident" id="7347145">w</span>&nbsp;<span class="ident" id="7347147">http</span><span class="op" id="7347151">.</span><span class="ident" id="7347152">ResponseWriter</span><span class="op" id="7347166">,</span>&nbsp;<span class="ident" id="7347168">r</span>&nbsp;<span class="op" id="7347170">*</span><span class="ident" id="7347171">http</span><span class="op" id="7347175">.</span><span class="ident" id="7347176">Request</span><span class="op" id="7347183">)</span>&nbsp;<span class="op" id="7347185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347191">w</span><span class="op" id="7347192">.</span><span class="ident" id="7347193">Write</span><span class="op" id="7347198">(</span><span class="op" id="7347199">[</span><span class="op" id="7347200">]</span><span class="builtintype" id="7347201">byte</span><span class="op" id="7347205">(</span><span class="string" id="7347206">&#34;hi&nbsp;first&#34;</span><span class="op" id="7347216">)</span><span class="op" id="7347217">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347223">w</span><span class="op" id="7347224">.</span><span class="ident" id="7347225">WriteHeader</span><span class="op" id="7347236">(</span><span class="num" id="7347237">201</span><span class="op" id="7347240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347246">w</span><span class="op" id="7347247">.</span><span class="ident" id="7347248">WriteHeader</span><span class="op" id="7347259">(</span><span class="num" id="7347260">202</span><span class="op" id="7347263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347268">}</span><span class="op" id="7347269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347274">check</span><span class="op" id="7347279">(</span><span class="ident" id="7347280">hasStatus</span><span class="op" id="7347289">(</span><span class="num" id="7347290">200</span><span class="op" id="7347293">)</span><span class="op" id="7347294">,</span>&nbsp;<span class="ident" id="7347296">hasContents</span><span class="op" id="7347307">(</span><span class="string" id="7347308">&#34;hi&nbsp;first&#34;</span><span class="op" id="7347318">)</span><span class="op" id="7347319">,</span>&nbsp;<span class="ident" id="7347321">hasFlush</span><span class="op" id="7347329">(</span><span class="builtintype" id="7347330">false</span><span class="op" id="7347335">)</span><span class="op" id="7347336">)</span><span class="op" id="7347337">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347341">}</span><span class="op" id="7347342">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7347351">&#34;flush&#34;</span><span class="op" id="7347358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347363">func</span><span class="op" id="7347367">(</span><span class="ident" id="7347368">w</span>&nbsp;<span class="ident" id="7347370">http</span><span class="op" id="7347374">.</span><span class="ident" id="7347375">ResponseWriter</span><span class="op" id="7347389">,</span>&nbsp;<span class="ident" id="7347391">r</span>&nbsp;<span class="op" id="7347393">*</span><span class="ident" id="7347394">http</span><span class="op" id="7347398">.</span><span class="ident" id="7347399">Request</span><span class="op" id="7347406">)</span>&nbsp;<span class="op" id="7347408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347414">w</span><span class="op" id="7347415">.</span><span class="op" id="7347416">(</span><span class="ident" id="7347417">http</span><span class="op" id="7347421">.</span><span class="ident" id="7347422">Flusher</span><span class="op" id="7347429">)</span><span class="op" id="7347430">.</span><span class="ident" id="7347431">Flush</span><span class="op" id="7347436">(</span><span class="op" id="7347437">)</span>&nbsp;<span class="comment" id="7347439">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347463">w</span><span class="op" id="7347464">.</span><span class="ident" id="7347465">WriteHeader</span><span class="op" id="7347476">(</span><span class="num" id="7347477">201</span><span class="op" id="7347480">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347485">}</span><span class="op" id="7347486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347491">check</span><span class="op" id="7347496">(</span><span class="ident" id="7347497">hasStatus</span><span class="op" id="7347506">(</span><span class="num" id="7347507">200</span><span class="op" id="7347510">)</span><span class="op" id="7347511">,</span>&nbsp;<span class="ident" id="7347513">hasFlush</span><span class="op" id="7347521">(</span><span class="builtintype" id="7347522">true</span><span class="op" id="7347526">)</span><span class="op" id="7347527">)</span><span class="op" id="7347528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347532">}</span><span class="op" id="7347533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347539">r</span><span class="op" id="7347540">,</span>&nbsp;<span class="ident" id="7347542">_</span>&nbsp;<span class="op" id="7347544">:=</span>&nbsp;<span class="ident" id="7347547">http</span><span class="op" id="7347551">.</span><span class="ident" id="7347552">NewRequest</span><span class="op" id="7347562">(</span><span class="string" id="7347563">&#34;GET&#34;</span><span class="op" id="7347568">,</span>&nbsp;<span class="string" id="7347570">&#34;http://foo.com/&#34;</span><span class="op" id="7347587">,</span>&nbsp;<span class="ident" id="7347589">nil</span><span class="op" id="7347592">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347595">for</span>&nbsp;<span class="ident" id="7347599">_</span><span class="op" id="7347600">,</span>&nbsp;<span class="ident" id="7347602">tt</span>&nbsp;<span class="op" id="7347605">:=</span>&nbsp;<span class="keyword" id="7347608">range</span>&nbsp;<span class="ident" id="7347614">tests</span>&nbsp;<span class="op" id="7347620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347624">h</span>&nbsp;<span class="op" id="7347626">:=</span>&nbsp;<span class="ident" id="7347629">http</span><span class="op" id="7347633">.</span><span class="ident" id="7347634">HandlerFunc</span><span class="op" id="7347645">(</span><span class="ident" id="7347646">tt</span><span class="op" id="7347648">.</span><span class="ident" id="7347649">h</span><span class="op" id="7347650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347654">rec</span>&nbsp;<span class="op" id="7347658">:=</span>&nbsp;<span class="ident" id="7347661">NewRecorder</span><span class="op" id="7347672">(</span><span class="op" id="7347673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347677">h</span><span class="op" id="7347678">.</span><span class="ident" id="7347679">ServeHTTP</span><span class="op" id="7347688">(</span><span class="ident" id="7347689">rec</span><span class="op" id="7347692">,</span>&nbsp;<span class="ident" id="7347694">r</span><span class="op" id="7347695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347699">for</span>&nbsp;<span class="ident" id="7347703">_</span><span class="op" id="7347704">,</span>&nbsp;<span class="ident" id="7347706">check</span>&nbsp;<span class="op" id="7347712">:=</span>&nbsp;<span class="keyword" id="7347715">range</span>&nbsp;<span class="ident" id="7347721">tt</span><span class="op" id="7347723">.</span><span class="ident" id="7347724">checks</span>&nbsp;<span class="op" id="7347731">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7347736">if</span>&nbsp;<span class="ident" id="7347739">err</span>&nbsp;<span class="op" id="7347743">:=</span>&nbsp;<span class="ident" id="7347746">check</span><span class="op" id="7347751">(</span><span class="ident" id="7347752">rec</span><span class="op" id="7347755">)</span><span class="op" id="7347756">;</span>&nbsp;<span class="ident" id="7347758">err</span>&nbsp;<span class="op" id="7347762">!=</span>&nbsp;<span class="ident" id="7347765">nil</span>&nbsp;<span class="op" id="7347769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7347775">t</span><span class="op" id="7347776">.</span><span class="ident" id="7347777">Errorf</span><span class="op" id="7347783">(</span><span class="string" id="7347784">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7347792">,</span>&nbsp;<span class="ident" id="7347794">tt</span><span class="op" id="7347796">.</span><span class="ident" id="7347797">name</span><span class="op" id="7347801">,</span>&nbsp;<span class="ident" id="7347803">err</span><span class="op" id="7347806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7347818">}</span><br>
<span class="lineno">90</span><span class="op" id="7347820">}</span>
</div>
</body>
</html>
