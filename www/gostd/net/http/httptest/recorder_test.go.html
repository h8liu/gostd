<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6484340">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6484395">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6484449">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6484500">package</span>&nbsp;<span class="ident" id="6484508">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6484518">import</span>&nbsp;<span class="op" id="6484525">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6484528">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6484535">&#34;net/http&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6484547">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6484557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6484560">func</span>&nbsp;<span class="ident" id="6484565">TestRecorder</span><span class="op" id="6484577">(</span><span class="ident" id="6484578">t</span>&nbsp;<span class="op" id="6484580">*</span><span class="ident" id="6484581">testing</span><span class="op" id="6484588">.</span><span class="ident" id="6484589">T</span><span class="op" id="6484590">)</span>&nbsp;<span class="op" id="6484592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484595">type</span>&nbsp;<span class="ident" id="6484600">checkFunc</span>&nbsp;<span class="keyword" id="6484610">func</span><span class="op" id="6484614">(</span><span class="op" id="6484615">*</span><span class="ident" id="6484616">ResponseRecorder</span><span class="op" id="6484632">)</span>&nbsp;<span class="builtintype" id="6484634">error</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484641">check</span>&nbsp;<span class="op" id="6484647">:=</span>&nbsp;<span class="keyword" id="6484650">func</span><span class="op" id="6484654">(</span><span class="ident" id="6484655">fns</span>&nbsp;<span class="op" id="6484659">...</span><span class="ident" id="6484662">checkFunc</span><span class="op" id="6484671">)</span>&nbsp;<span class="op" id="6484673">[</span><span class="op" id="6484674">]</span><span class="ident" id="6484675">checkFunc</span>&nbsp;<span class="op" id="6484685">{</span>&nbsp;<span class="keyword" id="6484687">return</span>&nbsp;<span class="ident" id="6484694">fns</span>&nbsp;<span class="op" id="6484698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484702">hasStatus</span>&nbsp;<span class="op" id="6484712">:=</span>&nbsp;<span class="keyword" id="6484715">func</span><span class="op" id="6484719">(</span><span class="ident" id="6484720">wantCode</span>&nbsp;<span class="builtintype" id="6484729">int</span><span class="op" id="6484732">)</span>&nbsp;<span class="ident" id="6484734">checkFunc</span>&nbsp;<span class="op" id="6484744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484748">return</span>&nbsp;<span class="keyword" id="6484755">func</span><span class="op" id="6484759">(</span><span class="ident" id="6484760">rec</span>&nbsp;<span class="op" id="6484764">*</span><span class="ident" id="6484765">ResponseRecorder</span><span class="op" id="6484781">)</span>&nbsp;<span class="builtintype" id="6484783">error</span>&nbsp;<span class="op" id="6484789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484794">if</span>&nbsp;<span class="ident" id="6484797">rec</span><span class="op" id="6484800">.</span><span class="ident" id="6484801">Code</span>&nbsp;<span class="op" id="6484806">!=</span>&nbsp;<span class="ident" id="6484809">wantCode</span>&nbsp;<span class="op" id="6484818">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484824">return</span>&nbsp;<span class="ident" id="6484831">fmt</span><span class="op" id="6484834">.</span><span class="ident" id="6484835">Errorf</span><span class="op" id="6484841">(</span><span class="string" id="6484842">&#34;Status&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6484864">,</span>&nbsp;<span class="ident" id="6484866">rec</span><span class="op" id="6484869">.</span><span class="ident" id="6484870">Code</span><span class="op" id="6484874">,</span>&nbsp;<span class="ident" id="6484876">wantCode</span><span class="op" id="6484884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484894">return</span>&nbsp;<span class="ident" id="6484901">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6484910">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6484913">hasContents</span>&nbsp;<span class="op" id="6484925">:=</span>&nbsp;<span class="keyword" id="6484928">func</span><span class="op" id="6484932">(</span><span class="ident" id="6484933">want</span>&nbsp;<span class="builtintype" id="6484938">string</span><span class="op" id="6484944">)</span>&nbsp;<span class="ident" id="6484946">checkFunc</span>&nbsp;<span class="op" id="6484956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6484960">return</span>&nbsp;<span class="keyword" id="6484967">func</span><span class="op" id="6484971">(</span><span class="ident" id="6484972">rec</span>&nbsp;<span class="op" id="6484976">*</span><span class="ident" id="6484977">ResponseRecorder</span><span class="op" id="6484993">)</span>&nbsp;<span class="builtintype" id="6484995">error</span>&nbsp;<span class="op" id="6485001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485006">if</span>&nbsp;<span class="ident" id="6485009">rec</span><span class="op" id="6485012">.</span><span class="ident" id="6485013">Body</span><span class="op" id="6485017">.</span><span class="ident" id="6485018">String</span><span class="op" id="6485024">(</span><span class="op" id="6485025">)</span>&nbsp;<span class="op" id="6485027">!=</span>&nbsp;<span class="ident" id="6485030">want</span>&nbsp;<span class="op" id="6485035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485041">return</span>&nbsp;<span class="ident" id="6485048">fmt</span><span class="op" id="6485051">.</span><span class="ident" id="6485052">Errorf</span><span class="op" id="6485058">(</span><span class="string" id="6485059">&#34;wrote&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6485080">,</span>&nbsp;<span class="ident" id="6485082">rec</span><span class="op" id="6485085">.</span><span class="ident" id="6485086">Body</span><span class="op" id="6485090">.</span><span class="ident" id="6485091">String</span><span class="op" id="6485097">(</span><span class="op" id="6485098">)</span><span class="op" id="6485099">,</span>&nbsp;<span class="ident" id="6485101">want</span><span class="op" id="6485105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485110">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485115">return</span>&nbsp;<span class="ident" id="6485122">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485134">hasFlush</span>&nbsp;<span class="op" id="6485143">:=</span>&nbsp;<span class="keyword" id="6485146">func</span><span class="op" id="6485150">(</span><span class="ident" id="6485151">want</span>&nbsp;<span class="builtintype" id="6485156">bool</span><span class="op" id="6485160">)</span>&nbsp;<span class="ident" id="6485162">checkFunc</span>&nbsp;<span class="op" id="6485172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485176">return</span>&nbsp;<span class="keyword" id="6485183">func</span><span class="op" id="6485187">(</span><span class="ident" id="6485188">rec</span>&nbsp;<span class="op" id="6485192">*</span><span class="ident" id="6485193">ResponseRecorder</span><span class="op" id="6485209">)</span>&nbsp;<span class="builtintype" id="6485211">error</span>&nbsp;<span class="op" id="6485217">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485222">if</span>&nbsp;<span class="ident" id="6485225">rec</span><span class="op" id="6485228">.</span><span class="ident" id="6485229">Flushed</span>&nbsp;<span class="op" id="6485237">!=</span>&nbsp;<span class="ident" id="6485240">want</span>&nbsp;<span class="op" id="6485245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485251">return</span>&nbsp;<span class="ident" id="6485258">fmt</span><span class="op" id="6485261">.</span><span class="ident" id="6485262">Errorf</span><span class="op" id="6485268">(</span><span class="string" id="6485269">&#34;Flushed&nbsp;=&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6485292">,</span>&nbsp;<span class="ident" id="6485294">rec</span><span class="op" id="6485297">.</span><span class="ident" id="6485298">Flushed</span><span class="op" id="6485305">,</span>&nbsp;<span class="ident" id="6485307">want</span><span class="op" id="6485311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485321">return</span>&nbsp;<span class="ident" id="6485328">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485334">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485341">tests</span>&nbsp;<span class="op" id="6485347">:=</span>&nbsp;<span class="op" id="6485350">[</span><span class="op" id="6485351">]</span><span class="keyword" id="6485352">struct</span>&nbsp;<span class="op" id="6485359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485363">name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6485370">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485379">h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6485386">func</span><span class="op" id="6485390">(</span><span class="ident" id="6485391">w</span>&nbsp;<span class="ident" id="6485393">http</span><span class="op" id="6485397">.</span><span class="ident" id="6485398">ResponseWriter</span><span class="op" id="6485412">,</span>&nbsp;<span class="ident" id="6485414">r</span>&nbsp;<span class="op" id="6485416">*</span><span class="ident" id="6485417">http</span><span class="op" id="6485421">.</span><span class="ident" id="6485422">Request</span><span class="op" id="6485429">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485433">checks</span>&nbsp;<span class="op" id="6485440">[</span><span class="op" id="6485441">]</span><span class="ident" id="6485442">checkFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485453">}</span><span class="op" id="6485454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6485463">&#34;200&nbsp;default&#34;</span><span class="op" id="6485476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485481">func</span><span class="op" id="6485485">(</span><span class="ident" id="6485486">w</span>&nbsp;<span class="ident" id="6485488">http</span><span class="op" id="6485492">.</span><span class="ident" id="6485493">ResponseWriter</span><span class="op" id="6485507">,</span>&nbsp;<span class="ident" id="6485509">r</span>&nbsp;<span class="op" id="6485511">*</span><span class="ident" id="6485512">http</span><span class="op" id="6485516">.</span><span class="ident" id="6485517">Request</span><span class="op" id="6485524">)</span>&nbsp;<span class="op" id="6485526">{</span><span class="op" id="6485527">}</span><span class="op" id="6485528">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485533">check</span><span class="op" id="6485538">(</span><span class="ident" id="6485539">hasStatus</span><span class="op" id="6485548">(</span><span class="num" id="6485549">200</span><span class="op" id="6485552">)</span><span class="op" id="6485553">,</span>&nbsp;<span class="ident" id="6485555">hasContents</span><span class="op" id="6485566">(</span><span class="string" id="6485567">&#34;&#34;</span><span class="op" id="6485569">)</span><span class="op" id="6485570">)</span><span class="op" id="6485571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485575">}</span><span class="op" id="6485576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6485585">&#34;first&nbsp;code&nbsp;only&#34;</span><span class="op" id="6485602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485607">func</span><span class="op" id="6485611">(</span><span class="ident" id="6485612">w</span>&nbsp;<span class="ident" id="6485614">http</span><span class="op" id="6485618">.</span><span class="ident" id="6485619">ResponseWriter</span><span class="op" id="6485633">,</span>&nbsp;<span class="ident" id="6485635">r</span>&nbsp;<span class="op" id="6485637">*</span><span class="ident" id="6485638">http</span><span class="op" id="6485642">.</span><span class="ident" id="6485643">Request</span><span class="op" id="6485650">)</span>&nbsp;<span class="op" id="6485652">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485658">w</span><span class="op" id="6485659">.</span><span class="ident" id="6485660">WriteHeader</span><span class="op" id="6485671">(</span><span class="num" id="6485672">201</span><span class="op" id="6485675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485681">w</span><span class="op" id="6485682">.</span><span class="ident" id="6485683">WriteHeader</span><span class="op" id="6485694">(</span><span class="num" id="6485695">202</span><span class="op" id="6485698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485704">w</span><span class="op" id="6485705">.</span><span class="ident" id="6485706">Write</span><span class="op" id="6485711">(</span><span class="op" id="6485712">[</span><span class="op" id="6485713">]</span><span class="builtintype" id="6485714">byte</span><span class="op" id="6485718">(</span><span class="string" id="6485719">&#34;hi&#34;</span><span class="op" id="6485723">)</span><span class="op" id="6485724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485729">}</span><span class="op" id="6485730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485735">check</span><span class="op" id="6485740">(</span><span class="ident" id="6485741">hasStatus</span><span class="op" id="6485750">(</span><span class="num" id="6485751">201</span><span class="op" id="6485754">)</span><span class="op" id="6485755">,</span>&nbsp;<span class="ident" id="6485757">hasContents</span><span class="op" id="6485768">(</span><span class="string" id="6485769">&#34;hi&#34;</span><span class="op" id="6485773">)</span><span class="op" id="6485774">)</span><span class="op" id="6485775">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485779">}</span><span class="op" id="6485780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6485789">&#34;write&nbsp;sends&nbsp;200&#34;</span><span class="op" id="6485806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6485811">func</span><span class="op" id="6485815">(</span><span class="ident" id="6485816">w</span>&nbsp;<span class="ident" id="6485818">http</span><span class="op" id="6485822">.</span><span class="ident" id="6485823">ResponseWriter</span><span class="op" id="6485837">,</span>&nbsp;<span class="ident" id="6485839">r</span>&nbsp;<span class="op" id="6485841">*</span><span class="ident" id="6485842">http</span><span class="op" id="6485846">.</span><span class="ident" id="6485847">Request</span><span class="op" id="6485854">)</span>&nbsp;<span class="op" id="6485856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485862">w</span><span class="op" id="6485863">.</span><span class="ident" id="6485864">Write</span><span class="op" id="6485869">(</span><span class="op" id="6485870">[</span><span class="op" id="6485871">]</span><span class="builtintype" id="6485872">byte</span><span class="op" id="6485876">(</span><span class="string" id="6485877">&#34;hi&nbsp;first&#34;</span><span class="op" id="6485887">)</span><span class="op" id="6485888">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485894">w</span><span class="op" id="6485895">.</span><span class="ident" id="6485896">WriteHeader</span><span class="op" id="6485907">(</span><span class="num" id="6485908">201</span><span class="op" id="6485911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485917">w</span><span class="op" id="6485918">.</span><span class="ident" id="6485919">WriteHeader</span><span class="op" id="6485930">(</span><span class="num" id="6485931">202</span><span class="op" id="6485934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6485939">}</span><span class="op" id="6485940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6485945">check</span><span class="op" id="6485950">(</span><span class="ident" id="6485951">hasStatus</span><span class="op" id="6485960">(</span><span class="num" id="6485961">200</span><span class="op" id="6485964">)</span><span class="op" id="6485965">,</span>&nbsp;<span class="ident" id="6485967">hasContents</span><span class="op" id="6485978">(</span><span class="string" id="6485979">&#34;hi&nbsp;first&#34;</span><span class="op" id="6485989">)</span><span class="op" id="6485990">,</span>&nbsp;<span class="ident" id="6485992">hasFlush</span><span class="op" id="6486000">(</span><span class="builtintype" id="6486001">false</span><span class="op" id="6486006">)</span><span class="op" id="6486007">)</span><span class="op" id="6486008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486012">}</span><span class="op" id="6486013">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6486022">&#34;flush&#34;</span><span class="op" id="6486029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6486034">func</span><span class="op" id="6486038">(</span><span class="ident" id="6486039">w</span>&nbsp;<span class="ident" id="6486041">http</span><span class="op" id="6486045">.</span><span class="ident" id="6486046">ResponseWriter</span><span class="op" id="6486060">,</span>&nbsp;<span class="ident" id="6486062">r</span>&nbsp;<span class="op" id="6486064">*</span><span class="ident" id="6486065">http</span><span class="op" id="6486069">.</span><span class="ident" id="6486070">Request</span><span class="op" id="6486077">)</span>&nbsp;<span class="op" id="6486079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486085">w</span><span class="op" id="6486086">.</span><span class="op" id="6486087">(</span><span class="ident" id="6486088">http</span><span class="op" id="6486092">.</span><span class="ident" id="6486093">Flusher</span><span class="op" id="6486100">)</span><span class="op" id="6486101">.</span><span class="ident" id="6486102">Flush</span><span class="op" id="6486107">(</span><span class="op" id="6486108">)</span>&nbsp;<span class="comment" id="6486110">//&nbsp;also&nbsp;sends&nbsp;a&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486134">w</span><span class="op" id="6486135">.</span><span class="ident" id="6486136">WriteHeader</span><span class="op" id="6486147">(</span><span class="num" id="6486148">201</span><span class="op" id="6486151">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486156">}</span><span class="op" id="6486157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486162">check</span><span class="op" id="6486167">(</span><span class="ident" id="6486168">hasStatus</span><span class="op" id="6486177">(</span><span class="num" id="6486178">200</span><span class="op" id="6486181">)</span><span class="op" id="6486182">,</span>&nbsp;<span class="ident" id="6486184">hasFlush</span><span class="op" id="6486192">(</span><span class="builtintype" id="6486193">true</span><span class="op" id="6486197">)</span><span class="op" id="6486198">)</span><span class="op" id="6486199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486203">}</span><span class="op" id="6486204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486210">r</span><span class="op" id="6486211">,</span>&nbsp;<span class="ident" id="6486213">_</span>&nbsp;<span class="op" id="6486215">:=</span>&nbsp;<span class="ident" id="6486218">http</span><span class="op" id="6486222">.</span><span class="ident" id="6486223">NewRequest</span><span class="op" id="6486233">(</span><span class="string" id="6486234">&#34;GET&#34;</span><span class="op" id="6486239">,</span>&nbsp;<span class="string" id="6486241">&#34;http://foo.com/&#34;</span><span class="op" id="6486258">,</span>&nbsp;<span class="ident" id="6486260">nil</span><span class="op" id="6486263">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6486266">for</span>&nbsp;<span class="ident" id="6486270">_</span><span class="op" id="6486271">,</span>&nbsp;<span class="ident" id="6486273">tt</span>&nbsp;<span class="op" id="6486276">:=</span>&nbsp;<span class="keyword" id="6486279">range</span>&nbsp;<span class="ident" id="6486285">tests</span>&nbsp;<span class="op" id="6486291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486295">h</span>&nbsp;<span class="op" id="6486297">:=</span>&nbsp;<span class="ident" id="6486300">http</span><span class="op" id="6486304">.</span><span class="ident" id="6486305">HandlerFunc</span><span class="op" id="6486316">(</span><span class="ident" id="6486317">tt</span><span class="op" id="6486319">.</span><span class="ident" id="6486320">h</span><span class="op" id="6486321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486325">rec</span>&nbsp;<span class="op" id="6486329">:=</span>&nbsp;<span class="ident" id="6486332">NewRecorder</span><span class="op" id="6486343">(</span><span class="op" id="6486344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486348">h</span><span class="op" id="6486349">.</span><span class="ident" id="6486350">ServeHTTP</span><span class="op" id="6486359">(</span><span class="ident" id="6486360">rec</span><span class="op" id="6486363">,</span>&nbsp;<span class="ident" id="6486365">r</span><span class="op" id="6486366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6486370">for</span>&nbsp;<span class="ident" id="6486374">_</span><span class="op" id="6486375">,</span>&nbsp;<span class="ident" id="6486377">check</span>&nbsp;<span class="op" id="6486383">:=</span>&nbsp;<span class="keyword" id="6486386">range</span>&nbsp;<span class="ident" id="6486392">tt</span><span class="op" id="6486394">.</span><span class="ident" id="6486395">checks</span>&nbsp;<span class="op" id="6486402">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6486407">if</span>&nbsp;<span class="ident" id="6486410">err</span>&nbsp;<span class="op" id="6486414">:=</span>&nbsp;<span class="ident" id="6486417">check</span><span class="op" id="6486422">(</span><span class="ident" id="6486423">rec</span><span class="op" id="6486426">)</span><span class="op" id="6486427">;</span>&nbsp;<span class="ident" id="6486429">err</span>&nbsp;<span class="op" id="6486433">!=</span>&nbsp;<span class="ident" id="6486436">nil</span>&nbsp;<span class="op" id="6486440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6486446">t</span><span class="op" id="6486447">.</span><span class="ident" id="6486448">Errorf</span><span class="op" id="6486454">(</span><span class="string" id="6486455">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6486463">,</span>&nbsp;<span class="ident" id="6486465">tt</span><span class="op" id="6486467">.</span><span class="ident" id="6486468">name</span><span class="op" id="6486472">,</span>&nbsp;<span class="ident" id="6486474">err</span><span class="op" id="6486477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6486489">}</span><br>
<span class="lineno">90</span><span class="op" id="6486491">}</span>
</div>
</body>
</html>
