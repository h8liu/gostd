<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5966039">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5966094">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5966148">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5966199">package</span>&nbsp;<span class="ident" id="5966207">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5966213">import</span>&nbsp;<span class="op" id="5966220">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966223">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966232">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966242">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966251">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5966266">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5966271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5966274">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="5966318">func</span>&nbsp;<span class="ident" id="5966323">min</span><span class="op" id="5966326">(</span><span class="ident" id="5966327">x</span><span class="op" id="5966328">,</span>&nbsp;<span class="ident" id="5966330">y</span>&nbsp;<span class="builtintype" id="5966332">int</span><span class="op" id="5966335">)</span>&nbsp;<span class="builtintype" id="5966337">int</span>&nbsp;<span class="op" id="5966341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966344">if</span>&nbsp;<span class="ident" id="5966347">x</span>&nbsp;<span class="op" id="5966349">&lt;</span>&nbsp;<span class="ident" id="5966351">y</span>&nbsp;<span class="op" id="5966353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966357">return</span>&nbsp;<span class="ident" id="5966364">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966367">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966370">return</span>&nbsp;<span class="ident" id="5966377">y</span><br>
<span class="lineno"></span><span class="op" id="5966379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5966382">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="5966461">func</span>&nbsp;<span class="ident" id="5966466">div</span><span class="op" id="5966469">(</span><span class="ident" id="5966470">a</span><span class="op" id="5966471">,</span>&nbsp;<span class="ident" id="5966473">b</span>&nbsp;<span class="builtintype" id="5966475">int32</span><span class="op" id="5966480">)</span>&nbsp;<span class="builtintype" id="5966482">int32</span>&nbsp;<span class="op" id="5966488">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966491">if</span>&nbsp;<span class="ident" id="5966494">a</span>&nbsp;<span class="op" id="5966496">&gt;=</span>&nbsp;<span class="num" id="5966499">0</span>&nbsp;<span class="op" id="5966501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966505">return</span>&nbsp;<span class="op" id="5966512">(</span><span class="ident" id="5966513">a</span>&nbsp;<span class="op" id="5966515">+</span>&nbsp;<span class="op" id="5966517">(</span><span class="ident" id="5966518">b</span>&nbsp;<span class="op" id="5966520">&gt;&gt;</span>&nbsp;<span class="num" id="5966523">1</span><span class="op" id="5966524">)</span><span class="op" id="5966525">)</span>&nbsp;<span class="op" id="5966527">/</span>&nbsp;<span class="ident" id="5966529">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5966532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5966535">return</span>&nbsp;<span class="op" id="5966542">-</span><span class="op" id="5966543">(</span><span class="op" id="5966544">(</span><span class="op" id="5966545">-</span><span class="ident" id="5966546">a</span>&nbsp;<span class="op" id="5966548">+</span>&nbsp;<span class="op" id="5966550">(</span><span class="ident" id="5966551">b</span>&nbsp;<span class="op" id="5966553">&gt;&gt;</span>&nbsp;<span class="num" id="5966556">1</span><span class="op" id="5966557">)</span><span class="op" id="5966558">)</span>&nbsp;<span class="op" id="5966560">/</span>&nbsp;<span class="ident" id="5966562">b</span><span class="op" id="5966563">)</span><br>
<span class="lineno"></span><span class="op" id="5966565">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5966568">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5966633">var</span>&nbsp;<span class="ident" id="5966637">bitCount</span>&nbsp;<span class="op" id="5966646">=</span>&nbsp;<span class="op" id="5966648">[</span><span class="num" id="5966649">256</span><span class="op" id="5966652">]</span><span class="builtintype" id="5966653">byte</span><span class="op" id="5966657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966660">0</span><span class="op" id="5966661">,</span>&nbsp;<span class="num" id="5966663">1</span><span class="op" id="5966664">,</span>&nbsp;<span class="num" id="5966666">2</span><span class="op" id="5966667">,</span>&nbsp;<span class="num" id="5966669">2</span><span class="op" id="5966670">,</span>&nbsp;<span class="num" id="5966672">3</span><span class="op" id="5966673">,</span>&nbsp;<span class="num" id="5966675">3</span><span class="op" id="5966676">,</span>&nbsp;<span class="num" id="5966678">3</span><span class="op" id="5966679">,</span>&nbsp;<span class="num" id="5966681">3</span><span class="op" id="5966682">,</span>&nbsp;<span class="num" id="5966684">4</span><span class="op" id="5966685">,</span>&nbsp;<span class="num" id="5966687">4</span><span class="op" id="5966688">,</span>&nbsp;<span class="num" id="5966690">4</span><span class="op" id="5966691">,</span>&nbsp;<span class="num" id="5966693">4</span><span class="op" id="5966694">,</span>&nbsp;<span class="num" id="5966696">4</span><span class="op" id="5966697">,</span>&nbsp;<span class="num" id="5966699">4</span><span class="op" id="5966700">,</span>&nbsp;<span class="num" id="5966702">4</span><span class="op" id="5966703">,</span>&nbsp;<span class="num" id="5966705">4</span><span class="op" id="5966706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966709">5</span><span class="op" id="5966710">,</span>&nbsp;<span class="num" id="5966712">5</span><span class="op" id="5966713">,</span>&nbsp;<span class="num" id="5966715">5</span><span class="op" id="5966716">,</span>&nbsp;<span class="num" id="5966718">5</span><span class="op" id="5966719">,</span>&nbsp;<span class="num" id="5966721">5</span><span class="op" id="5966722">,</span>&nbsp;<span class="num" id="5966724">5</span><span class="op" id="5966725">,</span>&nbsp;<span class="num" id="5966727">5</span><span class="op" id="5966728">,</span>&nbsp;<span class="num" id="5966730">5</span><span class="op" id="5966731">,</span>&nbsp;<span class="num" id="5966733">5</span><span class="op" id="5966734">,</span>&nbsp;<span class="num" id="5966736">5</span><span class="op" id="5966737">,</span>&nbsp;<span class="num" id="5966739">5</span><span class="op" id="5966740">,</span>&nbsp;<span class="num" id="5966742">5</span><span class="op" id="5966743">,</span>&nbsp;<span class="num" id="5966745">5</span><span class="op" id="5966746">,</span>&nbsp;<span class="num" id="5966748">5</span><span class="op" id="5966749">,</span>&nbsp;<span class="num" id="5966751">5</span><span class="op" id="5966752">,</span>&nbsp;<span class="num" id="5966754">5</span><span class="op" id="5966755">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966758">6</span><span class="op" id="5966759">,</span>&nbsp;<span class="num" id="5966761">6</span><span class="op" id="5966762">,</span>&nbsp;<span class="num" id="5966764">6</span><span class="op" id="5966765">,</span>&nbsp;<span class="num" id="5966767">6</span><span class="op" id="5966768">,</span>&nbsp;<span class="num" id="5966770">6</span><span class="op" id="5966771">,</span>&nbsp;<span class="num" id="5966773">6</span><span class="op" id="5966774">,</span>&nbsp;<span class="num" id="5966776">6</span><span class="op" id="5966777">,</span>&nbsp;<span class="num" id="5966779">6</span><span class="op" id="5966780">,</span>&nbsp;<span class="num" id="5966782">6</span><span class="op" id="5966783">,</span>&nbsp;<span class="num" id="5966785">6</span><span class="op" id="5966786">,</span>&nbsp;<span class="num" id="5966788">6</span><span class="op" id="5966789">,</span>&nbsp;<span class="num" id="5966791">6</span><span class="op" id="5966792">,</span>&nbsp;<span class="num" id="5966794">6</span><span class="op" id="5966795">,</span>&nbsp;<span class="num" id="5966797">6</span><span class="op" id="5966798">,</span>&nbsp;<span class="num" id="5966800">6</span><span class="op" id="5966801">,</span>&nbsp;<span class="num" id="5966803">6</span><span class="op" id="5966804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966807">6</span><span class="op" id="5966808">,</span>&nbsp;<span class="num" id="5966810">6</span><span class="op" id="5966811">,</span>&nbsp;<span class="num" id="5966813">6</span><span class="op" id="5966814">,</span>&nbsp;<span class="num" id="5966816">6</span><span class="op" id="5966817">,</span>&nbsp;<span class="num" id="5966819">6</span><span class="op" id="5966820">,</span>&nbsp;<span class="num" id="5966822">6</span><span class="op" id="5966823">,</span>&nbsp;<span class="num" id="5966825">6</span><span class="op" id="5966826">,</span>&nbsp;<span class="num" id="5966828">6</span><span class="op" id="5966829">,</span>&nbsp;<span class="num" id="5966831">6</span><span class="op" id="5966832">,</span>&nbsp;<span class="num" id="5966834">6</span><span class="op" id="5966835">,</span>&nbsp;<span class="num" id="5966837">6</span><span class="op" id="5966838">,</span>&nbsp;<span class="num" id="5966840">6</span><span class="op" id="5966841">,</span>&nbsp;<span class="num" id="5966843">6</span><span class="op" id="5966844">,</span>&nbsp;<span class="num" id="5966846">6</span><span class="op" id="5966847">,</span>&nbsp;<span class="num" id="5966849">6</span><span class="op" id="5966850">,</span>&nbsp;<span class="num" id="5966852">6</span><span class="op" id="5966853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966856">7</span><span class="op" id="5966857">,</span>&nbsp;<span class="num" id="5966859">7</span><span class="op" id="5966860">,</span>&nbsp;<span class="num" id="5966862">7</span><span class="op" id="5966863">,</span>&nbsp;<span class="num" id="5966865">7</span><span class="op" id="5966866">,</span>&nbsp;<span class="num" id="5966868">7</span><span class="op" id="5966869">,</span>&nbsp;<span class="num" id="5966871">7</span><span class="op" id="5966872">,</span>&nbsp;<span class="num" id="5966874">7</span><span class="op" id="5966875">,</span>&nbsp;<span class="num" id="5966877">7</span><span class="op" id="5966878">,</span>&nbsp;<span class="num" id="5966880">7</span><span class="op" id="5966881">,</span>&nbsp;<span class="num" id="5966883">7</span><span class="op" id="5966884">,</span>&nbsp;<span class="num" id="5966886">7</span><span class="op" id="5966887">,</span>&nbsp;<span class="num" id="5966889">7</span><span class="op" id="5966890">,</span>&nbsp;<span class="num" id="5966892">7</span><span class="op" id="5966893">,</span>&nbsp;<span class="num" id="5966895">7</span><span class="op" id="5966896">,</span>&nbsp;<span class="num" id="5966898">7</span><span class="op" id="5966899">,</span>&nbsp;<span class="num" id="5966901">7</span><span class="op" id="5966902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966905">7</span><span class="op" id="5966906">,</span>&nbsp;<span class="num" id="5966908">7</span><span class="op" id="5966909">,</span>&nbsp;<span class="num" id="5966911">7</span><span class="op" id="5966912">,</span>&nbsp;<span class="num" id="5966914">7</span><span class="op" id="5966915">,</span>&nbsp;<span class="num" id="5966917">7</span><span class="op" id="5966918">,</span>&nbsp;<span class="num" id="5966920">7</span><span class="op" id="5966921">,</span>&nbsp;<span class="num" id="5966923">7</span><span class="op" id="5966924">,</span>&nbsp;<span class="num" id="5966926">7</span><span class="op" id="5966927">,</span>&nbsp;<span class="num" id="5966929">7</span><span class="op" id="5966930">,</span>&nbsp;<span class="num" id="5966932">7</span><span class="op" id="5966933">,</span>&nbsp;<span class="num" id="5966935">7</span><span class="op" id="5966936">,</span>&nbsp;<span class="num" id="5966938">7</span><span class="op" id="5966939">,</span>&nbsp;<span class="num" id="5966941">7</span><span class="op" id="5966942">,</span>&nbsp;<span class="num" id="5966944">7</span><span class="op" id="5966945">,</span>&nbsp;<span class="num" id="5966947">7</span><span class="op" id="5966948">,</span>&nbsp;<span class="num" id="5966950">7</span><span class="op" id="5966951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5966954">7</span><span class="op" id="5966955">,</span>&nbsp;<span class="num" id="5966957">7</span><span class="op" id="5966958">,</span>&nbsp;<span class="num" id="5966960">7</span><span class="op" id="5966961">,</span>&nbsp;<span class="num" id="5966963">7</span><span class="op" id="5966964">,</span>&nbsp;<span class="num" id="5966966">7</span><span class="op" id="5966967">,</span>&nbsp;<span class="num" id="5966969">7</span><span class="op" id="5966970">,</span>&nbsp;<span class="num" id="5966972">7</span><span class="op" id="5966973">,</span>&nbsp;<span class="num" id="5966975">7</span><span class="op" id="5966976">,</span>&nbsp;<span class="num" id="5966978">7</span><span class="op" id="5966979">,</span>&nbsp;<span class="num" id="5966981">7</span><span class="op" id="5966982">,</span>&nbsp;<span class="num" id="5966984">7</span><span class="op" id="5966985">,</span>&nbsp;<span class="num" id="5966987">7</span><span class="op" id="5966988">,</span>&nbsp;<span class="num" id="5966990">7</span><span class="op" id="5966991">,</span>&nbsp;<span class="num" id="5966993">7</span><span class="op" id="5966994">,</span>&nbsp;<span class="num" id="5966996">7</span><span class="op" id="5966997">,</span>&nbsp;<span class="num" id="5966999">7</span><span class="op" id="5967000">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967003">7</span><span class="op" id="5967004">,</span>&nbsp;<span class="num" id="5967006">7</span><span class="op" id="5967007">,</span>&nbsp;<span class="num" id="5967009">7</span><span class="op" id="5967010">,</span>&nbsp;<span class="num" id="5967012">7</span><span class="op" id="5967013">,</span>&nbsp;<span class="num" id="5967015">7</span><span class="op" id="5967016">,</span>&nbsp;<span class="num" id="5967018">7</span><span class="op" id="5967019">,</span>&nbsp;<span class="num" id="5967021">7</span><span class="op" id="5967022">,</span>&nbsp;<span class="num" id="5967024">7</span><span class="op" id="5967025">,</span>&nbsp;<span class="num" id="5967027">7</span><span class="op" id="5967028">,</span>&nbsp;<span class="num" id="5967030">7</span><span class="op" id="5967031">,</span>&nbsp;<span class="num" id="5967033">7</span><span class="op" id="5967034">,</span>&nbsp;<span class="num" id="5967036">7</span><span class="op" id="5967037">,</span>&nbsp;<span class="num" id="5967039">7</span><span class="op" id="5967040">,</span>&nbsp;<span class="num" id="5967042">7</span><span class="op" id="5967043">,</span>&nbsp;<span class="num" id="5967045">7</span><span class="op" id="5967046">,</span>&nbsp;<span class="num" id="5967048">7</span><span class="op" id="5967049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967052">8</span><span class="op" id="5967053">,</span>&nbsp;<span class="num" id="5967055">8</span><span class="op" id="5967056">,</span>&nbsp;<span class="num" id="5967058">8</span><span class="op" id="5967059">,</span>&nbsp;<span class="num" id="5967061">8</span><span class="op" id="5967062">,</span>&nbsp;<span class="num" id="5967064">8</span><span class="op" id="5967065">,</span>&nbsp;<span class="num" id="5967067">8</span><span class="op" id="5967068">,</span>&nbsp;<span class="num" id="5967070">8</span><span class="op" id="5967071">,</span>&nbsp;<span class="num" id="5967073">8</span><span class="op" id="5967074">,</span>&nbsp;<span class="num" id="5967076">8</span><span class="op" id="5967077">,</span>&nbsp;<span class="num" id="5967079">8</span><span class="op" id="5967080">,</span>&nbsp;<span class="num" id="5967082">8</span><span class="op" id="5967083">,</span>&nbsp;<span class="num" id="5967085">8</span><span class="op" id="5967086">,</span>&nbsp;<span class="num" id="5967088">8</span><span class="op" id="5967089">,</span>&nbsp;<span class="num" id="5967091">8</span><span class="op" id="5967092">,</span>&nbsp;<span class="num" id="5967094">8</span><span class="op" id="5967095">,</span>&nbsp;<span class="num" id="5967097">8</span><span class="op" id="5967098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967101">8</span><span class="op" id="5967102">,</span>&nbsp;<span class="num" id="5967104">8</span><span class="op" id="5967105">,</span>&nbsp;<span class="num" id="5967107">8</span><span class="op" id="5967108">,</span>&nbsp;<span class="num" id="5967110">8</span><span class="op" id="5967111">,</span>&nbsp;<span class="num" id="5967113">8</span><span class="op" id="5967114">,</span>&nbsp;<span class="num" id="5967116">8</span><span class="op" id="5967117">,</span>&nbsp;<span class="num" id="5967119">8</span><span class="op" id="5967120">,</span>&nbsp;<span class="num" id="5967122">8</span><span class="op" id="5967123">,</span>&nbsp;<span class="num" id="5967125">8</span><span class="op" id="5967126">,</span>&nbsp;<span class="num" id="5967128">8</span><span class="op" id="5967129">,</span>&nbsp;<span class="num" id="5967131">8</span><span class="op" id="5967132">,</span>&nbsp;<span class="num" id="5967134">8</span><span class="op" id="5967135">,</span>&nbsp;<span class="num" id="5967137">8</span><span class="op" id="5967138">,</span>&nbsp;<span class="num" id="5967140">8</span><span class="op" id="5967141">,</span>&nbsp;<span class="num" id="5967143">8</span><span class="op" id="5967144">,</span>&nbsp;<span class="num" id="5967146">8</span><span class="op" id="5967147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967150">8</span><span class="op" id="5967151">,</span>&nbsp;<span class="num" id="5967153">8</span><span class="op" id="5967154">,</span>&nbsp;<span class="num" id="5967156">8</span><span class="op" id="5967157">,</span>&nbsp;<span class="num" id="5967159">8</span><span class="op" id="5967160">,</span>&nbsp;<span class="num" id="5967162">8</span><span class="op" id="5967163">,</span>&nbsp;<span class="num" id="5967165">8</span><span class="op" id="5967166">,</span>&nbsp;<span class="num" id="5967168">8</span><span class="op" id="5967169">,</span>&nbsp;<span class="num" id="5967171">8</span><span class="op" id="5967172">,</span>&nbsp;<span class="num" id="5967174">8</span><span class="op" id="5967175">,</span>&nbsp;<span class="num" id="5967177">8</span><span class="op" id="5967178">,</span>&nbsp;<span class="num" id="5967180">8</span><span class="op" id="5967181">,</span>&nbsp;<span class="num" id="5967183">8</span><span class="op" id="5967184">,</span>&nbsp;<span class="num" id="5967186">8</span><span class="op" id="5967187">,</span>&nbsp;<span class="num" id="5967189">8</span><span class="op" id="5967190">,</span>&nbsp;<span class="num" id="5967192">8</span><span class="op" id="5967193">,</span>&nbsp;<span class="num" id="5967195">8</span><span class="op" id="5967196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967199">8</span><span class="op" id="5967200">,</span>&nbsp;<span class="num" id="5967202">8</span><span class="op" id="5967203">,</span>&nbsp;<span class="num" id="5967205">8</span><span class="op" id="5967206">,</span>&nbsp;<span class="num" id="5967208">8</span><span class="op" id="5967209">,</span>&nbsp;<span class="num" id="5967211">8</span><span class="op" id="5967212">,</span>&nbsp;<span class="num" id="5967214">8</span><span class="op" id="5967215">,</span>&nbsp;<span class="num" id="5967217">8</span><span class="op" id="5967218">,</span>&nbsp;<span class="num" id="5967220">8</span><span class="op" id="5967221">,</span>&nbsp;<span class="num" id="5967223">8</span><span class="op" id="5967224">,</span>&nbsp;<span class="num" id="5967226">8</span><span class="op" id="5967227">,</span>&nbsp;<span class="num" id="5967229">8</span><span class="op" id="5967230">,</span>&nbsp;<span class="num" id="5967232">8</span><span class="op" id="5967233">,</span>&nbsp;<span class="num" id="5967235">8</span><span class="op" id="5967236">,</span>&nbsp;<span class="num" id="5967238">8</span><span class="op" id="5967239">,</span>&nbsp;<span class="num" id="5967241">8</span><span class="op" id="5967242">,</span>&nbsp;<span class="num" id="5967244">8</span><span class="op" id="5967245">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967248">8</span><span class="op" id="5967249">,</span>&nbsp;<span class="num" id="5967251">8</span><span class="op" id="5967252">,</span>&nbsp;<span class="num" id="5967254">8</span><span class="op" id="5967255">,</span>&nbsp;<span class="num" id="5967257">8</span><span class="op" id="5967258">,</span>&nbsp;<span class="num" id="5967260">8</span><span class="op" id="5967261">,</span>&nbsp;<span class="num" id="5967263">8</span><span class="op" id="5967264">,</span>&nbsp;<span class="num" id="5967266">8</span><span class="op" id="5967267">,</span>&nbsp;<span class="num" id="5967269">8</span><span class="op" id="5967270">,</span>&nbsp;<span class="num" id="5967272">8</span><span class="op" id="5967273">,</span>&nbsp;<span class="num" id="5967275">8</span><span class="op" id="5967276">,</span>&nbsp;<span class="num" id="5967278">8</span><span class="op" id="5967279">,</span>&nbsp;<span class="num" id="5967281">8</span><span class="op" id="5967282">,</span>&nbsp;<span class="num" id="5967284">8</span><span class="op" id="5967285">,</span>&nbsp;<span class="num" id="5967287">8</span><span class="op" id="5967288">,</span>&nbsp;<span class="num" id="5967290">8</span><span class="op" id="5967291">,</span>&nbsp;<span class="num" id="5967293">8</span><span class="op" id="5967294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967297">8</span><span class="op" id="5967298">,</span>&nbsp;<span class="num" id="5967300">8</span><span class="op" id="5967301">,</span>&nbsp;<span class="num" id="5967303">8</span><span class="op" id="5967304">,</span>&nbsp;<span class="num" id="5967306">8</span><span class="op" id="5967307">,</span>&nbsp;<span class="num" id="5967309">8</span><span class="op" id="5967310">,</span>&nbsp;<span class="num" id="5967312">8</span><span class="op" id="5967313">,</span>&nbsp;<span class="num" id="5967315">8</span><span class="op" id="5967316">,</span>&nbsp;<span class="num" id="5967318">8</span><span class="op" id="5967319">,</span>&nbsp;<span class="num" id="5967321">8</span><span class="op" id="5967322">,</span>&nbsp;<span class="num" id="5967324">8</span><span class="op" id="5967325">,</span>&nbsp;<span class="num" id="5967327">8</span><span class="op" id="5967328">,</span>&nbsp;<span class="num" id="5967330">8</span><span class="op" id="5967331">,</span>&nbsp;<span class="num" id="5967333">8</span><span class="op" id="5967334">,</span>&nbsp;<span class="num" id="5967336">8</span><span class="op" id="5967337">,</span>&nbsp;<span class="num" id="5967339">8</span><span class="op" id="5967340">,</span>&nbsp;<span class="num" id="5967342">8</span><span class="op" id="5967343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967346">8</span><span class="op" id="5967347">,</span>&nbsp;<span class="num" id="5967349">8</span><span class="op" id="5967350">,</span>&nbsp;<span class="num" id="5967352">8</span><span class="op" id="5967353">,</span>&nbsp;<span class="num" id="5967355">8</span><span class="op" id="5967356">,</span>&nbsp;<span class="num" id="5967358">8</span><span class="op" id="5967359">,</span>&nbsp;<span class="num" id="5967361">8</span><span class="op" id="5967362">,</span>&nbsp;<span class="num" id="5967364">8</span><span class="op" id="5967365">,</span>&nbsp;<span class="num" id="5967367">8</span><span class="op" id="5967368">,</span>&nbsp;<span class="num" id="5967370">8</span><span class="op" id="5967371">,</span>&nbsp;<span class="num" id="5967373">8</span><span class="op" id="5967374">,</span>&nbsp;<span class="num" id="5967376">8</span><span class="op" id="5967377">,</span>&nbsp;<span class="num" id="5967379">8</span><span class="op" id="5967380">,</span>&nbsp;<span class="num" id="5967382">8</span><span class="op" id="5967383">,</span>&nbsp;<span class="num" id="5967385">8</span><span class="op" id="5967386">,</span>&nbsp;<span class="num" id="5967388">8</span><span class="op" id="5967389">,</span>&nbsp;<span class="num" id="5967391">8</span><span class="op" id="5967392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967395">8</span><span class="op" id="5967396">,</span>&nbsp;<span class="num" id="5967398">8</span><span class="op" id="5967399">,</span>&nbsp;<span class="num" id="5967401">8</span><span class="op" id="5967402">,</span>&nbsp;<span class="num" id="5967404">8</span><span class="op" id="5967405">,</span>&nbsp;<span class="num" id="5967407">8</span><span class="op" id="5967408">,</span>&nbsp;<span class="num" id="5967410">8</span><span class="op" id="5967411">,</span>&nbsp;<span class="num" id="5967413">8</span><span class="op" id="5967414">,</span>&nbsp;<span class="num" id="5967416">8</span><span class="op" id="5967417">,</span>&nbsp;<span class="num" id="5967419">8</span><span class="op" id="5967420">,</span>&nbsp;<span class="num" id="5967422">8</span><span class="op" id="5967423">,</span>&nbsp;<span class="num" id="5967425">8</span><span class="op" id="5967426">,</span>&nbsp;<span class="num" id="5967428">8</span><span class="op" id="5967429">,</span>&nbsp;<span class="num" id="5967431">8</span><span class="op" id="5967432">,</span>&nbsp;<span class="num" id="5967434">8</span><span class="op" id="5967435">,</span>&nbsp;<span class="num" id="5967437">8</span><span class="op" id="5967438">,</span>&nbsp;<span class="num" id="5967440">8</span><span class="op" id="5967441">,</span><br>
<span class="lineno"></span><span class="op" id="5967443">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="5967446">type</span>&nbsp;<span class="ident" id="5967451">quantIndex</span>&nbsp;<span class="builtintype" id="5967462">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5967467">const</span>&nbsp;<span class="op" id="5967473">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967476">quantIndexLuminance</span>&nbsp;<span class="ident" id="5967496">quantIndex</span>&nbsp;<span class="op" id="5967507">=</span>&nbsp;<span class="ident" id="5967509">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967515">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5967538">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="5967550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5967553">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="5967630">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5967706">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5967782">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5967800">var</span>&nbsp;<span class="ident" id="5967804">unscaledQuant</span>&nbsp;<span class="op" id="5967818">=</span>&nbsp;<span class="op" id="5967820">[</span><span class="ident" id="5967821">nQuantIndex</span><span class="op" id="5967832">]</span><span class="op" id="5967833">[</span><span class="ident" id="5967834">blockSize</span><span class="op" id="5967843">]</span><span class="builtintype" id="5967844">byte</span><span class="op" id="5967848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5967851">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5967866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967870">16</span><span class="op" id="5967872">,</span>&nbsp;<span class="num" id="5967874">11</span><span class="op" id="5967876">,</span>&nbsp;<span class="num" id="5967878">12</span><span class="op" id="5967880">,</span>&nbsp;<span class="num" id="5967882">14</span><span class="op" id="5967884">,</span>&nbsp;<span class="num" id="5967886">12</span><span class="op" id="5967888">,</span>&nbsp;<span class="num" id="5967890">10</span><span class="op" id="5967892">,</span>&nbsp;<span class="num" id="5967894">16</span><span class="op" id="5967896">,</span>&nbsp;<span class="num" id="5967898">14</span><span class="op" id="5967900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967904">13</span><span class="op" id="5967906">,</span>&nbsp;<span class="num" id="5967908">14</span><span class="op" id="5967910">,</span>&nbsp;<span class="num" id="5967912">18</span><span class="op" id="5967914">,</span>&nbsp;<span class="num" id="5967916">17</span><span class="op" id="5967918">,</span>&nbsp;<span class="num" id="5967920">16</span><span class="op" id="5967922">,</span>&nbsp;<span class="num" id="5967924">19</span><span class="op" id="5967926">,</span>&nbsp;<span class="num" id="5967928">24</span><span class="op" id="5967930">,</span>&nbsp;<span class="num" id="5967932">40</span><span class="op" id="5967934">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967938">26</span><span class="op" id="5967940">,</span>&nbsp;<span class="num" id="5967942">24</span><span class="op" id="5967944">,</span>&nbsp;<span class="num" id="5967946">22</span><span class="op" id="5967948">,</span>&nbsp;<span class="num" id="5967950">22</span><span class="op" id="5967952">,</span>&nbsp;<span class="num" id="5967954">24</span><span class="op" id="5967956">,</span>&nbsp;<span class="num" id="5967958">49</span><span class="op" id="5967960">,</span>&nbsp;<span class="num" id="5967962">35</span><span class="op" id="5967964">,</span>&nbsp;<span class="num" id="5967966">37</span><span class="op" id="5967968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5967972">29</span><span class="op" id="5967974">,</span>&nbsp;<span class="num" id="5967976">40</span><span class="op" id="5967978">,</span>&nbsp;<span class="num" id="5967980">58</span><span class="op" id="5967982">,</span>&nbsp;<span class="num" id="5967984">51</span><span class="op" id="5967986">,</span>&nbsp;<span class="num" id="5967988">61</span><span class="op" id="5967990">,</span>&nbsp;<span class="num" id="5967992">60</span><span class="op" id="5967994">,</span>&nbsp;<span class="num" id="5967996">57</span><span class="op" id="5967998">,</span>&nbsp;<span class="num" id="5968000">51</span><span class="op" id="5968002">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968006">56</span><span class="op" id="5968008">,</span>&nbsp;<span class="num" id="5968010">55</span><span class="op" id="5968012">,</span>&nbsp;<span class="num" id="5968014">64</span><span class="op" id="5968016">,</span>&nbsp;<span class="num" id="5968018">72</span><span class="op" id="5968020">,</span>&nbsp;<span class="num" id="5968022">92</span><span class="op" id="5968024">,</span>&nbsp;<span class="num" id="5968026">78</span><span class="op" id="5968028">,</span>&nbsp;<span class="num" id="5968030">64</span><span class="op" id="5968032">,</span>&nbsp;<span class="num" id="5968034">68</span><span class="op" id="5968036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968040">87</span><span class="op" id="5968042">,</span>&nbsp;<span class="num" id="5968044">69</span><span class="op" id="5968046">,</span>&nbsp;<span class="num" id="5968048">55</span><span class="op" id="5968050">,</span>&nbsp;<span class="num" id="5968052">56</span><span class="op" id="5968054">,</span>&nbsp;<span class="num" id="5968056">80</span><span class="op" id="5968058">,</span>&nbsp;<span class="num" id="5968060">109</span><span class="op" id="5968063">,</span>&nbsp;<span class="num" id="5968065">81</span><span class="op" id="5968067">,</span>&nbsp;<span class="num" id="5968069">87</span><span class="op" id="5968071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968075">95</span><span class="op" id="5968077">,</span>&nbsp;<span class="num" id="5968079">98</span><span class="op" id="5968081">,</span>&nbsp;<span class="num" id="5968083">103</span><span class="op" id="5968086">,</span>&nbsp;<span class="num" id="5968088">104</span><span class="op" id="5968091">,</span>&nbsp;<span class="num" id="5968093">103</span><span class="op" id="5968096">,</span>&nbsp;<span class="num" id="5968098">62</span><span class="op" id="5968100">,</span>&nbsp;<span class="num" id="5968102">77</span><span class="op" id="5968104">,</span>&nbsp;<span class="num" id="5968106">113</span><span class="op" id="5968109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968113">121</span><span class="op" id="5968116">,</span>&nbsp;<span class="num" id="5968118">112</span><span class="op" id="5968121">,</span>&nbsp;<span class="num" id="5968123">100</span><span class="op" id="5968126">,</span>&nbsp;<span class="num" id="5968128">120</span><span class="op" id="5968131">,</span>&nbsp;<span class="num" id="5968133">92</span><span class="op" id="5968135">,</span>&nbsp;<span class="num" id="5968137">101</span><span class="op" id="5968140">,</span>&nbsp;<span class="num" id="5968142">103</span><span class="op" id="5968145">,</span>&nbsp;<span class="num" id="5968147">99</span><span class="op" id="5968149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968152">}</span><span class="op" id="5968153">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968156">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968177">17</span><span class="op" id="5968179">,</span>&nbsp;<span class="num" id="5968181">18</span><span class="op" id="5968183">,</span>&nbsp;<span class="num" id="5968185">18</span><span class="op" id="5968187">,</span>&nbsp;<span class="num" id="5968189">24</span><span class="op" id="5968191">,</span>&nbsp;<span class="num" id="5968193">21</span><span class="op" id="5968195">,</span>&nbsp;<span class="num" id="5968197">24</span><span class="op" id="5968199">,</span>&nbsp;<span class="num" id="5968201">47</span><span class="op" id="5968203">,</span>&nbsp;<span class="num" id="5968205">26</span><span class="op" id="5968207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968211">26</span><span class="op" id="5968213">,</span>&nbsp;<span class="num" id="5968215">47</span><span class="op" id="5968217">,</span>&nbsp;<span class="num" id="5968219">99</span><span class="op" id="5968221">,</span>&nbsp;<span class="num" id="5968223">66</span><span class="op" id="5968225">,</span>&nbsp;<span class="num" id="5968227">56</span><span class="op" id="5968229">,</span>&nbsp;<span class="num" id="5968231">66</span><span class="op" id="5968233">,</span>&nbsp;<span class="num" id="5968235">99</span><span class="op" id="5968237">,</span>&nbsp;<span class="num" id="5968239">99</span><span class="op" id="5968241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968245">99</span><span class="op" id="5968247">,</span>&nbsp;<span class="num" id="5968249">99</span><span class="op" id="5968251">,</span>&nbsp;<span class="num" id="5968253">99</span><span class="op" id="5968255">,</span>&nbsp;<span class="num" id="5968257">99</span><span class="op" id="5968259">,</span>&nbsp;<span class="num" id="5968261">99</span><span class="op" id="5968263">,</span>&nbsp;<span class="num" id="5968265">99</span><span class="op" id="5968267">,</span>&nbsp;<span class="num" id="5968269">99</span><span class="op" id="5968271">,</span>&nbsp;<span class="num" id="5968273">99</span><span class="op" id="5968275">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968279">99</span><span class="op" id="5968281">,</span>&nbsp;<span class="num" id="5968283">99</span><span class="op" id="5968285">,</span>&nbsp;<span class="num" id="5968287">99</span><span class="op" id="5968289">,</span>&nbsp;<span class="num" id="5968291">99</span><span class="op" id="5968293">,</span>&nbsp;<span class="num" id="5968295">99</span><span class="op" id="5968297">,</span>&nbsp;<span class="num" id="5968299">99</span><span class="op" id="5968301">,</span>&nbsp;<span class="num" id="5968303">99</span><span class="op" id="5968305">,</span>&nbsp;<span class="num" id="5968307">99</span><span class="op" id="5968309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968313">99</span><span class="op" id="5968315">,</span>&nbsp;<span class="num" id="5968317">99</span><span class="op" id="5968319">,</span>&nbsp;<span class="num" id="5968321">99</span><span class="op" id="5968323">,</span>&nbsp;<span class="num" id="5968325">99</span><span class="op" id="5968327">,</span>&nbsp;<span class="num" id="5968329">99</span><span class="op" id="5968331">,</span>&nbsp;<span class="num" id="5968333">99</span><span class="op" id="5968335">,</span>&nbsp;<span class="num" id="5968337">99</span><span class="op" id="5968339">,</span>&nbsp;<span class="num" id="5968341">99</span><span class="op" id="5968343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968347">99</span><span class="op" id="5968349">,</span>&nbsp;<span class="num" id="5968351">99</span><span class="op" id="5968353">,</span>&nbsp;<span class="num" id="5968355">99</span><span class="op" id="5968357">,</span>&nbsp;<span class="num" id="5968359">99</span><span class="op" id="5968361">,</span>&nbsp;<span class="num" id="5968363">99</span><span class="op" id="5968365">,</span>&nbsp;<span class="num" id="5968367">99</span><span class="op" id="5968369">,</span>&nbsp;<span class="num" id="5968371">99</span><span class="op" id="5968373">,</span>&nbsp;<span class="num" id="5968375">99</span><span class="op" id="5968377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968381">99</span><span class="op" id="5968383">,</span>&nbsp;<span class="num" id="5968385">99</span><span class="op" id="5968387">,</span>&nbsp;<span class="num" id="5968389">99</span><span class="op" id="5968391">,</span>&nbsp;<span class="num" id="5968393">99</span><span class="op" id="5968395">,</span>&nbsp;<span class="num" id="5968397">99</span><span class="op" id="5968399">,</span>&nbsp;<span class="num" id="5968401">99</span><span class="op" id="5968403">,</span>&nbsp;<span class="num" id="5968405">99</span><span class="op" id="5968407">,</span>&nbsp;<span class="num" id="5968409">99</span><span class="op" id="5968411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5968415">99</span><span class="op" id="5968417">,</span>&nbsp;<span class="num" id="5968419">99</span><span class="op" id="5968421">,</span>&nbsp;<span class="num" id="5968423">99</span><span class="op" id="5968425">,</span>&nbsp;<span class="num" id="5968427">99</span><span class="op" id="5968429">,</span>&nbsp;<span class="num" id="5968431">99</span><span class="op" id="5968433">,</span>&nbsp;<span class="num" id="5968435">99</span><span class="op" id="5968437">,</span>&nbsp;<span class="num" id="5968439">99</span><span class="op" id="5968441">,</span>&nbsp;<span class="num" id="5968443">99</span><span class="op" id="5968445">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5968448">}</span><span class="op" id="5968449">,</span><br>
<span class="lineno"></span><span class="op" id="5968451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5968454">type</span>&nbsp;<span class="ident" id="5968459">huffIndex</span>&nbsp;<span class="builtintype" id="5968469">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="5968474">const</span>&nbsp;<span class="op" id="5968480">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968483">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="5968504">huffIndex</span>&nbsp;<span class="op" id="5968514">=</span>&nbsp;<span class="ident" id="5968516">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968522">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968544">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968568">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968592">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="5968603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5968606">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5968651">type</span>&nbsp;<span class="ident" id="5968656">huffmanSpec</span>&nbsp;<span class="keyword" id="5968668">struct</span>&nbsp;<span class="op" id="5968675">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968678">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968732">count</span>&nbsp;<span class="op" id="5968738">[</span><span class="num" id="5968739">16</span><span class="op" id="5968741">]</span><span class="builtintype" id="5968742">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968748">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5968804">value</span>&nbsp;<span class="op" id="5968810">[</span><span class="op" id="5968811">]</span><span class="builtintype" id="5968812">byte</span><br>
<span class="lineno"></span><span class="op" id="5968817">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5968820">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="5968878">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="5968941">var</span>&nbsp;<span class="ident" id="5968945">theHuffmanSpec</span>&nbsp;<span class="op" id="5968960">=</span>&nbsp;<span class="op" id="5968962">[</span><span class="ident" id="5968963">nHuffIndex</span><span class="op" id="5968973">]</span><span class="ident" id="5968974">huffmanSpec</span><span class="op" id="5968985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5968988">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969010">[</span><span class="num" id="5969011">16</span><span class="op" id="5969013">]</span><span class="builtintype" id="5969014">byte</span><span class="op" id="5969018">{</span><span class="num" id="5969019">0</span><span class="op" id="5969020">,</span>&nbsp;<span class="num" id="5969022">1</span><span class="op" id="5969023">,</span>&nbsp;<span class="num" id="5969025">5</span><span class="op" id="5969026">,</span>&nbsp;<span class="num" id="5969028">1</span><span class="op" id="5969029">,</span>&nbsp;<span class="num" id="5969031">1</span><span class="op" id="5969032">,</span>&nbsp;<span class="num" id="5969034">1</span><span class="op" id="5969035">,</span>&nbsp;<span class="num" id="5969037">1</span><span class="op" id="5969038">,</span>&nbsp;<span class="num" id="5969040">1</span><span class="op" id="5969041">,</span>&nbsp;<span class="num" id="5969043">1</span><span class="op" id="5969044">,</span>&nbsp;<span class="num" id="5969046">0</span><span class="op" id="5969047">,</span>&nbsp;<span class="num" id="5969049">0</span><span class="op" id="5969050">,</span>&nbsp;<span class="num" id="5969052">0</span><span class="op" id="5969053">,</span>&nbsp;<span class="num" id="5969055">0</span><span class="op" id="5969056">,</span>&nbsp;<span class="num" id="5969058">0</span><span class="op" id="5969059">,</span>&nbsp;<span class="num" id="5969061">0</span><span class="op" id="5969062">,</span>&nbsp;<span class="num" id="5969064">0</span><span class="op" id="5969065">}</span><span class="op" id="5969066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969070">[</span><span class="op" id="5969071">]</span><span class="builtintype" id="5969072">byte</span><span class="op" id="5969076">{</span><span class="num" id="5969077">0</span><span class="op" id="5969078">,</span>&nbsp;<span class="num" id="5969080">1</span><span class="op" id="5969081">,</span>&nbsp;<span class="num" id="5969083">2</span><span class="op" id="5969084">,</span>&nbsp;<span class="num" id="5969086">3</span><span class="op" id="5969087">,</span>&nbsp;<span class="num" id="5969089">4</span><span class="op" id="5969090">,</span>&nbsp;<span class="num" id="5969092">5</span><span class="op" id="5969093">,</span>&nbsp;<span class="num" id="5969095">6</span><span class="op" id="5969096">,</span>&nbsp;<span class="num" id="5969098">7</span><span class="op" id="5969099">,</span>&nbsp;<span class="num" id="5969101">8</span><span class="op" id="5969102">,</span>&nbsp;<span class="num" id="5969104">9</span><span class="op" id="5969105">,</span>&nbsp;<span class="num" id="5969107">10</span><span class="op" id="5969109">,</span>&nbsp;<span class="num" id="5969111">11</span><span class="op" id="5969113">}</span><span class="op" id="5969114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969117">}</span><span class="op" id="5969118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5969121">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969143">[</span><span class="num" id="5969144">16</span><span class="op" id="5969146">]</span><span class="builtintype" id="5969147">byte</span><span class="op" id="5969151">{</span><span class="num" id="5969152">0</span><span class="op" id="5969153">,</span>&nbsp;<span class="num" id="5969155">2</span><span class="op" id="5969156">,</span>&nbsp;<span class="num" id="5969158">1</span><span class="op" id="5969159">,</span>&nbsp;<span class="num" id="5969161">3</span><span class="op" id="5969162">,</span>&nbsp;<span class="num" id="5969164">3</span><span class="op" id="5969165">,</span>&nbsp;<span class="num" id="5969167">2</span><span class="op" id="5969168">,</span>&nbsp;<span class="num" id="5969170">4</span><span class="op" id="5969171">,</span>&nbsp;<span class="num" id="5969173">3</span><span class="op" id="5969174">,</span>&nbsp;<span class="num" id="5969176">5</span><span class="op" id="5969177">,</span>&nbsp;<span class="num" id="5969179">5</span><span class="op" id="5969180">,</span>&nbsp;<span class="num" id="5969182">4</span><span class="op" id="5969183">,</span>&nbsp;<span class="num" id="5969185">4</span><span class="op" id="5969186">,</span>&nbsp;<span class="num" id="5969188">0</span><span class="op" id="5969189">,</span>&nbsp;<span class="num" id="5969191">0</span><span class="op" id="5969192">,</span>&nbsp;<span class="num" id="5969194">1</span><span class="op" id="5969195">,</span>&nbsp;<span class="num" id="5969197">125</span><span class="op" id="5969200">}</span><span class="op" id="5969201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5969205">[</span><span class="op" id="5969206">]</span><span class="builtintype" id="5969207">byte</span><span class="op" id="5969211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969216">0x01</span><span class="op" id="5969220">,</span>&nbsp;<span class="num" id="5969222">0x02</span><span class="op" id="5969226">,</span>&nbsp;<span class="num" id="5969228">0x03</span><span class="op" id="5969232">,</span>&nbsp;<span class="num" id="5969234">0x00</span><span class="op" id="5969238">,</span>&nbsp;<span class="num" id="5969240">0x04</span><span class="op" id="5969244">,</span>&nbsp;<span class="num" id="5969246">0x11</span><span class="op" id="5969250">,</span>&nbsp;<span class="num" id="5969252">0x05</span><span class="op" id="5969256">,</span>&nbsp;<span class="num" id="5969258">0x12</span><span class="op" id="5969262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969267">0x21</span><span class="op" id="5969271">,</span>&nbsp;<span class="num" id="5969273">0x31</span><span class="op" id="5969277">,</span>&nbsp;<span class="num" id="5969279">0x41</span><span class="op" id="5969283">,</span>&nbsp;<span class="num" id="5969285">0x06</span><span class="op" id="5969289">,</span>&nbsp;<span class="num" id="5969291">0x13</span><span class="op" id="5969295">,</span>&nbsp;<span class="num" id="5969297">0x51</span><span class="op" id="5969301">,</span>&nbsp;<span class="num" id="5969303">0x61</span><span class="op" id="5969307">,</span>&nbsp;<span class="num" id="5969309">0x07</span><span class="op" id="5969313">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969318">0x22</span><span class="op" id="5969322">,</span>&nbsp;<span class="num" id="5969324">0x71</span><span class="op" id="5969328">,</span>&nbsp;<span class="num" id="5969330">0x14</span><span class="op" id="5969334">,</span>&nbsp;<span class="num" id="5969336">0x32</span><span class="op" id="5969340">,</span>&nbsp;<span class="num" id="5969342">0x81</span><span class="op" id="5969346">,</span>&nbsp;<span class="num" id="5969348">0x91</span><span class="op" id="5969352">,</span>&nbsp;<span class="num" id="5969354">0xa1</span><span class="op" id="5969358">,</span>&nbsp;<span class="num" id="5969360">0x08</span><span class="op" id="5969364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969369">0x23</span><span class="op" id="5969373">,</span>&nbsp;<span class="num" id="5969375">0x42</span><span class="op" id="5969379">,</span>&nbsp;<span class="num" id="5969381">0xb1</span><span class="op" id="5969385">,</span>&nbsp;<span class="num" id="5969387">0xc1</span><span class="op" id="5969391">,</span>&nbsp;<span class="num" id="5969393">0x15</span><span class="op" id="5969397">,</span>&nbsp;<span class="num" id="5969399">0x52</span><span class="op" id="5969403">,</span>&nbsp;<span class="num" id="5969405">0xd1</span><span class="op" id="5969409">,</span>&nbsp;<span class="num" id="5969411">0xf0</span><span class="op" id="5969415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969420">0x24</span><span class="op" id="5969424">,</span>&nbsp;<span class="num" id="5969426">0x33</span><span class="op" id="5969430">,</span>&nbsp;<span class="num" id="5969432">0x62</span><span class="op" id="5969436">,</span>&nbsp;<span class="num" id="5969438">0x72</span><span class="op" id="5969442">,</span>&nbsp;<span class="num" id="5969444">0x82</span><span class="op" id="5969448">,</span>&nbsp;<span class="num" id="5969450">0x09</span><span class="op" id="5969454">,</span>&nbsp;<span class="num" id="5969456">0x0a</span><span class="op" id="5969460">,</span>&nbsp;<span class="num" id="5969462">0x16</span><span class="op" id="5969466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969471">0x17</span><span class="op" id="5969475">,</span>&nbsp;<span class="num" id="5969477">0x18</span><span class="op" id="5969481">,</span>&nbsp;<span class="num" id="5969483">0x19</span><span class="op" id="5969487">,</span>&nbsp;<span class="num" id="5969489">0x1a</span><span class="op" id="5969493">,</span>&nbsp;<span class="num" id="5969495">0x25</span><span class="op" id="5969499">,</span>&nbsp;<span class="num" id="5969501">0x26</span><span class="op" id="5969505">,</span>&nbsp;<span class="num" id="5969507">0x27</span><span class="op" id="5969511">,</span>&nbsp;<span class="num" id="5969513">0x28</span><span class="op" id="5969517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969522">0x29</span><span class="op" id="5969526">,</span>&nbsp;<span class="num" id="5969528">0x2a</span><span class="op" id="5969532">,</span>&nbsp;<span class="num" id="5969534">0x34</span><span class="op" id="5969538">,</span>&nbsp;<span class="num" id="5969540">0x35</span><span class="op" id="5969544">,</span>&nbsp;<span class="num" id="5969546">0x36</span><span class="op" id="5969550">,</span>&nbsp;<span class="num" id="5969552">0x37</span><span class="op" id="5969556">,</span>&nbsp;<span class="num" id="5969558">0x38</span><span class="op" id="5969562">,</span>&nbsp;<span class="num" id="5969564">0x39</span><span class="op" id="5969568">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969573">0x3a</span><span class="op" id="5969577">,</span>&nbsp;<span class="num" id="5969579">0x43</span><span class="op" id="5969583">,</span>&nbsp;<span class="num" id="5969585">0x44</span><span class="op" id="5969589">,</span>&nbsp;<span class="num" id="5969591">0x45</span><span class="op" id="5969595">,</span>&nbsp;<span class="num" id="5969597">0x46</span><span class="op" id="5969601">,</span>&nbsp;<span class="num" id="5969603">0x47</span><span class="op" id="5969607">,</span>&nbsp;<span class="num" id="5969609">0x48</span><span class="op" id="5969613">,</span>&nbsp;<span class="num" id="5969615">0x49</span><span class="op" id="5969619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969624">0x4a</span><span class="op" id="5969628">,</span>&nbsp;<span class="num" id="5969630">0x53</span><span class="op" id="5969634">,</span>&nbsp;<span class="num" id="5969636">0x54</span><span class="op" id="5969640">,</span>&nbsp;<span class="num" id="5969642">0x55</span><span class="op" id="5969646">,</span>&nbsp;<span class="num" id="5969648">0x56</span><span class="op" id="5969652">,</span>&nbsp;<span class="num" id="5969654">0x57</span><span class="op" id="5969658">,</span>&nbsp;<span class="num" id="5969660">0x58</span><span class="op" id="5969664">,</span>&nbsp;<span class="num" id="5969666">0x59</span><span class="op" id="5969670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969675">0x5a</span><span class="op" id="5969679">,</span>&nbsp;<span class="num" id="5969681">0x63</span><span class="op" id="5969685">,</span>&nbsp;<span class="num" id="5969687">0x64</span><span class="op" id="5969691">,</span>&nbsp;<span class="num" id="5969693">0x65</span><span class="op" id="5969697">,</span>&nbsp;<span class="num" id="5969699">0x66</span><span class="op" id="5969703">,</span>&nbsp;<span class="num" id="5969705">0x67</span><span class="op" id="5969709">,</span>&nbsp;<span class="num" id="5969711">0x68</span><span class="op" id="5969715">,</span>&nbsp;<span class="num" id="5969717">0x69</span><span class="op" id="5969721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969726">0x6a</span><span class="op" id="5969730">,</span>&nbsp;<span class="num" id="5969732">0x73</span><span class="op" id="5969736">,</span>&nbsp;<span class="num" id="5969738">0x74</span><span class="op" id="5969742">,</span>&nbsp;<span class="num" id="5969744">0x75</span><span class="op" id="5969748">,</span>&nbsp;<span class="num" id="5969750">0x76</span><span class="op" id="5969754">,</span>&nbsp;<span class="num" id="5969756">0x77</span><span class="op" id="5969760">,</span>&nbsp;<span class="num" id="5969762">0x78</span><span class="op" id="5969766">,</span>&nbsp;<span class="num" id="5969768">0x79</span><span class="op" id="5969772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969777">0x7a</span><span class="op" id="5969781">,</span>&nbsp;<span class="num" id="5969783">0x83</span><span class="op" id="5969787">,</span>&nbsp;<span class="num" id="5969789">0x84</span><span class="op" id="5969793">,</span>&nbsp;<span class="num" id="5969795">0x85</span><span class="op" id="5969799">,</span>&nbsp;<span class="num" id="5969801">0x86</span><span class="op" id="5969805">,</span>&nbsp;<span class="num" id="5969807">0x87</span><span class="op" id="5969811">,</span>&nbsp;<span class="num" id="5969813">0x88</span><span class="op" id="5969817">,</span>&nbsp;<span class="num" id="5969819">0x89</span><span class="op" id="5969823">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969828">0x8a</span><span class="op" id="5969832">,</span>&nbsp;<span class="num" id="5969834">0x92</span><span class="op" id="5969838">,</span>&nbsp;<span class="num" id="5969840">0x93</span><span class="op" id="5969844">,</span>&nbsp;<span class="num" id="5969846">0x94</span><span class="op" id="5969850">,</span>&nbsp;<span class="num" id="5969852">0x95</span><span class="op" id="5969856">,</span>&nbsp;<span class="num" id="5969858">0x96</span><span class="op" id="5969862">,</span>&nbsp;<span class="num" id="5969864">0x97</span><span class="op" id="5969868">,</span>&nbsp;<span class="num" id="5969870">0x98</span><span class="op" id="5969874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969879">0x99</span><span class="op" id="5969883">,</span>&nbsp;<span class="num" id="5969885">0x9a</span><span class="op" id="5969889">,</span>&nbsp;<span class="num" id="5969891">0xa2</span><span class="op" id="5969895">,</span>&nbsp;<span class="num" id="5969897">0xa3</span><span class="op" id="5969901">,</span>&nbsp;<span class="num" id="5969903">0xa4</span><span class="op" id="5969907">,</span>&nbsp;<span class="num" id="5969909">0xa5</span><span class="op" id="5969913">,</span>&nbsp;<span class="num" id="5969915">0xa6</span><span class="op" id="5969919">,</span>&nbsp;<span class="num" id="5969921">0xa7</span><span class="op" id="5969925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969930">0xa8</span><span class="op" id="5969934">,</span>&nbsp;<span class="num" id="5969936">0xa9</span><span class="op" id="5969940">,</span>&nbsp;<span class="num" id="5969942">0xaa</span><span class="op" id="5969946">,</span>&nbsp;<span class="num" id="5969948">0xb2</span><span class="op" id="5969952">,</span>&nbsp;<span class="num" id="5969954">0xb3</span><span class="op" id="5969958">,</span>&nbsp;<span class="num" id="5969960">0xb4</span><span class="op" id="5969964">,</span>&nbsp;<span class="num" id="5969966">0xb5</span><span class="op" id="5969970">,</span>&nbsp;<span class="num" id="5969972">0xb6</span><span class="op" id="5969976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5969981">0xb7</span><span class="op" id="5969985">,</span>&nbsp;<span class="num" id="5969987">0xb8</span><span class="op" id="5969991">,</span>&nbsp;<span class="num" id="5969993">0xb9</span><span class="op" id="5969997">,</span>&nbsp;<span class="num" id="5969999">0xba</span><span class="op" id="5970003">,</span>&nbsp;<span class="num" id="5970005">0xc2</span><span class="op" id="5970009">,</span>&nbsp;<span class="num" id="5970011">0xc3</span><span class="op" id="5970015">,</span>&nbsp;<span class="num" id="5970017">0xc4</span><span class="op" id="5970021">,</span>&nbsp;<span class="num" id="5970023">0xc5</span><span class="op" id="5970027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970032">0xc6</span><span class="op" id="5970036">,</span>&nbsp;<span class="num" id="5970038">0xc7</span><span class="op" id="5970042">,</span>&nbsp;<span class="num" id="5970044">0xc8</span><span class="op" id="5970048">,</span>&nbsp;<span class="num" id="5970050">0xc9</span><span class="op" id="5970054">,</span>&nbsp;<span class="num" id="5970056">0xca</span><span class="op" id="5970060">,</span>&nbsp;<span class="num" id="5970062">0xd2</span><span class="op" id="5970066">,</span>&nbsp;<span class="num" id="5970068">0xd3</span><span class="op" id="5970072">,</span>&nbsp;<span class="num" id="5970074">0xd4</span><span class="op" id="5970078">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970083">0xd5</span><span class="op" id="5970087">,</span>&nbsp;<span class="num" id="5970089">0xd6</span><span class="op" id="5970093">,</span>&nbsp;<span class="num" id="5970095">0xd7</span><span class="op" id="5970099">,</span>&nbsp;<span class="num" id="5970101">0xd8</span><span class="op" id="5970105">,</span>&nbsp;<span class="num" id="5970107">0xd9</span><span class="op" id="5970111">,</span>&nbsp;<span class="num" id="5970113">0xda</span><span class="op" id="5970117">,</span>&nbsp;<span class="num" id="5970119">0xe1</span><span class="op" id="5970123">,</span>&nbsp;<span class="num" id="5970125">0xe2</span><span class="op" id="5970129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970134">0xe3</span><span class="op" id="5970138">,</span>&nbsp;<span class="num" id="5970140">0xe4</span><span class="op" id="5970144">,</span>&nbsp;<span class="num" id="5970146">0xe5</span><span class="op" id="5970150">,</span>&nbsp;<span class="num" id="5970152">0xe6</span><span class="op" id="5970156">,</span>&nbsp;<span class="num" id="5970158">0xe7</span><span class="op" id="5970162">,</span>&nbsp;<span class="num" id="5970164">0xe8</span><span class="op" id="5970168">,</span>&nbsp;<span class="num" id="5970170">0xe9</span><span class="op" id="5970174">,</span>&nbsp;<span class="num" id="5970176">0xea</span><span class="op" id="5970180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970185">0xf1</span><span class="op" id="5970189">,</span>&nbsp;<span class="num" id="5970191">0xf2</span><span class="op" id="5970195">,</span>&nbsp;<span class="num" id="5970197">0xf3</span><span class="op" id="5970201">,</span>&nbsp;<span class="num" id="5970203">0xf4</span><span class="op" id="5970207">,</span>&nbsp;<span class="num" id="5970209">0xf5</span><span class="op" id="5970213">,</span>&nbsp;<span class="num" id="5970215">0xf6</span><span class="op" id="5970219">,</span>&nbsp;<span class="num" id="5970221">0xf7</span><span class="op" id="5970225">,</span>&nbsp;<span class="num" id="5970227">0xf8</span><span class="op" id="5970231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970236">0xf9</span><span class="op" id="5970240">,</span>&nbsp;<span class="num" id="5970242">0xfa</span><span class="op" id="5970246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970250">}</span><span class="op" id="5970251">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970254">}</span><span class="op" id="5970255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970258">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970282">[</span><span class="num" id="5970283">16</span><span class="op" id="5970285">]</span><span class="builtintype" id="5970286">byte</span><span class="op" id="5970290">{</span><span class="num" id="5970291">0</span><span class="op" id="5970292">,</span>&nbsp;<span class="num" id="5970294">3</span><span class="op" id="5970295">,</span>&nbsp;<span class="num" id="5970297">1</span><span class="op" id="5970298">,</span>&nbsp;<span class="num" id="5970300">1</span><span class="op" id="5970301">,</span>&nbsp;<span class="num" id="5970303">1</span><span class="op" id="5970304">,</span>&nbsp;<span class="num" id="5970306">1</span><span class="op" id="5970307">,</span>&nbsp;<span class="num" id="5970309">1</span><span class="op" id="5970310">,</span>&nbsp;<span class="num" id="5970312">1</span><span class="op" id="5970313">,</span>&nbsp;<span class="num" id="5970315">1</span><span class="op" id="5970316">,</span>&nbsp;<span class="num" id="5970318">1</span><span class="op" id="5970319">,</span>&nbsp;<span class="num" id="5970321">1</span><span class="op" id="5970322">,</span>&nbsp;<span class="num" id="5970324">0</span><span class="op" id="5970325">,</span>&nbsp;<span class="num" id="5970327">0</span><span class="op" id="5970328">,</span>&nbsp;<span class="num" id="5970330">0</span><span class="op" id="5970331">,</span>&nbsp;<span class="num" id="5970333">0</span><span class="op" id="5970334">,</span>&nbsp;<span class="num" id="5970336">0</span><span class="op" id="5970337">}</span><span class="op" id="5970338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970342">[</span><span class="op" id="5970343">]</span><span class="builtintype" id="5970344">byte</span><span class="op" id="5970348">{</span><span class="num" id="5970349">0</span><span class="op" id="5970350">,</span>&nbsp;<span class="num" id="5970352">1</span><span class="op" id="5970353">,</span>&nbsp;<span class="num" id="5970355">2</span><span class="op" id="5970356">,</span>&nbsp;<span class="num" id="5970358">3</span><span class="op" id="5970359">,</span>&nbsp;<span class="num" id="5970361">4</span><span class="op" id="5970362">,</span>&nbsp;<span class="num" id="5970364">5</span><span class="op" id="5970365">,</span>&nbsp;<span class="num" id="5970367">6</span><span class="op" id="5970368">,</span>&nbsp;<span class="num" id="5970370">7</span><span class="op" id="5970371">,</span>&nbsp;<span class="num" id="5970373">8</span><span class="op" id="5970374">,</span>&nbsp;<span class="num" id="5970376">9</span><span class="op" id="5970377">,</span>&nbsp;<span class="num" id="5970379">10</span><span class="op" id="5970381">,</span>&nbsp;<span class="num" id="5970383">11</span><span class="op" id="5970385">}</span><span class="op" id="5970386">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970389">}</span><span class="op" id="5970390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5970393">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970417">[</span><span class="num" id="5970418">16</span><span class="op" id="5970420">]</span><span class="builtintype" id="5970421">byte</span><span class="op" id="5970425">{</span><span class="num" id="5970426">0</span><span class="op" id="5970427">,</span>&nbsp;<span class="num" id="5970429">2</span><span class="op" id="5970430">,</span>&nbsp;<span class="num" id="5970432">1</span><span class="op" id="5970433">,</span>&nbsp;<span class="num" id="5970435">2</span><span class="op" id="5970436">,</span>&nbsp;<span class="num" id="5970438">4</span><span class="op" id="5970439">,</span>&nbsp;<span class="num" id="5970441">4</span><span class="op" id="5970442">,</span>&nbsp;<span class="num" id="5970444">3</span><span class="op" id="5970445">,</span>&nbsp;<span class="num" id="5970447">4</span><span class="op" id="5970448">,</span>&nbsp;<span class="num" id="5970450">7</span><span class="op" id="5970451">,</span>&nbsp;<span class="num" id="5970453">5</span><span class="op" id="5970454">,</span>&nbsp;<span class="num" id="5970456">4</span><span class="op" id="5970457">,</span>&nbsp;<span class="num" id="5970459">4</span><span class="op" id="5970460">,</span>&nbsp;<span class="num" id="5970462">0</span><span class="op" id="5970463">,</span>&nbsp;<span class="num" id="5970465">1</span><span class="op" id="5970466">,</span>&nbsp;<span class="num" id="5970468">2</span><span class="op" id="5970469">,</span>&nbsp;<span class="num" id="5970471">119</span><span class="op" id="5970474">}</span><span class="op" id="5970475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5970479">[</span><span class="op" id="5970480">]</span><span class="builtintype" id="5970481">byte</span><span class="op" id="5970485">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970490">0x00</span><span class="op" id="5970494">,</span>&nbsp;<span class="num" id="5970496">0x01</span><span class="op" id="5970500">,</span>&nbsp;<span class="num" id="5970502">0x02</span><span class="op" id="5970506">,</span>&nbsp;<span class="num" id="5970508">0x03</span><span class="op" id="5970512">,</span>&nbsp;<span class="num" id="5970514">0x11</span><span class="op" id="5970518">,</span>&nbsp;<span class="num" id="5970520">0x04</span><span class="op" id="5970524">,</span>&nbsp;<span class="num" id="5970526">0x05</span><span class="op" id="5970530">,</span>&nbsp;<span class="num" id="5970532">0x21</span><span class="op" id="5970536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970541">0x31</span><span class="op" id="5970545">,</span>&nbsp;<span class="num" id="5970547">0x06</span><span class="op" id="5970551">,</span>&nbsp;<span class="num" id="5970553">0x12</span><span class="op" id="5970557">,</span>&nbsp;<span class="num" id="5970559">0x41</span><span class="op" id="5970563">,</span>&nbsp;<span class="num" id="5970565">0x51</span><span class="op" id="5970569">,</span>&nbsp;<span class="num" id="5970571">0x07</span><span class="op" id="5970575">,</span>&nbsp;<span class="num" id="5970577">0x61</span><span class="op" id="5970581">,</span>&nbsp;<span class="num" id="5970583">0x71</span><span class="op" id="5970587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970592">0x13</span><span class="op" id="5970596">,</span>&nbsp;<span class="num" id="5970598">0x22</span><span class="op" id="5970602">,</span>&nbsp;<span class="num" id="5970604">0x32</span><span class="op" id="5970608">,</span>&nbsp;<span class="num" id="5970610">0x81</span><span class="op" id="5970614">,</span>&nbsp;<span class="num" id="5970616">0x08</span><span class="op" id="5970620">,</span>&nbsp;<span class="num" id="5970622">0x14</span><span class="op" id="5970626">,</span>&nbsp;<span class="num" id="5970628">0x42</span><span class="op" id="5970632">,</span>&nbsp;<span class="num" id="5970634">0x91</span><span class="op" id="5970638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970643">0xa1</span><span class="op" id="5970647">,</span>&nbsp;<span class="num" id="5970649">0xb1</span><span class="op" id="5970653">,</span>&nbsp;<span class="num" id="5970655">0xc1</span><span class="op" id="5970659">,</span>&nbsp;<span class="num" id="5970661">0x09</span><span class="op" id="5970665">,</span>&nbsp;<span class="num" id="5970667">0x23</span><span class="op" id="5970671">,</span>&nbsp;<span class="num" id="5970673">0x33</span><span class="op" id="5970677">,</span>&nbsp;<span class="num" id="5970679">0x52</span><span class="op" id="5970683">,</span>&nbsp;<span class="num" id="5970685">0xf0</span><span class="op" id="5970689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970694">0x15</span><span class="op" id="5970698">,</span>&nbsp;<span class="num" id="5970700">0x62</span><span class="op" id="5970704">,</span>&nbsp;<span class="num" id="5970706">0x72</span><span class="op" id="5970710">,</span>&nbsp;<span class="num" id="5970712">0xd1</span><span class="op" id="5970716">,</span>&nbsp;<span class="num" id="5970718">0x0a</span><span class="op" id="5970722">,</span>&nbsp;<span class="num" id="5970724">0x16</span><span class="op" id="5970728">,</span>&nbsp;<span class="num" id="5970730">0x24</span><span class="op" id="5970734">,</span>&nbsp;<span class="num" id="5970736">0x34</span><span class="op" id="5970740">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970745">0xe1</span><span class="op" id="5970749">,</span>&nbsp;<span class="num" id="5970751">0x25</span><span class="op" id="5970755">,</span>&nbsp;<span class="num" id="5970757">0xf1</span><span class="op" id="5970761">,</span>&nbsp;<span class="num" id="5970763">0x17</span><span class="op" id="5970767">,</span>&nbsp;<span class="num" id="5970769">0x18</span><span class="op" id="5970773">,</span>&nbsp;<span class="num" id="5970775">0x19</span><span class="op" id="5970779">,</span>&nbsp;<span class="num" id="5970781">0x1a</span><span class="op" id="5970785">,</span>&nbsp;<span class="num" id="5970787">0x26</span><span class="op" id="5970791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970796">0x27</span><span class="op" id="5970800">,</span>&nbsp;<span class="num" id="5970802">0x28</span><span class="op" id="5970806">,</span>&nbsp;<span class="num" id="5970808">0x29</span><span class="op" id="5970812">,</span>&nbsp;<span class="num" id="5970814">0x2a</span><span class="op" id="5970818">,</span>&nbsp;<span class="num" id="5970820">0x35</span><span class="op" id="5970824">,</span>&nbsp;<span class="num" id="5970826">0x36</span><span class="op" id="5970830">,</span>&nbsp;<span class="num" id="5970832">0x37</span><span class="op" id="5970836">,</span>&nbsp;<span class="num" id="5970838">0x38</span><span class="op" id="5970842">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970847">0x39</span><span class="op" id="5970851">,</span>&nbsp;<span class="num" id="5970853">0x3a</span><span class="op" id="5970857">,</span>&nbsp;<span class="num" id="5970859">0x43</span><span class="op" id="5970863">,</span>&nbsp;<span class="num" id="5970865">0x44</span><span class="op" id="5970869">,</span>&nbsp;<span class="num" id="5970871">0x45</span><span class="op" id="5970875">,</span>&nbsp;<span class="num" id="5970877">0x46</span><span class="op" id="5970881">,</span>&nbsp;<span class="num" id="5970883">0x47</span><span class="op" id="5970887">,</span>&nbsp;<span class="num" id="5970889">0x48</span><span class="op" id="5970893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970898">0x49</span><span class="op" id="5970902">,</span>&nbsp;<span class="num" id="5970904">0x4a</span><span class="op" id="5970908">,</span>&nbsp;<span class="num" id="5970910">0x53</span><span class="op" id="5970914">,</span>&nbsp;<span class="num" id="5970916">0x54</span><span class="op" id="5970920">,</span>&nbsp;<span class="num" id="5970922">0x55</span><span class="op" id="5970926">,</span>&nbsp;<span class="num" id="5970928">0x56</span><span class="op" id="5970932">,</span>&nbsp;<span class="num" id="5970934">0x57</span><span class="op" id="5970938">,</span>&nbsp;<span class="num" id="5970940">0x58</span><span class="op" id="5970944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5970949">0x59</span><span class="op" id="5970953">,</span>&nbsp;<span class="num" id="5970955">0x5a</span><span class="op" id="5970959">,</span>&nbsp;<span class="num" id="5970961">0x63</span><span class="op" id="5970965">,</span>&nbsp;<span class="num" id="5970967">0x64</span><span class="op" id="5970971">,</span>&nbsp;<span class="num" id="5970973">0x65</span><span class="op" id="5970977">,</span>&nbsp;<span class="num" id="5970979">0x66</span><span class="op" id="5970983">,</span>&nbsp;<span class="num" id="5970985">0x67</span><span class="op" id="5970989">,</span>&nbsp;<span class="num" id="5970991">0x68</span><span class="op" id="5970995">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971000">0x69</span><span class="op" id="5971004">,</span>&nbsp;<span class="num" id="5971006">0x6a</span><span class="op" id="5971010">,</span>&nbsp;<span class="num" id="5971012">0x73</span><span class="op" id="5971016">,</span>&nbsp;<span class="num" id="5971018">0x74</span><span class="op" id="5971022">,</span>&nbsp;<span class="num" id="5971024">0x75</span><span class="op" id="5971028">,</span>&nbsp;<span class="num" id="5971030">0x76</span><span class="op" id="5971034">,</span>&nbsp;<span class="num" id="5971036">0x77</span><span class="op" id="5971040">,</span>&nbsp;<span class="num" id="5971042">0x78</span><span class="op" id="5971046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971051">0x79</span><span class="op" id="5971055">,</span>&nbsp;<span class="num" id="5971057">0x7a</span><span class="op" id="5971061">,</span>&nbsp;<span class="num" id="5971063">0x82</span><span class="op" id="5971067">,</span>&nbsp;<span class="num" id="5971069">0x83</span><span class="op" id="5971073">,</span>&nbsp;<span class="num" id="5971075">0x84</span><span class="op" id="5971079">,</span>&nbsp;<span class="num" id="5971081">0x85</span><span class="op" id="5971085">,</span>&nbsp;<span class="num" id="5971087">0x86</span><span class="op" id="5971091">,</span>&nbsp;<span class="num" id="5971093">0x87</span><span class="op" id="5971097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971102">0x88</span><span class="op" id="5971106">,</span>&nbsp;<span class="num" id="5971108">0x89</span><span class="op" id="5971112">,</span>&nbsp;<span class="num" id="5971114">0x8a</span><span class="op" id="5971118">,</span>&nbsp;<span class="num" id="5971120">0x92</span><span class="op" id="5971124">,</span>&nbsp;<span class="num" id="5971126">0x93</span><span class="op" id="5971130">,</span>&nbsp;<span class="num" id="5971132">0x94</span><span class="op" id="5971136">,</span>&nbsp;<span class="num" id="5971138">0x95</span><span class="op" id="5971142">,</span>&nbsp;<span class="num" id="5971144">0x96</span><span class="op" id="5971148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971153">0x97</span><span class="op" id="5971157">,</span>&nbsp;<span class="num" id="5971159">0x98</span><span class="op" id="5971163">,</span>&nbsp;<span class="num" id="5971165">0x99</span><span class="op" id="5971169">,</span>&nbsp;<span class="num" id="5971171">0x9a</span><span class="op" id="5971175">,</span>&nbsp;<span class="num" id="5971177">0xa2</span><span class="op" id="5971181">,</span>&nbsp;<span class="num" id="5971183">0xa3</span><span class="op" id="5971187">,</span>&nbsp;<span class="num" id="5971189">0xa4</span><span class="op" id="5971193">,</span>&nbsp;<span class="num" id="5971195">0xa5</span><span class="op" id="5971199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971204">0xa6</span><span class="op" id="5971208">,</span>&nbsp;<span class="num" id="5971210">0xa7</span><span class="op" id="5971214">,</span>&nbsp;<span class="num" id="5971216">0xa8</span><span class="op" id="5971220">,</span>&nbsp;<span class="num" id="5971222">0xa9</span><span class="op" id="5971226">,</span>&nbsp;<span class="num" id="5971228">0xaa</span><span class="op" id="5971232">,</span>&nbsp;<span class="num" id="5971234">0xb2</span><span class="op" id="5971238">,</span>&nbsp;<span class="num" id="5971240">0xb3</span><span class="op" id="5971244">,</span>&nbsp;<span class="num" id="5971246">0xb4</span><span class="op" id="5971250">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971255">0xb5</span><span class="op" id="5971259">,</span>&nbsp;<span class="num" id="5971261">0xb6</span><span class="op" id="5971265">,</span>&nbsp;<span class="num" id="5971267">0xb7</span><span class="op" id="5971271">,</span>&nbsp;<span class="num" id="5971273">0xb8</span><span class="op" id="5971277">,</span>&nbsp;<span class="num" id="5971279">0xb9</span><span class="op" id="5971283">,</span>&nbsp;<span class="num" id="5971285">0xba</span><span class="op" id="5971289">,</span>&nbsp;<span class="num" id="5971291">0xc2</span><span class="op" id="5971295">,</span>&nbsp;<span class="num" id="5971297">0xc3</span><span class="op" id="5971301">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971306">0xc4</span><span class="op" id="5971310">,</span>&nbsp;<span class="num" id="5971312">0xc5</span><span class="op" id="5971316">,</span>&nbsp;<span class="num" id="5971318">0xc6</span><span class="op" id="5971322">,</span>&nbsp;<span class="num" id="5971324">0xc7</span><span class="op" id="5971328">,</span>&nbsp;<span class="num" id="5971330">0xc8</span><span class="op" id="5971334">,</span>&nbsp;<span class="num" id="5971336">0xc9</span><span class="op" id="5971340">,</span>&nbsp;<span class="num" id="5971342">0xca</span><span class="op" id="5971346">,</span>&nbsp;<span class="num" id="5971348">0xd2</span><span class="op" id="5971352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971357">0xd3</span><span class="op" id="5971361">,</span>&nbsp;<span class="num" id="5971363">0xd4</span><span class="op" id="5971367">,</span>&nbsp;<span class="num" id="5971369">0xd5</span><span class="op" id="5971373">,</span>&nbsp;<span class="num" id="5971375">0xd6</span><span class="op" id="5971379">,</span>&nbsp;<span class="num" id="5971381">0xd7</span><span class="op" id="5971385">,</span>&nbsp;<span class="num" id="5971387">0xd8</span><span class="op" id="5971391">,</span>&nbsp;<span class="num" id="5971393">0xd9</span><span class="op" id="5971397">,</span>&nbsp;<span class="num" id="5971399">0xda</span><span class="op" id="5971403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971408">0xe2</span><span class="op" id="5971412">,</span>&nbsp;<span class="num" id="5971414">0xe3</span><span class="op" id="5971418">,</span>&nbsp;<span class="num" id="5971420">0xe4</span><span class="op" id="5971424">,</span>&nbsp;<span class="num" id="5971426">0xe5</span><span class="op" id="5971430">,</span>&nbsp;<span class="num" id="5971432">0xe6</span><span class="op" id="5971436">,</span>&nbsp;<span class="num" id="5971438">0xe7</span><span class="op" id="5971442">,</span>&nbsp;<span class="num" id="5971444">0xe8</span><span class="op" id="5971448">,</span>&nbsp;<span class="num" id="5971450">0xe9</span><span class="op" id="5971454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971459">0xea</span><span class="op" id="5971463">,</span>&nbsp;<span class="num" id="5971465">0xf2</span><span class="op" id="5971469">,</span>&nbsp;<span class="num" id="5971471">0xf3</span><span class="op" id="5971475">,</span>&nbsp;<span class="num" id="5971477">0xf4</span><span class="op" id="5971481">,</span>&nbsp;<span class="num" id="5971483">0xf5</span><span class="op" id="5971487">,</span>&nbsp;<span class="num" id="5971489">0xf6</span><span class="op" id="5971493">,</span>&nbsp;<span class="num" id="5971495">0xf7</span><span class="op" id="5971499">,</span>&nbsp;<span class="num" id="5971501">0xf8</span><span class="op" id="5971505">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5971510">0xf9</span><span class="op" id="5971514">,</span>&nbsp;<span class="num" id="5971516">0xfa</span><span class="op" id="5971520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971524">}</span><span class="op" id="5971525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971528">}</span><span class="op" id="5971529">,</span><br>
<span class="lineno"></span><span class="op" id="5971531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="5971534">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="5971609">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5971686">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="5971764">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5971805">type</span>&nbsp;<span class="ident" id="5971810">huffmanLUT</span>&nbsp;<span class="op" id="5971821">[</span><span class="op" id="5971822">]</span><span class="builtintype" id="5971823">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="5971831">func</span>&nbsp;<span class="op" id="5971836">(</span><span class="ident" id="5971837">h</span>&nbsp;<span class="op" id="5971839">*</span><span class="ident" id="5971840">huffmanLUT</span><span class="op" id="5971850">)</span>&nbsp;<span class="ident" id="5971852">init</span><span class="op" id="5971856">(</span><span class="ident" id="5971857">s</span>&nbsp;<span class="ident" id="5971859">huffmanSpec</span><span class="op" id="5971870">)</span>&nbsp;<span class="op" id="5971872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971875">maxValue</span>&nbsp;<span class="op" id="5971884">:=</span>&nbsp;<span class="num" id="5971887">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971890">for</span>&nbsp;<span class="ident" id="5971894">_</span><span class="op" id="5971895">,</span>&nbsp;<span class="ident" id="5971897">v</span>&nbsp;<span class="op" id="5971899">:=</span>&nbsp;<span class="keyword" id="5971902">range</span>&nbsp;<span class="ident" id="5971908">s</span><span class="op" id="5971909">.</span><span class="ident" id="5971910">value</span>&nbsp;<span class="op" id="5971916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5971920">if</span>&nbsp;<span class="builtintype" id="5971923">int</span><span class="op" id="5971926">(</span><span class="ident" id="5971927">v</span><span class="op" id="5971928">)</span>&nbsp;<span class="op" id="5971930">&gt;</span>&nbsp;<span class="ident" id="5971932">maxValue</span>&nbsp;<span class="op" id="5971941">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5971946">maxValue</span>&nbsp;<span class="op" id="5971955">=</span>&nbsp;<span class="builtintype" id="5971957">int</span><span class="op" id="5971960">(</span><span class="ident" id="5971961">v</span><span class="op" id="5971962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5971972">*</span><span class="ident" id="5971973">h</span>&nbsp;<span class="op" id="5971975">=</span>&nbsp;<span class="builtinfunc" id="5971977">make</span><span class="op" id="5971981">(</span><span class="op" id="5971982">[</span><span class="op" id="5971983">]</span><span class="builtintype" id="5971984">uint32</span><span class="op" id="5971990">,</span>&nbsp;<span class="ident" id="5971992">maxValue</span><span class="op" id="5972000">+</span><span class="num" id="5972001">1</span><span class="op" id="5972002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972005">code</span><span class="op" id="5972009">,</span>&nbsp;<span class="ident" id="5972011">k</span>&nbsp;<span class="op" id="5972013">:=</span>&nbsp;<span class="builtintype" id="5972016">uint32</span><span class="op" id="5972022">(</span><span class="num" id="5972023">0</span><span class="op" id="5972024">)</span><span class="op" id="5972025">,</span>&nbsp;<span class="num" id="5972027">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972030">for</span>&nbsp;<span class="ident" id="5972034">i</span>&nbsp;<span class="op" id="5972036">:=</span>&nbsp;<span class="num" id="5972039">0</span><span class="op" id="5972040">;</span>&nbsp;<span class="ident" id="5972042">i</span>&nbsp;<span class="op" id="5972044">&lt;</span>&nbsp;<span class="builtinfunc" id="5972046">len</span><span class="op" id="5972049">(</span><span class="ident" id="5972050">s</span><span class="op" id="5972051">.</span><span class="ident" id="5972052">count</span><span class="op" id="5972057">)</span><span class="op" id="5972058">;</span>&nbsp;<span class="ident" id="5972060">i</span><span class="op" id="5972061">++</span>&nbsp;<span class="op" id="5972064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972068">nBits</span>&nbsp;<span class="op" id="5972074">:=</span>&nbsp;<span class="builtintype" id="5972077">uint32</span><span class="op" id="5972083">(</span><span class="ident" id="5972084">i</span><span class="op" id="5972085">+</span><span class="num" id="5972086">1</span><span class="op" id="5972087">)</span>&nbsp;<span class="op" id="5972089">&lt;&lt;</span>&nbsp;<span class="num" id="5972092">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972097">for</span>&nbsp;<span class="ident" id="5972101">j</span>&nbsp;<span class="op" id="5972103">:=</span>&nbsp;<span class="builtintype" id="5972106">uint8</span><span class="op" id="5972111">(</span><span class="num" id="5972112">0</span><span class="op" id="5972113">)</span><span class="op" id="5972114">;</span>&nbsp;<span class="ident" id="5972116">j</span>&nbsp;<span class="op" id="5972118">&lt;</span>&nbsp;<span class="ident" id="5972120">s</span><span class="op" id="5972121">.</span><span class="ident" id="5972122">count</span><span class="op" id="5972127">[</span><span class="ident" id="5972128">i</span><span class="op" id="5972129">]</span><span class="op" id="5972130">;</span>&nbsp;<span class="ident" id="5972132">j</span><span class="op" id="5972133">++</span>&nbsp;<span class="op" id="5972136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972141">(</span><span class="op" id="5972142">*</span><span class="ident" id="5972143">h</span><span class="op" id="5972144">)</span><span class="op" id="5972145">[</span><span class="ident" id="5972146">s</span><span class="op" id="5972147">.</span><span class="ident" id="5972148">value</span><span class="op" id="5972153">[</span><span class="ident" id="5972154">k</span><span class="op" id="5972155">]</span><span class="op" id="5972156">]</span>&nbsp;<span class="op" id="5972158">=</span>&nbsp;<span class="ident" id="5972160">nBits</span>&nbsp;<span class="op" id="5972166">|</span>&nbsp;<span class="ident" id="5972168">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972176">code</span><span class="op" id="5972180">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972186">k</span><span class="op" id="5972187">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972196">code</span>&nbsp;<span class="op" id="5972201">&lt;&lt;=</span>&nbsp;<span class="num" id="5972205">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972208">}</span><br>
<span class="lineno"></span><span class="op" id="5972210">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5972213">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="5972278">var</span>&nbsp;<span class="ident" id="5972282">theHuffmanLUT</span>&nbsp;<span class="op" id="5972296">[</span><span class="num" id="5972297">4</span><span class="op" id="5972298">]</span><span class="ident" id="5972299">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5972311">func</span>&nbsp;<span class="ident" id="5972316">init</span><span class="op" id="5972320">(</span><span class="op" id="5972321">)</span>&nbsp;<span class="op" id="5972323">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972326">for</span>&nbsp;<span class="ident" id="5972330">i</span><span class="op" id="5972331">,</span>&nbsp;<span class="ident" id="5972333">s</span>&nbsp;<span class="op" id="5972335">:=</span>&nbsp;<span class="keyword" id="5972338">range</span>&nbsp;<span class="ident" id="5972344">theHuffmanSpec</span>&nbsp;<span class="op" id="5972359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972363">theHuffmanLUT</span><span class="op" id="5972376">[</span><span class="ident" id="5972377">i</span><span class="op" id="5972378">]</span><span class="op" id="5972379">.</span><span class="ident" id="5972380">init</span><span class="op" id="5972384">(</span><span class="ident" id="5972385">s</span><span class="op" id="5972386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5972389">}</span><br>
<span class="lineno"></span><span class="op" id="5972391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="5972394">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5972426">type</span>&nbsp;<span class="ident" id="5972431">writer</span>&nbsp;<span class="keyword" id="5972438">interface</span>&nbsp;<span class="op" id="5972448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972451">Flush</span><span class="op" id="5972456">(</span><span class="op" id="5972457">)</span>&nbsp;<span class="builtintype" id="5972459">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972466">io</span><span class="op" id="5972468">.</span><span class="ident" id="5972469">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972477">io</span><span class="op" id="5972479">.</span><span class="ident" id="5972480">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="5972491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5972494">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="5972542">type</span>&nbsp;<span class="ident" id="5972547">encoder</span>&nbsp;<span class="keyword" id="5972555">struct</span>&nbsp;<span class="op" id="5972562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972565">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972640">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972711">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5972715">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972723">err</span>&nbsp;<span class="builtintype" id="5972727">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972734">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972763">buf</span>&nbsp;<span class="op" id="5972767">[</span><span class="num" id="5972768">16</span><span class="op" id="5972770">]</span><span class="builtintype" id="5972771">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972777">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972832">bits</span><span class="op" id="5972836">,</span>&nbsp;<span class="ident" id="5972838">nBits</span>&nbsp;<span class="builtintype" id="5972844">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5972852">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5972915">quant</span>&nbsp;<span class="op" id="5972921">[</span><span class="ident" id="5972922">nQuantIndex</span><span class="op" id="5972933">]</span><span class="op" id="5972934">[</span><span class="ident" id="5972935">blockSize</span><span class="op" id="5972944">]</span><span class="builtintype" id="5972945">byte</span><br>
<span class="lineno"></span><span class="op" id="5972950">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="5972953">func</span>&nbsp;<span class="op" id="5972958">(</span><span class="ident" id="5972959">e</span>&nbsp;<span class="op" id="5972961">*</span><span class="ident" id="5972962">encoder</span><span class="op" id="5972969">)</span>&nbsp;<span class="ident" id="5972971">flush</span><span class="op" id="5972976">(</span><span class="op" id="5972977">)</span>&nbsp;<span class="op" id="5972979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5972982">if</span>&nbsp;<span class="ident" id="5972985">e</span><span class="op" id="5972986">.</span><span class="ident" id="5972987">err</span>&nbsp;<span class="op" id="5972991">!=</span>&nbsp;<span class="ident" id="5972994">nil</span>&nbsp;<span class="op" id="5972998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973002">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973010">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973013">e</span><span class="op" id="5973014">.</span><span class="ident" id="5973015">err</span>&nbsp;<span class="op" id="5973019">=</span>&nbsp;<span class="ident" id="5973021">e</span><span class="op" id="5973022">.</span><span class="ident" id="5973023">w</span><span class="op" id="5973024">.</span><span class="ident" id="5973025">Flush</span><span class="op" id="5973030">(</span><span class="op" id="5973031">)</span><br>
<span class="lineno"></span><span class="op" id="5973033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5973036">func</span>&nbsp;<span class="op" id="5973041">(</span><span class="ident" id="5973042">e</span>&nbsp;<span class="op" id="5973044">*</span><span class="ident" id="5973045">encoder</span><span class="op" id="5973052">)</span>&nbsp;<span class="ident" id="5973054">write</span><span class="op" id="5973059">(</span><span class="ident" id="5973060">p</span>&nbsp;<span class="op" id="5973062">[</span><span class="op" id="5973063">]</span><span class="builtintype" id="5973064">byte</span><span class="op" id="5973068">)</span>&nbsp;<span class="op" id="5973070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973073">if</span>&nbsp;<span class="ident" id="5973076">e</span><span class="op" id="5973077">.</span><span class="ident" id="5973078">err</span>&nbsp;<span class="op" id="5973082">!=</span>&nbsp;<span class="ident" id="5973085">nil</span>&nbsp;<span class="op" id="5973089">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973104">_</span><span class="op" id="5973105">,</span>&nbsp;<span class="ident" id="5973107">e</span><span class="op" id="5973108">.</span><span class="ident" id="5973109">err</span>&nbsp;<span class="op" id="5973113">=</span>&nbsp;<span class="ident" id="5973115">e</span><span class="op" id="5973116">.</span><span class="ident" id="5973117">w</span><span class="op" id="5973118">.</span><span class="ident" id="5973119">Write</span><span class="op" id="5973124">(</span><span class="ident" id="5973125">p</span><span class="op" id="5973126">)</span><br>
<span class="lineno"></span><span class="op" id="5973128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="5973131">func</span>&nbsp;<span class="op" id="5973136">(</span><span class="ident" id="5973137">e</span>&nbsp;<span class="op" id="5973139">*</span><span class="ident" id="5973140">encoder</span><span class="op" id="5973147">)</span>&nbsp;<span class="ident" id="5973149">writeByte</span><span class="op" id="5973158">(</span><span class="ident" id="5973159">b</span>&nbsp;<span class="builtintype" id="5973161">byte</span><span class="op" id="5973165">)</span>&nbsp;<span class="op" id="5973167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973170">if</span>&nbsp;<span class="ident" id="5973173">e</span><span class="op" id="5973174">.</span><span class="ident" id="5973175">err</span>&nbsp;<span class="op" id="5973179">!=</span>&nbsp;<span class="ident" id="5973182">nil</span>&nbsp;<span class="op" id="5973186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973190">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973201">e</span><span class="op" id="5973202">.</span><span class="ident" id="5973203">err</span>&nbsp;<span class="op" id="5973207">=</span>&nbsp;<span class="ident" id="5973209">e</span><span class="op" id="5973210">.</span><span class="ident" id="5973211">w</span><span class="op" id="5973212">.</span><span class="ident" id="5973213">WriteByte</span><span class="op" id="5973222">(</span><span class="ident" id="5973223">b</span><span class="op" id="5973224">)</span><br>
<span class="lineno">250</span><span class="op" id="5973226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5973229">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="5973303">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="5973358">func</span>&nbsp;<span class="op" id="5973363">(</span><span class="ident" id="5973364">e</span>&nbsp;<span class="op" id="5973366">*</span><span class="ident" id="5973367">encoder</span><span class="op" id="5973374">)</span>&nbsp;<span class="ident" id="5973376">emit</span><span class="op" id="5973380">(</span><span class="ident" id="5973381">bits</span><span class="op" id="5973385">,</span>&nbsp;<span class="ident" id="5973387">nBits</span>&nbsp;<span class="builtintype" id="5973393">uint32</span><span class="op" id="5973399">)</span>&nbsp;<span class="op" id="5973401">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973404">nBits</span>&nbsp;<span class="op" id="5973410">+=</span>&nbsp;<span class="ident" id="5973413">e</span><span class="op" id="5973414">.</span><span class="ident" id="5973415">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973422">bits</span>&nbsp;<span class="op" id="5973427">&lt;&lt;=</span>&nbsp;<span class="num" id="5973431">32</span>&nbsp;<span class="op" id="5973434">-</span>&nbsp;<span class="ident" id="5973436">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973443">bits</span>&nbsp;<span class="op" id="5973448">|=</span>&nbsp;<span class="ident" id="5973451">e</span><span class="op" id="5973452">.</span><span class="ident" id="5973453">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973459">for</span>&nbsp;<span class="ident" id="5973463">nBits</span>&nbsp;<span class="op" id="5973469">&gt;=</span>&nbsp;<span class="num" id="5973472">8</span>&nbsp;<span class="op" id="5973474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973478">b</span>&nbsp;<span class="op" id="5973480">:=</span>&nbsp;<span class="builtintype" id="5973483">uint8</span><span class="op" id="5973488">(</span><span class="ident" id="5973489">bits</span>&nbsp;<span class="op" id="5973494">&gt;&gt;</span>&nbsp;<span class="num" id="5973497">24</span><span class="op" id="5973499">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973503">e</span><span class="op" id="5973504">.</span><span class="ident" id="5973505">writeByte</span><span class="op" id="5973514">(</span><span class="ident" id="5973515">b</span><span class="op" id="5973516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973520">if</span>&nbsp;<span class="ident" id="5973523">b</span>&nbsp;<span class="op" id="5973525">==</span>&nbsp;<span class="num" id="5973528">0xff</span>&nbsp;<span class="op" id="5973533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973538">e</span><span class="op" id="5973539">.</span><span class="ident" id="5973540">writeByte</span><span class="op" id="5973549">(</span><span class="num" id="5973550">0x00</span><span class="op" id="5973554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973562">bits</span>&nbsp;<span class="op" id="5973567">&lt;&lt;=</span>&nbsp;<span class="num" id="5973571">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973575">nBits</span>&nbsp;<span class="op" id="5973581">-=</span>&nbsp;<span class="num" id="5973584">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5973587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973590">e</span><span class="op" id="5973591">.</span><span class="ident" id="5973592">bits</span><span class="op" id="5973596">,</span>&nbsp;<span class="ident" id="5973598">e</span><span class="op" id="5973599">.</span><span class="ident" id="5973600">nBits</span>&nbsp;<span class="op" id="5973606">=</span>&nbsp;<span class="ident" id="5973608">bits</span><span class="op" id="5973612">,</span>&nbsp;<span class="ident" id="5973614">nBits</span><br>
<span class="lineno"></span><span class="op" id="5973620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="5973623">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5973689">func</span>&nbsp;<span class="op" id="5973694">(</span><span class="ident" id="5973695">e</span>&nbsp;<span class="op" id="5973697">*</span><span class="ident" id="5973698">encoder</span><span class="op" id="5973705">)</span>&nbsp;<span class="ident" id="5973707">emitHuff</span><span class="op" id="5973715">(</span><span class="ident" id="5973716">h</span>&nbsp;<span class="ident" id="5973718">huffIndex</span><span class="op" id="5973727">,</span>&nbsp;<span class="ident" id="5973729">value</span>&nbsp;<span class="builtintype" id="5973735">int32</span><span class="op" id="5973740">)</span>&nbsp;<span class="op" id="5973742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973745">x</span>&nbsp;<span class="op" id="5973747">:=</span>&nbsp;<span class="ident" id="5973750">theHuffmanLUT</span><span class="op" id="5973763">[</span><span class="ident" id="5973764">h</span><span class="op" id="5973765">]</span><span class="op" id="5973766">[</span><span class="ident" id="5973767">value</span><span class="op" id="5973772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973775">e</span><span class="op" id="5973776">.</span><span class="ident" id="5973777">emit</span><span class="op" id="5973781">(</span><span class="ident" id="5973782">x</span><span class="op" id="5973783">&amp;</span><span class="op" id="5973784">(</span><span class="num" id="5973785">1</span><span class="op" id="5973786">&lt;&lt;</span><span class="num" id="5973788">24</span><span class="op" id="5973790">-</span><span class="num" id="5973791">1</span><span class="op" id="5973792">)</span><span class="op" id="5973793">,</span>&nbsp;<span class="ident" id="5973795">x</span><span class="op" id="5973796">&gt;&gt;</span><span class="num" id="5973798">24</span><span class="op" id="5973800">)</span><br>
<span class="lineno"></span><span class="op" id="5973802">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="5973805">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5973884">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5973904">func</span>&nbsp;<span class="op" id="5973909">(</span><span class="ident" id="5973910">e</span>&nbsp;<span class="op" id="5973912">*</span><span class="ident" id="5973913">encoder</span><span class="op" id="5973920">)</span>&nbsp;<span class="ident" id="5973922">emitHuffRLE</span><span class="op" id="5973933">(</span><span class="ident" id="5973934">h</span>&nbsp;<span class="ident" id="5973936">huffIndex</span><span class="op" id="5973945">,</span>&nbsp;<span class="ident" id="5973947">runLength</span><span class="op" id="5973956">,</span>&nbsp;<span class="ident" id="5973958">value</span>&nbsp;<span class="builtintype" id="5973964">int32</span><span class="op" id="5973969">)</span>&nbsp;<span class="op" id="5973971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5973974">a</span><span class="op" id="5973975">,</span>&nbsp;<span class="ident" id="5973977">b</span>&nbsp;<span class="op" id="5973979">:=</span>&nbsp;<span class="ident" id="5973982">value</span><span class="op" id="5973987">,</span>&nbsp;<span class="ident" id="5973989">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5973996">if</span>&nbsp;<span class="ident" id="5973999">a</span>&nbsp;<span class="op" id="5974001">&lt;</span>&nbsp;<span class="num" id="5974003">0</span>&nbsp;<span class="op" id="5974005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974009">a</span><span class="op" id="5974010">,</span>&nbsp;<span class="ident" id="5974012">b</span>&nbsp;<span class="op" id="5974014">=</span>&nbsp;<span class="op" id="5974016">-</span><span class="ident" id="5974017">value</span><span class="op" id="5974022">,</span>&nbsp;<span class="ident" id="5974024">value</span><span class="op" id="5974029">-</span><span class="num" id="5974030">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974036">var</span>&nbsp;<span class="ident" id="5974040">nBits</span>&nbsp;<span class="builtintype" id="5974046">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974054">if</span>&nbsp;<span class="ident" id="5974057">a</span>&nbsp;<span class="op" id="5974059">&lt;</span>&nbsp;<span class="num" id="5974061">0x100</span>&nbsp;<span class="op" id="5974067">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974071">nBits</span>&nbsp;<span class="op" id="5974077">=</span>&nbsp;<span class="builtintype" id="5974079">uint32</span><span class="op" id="5974085">(</span><span class="ident" id="5974086">bitCount</span><span class="op" id="5974094">[</span><span class="ident" id="5974095">a</span><span class="op" id="5974096">]</span><span class="op" id="5974097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974100">}</span>&nbsp;<span class="keyword" id="5974102">else</span>&nbsp;<span class="op" id="5974107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974111">nBits</span>&nbsp;<span class="op" id="5974117">=</span>&nbsp;<span class="num" id="5974119">8</span>&nbsp;<span class="op" id="5974121">+</span>&nbsp;<span class="builtintype" id="5974123">uint32</span><span class="op" id="5974129">(</span><span class="ident" id="5974130">bitCount</span><span class="op" id="5974138">[</span><span class="ident" id="5974139">a</span><span class="op" id="5974140">&gt;&gt;</span><span class="num" id="5974142">8</span><span class="op" id="5974143">]</span><span class="op" id="5974144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974150">e</span><span class="op" id="5974151">.</span><span class="ident" id="5974152">emitHuff</span><span class="op" id="5974160">(</span><span class="ident" id="5974161">h</span><span class="op" id="5974162">,</span>&nbsp;<span class="ident" id="5974164">runLength</span><span class="op" id="5974173">&lt;&lt;</span><span class="num" id="5974175">4</span><span class="op" id="5974176">|</span><span class="builtintype" id="5974177">int32</span><span class="op" id="5974182">(</span><span class="ident" id="5974183">nBits</span><span class="op" id="5974188">)</span><span class="op" id="5974189">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974192">if</span>&nbsp;<span class="ident" id="5974195">nBits</span>&nbsp;<span class="op" id="5974201">&gt;</span>&nbsp;<span class="num" id="5974203">0</span>&nbsp;<span class="op" id="5974205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974209">e</span><span class="op" id="5974210">.</span><span class="ident" id="5974211">emit</span><span class="op" id="5974215">(</span><span class="builtintype" id="5974216">uint32</span><span class="op" id="5974222">(</span><span class="ident" id="5974223">b</span><span class="op" id="5974224">)</span><span class="op" id="5974225">&amp;</span><span class="op" id="5974226">(</span><span class="num" id="5974227">1</span><span class="op" id="5974228">&lt;&lt;</span><span class="ident" id="5974230">nBits</span><span class="op" id="5974235">-</span><span class="num" id="5974236">1</span><span class="op" id="5974237">)</span><span class="op" id="5974238">,</span>&nbsp;<span class="ident" id="5974240">nBits</span><span class="op" id="5974245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974248">}</span><br>
<span class="lineno"></span><span class="op" id="5974250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="5974253">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5974328">func</span>&nbsp;<span class="op" id="5974333">(</span><span class="ident" id="5974334">e</span>&nbsp;<span class="op" id="5974336">*</span><span class="ident" id="5974337">encoder</span><span class="op" id="5974344">)</span>&nbsp;<span class="ident" id="5974346">writeMarkerHeader</span><span class="op" id="5974363">(</span><span class="ident" id="5974364">marker</span>&nbsp;<span class="builtintype" id="5974371">uint8</span><span class="op" id="5974376">,</span>&nbsp;<span class="ident" id="5974378">markerlen</span>&nbsp;<span class="builtintype" id="5974388">int</span><span class="op" id="5974391">)</span>&nbsp;<span class="op" id="5974393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974396">e</span><span class="op" id="5974397">.</span><span class="ident" id="5974398">buf</span><span class="op" id="5974401">[</span><span class="num" id="5974402">0</span><span class="op" id="5974403">]</span>&nbsp;<span class="op" id="5974405">=</span>&nbsp;<span class="num" id="5974407">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974413">e</span><span class="op" id="5974414">.</span><span class="ident" id="5974415">buf</span><span class="op" id="5974418">[</span><span class="num" id="5974419">1</span><span class="op" id="5974420">]</span>&nbsp;<span class="op" id="5974422">=</span>&nbsp;<span class="ident" id="5974424">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974432">e</span><span class="op" id="5974433">.</span><span class="ident" id="5974434">buf</span><span class="op" id="5974437">[</span><span class="num" id="5974438">2</span><span class="op" id="5974439">]</span>&nbsp;<span class="op" id="5974441">=</span>&nbsp;<span class="builtintype" id="5974443">uint8</span><span class="op" id="5974448">(</span><span class="ident" id="5974449">markerlen</span>&nbsp;<span class="op" id="5974459">&gt;&gt;</span>&nbsp;<span class="num" id="5974462">8</span><span class="op" id="5974463">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974466">e</span><span class="op" id="5974467">.</span><span class="ident" id="5974468">buf</span><span class="op" id="5974471">[</span><span class="num" id="5974472">3</span><span class="op" id="5974473">]</span>&nbsp;<span class="op" id="5974475">=</span>&nbsp;<span class="builtintype" id="5974477">uint8</span><span class="op" id="5974482">(</span><span class="ident" id="5974483">markerlen</span>&nbsp;<span class="op" id="5974493">&amp;</span>&nbsp;<span class="num" id="5974495">0xff</span><span class="op" id="5974499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974502">e</span><span class="op" id="5974503">.</span><span class="ident" id="5974504">write</span><span class="op" id="5974509">(</span><span class="ident" id="5974510">e</span><span class="op" id="5974511">.</span><span class="ident" id="5974512">buf</span><span class="op" id="5974515">[</span><span class="op" id="5974516">:</span><span class="num" id="5974517">4</span><span class="op" id="5974518">]</span><span class="op" id="5974519">)</span><br>
<span class="lineno"></span><span class="op" id="5974521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974524">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="5974581">func</span>&nbsp;<span class="op" id="5974586">(</span><span class="ident" id="5974587">e</span>&nbsp;<span class="op" id="5974589">*</span><span class="ident" id="5974590">encoder</span><span class="op" id="5974597">)</span>&nbsp;<span class="ident" id="5974599">writeDQT</span><span class="op" id="5974607">(</span><span class="op" id="5974608">)</span>&nbsp;<span class="op" id="5974610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974613">const</span>&nbsp;<span class="ident" id="5974619">markerlen</span>&nbsp;<span class="op" id="5974629">=</span>&nbsp;<span class="num" id="5974631">2</span>&nbsp;<span class="op" id="5974633">+</span>&nbsp;<span class="builtintype" id="5974635">int</span><span class="op" id="5974638">(</span><span class="ident" id="5974639">nQuantIndex</span><span class="op" id="5974650">)</span><span class="op" id="5974651">*</span><span class="op" id="5974652">(</span><span class="num" id="5974653">1</span><span class="op" id="5974654">+</span><span class="ident" id="5974655">blockSize</span><span class="op" id="5974664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974667">e</span><span class="op" id="5974668">.</span><span class="ident" id="5974669">writeMarkerHeader</span><span class="op" id="5974686">(</span><span class="ident" id="5974687">dqtMarker</span><span class="op" id="5974696">,</span>&nbsp;<span class="ident" id="5974698">markerlen</span><span class="op" id="5974707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5974710">for</span>&nbsp;<span class="ident" id="5974714">i</span>&nbsp;<span class="op" id="5974716">:=</span>&nbsp;<span class="keyword" id="5974719">range</span>&nbsp;<span class="ident" id="5974725">e</span><span class="op" id="5974726">.</span><span class="ident" id="5974727">quant</span>&nbsp;<span class="op" id="5974733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974737">e</span><span class="op" id="5974738">.</span><span class="ident" id="5974739">writeByte</span><span class="op" id="5974748">(</span><span class="builtintype" id="5974749">uint8</span><span class="op" id="5974754">(</span><span class="ident" id="5974755">i</span><span class="op" id="5974756">)</span><span class="op" id="5974757">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974761">e</span><span class="op" id="5974762">.</span><span class="ident" id="5974763">write</span><span class="op" id="5974768">(</span><span class="ident" id="5974769">e</span><span class="op" id="5974770">.</span><span class="ident" id="5974771">quant</span><span class="op" id="5974776">[</span><span class="ident" id="5974777">i</span><span class="op" id="5974778">]</span><span class="op" id="5974779">[</span><span class="op" id="5974780">:</span><span class="op" id="5974781">]</span><span class="op" id="5974782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5974785">}</span><br>
<span class="lineno"></span><span class="op" id="5974787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5974790">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="5974848">func</span>&nbsp;<span class="op" id="5974853">(</span><span class="ident" id="5974854">e</span>&nbsp;<span class="op" id="5974856">*</span><span class="ident" id="5974857">encoder</span><span class="op" id="5974864">)</span>&nbsp;<span class="ident" id="5974866">writeSOF0</span><span class="op" id="5974875">(</span><span class="ident" id="5974876">size</span>&nbsp;<span class="ident" id="5974881">image</span><span class="op" id="5974886">.</span><span class="ident" id="5974887">Point</span><span class="op" id="5974892">,</span>&nbsp;<span class="ident" id="5974894">nComponent</span>&nbsp;<span class="builtintype" id="5974905">int</span><span class="op" id="5974908">)</span>&nbsp;<span class="op" id="5974910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974913">markerlen</span>&nbsp;<span class="op" id="5974923">:=</span>&nbsp;<span class="num" id="5974926">8</span>&nbsp;<span class="op" id="5974928">+</span>&nbsp;<span class="num" id="5974930">3</span><span class="op" id="5974931">*</span><span class="ident" id="5974932">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974944">e</span><span class="op" id="5974945">.</span><span class="ident" id="5974946">writeMarkerHeader</span><span class="op" id="5974963">(</span><span class="ident" id="5974964">sof0Marker</span><span class="op" id="5974974">,</span>&nbsp;<span class="ident" id="5974976">markerlen</span><span class="op" id="5974985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5974988">e</span><span class="op" id="5974989">.</span><span class="ident" id="5974990">buf</span><span class="op" id="5974993">[</span><span class="num" id="5974994">0</span><span class="op" id="5974995">]</span>&nbsp;<span class="op" id="5974997">=</span>&nbsp;<span class="num" id="5974999">8</span>&nbsp;<span class="comment" id="5975001">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975018">e</span><span class="op" id="5975019">.</span><span class="ident" id="5975020">buf</span><span class="op" id="5975023">[</span><span class="num" id="5975024">1</span><span class="op" id="5975025">]</span>&nbsp;<span class="op" id="5975027">=</span>&nbsp;<span class="builtintype" id="5975029">uint8</span><span class="op" id="5975034">(</span><span class="ident" id="5975035">size</span><span class="op" id="5975039">.</span><span class="ident" id="5975040">Y</span>&nbsp;<span class="op" id="5975042">&gt;&gt;</span>&nbsp;<span class="num" id="5975045">8</span><span class="op" id="5975046">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975049">e</span><span class="op" id="5975050">.</span><span class="ident" id="5975051">buf</span><span class="op" id="5975054">[</span><span class="num" id="5975055">2</span><span class="op" id="5975056">]</span>&nbsp;<span class="op" id="5975058">=</span>&nbsp;<span class="builtintype" id="5975060">uint8</span><span class="op" id="5975065">(</span><span class="ident" id="5975066">size</span><span class="op" id="5975070">.</span><span class="ident" id="5975071">Y</span>&nbsp;<span class="op" id="5975073">&amp;</span>&nbsp;<span class="num" id="5975075">0xff</span><span class="op" id="5975079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975082">e</span><span class="op" id="5975083">.</span><span class="ident" id="5975084">buf</span><span class="op" id="5975087">[</span><span class="num" id="5975088">3</span><span class="op" id="5975089">]</span>&nbsp;<span class="op" id="5975091">=</span>&nbsp;<span class="builtintype" id="5975093">uint8</span><span class="op" id="5975098">(</span><span class="ident" id="5975099">size</span><span class="op" id="5975103">.</span><span class="ident" id="5975104">X</span>&nbsp;<span class="op" id="5975106">&gt;&gt;</span>&nbsp;<span class="num" id="5975109">8</span><span class="op" id="5975110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975113">e</span><span class="op" id="5975114">.</span><span class="ident" id="5975115">buf</span><span class="op" id="5975118">[</span><span class="num" id="5975119">4</span><span class="op" id="5975120">]</span>&nbsp;<span class="op" id="5975122">=</span>&nbsp;<span class="builtintype" id="5975124">uint8</span><span class="op" id="5975129">(</span><span class="ident" id="5975130">size</span><span class="op" id="5975134">.</span><span class="ident" id="5975135">X</span>&nbsp;<span class="op" id="5975137">&amp;</span>&nbsp;<span class="num" id="5975139">0xff</span><span class="op" id="5975143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975146">e</span><span class="op" id="5975147">.</span><span class="ident" id="5975148">buf</span><span class="op" id="5975151">[</span><span class="num" id="5975152">5</span><span class="op" id="5975153">]</span>&nbsp;<span class="op" id="5975155">=</span>&nbsp;<span class="builtintype" id="5975157">uint8</span><span class="op" id="5975162">(</span><span class="ident" id="5975163">nComponent</span><span class="op" id="5975173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975176">if</span>&nbsp;<span class="ident" id="5975179">nComponent</span>&nbsp;<span class="op" id="5975190">==</span>&nbsp;<span class="num" id="5975193">1</span>&nbsp;<span class="op" id="5975195">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975199">e</span><span class="op" id="5975200">.</span><span class="ident" id="5975201">buf</span><span class="op" id="5975204">[</span><span class="num" id="5975205">6</span><span class="op" id="5975206">]</span>&nbsp;<span class="op" id="5975208">=</span>&nbsp;<span class="num" id="5975210">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975214">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975255">e</span><span class="op" id="5975256">.</span><span class="ident" id="5975257">buf</span><span class="op" id="5975260">[</span><span class="num" id="5975261">7</span><span class="op" id="5975262">]</span>&nbsp;<span class="op" id="5975264">=</span>&nbsp;<span class="num" id="5975266">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975273">e</span><span class="op" id="5975274">.</span><span class="ident" id="5975275">buf</span><span class="op" id="5975278">[</span><span class="num" id="5975279">8</span><span class="op" id="5975280">]</span>&nbsp;<span class="op" id="5975282">=</span>&nbsp;<span class="num" id="5975284">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975290">}</span>&nbsp;<span class="keyword" id="5975292">else</span>&nbsp;<span class="op" id="5975297">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975301">for</span>&nbsp;<span class="ident" id="5975305">i</span>&nbsp;<span class="op" id="5975307">:=</span>&nbsp;<span class="num" id="5975310">0</span><span class="op" id="5975311">;</span>&nbsp;<span class="ident" id="5975313">i</span>&nbsp;<span class="op" id="5975315">&lt;</span>&nbsp;<span class="ident" id="5975317">nComponent</span><span class="op" id="5975327">;</span>&nbsp;<span class="ident" id="5975329">i</span><span class="op" id="5975330">++</span>&nbsp;<span class="op" id="5975333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975338">e</span><span class="op" id="5975339">.</span><span class="ident" id="5975340">buf</span><span class="op" id="5975343">[</span><span class="num" id="5975344">3</span><span class="op" id="5975345">*</span><span class="ident" id="5975346">i</span><span class="op" id="5975347">+</span><span class="num" id="5975348">6</span><span class="op" id="5975349">]</span>&nbsp;<span class="op" id="5975351">=</span>&nbsp;<span class="builtintype" id="5975353">uint8</span><span class="op" id="5975358">(</span><span class="ident" id="5975359">i</span>&nbsp;<span class="op" id="5975361">+</span>&nbsp;<span class="num" id="5975363">1</span><span class="op" id="5975364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975369">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975408">e</span><span class="op" id="5975409">.</span><span class="ident" id="5975410">buf</span><span class="op" id="5975413">[</span><span class="num" id="5975414">3</span><span class="op" id="5975415">*</span><span class="ident" id="5975416">i</span><span class="op" id="5975417">+</span><span class="num" id="5975418">7</span><span class="op" id="5975419">]</span>&nbsp;<span class="op" id="5975421">=</span>&nbsp;<span class="string" id="5975423">&#34;\x22\x11\x11&#34;</span><span class="op" id="5975437">[</span><span class="ident" id="5975438">i</span><span class="op" id="5975439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975444">e</span><span class="op" id="5975445">.</span><span class="ident" id="5975446">buf</span><span class="op" id="5975449">[</span><span class="num" id="5975450">3</span><span class="op" id="5975451">*</span><span class="ident" id="5975452">i</span><span class="op" id="5975453">+</span><span class="num" id="5975454">8</span><span class="op" id="5975455">]</span>&nbsp;<span class="op" id="5975457">=</span>&nbsp;<span class="string" id="5975459">&#34;\x00\x01\x01&#34;</span><span class="op" id="5975473">[</span><span class="ident" id="5975474">i</span><span class="op" id="5975475">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975485">e</span><span class="op" id="5975486">.</span><span class="ident" id="5975487">write</span><span class="op" id="5975492">(</span><span class="ident" id="5975493">e</span><span class="op" id="5975494">.</span><span class="ident" id="5975495">buf</span><span class="op" id="5975498">[</span><span class="op" id="5975499">:</span><span class="num" id="5975500">3</span><span class="op" id="5975501">*</span><span class="op" id="5975502">(</span><span class="ident" id="5975503">nComponent</span><span class="op" id="5975513">-</span><span class="num" id="5975514">1</span><span class="op" id="5975515">)</span><span class="op" id="5975516">+</span><span class="num" id="5975517">9</span><span class="op" id="5975518">]</span><span class="op" id="5975519">)</span><br>
<span class="lineno"></span><span class="op" id="5975521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="5975524">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="5975576">func</span>&nbsp;<span class="op" id="5975581">(</span><span class="ident" id="5975582">e</span>&nbsp;<span class="op" id="5975584">*</span><span class="ident" id="5975585">encoder</span><span class="op" id="5975592">)</span>&nbsp;<span class="ident" id="5975594">writeDHT</span><span class="op" id="5975602">(</span><span class="ident" id="5975603">nComponent</span>&nbsp;<span class="builtintype" id="5975614">int</span><span class="op" id="5975617">)</span>&nbsp;<span class="op" id="5975619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975622">markerlen</span>&nbsp;<span class="op" id="5975632">:=</span>&nbsp;<span class="num" id="5975635">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975638">specs</span>&nbsp;<span class="op" id="5975644">:=</span>&nbsp;<span class="ident" id="5975647">theHuffmanSpec</span><span class="op" id="5975661">[</span><span class="op" id="5975662">:</span><span class="op" id="5975663">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975666">if</span>&nbsp;<span class="ident" id="5975669">nComponent</span>&nbsp;<span class="op" id="5975680">==</span>&nbsp;<span class="num" id="5975683">1</span>&nbsp;<span class="op" id="5975685">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5975689">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975723">specs</span>&nbsp;<span class="op" id="5975729">=</span>&nbsp;<span class="ident" id="5975731">specs</span><span class="op" id="5975736">[</span><span class="op" id="5975737">:</span><span class="num" id="5975738">2</span><span class="op" id="5975739">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975745">for</span>&nbsp;<span class="ident" id="5975749">_</span><span class="op" id="5975750">,</span>&nbsp;<span class="ident" id="5975752">s</span>&nbsp;<span class="op" id="5975754">:=</span>&nbsp;<span class="keyword" id="5975757">range</span>&nbsp;<span class="ident" id="5975763">specs</span>&nbsp;<span class="op" id="5975769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975773">markerlen</span>&nbsp;<span class="op" id="5975783">+=</span>&nbsp;<span class="num" id="5975786">1</span>&nbsp;<span class="op" id="5975788">+</span>&nbsp;<span class="num" id="5975790">16</span>&nbsp;<span class="op" id="5975793">+</span>&nbsp;<span class="builtinfunc" id="5975795">len</span><span class="op" id="5975798">(</span><span class="ident" id="5975799">s</span><span class="op" id="5975800">.</span><span class="ident" id="5975801">value</span><span class="op" id="5975806">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975812">e</span><span class="op" id="5975813">.</span><span class="ident" id="5975814">writeMarkerHeader</span><span class="op" id="5975831">(</span><span class="ident" id="5975832">dhtMarker</span><span class="op" id="5975841">,</span>&nbsp;<span class="ident" id="5975843">markerlen</span><span class="op" id="5975852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5975855">for</span>&nbsp;<span class="ident" id="5975859">i</span><span class="op" id="5975860">,</span>&nbsp;<span class="ident" id="5975862">s</span>&nbsp;<span class="op" id="5975864">:=</span>&nbsp;<span class="keyword" id="5975867">range</span>&nbsp;<span class="ident" id="5975873">specs</span>&nbsp;<span class="op" id="5975879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975883">e</span><span class="op" id="5975884">.</span><span class="ident" id="5975885">writeByte</span><span class="op" id="5975894">(</span><span class="string" id="5975895">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="5975913">[</span><span class="ident" id="5975914">i</span><span class="op" id="5975915">]</span><span class="op" id="5975916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975920">e</span><span class="op" id="5975921">.</span><span class="ident" id="5975922">write</span><span class="op" id="5975927">(</span><span class="ident" id="5975928">s</span><span class="op" id="5975929">.</span><span class="ident" id="5975930">count</span><span class="op" id="5975935">[</span><span class="op" id="5975936">:</span><span class="op" id="5975937">]</span><span class="op" id="5975938">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5975942">e</span><span class="op" id="5975943">.</span><span class="ident" id="5975944">write</span><span class="op" id="5975949">(</span><span class="ident" id="5975950">s</span><span class="op" id="5975951">.</span><span class="ident" id="5975952">value</span><span class="op" id="5975957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5975960">}</span><br>
<span class="lineno"></span><span class="op" id="5975962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5975965">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="5976044">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5976123">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="5976155">func</span>&nbsp;<span class="op" id="5976160">(</span><span class="ident" id="5976161">e</span>&nbsp;<span class="op" id="5976163">*</span><span class="ident" id="5976164">encoder</span><span class="op" id="5976171">)</span>&nbsp;<span class="ident" id="5976173">writeBlock</span><span class="op" id="5976183">(</span><span class="ident" id="5976184">b</span>&nbsp;<span class="op" id="5976186">*</span><span class="ident" id="5976187">block</span><span class="op" id="5976192">,</span>&nbsp;<span class="ident" id="5976194">q</span>&nbsp;<span class="ident" id="5976196">quantIndex</span><span class="op" id="5976206">,</span>&nbsp;<span class="ident" id="5976208">prevDC</span>&nbsp;<span class="builtintype" id="5976215">int32</span><span class="op" id="5976220">)</span>&nbsp;<span class="builtintype" id="5976222">int32</span>&nbsp;<span class="op" id="5976228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976231">fdct</span><span class="op" id="5976235">(</span><span class="ident" id="5976236">b</span><span class="op" id="5976237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976240">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976263">dc</span>&nbsp;<span class="op" id="5976266">:=</span>&nbsp;<span class="ident" id="5976269">div</span><span class="op" id="5976272">(</span><span class="ident" id="5976273">b</span><span class="op" id="5976274">[</span><span class="num" id="5976275">0</span><span class="op" id="5976276">]</span><span class="op" id="5976277">,</span>&nbsp;<span class="num" id="5976279">8</span><span class="op" id="5976280">*</span><span class="builtintype" id="5976281">int32</span><span class="op" id="5976286">(</span><span class="ident" id="5976287">e</span><span class="op" id="5976288">.</span><span class="ident" id="5976289">quant</span><span class="op" id="5976294">[</span><span class="ident" id="5976295">q</span><span class="op" id="5976296">]</span><span class="op" id="5976297">[</span><span class="num" id="5976298">0</span><span class="op" id="5976299">]</span><span class="op" id="5976300">)</span><span class="op" id="5976301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976304">e</span><span class="op" id="5976305">.</span><span class="ident" id="5976306">emitHuffRLE</span><span class="op" id="5976317">(</span><span class="ident" id="5976318">huffIndex</span><span class="op" id="5976327">(</span><span class="num" id="5976328">2</span><span class="op" id="5976329">*</span><span class="ident" id="5976330">q</span><span class="op" id="5976331">+</span><span class="num" id="5976332">0</span><span class="op" id="5976333">)</span><span class="op" id="5976334">,</span>&nbsp;<span class="num" id="5976336">0</span><span class="op" id="5976337">,</span>&nbsp;<span class="ident" id="5976339">dc</span><span class="op" id="5976341">-</span><span class="ident" id="5976342">prevDC</span><span class="op" id="5976348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5976351">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976379">h</span><span class="op" id="5976380">,</span>&nbsp;<span class="ident" id="5976382">runLength</span>&nbsp;<span class="op" id="5976392">:=</span>&nbsp;<span class="ident" id="5976395">huffIndex</span><span class="op" id="5976404">(</span><span class="num" id="5976405">2</span><span class="op" id="5976406">*</span><span class="ident" id="5976407">q</span><span class="op" id="5976408">+</span><span class="num" id="5976409">1</span><span class="op" id="5976410">)</span><span class="op" id="5976411">,</span>&nbsp;<span class="builtintype" id="5976413">int32</span><span class="op" id="5976418">(</span><span class="num" id="5976419">0</span><span class="op" id="5976420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976423">for</span>&nbsp;<span class="ident" id="5976427">zig</span>&nbsp;<span class="op" id="5976431">:=</span>&nbsp;<span class="num" id="5976434">1</span><span class="op" id="5976435">;</span>&nbsp;<span class="ident" id="5976437">zig</span>&nbsp;<span class="op" id="5976441">&lt;</span>&nbsp;<span class="ident" id="5976443">blockSize</span><span class="op" id="5976452">;</span>&nbsp;<span class="ident" id="5976454">zig</span><span class="op" id="5976457">++</span>&nbsp;<span class="op" id="5976460">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976464">ac</span>&nbsp;<span class="op" id="5976467">:=</span>&nbsp;<span class="ident" id="5976470">div</span><span class="op" id="5976473">(</span><span class="ident" id="5976474">b</span><span class="op" id="5976475">[</span><span class="ident" id="5976476">unzig</span><span class="op" id="5976481">[</span><span class="ident" id="5976482">zig</span><span class="op" id="5976485">]</span><span class="op" id="5976486">]</span><span class="op" id="5976487">,</span>&nbsp;<span class="num" id="5976489">8</span><span class="op" id="5976490">*</span><span class="builtintype" id="5976491">int32</span><span class="op" id="5976496">(</span><span class="ident" id="5976497">e</span><span class="op" id="5976498">.</span><span class="ident" id="5976499">quant</span><span class="op" id="5976504">[</span><span class="ident" id="5976505">q</span><span class="op" id="5976506">]</span><span class="op" id="5976507">[</span><span class="ident" id="5976508">zig</span><span class="op" id="5976511">]</span><span class="op" id="5976512">)</span><span class="op" id="5976513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976517">if</span>&nbsp;<span class="ident" id="5976520">ac</span>&nbsp;<span class="op" id="5976523">==</span>&nbsp;<span class="num" id="5976526">0</span>&nbsp;<span class="op" id="5976528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976533">runLength</span><span class="op" id="5976542">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976547">}</span>&nbsp;<span class="keyword" id="5976549">else</span>&nbsp;<span class="op" id="5976554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976559">for</span>&nbsp;<span class="ident" id="5976563">runLength</span>&nbsp;<span class="op" id="5976573">&gt;</span>&nbsp;<span class="num" id="5976575">15</span>&nbsp;<span class="op" id="5976578">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976584">e</span><span class="op" id="5976585">.</span><span class="ident" id="5976586">emitHuff</span><span class="op" id="5976594">(</span><span class="ident" id="5976595">h</span><span class="op" id="5976596">,</span>&nbsp;<span class="num" id="5976598">0xf0</span><span class="op" id="5976602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976608">runLength</span>&nbsp;<span class="op" id="5976618">-=</span>&nbsp;<span class="num" id="5976621">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976632">e</span><span class="op" id="5976633">.</span><span class="ident" id="5976634">emitHuffRLE</span><span class="op" id="5976645">(</span><span class="ident" id="5976646">h</span><span class="op" id="5976647">,</span>&nbsp;<span class="ident" id="5976649">runLength</span><span class="op" id="5976658">,</span>&nbsp;<span class="ident" id="5976660">ac</span><span class="op" id="5976662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976667">runLength</span>&nbsp;<span class="op" id="5976677">=</span>&nbsp;<span class="num" id="5976679">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976689">if</span>&nbsp;<span class="ident" id="5976692">runLength</span>&nbsp;<span class="op" id="5976702">&gt;</span>&nbsp;<span class="num" id="5976704">0</span>&nbsp;<span class="op" id="5976706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976710">e</span><span class="op" id="5976711">.</span><span class="ident" id="5976712">emitHuff</span><span class="op" id="5976720">(</span><span class="ident" id="5976721">h</span><span class="op" id="5976722">,</span>&nbsp;<span class="num" id="5976724">0x00</span><span class="op" id="5976728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5976731">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976734">return</span>&nbsp;<span class="ident" id="5976741">dc</span><br>
<span class="lineno"></span><span class="op" id="5976744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5976747">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5976821">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="5976838">func</span>&nbsp;<span class="ident" id="5976843">toYCbCr</span><span class="op" id="5976850">(</span><span class="ident" id="5976851">m</span>&nbsp;<span class="ident" id="5976853">image</span><span class="op" id="5976858">.</span><span class="ident" id="5976859">Image</span><span class="op" id="5976864">,</span>&nbsp;<span class="ident" id="5976866">p</span>&nbsp;<span class="ident" id="5976868">image</span><span class="op" id="5976873">.</span><span class="ident" id="5976874">Point</span><span class="op" id="5976879">,</span>&nbsp;<span class="ident" id="5976881">yBlock</span><span class="op" id="5976887">,</span>&nbsp;<span class="ident" id="5976889">cbBlock</span><span class="op" id="5976896">,</span>&nbsp;<span class="ident" id="5976898">crBlock</span>&nbsp;<span class="op" id="5976906">*</span><span class="ident" id="5976907">block</span><span class="op" id="5976912">)</span>&nbsp;<span class="op" id="5976914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976917">b</span>&nbsp;<span class="op" id="5976919">:=</span>&nbsp;<span class="ident" id="5976922">m</span><span class="op" id="5976923">.</span><span class="ident" id="5976924">Bounds</span><span class="op" id="5976930">(</span><span class="op" id="5976931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976934">xmax</span>&nbsp;<span class="op" id="5976939">:=</span>&nbsp;<span class="ident" id="5976942">b</span><span class="op" id="5976943">.</span><span class="ident" id="5976944">Max</span><span class="op" id="5976947">.</span><span class="ident" id="5976948">X</span>&nbsp;<span class="op" id="5976950">-</span>&nbsp;<span class="num" id="5976952">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5976955">ymax</span>&nbsp;<span class="op" id="5976960">:=</span>&nbsp;<span class="ident" id="5976963">b</span><span class="op" id="5976964">.</span><span class="ident" id="5976965">Max</span><span class="op" id="5976968">.</span><span class="ident" id="5976969">Y</span>&nbsp;<span class="op" id="5976971">-</span>&nbsp;<span class="num" id="5976973">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5976976">for</span>&nbsp;<span class="ident" id="5976980">j</span>&nbsp;<span class="op" id="5976982">:=</span>&nbsp;<span class="num" id="5976985">0</span><span class="op" id="5976986">;</span>&nbsp;<span class="ident" id="5976988">j</span>&nbsp;<span class="op" id="5976990">&lt;</span>&nbsp;<span class="num" id="5976992">8</span><span class="op" id="5976993">;</span>&nbsp;<span class="ident" id="5976995">j</span><span class="op" id="5976996">++</span>&nbsp;<span class="op" id="5976999">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977003">for</span>&nbsp;<span class="ident" id="5977007">i</span>&nbsp;<span class="op" id="5977009">:=</span>&nbsp;<span class="num" id="5977012">0</span><span class="op" id="5977013">;</span>&nbsp;<span class="ident" id="5977015">i</span>&nbsp;<span class="op" id="5977017">&lt;</span>&nbsp;<span class="num" id="5977019">8</span><span class="op" id="5977020">;</span>&nbsp;<span class="ident" id="5977022">i</span><span class="op" id="5977023">++</span>&nbsp;<span class="op" id="5977026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977031">r</span><span class="op" id="5977032">,</span>&nbsp;<span class="ident" id="5977034">g</span><span class="op" id="5977035">,</span>&nbsp;<span class="ident" id="5977037">b</span><span class="op" id="5977038">,</span>&nbsp;<span class="ident" id="5977040">_</span>&nbsp;<span class="op" id="5977042">:=</span>&nbsp;<span class="ident" id="5977045">m</span><span class="op" id="5977046">.</span><span class="ident" id="5977047">At</span><span class="op" id="5977049">(</span><span class="ident" id="5977050">min</span><span class="op" id="5977053">(</span><span class="ident" id="5977054">p</span><span class="op" id="5977055">.</span><span class="ident" id="5977056">X</span><span class="op" id="5977057">+</span><span class="ident" id="5977058">i</span><span class="op" id="5977059">,</span>&nbsp;<span class="ident" id="5977061">xmax</span><span class="op" id="5977065">)</span><span class="op" id="5977066">,</span>&nbsp;<span class="ident" id="5977068">min</span><span class="op" id="5977071">(</span><span class="ident" id="5977072">p</span><span class="op" id="5977073">.</span><span class="ident" id="5977074">Y</span><span class="op" id="5977075">+</span><span class="ident" id="5977076">j</span><span class="op" id="5977077">,</span>&nbsp;<span class="ident" id="5977079">ymax</span><span class="op" id="5977083">)</span><span class="op" id="5977084">)</span><span class="op" id="5977085">.</span><span class="ident" id="5977086">RGBA</span><span class="op" id="5977090">(</span><span class="op" id="5977091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977096">yy</span><span class="op" id="5977098">,</span>&nbsp;<span class="ident" id="5977100">cb</span><span class="op" id="5977102">,</span>&nbsp;<span class="ident" id="5977104">cr</span>&nbsp;<span class="op" id="5977107">:=</span>&nbsp;<span class="ident" id="5977110">color</span><span class="op" id="5977115">.</span><span class="ident" id="5977116">RGBToYCbCr</span><span class="op" id="5977126">(</span><span class="builtintype" id="5977127">uint8</span><span class="op" id="5977132">(</span><span class="ident" id="5977133">r</span><span class="op" id="5977134">&gt;&gt;</span><span class="num" id="5977136">8</span><span class="op" id="5977137">)</span><span class="op" id="5977138">,</span>&nbsp;<span class="builtintype" id="5977140">uint8</span><span class="op" id="5977145">(</span><span class="ident" id="5977146">g</span><span class="op" id="5977147">&gt;&gt;</span><span class="num" id="5977149">8</span><span class="op" id="5977150">)</span><span class="op" id="5977151">,</span>&nbsp;<span class="builtintype" id="5977153">uint8</span><span class="op" id="5977158">(</span><span class="ident" id="5977159">b</span><span class="op" id="5977160">&gt;&gt;</span><span class="num" id="5977162">8</span><span class="op" id="5977163">)</span><span class="op" id="5977164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977169">yBlock</span><span class="op" id="5977175">[</span><span class="num" id="5977176">8</span><span class="op" id="5977177">*</span><span class="ident" id="5977178">j</span><span class="op" id="5977179">+</span><span class="ident" id="5977180">i</span><span class="op" id="5977181">]</span>&nbsp;<span class="op" id="5977183">=</span>&nbsp;<span class="builtintype" id="5977185">int32</span><span class="op" id="5977190">(</span><span class="ident" id="5977191">yy</span><span class="op" id="5977193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977198">cbBlock</span><span class="op" id="5977205">[</span><span class="num" id="5977206">8</span><span class="op" id="5977207">*</span><span class="ident" id="5977208">j</span><span class="op" id="5977209">+</span><span class="ident" id="5977210">i</span><span class="op" id="5977211">]</span>&nbsp;<span class="op" id="5977213">=</span>&nbsp;<span class="builtintype" id="5977215">int32</span><span class="op" id="5977220">(</span><span class="ident" id="5977221">cb</span><span class="op" id="5977223">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977228">crBlock</span><span class="op" id="5977235">[</span><span class="num" id="5977236">8</span><span class="op" id="5977237">*</span><span class="ident" id="5977238">j</span><span class="op" id="5977239">+</span><span class="ident" id="5977240">i</span><span class="op" id="5977241">]</span>&nbsp;<span class="op" id="5977243">=</span>&nbsp;<span class="builtintype" id="5977245">int32</span><span class="op" id="5977250">(</span><span class="ident" id="5977251">cr</span><span class="op" id="5977253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977260">}</span><br>
<span class="lineno"></span><span class="op" id="5977262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="5977265">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="5977341">func</span>&nbsp;<span class="ident" id="5977346">grayToY</span><span class="op" id="5977353">(</span><span class="ident" id="5977354">m</span>&nbsp;<span class="op" id="5977356">*</span><span class="ident" id="5977357">image</span><span class="op" id="5977362">.</span><span class="ident" id="5977363">Gray</span><span class="op" id="5977367">,</span>&nbsp;<span class="ident" id="5977369">p</span>&nbsp;<span class="ident" id="5977371">image</span><span class="op" id="5977376">.</span><span class="ident" id="5977377">Point</span><span class="op" id="5977382">,</span>&nbsp;<span class="ident" id="5977384">yBlock</span>&nbsp;<span class="op" id="5977391">*</span><span class="ident" id="5977392">block</span><span class="op" id="5977397">)</span>&nbsp;<span class="op" id="5977399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977402">b</span>&nbsp;<span class="op" id="5977404">:=</span>&nbsp;<span class="ident" id="5977407">m</span><span class="op" id="5977408">.</span><span class="ident" id="5977409">Bounds</span><span class="op" id="5977415">(</span><span class="op" id="5977416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977419">xmax</span>&nbsp;<span class="op" id="5977424">:=</span>&nbsp;<span class="ident" id="5977427">b</span><span class="op" id="5977428">.</span><span class="ident" id="5977429">Max</span><span class="op" id="5977432">.</span><span class="ident" id="5977433">X</span>&nbsp;<span class="op" id="5977435">-</span>&nbsp;<span class="num" id="5977437">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977440">ymax</span>&nbsp;<span class="op" id="5977445">:=</span>&nbsp;<span class="ident" id="5977448">b</span><span class="op" id="5977449">.</span><span class="ident" id="5977450">Max</span><span class="op" id="5977453">.</span><span class="ident" id="5977454">Y</span>&nbsp;<span class="op" id="5977456">-</span>&nbsp;<span class="num" id="5977458">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977461">pix</span>&nbsp;<span class="op" id="5977465">:=</span>&nbsp;<span class="ident" id="5977468">m</span><span class="op" id="5977469">.</span><span class="ident" id="5977470">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977475">for</span>&nbsp;<span class="ident" id="5977479">j</span>&nbsp;<span class="op" id="5977481">:=</span>&nbsp;<span class="num" id="5977484">0</span><span class="op" id="5977485">;</span>&nbsp;<span class="ident" id="5977487">j</span>&nbsp;<span class="op" id="5977489">&lt;</span>&nbsp;<span class="num" id="5977491">8</span><span class="op" id="5977492">;</span>&nbsp;<span class="ident" id="5977494">j</span><span class="op" id="5977495">++</span>&nbsp;<span class="op" id="5977498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977502">for</span>&nbsp;<span class="ident" id="5977506">i</span>&nbsp;<span class="op" id="5977508">:=</span>&nbsp;<span class="num" id="5977511">0</span><span class="op" id="5977512">;</span>&nbsp;<span class="ident" id="5977514">i</span>&nbsp;<span class="op" id="5977516">&lt;</span>&nbsp;<span class="num" id="5977518">8</span><span class="op" id="5977519">;</span>&nbsp;<span class="ident" id="5977521">i</span><span class="op" id="5977522">++</span>&nbsp;<span class="op" id="5977525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977530">idx</span>&nbsp;<span class="op" id="5977534">:=</span>&nbsp;<span class="ident" id="5977537">m</span><span class="op" id="5977538">.</span><span class="ident" id="5977539">PixOffset</span><span class="op" id="5977548">(</span><span class="ident" id="5977549">min</span><span class="op" id="5977552">(</span><span class="ident" id="5977553">p</span><span class="op" id="5977554">.</span><span class="ident" id="5977555">X</span><span class="op" id="5977556">+</span><span class="ident" id="5977557">i</span><span class="op" id="5977558">,</span>&nbsp;<span class="ident" id="5977560">xmax</span><span class="op" id="5977564">)</span><span class="op" id="5977565">,</span>&nbsp;<span class="ident" id="5977567">min</span><span class="op" id="5977570">(</span><span class="ident" id="5977571">p</span><span class="op" id="5977572">.</span><span class="ident" id="5977573">Y</span><span class="op" id="5977574">+</span><span class="ident" id="5977575">j</span><span class="op" id="5977576">,</span>&nbsp;<span class="ident" id="5977578">ymax</span><span class="op" id="5977582">)</span><span class="op" id="5977583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977588">yBlock</span><span class="op" id="5977594">[</span><span class="num" id="5977595">8</span><span class="op" id="5977596">*</span><span class="ident" id="5977597">j</span><span class="op" id="5977598">+</span><span class="ident" id="5977599">i</span><span class="op" id="5977600">]</span>&nbsp;<span class="op" id="5977602">=</span>&nbsp;<span class="builtintype" id="5977604">int32</span><span class="op" id="5977609">(</span><span class="ident" id="5977610">pix</span><span class="op" id="5977613">[</span><span class="ident" id="5977614">idx</span><span class="op" id="5977617">]</span><span class="op" id="5977618">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977625">}</span><br>
<span class="lineno"></span><span class="op" id="5977627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5977630">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="5977704">func</span>&nbsp;<span class="ident" id="5977709">rgbaToYCbCr</span><span class="op" id="5977720">(</span><span class="ident" id="5977721">m</span>&nbsp;<span class="op" id="5977723">*</span><span class="ident" id="5977724">image</span><span class="op" id="5977729">.</span><span class="ident" id="5977730">RGBA</span><span class="op" id="5977734">,</span>&nbsp;<span class="ident" id="5977736">p</span>&nbsp;<span class="ident" id="5977738">image</span><span class="op" id="5977743">.</span><span class="ident" id="5977744">Point</span><span class="op" id="5977749">,</span>&nbsp;<span class="ident" id="5977751">yBlock</span><span class="op" id="5977757">,</span>&nbsp;<span class="ident" id="5977759">cbBlock</span><span class="op" id="5977766">,</span>&nbsp;<span class="ident" id="5977768">crBlock</span>&nbsp;<span class="op" id="5977776">*</span><span class="ident" id="5977777">block</span><span class="op" id="5977782">)</span>&nbsp;<span class="op" id="5977784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977787">b</span>&nbsp;<span class="op" id="5977789">:=</span>&nbsp;<span class="ident" id="5977792">m</span><span class="op" id="5977793">.</span><span class="ident" id="5977794">Bounds</span><span class="op" id="5977800">(</span><span class="op" id="5977801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977804">xmax</span>&nbsp;<span class="op" id="5977809">:=</span>&nbsp;<span class="ident" id="5977812">b</span><span class="op" id="5977813">.</span><span class="ident" id="5977814">Max</span><span class="op" id="5977817">.</span><span class="ident" id="5977818">X</span>&nbsp;<span class="op" id="5977820">-</span>&nbsp;<span class="num" id="5977822">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977825">ymax</span>&nbsp;<span class="op" id="5977830">:=</span>&nbsp;<span class="ident" id="5977833">b</span><span class="op" id="5977834">.</span><span class="ident" id="5977835">Max</span><span class="op" id="5977838">.</span><span class="ident" id="5977839">Y</span>&nbsp;<span class="op" id="5977841">-</span>&nbsp;<span class="num" id="5977843">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977846">for</span>&nbsp;<span class="ident" id="5977850">j</span>&nbsp;<span class="op" id="5977852">:=</span>&nbsp;<span class="num" id="5977855">0</span><span class="op" id="5977856">;</span>&nbsp;<span class="ident" id="5977858">j</span>&nbsp;<span class="op" id="5977860">&lt;</span>&nbsp;<span class="num" id="5977862">8</span><span class="op" id="5977863">;</span>&nbsp;<span class="ident" id="5977865">j</span><span class="op" id="5977866">++</span>&nbsp;<span class="op" id="5977869">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977873">sj</span>&nbsp;<span class="op" id="5977876">:=</span>&nbsp;<span class="ident" id="5977879">p</span><span class="op" id="5977880">.</span><span class="ident" id="5977881">Y</span>&nbsp;<span class="op" id="5977883">+</span>&nbsp;<span class="ident" id="5977885">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977889">if</span>&nbsp;<span class="ident" id="5977892">sj</span>&nbsp;<span class="op" id="5977895">&gt;</span>&nbsp;<span class="ident" id="5977897">ymax</span>&nbsp;<span class="op" id="5977902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977907">sj</span>&nbsp;<span class="op" id="5977910">=</span>&nbsp;<span class="ident" id="5977912">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5977919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977923">offset</span>&nbsp;<span class="op" id="5977930">:=</span>&nbsp;<span class="op" id="5977933">(</span><span class="ident" id="5977934">sj</span><span class="op" id="5977936">-</span><span class="ident" id="5977937">b</span><span class="op" id="5977938">.</span><span class="ident" id="5977939">Min</span><span class="op" id="5977942">.</span><span class="ident" id="5977943">Y</span><span class="op" id="5977944">)</span><span class="op" id="5977945">*</span><span class="ident" id="5977946">m</span><span class="op" id="5977947">.</span><span class="ident" id="5977948">Stride</span>&nbsp;<span class="op" id="5977955">-</span>&nbsp;<span class="ident" id="5977957">b</span><span class="op" id="5977958">.</span><span class="ident" id="5977959">Min</span><span class="op" id="5977962">.</span><span class="ident" id="5977963">X</span><span class="op" id="5977964">*</span><span class="num" id="5977965">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5977969">for</span>&nbsp;<span class="ident" id="5977973">i</span>&nbsp;<span class="op" id="5977975">:=</span>&nbsp;<span class="num" id="5977978">0</span><span class="op" id="5977979">;</span>&nbsp;<span class="ident" id="5977981">i</span>&nbsp;<span class="op" id="5977983">&lt;</span>&nbsp;<span class="num" id="5977985">8</span><span class="op" id="5977986">;</span>&nbsp;<span class="ident" id="5977988">i</span><span class="op" id="5977989">++</span>&nbsp;<span class="op" id="5977992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5977997">sx</span>&nbsp;<span class="op" id="5978000">:=</span>&nbsp;<span class="ident" id="5978003">p</span><span class="op" id="5978004">.</span><span class="ident" id="5978005">X</span>&nbsp;<span class="op" id="5978007">+</span>&nbsp;<span class="ident" id="5978009">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978014">if</span>&nbsp;<span class="ident" id="5978017">sx</span>&nbsp;<span class="op" id="5978020">&gt;</span>&nbsp;<span class="ident" id="5978022">xmax</span>&nbsp;<span class="op" id="5978027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978033">sx</span>&nbsp;<span class="op" id="5978036">=</span>&nbsp;<span class="ident" id="5978038">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978046">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978051">pix</span>&nbsp;<span class="op" id="5978055">:=</span>&nbsp;<span class="ident" id="5978058">m</span><span class="op" id="5978059">.</span><span class="ident" id="5978060">Pix</span><span class="op" id="5978063">[</span><span class="ident" id="5978064">offset</span><span class="op" id="5978070">+</span><span class="ident" id="5978071">sx</span><span class="op" id="5978073">*</span><span class="num" id="5978074">4</span><span class="op" id="5978075">:</span><span class="op" id="5978076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978081">yy</span><span class="op" id="5978083">,</span>&nbsp;<span class="ident" id="5978085">cb</span><span class="op" id="5978087">,</span>&nbsp;<span class="ident" id="5978089">cr</span>&nbsp;<span class="op" id="5978092">:=</span>&nbsp;<span class="ident" id="5978095">color</span><span class="op" id="5978100">.</span><span class="ident" id="5978101">RGBToYCbCr</span><span class="op" id="5978111">(</span><span class="ident" id="5978112">pix</span><span class="op" id="5978115">[</span><span class="num" id="5978116">0</span><span class="op" id="5978117">]</span><span class="op" id="5978118">,</span>&nbsp;<span class="ident" id="5978120">pix</span><span class="op" id="5978123">[</span><span class="num" id="5978124">1</span><span class="op" id="5978125">]</span><span class="op" id="5978126">,</span>&nbsp;<span class="ident" id="5978128">pix</span><span class="op" id="5978131">[</span><span class="num" id="5978132">2</span><span class="op" id="5978133">]</span><span class="op" id="5978134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978139">yBlock</span><span class="op" id="5978145">[</span><span class="num" id="5978146">8</span><span class="op" id="5978147">*</span><span class="ident" id="5978148">j</span><span class="op" id="5978149">+</span><span class="ident" id="5978150">i</span><span class="op" id="5978151">]</span>&nbsp;<span class="op" id="5978153">=</span>&nbsp;<span class="builtintype" id="5978155">int32</span><span class="op" id="5978160">(</span><span class="ident" id="5978161">yy</span><span class="op" id="5978163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978168">cbBlock</span><span class="op" id="5978175">[</span><span class="num" id="5978176">8</span><span class="op" id="5978177">*</span><span class="ident" id="5978178">j</span><span class="op" id="5978179">+</span><span class="ident" id="5978180">i</span><span class="op" id="5978181">]</span>&nbsp;<span class="op" id="5978183">=</span>&nbsp;<span class="builtintype" id="5978185">int32</span><span class="op" id="5978190">(</span><span class="ident" id="5978191">cb</span><span class="op" id="5978193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978198">crBlock</span><span class="op" id="5978205">[</span><span class="num" id="5978206">8</span><span class="op" id="5978207">*</span><span class="ident" id="5978208">j</span><span class="op" id="5978209">+</span><span class="ident" id="5978210">i</span><span class="op" id="5978211">]</span>&nbsp;<span class="op" id="5978213">=</span>&nbsp;<span class="builtintype" id="5978215">int32</span><span class="op" id="5978220">(</span><span class="ident" id="5978221">cr</span><span class="op" id="5978223">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978230">}</span><br>
<span class="lineno"></span><span class="op" id="5978232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5978235">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="5978311">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="5978325">func</span>&nbsp;<span class="ident" id="5978330">scale</span><span class="op" id="5978335">(</span><span class="ident" id="5978336">dst</span>&nbsp;<span class="op" id="5978340">*</span><span class="ident" id="5978341">block</span><span class="op" id="5978346">,</span>&nbsp;<span class="ident" id="5978348">src</span>&nbsp;<span class="op" id="5978352">*</span><span class="op" id="5978353">[</span><span class="num" id="5978354">4</span><span class="op" id="5978355">]</span><span class="ident" id="5978356">block</span><span class="op" id="5978361">)</span>&nbsp;<span class="op" id="5978363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978366">for</span>&nbsp;<span class="ident" id="5978370">i</span>&nbsp;<span class="op" id="5978372">:=</span>&nbsp;<span class="num" id="5978375">0</span><span class="op" id="5978376">;</span>&nbsp;<span class="ident" id="5978378">i</span>&nbsp;<span class="op" id="5978380">&lt;</span>&nbsp;<span class="num" id="5978382">4</span><span class="op" id="5978383">;</span>&nbsp;<span class="ident" id="5978385">i</span><span class="op" id="5978386">++</span>&nbsp;<span class="op" id="5978389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978393">dstOff</span>&nbsp;<span class="op" id="5978400">:=</span>&nbsp;<span class="op" id="5978403">(</span><span class="ident" id="5978404">i</span><span class="op" id="5978405">&amp;</span><span class="num" id="5978406">2</span><span class="op" id="5978407">)</span><span class="op" id="5978408">&lt;&lt;</span><span class="num" id="5978410">4</span>&nbsp;<span class="op" id="5978412">|</span>&nbsp;<span class="op" id="5978414">(</span><span class="ident" id="5978415">i</span><span class="op" id="5978416">&amp;</span><span class="num" id="5978417">1</span><span class="op" id="5978418">)</span><span class="op" id="5978419">&lt;&lt;</span><span class="num" id="5978421">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978425">for</span>&nbsp;<span class="ident" id="5978429">y</span>&nbsp;<span class="op" id="5978431">:=</span>&nbsp;<span class="num" id="5978434">0</span><span class="op" id="5978435">;</span>&nbsp;<span class="ident" id="5978437">y</span>&nbsp;<span class="op" id="5978439">&lt;</span>&nbsp;<span class="num" id="5978441">4</span><span class="op" id="5978442">;</span>&nbsp;<span class="ident" id="5978444">y</span><span class="op" id="5978445">++</span>&nbsp;<span class="op" id="5978448">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5978453">for</span>&nbsp;<span class="ident" id="5978457">x</span>&nbsp;<span class="op" id="5978459">:=</span>&nbsp;<span class="num" id="5978462">0</span><span class="op" id="5978463">;</span>&nbsp;<span class="ident" id="5978465">x</span>&nbsp;<span class="op" id="5978467">&lt;</span>&nbsp;<span class="num" id="5978469">4</span><span class="op" id="5978470">;</span>&nbsp;<span class="ident" id="5978472">x</span><span class="op" id="5978473">++</span>&nbsp;<span class="op" id="5978476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978482">j</span>&nbsp;<span class="op" id="5978484">:=</span>&nbsp;<span class="num" id="5978487">16</span><span class="op" id="5978489">*</span><span class="ident" id="5978490">y</span>&nbsp;<span class="op" id="5978492">+</span>&nbsp;<span class="num" id="5978494">2</span><span class="op" id="5978495">*</span><span class="ident" id="5978496">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978502">sum</span>&nbsp;<span class="op" id="5978506">:=</span>&nbsp;<span class="ident" id="5978509">src</span><span class="op" id="5978512">[</span><span class="ident" id="5978513">i</span><span class="op" id="5978514">]</span><span class="op" id="5978515">[</span><span class="ident" id="5978516">j</span><span class="op" id="5978517">]</span>&nbsp;<span class="op" id="5978519">+</span>&nbsp;<span class="ident" id="5978521">src</span><span class="op" id="5978524">[</span><span class="ident" id="5978525">i</span><span class="op" id="5978526">]</span><span class="op" id="5978527">[</span><span class="ident" id="5978528">j</span><span class="op" id="5978529">+</span><span class="num" id="5978530">1</span><span class="op" id="5978531">]</span>&nbsp;<span class="op" id="5978533">+</span>&nbsp;<span class="ident" id="5978535">src</span><span class="op" id="5978538">[</span><span class="ident" id="5978539">i</span><span class="op" id="5978540">]</span><span class="op" id="5978541">[</span><span class="ident" id="5978542">j</span><span class="op" id="5978543">+</span><span class="num" id="5978544">8</span><span class="op" id="5978545">]</span>&nbsp;<span class="op" id="5978547">+</span>&nbsp;<span class="ident" id="5978549">src</span><span class="op" id="5978552">[</span><span class="ident" id="5978553">i</span><span class="op" id="5978554">]</span><span class="op" id="5978555">[</span><span class="ident" id="5978556">j</span><span class="op" id="5978557">+</span><span class="num" id="5978558">9</span><span class="op" id="5978559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5978565">dst</span><span class="op" id="5978568">[</span><span class="num" id="5978569">8</span><span class="op" id="5978570">*</span><span class="ident" id="5978571">y</span><span class="op" id="5978572">+</span><span class="ident" id="5978573">x</span><span class="op" id="5978574">+</span><span class="ident" id="5978575">dstOff</span><span class="op" id="5978581">]</span>&nbsp;<span class="op" id="5978583">=</span>&nbsp;<span class="op" id="5978585">(</span><span class="ident" id="5978586">sum</span>&nbsp;<span class="op" id="5978590">+</span>&nbsp;<span class="num" id="5978592">2</span><span class="op" id="5978593">)</span>&nbsp;<span class="op" id="5978595">&gt;&gt;</span>&nbsp;<span class="num" id="5978598">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978603">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5978610">}</span><br>
<span class="lineno"></span><span class="op" id="5978612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5978615">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="5978679">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5978714">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5978752">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5978812">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5978883">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="5978958">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5979001">var</span>&nbsp;<span class="ident" id="5979005">sosHeaderY</span>&nbsp;<span class="op" id="5979016">=</span>&nbsp;<span class="op" id="5979018">[</span><span class="op" id="5979019">]</span><span class="builtintype" id="5979020">byte</span><span class="op" id="5979024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5979027">0xff</span><span class="op" id="5979031">,</span>&nbsp;<span class="num" id="5979033">0xda</span><span class="op" id="5979037">,</span>&nbsp;<span class="num" id="5979039">0x00</span><span class="op" id="5979043">,</span>&nbsp;<span class="num" id="5979045">0x08</span><span class="op" id="5979049">,</span>&nbsp;<span class="num" id="5979051">0x01</span><span class="op" id="5979055">,</span>&nbsp;<span class="num" id="5979057">0x01</span><span class="op" id="5979061">,</span>&nbsp;<span class="num" id="5979063">0x00</span><span class="op" id="5979067">,</span>&nbsp;<span class="num" id="5979069">0x00</span><span class="op" id="5979073">,</span>&nbsp;<span class="num" id="5979075">0x3f</span><span class="op" id="5979079">,</span>&nbsp;<span class="num" id="5979081">0x00</span><span class="op" id="5979085">,</span><br>
<span class="lineno"></span><span class="op" id="5979087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="5979090">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5979159">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5979194">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5979232">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5979292">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="5979352">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5979412">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5979483">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="5979558">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="5979601">var</span>&nbsp;<span class="ident" id="5979605">sosHeaderYCbCr</span>&nbsp;<span class="op" id="5979620">=</span>&nbsp;<span class="op" id="5979622">[</span><span class="op" id="5979623">]</span><span class="builtintype" id="5979624">byte</span><span class="op" id="5979628">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5979631">0xff</span><span class="op" id="5979635">,</span>&nbsp;<span class="num" id="5979637">0xda</span><span class="op" id="5979641">,</span>&nbsp;<span class="num" id="5979643">0x00</span><span class="op" id="5979647">,</span>&nbsp;<span class="num" id="5979649">0x0c</span><span class="op" id="5979653">,</span>&nbsp;<span class="num" id="5979655">0x03</span><span class="op" id="5979659">,</span>&nbsp;<span class="num" id="5979661">0x01</span><span class="op" id="5979665">,</span>&nbsp;<span class="num" id="5979667">0x00</span><span class="op" id="5979671">,</span>&nbsp;<span class="num" id="5979673">0x02</span><span class="op" id="5979677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="5979680">0x11</span><span class="op" id="5979684">,</span>&nbsp;<span class="num" id="5979686">0x03</span><span class="op" id="5979690">,</span>&nbsp;<span class="num" id="5979692">0x11</span><span class="op" id="5979696">,</span>&nbsp;<span class="num" id="5979698">0x00</span><span class="op" id="5979702">,</span>&nbsp;<span class="num" id="5979704">0x3f</span><span class="op" id="5979708">,</span>&nbsp;<span class="num" id="5979710">0x00</span><span class="op" id="5979714">,</span><br>
<span class="lineno"></span><span class="op" id="5979716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5979719">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="5979762">func</span>&nbsp;<span class="op" id="5979767">(</span><span class="ident" id="5979768">e</span>&nbsp;<span class="op" id="5979770">*</span><span class="ident" id="5979771">encoder</span><span class="op" id="5979778">)</span>&nbsp;<span class="ident" id="5979780">writeSOS</span><span class="op" id="5979788">(</span><span class="ident" id="5979789">m</span>&nbsp;<span class="ident" id="5979791">image</span><span class="op" id="5979796">.</span><span class="ident" id="5979797">Image</span><span class="op" id="5979802">)</span>&nbsp;<span class="op" id="5979804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979807">switch</span>&nbsp;<span class="ident" id="5979814">m</span><span class="op" id="5979815">.</span><span class="op" id="5979816">(</span><span class="keyword" id="5979817">type</span><span class="op" id="5979821">)</span>&nbsp;<span class="op" id="5979823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979826">case</span>&nbsp;<span class="op" id="5979831">*</span><span class="ident" id="5979832">image</span><span class="op" id="5979837">.</span><span class="ident" id="5979838">Gray</span><span class="op" id="5979842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979846">e</span><span class="op" id="5979847">.</span><span class="ident" id="5979848">write</span><span class="op" id="5979853">(</span><span class="ident" id="5979854">sosHeaderY</span><span class="op" id="5979864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979867">default</span><span class="op" id="5979874">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5979878">e</span><span class="op" id="5979879">.</span><span class="ident" id="5979880">write</span><span class="op" id="5979885">(</span><span class="ident" id="5979886">sosHeaderYCbCr</span><span class="op" id="5979900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5979903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5979906">var</span>&nbsp;<span class="op" id="5979910">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979914">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5979961">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980013">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5980020">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980028">cb</span><span class="op" id="5980030">,</span>&nbsp;<span class="ident" id="5980032">cr</span>&nbsp;<span class="op" id="5980035">[</span><span class="num" id="5980036">4</span><span class="op" id="5980037">]</span><span class="ident" id="5980038">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980046">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980084">prevDCY</span><span class="op" id="5980091">,</span>&nbsp;<span class="ident" id="5980093">prevDCCb</span><span class="op" id="5980101">,</span>&nbsp;<span class="ident" id="5980103">prevDCCr</span>&nbsp;<span class="builtintype" id="5980112">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980119">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980122">bounds</span>&nbsp;<span class="op" id="5980129">:=</span>&nbsp;<span class="ident" id="5980132">m</span><span class="op" id="5980133">.</span><span class="ident" id="5980134">Bounds</span><span class="op" id="5980140">(</span><span class="op" id="5980141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980144">switch</span>&nbsp;<span class="ident" id="5980151">m</span>&nbsp;<span class="op" id="5980153">:=</span>&nbsp;<span class="ident" id="5980156">m</span><span class="op" id="5980157">.</span><span class="op" id="5980158">(</span><span class="keyword" id="5980159">type</span><span class="op" id="5980163">)</span>&nbsp;<span class="op" id="5980165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5980168">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980230">case</span>&nbsp;<span class="op" id="5980235">*</span><span class="ident" id="5980236">image</span><span class="op" id="5980241">.</span><span class="ident" id="5980242">Gray</span><span class="op" id="5980246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980250">for</span>&nbsp;<span class="ident" id="5980254">y</span>&nbsp;<span class="op" id="5980256">:=</span>&nbsp;<span class="ident" id="5980259">bounds</span><span class="op" id="5980265">.</span><span class="ident" id="5980266">Min</span><span class="op" id="5980269">.</span><span class="ident" id="5980270">Y</span><span class="op" id="5980271">;</span>&nbsp;<span class="ident" id="5980273">y</span>&nbsp;<span class="op" id="5980275">&lt;</span>&nbsp;<span class="ident" id="5980277">bounds</span><span class="op" id="5980283">.</span><span class="ident" id="5980284">Max</span><span class="op" id="5980287">.</span><span class="ident" id="5980288">Y</span><span class="op" id="5980289">;</span>&nbsp;<span class="ident" id="5980291">y</span>&nbsp;<span class="op" id="5980293">+=</span>&nbsp;<span class="num" id="5980296">8</span>&nbsp;<span class="op" id="5980298">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980303">for</span>&nbsp;<span class="ident" id="5980307">x</span>&nbsp;<span class="op" id="5980309">:=</span>&nbsp;<span class="ident" id="5980312">bounds</span><span class="op" id="5980318">.</span><span class="ident" id="5980319">Min</span><span class="op" id="5980322">.</span><span class="ident" id="5980323">X</span><span class="op" id="5980324">;</span>&nbsp;<span class="ident" id="5980326">x</span>&nbsp;<span class="op" id="5980328">&lt;</span>&nbsp;<span class="ident" id="5980330">bounds</span><span class="op" id="5980336">.</span><span class="ident" id="5980337">Max</span><span class="op" id="5980340">.</span><span class="ident" id="5980341">X</span><span class="op" id="5980342">;</span>&nbsp;<span class="ident" id="5980344">x</span>&nbsp;<span class="op" id="5980346">+=</span>&nbsp;<span class="num" id="5980349">8</span>&nbsp;<span class="op" id="5980351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980357">p</span>&nbsp;<span class="op" id="5980359">:=</span>&nbsp;<span class="ident" id="5980362">image</span><span class="op" id="5980367">.</span><span class="ident" id="5980368">Pt</span><span class="op" id="5980370">(</span><span class="ident" id="5980371">x</span><span class="op" id="5980372">,</span>&nbsp;<span class="ident" id="5980374">y</span><span class="op" id="5980375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980381">grayToY</span><span class="op" id="5980388">(</span><span class="ident" id="5980389">m</span><span class="op" id="5980390">,</span>&nbsp;<span class="ident" id="5980392">p</span><span class="op" id="5980393">,</span>&nbsp;<span class="op" id="5980395">&amp;</span><span class="ident" id="5980396">b</span><span class="op" id="5980397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980403">prevDCY</span>&nbsp;<span class="op" id="5980411">=</span>&nbsp;<span class="ident" id="5980413">e</span><span class="op" id="5980414">.</span><span class="ident" id="5980415">writeBlock</span><span class="op" id="5980425">(</span><span class="op" id="5980426">&amp;</span><span class="ident" id="5980427">b</span><span class="op" id="5980428">,</span>&nbsp;<span class="num" id="5980430">0</span><span class="op" id="5980431">,</span>&nbsp;<span class="ident" id="5980433">prevDCY</span><span class="op" id="5980440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980445">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980452">default</span><span class="op" id="5980459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980463">rgba</span><span class="op" id="5980467">,</span>&nbsp;<span class="ident" id="5980469">_</span>&nbsp;<span class="op" id="5980471">:=</span>&nbsp;<span class="ident" id="5980474">m</span><span class="op" id="5980475">.</span><span class="op" id="5980476">(</span><span class="op" id="5980477">*</span><span class="ident" id="5980478">image</span><span class="op" id="5980483">.</span><span class="ident" id="5980484">RGBA</span><span class="op" id="5980488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980492">for</span>&nbsp;<span class="ident" id="5980496">y</span>&nbsp;<span class="op" id="5980498">:=</span>&nbsp;<span class="ident" id="5980501">bounds</span><span class="op" id="5980507">.</span><span class="ident" id="5980508">Min</span><span class="op" id="5980511">.</span><span class="ident" id="5980512">Y</span><span class="op" id="5980513">;</span>&nbsp;<span class="ident" id="5980515">y</span>&nbsp;<span class="op" id="5980517">&lt;</span>&nbsp;<span class="ident" id="5980519">bounds</span><span class="op" id="5980525">.</span><span class="ident" id="5980526">Max</span><span class="op" id="5980529">.</span><span class="ident" id="5980530">Y</span><span class="op" id="5980531">;</span>&nbsp;<span class="ident" id="5980533">y</span>&nbsp;<span class="op" id="5980535">+=</span>&nbsp;<span class="num" id="5980538">16</span>&nbsp;<span class="op" id="5980541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980546">for</span>&nbsp;<span class="ident" id="5980550">x</span>&nbsp;<span class="op" id="5980552">:=</span>&nbsp;<span class="ident" id="5980555">bounds</span><span class="op" id="5980561">.</span><span class="ident" id="5980562">Min</span><span class="op" id="5980565">.</span><span class="ident" id="5980566">X</span><span class="op" id="5980567">;</span>&nbsp;<span class="ident" id="5980569">x</span>&nbsp;<span class="op" id="5980571">&lt;</span>&nbsp;<span class="ident" id="5980573">bounds</span><span class="op" id="5980579">.</span><span class="ident" id="5980580">Max</span><span class="op" id="5980583">.</span><span class="ident" id="5980584">X</span><span class="op" id="5980585">;</span>&nbsp;<span class="ident" id="5980587">x</span>&nbsp;<span class="op" id="5980589">+=</span>&nbsp;<span class="num" id="5980592">16</span>&nbsp;<span class="op" id="5980595">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980601">for</span>&nbsp;<span class="ident" id="5980605">i</span>&nbsp;<span class="op" id="5980607">:=</span>&nbsp;<span class="num" id="5980610">0</span><span class="op" id="5980611">;</span>&nbsp;<span class="ident" id="5980613">i</span>&nbsp;<span class="op" id="5980615">&lt;</span>&nbsp;<span class="num" id="5980617">4</span><span class="op" id="5980618">;</span>&nbsp;<span class="ident" id="5980620">i</span><span class="op" id="5980621">++</span>&nbsp;<span class="op" id="5980624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980631">xOff</span>&nbsp;<span class="op" id="5980636">:=</span>&nbsp;<span class="op" id="5980639">(</span><span class="ident" id="5980640">i</span>&nbsp;<span class="op" id="5980642">&amp;</span>&nbsp;<span class="num" id="5980644">1</span><span class="op" id="5980645">)</span>&nbsp;<span class="op" id="5980647">*</span>&nbsp;<span class="num" id="5980649">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980656">yOff</span>&nbsp;<span class="op" id="5980661">:=</span>&nbsp;<span class="op" id="5980664">(</span><span class="ident" id="5980665">i</span>&nbsp;<span class="op" id="5980667">&amp;</span>&nbsp;<span class="num" id="5980669">2</span><span class="op" id="5980670">)</span>&nbsp;<span class="op" id="5980672">*</span>&nbsp;<span class="num" id="5980674">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980681">p</span>&nbsp;<span class="op" id="5980683">:=</span>&nbsp;<span class="ident" id="5980686">image</span><span class="op" id="5980691">.</span><span class="ident" id="5980692">Pt</span><span class="op" id="5980694">(</span><span class="ident" id="5980695">x</span><span class="op" id="5980696">+</span><span class="ident" id="5980697">xOff</span><span class="op" id="5980701">,</span>&nbsp;<span class="ident" id="5980703">y</span><span class="op" id="5980704">+</span><span class="ident" id="5980705">yOff</span><span class="op" id="5980709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5980716">if</span>&nbsp;<span class="ident" id="5980719">rgba</span>&nbsp;<span class="op" id="5980724">!=</span>&nbsp;<span class="ident" id="5980727">nil</span>&nbsp;<span class="op" id="5980731">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980739">rgbaToYCbCr</span><span class="op" id="5980750">(</span><span class="ident" id="5980751">rgba</span><span class="op" id="5980755">,</span>&nbsp;<span class="ident" id="5980757">p</span><span class="op" id="5980758">,</span>&nbsp;<span class="op" id="5980760">&amp;</span><span class="ident" id="5980761">b</span><span class="op" id="5980762">,</span>&nbsp;<span class="op" id="5980764">&amp;</span><span class="ident" id="5980765">cb</span><span class="op" id="5980767">[</span><span class="ident" id="5980768">i</span><span class="op" id="5980769">]</span><span class="op" id="5980770">,</span>&nbsp;<span class="op" id="5980772">&amp;</span><span class="ident" id="5980773">cr</span><span class="op" id="5980775">[</span><span class="ident" id="5980776">i</span><span class="op" id="5980777">]</span><span class="op" id="5980778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980785">}</span>&nbsp;<span class="keyword" id="5980787">else</span>&nbsp;<span class="op" id="5980792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980800">toYCbCr</span><span class="op" id="5980807">(</span><span class="ident" id="5980808">m</span><span class="op" id="5980809">,</span>&nbsp;<span class="ident" id="5980811">p</span><span class="op" id="5980812">,</span>&nbsp;<span class="op" id="5980814">&amp;</span><span class="ident" id="5980815">b</span><span class="op" id="5980816">,</span>&nbsp;<span class="op" id="5980818">&amp;</span><span class="ident" id="5980819">cb</span><span class="op" id="5980821">[</span><span class="ident" id="5980822">i</span><span class="op" id="5980823">]</span><span class="op" id="5980824">,</span>&nbsp;<span class="op" id="5980826">&amp;</span><span class="ident" id="5980827">cr</span><span class="op" id="5980829">[</span><span class="ident" id="5980830">i</span><span class="op" id="5980831">]</span><span class="op" id="5980832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980846">prevDCY</span>&nbsp;<span class="op" id="5980854">=</span>&nbsp;<span class="ident" id="5980856">e</span><span class="op" id="5980857">.</span><span class="ident" id="5980858">writeBlock</span><span class="op" id="5980868">(</span><span class="op" id="5980869">&amp;</span><span class="ident" id="5980870">b</span><span class="op" id="5980871">,</span>&nbsp;<span class="num" id="5980873">0</span><span class="op" id="5980874">,</span>&nbsp;<span class="ident" id="5980876">prevDCY</span><span class="op" id="5980883">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5980889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980895">scale</span><span class="op" id="5980900">(</span><span class="op" id="5980901">&amp;</span><span class="ident" id="5980902">b</span><span class="op" id="5980903">,</span>&nbsp;<span class="op" id="5980905">&amp;</span><span class="ident" id="5980906">cb</span><span class="op" id="5980908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980914">prevDCCb</span>&nbsp;<span class="op" id="5980923">=</span>&nbsp;<span class="ident" id="5980925">e</span><span class="op" id="5980926">.</span><span class="ident" id="5980927">writeBlock</span><span class="op" id="5980937">(</span><span class="op" id="5980938">&amp;</span><span class="ident" id="5980939">b</span><span class="op" id="5980940">,</span>&nbsp;<span class="num" id="5980942">1</span><span class="op" id="5980943">,</span>&nbsp;<span class="ident" id="5980945">prevDCCb</span><span class="op" id="5980953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980959">scale</span><span class="op" id="5980964">(</span><span class="op" id="5980965">&amp;</span><span class="ident" id="5980966">b</span><span class="op" id="5980967">,</span>&nbsp;<span class="op" id="5980969">&amp;</span><span class="ident" id="5980970">cr</span><span class="op" id="5980972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5980978">prevDCCr</span>&nbsp;<span class="op" id="5980987">=</span>&nbsp;<span class="ident" id="5980989">e</span><span class="op" id="5980990">.</span><span class="ident" id="5980991">writeBlock</span><span class="op" id="5981001">(</span><span class="op" id="5981002">&amp;</span><span class="ident" id="5981003">b</span><span class="op" id="5981004">,</span>&nbsp;<span class="num" id="5981006">1</span><span class="op" id="5981007">,</span>&nbsp;<span class="ident" id="5981009">prevDCCr</span><span class="op" id="5981017">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981032">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981064">e</span><span class="op" id="5981065">.</span><span class="ident" id="5981066">emit</span><span class="op" id="5981070">(</span><span class="num" id="5981071">0x7f</span><span class="op" id="5981075">,</span>&nbsp;<span class="num" id="5981077">7</span><span class="op" id="5981078">)</span><br>
<span class="lineno">535</span><span class="op" id="5981080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5981083">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="5981144">const</span>&nbsp;<span class="ident" id="5981150">DefaultQuality</span>&nbsp;<span class="op" id="5981165">=</span>&nbsp;<span class="num" id="5981167">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="5981171">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="5981211">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="5981272">type</span>&nbsp;<span class="ident" id="5981277">Options</span>&nbsp;<span class="keyword" id="5981285">struct</span>&nbsp;<span class="op" id="5981292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981295">Quality</span>&nbsp;<span class="builtintype" id="5981303">int</span><br>
<span class="lineno"></span><span class="op" id="5981307">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="5981310">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="5981389">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="5981458">func</span>&nbsp;<span class="ident" id="5981463">Encode</span><span class="op" id="5981469">(</span><span class="ident" id="5981470">w</span>&nbsp;<span class="ident" id="5981472">io</span><span class="op" id="5981474">.</span><span class="ident" id="5981475">Writer</span><span class="op" id="5981481">,</span>&nbsp;<span class="ident" id="5981483">m</span>&nbsp;<span class="ident" id="5981485">image</span><span class="op" id="5981490">.</span><span class="ident" id="5981491">Image</span><span class="op" id="5981496">,</span>&nbsp;<span class="ident" id="5981498">o</span>&nbsp;<span class="op" id="5981500">*</span><span class="ident" id="5981501">Options</span><span class="op" id="5981508">)</span>&nbsp;<span class="builtintype" id="5981510">error</span>&nbsp;<span class="op" id="5981516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981519">b</span>&nbsp;<span class="op" id="5981521">:=</span>&nbsp;<span class="ident" id="5981524">m</span><span class="op" id="5981525">.</span><span class="ident" id="5981526">Bounds</span><span class="op" id="5981532">(</span><span class="op" id="5981533">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981536">if</span>&nbsp;<span class="ident" id="5981539">b</span><span class="op" id="5981540">.</span><span class="ident" id="5981541">Dx</span><span class="op" id="5981543">(</span><span class="op" id="5981544">)</span>&nbsp;<span class="op" id="5981546">&gt;=</span>&nbsp;<span class="num" id="5981549">1</span><span class="op" id="5981550">&lt;&lt;</span><span class="num" id="5981552">16</span>&nbsp;<span class="op" id="5981555">||</span>&nbsp;<span class="ident" id="5981558">b</span><span class="op" id="5981559">.</span><span class="ident" id="5981560">Dy</span><span class="op" id="5981562">(</span><span class="op" id="5981563">)</span>&nbsp;<span class="op" id="5981565">&gt;=</span>&nbsp;<span class="num" id="5981568">1</span><span class="op" id="5981569">&lt;&lt;</span><span class="num" id="5981571">16</span>&nbsp;<span class="op" id="5981574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981578">return</span>&nbsp;<span class="ident" id="5981585">errors</span><span class="op" id="5981591">.</span><span class="ident" id="5981592">New</span><span class="op" id="5981595">(</span><span class="string" id="5981596">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="5981632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981638">var</span>&nbsp;<span class="ident" id="5981642">e</span>&nbsp;<span class="ident" id="5981644">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981653">if</span>&nbsp;<span class="ident" id="5981656">ww</span><span class="op" id="5981658">,</span>&nbsp;<span class="ident" id="5981660">ok</span>&nbsp;<span class="op" id="5981663">:=</span>&nbsp;<span class="ident" id="5981666">w</span><span class="op" id="5981667">.</span><span class="op" id="5981668">(</span><span class="ident" id="5981669">writer</span><span class="op" id="5981675">)</span><span class="op" id="5981676">;</span>&nbsp;<span class="ident" id="5981678">ok</span>&nbsp;<span class="op" id="5981681">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981685">e</span><span class="op" id="5981686">.</span><span class="ident" id="5981687">w</span>&nbsp;<span class="op" id="5981689">=</span>&nbsp;<span class="ident" id="5981691">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981695">}</span>&nbsp;<span class="keyword" id="5981697">else</span>&nbsp;<span class="op" id="5981702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981706">e</span><span class="op" id="5981707">.</span><span class="ident" id="5981708">w</span>&nbsp;<span class="op" id="5981710">=</span>&nbsp;<span class="ident" id="5981712">bufio</span><span class="op" id="5981717">.</span><span class="ident" id="5981718">NewWriter</span><span class="op" id="5981727">(</span><span class="ident" id="5981728">w</span><span class="op" id="5981729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981735">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981765">quality</span>&nbsp;<span class="op" id="5981773">:=</span>&nbsp;<span class="ident" id="5981776">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981792">if</span>&nbsp;<span class="ident" id="5981795">o</span>&nbsp;<span class="op" id="5981797">!=</span>&nbsp;<span class="ident" id="5981800">nil</span>&nbsp;<span class="op" id="5981804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981808">quality</span>&nbsp;<span class="op" id="5981816">=</span>&nbsp;<span class="ident" id="5981818">o</span><span class="op" id="5981819">.</span><span class="ident" id="5981820">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981830">if</span>&nbsp;<span class="ident" id="5981833">quality</span>&nbsp;<span class="op" id="5981841">&lt;</span>&nbsp;<span class="num" id="5981843">1</span>&nbsp;<span class="op" id="5981845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981850">quality</span>&nbsp;<span class="op" id="5981858">=</span>&nbsp;<span class="num" id="5981860">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981864">}</span>&nbsp;<span class="keyword" id="5981866">else</span>&nbsp;<span class="keyword" id="5981871">if</span>&nbsp;<span class="ident" id="5981874">quality</span>&nbsp;<span class="op" id="5981882">&gt;</span>&nbsp;<span class="num" id="5981884">100</span>&nbsp;<span class="op" id="5981888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5981893">quality</span>&nbsp;<span class="op" id="5981901">=</span>&nbsp;<span class="num" id="5981903">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5981912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5981915">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981970">var</span>&nbsp;<span class="ident" id="5981974">scale</span>&nbsp;<span class="builtintype" id="5981980">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5981985">if</span>&nbsp;<span class="ident" id="5981988">quality</span>&nbsp;<span class="op" id="5981996">&lt;</span>&nbsp;<span class="num" id="5981998">50</span>&nbsp;<span class="op" id="5982001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982005">scale</span>&nbsp;<span class="op" id="5982011">=</span>&nbsp;<span class="num" id="5982013">5000</span>&nbsp;<span class="op" id="5982018">/</span>&nbsp;<span class="ident" id="5982020">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982029">}</span>&nbsp;<span class="keyword" id="5982031">else</span>&nbsp;<span class="op" id="5982036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982040">scale</span>&nbsp;<span class="op" id="5982046">=</span>&nbsp;<span class="num" id="5982048">200</span>&nbsp;<span class="op" id="5982052">-</span>&nbsp;<span class="ident" id="5982054">quality</span><span class="op" id="5982061">*</span><span class="num" id="5982062">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982068">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982108">for</span>&nbsp;<span class="ident" id="5982112">i</span>&nbsp;<span class="op" id="5982114">:=</span>&nbsp;<span class="keyword" id="5982117">range</span>&nbsp;<span class="ident" id="5982123">e</span><span class="op" id="5982124">.</span><span class="ident" id="5982125">quant</span>&nbsp;<span class="op" id="5982131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982135">for</span>&nbsp;<span class="ident" id="5982139">j</span>&nbsp;<span class="op" id="5982141">:=</span>&nbsp;<span class="keyword" id="5982144">range</span>&nbsp;<span class="ident" id="5982150">e</span><span class="op" id="5982151">.</span><span class="ident" id="5982152">quant</span><span class="op" id="5982157">[</span><span class="ident" id="5982158">i</span><span class="op" id="5982159">]</span>&nbsp;<span class="op" id="5982161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982166">x</span>&nbsp;<span class="op" id="5982168">:=</span>&nbsp;<span class="builtintype" id="5982171">int</span><span class="op" id="5982174">(</span><span class="ident" id="5982175">unscaledQuant</span><span class="op" id="5982188">[</span><span class="ident" id="5982189">i</span><span class="op" id="5982190">]</span><span class="op" id="5982191">[</span><span class="ident" id="5982192">j</span><span class="op" id="5982193">]</span><span class="op" id="5982194">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982199">x</span>&nbsp;<span class="op" id="5982201">=</span>&nbsp;<span class="op" id="5982203">(</span><span class="ident" id="5982204">x</span><span class="op" id="5982205">*</span><span class="ident" id="5982206">scale</span>&nbsp;<span class="op" id="5982212">+</span>&nbsp;<span class="num" id="5982214">50</span><span class="op" id="5982216">)</span>&nbsp;<span class="op" id="5982218">/</span>&nbsp;<span class="num" id="5982220">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982227">if</span>&nbsp;<span class="ident" id="5982230">x</span>&nbsp;<span class="op" id="5982232">&lt;</span>&nbsp;<span class="num" id="5982234">1</span>&nbsp;<span class="op" id="5982236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982242">x</span>&nbsp;<span class="op" id="5982244">=</span>&nbsp;<span class="num" id="5982246">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982251">}</span>&nbsp;<span class="keyword" id="5982253">else</span>&nbsp;<span class="keyword" id="5982258">if</span>&nbsp;<span class="ident" id="5982261">x</span>&nbsp;<span class="op" id="5982263">&gt;</span>&nbsp;<span class="num" id="5982265">255</span>&nbsp;<span class="op" id="5982269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982275">x</span>&nbsp;<span class="op" id="5982277">=</span>&nbsp;<span class="num" id="5982279">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982291">e</span><span class="op" id="5982292">.</span><span class="ident" id="5982293">quant</span><span class="op" id="5982298">[</span><span class="ident" id="5982299">i</span><span class="op" id="5982300">]</span><span class="op" id="5982301">[</span><span class="ident" id="5982302">j</span><span class="op" id="5982303">]</span>&nbsp;<span class="op" id="5982305">=</span>&nbsp;<span class="builtintype" id="5982307">uint8</span><span class="op" id="5982312">(</span><span class="ident" id="5982313">x</span><span class="op" id="5982314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982324">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982384">nComponent</span>&nbsp;<span class="op" id="5982395">:=</span>&nbsp;<span class="num" id="5982398">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982401">switch</span>&nbsp;<span class="ident" id="5982408">m</span><span class="op" id="5982409">.</span><span class="op" id="5982410">(</span><span class="keyword" id="5982411">type</span><span class="op" id="5982415">)</span>&nbsp;<span class="op" id="5982417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982420">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982482">case</span>&nbsp;<span class="op" id="5982487">*</span><span class="ident" id="5982488">image</span><span class="op" id="5982493">.</span><span class="ident" id="5982494">Gray</span><span class="op" id="5982498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982502">nComponent</span>&nbsp;<span class="op" id="5982513">=</span>&nbsp;<span class="num" id="5982515">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5982518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982521">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982558">e</span><span class="op" id="5982559">.</span><span class="ident" id="5982560">buf</span><span class="op" id="5982563">[</span><span class="num" id="5982564">0</span><span class="op" id="5982565">]</span>&nbsp;<span class="op" id="5982567">=</span>&nbsp;<span class="num" id="5982569">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982575">e</span><span class="op" id="5982576">.</span><span class="ident" id="5982577">buf</span><span class="op" id="5982580">[</span><span class="num" id="5982581">1</span><span class="op" id="5982582">]</span>&nbsp;<span class="op" id="5982584">=</span>&nbsp;<span class="num" id="5982586">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982592">e</span><span class="op" id="5982593">.</span><span class="ident" id="5982594">write</span><span class="op" id="5982599">(</span><span class="ident" id="5982600">e</span><span class="op" id="5982601">.</span><span class="ident" id="5982602">buf</span><span class="op" id="5982605">[</span><span class="op" id="5982606">:</span><span class="num" id="5982607">2</span><span class="op" id="5982608">]</span><span class="op" id="5982609">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982612">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982647">e</span><span class="op" id="5982648">.</span><span class="ident" id="5982649">writeDQT</span><span class="op" id="5982657">(</span><span class="op" id="5982658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982661">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982693">e</span><span class="op" id="5982694">.</span><span class="ident" id="5982695">writeSOF0</span><span class="op" id="5982704">(</span><span class="ident" id="5982705">b</span><span class="op" id="5982706">.</span><span class="ident" id="5982707">Size</span><span class="op" id="5982711">(</span><span class="op" id="5982712">)</span><span class="op" id="5982713">,</span>&nbsp;<span class="ident" id="5982715">nComponent</span><span class="op" id="5982725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982728">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982758">e</span><span class="op" id="5982759">.</span><span class="ident" id="5982760">writeDHT</span><span class="op" id="5982768">(</span><span class="ident" id="5982769">nComponent</span><span class="op" id="5982779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982782">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982808">e</span><span class="op" id="5982809">.</span><span class="ident" id="5982810">writeSOS</span><span class="op" id="5982818">(</span><span class="ident" id="5982819">m</span><span class="op" id="5982820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5982823">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982858">e</span><span class="op" id="5982859">.</span><span class="ident" id="5982860">buf</span><span class="op" id="5982863">[</span><span class="num" id="5982864">0</span><span class="op" id="5982865">]</span>&nbsp;<span class="op" id="5982867">=</span>&nbsp;<span class="num" id="5982869">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982875">e</span><span class="op" id="5982876">.</span><span class="ident" id="5982877">buf</span><span class="op" id="5982880">[</span><span class="num" id="5982881">1</span><span class="op" id="5982882">]</span>&nbsp;<span class="op" id="5982884">=</span>&nbsp;<span class="num" id="5982886">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982892">e</span><span class="op" id="5982893">.</span><span class="ident" id="5982894">write</span><span class="op" id="5982899">(</span><span class="ident" id="5982900">e</span><span class="op" id="5982901">.</span><span class="ident" id="5982902">buf</span><span class="op" id="5982905">[</span><span class="op" id="5982906">:</span><span class="num" id="5982907">2</span><span class="op" id="5982908">]</span><span class="op" id="5982909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5982912">e</span><span class="op" id="5982913">.</span><span class="ident" id="5982914">flush</span><span class="op" id="5982919">(</span><span class="op" id="5982920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5982923">return</span>&nbsp;<span class="ident" id="5982930">e</span><span class="op" id="5982931">.</span><span class="ident" id="5982932">err</span><br>
<span class="lineno"></span><span class="op" id="5982936">}</span>
</div>
</body>
</html>
