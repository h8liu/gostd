<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7979869">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7979924">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7979978">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7980029">package</span>&nbsp;<span class="ident" id="7980037">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7980042">import</span>&nbsp;<span class="op" id="7980049">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7980052">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7980059">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7980065">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7980078">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7980089">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7980100">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7980107">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7980110">func</span>&nbsp;<span class="ident" id="7980115">isTimeout</span><span class="op" id="7980124">(</span><span class="ident" id="7980125">err</span>&nbsp;<span class="builtintype" id="7980129">error</span><span class="op" id="7980134">)</span>&nbsp;<span class="builtintype" id="7980136">bool</span>&nbsp;<span class="op" id="7980141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980144">e</span><span class="op" id="7980145">,</span>&nbsp;<span class="ident" id="7980147">ok</span>&nbsp;<span class="op" id="7980150">:=</span>&nbsp;<span class="ident" id="7980153">err</span><span class="op" id="7980156">.</span><span class="op" id="7980157">(</span><span class="ident" id="7980158">Error</span><span class="op" id="7980163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980166">return</span>&nbsp;<span class="ident" id="7980173">ok</span>&nbsp;<span class="op" id="7980176">&amp;&amp;</span>&nbsp;<span class="ident" id="7980179">e</span><span class="op" id="7980180">.</span><span class="ident" id="7980181">Timeout</span><span class="op" id="7980188">(</span><span class="op" id="7980189">)</span><br>
<span class="lineno"></span><span class="op" id="7980191">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7980194">type</span>&nbsp;<span class="ident" id="7980199">copyRes</span>&nbsp;<span class="keyword" id="7980207">struct</span>&nbsp;<span class="op" id="7980214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980217">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7980221">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980228">err</span>&nbsp;<span class="builtintype" id="7980232">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980239">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7980243">time</span><span class="op" id="7980247">.</span><span class="ident" id="7980248">Duration</span><br>
<span class="lineno">25</span><span class="op" id="7980257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7980260">func</span>&nbsp;<span class="ident" id="7980265">TestAcceptTimeout</span><span class="op" id="7980282">(</span><span class="ident" id="7980283">t</span>&nbsp;<span class="op" id="7980285">*</span><span class="ident" id="7980286">testing</span><span class="op" id="7980293">.</span><span class="ident" id="7980294">T</span><span class="op" id="7980295">)</span>&nbsp;<span class="op" id="7980297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980300">switch</span>&nbsp;<span class="ident" id="7980307">runtime</span><span class="op" id="7980314">.</span><span class="ident" id="7980315">GOOS</span>&nbsp;<span class="op" id="7980320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980323">case</span>&nbsp;<span class="string" id="7980328">&#34;plan9&#34;</span><span class="op" id="7980335">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980339">t</span><span class="op" id="7980340">.</span><span class="ident" id="7980341">Skipf</span><span class="op" id="7980346">(</span><span class="string" id="7980347">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7980368">,</span>&nbsp;<span class="ident" id="7980370">runtime</span><span class="op" id="7980377">.</span><span class="ident" id="7980378">GOOS</span><span class="op" id="7980382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980389">ln</span>&nbsp;<span class="op" id="7980392">:=</span>&nbsp;<span class="ident" id="7980395">newLocalListener</span><span class="op" id="7980411">(</span><span class="ident" id="7980412">t</span><span class="op" id="7980413">)</span><span class="op" id="7980414">.</span><span class="op" id="7980415">(</span><span class="op" id="7980416">*</span><span class="ident" id="7980417">TCPListener</span><span class="op" id="7980428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980431">defer</span>&nbsp;<span class="ident" id="7980437">ln</span><span class="op" id="7980439">.</span><span class="ident" id="7980440">Close</span><span class="op" id="7980445">(</span><span class="op" id="7980446">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980449">ln</span><span class="op" id="7980451">.</span><span class="ident" id="7980452">SetDeadline</span><span class="op" id="7980463">(</span><span class="ident" id="7980464">time</span><span class="op" id="7980468">.</span><span class="ident" id="7980469">Now</span><span class="op" id="7980472">(</span><span class="op" id="7980473">)</span><span class="op" id="7980474">.</span><span class="ident" id="7980475">Add</span><span class="op" id="7980478">(</span><span class="op" id="7980479">-</span><span class="num" id="7980480">1</span>&nbsp;<span class="op" id="7980482">*</span>&nbsp;<span class="ident" id="7980484">time</span><span class="op" id="7980488">.</span><span class="ident" id="7980489">Second</span><span class="op" id="7980495">)</span><span class="op" id="7980496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980499">if</span>&nbsp;<span class="ident" id="7980502">_</span><span class="op" id="7980503">,</span>&nbsp;<span class="ident" id="7980505">err</span>&nbsp;<span class="op" id="7980509">:=</span>&nbsp;<span class="ident" id="7980512">ln</span><span class="op" id="7980514">.</span><span class="ident" id="7980515">Accept</span><span class="op" id="7980521">(</span><span class="op" id="7980522">)</span><span class="op" id="7980523">;</span>&nbsp;<span class="op" id="7980525">!</span><span class="ident" id="7980526">isTimeout</span><span class="op" id="7980535">(</span><span class="ident" id="7980536">err</span><span class="op" id="7980539">)</span>&nbsp;<span class="op" id="7980541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980545">t</span><span class="op" id="7980546">.</span><span class="ident" id="7980547">Fatalf</span><span class="op" id="7980553">(</span><span class="string" id="7980554">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7980587">,</span>&nbsp;<span class="ident" id="7980589">errTimeout</span><span class="op" id="7980599">,</span>&nbsp;<span class="ident" id="7980601">err</span><span class="op" id="7980604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980610">if</span>&nbsp;<span class="ident" id="7980613">_</span><span class="op" id="7980614">,</span>&nbsp;<span class="ident" id="7980616">err</span>&nbsp;<span class="op" id="7980620">:=</span>&nbsp;<span class="ident" id="7980623">ln</span><span class="op" id="7980625">.</span><span class="ident" id="7980626">Accept</span><span class="op" id="7980632">(</span><span class="op" id="7980633">)</span><span class="op" id="7980634">;</span>&nbsp;<span class="op" id="7980636">!</span><span class="ident" id="7980637">isTimeout</span><span class="op" id="7980646">(</span><span class="ident" id="7980647">err</span><span class="op" id="7980650">)</span>&nbsp;<span class="op" id="7980652">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980656">t</span><span class="op" id="7980657">.</span><span class="ident" id="7980658">Fatalf</span><span class="op" id="7980664">(</span><span class="string" id="7980665">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7980698">,</span>&nbsp;<span class="ident" id="7980700">errTimeout</span><span class="op" id="7980710">,</span>&nbsp;<span class="ident" id="7980712">err</span><span class="op" id="7980715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980721">ln</span><span class="op" id="7980723">.</span><span class="ident" id="7980724">SetDeadline</span><span class="op" id="7980735">(</span><span class="ident" id="7980736">time</span><span class="op" id="7980740">.</span><span class="ident" id="7980741">Now</span><span class="op" id="7980744">(</span><span class="op" id="7980745">)</span><span class="op" id="7980746">.</span><span class="ident" id="7980747">Add</span><span class="op" id="7980750">(</span><span class="num" id="7980751">100</span>&nbsp;<span class="op" id="7980755">*</span>&nbsp;<span class="ident" id="7980757">time</span><span class="op" id="7980761">.</span><span class="ident" id="7980762">Millisecond</span><span class="op" id="7980773">)</span><span class="op" id="7980774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980777">if</span>&nbsp;<span class="ident" id="7980780">_</span><span class="op" id="7980781">,</span>&nbsp;<span class="ident" id="7980783">err</span>&nbsp;<span class="op" id="7980787">:=</span>&nbsp;<span class="ident" id="7980790">ln</span><span class="op" id="7980792">.</span><span class="ident" id="7980793">Accept</span><span class="op" id="7980799">(</span><span class="op" id="7980800">)</span><span class="op" id="7980801">;</span>&nbsp;<span class="op" id="7980803">!</span><span class="ident" id="7980804">isTimeout</span><span class="op" id="7980813">(</span><span class="ident" id="7980814">err</span><span class="op" id="7980817">)</span>&nbsp;<span class="op" id="7980819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980823">t</span><span class="op" id="7980824">.</span><span class="ident" id="7980825">Fatalf</span><span class="op" id="7980831">(</span><span class="string" id="7980832">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7980865">,</span>&nbsp;<span class="ident" id="7980867">errTimeout</span><span class="op" id="7980877">,</span>&nbsp;<span class="ident" id="7980879">err</span><span class="op" id="7980882">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7980888">if</span>&nbsp;<span class="ident" id="7980891">_</span><span class="op" id="7980892">,</span>&nbsp;<span class="ident" id="7980894">err</span>&nbsp;<span class="op" id="7980898">:=</span>&nbsp;<span class="ident" id="7980901">ln</span><span class="op" id="7980903">.</span><span class="ident" id="7980904">Accept</span><span class="op" id="7980910">(</span><span class="op" id="7980911">)</span><span class="op" id="7980912">;</span>&nbsp;<span class="op" id="7980914">!</span><span class="ident" id="7980915">isTimeout</span><span class="op" id="7980924">(</span><span class="ident" id="7980925">err</span><span class="op" id="7980928">)</span>&nbsp;<span class="op" id="7980930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980934">t</span><span class="op" id="7980935">.</span><span class="ident" id="7980936">Fatalf</span><span class="op" id="7980942">(</span><span class="string" id="7980943">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7980976">,</span>&nbsp;<span class="ident" id="7980978">errTimeout</span><span class="op" id="7980988">,</span>&nbsp;<span class="ident" id="7980990">err</span><span class="op" id="7980993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7980996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7980999">ln</span><span class="op" id="7981001">.</span><span class="ident" id="7981002">SetDeadline</span><span class="op" id="7981013">(</span><span class="ident" id="7981014">noDeadline</span><span class="op" id="7981024">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981027">errc</span>&nbsp;<span class="op" id="7981032">:=</span>&nbsp;<span class="builtinfunc" id="7981035">make</span><span class="op" id="7981039">(</span><span class="keyword" id="7981040">chan</span>&nbsp;<span class="builtintype" id="7981045">error</span><span class="op" id="7981050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981053">go</span>&nbsp;<span class="keyword" id="7981056">func</span><span class="op" id="7981060">(</span><span class="op" id="7981061">)</span>&nbsp;<span class="op" id="7981063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981067">_</span><span class="op" id="7981068">,</span>&nbsp;<span class="ident" id="7981070">err</span>&nbsp;<span class="op" id="7981074">:=</span>&nbsp;<span class="ident" id="7981077">ln</span><span class="op" id="7981079">.</span><span class="ident" id="7981080">Accept</span><span class="op" id="7981086">(</span><span class="op" id="7981087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981091">errc</span>&nbsp;<span class="op" id="7981096">&lt;-</span>&nbsp;<span class="ident" id="7981099">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981104">}</span><span class="op" id="7981105">(</span><span class="op" id="7981106">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981109">time</span><span class="op" id="7981113">.</span><span class="ident" id="7981114">Sleep</span><span class="op" id="7981119">(</span><span class="num" id="7981120">100</span>&nbsp;<span class="op" id="7981124">*</span>&nbsp;<span class="ident" id="7981126">time</span><span class="op" id="7981130">.</span><span class="ident" id="7981131">Millisecond</span><span class="op" id="7981142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981145">select</span>&nbsp;<span class="op" id="7981152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981155">case</span>&nbsp;<span class="ident" id="7981160">err</span>&nbsp;<span class="op" id="7981164">:=</span>&nbsp;<span class="op" id="7981167">&lt;-</span><span class="ident" id="7981169">errc</span><span class="op" id="7981173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981177">t</span><span class="op" id="7981178">.</span><span class="ident" id="7981179">Fatalf</span><span class="op" id="7981185">(</span><span class="string" id="7981186">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7981246">,</span>&nbsp;<span class="ident" id="7981248">err</span><span class="op" id="7981251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981254">default</span><span class="op" id="7981261">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981267">ln</span><span class="op" id="7981269">.</span><span class="ident" id="7981270">Close</span><span class="op" id="7981275">(</span><span class="op" id="7981276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981279">switch</span>&nbsp;<span class="ident" id="7981286">nerr</span>&nbsp;<span class="op" id="7981291">:=</span>&nbsp;<span class="op" id="7981294">&lt;-</span><span class="ident" id="7981296">errc</span><span class="op" id="7981300">;</span>&nbsp;<span class="ident" id="7981302">err</span>&nbsp;<span class="op" id="7981306">:=</span>&nbsp;<span class="ident" id="7981309">nerr</span><span class="op" id="7981313">.</span><span class="op" id="7981314">(</span><span class="keyword" id="7981315">type</span><span class="op" id="7981319">)</span>&nbsp;<span class="op" id="7981321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981324">case</span>&nbsp;<span class="op" id="7981329">*</span><span class="ident" id="7981330">OpError</span><span class="op" id="7981337">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981341">if</span>&nbsp;<span class="ident" id="7981344">err</span><span class="op" id="7981347">.</span><span class="ident" id="7981348">Err</span>&nbsp;<span class="op" id="7981352">!=</span>&nbsp;<span class="ident" id="7981355">errClosing</span>&nbsp;<span class="op" id="7981366">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981371">t</span><span class="op" id="7981372">.</span><span class="ident" id="7981373">Fatalf</span><span class="op" id="7981379">(</span><span class="string" id="7981380">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7981413">,</span>&nbsp;<span class="ident" id="7981415">errClosing</span><span class="op" id="7981425">,</span>&nbsp;<span class="ident" id="7981427">err</span><span class="op" id="7981430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981437">default</span><span class="op" id="7981444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981448">if</span>&nbsp;<span class="ident" id="7981451">err</span>&nbsp;<span class="op" id="7981455">!=</span>&nbsp;<span class="ident" id="7981458">errClosing</span>&nbsp;<span class="op" id="7981469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981474">t</span><span class="op" id="7981475">.</span><span class="ident" id="7981476">Fatalf</span><span class="op" id="7981482">(</span><span class="string" id="7981483">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7981516">,</span>&nbsp;<span class="ident" id="7981518">errClosing</span><span class="op" id="7981528">,</span>&nbsp;<span class="ident" id="7981530">err</span><span class="op" id="7981533">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981540">}</span><br>
<span class="lineno"></span><span class="op" id="7981542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7981545">func</span>&nbsp;<span class="ident" id="7981550">TestReadTimeout</span><span class="op" id="7981565">(</span><span class="ident" id="7981566">t</span>&nbsp;<span class="op" id="7981568">*</span><span class="ident" id="7981569">testing</span><span class="op" id="7981576">.</span><span class="ident" id="7981577">T</span><span class="op" id="7981578">)</span>&nbsp;<span class="op" id="7981580">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981583">switch</span>&nbsp;<span class="ident" id="7981590">runtime</span><span class="op" id="7981597">.</span><span class="ident" id="7981598">GOOS</span>&nbsp;<span class="op" id="7981603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981606">case</span>&nbsp;<span class="string" id="7981611">&#34;plan9&#34;</span><span class="op" id="7981618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981622">t</span><span class="op" id="7981623">.</span><span class="ident" id="7981624">Skipf</span><span class="op" id="7981629">(</span><span class="string" id="7981630">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7981651">,</span>&nbsp;<span class="ident" id="7981653">runtime</span><span class="op" id="7981660">.</span><span class="ident" id="7981661">GOOS</span><span class="op" id="7981665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981672">ln</span>&nbsp;<span class="op" id="7981675">:=</span>&nbsp;<span class="ident" id="7981678">newLocalListener</span><span class="op" id="7981694">(</span><span class="ident" id="7981695">t</span><span class="op" id="7981696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981699">defer</span>&nbsp;<span class="ident" id="7981705">ln</span><span class="op" id="7981707">.</span><span class="ident" id="7981708">Close</span><span class="op" id="7981713">(</span><span class="op" id="7981714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981717">c</span><span class="op" id="7981718">,</span>&nbsp;<span class="ident" id="7981720">err</span>&nbsp;<span class="op" id="7981724">:=</span>&nbsp;<span class="ident" id="7981727">DialTCP</span><span class="op" id="7981734">(</span><span class="string" id="7981735">&#34;tcp&#34;</span><span class="op" id="7981740">,</span>&nbsp;<span class="ident" id="7981742">nil</span><span class="op" id="7981745">,</span>&nbsp;<span class="ident" id="7981747">ln</span><span class="op" id="7981749">.</span><span class="ident" id="7981750">Addr</span><span class="op" id="7981754">(</span><span class="op" id="7981755">)</span><span class="op" id="7981756">.</span><span class="op" id="7981757">(</span><span class="op" id="7981758">*</span><span class="ident" id="7981759">TCPAddr</span><span class="op" id="7981766">)</span><span class="op" id="7981767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981770">if</span>&nbsp;<span class="ident" id="7981773">err</span>&nbsp;<span class="op" id="7981777">!=</span>&nbsp;<span class="ident" id="7981780">nil</span>&nbsp;<span class="op" id="7981784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981788">t</span><span class="op" id="7981789">.</span><span class="ident" id="7981790">Fatalf</span><span class="op" id="7981796">(</span><span class="string" id="7981797">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="7981810">,</span>&nbsp;<span class="ident" id="7981812">err</span><span class="op" id="7981815">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7981818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981821">defer</span>&nbsp;<span class="ident" id="7981827">c</span><span class="op" id="7981828">.</span><span class="ident" id="7981829">Close</span><span class="op" id="7981834">(</span><span class="op" id="7981835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981838">c</span><span class="op" id="7981839">.</span><span class="ident" id="7981840">SetDeadline</span><span class="op" id="7981851">(</span><span class="ident" id="7981852">time</span><span class="op" id="7981856">.</span><span class="ident" id="7981857">Now</span><span class="op" id="7981860">(</span><span class="op" id="7981861">)</span><span class="op" id="7981862">.</span><span class="ident" id="7981863">Add</span><span class="op" id="7981866">(</span><span class="ident" id="7981867">time</span><span class="op" id="7981871">.</span><span class="ident" id="7981872">Hour</span><span class="op" id="7981876">)</span><span class="op" id="7981877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981880">c</span><span class="op" id="7981881">.</span><span class="ident" id="7981882">SetReadDeadline</span><span class="op" id="7981897">(</span><span class="ident" id="7981898">time</span><span class="op" id="7981902">.</span><span class="ident" id="7981903">Now</span><span class="op" id="7981906">(</span><span class="op" id="7981907">)</span><span class="op" id="7981908">.</span><span class="ident" id="7981909">Add</span><span class="op" id="7981912">(</span><span class="op" id="7981913">-</span><span class="num" id="7981914">1</span>&nbsp;<span class="op" id="7981916">*</span>&nbsp;<span class="ident" id="7981918">time</span><span class="op" id="7981922">.</span><span class="ident" id="7981923">Second</span><span class="op" id="7981929">)</span><span class="op" id="7981930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7981933">buf</span>&nbsp;<span class="op" id="7981937">:=</span>&nbsp;<span class="builtinfunc" id="7981940">make</span><span class="op" id="7981944">(</span><span class="op" id="7981945">[</span><span class="op" id="7981946">]</span><span class="builtintype" id="7981947">byte</span><span class="op" id="7981951">,</span>&nbsp;<span class="num" id="7981953">1</span><span class="op" id="7981954">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7981957">if</span>&nbsp;<span class="ident" id="7981960">_</span><span class="op" id="7981961">,</span>&nbsp;<span class="ident" id="7981963">err</span>&nbsp;<span class="op" id="7981967">=</span>&nbsp;<span class="ident" id="7981969">c</span><span class="op" id="7981970">.</span><span class="ident" id="7981971">Read</span><span class="op" id="7981975">(</span><span class="ident" id="7981976">buf</span><span class="op" id="7981979">)</span><span class="op" id="7981980">;</span>&nbsp;<span class="op" id="7981982">!</span><span class="ident" id="7981983">isTimeout</span><span class="op" id="7981992">(</span><span class="ident" id="7981993">err</span><span class="op" id="7981996">)</span>&nbsp;<span class="op" id="7981998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982002">t</span><span class="op" id="7982003">.</span><span class="ident" id="7982004">Fatalf</span><span class="op" id="7982010">(</span><span class="string" id="7982011">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7982042">,</span>&nbsp;<span class="ident" id="7982044">errTimeout</span><span class="op" id="7982054">,</span>&nbsp;<span class="ident" id="7982056">err</span><span class="op" id="7982059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982065">if</span>&nbsp;<span class="ident" id="7982068">_</span><span class="op" id="7982069">,</span>&nbsp;<span class="ident" id="7982071">err</span>&nbsp;<span class="op" id="7982075">=</span>&nbsp;<span class="ident" id="7982077">c</span><span class="op" id="7982078">.</span><span class="ident" id="7982079">Read</span><span class="op" id="7982083">(</span><span class="ident" id="7982084">buf</span><span class="op" id="7982087">)</span><span class="op" id="7982088">;</span>&nbsp;<span class="op" id="7982090">!</span><span class="ident" id="7982091">isTimeout</span><span class="op" id="7982100">(</span><span class="ident" id="7982101">err</span><span class="op" id="7982104">)</span>&nbsp;<span class="op" id="7982106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982110">t</span><span class="op" id="7982111">.</span><span class="ident" id="7982112">Fatalf</span><span class="op" id="7982118">(</span><span class="string" id="7982119">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7982150">,</span>&nbsp;<span class="ident" id="7982152">errTimeout</span><span class="op" id="7982162">,</span>&nbsp;<span class="ident" id="7982164">err</span><span class="op" id="7982167">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982173">c</span><span class="op" id="7982174">.</span><span class="ident" id="7982175">SetDeadline</span><span class="op" id="7982186">(</span><span class="ident" id="7982187">time</span><span class="op" id="7982191">.</span><span class="ident" id="7982192">Now</span><span class="op" id="7982195">(</span><span class="op" id="7982196">)</span><span class="op" id="7982197">.</span><span class="ident" id="7982198">Add</span><span class="op" id="7982201">(</span><span class="num" id="7982202">100</span>&nbsp;<span class="op" id="7982206">*</span>&nbsp;<span class="ident" id="7982208">time</span><span class="op" id="7982212">.</span><span class="ident" id="7982213">Millisecond</span><span class="op" id="7982224">)</span><span class="op" id="7982225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982228">if</span>&nbsp;<span class="ident" id="7982231">_</span><span class="op" id="7982232">,</span>&nbsp;<span class="ident" id="7982234">err</span>&nbsp;<span class="op" id="7982238">=</span>&nbsp;<span class="ident" id="7982240">c</span><span class="op" id="7982241">.</span><span class="ident" id="7982242">Read</span><span class="op" id="7982246">(</span><span class="ident" id="7982247">buf</span><span class="op" id="7982250">)</span><span class="op" id="7982251">;</span>&nbsp;<span class="op" id="7982253">!</span><span class="ident" id="7982254">isTimeout</span><span class="op" id="7982263">(</span><span class="ident" id="7982264">err</span><span class="op" id="7982267">)</span>&nbsp;<span class="op" id="7982269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982273">t</span><span class="op" id="7982274">.</span><span class="ident" id="7982275">Fatalf</span><span class="op" id="7982281">(</span><span class="string" id="7982282">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7982313">,</span>&nbsp;<span class="ident" id="7982315">errTimeout</span><span class="op" id="7982325">,</span>&nbsp;<span class="ident" id="7982327">err</span><span class="op" id="7982330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982333">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982336">if</span>&nbsp;<span class="ident" id="7982339">_</span><span class="op" id="7982340">,</span>&nbsp;<span class="ident" id="7982342">err</span>&nbsp;<span class="op" id="7982346">=</span>&nbsp;<span class="ident" id="7982348">c</span><span class="op" id="7982349">.</span><span class="ident" id="7982350">Read</span><span class="op" id="7982354">(</span><span class="ident" id="7982355">buf</span><span class="op" id="7982358">)</span><span class="op" id="7982359">;</span>&nbsp;<span class="op" id="7982361">!</span><span class="ident" id="7982362">isTimeout</span><span class="op" id="7982371">(</span><span class="ident" id="7982372">err</span><span class="op" id="7982375">)</span>&nbsp;<span class="op" id="7982377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982381">t</span><span class="op" id="7982382">.</span><span class="ident" id="7982383">Fatalf</span><span class="op" id="7982389">(</span><span class="string" id="7982390">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7982421">,</span>&nbsp;<span class="ident" id="7982423">errTimeout</span><span class="op" id="7982433">,</span>&nbsp;<span class="ident" id="7982435">err</span><span class="op" id="7982438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982444">c</span><span class="op" id="7982445">.</span><span class="ident" id="7982446">SetReadDeadline</span><span class="op" id="7982461">(</span><span class="ident" id="7982462">noDeadline</span><span class="op" id="7982472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982475">c</span><span class="op" id="7982476">.</span><span class="ident" id="7982477">SetWriteDeadline</span><span class="op" id="7982493">(</span><span class="ident" id="7982494">time</span><span class="op" id="7982498">.</span><span class="ident" id="7982499">Now</span><span class="op" id="7982502">(</span><span class="op" id="7982503">)</span><span class="op" id="7982504">.</span><span class="ident" id="7982505">Add</span><span class="op" id="7982508">(</span><span class="op" id="7982509">-</span><span class="num" id="7982510">1</span>&nbsp;<span class="op" id="7982512">*</span>&nbsp;<span class="ident" id="7982514">time</span><span class="op" id="7982518">.</span><span class="ident" id="7982519">Second</span><span class="op" id="7982525">)</span><span class="op" id="7982526">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982529">errc</span>&nbsp;<span class="op" id="7982534">:=</span>&nbsp;<span class="builtinfunc" id="7982537">make</span><span class="op" id="7982541">(</span><span class="keyword" id="7982542">chan</span>&nbsp;<span class="builtintype" id="7982547">error</span><span class="op" id="7982552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982555">go</span>&nbsp;<span class="keyword" id="7982558">func</span><span class="op" id="7982562">(</span><span class="op" id="7982563">)</span>&nbsp;<span class="op" id="7982565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982569">_</span><span class="op" id="7982570">,</span>&nbsp;<span class="ident" id="7982572">err</span>&nbsp;<span class="op" id="7982576">:=</span>&nbsp;<span class="ident" id="7982579">c</span><span class="op" id="7982580">.</span><span class="ident" id="7982581">Read</span><span class="op" id="7982585">(</span><span class="ident" id="7982586">buf</span><span class="op" id="7982589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982593">errc</span>&nbsp;<span class="op" id="7982598">&lt;-</span>&nbsp;<span class="ident" id="7982601">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982606">}</span><span class="op" id="7982607">(</span><span class="op" id="7982608">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982611">time</span><span class="op" id="7982615">.</span><span class="ident" id="7982616">Sleep</span><span class="op" id="7982621">(</span><span class="num" id="7982622">100</span>&nbsp;<span class="op" id="7982626">*</span>&nbsp;<span class="ident" id="7982628">time</span><span class="op" id="7982632">.</span><span class="ident" id="7982633">Millisecond</span><span class="op" id="7982644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982647">select</span>&nbsp;<span class="op" id="7982654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982657">case</span>&nbsp;<span class="ident" id="7982662">err</span>&nbsp;<span class="op" id="7982666">:=</span>&nbsp;<span class="op" id="7982669">&lt;-</span><span class="ident" id="7982671">errc</span><span class="op" id="7982675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982679">t</span><span class="op" id="7982680">.</span><span class="ident" id="7982681">Fatalf</span><span class="op" id="7982687">(</span><span class="string" id="7982688">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7982746">,</span>&nbsp;<span class="ident" id="7982748">err</span><span class="op" id="7982751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982754">default</span><span class="op" id="7982761">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982767">c</span><span class="op" id="7982768">.</span><span class="ident" id="7982769">Close</span><span class="op" id="7982774">(</span><span class="op" id="7982775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982778">switch</span>&nbsp;<span class="ident" id="7982785">nerr</span>&nbsp;<span class="op" id="7982790">:=</span>&nbsp;<span class="op" id="7982793">&lt;-</span><span class="ident" id="7982795">errc</span><span class="op" id="7982799">;</span>&nbsp;<span class="ident" id="7982801">err</span>&nbsp;<span class="op" id="7982805">:=</span>&nbsp;<span class="ident" id="7982808">nerr</span><span class="op" id="7982812">.</span><span class="op" id="7982813">(</span><span class="keyword" id="7982814">type</span><span class="op" id="7982818">)</span>&nbsp;<span class="op" id="7982820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982823">case</span>&nbsp;<span class="op" id="7982828">*</span><span class="ident" id="7982829">OpError</span><span class="op" id="7982836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982840">if</span>&nbsp;<span class="ident" id="7982843">err</span><span class="op" id="7982846">.</span><span class="ident" id="7982847">Err</span>&nbsp;<span class="op" id="7982851">!=</span>&nbsp;<span class="ident" id="7982854">errClosing</span>&nbsp;<span class="op" id="7982865">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7982870">t</span><span class="op" id="7982871">.</span><span class="ident" id="7982872">Fatalf</span><span class="op" id="7982878">(</span><span class="string" id="7982879">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7982910">,</span>&nbsp;<span class="ident" id="7982912">errClosing</span><span class="op" id="7982922">,</span>&nbsp;<span class="ident" id="7982924">err</span><span class="op" id="7982927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7982931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982934">default</span><span class="op" id="7982941">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7982945">if</span>&nbsp;<span class="ident" id="7982948">err</span>&nbsp;<span class="op" id="7982952">==</span>&nbsp;<span class="ident" id="7982955">io</span><span class="op" id="7982957">.</span><span class="ident" id="7982958">EOF</span>&nbsp;<span class="op" id="7982962">&amp;&amp;</span>&nbsp;<span class="ident" id="7982965">runtime</span><span class="op" id="7982972">.</span><span class="ident" id="7982973">GOOS</span>&nbsp;<span class="op" id="7982978">==</span>&nbsp;<span class="string" id="7982981">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7982988">{</span>&nbsp;<span class="comment" id="7982990">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983032">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983044">if</span>&nbsp;<span class="ident" id="7983047">err</span>&nbsp;<span class="op" id="7983051">!=</span>&nbsp;<span class="ident" id="7983054">errClosing</span>&nbsp;<span class="op" id="7983065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983070">t</span><span class="op" id="7983071">.</span><span class="ident" id="7983072">Fatalf</span><span class="op" id="7983078">(</span><span class="string" id="7983079">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7983110">,</span>&nbsp;<span class="ident" id="7983112">errClosing</span><span class="op" id="7983122">,</span>&nbsp;<span class="ident" id="7983124">err</span><span class="op" id="7983127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983134">}</span><br>
<span class="lineno">130</span><span class="op" id="7983136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7983139">func</span>&nbsp;<span class="ident" id="7983144">TestWriteTimeout</span><span class="op" id="7983160">(</span><span class="ident" id="7983161">t</span>&nbsp;<span class="op" id="7983163">*</span><span class="ident" id="7983164">testing</span><span class="op" id="7983171">.</span><span class="ident" id="7983172">T</span><span class="op" id="7983173">)</span>&nbsp;<span class="op" id="7983175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983178">switch</span>&nbsp;<span class="ident" id="7983185">runtime</span><span class="op" id="7983192">.</span><span class="ident" id="7983193">GOOS</span>&nbsp;<span class="op" id="7983198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983201">case</span>&nbsp;<span class="string" id="7983206">&#34;plan9&#34;</span><span class="op" id="7983213">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983217">t</span><span class="op" id="7983218">.</span><span class="ident" id="7983219">Skipf</span><span class="op" id="7983224">(</span><span class="string" id="7983225">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7983246">,</span>&nbsp;<span class="ident" id="7983248">runtime</span><span class="op" id="7983255">.</span><span class="ident" id="7983256">GOOS</span><span class="op" id="7983260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983267">ln</span>&nbsp;<span class="op" id="7983270">:=</span>&nbsp;<span class="ident" id="7983273">newLocalListener</span><span class="op" id="7983289">(</span><span class="ident" id="7983290">t</span><span class="op" id="7983291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983294">defer</span>&nbsp;<span class="ident" id="7983300">ln</span><span class="op" id="7983302">.</span><span class="ident" id="7983303">Close</span><span class="op" id="7983308">(</span><span class="op" id="7983309">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983312">c</span><span class="op" id="7983313">,</span>&nbsp;<span class="ident" id="7983315">err</span>&nbsp;<span class="op" id="7983319">:=</span>&nbsp;<span class="ident" id="7983322">DialTCP</span><span class="op" id="7983329">(</span><span class="string" id="7983330">&#34;tcp&#34;</span><span class="op" id="7983335">,</span>&nbsp;<span class="ident" id="7983337">nil</span><span class="op" id="7983340">,</span>&nbsp;<span class="ident" id="7983342">ln</span><span class="op" id="7983344">.</span><span class="ident" id="7983345">Addr</span><span class="op" id="7983349">(</span><span class="op" id="7983350">)</span><span class="op" id="7983351">.</span><span class="op" id="7983352">(</span><span class="op" id="7983353">*</span><span class="ident" id="7983354">TCPAddr</span><span class="op" id="7983361">)</span><span class="op" id="7983362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983365">if</span>&nbsp;<span class="ident" id="7983368">err</span>&nbsp;<span class="op" id="7983372">!=</span>&nbsp;<span class="ident" id="7983375">nil</span>&nbsp;<span class="op" id="7983379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983383">t</span><span class="op" id="7983384">.</span><span class="ident" id="7983385">Fatalf</span><span class="op" id="7983391">(</span><span class="string" id="7983392">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="7983405">,</span>&nbsp;<span class="ident" id="7983407">err</span><span class="op" id="7983410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983416">defer</span>&nbsp;<span class="ident" id="7983422">c</span><span class="op" id="7983423">.</span><span class="ident" id="7983424">Close</span><span class="op" id="7983429">(</span><span class="op" id="7983430">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983433">c</span><span class="op" id="7983434">.</span><span class="ident" id="7983435">SetDeadline</span><span class="op" id="7983446">(</span><span class="ident" id="7983447">time</span><span class="op" id="7983451">.</span><span class="ident" id="7983452">Now</span><span class="op" id="7983455">(</span><span class="op" id="7983456">)</span><span class="op" id="7983457">.</span><span class="ident" id="7983458">Add</span><span class="op" id="7983461">(</span><span class="ident" id="7983462">time</span><span class="op" id="7983466">.</span><span class="ident" id="7983467">Hour</span><span class="op" id="7983471">)</span><span class="op" id="7983472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983475">c</span><span class="op" id="7983476">.</span><span class="ident" id="7983477">SetWriteDeadline</span><span class="op" id="7983493">(</span><span class="ident" id="7983494">time</span><span class="op" id="7983498">.</span><span class="ident" id="7983499">Now</span><span class="op" id="7983502">(</span><span class="op" id="7983503">)</span><span class="op" id="7983504">.</span><span class="ident" id="7983505">Add</span><span class="op" id="7983508">(</span><span class="op" id="7983509">-</span><span class="num" id="7983510">1</span>&nbsp;<span class="op" id="7983512">*</span>&nbsp;<span class="ident" id="7983514">time</span><span class="op" id="7983518">.</span><span class="ident" id="7983519">Second</span><span class="op" id="7983525">)</span><span class="op" id="7983526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983529">buf</span>&nbsp;<span class="op" id="7983533">:=</span>&nbsp;<span class="builtinfunc" id="7983536">make</span><span class="op" id="7983540">(</span><span class="op" id="7983541">[</span><span class="op" id="7983542">]</span><span class="builtintype" id="7983543">byte</span><span class="op" id="7983547">,</span>&nbsp;<span class="num" id="7983549">4096</span><span class="op" id="7983553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983556">writeUntilTimeout</span>&nbsp;<span class="op" id="7983574">:=</span>&nbsp;<span class="keyword" id="7983577">func</span><span class="op" id="7983581">(</span><span class="op" id="7983582">)</span>&nbsp;<span class="op" id="7983584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983588">for</span>&nbsp;<span class="op" id="7983592">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983597">_</span><span class="op" id="7983598">,</span>&nbsp;<span class="ident" id="7983600">err</span>&nbsp;<span class="op" id="7983604">:=</span>&nbsp;<span class="ident" id="7983607">c</span><span class="op" id="7983608">.</span><span class="ident" id="7983609">Write</span><span class="op" id="7983614">(</span><span class="ident" id="7983615">buf</span><span class="op" id="7983618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983623">if</span>&nbsp;<span class="ident" id="7983626">err</span>&nbsp;<span class="op" id="7983630">!=</span>&nbsp;<span class="ident" id="7983633">nil</span>&nbsp;<span class="op" id="7983637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983643">if</span>&nbsp;<span class="ident" id="7983646">isTimeout</span><span class="op" id="7983655">(</span><span class="ident" id="7983656">err</span><span class="op" id="7983659">)</span>&nbsp;<span class="op" id="7983661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983668">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983679">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983685">t</span><span class="op" id="7983686">.</span><span class="ident" id="7983687">Fatalf</span><span class="op" id="7983693">(</span><span class="string" id="7983694">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7983726">,</span>&nbsp;<span class="ident" id="7983728">errTimeout</span><span class="op" id="7983738">,</span>&nbsp;<span class="ident" id="7983740">err</span><span class="op" id="7983743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7983755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983758">writeUntilTimeout</span><span class="op" id="7983775">(</span><span class="op" id="7983776">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983779">c</span><span class="op" id="7983780">.</span><span class="ident" id="7983781">SetDeadline</span><span class="op" id="7983792">(</span><span class="ident" id="7983793">time</span><span class="op" id="7983797">.</span><span class="ident" id="7983798">Now</span><span class="op" id="7983801">(</span><span class="op" id="7983802">)</span><span class="op" id="7983803">.</span><span class="ident" id="7983804">Add</span><span class="op" id="7983807">(</span><span class="num" id="7983808">10</span>&nbsp;<span class="op" id="7983811">*</span>&nbsp;<span class="ident" id="7983813">time</span><span class="op" id="7983817">.</span><span class="ident" id="7983818">Millisecond</span><span class="op" id="7983829">)</span><span class="op" id="7983830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983833">writeUntilTimeout</span><span class="op" id="7983850">(</span><span class="op" id="7983851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983854">writeUntilTimeout</span><span class="op" id="7983871">(</span><span class="op" id="7983872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983875">c</span><span class="op" id="7983876">.</span><span class="ident" id="7983877">SetWriteDeadline</span><span class="op" id="7983893">(</span><span class="ident" id="7983894">noDeadline</span><span class="op" id="7983904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983907">c</span><span class="op" id="7983908">.</span><span class="ident" id="7983909">SetReadDeadline</span><span class="op" id="7983924">(</span><span class="ident" id="7983925">time</span><span class="op" id="7983929">.</span><span class="ident" id="7983930">Now</span><span class="op" id="7983933">(</span><span class="op" id="7983934">)</span><span class="op" id="7983935">.</span><span class="ident" id="7983936">Add</span><span class="op" id="7983939">(</span><span class="op" id="7983940">-</span><span class="num" id="7983941">1</span>&nbsp;<span class="op" id="7983943">*</span>&nbsp;<span class="ident" id="7983945">time</span><span class="op" id="7983949">.</span><span class="ident" id="7983950">Second</span><span class="op" id="7983956">)</span><span class="op" id="7983957">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7983960">errc</span>&nbsp;<span class="op" id="7983965">:=</span>&nbsp;<span class="builtinfunc" id="7983968">make</span><span class="op" id="7983972">(</span><span class="keyword" id="7983973">chan</span>&nbsp;<span class="builtintype" id="7983978">error</span><span class="op" id="7983983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7983986">go</span>&nbsp;<span class="keyword" id="7983989">func</span><span class="op" id="7983993">(</span><span class="op" id="7983994">)</span>&nbsp;<span class="op" id="7983996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984000">for</span>&nbsp;<span class="op" id="7984004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984009">_</span><span class="op" id="7984010">,</span>&nbsp;<span class="ident" id="7984012">err</span>&nbsp;<span class="op" id="7984016">:=</span>&nbsp;<span class="ident" id="7984019">c</span><span class="op" id="7984020">.</span><span class="ident" id="7984021">Write</span><span class="op" id="7984026">(</span><span class="ident" id="7984027">buf</span><span class="op" id="7984030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984035">if</span>&nbsp;<span class="ident" id="7984038">err</span>&nbsp;<span class="op" id="7984042">!=</span>&nbsp;<span class="ident" id="7984045">nil</span>&nbsp;<span class="op" id="7984049">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984055">errc</span>&nbsp;<span class="op" id="7984060">&lt;-</span>&nbsp;<span class="ident" id="7984063">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984077">}</span><span class="op" id="7984078">(</span><span class="op" id="7984079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984082">time</span><span class="op" id="7984086">.</span><span class="ident" id="7984087">Sleep</span><span class="op" id="7984092">(</span><span class="num" id="7984093">100</span>&nbsp;<span class="op" id="7984097">*</span>&nbsp;<span class="ident" id="7984099">time</span><span class="op" id="7984103">.</span><span class="ident" id="7984104">Millisecond</span><span class="op" id="7984115">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984118">select</span>&nbsp;<span class="op" id="7984125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984128">case</span>&nbsp;<span class="ident" id="7984133">err</span>&nbsp;<span class="op" id="7984137">:=</span>&nbsp;<span class="op" id="7984140">&lt;-</span><span class="ident" id="7984142">errc</span><span class="op" id="7984146">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984150">t</span><span class="op" id="7984151">.</span><span class="ident" id="7984152">Fatalf</span><span class="op" id="7984158">(</span><span class="string" id="7984159">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="7984218">,</span>&nbsp;<span class="ident" id="7984220">err</span><span class="op" id="7984223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984226">default</span><span class="op" id="7984233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984236">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984239">c</span><span class="op" id="7984240">.</span><span class="ident" id="7984241">Close</span><span class="op" id="7984246">(</span><span class="op" id="7984247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984250">switch</span>&nbsp;<span class="ident" id="7984257">nerr</span>&nbsp;<span class="op" id="7984262">:=</span>&nbsp;<span class="op" id="7984265">&lt;-</span><span class="ident" id="7984267">errc</span><span class="op" id="7984271">;</span>&nbsp;<span class="ident" id="7984273">err</span>&nbsp;<span class="op" id="7984277">:=</span>&nbsp;<span class="ident" id="7984280">nerr</span><span class="op" id="7984284">.</span><span class="op" id="7984285">(</span><span class="keyword" id="7984286">type</span><span class="op" id="7984290">)</span>&nbsp;<span class="op" id="7984292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984295">case</span>&nbsp;<span class="op" id="7984300">*</span><span class="ident" id="7984301">OpError</span><span class="op" id="7984308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984312">if</span>&nbsp;<span class="ident" id="7984315">err</span><span class="op" id="7984318">.</span><span class="ident" id="7984319">Err</span>&nbsp;<span class="op" id="7984323">!=</span>&nbsp;<span class="ident" id="7984326">errClosing</span>&nbsp;<span class="op" id="7984337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984342">t</span><span class="op" id="7984343">.</span><span class="ident" id="7984344">Fatalf</span><span class="op" id="7984350">(</span><span class="string" id="7984351">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7984383">,</span>&nbsp;<span class="ident" id="7984385">errClosing</span><span class="op" id="7984395">,</span>&nbsp;<span class="ident" id="7984397">err</span><span class="op" id="7984400">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984407">default</span><span class="op" id="7984414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984418">if</span>&nbsp;<span class="ident" id="7984421">err</span>&nbsp;<span class="op" id="7984425">!=</span>&nbsp;<span class="ident" id="7984428">errClosing</span>&nbsp;<span class="op" id="7984439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984444">t</span><span class="op" id="7984445">.</span><span class="ident" id="7984446">Fatalf</span><span class="op" id="7984452">(</span><span class="string" id="7984453">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7984485">,</span>&nbsp;<span class="ident" id="7984487">errClosing</span><span class="op" id="7984497">,</span>&nbsp;<span class="ident" id="7984499">err</span><span class="op" id="7984502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984506">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984509">}</span><br>
<span class="lineno"></span><span class="op" id="7984511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7984514">func</span>&nbsp;<span class="ident" id="7984519">testTimeout</span><span class="op" id="7984530">(</span><span class="ident" id="7984531">t</span>&nbsp;<span class="op" id="7984533">*</span><span class="ident" id="7984534">testing</span><span class="op" id="7984541">.</span><span class="ident" id="7984542">T</span><span class="op" id="7984543">,</span>&nbsp;<span class="ident" id="7984545">net</span><span class="op" id="7984548">,</span>&nbsp;<span class="ident" id="7984550">addr</span>&nbsp;<span class="builtintype" id="7984555">string</span><span class="op" id="7984561">,</span>&nbsp;<span class="ident" id="7984563">readFrom</span>&nbsp;<span class="builtintype" id="7984572">bool</span><span class="op" id="7984576">)</span>&nbsp;<span class="op" id="7984578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984581">c</span><span class="op" id="7984582">,</span>&nbsp;<span class="ident" id="7984584">err</span>&nbsp;<span class="op" id="7984588">:=</span>&nbsp;<span class="ident" id="7984591">Dial</span><span class="op" id="7984595">(</span><span class="ident" id="7984596">net</span><span class="op" id="7984599">,</span>&nbsp;<span class="ident" id="7984601">addr</span><span class="op" id="7984605">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984608">if</span>&nbsp;<span class="ident" id="7984611">err</span>&nbsp;<span class="op" id="7984615">!=</span>&nbsp;<span class="ident" id="7984618">nil</span>&nbsp;<span class="op" id="7984622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984626">t</span><span class="op" id="7984627">.</span><span class="ident" id="7984628">Errorf</span><span class="op" id="7984634">(</span><span class="string" id="7984635">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7984660">,</span>&nbsp;<span class="ident" id="7984662">net</span><span class="op" id="7984665">,</span>&nbsp;<span class="ident" id="7984667">addr</span><span class="op" id="7984671">,</span>&nbsp;<span class="ident" id="7984673">err</span><span class="op" id="7984676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984691">defer</span>&nbsp;<span class="ident" id="7984697">c</span><span class="op" id="7984698">.</span><span class="ident" id="7984699">Close</span><span class="op" id="7984704">(</span><span class="op" id="7984705">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984708">what</span>&nbsp;<span class="op" id="7984713">:=</span>&nbsp;<span class="string" id="7984716">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984724">if</span>&nbsp;<span class="ident" id="7984727">readFrom</span>&nbsp;<span class="op" id="7984736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984740">what</span>&nbsp;<span class="op" id="7984745">=</span>&nbsp;<span class="string" id="7984747">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984763">errc</span>&nbsp;<span class="op" id="7984768">:=</span>&nbsp;<span class="builtinfunc" id="7984771">make</span><span class="op" id="7984775">(</span><span class="keyword" id="7984776">chan</span>&nbsp;<span class="builtintype" id="7984781">error</span><span class="op" id="7984786">,</span>&nbsp;<span class="num" id="7984788">1</span><span class="op" id="7984789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984792">go</span>&nbsp;<span class="keyword" id="7984795">func</span><span class="op" id="7984799">(</span><span class="op" id="7984800">)</span>&nbsp;<span class="op" id="7984802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984806">t0</span>&nbsp;<span class="op" id="7984809">:=</span>&nbsp;<span class="ident" id="7984812">time</span><span class="op" id="7984816">.</span><span class="ident" id="7984817">Now</span><span class="op" id="7984820">(</span><span class="op" id="7984821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984825">c</span><span class="op" id="7984826">.</span><span class="ident" id="7984827">SetReadDeadline</span><span class="op" id="7984842">(</span><span class="ident" id="7984843">time</span><span class="op" id="7984847">.</span><span class="ident" id="7984848">Now</span><span class="op" id="7984851">(</span><span class="op" id="7984852">)</span><span class="op" id="7984853">.</span><span class="ident" id="7984854">Add</span><span class="op" id="7984857">(</span><span class="num" id="7984858">100</span>&nbsp;<span class="op" id="7984862">*</span>&nbsp;<span class="ident" id="7984864">time</span><span class="op" id="7984868">.</span><span class="ident" id="7984869">Millisecond</span><span class="op" id="7984880">)</span><span class="op" id="7984881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984885">var</span>&nbsp;<span class="ident" id="7984889">b</span>&nbsp;<span class="op" id="7984891">[</span><span class="num" id="7984892">100</span><span class="op" id="7984895">]</span><span class="builtintype" id="7984896">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984903">var</span>&nbsp;<span class="ident" id="7984907">n</span>&nbsp;<span class="builtintype" id="7984909">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984915">var</span>&nbsp;<span class="ident" id="7984919">err</span>&nbsp;<span class="builtintype" id="7984923">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7984931">if</span>&nbsp;<span class="ident" id="7984934">readFrom</span>&nbsp;<span class="op" id="7984943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7984948">n</span><span class="op" id="7984949">,</span>&nbsp;<span class="ident" id="7984951">_</span><span class="op" id="7984952">,</span>&nbsp;<span class="ident" id="7984954">err</span>&nbsp;<span class="op" id="7984958">=</span>&nbsp;<span class="ident" id="7984960">c</span><span class="op" id="7984961">.</span><span class="op" id="7984962">(</span><span class="ident" id="7984963">PacketConn</span><span class="op" id="7984973">)</span><span class="op" id="7984974">.</span><span class="ident" id="7984975">ReadFrom</span><span class="op" id="7984983">(</span><span class="ident" id="7984984">b</span><span class="op" id="7984985">[</span><span class="num" id="7984986">0</span><span class="op" id="7984987">:</span><span class="op" id="7984988">]</span><span class="op" id="7984989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7984993">}</span>&nbsp;<span class="keyword" id="7984995">else</span>&nbsp;<span class="op" id="7985000">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985005">n</span><span class="op" id="7985006">,</span>&nbsp;<span class="ident" id="7985008">err</span>&nbsp;<span class="op" id="7985012">=</span>&nbsp;<span class="ident" id="7985014">c</span><span class="op" id="7985015">.</span><span class="ident" id="7985016">Read</span><span class="op" id="7985020">(</span><span class="ident" id="7985021">b</span><span class="op" id="7985022">[</span><span class="num" id="7985023">0</span><span class="op" id="7985024">:</span><span class="op" id="7985025">]</span><span class="op" id="7985026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985034">t1</span>&nbsp;<span class="op" id="7985037">:=</span>&nbsp;<span class="ident" id="7985040">time</span><span class="op" id="7985044">.</span><span class="ident" id="7985045">Now</span><span class="op" id="7985048">(</span><span class="op" id="7985049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985053">if</span>&nbsp;<span class="ident" id="7985056">n</span>&nbsp;<span class="op" id="7985058">!=</span>&nbsp;<span class="num" id="7985061">0</span>&nbsp;<span class="op" id="7985063">||</span>&nbsp;<span class="ident" id="7985066">err</span>&nbsp;<span class="op" id="7985070">==</span>&nbsp;<span class="ident" id="7985073">nil</span>&nbsp;<span class="op" id="7985077">||</span>&nbsp;<span class="op" id="7985080">!</span><span class="ident" id="7985081">err</span><span class="op" id="7985084">.</span><span class="op" id="7985085">(</span><span class="ident" id="7985086">Error</span><span class="op" id="7985091">)</span><span class="op" id="7985092">.</span><span class="ident" id="7985093">Timeout</span><span class="op" id="7985100">(</span><span class="op" id="7985101">)</span>&nbsp;<span class="op" id="7985103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985108">errc</span>&nbsp;<span class="op" id="7985113">&lt;-</span>&nbsp;<span class="ident" id="7985116">fmt</span><span class="op" id="7985119">.</span><span class="ident" id="7985120">Errorf</span><span class="op" id="7985126">(</span><span class="string" id="7985127">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="7985173">,</span>&nbsp;<span class="ident" id="7985175">what</span><span class="op" id="7985179">,</span>&nbsp;<span class="ident" id="7985181">net</span><span class="op" id="7985184">,</span>&nbsp;<span class="ident" id="7985186">addr</span><span class="op" id="7985190">,</span>&nbsp;<span class="ident" id="7985192">n</span><span class="op" id="7985193">,</span>&nbsp;<span class="ident" id="7985195">err</span><span class="op" id="7985198">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985203">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985216">if</span>&nbsp;<span class="ident" id="7985219">dt</span>&nbsp;<span class="op" id="7985222">:=</span>&nbsp;<span class="ident" id="7985225">t1</span><span class="op" id="7985227">.</span><span class="ident" id="7985228">Sub</span><span class="op" id="7985231">(</span><span class="ident" id="7985232">t0</span><span class="op" id="7985234">)</span><span class="op" id="7985235">;</span>&nbsp;<span class="ident" id="7985237">dt</span>&nbsp;<span class="op" id="7985240">&lt;</span>&nbsp;<span class="num" id="7985242">50</span><span class="op" id="7985244">*</span><span class="ident" id="7985245">time</span><span class="op" id="7985249">.</span><span class="ident" id="7985250">Millisecond</span>&nbsp;<span class="op" id="7985262">||</span>&nbsp;<span class="op" id="7985265">!</span><span class="ident" id="7985266">testing</span><span class="op" id="7985273">.</span><span class="ident" id="7985274">Short</span><span class="op" id="7985279">(</span><span class="op" id="7985280">)</span>&nbsp;<span class="op" id="7985282">&amp;&amp;</span>&nbsp;<span class="ident" id="7985285">dt</span>&nbsp;<span class="op" id="7985288">&gt;</span>&nbsp;<span class="num" id="7985290">250</span><span class="op" id="7985293">*</span><span class="ident" id="7985294">time</span><span class="op" id="7985298">.</span><span class="ident" id="7985299">Millisecond</span>&nbsp;<span class="op" id="7985311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985316">errc</span>&nbsp;<span class="op" id="7985321">&lt;-</span>&nbsp;<span class="ident" id="7985324">fmt</span><span class="op" id="7985327">.</span><span class="ident" id="7985328">Errorf</span><span class="op" id="7985334">(</span><span class="string" id="7985335">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="7985370">,</span>&nbsp;<span class="ident" id="7985372">what</span><span class="op" id="7985376">,</span>&nbsp;<span class="ident" id="7985378">net</span><span class="op" id="7985381">,</span>&nbsp;<span class="ident" id="7985383">addr</span><span class="op" id="7985387">,</span>&nbsp;<span class="ident" id="7985389">dt</span><span class="op" id="7985391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985396">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985409">errc</span>&nbsp;<span class="op" id="7985414">&lt;-</span>&nbsp;<span class="ident" id="7985417">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985422">}</span><span class="op" id="7985423">(</span><span class="op" id="7985424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985427">select</span>&nbsp;<span class="op" id="7985434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985437">case</span>&nbsp;<span class="ident" id="7985442">err</span>&nbsp;<span class="op" id="7985446">:=</span>&nbsp;<span class="op" id="7985449">&lt;-</span><span class="ident" id="7985451">errc</span><span class="op" id="7985455">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985459">if</span>&nbsp;<span class="ident" id="7985462">err</span>&nbsp;<span class="op" id="7985466">!=</span>&nbsp;<span class="ident" id="7985469">nil</span>&nbsp;<span class="op" id="7985473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985478">t</span><span class="op" id="7985479">.</span><span class="ident" id="7985480">Error</span><span class="op" id="7985485">(</span><span class="ident" id="7985486">err</span><span class="op" id="7985489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985496">case</span>&nbsp;<span class="op" id="7985501">&lt;-</span><span class="ident" id="7985503">time</span><span class="op" id="7985507">.</span><span class="ident" id="7985508">After</span><span class="op" id="7985513">(</span><span class="num" id="7985514">1</span>&nbsp;<span class="op" id="7985516">*</span>&nbsp;<span class="ident" id="7985518">time</span><span class="op" id="7985522">.</span><span class="ident" id="7985523">Second</span><span class="op" id="7985529">)</span><span class="op" id="7985530">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985534">t</span><span class="op" id="7985535">.</span><span class="ident" id="7985536">Errorf</span><span class="op" id="7985542">(</span><span class="string" id="7985543">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="7985589">,</span>&nbsp;<span class="ident" id="7985591">what</span><span class="op" id="7985595">,</span>&nbsp;<span class="ident" id="7985597">net</span><span class="op" id="7985600">,</span>&nbsp;<span class="ident" id="7985602">addr</span><span class="op" id="7985606">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985609">}</span><br>
<span class="lineno"></span><span class="op" id="7985611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7985614">func</span>&nbsp;<span class="ident" id="7985619">TestTimeoutUDP</span><span class="op" id="7985633">(</span><span class="ident" id="7985634">t</span>&nbsp;<span class="op" id="7985636">*</span><span class="ident" id="7985637">testing</span><span class="op" id="7985644">.</span><span class="ident" id="7985645">T</span><span class="op" id="7985646">)</span>&nbsp;<span class="op" id="7985648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985651">switch</span>&nbsp;<span class="ident" id="7985658">runtime</span><span class="op" id="7985665">.</span><span class="ident" id="7985666">GOOS</span>&nbsp;<span class="op" id="7985671">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985674">case</span>&nbsp;<span class="string" id="7985679">&#34;plan9&#34;</span><span class="op" id="7985686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985690">t</span><span class="op" id="7985691">.</span><span class="ident" id="7985692">Skipf</span><span class="op" id="7985697">(</span><span class="string" id="7985698">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7985719">,</span>&nbsp;<span class="ident" id="7985721">runtime</span><span class="op" id="7985728">.</span><span class="ident" id="7985729">GOOS</span><span class="op" id="7985733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7985736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7985740">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985783">listening</span>&nbsp;<span class="op" id="7985793">:=</span>&nbsp;<span class="builtinfunc" id="7985796">make</span><span class="op" id="7985800">(</span><span class="keyword" id="7985801">chan</span>&nbsp;<span class="builtintype" id="7985806">string</span><span class="op" id="7985812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985815">done</span>&nbsp;<span class="op" id="7985820">:=</span>&nbsp;<span class="builtinfunc" id="7985823">make</span><span class="op" id="7985827">(</span><span class="keyword" id="7985828">chan</span>&nbsp;<span class="builtintype" id="7985833">int</span><span class="op" id="7985836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7985839">go</span>&nbsp;<span class="ident" id="7985842">runDatagramPacketConnServer</span><span class="op" id="7985869">(</span><span class="ident" id="7985870">t</span><span class="op" id="7985871">,</span>&nbsp;<span class="string" id="7985873">&#34;udp&#34;</span><span class="op" id="7985878">,</span>&nbsp;<span class="string" id="7985880">&#34;127.0.0.1:0&#34;</span><span class="op" id="7985893">,</span>&nbsp;<span class="ident" id="7985895">listening</span><span class="op" id="7985904">,</span>&nbsp;<span class="ident" id="7985906">done</span><span class="op" id="7985910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985913">addr</span>&nbsp;<span class="op" id="7985918">:=</span>&nbsp;<span class="op" id="7985921">&lt;-</span><span class="ident" id="7985923">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985935">testTimeout</span><span class="op" id="7985946">(</span><span class="ident" id="7985947">t</span><span class="op" id="7985948">,</span>&nbsp;<span class="string" id="7985950">&#34;udp&#34;</span><span class="op" id="7985955">,</span>&nbsp;<span class="ident" id="7985957">addr</span><span class="op" id="7985961">,</span>&nbsp;<span class="builtintype" id="7985963">false</span><span class="op" id="7985968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7985971">testTimeout</span><span class="op" id="7985982">(</span><span class="ident" id="7985983">t</span><span class="op" id="7985984">,</span>&nbsp;<span class="string" id="7985986">&#34;udp&#34;</span><span class="op" id="7985991">,</span>&nbsp;<span class="ident" id="7985993">addr</span><span class="op" id="7985997">,</span>&nbsp;<span class="builtintype" id="7985999">true</span><span class="op" id="7986003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986006">&lt;-</span><span class="ident" id="7986008">done</span><br>
<span class="lineno"></span><span class="op" id="7986013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="7986016">func</span>&nbsp;<span class="ident" id="7986021">TestTimeoutTCP</span><span class="op" id="7986035">(</span><span class="ident" id="7986036">t</span>&nbsp;<span class="op" id="7986038">*</span><span class="ident" id="7986039">testing</span><span class="op" id="7986046">.</span><span class="ident" id="7986047">T</span><span class="op" id="7986048">)</span>&nbsp;<span class="op" id="7986050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986053">switch</span>&nbsp;<span class="ident" id="7986060">runtime</span><span class="op" id="7986067">.</span><span class="ident" id="7986068">GOOS</span>&nbsp;<span class="op" id="7986073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986076">case</span>&nbsp;<span class="string" id="7986081">&#34;plan9&#34;</span><span class="op" id="7986088">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986092">t</span><span class="op" id="7986093">.</span><span class="ident" id="7986094">Skipf</span><span class="op" id="7986099">(</span><span class="string" id="7986100">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7986121">,</span>&nbsp;<span class="ident" id="7986123">runtime</span><span class="op" id="7986130">.</span><span class="ident" id="7986131">GOOS</span><span class="op" id="7986135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986138">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986142">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986185">listening</span>&nbsp;<span class="op" id="7986195">:=</span>&nbsp;<span class="builtinfunc" id="7986198">make</span><span class="op" id="7986202">(</span><span class="keyword" id="7986203">chan</span>&nbsp;<span class="builtintype" id="7986208">string</span><span class="op" id="7986214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986217">done</span>&nbsp;<span class="op" id="7986222">:=</span>&nbsp;<span class="builtinfunc" id="7986225">make</span><span class="op" id="7986229">(</span><span class="keyword" id="7986230">chan</span>&nbsp;<span class="builtintype" id="7986235">int</span><span class="op" id="7986238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986241">go</span>&nbsp;<span class="ident" id="7986244">runStreamConnServer</span><span class="op" id="7986263">(</span><span class="ident" id="7986264">t</span><span class="op" id="7986265">,</span>&nbsp;<span class="string" id="7986267">&#34;tcp&#34;</span><span class="op" id="7986272">,</span>&nbsp;<span class="string" id="7986274">&#34;127.0.0.1:0&#34;</span><span class="op" id="7986287">,</span>&nbsp;<span class="ident" id="7986289">listening</span><span class="op" id="7986298">,</span>&nbsp;<span class="ident" id="7986300">done</span><span class="op" id="7986304">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986307">addr</span>&nbsp;<span class="op" id="7986312">:=</span>&nbsp;<span class="op" id="7986315">&lt;-</span><span class="ident" id="7986317">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986329">testTimeout</span><span class="op" id="7986340">(</span><span class="ident" id="7986341">t</span><span class="op" id="7986342">,</span>&nbsp;<span class="string" id="7986344">&#34;tcp&#34;</span><span class="op" id="7986349">,</span>&nbsp;<span class="ident" id="7986351">addr</span><span class="op" id="7986355">,</span>&nbsp;<span class="builtintype" id="7986357">false</span><span class="op" id="7986362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986365">&lt;-</span><span class="ident" id="7986367">done</span><br>
<span class="lineno"></span><span class="op" id="7986372">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="7986375">func</span>&nbsp;<span class="ident" id="7986380">TestDeadlineReset</span><span class="op" id="7986397">(</span><span class="ident" id="7986398">t</span>&nbsp;<span class="op" id="7986400">*</span><span class="ident" id="7986401">testing</span><span class="op" id="7986408">.</span><span class="ident" id="7986409">T</span><span class="op" id="7986410">)</span>&nbsp;<span class="op" id="7986412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986415">switch</span>&nbsp;<span class="ident" id="7986422">runtime</span><span class="op" id="7986429">.</span><span class="ident" id="7986430">GOOS</span>&nbsp;<span class="op" id="7986435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986438">case</span>&nbsp;<span class="string" id="7986443">&#34;plan9&#34;</span><span class="op" id="7986450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986454">t</span><span class="op" id="7986455">.</span><span class="ident" id="7986456">Skipf</span><span class="op" id="7986461">(</span><span class="string" id="7986462">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7986483">,</span>&nbsp;<span class="ident" id="7986485">runtime</span><span class="op" id="7986492">.</span><span class="ident" id="7986493">GOOS</span><span class="op" id="7986497">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986503">ln</span><span class="op" id="7986505">,</span>&nbsp;<span class="ident" id="7986507">err</span>&nbsp;<span class="op" id="7986511">:=</span>&nbsp;<span class="ident" id="7986514">Listen</span><span class="op" id="7986520">(</span><span class="string" id="7986521">&#34;tcp&#34;</span><span class="op" id="7986526">,</span>&nbsp;<span class="string" id="7986528">&#34;127.0.0.1:0&#34;</span><span class="op" id="7986541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986544">if</span>&nbsp;<span class="ident" id="7986547">err</span>&nbsp;<span class="op" id="7986551">!=</span>&nbsp;<span class="ident" id="7986554">nil</span>&nbsp;<span class="op" id="7986558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986562">t</span><span class="op" id="7986563">.</span><span class="ident" id="7986564">Fatal</span><span class="op" id="7986569">(</span><span class="ident" id="7986570">err</span><span class="op" id="7986573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986576">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986579">defer</span>&nbsp;<span class="ident" id="7986585">ln</span><span class="op" id="7986587">.</span><span class="ident" id="7986588">Close</span><span class="op" id="7986593">(</span><span class="op" id="7986594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986597">tl</span>&nbsp;<span class="op" id="7986600">:=</span>&nbsp;<span class="ident" id="7986603">ln</span><span class="op" id="7986605">.</span><span class="op" id="7986606">(</span><span class="op" id="7986607">*</span><span class="ident" id="7986608">TCPListener</span><span class="op" id="7986619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986622">tl</span><span class="op" id="7986624">.</span><span class="ident" id="7986625">SetDeadline</span><span class="op" id="7986636">(</span><span class="ident" id="7986637">time</span><span class="op" id="7986641">.</span><span class="ident" id="7986642">Now</span><span class="op" id="7986645">(</span><span class="op" id="7986646">)</span><span class="op" id="7986647">.</span><span class="ident" id="7986648">Add</span><span class="op" id="7986651">(</span><span class="num" id="7986652">1</span>&nbsp;<span class="op" id="7986654">*</span>&nbsp;<span class="ident" id="7986656">time</span><span class="op" id="7986660">.</span><span class="ident" id="7986661">Minute</span><span class="op" id="7986667">)</span><span class="op" id="7986668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986671">tl</span><span class="op" id="7986673">.</span><span class="ident" id="7986674">SetDeadline</span><span class="op" id="7986685">(</span><span class="ident" id="7986686">noDeadline</span><span class="op" id="7986696">)</span>&nbsp;<span class="comment" id="7986698">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986711">errc</span>&nbsp;<span class="op" id="7986716">:=</span>&nbsp;<span class="builtinfunc" id="7986719">make</span><span class="op" id="7986723">(</span><span class="keyword" id="7986724">chan</span>&nbsp;<span class="builtintype" id="7986729">error</span><span class="op" id="7986734">,</span>&nbsp;<span class="num" id="7986736">1</span><span class="op" id="7986737">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986740">go</span>&nbsp;<span class="keyword" id="7986743">func</span><span class="op" id="7986747">(</span><span class="op" id="7986748">)</span>&nbsp;<span class="op" id="7986750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986754">_</span><span class="op" id="7986755">,</span>&nbsp;<span class="ident" id="7986757">err</span>&nbsp;<span class="op" id="7986761">:=</span>&nbsp;<span class="ident" id="7986764">ln</span><span class="op" id="7986766">.</span><span class="ident" id="7986767">Accept</span><span class="op" id="7986773">(</span><span class="op" id="7986774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986778">errc</span>&nbsp;<span class="op" id="7986783">&lt;-</span>&nbsp;<span class="ident" id="7986786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7986791">}</span><span class="op" id="7986792">(</span><span class="op" id="7986793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986796">select</span>&nbsp;<span class="op" id="7986803">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986806">case</span>&nbsp;<span class="op" id="7986811">&lt;-</span><span class="ident" id="7986813">time</span><span class="op" id="7986817">.</span><span class="ident" id="7986818">After</span><span class="op" id="7986823">(</span><span class="num" id="7986824">50</span>&nbsp;<span class="op" id="7986827">*</span>&nbsp;<span class="ident" id="7986829">time</span><span class="op" id="7986833">.</span><span class="ident" id="7986834">Millisecond</span><span class="op" id="7986845">)</span><span class="op" id="7986846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986850">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7986860">case</span>&nbsp;<span class="ident" id="7986865">err</span>&nbsp;<span class="op" id="7986869">:=</span>&nbsp;<span class="op" id="7986872">&lt;-</span><span class="ident" id="7986874">errc</span><span class="op" id="7986878">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986882">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7986924">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7986946">t</span><span class="op" id="7986947">.</span><span class="ident" id="7986948">Errorf</span><span class="op" id="7986954">(</span><span class="string" id="7986955">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="7986994">,</span>&nbsp;<span class="ident" id="7986996">err</span><span class="op" id="7986999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987002">}</span><br>
<span class="lineno"></span><span class="op" id="7987004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7987007">func</span>&nbsp;<span class="ident" id="7987012">TestTimeoutAccept</span><span class="op" id="7987029">(</span><span class="ident" id="7987030">t</span>&nbsp;<span class="op" id="7987032">*</span><span class="ident" id="7987033">testing</span><span class="op" id="7987040">.</span><span class="ident" id="7987041">T</span><span class="op" id="7987042">)</span>&nbsp;<span class="op" id="7987044">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987047">switch</span>&nbsp;<span class="ident" id="7987054">runtime</span><span class="op" id="7987061">.</span><span class="ident" id="7987062">GOOS</span>&nbsp;<span class="op" id="7987067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987070">case</span>&nbsp;<span class="string" id="7987075">&#34;plan9&#34;</span><span class="op" id="7987082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987086">t</span><span class="op" id="7987087">.</span><span class="ident" id="7987088">Skipf</span><span class="op" id="7987093">(</span><span class="string" id="7987094">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7987115">,</span>&nbsp;<span class="ident" id="7987117">runtime</span><span class="op" id="7987124">.</span><span class="ident" id="7987125">GOOS</span><span class="op" id="7987129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987135">ln</span><span class="op" id="7987137">,</span>&nbsp;<span class="ident" id="7987139">err</span>&nbsp;<span class="op" id="7987143">:=</span>&nbsp;<span class="ident" id="7987146">Listen</span><span class="op" id="7987152">(</span><span class="string" id="7987153">&#34;tcp&#34;</span><span class="op" id="7987158">,</span>&nbsp;<span class="string" id="7987160">&#34;127.0.0.1:0&#34;</span><span class="op" id="7987173">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987176">if</span>&nbsp;<span class="ident" id="7987179">err</span>&nbsp;<span class="op" id="7987183">!=</span>&nbsp;<span class="ident" id="7987186">nil</span>&nbsp;<span class="op" id="7987190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987194">t</span><span class="op" id="7987195">.</span><span class="ident" id="7987196">Fatal</span><span class="op" id="7987201">(</span><span class="ident" id="7987202">err</span><span class="op" id="7987205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987211">defer</span>&nbsp;<span class="ident" id="7987217">ln</span><span class="op" id="7987219">.</span><span class="ident" id="7987220">Close</span><span class="op" id="7987225">(</span><span class="op" id="7987226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987229">tl</span>&nbsp;<span class="op" id="7987232">:=</span>&nbsp;<span class="ident" id="7987235">ln</span><span class="op" id="7987237">.</span><span class="op" id="7987238">(</span><span class="op" id="7987239">*</span><span class="ident" id="7987240">TCPListener</span><span class="op" id="7987251">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987254">tl</span><span class="op" id="7987256">.</span><span class="ident" id="7987257">SetDeadline</span><span class="op" id="7987268">(</span><span class="ident" id="7987269">time</span><span class="op" id="7987273">.</span><span class="ident" id="7987274">Now</span><span class="op" id="7987277">(</span><span class="op" id="7987278">)</span><span class="op" id="7987279">.</span><span class="ident" id="7987280">Add</span><span class="op" id="7987283">(</span><span class="num" id="7987284">100</span>&nbsp;<span class="op" id="7987288">*</span>&nbsp;<span class="ident" id="7987290">time</span><span class="op" id="7987294">.</span><span class="ident" id="7987295">Millisecond</span><span class="op" id="7987306">)</span><span class="op" id="7987307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987310">errc</span>&nbsp;<span class="op" id="7987315">:=</span>&nbsp;<span class="builtinfunc" id="7987318">make</span><span class="op" id="7987322">(</span><span class="keyword" id="7987323">chan</span>&nbsp;<span class="builtintype" id="7987328">error</span><span class="op" id="7987333">,</span>&nbsp;<span class="num" id="7987335">1</span><span class="op" id="7987336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987339">go</span>&nbsp;<span class="keyword" id="7987342">func</span><span class="op" id="7987346">(</span><span class="op" id="7987347">)</span>&nbsp;<span class="op" id="7987349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987353">_</span><span class="op" id="7987354">,</span>&nbsp;<span class="ident" id="7987356">err</span>&nbsp;<span class="op" id="7987360">:=</span>&nbsp;<span class="ident" id="7987363">ln</span><span class="op" id="7987365">.</span><span class="ident" id="7987366">Accept</span><span class="op" id="7987372">(</span><span class="op" id="7987373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987377">errc</span>&nbsp;<span class="op" id="7987382">&lt;-</span>&nbsp;<span class="ident" id="7987385">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987390">}</span><span class="op" id="7987391">(</span><span class="op" id="7987392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987395">select</span>&nbsp;<span class="op" id="7987402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987405">case</span>&nbsp;<span class="op" id="7987410">&lt;-</span><span class="ident" id="7987412">time</span><span class="op" id="7987416">.</span><span class="ident" id="7987417">After</span><span class="op" id="7987422">(</span><span class="num" id="7987423">1</span>&nbsp;<span class="op" id="7987425">*</span>&nbsp;<span class="ident" id="7987427">time</span><span class="op" id="7987431">.</span><span class="ident" id="7987432">Second</span><span class="op" id="7987438">)</span><span class="op" id="7987439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7987443">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987484">t</span><span class="op" id="7987485">.</span><span class="ident" id="7987486">Errorf</span><span class="op" id="7987492">(</span><span class="string" id="7987493">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="7987535">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987538">case</span>&nbsp;<span class="op" id="7987543">&lt;-</span><span class="ident" id="7987545">errc</span><span class="op" id="7987549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7987553">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987563">}</span><br>
<span class="lineno"></span><span class="op" id="7987565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="7987568">func</span>&nbsp;<span class="ident" id="7987573">TestReadWriteDeadline</span><span class="op" id="7987594">(</span><span class="ident" id="7987595">t</span>&nbsp;<span class="op" id="7987597">*</span><span class="ident" id="7987598">testing</span><span class="op" id="7987605">.</span><span class="ident" id="7987606">T</span><span class="op" id="7987607">)</span>&nbsp;<span class="op" id="7987609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987612">switch</span>&nbsp;<span class="ident" id="7987619">runtime</span><span class="op" id="7987626">.</span><span class="ident" id="7987627">GOOS</span>&nbsp;<span class="op" id="7987632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987635">case</span>&nbsp;<span class="string" id="7987640">&#34;plan9&#34;</span><span class="op" id="7987647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987651">t</span><span class="op" id="7987652">.</span><span class="ident" id="7987653">Skipf</span><span class="op" id="7987658">(</span><span class="string" id="7987659">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7987680">,</span>&nbsp;<span class="ident" id="7987682">runtime</span><span class="op" id="7987689">.</span><span class="ident" id="7987690">GOOS</span><span class="op" id="7987694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987697">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987701">const</span>&nbsp;<span class="op" id="7987707">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987711">readTimeout</span>&nbsp;&nbsp;<span class="op" id="7987724">=</span>&nbsp;<span class="num" id="7987726">50</span>&nbsp;<span class="op" id="7987729">*</span>&nbsp;<span class="ident" id="7987731">time</span><span class="op" id="7987735">.</span><span class="ident" id="7987736">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987750">writeTimeout</span>&nbsp;<span class="op" id="7987763">=</span>&nbsp;<span class="num" id="7987765">250</span>&nbsp;<span class="op" id="7987769">*</span>&nbsp;<span class="ident" id="7987771">time</span><span class="op" id="7987775">.</span><span class="ident" id="7987776">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7987789">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987792">checkTimeout</span>&nbsp;<span class="op" id="7987805">:=</span>&nbsp;<span class="keyword" id="7987808">func</span><span class="op" id="7987812">(</span><span class="ident" id="7987813">command</span>&nbsp;<span class="builtintype" id="7987821">string</span><span class="op" id="7987827">,</span>&nbsp;<span class="ident" id="7987829">start</span>&nbsp;<span class="ident" id="7987835">time</span><span class="op" id="7987839">.</span><span class="ident" id="7987840">Time</span><span class="op" id="7987844">,</span>&nbsp;<span class="ident" id="7987846">should</span>&nbsp;<span class="ident" id="7987853">time</span><span class="op" id="7987857">.</span><span class="ident" id="7987858">Duration</span><span class="op" id="7987866">)</span>&nbsp;<span class="op" id="7987868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987872">is</span>&nbsp;<span class="op" id="7987875">:=</span>&nbsp;<span class="ident" id="7987878">time</span><span class="op" id="7987882">.</span><span class="ident" id="7987883">Now</span><span class="op" id="7987886">(</span><span class="op" id="7987887">)</span><span class="op" id="7987888">.</span><span class="ident" id="7987889">Sub</span><span class="op" id="7987892">(</span><span class="ident" id="7987893">start</span><span class="op" id="7987898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7987902">d</span>&nbsp;<span class="op" id="7987904">:=</span>&nbsp;<span class="ident" id="7987907">is</span>&nbsp;<span class="op" id="7987910">-</span>&nbsp;<span class="ident" id="7987912">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7987921">if</span>&nbsp;<span class="ident" id="7987924">d</span>&nbsp;<span class="op" id="7987926">&lt;</span>&nbsp;<span class="op" id="7987928">-</span><span class="num" id="7987929">30</span><span class="op" id="7987931">*</span><span class="ident" id="7987932">time</span><span class="op" id="7987936">.</span><span class="ident" id="7987937">Millisecond</span>&nbsp;<span class="op" id="7987949">||</span>&nbsp;<span class="op" id="7987952">!</span><span class="ident" id="7987953">testing</span><span class="op" id="7987960">.</span><span class="ident" id="7987961">Short</span><span class="op" id="7987966">(</span><span class="op" id="7987967">)</span>&nbsp;<span class="op" id="7987969">&amp;&amp;</span>&nbsp;<span class="num" id="7987972">150</span><span class="op" id="7987975">*</span><span class="ident" id="7987976">time</span><span class="op" id="7987980">.</span><span class="ident" id="7987981">Millisecond</span>&nbsp;<span class="op" id="7987993">&lt;</span>&nbsp;<span class="ident" id="7987995">d</span>&nbsp;<span class="op" id="7987997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988002">t</span><span class="op" id="7988003">.</span><span class="ident" id="7988004">Errorf</span><span class="op" id="7988010">(</span><span class="string" id="7988011">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="7988054">,</span>&nbsp;<span class="ident" id="7988056">command</span><span class="op" id="7988063">,</span>&nbsp;<span class="ident" id="7988065">is</span><span class="op" id="7988067">,</span>&nbsp;<span class="ident" id="7988069">should</span><span class="op" id="7988075">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988086">ln</span><span class="op" id="7988088">,</span>&nbsp;<span class="ident" id="7988090">err</span>&nbsp;<span class="op" id="7988094">:=</span>&nbsp;<span class="ident" id="7988097">Listen</span><span class="op" id="7988103">(</span><span class="string" id="7988104">&#34;tcp&#34;</span><span class="op" id="7988109">,</span>&nbsp;<span class="string" id="7988111">&#34;127.0.0.1:0&#34;</span><span class="op" id="7988124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988127">if</span>&nbsp;<span class="ident" id="7988130">err</span>&nbsp;<span class="op" id="7988134">!=</span>&nbsp;<span class="ident" id="7988137">nil</span>&nbsp;<span class="op" id="7988141">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988145">t</span><span class="op" id="7988146">.</span><span class="ident" id="7988147">Fatalf</span><span class="op" id="7988153">(</span><span class="string" id="7988154">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7988175">,</span>&nbsp;<span class="ident" id="7988177">err</span><span class="op" id="7988180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988186">defer</span>&nbsp;<span class="ident" id="7988192">ln</span><span class="op" id="7988194">.</span><span class="ident" id="7988195">Close</span><span class="op" id="7988200">(</span><span class="op" id="7988201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988205">lnquit</span>&nbsp;<span class="op" id="7988212">:=</span>&nbsp;<span class="builtinfunc" id="7988215">make</span><span class="op" id="7988219">(</span><span class="keyword" id="7988220">chan</span>&nbsp;<span class="builtintype" id="7988225">bool</span><span class="op" id="7988229">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988233">go</span>&nbsp;<span class="keyword" id="7988236">func</span><span class="op" id="7988240">(</span><span class="op" id="7988241">)</span>&nbsp;<span class="op" id="7988243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988247">c</span><span class="op" id="7988248">,</span>&nbsp;<span class="ident" id="7988250">err</span>&nbsp;<span class="op" id="7988254">:=</span>&nbsp;<span class="ident" id="7988257">ln</span><span class="op" id="7988259">.</span><span class="ident" id="7988260">Accept</span><span class="op" id="7988266">(</span><span class="op" id="7988267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988271">if</span>&nbsp;<span class="ident" id="7988274">err</span>&nbsp;<span class="op" id="7988278">!=</span>&nbsp;<span class="ident" id="7988281">nil</span>&nbsp;<span class="op" id="7988285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988290">t</span><span class="op" id="7988291">.</span><span class="ident" id="7988292">Errorf</span><span class="op" id="7988298">(</span><span class="string" id="7988299">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7988311">,</span>&nbsp;<span class="ident" id="7988313">err</span><span class="op" id="7988316">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988321">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988334">defer</span>&nbsp;<span class="ident" id="7988340">c</span><span class="op" id="7988341">.</span><span class="ident" id="7988342">Close</span><span class="op" id="7988347">(</span><span class="op" id="7988348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988352">lnquit</span>&nbsp;<span class="op" id="7988359">&lt;-</span>&nbsp;<span class="builtintype" id="7988362">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988368">}</span><span class="op" id="7988369">(</span><span class="op" id="7988370">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988374">c</span><span class="op" id="7988375">,</span>&nbsp;<span class="ident" id="7988377">err</span>&nbsp;<span class="op" id="7988381">:=</span>&nbsp;<span class="ident" id="7988384">Dial</span><span class="op" id="7988388">(</span><span class="string" id="7988389">&#34;tcp&#34;</span><span class="op" id="7988394">,</span>&nbsp;<span class="ident" id="7988396">ln</span><span class="op" id="7988398">.</span><span class="ident" id="7988399">Addr</span><span class="op" id="7988403">(</span><span class="op" id="7988404">)</span><span class="op" id="7988405">.</span><span class="ident" id="7988406">String</span><span class="op" id="7988412">(</span><span class="op" id="7988413">)</span><span class="op" id="7988414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988417">if</span>&nbsp;<span class="ident" id="7988420">err</span>&nbsp;<span class="op" id="7988424">!=</span>&nbsp;<span class="ident" id="7988427">nil</span>&nbsp;<span class="op" id="7988431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988435">t</span><span class="op" id="7988436">.</span><span class="ident" id="7988437">Fatalf</span><span class="op" id="7988443">(</span><span class="string" id="7988444">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7988454">,</span>&nbsp;<span class="ident" id="7988456">err</span><span class="op" id="7988459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988462">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988465">defer</span>&nbsp;<span class="ident" id="7988471">c</span><span class="op" id="7988472">.</span><span class="ident" id="7988473">Close</span><span class="op" id="7988478">(</span><span class="op" id="7988479">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988483">start</span>&nbsp;<span class="op" id="7988489">:=</span>&nbsp;<span class="ident" id="7988492">time</span><span class="op" id="7988496">.</span><span class="ident" id="7988497">Now</span><span class="op" id="7988500">(</span><span class="op" id="7988501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988504">err</span>&nbsp;<span class="op" id="7988508">=</span>&nbsp;<span class="ident" id="7988510">c</span><span class="op" id="7988511">.</span><span class="ident" id="7988512">SetReadDeadline</span><span class="op" id="7988527">(</span><span class="ident" id="7988528">start</span><span class="op" id="7988533">.</span><span class="ident" id="7988534">Add</span><span class="op" id="7988537">(</span><span class="ident" id="7988538">readTimeout</span><span class="op" id="7988549">)</span><span class="op" id="7988550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988553">if</span>&nbsp;<span class="ident" id="7988556">err</span>&nbsp;<span class="op" id="7988560">!=</span>&nbsp;<span class="ident" id="7988563">nil</span>&nbsp;<span class="op" id="7988567">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988571">t</span><span class="op" id="7988572">.</span><span class="ident" id="7988573">Fatalf</span><span class="op" id="7988579">(</span><span class="string" id="7988580">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="7988601">,</span>&nbsp;<span class="ident" id="7988603">err</span><span class="op" id="7988606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988612">err</span>&nbsp;<span class="op" id="7988616">=</span>&nbsp;<span class="ident" id="7988618">c</span><span class="op" id="7988619">.</span><span class="ident" id="7988620">SetWriteDeadline</span><span class="op" id="7988636">(</span><span class="ident" id="7988637">start</span><span class="op" id="7988642">.</span><span class="ident" id="7988643">Add</span><span class="op" id="7988646">(</span><span class="ident" id="7988647">writeTimeout</span><span class="op" id="7988659">)</span><span class="op" id="7988660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988663">if</span>&nbsp;<span class="ident" id="7988666">err</span>&nbsp;<span class="op" id="7988670">!=</span>&nbsp;<span class="ident" id="7988673">nil</span>&nbsp;<span class="op" id="7988677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988681">t</span><span class="op" id="7988682">.</span><span class="ident" id="7988683">Fatalf</span><span class="op" id="7988689">(</span><span class="string" id="7988690">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="7988712">,</span>&nbsp;<span class="ident" id="7988714">err</span><span class="op" id="7988717">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988724">quit</span>&nbsp;<span class="op" id="7988729">:=</span>&nbsp;<span class="builtinfunc" id="7988732">make</span><span class="op" id="7988736">(</span><span class="keyword" id="7988737">chan</span>&nbsp;<span class="builtintype" id="7988742">bool</span><span class="op" id="7988746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988750">go</span>&nbsp;<span class="keyword" id="7988753">func</span><span class="op" id="7988757">(</span><span class="op" id="7988758">)</span>&nbsp;<span class="op" id="7988760">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988764">var</span>&nbsp;<span class="ident" id="7988768">buf</span>&nbsp;<span class="op" id="7988772">[</span><span class="num" id="7988773">10</span><span class="op" id="7988775">]</span><span class="builtintype" id="7988776">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988783">_</span><span class="op" id="7988784">,</span>&nbsp;<span class="ident" id="7988786">err</span>&nbsp;<span class="op" id="7988790">:=</span>&nbsp;<span class="ident" id="7988793">c</span><span class="op" id="7988794">.</span><span class="ident" id="7988795">Read</span><span class="op" id="7988799">(</span><span class="ident" id="7988800">buf</span><span class="op" id="7988803">[</span><span class="op" id="7988804">:</span><span class="op" id="7988805">]</span><span class="op" id="7988806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988810">if</span>&nbsp;<span class="ident" id="7988813">err</span>&nbsp;<span class="op" id="7988817">==</span>&nbsp;<span class="ident" id="7988820">nil</span>&nbsp;<span class="op" id="7988824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988829">t</span><span class="op" id="7988830">.</span><span class="ident" id="7988831">Errorf</span><span class="op" id="7988837">(</span><span class="string" id="7988838">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="7988863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988867">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988871">checkTimeout</span><span class="op" id="7988883">(</span><span class="string" id="7988884">&#34;Read&#34;</span><span class="op" id="7988890">,</span>&nbsp;<span class="ident" id="7988892">start</span><span class="op" id="7988897">,</span>&nbsp;<span class="ident" id="7988899">readTimeout</span><span class="op" id="7988910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988914">quit</span>&nbsp;<span class="op" id="7988919">&lt;-</span>&nbsp;<span class="builtintype" id="7988922">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7988928">}</span><span class="op" id="7988929">(</span><span class="op" id="7988930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988934">go</span>&nbsp;<span class="keyword" id="7988937">func</span><span class="op" id="7988941">(</span><span class="op" id="7988942">)</span>&nbsp;<span class="op" id="7988944">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988948">var</span>&nbsp;<span class="ident" id="7988952">buf</span>&nbsp;<span class="op" id="7988956">[</span><span class="num" id="7988957">10000</span><span class="op" id="7988962">]</span><span class="builtintype" id="7988963">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7988970">for</span>&nbsp;<span class="op" id="7988974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7988979">_</span><span class="op" id="7988980">,</span>&nbsp;<span class="ident" id="7988982">err</span>&nbsp;<span class="op" id="7988986">:=</span>&nbsp;<span class="ident" id="7988989">c</span><span class="op" id="7988990">.</span><span class="ident" id="7988991">Write</span><span class="op" id="7988996">(</span><span class="ident" id="7988997">buf</span><span class="op" id="7989000">[</span><span class="op" id="7989001">:</span><span class="op" id="7989002">]</span><span class="op" id="7989003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989008">if</span>&nbsp;<span class="ident" id="7989011">err</span>&nbsp;<span class="op" id="7989015">!=</span>&nbsp;<span class="ident" id="7989018">nil</span>&nbsp;<span class="op" id="7989022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989028">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989045">checkTimeout</span><span class="op" id="7989057">(</span><span class="string" id="7989058">&#34;Write&#34;</span><span class="op" id="7989065">,</span>&nbsp;<span class="ident" id="7989067">start</span><span class="op" id="7989072">,</span>&nbsp;<span class="ident" id="7989074">writeTimeout</span><span class="op" id="7989086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989090">quit</span>&nbsp;<span class="op" id="7989095">&lt;-</span>&nbsp;<span class="builtintype" id="7989098">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989104">}</span><span class="op" id="7989105">(</span><span class="op" id="7989106">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989110">&lt;-</span><span class="ident" id="7989112">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989118">&lt;-</span><span class="ident" id="7989120">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989126">&lt;-</span><span class="ident" id="7989128">lnquit</span><br>
<span class="lineno"></span><span class="op" id="7989135">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="7989138">type</span>&nbsp;<span class="ident" id="7989143">neverEnding</span>&nbsp;<span class="builtintype" id="7989155">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7989161">func</span>&nbsp;<span class="op" id="7989166">(</span><span class="ident" id="7989167">b</span>&nbsp;<span class="ident" id="7989169">neverEnding</span><span class="op" id="7989180">)</span>&nbsp;<span class="ident" id="7989182">Read</span><span class="op" id="7989186">(</span><span class="ident" id="7989187">p</span>&nbsp;<span class="op" id="7989189">[</span><span class="op" id="7989190">]</span><span class="builtintype" id="7989191">byte</span><span class="op" id="7989195">)</span>&nbsp;<span class="op" id="7989197">(</span><span class="ident" id="7989198">n</span>&nbsp;<span class="builtintype" id="7989200">int</span><span class="op" id="7989203">,</span>&nbsp;<span class="ident" id="7989205">err</span>&nbsp;<span class="builtintype" id="7989209">error</span><span class="op" id="7989214">)</span>&nbsp;<span class="op" id="7989216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989219">for</span>&nbsp;<span class="ident" id="7989223">i</span>&nbsp;<span class="op" id="7989225">:=</span>&nbsp;<span class="keyword" id="7989228">range</span>&nbsp;<span class="ident" id="7989234">p</span>&nbsp;<span class="op" id="7989236">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989240">p</span><span class="op" id="7989241">[</span><span class="ident" id="7989242">i</span><span class="op" id="7989243">]</span>&nbsp;<span class="op" id="7989245">=</span>&nbsp;<span class="builtintype" id="7989247">byte</span><span class="op" id="7989251">(</span><span class="ident" id="7989252">b</span><span class="op" id="7989253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989259">return</span>&nbsp;<span class="builtinfunc" id="7989266">len</span><span class="op" id="7989269">(</span><span class="ident" id="7989270">p</span><span class="op" id="7989271">)</span><span class="op" id="7989272">,</span>&nbsp;<span class="ident" id="7989274">nil</span><br>
<span class="lineno"></span><span class="op" id="7989278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="7989281">func</span>&nbsp;<span class="ident" id="7989286">TestVariousDeadlines1Proc</span><span class="op" id="7989311">(</span><span class="ident" id="7989312">t</span>&nbsp;<span class="op" id="7989314">*</span><span class="ident" id="7989315">testing</span><span class="op" id="7989322">.</span><span class="ident" id="7989323">T</span><span class="op" id="7989324">)</span>&nbsp;<span class="op" id="7989326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989329">testVariousDeadlines</span><span class="op" id="7989349">(</span><span class="ident" id="7989350">t</span><span class="op" id="7989351">,</span>&nbsp;<span class="num" id="7989353">1</span><span class="op" id="7989354">)</span><br>
<span class="lineno"></span><span class="op" id="7989356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7989359">func</span>&nbsp;<span class="ident" id="7989364">TestVariousDeadlines4Proc</span><span class="op" id="7989389">(</span><span class="ident" id="7989390">t</span>&nbsp;<span class="op" id="7989392">*</span><span class="ident" id="7989393">testing</span><span class="op" id="7989400">.</span><span class="ident" id="7989401">T</span><span class="op" id="7989402">)</span>&nbsp;<span class="op" id="7989404">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989407">testVariousDeadlines</span><span class="op" id="7989427">(</span><span class="ident" id="7989428">t</span><span class="op" id="7989429">,</span>&nbsp;<span class="num" id="7989431">4</span><span class="op" id="7989432">)</span><br>
<span class="lineno"></span><span class="op" id="7989434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7989437">func</span>&nbsp;<span class="ident" id="7989442">testVariousDeadlines</span><span class="op" id="7989462">(</span><span class="ident" id="7989463">t</span>&nbsp;<span class="op" id="7989465">*</span><span class="ident" id="7989466">testing</span><span class="op" id="7989473">.</span><span class="ident" id="7989474">T</span><span class="op" id="7989475">,</span>&nbsp;<span class="ident" id="7989477">maxProcs</span>&nbsp;<span class="builtintype" id="7989486">int</span><span class="op" id="7989489">)</span>&nbsp;<span class="op" id="7989491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989494">switch</span>&nbsp;<span class="ident" id="7989501">runtime</span><span class="op" id="7989508">.</span><span class="ident" id="7989509">GOOS</span>&nbsp;<span class="op" id="7989514">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989517">case</span>&nbsp;<span class="string" id="7989522">&#34;plan9&#34;</span><span class="op" id="7989529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989533">t</span><span class="op" id="7989534">.</span><span class="ident" id="7989535">Skipf</span><span class="op" id="7989540">(</span><span class="string" id="7989541">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7989562">,</span>&nbsp;<span class="ident" id="7989564">runtime</span><span class="op" id="7989571">.</span><span class="ident" id="7989572">GOOS</span><span class="op" id="7989576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989583">defer</span>&nbsp;<span class="ident" id="7989589">runtime</span><span class="op" id="7989596">.</span><span class="ident" id="7989597">GOMAXPROCS</span><span class="op" id="7989607">(</span><span class="ident" id="7989608">runtime</span><span class="op" id="7989615">.</span><span class="ident" id="7989616">GOMAXPROCS</span><span class="op" id="7989626">(</span><span class="ident" id="7989627">maxProcs</span><span class="op" id="7989635">)</span><span class="op" id="7989636">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989639">ln</span>&nbsp;<span class="op" id="7989642">:=</span>&nbsp;<span class="ident" id="7989645">newLocalListener</span><span class="op" id="7989661">(</span><span class="ident" id="7989662">t</span><span class="op" id="7989663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989666">defer</span>&nbsp;<span class="ident" id="7989672">ln</span><span class="op" id="7989674">.</span><span class="ident" id="7989675">Close</span><span class="op" id="7989680">(</span><span class="op" id="7989681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989684">acceptc</span>&nbsp;<span class="op" id="7989692">:=</span>&nbsp;<span class="builtinfunc" id="7989695">make</span><span class="op" id="7989699">(</span><span class="keyword" id="7989700">chan</span>&nbsp;<span class="builtintype" id="7989705">error</span><span class="op" id="7989710">,</span>&nbsp;<span class="num" id="7989712">1</span><span class="op" id="7989713">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7989717">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7989787">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989810">servec</span>&nbsp;<span class="op" id="7989817">:=</span>&nbsp;<span class="builtinfunc" id="7989820">make</span><span class="op" id="7989824">(</span><span class="keyword" id="7989825">chan</span>&nbsp;<span class="ident" id="7989830">copyRes</span><span class="op" id="7989837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989840">go</span>&nbsp;<span class="keyword" id="7989843">func</span><span class="op" id="7989847">(</span><span class="op" id="7989848">)</span>&nbsp;<span class="op" id="7989850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989854">for</span>&nbsp;<span class="op" id="7989858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989863">c</span><span class="op" id="7989864">,</span>&nbsp;<span class="ident" id="7989866">err</span>&nbsp;<span class="op" id="7989870">:=</span>&nbsp;<span class="ident" id="7989873">ln</span><span class="op" id="7989875">.</span><span class="ident" id="7989876">Accept</span><span class="op" id="7989882">(</span><span class="op" id="7989883">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989888">if</span>&nbsp;<span class="ident" id="7989891">err</span>&nbsp;<span class="op" id="7989895">!=</span>&nbsp;<span class="ident" id="7989898">nil</span>&nbsp;<span class="op" id="7989902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989908">acceptc</span>&nbsp;<span class="op" id="7989916">&lt;-</span>&nbsp;<span class="ident" id="7989919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989927">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7989937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7989942">go</span>&nbsp;<span class="keyword" id="7989945">func</span><span class="op" id="7989949">(</span><span class="op" id="7989950">)</span>&nbsp;<span class="op" id="7989952">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989958">t0</span>&nbsp;<span class="op" id="7989961">:=</span>&nbsp;<span class="ident" id="7989964">time</span><span class="op" id="7989968">.</span><span class="ident" id="7989969">Now</span><span class="op" id="7989972">(</span><span class="op" id="7989973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7989979">n</span><span class="op" id="7989980">,</span>&nbsp;<span class="ident" id="7989982">err</span>&nbsp;<span class="op" id="7989986">:=</span>&nbsp;<span class="ident" id="7989989">io</span><span class="op" id="7989991">.</span><span class="ident" id="7989992">Copy</span><span class="op" id="7989996">(</span><span class="ident" id="7989997">c</span><span class="op" id="7989998">,</span>&nbsp;<span class="ident" id="7990000">neverEnding</span><span class="op" id="7990011">(</span><span class="string" id="7990012">&#39;a&#39;</span><span class="op" id="7990015">)</span><span class="op" id="7990016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990022">d</span>&nbsp;<span class="op" id="7990024">:=</span>&nbsp;<span class="ident" id="7990027">time</span><span class="op" id="7990031">.</span><span class="ident" id="7990032">Since</span><span class="op" id="7990037">(</span><span class="ident" id="7990038">t0</span><span class="op" id="7990040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990046">c</span><span class="op" id="7990047">.</span><span class="ident" id="7990048">Close</span><span class="op" id="7990053">(</span><span class="op" id="7990054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990060">servec</span>&nbsp;<span class="op" id="7990067">&lt;-</span>&nbsp;<span class="ident" id="7990070">copyRes</span><span class="op" id="7990077">{</span><span class="ident" id="7990078">n</span><span class="op" id="7990079">,</span>&nbsp;<span class="ident" id="7990081">err</span><span class="op" id="7990084">,</span>&nbsp;<span class="ident" id="7990086">d</span><span class="op" id="7990087">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990092">}</span><span class="op" id="7990093">(</span><span class="op" id="7990094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990101">}</span><span class="op" id="7990102">(</span><span class="op" id="7990103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990107">for</span>&nbsp;<span class="ident" id="7990111">_</span><span class="op" id="7990112">,</span>&nbsp;<span class="ident" id="7990114">timeout</span>&nbsp;<span class="op" id="7990122">:=</span>&nbsp;<span class="keyword" id="7990125">range</span>&nbsp;<span class="op" id="7990131">[</span><span class="op" id="7990132">]</span><span class="ident" id="7990133">time</span><span class="op" id="7990137">.</span><span class="ident" id="7990138">Duration</span><span class="op" id="7990146">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990150">1</span>&nbsp;<span class="op" id="7990152">*</span>&nbsp;<span class="ident" id="7990154">time</span><span class="op" id="7990158">.</span><span class="ident" id="7990159">Nanosecond</span><span class="op" id="7990169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990173">2</span>&nbsp;<span class="op" id="7990175">*</span>&nbsp;<span class="ident" id="7990177">time</span><span class="op" id="7990181">.</span><span class="ident" id="7990182">Nanosecond</span><span class="op" id="7990192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990196">5</span>&nbsp;<span class="op" id="7990198">*</span>&nbsp;<span class="ident" id="7990200">time</span><span class="op" id="7990204">.</span><span class="ident" id="7990205">Nanosecond</span><span class="op" id="7990215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990219">50</span>&nbsp;<span class="op" id="7990222">*</span>&nbsp;<span class="ident" id="7990224">time</span><span class="op" id="7990228">.</span><span class="ident" id="7990229">Nanosecond</span><span class="op" id="7990239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990243">100</span>&nbsp;<span class="op" id="7990247">*</span>&nbsp;<span class="ident" id="7990249">time</span><span class="op" id="7990253">.</span><span class="ident" id="7990254">Nanosecond</span><span class="op" id="7990264">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990268">200</span>&nbsp;<span class="op" id="7990272">*</span>&nbsp;<span class="ident" id="7990274">time</span><span class="op" id="7990278">.</span><span class="ident" id="7990279">Nanosecond</span><span class="op" id="7990289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990293">500</span>&nbsp;<span class="op" id="7990297">*</span>&nbsp;<span class="ident" id="7990299">time</span><span class="op" id="7990303">.</span><span class="ident" id="7990304">Nanosecond</span><span class="op" id="7990314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990318">750</span>&nbsp;<span class="op" id="7990322">*</span>&nbsp;<span class="ident" id="7990324">time</span><span class="op" id="7990328">.</span><span class="ident" id="7990329">Nanosecond</span><span class="op" id="7990339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990343">1</span>&nbsp;<span class="op" id="7990345">*</span>&nbsp;<span class="ident" id="7990347">time</span><span class="op" id="7990351">.</span><span class="ident" id="7990352">Microsecond</span><span class="op" id="7990363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990367">5</span>&nbsp;<span class="op" id="7990369">*</span>&nbsp;<span class="ident" id="7990371">time</span><span class="op" id="7990375">.</span><span class="ident" id="7990376">Microsecond</span><span class="op" id="7990387">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990391">25</span>&nbsp;<span class="op" id="7990394">*</span>&nbsp;<span class="ident" id="7990396">time</span><span class="op" id="7990400">.</span><span class="ident" id="7990401">Microsecond</span><span class="op" id="7990412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990416">250</span>&nbsp;<span class="op" id="7990420">*</span>&nbsp;<span class="ident" id="7990422">time</span><span class="op" id="7990426">.</span><span class="ident" id="7990427">Microsecond</span><span class="op" id="7990438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990442">500</span>&nbsp;<span class="op" id="7990446">*</span>&nbsp;<span class="ident" id="7990448">time</span><span class="op" id="7990452">.</span><span class="ident" id="7990453">Microsecond</span><span class="op" id="7990464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990468">1</span>&nbsp;<span class="op" id="7990470">*</span>&nbsp;<span class="ident" id="7990472">time</span><span class="op" id="7990476">.</span><span class="ident" id="7990477">Millisecond</span><span class="op" id="7990488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990492">5</span>&nbsp;<span class="op" id="7990494">*</span>&nbsp;<span class="ident" id="7990496">time</span><span class="op" id="7990500">.</span><span class="ident" id="7990501">Millisecond</span><span class="op" id="7990512">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990516">100</span>&nbsp;<span class="op" id="7990520">*</span>&nbsp;<span class="ident" id="7990522">time</span><span class="op" id="7990526">.</span><span class="ident" id="7990527">Millisecond</span><span class="op" id="7990538">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990542">250</span>&nbsp;<span class="op" id="7990546">*</span>&nbsp;<span class="ident" id="7990548">time</span><span class="op" id="7990552">.</span><span class="ident" id="7990553">Millisecond</span><span class="op" id="7990564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990568">500</span>&nbsp;<span class="op" id="7990572">*</span>&nbsp;<span class="ident" id="7990574">time</span><span class="op" id="7990578">.</span><span class="ident" id="7990579">Millisecond</span><span class="op" id="7990590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7990594">1</span>&nbsp;<span class="op" id="7990596">*</span>&nbsp;<span class="ident" id="7990598">time</span><span class="op" id="7990602">.</span><span class="ident" id="7990603">Second</span><span class="op" id="7990609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990612">}</span>&nbsp;<span class="op" id="7990614">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990618">numRuns</span>&nbsp;<span class="op" id="7990626">:=</span>&nbsp;<span class="num" id="7990629">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990633">if</span>&nbsp;<span class="ident" id="7990636">testing</span><span class="op" id="7990643">.</span><span class="ident" id="7990644">Short</span><span class="op" id="7990649">(</span><span class="op" id="7990650">)</span>&nbsp;<span class="op" id="7990652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990657">numRuns</span>&nbsp;<span class="op" id="7990665">=</span>&nbsp;<span class="num" id="7990667">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990672">if</span>&nbsp;<span class="ident" id="7990675">timeout</span>&nbsp;<span class="op" id="7990683">&gt;</span>&nbsp;<span class="num" id="7990685">500</span><span class="op" id="7990688">*</span><span class="ident" id="7990689">time</span><span class="op" id="7990693">.</span><span class="ident" id="7990694">Microsecond</span>&nbsp;<span class="op" id="7990706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990712">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990732">for</span>&nbsp;<span class="ident" id="7990736">run</span>&nbsp;<span class="op" id="7990740">:=</span>&nbsp;<span class="num" id="7990743">0</span><span class="op" id="7990744">;</span>&nbsp;<span class="ident" id="7990746">run</span>&nbsp;<span class="op" id="7990750">&lt;</span>&nbsp;<span class="ident" id="7990752">numRuns</span><span class="op" id="7990759">;</span>&nbsp;<span class="ident" id="7990761">run</span><span class="op" id="7990764">++</span>&nbsp;<span class="op" id="7990767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990772">name</span>&nbsp;<span class="op" id="7990777">:=</span>&nbsp;<span class="ident" id="7990780">fmt</span><span class="op" id="7990783">.</span><span class="ident" id="7990784">Sprintf</span><span class="op" id="7990791">(</span><span class="string" id="7990792">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="7990806">,</span>&nbsp;<span class="ident" id="7990808">timeout</span><span class="op" id="7990815">,</span>&nbsp;<span class="ident" id="7990817">run</span><span class="op" id="7990820">+</span><span class="num" id="7990821">1</span><span class="op" id="7990822">,</span>&nbsp;<span class="ident" id="7990824">numRuns</span><span class="op" id="7990831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990836">t</span><span class="op" id="7990837">.</span><span class="ident" id="7990838">Log</span><span class="op" id="7990841">(</span><span class="ident" id="7990842">name</span><span class="op" id="7990846">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990852">c</span><span class="op" id="7990853">,</span>&nbsp;<span class="ident" id="7990855">err</span>&nbsp;<span class="op" id="7990859">:=</span>&nbsp;<span class="ident" id="7990862">Dial</span><span class="op" id="7990866">(</span><span class="string" id="7990867">&#34;tcp&#34;</span><span class="op" id="7990872">,</span>&nbsp;<span class="ident" id="7990874">ln</span><span class="op" id="7990876">.</span><span class="ident" id="7990877">Addr</span><span class="op" id="7990881">(</span><span class="op" id="7990882">)</span><span class="op" id="7990883">.</span><span class="ident" id="7990884">String</span><span class="op" id="7990890">(</span><span class="op" id="7990891">)</span><span class="op" id="7990892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990897">if</span>&nbsp;<span class="ident" id="7990900">err</span>&nbsp;<span class="op" id="7990904">!=</span>&nbsp;<span class="ident" id="7990907">nil</span>&nbsp;<span class="op" id="7990911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990917">t</span><span class="op" id="7990918">.</span><span class="ident" id="7990919">Fatalf</span><span class="op" id="7990925">(</span><span class="string" id="7990926">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7990936">,</span>&nbsp;<span class="ident" id="7990938">err</span><span class="op" id="7990941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7990946">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7990951">clientc</span>&nbsp;<span class="op" id="7990959">:=</span>&nbsp;<span class="builtinfunc" id="7990962">make</span><span class="op" id="7990966">(</span><span class="keyword" id="7990967">chan</span>&nbsp;<span class="ident" id="7990972">copyRes</span><span class="op" id="7990979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7990984">go</span>&nbsp;<span class="keyword" id="7990987">func</span><span class="op" id="7990991">(</span><span class="op" id="7990992">)</span>&nbsp;<span class="op" id="7990994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991000">t0</span>&nbsp;<span class="op" id="7991003">:=</span>&nbsp;<span class="ident" id="7991006">time</span><span class="op" id="7991010">.</span><span class="ident" id="7991011">Now</span><span class="op" id="7991014">(</span><span class="op" id="7991015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991021">c</span><span class="op" id="7991022">.</span><span class="ident" id="7991023">SetDeadline</span><span class="op" id="7991034">(</span><span class="ident" id="7991035">t0</span><span class="op" id="7991037">.</span><span class="ident" id="7991038">Add</span><span class="op" id="7991041">(</span><span class="ident" id="7991042">timeout</span><span class="op" id="7991049">)</span><span class="op" id="7991050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991056">n</span><span class="op" id="7991057">,</span>&nbsp;<span class="ident" id="7991059">err</span>&nbsp;<span class="op" id="7991063">:=</span>&nbsp;<span class="ident" id="7991066">io</span><span class="op" id="7991068">.</span><span class="ident" id="7991069">Copy</span><span class="op" id="7991073">(</span><span class="ident" id="7991074">ioutil</span><span class="op" id="7991080">.</span><span class="ident" id="7991081">Discard</span><span class="op" id="7991088">,</span>&nbsp;<span class="ident" id="7991090">c</span><span class="op" id="7991091">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991097">d</span>&nbsp;<span class="op" id="7991099">:=</span>&nbsp;<span class="ident" id="7991102">time</span><span class="op" id="7991106">.</span><span class="ident" id="7991107">Since</span><span class="op" id="7991112">(</span><span class="ident" id="7991113">t0</span><span class="op" id="7991115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991121">c</span><span class="op" id="7991122">.</span><span class="ident" id="7991123">Close</span><span class="op" id="7991128">(</span><span class="op" id="7991129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991135">clientc</span>&nbsp;<span class="op" id="7991143">&lt;-</span>&nbsp;<span class="ident" id="7991146">copyRes</span><span class="op" id="7991153">{</span><span class="ident" id="7991154">n</span><span class="op" id="7991155">,</span>&nbsp;<span class="ident" id="7991157">err</span><span class="op" id="7991160">,</span>&nbsp;<span class="ident" id="7991162">d</span><span class="op" id="7991163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991168">}</span><span class="op" id="7991169">(</span><span class="op" id="7991170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991176">tooLong</span>&nbsp;<span class="op" id="7991184">:=</span>&nbsp;<span class="num" id="7991187">5</span>&nbsp;<span class="op" id="7991189">*</span>&nbsp;<span class="ident" id="7991191">time</span><span class="op" id="7991195">.</span><span class="ident" id="7991196">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991206">select</span>&nbsp;<span class="op" id="7991213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991218">case</span>&nbsp;<span class="ident" id="7991223">res</span>&nbsp;<span class="op" id="7991227">:=</span>&nbsp;<span class="op" id="7991230">&lt;-</span><span class="ident" id="7991232">clientc</span><span class="op" id="7991239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991245">if</span>&nbsp;<span class="ident" id="7991248">isTimeout</span><span class="op" id="7991257">(</span><span class="ident" id="7991258">res</span><span class="op" id="7991261">.</span><span class="ident" id="7991262">err</span><span class="op" id="7991265">)</span>&nbsp;<span class="op" id="7991267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991274">t</span><span class="op" id="7991275">.</span><span class="ident" id="7991276">Logf</span><span class="op" id="7991280">(</span><span class="string" id="7991281">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="7991337">,</span>&nbsp;<span class="ident" id="7991339">name</span><span class="op" id="7991343">,</span>&nbsp;<span class="ident" id="7991345">res</span><span class="op" id="7991348">.</span><span class="ident" id="7991349">d</span><span class="op" id="7991350">,</span>&nbsp;<span class="ident" id="7991352">res</span><span class="op" id="7991355">.</span><span class="ident" id="7991356">n</span><span class="op" id="7991357">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991363">}</span>&nbsp;<span class="keyword" id="7991365">else</span>&nbsp;<span class="op" id="7991370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991377">t</span><span class="op" id="7991378">.</span><span class="ident" id="7991379">Fatalf</span><span class="op" id="7991385">(</span><span class="string" id="7991386">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="7991431">,</span>&nbsp;<span class="ident" id="7991433">name</span><span class="op" id="7991437">,</span>&nbsp;<span class="ident" id="7991439">res</span><span class="op" id="7991442">.</span><span class="ident" id="7991443">n</span><span class="op" id="7991444">,</span>&nbsp;<span class="ident" id="7991446">res</span><span class="op" id="7991449">.</span><span class="ident" id="7991450">err</span><span class="op" id="7991453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991464">case</span>&nbsp;<span class="op" id="7991469">&lt;-</span><span class="ident" id="7991471">time</span><span class="op" id="7991475">.</span><span class="ident" id="7991476">After</span><span class="op" id="7991481">(</span><span class="ident" id="7991482">tooLong</span><span class="op" id="7991489">)</span><span class="op" id="7991490">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991496">t</span><span class="op" id="7991497">.</span><span class="ident" id="7991498">Fatalf</span><span class="op" id="7991504">(</span><span class="string" id="7991505">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="7991570">,</span>&nbsp;<span class="ident" id="7991572">name</span><span class="op" id="7991576">,</span>&nbsp;<span class="ident" id="7991578">tooLong</span><span class="op" id="7991585">,</span>&nbsp;<span class="ident" id="7991587">timeout</span><span class="op" id="7991594">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991605">select</span>&nbsp;<span class="op" id="7991612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991617">case</span>&nbsp;<span class="ident" id="7991622">res</span>&nbsp;<span class="op" id="7991626">:=</span>&nbsp;<span class="op" id="7991629">&lt;-</span><span class="ident" id="7991631">servec</span><span class="op" id="7991637">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991643">t</span><span class="op" id="7991644">.</span><span class="ident" id="7991645">Logf</span><span class="op" id="7991649">(</span><span class="string" id="7991650">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="7991685">,</span>&nbsp;<span class="ident" id="7991687">name</span><span class="op" id="7991691">,</span>&nbsp;<span class="ident" id="7991693">res</span><span class="op" id="7991696">.</span><span class="ident" id="7991697">d</span><span class="op" id="7991698">,</span>&nbsp;<span class="ident" id="7991700">res</span><span class="op" id="7991703">.</span><span class="ident" id="7991704">n</span><span class="op" id="7991705">,</span>&nbsp;<span class="ident" id="7991707">res</span><span class="op" id="7991710">.</span><span class="ident" id="7991711">err</span><span class="op" id="7991714">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991719">case</span>&nbsp;<span class="ident" id="7991724">err</span>&nbsp;<span class="op" id="7991728">:=</span>&nbsp;<span class="op" id="7991731">&lt;-</span><span class="ident" id="7991733">acceptc</span><span class="op" id="7991740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991746">t</span><span class="op" id="7991747">.</span><span class="ident" id="7991748">Fatalf</span><span class="op" id="7991754">(</span><span class="string" id="7991755">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="7991783">,</span>&nbsp;<span class="ident" id="7991785">name</span><span class="op" id="7991789">,</span>&nbsp;<span class="ident" id="7991791">err</span><span class="op" id="7991794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7991799">case</span>&nbsp;<span class="op" id="7991804">&lt;-</span><span class="ident" id="7991806">time</span><span class="op" id="7991810">.</span><span class="ident" id="7991811">After</span><span class="op" id="7991816">(</span><span class="ident" id="7991817">tooLong</span><span class="op" id="7991824">)</span><span class="op" id="7991825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7991831">t</span><span class="op" id="7991832">.</span><span class="ident" id="7991833">Fatalf</span><span class="op" id="7991839">(</span><span class="string" id="7991840">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="7991894">,</span>&nbsp;<span class="ident" id="7991896">name</span><span class="op" id="7991900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991905">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7991912">}</span><br>
<span class="lineno"></span><span class="op" id="7991914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7991917">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="7991987">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="7992024">func</span>&nbsp;<span class="ident" id="7992029">TestReadDeadlineDataAvailable</span><span class="op" id="7992058">(</span><span class="ident" id="7992059">t</span>&nbsp;<span class="op" id="7992061">*</span><span class="ident" id="7992062">testing</span><span class="op" id="7992069">.</span><span class="ident" id="7992070">T</span><span class="op" id="7992071">)</span>&nbsp;<span class="op" id="7992073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992076">switch</span>&nbsp;<span class="ident" id="7992083">runtime</span><span class="op" id="7992090">.</span><span class="ident" id="7992091">GOOS</span>&nbsp;<span class="op" id="7992096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992099">case</span>&nbsp;<span class="string" id="7992104">&#34;plan9&#34;</span><span class="op" id="7992111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992115">t</span><span class="op" id="7992116">.</span><span class="ident" id="7992117">Skipf</span><span class="op" id="7992122">(</span><span class="string" id="7992123">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7992144">,</span>&nbsp;<span class="ident" id="7992146">runtime</span><span class="op" id="7992153">.</span><span class="ident" id="7992154">GOOS</span><span class="op" id="7992158">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992165">ln</span>&nbsp;<span class="op" id="7992168">:=</span>&nbsp;<span class="ident" id="7992171">newLocalListener</span><span class="op" id="7992187">(</span><span class="ident" id="7992188">t</span><span class="op" id="7992189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992192">defer</span>&nbsp;<span class="ident" id="7992198">ln</span><span class="op" id="7992200">.</span><span class="ident" id="7992201">Close</span><span class="op" id="7992206">(</span><span class="op" id="7992207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992211">servec</span>&nbsp;<span class="op" id="7992218">:=</span>&nbsp;<span class="builtinfunc" id="7992221">make</span><span class="op" id="7992225">(</span><span class="keyword" id="7992226">chan</span>&nbsp;<span class="ident" id="7992231">copyRes</span><span class="op" id="7992238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992241">const</span>&nbsp;<span class="ident" id="7992247">msg</span>&nbsp;<span class="op" id="7992251">=</span>&nbsp;<span class="string" id="7992253">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992313">go</span>&nbsp;<span class="keyword" id="7992316">func</span><span class="op" id="7992320">(</span><span class="op" id="7992321">)</span>&nbsp;<span class="op" id="7992323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992327">c</span><span class="op" id="7992328">,</span>&nbsp;<span class="ident" id="7992330">err</span>&nbsp;<span class="op" id="7992334">:=</span>&nbsp;<span class="ident" id="7992337">ln</span><span class="op" id="7992339">.</span><span class="ident" id="7992340">Accept</span><span class="op" id="7992346">(</span><span class="op" id="7992347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992351">if</span>&nbsp;<span class="ident" id="7992354">err</span>&nbsp;<span class="op" id="7992358">!=</span>&nbsp;<span class="ident" id="7992361">nil</span>&nbsp;<span class="op" id="7992365">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992370">t</span><span class="op" id="7992371">.</span><span class="ident" id="7992372">Errorf</span><span class="op" id="7992378">(</span><span class="string" id="7992379">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7992391">,</span>&nbsp;<span class="ident" id="7992393">err</span><span class="op" id="7992396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992401">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992414">defer</span>&nbsp;<span class="ident" id="7992420">c</span><span class="op" id="7992421">.</span><span class="ident" id="7992422">Close</span><span class="op" id="7992427">(</span><span class="op" id="7992428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992432">n</span><span class="op" id="7992433">,</span>&nbsp;<span class="ident" id="7992435">err</span>&nbsp;<span class="op" id="7992439">:=</span>&nbsp;<span class="ident" id="7992442">c</span><span class="op" id="7992443">.</span><span class="ident" id="7992444">Write</span><span class="op" id="7992449">(</span><span class="op" id="7992450">[</span><span class="op" id="7992451">]</span><span class="builtintype" id="7992452">byte</span><span class="op" id="7992456">(</span><span class="ident" id="7992457">msg</span><span class="op" id="7992460">)</span><span class="op" id="7992461">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992465">servec</span>&nbsp;<span class="op" id="7992472">&lt;-</span>&nbsp;<span class="ident" id="7992475">copyRes</span><span class="op" id="7992482">{</span><span class="ident" id="7992483">n</span><span class="op" id="7992484">:</span>&nbsp;<span class="ident" id="7992486">int64</span><span class="op" id="7992491">(</span><span class="ident" id="7992492">n</span><span class="op" id="7992493">)</span><span class="op" id="7992494">,</span>&nbsp;<span class="ident" id="7992496">err</span><span class="op" id="7992499">:</span>&nbsp;<span class="ident" id="7992501">err</span><span class="op" id="7992504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992507">}</span><span class="op" id="7992508">(</span><span class="op" id="7992509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992513">c</span><span class="op" id="7992514">,</span>&nbsp;<span class="ident" id="7992516">err</span>&nbsp;<span class="op" id="7992520">:=</span>&nbsp;<span class="ident" id="7992523">Dial</span><span class="op" id="7992527">(</span><span class="string" id="7992528">&#34;tcp&#34;</span><span class="op" id="7992533">,</span>&nbsp;<span class="ident" id="7992535">ln</span><span class="op" id="7992537">.</span><span class="ident" id="7992538">Addr</span><span class="op" id="7992542">(</span><span class="op" id="7992543">)</span><span class="op" id="7992544">.</span><span class="ident" id="7992545">String</span><span class="op" id="7992551">(</span><span class="op" id="7992552">)</span><span class="op" id="7992553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992556">if</span>&nbsp;<span class="ident" id="7992559">err</span>&nbsp;<span class="op" id="7992563">!=</span>&nbsp;<span class="ident" id="7992566">nil</span>&nbsp;<span class="op" id="7992570">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992574">t</span><span class="op" id="7992575">.</span><span class="ident" id="7992576">Fatalf</span><span class="op" id="7992582">(</span><span class="string" id="7992583">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7992593">,</span>&nbsp;<span class="ident" id="7992595">err</span><span class="op" id="7992598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992604">defer</span>&nbsp;<span class="ident" id="7992610">c</span><span class="op" id="7992611">.</span><span class="ident" id="7992612">Close</span><span class="op" id="7992617">(</span><span class="op" id="7992618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992621">if</span>&nbsp;<span class="ident" id="7992624">res</span>&nbsp;<span class="op" id="7992628">:=</span>&nbsp;<span class="op" id="7992631">&lt;-</span><span class="ident" id="7992633">servec</span><span class="op" id="7992639">;</span>&nbsp;<span class="ident" id="7992641">res</span><span class="op" id="7992644">.</span><span class="ident" id="7992645">err</span>&nbsp;<span class="op" id="7992649">!=</span>&nbsp;<span class="ident" id="7992652">nil</span>&nbsp;<span class="op" id="7992656">||</span>&nbsp;<span class="ident" id="7992659">res</span><span class="op" id="7992662">.</span><span class="ident" id="7992663">n</span>&nbsp;<span class="op" id="7992665">!=</span>&nbsp;<span class="ident" id="7992668">int64</span><span class="op" id="7992673">(</span><span class="builtinfunc" id="7992674">len</span><span class="op" id="7992677">(</span><span class="ident" id="7992678">msg</span><span class="op" id="7992681">)</span><span class="op" id="7992682">)</span>&nbsp;<span class="op" id="7992684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992688">t</span><span class="op" id="7992689">.</span><span class="ident" id="7992690">Fatalf</span><span class="op" id="7992696">(</span><span class="string" id="7992697">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="7992756">,</span>&nbsp;<span class="ident" id="7992758">res</span><span class="op" id="7992761">.</span><span class="ident" id="7992762">n</span><span class="op" id="7992763">,</span>&nbsp;<span class="ident" id="7992765">res</span><span class="op" id="7992768">.</span><span class="ident" id="7992769">err</span><span class="op" id="7992772">,</span>&nbsp;<span class="builtinfunc" id="7992774">len</span><span class="op" id="7992777">(</span><span class="ident" id="7992778">msg</span><span class="op" id="7992781">)</span><span class="op" id="7992782">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7992785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992788">c</span><span class="op" id="7992789">.</span><span class="ident" id="7992790">SetReadDeadline</span><span class="op" id="7992805">(</span><span class="ident" id="7992806">time</span><span class="op" id="7992810">.</span><span class="ident" id="7992811">Now</span><span class="op" id="7992814">(</span><span class="op" id="7992815">)</span><span class="op" id="7992816">.</span><span class="ident" id="7992817">Add</span><span class="op" id="7992820">(</span><span class="op" id="7992821">-</span><span class="num" id="7992822">5</span>&nbsp;<span class="op" id="7992824">*</span>&nbsp;<span class="ident" id="7992826">time</span><span class="op" id="7992830">.</span><span class="ident" id="7992831">Second</span><span class="op" id="7992837">)</span><span class="op" id="7992838">)</span>&nbsp;<span class="comment" id="7992840">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992857">buf</span>&nbsp;<span class="op" id="7992861">:=</span>&nbsp;<span class="builtinfunc" id="7992864">make</span><span class="op" id="7992868">(</span><span class="op" id="7992869">[</span><span class="op" id="7992870">]</span><span class="builtintype" id="7992871">byte</span><span class="op" id="7992875">,</span>&nbsp;<span class="builtinfunc" id="7992877">len</span><span class="op" id="7992880">(</span><span class="ident" id="7992881">msg</span><span class="op" id="7992884">)</span><span class="op" id="7992885">/</span><span class="num" id="7992886">2</span><span class="op" id="7992887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992890">n</span><span class="op" id="7992891">,</span>&nbsp;<span class="ident" id="7992893">err</span>&nbsp;<span class="op" id="7992897">:=</span>&nbsp;<span class="ident" id="7992900">c</span><span class="op" id="7992901">.</span><span class="ident" id="7992902">Read</span><span class="op" id="7992906">(</span><span class="ident" id="7992907">buf</span><span class="op" id="7992910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7992913">if</span>&nbsp;<span class="ident" id="7992916">n</span>&nbsp;<span class="op" id="7992918">&gt;</span>&nbsp;<span class="num" id="7992920">0</span>&nbsp;<span class="op" id="7992922">||</span>&nbsp;<span class="op" id="7992925">!</span><span class="ident" id="7992926">isTimeout</span><span class="op" id="7992935">(</span><span class="ident" id="7992936">err</span><span class="op" id="7992939">)</span>&nbsp;<span class="op" id="7992941">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7992945">t</span><span class="op" id="7992946">.</span><span class="ident" id="7992947">Fatalf</span><span class="op" id="7992953">(</span><span class="string" id="7992954">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="7993001">,</span>&nbsp;<span class="ident" id="7993003">n</span><span class="op" id="7993004">,</span>&nbsp;<span class="ident" id="7993006">buf</span><span class="op" id="7993009">[</span><span class="op" id="7993010">:</span><span class="ident" id="7993011">n</span><span class="op" id="7993012">]</span><span class="op" id="7993013">,</span>&nbsp;<span class="ident" id="7993015">err</span><span class="op" id="7993018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993021">}</span><br>
<span class="lineno"></span><span class="op" id="7993023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7993026">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="7993100">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="7993147">func</span>&nbsp;<span class="ident" id="7993152">TestWriteDeadlineBufferAvailable</span><span class="op" id="7993184">(</span><span class="ident" id="7993185">t</span>&nbsp;<span class="op" id="7993187">*</span><span class="ident" id="7993188">testing</span><span class="op" id="7993195">.</span><span class="ident" id="7993196">T</span><span class="op" id="7993197">)</span>&nbsp;<span class="op" id="7993199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993202">switch</span>&nbsp;<span class="ident" id="7993209">runtime</span><span class="op" id="7993216">.</span><span class="ident" id="7993217">GOOS</span>&nbsp;<span class="op" id="7993222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993225">case</span>&nbsp;<span class="string" id="7993230">&#34;plan9&#34;</span><span class="op" id="7993237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993241">t</span><span class="op" id="7993242">.</span><span class="ident" id="7993243">Skipf</span><span class="op" id="7993248">(</span><span class="string" id="7993249">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7993270">,</span>&nbsp;<span class="ident" id="7993272">runtime</span><span class="op" id="7993279">.</span><span class="ident" id="7993280">GOOS</span><span class="op" id="7993284">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993291">ln</span>&nbsp;<span class="op" id="7993294">:=</span>&nbsp;<span class="ident" id="7993297">newLocalListener</span><span class="op" id="7993313">(</span><span class="ident" id="7993314">t</span><span class="op" id="7993315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993318">defer</span>&nbsp;<span class="ident" id="7993324">ln</span><span class="op" id="7993326">.</span><span class="ident" id="7993327">Close</span><span class="op" id="7993332">(</span><span class="op" id="7993333">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993337">servec</span>&nbsp;<span class="op" id="7993344">:=</span>&nbsp;<span class="builtinfunc" id="7993347">make</span><span class="op" id="7993351">(</span><span class="keyword" id="7993352">chan</span>&nbsp;<span class="ident" id="7993357">copyRes</span><span class="op" id="7993364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993367">go</span>&nbsp;<span class="keyword" id="7993370">func</span><span class="op" id="7993374">(</span><span class="op" id="7993375">)</span>&nbsp;<span class="op" id="7993377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993381">c</span><span class="op" id="7993382">,</span>&nbsp;<span class="ident" id="7993384">err</span>&nbsp;<span class="op" id="7993388">:=</span>&nbsp;<span class="ident" id="7993391">ln</span><span class="op" id="7993393">.</span><span class="ident" id="7993394">Accept</span><span class="op" id="7993400">(</span><span class="op" id="7993401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993405">if</span>&nbsp;<span class="ident" id="7993408">err</span>&nbsp;<span class="op" id="7993412">!=</span>&nbsp;<span class="ident" id="7993415">nil</span>&nbsp;<span class="op" id="7993419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993424">t</span><span class="op" id="7993425">.</span><span class="ident" id="7993426">Errorf</span><span class="op" id="7993432">(</span><span class="string" id="7993433">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="7993445">,</span>&nbsp;<span class="ident" id="7993447">err</span><span class="op" id="7993450">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993455">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993468">defer</span>&nbsp;<span class="ident" id="7993474">c</span><span class="op" id="7993475">.</span><span class="ident" id="7993476">Close</span><span class="op" id="7993481">(</span><span class="op" id="7993482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993486">c</span><span class="op" id="7993487">.</span><span class="ident" id="7993488">SetWriteDeadline</span><span class="op" id="7993504">(</span><span class="ident" id="7993505">time</span><span class="op" id="7993509">.</span><span class="ident" id="7993510">Now</span><span class="op" id="7993513">(</span><span class="op" id="7993514">)</span><span class="op" id="7993515">.</span><span class="ident" id="7993516">Add</span><span class="op" id="7993519">(</span><span class="op" id="7993520">-</span><span class="num" id="7993521">5</span>&nbsp;<span class="op" id="7993523">*</span>&nbsp;<span class="ident" id="7993525">time</span><span class="op" id="7993529">.</span><span class="ident" id="7993530">Second</span><span class="op" id="7993536">)</span><span class="op" id="7993537">)</span>&nbsp;<span class="comment" id="7993539">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993556">n</span><span class="op" id="7993557">,</span>&nbsp;<span class="ident" id="7993559">err</span>&nbsp;<span class="op" id="7993563">:=</span>&nbsp;<span class="ident" id="7993566">c</span><span class="op" id="7993567">.</span><span class="ident" id="7993568">Write</span><span class="op" id="7993573">(</span><span class="op" id="7993574">[</span><span class="op" id="7993575">]</span><span class="builtintype" id="7993576">byte</span><span class="op" id="7993580">{</span><span class="string" id="7993581">&#39;x&#39;</span><span class="op" id="7993584">}</span><span class="op" id="7993585">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993589">servec</span>&nbsp;<span class="op" id="7993596">&lt;-</span>&nbsp;<span class="ident" id="7993599">copyRes</span><span class="op" id="7993606">{</span><span class="ident" id="7993607">n</span><span class="op" id="7993608">:</span>&nbsp;<span class="ident" id="7993610">int64</span><span class="op" id="7993615">(</span><span class="ident" id="7993616">n</span><span class="op" id="7993617">)</span><span class="op" id="7993618">,</span>&nbsp;<span class="ident" id="7993620">err</span><span class="op" id="7993623">:</span>&nbsp;<span class="ident" id="7993625">err</span><span class="op" id="7993628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993631">}</span><span class="op" id="7993632">(</span><span class="op" id="7993633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993637">c</span><span class="op" id="7993638">,</span>&nbsp;<span class="ident" id="7993640">err</span>&nbsp;<span class="op" id="7993644">:=</span>&nbsp;<span class="ident" id="7993647">Dial</span><span class="op" id="7993651">(</span><span class="string" id="7993652">&#34;tcp&#34;</span><span class="op" id="7993657">,</span>&nbsp;<span class="ident" id="7993659">ln</span><span class="op" id="7993661">.</span><span class="ident" id="7993662">Addr</span><span class="op" id="7993666">(</span><span class="op" id="7993667">)</span><span class="op" id="7993668">.</span><span class="ident" id="7993669">String</span><span class="op" id="7993675">(</span><span class="op" id="7993676">)</span><span class="op" id="7993677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993680">if</span>&nbsp;<span class="ident" id="7993683">err</span>&nbsp;<span class="op" id="7993687">!=</span>&nbsp;<span class="ident" id="7993690">nil</span>&nbsp;<span class="op" id="7993694">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993698">t</span><span class="op" id="7993699">.</span><span class="ident" id="7993700">Fatalf</span><span class="op" id="7993706">(</span><span class="string" id="7993707">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7993717">,</span>&nbsp;<span class="ident" id="7993719">err</span><span class="op" id="7993722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993728">defer</span>&nbsp;<span class="ident" id="7993734">c</span><span class="op" id="7993735">.</span><span class="ident" id="7993736">Close</span><span class="op" id="7993741">(</span><span class="op" id="7993742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993745">res</span>&nbsp;<span class="op" id="7993749">:=</span>&nbsp;<span class="op" id="7993752">&lt;-</span><span class="ident" id="7993754">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993762">if</span>&nbsp;<span class="ident" id="7993765">res</span><span class="op" id="7993768">.</span><span class="ident" id="7993769">n</span>&nbsp;<span class="op" id="7993771">!=</span>&nbsp;<span class="num" id="7993774">0</span>&nbsp;<span class="op" id="7993776">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993780">t</span><span class="op" id="7993781">.</span><span class="ident" id="7993782">Errorf</span><span class="op" id="7993788">(</span><span class="string" id="7993789">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="7993809">,</span>&nbsp;<span class="ident" id="7993811">res</span><span class="op" id="7993814">.</span><span class="ident" id="7993815">n</span><span class="op" id="7993816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7993822">if</span>&nbsp;<span class="op" id="7993825">!</span><span class="ident" id="7993826">isTimeout</span><span class="op" id="7993835">(</span><span class="ident" id="7993836">res</span><span class="op" id="7993839">.</span><span class="ident" id="7993840">err</span><span class="op" id="7993843">)</span>&nbsp;<span class="op" id="7993845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7993849">t</span><span class="op" id="7993850">.</span><span class="ident" id="7993851">Errorf</span><span class="op" id="7993857">(</span><span class="string" id="7993858">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7993890">,</span>&nbsp;<span class="ident" id="7993892">res</span><span class="op" id="7993895">.</span><span class="ident" id="7993896">err</span><span class="op" id="7993899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7993902">}</span><br>
<span class="lineno">600</span><span class="op" id="7993904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7993907">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="7993987">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="7994033">func</span>&nbsp;<span class="ident" id="7994038">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="7994075">(</span><span class="ident" id="7994076">t</span>&nbsp;<span class="op" id="7994078">*</span><span class="ident" id="7994079">testing</span><span class="op" id="7994086">.</span><span class="ident" id="7994087">T</span><span class="op" id="7994088">)</span>&nbsp;<span class="op" id="7994090">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994093">switch</span>&nbsp;<span class="ident" id="7994100">runtime</span><span class="op" id="7994107">.</span><span class="ident" id="7994108">GOOS</span>&nbsp;<span class="op" id="7994113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994116">case</span>&nbsp;<span class="string" id="7994121">&#34;plan9&#34;</span><span class="op" id="7994128">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994132">t</span><span class="op" id="7994133">.</span><span class="ident" id="7994134">Skipf</span><span class="op" id="7994139">(</span><span class="string" id="7994140">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7994161">,</span>&nbsp;<span class="ident" id="7994163">runtime</span><span class="op" id="7994170">.</span><span class="ident" id="7994171">GOOS</span><span class="op" id="7994175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994182">ln</span>&nbsp;<span class="op" id="7994185">:=</span>&nbsp;<span class="ident" id="7994188">newLocalListener</span><span class="op" id="7994204">(</span><span class="ident" id="7994205">t</span><span class="op" id="7994206">)</span><span class="op" id="7994207">.</span><span class="op" id="7994208">(</span><span class="op" id="7994209">*</span><span class="ident" id="7994210">TCPListener</span><span class="op" id="7994221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994224">defer</span>&nbsp;<span class="ident" id="7994230">ln</span><span class="op" id="7994232">.</span><span class="ident" id="7994233">Close</span><span class="op" id="7994238">(</span><span class="op" id="7994239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994243">go</span>&nbsp;<span class="keyword" id="7994246">func</span><span class="op" id="7994250">(</span><span class="op" id="7994251">)</span>&nbsp;<span class="op" id="7994253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994257">c</span><span class="op" id="7994258">,</span>&nbsp;<span class="ident" id="7994260">err</span>&nbsp;<span class="op" id="7994264">:=</span>&nbsp;<span class="ident" id="7994267">Dial</span><span class="op" id="7994271">(</span><span class="string" id="7994272">&#34;tcp&#34;</span><span class="op" id="7994277">,</span>&nbsp;<span class="ident" id="7994279">ln</span><span class="op" id="7994281">.</span><span class="ident" id="7994282">Addr</span><span class="op" id="7994286">(</span><span class="op" id="7994287">)</span><span class="op" id="7994288">.</span><span class="ident" id="7994289">String</span><span class="op" id="7994295">(</span><span class="op" id="7994296">)</span><span class="op" id="7994297">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994301">if</span>&nbsp;<span class="ident" id="7994304">err</span>&nbsp;<span class="op" id="7994308">!=</span>&nbsp;<span class="ident" id="7994311">nil</span>&nbsp;<span class="op" id="7994315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994320">t</span><span class="op" id="7994321">.</span><span class="ident" id="7994322">Errorf</span><span class="op" id="7994328">(</span><span class="string" id="7994329">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7994339">,</span>&nbsp;<span class="ident" id="7994341">err</span><span class="op" id="7994344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994349">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994362">defer</span>&nbsp;<span class="ident" id="7994368">c</span><span class="op" id="7994369">.</span><span class="ident" id="7994370">Close</span><span class="op" id="7994375">(</span><span class="op" id="7994376">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994380">var</span>&nbsp;<span class="ident" id="7994384">buf</span>&nbsp;<span class="op" id="7994388">[</span><span class="num" id="7994389">1</span><span class="op" id="7994390">]</span><span class="builtintype" id="7994391">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994398">c</span><span class="op" id="7994399">.</span><span class="ident" id="7994400">Read</span><span class="op" id="7994404">(</span><span class="ident" id="7994405">buf</span><span class="op" id="7994408">[</span><span class="op" id="7994409">:</span><span class="op" id="7994410">]</span><span class="op" id="7994411">)</span>&nbsp;<span class="comment" id="7994413">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994466">}</span><span class="op" id="7994467">(</span><span class="op" id="7994468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994471">time</span><span class="op" id="7994475">.</span><span class="ident" id="7994476">Sleep</span><span class="op" id="7994481">(</span><span class="num" id="7994482">10</span>&nbsp;<span class="op" id="7994485">*</span>&nbsp;<span class="ident" id="7994487">time</span><span class="op" id="7994491">.</span><span class="ident" id="7994492">Millisecond</span><span class="op" id="7994503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994506">ln</span><span class="op" id="7994508">.</span><span class="ident" id="7994509">SetDeadline</span><span class="op" id="7994520">(</span><span class="ident" id="7994521">time</span><span class="op" id="7994525">.</span><span class="ident" id="7994526">Now</span><span class="op" id="7994529">(</span><span class="op" id="7994530">)</span><span class="op" id="7994531">.</span><span class="ident" id="7994532">Add</span><span class="op" id="7994535">(</span><span class="op" id="7994536">-</span><span class="num" id="7994537">5</span>&nbsp;<span class="op" id="7994539">*</span>&nbsp;<span class="ident" id="7994541">time</span><span class="op" id="7994545">.</span><span class="ident" id="7994546">Second</span><span class="op" id="7994552">)</span><span class="op" id="7994553">)</span>&nbsp;<span class="comment" id="7994555">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994571">c</span><span class="op" id="7994572">,</span>&nbsp;<span class="ident" id="7994574">err</span>&nbsp;<span class="op" id="7994578">:=</span>&nbsp;<span class="ident" id="7994581">ln</span><span class="op" id="7994583">.</span><span class="ident" id="7994584">Accept</span><span class="op" id="7994590">(</span><span class="op" id="7994591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994594">if</span>&nbsp;<span class="ident" id="7994597">err</span>&nbsp;<span class="op" id="7994601">==</span>&nbsp;<span class="ident" id="7994604">nil</span>&nbsp;<span class="op" id="7994608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994612">defer</span>&nbsp;<span class="ident" id="7994618">c</span><span class="op" id="7994619">.</span><span class="ident" id="7994620">Close</span><span class="op" id="7994625">(</span><span class="op" id="7994626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994632">if</span>&nbsp;<span class="op" id="7994635">!</span><span class="ident" id="7994636">isTimeout</span><span class="op" id="7994645">(</span><span class="ident" id="7994646">err</span><span class="op" id="7994649">)</span>&nbsp;<span class="op" id="7994651">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994655">t</span><span class="op" id="7994656">.</span><span class="ident" id="7994657">Fatalf</span><span class="op" id="7994663">(</span><span class="string" id="7994664">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7994694">,</span>&nbsp;<span class="ident" id="7994696">err</span><span class="op" id="7994699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994702">}</span><br>
<span class="lineno"></span><span class="op" id="7994704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7994707">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="7994779">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="7994833">func</span>&nbsp;<span class="ident" id="7994838">TestConnectDeadlineInThePast</span><span class="op" id="7994866">(</span><span class="ident" id="7994867">t</span>&nbsp;<span class="op" id="7994869">*</span><span class="ident" id="7994870">testing</span><span class="op" id="7994877">.</span><span class="ident" id="7994878">T</span><span class="op" id="7994879">)</span>&nbsp;<span class="op" id="7994881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994884">switch</span>&nbsp;<span class="ident" id="7994891">runtime</span><span class="op" id="7994898">.</span><span class="ident" id="7994899">GOOS</span>&nbsp;<span class="op" id="7994904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7994907">case</span>&nbsp;<span class="string" id="7994912">&#34;plan9&#34;</span><span class="op" id="7994919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994923">t</span><span class="op" id="7994924">.</span><span class="ident" id="7994925">Skipf</span><span class="op" id="7994930">(</span><span class="string" id="7994931">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7994952">,</span>&nbsp;<span class="ident" id="7994954">runtime</span><span class="op" id="7994961">.</span><span class="ident" id="7994962">GOOS</span><span class="op" id="7994966">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7994969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7994973">ln</span>&nbsp;<span class="op" id="7994976">:=</span>&nbsp;<span class="ident" id="7994979">newLocalListener</span><span class="op" id="7994995">(</span><span class="ident" id="7994996">t</span><span class="op" id="7994997">)</span><span class="op" id="7994998">.</span><span class="op" id="7994999">(</span><span class="op" id="7995000">*</span><span class="ident" id="7995001">TCPListener</span><span class="op" id="7995012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995015">defer</span>&nbsp;<span class="ident" id="7995021">ln</span><span class="op" id="7995023">.</span><span class="ident" id="7995024">Close</span><span class="op" id="7995029">(</span><span class="op" id="7995030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995034">go</span>&nbsp;<span class="keyword" id="7995037">func</span><span class="op" id="7995041">(</span><span class="op" id="7995042">)</span>&nbsp;<span class="op" id="7995044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995048">c</span><span class="op" id="7995049">,</span>&nbsp;<span class="ident" id="7995051">err</span>&nbsp;<span class="op" id="7995055">:=</span>&nbsp;<span class="ident" id="7995058">ln</span><span class="op" id="7995060">.</span><span class="ident" id="7995061">Accept</span><span class="op" id="7995067">(</span><span class="op" id="7995068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995072">if</span>&nbsp;<span class="ident" id="7995075">err</span>&nbsp;<span class="op" id="7995079">==</span>&nbsp;<span class="ident" id="7995082">nil</span>&nbsp;<span class="op" id="7995086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995091">defer</span>&nbsp;<span class="ident" id="7995097">c</span><span class="op" id="7995098">.</span><span class="ident" id="7995099">Close</span><span class="op" id="7995104">(</span><span class="op" id="7995105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995109">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995112">}</span><span class="op" id="7995113">(</span><span class="op" id="7995114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995117">time</span><span class="op" id="7995121">.</span><span class="ident" id="7995122">Sleep</span><span class="op" id="7995127">(</span><span class="num" id="7995128">10</span>&nbsp;<span class="op" id="7995131">*</span>&nbsp;<span class="ident" id="7995133">time</span><span class="op" id="7995137">.</span><span class="ident" id="7995138">Millisecond</span><span class="op" id="7995149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995152">c</span><span class="op" id="7995153">,</span>&nbsp;<span class="ident" id="7995155">err</span>&nbsp;<span class="op" id="7995159">:=</span>&nbsp;<span class="ident" id="7995162">DialTimeout</span><span class="op" id="7995173">(</span><span class="string" id="7995174">&#34;tcp&#34;</span><span class="op" id="7995179">,</span>&nbsp;<span class="ident" id="7995181">ln</span><span class="op" id="7995183">.</span><span class="ident" id="7995184">Addr</span><span class="op" id="7995188">(</span><span class="op" id="7995189">)</span><span class="op" id="7995190">.</span><span class="ident" id="7995191">String</span><span class="op" id="7995197">(</span><span class="op" id="7995198">)</span><span class="op" id="7995199">,</span>&nbsp;<span class="op" id="7995201">-</span><span class="num" id="7995202">5</span><span class="op" id="7995203">*</span><span class="ident" id="7995204">time</span><span class="op" id="7995208">.</span><span class="ident" id="7995209">Second</span><span class="op" id="7995215">)</span>&nbsp;<span class="comment" id="7995217">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995233">if</span>&nbsp;<span class="ident" id="7995236">err</span>&nbsp;<span class="op" id="7995240">==</span>&nbsp;<span class="ident" id="7995243">nil</span>&nbsp;<span class="op" id="7995247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995251">defer</span>&nbsp;<span class="ident" id="7995257">c</span><span class="op" id="7995258">.</span><span class="ident" id="7995259">Close</span><span class="op" id="7995264">(</span><span class="op" id="7995265">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995271">if</span>&nbsp;<span class="op" id="7995274">!</span><span class="ident" id="7995275">isTimeout</span><span class="op" id="7995284">(</span><span class="ident" id="7995285">err</span><span class="op" id="7995288">)</span>&nbsp;<span class="op" id="7995290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995294">t</span><span class="op" id="7995295">.</span><span class="ident" id="7995296">Fatalf</span><span class="op" id="7995302">(</span><span class="string" id="7995303">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="7995338">,</span>&nbsp;<span class="ident" id="7995340">err</span><span class="op" id="7995343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995346">}</span><br>
<span class="lineno"></span><span class="op" id="7995348">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="7995351">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="7995413">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="7995455">func</span>&nbsp;<span class="ident" id="7995460">TestProlongTimeout</span><span class="op" id="7995478">(</span><span class="ident" id="7995479">t</span>&nbsp;<span class="op" id="7995481">*</span><span class="ident" id="7995482">testing</span><span class="op" id="7995489">.</span><span class="ident" id="7995490">T</span><span class="op" id="7995491">)</span>&nbsp;<span class="op" id="7995493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995496">switch</span>&nbsp;<span class="ident" id="7995503">runtime</span><span class="op" id="7995510">.</span><span class="ident" id="7995511">GOOS</span>&nbsp;<span class="op" id="7995516">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995519">case</span>&nbsp;<span class="string" id="7995524">&#34;plan9&#34;</span><span class="op" id="7995531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995535">t</span><span class="op" id="7995536">.</span><span class="ident" id="7995537">Skipf</span><span class="op" id="7995542">(</span><span class="string" id="7995543">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7995564">,</span>&nbsp;<span class="ident" id="7995566">runtime</span><span class="op" id="7995573">.</span><span class="ident" id="7995574">GOOS</span><span class="op" id="7995578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995585">ln</span>&nbsp;<span class="op" id="7995588">:=</span>&nbsp;<span class="ident" id="7995591">newLocalListener</span><span class="op" id="7995607">(</span><span class="ident" id="7995608">t</span><span class="op" id="7995609">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995612">defer</span>&nbsp;<span class="ident" id="7995618">ln</span><span class="op" id="7995620">.</span><span class="ident" id="7995621">Close</span><span class="op" id="7995626">(</span><span class="op" id="7995627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995630">connected</span>&nbsp;<span class="op" id="7995640">:=</span>&nbsp;<span class="builtinfunc" id="7995643">make</span><span class="op" id="7995647">(</span><span class="keyword" id="7995648">chan</span>&nbsp;<span class="builtintype" id="7995653">bool</span><span class="op" id="7995657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995660">go</span>&nbsp;<span class="keyword" id="7995663">func</span><span class="op" id="7995667">(</span><span class="op" id="7995668">)</span>&nbsp;<span class="op" id="7995670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995674">s</span><span class="op" id="7995675">,</span>&nbsp;<span class="ident" id="7995677">err</span>&nbsp;<span class="op" id="7995681">:=</span>&nbsp;<span class="ident" id="7995684">ln</span><span class="op" id="7995686">.</span><span class="ident" id="7995687">Accept</span><span class="op" id="7995693">(</span><span class="op" id="7995694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995698">connected</span>&nbsp;<span class="op" id="7995708">&lt;-</span>&nbsp;<span class="builtintype" id="7995711">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995718">if</span>&nbsp;<span class="ident" id="7995721">err</span>&nbsp;<span class="op" id="7995725">!=</span>&nbsp;<span class="ident" id="7995728">nil</span>&nbsp;<span class="op" id="7995732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995737">t</span><span class="op" id="7995738">.</span><span class="ident" id="7995739">Errorf</span><span class="op" id="7995745">(</span><span class="string" id="7995746">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="7995761">,</span>&nbsp;<span class="ident" id="7995763">err</span><span class="op" id="7995766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995771">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995784">defer</span>&nbsp;<span class="ident" id="7995790">s</span><span class="op" id="7995791">.</span><span class="ident" id="7995792">Close</span><span class="op" id="7995797">(</span><span class="op" id="7995798">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995802">s</span><span class="op" id="7995803">.</span><span class="ident" id="7995804">SetDeadline</span><span class="op" id="7995815">(</span><span class="ident" id="7995816">time</span><span class="op" id="7995820">.</span><span class="ident" id="7995821">Now</span><span class="op" id="7995824">(</span><span class="op" id="7995825">)</span><span class="op" id="7995826">.</span><span class="ident" id="7995827">Add</span><span class="op" id="7995830">(</span><span class="ident" id="7995831">time</span><span class="op" id="7995835">.</span><span class="ident" id="7995836">Hour</span><span class="op" id="7995840">)</span><span class="op" id="7995841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995845">go</span>&nbsp;<span class="keyword" id="7995848">func</span><span class="op" id="7995852">(</span><span class="op" id="7995853">)</span>&nbsp;<span class="op" id="7995855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995860">var</span>&nbsp;<span class="ident" id="7995864">buf</span>&nbsp;<span class="op" id="7995868">[</span><span class="num" id="7995869">4096</span><span class="op" id="7995873">]</span><span class="builtintype" id="7995874">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995882">for</span>&nbsp;<span class="op" id="7995886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995892">_</span><span class="op" id="7995893">,</span>&nbsp;<span class="ident" id="7995895">err</span>&nbsp;<span class="op" id="7995899">:=</span>&nbsp;<span class="ident" id="7995902">s</span><span class="op" id="7995903">.</span><span class="ident" id="7995904">Write</span><span class="op" id="7995909">(</span><span class="ident" id="7995910">buf</span><span class="op" id="7995913">[</span><span class="op" id="7995914">:</span><span class="op" id="7995915">]</span><span class="op" id="7995916">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995922">if</span>&nbsp;<span class="ident" id="7995925">err</span>&nbsp;<span class="op" id="7995929">!=</span>&nbsp;<span class="ident" id="7995932">nil</span>&nbsp;<span class="op" id="7995936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7995943">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7995953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7995959">s</span><span class="op" id="7995960">.</span><span class="ident" id="7995961">SetDeadline</span><span class="op" id="7995972">(</span><span class="ident" id="7995973">time</span><span class="op" id="7995977">.</span><span class="ident" id="7995978">Now</span><span class="op" id="7995981">(</span><span class="op" id="7995982">)</span><span class="op" id="7995983">.</span><span class="ident" id="7995984">Add</span><span class="op" id="7995987">(</span><span class="ident" id="7995988">time</span><span class="op" id="7995992">.</span><span class="ident" id="7995993">Hour</span><span class="op" id="7995997">)</span><span class="op" id="7995998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996003">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996007">}</span><span class="op" id="7996008">(</span><span class="op" id="7996009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996013">buf</span>&nbsp;<span class="op" id="7996017">:=</span>&nbsp;<span class="builtinfunc" id="7996020">make</span><span class="op" id="7996024">(</span><span class="op" id="7996025">[</span><span class="op" id="7996026">]</span><span class="builtintype" id="7996027">byte</span><span class="op" id="7996031">,</span>&nbsp;<span class="num" id="7996033">1</span><span class="op" id="7996034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996038">for</span>&nbsp;<span class="op" id="7996042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996047">_</span><span class="op" id="7996048">,</span>&nbsp;<span class="ident" id="7996050">err</span>&nbsp;<span class="op" id="7996054">:=</span>&nbsp;<span class="ident" id="7996057">s</span><span class="op" id="7996058">.</span><span class="ident" id="7996059">Read</span><span class="op" id="7996063">(</span><span class="ident" id="7996064">buf</span><span class="op" id="7996067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996072">if</span>&nbsp;<span class="ident" id="7996075">err</span>&nbsp;<span class="op" id="7996079">!=</span>&nbsp;<span class="ident" id="7996082">nil</span>&nbsp;<span class="op" id="7996086">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996092">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996106">s</span><span class="op" id="7996107">.</span><span class="ident" id="7996108">SetDeadline</span><span class="op" id="7996119">(</span><span class="ident" id="7996120">time</span><span class="op" id="7996124">.</span><span class="ident" id="7996125">Now</span><span class="op" id="7996128">(</span><span class="op" id="7996129">)</span><span class="op" id="7996130">.</span><span class="ident" id="7996131">Add</span><span class="op" id="7996134">(</span><span class="ident" id="7996135">time</span><span class="op" id="7996139">.</span><span class="ident" id="7996140">Hour</span><span class="op" id="7996144">)</span><span class="op" id="7996145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996152">}</span><span class="op" id="7996153">(</span><span class="op" id="7996154">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996157">c</span><span class="op" id="7996158">,</span>&nbsp;<span class="ident" id="7996160">err</span>&nbsp;<span class="op" id="7996164">:=</span>&nbsp;<span class="ident" id="7996167">Dial</span><span class="op" id="7996171">(</span><span class="string" id="7996172">&#34;tcp&#34;</span><span class="op" id="7996177">,</span>&nbsp;<span class="ident" id="7996179">ln</span><span class="op" id="7996181">.</span><span class="ident" id="7996182">Addr</span><span class="op" id="7996186">(</span><span class="op" id="7996187">)</span><span class="op" id="7996188">.</span><span class="ident" id="7996189">String</span><span class="op" id="7996195">(</span><span class="op" id="7996196">)</span><span class="op" id="7996197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996200">if</span>&nbsp;<span class="ident" id="7996203">err</span>&nbsp;<span class="op" id="7996207">!=</span>&nbsp;<span class="ident" id="7996210">nil</span>&nbsp;<span class="op" id="7996214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996218">t</span><span class="op" id="7996219">.</span><span class="ident" id="7996220">Fatalf</span><span class="op" id="7996226">(</span><span class="string" id="7996227">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="7996240">,</span>&nbsp;<span class="ident" id="7996242">err</span><span class="op" id="7996245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996251">defer</span>&nbsp;<span class="ident" id="7996257">c</span><span class="op" id="7996258">.</span><span class="ident" id="7996259">Close</span><span class="op" id="7996264">(</span><span class="op" id="7996265">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996268">&lt;-</span><span class="ident" id="7996270">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996281">for</span>&nbsp;<span class="ident" id="7996285">i</span>&nbsp;<span class="op" id="7996287">:=</span>&nbsp;<span class="num" id="7996290">0</span><span class="op" id="7996291">;</span>&nbsp;<span class="ident" id="7996293">i</span>&nbsp;<span class="op" id="7996295">&lt;</span>&nbsp;<span class="num" id="7996297">1024</span><span class="op" id="7996301">;</span>&nbsp;<span class="ident" id="7996303">i</span><span class="op" id="7996304">++</span>&nbsp;<span class="op" id="7996307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996311">var</span>&nbsp;<span class="ident" id="7996315">buf</span>&nbsp;<span class="op" id="7996319">[</span><span class="num" id="7996320">1</span><span class="op" id="7996321">]</span><span class="builtintype" id="7996322">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996329">c</span><span class="op" id="7996330">.</span><span class="ident" id="7996331">Write</span><span class="op" id="7996336">(</span><span class="ident" id="7996337">buf</span><span class="op" id="7996340">[</span><span class="op" id="7996341">:</span><span class="op" id="7996342">]</span><span class="op" id="7996343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996346">}</span><br>
<span class="lineno">710</span><span class="op" id="7996348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7996351">func</span>&nbsp;<span class="ident" id="7996356">TestDeadlineRace</span><span class="op" id="7996372">(</span><span class="ident" id="7996373">t</span>&nbsp;<span class="op" id="7996375">*</span><span class="ident" id="7996376">testing</span><span class="op" id="7996383">.</span><span class="ident" id="7996384">T</span><span class="op" id="7996385">)</span>&nbsp;<span class="op" id="7996387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996390">switch</span>&nbsp;<span class="ident" id="7996397">runtime</span><span class="op" id="7996404">.</span><span class="ident" id="7996405">GOOS</span>&nbsp;<span class="op" id="7996410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996413">case</span>&nbsp;<span class="string" id="7996418">&#34;nacl&#34;</span><span class="op" id="7996424">,</span>&nbsp;<span class="string" id="7996426">&#34;plan9&#34;</span><span class="op" id="7996433">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996437">t</span><span class="op" id="7996438">.</span><span class="ident" id="7996439">Skipf</span><span class="op" id="7996444">(</span><span class="string" id="7996445">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7996466">,</span>&nbsp;<span class="ident" id="7996468">runtime</span><span class="op" id="7996475">.</span><span class="ident" id="7996476">GOOS</span><span class="op" id="7996480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996487">N</span>&nbsp;<span class="op" id="7996489">:=</span>&nbsp;<span class="num" id="7996492">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996498">if</span>&nbsp;<span class="ident" id="7996501">testing</span><span class="op" id="7996508">.</span><span class="ident" id="7996509">Short</span><span class="op" id="7996514">(</span><span class="op" id="7996515">)</span>&nbsp;<span class="op" id="7996517">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996521">N</span>&nbsp;<span class="op" id="7996523">=</span>&nbsp;<span class="num" id="7996525">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996532">defer</span>&nbsp;<span class="ident" id="7996538">runtime</span><span class="op" id="7996545">.</span><span class="ident" id="7996546">GOMAXPROCS</span><span class="op" id="7996556">(</span><span class="ident" id="7996557">runtime</span><span class="op" id="7996564">.</span><span class="ident" id="7996565">GOMAXPROCS</span><span class="op" id="7996575">(</span><span class="num" id="7996576">4</span><span class="op" id="7996577">)</span><span class="op" id="7996578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996581">ln</span>&nbsp;<span class="op" id="7996584">:=</span>&nbsp;<span class="ident" id="7996587">newLocalListener</span><span class="op" id="7996603">(</span><span class="ident" id="7996604">t</span><span class="op" id="7996605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996608">defer</span>&nbsp;<span class="ident" id="7996614">ln</span><span class="op" id="7996616">.</span><span class="ident" id="7996617">Close</span><span class="op" id="7996622">(</span><span class="op" id="7996623">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996626">c</span><span class="op" id="7996627">,</span>&nbsp;<span class="ident" id="7996629">err</span>&nbsp;<span class="op" id="7996633">:=</span>&nbsp;<span class="ident" id="7996636">Dial</span><span class="op" id="7996640">(</span><span class="string" id="7996641">&#34;tcp&#34;</span><span class="op" id="7996646">,</span>&nbsp;<span class="ident" id="7996648">ln</span><span class="op" id="7996650">.</span><span class="ident" id="7996651">Addr</span><span class="op" id="7996655">(</span><span class="op" id="7996656">)</span><span class="op" id="7996657">.</span><span class="ident" id="7996658">String</span><span class="op" id="7996664">(</span><span class="op" id="7996665">)</span><span class="op" id="7996666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996669">if</span>&nbsp;<span class="ident" id="7996672">err</span>&nbsp;<span class="op" id="7996676">!=</span>&nbsp;<span class="ident" id="7996679">nil</span>&nbsp;<span class="op" id="7996683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996687">t</span><span class="op" id="7996688">.</span><span class="ident" id="7996689">Fatalf</span><span class="op" id="7996695">(</span><span class="string" id="7996696">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="7996706">,</span>&nbsp;<span class="ident" id="7996708">err</span><span class="op" id="7996711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996717">defer</span>&nbsp;<span class="ident" id="7996723">c</span><span class="op" id="7996724">.</span><span class="ident" id="7996725">Close</span><span class="op" id="7996730">(</span><span class="op" id="7996731">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996734">done</span>&nbsp;<span class="op" id="7996739">:=</span>&nbsp;<span class="builtinfunc" id="7996742">make</span><span class="op" id="7996746">(</span><span class="keyword" id="7996747">chan</span>&nbsp;<span class="builtintype" id="7996752">bool</span><span class="op" id="7996756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996759">go</span>&nbsp;<span class="keyword" id="7996762">func</span><span class="op" id="7996766">(</span><span class="op" id="7996767">)</span>&nbsp;<span class="op" id="7996769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996773">t</span>&nbsp;<span class="op" id="7996775">:=</span>&nbsp;<span class="ident" id="7996778">time</span><span class="op" id="7996782">.</span><span class="ident" id="7996783">NewTicker</span><span class="op" id="7996792">(</span><span class="num" id="7996793">2</span>&nbsp;<span class="op" id="7996795">*</span>&nbsp;<span class="ident" id="7996797">time</span><span class="op" id="7996801">.</span><span class="ident" id="7996802">Microsecond</span><span class="op" id="7996813">)</span><span class="op" id="7996814">.</span><span class="ident" id="7996815">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996819">for</span>&nbsp;<span class="ident" id="7996823">i</span>&nbsp;<span class="op" id="7996825">:=</span>&nbsp;<span class="num" id="7996828">0</span><span class="op" id="7996829">;</span>&nbsp;<span class="ident" id="7996831">i</span>&nbsp;<span class="op" id="7996833">&lt;</span>&nbsp;<span class="ident" id="7996835">N</span><span class="op" id="7996836">;</span>&nbsp;<span class="ident" id="7996838">i</span><span class="op" id="7996839">++</span>&nbsp;<span class="op" id="7996842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996847">if</span>&nbsp;<span class="ident" id="7996850">err</span>&nbsp;<span class="op" id="7996854">:=</span>&nbsp;<span class="ident" id="7996857">c</span><span class="op" id="7996858">.</span><span class="ident" id="7996859">SetDeadline</span><span class="op" id="7996870">(</span><span class="ident" id="7996871">time</span><span class="op" id="7996875">.</span><span class="ident" id="7996876">Now</span><span class="op" id="7996879">(</span><span class="op" id="7996880">)</span><span class="op" id="7996881">.</span><span class="ident" id="7996882">Add</span><span class="op" id="7996885">(</span><span class="num" id="7996886">2</span>&nbsp;<span class="op" id="7996888">*</span>&nbsp;<span class="ident" id="7996890">time</span><span class="op" id="7996894">.</span><span class="ident" id="7996895">Microsecond</span><span class="op" id="7996906">)</span><span class="op" id="7996907">)</span><span class="op" id="7996908">;</span>&nbsp;<span class="ident" id="7996910">err</span>&nbsp;<span class="op" id="7996914">!=</span>&nbsp;<span class="ident" id="7996917">nil</span>&nbsp;<span class="op" id="7996921">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996927">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996941">&lt;-</span><span class="ident" id="7996943">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7996951">done</span>&nbsp;<span class="op" id="7996956">&lt;-</span>&nbsp;<span class="builtintype" id="7996959">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7996965">}</span><span class="op" id="7996966">(</span><span class="op" id="7996967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996970">var</span>&nbsp;<span class="ident" id="7996974">buf</span>&nbsp;<span class="op" id="7996978">[</span><span class="num" id="7996979">1</span><span class="op" id="7996980">]</span><span class="builtintype" id="7996981">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7996987">for</span>&nbsp;<span class="ident" id="7996991">i</span>&nbsp;<span class="op" id="7996993">:=</span>&nbsp;<span class="num" id="7996996">0</span><span class="op" id="7996997">;</span>&nbsp;<span class="ident" id="7996999">i</span>&nbsp;<span class="op" id="7997001">&lt;</span>&nbsp;<span class="ident" id="7997003">N</span><span class="op" id="7997004">;</span>&nbsp;<span class="ident" id="7997006">i</span><span class="op" id="7997007">++</span>&nbsp;<span class="op" id="7997010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997014">c</span><span class="op" id="7997015">.</span><span class="ident" id="7997016">Read</span><span class="op" id="7997020">(</span><span class="ident" id="7997021">buf</span><span class="op" id="7997024">[</span><span class="op" id="7997025">:</span><span class="op" id="7997026">]</span><span class="op" id="7997027">)</span>&nbsp;<span class="comment" id="7997029">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997064">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997067">c</span><span class="op" id="7997068">.</span><span class="ident" id="7997069">Close</span><span class="op" id="7997074">(</span><span class="op" id="7997075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997078">&lt;-</span><span class="ident" id="7997080">done</span><br>
<span class="lineno"></span><span class="op" id="7997085">}</span>
</div>
</body>
</html>
