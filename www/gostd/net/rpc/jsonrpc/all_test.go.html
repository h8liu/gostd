<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc/jsonrpc</h2>
<ul>
<li><a href="/gostd/net/rpc/jsonrpc/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/jsonrpc/server.go.html">server.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7378847">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7378903">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7378957">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7379008">package</span>&nbsp;<span class="ident" id="7379016">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379025">import</span>&nbsp;<span class="op" id="7379032">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379035">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379044">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379061">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379071">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379078">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379084">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379097">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379104">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379115">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7379126">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7379136">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7379139">type</span>&nbsp;<span class="ident" id="7379144">Args</span>&nbsp;<span class="keyword" id="7379149">struct</span>&nbsp;<span class="op" id="7379156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379159">A</span><span class="op" id="7379160">,</span>&nbsp;<span class="ident" id="7379162">B</span>&nbsp;<span class="builtintype" id="7379164">int</span><br>
<span class="lineno"></span><span class="op" id="7379168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379171">type</span>&nbsp;<span class="ident" id="7379176">Reply</span>&nbsp;<span class="keyword" id="7379182">struct</span>&nbsp;<span class="op" id="7379189">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379192">C</span>&nbsp;<span class="builtintype" id="7379194">int</span><br>
<span class="lineno"></span><span class="op" id="7379198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379201">type</span>&nbsp;<span class="ident" id="7379206">Arith</span>&nbsp;<span class="builtintype" id="7379212">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7379217">type</span>&nbsp;<span class="ident" id="7379222">ArithAddResp</span>&nbsp;<span class="keyword" id="7379235">struct</span>&nbsp;<span class="op" id="7379242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379245">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7379252">interface</span><span class="op" id="7379261">{</span><span class="op" id="7379262">}</span>&nbsp;<span class="string" id="7379264">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379277">Result</span>&nbsp;<span class="ident" id="7379284">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7379296">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379313">Error</span>&nbsp;&nbsp;<span class="keyword" id="7379320">interface</span><span class="op" id="7379329">{</span><span class="op" id="7379330">}</span>&nbsp;<span class="string" id="7379332">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7379347">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7379350">func</span>&nbsp;<span class="op" id="7379355">(</span><span class="ident" id="7379356">t</span>&nbsp;<span class="op" id="7379358">*</span><span class="ident" id="7379359">Arith</span><span class="op" id="7379364">)</span>&nbsp;<span class="ident" id="7379366">Add</span><span class="op" id="7379369">(</span><span class="ident" id="7379370">args</span>&nbsp;<span class="op" id="7379375">*</span><span class="ident" id="7379376">Args</span><span class="op" id="7379380">,</span>&nbsp;<span class="ident" id="7379382">reply</span>&nbsp;<span class="op" id="7379388">*</span><span class="ident" id="7379389">Reply</span><span class="op" id="7379394">)</span>&nbsp;<span class="builtintype" id="7379396">error</span>&nbsp;<span class="op" id="7379402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379405">reply</span><span class="op" id="7379410">.</span><span class="ident" id="7379411">C</span>&nbsp;<span class="op" id="7379413">=</span>&nbsp;<span class="ident" id="7379415">args</span><span class="op" id="7379419">.</span><span class="ident" id="7379420">A</span>&nbsp;<span class="op" id="7379422">+</span>&nbsp;<span class="ident" id="7379424">args</span><span class="op" id="7379428">.</span><span class="ident" id="7379429">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379432">return</span>&nbsp;<span class="ident" id="7379439">nil</span><br>
<span class="lineno"></span><span class="op" id="7379443">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7379446">func</span>&nbsp;<span class="op" id="7379451">(</span><span class="ident" id="7379452">t</span>&nbsp;<span class="op" id="7379454">*</span><span class="ident" id="7379455">Arith</span><span class="op" id="7379460">)</span>&nbsp;<span class="ident" id="7379462">Mul</span><span class="op" id="7379465">(</span><span class="ident" id="7379466">args</span>&nbsp;<span class="op" id="7379471">*</span><span class="ident" id="7379472">Args</span><span class="op" id="7379476">,</span>&nbsp;<span class="ident" id="7379478">reply</span>&nbsp;<span class="op" id="7379484">*</span><span class="ident" id="7379485">Reply</span><span class="op" id="7379490">)</span>&nbsp;<span class="builtintype" id="7379492">error</span>&nbsp;<span class="op" id="7379498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379501">reply</span><span class="op" id="7379506">.</span><span class="ident" id="7379507">C</span>&nbsp;<span class="op" id="7379509">=</span>&nbsp;<span class="ident" id="7379511">args</span><span class="op" id="7379515">.</span><span class="ident" id="7379516">A</span>&nbsp;<span class="op" id="7379518">*</span>&nbsp;<span class="ident" id="7379520">args</span><span class="op" id="7379524">.</span><span class="ident" id="7379525">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379528">return</span>&nbsp;<span class="ident" id="7379535">nil</span><br>
<span class="lineno"></span><span class="op" id="7379539">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7379542">func</span>&nbsp;<span class="op" id="7379547">(</span><span class="ident" id="7379548">t</span>&nbsp;<span class="op" id="7379550">*</span><span class="ident" id="7379551">Arith</span><span class="op" id="7379556">)</span>&nbsp;<span class="ident" id="7379558">Div</span><span class="op" id="7379561">(</span><span class="ident" id="7379562">args</span>&nbsp;<span class="op" id="7379567">*</span><span class="ident" id="7379568">Args</span><span class="op" id="7379572">,</span>&nbsp;<span class="ident" id="7379574">reply</span>&nbsp;<span class="op" id="7379580">*</span><span class="ident" id="7379581">Reply</span><span class="op" id="7379586">)</span>&nbsp;<span class="builtintype" id="7379588">error</span>&nbsp;<span class="op" id="7379594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379597">if</span>&nbsp;<span class="ident" id="7379600">args</span><span class="op" id="7379604">.</span><span class="ident" id="7379605">B</span>&nbsp;<span class="op" id="7379607">==</span>&nbsp;<span class="num" id="7379610">0</span>&nbsp;<span class="op" id="7379612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379616">return</span>&nbsp;<span class="ident" id="7379623">errors</span><span class="op" id="7379629">.</span><span class="ident" id="7379630">New</span><span class="op" id="7379633">(</span><span class="string" id="7379634">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7379650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7379653">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379656">reply</span><span class="op" id="7379661">.</span><span class="ident" id="7379662">C</span>&nbsp;<span class="op" id="7379664">=</span>&nbsp;<span class="ident" id="7379666">args</span><span class="op" id="7379670">.</span><span class="ident" id="7379671">A</span>&nbsp;<span class="op" id="7379673">/</span>&nbsp;<span class="ident" id="7379675">args</span><span class="op" id="7379679">.</span><span class="ident" id="7379680">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379683">return</span>&nbsp;<span class="ident" id="7379690">nil</span><br>
<span class="lineno"></span><span class="op" id="7379694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379697">func</span>&nbsp;<span class="op" id="7379702">(</span><span class="ident" id="7379703">t</span>&nbsp;<span class="op" id="7379705">*</span><span class="ident" id="7379706">Arith</span><span class="op" id="7379711">)</span>&nbsp;<span class="ident" id="7379713">Error</span><span class="op" id="7379718">(</span><span class="ident" id="7379719">args</span>&nbsp;<span class="op" id="7379724">*</span><span class="ident" id="7379725">Args</span><span class="op" id="7379729">,</span>&nbsp;<span class="ident" id="7379731">reply</span>&nbsp;<span class="op" id="7379737">*</span><span class="ident" id="7379738">Reply</span><span class="op" id="7379743">)</span>&nbsp;<span class="builtintype" id="7379745">error</span>&nbsp;<span class="op" id="7379751">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7379754">panic</span><span class="op" id="7379759">(</span><span class="string" id="7379760">&#34;ERROR&#34;</span><span class="op" id="7379767">)</span><br>
<span class="lineno"></span><span class="op" id="7379769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379772">func</span>&nbsp;<span class="ident" id="7379777">init</span><span class="op" id="7379781">(</span><span class="op" id="7379782">)</span>&nbsp;<span class="op" id="7379784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379787">rpc</span><span class="op" id="7379790">.</span><span class="ident" id="7379791">Register</span><span class="op" id="7379799">(</span><span class="builtinfunc" id="7379800">new</span><span class="op" id="7379803">(</span><span class="ident" id="7379804">Arith</span><span class="op" id="7379809">)</span><span class="op" id="7379810">)</span><br>
<span class="lineno">60</span><span class="op" id="7379812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7379815">func</span>&nbsp;<span class="ident" id="7379820">TestServerNoParams</span><span class="op" id="7379838">(</span><span class="ident" id="7379839">t</span>&nbsp;<span class="op" id="7379841">*</span><span class="ident" id="7379842">testing</span><span class="op" id="7379849">.</span><span class="ident" id="7379850">T</span><span class="op" id="7379851">)</span>&nbsp;<span class="op" id="7379853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379856">cli</span><span class="op" id="7379859">,</span>&nbsp;<span class="ident" id="7379861">srv</span>&nbsp;<span class="op" id="7379865">:=</span>&nbsp;<span class="ident" id="7379868">net</span><span class="op" id="7379871">.</span><span class="ident" id="7379872">Pipe</span><span class="op" id="7379876">(</span><span class="op" id="7379877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379880">defer</span>&nbsp;<span class="ident" id="7379886">cli</span><span class="op" id="7379889">.</span><span class="ident" id="7379890">Close</span><span class="op" id="7379895">(</span><span class="op" id="7379896">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7379899">go</span>&nbsp;<span class="ident" id="7379902">ServeConn</span><span class="op" id="7379911">(</span><span class="ident" id="7379912">srv</span><span class="op" id="7379915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379918">dec</span>&nbsp;<span class="op" id="7379922">:=</span>&nbsp;<span class="ident" id="7379925">json</span><span class="op" id="7379929">.</span><span class="ident" id="7379930">NewDecoder</span><span class="op" id="7379940">(</span><span class="ident" id="7379941">cli</span><span class="op" id="7379944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7379948">fmt</span><span class="op" id="7379951">.</span><span class="ident" id="7379952">Fprintf</span><span class="op" id="7379959">(</span><span class="ident" id="7379960">cli</span><span class="op" id="7379963">,</span>&nbsp;<span class="string" id="7379965">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="7380003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380006">var</span>&nbsp;<span class="ident" id="7380010">resp</span>&nbsp;<span class="ident" id="7380015">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380029">if</span>&nbsp;<span class="ident" id="7380032">err</span>&nbsp;<span class="op" id="7380036">:=</span>&nbsp;<span class="ident" id="7380039">dec</span><span class="op" id="7380042">.</span><span class="ident" id="7380043">Decode</span><span class="op" id="7380049">(</span><span class="op" id="7380050">&amp;</span><span class="ident" id="7380051">resp</span><span class="op" id="7380055">)</span><span class="op" id="7380056">;</span>&nbsp;<span class="ident" id="7380058">err</span>&nbsp;<span class="op" id="7380062">!=</span>&nbsp;<span class="ident" id="7380065">nil</span>&nbsp;<span class="op" id="7380069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380073">t</span><span class="op" id="7380074">.</span><span class="ident" id="7380075">Fatalf</span><span class="op" id="7380081">(</span><span class="string" id="7380082">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="7380110">,</span>&nbsp;<span class="ident" id="7380112">err</span><span class="op" id="7380115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380121">if</span>&nbsp;<span class="ident" id="7380124">resp</span><span class="op" id="7380128">.</span><span class="ident" id="7380129">Error</span>&nbsp;<span class="op" id="7380135">==</span>&nbsp;<span class="ident" id="7380138">nil</span>&nbsp;<span class="op" id="7380142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380146">t</span><span class="op" id="7380147">.</span><span class="ident" id="7380148">Fatalf</span><span class="op" id="7380154">(</span><span class="string" id="7380155">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7380180">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380183">}</span><br>
<span class="lineno"></span><span class="op" id="7380185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7380188">func</span>&nbsp;<span class="ident" id="7380193">TestServerEmptyMessage</span><span class="op" id="7380215">(</span><span class="ident" id="7380216">t</span>&nbsp;<span class="op" id="7380218">*</span><span class="ident" id="7380219">testing</span><span class="op" id="7380226">.</span><span class="ident" id="7380227">T</span><span class="op" id="7380228">)</span>&nbsp;<span class="op" id="7380230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380233">cli</span><span class="op" id="7380236">,</span>&nbsp;<span class="ident" id="7380238">srv</span>&nbsp;<span class="op" id="7380242">:=</span>&nbsp;<span class="ident" id="7380245">net</span><span class="op" id="7380248">.</span><span class="ident" id="7380249">Pipe</span><span class="op" id="7380253">(</span><span class="op" id="7380254">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380257">defer</span>&nbsp;<span class="ident" id="7380263">cli</span><span class="op" id="7380266">.</span><span class="ident" id="7380267">Close</span><span class="op" id="7380272">(</span><span class="op" id="7380273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380276">go</span>&nbsp;<span class="ident" id="7380279">ServeConn</span><span class="op" id="7380288">(</span><span class="ident" id="7380289">srv</span><span class="op" id="7380292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380295">dec</span>&nbsp;<span class="op" id="7380299">:=</span>&nbsp;<span class="ident" id="7380302">json</span><span class="op" id="7380306">.</span><span class="ident" id="7380307">NewDecoder</span><span class="op" id="7380317">(</span><span class="ident" id="7380318">cli</span><span class="op" id="7380321">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380325">fmt</span><span class="op" id="7380328">.</span><span class="ident" id="7380329">Fprintf</span><span class="op" id="7380336">(</span><span class="ident" id="7380337">cli</span><span class="op" id="7380340">,</span>&nbsp;<span class="string" id="7380342">&#34;{}&#34;</span><span class="op" id="7380346">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380349">var</span>&nbsp;<span class="ident" id="7380353">resp</span>&nbsp;<span class="ident" id="7380358">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380372">if</span>&nbsp;<span class="ident" id="7380375">err</span>&nbsp;<span class="op" id="7380379">:=</span>&nbsp;<span class="ident" id="7380382">dec</span><span class="op" id="7380385">.</span><span class="ident" id="7380386">Decode</span><span class="op" id="7380392">(</span><span class="op" id="7380393">&amp;</span><span class="ident" id="7380394">resp</span><span class="op" id="7380398">)</span><span class="op" id="7380399">;</span>&nbsp;<span class="ident" id="7380401">err</span>&nbsp;<span class="op" id="7380405">!=</span>&nbsp;<span class="ident" id="7380408">nil</span>&nbsp;<span class="op" id="7380412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380416">t</span><span class="op" id="7380417">.</span><span class="ident" id="7380418">Fatalf</span><span class="op" id="7380424">(</span><span class="string" id="7380425">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="7380449">,</span>&nbsp;<span class="ident" id="7380451">err</span><span class="op" id="7380454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380460">if</span>&nbsp;<span class="ident" id="7380463">resp</span><span class="op" id="7380467">.</span><span class="ident" id="7380468">Error</span>&nbsp;<span class="op" id="7380474">==</span>&nbsp;<span class="ident" id="7380477">nil</span>&nbsp;<span class="op" id="7380481">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380485">t</span><span class="op" id="7380486">.</span><span class="ident" id="7380487">Fatalf</span><span class="op" id="7380493">(</span><span class="string" id="7380494">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7380519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380522">}</span><br>
<span class="lineno"></span><span class="op" id="7380524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7380527">func</span>&nbsp;<span class="ident" id="7380532">TestServer</span><span class="op" id="7380542">(</span><span class="ident" id="7380543">t</span>&nbsp;<span class="op" id="7380545">*</span><span class="ident" id="7380546">testing</span><span class="op" id="7380553">.</span><span class="ident" id="7380554">T</span><span class="op" id="7380555">)</span>&nbsp;<span class="op" id="7380557">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380560">cli</span><span class="op" id="7380563">,</span>&nbsp;<span class="ident" id="7380565">srv</span>&nbsp;<span class="op" id="7380569">:=</span>&nbsp;<span class="ident" id="7380572">net</span><span class="op" id="7380575">.</span><span class="ident" id="7380576">Pipe</span><span class="op" id="7380580">(</span><span class="op" id="7380581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380584">defer</span>&nbsp;<span class="ident" id="7380590">cli</span><span class="op" id="7380593">.</span><span class="ident" id="7380594">Close</span><span class="op" id="7380599">(</span><span class="op" id="7380600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380603">go</span>&nbsp;<span class="ident" id="7380606">ServeConn</span><span class="op" id="7380615">(</span><span class="ident" id="7380616">srv</span><span class="op" id="7380619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380622">dec</span>&nbsp;<span class="op" id="7380626">:=</span>&nbsp;<span class="ident" id="7380629">json</span><span class="op" id="7380633">.</span><span class="ident" id="7380634">NewDecoder</span><span class="op" id="7380644">(</span><span class="ident" id="7380645">cli</span><span class="op" id="7380648">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7380652">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380709">for</span>&nbsp;<span class="ident" id="7380713">i</span>&nbsp;<span class="op" id="7380715">:=</span>&nbsp;<span class="num" id="7380718">0</span><span class="op" id="7380719">;</span>&nbsp;<span class="ident" id="7380721">i</span>&nbsp;<span class="op" id="7380723">&lt;</span>&nbsp;<span class="num" id="7380725">10</span><span class="op" id="7380727">;</span>&nbsp;<span class="ident" id="7380729">i</span><span class="op" id="7380730">++</span>&nbsp;<span class="op" id="7380733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380737">fmt</span><span class="op" id="7380740">.</span><span class="ident" id="7380741">Fprintf</span><span class="op" id="7380748">(</span><span class="ident" id="7380749">cli</span><span class="op" id="7380752">,</span>&nbsp;<span class="string" id="7380754">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="7380827">,</span>&nbsp;<span class="ident" id="7380829">i</span><span class="op" id="7380830">,</span>&nbsp;<span class="ident" id="7380832">i</span><span class="op" id="7380833">,</span>&nbsp;<span class="ident" id="7380835">i</span><span class="op" id="7380836">+</span><span class="num" id="7380837">1</span><span class="op" id="7380838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380842">var</span>&nbsp;<span class="ident" id="7380846">resp</span>&nbsp;<span class="ident" id="7380851">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380866">err</span>&nbsp;<span class="op" id="7380870">:=</span>&nbsp;<span class="ident" id="7380873">dec</span><span class="op" id="7380876">.</span><span class="ident" id="7380877">Decode</span><span class="op" id="7380883">(</span><span class="op" id="7380884">&amp;</span><span class="ident" id="7380885">resp</span><span class="op" id="7380889">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380893">if</span>&nbsp;<span class="ident" id="7380896">err</span>&nbsp;<span class="op" id="7380900">!=</span>&nbsp;<span class="ident" id="7380903">nil</span>&nbsp;<span class="op" id="7380907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380912">t</span><span class="op" id="7380913">.</span><span class="ident" id="7380914">Fatalf</span><span class="op" id="7380920">(</span><span class="string" id="7380921">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="7380933">,</span>&nbsp;<span class="ident" id="7380935">err</span><span class="op" id="7380938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7380942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7380946">if</span>&nbsp;<span class="ident" id="7380949">resp</span><span class="op" id="7380953">.</span><span class="ident" id="7380954">Error</span>&nbsp;<span class="op" id="7380960">!=</span>&nbsp;<span class="ident" id="7380963">nil</span>&nbsp;<span class="op" id="7380967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7380972">t</span><span class="op" id="7380973">.</span><span class="ident" id="7380974">Fatalf</span><span class="op" id="7380980">(</span><span class="string" id="7380981">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="7380997">,</span>&nbsp;<span class="ident" id="7380999">resp</span><span class="op" id="7381003">.</span><span class="ident" id="7381004">Error</span><span class="op" id="7381009">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381017">if</span>&nbsp;<span class="ident" id="7381020">resp</span><span class="op" id="7381024">.</span><span class="ident" id="7381025">Id</span><span class="op" id="7381027">.</span><span class="op" id="7381028">(</span><span class="builtintype" id="7381029">string</span><span class="op" id="7381035">)</span>&nbsp;<span class="op" id="7381037">!=</span>&nbsp;<span class="builtintype" id="7381040">string</span><span class="op" id="7381046">(</span><span class="ident" id="7381047">i</span><span class="op" id="7381048">)</span>&nbsp;<span class="op" id="7381050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381055">t</span><span class="op" id="7381056">.</span><span class="ident" id="7381057">Fatalf</span><span class="op" id="7381063">(</span><span class="string" id="7381064">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7381089">,</span>&nbsp;<span class="ident" id="7381091">resp</span><span class="op" id="7381095">.</span><span class="ident" id="7381096">Id</span><span class="op" id="7381098">.</span><span class="op" id="7381099">(</span><span class="builtintype" id="7381100">string</span><span class="op" id="7381106">)</span><span class="op" id="7381107">,</span>&nbsp;<span class="builtintype" id="7381109">string</span><span class="op" id="7381115">(</span><span class="ident" id="7381116">i</span><span class="op" id="7381117">)</span><span class="op" id="7381118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381126">if</span>&nbsp;<span class="ident" id="7381129">resp</span><span class="op" id="7381133">.</span><span class="ident" id="7381134">Result</span><span class="op" id="7381140">.</span><span class="ident" id="7381141">C</span>&nbsp;<span class="op" id="7381143">!=</span>&nbsp;<span class="num" id="7381146">2</span><span class="op" id="7381147">*</span><span class="ident" id="7381148">i</span><span class="op" id="7381149">+</span><span class="num" id="7381150">1</span>&nbsp;<span class="op" id="7381152">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381157">t</span><span class="op" id="7381158">.</span><span class="ident" id="7381159">Fatalf</span><span class="op" id="7381165">(</span><span class="string" id="7381166">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="7381194">,</span>&nbsp;<span class="ident" id="7381196">i</span><span class="op" id="7381197">,</span>&nbsp;<span class="ident" id="7381199">i</span><span class="op" id="7381200">+</span><span class="num" id="7381201">1</span><span class="op" id="7381202">,</span>&nbsp;<span class="ident" id="7381204">resp</span><span class="op" id="7381208">.</span><span class="ident" id="7381209">Result</span><span class="op" id="7381215">.</span><span class="ident" id="7381216">C</span><span class="op" id="7381217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381224">}</span><br>
<span class="lineno"></span><span class="op" id="7381226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7381229">func</span>&nbsp;<span class="ident" id="7381234">TestClient</span><span class="op" id="7381244">(</span><span class="ident" id="7381245">t</span>&nbsp;<span class="op" id="7381247">*</span><span class="ident" id="7381248">testing</span><span class="op" id="7381255">.</span><span class="ident" id="7381256">T</span><span class="op" id="7381257">)</span>&nbsp;<span class="op" id="7381259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7381262">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7381311">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381343">cli</span><span class="op" id="7381346">,</span>&nbsp;<span class="ident" id="7381348">srv</span>&nbsp;<span class="op" id="7381352">:=</span>&nbsp;<span class="ident" id="7381355">net</span><span class="op" id="7381358">.</span><span class="ident" id="7381359">Pipe</span><span class="op" id="7381363">(</span><span class="op" id="7381364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381367">go</span>&nbsp;<span class="ident" id="7381370">ServeConn</span><span class="op" id="7381379">(</span><span class="ident" id="7381380">srv</span><span class="op" id="7381383">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381387">client</span>&nbsp;<span class="op" id="7381394">:=</span>&nbsp;<span class="ident" id="7381397">NewClient</span><span class="op" id="7381406">(</span><span class="ident" id="7381407">cli</span><span class="op" id="7381410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381413">defer</span>&nbsp;<span class="ident" id="7381419">client</span><span class="op" id="7381425">.</span><span class="ident" id="7381426">Close</span><span class="op" id="7381431">(</span><span class="op" id="7381432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7381436">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381458">args</span>&nbsp;<span class="op" id="7381463">:=</span>&nbsp;<span class="op" id="7381466">&amp;</span><span class="ident" id="7381467">Args</span><span class="op" id="7381471">{</span><span class="num" id="7381472">7</span><span class="op" id="7381473">,</span>&nbsp;<span class="num" id="7381475">8</span><span class="op" id="7381476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381479">reply</span>&nbsp;<span class="op" id="7381485">:=</span>&nbsp;<span class="builtinfunc" id="7381488">new</span><span class="op" id="7381491">(</span><span class="ident" id="7381492">Reply</span><span class="op" id="7381497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381500">err</span>&nbsp;<span class="op" id="7381504">:=</span>&nbsp;<span class="ident" id="7381507">client</span><span class="op" id="7381513">.</span><span class="ident" id="7381514">Call</span><span class="op" id="7381518">(</span><span class="string" id="7381519">&#34;Arith.Add&#34;</span><span class="op" id="7381530">,</span>&nbsp;<span class="ident" id="7381532">args</span><span class="op" id="7381536">,</span>&nbsp;<span class="ident" id="7381538">reply</span><span class="op" id="7381543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381546">if</span>&nbsp;<span class="ident" id="7381549">err</span>&nbsp;<span class="op" id="7381553">!=</span>&nbsp;<span class="ident" id="7381556">nil</span>&nbsp;<span class="op" id="7381560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381564">t</span><span class="op" id="7381565">.</span><span class="ident" id="7381566">Errorf</span><span class="op" id="7381572">(</span><span class="string" id="7381573">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7381615">,</span>&nbsp;<span class="ident" id="7381617">err</span><span class="op" id="7381620">.</span><span class="ident" id="7381621">Error</span><span class="op" id="7381626">(</span><span class="op" id="7381627">)</span><span class="op" id="7381628">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381634">if</span>&nbsp;<span class="ident" id="7381637">reply</span><span class="op" id="7381642">.</span><span class="ident" id="7381643">C</span>&nbsp;<span class="op" id="7381645">!=</span>&nbsp;<span class="ident" id="7381648">args</span><span class="op" id="7381652">.</span><span class="ident" id="7381653">A</span><span class="op" id="7381654">+</span><span class="ident" id="7381655">args</span><span class="op" id="7381659">.</span><span class="ident" id="7381660">B</span>&nbsp;<span class="op" id="7381662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381666">t</span><span class="op" id="7381667">.</span><span class="ident" id="7381668">Errorf</span><span class="op" id="7381674">(</span><span class="string" id="7381675">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7381700">,</span>&nbsp;<span class="ident" id="7381702">reply</span><span class="op" id="7381707">.</span><span class="ident" id="7381708">C</span><span class="op" id="7381709">,</span>&nbsp;<span class="ident" id="7381711">args</span><span class="op" id="7381715">.</span><span class="ident" id="7381716">A</span><span class="op" id="7381717">+</span><span class="ident" id="7381718">args</span><span class="op" id="7381722">.</span><span class="ident" id="7381723">B</span><span class="op" id="7381724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381731">args</span>&nbsp;<span class="op" id="7381736">=</span>&nbsp;<span class="op" id="7381738">&amp;</span><span class="ident" id="7381739">Args</span><span class="op" id="7381743">{</span><span class="num" id="7381744">7</span><span class="op" id="7381745">,</span>&nbsp;<span class="num" id="7381747">8</span><span class="op" id="7381748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381751">reply</span>&nbsp;<span class="op" id="7381757">=</span>&nbsp;<span class="builtinfunc" id="7381759">new</span><span class="op" id="7381762">(</span><span class="ident" id="7381763">Reply</span><span class="op" id="7381768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381771">err</span>&nbsp;<span class="op" id="7381775">=</span>&nbsp;<span class="ident" id="7381777">client</span><span class="op" id="7381783">.</span><span class="ident" id="7381784">Call</span><span class="op" id="7381788">(</span><span class="string" id="7381789">&#34;Arith.Mul&#34;</span><span class="op" id="7381800">,</span>&nbsp;<span class="ident" id="7381802">args</span><span class="op" id="7381806">,</span>&nbsp;<span class="ident" id="7381808">reply</span><span class="op" id="7381813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381816">if</span>&nbsp;<span class="ident" id="7381819">err</span>&nbsp;<span class="op" id="7381823">!=</span>&nbsp;<span class="ident" id="7381826">nil</span>&nbsp;<span class="op" id="7381830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381834">t</span><span class="op" id="7381835">.</span><span class="ident" id="7381836">Errorf</span><span class="op" id="7381842">(</span><span class="string" id="7381843">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7381885">,</span>&nbsp;<span class="ident" id="7381887">err</span><span class="op" id="7381890">.</span><span class="ident" id="7381891">Error</span><span class="op" id="7381896">(</span><span class="op" id="7381897">)</span><span class="op" id="7381898">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7381904">if</span>&nbsp;<span class="ident" id="7381907">reply</span><span class="op" id="7381912">.</span><span class="ident" id="7381913">C</span>&nbsp;<span class="op" id="7381915">!=</span>&nbsp;<span class="ident" id="7381918">args</span><span class="op" id="7381922">.</span><span class="ident" id="7381923">A</span><span class="op" id="7381924">*</span><span class="ident" id="7381925">args</span><span class="op" id="7381929">.</span><span class="ident" id="7381930">B</span>&nbsp;<span class="op" id="7381932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7381936">t</span><span class="op" id="7381937">.</span><span class="ident" id="7381938">Errorf</span><span class="op" id="7381944">(</span><span class="string" id="7381945">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7381970">,</span>&nbsp;<span class="ident" id="7381972">reply</span><span class="op" id="7381977">.</span><span class="ident" id="7381978">C</span><span class="op" id="7381979">,</span>&nbsp;<span class="ident" id="7381981">args</span><span class="op" id="7381985">.</span><span class="ident" id="7381986">A</span><span class="op" id="7381987">*</span><span class="ident" id="7381988">args</span><span class="op" id="7381992">.</span><span class="ident" id="7381993">B</span><span class="op" id="7381994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7381997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7382001">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382019">args</span>&nbsp;<span class="op" id="7382024">=</span>&nbsp;<span class="op" id="7382026">&amp;</span><span class="ident" id="7382027">Args</span><span class="op" id="7382031">{</span><span class="num" id="7382032">7</span><span class="op" id="7382033">,</span>&nbsp;<span class="num" id="7382035">8</span><span class="op" id="7382036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382039">mulReply</span>&nbsp;<span class="op" id="7382048">:=</span>&nbsp;<span class="builtinfunc" id="7382051">new</span><span class="op" id="7382054">(</span><span class="ident" id="7382055">Reply</span><span class="op" id="7382060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382063">mulCall</span>&nbsp;<span class="op" id="7382071">:=</span>&nbsp;<span class="ident" id="7382074">client</span><span class="op" id="7382080">.</span><span class="ident" id="7382081">Go</span><span class="op" id="7382083">(</span><span class="string" id="7382084">&#34;Arith.Mul&#34;</span><span class="op" id="7382095">,</span>&nbsp;<span class="ident" id="7382097">args</span><span class="op" id="7382101">,</span>&nbsp;<span class="ident" id="7382103">mulReply</span><span class="op" id="7382111">,</span>&nbsp;<span class="ident" id="7382113">nil</span><span class="op" id="7382116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382119">addReply</span>&nbsp;<span class="op" id="7382128">:=</span>&nbsp;<span class="builtinfunc" id="7382131">new</span><span class="op" id="7382134">(</span><span class="ident" id="7382135">Reply</span><span class="op" id="7382140">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382143">addCall</span>&nbsp;<span class="op" id="7382151">:=</span>&nbsp;<span class="ident" id="7382154">client</span><span class="op" id="7382160">.</span><span class="ident" id="7382161">Go</span><span class="op" id="7382163">(</span><span class="string" id="7382164">&#34;Arith.Add&#34;</span><span class="op" id="7382175">,</span>&nbsp;<span class="ident" id="7382177">args</span><span class="op" id="7382181">,</span>&nbsp;<span class="ident" id="7382183">addReply</span><span class="op" id="7382191">,</span>&nbsp;<span class="ident" id="7382193">nil</span><span class="op" id="7382196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382200">addCall</span>&nbsp;<span class="op" id="7382208">=</span>&nbsp;<span class="op" id="7382210">&lt;-</span><span class="ident" id="7382212">addCall</span><span class="op" id="7382219">.</span><span class="ident" id="7382220">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382226">if</span>&nbsp;<span class="ident" id="7382229">addCall</span><span class="op" id="7382236">.</span><span class="ident" id="7382237">Error</span>&nbsp;<span class="op" id="7382243">!=</span>&nbsp;<span class="ident" id="7382246">nil</span>&nbsp;<span class="op" id="7382250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382254">t</span><span class="op" id="7382255">.</span><span class="ident" id="7382256">Errorf</span><span class="op" id="7382262">(</span><span class="string" id="7382263">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7382305">,</span>&nbsp;<span class="ident" id="7382307">addCall</span><span class="op" id="7382314">.</span><span class="ident" id="7382315">Error</span><span class="op" id="7382320">.</span><span class="ident" id="7382321">Error</span><span class="op" id="7382326">(</span><span class="op" id="7382327">)</span><span class="op" id="7382328">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382334">if</span>&nbsp;<span class="ident" id="7382337">addReply</span><span class="op" id="7382345">.</span><span class="ident" id="7382346">C</span>&nbsp;<span class="op" id="7382348">!=</span>&nbsp;<span class="ident" id="7382351">args</span><span class="op" id="7382355">.</span><span class="ident" id="7382356">A</span><span class="op" id="7382357">+</span><span class="ident" id="7382358">args</span><span class="op" id="7382362">.</span><span class="ident" id="7382363">B</span>&nbsp;<span class="op" id="7382365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382369">t</span><span class="op" id="7382370">.</span><span class="ident" id="7382371">Errorf</span><span class="op" id="7382377">(</span><span class="string" id="7382378">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7382403">,</span>&nbsp;<span class="ident" id="7382405">addReply</span><span class="op" id="7382413">.</span><span class="ident" id="7382414">C</span><span class="op" id="7382415">,</span>&nbsp;<span class="ident" id="7382417">args</span><span class="op" id="7382421">.</span><span class="ident" id="7382422">A</span><span class="op" id="7382423">+</span><span class="ident" id="7382424">args</span><span class="op" id="7382428">.</span><span class="ident" id="7382429">B</span><span class="op" id="7382430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382437">mulCall</span>&nbsp;<span class="op" id="7382445">=</span>&nbsp;<span class="op" id="7382447">&lt;-</span><span class="ident" id="7382449">mulCall</span><span class="op" id="7382456">.</span><span class="ident" id="7382457">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382463">if</span>&nbsp;<span class="ident" id="7382466">mulCall</span><span class="op" id="7382473">.</span><span class="ident" id="7382474">Error</span>&nbsp;<span class="op" id="7382480">!=</span>&nbsp;<span class="ident" id="7382483">nil</span>&nbsp;<span class="op" id="7382487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382491">t</span><span class="op" id="7382492">.</span><span class="ident" id="7382493">Errorf</span><span class="op" id="7382499">(</span><span class="string" id="7382500">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7382542">,</span>&nbsp;<span class="ident" id="7382544">mulCall</span><span class="op" id="7382551">.</span><span class="ident" id="7382552">Error</span><span class="op" id="7382557">.</span><span class="ident" id="7382558">Error</span><span class="op" id="7382563">(</span><span class="op" id="7382564">)</span><span class="op" id="7382565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382571">if</span>&nbsp;<span class="ident" id="7382574">mulReply</span><span class="op" id="7382582">.</span><span class="ident" id="7382583">C</span>&nbsp;<span class="op" id="7382585">!=</span>&nbsp;<span class="ident" id="7382588">args</span><span class="op" id="7382592">.</span><span class="ident" id="7382593">A</span><span class="op" id="7382594">*</span><span class="ident" id="7382595">args</span><span class="op" id="7382599">.</span><span class="ident" id="7382600">B</span>&nbsp;<span class="op" id="7382602">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382606">t</span><span class="op" id="7382607">.</span><span class="ident" id="7382608">Errorf</span><span class="op" id="7382614">(</span><span class="string" id="7382615">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7382640">,</span>&nbsp;<span class="ident" id="7382642">mulReply</span><span class="op" id="7382650">.</span><span class="ident" id="7382651">C</span><span class="op" id="7382652">,</span>&nbsp;<span class="ident" id="7382654">args</span><span class="op" id="7382658">.</span><span class="ident" id="7382659">A</span><span class="op" id="7382660">*</span><span class="ident" id="7382661">args</span><span class="op" id="7382665">.</span><span class="ident" id="7382666">B</span><span class="op" id="7382667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7382674">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382689">args</span>&nbsp;<span class="op" id="7382694">=</span>&nbsp;<span class="op" id="7382696">&amp;</span><span class="ident" id="7382697">Args</span><span class="op" id="7382701">{</span><span class="num" id="7382702">7</span><span class="op" id="7382703">,</span>&nbsp;<span class="num" id="7382705">0</span><span class="op" id="7382706">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382709">reply</span>&nbsp;<span class="op" id="7382715">=</span>&nbsp;<span class="builtinfunc" id="7382717">new</span><span class="op" id="7382720">(</span><span class="ident" id="7382721">Reply</span><span class="op" id="7382726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382729">err</span>&nbsp;<span class="op" id="7382733">=</span>&nbsp;<span class="ident" id="7382735">client</span><span class="op" id="7382741">.</span><span class="ident" id="7382742">Call</span><span class="op" id="7382746">(</span><span class="string" id="7382747">&#34;Arith.Div&#34;</span><span class="op" id="7382758">,</span>&nbsp;<span class="ident" id="7382760">args</span><span class="op" id="7382764">,</span>&nbsp;<span class="ident" id="7382766">reply</span><span class="op" id="7382771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7382774">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7382807">if</span>&nbsp;<span class="ident" id="7382810">err</span>&nbsp;<span class="op" id="7382814">==</span>&nbsp;<span class="ident" id="7382817">nil</span>&nbsp;<span class="op" id="7382821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382825">t</span><span class="op" id="7382826">.</span><span class="ident" id="7382827">Error</span><span class="op" id="7382832">(</span><span class="string" id="7382833">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7382854">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382857">}</span>&nbsp;<span class="keyword" id="7382859">else</span>&nbsp;<span class="keyword" id="7382864">if</span>&nbsp;<span class="ident" id="7382867">err</span><span class="op" id="7382870">.</span><span class="ident" id="7382871">Error</span><span class="op" id="7382876">(</span><span class="op" id="7382877">)</span>&nbsp;<span class="op" id="7382879">!=</span>&nbsp;<span class="string" id="7382882">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7382899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7382903">t</span><span class="op" id="7382904">.</span><span class="ident" id="7382905">Error</span><span class="op" id="7382910">(</span><span class="string" id="7382911">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7382952">,</span>&nbsp;<span class="ident" id="7382954">err</span><span class="op" id="7382957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7382960">}</span><br>
<span class="lineno"></span><span class="op" id="7382962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="7382965">func</span>&nbsp;<span class="ident" id="7382970">TestMalformedInput</span><span class="op" id="7382988">(</span><span class="ident" id="7382989">t</span>&nbsp;<span class="op" id="7382991">*</span><span class="ident" id="7382992">testing</span><span class="op" id="7382999">.</span><span class="ident" id="7383000">T</span><span class="op" id="7383001">)</span>&nbsp;<span class="op" id="7383003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383006">cli</span><span class="op" id="7383009">,</span>&nbsp;<span class="ident" id="7383011">srv</span>&nbsp;<span class="op" id="7383015">:=</span>&nbsp;<span class="ident" id="7383018">net</span><span class="op" id="7383021">.</span><span class="ident" id="7383022">Pipe</span><span class="op" id="7383026">(</span><span class="op" id="7383027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383030">go</span>&nbsp;<span class="ident" id="7383033">cli</span><span class="op" id="7383036">.</span><span class="ident" id="7383037">Write</span><span class="op" id="7383042">(</span><span class="op" id="7383043">[</span><span class="op" id="7383044">]</span><span class="builtintype" id="7383045">byte</span><span class="op" id="7383049">(</span><span class="string" id="7383050">`{id:1}`</span><span class="op" id="7383058">)</span><span class="op" id="7383059">)</span>&nbsp;<span class="comment" id="7383061">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383078">ServeConn</span><span class="op" id="7383087">(</span><span class="ident" id="7383088">srv</span><span class="op" id="7383091">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7383109">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7383134">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7383137">func</span>&nbsp;<span class="ident" id="7383142">TestMalformedOutput</span><span class="op" id="7383161">(</span><span class="ident" id="7383162">t</span>&nbsp;<span class="op" id="7383164">*</span><span class="ident" id="7383165">testing</span><span class="op" id="7383172">.</span><span class="ident" id="7383173">T</span><span class="op" id="7383174">)</span>&nbsp;<span class="op" id="7383176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383179">cli</span><span class="op" id="7383182">,</span>&nbsp;<span class="ident" id="7383184">srv</span>&nbsp;<span class="op" id="7383188">:=</span>&nbsp;<span class="ident" id="7383191">net</span><span class="op" id="7383194">.</span><span class="ident" id="7383195">Pipe</span><span class="op" id="7383199">(</span><span class="op" id="7383200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383203">go</span>&nbsp;<span class="ident" id="7383206">srv</span><span class="op" id="7383209">.</span><span class="ident" id="7383210">Write</span><span class="op" id="7383215">(</span><span class="op" id="7383216">[</span><span class="op" id="7383217">]</span><span class="builtintype" id="7383218">byte</span><span class="op" id="7383222">(</span><span class="string" id="7383223">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="7383260">)</span><span class="op" id="7383261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383264">go</span>&nbsp;<span class="ident" id="7383267">ioutil</span><span class="op" id="7383273">.</span><span class="ident" id="7383274">ReadAll</span><span class="op" id="7383281">(</span><span class="ident" id="7383282">srv</span><span class="op" id="7383285">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383289">client</span>&nbsp;<span class="op" id="7383296">:=</span>&nbsp;<span class="ident" id="7383299">NewClient</span><span class="op" id="7383308">(</span><span class="ident" id="7383309">cli</span><span class="op" id="7383312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383315">defer</span>&nbsp;<span class="ident" id="7383321">client</span><span class="op" id="7383327">.</span><span class="ident" id="7383328">Close</span><span class="op" id="7383333">(</span><span class="op" id="7383334">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383338">args</span>&nbsp;<span class="op" id="7383343">:=</span>&nbsp;<span class="op" id="7383346">&amp;</span><span class="ident" id="7383347">Args</span><span class="op" id="7383351">{</span><span class="num" id="7383352">7</span><span class="op" id="7383353">,</span>&nbsp;<span class="num" id="7383355">8</span><span class="op" id="7383356">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383359">reply</span>&nbsp;<span class="op" id="7383365">:=</span>&nbsp;<span class="builtinfunc" id="7383368">new</span><span class="op" id="7383371">(</span><span class="ident" id="7383372">Reply</span><span class="op" id="7383377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383380">err</span>&nbsp;<span class="op" id="7383384">:=</span>&nbsp;<span class="ident" id="7383387">client</span><span class="op" id="7383393">.</span><span class="ident" id="7383394">Call</span><span class="op" id="7383398">(</span><span class="string" id="7383399">&#34;Arith.Add&#34;</span><span class="op" id="7383410">,</span>&nbsp;<span class="ident" id="7383412">args</span><span class="op" id="7383416">,</span>&nbsp;<span class="ident" id="7383418">reply</span><span class="op" id="7383423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383426">if</span>&nbsp;<span class="ident" id="7383429">err</span>&nbsp;<span class="op" id="7383433">==</span>&nbsp;<span class="ident" id="7383436">nil</span>&nbsp;<span class="op" id="7383440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383444">t</span><span class="op" id="7383445">.</span><span class="ident" id="7383446">Error</span><span class="op" id="7383451">(</span><span class="string" id="7383452">&#34;expected&nbsp;error&#34;</span><span class="op" id="7383468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383471">}</span><br>
<span class="lineno">205</span><span class="op" id="7383473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7383476">func</span>&nbsp;<span class="ident" id="7383481">TestServerErrorHasNullResult</span><span class="op" id="7383509">(</span><span class="ident" id="7383510">t</span>&nbsp;<span class="op" id="7383512">*</span><span class="ident" id="7383513">testing</span><span class="op" id="7383520">.</span><span class="ident" id="7383521">T</span><span class="op" id="7383522">)</span>&nbsp;<span class="op" id="7383524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383527">var</span>&nbsp;<span class="ident" id="7383531">out</span>&nbsp;<span class="ident" id="7383535">bytes</span><span class="op" id="7383540">.</span><span class="ident" id="7383541">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383549">sc</span>&nbsp;<span class="op" id="7383552">:=</span>&nbsp;<span class="ident" id="7383555">NewServerCodec</span><span class="op" id="7383569">(</span><span class="keyword" id="7383570">struct</span>&nbsp;<span class="op" id="7383577">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383581">io</span><span class="op" id="7383583">.</span><span class="ident" id="7383584">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383593">io</span><span class="op" id="7383595">.</span><span class="ident" id="7383596">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383605">io</span><span class="op" id="7383607">.</span><span class="ident" id="7383608">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383616">}</span><span class="op" id="7383617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383621">Reader</span><span class="op" id="7383627">:</span>&nbsp;<span class="ident" id="7383629">strings</span><span class="op" id="7383636">.</span><span class="ident" id="7383637">NewReader</span><span class="op" id="7383646">(</span><span class="string" id="7383647">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="7383699">)</span><span class="op" id="7383700">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383704">Writer</span><span class="op" id="7383710">:</span>&nbsp;<span class="op" id="7383712">&amp;</span><span class="ident" id="7383713">out</span><span class="op" id="7383716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383720">Closer</span><span class="op" id="7383726">:</span>&nbsp;<span class="ident" id="7383728">ioutil</span><span class="op" id="7383734">.</span><span class="ident" id="7383735">NopCloser</span><span class="op" id="7383744">(</span><span class="ident" id="7383745">nil</span><span class="op" id="7383748">)</span><span class="op" id="7383749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383752">}</span><span class="op" id="7383753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383756">r</span>&nbsp;<span class="op" id="7383758">:=</span>&nbsp;<span class="builtinfunc" id="7383761">new</span><span class="op" id="7383764">(</span><span class="ident" id="7383765">rpc</span><span class="op" id="7383768">.</span><span class="ident" id="7383769">Request</span><span class="op" id="7383776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383779">if</span>&nbsp;<span class="ident" id="7383782">err</span>&nbsp;<span class="op" id="7383786">:=</span>&nbsp;<span class="ident" id="7383789">sc</span><span class="op" id="7383791">.</span><span class="ident" id="7383792">ReadRequestHeader</span><span class="op" id="7383809">(</span><span class="ident" id="7383810">r</span><span class="op" id="7383811">)</span><span class="op" id="7383812">;</span>&nbsp;<span class="ident" id="7383814">err</span>&nbsp;<span class="op" id="7383818">!=</span>&nbsp;<span class="ident" id="7383821">nil</span>&nbsp;<span class="op" id="7383825">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383829">t</span><span class="op" id="7383830">.</span><span class="ident" id="7383831">Fatal</span><span class="op" id="7383836">(</span><span class="ident" id="7383837">err</span><span class="op" id="7383840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7383843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383846">const</span>&nbsp;<span class="ident" id="7383852">valueText</span>&nbsp;<span class="op" id="7383862">=</span>&nbsp;<span class="string" id="7383864">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7383898">const</span>&nbsp;<span class="ident" id="7383904">errorText</span>&nbsp;<span class="op" id="7383914">=</span>&nbsp;<span class="string" id="7383916">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383930">err</span>&nbsp;<span class="op" id="7383934">:=</span>&nbsp;<span class="ident" id="7383937">sc</span><span class="op" id="7383939">.</span><span class="ident" id="7383940">WriteResponse</span><span class="op" id="7383953">(</span><span class="op" id="7383954">&amp;</span><span class="ident" id="7383955">rpc</span><span class="op" id="7383958">.</span><span class="ident" id="7383959">Response</span><span class="op" id="7383967">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383971">ServiceMethod</span><span class="op" id="7383984">:</span>&nbsp;<span class="string" id="7383986">&#34;Method&#34;</span><span class="op" id="7383994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7383998">Seq</span><span class="op" id="7384001">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7384013">1</span><span class="op" id="7384014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384018">Error</span><span class="op" id="7384023">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7384033">errorText</span><span class="op" id="7384042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384045">}</span><span class="op" id="7384046">,</span>&nbsp;<span class="ident" id="7384048">valueText</span><span class="op" id="7384057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384060">if</span>&nbsp;<span class="ident" id="7384063">err</span>&nbsp;<span class="op" id="7384067">!=</span>&nbsp;<span class="ident" id="7384070">nil</span>&nbsp;<span class="op" id="7384074">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384078">t</span><span class="op" id="7384079">.</span><span class="ident" id="7384080">Fatal</span><span class="op" id="7384085">(</span><span class="ident" id="7384086">err</span><span class="op" id="7384089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384095">if</span>&nbsp;<span class="op" id="7384098">!</span><span class="ident" id="7384099">strings</span><span class="op" id="7384106">.</span><span class="ident" id="7384107">Contains</span><span class="op" id="7384115">(</span><span class="ident" id="7384116">out</span><span class="op" id="7384119">.</span><span class="ident" id="7384120">String</span><span class="op" id="7384126">(</span><span class="op" id="7384127">)</span><span class="op" id="7384128">,</span>&nbsp;<span class="ident" id="7384130">errorText</span><span class="op" id="7384139">)</span>&nbsp;<span class="op" id="7384141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384145">t</span><span class="op" id="7384146">.</span><span class="ident" id="7384147">Fatalf</span><span class="op" id="7384153">(</span><span class="string" id="7384154">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="7384201">,</span>&nbsp;<span class="ident" id="7384203">errorText</span><span class="op" id="7384212">,</span>&nbsp;<span class="op" id="7384214">&amp;</span><span class="ident" id="7384215">out</span><span class="op" id="7384218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384221">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384224">if</span>&nbsp;<span class="ident" id="7384227">strings</span><span class="op" id="7384234">.</span><span class="ident" id="7384235">Contains</span><span class="op" id="7384243">(</span><span class="ident" id="7384244">out</span><span class="op" id="7384247">.</span><span class="ident" id="7384248">String</span><span class="op" id="7384254">(</span><span class="op" id="7384255">)</span><span class="op" id="7384256">,</span>&nbsp;<span class="ident" id="7384258">valueText</span><span class="op" id="7384267">)</span>&nbsp;<span class="op" id="7384269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384273">t</span><span class="op" id="7384274">.</span><span class="ident" id="7384275">Errorf</span><span class="op" id="7384281">(</span><span class="string" id="7384282">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="7384329">,</span>&nbsp;<span class="op" id="7384331">&amp;</span><span class="ident" id="7384332">out</span><span class="op" id="7384335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384338">}</span><br>
<span class="lineno"></span><span class="op" id="7384340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7384343">func</span>&nbsp;<span class="ident" id="7384348">TestUnexpectedError</span><span class="op" id="7384367">(</span><span class="ident" id="7384368">t</span>&nbsp;<span class="op" id="7384370">*</span><span class="ident" id="7384371">testing</span><span class="op" id="7384378">.</span><span class="ident" id="7384379">T</span><span class="op" id="7384380">)</span>&nbsp;<span class="op" id="7384382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384385">cli</span><span class="op" id="7384388">,</span>&nbsp;<span class="ident" id="7384390">srv</span>&nbsp;<span class="op" id="7384394">:=</span>&nbsp;<span class="ident" id="7384397">myPipe</span><span class="op" id="7384403">(</span><span class="op" id="7384404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384407">go</span>&nbsp;<span class="ident" id="7384410">cli</span><span class="op" id="7384413">.</span><span class="ident" id="7384414">PipeWriter</span><span class="op" id="7384424">.</span><span class="ident" id="7384425">CloseWithError</span><span class="op" id="7384439">(</span><span class="ident" id="7384440">errors</span><span class="op" id="7384446">.</span><span class="ident" id="7384447">New</span><span class="op" id="7384450">(</span><span class="string" id="7384451">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="7384470">)</span><span class="op" id="7384471">)</span>&nbsp;<span class="comment" id="7384473">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384504">ServeConn</span><span class="op" id="7384513">(</span><span class="ident" id="7384514">srv</span><span class="op" id="7384517">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7384570">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7384595">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7384598">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="7384626">func</span>&nbsp;<span class="ident" id="7384631">myPipe</span><span class="op" id="7384637">(</span><span class="op" id="7384638">)</span>&nbsp;<span class="op" id="7384640">(</span><span class="op" id="7384641">*</span><span class="ident" id="7384642">pipe</span><span class="op" id="7384646">,</span>&nbsp;<span class="op" id="7384648">*</span><span class="ident" id="7384649">pipe</span><span class="op" id="7384653">)</span>&nbsp;<span class="op" id="7384655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384658">r1</span><span class="op" id="7384660">,</span>&nbsp;<span class="ident" id="7384662">w1</span>&nbsp;<span class="op" id="7384665">:=</span>&nbsp;<span class="ident" id="7384668">io</span><span class="op" id="7384670">.</span><span class="ident" id="7384671">Pipe</span><span class="op" id="7384675">(</span><span class="op" id="7384676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384679">r2</span><span class="op" id="7384681">,</span>&nbsp;<span class="ident" id="7384683">w2</span>&nbsp;<span class="op" id="7384686">:=</span>&nbsp;<span class="ident" id="7384689">io</span><span class="op" id="7384691">.</span><span class="ident" id="7384692">Pipe</span><span class="op" id="7384696">(</span><span class="op" id="7384697">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384701">return</span>&nbsp;<span class="op" id="7384708">&amp;</span><span class="ident" id="7384709">pipe</span><span class="op" id="7384713">{</span><span class="ident" id="7384714">r1</span><span class="op" id="7384716">,</span>&nbsp;<span class="ident" id="7384718">w2</span><span class="op" id="7384720">}</span><span class="op" id="7384721">,</span>&nbsp;<span class="op" id="7384723">&amp;</span><span class="ident" id="7384724">pipe</span><span class="op" id="7384728">{</span><span class="ident" id="7384729">r2</span><span class="op" id="7384731">,</span>&nbsp;<span class="ident" id="7384733">w1</span><span class="op" id="7384735">}</span><br>
<span class="lineno"></span><span class="op" id="7384737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7384740">type</span>&nbsp;<span class="ident" id="7384745">pipe</span>&nbsp;<span class="keyword" id="7384750">struct</span>&nbsp;<span class="op" id="7384757">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384760">*</span><span class="ident" id="7384761">io</span><span class="op" id="7384763">.</span><span class="ident" id="7384764">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7384776">*</span><span class="ident" id="7384777">io</span><span class="op" id="7384779">.</span><span class="ident" id="7384780">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="7384791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7384794">type</span>&nbsp;<span class="ident" id="7384799">pipeAddr</span>&nbsp;<span class="builtintype" id="7384808">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="7384813">func</span>&nbsp;<span class="op" id="7384818">(</span><span class="ident" id="7384819">pipeAddr</span><span class="op" id="7384827">)</span>&nbsp;<span class="ident" id="7384829">Network</span><span class="op" id="7384836">(</span><span class="op" id="7384837">)</span>&nbsp;<span class="builtintype" id="7384839">string</span>&nbsp;<span class="op" id="7384846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384849">return</span>&nbsp;<span class="string" id="7384856">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7384863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="7384866">func</span>&nbsp;<span class="op" id="7384871">(</span><span class="ident" id="7384872">pipeAddr</span><span class="op" id="7384880">)</span>&nbsp;<span class="ident" id="7384882">String</span><span class="op" id="7384888">(</span><span class="op" id="7384889">)</span>&nbsp;<span class="builtintype" id="7384891">string</span>&nbsp;<span class="op" id="7384898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7384901">return</span>&nbsp;<span class="string" id="7384908">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7384915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7384918">func</span>&nbsp;<span class="op" id="7384923">(</span><span class="ident" id="7384924">p</span>&nbsp;<span class="op" id="7384926">*</span><span class="ident" id="7384927">pipe</span><span class="op" id="7384931">)</span>&nbsp;<span class="ident" id="7384933">Close</span><span class="op" id="7384938">(</span><span class="op" id="7384939">)</span>&nbsp;<span class="builtintype" id="7384941">error</span>&nbsp;<span class="op" id="7384947">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384950">err</span>&nbsp;<span class="op" id="7384954">:=</span>&nbsp;<span class="ident" id="7384957">p</span><span class="op" id="7384958">.</span><span class="ident" id="7384959">PipeReader</span><span class="op" id="7384969">.</span><span class="ident" id="7384970">Close</span><span class="op" id="7384975">(</span><span class="op" id="7384976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7384979">err1</span>&nbsp;<span class="op" id="7384984">:=</span>&nbsp;<span class="ident" id="7384987">p</span><span class="op" id="7384988">.</span><span class="ident" id="7384989">PipeWriter</span><span class="op" id="7384999">.</span><span class="ident" id="7385000">Close</span><span class="op" id="7385005">(</span><span class="op" id="7385006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385009">if</span>&nbsp;<span class="ident" id="7385012">err</span>&nbsp;<span class="op" id="7385016">==</span>&nbsp;<span class="ident" id="7385019">nil</span>&nbsp;<span class="op" id="7385023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7385027">err</span>&nbsp;<span class="op" id="7385031">=</span>&nbsp;<span class="ident" id="7385033">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7385039">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385042">return</span>&nbsp;<span class="ident" id="7385049">err</span><br>
<span class="lineno"></span><span class="op" id="7385053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7385056">func</span>&nbsp;<span class="op" id="7385061">(</span><span class="ident" id="7385062">p</span>&nbsp;<span class="op" id="7385064">*</span><span class="ident" id="7385065">pipe</span><span class="op" id="7385069">)</span>&nbsp;<span class="ident" id="7385071">LocalAddr</span><span class="op" id="7385080">(</span><span class="op" id="7385081">)</span>&nbsp;<span class="ident" id="7385083">net</span><span class="op" id="7385086">.</span><span class="ident" id="7385087">Addr</span>&nbsp;<span class="op" id="7385092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385095">return</span>&nbsp;<span class="ident" id="7385102">pipeAddr</span><span class="op" id="7385110">(</span><span class="num" id="7385111">0</span><span class="op" id="7385112">)</span><br>
<span class="lineno">280</span><span class="op" id="7385114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7385117">func</span>&nbsp;<span class="op" id="7385122">(</span><span class="ident" id="7385123">p</span>&nbsp;<span class="op" id="7385125">*</span><span class="ident" id="7385126">pipe</span><span class="op" id="7385130">)</span>&nbsp;<span class="ident" id="7385132">RemoteAddr</span><span class="op" id="7385142">(</span><span class="op" id="7385143">)</span>&nbsp;<span class="ident" id="7385145">net</span><span class="op" id="7385148">.</span><span class="ident" id="7385149">Addr</span>&nbsp;<span class="op" id="7385154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385157">return</span>&nbsp;<span class="ident" id="7385164">pipeAddr</span><span class="op" id="7385172">(</span><span class="num" id="7385173">0</span><span class="op" id="7385174">)</span><br>
<span class="lineno"></span><span class="op" id="7385176">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="7385179">func</span>&nbsp;<span class="op" id="7385184">(</span><span class="ident" id="7385185">p</span>&nbsp;<span class="op" id="7385187">*</span><span class="ident" id="7385188">pipe</span><span class="op" id="7385192">)</span>&nbsp;<span class="ident" id="7385194">SetTimeout</span><span class="op" id="7385204">(</span><span class="ident" id="7385205">nsec</span>&nbsp;<span class="ident" id="7385210">int64</span><span class="op" id="7385215">)</span>&nbsp;<span class="builtintype" id="7385217">error</span>&nbsp;<span class="op" id="7385223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385226">return</span>&nbsp;<span class="ident" id="7385233">errors</span><span class="op" id="7385239">.</span><span class="ident" id="7385240">New</span><span class="op" id="7385243">(</span><span class="string" id="7385244">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7385280">)</span><br>
<span class="lineno"></span><span class="op" id="7385282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="7385285">func</span>&nbsp;<span class="op" id="7385290">(</span><span class="ident" id="7385291">p</span>&nbsp;<span class="op" id="7385293">*</span><span class="ident" id="7385294">pipe</span><span class="op" id="7385298">)</span>&nbsp;<span class="ident" id="7385300">SetReadTimeout</span><span class="op" id="7385314">(</span><span class="ident" id="7385315">nsec</span>&nbsp;<span class="ident" id="7385320">int64</span><span class="op" id="7385325">)</span>&nbsp;<span class="builtintype" id="7385327">error</span>&nbsp;<span class="op" id="7385333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385336">return</span>&nbsp;<span class="ident" id="7385343">errors</span><span class="op" id="7385349">.</span><span class="ident" id="7385350">New</span><span class="op" id="7385353">(</span><span class="string" id="7385354">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7385390">)</span><br>
<span class="lineno"></span><span class="op" id="7385392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7385395">func</span>&nbsp;<span class="op" id="7385400">(</span><span class="ident" id="7385401">p</span>&nbsp;<span class="op" id="7385403">*</span><span class="ident" id="7385404">pipe</span><span class="op" id="7385408">)</span>&nbsp;<span class="ident" id="7385410">SetWriteTimeout</span><span class="op" id="7385425">(</span><span class="ident" id="7385426">nsec</span>&nbsp;<span class="ident" id="7385431">int64</span><span class="op" id="7385436">)</span>&nbsp;<span class="builtintype" id="7385438">error</span>&nbsp;<span class="op" id="7385444">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7385447">return</span>&nbsp;<span class="ident" id="7385454">errors</span><span class="op" id="7385460">.</span><span class="ident" id="7385461">New</span><span class="op" id="7385464">(</span><span class="string" id="7385465">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7385501">)</span><br>
<span class="lineno"></span><span class="op" id="7385503">}</span>
</div>
</body>
</html>
