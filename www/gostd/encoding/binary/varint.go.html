<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/binary</h2>
<ul>
<li><a href="/gostd/encoding/binary/binary.go.html">binary.go</a></li>
<li><a href="/gostd/encoding/binary/binary_test.go.html">binary_test.go</a></li>
<li><a href="/gostd/encoding/binary/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/binary/varint.go.html" class="current">varint.go</a></li>
<li><a href="/gostd/encoding/binary/varint_test.go.html">varint_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3699291">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3699347">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3699401">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3699452">package</span>&nbsp;<span class="ident" id="3699460">binary</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3699468">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;&#34;varint&#34;&nbsp;encoding&nbsp;of&nbsp;64-bit&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3699530">//&nbsp;The&nbsp;encoding&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3699550">//&nbsp;-&nbsp;unsigned&nbsp;integers&nbsp;are&nbsp;serialized&nbsp;7&nbsp;bits&nbsp;at&nbsp;a&nbsp;time,&nbsp;starting&nbsp;with&nbsp;the</span><br>
<span class="lineno">10</span><span class="comment" id="3699624">//&nbsp;&nbsp;&nbsp;least&nbsp;significant&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3699652">//&nbsp;-&nbsp;the&nbsp;most&nbsp;significant&nbsp;bit&nbsp;(msb)&nbsp;in&nbsp;each&nbsp;output&nbsp;byte&nbsp;indicates&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="3699727">//&nbsp;&nbsp;&nbsp;is&nbsp;a&nbsp;continuation&nbsp;byte&nbsp;(msb&nbsp;=&nbsp;1)</span><br>
<span class="lineno"></span><span class="comment" id="3699765">//&nbsp;-&nbsp;signed&nbsp;integers&nbsp;are&nbsp;mapped&nbsp;to&nbsp;unsigned&nbsp;integers&nbsp;using&nbsp;&#34;zig-zag&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3699834">//&nbsp;&nbsp;&nbsp;encoding:&nbsp;Positive&nbsp;values&nbsp;x&nbsp;are&nbsp;written&nbsp;as&nbsp;2*x&nbsp;+&nbsp;0,&nbsp;negative&nbsp;values</span><br>
<span class="lineno">15</span><span class="comment" id="3699907">//&nbsp;&nbsp;&nbsp;are&nbsp;written&nbsp;as&nbsp;2*(^x)&nbsp;+&nbsp;1;&nbsp;that&nbsp;is,&nbsp;negative&nbsp;numbers&nbsp;are&nbsp;complemented</span><br>
<span class="lineno"></span><span class="comment" id="3699982">//&nbsp;&nbsp;&nbsp;and&nbsp;whether&nbsp;to&nbsp;complement&nbsp;is&nbsp;encoded&nbsp;in&nbsp;bit&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3700034">//</span><br>
<span class="lineno"></span><span class="comment" id="3700037">//&nbsp;Design&nbsp;note:</span><br>
<span class="lineno"></span><span class="comment" id="3700053">//&nbsp;At&nbsp;most&nbsp;10&nbsp;bytes&nbsp;are&nbsp;needed&nbsp;for&nbsp;64-bit&nbsp;values.&nbsp;The&nbsp;encoding&nbsp;could</span><br>
<span class="lineno">20</span><span class="comment" id="3700122">//&nbsp;be&nbsp;more&nbsp;dense:&nbsp;a&nbsp;full&nbsp;64-bit&nbsp;value&nbsp;needs&nbsp;an&nbsp;extra&nbsp;byte&nbsp;just&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3700201">//&nbsp;Instead,&nbsp;the&nbsp;msb&nbsp;of&nbsp;the&nbsp;previous&nbsp;byte&nbsp;could&nbsp;be&nbsp;used&nbsp;to&nbsp;hold&nbsp;bit&nbsp;63&nbsp;since&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="3700280">//&nbsp;know&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;more&nbsp;than&nbsp;64&nbsp;bits.&nbsp;This&nbsp;is&nbsp;a&nbsp;trivial&nbsp;improvement&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3700356">//&nbsp;would&nbsp;reduce&nbsp;the&nbsp;maximum&nbsp;encoding&nbsp;length&nbsp;to&nbsp;9&nbsp;bytes.&nbsp;However,&nbsp;it&nbsp;breaks&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3700435">//&nbsp;invariant&nbsp;that&nbsp;the&nbsp;msb&nbsp;is&nbsp;always&nbsp;the&nbsp;&#34;continuation&nbsp;bit&#34;&nbsp;and&nbsp;thus&nbsp;makes&nbsp;the</span><br>
<span class="lineno">25</span><span class="comment" id="3700513">//&nbsp;format&nbsp;incompatible&nbsp;with&nbsp;a&nbsp;varint&nbsp;encoding&nbsp;for&nbsp;larger&nbsp;numbers&nbsp;(say&nbsp;128-bit).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3700594">import</span>&nbsp;<span class="op" id="3700601">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3700604">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3700614">&#34;io&#34;</span><br>
<span class="lineno">30</span><span class="op" id="3700619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3700622">//&nbsp;MaxVarintLenN&nbsp;is&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;a&nbsp;varint-encoded&nbsp;N-bit&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="3700696">const</span>&nbsp;<span class="op" id="3700702">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700705">MaxVarintLen16</span>&nbsp;<span class="op" id="3700720">=</span>&nbsp;<span class="num" id="3700722">3</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700725">MaxVarintLen32</span>&nbsp;<span class="op" id="3700740">=</span>&nbsp;<span class="num" id="3700742">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700745">MaxVarintLen64</span>&nbsp;<span class="op" id="3700760">=</span>&nbsp;<span class="num" id="3700762">10</span><br>
<span class="lineno"></span><span class="op" id="3700765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3700768">//&nbsp;PutUvarint&nbsp;encodes&nbsp;a&nbsp;uint64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">40</span><span class="comment" id="3700849">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutUvarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3700903">func</span>&nbsp;<span class="ident" id="3700908">PutUvarint</span><span class="op" id="3700918">(</span><span class="ident" id="3700919">buf</span>&nbsp;<span class="op" id="3700923">[</span><span class="op" id="3700924">]</span><span class="builtintype" id="3700925">byte</span><span class="op" id="3700929">,</span>&nbsp;<span class="ident" id="3700931">x</span>&nbsp;<span class="ident" id="3700933">uint64</span><span class="op" id="3700939">)</span>&nbsp;<span class="builtintype" id="3700941">int</span>&nbsp;<span class="op" id="3700945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700948">i</span>&nbsp;<span class="op" id="3700950">:=</span>&nbsp;<span class="num" id="3700953">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3700956">for</span>&nbsp;<span class="ident" id="3700960">x</span>&nbsp;<span class="op" id="3700962">&gt;=</span>&nbsp;<span class="num" id="3700965">0x80</span>&nbsp;<span class="op" id="3700970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3700974">buf</span><span class="op" id="3700977">[</span><span class="ident" id="3700978">i</span><span class="op" id="3700979">]</span>&nbsp;<span class="op" id="3700981">=</span>&nbsp;<span class="builtintype" id="3700983">byte</span><span class="op" id="3700987">(</span><span class="ident" id="3700988">x</span><span class="op" id="3700989">)</span>&nbsp;<span class="op" id="3700991">|</span>&nbsp;<span class="num" id="3700993">0x80</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701000">x</span>&nbsp;<span class="op" id="3701002">&gt;&gt;=</span>&nbsp;<span class="num" id="3701006">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701010">i</span><span class="op" id="3701011">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701018">buf</span><span class="op" id="3701021">[</span><span class="ident" id="3701022">i</span><span class="op" id="3701023">]</span>&nbsp;<span class="op" id="3701025">=</span>&nbsp;<span class="builtintype" id="3701027">byte</span><span class="op" id="3701031">(</span><span class="ident" id="3701032">x</span><span class="op" id="3701033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701036">return</span>&nbsp;<span class="ident" id="3701043">i</span>&nbsp;<span class="op" id="3701045">+</span>&nbsp;<span class="num" id="3701047">1</span><br>
<span class="lineno">50</span><span class="op" id="3701049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701052">//&nbsp;Uvarint&nbsp;decodes&nbsp;a&nbsp;uint64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3701120">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3701188">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;meaning:</span><br>
<span class="lineno">55</span><span class="comment" id="3701234">//</span><br>
<span class="lineno"></span><span class="comment" id="3701237">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3701262">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3701310">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3701361">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3701364">func</span>&nbsp;<span class="ident" id="3701369">Uvarint</span><span class="op" id="3701376">(</span><span class="ident" id="3701377">buf</span>&nbsp;<span class="op" id="3701381">[</span><span class="op" id="3701382">]</span><span class="builtintype" id="3701383">byte</span><span class="op" id="3701387">)</span>&nbsp;<span class="op" id="3701389">(</span><span class="ident" id="3701390">uint64</span><span class="op" id="3701396">,</span>&nbsp;<span class="builtintype" id="3701398">int</span><span class="op" id="3701401">)</span>&nbsp;<span class="op" id="3701403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701406">var</span>&nbsp;<span class="ident" id="3701410">x</span>&nbsp;<span class="ident" id="3701412">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701420">var</span>&nbsp;<span class="ident" id="3701424">s</span>&nbsp;<span class="builtintype" id="3701426">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701432">for</span>&nbsp;<span class="ident" id="3701436">i</span><span class="op" id="3701437">,</span>&nbsp;<span class="ident" id="3701439">b</span>&nbsp;<span class="op" id="3701441">:=</span>&nbsp;<span class="keyword" id="3701444">range</span>&nbsp;<span class="ident" id="3701450">buf</span>&nbsp;<span class="op" id="3701454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701458">if</span>&nbsp;<span class="ident" id="3701461">b</span>&nbsp;<span class="op" id="3701463">&lt;</span>&nbsp;<span class="num" id="3701465">0x80</span>&nbsp;<span class="op" id="3701470">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701475">if</span>&nbsp;<span class="ident" id="3701478">i</span>&nbsp;<span class="op" id="3701480">&gt;</span>&nbsp;<span class="num" id="3701482">9</span>&nbsp;<span class="op" id="3701484">||</span>&nbsp;<span class="ident" id="3701487">i</span>&nbsp;<span class="op" id="3701489">==</span>&nbsp;<span class="num" id="3701492">9</span>&nbsp;<span class="op" id="3701494">&amp;&amp;</span>&nbsp;<span class="ident" id="3701497">b</span>&nbsp;<span class="op" id="3701499">&gt;</span>&nbsp;<span class="num" id="3701501">1</span>&nbsp;<span class="op" id="3701503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701509">return</span>&nbsp;<span class="num" id="3701516">0</span><span class="op" id="3701517">,</span>&nbsp;<span class="op" id="3701519">-</span><span class="op" id="3701520">(</span><span class="ident" id="3701521">i</span>&nbsp;<span class="op" id="3701523">+</span>&nbsp;<span class="num" id="3701525">1</span><span class="op" id="3701526">)</span>&nbsp;<span class="comment" id="3701528">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701548">return</span>&nbsp;<span class="ident" id="3701555">x</span>&nbsp;<span class="op" id="3701557">|</span>&nbsp;<span class="ident" id="3701559">uint64</span><span class="op" id="3701565">(</span><span class="ident" id="3701566">b</span><span class="op" id="3701567">)</span><span class="op" id="3701568">&lt;&lt;</span><span class="ident" id="3701570">s</span><span class="op" id="3701571">,</span>&nbsp;<span class="ident" id="3701573">i</span>&nbsp;<span class="op" id="3701575">+</span>&nbsp;<span class="num" id="3701577">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701581">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701585">x</span>&nbsp;<span class="op" id="3701587">|=</span>&nbsp;<span class="ident" id="3701590">uint64</span><span class="op" id="3701596">(</span><span class="ident" id="3701597">b</span><span class="op" id="3701598">&amp;</span><span class="num" id="3701599">0x7f</span><span class="op" id="3701603">)</span>&nbsp;<span class="op" id="3701605">&lt;&lt;</span>&nbsp;<span class="ident" id="3701608">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701612">s</span>&nbsp;<span class="op" id="3701614">+=</span>&nbsp;<span class="num" id="3701617">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701623">return</span>&nbsp;<span class="num" id="3701630">0</span><span class="op" id="3701631">,</span>&nbsp;<span class="num" id="3701633">0</span><br>
<span class="lineno"></span><span class="op" id="3701635">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3701638">//&nbsp;PutVarint&nbsp;encodes&nbsp;an&nbsp;int64&nbsp;into&nbsp;buf&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="3701718">//&nbsp;If&nbsp;the&nbsp;buffer&nbsp;is&nbsp;too&nbsp;small,&nbsp;PutVarint&nbsp;will&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="3701771">func</span>&nbsp;<span class="ident" id="3701776">PutVarint</span><span class="op" id="3701785">(</span><span class="ident" id="3701786">buf</span>&nbsp;<span class="op" id="3701790">[</span><span class="op" id="3701791">]</span><span class="builtintype" id="3701792">byte</span><span class="op" id="3701796">,</span>&nbsp;<span class="ident" id="3701798">x</span>&nbsp;<span class="ident" id="3701800">int64</span><span class="op" id="3701805">)</span>&nbsp;<span class="builtintype" id="3701807">int</span>&nbsp;<span class="op" id="3701811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701814">ux</span>&nbsp;<span class="op" id="3701817">:=</span>&nbsp;<span class="ident" id="3701820">uint64</span><span class="op" id="3701826">(</span><span class="ident" id="3701827">x</span><span class="op" id="3701828">)</span>&nbsp;<span class="op" id="3701830">&lt;&lt;</span>&nbsp;<span class="num" id="3701833">1</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701836">if</span>&nbsp;<span class="ident" id="3701839">x</span>&nbsp;<span class="op" id="3701841">&lt;</span>&nbsp;<span class="num" id="3701843">0</span>&nbsp;<span class="op" id="3701845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3701849">ux</span>&nbsp;<span class="op" id="3701852">=</span>&nbsp;<span class="op" id="3701854">^</span><span class="ident" id="3701855">ux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3701859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3701862">return</span>&nbsp;<span class="ident" id="3701869">PutUvarint</span><span class="op" id="3701879">(</span><span class="ident" id="3701880">buf</span><span class="op" id="3701883">,</span>&nbsp;<span class="ident" id="3701885">ux</span><span class="op" id="3701887">)</span><br>
<span class="lineno"></span><span class="op" id="3701889">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3701892">//&nbsp;Varint&nbsp;decodes&nbsp;an&nbsp;int64&nbsp;from&nbsp;buf&nbsp;and&nbsp;returns&nbsp;that&nbsp;value&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3701959">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;(&gt;&nbsp;0).&nbsp;If&nbsp;an&nbsp;error&nbsp;occurred,&nbsp;the&nbsp;value&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span><span class="comment" id="3702027">//&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;n&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;with&nbsp;the&nbsp;following&nbsp;meaning:</span><br>
<span class="lineno"></span><span class="comment" id="3702092">//</span><br>
<span class="lineno">90</span><span class="comment" id="3702095">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;buf&nbsp;too&nbsp;small</span><br>
<span class="lineno"></span><span class="comment" id="3702120">//&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&lt;&nbsp;0:&nbsp;value&nbsp;larger&nbsp;than&nbsp;64&nbsp;bits&nbsp;(overflow)</span><br>
<span class="lineno"></span><span class="comment" id="3702168">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;-n&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="3702219">//</span><br>
<span class="lineno"></span><span class="keyword" id="3702222">func</span>&nbsp;<span class="ident" id="3702227">Varint</span><span class="op" id="3702233">(</span><span class="ident" id="3702234">buf</span>&nbsp;<span class="op" id="3702238">[</span><span class="op" id="3702239">]</span><span class="builtintype" id="3702240">byte</span><span class="op" id="3702244">)</span>&nbsp;<span class="op" id="3702246">(</span><span class="ident" id="3702247">int64</span><span class="op" id="3702252">,</span>&nbsp;<span class="builtintype" id="3702254">int</span><span class="op" id="3702257">)</span>&nbsp;<span class="op" id="3702259">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702262">ux</span><span class="op" id="3702264">,</span>&nbsp;<span class="ident" id="3702266">n</span>&nbsp;<span class="op" id="3702268">:=</span>&nbsp;<span class="ident" id="3702271">Uvarint</span><span class="op" id="3702278">(</span><span class="ident" id="3702279">buf</span><span class="op" id="3702282">)</span>&nbsp;<span class="comment" id="3702284">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702324">x</span>&nbsp;<span class="op" id="3702326">:=</span>&nbsp;<span class="ident" id="3702329">int64</span><span class="op" id="3702334">(</span><span class="ident" id="3702335">ux</span>&nbsp;<span class="op" id="3702338">&gt;&gt;</span>&nbsp;<span class="num" id="3702341">1</span><span class="op" id="3702342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702345">if</span>&nbsp;<span class="ident" id="3702348">ux</span><span class="op" id="3702350">&amp;</span><span class="num" id="3702351">1</span>&nbsp;<span class="op" id="3702353">!=</span>&nbsp;<span class="num" id="3702356">0</span>&nbsp;<span class="op" id="3702358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702362">x</span>&nbsp;<span class="op" id="3702364">=</span>&nbsp;<span class="op" id="3702366">^</span><span class="ident" id="3702367">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702370">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702373">return</span>&nbsp;<span class="ident" id="3702380">x</span><span class="op" id="3702381">,</span>&nbsp;<span class="ident" id="3702383">n</span><br>
<span class="lineno"></span><span class="op" id="3702385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3702388">var</span>&nbsp;<span class="ident" id="3702392">overflow</span>&nbsp;<span class="op" id="3702401">=</span>&nbsp;<span class="ident" id="3702403">errors</span><span class="op" id="3702409">.</span><span class="ident" id="3702410">New</span><span class="op" id="3702413">(</span><span class="string" id="3702414">&#34;binary:&nbsp;varint&nbsp;overflows&nbsp;a&nbsp;64-bit&nbsp;integer&#34;</span><span class="op" id="3702457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3702460">//&nbsp;ReadUvarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64.</span><br>
<span class="lineno"></span><span class="keyword" id="3702544">func</span>&nbsp;<span class="ident" id="3702549">ReadUvarint</span><span class="op" id="3702560">(</span><span class="ident" id="3702561">r</span>&nbsp;<span class="ident" id="3702563">io</span><span class="op" id="3702565">.</span><span class="ident" id="3702566">ByteReader</span><span class="op" id="3702576">)</span>&nbsp;<span class="op" id="3702578">(</span><span class="ident" id="3702579">uint64</span><span class="op" id="3702585">,</span>&nbsp;<span class="builtintype" id="3702587">error</span><span class="op" id="3702592">)</span>&nbsp;<span class="op" id="3702594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702597">var</span>&nbsp;<span class="ident" id="3702601">x</span>&nbsp;<span class="ident" id="3702603">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702611">var</span>&nbsp;<span class="ident" id="3702615">s</span>&nbsp;<span class="builtintype" id="3702617">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702623">for</span>&nbsp;<span class="ident" id="3702627">i</span>&nbsp;<span class="op" id="3702629">:=</span>&nbsp;<span class="num" id="3702632">0</span><span class="op" id="3702633">;</span>&nbsp;<span class="op" id="3702635">;</span>&nbsp;<span class="ident" id="3702637">i</span><span class="op" id="3702638">++</span>&nbsp;<span class="op" id="3702641">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702645">b</span><span class="op" id="3702646">,</span>&nbsp;<span class="ident" id="3702648">err</span>&nbsp;<span class="op" id="3702652">:=</span>&nbsp;<span class="ident" id="3702655">r</span><span class="op" id="3702656">.</span><span class="ident" id="3702657">ReadByte</span><span class="op" id="3702665">(</span><span class="op" id="3702666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702670">if</span>&nbsp;<span class="ident" id="3702673">err</span>&nbsp;<span class="op" id="3702677">!=</span>&nbsp;<span class="builtintype" id="3702680">nil</span>&nbsp;<span class="op" id="3702684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702689">return</span>&nbsp;<span class="ident" id="3702696">x</span><span class="op" id="3702697">,</span>&nbsp;<span class="ident" id="3702699">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702709">if</span>&nbsp;<span class="ident" id="3702712">b</span>&nbsp;<span class="op" id="3702714">&lt;</span>&nbsp;<span class="num" id="3702716">0x80</span>&nbsp;<span class="op" id="3702721">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702726">if</span>&nbsp;<span class="ident" id="3702729">i</span>&nbsp;<span class="op" id="3702731">&gt;</span>&nbsp;<span class="num" id="3702733">9</span>&nbsp;<span class="op" id="3702735">||</span>&nbsp;<span class="ident" id="3702738">i</span>&nbsp;<span class="op" id="3702740">==</span>&nbsp;<span class="num" id="3702743">9</span>&nbsp;<span class="op" id="3702745">&amp;&amp;</span>&nbsp;<span class="ident" id="3702748">b</span>&nbsp;<span class="op" id="3702750">&gt;</span>&nbsp;<span class="num" id="3702752">1</span>&nbsp;<span class="op" id="3702754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702760">return</span>&nbsp;<span class="ident" id="3702767">x</span><span class="op" id="3702768">,</span>&nbsp;<span class="ident" id="3702770">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3702787">return</span>&nbsp;<span class="ident" id="3702794">x</span>&nbsp;<span class="op" id="3702796">|</span>&nbsp;<span class="ident" id="3702798">uint64</span><span class="op" id="3702804">(</span><span class="ident" id="3702805">b</span><span class="op" id="3702806">)</span><span class="op" id="3702807">&lt;&lt;</span><span class="ident" id="3702809">s</span><span class="op" id="3702810">,</span>&nbsp;<span class="builtintype" id="3702812">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702818">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702822">x</span>&nbsp;<span class="op" id="3702824">|=</span>&nbsp;<span class="ident" id="3702827">uint64</span><span class="op" id="3702833">(</span><span class="ident" id="3702834">b</span><span class="op" id="3702835">&amp;</span><span class="num" id="3702836">0x7f</span><span class="op" id="3702840">)</span>&nbsp;<span class="op" id="3702842">&lt;&lt;</span>&nbsp;<span class="ident" id="3702845">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702849">s</span>&nbsp;<span class="op" id="3702851">+=</span>&nbsp;<span class="num" id="3702854">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3702857">}</span><br>
<span class="lineno"></span><span class="op" id="3702859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="3702862">//&nbsp;ReadVarint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;int64.</span><br>
<span class="lineno"></span><span class="keyword" id="3702943">func</span>&nbsp;<span class="ident" id="3702948">ReadVarint</span><span class="op" id="3702958">(</span><span class="ident" id="3702959">r</span>&nbsp;<span class="ident" id="3702961">io</span><span class="op" id="3702963">.</span><span class="ident" id="3702964">ByteReader</span><span class="op" id="3702974">)</span>&nbsp;<span class="op" id="3702976">(</span><span class="ident" id="3702977">int64</span><span class="op" id="3702982">,</span>&nbsp;<span class="builtintype" id="3702984">error</span><span class="op" id="3702989">)</span>&nbsp;<span class="op" id="3702991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3702994">ux</span><span class="op" id="3702996">,</span>&nbsp;<span class="ident" id="3702998">err</span>&nbsp;<span class="op" id="3703002">:=</span>&nbsp;<span class="ident" id="3703005">ReadUvarint</span><span class="op" id="3703016">(</span><span class="ident" id="3703017">r</span><span class="op" id="3703018">)</span>&nbsp;<span class="comment" id="3703020">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;in&nbsp;presence&nbsp;of&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703060">x</span>&nbsp;<span class="op" id="3703062">:=</span>&nbsp;<span class="ident" id="3703065">int64</span><span class="op" id="3703070">(</span><span class="ident" id="3703071">ux</span>&nbsp;<span class="op" id="3703074">&gt;&gt;</span>&nbsp;<span class="num" id="3703077">1</span><span class="op" id="3703078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703081">if</span>&nbsp;<span class="ident" id="3703084">ux</span><span class="op" id="3703086">&amp;</span><span class="num" id="3703087">1</span>&nbsp;<span class="op" id="3703089">!=</span>&nbsp;<span class="num" id="3703092">0</span>&nbsp;<span class="op" id="3703094">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3703098">x</span>&nbsp;<span class="op" id="3703100">=</span>&nbsp;<span class="op" id="3703102">^</span><span class="ident" id="3703103">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3703106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3703109">return</span>&nbsp;<span class="ident" id="3703116">x</span><span class="op" id="3703117">,</span>&nbsp;<span class="ident" id="3703119">err</span><br>
<span class="lineno"></span><span class="op" id="3703123">}</span>
</div>
</body>
</html>
