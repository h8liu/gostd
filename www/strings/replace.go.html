<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2928371">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2928426">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2928480">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2928531">package</span>&nbsp;<span class="ident" id="2928539">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2928548">import</span>&nbsp;<span class="string" id="2928555">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2928561">//&nbsp;Replacer&nbsp;replaces&nbsp;a&nbsp;list&nbsp;of&nbsp;strings&nbsp;with&nbsp;replacements.</span><br>
<span class="lineno">10</span><span class="comment" id="2928619">//&nbsp;It&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="2928676">type</span>&nbsp;<span class="ident" id="2928681">Replacer</span>&nbsp;<span class="keyword" id="2928690">struct</span>&nbsp;<span class="op" id="2928697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928700">r</span>&nbsp;<span class="ident" id="2928702"><a href="/strings/replace.go.html#2928797">replacer</a></span><br>
<span class="lineno"></span><span class="op" id="2928711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2928714">//&nbsp;replacer&nbsp;is&nbsp;the&nbsp;interface&nbsp;that&nbsp;a&nbsp;replacement&nbsp;algorithm&nbsp;needs&nbsp;to&nbsp;implement.</span><br>
<span class="lineno"></span><span class="keyword" id="2928792">type</span>&nbsp;<span class="ident" id="2928797">replacer</span>&nbsp;<span class="keyword" id="2928806">interface</span>&nbsp;<span class="op" id="2928816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928819">Replace</span><span class="op" id="2928826">(</span><span class="ident" id="2928827">s</span>&nbsp;<span class="builtintype" id="2928829">string</span><span class="op" id="2928835">)</span>&nbsp;<span class="builtintype" id="2928837">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2928845">WriteString</span><span class="op" id="2928856">(</span><span class="ident" id="2928857">w</span>&nbsp;<span class="ident" id="2928859"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2928861">.</span><span class="ident" id="2928862">Writer</span><span class="op" id="2928868">,</span>&nbsp;<span class="ident" id="2928870">s</span>&nbsp;<span class="builtintype" id="2928872">string</span><span class="op" id="2928878">)</span>&nbsp;<span class="op" id="2928880">(</span><span class="ident" id="2928881">n</span>&nbsp;<span class="builtintype" id="2928883">int</span><span class="op" id="2928886">,</span>&nbsp;<span class="ident" id="2928888">err</span>&nbsp;<span class="builtintype" id="2928892">error</span><span class="op" id="2928897">)</span><br>
<span class="lineno"></span><span class="op" id="2928899">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2928902">//&nbsp;NewReplacer&nbsp;returns&nbsp;a&nbsp;new&nbsp;Replacer&nbsp;from&nbsp;a&nbsp;list&nbsp;of&nbsp;old,&nbsp;new&nbsp;string&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="2928978">//&nbsp;Replacements&nbsp;are&nbsp;performed&nbsp;in&nbsp;order,&nbsp;without&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span><span class="keyword" id="2929047">func</span>&nbsp;<span class="ident" id="2929052">NewReplacer</span><span class="op" id="2929063">(</span><span class="ident" id="2929064">oldnew</span>&nbsp;<span class="op" id="2929071">...</span><span class="builtintype" id="2929074">string</span><span class="op" id="2929080">)</span>&nbsp;<span class="op" id="2929082">*</span><span class="ident" id="2929083"><a href="/strings/replace.go.html#2928681">Replacer</a></span>&nbsp;<span class="op" id="2929092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929095">if</span>&nbsp;<span class="builtinfunc" id="2929098">len</span><span class="op" id="2929101">(</span><span class="ident" id="2929102"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929108">)</span><span class="op" id="2929109">%</span><span class="num" id="2929110">2</span>&nbsp;<span class="op" id="2929112">==</span>&nbsp;<span class="num" id="2929115">1</span>&nbsp;<span class="op" id="2929117">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2929121">panic</span><span class="op" id="2929126">(</span><span class="string" id="2929127">&#34;strings.NewReplacer:&nbsp;odd&nbsp;argument&nbsp;count&#34;</span><span class="op" id="2929168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929175">if</span>&nbsp;<span class="builtinfunc" id="2929178">len</span><span class="op" id="2929181">(</span><span class="ident" id="2929182"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929188">)</span>&nbsp;<span class="op" id="2929190">==</span>&nbsp;<span class="num" id="2929193">2</span>&nbsp;<span class="op" id="2929195">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2929198">len</span><span class="op" id="2929201">(</span><span class="ident" id="2929202"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929208">[</span><span class="num" id="2929209">0</span><span class="op" id="2929210">]</span><span class="op" id="2929211">)</span>&nbsp;<span class="op" id="2929213">&gt;</span>&nbsp;<span class="num" id="2929215">1</span>&nbsp;<span class="op" id="2929217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929221">return</span>&nbsp;<span class="op" id="2929228">&amp;</span><span class="ident" id="2929229"><a href="/strings/replace.go.html#2928681">Replacer</a></span><span class="op" id="2929237">{</span><span class="ident" id="2929238">r</span><span class="op" id="2929239">:</span>&nbsp;<span class="ident" id="2929241"><a href="/strings/replace.go.html#2938037">makeSingleStringReplacer</a></span><span class="op" id="2929265">(</span><span class="ident" id="2929266"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929272">[</span><span class="num" id="2929273">0</span><span class="op" id="2929274">]</span><span class="op" id="2929275">,</span>&nbsp;<span class="ident" id="2929277"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929283">[</span><span class="num" id="2929284">1</span><span class="op" id="2929285">]</span><span class="op" id="2929286">)</span><span class="op" id="2929287">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929294">allNewBytes</span>&nbsp;<span class="op" id="2929306">:=</span>&nbsp;<span class="ident" id="2929309">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929315">for</span>&nbsp;<span class="ident" id="2929319">i</span>&nbsp;<span class="op" id="2929321">:=</span>&nbsp;<span class="num" id="2929324">0</span><span class="op" id="2929325">;</span>&nbsp;<span class="ident" id="2929327"><a href="/strings/replace.go.html#2929319">i</a></span>&nbsp;<span class="op" id="2929329">&lt;</span>&nbsp;<span class="builtinfunc" id="2929331">len</span><span class="op" id="2929334">(</span><span class="ident" id="2929335"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929341">)</span><span class="op" id="2929342">;</span>&nbsp;<span class="ident" id="2929344"><a href="/strings/replace.go.html#2929319">i</a></span>&nbsp;<span class="op" id="2929346">+=</span>&nbsp;<span class="num" id="2929349">2</span>&nbsp;<span class="op" id="2929351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929355">if</span>&nbsp;<span class="builtinfunc" id="2929358">len</span><span class="op" id="2929361">(</span><span class="ident" id="2929362"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929368">[</span><span class="ident" id="2929369"><a href="/strings/replace.go.html#2929319">i</a></span><span class="op" id="2929370">]</span><span class="op" id="2929371">)</span>&nbsp;<span class="op" id="2929373">!=</span>&nbsp;<span class="num" id="2929376">1</span>&nbsp;<span class="op" id="2929378">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929383">return</span>&nbsp;<span class="op" id="2929390">&amp;</span><span class="ident" id="2929391"><a href="/strings/replace.go.html#2928681">Replacer</a></span><span class="op" id="2929399">{</span><span class="ident" id="2929400">r</span><span class="op" id="2929401">:</span>&nbsp;<span class="ident" id="2929403"><a href="/strings/replace.go.html#2935307">makeGenericReplacer</a></span><span class="op" id="2929422">(</span><span class="ident" id="2929423"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929429">)</span><span class="op" id="2929430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929438">if</span>&nbsp;<span class="builtinfunc" id="2929441">len</span><span class="op" id="2929444">(</span><span class="ident" id="2929445"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929451">[</span><span class="ident" id="2929452"><a href="/strings/replace.go.html#2929319">i</a></span><span class="op" id="2929453">+</span><span class="num" id="2929454">1</span><span class="op" id="2929455">]</span><span class="op" id="2929456">)</span>&nbsp;<span class="op" id="2929458">!=</span>&nbsp;<span class="num" id="2929461">1</span>&nbsp;<span class="op" id="2929463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929468"><a href="/strings/replace.go.html#2929294">allNewBytes</a></span>&nbsp;<span class="op" id="2929480">=</span>&nbsp;<span class="ident" id="2929482">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929490">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929497">if</span>&nbsp;<span class="ident" id="2929500"><a href="/strings/replace.go.html#2929294">allNewBytes</a></span>&nbsp;<span class="op" id="2929512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929516">r</span>&nbsp;<span class="op" id="2929518">:=</span>&nbsp;<span class="ident" id="2929521"><a href="/strings/replace.go.html#2939208">byteReplacer</a></span><span class="op" id="2929533">{</span><span class="op" id="2929534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929538">for</span>&nbsp;<span class="ident" id="2929542">i</span>&nbsp;<span class="op" id="2929544">:=</span>&nbsp;<span class="keyword" id="2929547">range</span>&nbsp;<span class="ident" id="2929553"><a href="/strings/replace.go.html#2929516">r</a></span>&nbsp;<span class="op" id="2929555">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929560"><a href="/strings/replace.go.html#2929516">r</a></span><span class="op" id="2929561">[</span><span class="ident" id="2929562"><a href="/strings/replace.go.html#2929542">i</a></span><span class="op" id="2929563">]</span>&nbsp;<span class="op" id="2929565">=</span>&nbsp;<span class="builtintype" id="2929567">byte</span><span class="op" id="2929571">(</span><span class="ident" id="2929572"><a href="/strings/replace.go.html#2929542">i</a></span><span class="op" id="2929573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929581">//&nbsp;The&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;old-&gt;new&nbsp;map&nbsp;takes&nbsp;precedence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929640">//&nbsp;over&nbsp;the&nbsp;others&nbsp;with&nbsp;the&nbsp;same&nbsp;old&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929687">for</span>&nbsp;<span class="ident" id="2929691">i</span>&nbsp;<span class="op" id="2929693">:=</span>&nbsp;<span class="builtinfunc" id="2929696">len</span><span class="op" id="2929699">(</span><span class="ident" id="2929700"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929706">)</span>&nbsp;<span class="op" id="2929708">-</span>&nbsp;<span class="num" id="2929710">2</span><span class="op" id="2929711">;</span>&nbsp;<span class="ident" id="2929713"><a href="/strings/replace.go.html#2929691">i</a></span>&nbsp;<span class="op" id="2929715">&gt;=</span>&nbsp;<span class="num" id="2929718">0</span><span class="op" id="2929719">;</span>&nbsp;<span class="ident" id="2929721"><a href="/strings/replace.go.html#2929691">i</a></span>&nbsp;<span class="op" id="2929723">-=</span>&nbsp;<span class="num" id="2929726">2</span>&nbsp;<span class="op" id="2929728">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929733">o</span>&nbsp;<span class="op" id="2929735">:=</span>&nbsp;<span class="ident" id="2929738"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929744">[</span><span class="ident" id="2929745"><a href="/strings/replace.go.html#2929691">i</a></span><span class="op" id="2929746">]</span><span class="op" id="2929747">[</span><span class="num" id="2929748">0</span><span class="op" id="2929749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929754">n</span>&nbsp;<span class="op" id="2929756">:=</span>&nbsp;<span class="ident" id="2929759"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929765">[</span><span class="ident" id="2929766"><a href="/strings/replace.go.html#2929691">i</a></span><span class="op" id="2929767">+</span><span class="num" id="2929768">1</span><span class="op" id="2929769">]</span><span class="op" id="2929770">[</span><span class="num" id="2929771">0</span><span class="op" id="2929772">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929777"><a href="/strings/replace.go.html#2929516">r</a></span><span class="op" id="2929778">[</span><span class="ident" id="2929779"><a href="/strings/replace.go.html#2929733">o</a></span><span class="op" id="2929780">]</span>&nbsp;<span class="op" id="2929782">=</span>&nbsp;<span class="ident" id="2929784"><a href="/strings/replace.go.html#2929754">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929792">return</span>&nbsp;<span class="op" id="2929799">&amp;</span><span class="ident" id="2929800"><a href="/strings/replace.go.html#2928681">Replacer</a></span><span class="op" id="2929808">{</span><span class="ident" id="2929809">r</span><span class="op" id="2929810">:</span>&nbsp;<span class="op" id="2929812">&amp;</span><span class="ident" id="2929813"><a href="/strings/replace.go.html#2929516">r</a></span><span class="op" id="2929814">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2929817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929821">r</span>&nbsp;<span class="op" id="2929823">:=</span>&nbsp;<span class="ident" id="2929826"><a href="/strings/replace.go.html#2940253">byteStringReplacer</a></span><span class="op" id="2929844">{</span><span class="op" id="2929845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929848">//&nbsp;The&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;old-&gt;new&nbsp;map&nbsp;takes&nbsp;precedence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2929906">//&nbsp;over&nbsp;the&nbsp;others&nbsp;with&nbsp;the&nbsp;same&nbsp;old&nbsp;string.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2929952">for</span>&nbsp;<span class="ident" id="2929956">i</span>&nbsp;<span class="op" id="2929958">:=</span>&nbsp;<span class="builtinfunc" id="2929961">len</span><span class="op" id="2929964">(</span><span class="ident" id="2929965"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2929971">)</span>&nbsp;<span class="op" id="2929973">-</span>&nbsp;<span class="num" id="2929975">2</span><span class="op" id="2929976">;</span>&nbsp;<span class="ident" id="2929978"><a href="/strings/replace.go.html#2929956">i</a></span>&nbsp;<span class="op" id="2929980">&gt;=</span>&nbsp;<span class="num" id="2929983">0</span><span class="op" id="2929984">;</span>&nbsp;<span class="ident" id="2929986"><a href="/strings/replace.go.html#2929956">i</a></span>&nbsp;<span class="op" id="2929988">-=</span>&nbsp;<span class="num" id="2929991">2</span>&nbsp;<span class="op" id="2929993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2929997">o</span>&nbsp;<span class="op" id="2929999">:=</span>&nbsp;<span class="ident" id="2930002"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2930008">[</span><span class="ident" id="2930009"><a href="/strings/replace.go.html#2929956">i</a></span><span class="op" id="2930010">]</span><span class="op" id="2930011">[</span><span class="num" id="2930012">0</span><span class="op" id="2930013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930017">n</span>&nbsp;<span class="op" id="2930019">:=</span>&nbsp;<span class="ident" id="2930022"><a href="/strings/replace.go.html#2929064">oldnew</a></span><span class="op" id="2930028">[</span><span class="ident" id="2930029"><a href="/strings/replace.go.html#2929956">i</a></span><span class="op" id="2930030">+</span><span class="num" id="2930031">1</span><span class="op" id="2930032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2930036"><a href="/strings/replace.go.html#2929821">r</a></span><span class="op" id="2930037">[</span><span class="ident" id="2930038"><a href="/strings/replace.go.html#2929997">o</a></span><span class="op" id="2930039">]</span>&nbsp;<span class="op" id="2930041">=</span>&nbsp;<span class="op" id="2930043">[</span><span class="op" id="2930044">]</span><span class="builtintype" id="2930045">byte</span><span class="op" id="2930049">(</span><span class="ident" id="2930050"><a href="/strings/replace.go.html#2930017">n</a></span><span class="op" id="2930051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2930054">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930057">return</span>&nbsp;<span class="op" id="2930064">&amp;</span><span class="ident" id="2930065"><a href="/strings/replace.go.html#2928681">Replacer</a></span><span class="op" id="2930073">{</span><span class="ident" id="2930074">r</span><span class="op" id="2930075">:</span>&nbsp;<span class="op" id="2930077">&amp;</span><span class="ident" id="2930078"><a href="/strings/replace.go.html#2929821">r</a></span><span class="op" id="2930079">}</span><br>
<span class="lineno"></span><span class="op" id="2930081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930084">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;replacements&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2930148">func</span>&nbsp;<span class="op" id="2930153">(</span><span class="ident" id="2930154">r</span>&nbsp;<span class="op" id="2930156">*</span><span class="ident" id="2930157"><a href="/strings/replace.go.html#2928681">Replacer</a></span><span class="op" id="2930165">)</span>&nbsp;<span class="ident" id="2930167">Replace</span><span class="op" id="2930174">(</span><span class="ident" id="2930175">s</span>&nbsp;<span class="builtintype" id="2930177">string</span><span class="op" id="2930183">)</span>&nbsp;<span class="builtintype" id="2930185">string</span>&nbsp;<span class="op" id="2930192">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930195">return</span>&nbsp;<span class="ident" id="2930202"><a href="/strings/replace.go.html#2930154">r</a></span><span class="op" id="2930203">.</span><span class="ident" id="2930204">r</span><span class="op" id="2930205">.</span><span class="ident" id="2930206">Replace</span><span class="op" id="2930213">(</span><span class="ident" id="2930214"><a href="/strings/replace.go.html#2930175">s</a></span><span class="op" id="2930215">)</span><br>
<span class="lineno"></span><span class="op" id="2930217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930220">//&nbsp;WriteString&nbsp;writes&nbsp;s&nbsp;to&nbsp;w&nbsp;with&nbsp;all&nbsp;replacements&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="2930282">func</span>&nbsp;<span class="op" id="2930287">(</span><span class="ident" id="2930288">r</span>&nbsp;<span class="op" id="2930290">*</span><span class="ident" id="2930291"><a href="/strings/replace.go.html#2928681">Replacer</a></span><span class="op" id="2930299">)</span>&nbsp;<span class="ident" id="2930301">WriteString</span><span class="op" id="2930312">(</span><span class="ident" id="2930313">w</span>&nbsp;<span class="ident" id="2930315"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2930317">.</span><span class="ident" id="2930318">Writer</span><span class="op" id="2930324">,</span>&nbsp;<span class="ident" id="2930326">s</span>&nbsp;<span class="builtintype" id="2930328">string</span><span class="op" id="2930334">)</span>&nbsp;<span class="op" id="2930336">(</span><span class="ident" id="2930337">n</span>&nbsp;<span class="builtintype" id="2930339">int</span><span class="op" id="2930342">,</span>&nbsp;<span class="ident" id="2930344">err</span>&nbsp;<span class="builtintype" id="2930348">error</span><span class="op" id="2930353">)</span>&nbsp;<span class="op" id="2930355">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2930358">return</span>&nbsp;<span class="ident" id="2930365"><a href="/strings/replace.go.html#2930288">r</a></span><span class="op" id="2930366">.</span><span class="ident" id="2930367">r</span><span class="op" id="2930368">.</span><span class="ident" id="2930369">WriteString</span><span class="op" id="2930380">(</span><span class="ident" id="2930381"><a href="/strings/replace.go.html#2930313">w</a></span><span class="op" id="2930382">,</span>&nbsp;<span class="ident" id="2930384"><a href="/strings/replace.go.html#2930326">s</a></span><span class="op" id="2930385">)</span><br>
<span class="lineno"></span><span class="op" id="2930387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2930390">//&nbsp;trieNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;a&nbsp;lookup&nbsp;trie&nbsp;for&nbsp;prioritized&nbsp;key/value&nbsp;pairs.&nbsp;Keys</span><br>
<span class="lineno"></span><span class="comment" id="2930467">//&nbsp;and&nbsp;values&nbsp;may&nbsp;be&nbsp;empty.&nbsp;For&nbsp;example,&nbsp;the&nbsp;trie&nbsp;containing&nbsp;keys&nbsp;&#34;ax&#34;,&nbsp;&#34;ay&#34;,</span><br>
<span class="lineno">80</span><span class="comment" id="2930545">//&nbsp;&#34;bcbc&#34;,&nbsp;&#34;x&#34;&nbsp;and&nbsp;&#34;xy&#34;&nbsp;could&nbsp;have&nbsp;eight&nbsp;nodes:</span><br>
<span class="lineno"></span><span class="comment" id="2930593">//</span><br>
<span class="lineno"></span><span class="comment" id="2930596">//&nbsp;&nbsp;n0&nbsp;&nbsp;-</span><br>
<span class="lineno"></span><span class="comment" id="2930606">//&nbsp;&nbsp;n1&nbsp;&nbsp;a-</span><br>
<span class="lineno"></span><span class="comment" id="2930617">//&nbsp;&nbsp;n2&nbsp;&nbsp;.x+</span><br>
<span class="lineno">85</span><span class="comment" id="2930629">//&nbsp;&nbsp;n3&nbsp;&nbsp;.y+</span><br>
<span class="lineno"></span><span class="comment" id="2930641">//&nbsp;&nbsp;n4&nbsp;&nbsp;b-</span><br>
<span class="lineno"></span><span class="comment" id="2930652">//&nbsp;&nbsp;n5&nbsp;&nbsp;.cbc+</span><br>
<span class="lineno"></span><span class="comment" id="2930666">//&nbsp;&nbsp;n6&nbsp;&nbsp;x+</span><br>
<span class="lineno"></span><span class="comment" id="2930677">//&nbsp;&nbsp;n7&nbsp;&nbsp;.y+</span><br>
<span class="lineno">90</span><span class="comment" id="2930689">//</span><br>
<span class="lineno"></span><span class="comment" id="2930692">//&nbsp;n0&nbsp;is&nbsp;the&nbsp;root&nbsp;node,&nbsp;and&nbsp;its&nbsp;children&nbsp;are&nbsp;n1,&nbsp;n4&nbsp;and&nbsp;n6;&nbsp;n1&#39;s&nbsp;children&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2930770">//&nbsp;n2&nbsp;and&nbsp;n3;&nbsp;n4&#39;s&nbsp;child&nbsp;is&nbsp;n5;&nbsp;n6&#39;s&nbsp;child&nbsp;is&nbsp;n7.&nbsp;Nodes&nbsp;n0,&nbsp;n1&nbsp;and&nbsp;n4&nbsp;(marked</span><br>
<span class="lineno"></span><span class="comment" id="2930848">//&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;-&#34;)&nbsp;are&nbsp;partial&nbsp;keys,&nbsp;and&nbsp;nodes&nbsp;n2,&nbsp;n3,&nbsp;n5,&nbsp;n6&nbsp;and&nbsp;n7</span><br>
<span class="lineno"></span><span class="comment" id="2930922">//&nbsp;(marked&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;+&#34;)&nbsp;are&nbsp;complete&nbsp;keys.</span><br>
<span class="lineno">95</span><span class="keyword" id="2930973">type</span>&nbsp;<span class="ident" id="2930978">trieNode</span>&nbsp;<span class="keyword" id="2930987">struct</span>&nbsp;<span class="op" id="2930994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2930997">//&nbsp;value&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;trie&nbsp;node&#39;s&nbsp;key/value&nbsp;pair.&nbsp;It&nbsp;is&nbsp;empty&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931070">//&nbsp;this&nbsp;node&nbsp;is&nbsp;not&nbsp;a&nbsp;complete&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931107">value</span>&nbsp;<span class="builtintype" id="2931113">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931121">//&nbsp;priority&nbsp;is&nbsp;the&nbsp;priority&nbsp;(higher&nbsp;is&nbsp;more&nbsp;important)&nbsp;of&nbsp;the&nbsp;trie&nbsp;node&#39;s</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931196">//&nbsp;key/value&nbsp;pair;&nbsp;keys&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;matched&nbsp;shortest-&nbsp;or&nbsp;longest-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931271">//&nbsp;first.&nbsp;Priority&nbsp;is&nbsp;positive&nbsp;if&nbsp;this&nbsp;node&nbsp;is&nbsp;a&nbsp;complete&nbsp;key,&nbsp;and&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931344">//&nbsp;otherwise.&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;positive/zero&nbsp;priorities&nbsp;are&nbsp;marked</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931417">//&nbsp;with&nbsp;a&nbsp;trailing&nbsp;&#34;+&#34;&nbsp;or&nbsp;&#34;-&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2931449">priority</span>&nbsp;<span class="builtintype" id="2931458">int</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931464">//&nbsp;A&nbsp;trie&nbsp;node&nbsp;may&nbsp;have&nbsp;zero,&nbsp;one&nbsp;or&nbsp;more&nbsp;child&nbsp;nodes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931520">//&nbsp;&nbsp;*&nbsp;if&nbsp;the&nbsp;remaining&nbsp;fields&nbsp;are&nbsp;zero,&nbsp;there&nbsp;are&nbsp;no&nbsp;children.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931584">//&nbsp;&nbsp;*&nbsp;if&nbsp;prefix&nbsp;and&nbsp;next&nbsp;are&nbsp;non-zero,&nbsp;there&nbsp;is&nbsp;one&nbsp;child&nbsp;in&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931652">//&nbsp;&nbsp;*&nbsp;if&nbsp;table&nbsp;is&nbsp;non-zero,&nbsp;it&nbsp;defines&nbsp;all&nbsp;the&nbsp;children.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931710">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931714">//&nbsp;Prefixes&nbsp;are&nbsp;preferred&nbsp;over&nbsp;tables&nbsp;when&nbsp;there&nbsp;is&nbsp;one&nbsp;child,&nbsp;but&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931786">//&nbsp;root&nbsp;node&nbsp;always&nbsp;uses&nbsp;a&nbsp;table&nbsp;for&nbsp;lookup&nbsp;efficiency.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931844">//&nbsp;prefix&nbsp;is&nbsp;the&nbsp;difference&nbsp;in&nbsp;keys&nbsp;between&nbsp;this&nbsp;trie&nbsp;node&nbsp;and&nbsp;the&nbsp;next.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931918">//&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;node&nbsp;n4&nbsp;has&nbsp;prefix&nbsp;&#34;cbc&#34;&nbsp;and&nbsp;n4&#39;s&nbsp;next&nbsp;node&nbsp;is&nbsp;n5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2931995">//&nbsp;Node&nbsp;n5&nbsp;has&nbsp;no&nbsp;children&nbsp;and&nbsp;so&nbsp;has&nbsp;zero&nbsp;prefix,&nbsp;next&nbsp;and&nbsp;table&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932070">prefix</span>&nbsp;<span class="builtintype" id="2932077">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932085">next</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2932092">*</span><span class="ident" id="2932093"><a href="/strings/replace.go.html#2930978">trieNode</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932104">//&nbsp;table&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;indexed&nbsp;by&nbsp;the&nbsp;next&nbsp;byte&nbsp;in&nbsp;the&nbsp;key,&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932175">//&nbsp;remapping&nbsp;that&nbsp;byte&nbsp;through&nbsp;genericReplacer.mapping&nbsp;to&nbsp;create&nbsp;a&nbsp;dense</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932249">//&nbsp;index.&nbsp;In&nbsp;the&nbsp;example&nbsp;above,&nbsp;the&nbsp;keys&nbsp;only&nbsp;use&nbsp;&#39;a&#39;,&nbsp;&#39;b&#39;,&nbsp;&#39;c&#39;,&nbsp;&#39;x&#39;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932323">//&nbsp;&#39;y&#39;,&nbsp;which&nbsp;remap&nbsp;to&nbsp;0,&nbsp;1,&nbsp;2,&nbsp;3&nbsp;and&nbsp;4.&nbsp;All&nbsp;other&nbsp;bytes&nbsp;remap&nbsp;to&nbsp;5,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932397">//&nbsp;genericReplacer.tableSize&nbsp;will&nbsp;be&nbsp;5.&nbsp;Node&nbsp;n0&#39;s&nbsp;table&nbsp;will&nbsp;be</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932462">//&nbsp;[]*trieNode{&nbsp;0:n1,&nbsp;1:n4,&nbsp;3:n6&nbsp;},&nbsp;where&nbsp;the&nbsp;0,&nbsp;1&nbsp;and&nbsp;3&nbsp;are&nbsp;the&nbsp;remapped</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932537">//&nbsp;&#39;a&#39;,&nbsp;&#39;b&#39;&nbsp;and&nbsp;&#39;x&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932559">table</span>&nbsp;<span class="op" id="2932565">[</span><span class="op" id="2932566">]</span><span class="op" id="2932567">*</span><span class="ident" id="2932568"><a href="/strings/replace.go.html#2930978">trieNode</a></span><br>
<span class="lineno"></span><span class="op" id="2932577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2932580">func</span>&nbsp;<span class="op" id="2932585">(</span><span class="ident" id="2932586">t</span>&nbsp;<span class="op" id="2932588">*</span><span class="ident" id="2932589"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2932597">)</span>&nbsp;<span class="ident" id="2932599">add</span><span class="op" id="2932602">(</span><span class="ident" id="2932603">key</span><span class="op" id="2932606">,</span>&nbsp;<span class="ident" id="2932608">val</span>&nbsp;<span class="builtintype" id="2932612">string</span><span class="op" id="2932618">,</span>&nbsp;<span class="ident" id="2932620">priority</span>&nbsp;<span class="builtintype" id="2932629">int</span><span class="op" id="2932632">,</span>&nbsp;<span class="ident" id="2932634">r</span>&nbsp;<span class="op" id="2932636">*</span><span class="ident" id="2932637"><a href="/strings/replace.go.html#2935057">genericReplacer</a></span><span class="op" id="2932652">)</span>&nbsp;<span class="op" id="2932654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932657">if</span>&nbsp;<span class="ident" id="2932660"><a href="/strings/replace.go.html#2932603">key</a></span>&nbsp;<span class="op" id="2932664">==</span>&nbsp;<span class="string" id="2932667">&#34;&#34;</span>&nbsp;<span class="op" id="2932670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932674">if</span>&nbsp;<span class="ident" id="2932677"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932678">.</span><span class="ident" id="2932679">priority</span>&nbsp;<span class="op" id="2932688">==</span>&nbsp;<span class="num" id="2932691">0</span>&nbsp;<span class="op" id="2932693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932698"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932699">.</span><span class="ident" id="2932700">value</span>&nbsp;<span class="op" id="2932706">=</span>&nbsp;<span class="ident" id="2932708"><a href="/strings/replace.go.html#2932608">val</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2932715"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932716">.</span><span class="ident" id="2932717">priority</span>&nbsp;<span class="op" id="2932726">=</span>&nbsp;<span class="ident" id="2932728"><a href="/strings/replace.go.html#2932620">priority</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932743">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932755">if</span>&nbsp;<span class="ident" id="2932758"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932759">.</span><span class="ident" id="2932760">prefix</span>&nbsp;<span class="op" id="2932767">!=</span>&nbsp;<span class="string" id="2932770">&#34;&#34;</span>&nbsp;<span class="op" id="2932773">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2932777">//&nbsp;Need&nbsp;to&nbsp;split&nbsp;the&nbsp;prefix&nbsp;among&nbsp;multiple&nbsp;nodes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932829">var</span>&nbsp;<span class="ident" id="2932833">n</span>&nbsp;<span class="builtintype" id="2932835">int</span>&nbsp;<span class="comment" id="2932839">//&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932880">for</span>&nbsp;<span class="op" id="2932884">;</span>&nbsp;<span class="ident" id="2932886"><a href="/strings/replace.go.html#2932833">n</a></span>&nbsp;<span class="op" id="2932888">&lt;</span>&nbsp;<span class="builtinfunc" id="2932890">len</span><span class="op" id="2932893">(</span><span class="ident" id="2932894"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932895">.</span><span class="ident" id="2932896">prefix</span><span class="op" id="2932902">)</span>&nbsp;<span class="op" id="2932904">&amp;&amp;</span>&nbsp;<span class="ident" id="2932907"><a href="/strings/replace.go.html#2932833">n</a></span>&nbsp;<span class="op" id="2932909">&lt;</span>&nbsp;<span class="builtinfunc" id="2932911">len</span><span class="op" id="2932914">(</span><span class="ident" id="2932915"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2932918">)</span><span class="op" id="2932919">;</span>&nbsp;<span class="ident" id="2932921"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2932922">++</span>&nbsp;<span class="op" id="2932925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932930">if</span>&nbsp;<span class="ident" id="2932933"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932934">.</span><span class="ident" id="2932935">prefix</span><span class="op" id="2932941">[</span><span class="ident" id="2932942"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2932943">]</span>&nbsp;<span class="op" id="2932945">!=</span>&nbsp;<span class="ident" id="2932948"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2932951">[</span><span class="ident" id="2932952"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2932953">]</span>&nbsp;<span class="op" id="2932955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932961">break</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2932974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2932978">if</span>&nbsp;<span class="ident" id="2932981"><a href="/strings/replace.go.html#2932833">n</a></span>&nbsp;<span class="op" id="2932983">==</span>&nbsp;<span class="builtinfunc" id="2932986">len</span><span class="op" id="2932989">(</span><span class="ident" id="2932990"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2932991">.</span><span class="ident" id="2932992">prefix</span><span class="op" id="2932998">)</span>&nbsp;<span class="op" id="2933000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933005"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933006">.</span><span class="ident" id="2933007">next</span><span class="op" id="2933011">.</span><span class="ident" id="2933012">add</span><span class="op" id="2933015">(</span><span class="ident" id="2933016"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2933019">[</span><span class="ident" id="2933020"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2933021">:</span><span class="op" id="2933022">]</span><span class="op" id="2933023">,</span>&nbsp;<span class="ident" id="2933025"><a href="/strings/replace.go.html#2932608">val</a></span><span class="op" id="2933028">,</span>&nbsp;<span class="ident" id="2933030"><a href="/strings/replace.go.html#2932620">priority</a></span><span class="op" id="2933038">,</span>&nbsp;<span class="ident" id="2933040"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933045">}</span>&nbsp;<span class="keyword" id="2933047">else</span>&nbsp;<span class="keyword" id="2933052">if</span>&nbsp;<span class="ident" id="2933055"><a href="/strings/replace.go.html#2932833">n</a></span>&nbsp;<span class="op" id="2933057">==</span>&nbsp;<span class="num" id="2933060">0</span>&nbsp;<span class="op" id="2933062">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933067">//&nbsp;First&nbsp;byte&nbsp;differs,&nbsp;start&nbsp;a&nbsp;new&nbsp;lookup&nbsp;table&nbsp;here.&nbsp;Looking&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933135">//&nbsp;what&nbsp;is&nbsp;currently&nbsp;t.prefix[0]&nbsp;will&nbsp;lead&nbsp;to&nbsp;prefixNode,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933200">//&nbsp;looking&nbsp;up&nbsp;key[0]&nbsp;will&nbsp;lead&nbsp;to&nbsp;keyNode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933246">var</span>&nbsp;<span class="ident" id="2933250">prefixNode</span>&nbsp;<span class="op" id="2933261">*</span><span class="ident" id="2933262"><a href="/strings/replace.go.html#2930978">trieNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933274">if</span>&nbsp;<span class="builtinfunc" id="2933277">len</span><span class="op" id="2933280">(</span><span class="ident" id="2933281"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933282">.</span><span class="ident" id="2933283">prefix</span><span class="op" id="2933289">)</span>&nbsp;<span class="op" id="2933291">==</span>&nbsp;<span class="num" id="2933294">1</span>&nbsp;<span class="op" id="2933296">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933302"><a href="/strings/replace.go.html#2933250">prefixNode</a></span>&nbsp;<span class="op" id="2933313">=</span>&nbsp;<span class="ident" id="2933315"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933316">.</span><span class="ident" id="2933317">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933325">}</span>&nbsp;<span class="keyword" id="2933327">else</span>&nbsp;<span class="op" id="2933332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933338"><a href="/strings/replace.go.html#2933250">prefixNode</a></span>&nbsp;<span class="op" id="2933349">=</span>&nbsp;<span class="op" id="2933351">&amp;</span><span class="ident" id="2933352"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2933360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933367">prefix</span><span class="op" id="2933373">:</span>&nbsp;<span class="ident" id="2933375"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933376">.</span><span class="ident" id="2933377">prefix</span><span class="op" id="2933383">[</span><span class="num" id="2933384">1</span><span class="op" id="2933385">:</span><span class="op" id="2933386">]</span><span class="op" id="2933387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933394">next</span><span class="op" id="2933398">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2933402"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933403">.</span><span class="ident" id="2933404">next</span><span class="op" id="2933408">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933424">keyNode</span>&nbsp;<span class="op" id="2933432">:=</span>&nbsp;<span class="builtinfunc" id="2933435">new</span><span class="op" id="2933438">(</span><span class="ident" id="2933439"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2933447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933452"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933453">.</span><span class="ident" id="2933454">table</span>&nbsp;<span class="op" id="2933460">=</span>&nbsp;<span class="builtinfunc" id="2933462">make</span><span class="op" id="2933466">(</span><span class="op" id="2933467">[</span><span class="op" id="2933468">]</span><span class="op" id="2933469">*</span><span class="ident" id="2933470"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2933478">,</span>&nbsp;<span class="ident" id="2933480"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933481">.</span><span class="ident" id="2933482">tableSize</span><span class="op" id="2933491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933496"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933497">.</span><span class="ident" id="2933498">table</span><span class="op" id="2933503">[</span><span class="ident" id="2933504"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933505">.</span><span class="ident" id="2933506">mapping</span><span class="op" id="2933513">[</span><span class="ident" id="2933514"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933515">.</span><span class="ident" id="2933516">prefix</span><span class="op" id="2933522">[</span><span class="num" id="2933523">0</span><span class="op" id="2933524">]</span><span class="op" id="2933525">]</span><span class="op" id="2933526">]</span>&nbsp;<span class="op" id="2933528">=</span>&nbsp;<span class="ident" id="2933530"><a href="/strings/replace.go.html#2933250">prefixNode</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933544"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933545">.</span><span class="ident" id="2933546">table</span><span class="op" id="2933551">[</span><span class="ident" id="2933552"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933553">.</span><span class="ident" id="2933554">mapping</span><span class="op" id="2933561">[</span><span class="ident" id="2933562"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2933565">[</span><span class="num" id="2933566">0</span><span class="op" id="2933567">]</span><span class="op" id="2933568">]</span><span class="op" id="2933569">]</span>&nbsp;<span class="op" id="2933571">=</span>&nbsp;<span class="ident" id="2933573"><a href="/strings/replace.go.html#2933424">keyNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933584"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933585">.</span><span class="ident" id="2933586">prefix</span>&nbsp;<span class="op" id="2933593">=</span>&nbsp;<span class="string" id="2933595">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933601"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933602">.</span><span class="ident" id="2933603">next</span>&nbsp;<span class="op" id="2933608">=</span>&nbsp;<span class="ident" id="2933610">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933617"><a href="/strings/replace.go.html#2933424">keyNode</a></span><span class="op" id="2933624">.</span><span class="ident" id="2933625">add</span><span class="op" id="2933628">(</span><span class="ident" id="2933629"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2933632">[</span><span class="num" id="2933633">1</span><span class="op" id="2933634">:</span><span class="op" id="2933635">]</span><span class="op" id="2933636">,</span>&nbsp;<span class="ident" id="2933638"><a href="/strings/replace.go.html#2932608">val</a></span><span class="op" id="2933641">,</span>&nbsp;<span class="ident" id="2933643"><a href="/strings/replace.go.html#2932620">priority</a></span><span class="op" id="2933651">,</span>&nbsp;<span class="ident" id="2933653"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933658">}</span>&nbsp;<span class="keyword" id="2933660">else</span>&nbsp;<span class="op" id="2933665">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933670">//&nbsp;Insert&nbsp;new&nbsp;node&nbsp;after&nbsp;the&nbsp;common&nbsp;section&nbsp;of&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933732">next</span>&nbsp;<span class="op" id="2933737">:=</span>&nbsp;<span class="op" id="2933740">&amp;</span><span class="ident" id="2933741"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2933749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933755">prefix</span><span class="op" id="2933761">:</span>&nbsp;<span class="ident" id="2933763"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933764">.</span><span class="ident" id="2933765">prefix</span><span class="op" id="2933771">[</span><span class="ident" id="2933772"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2933773">:</span><span class="op" id="2933774">]</span><span class="op" id="2933775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933781">next</span><span class="op" id="2933785">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2933789"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933790">.</span><span class="ident" id="2933791">next</span><span class="op" id="2933795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933800">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933805"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933806">.</span><span class="ident" id="2933807">prefix</span>&nbsp;<span class="op" id="2933814">=</span>&nbsp;<span class="ident" id="2933816"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933817">.</span><span class="ident" id="2933818">prefix</span><span class="op" id="2933824">[</span><span class="op" id="2933825">:</span><span class="ident" id="2933826"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2933827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933832"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933833">.</span><span class="ident" id="2933834">next</span>&nbsp;<span class="op" id="2933839">=</span>&nbsp;<span class="ident" id="2933841"><a href="/strings/replace.go.html#2933732">next</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933849"><a href="/strings/replace.go.html#2933732">next</a></span><span class="op" id="2933853">.</span><span class="ident" id="2933854">add</span><span class="op" id="2933857">(</span><span class="ident" id="2933858"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2933861">[</span><span class="ident" id="2933862"><a href="/strings/replace.go.html#2932833">n</a></span><span class="op" id="2933863">:</span><span class="op" id="2933864">]</span><span class="op" id="2933865">,</span>&nbsp;<span class="ident" id="2933867"><a href="/strings/replace.go.html#2932608">val</a></span><span class="op" id="2933870">,</span>&nbsp;<span class="ident" id="2933872"><a href="/strings/replace.go.html#2932620">priority</a></span><span class="op" id="2933880">,</span>&nbsp;<span class="ident" id="2933882"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2933890">}</span>&nbsp;<span class="keyword" id="2933892">else</span>&nbsp;<span class="keyword" id="2933897">if</span>&nbsp;<span class="ident" id="2933900"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933901">.</span><span class="ident" id="2933902">table</span>&nbsp;<span class="op" id="2933908">!=</span>&nbsp;<span class="ident" id="2933911">nil</span>&nbsp;<span class="op" id="2933915">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2933919">//&nbsp;Insert&nbsp;into&nbsp;existing&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2933952">m</span>&nbsp;<span class="op" id="2933954">:=</span>&nbsp;<span class="ident" id="2933957"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2933958">.</span><span class="ident" id="2933959">mapping</span><span class="op" id="2933966">[</span><span class="ident" id="2933967"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2933970">[</span><span class="num" id="2933971">0</span><span class="op" id="2933972">]</span><span class="op" id="2933973">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2933977">if</span>&nbsp;<span class="ident" id="2933980"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2933981">.</span><span class="ident" id="2933982">table</span><span class="op" id="2933987">[</span><span class="ident" id="2933988"><a href="/strings/replace.go.html#2933952">m</a></span><span class="op" id="2933989">]</span>&nbsp;<span class="op" id="2933991">==</span>&nbsp;<span class="ident" id="2933994">nil</span>&nbsp;<span class="op" id="2933998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934003"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2934004">.</span><span class="ident" id="2934005">table</span><span class="op" id="2934010">[</span><span class="ident" id="2934011"><a href="/strings/replace.go.html#2933952">m</a></span><span class="op" id="2934012">]</span>&nbsp;<span class="op" id="2934014">=</span>&nbsp;<span class="builtinfunc" id="2934016">new</span><span class="op" id="2934019">(</span><span class="ident" id="2934020"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2934028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934032">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934036"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2934037">.</span><span class="ident" id="2934038">table</span><span class="op" id="2934043">[</span><span class="ident" id="2934044"><a href="/strings/replace.go.html#2933952">m</a></span><span class="op" id="2934045">]</span><span class="op" id="2934046">.</span><span class="ident" id="2934047">add</span><span class="op" id="2934050">(</span><span class="ident" id="2934051"><a href="/strings/replace.go.html#2932603">key</a></span><span class="op" id="2934054">[</span><span class="num" id="2934055">1</span><span class="op" id="2934056">:</span><span class="op" id="2934057">]</span><span class="op" id="2934058">,</span>&nbsp;<span class="ident" id="2934060"><a href="/strings/replace.go.html#2932608">val</a></span><span class="op" id="2934063">,</span>&nbsp;<span class="ident" id="2934065"><a href="/strings/replace.go.html#2932620">priority</a></span><span class="op" id="2934073">,</span>&nbsp;<span class="ident" id="2934075"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2934076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934079">}</span>&nbsp;<span class="keyword" id="2934081">else</span>&nbsp;<span class="op" id="2934086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934090"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2934091">.</span><span class="ident" id="2934092">prefix</span>&nbsp;<span class="op" id="2934099">=</span>&nbsp;<span class="ident" id="2934101"><a href="/strings/replace.go.html#2932603">key</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934107"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2934108">.</span><span class="ident" id="2934109">next</span>&nbsp;<span class="op" id="2934114">=</span>&nbsp;<span class="builtinfunc" id="2934116">new</span><span class="op" id="2934119">(</span><span class="ident" id="2934120"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2934128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934132"><a href="/strings/replace.go.html#2932586">t</a></span><span class="op" id="2934133">.</span><span class="ident" id="2934134">next</span><span class="op" id="2934138">.</span><span class="ident" id="2934139">add</span><span class="op" id="2934142">(</span><span class="string" id="2934143">&#34;&#34;</span><span class="op" id="2934145">,</span>&nbsp;<span class="ident" id="2934147"><a href="/strings/replace.go.html#2932608">val</a></span><span class="op" id="2934150">,</span>&nbsp;<span class="ident" id="2934152"><a href="/strings/replace.go.html#2932620">priority</a></span><span class="op" id="2934160">,</span>&nbsp;<span class="ident" id="2934162"><a href="/strings/replace.go.html#2932634">r</a></span><span class="op" id="2934163">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934166">}</span><br>
<span class="lineno"></span><span class="op" id="2934168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2934171">func</span>&nbsp;<span class="op" id="2934176">(</span><span class="ident" id="2934177">r</span>&nbsp;<span class="op" id="2934179">*</span><span class="ident" id="2934180"><a href="/strings/replace.go.html#2935057">genericReplacer</a></span><span class="op" id="2934195">)</span>&nbsp;<span class="ident" id="2934197">lookup</span><span class="op" id="2934203">(</span><span class="ident" id="2934204">s</span>&nbsp;<span class="builtintype" id="2934206">string</span><span class="op" id="2934212">,</span>&nbsp;<span class="ident" id="2934214">ignoreRoot</span>&nbsp;<span class="builtintype" id="2934225">bool</span><span class="op" id="2934229">)</span>&nbsp;<span class="op" id="2934231">(</span><span class="ident" id="2934232">val</span>&nbsp;<span class="builtintype" id="2934236">string</span><span class="op" id="2934242">,</span>&nbsp;<span class="ident" id="2934244">keylen</span>&nbsp;<span class="builtintype" id="2934251">int</span><span class="op" id="2934254">,</span>&nbsp;<span class="ident" id="2934256">found</span>&nbsp;<span class="builtintype" id="2934262">bool</span><span class="op" id="2934266">)</span>&nbsp;<span class="op" id="2934268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934271">//&nbsp;Iterate&nbsp;down&nbsp;the&nbsp;trie&nbsp;to&nbsp;the&nbsp;end,&nbsp;and&nbsp;grab&nbsp;the&nbsp;value&nbsp;and&nbsp;keylen&nbsp;with</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2934344">//&nbsp;the&nbsp;highest&nbsp;priority.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934370">bestPriority</span>&nbsp;<span class="op" id="2934383">:=</span>&nbsp;<span class="num" id="2934386">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934389">node</span>&nbsp;<span class="op" id="2934394">:=</span>&nbsp;<span class="op" id="2934397">&amp;</span><span class="ident" id="2934398"><a href="/strings/replace.go.html#2934177">r</a></span><span class="op" id="2934399">.</span><span class="ident" id="2934400">root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934406">n</span>&nbsp;<span class="op" id="2934408">:=</span>&nbsp;<span class="num" id="2934411">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934414">for</span>&nbsp;<span class="ident" id="2934418"><a href="/strings/replace.go.html#2934389">node</a></span>&nbsp;<span class="op" id="2934423">!=</span>&nbsp;<span class="ident" id="2934426">nil</span>&nbsp;<span class="op" id="2934430">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934434">if</span>&nbsp;<span class="ident" id="2934437"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934441">.</span><span class="ident" id="2934442">priority</span>&nbsp;<span class="op" id="2934451">&gt;</span>&nbsp;<span class="ident" id="2934453"><a href="/strings/replace.go.html#2934370">bestPriority</a></span>&nbsp;<span class="op" id="2934466">&amp;&amp;</span>&nbsp;<span class="op" id="2934469">!</span><span class="op" id="2934470">(</span><span class="ident" id="2934471"><a href="/strings/replace.go.html#2934214">ignoreRoot</a></span>&nbsp;<span class="op" id="2934482">&amp;&amp;</span>&nbsp;<span class="ident" id="2934485"><a href="/strings/replace.go.html#2934389">node</a></span>&nbsp;<span class="op" id="2934490">==</span>&nbsp;<span class="op" id="2934493">&amp;</span><span class="ident" id="2934494"><a href="/strings/replace.go.html#2934177">r</a></span><span class="op" id="2934495">.</span><span class="ident" id="2934496">root</span><span class="op" id="2934500">)</span>&nbsp;<span class="op" id="2934502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934507"><a href="/strings/replace.go.html#2934370">bestPriority</a></span>&nbsp;<span class="op" id="2934520">=</span>&nbsp;<span class="ident" id="2934522"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934526">.</span><span class="ident" id="2934527">priority</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934539"><a href="/strings/replace.go.html#2934232">val</a></span>&nbsp;<span class="op" id="2934543">=</span>&nbsp;<span class="ident" id="2934545"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934549">.</span><span class="ident" id="2934550">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934559"><a href="/strings/replace.go.html#2934244">keylen</a></span>&nbsp;<span class="op" id="2934566">=</span>&nbsp;<span class="ident" id="2934568"><a href="/strings/replace.go.html#2934406">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934573"><a href="/strings/replace.go.html#2934256">found</a></span>&nbsp;<span class="op" id="2934579">=</span>&nbsp;<span class="ident" id="2934581">true</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934593">if</span>&nbsp;<span class="ident" id="2934596"><a href="/strings/replace.go.html#2934204">s</a></span>&nbsp;<span class="op" id="2934598">==</span>&nbsp;<span class="string" id="2934601">&#34;&#34;</span>&nbsp;<span class="op" id="2934604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934609">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934617">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934621">if</span>&nbsp;<span class="ident" id="2934624"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934628">.</span><span class="ident" id="2934629">table</span>&nbsp;<span class="op" id="2934635">!=</span>&nbsp;<span class="ident" id="2934638">nil</span>&nbsp;<span class="op" id="2934642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934647">index</span>&nbsp;<span class="op" id="2934653">:=</span>&nbsp;<span class="ident" id="2934656"><a href="/strings/replace.go.html#2934177">r</a></span><span class="op" id="2934657">.</span><span class="ident" id="2934658">mapping</span><span class="op" id="2934665">[</span><span class="ident" id="2934666"><a href="/strings/replace.go.html#2934204">s</a></span><span class="op" id="2934667">[</span><span class="num" id="2934668">0</span><span class="op" id="2934669">]</span><span class="op" id="2934670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934675">if</span>&nbsp;<span class="builtintype" id="2934678">int</span><span class="op" id="2934681">(</span><span class="ident" id="2934682"><a href="/strings/replace.go.html#2934647">index</a></span><span class="op" id="2934687">)</span>&nbsp;<span class="op" id="2934689">==</span>&nbsp;<span class="ident" id="2934692"><a href="/strings/replace.go.html#2934177">r</a></span><span class="op" id="2934693">.</span><span class="ident" id="2934694">tableSize</span>&nbsp;<span class="op" id="2934704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934710">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934719">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934724"><a href="/strings/replace.go.html#2934389">node</a></span>&nbsp;<span class="op" id="2934729">=</span>&nbsp;<span class="ident" id="2934731"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934735">.</span><span class="ident" id="2934736">table</span><span class="op" id="2934741">[</span><span class="ident" id="2934742"><a href="/strings/replace.go.html#2934647">index</a></span><span class="op" id="2934747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934752"><a href="/strings/replace.go.html#2934204">s</a></span>&nbsp;<span class="op" id="2934754">=</span>&nbsp;<span class="ident" id="2934756"><a href="/strings/replace.go.html#2934204">s</a></span><span class="op" id="2934757">[</span><span class="num" id="2934758">1</span><span class="op" id="2934759">:</span><span class="op" id="2934760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934765"><a href="/strings/replace.go.html#2934406">n</a></span><span class="op" id="2934766">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934771">}</span>&nbsp;<span class="keyword" id="2934773">else</span>&nbsp;<span class="keyword" id="2934778">if</span>&nbsp;<span class="ident" id="2934781"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934785">.</span><span class="ident" id="2934786">prefix</span>&nbsp;<span class="op" id="2934793">!=</span>&nbsp;<span class="string" id="2934796">&#34;&#34;</span>&nbsp;<span class="op" id="2934799">&amp;&amp;</span>&nbsp;<span class="ident" id="2934802"><a href="/strings/strings.go.html#2955362">HasPrefix</a></span><span class="op" id="2934811">(</span><span class="ident" id="2934812"><a href="/strings/replace.go.html#2934204">s</a></span><span class="op" id="2934813">,</span>&nbsp;<span class="ident" id="2934815"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934819">.</span><span class="ident" id="2934820">prefix</span><span class="op" id="2934826">)</span>&nbsp;<span class="op" id="2934828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934833"><a href="/strings/replace.go.html#2934406">n</a></span>&nbsp;<span class="op" id="2934835">+=</span>&nbsp;<span class="builtinfunc" id="2934838">len</span><span class="op" id="2934841">(</span><span class="ident" id="2934842"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934846">.</span><span class="ident" id="2934847">prefix</span><span class="op" id="2934853">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934858"><a href="/strings/replace.go.html#2934204">s</a></span>&nbsp;<span class="op" id="2934860">=</span>&nbsp;<span class="ident" id="2934862"><a href="/strings/replace.go.html#2934204">s</a></span><span class="op" id="2934863">[</span><span class="builtinfunc" id="2934864">len</span><span class="op" id="2934867">(</span><span class="ident" id="2934868"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934872">.</span><span class="ident" id="2934873">prefix</span><span class="op" id="2934879">)</span><span class="op" id="2934880">:</span><span class="op" id="2934881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2934886"><a href="/strings/replace.go.html#2934389">node</a></span>&nbsp;<span class="op" id="2934891">=</span>&nbsp;<span class="ident" id="2934893"><a href="/strings/replace.go.html#2934389">node</a></span><span class="op" id="2934897">.</span><span class="ident" id="2934898">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934905">}</span>&nbsp;<span class="keyword" id="2934907">else</span>&nbsp;<span class="op" id="2934912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934917">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934925">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2934928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2934931">return</span><br>
<span class="lineno"></span><span class="op" id="2934938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2934941">//&nbsp;genericReplacer&nbsp;is&nbsp;the&nbsp;fully&nbsp;generic&nbsp;algorithm.</span><br>
<span class="lineno">230</span><span class="comment" id="2934992">//&nbsp;It&#39;s&nbsp;used&nbsp;as&nbsp;a&nbsp;fallback&nbsp;when&nbsp;nothing&nbsp;faster&nbsp;can&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2935052">type</span>&nbsp;<span class="ident" id="2935057">genericReplacer</span>&nbsp;<span class="keyword" id="2935073">struct</span>&nbsp;<span class="op" id="2935080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935083">root</span>&nbsp;<span class="ident" id="2935088"><a href="/strings/replace.go.html#2930978">trieNode</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2935098">//&nbsp;tableSize&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;a&nbsp;trie&nbsp;node&#39;s&nbsp;lookup&nbsp;table.&nbsp;It&nbsp;is&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2935172">//&nbsp;of&nbsp;unique&nbsp;key&nbsp;bytes.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935197">tableSize</span>&nbsp;<span class="builtintype" id="2935207">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2935212">//&nbsp;mapping&nbsp;maps&nbsp;from&nbsp;key&nbsp;bytes&nbsp;to&nbsp;a&nbsp;dense&nbsp;index&nbsp;for&nbsp;trieNode.table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935281">mapping</span>&nbsp;<span class="op" id="2935289">[</span><span class="num" id="2935290">256</span><span class="op" id="2935293">]</span><span class="builtintype" id="2935294">byte</span><br>
<span class="lineno"></span><span class="op" id="2935299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="2935302">func</span>&nbsp;<span class="ident" id="2935307">makeGenericReplacer</span><span class="op" id="2935326">(</span><span class="ident" id="2935327">oldnew</span>&nbsp;<span class="op" id="2935334">[</span><span class="op" id="2935335">]</span><span class="builtintype" id="2935336">string</span><span class="op" id="2935342">)</span>&nbsp;<span class="op" id="2935344">*</span><span class="ident" id="2935345"><a href="/strings/replace.go.html#2935057">genericReplacer</a></span>&nbsp;<span class="op" id="2935361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935364">r</span>&nbsp;<span class="op" id="2935366">:=</span>&nbsp;<span class="builtinfunc" id="2935369">new</span><span class="op" id="2935372">(</span><span class="ident" id="2935373"><a href="/strings/replace.go.html#2935057">genericReplacer</a></span><span class="op" id="2935388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2935391">//&nbsp;Find&nbsp;each&nbsp;byte&nbsp;used,&nbsp;then&nbsp;assign&nbsp;them&nbsp;each&nbsp;an&nbsp;index.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935448">for</span>&nbsp;<span class="ident" id="2935452">i</span>&nbsp;<span class="op" id="2935454">:=</span>&nbsp;<span class="num" id="2935457">0</span><span class="op" id="2935458">;</span>&nbsp;<span class="ident" id="2935460"><a href="/strings/replace.go.html#2935452">i</a></span>&nbsp;<span class="op" id="2935462">&lt;</span>&nbsp;<span class="builtinfunc" id="2935464">len</span><span class="op" id="2935467">(</span><span class="ident" id="2935468"><a href="/strings/replace.go.html#2935327">oldnew</a></span><span class="op" id="2935474">)</span><span class="op" id="2935475">;</span>&nbsp;<span class="ident" id="2935477"><a href="/strings/replace.go.html#2935452">i</a></span>&nbsp;<span class="op" id="2935479">+=</span>&nbsp;<span class="num" id="2935482">2</span>&nbsp;<span class="op" id="2935484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935488">key</span>&nbsp;<span class="op" id="2935492">:=</span>&nbsp;<span class="ident" id="2935495"><a href="/strings/replace.go.html#2935327">oldnew</a></span><span class="op" id="2935501">[</span><span class="ident" id="2935502"><a href="/strings/replace.go.html#2935452">i</a></span><span class="op" id="2935503">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935507">for</span>&nbsp;<span class="ident" id="2935511">j</span>&nbsp;<span class="op" id="2935513">:=</span>&nbsp;<span class="num" id="2935516">0</span><span class="op" id="2935517">;</span>&nbsp;<span class="ident" id="2935519"><a href="/strings/replace.go.html#2935511">j</a></span>&nbsp;<span class="op" id="2935521">&lt;</span>&nbsp;<span class="builtinfunc" id="2935523">len</span><span class="op" id="2935526">(</span><span class="ident" id="2935527"><a href="/strings/replace.go.html#2935488">key</a></span><span class="op" id="2935530">)</span><span class="op" id="2935531">;</span>&nbsp;<span class="ident" id="2935533"><a href="/strings/replace.go.html#2935511">j</a></span><span class="op" id="2935534">++</span>&nbsp;<span class="op" id="2935537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935542"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935543">.</span><span class="ident" id="2935544">mapping</span><span class="op" id="2935551">[</span><span class="ident" id="2935552"><a href="/strings/replace.go.html#2935488">key</a></span><span class="op" id="2935555">[</span><span class="ident" id="2935556"><a href="/strings/replace.go.html#2935511">j</a></span><span class="op" id="2935557">]</span><span class="op" id="2935558">]</span>&nbsp;<span class="op" id="2935560">=</span>&nbsp;<span class="num" id="2935562">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935573">for</span>&nbsp;<span class="ident" id="2935577">_</span><span class="op" id="2935578">,</span>&nbsp;<span class="ident" id="2935580">b</span>&nbsp;<span class="op" id="2935582">:=</span>&nbsp;<span class="keyword" id="2935585">range</span>&nbsp;<span class="ident" id="2935591"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935592">.</span><span class="ident" id="2935593">mapping</span>&nbsp;<span class="op" id="2935601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935605"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935606">.</span><span class="ident" id="2935607">tableSize</span>&nbsp;<span class="op" id="2935617">+=</span>&nbsp;<span class="builtintype" id="2935620">int</span><span class="op" id="2935623">(</span><span class="ident" id="2935624"><a href="/strings/replace.go.html#2935580">b</a></span><span class="op" id="2935625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935632">var</span>&nbsp;<span class="ident" id="2935636">index</span>&nbsp;<span class="builtintype" id="2935642">byte</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935648">for</span>&nbsp;<span class="ident" id="2935652">i</span><span class="op" id="2935653">,</span>&nbsp;<span class="ident" id="2935655">b</span>&nbsp;<span class="op" id="2935657">:=</span>&nbsp;<span class="keyword" id="2935660">range</span>&nbsp;<span class="ident" id="2935666"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935667">.</span><span class="ident" id="2935668">mapping</span>&nbsp;<span class="op" id="2935676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935680">if</span>&nbsp;<span class="ident" id="2935683"><a href="/strings/replace.go.html#2935655">b</a></span>&nbsp;<span class="op" id="2935685">==</span>&nbsp;<span class="num" id="2935688">0</span>&nbsp;<span class="op" id="2935690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935695"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935696">.</span><span class="ident" id="2935697">mapping</span><span class="op" id="2935704">[</span><span class="ident" id="2935705"><a href="/strings/replace.go.html#2935652">i</a></span><span class="op" id="2935706">]</span>&nbsp;<span class="op" id="2935708">=</span>&nbsp;<span class="builtintype" id="2935710">byte</span><span class="op" id="2935714">(</span><span class="ident" id="2935715"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935716">.</span><span class="ident" id="2935717">tableSize</span><span class="op" id="2935726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935730">}</span>&nbsp;<span class="keyword" id="2935732">else</span>&nbsp;<span class="op" id="2935737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935742"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935743">.</span><span class="ident" id="2935744">mapping</span><span class="op" id="2935751">[</span><span class="ident" id="2935752"><a href="/strings/replace.go.html#2935652">i</a></span><span class="op" id="2935753">]</span>&nbsp;<span class="op" id="2935755">=</span>&nbsp;<span class="ident" id="2935757"><a href="/strings/replace.go.html#2935636">index</a></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935766"><a href="/strings/replace.go.html#2935636">index</a></span><span class="op" id="2935771">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2935782">//&nbsp;Ensure&nbsp;root&nbsp;node&nbsp;uses&nbsp;a&nbsp;lookup&nbsp;table&nbsp;(for&nbsp;performance).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935842"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935843">.</span><span class="ident" id="2935844">root</span><span class="op" id="2935848">.</span><span class="ident" id="2935849">table</span>&nbsp;<span class="op" id="2935855">=</span>&nbsp;<span class="builtinfunc" id="2935857">make</span><span class="op" id="2935861">(</span><span class="op" id="2935862">[</span><span class="op" id="2935863">]</span><span class="op" id="2935864">*</span><span class="ident" id="2935865"><a href="/strings/replace.go.html#2930978">trieNode</a></span><span class="op" id="2935873">,</span>&nbsp;<span class="ident" id="2935875"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935876">.</span><span class="ident" id="2935877">tableSize</span><span class="op" id="2935886">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935890">for</span>&nbsp;<span class="ident" id="2935894">i</span>&nbsp;<span class="op" id="2935896">:=</span>&nbsp;<span class="num" id="2935899">0</span><span class="op" id="2935900">;</span>&nbsp;<span class="ident" id="2935902"><a href="/strings/replace.go.html#2935894">i</a></span>&nbsp;<span class="op" id="2935904">&lt;</span>&nbsp;<span class="builtinfunc" id="2935906">len</span><span class="op" id="2935909">(</span><span class="ident" id="2935910"><a href="/strings/replace.go.html#2935327">oldnew</a></span><span class="op" id="2935916">)</span><span class="op" id="2935917">;</span>&nbsp;<span class="ident" id="2935919"><a href="/strings/replace.go.html#2935894">i</a></span>&nbsp;<span class="op" id="2935921">+=</span>&nbsp;<span class="num" id="2935924">2</span>&nbsp;<span class="op" id="2935926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2935930"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935931">.</span><span class="ident" id="2935932">root</span><span class="op" id="2935936">.</span><span class="ident" id="2935937">add</span><span class="op" id="2935940">(</span><span class="ident" id="2935941"><a href="/strings/replace.go.html#2935327">oldnew</a></span><span class="op" id="2935947">[</span><span class="ident" id="2935948"><a href="/strings/replace.go.html#2935894">i</a></span><span class="op" id="2935949">]</span><span class="op" id="2935950">,</span>&nbsp;<span class="ident" id="2935952"><a href="/strings/replace.go.html#2935327">oldnew</a></span><span class="op" id="2935958">[</span><span class="ident" id="2935959"><a href="/strings/replace.go.html#2935894">i</a></span><span class="op" id="2935960">+</span><span class="num" id="2935961">1</span><span class="op" id="2935962">]</span><span class="op" id="2935963">,</span>&nbsp;<span class="builtinfunc" id="2935965">len</span><span class="op" id="2935968">(</span><span class="ident" id="2935969"><a href="/strings/replace.go.html#2935327">oldnew</a></span><span class="op" id="2935975">)</span><span class="op" id="2935976">-</span><span class="ident" id="2935977"><a href="/strings/replace.go.html#2935894">i</a></span><span class="op" id="2935978">,</span>&nbsp;<span class="ident" id="2935980"><a href="/strings/replace.go.html#2935364">r</a></span><span class="op" id="2935981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2935984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2935987">return</span>&nbsp;<span class="ident" id="2935994"><a href="/strings/replace.go.html#2935364">r</a></span><br>
<span class="lineno">270</span><span class="op" id="2935996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2935999">type</span>&nbsp;<span class="ident" id="2936004">appendSliceWriter</span>&nbsp;<span class="op" id="2936022">[</span><span class="op" id="2936023">]</span><span class="builtintype" id="2936024">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2936030">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;buffer&nbsp;to&nbsp;satisfy&nbsp;io.Writer.</span><br>
<span class="lineno">275</span><span class="keyword" id="2936082">func</span>&nbsp;<span class="op" id="2936087">(</span><span class="ident" id="2936088">w</span>&nbsp;<span class="op" id="2936090">*</span><span class="ident" id="2936091"><a href="/strings/replace.go.html#2936004">appendSliceWriter</a></span><span class="op" id="2936108">)</span>&nbsp;<span class="ident" id="2936110">Write</span><span class="op" id="2936115">(</span><span class="ident" id="2936116">p</span>&nbsp;<span class="op" id="2936118">[</span><span class="op" id="2936119">]</span><span class="builtintype" id="2936120">byte</span><span class="op" id="2936124">)</span>&nbsp;<span class="op" id="2936126">(</span><span class="builtintype" id="2936127">int</span><span class="op" id="2936130">,</span>&nbsp;<span class="builtintype" id="2936132">error</span><span class="op" id="2936137">)</span>&nbsp;<span class="op" id="2936139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936142">*</span><span class="ident" id="2936143"><a href="/strings/replace.go.html#2936088">w</a></span>&nbsp;<span class="op" id="2936145">=</span>&nbsp;<span class="builtinfunc" id="2936147">append</span><span class="op" id="2936153">(</span><span class="op" id="2936154">*</span><span class="ident" id="2936155"><a href="/strings/replace.go.html#2936088">w</a></span><span class="op" id="2936156">,</span>&nbsp;<span class="ident" id="2936158"><a href="/strings/replace.go.html#2936116">p</a></span><span class="op" id="2936159">...</span><span class="op" id="2936162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936165">return</span>&nbsp;<span class="builtinfunc" id="2936172">len</span><span class="op" id="2936175">(</span><span class="ident" id="2936176"><a href="/strings/replace.go.html#2936116">p</a></span><span class="op" id="2936177">)</span><span class="op" id="2936178">,</span>&nbsp;<span class="ident" id="2936180">nil</span><br>
<span class="lineno"></span><span class="op" id="2936184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="comment" id="2936187">//&nbsp;WriteString&nbsp;writes&nbsp;to&nbsp;the&nbsp;buffer&nbsp;without&nbsp;string-&gt;[]byte-&gt;string&nbsp;allocations.</span><br>
<span class="lineno"></span><span class="keyword" id="2936267">func</span>&nbsp;<span class="op" id="2936272">(</span><span class="ident" id="2936273">w</span>&nbsp;<span class="op" id="2936275">*</span><span class="ident" id="2936276"><a href="/strings/replace.go.html#2936004">appendSliceWriter</a></span><span class="op" id="2936293">)</span>&nbsp;<span class="ident" id="2936295">WriteString</span><span class="op" id="2936306">(</span><span class="ident" id="2936307">s</span>&nbsp;<span class="builtintype" id="2936309">string</span><span class="op" id="2936315">)</span>&nbsp;<span class="op" id="2936317">(</span><span class="builtintype" id="2936318">int</span><span class="op" id="2936321">,</span>&nbsp;<span class="builtintype" id="2936323">error</span><span class="op" id="2936328">)</span>&nbsp;<span class="op" id="2936330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936333">*</span><span class="ident" id="2936334"><a href="/strings/replace.go.html#2936273">w</a></span>&nbsp;<span class="op" id="2936336">=</span>&nbsp;<span class="builtinfunc" id="2936338">append</span><span class="op" id="2936344">(</span><span class="op" id="2936345">*</span><span class="ident" id="2936346"><a href="/strings/replace.go.html#2936273">w</a></span><span class="op" id="2936347">,</span>&nbsp;<span class="ident" id="2936349"><a href="/strings/replace.go.html#2936307">s</a></span><span class="op" id="2936350">...</span><span class="op" id="2936353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936356">return</span>&nbsp;<span class="builtinfunc" id="2936363">len</span><span class="op" id="2936366">(</span><span class="ident" id="2936367"><a href="/strings/replace.go.html#2936307">s</a></span><span class="op" id="2936368">)</span><span class="op" id="2936369">,</span>&nbsp;<span class="ident" id="2936371">nil</span><br>
<span class="lineno"></span><span class="op" id="2936375">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="2936378">type</span>&nbsp;<span class="ident" id="2936383">stringWriterIface</span>&nbsp;<span class="keyword" id="2936401">interface</span>&nbsp;<span class="op" id="2936411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936414">WriteString</span><span class="op" id="2936425">(</span><span class="builtintype" id="2936426">string</span><span class="op" id="2936432">)</span>&nbsp;<span class="op" id="2936434">(</span><span class="builtintype" id="2936435">int</span><span class="op" id="2936438">,</span>&nbsp;<span class="builtintype" id="2936440">error</span><span class="op" id="2936445">)</span><br>
<span class="lineno"></span><span class="op" id="2936447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="2936450">type</span>&nbsp;<span class="ident" id="2936455">stringWriter</span>&nbsp;<span class="keyword" id="2936468">struct</span>&nbsp;<span class="op" id="2936475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936478">w</span>&nbsp;<span class="ident" id="2936480"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2936482">.</span><span class="ident" id="2936483">Writer</span><br>
<span class="lineno"></span><span class="op" id="2936490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2936493">func</span>&nbsp;<span class="op" id="2936498">(</span><span class="ident" id="2936499">w</span>&nbsp;<span class="ident" id="2936501"><a href="/strings/replace.go.html#2936455">stringWriter</a></span><span class="op" id="2936513">)</span>&nbsp;<span class="ident" id="2936515">WriteString</span><span class="op" id="2936526">(</span><span class="ident" id="2936527">s</span>&nbsp;<span class="builtintype" id="2936529">string</span><span class="op" id="2936535">)</span>&nbsp;<span class="op" id="2936537">(</span><span class="builtintype" id="2936538">int</span><span class="op" id="2936541">,</span>&nbsp;<span class="builtintype" id="2936543">error</span><span class="op" id="2936548">)</span>&nbsp;<span class="op" id="2936550">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936553">return</span>&nbsp;<span class="ident" id="2936560"><a href="/strings/replace.go.html#2936499">w</a></span><span class="op" id="2936561">.</span><span class="ident" id="2936562">w</span><span class="op" id="2936563">.</span><span class="ident" id="2936564">Write</span><span class="op" id="2936569">(</span><span class="op" id="2936570">[</span><span class="op" id="2936571">]</span><span class="builtintype" id="2936572">byte</span><span class="op" id="2936576">(</span><span class="ident" id="2936577"><a href="/strings/replace.go.html#2936527">s</a></span><span class="op" id="2936578">)</span><span class="op" id="2936579">)</span><br>
<span class="lineno"></span><span class="op" id="2936581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2936584">func</span>&nbsp;<span class="ident" id="2936589">getStringWriter</span><span class="op" id="2936604">(</span><span class="ident" id="2936605">w</span>&nbsp;<span class="ident" id="2936607"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2936609">.</span><span class="ident" id="2936610">Writer</span><span class="op" id="2936616">)</span>&nbsp;<span class="ident" id="2936618"><a href="/strings/replace.go.html#2936383">stringWriterIface</a></span>&nbsp;<span class="op" id="2936636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936639">sw</span><span class="op" id="2936641">,</span>&nbsp;<span class="ident" id="2936643">ok</span>&nbsp;<span class="op" id="2936646">:=</span>&nbsp;<span class="ident" id="2936649"><a href="/strings/replace.go.html#2936605">w</a></span><span class="op" id="2936650">.</span><span class="op" id="2936651">(</span><span class="ident" id="2936652"><a href="/strings/replace.go.html#2936383">stringWriterIface</a></span><span class="op" id="2936669">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936672">if</span>&nbsp;<span class="op" id="2936675">!</span><span class="ident" id="2936676"><a href="/strings/replace.go.html#2936643">ok</a></span>&nbsp;<span class="op" id="2936679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936683"><a href="/strings/replace.go.html#2936639">sw</a></span>&nbsp;<span class="op" id="2936686">=</span>&nbsp;<span class="ident" id="2936688"><a href="/strings/replace.go.html#2936455">stringWriter</a></span><span class="op" id="2936700">{</span><span class="ident" id="2936701"><a href="/strings/replace.go.html#2936605">w</a></span><span class="op" id="2936702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2936705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936708">return</span>&nbsp;<span class="ident" id="2936715"><a href="/strings/replace.go.html#2936639">sw</a></span><br>
<span class="lineno"></span><span class="op" id="2936718">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="2936721">func</span>&nbsp;<span class="op" id="2936726">(</span><span class="ident" id="2936727">r</span>&nbsp;<span class="op" id="2936729">*</span><span class="ident" id="2936730"><a href="/strings/replace.go.html#2935057">genericReplacer</a></span><span class="op" id="2936745">)</span>&nbsp;<span class="ident" id="2936747">Replace</span><span class="op" id="2936754">(</span><span class="ident" id="2936755">s</span>&nbsp;<span class="builtintype" id="2936757">string</span><span class="op" id="2936763">)</span>&nbsp;<span class="builtintype" id="2936765">string</span>&nbsp;<span class="op" id="2936772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936775">buf</span>&nbsp;<span class="op" id="2936779">:=</span>&nbsp;<span class="builtinfunc" id="2936782">make</span><span class="op" id="2936786">(</span><span class="ident" id="2936787"><a href="/strings/replace.go.html#2936004">appendSliceWriter</a></span><span class="op" id="2936804">,</span>&nbsp;<span class="num" id="2936806">0</span><span class="op" id="2936807">,</span>&nbsp;<span class="builtinfunc" id="2936809">len</span><span class="op" id="2936812">(</span><span class="ident" id="2936813"><a href="/strings/replace.go.html#2936755">s</a></span><span class="op" id="2936814">)</span><span class="op" id="2936815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936818"><a href="/strings/replace.go.html#2936727">r</a></span><span class="op" id="2936819">.</span><span class="ident" id="2936820">WriteString</span><span class="op" id="2936831">(</span><span class="op" id="2936832">&amp;</span><span class="ident" id="2936833"><a href="/strings/replace.go.html#2936775">buf</a></span><span class="op" id="2936836">,</span>&nbsp;<span class="ident" id="2936838"><a href="/strings/replace.go.html#2936755">s</a></span><span class="op" id="2936839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936842">return</span>&nbsp;<span class="builtintype" id="2936849">string</span><span class="op" id="2936855">(</span><span class="ident" id="2936856"><a href="/strings/replace.go.html#2936775">buf</a></span><span class="op" id="2936859">)</span><br>
<span class="lineno">310</span><span class="op" id="2936861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2936864">func</span>&nbsp;<span class="op" id="2936869">(</span><span class="ident" id="2936870">r</span>&nbsp;<span class="op" id="2936872">*</span><span class="ident" id="2936873"><a href="/strings/replace.go.html#2935057">genericReplacer</a></span><span class="op" id="2936888">)</span>&nbsp;<span class="ident" id="2936890">WriteString</span><span class="op" id="2936901">(</span><span class="ident" id="2936902">w</span>&nbsp;<span class="ident" id="2936904"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2936906">.</span><span class="ident" id="2936907">Writer</span><span class="op" id="2936913">,</span>&nbsp;<span class="ident" id="2936915">s</span>&nbsp;<span class="builtintype" id="2936917">string</span><span class="op" id="2936923">)</span>&nbsp;<span class="op" id="2936925">(</span><span class="ident" id="2936926">n</span>&nbsp;<span class="builtintype" id="2936928">int</span><span class="op" id="2936931">,</span>&nbsp;<span class="ident" id="2936933">err</span>&nbsp;<span class="builtintype" id="2936937">error</span><span class="op" id="2936942">)</span>&nbsp;<span class="op" id="2936944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2936947">sw</span>&nbsp;<span class="op" id="2936950">:=</span>&nbsp;<span class="ident" id="2936953"><a href="/strings/replace.go.html#2936589">getStringWriter</a></span><span class="op" id="2936968">(</span><span class="ident" id="2936969"><a href="/strings/replace.go.html#2936902">w</a></span><span class="op" id="2936970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936973">var</span>&nbsp;<span class="ident" id="2936977">last</span><span class="op" id="2936981">,</span>&nbsp;<span class="ident" id="2936983">wn</span>&nbsp;<span class="builtintype" id="2936986">int</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2936991">var</span>&nbsp;<span class="ident" id="2936995">prevMatchEmpty</span>&nbsp;<span class="builtintype" id="2937010">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937016">for</span>&nbsp;<span class="ident" id="2937020">i</span>&nbsp;<span class="op" id="2937022">:=</span>&nbsp;<span class="num" id="2937025">0</span><span class="op" id="2937026">;</span>&nbsp;<span class="ident" id="2937028"><a href="/strings/replace.go.html#2937020">i</a></span>&nbsp;<span class="op" id="2937030">&lt;=</span>&nbsp;<span class="builtinfunc" id="2937033">len</span><span class="op" id="2937036">(</span><span class="ident" id="2937037"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937038">)</span><span class="op" id="2937039">;</span>&nbsp;<span class="op" id="2937041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2937045">//&nbsp;Fast&nbsp;path:&nbsp;s[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix&nbsp;of&nbsp;any&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937098">if</span>&nbsp;<span class="ident" id="2937101"><a href="/strings/replace.go.html#2937020">i</a></span>&nbsp;<span class="op" id="2937103">!=</span>&nbsp;<span class="builtinfunc" id="2937106">len</span><span class="op" id="2937109">(</span><span class="ident" id="2937110"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937111">)</span>&nbsp;<span class="op" id="2937113">&amp;&amp;</span>&nbsp;<span class="ident" id="2937116"><a href="/strings/replace.go.html#2936870">r</a></span><span class="op" id="2937117">.</span><span class="ident" id="2937118">root</span><span class="op" id="2937122">.</span><span class="ident" id="2937123">priority</span>&nbsp;<span class="op" id="2937132">==</span>&nbsp;<span class="num" id="2937135">0</span>&nbsp;<span class="op" id="2937137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937142">index</span>&nbsp;<span class="op" id="2937148">:=</span>&nbsp;<span class="builtintype" id="2937151">int</span><span class="op" id="2937154">(</span><span class="ident" id="2937155"><a href="/strings/replace.go.html#2936870">r</a></span><span class="op" id="2937156">.</span><span class="ident" id="2937157">mapping</span><span class="op" id="2937164">[</span><span class="ident" id="2937165"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937166">[</span><span class="ident" id="2937167"><a href="/strings/replace.go.html#2937020">i</a></span><span class="op" id="2937168">]</span><span class="op" id="2937169">]</span><span class="op" id="2937170">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937175">if</span>&nbsp;<span class="ident" id="2937178"><a href="/strings/replace.go.html#2937142">index</a></span>&nbsp;<span class="op" id="2937184">==</span>&nbsp;<span class="ident" id="2937187"><a href="/strings/replace.go.html#2936870">r</a></span><span class="op" id="2937188">.</span><span class="ident" id="2937189">tableSize</span>&nbsp;<span class="op" id="2937199">||</span>&nbsp;<span class="ident" id="2937202"><a href="/strings/replace.go.html#2936870">r</a></span><span class="op" id="2937203">.</span><span class="ident" id="2937204">root</span><span class="op" id="2937208">.</span><span class="ident" id="2937209">table</span><span class="op" id="2937214">[</span><span class="ident" id="2937215"><a href="/strings/replace.go.html#2937142">index</a></span><span class="op" id="2937220">]</span>&nbsp;<span class="op" id="2937222">==</span>&nbsp;<span class="ident" id="2937225">nil</span>&nbsp;<span class="op" id="2937229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937235"><a href="/strings/replace.go.html#2937020">i</a></span><span class="op" id="2937236">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937243">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937259">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2937264">//&nbsp;Ignore&nbsp;the&nbsp;empty&nbsp;match&nbsp;iff&nbsp;the&nbsp;previous&nbsp;loop&nbsp;found&nbsp;the&nbsp;empty&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937337">val</span><span class="op" id="2937340">,</span>&nbsp;<span class="ident" id="2937342">keylen</span><span class="op" id="2937348">,</span>&nbsp;<span class="ident" id="2937350">match</span>&nbsp;<span class="op" id="2937356">:=</span>&nbsp;<span class="ident" id="2937359"><a href="/strings/replace.go.html#2936870">r</a></span><span class="op" id="2937360">.</span><span class="ident" id="2937361">lookup</span><span class="op" id="2937367">(</span><span class="ident" id="2937368"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937369">[</span><span class="ident" id="2937370"><a href="/strings/replace.go.html#2937020">i</a></span><span class="op" id="2937371">:</span><span class="op" id="2937372">]</span><span class="op" id="2937373">,</span>&nbsp;<span class="ident" id="2937375"><a href="/strings/replace.go.html#2936995">prevMatchEmpty</a></span><span class="op" id="2937389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937393"><a href="/strings/replace.go.html#2936995">prevMatchEmpty</a></span>&nbsp;<span class="op" id="2937408">=</span>&nbsp;<span class="ident" id="2937410"><a href="/strings/replace.go.html#2937350">match</a></span>&nbsp;<span class="op" id="2937416">&amp;&amp;</span>&nbsp;<span class="ident" id="2937419"><a href="/strings/replace.go.html#2937342">keylen</a></span>&nbsp;<span class="op" id="2937426">==</span>&nbsp;<span class="num" id="2937429">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937433">if</span>&nbsp;<span class="ident" id="2937436"><a href="/strings/replace.go.html#2937350">match</a></span>&nbsp;<span class="op" id="2937442">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937447"><a href="/strings/replace.go.html#2936983">wn</a></span><span class="op" id="2937449">,</span>&nbsp;<span class="ident" id="2937451"><a href="/strings/replace.go.html#2936933">err</a></span>&nbsp;<span class="op" id="2937455">=</span>&nbsp;<span class="ident" id="2937457"><a href="/strings/replace.go.html#2936947">sw</a></span><span class="op" id="2937459">.</span><span class="ident" id="2937460">WriteString</span><span class="op" id="2937471">(</span><span class="ident" id="2937472"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937473">[</span><span class="ident" id="2937474"><a href="/strings/replace.go.html#2936977">last</a></span><span class="op" id="2937478">:</span><span class="ident" id="2937479"><a href="/strings/replace.go.html#2937020">i</a></span><span class="op" id="2937480">]</span><span class="op" id="2937481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937486"><a href="/strings/replace.go.html#2936926">n</a></span>&nbsp;<span class="op" id="2937488">+=</span>&nbsp;<span class="ident" id="2937491"><a href="/strings/replace.go.html#2936983">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937497">if</span>&nbsp;<span class="ident" id="2937500"><a href="/strings/replace.go.html#2936933">err</a></span>&nbsp;<span class="op" id="2937504">!=</span>&nbsp;<span class="ident" id="2937507">nil</span>&nbsp;<span class="op" id="2937511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937517">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937527">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937532"><a href="/strings/replace.go.html#2936983">wn</a></span><span class="op" id="2937534">,</span>&nbsp;<span class="ident" id="2937536"><a href="/strings/replace.go.html#2936933">err</a></span>&nbsp;<span class="op" id="2937540">=</span>&nbsp;<span class="ident" id="2937542"><a href="/strings/replace.go.html#2936947">sw</a></span><span class="op" id="2937544">.</span><span class="ident" id="2937545">WriteString</span><span class="op" id="2937556">(</span><span class="ident" id="2937557"><a href="/strings/replace.go.html#2937337">val</a></span><span class="op" id="2937560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937565"><a href="/strings/replace.go.html#2936926">n</a></span>&nbsp;<span class="op" id="2937567">+=</span>&nbsp;<span class="ident" id="2937570"><a href="/strings/replace.go.html#2936983">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937576">if</span>&nbsp;<span class="ident" id="2937579"><a href="/strings/replace.go.html#2936933">err</a></span>&nbsp;<span class="op" id="2937583">!=</span>&nbsp;<span class="ident" id="2937586">nil</span>&nbsp;<span class="op" id="2937590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937606">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937611"><a href="/strings/replace.go.html#2937020">i</a></span>&nbsp;<span class="op" id="2937613">+=</span>&nbsp;<span class="ident" id="2937616"><a href="/strings/replace.go.html#2937342">keylen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937626"><a href="/strings/replace.go.html#2936977">last</a></span>&nbsp;<span class="op" id="2937631">=</span>&nbsp;<span class="ident" id="2937633"><a href="/strings/replace.go.html#2937020">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937638">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937653"><a href="/strings/replace.go.html#2937020">i</a></span><span class="op" id="2937654">++</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937661">if</span>&nbsp;<span class="ident" id="2937664"><a href="/strings/replace.go.html#2936977">last</a></span>&nbsp;<span class="op" id="2937669">!=</span>&nbsp;<span class="builtinfunc" id="2937672">len</span><span class="op" id="2937675">(</span><span class="ident" id="2937676"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937677">)</span>&nbsp;<span class="op" id="2937679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937683"><a href="/strings/replace.go.html#2936983">wn</a></span><span class="op" id="2937685">,</span>&nbsp;<span class="ident" id="2937687"><a href="/strings/replace.go.html#2936933">err</a></span>&nbsp;<span class="op" id="2937691">=</span>&nbsp;<span class="ident" id="2937693"><a href="/strings/replace.go.html#2936947">sw</a></span><span class="op" id="2937695">.</span><span class="ident" id="2937696">WriteString</span><span class="op" id="2937707">(</span><span class="ident" id="2937708"><a href="/strings/replace.go.html#2936915">s</a></span><span class="op" id="2937709">[</span><span class="ident" id="2937710"><a href="/strings/replace.go.html#2936977">last</a></span><span class="op" id="2937714">:</span><span class="op" id="2937715">]</span><span class="op" id="2937716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937720"><a href="/strings/replace.go.html#2936926">n</a></span>&nbsp;<span class="op" id="2937722">+=</span>&nbsp;<span class="ident" id="2937725"><a href="/strings/replace.go.html#2936983">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2937729">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2937732">return</span><br>
<span class="lineno"></span><span class="op" id="2937739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2937742">//&nbsp;singleStringReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;there&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="2937819">//&nbsp;one&nbsp;string&nbsp;to&nbsp;replace&nbsp;(and&nbsp;that&nbsp;string&nbsp;has&nbsp;more&nbsp;than&nbsp;one&nbsp;byte).</span><br>
<span class="lineno">355</span><span class="keyword" id="2937886">type</span>&nbsp;<span class="ident" id="2937891">singleStringReplacer</span>&nbsp;<span class="keyword" id="2937912">struct</span>&nbsp;<span class="op" id="2937919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2937922">finder</span>&nbsp;<span class="op" id="2937929">*</span><span class="ident" id="2937930"><a href="/strings/search.go.html#2941803">stringFinder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2937944">//&nbsp;value&nbsp;is&nbsp;the&nbsp;new&nbsp;string&nbsp;that&nbsp;replaces&nbsp;that&nbsp;pattern&nbsp;when&nbsp;it&#39;s&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938016">value</span>&nbsp;<span class="builtintype" id="2938022">string</span><br>
<span class="lineno"></span><span class="op" id="2938029">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="2938032">func</span>&nbsp;<span class="ident" id="2938037">makeSingleStringReplacer</span><span class="op" id="2938061">(</span><span class="ident" id="2938062">pattern</span>&nbsp;<span class="builtintype" id="2938070">string</span><span class="op" id="2938076">,</span>&nbsp;<span class="ident" id="2938078">value</span>&nbsp;<span class="builtintype" id="2938084">string</span><span class="op" id="2938090">)</span>&nbsp;<span class="op" id="2938092">*</span><span class="ident" id="2938093"><a href="/strings/replace.go.html#2937891">singleStringReplacer</a></span>&nbsp;<span class="op" id="2938114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938117">return</span>&nbsp;<span class="op" id="2938124">&amp;</span><span class="ident" id="2938125"><a href="/strings/replace.go.html#2937891">singleStringReplacer</a></span><span class="op" id="2938145">{</span><span class="ident" id="2938146">finder</span><span class="op" id="2938152">:</span>&nbsp;<span class="ident" id="2938154"><a href="/strings/search.go.html#2943547">makeStringFinder</a></span><span class="op" id="2938170">(</span><span class="ident" id="2938171"><a href="/strings/replace.go.html#2938062">pattern</a></span><span class="op" id="2938178">)</span><span class="op" id="2938179">,</span>&nbsp;<span class="ident" id="2938181">value</span><span class="op" id="2938186">:</span>&nbsp;<span class="ident" id="2938188"><a href="/strings/replace.go.html#2938078">value</a></span><span class="op" id="2938193">}</span><br>
<span class="lineno"></span><span class="op" id="2938195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="2938198">func</span>&nbsp;<span class="op" id="2938203">(</span><span class="ident" id="2938204">r</span>&nbsp;<span class="op" id="2938206">*</span><span class="ident" id="2938207"><a href="/strings/replace.go.html#2937891">singleStringReplacer</a></span><span class="op" id="2938227">)</span>&nbsp;<span class="ident" id="2938229">Replace</span><span class="op" id="2938236">(</span><span class="ident" id="2938237">s</span>&nbsp;<span class="builtintype" id="2938239">string</span><span class="op" id="2938245">)</span>&nbsp;<span class="builtintype" id="2938247">string</span>&nbsp;<span class="op" id="2938254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938257">var</span>&nbsp;<span class="ident" id="2938261">buf</span>&nbsp;<span class="op" id="2938265">[</span><span class="op" id="2938266">]</span><span class="builtintype" id="2938267">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938273">i</span><span class="op" id="2938274">,</span>&nbsp;<span class="ident" id="2938276">matched</span>&nbsp;<span class="op" id="2938284">:=</span>&nbsp;<span class="num" id="2938287">0</span><span class="op" id="2938288">,</span>&nbsp;<span class="ident" id="2938290">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938297">for</span>&nbsp;<span class="op" id="2938301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938305">match</span>&nbsp;<span class="op" id="2938311">:=</span>&nbsp;<span class="ident" id="2938314"><a href="/strings/replace.go.html#2938204">r</a></span><span class="op" id="2938315">.</span><span class="ident" id="2938316">finder</span><span class="op" id="2938322">.</span><span class="ident" id="2938323">next</span><span class="op" id="2938327">(</span><span class="ident" id="2938328"><a href="/strings/replace.go.html#2938237">s</a></span><span class="op" id="2938329">[</span><span class="ident" id="2938330"><a href="/strings/replace.go.html#2938273">i</a></span><span class="op" id="2938331">:</span><span class="op" id="2938332">]</span><span class="op" id="2938333">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938337">if</span>&nbsp;<span class="ident" id="2938340"><a href="/strings/replace.go.html#2938305">match</a></span>&nbsp;<span class="op" id="2938346">==</span>&nbsp;<span class="op" id="2938349">-</span><span class="num" id="2938350">1</span>&nbsp;<span class="op" id="2938352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938357">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938369"><a href="/strings/replace.go.html#2938276">matched</a></span>&nbsp;<span class="op" id="2938377">=</span>&nbsp;<span class="ident" id="2938379">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938386"><a href="/strings/replace.go.html#2938261">buf</a></span>&nbsp;<span class="op" id="2938390">=</span>&nbsp;<span class="builtinfunc" id="2938392">append</span><span class="op" id="2938398">(</span><span class="ident" id="2938399"><a href="/strings/replace.go.html#2938261">buf</a></span><span class="op" id="2938402">,</span>&nbsp;<span class="ident" id="2938404"><a href="/strings/replace.go.html#2938237">s</a></span><span class="op" id="2938405">[</span><span class="ident" id="2938406"><a href="/strings/replace.go.html#2938273">i</a></span><span class="op" id="2938407">:</span><span class="ident" id="2938408"><a href="/strings/replace.go.html#2938273">i</a></span><span class="op" id="2938409">+</span><span class="ident" id="2938410"><a href="/strings/replace.go.html#2938305">match</a></span><span class="op" id="2938415">]</span><span class="op" id="2938416">...</span><span class="op" id="2938419">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938423"><a href="/strings/replace.go.html#2938261">buf</a></span>&nbsp;<span class="op" id="2938427">=</span>&nbsp;<span class="builtinfunc" id="2938429">append</span><span class="op" id="2938435">(</span><span class="ident" id="2938436"><a href="/strings/replace.go.html#2938261">buf</a></span><span class="op" id="2938439">,</span>&nbsp;<span class="ident" id="2938441"><a href="/strings/replace.go.html#2938204">r</a></span><span class="op" id="2938442">.</span><span class="ident" id="2938443">value</span><span class="op" id="2938448">...</span><span class="op" id="2938451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938455"><a href="/strings/replace.go.html#2938273">i</a></span>&nbsp;<span class="op" id="2938457">+=</span>&nbsp;<span class="ident" id="2938460"><a href="/strings/replace.go.html#2938305">match</a></span>&nbsp;<span class="op" id="2938466">+</span>&nbsp;<span class="builtinfunc" id="2938468">len</span><span class="op" id="2938471">(</span><span class="ident" id="2938472"><a href="/strings/replace.go.html#2938204">r</a></span><span class="op" id="2938473">.</span><span class="ident" id="2938474">finder</span><span class="op" id="2938480">.</span><span class="ident" id="2938481">pattern</span><span class="op" id="2938488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938494">if</span>&nbsp;<span class="op" id="2938497">!</span><span class="ident" id="2938498"><a href="/strings/replace.go.html#2938276">matched</a></span>&nbsp;<span class="op" id="2938506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938510">return</span>&nbsp;<span class="ident" id="2938517"><a href="/strings/replace.go.html#2938237">s</a></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938523"><a href="/strings/replace.go.html#2938261">buf</a></span>&nbsp;<span class="op" id="2938527">=</span>&nbsp;<span class="builtinfunc" id="2938529">append</span><span class="op" id="2938535">(</span><span class="ident" id="2938536"><a href="/strings/replace.go.html#2938261">buf</a></span><span class="op" id="2938539">,</span>&nbsp;<span class="ident" id="2938541"><a href="/strings/replace.go.html#2938237">s</a></span><span class="op" id="2938542">[</span><span class="ident" id="2938543"><a href="/strings/replace.go.html#2938273">i</a></span><span class="op" id="2938544">:</span><span class="op" id="2938545">]</span><span class="op" id="2938546">...</span><span class="op" id="2938549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938552">return</span>&nbsp;<span class="builtintype" id="2938559">string</span><span class="op" id="2938565">(</span><span class="ident" id="2938566"><a href="/strings/replace.go.html#2938261">buf</a></span><span class="op" id="2938569">)</span><br>
<span class="lineno"></span><span class="op" id="2938571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="2938574">func</span>&nbsp;<span class="op" id="2938579">(</span><span class="ident" id="2938580">r</span>&nbsp;<span class="op" id="2938582">*</span><span class="ident" id="2938583"><a href="/strings/replace.go.html#2937891">singleStringReplacer</a></span><span class="op" id="2938603">)</span>&nbsp;<span class="ident" id="2938605">WriteString</span><span class="op" id="2938616">(</span><span class="ident" id="2938617">w</span>&nbsp;<span class="ident" id="2938619"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2938621">.</span><span class="ident" id="2938622">Writer</span><span class="op" id="2938628">,</span>&nbsp;<span class="ident" id="2938630">s</span>&nbsp;<span class="builtintype" id="2938632">string</span><span class="op" id="2938638">)</span>&nbsp;<span class="op" id="2938640">(</span><span class="ident" id="2938641">n</span>&nbsp;<span class="builtintype" id="2938643">int</span><span class="op" id="2938646">,</span>&nbsp;<span class="ident" id="2938648">err</span>&nbsp;<span class="builtintype" id="2938652">error</span><span class="op" id="2938657">)</span>&nbsp;<span class="op" id="2938659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938662">sw</span>&nbsp;<span class="op" id="2938665">:=</span>&nbsp;<span class="ident" id="2938668"><a href="/strings/replace.go.html#2936589">getStringWriter</a></span><span class="op" id="2938683">(</span><span class="ident" id="2938684"><a href="/strings/replace.go.html#2938617">w</a></span><span class="op" id="2938685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938688">var</span>&nbsp;<span class="ident" id="2938692">i</span><span class="op" id="2938693">,</span>&nbsp;<span class="ident" id="2938695">wn</span>&nbsp;<span class="builtintype" id="2938698">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938703">for</span>&nbsp;<span class="op" id="2938707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938711">match</span>&nbsp;<span class="op" id="2938717">:=</span>&nbsp;<span class="ident" id="2938720"><a href="/strings/replace.go.html#2938580">r</a></span><span class="op" id="2938721">.</span><span class="ident" id="2938722">finder</span><span class="op" id="2938728">.</span><span class="ident" id="2938729">next</span><span class="op" id="2938733">(</span><span class="ident" id="2938734"><a href="/strings/replace.go.html#2938630">s</a></span><span class="op" id="2938735">[</span><span class="ident" id="2938736"><a href="/strings/replace.go.html#2938692">i</a></span><span class="op" id="2938737">:</span><span class="op" id="2938738">]</span><span class="op" id="2938739">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938743">if</span>&nbsp;<span class="ident" id="2938746"><a href="/strings/replace.go.html#2938711">match</a></span>&nbsp;<span class="op" id="2938752">==</span>&nbsp;<span class="op" id="2938755">-</span><span class="num" id="2938756">1</span>&nbsp;<span class="op" id="2938758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938763">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938775"><a href="/strings/replace.go.html#2938695">wn</a></span><span class="op" id="2938777">,</span>&nbsp;<span class="ident" id="2938779"><a href="/strings/replace.go.html#2938648">err</a></span>&nbsp;<span class="op" id="2938783">=</span>&nbsp;<span class="ident" id="2938785"><a href="/strings/replace.go.html#2938662">sw</a></span><span class="op" id="2938787">.</span><span class="ident" id="2938788">WriteString</span><span class="op" id="2938799">(</span><span class="ident" id="2938800"><a href="/strings/replace.go.html#2938630">s</a></span><span class="op" id="2938801">[</span><span class="ident" id="2938802"><a href="/strings/replace.go.html#2938692">i</a></span>&nbsp;<span class="op" id="2938804">:</span>&nbsp;<span class="ident" id="2938806"><a href="/strings/replace.go.html#2938692">i</a></span><span class="op" id="2938807">+</span><span class="ident" id="2938808"><a href="/strings/replace.go.html#2938711">match</a></span><span class="op" id="2938813">]</span><span class="op" id="2938814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938818"><a href="/strings/replace.go.html#2938641">n</a></span>&nbsp;<span class="op" id="2938820">+=</span>&nbsp;<span class="ident" id="2938823"><a href="/strings/replace.go.html#2938695">wn</a></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938828">if</span>&nbsp;<span class="ident" id="2938831"><a href="/strings/replace.go.html#2938648">err</a></span>&nbsp;<span class="op" id="2938835">!=</span>&nbsp;<span class="ident" id="2938838">nil</span>&nbsp;<span class="op" id="2938842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938847">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938860"><a href="/strings/replace.go.html#2938695">wn</a></span><span class="op" id="2938862">,</span>&nbsp;<span class="ident" id="2938864"><a href="/strings/replace.go.html#2938648">err</a></span>&nbsp;<span class="op" id="2938868">=</span>&nbsp;<span class="ident" id="2938870"><a href="/strings/replace.go.html#2938662">sw</a></span><span class="op" id="2938872">.</span><span class="ident" id="2938873">WriteString</span><span class="op" id="2938884">(</span><span class="ident" id="2938885"><a href="/strings/replace.go.html#2938580">r</a></span><span class="op" id="2938886">.</span><span class="ident" id="2938887">value</span><span class="op" id="2938892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938896"><a href="/strings/replace.go.html#2938641">n</a></span>&nbsp;<span class="op" id="2938898">+=</span>&nbsp;<span class="ident" id="2938901"><a href="/strings/replace.go.html#2938695">wn</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938906">if</span>&nbsp;<span class="ident" id="2938909"><a href="/strings/replace.go.html#2938648">err</a></span>&nbsp;<span class="op" id="2938913">!=</span>&nbsp;<span class="ident" id="2938916">nil</span>&nbsp;<span class="op" id="2938920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2938925">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938938"><a href="/strings/replace.go.html#2938692">i</a></span>&nbsp;<span class="op" id="2938940">+=</span>&nbsp;<span class="ident" id="2938943"><a href="/strings/replace.go.html#2938711">match</a></span>&nbsp;<span class="op" id="2938949">+</span>&nbsp;<span class="builtinfunc" id="2938951">len</span><span class="op" id="2938954">(</span><span class="ident" id="2938955"><a href="/strings/replace.go.html#2938580">r</a></span><span class="op" id="2938956">.</span><span class="ident" id="2938957">finder</span><span class="op" id="2938963">.</span><span class="ident" id="2938964">pattern</span><span class="op" id="2938971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2938974">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2938977"><a href="/strings/replace.go.html#2938695">wn</a></span><span class="op" id="2938979">,</span>&nbsp;<span class="ident" id="2938981"><a href="/strings/replace.go.html#2938648">err</a></span>&nbsp;<span class="op" id="2938985">=</span>&nbsp;<span class="ident" id="2938987"><a href="/strings/replace.go.html#2938662">sw</a></span><span class="op" id="2938989">.</span><span class="ident" id="2938990">WriteString</span><span class="op" id="2939001">(</span><span class="ident" id="2939002"><a href="/strings/replace.go.html#2938630">s</a></span><span class="op" id="2939003">[</span><span class="ident" id="2939004"><a href="/strings/replace.go.html#2938692">i</a></span><span class="op" id="2939005">:</span><span class="op" id="2939006">]</span><span class="op" id="2939007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939010"><a href="/strings/replace.go.html#2938641">n</a></span>&nbsp;<span class="op" id="2939012">+=</span>&nbsp;<span class="ident" id="2939015"><a href="/strings/replace.go.html#2938695">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939019">return</span><br>
<span class="lineno"></span><span class="op" id="2939026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="2939029">//&nbsp;byteReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;all&nbsp;the&nbsp;&#34;old&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2939098">//&nbsp;and&nbsp;&#34;new&#34;&nbsp;values&nbsp;are&nbsp;single&nbsp;ASCII&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2939142">//&nbsp;The&nbsp;array&nbsp;contains&nbsp;replacement&nbsp;bytes&nbsp;indexed&nbsp;by&nbsp;old&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="2939203">type</span>&nbsp;<span class="ident" id="2939208">byteReplacer</span>&nbsp;<span class="op" id="2939221">[</span><span class="num" id="2939222">256</span><span class="op" id="2939225">]</span><span class="builtintype" id="2939226">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="2939232">func</span>&nbsp;<span class="op" id="2939237">(</span><span class="ident" id="2939238">r</span>&nbsp;<span class="op" id="2939240">*</span><span class="ident" id="2939241"><a href="/strings/replace.go.html#2939208">byteReplacer</a></span><span class="op" id="2939253">)</span>&nbsp;<span class="ident" id="2939255">Replace</span><span class="op" id="2939262">(</span><span class="ident" id="2939263">s</span>&nbsp;<span class="builtintype" id="2939265">string</span><span class="op" id="2939271">)</span>&nbsp;<span class="builtintype" id="2939273">string</span>&nbsp;<span class="op" id="2939280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939283">var</span>&nbsp;<span class="ident" id="2939287">buf</span>&nbsp;<span class="op" id="2939291">[</span><span class="op" id="2939292">]</span><span class="builtintype" id="2939293">byte</span>&nbsp;<span class="comment" id="2939298">//&nbsp;lazily&nbsp;allocated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939319">for</span>&nbsp;<span class="ident" id="2939323">i</span>&nbsp;<span class="op" id="2939325">:=</span>&nbsp;<span class="num" id="2939328">0</span><span class="op" id="2939329">;</span>&nbsp;<span class="ident" id="2939331"><a href="/strings/replace.go.html#2939323">i</a></span>&nbsp;<span class="op" id="2939333">&lt;</span>&nbsp;<span class="builtinfunc" id="2939335">len</span><span class="op" id="2939338">(</span><span class="ident" id="2939339"><a href="/strings/replace.go.html#2939263">s</a></span><span class="op" id="2939340">)</span><span class="op" id="2939341">;</span>&nbsp;<span class="ident" id="2939343"><a href="/strings/replace.go.html#2939323">i</a></span><span class="op" id="2939344">++</span>&nbsp;<span class="op" id="2939347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939351">b</span>&nbsp;<span class="op" id="2939353">:=</span>&nbsp;<span class="ident" id="2939356"><a href="/strings/replace.go.html#2939263">s</a></span><span class="op" id="2939357">[</span><span class="ident" id="2939358"><a href="/strings/replace.go.html#2939323">i</a></span><span class="op" id="2939359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939363">if</span>&nbsp;<span class="ident" id="2939366"><a href="/strings/replace.go.html#2939238">r</a></span><span class="op" id="2939367">[</span><span class="ident" id="2939368"><a href="/strings/replace.go.html#2939351">b</a></span><span class="op" id="2939369">]</span>&nbsp;<span class="op" id="2939371">!=</span>&nbsp;<span class="ident" id="2939374"><a href="/strings/replace.go.html#2939351">b</a></span>&nbsp;<span class="op" id="2939376">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939381">if</span>&nbsp;<span class="ident" id="2939384"><a href="/strings/replace.go.html#2939287">buf</a></span>&nbsp;<span class="op" id="2939388">==</span>&nbsp;<span class="ident" id="2939391">nil</span>&nbsp;<span class="op" id="2939395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939401"><a href="/strings/replace.go.html#2939287">buf</a></span>&nbsp;<span class="op" id="2939405">=</span>&nbsp;<span class="op" id="2939407">[</span><span class="op" id="2939408">]</span><span class="builtintype" id="2939409">byte</span><span class="op" id="2939413">(</span><span class="ident" id="2939414"><a href="/strings/replace.go.html#2939263">s</a></span><span class="op" id="2939415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939425"><a href="/strings/replace.go.html#2939287">buf</a></span><span class="op" id="2939428">[</span><span class="ident" id="2939429"><a href="/strings/replace.go.html#2939323">i</a></span><span class="op" id="2939430">]</span>&nbsp;<span class="op" id="2939432">=</span>&nbsp;<span class="ident" id="2939434"><a href="/strings/replace.go.html#2939238">r</a></span><span class="op" id="2939435">[</span><span class="ident" id="2939436"><a href="/strings/replace.go.html#2939351">b</a></span><span class="op" id="2939437">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939441">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939447">if</span>&nbsp;<span class="ident" id="2939450"><a href="/strings/replace.go.html#2939287">buf</a></span>&nbsp;<span class="op" id="2939454">==</span>&nbsp;<span class="ident" id="2939457">nil</span>&nbsp;<span class="op" id="2939461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939465">return</span>&nbsp;<span class="ident" id="2939472"><a href="/strings/replace.go.html#2939263">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939478">return</span>&nbsp;<span class="builtintype" id="2939485">string</span><span class="op" id="2939491">(</span><span class="ident" id="2939492"><a href="/strings/replace.go.html#2939287">buf</a></span><span class="op" id="2939495">)</span><br>
<span class="lineno">430</span><span class="op" id="2939497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2939500">func</span>&nbsp;<span class="op" id="2939505">(</span><span class="ident" id="2939506">r</span>&nbsp;<span class="op" id="2939508">*</span><span class="ident" id="2939509"><a href="/strings/replace.go.html#2939208">byteReplacer</a></span><span class="op" id="2939521">)</span>&nbsp;<span class="ident" id="2939523">WriteString</span><span class="op" id="2939534">(</span><span class="ident" id="2939535">w</span>&nbsp;<span class="ident" id="2939537"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2939539">.</span><span class="ident" id="2939540">Writer</span><span class="op" id="2939546">,</span>&nbsp;<span class="ident" id="2939548">s</span>&nbsp;<span class="builtintype" id="2939550">string</span><span class="op" id="2939556">)</span>&nbsp;<span class="op" id="2939558">(</span><span class="ident" id="2939559">n</span>&nbsp;<span class="builtintype" id="2939561">int</span><span class="op" id="2939564">,</span>&nbsp;<span class="ident" id="2939566">err</span>&nbsp;<span class="builtintype" id="2939570">error</span><span class="op" id="2939575">)</span>&nbsp;<span class="op" id="2939577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2939580">//&nbsp;TODO(bradfitz):&nbsp;use&nbsp;io.WriteString&nbsp;with&nbsp;slices&nbsp;of&nbsp;s,&nbsp;avoiding&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939658">bufsize</span>&nbsp;<span class="op" id="2939666">:=</span>&nbsp;<span class="num" id="2939669">32</span>&nbsp;<span class="op" id="2939672">&lt;&lt;</span>&nbsp;<span class="num" id="2939675">10</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939679">if</span>&nbsp;<span class="builtinfunc" id="2939682">len</span><span class="op" id="2939685">(</span><span class="ident" id="2939686"><a href="/strings/replace.go.html#2939548">s</a></span><span class="op" id="2939687">)</span>&nbsp;<span class="op" id="2939689">&lt;</span>&nbsp;<span class="ident" id="2939691"><a href="/strings/replace.go.html#2939658">bufsize</a></span>&nbsp;<span class="op" id="2939699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939703"><a href="/strings/replace.go.html#2939658">bufsize</a></span>&nbsp;<span class="op" id="2939711">=</span>&nbsp;<span class="builtinfunc" id="2939713">len</span><span class="op" id="2939716">(</span><span class="ident" id="2939717"><a href="/strings/replace.go.html#2939548">s</a></span><span class="op" id="2939718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939724">buf</span>&nbsp;<span class="op" id="2939728">:=</span>&nbsp;<span class="builtinfunc" id="2939731">make</span><span class="op" id="2939735">(</span><span class="op" id="2939736">[</span><span class="op" id="2939737">]</span><span class="builtintype" id="2939738">byte</span><span class="op" id="2939742">,</span>&nbsp;<span class="ident" id="2939744"><a href="/strings/replace.go.html#2939658">bufsize</a></span><span class="op" id="2939751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939755">for</span>&nbsp;<span class="builtinfunc" id="2939759">len</span><span class="op" id="2939762">(</span><span class="ident" id="2939763"><a href="/strings/replace.go.html#2939548">s</a></span><span class="op" id="2939764">)</span>&nbsp;<span class="op" id="2939766">&gt;</span>&nbsp;<span class="num" id="2939768">0</span>&nbsp;<span class="op" id="2939770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939774">ncopy</span>&nbsp;<span class="op" id="2939780">:=</span>&nbsp;<span class="builtinfunc" id="2939783">copy</span><span class="op" id="2939787">(</span><span class="ident" id="2939788"><a href="/strings/replace.go.html#2939724">buf</a></span><span class="op" id="2939791">,</span>&nbsp;<span class="ident" id="2939793"><a href="/strings/replace.go.html#2939548">s</a></span><span class="op" id="2939794">[</span><span class="op" id="2939795">:</span><span class="op" id="2939796">]</span><span class="op" id="2939797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939801"><a href="/strings/replace.go.html#2939548">s</a></span>&nbsp;<span class="op" id="2939803">=</span>&nbsp;<span class="ident" id="2939805"><a href="/strings/replace.go.html#2939548">s</a></span><span class="op" id="2939806">[</span><span class="ident" id="2939807"><a href="/strings/replace.go.html#2939774">ncopy</a></span><span class="op" id="2939812">:</span><span class="op" id="2939813">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939817">for</span>&nbsp;<span class="ident" id="2939821">i</span><span class="op" id="2939822">,</span>&nbsp;<span class="ident" id="2939824">b</span>&nbsp;<span class="op" id="2939826">:=</span>&nbsp;<span class="keyword" id="2939829">range</span>&nbsp;<span class="ident" id="2939835"><a href="/strings/replace.go.html#2939724">buf</a></span><span class="op" id="2939838">[</span><span class="op" id="2939839">:</span><span class="ident" id="2939840"><a href="/strings/replace.go.html#2939774">ncopy</a></span><span class="op" id="2939845">]</span>&nbsp;<span class="op" id="2939847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939852"><a href="/strings/replace.go.html#2939724">buf</a></span><span class="op" id="2939855">[</span><span class="ident" id="2939856"><a href="/strings/replace.go.html#2939821">i</a></span><span class="op" id="2939857">]</span>&nbsp;<span class="op" id="2939859">=</span>&nbsp;<span class="ident" id="2939861"><a href="/strings/replace.go.html#2939506">r</a></span><span class="op" id="2939862">[</span><span class="ident" id="2939863"><a href="/strings/replace.go.html#2939824">b</a></span><span class="op" id="2939864">]</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939872">wn</span><span class="op" id="2939874">,</span>&nbsp;<span class="ident" id="2939876">err</span>&nbsp;<span class="op" id="2939880">:=</span>&nbsp;<span class="ident" id="2939883"><a href="/strings/replace.go.html#2939535">w</a></span><span class="op" id="2939884">.</span><span class="ident" id="2939885">Write</span><span class="op" id="2939890">(</span><span class="ident" id="2939891"><a href="/strings/replace.go.html#2939724">buf</a></span><span class="op" id="2939894">[</span><span class="op" id="2939895">:</span><span class="ident" id="2939896"><a href="/strings/replace.go.html#2939774">ncopy</a></span><span class="op" id="2939901">]</span><span class="op" id="2939902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2939906"><a href="/strings/replace.go.html#2939559">n</a></span>&nbsp;<span class="op" id="2939908">+=</span>&nbsp;<span class="ident" id="2939911"><a href="/strings/replace.go.html#2939872">wn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939916">if</span>&nbsp;<span class="ident" id="2939919"><a href="/strings/replace.go.html#2939876">err</a></span>&nbsp;<span class="op" id="2939923">!=</span>&nbsp;<span class="ident" id="2939926">nil</span>&nbsp;<span class="op" id="2939930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939935">return</span>&nbsp;<span class="ident" id="2939942"><a href="/strings/replace.go.html#2939559">n</a></span><span class="op" id="2939943">,</span>&nbsp;<span class="ident" id="2939945"><a href="/strings/replace.go.html#2939876">err</a></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2939954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2939957">return</span>&nbsp;<span class="ident" id="2939964"><a href="/strings/replace.go.html#2939559">n</a></span><span class="op" id="2939965">,</span>&nbsp;<span class="ident" id="2939967">nil</span><br>
<span class="lineno"></span><span class="op" id="2939971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="2939974">//&nbsp;byteStringReplacer&nbsp;is&nbsp;the&nbsp;implementation&nbsp;that&#39;s&nbsp;used&nbsp;when&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2940043">//&nbsp;&#34;old&#34;&nbsp;values&nbsp;are&nbsp;single&nbsp;ASCII&nbsp;bytes&nbsp;but&nbsp;the&nbsp;&#34;new&#34;&nbsp;values&nbsp;vary&nbsp;in&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="2940117">//&nbsp;The&nbsp;array&nbsp;contains&nbsp;replacement&nbsp;byte&nbsp;slices&nbsp;indexed&nbsp;by&nbsp;old&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="2940184">//&nbsp;A&nbsp;nil&nbsp;[]byte&nbsp;means&nbsp;that&nbsp;the&nbsp;old&nbsp;byte&nbsp;should&nbsp;not&nbsp;be&nbsp;replaced.</span><br>
<span class="lineno"></span><span class="keyword" id="2940248">type</span>&nbsp;<span class="ident" id="2940253">byteStringReplacer</span>&nbsp;<span class="op" id="2940272">[</span><span class="num" id="2940273">256</span><span class="op" id="2940276">]</span><span class="op" id="2940277">[</span><span class="op" id="2940278">]</span><span class="builtintype" id="2940279">byte</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="keyword" id="2940285">func</span>&nbsp;<span class="op" id="2940290">(</span><span class="ident" id="2940291">r</span>&nbsp;<span class="op" id="2940293">*</span><span class="ident" id="2940294"><a href="/strings/replace.go.html#2940253">byteStringReplacer</a></span><span class="op" id="2940312">)</span>&nbsp;<span class="ident" id="2940314">Replace</span><span class="op" id="2940321">(</span><span class="ident" id="2940322">s</span>&nbsp;<span class="builtintype" id="2940324">string</span><span class="op" id="2940330">)</span>&nbsp;<span class="builtintype" id="2940332">string</span>&nbsp;<span class="op" id="2940339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940342">newSize</span>&nbsp;<span class="op" id="2940350">:=</span>&nbsp;<span class="builtinfunc" id="2940353">len</span><span class="op" id="2940356">(</span><span class="ident" id="2940357"><a href="/strings/replace.go.html#2940322">s</a></span><span class="op" id="2940358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940361">anyChanges</span>&nbsp;<span class="op" id="2940372">:=</span>&nbsp;<span class="ident" id="2940375">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940382">for</span>&nbsp;<span class="ident" id="2940386">i</span>&nbsp;<span class="op" id="2940388">:=</span>&nbsp;<span class="num" id="2940391">0</span><span class="op" id="2940392">;</span>&nbsp;<span class="ident" id="2940394"><a href="/strings/replace.go.html#2940386">i</a></span>&nbsp;<span class="op" id="2940396">&lt;</span>&nbsp;<span class="builtinfunc" id="2940398">len</span><span class="op" id="2940401">(</span><span class="ident" id="2940402"><a href="/strings/replace.go.html#2940322">s</a></span><span class="op" id="2940403">)</span><span class="op" id="2940404">;</span>&nbsp;<span class="ident" id="2940406"><a href="/strings/replace.go.html#2940386">i</a></span><span class="op" id="2940407">++</span>&nbsp;<span class="op" id="2940410">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940414">b</span>&nbsp;<span class="op" id="2940416">:=</span>&nbsp;<span class="ident" id="2940419"><a href="/strings/replace.go.html#2940322">s</a></span><span class="op" id="2940420">[</span><span class="ident" id="2940421"><a href="/strings/replace.go.html#2940386">i</a></span><span class="op" id="2940422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940426">if</span>&nbsp;<span class="ident" id="2940429"><a href="/strings/replace.go.html#2940291">r</a></span><span class="op" id="2940430">[</span><span class="ident" id="2940431"><a href="/strings/replace.go.html#2940414">b</a></span><span class="op" id="2940432">]</span>&nbsp;<span class="op" id="2940434">!=</span>&nbsp;<span class="ident" id="2940437">nil</span>&nbsp;<span class="op" id="2940441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940446"><a href="/strings/replace.go.html#2940361">anyChanges</a></span>&nbsp;<span class="op" id="2940457">=</span>&nbsp;<span class="ident" id="2940459">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2940467">//&nbsp;The&nbsp;-1&nbsp;is&nbsp;because&nbsp;we&nbsp;are&nbsp;replacing&nbsp;1&nbsp;byte&nbsp;with&nbsp;len(r[b])&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940537"><a href="/strings/replace.go.html#2940342">newSize</a></span>&nbsp;<span class="op" id="2940545">+=</span>&nbsp;<span class="builtinfunc" id="2940548">len</span><span class="op" id="2940551">(</span><span class="ident" id="2940552"><a href="/strings/replace.go.html#2940291">r</a></span><span class="op" id="2940553">[</span><span class="ident" id="2940554"><a href="/strings/replace.go.html#2940414">b</a></span><span class="op" id="2940555">]</span><span class="op" id="2940556">)</span>&nbsp;<span class="op" id="2940558">-</span>&nbsp;<span class="num" id="2940560">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940570">if</span>&nbsp;<span class="op" id="2940573">!</span><span class="ident" id="2940574"><a href="/strings/replace.go.html#2940361">anyChanges</a></span>&nbsp;<span class="op" id="2940585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940589">return</span>&nbsp;<span class="ident" id="2940596"><a href="/strings/replace.go.html#2940322">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940599">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940602">buf</span>&nbsp;<span class="op" id="2940606">:=</span>&nbsp;<span class="builtinfunc" id="2940609">make</span><span class="op" id="2940613">(</span><span class="op" id="2940614">[</span><span class="op" id="2940615">]</span><span class="builtintype" id="2940616">byte</span><span class="op" id="2940620">,</span>&nbsp;<span class="ident" id="2940622"><a href="/strings/replace.go.html#2940342">newSize</a></span><span class="op" id="2940629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940632">bi</span>&nbsp;<span class="op" id="2940635">:=</span>&nbsp;<span class="ident" id="2940638"><a href="/strings/replace.go.html#2940602">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940643">for</span>&nbsp;<span class="ident" id="2940647">i</span>&nbsp;<span class="op" id="2940649">:=</span>&nbsp;<span class="num" id="2940652">0</span><span class="op" id="2940653">;</span>&nbsp;<span class="ident" id="2940655"><a href="/strings/replace.go.html#2940647">i</a></span>&nbsp;<span class="op" id="2940657">&lt;</span>&nbsp;<span class="builtinfunc" id="2940659">len</span><span class="op" id="2940662">(</span><span class="ident" id="2940663"><a href="/strings/replace.go.html#2940322">s</a></span><span class="op" id="2940664">)</span><span class="op" id="2940665">;</span>&nbsp;<span class="ident" id="2940667"><a href="/strings/replace.go.html#2940647">i</a></span><span class="op" id="2940668">++</span>&nbsp;<span class="op" id="2940671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940675">b</span>&nbsp;<span class="op" id="2940677">:=</span>&nbsp;<span class="ident" id="2940680"><a href="/strings/replace.go.html#2940322">s</a></span><span class="op" id="2940681">[</span><span class="ident" id="2940682"><a href="/strings/replace.go.html#2940647">i</a></span><span class="op" id="2940683">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940687">if</span>&nbsp;<span class="ident" id="2940690"><a href="/strings/replace.go.html#2940291">r</a></span><span class="op" id="2940691">[</span><span class="ident" id="2940692"><a href="/strings/replace.go.html#2940675">b</a></span><span class="op" id="2940693">]</span>&nbsp;<span class="op" id="2940695">!=</span>&nbsp;<span class="ident" id="2940698">nil</span>&nbsp;<span class="op" id="2940702">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940707">n</span>&nbsp;<span class="op" id="2940709">:=</span>&nbsp;<span class="builtinfunc" id="2940712">copy</span><span class="op" id="2940716">(</span><span class="ident" id="2940717"><a href="/strings/replace.go.html#2940632">bi</a></span><span class="op" id="2940719">,</span>&nbsp;<span class="ident" id="2940721"><a href="/strings/replace.go.html#2940291">r</a></span><span class="op" id="2940722">[</span><span class="ident" id="2940723"><a href="/strings/replace.go.html#2940675">b</a></span><span class="op" id="2940724">]</span><span class="op" id="2940725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940730"><a href="/strings/replace.go.html#2940632">bi</a></span>&nbsp;<span class="op" id="2940733">=</span>&nbsp;<span class="ident" id="2940735"><a href="/strings/replace.go.html#2940632">bi</a></span><span class="op" id="2940737">[</span><span class="ident" id="2940738"><a href="/strings/replace.go.html#2940707">n</a></span><span class="op" id="2940739">:</span><span class="op" id="2940740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940744">}</span>&nbsp;<span class="keyword" id="2940746">else</span>&nbsp;<span class="op" id="2940751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940756"><a href="/strings/replace.go.html#2940632">bi</a></span><span class="op" id="2940758">[</span><span class="num" id="2940759">0</span><span class="op" id="2940760">]</span>&nbsp;<span class="op" id="2940762">=</span>&nbsp;<span class="ident" id="2940764"><a href="/strings/replace.go.html#2940675">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940769"><a href="/strings/replace.go.html#2940632">bi</a></span>&nbsp;<span class="op" id="2940772">=</span>&nbsp;<span class="ident" id="2940774"><a href="/strings/replace.go.html#2940632">bi</a></span><span class="op" id="2940776">[</span><span class="num" id="2940777">1</span><span class="op" id="2940778">:</span><span class="op" id="2940779">]</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2940786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940789">return</span>&nbsp;<span class="builtintype" id="2940796">string</span><span class="op" id="2940802">(</span><span class="ident" id="2940803"><a href="/strings/replace.go.html#2940602">buf</a></span><span class="op" id="2940806">)</span><br>
<span class="lineno"></span><span class="op" id="2940808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">490</span><span class="keyword" id="2940811">func</span>&nbsp;<span class="op" id="2940816">(</span><span class="ident" id="2940817">r</span>&nbsp;<span class="op" id="2940819">*</span><span class="ident" id="2940820"><a href="/strings/replace.go.html#2940253">byteStringReplacer</a></span><span class="op" id="2940838">)</span>&nbsp;<span class="ident" id="2940840">WriteString</span><span class="op" id="2940851">(</span><span class="ident" id="2940852">w</span>&nbsp;<span class="ident" id="2940854"><a href="/strings/replace.go.html#2928555">io</a></span><span class="op" id="2940856">.</span><span class="ident" id="2940857">Writer</span><span class="op" id="2940863">,</span>&nbsp;<span class="ident" id="2940865">s</span>&nbsp;<span class="builtintype" id="2940867">string</span><span class="op" id="2940873">)</span>&nbsp;<span class="op" id="2940875">(</span><span class="ident" id="2940876">n</span>&nbsp;<span class="builtintype" id="2940878">int</span><span class="op" id="2940881">,</span>&nbsp;<span class="ident" id="2940883">err</span>&nbsp;<span class="builtintype" id="2940887">error</span><span class="op" id="2940892">)</span>&nbsp;<span class="op" id="2940894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940897">sw</span>&nbsp;<span class="op" id="2940900">:=</span>&nbsp;<span class="ident" id="2940903"><a href="/strings/replace.go.html#2936589">getStringWriter</a></span><span class="op" id="2940918">(</span><span class="ident" id="2940919"><a href="/strings/replace.go.html#2940852">w</a></span><span class="op" id="2940920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940923">last</span>&nbsp;<span class="op" id="2940928">:=</span>&nbsp;<span class="num" id="2940931">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940934">for</span>&nbsp;<span class="ident" id="2940938">i</span>&nbsp;<span class="op" id="2940940">:=</span>&nbsp;<span class="num" id="2940943">0</span><span class="op" id="2940944">;</span>&nbsp;<span class="ident" id="2940946"><a href="/strings/replace.go.html#2940938">i</a></span>&nbsp;<span class="op" id="2940948">&lt;</span>&nbsp;<span class="builtinfunc" id="2940950">len</span><span class="op" id="2940953">(</span><span class="ident" id="2940954"><a href="/strings/replace.go.html#2940865">s</a></span><span class="op" id="2940955">)</span><span class="op" id="2940956">;</span>&nbsp;<span class="ident" id="2940958"><a href="/strings/replace.go.html#2940938">i</a></span><span class="op" id="2940959">++</span>&nbsp;<span class="op" id="2940962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2940966">b</span>&nbsp;<span class="op" id="2940968">:=</span>&nbsp;<span class="ident" id="2940971"><a href="/strings/replace.go.html#2940865">s</a></span><span class="op" id="2940972">[</span><span class="ident" id="2940973"><a href="/strings/replace.go.html#2940938">i</a></span><span class="op" id="2940974">]</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940978">if</span>&nbsp;<span class="ident" id="2940981"><a href="/strings/replace.go.html#2940817">r</a></span><span class="op" id="2940982">[</span><span class="ident" id="2940983"><a href="/strings/replace.go.html#2940966">b</a></span><span class="op" id="2940984">]</span>&nbsp;<span class="op" id="2940986">==</span>&nbsp;<span class="ident" id="2940989">nil</span>&nbsp;<span class="op" id="2940993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2940998">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941013">if</span>&nbsp;<span class="ident" id="2941016"><a href="/strings/replace.go.html#2940923">last</a></span>&nbsp;<span class="op" id="2941021">!=</span>&nbsp;<span class="ident" id="2941024"><a href="/strings/replace.go.html#2940938">i</a></span>&nbsp;<span class="op" id="2941026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941031">nw</span><span class="op" id="2941033">,</span>&nbsp;<span class="ident" id="2941035">err</span>&nbsp;<span class="op" id="2941039">:=</span>&nbsp;<span class="ident" id="2941042"><a href="/strings/replace.go.html#2940897">sw</a></span><span class="op" id="2941044">.</span><span class="ident" id="2941045">WriteString</span><span class="op" id="2941056">(</span><span class="ident" id="2941057"><a href="/strings/replace.go.html#2940865">s</a></span><span class="op" id="2941058">[</span><span class="ident" id="2941059"><a href="/strings/replace.go.html#2940923">last</a></span><span class="op" id="2941063">:</span><span class="ident" id="2941064"><a href="/strings/replace.go.html#2940938">i</a></span><span class="op" id="2941065">]</span><span class="op" id="2941066">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941071"><a href="/strings/replace.go.html#2940876">n</a></span>&nbsp;<span class="op" id="2941073">+=</span>&nbsp;<span class="ident" id="2941076"><a href="/strings/replace.go.html#2941031">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941082">if</span>&nbsp;<span class="ident" id="2941085"><a href="/strings/replace.go.html#2941035">err</a></span>&nbsp;<span class="op" id="2941089">!=</span>&nbsp;<span class="ident" id="2941092">nil</span>&nbsp;<span class="op" id="2941096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941102">return</span>&nbsp;<span class="ident" id="2941109"><a href="/strings/replace.go.html#2940876">n</a></span><span class="op" id="2941110">,</span>&nbsp;<span class="ident" id="2941112"><a href="/strings/replace.go.html#2941035">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941123">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941127"><a href="/strings/replace.go.html#2940923">last</a></span>&nbsp;<span class="op" id="2941132">=</span>&nbsp;<span class="ident" id="2941134"><a href="/strings/replace.go.html#2940938">i</a></span>&nbsp;<span class="op" id="2941136">+</span>&nbsp;<span class="num" id="2941138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941142">nw</span><span class="op" id="2941144">,</span>&nbsp;<span class="ident" id="2941146">err</span>&nbsp;<span class="op" id="2941150">:=</span>&nbsp;<span class="ident" id="2941153"><a href="/strings/replace.go.html#2940852">w</a></span><span class="op" id="2941154">.</span><span class="ident" id="2941155">Write</span><span class="op" id="2941160">(</span><span class="ident" id="2941161"><a href="/strings/replace.go.html#2940817">r</a></span><span class="op" id="2941162">[</span><span class="ident" id="2941163"><a href="/strings/replace.go.html#2940966">b</a></span><span class="op" id="2941164">]</span><span class="op" id="2941165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941169"><a href="/strings/replace.go.html#2940876">n</a></span>&nbsp;<span class="op" id="2941171">+=</span>&nbsp;<span class="ident" id="2941174"><a href="/strings/replace.go.html#2941142">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941179">if</span>&nbsp;<span class="ident" id="2941182"><a href="/strings/replace.go.html#2941146">err</a></span>&nbsp;<span class="op" id="2941186">!=</span>&nbsp;<span class="ident" id="2941189">nil</span>&nbsp;<span class="op" id="2941193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941198">return</span>&nbsp;<span class="ident" id="2941205"><a href="/strings/replace.go.html#2940876">n</a></span><span class="op" id="2941206">,</span>&nbsp;<span class="ident" id="2941208"><a href="/strings/replace.go.html#2941146">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941220">if</span>&nbsp;<span class="ident" id="2941223"><a href="/strings/replace.go.html#2940923">last</a></span>&nbsp;<span class="op" id="2941228">!=</span>&nbsp;<span class="builtinfunc" id="2941231">len</span><span class="op" id="2941234">(</span><span class="ident" id="2941235"><a href="/strings/replace.go.html#2940865">s</a></span><span class="op" id="2941236">)</span>&nbsp;<span class="op" id="2941238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941242">var</span>&nbsp;<span class="ident" id="2941246">nw</span>&nbsp;<span class="builtintype" id="2941249">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941255"><a href="/strings/replace.go.html#2941246">nw</a></span><span class="op" id="2941257">,</span>&nbsp;<span class="ident" id="2941259"><a href="/strings/replace.go.html#2940883">err</a></span>&nbsp;<span class="op" id="2941263">=</span>&nbsp;<span class="ident" id="2941265"><a href="/strings/replace.go.html#2940897">sw</a></span><span class="op" id="2941267">.</span><span class="ident" id="2941268">WriteString</span><span class="op" id="2941279">(</span><span class="ident" id="2941280"><a href="/strings/replace.go.html#2940865">s</a></span><span class="op" id="2941281">[</span><span class="ident" id="2941282"><a href="/strings/replace.go.html#2940923">last</a></span><span class="op" id="2941286">:</span><span class="op" id="2941287">]</span><span class="op" id="2941288">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2941292"><a href="/strings/replace.go.html#2940876">n</a></span>&nbsp;<span class="op" id="2941294">+=</span>&nbsp;<span class="ident" id="2941297"><a href="/strings/replace.go.html#2941246">nw</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2941301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2941304">return</span><br>
<span class="lineno"></span><span class="op" id="2941311">}</span>
</div>
</body>
</html>
