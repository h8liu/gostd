<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html" class="current">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2994410">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2994465">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2994519">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2994570">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="2994638">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="2994684">//</span><br>
<span class="lineno"></span><span class="comment" id="2994687">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbsp;signed&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="2994712">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsp;rational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="2994738">//</span><br>
<span class="lineno"></span><span class="comment" id="2994741">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="2994779">//</span><br>
<span class="lineno"></span><span class="comment" id="2994782">//&nbsp;&nbsp;&nbsp;&nbsp;func&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp;(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="2994837">//</span><br>
<span class="lineno">15</span><span class="comment" id="2994840">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2994914">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="2994987">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="2995061">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2995135">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="2995152">//</span><br>
<span class="lineno"></span><span class="keyword" id="2995155">package</span>&nbsp;<span class="ident" id="2995163">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2995168">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="2995239">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="2995310">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995329">import</span>&nbsp;<span class="op" id="2995336">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2995339">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2995349">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2995355">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2995363">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2995376">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="2995383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="2995386">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="2995423">//</span><br>
<span class="lineno"></span><span class="comment" id="2995426">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="2995492">//</span><br>
<span class="lineno"></span><span class="comment" id="2995495">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="2995567">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="2995614">//</span><br>
<span class="lineno"></span><span class="comment" id="2995617">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2995686">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2995757">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="2995828">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="2995891">//</span><br>
<span class="lineno"></span><span class="keyword" id="2995894">type</span>&nbsp;<span class="ident" id="2995899">nat</span>&nbsp;<span class="op" id="2995903">[</span><span class="op" id="2995904">]</span><span class="ident" id="2995905">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2995911">var</span>&nbsp;<span class="op" id="2995915">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995918">natOne</span>&nbsp;<span class="op" id="2995925">=</span>&nbsp;<span class="ident" id="2995927">nat</span><span class="op" id="2995930">{</span><span class="num" id="2995931">1</span><span class="op" id="2995932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995935">natTwo</span>&nbsp;<span class="op" id="2995942">=</span>&nbsp;<span class="ident" id="2995944">nat</span><span class="op" id="2995947">{</span><span class="num" id="2995948">2</span><span class="op" id="2995949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2995952">natTen</span>&nbsp;<span class="op" id="2995959">=</span>&nbsp;<span class="ident" id="2995961">nat</span><span class="op" id="2995964">{</span><span class="num" id="2995965">10</span><span class="op" id="2995967">}</span><br>
<span class="lineno"></span><span class="op" id="2995969">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="2995972">func</span>&nbsp;<span class="op" id="2995977">(</span><span class="ident" id="2995978">z</span>&nbsp;<span class="ident" id="2995980">nat</span><span class="op" id="2995983">)</span>&nbsp;<span class="ident" id="2995985">clear</span><span class="op" id="2995990">(</span><span class="op" id="2995991">)</span>&nbsp;<span class="op" id="2995993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2995996">for</span>&nbsp;<span class="ident" id="2996000">i</span>&nbsp;<span class="op" id="2996002">:=</span>&nbsp;<span class="keyword" id="2996005">range</span>&nbsp;<span class="ident" id="2996011">z</span>&nbsp;<span class="op" id="2996013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996017">z</span><span class="op" id="2996018">[</span><span class="ident" id="2996019">i</span><span class="op" id="2996020">]</span>&nbsp;<span class="op" id="2996022">=</span>&nbsp;<span class="num" id="2996024">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996027">}</span><br>
<span class="lineno"></span><span class="op" id="2996029">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="2996032">func</span>&nbsp;<span class="op" id="2996037">(</span><span class="ident" id="2996038">z</span>&nbsp;<span class="ident" id="2996040">nat</span><span class="op" id="2996043">)</span>&nbsp;<span class="ident" id="2996045">norm</span><span class="op" id="2996049">(</span><span class="op" id="2996050">)</span>&nbsp;<span class="ident" id="2996052">nat</span>&nbsp;<span class="op" id="2996056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996059">i</span>&nbsp;<span class="op" id="2996061">:=</span>&nbsp;<span class="builtinfunc" id="2996064">len</span><span class="op" id="2996067">(</span><span class="ident" id="2996068">z</span><span class="op" id="2996069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996072">for</span>&nbsp;<span class="ident" id="2996076">i</span>&nbsp;<span class="op" id="2996078">&gt;</span>&nbsp;<span class="num" id="2996080">0</span>&nbsp;<span class="op" id="2996082">&amp;&amp;</span>&nbsp;<span class="ident" id="2996085">z</span><span class="op" id="2996086">[</span><span class="ident" id="2996087">i</span><span class="op" id="2996088">-</span><span class="num" id="2996089">1</span><span class="op" id="2996090">]</span>&nbsp;<span class="op" id="2996092">==</span>&nbsp;<span class="num" id="2996095">0</span>&nbsp;<span class="op" id="2996097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996101">i</span><span class="op" id="2996102">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996109">return</span>&nbsp;<span class="ident" id="2996116">z</span><span class="op" id="2996117">[</span><span class="num" id="2996118">0</span><span class="op" id="2996119">:</span><span class="ident" id="2996120">i</span><span class="op" id="2996121">]</span><br>
<span class="lineno"></span><span class="op" id="2996123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2996126">func</span>&nbsp;<span class="op" id="2996131">(</span><span class="ident" id="2996132">z</span>&nbsp;<span class="ident" id="2996134">nat</span><span class="op" id="2996137">)</span>&nbsp;<span class="builtinfunc" id="2996139">make</span><span class="op" id="2996143">(</span><span class="ident" id="2996144">n</span>&nbsp;<span class="builtintype" id="2996146">int</span><span class="op" id="2996149">)</span>&nbsp;<span class="ident" id="2996151">nat</span>&nbsp;<span class="op" id="2996155">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996158">if</span>&nbsp;<span class="ident" id="2996161">n</span>&nbsp;<span class="op" id="2996163">&lt;=</span>&nbsp;<span class="builtinfunc" id="2996166">cap</span><span class="op" id="2996169">(</span><span class="ident" id="2996170">z</span><span class="op" id="2996171">)</span>&nbsp;<span class="op" id="2996173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996177">return</span>&nbsp;<span class="ident" id="2996184">z</span><span class="op" id="2996185">[</span><span class="num" id="2996186">0</span><span class="op" id="2996187">:</span><span class="ident" id="2996188">n</span><span class="op" id="2996189">]</span>&nbsp;<span class="comment" id="2996191">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996206">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996273">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996337">const</span>&nbsp;<span class="ident" id="2996343">e</span>&nbsp;<span class="op" id="2996345">=</span>&nbsp;<span class="num" id="2996347">4</span>&nbsp;<span class="comment" id="2996349">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996368">return</span>&nbsp;<span class="builtinfunc" id="2996375">make</span><span class="op" id="2996379">(</span><span class="ident" id="2996380">nat</span><span class="op" id="2996383">,</span>&nbsp;<span class="ident" id="2996385">n</span><span class="op" id="2996386">,</span>&nbsp;<span class="ident" id="2996388">n</span><span class="op" id="2996389">+</span><span class="ident" id="2996390">e</span><span class="op" id="2996391">)</span><br>
<span class="lineno"></span><span class="op" id="2996393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2996396">func</span>&nbsp;<span class="op" id="2996401">(</span><span class="ident" id="2996402">z</span>&nbsp;<span class="ident" id="2996404">nat</span><span class="op" id="2996407">)</span>&nbsp;<span class="ident" id="2996409">setWord</span><span class="op" id="2996416">(</span><span class="ident" id="2996417">x</span>&nbsp;<span class="ident" id="2996419">Word</span><span class="op" id="2996423">)</span>&nbsp;<span class="ident" id="2996425">nat</span>&nbsp;<span class="op" id="2996429">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996432">if</span>&nbsp;<span class="ident" id="2996435">x</span>&nbsp;<span class="op" id="2996437">==</span>&nbsp;<span class="num" id="2996440">0</span>&nbsp;<span class="op" id="2996442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996446">return</span>&nbsp;<span class="ident" id="2996453">z</span><span class="op" id="2996454">.</span><span class="builtinfunc" id="2996455">make</span><span class="op" id="2996459">(</span><span class="num" id="2996460">0</span><span class="op" id="2996461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996467">z</span>&nbsp;<span class="op" id="2996469">=</span>&nbsp;<span class="ident" id="2996471">z</span><span class="op" id="2996472">.</span><span class="builtinfunc" id="2996473">make</span><span class="op" id="2996477">(</span><span class="num" id="2996478">1</span><span class="op" id="2996479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996482">z</span><span class="op" id="2996483">[</span><span class="num" id="2996484">0</span><span class="op" id="2996485">]</span>&nbsp;<span class="op" id="2996487">=</span>&nbsp;<span class="ident" id="2996489">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996492">return</span>&nbsp;<span class="ident" id="2996499">z</span><br>
<span class="lineno"></span><span class="op" id="2996501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2996504">func</span>&nbsp;<span class="op" id="2996509">(</span><span class="ident" id="2996510">z</span>&nbsp;<span class="ident" id="2996512">nat</span><span class="op" id="2996515">)</span>&nbsp;<span class="ident" id="2996517">setUint64</span><span class="op" id="2996526">(</span><span class="ident" id="2996527">x</span>&nbsp;<span class="ident" id="2996529">uint64</span><span class="op" id="2996535">)</span>&nbsp;<span class="ident" id="2996537">nat</span>&nbsp;<span class="op" id="2996541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996544">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996568">if</span>&nbsp;<span class="ident" id="2996571">w</span>&nbsp;<span class="op" id="2996573">:=</span>&nbsp;<span class="ident" id="2996576">Word</span><span class="op" id="2996580">(</span><span class="ident" id="2996581">x</span><span class="op" id="2996582">)</span><span class="op" id="2996583">;</span>&nbsp;<span class="ident" id="2996585">uint64</span><span class="op" id="2996591">(</span><span class="ident" id="2996592">w</span><span class="op" id="2996593">)</span>&nbsp;<span class="op" id="2996595">==</span>&nbsp;<span class="ident" id="2996598">x</span>&nbsp;<span class="op" id="2996600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996604">return</span>&nbsp;<span class="ident" id="2996611">z</span><span class="op" id="2996612">.</span><span class="ident" id="2996613">setWord</span><span class="op" id="2996620">(</span><span class="ident" id="2996621">w</span><span class="op" id="2996622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996629">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996683">n</span>&nbsp;<span class="op" id="2996685">:=</span>&nbsp;<span class="num" id="2996688">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996691">for</span>&nbsp;<span class="ident" id="2996695">t</span>&nbsp;<span class="op" id="2996697">:=</span>&nbsp;<span class="ident" id="2996700">x</span><span class="op" id="2996701">;</span>&nbsp;<span class="ident" id="2996703">t</span>&nbsp;<span class="op" id="2996705">&gt;</span>&nbsp;<span class="num" id="2996707">0</span><span class="op" id="2996708">;</span>&nbsp;<span class="ident" id="2996710">t</span>&nbsp;<span class="op" id="2996712">&gt;&gt;=</span>&nbsp;<span class="ident" id="2996716">_W</span>&nbsp;<span class="op" id="2996719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996723">n</span><span class="op" id="2996724">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2996732">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996757">z</span>&nbsp;<span class="op" id="2996759">=</span>&nbsp;<span class="ident" id="2996761">z</span><span class="op" id="2996762">.</span><span class="builtinfunc" id="2996763">make</span><span class="op" id="2996767">(</span><span class="ident" id="2996768">n</span><span class="op" id="2996769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996772">for</span>&nbsp;<span class="ident" id="2996776">i</span>&nbsp;<span class="op" id="2996778">:=</span>&nbsp;<span class="keyword" id="2996781">range</span>&nbsp;<span class="ident" id="2996787">z</span>&nbsp;<span class="op" id="2996789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996793">z</span><span class="op" id="2996794">[</span><span class="ident" id="2996795">i</span><span class="op" id="2996796">]</span>&nbsp;<span class="op" id="2996798">=</span>&nbsp;<span class="ident" id="2996800">Word</span><span class="op" id="2996804">(</span><span class="ident" id="2996805">x</span>&nbsp;<span class="op" id="2996807">&amp;</span>&nbsp;<span class="ident" id="2996809">_M</span><span class="op" id="2996811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996815">x</span>&nbsp;<span class="op" id="2996817">&gt;&gt;=</span>&nbsp;<span class="ident" id="2996821">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2996825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996829">return</span>&nbsp;<span class="ident" id="2996836">z</span><br>
<span class="lineno"></span><span class="op" id="2996838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="2996841">func</span>&nbsp;<span class="op" id="2996846">(</span><span class="ident" id="2996847">z</span>&nbsp;<span class="ident" id="2996849">nat</span><span class="op" id="2996852">)</span>&nbsp;<span class="ident" id="2996854">set</span><span class="op" id="2996857">(</span><span class="ident" id="2996858">x</span>&nbsp;<span class="ident" id="2996860">nat</span><span class="op" id="2996863">)</span>&nbsp;<span class="ident" id="2996865">nat</span>&nbsp;<span class="op" id="2996869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996872">z</span>&nbsp;<span class="op" id="2996874">=</span>&nbsp;<span class="ident" id="2996876">z</span><span class="op" id="2996877">.</span><span class="builtinfunc" id="2996878">make</span><span class="op" id="2996882">(</span><span class="builtinfunc" id="2996883">len</span><span class="op" id="2996886">(</span><span class="ident" id="2996887">x</span><span class="op" id="2996888">)</span><span class="op" id="2996889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2996892">copy</span><span class="op" id="2996896">(</span><span class="ident" id="2996897">z</span><span class="op" id="2996898">,</span>&nbsp;<span class="ident" id="2996900">x</span><span class="op" id="2996901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996904">return</span>&nbsp;<span class="ident" id="2996911">z</span><br>
<span class="lineno"></span><span class="op" id="2996913">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="2996916">func</span>&nbsp;<span class="op" id="2996921">(</span><span class="ident" id="2996922">z</span>&nbsp;<span class="ident" id="2996924">nat</span><span class="op" id="2996927">)</span>&nbsp;<span class="ident" id="2996929">add</span><span class="op" id="2996932">(</span><span class="ident" id="2996933">x</span><span class="op" id="2996934">,</span>&nbsp;<span class="ident" id="2996936">y</span>&nbsp;<span class="ident" id="2996938">nat</span><span class="op" id="2996941">)</span>&nbsp;<span class="ident" id="2996943">nat</span>&nbsp;<span class="op" id="2996947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996950">m</span>&nbsp;<span class="op" id="2996952">:=</span>&nbsp;<span class="builtinfunc" id="2996955">len</span><span class="op" id="2996958">(</span><span class="ident" id="2996959">x</span><span class="op" id="2996960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2996963">n</span>&nbsp;<span class="op" id="2996965">:=</span>&nbsp;<span class="builtinfunc" id="2996968">len</span><span class="op" id="2996971">(</span><span class="ident" id="2996972">y</span><span class="op" id="2996973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996977">switch</span>&nbsp;<span class="op" id="2996984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2996987">case</span>&nbsp;<span class="ident" id="2996992">m</span>&nbsp;<span class="op" id="2996994">&lt;</span>&nbsp;<span class="ident" id="2996996">n</span><span class="op" id="2996997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997001">return</span>&nbsp;<span class="ident" id="2997008">z</span><span class="op" id="2997009">.</span><span class="ident" id="2997010">add</span><span class="op" id="2997013">(</span><span class="ident" id="2997014">y</span><span class="op" id="2997015">,</span>&nbsp;<span class="ident" id="2997017">x</span><span class="op" id="2997018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997021">case</span>&nbsp;<span class="ident" id="2997026">m</span>&nbsp;<span class="op" id="2997028">==</span>&nbsp;<span class="num" id="2997031">0</span><span class="op" id="2997032">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997036">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997076">return</span>&nbsp;<span class="ident" id="2997083">z</span><span class="op" id="2997084">.</span><span class="builtinfunc" id="2997085">make</span><span class="op" id="2997089">(</span><span class="num" id="2997090">0</span><span class="op" id="2997091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997094">case</span>&nbsp;<span class="ident" id="2997099">n</span>&nbsp;<span class="op" id="2997101">==</span>&nbsp;<span class="num" id="2997104">0</span><span class="op" id="2997105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997109">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997126">return</span>&nbsp;<span class="ident" id="2997133">z</span><span class="op" id="2997134">.</span><span class="ident" id="2997135">set</span><span class="op" id="2997138">(</span><span class="ident" id="2997139">x</span><span class="op" id="2997140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997143">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997146">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997157">z</span>&nbsp;<span class="op" id="2997159">=</span>&nbsp;<span class="ident" id="2997161">z</span><span class="op" id="2997162">.</span><span class="builtinfunc" id="2997163">make</span><span class="op" id="2997167">(</span><span class="ident" id="2997168">m</span>&nbsp;<span class="op" id="2997170">+</span>&nbsp;<span class="num" id="2997172">1</span><span class="op" id="2997173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997176">c</span>&nbsp;<span class="op" id="2997178">:=</span>&nbsp;<span class="ident" id="2997181">addVV</span><span class="op" id="2997186">(</span><span class="ident" id="2997187">z</span><span class="op" id="2997188">[</span><span class="num" id="2997189">0</span><span class="op" id="2997190">:</span><span class="ident" id="2997191">n</span><span class="op" id="2997192">]</span><span class="op" id="2997193">,</span>&nbsp;<span class="ident" id="2997195">x</span><span class="op" id="2997196">,</span>&nbsp;<span class="ident" id="2997198">y</span><span class="op" id="2997199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997202">if</span>&nbsp;<span class="ident" id="2997205">m</span>&nbsp;<span class="op" id="2997207">&gt;</span>&nbsp;<span class="ident" id="2997209">n</span>&nbsp;<span class="op" id="2997211">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997215">c</span>&nbsp;<span class="op" id="2997217">=</span>&nbsp;<span class="ident" id="2997219">addVW</span><span class="op" id="2997224">(</span><span class="ident" id="2997225">z</span><span class="op" id="2997226">[</span><span class="ident" id="2997227">n</span><span class="op" id="2997228">:</span><span class="ident" id="2997229">m</span><span class="op" id="2997230">]</span><span class="op" id="2997231">,</span>&nbsp;<span class="ident" id="2997233">x</span><span class="op" id="2997234">[</span><span class="ident" id="2997235">n</span><span class="op" id="2997236">:</span><span class="op" id="2997237">]</span><span class="op" id="2997238">,</span>&nbsp;<span class="ident" id="2997240">c</span><span class="op" id="2997241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997247">z</span><span class="op" id="2997248">[</span><span class="ident" id="2997249">m</span><span class="op" id="2997250">]</span>&nbsp;<span class="op" id="2997252">=</span>&nbsp;<span class="ident" id="2997254">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997258">return</span>&nbsp;<span class="ident" id="2997265">z</span><span class="op" id="2997266">.</span><span class="ident" id="2997267">norm</span><span class="op" id="2997271">(</span><span class="op" id="2997272">)</span><br>
<span class="lineno">140</span><span class="op" id="2997274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2997277">func</span>&nbsp;<span class="op" id="2997282">(</span><span class="ident" id="2997283">z</span>&nbsp;<span class="ident" id="2997285">nat</span><span class="op" id="2997288">)</span>&nbsp;<span class="ident" id="2997290">sub</span><span class="op" id="2997293">(</span><span class="ident" id="2997294">x</span><span class="op" id="2997295">,</span>&nbsp;<span class="ident" id="2997297">y</span>&nbsp;<span class="ident" id="2997299">nat</span><span class="op" id="2997302">)</span>&nbsp;<span class="ident" id="2997304">nat</span>&nbsp;<span class="op" id="2997308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997311">m</span>&nbsp;<span class="op" id="2997313">:=</span>&nbsp;<span class="builtinfunc" id="2997316">len</span><span class="op" id="2997319">(</span><span class="ident" id="2997320">x</span><span class="op" id="2997321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997324">n</span>&nbsp;<span class="op" id="2997326">:=</span>&nbsp;<span class="builtinfunc" id="2997329">len</span><span class="op" id="2997332">(</span><span class="ident" id="2997333">y</span><span class="op" id="2997334">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997338">switch</span>&nbsp;<span class="op" id="2997345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997348">case</span>&nbsp;<span class="ident" id="2997353">m</span>&nbsp;<span class="op" id="2997355">&lt;</span>&nbsp;<span class="ident" id="2997357">n</span><span class="op" id="2997358">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2997362">panic</span><span class="op" id="2997367">(</span><span class="string" id="2997368">&#34;underflow&#34;</span><span class="op" id="2997379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997382">case</span>&nbsp;<span class="ident" id="2997387">m</span>&nbsp;<span class="op" id="2997389">==</span>&nbsp;<span class="num" id="2997392">0</span><span class="op" id="2997393">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997397">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997437">return</span>&nbsp;<span class="ident" id="2997444">z</span><span class="op" id="2997445">.</span><span class="builtinfunc" id="2997446">make</span><span class="op" id="2997450">(</span><span class="num" id="2997451">0</span><span class="op" id="2997452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997455">case</span>&nbsp;<span class="ident" id="2997460">n</span>&nbsp;<span class="op" id="2997462">==</span>&nbsp;<span class="num" id="2997465">0</span><span class="op" id="2997466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997470">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997487">return</span>&nbsp;<span class="ident" id="2997494">z</span><span class="op" id="2997495">.</span><span class="ident" id="2997496">set</span><span class="op" id="2997499">(</span><span class="ident" id="2997500">x</span><span class="op" id="2997501">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2997507">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997518">z</span>&nbsp;<span class="op" id="2997520">=</span>&nbsp;<span class="ident" id="2997522">z</span><span class="op" id="2997523">.</span><span class="builtinfunc" id="2997524">make</span><span class="op" id="2997528">(</span><span class="ident" id="2997529">m</span><span class="op" id="2997530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997533">c</span>&nbsp;<span class="op" id="2997535">:=</span>&nbsp;<span class="ident" id="2997538">subVV</span><span class="op" id="2997543">(</span><span class="ident" id="2997544">z</span><span class="op" id="2997545">[</span><span class="num" id="2997546">0</span><span class="op" id="2997547">:</span><span class="ident" id="2997548">n</span><span class="op" id="2997549">]</span><span class="op" id="2997550">,</span>&nbsp;<span class="ident" id="2997552">x</span><span class="op" id="2997553">,</span>&nbsp;<span class="ident" id="2997555">y</span><span class="op" id="2997556">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997559">if</span>&nbsp;<span class="ident" id="2997562">m</span>&nbsp;<span class="op" id="2997564">&gt;</span>&nbsp;<span class="ident" id="2997566">n</span>&nbsp;<span class="op" id="2997568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997572">c</span>&nbsp;<span class="op" id="2997574">=</span>&nbsp;<span class="ident" id="2997576">subVW</span><span class="op" id="2997581">(</span><span class="ident" id="2997582">z</span><span class="op" id="2997583">[</span><span class="ident" id="2997584">n</span><span class="op" id="2997585">:</span><span class="op" id="2997586">]</span><span class="op" id="2997587">,</span>&nbsp;<span class="ident" id="2997589">x</span><span class="op" id="2997590">[</span><span class="ident" id="2997591">n</span><span class="op" id="2997592">:</span><span class="op" id="2997593">]</span><span class="op" id="2997594">,</span>&nbsp;<span class="ident" id="2997596">c</span><span class="op" id="2997597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997603">if</span>&nbsp;<span class="ident" id="2997606">c</span>&nbsp;<span class="op" id="2997608">!=</span>&nbsp;<span class="num" id="2997611">0</span>&nbsp;<span class="op" id="2997613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2997617">panic</span><span class="op" id="2997622">(</span><span class="string" id="2997623">&#34;underflow&#34;</span><span class="op" id="2997634">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997641">return</span>&nbsp;<span class="ident" id="2997648">z</span><span class="op" id="2997649">.</span><span class="ident" id="2997650">norm</span><span class="op" id="2997654">(</span><span class="op" id="2997655">)</span><br>
<span class="lineno"></span><span class="op" id="2997657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="2997660">func</span>&nbsp;<span class="op" id="2997665">(</span><span class="ident" id="2997666">x</span>&nbsp;<span class="ident" id="2997668">nat</span><span class="op" id="2997671">)</span>&nbsp;<span class="ident" id="2997673">cmp</span><span class="op" id="2997676">(</span><span class="ident" id="2997677">y</span>&nbsp;<span class="ident" id="2997679">nat</span><span class="op" id="2997682">)</span>&nbsp;<span class="op" id="2997684">(</span><span class="ident" id="2997685">r</span>&nbsp;<span class="builtintype" id="2997687">int</span><span class="op" id="2997690">)</span>&nbsp;<span class="op" id="2997692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997695">m</span>&nbsp;<span class="op" id="2997697">:=</span>&nbsp;<span class="builtinfunc" id="2997700">len</span><span class="op" id="2997703">(</span><span class="ident" id="2997704">x</span><span class="op" id="2997705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997708">n</span>&nbsp;<span class="op" id="2997710">:=</span>&nbsp;<span class="builtinfunc" id="2997713">len</span><span class="op" id="2997716">(</span><span class="ident" id="2997717">y</span><span class="op" id="2997718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997721">if</span>&nbsp;<span class="ident" id="2997724">m</span>&nbsp;<span class="op" id="2997726">!=</span>&nbsp;<span class="ident" id="2997729">n</span>&nbsp;<span class="op" id="2997731">||</span>&nbsp;<span class="ident" id="2997734">m</span>&nbsp;<span class="op" id="2997736">==</span>&nbsp;<span class="num" id="2997739">0</span>&nbsp;<span class="op" id="2997741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997745">switch</span>&nbsp;<span class="op" id="2997752">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997756">case</span>&nbsp;<span class="ident" id="2997761">m</span>&nbsp;<span class="op" id="2997763">&lt;</span>&nbsp;<span class="ident" id="2997765">n</span><span class="op" id="2997766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997771">r</span>&nbsp;<span class="op" id="2997773">=</span>&nbsp;<span class="op" id="2997775">-</span><span class="num" id="2997776">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997780">case</span>&nbsp;<span class="ident" id="2997785">m</span>&nbsp;<span class="op" id="2997787">&gt;</span>&nbsp;<span class="ident" id="2997789">n</span><span class="op" id="2997790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997795">r</span>&nbsp;<span class="op" id="2997797">=</span>&nbsp;<span class="num" id="2997799">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997803">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997807">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997819">i</span>&nbsp;<span class="op" id="2997821">:=</span>&nbsp;<span class="ident" id="2997824">m</span>&nbsp;<span class="op" id="2997826">-</span>&nbsp;<span class="num" id="2997828">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997831">for</span>&nbsp;<span class="ident" id="2997835">i</span>&nbsp;<span class="op" id="2997837">&gt;</span>&nbsp;<span class="num" id="2997839">0</span>&nbsp;<span class="op" id="2997841">&amp;&amp;</span>&nbsp;<span class="ident" id="2997844">x</span><span class="op" id="2997845">[</span><span class="ident" id="2997846">i</span><span class="op" id="2997847">]</span>&nbsp;<span class="op" id="2997849">==</span>&nbsp;<span class="ident" id="2997852">y</span><span class="op" id="2997853">[</span><span class="ident" id="2997854">i</span><span class="op" id="2997855">]</span>&nbsp;<span class="op" id="2997857">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997861">i</span><span class="op" id="2997862">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997870">switch</span>&nbsp;<span class="op" id="2997877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997880">case</span>&nbsp;<span class="ident" id="2997885">x</span><span class="op" id="2997886">[</span><span class="ident" id="2997887">i</span><span class="op" id="2997888">]</span>&nbsp;<span class="op" id="2997890">&lt;</span>&nbsp;<span class="ident" id="2997892">y</span><span class="op" id="2997893">[</span><span class="ident" id="2997894">i</span><span class="op" id="2997895">]</span><span class="op" id="2997896">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997900">r</span>&nbsp;<span class="op" id="2997902">=</span>&nbsp;<span class="op" id="2997904">-</span><span class="num" id="2997905">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997908">case</span>&nbsp;<span class="ident" id="2997913">x</span><span class="op" id="2997914">[</span><span class="ident" id="2997915">i</span><span class="op" id="2997916">]</span>&nbsp;<span class="op" id="2997918">&gt;</span>&nbsp;<span class="ident" id="2997920">y</span><span class="op" id="2997921">[</span><span class="ident" id="2997922">i</span><span class="op" id="2997923">]</span><span class="op" id="2997924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997928">r</span>&nbsp;<span class="op" id="2997930">=</span>&nbsp;<span class="num" id="2997932">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2997935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2997938">return</span><br>
<span class="lineno">195</span><span class="op" id="2997945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2997948">func</span>&nbsp;<span class="op" id="2997953">(</span><span class="ident" id="2997954">z</span>&nbsp;<span class="ident" id="2997956">nat</span><span class="op" id="2997959">)</span>&nbsp;<span class="ident" id="2997961">mulAddWW</span><span class="op" id="2997969">(</span><span class="ident" id="2997970">x</span>&nbsp;<span class="ident" id="2997972">nat</span><span class="op" id="2997975">,</span>&nbsp;<span class="ident" id="2997977">y</span><span class="op" id="2997978">,</span>&nbsp;<span class="ident" id="2997980">r</span>&nbsp;<span class="ident" id="2997982">Word</span><span class="op" id="2997986">)</span>&nbsp;<span class="ident" id="2997988">nat</span>&nbsp;<span class="op" id="2997992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2997995">m</span>&nbsp;<span class="op" id="2997997">:=</span>&nbsp;<span class="builtinfunc" id="2998000">len</span><span class="op" id="2998003">(</span><span class="ident" id="2998004">x</span><span class="op" id="2998005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998008">if</span>&nbsp;<span class="ident" id="2998011">m</span>&nbsp;<span class="op" id="2998013">==</span>&nbsp;<span class="num" id="2998016">0</span>&nbsp;<span class="op" id="2998018">||</span>&nbsp;<span class="ident" id="2998021">y</span>&nbsp;<span class="op" id="2998023">==</span>&nbsp;<span class="num" id="2998026">0</span>&nbsp;<span class="op" id="2998028">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998032">return</span>&nbsp;<span class="ident" id="2998039">z</span><span class="op" id="2998040">.</span><span class="ident" id="2998041">setWord</span><span class="op" id="2998048">(</span><span class="ident" id="2998049">r</span><span class="op" id="2998050">)</span>&nbsp;<span class="comment" id="2998052">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2998071">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998082">z</span>&nbsp;<span class="op" id="2998084">=</span>&nbsp;<span class="ident" id="2998086">z</span><span class="op" id="2998087">.</span><span class="builtinfunc" id="2998088">make</span><span class="op" id="2998092">(</span><span class="ident" id="2998093">m</span>&nbsp;<span class="op" id="2998095">+</span>&nbsp;<span class="num" id="2998097">1</span><span class="op" id="2998098">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998101">z</span><span class="op" id="2998102">[</span><span class="ident" id="2998103">m</span><span class="op" id="2998104">]</span>&nbsp;<span class="op" id="2998106">=</span>&nbsp;<span class="ident" id="2998108">mulAddVWW</span><span class="op" id="2998117">(</span><span class="ident" id="2998118">z</span><span class="op" id="2998119">[</span><span class="num" id="2998120">0</span><span class="op" id="2998121">:</span><span class="ident" id="2998122">m</span><span class="op" id="2998123">]</span><span class="op" id="2998124">,</span>&nbsp;<span class="ident" id="2998126">x</span><span class="op" id="2998127">,</span>&nbsp;<span class="ident" id="2998129">y</span><span class="op" id="2998130">,</span>&nbsp;<span class="ident" id="2998132">r</span><span class="op" id="2998133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998137">return</span>&nbsp;<span class="ident" id="2998144">z</span><span class="op" id="2998145">.</span><span class="ident" id="2998146">norm</span><span class="op" id="2998150">(</span><span class="op" id="2998151">)</span><br>
<span class="lineno"></span><span class="op" id="2998153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="2998156">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="2998215">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="2998283">func</span>&nbsp;<span class="ident" id="2998288">basicMul</span><span class="op" id="2998296">(</span><span class="ident" id="2998297">z</span><span class="op" id="2998298">,</span>&nbsp;<span class="ident" id="2998300">x</span><span class="op" id="2998301">,</span>&nbsp;<span class="ident" id="2998303">y</span>&nbsp;<span class="ident" id="2998305">nat</span><span class="op" id="2998308">)</span>&nbsp;<span class="op" id="2998310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998313">z</span><span class="op" id="2998314">[</span><span class="num" id="2998315">0</span>&nbsp;<span class="op" id="2998317">:</span>&nbsp;<span class="builtinfunc" id="2998319">len</span><span class="op" id="2998322">(</span><span class="ident" id="2998323">x</span><span class="op" id="2998324">)</span><span class="op" id="2998325">+</span><span class="builtinfunc" id="2998326">len</span><span class="op" id="2998329">(</span><span class="ident" id="2998330">y</span><span class="op" id="2998331">)</span><span class="op" id="2998332">]</span><span class="op" id="2998333">.</span><span class="ident" id="2998334">clear</span><span class="op" id="2998339">(</span><span class="op" id="2998340">)</span>&nbsp;<span class="comment" id="2998342">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998359">for</span>&nbsp;<span class="ident" id="2998363">i</span><span class="op" id="2998364">,</span>&nbsp;<span class="ident" id="2998366">d</span>&nbsp;<span class="op" id="2998368">:=</span>&nbsp;<span class="keyword" id="2998371">range</span>&nbsp;<span class="ident" id="2998377">y</span>&nbsp;<span class="op" id="2998379">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998383">if</span>&nbsp;<span class="ident" id="2998386">d</span>&nbsp;<span class="op" id="2998388">!=</span>&nbsp;<span class="num" id="2998391">0</span>&nbsp;<span class="op" id="2998393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998398">z</span><span class="op" id="2998399">[</span><span class="builtinfunc" id="2998400">len</span><span class="op" id="2998403">(</span><span class="ident" id="2998404">x</span><span class="op" id="2998405">)</span><span class="op" id="2998406">+</span><span class="ident" id="2998407">i</span><span class="op" id="2998408">]</span>&nbsp;<span class="op" id="2998410">=</span>&nbsp;<span class="ident" id="2998412">addMulVVW</span><span class="op" id="2998421">(</span><span class="ident" id="2998422">z</span><span class="op" id="2998423">[</span><span class="ident" id="2998424">i</span><span class="op" id="2998425">:</span><span class="ident" id="2998426">i</span><span class="op" id="2998427">+</span><span class="builtinfunc" id="2998428">len</span><span class="op" id="2998431">(</span><span class="ident" id="2998432">x</span><span class="op" id="2998433">)</span><span class="op" id="2998434">]</span><span class="op" id="2998435">,</span>&nbsp;<span class="ident" id="2998437">x</span><span class="op" id="2998438">,</span>&nbsp;<span class="ident" id="2998440">d</span><span class="op" id="2998441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998448">}</span><br>
<span class="lineno"></span><span class="op" id="2998450">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="2998453">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="2998528">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="2998592">func</span>&nbsp;<span class="ident" id="2998597">karatsubaAdd</span><span class="op" id="2998609">(</span><span class="ident" id="2998610">z</span><span class="op" id="2998611">,</span>&nbsp;<span class="ident" id="2998613">x</span>&nbsp;<span class="ident" id="2998615">nat</span><span class="op" id="2998618">,</span>&nbsp;<span class="ident" id="2998620">n</span>&nbsp;<span class="builtintype" id="2998622">int</span><span class="op" id="2998625">)</span>&nbsp;<span class="op" id="2998627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998630">if</span>&nbsp;<span class="ident" id="2998633">c</span>&nbsp;<span class="op" id="2998635">:=</span>&nbsp;<span class="ident" id="2998638">addVV</span><span class="op" id="2998643">(</span><span class="ident" id="2998644">z</span><span class="op" id="2998645">[</span><span class="num" id="2998646">0</span><span class="op" id="2998647">:</span><span class="ident" id="2998648">n</span><span class="op" id="2998649">]</span><span class="op" id="2998650">,</span>&nbsp;<span class="ident" id="2998652">z</span><span class="op" id="2998653">,</span>&nbsp;<span class="ident" id="2998655">x</span><span class="op" id="2998656">)</span><span class="op" id="2998657">;</span>&nbsp;<span class="ident" id="2998659">c</span>&nbsp;<span class="op" id="2998661">!=</span>&nbsp;<span class="num" id="2998664">0</span>&nbsp;<span class="op" id="2998666">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998670">addVW</span><span class="op" id="2998675">(</span><span class="ident" id="2998676">z</span><span class="op" id="2998677">[</span><span class="ident" id="2998678">n</span><span class="op" id="2998679">:</span><span class="ident" id="2998680">n</span><span class="op" id="2998681">+</span><span class="ident" id="2998682">n</span><span class="op" id="2998683">&gt;&gt;</span><span class="num" id="2998685">1</span><span class="op" id="2998686">]</span><span class="op" id="2998687">,</span>&nbsp;<span class="ident" id="2998689">z</span><span class="op" id="2998690">[</span><span class="ident" id="2998691">n</span><span class="op" id="2998692">:</span><span class="op" id="2998693">]</span><span class="op" id="2998694">,</span>&nbsp;<span class="ident" id="2998696">c</span><span class="op" id="2998697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998700">}</span><br>
<span class="lineno"></span><span class="op" id="2998702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2998705">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="2998746">func</span>&nbsp;<span class="ident" id="2998751">karatsubaSub</span><span class="op" id="2998763">(</span><span class="ident" id="2998764">z</span><span class="op" id="2998765">,</span>&nbsp;<span class="ident" id="2998767">x</span>&nbsp;<span class="ident" id="2998769">nat</span><span class="op" id="2998772">,</span>&nbsp;<span class="ident" id="2998774">n</span>&nbsp;<span class="builtintype" id="2998776">int</span><span class="op" id="2998779">)</span>&nbsp;<span class="op" id="2998781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2998784">if</span>&nbsp;<span class="ident" id="2998787">c</span>&nbsp;<span class="op" id="2998789">:=</span>&nbsp;<span class="ident" id="2998792">subVV</span><span class="op" id="2998797">(</span><span class="ident" id="2998798">z</span><span class="op" id="2998799">[</span><span class="num" id="2998800">0</span><span class="op" id="2998801">:</span><span class="ident" id="2998802">n</span><span class="op" id="2998803">]</span><span class="op" id="2998804">,</span>&nbsp;<span class="ident" id="2998806">z</span><span class="op" id="2998807">,</span>&nbsp;<span class="ident" id="2998809">x</span><span class="op" id="2998810">)</span><span class="op" id="2998811">;</span>&nbsp;<span class="ident" id="2998813">c</span>&nbsp;<span class="op" id="2998815">!=</span>&nbsp;<span class="num" id="2998818">0</span>&nbsp;<span class="op" id="2998820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2998824">subVW</span><span class="op" id="2998829">(</span><span class="ident" id="2998830">z</span><span class="op" id="2998831">[</span><span class="ident" id="2998832">n</span><span class="op" id="2998833">:</span><span class="ident" id="2998834">n</span><span class="op" id="2998835">+</span><span class="ident" id="2998836">n</span><span class="op" id="2998837">&gt;&gt;</span><span class="num" id="2998839">1</span><span class="op" id="2998840">]</span><span class="op" id="2998841">,</span>&nbsp;<span class="ident" id="2998843">z</span><span class="op" id="2998844">[</span><span class="ident" id="2998845">n</span><span class="op" id="2998846">:</span><span class="op" id="2998847">]</span><span class="op" id="2998848">,</span>&nbsp;<span class="ident" id="2998850">c</span><span class="op" id="2998851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2998854">}</span><br>
<span class="lineno"></span><span class="op" id="2998856">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="2998859">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="2998933">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="2999011">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2999023">var</span>&nbsp;<span class="ident" id="2999027">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="2999046">int</span>&nbsp;<span class="op" id="2999050">=</span>&nbsp;<span class="num" id="2999052">40</span>&nbsp;<span class="comment" id="2999055">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="2999084">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="2999144">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2999204">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="2999264">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="2999320">func</span>&nbsp;<span class="ident" id="2999325">karatsuba</span><span class="op" id="2999334">(</span><span class="ident" id="2999335">z</span><span class="op" id="2999336">,</span>&nbsp;<span class="ident" id="2999338">x</span><span class="op" id="2999339">,</span>&nbsp;<span class="ident" id="2999341">y</span>&nbsp;<span class="ident" id="2999343">nat</span><span class="op" id="2999346">)</span>&nbsp;<span class="op" id="2999348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999351">n</span>&nbsp;<span class="op" id="2999353">:=</span>&nbsp;<span class="builtinfunc" id="2999356">len</span><span class="op" id="2999359">(</span><span class="ident" id="2999360">y</span><span class="op" id="2999361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999365">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999429">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999489">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999507">if</span>&nbsp;<span class="ident" id="2999510">n</span><span class="op" id="2999511">&amp;</span><span class="num" id="2999512">1</span>&nbsp;<span class="op" id="2999514">!=</span>&nbsp;<span class="num" id="2999517">0</span>&nbsp;<span class="op" id="2999519">||</span>&nbsp;<span class="ident" id="2999522">n</span>&nbsp;<span class="op" id="2999524">&lt;</span>&nbsp;<span class="ident" id="2999526">karatsubaThreshold</span>&nbsp;<span class="op" id="2999545">||</span>&nbsp;<span class="ident" id="2999548">n</span>&nbsp;<span class="op" id="2999550">&lt;</span>&nbsp;<span class="num" id="2999552">2</span>&nbsp;<span class="op" id="2999554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2999558">basicMul</span><span class="op" id="2999566">(</span><span class="ident" id="2999567">z</span><span class="op" id="2999568">,</span>&nbsp;<span class="ident" id="2999570">x</span><span class="op" id="2999571">,</span>&nbsp;<span class="ident" id="2999573">y</span><span class="op" id="2999574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2999578">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2999586">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999589">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999640">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999702">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999736">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999740">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999760">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999780">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999784">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999847">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999865">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999869">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999919">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999969">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999973">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999983">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2999987">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000006">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000025">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000029">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000080">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000131">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000182">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000233">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000275">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000304">n2</span>&nbsp;<span class="op" id="3000307">:=</span>&nbsp;<span class="ident" id="3000310">n</span>&nbsp;<span class="op" id="3000312">&gt;&gt;</span>&nbsp;<span class="num" id="3000315">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000330">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000342">x1</span><span class="op" id="3000344">,</span>&nbsp;<span class="ident" id="3000346">x0</span>&nbsp;<span class="op" id="3000349">:=</span>&nbsp;<span class="ident" id="3000352">x</span><span class="op" id="3000353">[</span><span class="ident" id="3000354">n2</span><span class="op" id="3000356">:</span><span class="op" id="3000357">]</span><span class="op" id="3000358">,</span>&nbsp;<span class="ident" id="3000360">x</span><span class="op" id="3000361">[</span><span class="num" id="3000362">0</span><span class="op" id="3000363">:</span><span class="ident" id="3000364">n2</span><span class="op" id="3000366">]</span>&nbsp;<span class="comment" id="3000368">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000386">y1</span><span class="op" id="3000388">,</span>&nbsp;<span class="ident" id="3000390">y0</span>&nbsp;<span class="op" id="3000393">:=</span>&nbsp;<span class="ident" id="3000396">y</span><span class="op" id="3000397">[</span><span class="ident" id="3000398">n2</span><span class="op" id="3000400">:</span><span class="op" id="3000401">]</span><span class="op" id="3000402">,</span>&nbsp;<span class="ident" id="3000404">y</span><span class="op" id="3000405">[</span><span class="num" id="3000406">0</span><span class="op" id="3000407">:</span><span class="ident" id="3000408">n2</span><span class="op" id="3000410">]</span>&nbsp;<span class="comment" id="3000412">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000431">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000483">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000487">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000545">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000603">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000607">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000668">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000730">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000747">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000801">karatsuba</span><span class="op" id="3000810">(</span><span class="ident" id="3000811">z</span><span class="op" id="3000812">,</span>&nbsp;<span class="ident" id="3000814">x0</span><span class="op" id="3000816">,</span>&nbsp;<span class="ident" id="3000818">y0</span><span class="op" id="3000820">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000826">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000841">karatsuba</span><span class="op" id="3000850">(</span><span class="ident" id="3000851">z</span><span class="op" id="3000852">[</span><span class="ident" id="3000853">n</span><span class="op" id="3000854">:</span><span class="op" id="3000855">]</span><span class="op" id="3000856">,</span>&nbsp;<span class="ident" id="3000858">x1</span><span class="op" id="3000860">,</span>&nbsp;<span class="ident" id="3000862">y1</span><span class="op" id="3000864">)</span>&nbsp;<span class="comment" id="3000866">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3000882">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000941">s</span>&nbsp;<span class="op" id="3000943">:=</span>&nbsp;<span class="num" id="3000946">1</span>&nbsp;<span class="comment" id="3000948">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3000974">xd</span>&nbsp;<span class="op" id="3000977">:=</span>&nbsp;<span class="ident" id="3000980">z</span><span class="op" id="3000981">[</span><span class="num" id="3000982">2</span><span class="op" id="3000983">*</span><span class="ident" id="3000984">n</span>&nbsp;<span class="op" id="3000986">:</span>&nbsp;<span class="num" id="3000988">2</span><span class="op" id="3000989">*</span><span class="ident" id="3000990">n</span><span class="op" id="3000991">+</span><span class="ident" id="3000992">n2</span><span class="op" id="3000994">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3000997">if</span>&nbsp;<span class="ident" id="3001000">subVV</span><span class="op" id="3001005">(</span><span class="ident" id="3001006">xd</span><span class="op" id="3001008">,</span>&nbsp;<span class="ident" id="3001010">x1</span><span class="op" id="3001012">,</span>&nbsp;<span class="ident" id="3001014">x0</span><span class="op" id="3001016">)</span>&nbsp;<span class="op" id="3001018">!=</span>&nbsp;<span class="num" id="3001021">0</span>&nbsp;<span class="op" id="3001023">{</span>&nbsp;<span class="comment" id="3001025">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001036">s</span>&nbsp;<span class="op" id="3001038">=</span>&nbsp;<span class="op" id="3001040">-</span><span class="ident" id="3001041">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001045">subVV</span><span class="op" id="3001050">(</span><span class="ident" id="3001051">xd</span><span class="op" id="3001053">,</span>&nbsp;<span class="ident" id="3001055">x0</span><span class="op" id="3001057">,</span>&nbsp;<span class="ident" id="3001059">x1</span><span class="op" id="3001061">)</span>&nbsp;<span class="comment" id="3001063">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001073">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001077">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001136">yd</span>&nbsp;<span class="op" id="3001139">:=</span>&nbsp;<span class="ident" id="3001142">z</span><span class="op" id="3001143">[</span><span class="num" id="3001144">2</span><span class="op" id="3001145">*</span><span class="ident" id="3001146">n</span><span class="op" id="3001147">+</span><span class="ident" id="3001148">n2</span>&nbsp;<span class="op" id="3001151">:</span>&nbsp;<span class="num" id="3001153">3</span><span class="op" id="3001154">*</span><span class="ident" id="3001155">n</span><span class="op" id="3001156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001159">if</span>&nbsp;<span class="ident" id="3001162">subVV</span><span class="op" id="3001167">(</span><span class="ident" id="3001168">yd</span><span class="op" id="3001170">,</span>&nbsp;<span class="ident" id="3001172">y0</span><span class="op" id="3001174">,</span>&nbsp;<span class="ident" id="3001176">y1</span><span class="op" id="3001178">)</span>&nbsp;<span class="op" id="3001180">!=</span>&nbsp;<span class="num" id="3001183">0</span>&nbsp;<span class="op" id="3001185">{</span>&nbsp;<span class="comment" id="3001187">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001198">s</span>&nbsp;<span class="op" id="3001200">=</span>&nbsp;<span class="op" id="3001202">-</span><span class="ident" id="3001203">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001207">subVV</span><span class="op" id="3001212">(</span><span class="ident" id="3001213">yd</span><span class="op" id="3001215">,</span>&nbsp;<span class="ident" id="3001217">y1</span><span class="op" id="3001219">,</span>&nbsp;<span class="ident" id="3001221">y0</span><span class="op" id="3001223">)</span>&nbsp;<span class="comment" id="3001225">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001239">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001306">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001373">p</span>&nbsp;<span class="op" id="3001375">:=</span>&nbsp;<span class="ident" id="3001378">z</span><span class="op" id="3001379">[</span><span class="ident" id="3001380">n</span><span class="op" id="3001381">*</span><span class="num" id="3001382">3</span><span class="op" id="3001383">:</span><span class="op" id="3001384">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001387">karatsuba</span><span class="op" id="3001396">(</span><span class="ident" id="3001397">p</span><span class="op" id="3001398">,</span>&nbsp;<span class="ident" id="3001400">xd</span><span class="op" id="3001402">,</span>&nbsp;<span class="ident" id="3001404">yd</span><span class="op" id="3001406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001410">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001434">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001493">r</span>&nbsp;<span class="op" id="3001495">:=</span>&nbsp;<span class="ident" id="3001498">z</span><span class="op" id="3001499">[</span><span class="ident" id="3001500">n</span><span class="op" id="3001501">*</span><span class="num" id="3001502">4</span><span class="op" id="3001503">:</span><span class="op" id="3001504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3001507">copy</span><span class="op" id="3001511">(</span><span class="ident" id="3001512">r</span><span class="op" id="3001513">,</span>&nbsp;<span class="ident" id="3001515">z</span><span class="op" id="3001516">[</span><span class="op" id="3001517">:</span><span class="ident" id="3001518">n</span><span class="op" id="3001519">*</span><span class="num" id="3001520">2</span><span class="op" id="3001521">]</span><span class="op" id="3001522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001526">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001558">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001562">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001584">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001606">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001625">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001644">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3001663">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001667">karatsubaAdd</span><span class="op" id="3001679">(</span><span class="ident" id="3001680">z</span><span class="op" id="3001681">[</span><span class="ident" id="3001682">n2</span><span class="op" id="3001684">:</span><span class="op" id="3001685">]</span><span class="op" id="3001686">,</span>&nbsp;<span class="ident" id="3001688">r</span><span class="op" id="3001689">,</span>&nbsp;<span class="ident" id="3001691">n</span><span class="op" id="3001692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001695">karatsubaAdd</span><span class="op" id="3001707">(</span><span class="ident" id="3001708">z</span><span class="op" id="3001709">[</span><span class="ident" id="3001710">n2</span><span class="op" id="3001712">:</span><span class="op" id="3001713">]</span><span class="op" id="3001714">,</span>&nbsp;<span class="ident" id="3001716">r</span><span class="op" id="3001717">[</span><span class="ident" id="3001718">n</span><span class="op" id="3001719">:</span><span class="op" id="3001720">]</span><span class="op" id="3001721">,</span>&nbsp;<span class="ident" id="3001723">n</span><span class="op" id="3001724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001727">if</span>&nbsp;<span class="ident" id="3001730">s</span>&nbsp;<span class="op" id="3001732">&gt;</span>&nbsp;<span class="num" id="3001734">0</span>&nbsp;<span class="op" id="3001736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001740">karatsubaAdd</span><span class="op" id="3001752">(</span><span class="ident" id="3001753">z</span><span class="op" id="3001754">[</span><span class="ident" id="3001755">n2</span><span class="op" id="3001757">:</span><span class="op" id="3001758">]</span><span class="op" id="3001759">,</span>&nbsp;<span class="ident" id="3001761">p</span><span class="op" id="3001762">,</span>&nbsp;<span class="ident" id="3001764">n</span><span class="op" id="3001765">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001768">}</span>&nbsp;<span class="keyword" id="3001770">else</span>&nbsp;<span class="op" id="3001775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3001779">karatsubaSub</span><span class="op" id="3001791">(</span><span class="ident" id="3001792">z</span><span class="op" id="3001793">[</span><span class="ident" id="3001794">n2</span><span class="op" id="3001796">:</span><span class="op" id="3001797">]</span><span class="op" id="3001798">,</span>&nbsp;<span class="ident" id="3001800">p</span><span class="op" id="3001801">,</span>&nbsp;<span class="ident" id="3001803">n</span><span class="op" id="3001804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3001807">}</span><br>
<span class="lineno"></span><span class="op" id="3001809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3001812">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3001872">func</span>&nbsp;<span class="ident" id="3001877">alias</span><span class="op" id="3001882">(</span><span class="ident" id="3001883">x</span><span class="op" id="3001884">,</span>&nbsp;<span class="ident" id="3001886">y</span>&nbsp;<span class="ident" id="3001888">nat</span><span class="op" id="3001891">)</span>&nbsp;<span class="builtintype" id="3001893">bool</span>&nbsp;<span class="op" id="3001898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3001901">return</span>&nbsp;<span class="builtinfunc" id="3001908">cap</span><span class="op" id="3001911">(</span><span class="ident" id="3001912">x</span><span class="op" id="3001913">)</span>&nbsp;<span class="op" id="3001915">&gt;</span>&nbsp;<span class="num" id="3001917">0</span>&nbsp;<span class="op" id="3001919">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3001922">cap</span><span class="op" id="3001925">(</span><span class="ident" id="3001926">y</span><span class="op" id="3001927">)</span>&nbsp;<span class="op" id="3001929">&gt;</span>&nbsp;<span class="num" id="3001931">0</span>&nbsp;<span class="op" id="3001933">&amp;&amp;</span>&nbsp;<span class="op" id="3001936">&amp;</span><span class="ident" id="3001937">x</span><span class="op" id="3001938">[</span><span class="num" id="3001939">0</span><span class="op" id="3001940">:</span><span class="builtinfunc" id="3001941">cap</span><span class="op" id="3001944">(</span><span class="ident" id="3001945">x</span><span class="op" id="3001946">)</span><span class="op" id="3001947">]</span><span class="op" id="3001948">[</span><span class="builtinfunc" id="3001949">cap</span><span class="op" id="3001952">(</span><span class="ident" id="3001953">x</span><span class="op" id="3001954">)</span><span class="op" id="3001955">-</span><span class="num" id="3001956">1</span><span class="op" id="3001957">]</span>&nbsp;<span class="op" id="3001959">==</span>&nbsp;<span class="op" id="3001962">&amp;</span><span class="ident" id="3001963">y</span><span class="op" id="3001964">[</span><span class="num" id="3001965">0</span><span class="op" id="3001966">:</span><span class="builtinfunc" id="3001967">cap</span><span class="op" id="3001970">(</span><span class="ident" id="3001971">y</span><span class="op" id="3001972">)</span><span class="op" id="3001973">]</span><span class="op" id="3001974">[</span><span class="builtinfunc" id="3001975">cap</span><span class="op" id="3001978">(</span><span class="ident" id="3001979">y</span><span class="op" id="3001980">)</span><span class="op" id="3001981">-</span><span class="num" id="3001982">1</span><span class="op" id="3001983">]</span><br>
<span class="lineno"></span><span class="op" id="3001985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3001988">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3002047">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3002107">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3002171">func</span>&nbsp;<span class="ident" id="3002176">addAt</span><span class="op" id="3002181">(</span><span class="ident" id="3002182">z</span><span class="op" id="3002183">,</span>&nbsp;<span class="ident" id="3002185">x</span>&nbsp;<span class="ident" id="3002187">nat</span><span class="op" id="3002190">,</span>&nbsp;<span class="ident" id="3002192">i</span>&nbsp;<span class="builtintype" id="3002194">int</span><span class="op" id="3002197">)</span>&nbsp;<span class="op" id="3002199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002202">if</span>&nbsp;<span class="ident" id="3002205">n</span>&nbsp;<span class="op" id="3002207">:=</span>&nbsp;<span class="builtinfunc" id="3002210">len</span><span class="op" id="3002213">(</span><span class="ident" id="3002214">x</span><span class="op" id="3002215">)</span><span class="op" id="3002216">;</span>&nbsp;<span class="ident" id="3002218">n</span>&nbsp;<span class="op" id="3002220">&gt;</span>&nbsp;<span class="num" id="3002222">0</span>&nbsp;<span class="op" id="3002224">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002228">if</span>&nbsp;<span class="ident" id="3002231">c</span>&nbsp;<span class="op" id="3002233">:=</span>&nbsp;<span class="ident" id="3002236">addVV</span><span class="op" id="3002241">(</span><span class="ident" id="3002242">z</span><span class="op" id="3002243">[</span><span class="ident" id="3002244">i</span><span class="op" id="3002245">:</span><span class="ident" id="3002246">i</span><span class="op" id="3002247">+</span><span class="ident" id="3002248">n</span><span class="op" id="3002249">]</span><span class="op" id="3002250">,</span>&nbsp;<span class="ident" id="3002252">z</span><span class="op" id="3002253">[</span><span class="ident" id="3002254">i</span><span class="op" id="3002255">:</span><span class="op" id="3002256">]</span><span class="op" id="3002257">,</span>&nbsp;<span class="ident" id="3002259">x</span><span class="op" id="3002260">)</span><span class="op" id="3002261">;</span>&nbsp;<span class="ident" id="3002263">c</span>&nbsp;<span class="op" id="3002265">!=</span>&nbsp;<span class="num" id="3002268">0</span>&nbsp;<span class="op" id="3002270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002275">j</span>&nbsp;<span class="op" id="3002277">:=</span>&nbsp;<span class="ident" id="3002280">i</span>&nbsp;<span class="op" id="3002282">+</span>&nbsp;<span class="ident" id="3002284">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002289">if</span>&nbsp;<span class="ident" id="3002292">j</span>&nbsp;<span class="op" id="3002294">&lt;</span>&nbsp;<span class="builtinfunc" id="3002296">len</span><span class="op" id="3002299">(</span><span class="ident" id="3002300">z</span><span class="op" id="3002301">)</span>&nbsp;<span class="op" id="3002303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002309">addVW</span><span class="op" id="3002314">(</span><span class="ident" id="3002315">z</span><span class="op" id="3002316">[</span><span class="ident" id="3002317">j</span><span class="op" id="3002318">:</span><span class="op" id="3002319">]</span><span class="op" id="3002320">,</span>&nbsp;<span class="ident" id="3002322">z</span><span class="op" id="3002323">[</span><span class="ident" id="3002324">j</span><span class="op" id="3002325">:</span><span class="op" id="3002326">]</span><span class="op" id="3002327">,</span>&nbsp;<span class="ident" id="3002329">c</span><span class="op" id="3002330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002335">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002342">}</span><br>
<span class="lineno"></span><span class="op" id="3002344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3002347">func</span>&nbsp;<span class="ident" id="3002352">max</span><span class="op" id="3002355">(</span><span class="ident" id="3002356">x</span><span class="op" id="3002357">,</span>&nbsp;<span class="ident" id="3002359">y</span>&nbsp;<span class="builtintype" id="3002361">int</span><span class="op" id="3002364">)</span>&nbsp;<span class="builtintype" id="3002366">int</span>&nbsp;<span class="op" id="3002370">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002373">if</span>&nbsp;<span class="ident" id="3002376">x</span>&nbsp;<span class="op" id="3002378">&gt;</span>&nbsp;<span class="ident" id="3002380">y</span>&nbsp;<span class="op" id="3002382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002386">return</span>&nbsp;<span class="ident" id="3002393">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002399">return</span>&nbsp;<span class="ident" id="3002406">y</span><br>
<span class="lineno"></span><span class="op" id="3002408">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3002411">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3002485">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3002559">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3002634">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3002685">func</span>&nbsp;<span class="ident" id="3002690">karatsubaLen</span><span class="op" id="3002702">(</span><span class="ident" id="3002703">n</span>&nbsp;<span class="builtintype" id="3002705">int</span><span class="op" id="3002708">)</span>&nbsp;<span class="builtintype" id="3002710">int</span>&nbsp;<span class="op" id="3002714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002717">i</span>&nbsp;<span class="op" id="3002719">:=</span>&nbsp;<span class="builtintype" id="3002722">uint</span><span class="op" id="3002726">(</span><span class="num" id="3002727">0</span><span class="op" id="3002728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002731">for</span>&nbsp;<span class="ident" id="3002735">n</span>&nbsp;<span class="op" id="3002737">&gt;</span>&nbsp;<span class="ident" id="3002739">karatsubaThreshold</span>&nbsp;<span class="op" id="3002758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002762">n</span>&nbsp;<span class="op" id="3002764">&gt;&gt;=</span>&nbsp;<span class="num" id="3002768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002772">i</span><span class="op" id="3002773">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002780">return</span>&nbsp;<span class="ident" id="3002787">n</span>&nbsp;<span class="op" id="3002789">&lt;&lt;</span>&nbsp;<span class="ident" id="3002792">i</span><br>
<span class="lineno"></span><span class="op" id="3002794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3002797">func</span>&nbsp;<span class="op" id="3002802">(</span><span class="ident" id="3002803">z</span>&nbsp;<span class="ident" id="3002805">nat</span><span class="op" id="3002808">)</span>&nbsp;<span class="ident" id="3002810">mul</span><span class="op" id="3002813">(</span><span class="ident" id="3002814">x</span><span class="op" id="3002815">,</span>&nbsp;<span class="ident" id="3002817">y</span>&nbsp;<span class="ident" id="3002819">nat</span><span class="op" id="3002822">)</span>&nbsp;<span class="ident" id="3002824">nat</span>&nbsp;<span class="op" id="3002828">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002831">m</span>&nbsp;<span class="op" id="3002833">:=</span>&nbsp;<span class="builtinfunc" id="3002836">len</span><span class="op" id="3002839">(</span><span class="ident" id="3002840">x</span><span class="op" id="3002841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3002844">n</span>&nbsp;<span class="op" id="3002846">:=</span>&nbsp;<span class="builtinfunc" id="3002849">len</span><span class="op" id="3002852">(</span><span class="ident" id="3002853">y</span><span class="op" id="3002854">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002858">switch</span>&nbsp;<span class="op" id="3002865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002868">case</span>&nbsp;<span class="ident" id="3002873">m</span>&nbsp;<span class="op" id="3002875">&lt;</span>&nbsp;<span class="ident" id="3002877">n</span><span class="op" id="3002878">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002882">return</span>&nbsp;<span class="ident" id="3002889">z</span><span class="op" id="3002890">.</span><span class="ident" id="3002891">mul</span><span class="op" id="3002894">(</span><span class="ident" id="3002895">y</span><span class="op" id="3002896">,</span>&nbsp;<span class="ident" id="3002898">x</span><span class="op" id="3002899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002902">case</span>&nbsp;<span class="ident" id="3002907">m</span>&nbsp;<span class="op" id="3002909">==</span>&nbsp;<span class="num" id="3002912">0</span>&nbsp;<span class="op" id="3002914">||</span>&nbsp;<span class="ident" id="3002917">n</span>&nbsp;<span class="op" id="3002919">==</span>&nbsp;<span class="num" id="3002922">0</span><span class="op" id="3002923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002927">return</span>&nbsp;<span class="ident" id="3002934">z</span><span class="op" id="3002935">.</span><span class="builtinfunc" id="3002936">make</span><span class="op" id="3002940">(</span><span class="num" id="3002941">0</span><span class="op" id="3002942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002945">case</span>&nbsp;<span class="ident" id="3002950">n</span>&nbsp;<span class="op" id="3002952">==</span>&nbsp;<span class="num" id="3002955">1</span><span class="op" id="3002956">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3002960">return</span>&nbsp;<span class="ident" id="3002967">z</span><span class="op" id="3002968">.</span><span class="ident" id="3002969">mulAddWW</span><span class="op" id="3002977">(</span><span class="ident" id="3002978">x</span><span class="op" id="3002979">,</span>&nbsp;<span class="ident" id="3002981">y</span><span class="op" id="3002982">[</span><span class="num" id="3002983">0</span><span class="op" id="3002984">]</span><span class="op" id="3002985">,</span>&nbsp;<span class="num" id="3002987">0</span><span class="op" id="3002988">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3002991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3002994">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003010">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003043">if</span>&nbsp;<span class="ident" id="3003046">alias</span><span class="op" id="3003051">(</span><span class="ident" id="3003052">z</span><span class="op" id="3003053">,</span>&nbsp;<span class="ident" id="3003055">x</span><span class="op" id="3003056">)</span>&nbsp;<span class="op" id="3003058">||</span>&nbsp;<span class="ident" id="3003061">alias</span><span class="op" id="3003066">(</span><span class="ident" id="3003067">z</span><span class="op" id="3003068">,</span>&nbsp;<span class="ident" id="3003070">y</span><span class="op" id="3003071">)</span>&nbsp;<span class="op" id="3003073">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003077">z</span>&nbsp;<span class="op" id="3003079">=</span>&nbsp;<span class="builtintype" id="3003081">nil</span>&nbsp;<span class="comment" id="3003085">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003133">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003187">if</span>&nbsp;<span class="ident" id="3003190">n</span>&nbsp;<span class="op" id="3003192">&lt;</span>&nbsp;<span class="ident" id="3003194">karatsubaThreshold</span>&nbsp;<span class="op" id="3003213">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003217">z</span>&nbsp;<span class="op" id="3003219">=</span>&nbsp;<span class="ident" id="3003221">z</span><span class="op" id="3003222">.</span><span class="builtinfunc" id="3003223">make</span><span class="op" id="3003227">(</span><span class="ident" id="3003228">m</span>&nbsp;<span class="op" id="3003230">+</span>&nbsp;<span class="ident" id="3003232">n</span><span class="op" id="3003233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003237">basicMul</span><span class="op" id="3003245">(</span><span class="ident" id="3003246">z</span><span class="op" id="3003247">,</span>&nbsp;<span class="ident" id="3003249">x</span><span class="op" id="3003250">,</span>&nbsp;<span class="ident" id="3003252">y</span><span class="op" id="3003253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3003257">return</span>&nbsp;<span class="ident" id="3003264">z</span><span class="op" id="3003265">.</span><span class="ident" id="3003266">norm</span><span class="op" id="3003270">(</span><span class="op" id="3003271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3003274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003277">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003326">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003369">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003373">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003408">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003443">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003490">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003494">k</span>&nbsp;<span class="op" id="3003496">:=</span>&nbsp;<span class="ident" id="3003499">karatsubaLen</span><span class="op" id="3003511">(</span><span class="ident" id="3003512">n</span><span class="op" id="3003513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003516">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003528">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003565">x0</span>&nbsp;<span class="op" id="3003568">:=</span>&nbsp;<span class="ident" id="3003571">x</span><span class="op" id="3003572">[</span><span class="num" id="3003573">0</span><span class="op" id="3003574">:</span><span class="ident" id="3003575">k</span><span class="op" id="3003576">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003591">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003616">y0</span>&nbsp;<span class="op" id="3003619">:=</span>&nbsp;<span class="ident" id="3003622">y</span><span class="op" id="3003623">[</span><span class="num" id="3003624">0</span><span class="op" id="3003625">:</span><span class="ident" id="3003626">k</span><span class="op" id="3003627">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003642">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003667">z</span>&nbsp;<span class="op" id="3003669">=</span>&nbsp;<span class="ident" id="3003671">z</span><span class="op" id="3003672">.</span><span class="builtinfunc" id="3003673">make</span><span class="op" id="3003677">(</span><span class="ident" id="3003678">max</span><span class="op" id="3003681">(</span><span class="num" id="3003682">6</span><span class="op" id="3003683">*</span><span class="ident" id="3003684">k</span><span class="op" id="3003685">,</span>&nbsp;<span class="ident" id="3003687">m</span><span class="op" id="3003688">+</span><span class="ident" id="3003689">n</span><span class="op" id="3003690">)</span><span class="op" id="3003691">)</span>&nbsp;<span class="comment" id="3003693">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003756">karatsuba</span><span class="op" id="3003765">(</span><span class="ident" id="3003766">z</span><span class="op" id="3003767">,</span>&nbsp;<span class="ident" id="3003769">x0</span><span class="op" id="3003771">,</span>&nbsp;<span class="ident" id="3003773">y0</span><span class="op" id="3003775">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003778">z</span>&nbsp;<span class="op" id="3003780">=</span>&nbsp;<span class="ident" id="3003782">z</span><span class="op" id="3003783">[</span><span class="num" id="3003784">0</span>&nbsp;<span class="op" id="3003786">:</span>&nbsp;<span class="ident" id="3003788">m</span><span class="op" id="3003789">+</span><span class="ident" id="3003790">n</span><span class="op" id="3003791">]</span>&nbsp;&nbsp;<span class="comment" id="3003794">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3003839">z</span><span class="op" id="3003840">[</span><span class="num" id="3003841">2</span><span class="op" id="3003842">*</span><span class="ident" id="3003843">k</span><span class="op" id="3003844">:</span><span class="op" id="3003845">]</span><span class="op" id="3003846">.</span><span class="ident" id="3003847">clear</span><span class="op" id="3003852">(</span><span class="op" id="3003853">)</span>&nbsp;<span class="comment" id="3003855">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003925">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003984">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3003988">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004042">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004096">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004100">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004126">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004130">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004183">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004187">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004255">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004323">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004393">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004397">if</span>&nbsp;<span class="ident" id="3004400">k</span>&nbsp;<span class="op" id="3004402">&lt;</span>&nbsp;<span class="ident" id="3004404">n</span>&nbsp;<span class="op" id="3004406">||</span>&nbsp;<span class="ident" id="3004409">m</span>&nbsp;<span class="op" id="3004411">!=</span>&nbsp;<span class="ident" id="3004414">n</span>&nbsp;<span class="op" id="3004416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004420">var</span>&nbsp;<span class="ident" id="3004424">t</span>&nbsp;<span class="ident" id="3004426">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004433">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004450">x0</span>&nbsp;<span class="op" id="3004453">:=</span>&nbsp;<span class="ident" id="3004456">x0</span><span class="op" id="3004458">.</span><span class="ident" id="3004459">norm</span><span class="op" id="3004463">(</span><span class="op" id="3004464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004468">y1</span>&nbsp;<span class="op" id="3004471">:=</span>&nbsp;<span class="ident" id="3004474">y</span><span class="op" id="3004475">[</span><span class="ident" id="3004476">k</span><span class="op" id="3004477">:</span><span class="op" id="3004478">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004486">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004521">t</span>&nbsp;<span class="op" id="3004523">=</span>&nbsp;<span class="ident" id="3004525">t</span><span class="op" id="3004526">.</span><span class="ident" id="3004527">mul</span><span class="op" id="3004530">(</span><span class="ident" id="3004531">x0</span><span class="op" id="3004533">,</span>&nbsp;<span class="ident" id="3004535">y1</span><span class="op" id="3004537">)</span>&nbsp;<span class="comment" id="3004539">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004591">addAt</span><span class="op" id="3004596">(</span><span class="ident" id="3004597">z</span><span class="op" id="3004598">,</span>&nbsp;<span class="ident" id="3004600">t</span><span class="op" id="3004601">,</span>&nbsp;<span class="ident" id="3004603">k</span><span class="op" id="3004604">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3004609">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004643">y0</span>&nbsp;<span class="op" id="3004646">:=</span>&nbsp;<span class="ident" id="3004649">y0</span><span class="op" id="3004651">.</span><span class="ident" id="3004652">norm</span><span class="op" id="3004656">(</span><span class="op" id="3004657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004661">for</span>&nbsp;<span class="ident" id="3004665">i</span>&nbsp;<span class="op" id="3004667">:=</span>&nbsp;<span class="ident" id="3004670">k</span><span class="op" id="3004671">;</span>&nbsp;<span class="ident" id="3004673">i</span>&nbsp;<span class="op" id="3004675">&lt;</span>&nbsp;<span class="builtinfunc" id="3004677">len</span><span class="op" id="3004680">(</span><span class="ident" id="3004681">x</span><span class="op" id="3004682">)</span><span class="op" id="3004683">;</span>&nbsp;<span class="ident" id="3004685">i</span>&nbsp;<span class="op" id="3004687">+=</span>&nbsp;<span class="ident" id="3004690">k</span>&nbsp;<span class="op" id="3004692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004697">xi</span>&nbsp;<span class="op" id="3004700">:=</span>&nbsp;<span class="ident" id="3004703">x</span><span class="op" id="3004704">[</span><span class="ident" id="3004705">i</span><span class="op" id="3004706">:</span><span class="op" id="3004707">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004712">if</span>&nbsp;<span class="builtinfunc" id="3004715">len</span><span class="op" id="3004718">(</span><span class="ident" id="3004719">xi</span><span class="op" id="3004721">)</span>&nbsp;<span class="op" id="3004723">&gt;</span>&nbsp;<span class="ident" id="3004725">k</span>&nbsp;<span class="op" id="3004727">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004733">xi</span>&nbsp;<span class="op" id="3004736">=</span>&nbsp;<span class="ident" id="3004738">xi</span><span class="op" id="3004740">[</span><span class="op" id="3004741">:</span><span class="ident" id="3004742">k</span><span class="op" id="3004743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004753">xi</span>&nbsp;<span class="op" id="3004756">=</span>&nbsp;<span class="ident" id="3004758">xi</span><span class="op" id="3004760">.</span><span class="ident" id="3004761">norm</span><span class="op" id="3004765">(</span><span class="op" id="3004766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004771">t</span>&nbsp;<span class="op" id="3004773">=</span>&nbsp;<span class="ident" id="3004775">t</span><span class="op" id="3004776">.</span><span class="ident" id="3004777">mul</span><span class="op" id="3004780">(</span><span class="ident" id="3004781">xi</span><span class="op" id="3004783">,</span>&nbsp;<span class="ident" id="3004785">y0</span><span class="op" id="3004787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004792">addAt</span><span class="op" id="3004797">(</span><span class="ident" id="3004798">z</span><span class="op" id="3004799">,</span>&nbsp;<span class="ident" id="3004801">t</span><span class="op" id="3004802">,</span>&nbsp;<span class="ident" id="3004804">i</span><span class="op" id="3004805">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004810">t</span>&nbsp;<span class="op" id="3004812">=</span>&nbsp;<span class="ident" id="3004814">t</span><span class="op" id="3004815">.</span><span class="ident" id="3004816">mul</span><span class="op" id="3004819">(</span><span class="ident" id="3004820">xi</span><span class="op" id="3004822">,</span>&nbsp;<span class="ident" id="3004824">y1</span><span class="op" id="3004826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3004831">addAt</span><span class="op" id="3004836">(</span><span class="ident" id="3004837">z</span><span class="op" id="3004838">,</span>&nbsp;<span class="ident" id="3004840">t</span><span class="op" id="3004841">,</span>&nbsp;<span class="ident" id="3004843">i</span><span class="op" id="3004844">+</span><span class="ident" id="3004845">k</span><span class="op" id="3004846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3004853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3004857">return</span>&nbsp;<span class="ident" id="3004864">z</span><span class="op" id="3004865">.</span><span class="ident" id="3004866">norm</span><span class="op" id="3004870">(</span><span class="op" id="3004871">)</span><br>
<span class="lineno"></span><span class="op" id="3004873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3004876">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3004945">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3005015">func</span>&nbsp;<span class="op" id="3005020">(</span><span class="ident" id="3005021">z</span>&nbsp;<span class="ident" id="3005023">nat</span><span class="op" id="3005026">)</span>&nbsp;<span class="ident" id="3005028">mulRange</span><span class="op" id="3005036">(</span><span class="ident" id="3005037">a</span><span class="op" id="3005038">,</span>&nbsp;<span class="ident" id="3005040">b</span>&nbsp;<span class="ident" id="3005042">uint64</span><span class="op" id="3005048">)</span>&nbsp;<span class="ident" id="3005050">nat</span>&nbsp;<span class="op" id="3005054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005057">switch</span>&nbsp;<span class="op" id="3005064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005067">case</span>&nbsp;<span class="ident" id="3005072">a</span>&nbsp;<span class="op" id="3005074">==</span>&nbsp;<span class="num" id="3005077">0</span><span class="op" id="3005078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005082">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005124">return</span>&nbsp;<span class="ident" id="3005131">z</span><span class="op" id="3005132">.</span><span class="ident" id="3005133">setUint64</span><span class="op" id="3005142">(</span><span class="num" id="3005143">0</span><span class="op" id="3005144">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005147">case</span>&nbsp;<span class="ident" id="3005152">a</span>&nbsp;<span class="op" id="3005154">&gt;</span>&nbsp;<span class="ident" id="3005156">b</span><span class="op" id="3005157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005161">return</span>&nbsp;<span class="ident" id="3005168">z</span><span class="op" id="3005169">.</span><span class="ident" id="3005170">setUint64</span><span class="op" id="3005179">(</span><span class="num" id="3005180">1</span><span class="op" id="3005181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005184">case</span>&nbsp;<span class="ident" id="3005189">a</span>&nbsp;<span class="op" id="3005191">==</span>&nbsp;<span class="ident" id="3005194">b</span><span class="op" id="3005195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005199">return</span>&nbsp;<span class="ident" id="3005206">z</span><span class="op" id="3005207">.</span><span class="ident" id="3005208">setUint64</span><span class="op" id="3005217">(</span><span class="ident" id="3005218">a</span><span class="op" id="3005219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005222">case</span>&nbsp;<span class="ident" id="3005227">a</span><span class="op" id="3005228">+</span><span class="num" id="3005229">1</span>&nbsp;<span class="op" id="3005231">==</span>&nbsp;<span class="ident" id="3005234">b</span><span class="op" id="3005235">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005239">return</span>&nbsp;<span class="ident" id="3005246">z</span><span class="op" id="3005247">.</span><span class="ident" id="3005248">mul</span><span class="op" id="3005251">(</span><span class="ident" id="3005252">nat</span><span class="op" id="3005255">(</span><span class="builtintype" id="3005256">nil</span><span class="op" id="3005259">)</span><span class="op" id="3005260">.</span><span class="ident" id="3005261">setUint64</span><span class="op" id="3005270">(</span><span class="ident" id="3005271">a</span><span class="op" id="3005272">)</span><span class="op" id="3005273">,</span>&nbsp;<span class="ident" id="3005275">nat</span><span class="op" id="3005278">(</span><span class="builtintype" id="3005279">nil</span><span class="op" id="3005282">)</span><span class="op" id="3005283">.</span><span class="ident" id="3005284">setUint64</span><span class="op" id="3005293">(</span><span class="ident" id="3005294">b</span><span class="op" id="3005295">)</span><span class="op" id="3005296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005302">m</span>&nbsp;<span class="op" id="3005304">:=</span>&nbsp;<span class="op" id="3005307">(</span><span class="ident" id="3005308">a</span>&nbsp;<span class="op" id="3005310">+</span>&nbsp;<span class="ident" id="3005312">b</span><span class="op" id="3005313">)</span>&nbsp;<span class="op" id="3005315">/</span>&nbsp;<span class="num" id="3005317">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005320">return</span>&nbsp;<span class="ident" id="3005327">z</span><span class="op" id="3005328">.</span><span class="ident" id="3005329">mul</span><span class="op" id="3005332">(</span><span class="ident" id="3005333">nat</span><span class="op" id="3005336">(</span><span class="builtintype" id="3005337">nil</span><span class="op" id="3005340">)</span><span class="op" id="3005341">.</span><span class="ident" id="3005342">mulRange</span><span class="op" id="3005350">(</span><span class="ident" id="3005351">a</span><span class="op" id="3005352">,</span>&nbsp;<span class="ident" id="3005354">m</span><span class="op" id="3005355">)</span><span class="op" id="3005356">,</span>&nbsp;<span class="ident" id="3005358">nat</span><span class="op" id="3005361">(</span><span class="builtintype" id="3005362">nil</span><span class="op" id="3005365">)</span><span class="op" id="3005366">.</span><span class="ident" id="3005367">mulRange</span><span class="op" id="3005375">(</span><span class="ident" id="3005376">m</span><span class="op" id="3005377">+</span><span class="num" id="3005378">1</span><span class="op" id="3005379">,</span>&nbsp;<span class="ident" id="3005381">b</span><span class="op" id="3005382">)</span><span class="op" id="3005383">)</span><br>
<span class="lineno"></span><span class="op" id="3005385">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3005388">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3005420">func</span>&nbsp;<span class="op" id="3005425">(</span><span class="ident" id="3005426">z</span>&nbsp;<span class="ident" id="3005428">nat</span><span class="op" id="3005431">)</span>&nbsp;<span class="ident" id="3005433">divW</span><span class="op" id="3005437">(</span><span class="ident" id="3005438">x</span>&nbsp;<span class="ident" id="3005440">nat</span><span class="op" id="3005443">,</span>&nbsp;<span class="ident" id="3005445">y</span>&nbsp;<span class="ident" id="3005447">Word</span><span class="op" id="3005451">)</span>&nbsp;<span class="op" id="3005453">(</span><span class="ident" id="3005454">q</span>&nbsp;<span class="ident" id="3005456">nat</span><span class="op" id="3005459">,</span>&nbsp;<span class="ident" id="3005461">r</span>&nbsp;<span class="ident" id="3005463">Word</span><span class="op" id="3005467">)</span>&nbsp;<span class="op" id="3005469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005472">m</span>&nbsp;<span class="op" id="3005474">:=</span>&nbsp;<span class="builtinfunc" id="3005477">len</span><span class="op" id="3005480">(</span><span class="ident" id="3005481">x</span><span class="op" id="3005482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005485">switch</span>&nbsp;<span class="op" id="3005492">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005495">case</span>&nbsp;<span class="ident" id="3005500">y</span>&nbsp;<span class="op" id="3005502">==</span>&nbsp;<span class="num" id="3005505">0</span><span class="op" id="3005506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3005510">panic</span><span class="op" id="3005515">(</span><span class="string" id="3005516">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3005534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005537">case</span>&nbsp;<span class="ident" id="3005542">y</span>&nbsp;<span class="op" id="3005544">==</span>&nbsp;<span class="num" id="3005547">1</span><span class="op" id="3005548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005552">q</span>&nbsp;<span class="op" id="3005554">=</span>&nbsp;<span class="ident" id="3005556">z</span><span class="op" id="3005557">.</span><span class="ident" id="3005558">set</span><span class="op" id="3005561">(</span><span class="ident" id="3005562">x</span><span class="op" id="3005563">)</span>&nbsp;<span class="comment" id="3005565">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005582">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005590">case</span>&nbsp;<span class="ident" id="3005595">m</span>&nbsp;<span class="op" id="3005597">==</span>&nbsp;<span class="num" id="3005600">0</span><span class="op" id="3005601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005605">q</span>&nbsp;<span class="op" id="3005607">=</span>&nbsp;<span class="ident" id="3005609">z</span><span class="op" id="3005610">.</span><span class="builtinfunc" id="3005611">make</span><span class="op" id="3005615">(</span><span class="num" id="3005616">0</span><span class="op" id="3005617">)</span>&nbsp;<span class="comment" id="3005619">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005636">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005647">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005657">z</span>&nbsp;<span class="op" id="3005659">=</span>&nbsp;<span class="ident" id="3005661">z</span><span class="op" id="3005662">.</span><span class="builtinfunc" id="3005663">make</span><span class="op" id="3005667">(</span><span class="ident" id="3005668">m</span><span class="op" id="3005669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005672">r</span>&nbsp;<span class="op" id="3005674">=</span>&nbsp;<span class="ident" id="3005676">divWVW</span><span class="op" id="3005682">(</span><span class="ident" id="3005683">z</span><span class="op" id="3005684">,</span>&nbsp;<span class="num" id="3005686">0</span><span class="op" id="3005687">,</span>&nbsp;<span class="ident" id="3005689">x</span><span class="op" id="3005690">,</span>&nbsp;<span class="ident" id="3005692">y</span><span class="op" id="3005693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005696">q</span>&nbsp;<span class="op" id="3005698">=</span>&nbsp;<span class="ident" id="3005700">z</span><span class="op" id="3005701">.</span><span class="ident" id="3005702">norm</span><span class="op" id="3005706">(</span><span class="op" id="3005707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005710">return</span><br>
<span class="lineno"></span><span class="op" id="3005717">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3005720">func</span>&nbsp;<span class="op" id="3005725">(</span><span class="ident" id="3005726">z</span>&nbsp;<span class="ident" id="3005728">nat</span><span class="op" id="3005731">)</span>&nbsp;<span class="ident" id="3005733">div</span><span class="op" id="3005736">(</span><span class="ident" id="3005737">z2</span><span class="op" id="3005739">,</span>&nbsp;<span class="ident" id="3005741">u</span><span class="op" id="3005742">,</span>&nbsp;<span class="ident" id="3005744">v</span>&nbsp;<span class="ident" id="3005746">nat</span><span class="op" id="3005749">)</span>&nbsp;<span class="op" id="3005751">(</span><span class="ident" id="3005752">q</span><span class="op" id="3005753">,</span>&nbsp;<span class="ident" id="3005755">r</span>&nbsp;<span class="ident" id="3005757">nat</span><span class="op" id="3005760">)</span>&nbsp;<span class="op" id="3005762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005765">if</span>&nbsp;<span class="builtinfunc" id="3005768">len</span><span class="op" id="3005771">(</span><span class="ident" id="3005772">v</span><span class="op" id="3005773">)</span>&nbsp;<span class="op" id="3005775">==</span>&nbsp;<span class="num" id="3005778">0</span>&nbsp;<span class="op" id="3005780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3005784">panic</span><span class="op" id="3005789">(</span><span class="string" id="3005790">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3005808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005811">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005815">if</span>&nbsp;<span class="ident" id="3005818">u</span><span class="op" id="3005819">.</span><span class="ident" id="3005820">cmp</span><span class="op" id="3005823">(</span><span class="ident" id="3005824">v</span><span class="op" id="3005825">)</span>&nbsp;<span class="op" id="3005827">&lt;</span>&nbsp;<span class="num" id="3005829">0</span>&nbsp;<span class="op" id="3005831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005835">q</span>&nbsp;<span class="op" id="3005837">=</span>&nbsp;<span class="ident" id="3005839">z</span><span class="op" id="3005840">.</span><span class="builtinfunc" id="3005841">make</span><span class="op" id="3005845">(</span><span class="num" id="3005846">0</span><span class="op" id="3005847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005851">r</span>&nbsp;<span class="op" id="3005853">=</span>&nbsp;<span class="ident" id="3005855">z2</span><span class="op" id="3005857">.</span><span class="ident" id="3005858">set</span><span class="op" id="3005861">(</span><span class="ident" id="3005862">u</span><span class="op" id="3005863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005867">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005879">if</span>&nbsp;<span class="builtinfunc" id="3005882">len</span><span class="op" id="3005885">(</span><span class="ident" id="3005886">v</span><span class="op" id="3005887">)</span>&nbsp;<span class="op" id="3005889">==</span>&nbsp;<span class="num" id="3005892">1</span>&nbsp;<span class="op" id="3005894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005898">var</span>&nbsp;<span class="ident" id="3005902">r2</span>&nbsp;<span class="ident" id="3005905">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005912">q</span><span class="op" id="3005913">,</span>&nbsp;<span class="ident" id="3005915">r2</span>&nbsp;<span class="op" id="3005918">=</span>&nbsp;<span class="ident" id="3005920">z</span><span class="op" id="3005921">.</span><span class="ident" id="3005922">divW</span><span class="op" id="3005926">(</span><span class="ident" id="3005927">u</span><span class="op" id="3005928">,</span>&nbsp;<span class="ident" id="3005930">v</span><span class="op" id="3005931">[</span><span class="num" id="3005932">0</span><span class="op" id="3005933">]</span><span class="op" id="3005934">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005938">r</span>&nbsp;<span class="op" id="3005940">=</span>&nbsp;<span class="ident" id="3005942">z2</span><span class="op" id="3005944">.</span><span class="ident" id="3005945">setWord</span><span class="op" id="3005952">(</span><span class="ident" id="3005953">r2</span><span class="op" id="3005955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3005959">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3005967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005971">q</span><span class="op" id="3005972">,</span>&nbsp;<span class="ident" id="3005974">r</span>&nbsp;<span class="op" id="3005976">=</span>&nbsp;<span class="ident" id="3005978">z</span><span class="op" id="3005979">.</span><span class="ident" id="3005980">divLarge</span><span class="op" id="3005988">(</span><span class="ident" id="3005989">z2</span><span class="op" id="3005991">,</span>&nbsp;<span class="ident" id="3005993">u</span><span class="op" id="3005994">,</span>&nbsp;<span class="ident" id="3005996">v</span><span class="op" id="3005997">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3006000">return</span><br>
<span class="lineno"></span><span class="op" id="3006007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3006010">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3006044">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3006108">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3006160">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3006178">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3006196">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3006221">func</span>&nbsp;<span class="op" id="3006226">(</span><span class="ident" id="3006227">z</span>&nbsp;<span class="ident" id="3006229">nat</span><span class="op" id="3006232">)</span>&nbsp;<span class="ident" id="3006234">divLarge</span><span class="op" id="3006242">(</span><span class="ident" id="3006243">u</span><span class="op" id="3006244">,</span>&nbsp;<span class="ident" id="3006246">uIn</span><span class="op" id="3006249">,</span>&nbsp;<span class="ident" id="3006251">v</span>&nbsp;<span class="ident" id="3006253">nat</span><span class="op" id="3006256">)</span>&nbsp;<span class="op" id="3006258">(</span><span class="ident" id="3006259">q</span><span class="op" id="3006260">,</span>&nbsp;<span class="ident" id="3006262">r</span>&nbsp;<span class="ident" id="3006264">nat</span><span class="op" id="3006267">)</span>&nbsp;<span class="op" id="3006269">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006272">n</span>&nbsp;<span class="op" id="3006274">:=</span>&nbsp;<span class="builtinfunc" id="3006277">len</span><span class="op" id="3006280">(</span><span class="ident" id="3006281">v</span><span class="op" id="3006282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006285">m</span>&nbsp;<span class="op" id="3006287">:=</span>&nbsp;<span class="builtinfunc" id="3006290">len</span><span class="op" id="3006293">(</span><span class="ident" id="3006294">uIn</span><span class="op" id="3006297">)</span>&nbsp;<span class="op" id="3006299">-</span>&nbsp;<span class="ident" id="3006301">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006305">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006338">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006402">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3006468">if</span>&nbsp;<span class="ident" id="3006471">alias</span><span class="op" id="3006476">(</span><span class="ident" id="3006477">z</span><span class="op" id="3006478">,</span>&nbsp;<span class="ident" id="3006480">uIn</span><span class="op" id="3006483">)</span>&nbsp;<span class="op" id="3006485">||</span>&nbsp;<span class="ident" id="3006488">alias</span><span class="op" id="3006493">(</span><span class="ident" id="3006494">z</span><span class="op" id="3006495">,</span>&nbsp;<span class="ident" id="3006497">v</span><span class="op" id="3006498">)</span>&nbsp;<span class="op" id="3006500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006504">z</span>&nbsp;<span class="op" id="3006506">=</span>&nbsp;<span class="builtintype" id="3006508">nil</span>&nbsp;<span class="comment" id="3006512">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3006558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006561">q</span>&nbsp;<span class="op" id="3006563">=</span>&nbsp;<span class="ident" id="3006565">z</span><span class="op" id="3006566">.</span><span class="builtinfunc" id="3006567">make</span><span class="op" id="3006571">(</span><span class="ident" id="3006572">m</span>&nbsp;<span class="op" id="3006574">+</span>&nbsp;<span class="num" id="3006576">1</span><span class="op" id="3006577">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006581">qhatv</span>&nbsp;<span class="op" id="3006587">:=</span>&nbsp;<span class="builtinfunc" id="3006590">make</span><span class="op" id="3006594">(</span><span class="ident" id="3006595">nat</span><span class="op" id="3006598">,</span>&nbsp;<span class="ident" id="3006600">n</span><span class="op" id="3006601">+</span><span class="num" id="3006602">1</span><span class="op" id="3006603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3006606">if</span>&nbsp;<span class="ident" id="3006609">alias</span><span class="op" id="3006614">(</span><span class="ident" id="3006615">u</span><span class="op" id="3006616">,</span>&nbsp;<span class="ident" id="3006618">uIn</span><span class="op" id="3006621">)</span>&nbsp;<span class="op" id="3006623">||</span>&nbsp;<span class="ident" id="3006626">alias</span><span class="op" id="3006631">(</span><span class="ident" id="3006632">u</span><span class="op" id="3006633">,</span>&nbsp;<span class="ident" id="3006635">v</span><span class="op" id="3006636">)</span>&nbsp;<span class="op" id="3006638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006642">u</span>&nbsp;<span class="op" id="3006644">=</span>&nbsp;<span class="builtintype" id="3006646">nil</span>&nbsp;<span class="comment" id="3006650">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3006696">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006699">u</span>&nbsp;<span class="op" id="3006701">=</span>&nbsp;<span class="ident" id="3006703">u</span><span class="op" id="3006704">.</span><span class="builtinfunc" id="3006705">make</span><span class="op" id="3006709">(</span><span class="builtinfunc" id="3006710">len</span><span class="op" id="3006713">(</span><span class="ident" id="3006714">uIn</span><span class="op" id="3006717">)</span>&nbsp;<span class="op" id="3006719">+</span>&nbsp;<span class="num" id="3006721">1</span><span class="op" id="3006722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006725">u</span><span class="op" id="3006726">.</span><span class="ident" id="3006727">clear</span><span class="op" id="3006732">(</span><span class="op" id="3006733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006737">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006745">shift</span>&nbsp;<span class="op" id="3006751">:=</span>&nbsp;<span class="ident" id="3006754">leadingZeros</span><span class="op" id="3006766">(</span><span class="ident" id="3006767">v</span><span class="op" id="3006768">[</span><span class="ident" id="3006769">n</span><span class="op" id="3006770">-</span><span class="num" id="3006771">1</span><span class="op" id="3006772">]</span><span class="op" id="3006773">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3006776">if</span>&nbsp;<span class="ident" id="3006779">shift</span>&nbsp;<span class="op" id="3006785">&gt;</span>&nbsp;<span class="num" id="3006787">0</span>&nbsp;<span class="op" id="3006789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006793">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006866">v1</span>&nbsp;<span class="op" id="3006869">:=</span>&nbsp;<span class="builtinfunc" id="3006872">make</span><span class="op" id="3006876">(</span><span class="ident" id="3006877">nat</span><span class="op" id="3006880">,</span>&nbsp;<span class="ident" id="3006882">n</span><span class="op" id="3006883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006887">shlVU</span><span class="op" id="3006892">(</span><span class="ident" id="3006893">v1</span><span class="op" id="3006895">,</span>&nbsp;<span class="ident" id="3006897">v</span><span class="op" id="3006898">,</span>&nbsp;<span class="ident" id="3006900">shift</span><span class="op" id="3006905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006909">v</span>&nbsp;<span class="op" id="3006911">=</span>&nbsp;<span class="ident" id="3006913">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3006917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006920">u</span><span class="op" id="3006921">[</span><span class="builtinfunc" id="3006922">len</span><span class="op" id="3006925">(</span><span class="ident" id="3006926">uIn</span><span class="op" id="3006929">)</span><span class="op" id="3006930">]</span>&nbsp;<span class="op" id="3006932">=</span>&nbsp;<span class="ident" id="3006934">shlVU</span><span class="op" id="3006939">(</span><span class="ident" id="3006940">u</span><span class="op" id="3006941">[</span><span class="num" id="3006942">0</span><span class="op" id="3006943">:</span><span class="builtinfunc" id="3006944">len</span><span class="op" id="3006947">(</span><span class="ident" id="3006948">uIn</span><span class="op" id="3006951">)</span><span class="op" id="3006952">]</span><span class="op" id="3006953">,</span>&nbsp;<span class="ident" id="3006955">uIn</span><span class="op" id="3006958">,</span>&nbsp;<span class="ident" id="3006960">shift</span><span class="op" id="3006965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006969">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3006977">for</span>&nbsp;<span class="ident" id="3006981">j</span>&nbsp;<span class="op" id="3006983">:=</span>&nbsp;<span class="ident" id="3006986">m</span><span class="op" id="3006987">;</span>&nbsp;<span class="ident" id="3006989">j</span>&nbsp;<span class="op" id="3006991">&gt;=</span>&nbsp;<span class="num" id="3006994">0</span><span class="op" id="3006995">;</span>&nbsp;<span class="ident" id="3006997">j</span><span class="op" id="3006998">--</span>&nbsp;<span class="op" id="3007001">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007005">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007014">qhat</span>&nbsp;<span class="op" id="3007019">:=</span>&nbsp;<span class="ident" id="3007022">Word</span><span class="op" id="3007026">(</span><span class="ident" id="3007027">_M</span><span class="op" id="3007029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007033">if</span>&nbsp;<span class="ident" id="3007036">u</span><span class="op" id="3007037">[</span><span class="ident" id="3007038">j</span><span class="op" id="3007039">+</span><span class="ident" id="3007040">n</span><span class="op" id="3007041">]</span>&nbsp;<span class="op" id="3007043">!=</span>&nbsp;<span class="ident" id="3007046">v</span><span class="op" id="3007047">[</span><span class="ident" id="3007048">n</span><span class="op" id="3007049">-</span><span class="num" id="3007050">1</span><span class="op" id="3007051">]</span>&nbsp;<span class="op" id="3007053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007058">var</span>&nbsp;<span class="ident" id="3007062">rhat</span>&nbsp;<span class="ident" id="3007067">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007075">qhat</span><span class="op" id="3007079">,</span>&nbsp;<span class="ident" id="3007081">rhat</span>&nbsp;<span class="op" id="3007086">=</span>&nbsp;<span class="ident" id="3007088">divWW</span><span class="op" id="3007093">(</span><span class="ident" id="3007094">u</span><span class="op" id="3007095">[</span><span class="ident" id="3007096">j</span><span class="op" id="3007097">+</span><span class="ident" id="3007098">n</span><span class="op" id="3007099">]</span><span class="op" id="3007100">,</span>&nbsp;<span class="ident" id="3007102">u</span><span class="op" id="3007103">[</span><span class="ident" id="3007104">j</span><span class="op" id="3007105">+</span><span class="ident" id="3007106">n</span><span class="op" id="3007107">-</span><span class="num" id="3007108">1</span><span class="op" id="3007109">]</span><span class="op" id="3007110">,</span>&nbsp;<span class="ident" id="3007112">v</span><span class="op" id="3007113">[</span><span class="ident" id="3007114">n</span><span class="op" id="3007115">-</span><span class="num" id="3007116">1</span><span class="op" id="3007117">]</span><span class="op" id="3007118">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007124">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;qv_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007151">x1</span><span class="op" id="3007153">,</span>&nbsp;<span class="ident" id="3007155">x2</span>&nbsp;<span class="op" id="3007158">:=</span>&nbsp;<span class="ident" id="3007161">mulWW</span><span class="op" id="3007166">(</span><span class="ident" id="3007167">qhat</span><span class="op" id="3007171">,</span>&nbsp;<span class="ident" id="3007173">v</span><span class="op" id="3007174">[</span><span class="ident" id="3007175">n</span><span class="op" id="3007176">-</span><span class="num" id="3007177">2</span><span class="op" id="3007178">]</span><span class="op" id="3007179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007184">//&nbsp;test&nbsp;if&nbsp;qv_{n-2}&nbsp;&gt;&nbsp;br&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007228">for</span>&nbsp;<span class="ident" id="3007232">greaterThan</span><span class="op" id="3007243">(</span><span class="ident" id="3007244">x1</span><span class="op" id="3007246">,</span>&nbsp;<span class="ident" id="3007248">x2</span><span class="op" id="3007250">,</span>&nbsp;<span class="ident" id="3007252">rhat</span><span class="op" id="3007256">,</span>&nbsp;<span class="ident" id="3007258">u</span><span class="op" id="3007259">[</span><span class="ident" id="3007260">j</span><span class="op" id="3007261">+</span><span class="ident" id="3007262">n</span><span class="op" id="3007263">-</span><span class="num" id="3007264">2</span><span class="op" id="3007265">]</span><span class="op" id="3007266">)</span>&nbsp;<span class="op" id="3007268">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007274">qhat</span><span class="op" id="3007278">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007285">prevRhat</span>&nbsp;<span class="op" id="3007294">:=</span>&nbsp;<span class="ident" id="3007297">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007306">rhat</span>&nbsp;<span class="op" id="3007311">+=</span>&nbsp;<span class="ident" id="3007314">v</span><span class="op" id="3007315">[</span><span class="ident" id="3007316">n</span><span class="op" id="3007317">-</span><span class="num" id="3007318">1</span><span class="op" id="3007319">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007325">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007373">if</span>&nbsp;<span class="ident" id="3007376">rhat</span>&nbsp;<span class="op" id="3007381">&lt;</span>&nbsp;<span class="ident" id="3007383">prevRhat</span>&nbsp;<span class="op" id="3007392">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007399">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007415">x1</span><span class="op" id="3007417">,</span>&nbsp;<span class="ident" id="3007419">x2</span>&nbsp;<span class="op" id="3007422">=</span>&nbsp;<span class="ident" id="3007424">mulWW</span><span class="op" id="3007429">(</span><span class="ident" id="3007430">qhat</span><span class="op" id="3007434">,</span>&nbsp;<span class="ident" id="3007436">v</span><span class="op" id="3007437">[</span><span class="ident" id="3007438">n</span><span class="op" id="3007439">-</span><span class="num" id="3007440">2</span><span class="op" id="3007441">]</span><span class="op" id="3007442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007451">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007456">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007465">qhatv</span><span class="op" id="3007470">[</span><span class="ident" id="3007471">n</span><span class="op" id="3007472">]</span>&nbsp;<span class="op" id="3007474">=</span>&nbsp;<span class="ident" id="3007476">mulAddVWW</span><span class="op" id="3007485">(</span><span class="ident" id="3007486">qhatv</span><span class="op" id="3007491">[</span><span class="num" id="3007492">0</span><span class="op" id="3007493">:</span><span class="ident" id="3007494">n</span><span class="op" id="3007495">]</span><span class="op" id="3007496">,</span>&nbsp;<span class="ident" id="3007498">v</span><span class="op" id="3007499">,</span>&nbsp;<span class="ident" id="3007501">qhat</span><span class="op" id="3007505">,</span>&nbsp;<span class="num" id="3007507">0</span><span class="op" id="3007508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007513">c</span>&nbsp;<span class="op" id="3007515">:=</span>&nbsp;<span class="ident" id="3007518">subVV</span><span class="op" id="3007523">(</span><span class="ident" id="3007524">u</span><span class="op" id="3007525">[</span><span class="ident" id="3007526">j</span><span class="op" id="3007527">:</span><span class="ident" id="3007528">j</span><span class="op" id="3007529">+</span><span class="builtinfunc" id="3007530">len</span><span class="op" id="3007533">(</span><span class="ident" id="3007534">qhatv</span><span class="op" id="3007539">)</span><span class="op" id="3007540">]</span><span class="op" id="3007541">,</span>&nbsp;<span class="ident" id="3007543">u</span><span class="op" id="3007544">[</span><span class="ident" id="3007545">j</span><span class="op" id="3007546">:</span><span class="op" id="3007547">]</span><span class="op" id="3007548">,</span>&nbsp;<span class="ident" id="3007550">qhatv</span><span class="op" id="3007555">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007559">if</span>&nbsp;<span class="ident" id="3007562">c</span>&nbsp;<span class="op" id="3007564">!=</span>&nbsp;<span class="num" id="3007567">0</span>&nbsp;<span class="op" id="3007569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007574">c</span>&nbsp;<span class="op" id="3007576">:=</span>&nbsp;<span class="ident" id="3007579">addVV</span><span class="op" id="3007584">(</span><span class="ident" id="3007585">u</span><span class="op" id="3007586">[</span><span class="ident" id="3007587">j</span><span class="op" id="3007588">:</span><span class="ident" id="3007589">j</span><span class="op" id="3007590">+</span><span class="ident" id="3007591">n</span><span class="op" id="3007592">]</span><span class="op" id="3007593">,</span>&nbsp;<span class="ident" id="3007595">u</span><span class="op" id="3007596">[</span><span class="ident" id="3007597">j</span><span class="op" id="3007598">:</span><span class="op" id="3007599">]</span><span class="op" id="3007600">,</span>&nbsp;<span class="ident" id="3007602">v</span><span class="op" id="3007603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007608">u</span><span class="op" id="3007609">[</span><span class="ident" id="3007610">j</span><span class="op" id="3007611">+</span><span class="ident" id="3007612">n</span><span class="op" id="3007613">]</span>&nbsp;<span class="op" id="3007615">+=</span>&nbsp;<span class="ident" id="3007618">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007623">qhat</span><span class="op" id="3007627">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007632">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007637">q</span><span class="op" id="3007638">[</span><span class="ident" id="3007639">j</span><span class="op" id="3007640">]</span>&nbsp;<span class="op" id="3007642">=</span>&nbsp;<span class="ident" id="3007644">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007654">q</span>&nbsp;<span class="op" id="3007656">=</span>&nbsp;<span class="ident" id="3007658">q</span><span class="op" id="3007659">.</span><span class="ident" id="3007660">norm</span><span class="op" id="3007664">(</span><span class="op" id="3007665">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007668">shrVU</span><span class="op" id="3007673">(</span><span class="ident" id="3007674">u</span><span class="op" id="3007675">,</span>&nbsp;<span class="ident" id="3007677">u</span><span class="op" id="3007678">,</span>&nbsp;<span class="ident" id="3007680">shift</span><span class="op" id="3007685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007688">r</span>&nbsp;<span class="op" id="3007690">=</span>&nbsp;<span class="ident" id="3007692">u</span><span class="op" id="3007693">.</span><span class="ident" id="3007694">norm</span><span class="op" id="3007698">(</span><span class="op" id="3007699">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007703">return</span>&nbsp;<span class="ident" id="3007710">q</span><span class="op" id="3007711">,</span>&nbsp;<span class="ident" id="3007713">r</span><br>
<span class="lineno"></span><span class="op" id="3007715">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3007718">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3007764">func</span>&nbsp;<span class="op" id="3007769">(</span><span class="ident" id="3007770">x</span>&nbsp;<span class="ident" id="3007772">nat</span><span class="op" id="3007775">)</span>&nbsp;<span class="ident" id="3007777">bitLen</span><span class="op" id="3007783">(</span><span class="op" id="3007784">)</span>&nbsp;<span class="builtintype" id="3007786">int</span>&nbsp;<span class="op" id="3007790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007793">if</span>&nbsp;<span class="ident" id="3007796">i</span>&nbsp;<span class="op" id="3007798">:=</span>&nbsp;<span class="builtinfunc" id="3007801">len</span><span class="op" id="3007804">(</span><span class="ident" id="3007805">x</span><span class="op" id="3007806">)</span>&nbsp;<span class="op" id="3007808">-</span>&nbsp;<span class="num" id="3007810">1</span><span class="op" id="3007811">;</span>&nbsp;<span class="ident" id="3007813">i</span>&nbsp;<span class="op" id="3007815">&gt;=</span>&nbsp;<span class="num" id="3007818">0</span>&nbsp;<span class="op" id="3007820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007824">return</span>&nbsp;<span class="ident" id="3007831">i</span><span class="op" id="3007832">*</span><span class="ident" id="3007833">_W</span>&nbsp;<span class="op" id="3007836">+</span>&nbsp;<span class="ident" id="3007838">bitLen</span><span class="op" id="3007844">(</span><span class="ident" id="3007845">x</span><span class="op" id="3007846">[</span><span class="ident" id="3007847">i</span><span class="op" id="3007848">]</span><span class="op" id="3007849">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3007852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007855">return</span>&nbsp;<span class="num" id="3007862">0</span><br>
<span class="lineno"></span><span class="op" id="3007864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3007867">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3007938">const</span>&nbsp;<span class="ident" id="3007944">MaxBase</span>&nbsp;<span class="op" id="3007952">=</span>&nbsp;<span class="string" id="3007954">&#39;z&#39;</span>&nbsp;<span class="op" id="3007958">-</span>&nbsp;<span class="string" id="3007960">&#39;a&#39;</span>&nbsp;<span class="op" id="3007964">+</span>&nbsp;<span class="num" id="3007966">10</span>&nbsp;<span class="op" id="3007969">+</span>&nbsp;<span class="num" id="3007971">1</span>&nbsp;<span class="comment" id="3007973">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3007997">func</span>&nbsp;<span class="ident" id="3008002">hexValue</span><span class="op" id="3008010">(</span><span class="ident" id="3008011">ch</span>&nbsp;<span class="builtintype" id="3008014">rune</span><span class="op" id="3008018">)</span>&nbsp;<span class="ident" id="3008020">Word</span>&nbsp;<span class="op" id="3008025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008028">d</span>&nbsp;<span class="op" id="3008030">:=</span>&nbsp;<span class="builtintype" id="3008033">int</span><span class="op" id="3008036">(</span><span class="ident" id="3008037">MaxBase</span>&nbsp;<span class="op" id="3008045">+</span>&nbsp;<span class="num" id="3008047">1</span><span class="op" id="3008048">)</span>&nbsp;<span class="comment" id="3008050">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008067">switch</span>&nbsp;<span class="op" id="3008074">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008077">case</span>&nbsp;<span class="string" id="3008082">&#39;0&#39;</span>&nbsp;<span class="op" id="3008086">&lt;=</span>&nbsp;<span class="ident" id="3008089">ch</span>&nbsp;<span class="op" id="3008092">&amp;&amp;</span>&nbsp;<span class="ident" id="3008095">ch</span>&nbsp;<span class="op" id="3008098">&lt;=</span>&nbsp;<span class="string" id="3008101">&#39;9&#39;</span><span class="op" id="3008104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008108">d</span>&nbsp;<span class="op" id="3008110">=</span>&nbsp;<span class="builtintype" id="3008112">int</span><span class="op" id="3008115">(</span><span class="ident" id="3008116">ch</span>&nbsp;<span class="op" id="3008119">-</span>&nbsp;<span class="string" id="3008121">&#39;0&#39;</span><span class="op" id="3008124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008127">case</span>&nbsp;<span class="string" id="3008132">&#39;a&#39;</span>&nbsp;<span class="op" id="3008136">&lt;=</span>&nbsp;<span class="ident" id="3008139">ch</span>&nbsp;<span class="op" id="3008142">&amp;&amp;</span>&nbsp;<span class="ident" id="3008145">ch</span>&nbsp;<span class="op" id="3008148">&lt;=</span>&nbsp;<span class="string" id="3008151">&#39;z&#39;</span><span class="op" id="3008154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008158">d</span>&nbsp;<span class="op" id="3008160">=</span>&nbsp;<span class="builtintype" id="3008162">int</span><span class="op" id="3008165">(</span><span class="ident" id="3008166">ch</span>&nbsp;<span class="op" id="3008169">-</span>&nbsp;<span class="string" id="3008171">&#39;a&#39;</span>&nbsp;<span class="op" id="3008175">+</span>&nbsp;<span class="num" id="3008177">10</span><span class="op" id="3008179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008182">case</span>&nbsp;<span class="string" id="3008187">&#39;A&#39;</span>&nbsp;<span class="op" id="3008191">&lt;=</span>&nbsp;<span class="ident" id="3008194">ch</span>&nbsp;<span class="op" id="3008197">&amp;&amp;</span>&nbsp;<span class="ident" id="3008200">ch</span>&nbsp;<span class="op" id="3008203">&lt;=</span>&nbsp;<span class="string" id="3008206">&#39;Z&#39;</span><span class="op" id="3008209">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008213">d</span>&nbsp;<span class="op" id="3008215">=</span>&nbsp;<span class="builtintype" id="3008217">int</span><span class="op" id="3008220">(</span><span class="ident" id="3008221">ch</span>&nbsp;<span class="op" id="3008224">-</span>&nbsp;<span class="string" id="3008226">&#39;A&#39;</span>&nbsp;<span class="op" id="3008230">+</span>&nbsp;<span class="num" id="3008232">10</span><span class="op" id="3008234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008240">return</span>&nbsp;<span class="ident" id="3008247">Word</span><span class="op" id="3008251">(</span><span class="ident" id="3008252">d</span><span class="op" id="3008253">)</span><br>
<span class="lineno"></span><span class="op" id="3008255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3008258">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3008340">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3008416">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3008495">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3008572">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3008608">//</span><br>
<span class="lineno"></span><span class="comment" id="3008611">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3008689">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3008767">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3008843">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3008921">//</span><br>
<span class="lineno"></span><span class="keyword" id="3008924">func</span>&nbsp;<span class="op" id="3008929">(</span><span class="ident" id="3008930">z</span>&nbsp;<span class="ident" id="3008932">nat</span><span class="op" id="3008935">)</span>&nbsp;<span class="ident" id="3008937">scan</span><span class="op" id="3008941">(</span><span class="ident" id="3008942">r</span>&nbsp;<span class="ident" id="3008944">io</span><span class="op" id="3008946">.</span><span class="ident" id="3008947">RuneScanner</span><span class="op" id="3008958">,</span>&nbsp;<span class="ident" id="3008960">base</span>&nbsp;<span class="builtintype" id="3008965">int</span><span class="op" id="3008968">)</span>&nbsp;<span class="op" id="3008970">(</span><span class="ident" id="3008971">nat</span><span class="op" id="3008974">,</span>&nbsp;<span class="builtintype" id="3008976">int</span><span class="op" id="3008979">,</span>&nbsp;<span class="builtintype" id="3008981">error</span><span class="op" id="3008986">)</span>&nbsp;<span class="op" id="3008988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3008991">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009016">if</span>&nbsp;<span class="ident" id="3009019">base</span>&nbsp;<span class="op" id="3009024">&lt;</span>&nbsp;<span class="num" id="3009026">0</span>&nbsp;<span class="op" id="3009028">||</span>&nbsp;<span class="ident" id="3009031">base</span>&nbsp;<span class="op" id="3009036">==</span>&nbsp;<span class="num" id="3009039">1</span>&nbsp;<span class="op" id="3009041">||</span>&nbsp;<span class="ident" id="3009044">MaxBase</span>&nbsp;<span class="op" id="3009052">&lt;</span>&nbsp;<span class="ident" id="3009054">base</span>&nbsp;<span class="op" id="3009059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009063">return</span>&nbsp;<span class="ident" id="3009070">z</span><span class="op" id="3009071">,</span>&nbsp;<span class="num" id="3009073">0</span><span class="op" id="3009074">,</span>&nbsp;<span class="ident" id="3009076">errors</span><span class="op" id="3009082">.</span><span class="ident" id="3009083">New</span><span class="op" id="3009086">(</span><span class="string" id="3009087">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3009108">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3009115">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009139">ch</span><span class="op" id="3009141">,</span>&nbsp;<span class="ident" id="3009143">_</span><span class="op" id="3009144">,</span>&nbsp;<span class="ident" id="3009146">err</span>&nbsp;<span class="op" id="3009150">:=</span>&nbsp;<span class="ident" id="3009153">r</span><span class="op" id="3009154">.</span><span class="ident" id="3009155">ReadRune</span><span class="op" id="3009163">(</span><span class="op" id="3009164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009167">if</span>&nbsp;<span class="ident" id="3009170">err</span>&nbsp;<span class="op" id="3009174">!=</span>&nbsp;<span class="builtintype" id="3009177">nil</span>&nbsp;<span class="op" id="3009181">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009185">return</span>&nbsp;<span class="ident" id="3009192">z</span><span class="op" id="3009193">,</span>&nbsp;<span class="num" id="3009195">0</span><span class="op" id="3009196">,</span>&nbsp;<span class="ident" id="3009198">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3009207">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009239">b</span>&nbsp;<span class="op" id="3009241">:=</span>&nbsp;<span class="ident" id="3009244">Word</span><span class="op" id="3009248">(</span><span class="ident" id="3009249">base</span><span class="op" id="3009253">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009256">if</span>&nbsp;<span class="ident" id="3009259">base</span>&nbsp;<span class="op" id="3009264">==</span>&nbsp;<span class="num" id="3009267">0</span>&nbsp;<span class="op" id="3009269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009273">b</span>&nbsp;<span class="op" id="3009275">=</span>&nbsp;<span class="num" id="3009277">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009282">if</span>&nbsp;<span class="ident" id="3009285">ch</span>&nbsp;<span class="op" id="3009288">==</span>&nbsp;<span class="string" id="3009291">&#39;0&#39;</span>&nbsp;<span class="op" id="3009295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009300">switch</span>&nbsp;<span class="ident" id="3009307">ch</span><span class="op" id="3009309">,</span>&nbsp;<span class="ident" id="3009311">_</span><span class="op" id="3009312">,</span>&nbsp;<span class="ident" id="3009314">err</span>&nbsp;<span class="op" id="3009318">=</span>&nbsp;<span class="ident" id="3009320">r</span><span class="op" id="3009321">.</span><span class="ident" id="3009322">ReadRune</span><span class="op" id="3009330">(</span><span class="op" id="3009331">)</span><span class="op" id="3009332">;</span>&nbsp;<span class="ident" id="3009334">err</span>&nbsp;<span class="op" id="3009338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009343">case</span>&nbsp;<span class="builtintype" id="3009348">nil</span><span class="op" id="3009351">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009357">b</span>&nbsp;<span class="op" id="3009359">=</span>&nbsp;<span class="num" id="3009361">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009367">switch</span>&nbsp;<span class="ident" id="3009374">ch</span>&nbsp;<span class="op" id="3009377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009383">case</span>&nbsp;<span class="string" id="3009388">&#39;x&#39;</span><span class="op" id="3009391">,</span>&nbsp;<span class="string" id="3009393">&#39;X&#39;</span><span class="op" id="3009396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009403">b</span>&nbsp;<span class="op" id="3009405">=</span>&nbsp;<span class="num" id="3009407">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009414">case</span>&nbsp;<span class="string" id="3009419">&#39;b&#39;</span><span class="op" id="3009422">,</span>&nbsp;<span class="string" id="3009424">&#39;B&#39;</span><span class="op" id="3009427">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009434">b</span>&nbsp;<span class="op" id="3009436">=</span>&nbsp;<span class="num" id="3009438">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009450">if</span>&nbsp;<span class="ident" id="3009453">b</span>&nbsp;<span class="op" id="3009455">==</span>&nbsp;<span class="num" id="3009458">2</span>&nbsp;<span class="op" id="3009460">||</span>&nbsp;<span class="ident" id="3009463">b</span>&nbsp;<span class="op" id="3009465">==</span>&nbsp;<span class="num" id="3009468">16</span>&nbsp;<span class="op" id="3009471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009478">if</span>&nbsp;<span class="ident" id="3009481">ch</span><span class="op" id="3009483">,</span>&nbsp;<span class="ident" id="3009485">_</span><span class="op" id="3009486">,</span>&nbsp;<span class="ident" id="3009488">err</span>&nbsp;<span class="op" id="3009492">=</span>&nbsp;<span class="ident" id="3009494">r</span><span class="op" id="3009495">.</span><span class="ident" id="3009496">ReadRune</span><span class="op" id="3009504">(</span><span class="op" id="3009505">)</span><span class="op" id="3009506">;</span>&nbsp;<span class="ident" id="3009508">err</span>&nbsp;<span class="op" id="3009512">!=</span>&nbsp;<span class="builtintype" id="3009515">nil</span>&nbsp;<span class="op" id="3009519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009527">return</span>&nbsp;<span class="ident" id="3009534">z</span><span class="op" id="3009535">,</span>&nbsp;<span class="num" id="3009537">0</span><span class="op" id="3009538">,</span>&nbsp;<span class="ident" id="3009540">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009560">case</span>&nbsp;<span class="ident" id="3009565">io</span><span class="op" id="3009567">.</span><span class="ident" id="3009568">EOF</span><span class="op" id="3009571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009577">return</span>&nbsp;<span class="ident" id="3009584">z</span><span class="op" id="3009585">.</span><span class="builtinfunc" id="3009586">make</span><span class="op" id="3009590">(</span><span class="num" id="3009591">0</span><span class="op" id="3009592">)</span><span class="op" id="3009593">,</span>&nbsp;<span class="num" id="3009595">10</span><span class="op" id="3009597">,</span>&nbsp;<span class="builtintype" id="3009599">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009606">default</span><span class="op" id="3009613">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009619">return</span>&nbsp;<span class="ident" id="3009626">z</span><span class="op" id="3009627">,</span>&nbsp;<span class="num" id="3009629">10</span><span class="op" id="3009631">,</span>&nbsp;<span class="ident" id="3009633">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3009651">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3009670">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3009765">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009860">z</span>&nbsp;<span class="op" id="3009862">=</span>&nbsp;<span class="ident" id="3009864">z</span><span class="op" id="3009865">.</span><span class="builtinfunc" id="3009866">make</span><span class="op" id="3009870">(</span><span class="num" id="3009871">0</span><span class="op" id="3009872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009875">bb</span>&nbsp;<span class="op" id="3009878">:=</span>&nbsp;<span class="ident" id="3009881">Word</span><span class="op" id="3009885">(</span><span class="num" id="3009886">1</span><span class="op" id="3009887">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009890">dd</span>&nbsp;<span class="op" id="3009893">:=</span>&nbsp;<span class="ident" id="3009896">Word</span><span class="op" id="3009900">(</span><span class="num" id="3009901">0</span><span class="op" id="3009902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009905">for</span>&nbsp;<span class="ident" id="3009909">max</span>&nbsp;<span class="op" id="3009913">:=</span>&nbsp;<span class="ident" id="3009916">_M</span>&nbsp;<span class="op" id="3009919">/</span>&nbsp;<span class="ident" id="3009921">b</span><span class="op" id="3009922">;</span>&nbsp;<span class="op" id="3009924">;</span>&nbsp;<span class="op" id="3009926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009930">d</span>&nbsp;<span class="op" id="3009932">:=</span>&nbsp;<span class="ident" id="3009935">hexValue</span><span class="op" id="3009943">(</span><span class="ident" id="3009944">ch</span><span class="op" id="3009946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009950">if</span>&nbsp;<span class="ident" id="3009953">d</span>&nbsp;<span class="op" id="3009955">&gt;=</span>&nbsp;<span class="ident" id="3009958">b</span>&nbsp;<span class="op" id="3009960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009965">r</span><span class="op" id="3009966">.</span><span class="ident" id="3009967">UnreadRune</span><span class="op" id="3009977">(</span><span class="op" id="3009978">)</span>&nbsp;<span class="comment" id="3009980">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010023">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010036">if</span>&nbsp;<span class="ident" id="3010039">bb</span>&nbsp;<span class="op" id="3010042">&lt;=</span>&nbsp;<span class="ident" id="3010045">max</span>&nbsp;<span class="op" id="3010049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010054">bb</span>&nbsp;<span class="op" id="3010057">*=</span>&nbsp;<span class="ident" id="3010060">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010065">dd</span>&nbsp;<span class="op" id="3010068">=</span>&nbsp;<span class="ident" id="3010070">dd</span><span class="op" id="3010072">*</span><span class="ident" id="3010073">b</span>&nbsp;<span class="op" id="3010075">+</span>&nbsp;<span class="ident" id="3010077">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010081">}</span>&nbsp;<span class="keyword" id="3010083">else</span>&nbsp;<span class="op" id="3010088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3010093">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010121">z</span>&nbsp;<span class="op" id="3010123">=</span>&nbsp;<span class="ident" id="3010125">z</span><span class="op" id="3010126">.</span><span class="ident" id="3010127">mulAddWW</span><span class="op" id="3010135">(</span><span class="ident" id="3010136">z</span><span class="op" id="3010137">,</span>&nbsp;<span class="ident" id="3010139">bb</span><span class="op" id="3010141">,</span>&nbsp;<span class="ident" id="3010143">dd</span><span class="op" id="3010145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010150">bb</span>&nbsp;<span class="op" id="3010153">=</span>&nbsp;<span class="ident" id="3010155">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010160">dd</span>&nbsp;<span class="op" id="3010163">=</span>&nbsp;<span class="ident" id="3010165">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010174">if</span>&nbsp;<span class="ident" id="3010177">ch</span><span class="op" id="3010179">,</span>&nbsp;<span class="ident" id="3010181">_</span><span class="op" id="3010182">,</span>&nbsp;<span class="ident" id="3010184">err</span>&nbsp;<span class="op" id="3010188">=</span>&nbsp;<span class="ident" id="3010190">r</span><span class="op" id="3010191">.</span><span class="ident" id="3010192">ReadRune</span><span class="op" id="3010200">(</span><span class="op" id="3010201">)</span><span class="op" id="3010202">;</span>&nbsp;<span class="ident" id="3010204">err</span>&nbsp;<span class="op" id="3010208">!=</span>&nbsp;<span class="builtintype" id="3010211">nil</span>&nbsp;<span class="op" id="3010215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010220">if</span>&nbsp;<span class="ident" id="3010223">err</span>&nbsp;<span class="op" id="3010227">!=</span>&nbsp;<span class="ident" id="3010230">io</span><span class="op" id="3010232">.</span><span class="ident" id="3010233">EOF</span>&nbsp;<span class="op" id="3010237">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010243">return</span>&nbsp;<span class="ident" id="3010250">z</span><span class="op" id="3010251">,</span>&nbsp;<span class="builtintype" id="3010253">int</span><span class="op" id="3010256">(</span><span class="ident" id="3010257">b</span><span class="op" id="3010258">)</span><span class="op" id="3010259">,</span>&nbsp;<span class="ident" id="3010261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010273">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010284">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010288">switch</span>&nbsp;<span class="op" id="3010295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010298">case</span>&nbsp;<span class="ident" id="3010303">bb</span>&nbsp;<span class="op" id="3010306">&gt;</span>&nbsp;<span class="num" id="3010308">1</span><span class="op" id="3010309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3010313">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010356">z</span>&nbsp;<span class="op" id="3010358">=</span>&nbsp;<span class="ident" id="3010360">z</span><span class="op" id="3010361">.</span><span class="ident" id="3010362">mulAddWW</span><span class="op" id="3010370">(</span><span class="ident" id="3010371">z</span><span class="op" id="3010372">,</span>&nbsp;<span class="ident" id="3010374">bb</span><span class="op" id="3010376">,</span>&nbsp;<span class="ident" id="3010378">dd</span><span class="op" id="3010380">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010383">case</span>&nbsp;<span class="ident" id="3010388">base</span>&nbsp;<span class="op" id="3010393">==</span>&nbsp;<span class="num" id="3010396">0</span>&nbsp;<span class="op" id="3010398">&amp;&amp;</span>&nbsp;<span class="ident" id="3010401">b</span>&nbsp;<span class="op" id="3010403">==</span>&nbsp;<span class="num" id="3010406">8</span><span class="op" id="3010407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3010411">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3010485">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010512">return</span>&nbsp;<span class="ident" id="3010519">z</span><span class="op" id="3010520">,</span>&nbsp;<span class="num" id="3010522">10</span><span class="op" id="3010524">,</span>&nbsp;<span class="builtintype" id="3010526">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010531">case</span>&nbsp;<span class="ident" id="3010536">base</span>&nbsp;<span class="op" id="3010541">!=</span>&nbsp;<span class="num" id="3010544">0</span>&nbsp;<span class="op" id="3010546">||</span>&nbsp;<span class="ident" id="3010549">b</span>&nbsp;<span class="op" id="3010551">!=</span>&nbsp;<span class="num" id="3010554">8</span><span class="op" id="3010555">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3010559">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010622">return</span>&nbsp;<span class="ident" id="3010629">z</span><span class="op" id="3010630">,</span>&nbsp;<span class="builtintype" id="3010632">int</span><span class="op" id="3010635">(</span><span class="ident" id="3010636">b</span><span class="op" id="3010637">)</span><span class="op" id="3010638">,</span>&nbsp;<span class="ident" id="3010640">errors</span><span class="op" id="3010646">.</span><span class="ident" id="3010647">New</span><span class="op" id="3010650">(</span><span class="string" id="3010651">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3010681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010688">return</span>&nbsp;<span class="ident" id="3010695">z</span><span class="op" id="3010696">.</span><span class="ident" id="3010697">norm</span><span class="op" id="3010701">(</span><span class="op" id="3010702">)</span><span class="op" id="3010703">,</span>&nbsp;<span class="builtintype" id="3010705">int</span><span class="op" id="3010708">(</span><span class="ident" id="3010709">b</span><span class="op" id="3010710">)</span><span class="op" id="3010711">,</span>&nbsp;<span class="builtintype" id="3010713">nil</span><br>
<span class="lineno">720</span><span class="op" id="3010717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3010720">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3010761">const</span>&nbsp;<span class="op" id="3010767">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010770">lowercaseDigits</span>&nbsp;<span class="op" id="3010786">=</span>&nbsp;<span class="string" id="3010788">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010828">uppercaseDigits</span>&nbsp;<span class="op" id="3010844">=</span>&nbsp;<span class="string" id="3010846">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3010885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3010888">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3010944">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3010996">func</span>&nbsp;<span class="op" id="3011001">(</span><span class="ident" id="3011002">x</span>&nbsp;<span class="ident" id="3011004">nat</span><span class="op" id="3011007">)</span>&nbsp;<span class="ident" id="3011009">decimalString</span><span class="op" id="3011022">(</span><span class="op" id="3011023">)</span>&nbsp;<span class="builtintype" id="3011025">string</span>&nbsp;<span class="op" id="3011032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011035">return</span>&nbsp;<span class="ident" id="3011042">x</span><span class="op" id="3011043">.</span><span class="builtintype" id="3011044">string</span><span class="op" id="3011050">(</span><span class="ident" id="3011051">lowercaseDigits</span><span class="op" id="3011066">[</span><span class="num" id="3011067">0</span><span class="op" id="3011068">:</span><span class="num" id="3011069">10</span><span class="op" id="3011071">]</span><span class="op" id="3011072">)</span><br>
<span class="lineno"></span><span class="op" id="3011074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3011077">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3011152">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3011227">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3011278">func</span>&nbsp;<span class="op" id="3011283">(</span><span class="ident" id="3011284">x</span>&nbsp;<span class="ident" id="3011286">nat</span><span class="op" id="3011289">)</span>&nbsp;<span class="builtintype" id="3011291">string</span><span class="op" id="3011297">(</span><span class="ident" id="3011298">charset</span>&nbsp;<span class="builtintype" id="3011306">string</span><span class="op" id="3011312">)</span>&nbsp;<span class="builtintype" id="3011314">string</span>&nbsp;<span class="op" id="3011321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011324">b</span>&nbsp;<span class="op" id="3011326">:=</span>&nbsp;<span class="ident" id="3011329">Word</span><span class="op" id="3011333">(</span><span class="builtinfunc" id="3011334">len</span><span class="op" id="3011337">(</span><span class="ident" id="3011338">charset</span><span class="op" id="3011345">)</span><span class="op" id="3011346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011350">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011368">switch</span>&nbsp;<span class="op" id="3011375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011378">case</span>&nbsp;<span class="ident" id="3011383">b</span>&nbsp;<span class="op" id="3011385">&lt;</span>&nbsp;<span class="num" id="3011387">2</span>&nbsp;<span class="op" id="3011389">||</span>&nbsp;<span class="ident" id="3011392">MaxBase</span>&nbsp;<span class="op" id="3011400">&gt;</span>&nbsp;<span class="num" id="3011402">256</span><span class="op" id="3011405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3011409">panic</span><span class="op" id="3011414">(</span><span class="string" id="3011415">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3011429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011432">case</span>&nbsp;<span class="builtinfunc" id="3011437">len</span><span class="op" id="3011440">(</span><span class="ident" id="3011441">x</span><span class="op" id="3011442">)</span>&nbsp;<span class="op" id="3011444">==</span>&nbsp;<span class="num" id="3011447">0</span><span class="op" id="3011448">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011452">return</span>&nbsp;<span class="builtintype" id="3011459">string</span><span class="op" id="3011465">(</span><span class="ident" id="3011466">charset</span><span class="op" id="3011473">[</span><span class="num" id="3011474">0</span><span class="op" id="3011475">]</span><span class="op" id="3011476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011483">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011518">i</span>&nbsp;<span class="op" id="3011520">:=</span>&nbsp;<span class="builtintype" id="3011523">int</span><span class="op" id="3011526">(</span><span class="builtintype" id="3011527">float64</span><span class="op" id="3011534">(</span><span class="ident" id="3011535">x</span><span class="op" id="3011536">.</span><span class="ident" id="3011537">bitLen</span><span class="op" id="3011543">(</span><span class="op" id="3011544">)</span><span class="op" id="3011545">)</span><span class="op" id="3011546">/</span><span class="ident" id="3011547">math</span><span class="op" id="3011551">.</span><span class="ident" id="3011552">Log2</span><span class="op" id="3011556">(</span><span class="builtintype" id="3011557">float64</span><span class="op" id="3011564">(</span><span class="ident" id="3011565">b</span><span class="op" id="3011566">)</span><span class="op" id="3011567">)</span><span class="op" id="3011568">)</span>&nbsp;<span class="op" id="3011570">+</span>&nbsp;<span class="num" id="3011572">1</span>&nbsp;<span class="comment" id="3011574">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011597">s</span>&nbsp;<span class="op" id="3011599">:=</span>&nbsp;<span class="builtinfunc" id="3011602">make</span><span class="op" id="3011606">(</span><span class="op" id="3011607">[</span><span class="op" id="3011608">]</span><span class="builtintype" id="3011609">byte</span><span class="op" id="3011613">,</span>&nbsp;<span class="ident" id="3011615">i</span><span class="op" id="3011616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011620">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011683">if</span>&nbsp;<span class="ident" id="3011686">b</span>&nbsp;<span class="op" id="3011688">==</span>&nbsp;<span class="ident" id="3011691">b</span><span class="op" id="3011692">&amp;</span><span class="op" id="3011693">-</span><span class="ident" id="3011694">b</span>&nbsp;<span class="op" id="3011696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011700">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011740">shift</span>&nbsp;<span class="op" id="3011746">:=</span>&nbsp;<span class="ident" id="3011749">trailingZeroBits</span><span class="op" id="3011765">(</span><span class="ident" id="3011766">b</span><span class="op" id="3011767">)</span>&nbsp;<span class="comment" id="3011769">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011799">mask</span>&nbsp;<span class="op" id="3011804">:=</span>&nbsp;<span class="ident" id="3011807">Word</span><span class="op" id="3011811">(</span><span class="num" id="3011812">1</span><span class="op" id="3011813">)</span><span class="op" id="3011814">&lt;&lt;</span><span class="ident" id="3011816">shift</span>&nbsp;<span class="op" id="3011822">-</span>&nbsp;<span class="num" id="3011824">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011828">w</span>&nbsp;<span class="op" id="3011830">:=</span>&nbsp;<span class="ident" id="3011833">x</span><span class="op" id="3011834">[</span><span class="num" id="3011835">0</span><span class="op" id="3011836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011840">nbits</span>&nbsp;<span class="op" id="3011846">:=</span>&nbsp;<span class="builtintype" id="3011849">uint</span><span class="op" id="3011853">(</span><span class="ident" id="3011854">_W</span><span class="op" id="3011856">)</span>&nbsp;<span class="comment" id="3011858">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011896">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011932">for</span>&nbsp;<span class="ident" id="3011936">k</span>&nbsp;<span class="op" id="3011938">:=</span>&nbsp;<span class="num" id="3011941">1</span><span class="op" id="3011942">;</span>&nbsp;<span class="ident" id="3011944">k</span>&nbsp;<span class="op" id="3011946">&lt;</span>&nbsp;<span class="builtinfunc" id="3011948">len</span><span class="op" id="3011951">(</span><span class="ident" id="3011952">x</span><span class="op" id="3011953">)</span><span class="op" id="3011954">;</span>&nbsp;<span class="ident" id="3011956">k</span><span class="op" id="3011957">++</span>&nbsp;<span class="op" id="3011960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011965">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011991">for</span>&nbsp;<span class="ident" id="3011995">nbits</span>&nbsp;<span class="op" id="3012001">&gt;=</span>&nbsp;<span class="ident" id="3012004">shift</span>&nbsp;<span class="op" id="3012010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012016">i</span><span class="op" id="3012017">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012024">s</span><span class="op" id="3012025">[</span><span class="ident" id="3012026">i</span><span class="op" id="3012027">]</span>&nbsp;<span class="op" id="3012029">=</span>&nbsp;<span class="ident" id="3012031">charset</span><span class="op" id="3012038">[</span><span class="ident" id="3012039">w</span><span class="op" id="3012040">&amp;</span><span class="ident" id="3012041">mask</span><span class="op" id="3012045">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012051">w</span>&nbsp;<span class="op" id="3012053">&gt;&gt;=</span>&nbsp;<span class="ident" id="3012057">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012067">nbits</span>&nbsp;<span class="op" id="3012073">-=</span>&nbsp;<span class="ident" id="3012076">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012091">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012156">if</span>&nbsp;<span class="ident" id="3012159">nbits</span>&nbsp;<span class="op" id="3012165">==</span>&nbsp;<span class="num" id="3012168">0</span>&nbsp;<span class="op" id="3012170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012176">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012224">w</span>&nbsp;<span class="op" id="3012226">=</span>&nbsp;<span class="ident" id="3012228">x</span><span class="op" id="3012229">[</span><span class="ident" id="3012230">k</span><span class="op" id="3012231">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012237">nbits</span>&nbsp;<span class="op" id="3012243">=</span>&nbsp;<span class="ident" id="3012245">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012251">}</span>&nbsp;<span class="keyword" id="3012253">else</span>&nbsp;<span class="op" id="3012258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012264">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012320">w</span>&nbsp;<span class="op" id="3012322">|=</span>&nbsp;<span class="ident" id="3012325">x</span><span class="op" id="3012326">[</span><span class="ident" id="3012327">k</span><span class="op" id="3012328">]</span>&nbsp;<span class="op" id="3012330">&lt;&lt;</span>&nbsp;<span class="ident" id="3012333">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012343">i</span><span class="op" id="3012344">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012351">s</span><span class="op" id="3012352">[</span><span class="ident" id="3012353">i</span><span class="op" id="3012354">]</span>&nbsp;<span class="op" id="3012356">=</span>&nbsp;<span class="ident" id="3012358">charset</span><span class="op" id="3012365">[</span><span class="ident" id="3012366">w</span><span class="op" id="3012367">&amp;</span><span class="ident" id="3012368">mask</span><span class="op" id="3012372">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012379">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012394">w</span>&nbsp;<span class="op" id="3012396">=</span>&nbsp;<span class="ident" id="3012398">x</span><span class="op" id="3012399">[</span><span class="ident" id="3012400">k</span><span class="op" id="3012401">]</span>&nbsp;<span class="op" id="3012403">&gt;&gt;</span>&nbsp;<span class="op" id="3012406">(</span><span class="ident" id="3012407">shift</span>&nbsp;<span class="op" id="3012413">-</span>&nbsp;<span class="ident" id="3012415">nbits</span><span class="op" id="3012420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012426">nbits</span>&nbsp;<span class="op" id="3012432">=</span>&nbsp;<span class="ident" id="3012434">_W</span>&nbsp;<span class="op" id="3012437">-</span>&nbsp;<span class="op" id="3012439">(</span><span class="ident" id="3012440">shift</span>&nbsp;<span class="op" id="3012446">-</span>&nbsp;<span class="ident" id="3012448">nbits</span><span class="op" id="3012453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012458">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012467">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012533">for</span>&nbsp;<span class="ident" id="3012537">nbits</span>&nbsp;<span class="op" id="3012543">&gt;=</span>&nbsp;<span class="num" id="3012546">0</span>&nbsp;<span class="op" id="3012548">&amp;&amp;</span>&nbsp;<span class="ident" id="3012551">w</span>&nbsp;<span class="op" id="3012553">!=</span>&nbsp;<span class="num" id="3012556">0</span>&nbsp;<span class="op" id="3012558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012563">i</span><span class="op" id="3012564">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012570">s</span><span class="op" id="3012571">[</span><span class="ident" id="3012572">i</span><span class="op" id="3012573">]</span>&nbsp;<span class="op" id="3012575">=</span>&nbsp;<span class="ident" id="3012577">charset</span><span class="op" id="3012584">[</span><span class="ident" id="3012585">w</span><span class="op" id="3012586">&amp;</span><span class="ident" id="3012587">mask</span><span class="op" id="3012591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012596">w</span>&nbsp;<span class="op" id="3012598">&gt;&gt;=</span>&nbsp;<span class="ident" id="3012602">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012611">nbits</span>&nbsp;<span class="op" id="3012617">-=</span>&nbsp;<span class="ident" id="3012620">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012632">}</span>&nbsp;<span class="keyword" id="3012634">else</span>&nbsp;<span class="op" id="3012639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012643">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012706">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012764">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012821">bb</span>&nbsp;<span class="op" id="3012824">:=</span>&nbsp;<span class="ident" id="3012827">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012834">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012862">ndigits</span>&nbsp;<span class="op" id="3012870">:=</span>&nbsp;<span class="num" id="3012873">1</span>&nbsp;<span class="comment" id="3012875">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012904">for</span>&nbsp;<span class="ident" id="3012908">max</span>&nbsp;<span class="op" id="3012912">:=</span>&nbsp;<span class="ident" id="3012915">Word</span><span class="op" id="3012919">(</span><span class="ident" id="3012920">_M</span>&nbsp;<span class="op" id="3012923">/</span>&nbsp;<span class="ident" id="3012925">b</span><span class="op" id="3012926">)</span><span class="op" id="3012927">;</span>&nbsp;<span class="ident" id="3012929">bb</span>&nbsp;<span class="op" id="3012932">&lt;=</span>&nbsp;<span class="ident" id="3012935">max</span><span class="op" id="3012938">;</span>&nbsp;<span class="ident" id="3012940">bb</span>&nbsp;<span class="op" id="3012943">*=</span>&nbsp;<span class="ident" id="3012946">b</span>&nbsp;<span class="op" id="3012948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012953">ndigits</span><span class="op" id="3012960">++</span>&nbsp;<span class="comment" id="3012963">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013022">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013103">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013158">table</span>&nbsp;<span class="op" id="3013164">:=</span>&nbsp;<span class="ident" id="3013167">divisors</span><span class="op" id="3013175">(</span><span class="builtinfunc" id="3013176">len</span><span class="op" id="3013179">(</span><span class="ident" id="3013180">x</span><span class="op" id="3013181">)</span><span class="op" id="3013182">,</span>&nbsp;<span class="ident" id="3013184">b</span><span class="op" id="3013185">,</span>&nbsp;<span class="ident" id="3013187">ndigits</span><span class="op" id="3013194">,</span>&nbsp;<span class="ident" id="3013196">bb</span><span class="op" id="3013198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013203">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013262">q</span>&nbsp;<span class="op" id="3013264">:=</span>&nbsp;<span class="ident" id="3013267">nat</span><span class="op" id="3013270">(</span><span class="builtintype" id="3013271">nil</span><span class="op" id="3013274">)</span><span class="op" id="3013275">.</span><span class="ident" id="3013276">set</span><span class="op" id="3013279">(</span><span class="ident" id="3013280">x</span><span class="op" id="3013281">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013286">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013323">q</span><span class="op" id="3013324">.</span><span class="ident" id="3013325">convertWords</span><span class="op" id="3013337">(</span><span class="ident" id="3013338">s</span><span class="op" id="3013339">,</span>&nbsp;<span class="ident" id="3013341">charset</span><span class="op" id="3013348">,</span>&nbsp;<span class="ident" id="3013350">b</span><span class="op" id="3013351">,</span>&nbsp;<span class="ident" id="3013353">ndigits</span><span class="op" id="3013360">,</span>&nbsp;<span class="ident" id="3013362">bb</span><span class="op" id="3013364">,</span>&nbsp;<span class="ident" id="3013366">table</span><span class="op" id="3013371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013376">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013401">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013463">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013497">i</span>&nbsp;<span class="op" id="3013499">=</span>&nbsp;<span class="num" id="3013501">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013505">for</span>&nbsp;<span class="ident" id="3013509">zero</span>&nbsp;<span class="op" id="3013514">:=</span>&nbsp;<span class="ident" id="3013517">charset</span><span class="op" id="3013524">[</span><span class="num" id="3013525">0</span><span class="op" id="3013526">]</span><span class="op" id="3013527">;</span>&nbsp;<span class="ident" id="3013529">s</span><span class="op" id="3013530">[</span><span class="ident" id="3013531">i</span><span class="op" id="3013532">]</span>&nbsp;<span class="op" id="3013534">==</span>&nbsp;<span class="ident" id="3013537">zero</span><span class="op" id="3013541">;</span>&nbsp;<span class="op" id="3013543">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013548">i</span><span class="op" id="3013549">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013561">return</span>&nbsp;<span class="builtintype" id="3013568">string</span><span class="op" id="3013574">(</span><span class="ident" id="3013575">s</span><span class="op" id="3013576">[</span><span class="ident" id="3013577">i</span><span class="op" id="3013578">:</span><span class="op" id="3013579">]</span><span class="op" id="3013580">)</span><br>
<span class="lineno">825</span><span class="op" id="3013582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3013585">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3013679">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3013773">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3013804">//</span><br>
<span class="lineno"></span><span class="comment" id="3013807">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3013907">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3014004">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3014100">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3014196">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3014294">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3014391">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3014488">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3014586">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3014682">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3014775">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3014797">//</span><br>
<span class="lineno"></span><span class="keyword" id="3014800">func</span>&nbsp;<span class="op" id="3014805">(</span><span class="ident" id="3014806">q</span>&nbsp;<span class="ident" id="3014808">nat</span><span class="op" id="3014811">)</span>&nbsp;<span class="ident" id="3014813">convertWords</span><span class="op" id="3014825">(</span><span class="ident" id="3014826">s</span>&nbsp;<span class="op" id="3014828">[</span><span class="op" id="3014829">]</span><span class="builtintype" id="3014830">byte</span><span class="op" id="3014834">,</span>&nbsp;<span class="ident" id="3014836">charset</span>&nbsp;<span class="builtintype" id="3014844">string</span><span class="op" id="3014850">,</span>&nbsp;<span class="ident" id="3014852">b</span>&nbsp;<span class="ident" id="3014854">Word</span><span class="op" id="3014858">,</span>&nbsp;<span class="ident" id="3014860">ndigits</span>&nbsp;<span class="builtintype" id="3014868">int</span><span class="op" id="3014871">,</span>&nbsp;<span class="ident" id="3014873">bb</span>&nbsp;<span class="ident" id="3014876">Word</span><span class="op" id="3014880">,</span>&nbsp;<span class="ident" id="3014882">table</span>&nbsp;<span class="op" id="3014888">[</span><span class="op" id="3014889">]</span><span class="ident" id="3014890">divisor</span><span class="op" id="3014897">)</span>&nbsp;<span class="op" id="3014899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3014902">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014938">if</span>&nbsp;<span class="ident" id="3014941">table</span>&nbsp;<span class="op" id="3014947">!=</span>&nbsp;<span class="builtintype" id="3014950">nil</span>&nbsp;<span class="op" id="3014954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3014958">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3014985">var</span>&nbsp;<span class="ident" id="3014989">r</span>&nbsp;<span class="ident" id="3014991">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3014997">index</span>&nbsp;<span class="op" id="3015003">:=</span>&nbsp;<span class="builtinfunc" id="3015006">len</span><span class="op" id="3015009">(</span><span class="ident" id="3015010">table</span><span class="op" id="3015015">)</span>&nbsp;<span class="op" id="3015017">-</span>&nbsp;<span class="num" id="3015019">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3015023">for</span>&nbsp;<span class="builtinfunc" id="3015027">len</span><span class="op" id="3015030">(</span><span class="ident" id="3015031">q</span><span class="op" id="3015032">)</span>&nbsp;<span class="op" id="3015034">&gt;</span>&nbsp;<span class="ident" id="3015036">leafSize</span>&nbsp;<span class="op" id="3015045">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3015050">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015119">maxLength</span>&nbsp;<span class="op" id="3015129">:=</span>&nbsp;<span class="ident" id="3015132">q</span><span class="op" id="3015133">.</span><span class="ident" id="3015134">bitLen</span><span class="op" id="3015140">(</span><span class="op" id="3015141">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3015147">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015217">minLength</span>&nbsp;<span class="op" id="3015227">:=</span>&nbsp;<span class="ident" id="3015230">maxLength</span>&nbsp;<span class="op" id="3015240">&gt;&gt;</span>&nbsp;<span class="num" id="3015243">1</span>&nbsp;<span class="comment" id="3015245">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3015267">for</span>&nbsp;<span class="ident" id="3015271">index</span>&nbsp;<span class="op" id="3015277">&gt;</span>&nbsp;<span class="num" id="3015279">0</span>&nbsp;<span class="op" id="3015281">&amp;&amp;</span>&nbsp;<span class="ident" id="3015284">table</span><span class="op" id="3015289">[</span><span class="ident" id="3015290">index</span><span class="op" id="3015295">-</span><span class="num" id="3015296">1</span><span class="op" id="3015297">]</span><span class="op" id="3015298">.</span><span class="ident" id="3015299">nbits</span>&nbsp;<span class="op" id="3015305">&gt;</span>&nbsp;<span class="ident" id="3015307">minLength</span>&nbsp;<span class="op" id="3015317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015323">index</span><span class="op" id="3015328">--</span>&nbsp;<span class="comment" id="3015331">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3015345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3015350">if</span>&nbsp;<span class="ident" id="3015353">table</span><span class="op" id="3015358">[</span><span class="ident" id="3015359">index</span><span class="op" id="3015364">]</span><span class="op" id="3015365">.</span><span class="ident" id="3015366">nbits</span>&nbsp;<span class="op" id="3015372">&gt;=</span>&nbsp;<span class="ident" id="3015375">maxLength</span>&nbsp;<span class="op" id="3015385">&amp;&amp;</span>&nbsp;<span class="ident" id="3015388">table</span><span class="op" id="3015393">[</span><span class="ident" id="3015394">index</span><span class="op" id="3015399">]</span><span class="op" id="3015400">.</span><span class="ident" id="3015401">bbb</span><span class="op" id="3015404">.</span><span class="ident" id="3015405">cmp</span><span class="op" id="3015408">(</span><span class="ident" id="3015409">q</span><span class="op" id="3015410">)</span>&nbsp;<span class="op" id="3015412">&gt;=</span>&nbsp;<span class="num" id="3015415">0</span>&nbsp;<span class="op" id="3015417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015423">index</span><span class="op" id="3015428">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3015435">if</span>&nbsp;<span class="ident" id="3015438">index</span>&nbsp;<span class="op" id="3015444">&lt;</span>&nbsp;<span class="num" id="3015446">0</span>&nbsp;<span class="op" id="3015448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3015455">panic</span><span class="op" id="3015460">(</span><span class="string" id="3015461">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3015485">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3015491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3015496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3015502">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015585">q</span><span class="op" id="3015586">,</span>&nbsp;<span class="ident" id="3015588">r</span>&nbsp;<span class="op" id="3015590">=</span>&nbsp;<span class="ident" id="3015592">q</span><span class="op" id="3015593">.</span><span class="ident" id="3015594">div</span><span class="op" id="3015597">(</span><span class="ident" id="3015598">r</span><span class="op" id="3015599">,</span>&nbsp;<span class="ident" id="3015601">q</span><span class="op" id="3015602">,</span>&nbsp;<span class="ident" id="3015604">table</span><span class="op" id="3015609">[</span><span class="ident" id="3015610">index</span><span class="op" id="3015615">]</span><span class="op" id="3015616">.</span><span class="ident" id="3015617">bbb</span><span class="op" id="3015620">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3015626">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015689">h</span>&nbsp;<span class="op" id="3015691">:=</span>&nbsp;<span class="builtinfunc" id="3015694">len</span><span class="op" id="3015697">(</span><span class="ident" id="3015698">s</span><span class="op" id="3015699">)</span>&nbsp;<span class="op" id="3015701">-</span>&nbsp;<span class="ident" id="3015703">table</span><span class="op" id="3015708">[</span><span class="ident" id="3015709">index</span><span class="op" id="3015714">]</span><span class="op" id="3015715">.</span><span class="ident" id="3015716">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015727">r</span><span class="op" id="3015728">.</span><span class="ident" id="3015729">convertWords</span><span class="op" id="3015741">(</span><span class="ident" id="3015742">s</span><span class="op" id="3015743">[</span><span class="ident" id="3015744">h</span><span class="op" id="3015745">:</span><span class="op" id="3015746">]</span><span class="op" id="3015747">,</span>&nbsp;<span class="ident" id="3015749">charset</span><span class="op" id="3015756">,</span>&nbsp;<span class="ident" id="3015758">b</span><span class="op" id="3015759">,</span>&nbsp;<span class="ident" id="3015761">ndigits</span><span class="op" id="3015768">,</span>&nbsp;<span class="ident" id="3015770">bb</span><span class="op" id="3015772">,</span>&nbsp;<span class="ident" id="3015774">table</span><span class="op" id="3015779">[</span><span class="num" id="3015780">0</span><span class="op" id="3015781">:</span><span class="ident" id="3015782">index</span><span class="op" id="3015787">]</span><span class="op" id="3015788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015793">s</span>&nbsp;<span class="op" id="3015795">=</span>&nbsp;<span class="ident" id="3015797">s</span><span class="op" id="3015798">[</span><span class="op" id="3015799">:</span><span class="ident" id="3015800">h</span><span class="op" id="3015801">]</span>&nbsp;<span class="comment" id="3015803">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3015872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3015875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3015879">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3015965">i</span>&nbsp;<span class="op" id="3015967">:=</span>&nbsp;<span class="builtinfunc" id="3015970">len</span><span class="op" id="3015973">(</span><span class="ident" id="3015974">s</span><span class="op" id="3015975">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3015978">var</span>&nbsp;<span class="ident" id="3015982">r</span>&nbsp;<span class="ident" id="3015984">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3015990">if</span>&nbsp;<span class="ident" id="3015993">b</span>&nbsp;<span class="op" id="3015995">==</span>&nbsp;<span class="num" id="3015998">10</span>&nbsp;<span class="op" id="3016001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016005">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3016092">for</span>&nbsp;<span class="builtinfunc" id="3016096">len</span><span class="op" id="3016099">(</span><span class="ident" id="3016100">q</span><span class="op" id="3016101">)</span>&nbsp;<span class="op" id="3016103">&gt;</span>&nbsp;<span class="num" id="3016105">0</span>&nbsp;<span class="op" id="3016107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016112">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016161">q</span><span class="op" id="3016162">,</span>&nbsp;<span class="ident" id="3016164">r</span>&nbsp;<span class="op" id="3016166">=</span>&nbsp;<span class="ident" id="3016168">q</span><span class="op" id="3016169">.</span><span class="ident" id="3016170">divW</span><span class="op" id="3016174">(</span><span class="ident" id="3016175">q</span><span class="op" id="3016176">,</span>&nbsp;<span class="ident" id="3016178">bb</span><span class="op" id="3016180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3016185">for</span>&nbsp;<span class="ident" id="3016189">j</span>&nbsp;<span class="op" id="3016191">:=</span>&nbsp;<span class="num" id="3016194">0</span><span class="op" id="3016195">;</span>&nbsp;<span class="ident" id="3016197">j</span>&nbsp;<span class="op" id="3016199">&lt;</span>&nbsp;<span class="ident" id="3016201">ndigits</span>&nbsp;<span class="op" id="3016209">&amp;&amp;</span>&nbsp;<span class="ident" id="3016212">i</span>&nbsp;<span class="op" id="3016214">&gt;</span>&nbsp;<span class="num" id="3016216">0</span><span class="op" id="3016217">;</span>&nbsp;<span class="ident" id="3016219">j</span><span class="op" id="3016220">++</span>&nbsp;<span class="op" id="3016223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016229">i</span><span class="op" id="3016230">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016237">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016296">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016360">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016422">t</span>&nbsp;<span class="op" id="3016424">:=</span>&nbsp;<span class="ident" id="3016427">r</span>&nbsp;<span class="op" id="3016429">/</span>&nbsp;<span class="num" id="3016431">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016438">s</span><span class="op" id="3016439">[</span><span class="ident" id="3016440">i</span><span class="op" id="3016441">]</span>&nbsp;<span class="op" id="3016443">=</span>&nbsp;<span class="ident" id="3016445">charset</span><span class="op" id="3016452">[</span><span class="ident" id="3016453">r</span><span class="op" id="3016454">-</span><span class="ident" id="3016455">t</span><span class="op" id="3016456">&lt;&lt;</span><span class="num" id="3016458">3</span><span class="op" id="3016459">-</span><span class="ident" id="3016460">t</span><span class="op" id="3016461">-</span><span class="ident" id="3016462">t</span><span class="op" id="3016463">]</span>&nbsp;<span class="comment" id="3016465">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016533">r</span>&nbsp;<span class="op" id="3016535">=</span>&nbsp;<span class="ident" id="3016537">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016542">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016549">}</span>&nbsp;<span class="keyword" id="3016551">else</span>&nbsp;<span class="op" id="3016556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3016560">for</span>&nbsp;<span class="builtinfunc" id="3016564">len</span><span class="op" id="3016567">(</span><span class="ident" id="3016568">q</span><span class="op" id="3016569">)</span>&nbsp;<span class="op" id="3016571">&gt;</span>&nbsp;<span class="num" id="3016573">0</span>&nbsp;<span class="op" id="3016575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016580">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016629">q</span><span class="op" id="3016630">,</span>&nbsp;<span class="ident" id="3016632">r</span>&nbsp;<span class="op" id="3016634">=</span>&nbsp;<span class="ident" id="3016636">q</span><span class="op" id="3016637">.</span><span class="ident" id="3016638">divW</span><span class="op" id="3016642">(</span><span class="ident" id="3016643">q</span><span class="op" id="3016644">,</span>&nbsp;<span class="ident" id="3016646">bb</span><span class="op" id="3016648">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3016653">for</span>&nbsp;<span class="ident" id="3016657">j</span>&nbsp;<span class="op" id="3016659">:=</span>&nbsp;<span class="num" id="3016662">0</span><span class="op" id="3016663">;</span>&nbsp;<span class="ident" id="3016665">j</span>&nbsp;<span class="op" id="3016667">&lt;</span>&nbsp;<span class="ident" id="3016669">ndigits</span>&nbsp;<span class="op" id="3016677">&amp;&amp;</span>&nbsp;<span class="ident" id="3016680">i</span>&nbsp;<span class="op" id="3016682">&gt;</span>&nbsp;<span class="num" id="3016684">0</span><span class="op" id="3016685">;</span>&nbsp;<span class="ident" id="3016687">j</span><span class="op" id="3016688">++</span>&nbsp;<span class="op" id="3016691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016697">i</span><span class="op" id="3016698">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016705">s</span><span class="op" id="3016706">[</span><span class="ident" id="3016707">i</span><span class="op" id="3016708">]</span>&nbsp;<span class="op" id="3016710">=</span>&nbsp;<span class="ident" id="3016712">charset</span><span class="op" id="3016719">[</span><span class="ident" id="3016720">r</span><span class="op" id="3016721">%</span><span class="ident" id="3016722">b</span><span class="op" id="3016723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016729">r</span>&nbsp;<span class="op" id="3016731">/=</span>&nbsp;<span class="ident" id="3016734">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016739">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3016750">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016780">zero</span>&nbsp;<span class="op" id="3016785">:=</span>&nbsp;<span class="ident" id="3016788">charset</span><span class="op" id="3016795">[</span><span class="num" id="3016796">0</span><span class="op" id="3016797">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3016800">for</span>&nbsp;<span class="ident" id="3016804">i</span>&nbsp;<span class="op" id="3016806">&gt;</span>&nbsp;<span class="num" id="3016808">0</span>&nbsp;<span class="op" id="3016810">{</span>&nbsp;<span class="comment" id="3016812">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016848">i</span><span class="op" id="3016849">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3016854">s</span><span class="op" id="3016855">[</span><span class="ident" id="3016856">i</span><span class="op" id="3016857">]</span>&nbsp;<span class="op" id="3016859">=</span>&nbsp;<span class="ident" id="3016861">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3016867">}</span><br>
<span class="lineno"></span><span class="op" id="3016869">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3016872">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3016962">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3017027">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3017107">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3017167">var</span>&nbsp;<span class="ident" id="3017171">leafSize</span>&nbsp;<span class="builtintype" id="3017180">int</span>&nbsp;<span class="op" id="3017184">=</span>&nbsp;<span class="num" id="3017186">8</span>&nbsp;<span class="comment" id="3017188">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017254">type</span>&nbsp;<span class="ident" id="3017259">divisor</span>&nbsp;<span class="keyword" id="3017267">struct</span>&nbsp;<span class="op" id="3017274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017277">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017285">nat</span>&nbsp;<span class="comment" id="3017289">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017301">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3017309">int</span>&nbsp;<span class="comment" id="3017313">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017381">ndigits</span>&nbsp;<span class="builtintype" id="3017389">int</span>&nbsp;<span class="comment" id="3017393">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3017451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3017454">var</span>&nbsp;<span class="ident" id="3017458">cacheBase10</span>&nbsp;<span class="keyword" id="3017470">struct</span>&nbsp;<span class="op" id="3017477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017480">sync</span><span class="op" id="3017484">.</span><span class="ident" id="3017485">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017492">table</span>&nbsp;<span class="op" id="3017498">[</span><span class="num" id="3017499">64</span><span class="op" id="3017501">]</span><span class="ident" id="3017502">divisor</span>&nbsp;<span class="comment" id="3017510">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3017541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3017544">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3017567">func</span>&nbsp;<span class="op" id="3017572">(</span><span class="ident" id="3017573">z</span>&nbsp;<span class="ident" id="3017575">nat</span><span class="op" id="3017578">)</span>&nbsp;<span class="ident" id="3017580">expWW</span><span class="op" id="3017585">(</span><span class="ident" id="3017586">x</span><span class="op" id="3017587">,</span>&nbsp;<span class="ident" id="3017589">y</span>&nbsp;<span class="ident" id="3017591">Word</span><span class="op" id="3017595">)</span>&nbsp;<span class="ident" id="3017597">nat</span>&nbsp;<span class="op" id="3017601">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3017604">return</span>&nbsp;<span class="ident" id="3017611">z</span><span class="op" id="3017612">.</span><span class="ident" id="3017613">expNN</span><span class="op" id="3017618">(</span><span class="ident" id="3017619">nat</span><span class="op" id="3017622">(</span><span class="builtintype" id="3017623">nil</span><span class="op" id="3017626">)</span><span class="op" id="3017627">.</span><span class="ident" id="3017628">setWord</span><span class="op" id="3017635">(</span><span class="ident" id="3017636">x</span><span class="op" id="3017637">)</span><span class="op" id="3017638">,</span>&nbsp;<span class="ident" id="3017640">nat</span><span class="op" id="3017643">(</span><span class="builtintype" id="3017644">nil</span><span class="op" id="3017647">)</span><span class="op" id="3017648">.</span><span class="ident" id="3017649">setWord</span><span class="op" id="3017656">(</span><span class="ident" id="3017657">y</span><span class="op" id="3017658">)</span><span class="op" id="3017659">,</span>&nbsp;<span class="builtintype" id="3017661">nil</span><span class="op" id="3017664">)</span><br>
<span class="lineno"></span><span class="op" id="3017666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3017669">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3017736">func</span>&nbsp;<span class="ident" id="3017741">divisors</span><span class="op" id="3017749">(</span><span class="ident" id="3017750">m</span>&nbsp;<span class="builtintype" id="3017752">int</span><span class="op" id="3017755">,</span>&nbsp;<span class="ident" id="3017757">b</span>&nbsp;<span class="ident" id="3017759">Word</span><span class="op" id="3017763">,</span>&nbsp;<span class="ident" id="3017765">ndigits</span>&nbsp;<span class="builtintype" id="3017773">int</span><span class="op" id="3017776">,</span>&nbsp;<span class="ident" id="3017778">bb</span>&nbsp;<span class="ident" id="3017781">Word</span><span class="op" id="3017785">)</span>&nbsp;<span class="op" id="3017787">[</span><span class="op" id="3017788">]</span><span class="ident" id="3017789">divisor</span>&nbsp;<span class="op" id="3017797">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3017800">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3017875">if</span>&nbsp;<span class="ident" id="3017878">leafSize</span>&nbsp;<span class="op" id="3017887">==</span>&nbsp;<span class="num" id="3017890">0</span>&nbsp;<span class="op" id="3017892">||</span>&nbsp;<span class="ident" id="3017895">m</span>&nbsp;<span class="op" id="3017897">&lt;=</span>&nbsp;<span class="ident" id="3017900">leafSize</span>&nbsp;<span class="op" id="3017909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3017913">return</span>&nbsp;<span class="builtintype" id="3017920">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3017925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3017929">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3017985">k</span>&nbsp;<span class="op" id="3017987">:=</span>&nbsp;<span class="num" id="3017990">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3017993">for</span>&nbsp;<span class="ident" id="3017997">words</span>&nbsp;<span class="op" id="3018003">:=</span>&nbsp;<span class="ident" id="3018006">leafSize</span><span class="op" id="3018014">;</span>&nbsp;<span class="ident" id="3018016">words</span>&nbsp;<span class="op" id="3018022">&lt;</span>&nbsp;<span class="ident" id="3018024">m</span><span class="op" id="3018025">&gt;&gt;</span><span class="num" id="3018027">1</span>&nbsp;<span class="op" id="3018029">&amp;&amp;</span>&nbsp;<span class="ident" id="3018032">k</span>&nbsp;<span class="op" id="3018034">&lt;</span>&nbsp;<span class="builtinfunc" id="3018036">len</span><span class="op" id="3018039">(</span><span class="ident" id="3018040">cacheBase10</span><span class="op" id="3018051">.</span><span class="ident" id="3018052">table</span><span class="op" id="3018057">)</span><span class="op" id="3018058">;</span>&nbsp;<span class="ident" id="3018060">words</span>&nbsp;<span class="op" id="3018066">&lt;&lt;=</span>&nbsp;<span class="num" id="3018070">1</span>&nbsp;<span class="op" id="3018072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018076">k</span><span class="op" id="3018077">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3018081">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3018085">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018168">var</span>&nbsp;<span class="ident" id="3018172">table</span>&nbsp;<span class="op" id="3018178">[</span><span class="op" id="3018179">]</span><span class="ident" id="3018180">divisor</span>&nbsp;<span class="comment" id="3018188">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018243">if</span>&nbsp;<span class="ident" id="3018246">b</span>&nbsp;<span class="op" id="3018248">==</span>&nbsp;<span class="num" id="3018251">10</span>&nbsp;<span class="op" id="3018254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018258">cacheBase10</span><span class="op" id="3018269">.</span><span class="ident" id="3018270">Lock</span><span class="op" id="3018274">(</span><span class="op" id="3018275">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018279">table</span>&nbsp;<span class="op" id="3018285">=</span>&nbsp;<span class="ident" id="3018287">cacheBase10</span><span class="op" id="3018298">.</span><span class="ident" id="3018299">table</span><span class="op" id="3018304">[</span><span class="num" id="3018305">0</span><span class="op" id="3018306">:</span><span class="ident" id="3018307">k</span><span class="op" id="3018308">]</span>&nbsp;<span class="comment" id="3018310">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3018350">}</span>&nbsp;<span class="keyword" id="3018352">else</span>&nbsp;<span class="op" id="3018357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018361">table</span>&nbsp;<span class="op" id="3018367">=</span>&nbsp;<span class="builtinfunc" id="3018369">make</span><span class="op" id="3018373">(</span><span class="op" id="3018374">[</span><span class="op" id="3018375">]</span><span class="ident" id="3018376">divisor</span><span class="op" id="3018383">,</span>&nbsp;<span class="ident" id="3018385">k</span><span class="op" id="3018386">)</span>&nbsp;<span class="comment" id="3018388">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3018429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3018433">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018450">if</span>&nbsp;<span class="ident" id="3018453">table</span><span class="op" id="3018458">[</span><span class="ident" id="3018459">k</span><span class="op" id="3018460">-</span><span class="num" id="3018461">1</span><span class="op" id="3018462">]</span><span class="op" id="3018463">.</span><span class="ident" id="3018464">ndigits</span>&nbsp;<span class="op" id="3018472">==</span>&nbsp;<span class="num" id="3018475">0</span>&nbsp;<span class="op" id="3018477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3018481">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018512">var</span>&nbsp;<span class="ident" id="3018516">larger</span>&nbsp;<span class="ident" id="3018523">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018529">for</span>&nbsp;<span class="ident" id="3018533">i</span>&nbsp;<span class="op" id="3018535">:=</span>&nbsp;<span class="num" id="3018538">0</span><span class="op" id="3018539">;</span>&nbsp;<span class="ident" id="3018541">i</span>&nbsp;<span class="op" id="3018543">&lt;</span>&nbsp;<span class="ident" id="3018545">k</span><span class="op" id="3018546">;</span>&nbsp;<span class="ident" id="3018548">i</span><span class="op" id="3018549">++</span>&nbsp;<span class="op" id="3018552">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018557">if</span>&nbsp;<span class="ident" id="3018560">table</span><span class="op" id="3018565">[</span><span class="ident" id="3018566">i</span><span class="op" id="3018567">]</span><span class="op" id="3018568">.</span><span class="ident" id="3018569">ndigits</span>&nbsp;<span class="op" id="3018577">==</span>&nbsp;<span class="num" id="3018580">0</span>&nbsp;<span class="op" id="3018582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018588">if</span>&nbsp;<span class="ident" id="3018591">i</span>&nbsp;<span class="op" id="3018593">==</span>&nbsp;<span class="num" id="3018596">0</span>&nbsp;<span class="op" id="3018598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018605">table</span><span class="op" id="3018610">[</span><span class="num" id="3018611">0</span><span class="op" id="3018612">]</span><span class="op" id="3018613">.</span><span class="ident" id="3018614">bbb</span>&nbsp;<span class="op" id="3018618">=</span>&nbsp;<span class="ident" id="3018620">nat</span><span class="op" id="3018623">(</span><span class="builtintype" id="3018624">nil</span><span class="op" id="3018627">)</span><span class="op" id="3018628">.</span><span class="ident" id="3018629">expWW</span><span class="op" id="3018634">(</span><span class="ident" id="3018635">bb</span><span class="op" id="3018637">,</span>&nbsp;<span class="ident" id="3018639">Word</span><span class="op" id="3018643">(</span><span class="ident" id="3018644">leafSize</span><span class="op" id="3018652">)</span><span class="op" id="3018653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018660">table</span><span class="op" id="3018665">[</span><span class="num" id="3018666">0</span><span class="op" id="3018667">]</span><span class="op" id="3018668">.</span><span class="ident" id="3018669">ndigits</span>&nbsp;<span class="op" id="3018677">=</span>&nbsp;<span class="ident" id="3018679">ndigits</span>&nbsp;<span class="op" id="3018687">*</span>&nbsp;<span class="ident" id="3018689">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3018702">}</span>&nbsp;<span class="keyword" id="3018704">else</span>&nbsp;<span class="op" id="3018709">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018716">table</span><span class="op" id="3018721">[</span><span class="ident" id="3018722">i</span><span class="op" id="3018723">]</span><span class="op" id="3018724">.</span><span class="ident" id="3018725">bbb</span>&nbsp;<span class="op" id="3018729">=</span>&nbsp;<span class="ident" id="3018731">nat</span><span class="op" id="3018734">(</span><span class="builtintype" id="3018735">nil</span><span class="op" id="3018738">)</span><span class="op" id="3018739">.</span><span class="ident" id="3018740">mul</span><span class="op" id="3018743">(</span><span class="ident" id="3018744">table</span><span class="op" id="3018749">[</span><span class="ident" id="3018750">i</span><span class="op" id="3018751">-</span><span class="num" id="3018752">1</span><span class="op" id="3018753">]</span><span class="op" id="3018754">.</span><span class="ident" id="3018755">bbb</span><span class="op" id="3018758">,</span>&nbsp;<span class="ident" id="3018760">table</span><span class="op" id="3018765">[</span><span class="ident" id="3018766">i</span><span class="op" id="3018767">-</span><span class="num" id="3018768">1</span><span class="op" id="3018769">]</span><span class="op" id="3018770">.</span><span class="ident" id="3018771">bbb</span><span class="op" id="3018774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018781">table</span><span class="op" id="3018786">[</span><span class="ident" id="3018787">i</span><span class="op" id="3018788">]</span><span class="op" id="3018789">.</span><span class="ident" id="3018790">ndigits</span>&nbsp;<span class="op" id="3018798">=</span>&nbsp;<span class="num" id="3018800">2</span>&nbsp;<span class="op" id="3018802">*</span>&nbsp;<span class="ident" id="3018804">table</span><span class="op" id="3018809">[</span><span class="ident" id="3018810">i</span><span class="op" id="3018811">-</span><span class="num" id="3018812">1</span><span class="op" id="3018813">]</span><span class="op" id="3018814">.</span><span class="ident" id="3018815">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3018827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3018834">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018901">larger</span>&nbsp;<span class="op" id="3018908">=</span>&nbsp;<span class="ident" id="3018910">nat</span><span class="op" id="3018913">(</span><span class="builtintype" id="3018914">nil</span><span class="op" id="3018917">)</span><span class="op" id="3018918">.</span><span class="ident" id="3018919">set</span><span class="op" id="3018922">(</span><span class="ident" id="3018923">table</span><span class="op" id="3018928">[</span><span class="ident" id="3018929">i</span><span class="op" id="3018930">]</span><span class="op" id="3018931">.</span><span class="ident" id="3018932">bbb</span><span class="op" id="3018935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3018941">for</span>&nbsp;<span class="ident" id="3018945">mulAddVWW</span><span class="op" id="3018954">(</span><span class="ident" id="3018955">larger</span><span class="op" id="3018961">,</span>&nbsp;<span class="ident" id="3018963">larger</span><span class="op" id="3018969">,</span>&nbsp;<span class="ident" id="3018971">b</span><span class="op" id="3018972">,</span>&nbsp;<span class="num" id="3018974">0</span><span class="op" id="3018975">)</span>&nbsp;<span class="op" id="3018977">==</span>&nbsp;<span class="num" id="3018980">0</span>&nbsp;<span class="op" id="3018982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3018989">table</span><span class="op" id="3018994">[</span><span class="ident" id="3018995">i</span><span class="op" id="3018996">]</span><span class="op" id="3018997">.</span><span class="ident" id="3018998">bbb</span>&nbsp;<span class="op" id="3019002">=</span>&nbsp;<span class="ident" id="3019004">table</span><span class="op" id="3019009">[</span><span class="ident" id="3019010">i</span><span class="op" id="3019011">]</span><span class="op" id="3019012">.</span><span class="ident" id="3019013">bbb</span><span class="op" id="3019016">.</span><span class="ident" id="3019017">set</span><span class="op" id="3019020">(</span><span class="ident" id="3019021">larger</span><span class="op" id="3019027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3019034">table</span><span class="op" id="3019039">[</span><span class="ident" id="3019040">i</span><span class="op" id="3019041">]</span><span class="op" id="3019042">.</span><span class="ident" id="3019043">ndigits</span><span class="op" id="3019050">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3019057">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3019064">table</span><span class="op" id="3019069">[</span><span class="ident" id="3019070">i</span><span class="op" id="3019071">]</span><span class="op" id="3019072">.</span><span class="ident" id="3019073">nbits</span>&nbsp;<span class="op" id="3019079">=</span>&nbsp;<span class="ident" id="3019081">table</span><span class="op" id="3019086">[</span><span class="ident" id="3019087">i</span><span class="op" id="3019088">]</span><span class="op" id="3019089">.</span><span class="ident" id="3019090">bbb</span><span class="op" id="3019093">.</span><span class="ident" id="3019094">bitLen</span><span class="op" id="3019100">(</span><span class="op" id="3019101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3019106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3019110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3019113">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3019117">if</span>&nbsp;<span class="ident" id="3019120">b</span>&nbsp;<span class="op" id="3019122">==</span>&nbsp;<span class="num" id="3019125">10</span>&nbsp;<span class="op" id="3019128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3019132">cacheBase10</span><span class="op" id="3019143">.</span><span class="ident" id="3019144">Unlock</span><span class="op" id="3019150">(</span><span class="op" id="3019151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3019154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3019158">return</span>&nbsp;<span class="ident" id="3019165">table</span><br>
<span class="lineno"></span><span class="op" id="3019171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3019174">const</span>&nbsp;<span class="ident" id="3019180">deBruijn32</span>&nbsp;<span class="op" id="3019191">=</span>&nbsp;<span class="num" id="3019193">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3019205">var</span>&nbsp;<span class="ident" id="3019209">deBruijn32Lookup</span>&nbsp;<span class="op" id="3019226">=</span>&nbsp;<span class="op" id="3019228">[</span><span class="op" id="3019229">]</span><span class="builtintype" id="3019230">byte</span><span class="op" id="3019234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3019237">0</span><span class="op" id="3019238">,</span>&nbsp;<span class="num" id="3019240">1</span><span class="op" id="3019241">,</span>&nbsp;<span class="num" id="3019243">28</span><span class="op" id="3019245">,</span>&nbsp;<span class="num" id="3019247">2</span><span class="op" id="3019248">,</span>&nbsp;<span class="num" id="3019250">29</span><span class="op" id="3019252">,</span>&nbsp;<span class="num" id="3019254">14</span><span class="op" id="3019256">,</span>&nbsp;<span class="num" id="3019258">24</span><span class="op" id="3019260">,</span>&nbsp;<span class="num" id="3019262">3</span><span class="op" id="3019263">,</span>&nbsp;<span class="num" id="3019265">30</span><span class="op" id="3019267">,</span>&nbsp;<span class="num" id="3019269">22</span><span class="op" id="3019271">,</span>&nbsp;<span class="num" id="3019273">20</span><span class="op" id="3019275">,</span>&nbsp;<span class="num" id="3019277">15</span><span class="op" id="3019279">,</span>&nbsp;<span class="num" id="3019281">25</span><span class="op" id="3019283">,</span>&nbsp;<span class="num" id="3019285">17</span><span class="op" id="3019287">,</span>&nbsp;<span class="num" id="3019289">4</span><span class="op" id="3019290">,</span>&nbsp;<span class="num" id="3019292">8</span><span class="op" id="3019293">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3019296">31</span><span class="op" id="3019298">,</span>&nbsp;<span class="num" id="3019300">27</span><span class="op" id="3019302">,</span>&nbsp;<span class="num" id="3019304">13</span><span class="op" id="3019306">,</span>&nbsp;<span class="num" id="3019308">23</span><span class="op" id="3019310">,</span>&nbsp;<span class="num" id="3019312">21</span><span class="op" id="3019314">,</span>&nbsp;<span class="num" id="3019316">19</span><span class="op" id="3019318">,</span>&nbsp;<span class="num" id="3019320">16</span><span class="op" id="3019322">,</span>&nbsp;<span class="num" id="3019324">7</span><span class="op" id="3019325">,</span>&nbsp;<span class="num" id="3019327">26</span><span class="op" id="3019329">,</span>&nbsp;<span class="num" id="3019331">12</span><span class="op" id="3019333">,</span>&nbsp;<span class="num" id="3019335">18</span><span class="op" id="3019337">,</span>&nbsp;<span class="num" id="3019339">6</span><span class="op" id="3019340">,</span>&nbsp;<span class="num" id="3019342">11</span><span class="op" id="3019344">,</span>&nbsp;<span class="num" id="3019346">5</span><span class="op" id="3019347">,</span>&nbsp;<span class="num" id="3019349">10</span><span class="op" id="3019351">,</span>&nbsp;<span class="num" id="3019353">9</span><span class="op" id="3019354">,</span><br>
<span class="lineno"></span><span class="op" id="3019356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3019359">const</span>&nbsp;<span class="ident" id="3019365">deBruijn64</span>&nbsp;<span class="op" id="3019376">=</span>&nbsp;<span class="num" id="3019378">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3019398">var</span>&nbsp;<span class="ident" id="3019402">deBruijn64Lookup</span>&nbsp;<span class="op" id="3019419">=</span>&nbsp;<span class="op" id="3019421">[</span><span class="op" id="3019422">]</span><span class="builtintype" id="3019423">byte</span><span class="op" id="3019427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3019430">0</span><span class="op" id="3019431">,</span>&nbsp;<span class="num" id="3019433">1</span><span class="op" id="3019434">,</span>&nbsp;<span class="num" id="3019436">56</span><span class="op" id="3019438">,</span>&nbsp;<span class="num" id="3019440">2</span><span class="op" id="3019441">,</span>&nbsp;<span class="num" id="3019443">57</span><span class="op" id="3019445">,</span>&nbsp;<span class="num" id="3019447">49</span><span class="op" id="3019449">,</span>&nbsp;<span class="num" id="3019451">28</span><span class="op" id="3019453">,</span>&nbsp;<span class="num" id="3019455">3</span><span class="op" id="3019456">,</span>&nbsp;<span class="num" id="3019458">61</span><span class="op" id="3019460">,</span>&nbsp;<span class="num" id="3019462">58</span><span class="op" id="3019464">,</span>&nbsp;<span class="num" id="3019466">42</span><span class="op" id="3019468">,</span>&nbsp;<span class="num" id="3019470">50</span><span class="op" id="3019472">,</span>&nbsp;<span class="num" id="3019474">38</span><span class="op" id="3019476">,</span>&nbsp;<span class="num" id="3019478">29</span><span class="op" id="3019480">,</span>&nbsp;<span class="num" id="3019482">17</span><span class="op" id="3019484">,</span>&nbsp;<span class="num" id="3019486">4</span><span class="op" id="3019487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3019490">62</span><span class="op" id="3019492">,</span>&nbsp;<span class="num" id="3019494">47</span><span class="op" id="3019496">,</span>&nbsp;<span class="num" id="3019498">59</span><span class="op" id="3019500">,</span>&nbsp;<span class="num" id="3019502">36</span><span class="op" id="3019504">,</span>&nbsp;<span class="num" id="3019506">45</span><span class="op" id="3019508">,</span>&nbsp;<span class="num" id="3019510">43</span><span class="op" id="3019512">,</span>&nbsp;<span class="num" id="3019514">51</span><span class="op" id="3019516">,</span>&nbsp;<span class="num" id="3019518">22</span><span class="op" id="3019520">,</span>&nbsp;<span class="num" id="3019522">53</span><span class="op" id="3019524">,</span>&nbsp;<span class="num" id="3019526">39</span><span class="op" id="3019528">,</span>&nbsp;<span class="num" id="3019530">33</span><span class="op" id="3019532">,</span>&nbsp;<span class="num" id="3019534">30</span><span class="op" id="3019536">,</span>&nbsp;<span class="num" id="3019538">24</span><span class="op" id="3019540">,</span>&nbsp;<span class="num" id="3019542">18</span><span class="op" id="3019544">,</span>&nbsp;<span class="num" id="3019546">12</span><span class="op" id="3019548">,</span>&nbsp;<span class="num" id="3019550">5</span><span class="op" id="3019551">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3019554">63</span><span class="op" id="3019556">,</span>&nbsp;<span class="num" id="3019558">55</span><span class="op" id="3019560">,</span>&nbsp;<span class="num" id="3019562">48</span><span class="op" id="3019564">,</span>&nbsp;<span class="num" id="3019566">27</span><span class="op" id="3019568">,</span>&nbsp;<span class="num" id="3019570">60</span><span class="op" id="3019572">,</span>&nbsp;<span class="num" id="3019574">41</span><span class="op" id="3019576">,</span>&nbsp;<span class="num" id="3019578">37</span><span class="op" id="3019580">,</span>&nbsp;<span class="num" id="3019582">16</span><span class="op" id="3019584">,</span>&nbsp;<span class="num" id="3019586">46</span><span class="op" id="3019588">,</span>&nbsp;<span class="num" id="3019590">35</span><span class="op" id="3019592">,</span>&nbsp;<span class="num" id="3019594">44</span><span class="op" id="3019596">,</span>&nbsp;<span class="num" id="3019598">21</span><span class="op" id="3019600">,</span>&nbsp;<span class="num" id="3019602">52</span><span class="op" id="3019604">,</span>&nbsp;<span class="num" id="3019606">32</span><span class="op" id="3019608">,</span>&nbsp;<span class="num" id="3019610">23</span><span class="op" id="3019612">,</span>&nbsp;<span class="num" id="3019614">11</span><span class="op" id="3019616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="3019619">54</span><span class="op" id="3019621">,</span>&nbsp;<span class="num" id="3019623">26</span><span class="op" id="3019625">,</span>&nbsp;<span class="num" id="3019627">40</span><span class="op" id="3019629">,</span>&nbsp;<span class="num" id="3019631">15</span><span class="op" id="3019633">,</span>&nbsp;<span class="num" id="3019635">34</span><span class="op" id="3019637">,</span>&nbsp;<span class="num" id="3019639">20</span><span class="op" id="3019641">,</span>&nbsp;<span class="num" id="3019643">31</span><span class="op" id="3019645">,</span>&nbsp;<span class="num" id="3019647">10</span><span class="op" id="3019649">,</span>&nbsp;<span class="num" id="3019651">25</span><span class="op" id="3019653">,</span>&nbsp;<span class="num" id="3019655">14</span><span class="op" id="3019657">,</span>&nbsp;<span class="num" id="3019659">19</span><span class="op" id="3019661">,</span>&nbsp;<span class="num" id="3019663">9</span><span class="op" id="3019664">,</span>&nbsp;<span class="num" id="3019666">13</span><span class="op" id="3019668">,</span>&nbsp;<span class="num" id="3019670">8</span><span class="op" id="3019671">,</span>&nbsp;<span class="num" id="3019673">7</span><span class="op" id="3019674">,</span>&nbsp;<span class="num" id="3019676">6</span><span class="op" id="3019677">,</span><br>
<span class="lineno"></span><span class="op" id="3019679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3019682">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3019759">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3019773">func</span>&nbsp;<span class="ident" id="3019778">trailingZeroBits</span><span class="op" id="3019794">(</span><span class="ident" id="3019795">x</span>&nbsp;<span class="ident" id="3019797">Word</span><span class="op" id="3019801">)</span>&nbsp;<span class="builtintype" id="3019803">uint</span>&nbsp;<span class="op" id="3019808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3019811">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3019883">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3019955">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020025">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020095">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020159">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020232">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020301">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020348">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020385">switch</span>&nbsp;<span class="ident" id="3020392">_W</span>&nbsp;<span class="op" id="3020395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020398">case</span>&nbsp;<span class="num" id="3020403">32</span><span class="op" id="3020405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020409">return</span>&nbsp;<span class="builtintype" id="3020416">uint</span><span class="op" id="3020420">(</span><span class="ident" id="3020421">deBruijn32Lookup</span><span class="op" id="3020437">[</span><span class="op" id="3020438">(</span><span class="op" id="3020439">(</span><span class="ident" id="3020440">x</span><span class="op" id="3020441">&amp;</span><span class="op" id="3020442">-</span><span class="ident" id="3020443">x</span><span class="op" id="3020444">)</span><span class="op" id="3020445">*</span><span class="ident" id="3020446">deBruijn32</span><span class="op" id="3020456">)</span><span class="op" id="3020457">&gt;&gt;</span><span class="num" id="3020459">27</span><span class="op" id="3020461">]</span><span class="op" id="3020462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020465">case</span>&nbsp;<span class="num" id="3020470">64</span><span class="op" id="3020472">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020476">return</span>&nbsp;<span class="builtintype" id="3020483">uint</span><span class="op" id="3020487">(</span><span class="ident" id="3020488">deBruijn64Lookup</span><span class="op" id="3020504">[</span><span class="op" id="3020505">(</span><span class="op" id="3020506">(</span><span class="ident" id="3020507">x</span><span class="op" id="3020508">&amp;</span><span class="op" id="3020509">-</span><span class="ident" id="3020510">x</span><span class="op" id="3020511">)</span><span class="op" id="3020512">*</span><span class="op" id="3020513">(</span><span class="ident" id="3020514">deBruijn64</span><span class="op" id="3020524">&amp;</span><span class="ident" id="3020525">_M</span><span class="op" id="3020527">)</span><span class="op" id="3020528">)</span><span class="op" id="3020529">&gt;&gt;</span><span class="num" id="3020531">58</span><span class="op" id="3020533">]</span><span class="op" id="3020534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020537">default</span><span class="op" id="3020544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3020548">panic</span><span class="op" id="3020553">(</span><span class="string" id="3020554">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3020573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020576">}</span><br>
<span class="lineno"></span><span class="op" id="3020578">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3020581">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3020658">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3020672">func</span>&nbsp;<span class="op" id="3020677">(</span><span class="ident" id="3020678">x</span>&nbsp;<span class="ident" id="3020680">nat</span><span class="op" id="3020683">)</span>&nbsp;<span class="ident" id="3020685">trailingZeroBits</span><span class="op" id="3020701">(</span><span class="op" id="3020702">)</span>&nbsp;<span class="builtintype" id="3020704">uint</span>&nbsp;<span class="op" id="3020709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020712">if</span>&nbsp;<span class="builtinfunc" id="3020715">len</span><span class="op" id="3020718">(</span><span class="ident" id="3020719">x</span><span class="op" id="3020720">)</span>&nbsp;<span class="op" id="3020722">==</span>&nbsp;<span class="num" id="3020725">0</span>&nbsp;<span class="op" id="3020727">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020731">return</span>&nbsp;<span class="num" id="3020738">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020744">var</span>&nbsp;<span class="ident" id="3020748">i</span>&nbsp;<span class="builtintype" id="3020750">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020756">for</span>&nbsp;<span class="ident" id="3020760">x</span><span class="op" id="3020761">[</span><span class="ident" id="3020762">i</span><span class="op" id="3020763">]</span>&nbsp;<span class="op" id="3020765">==</span>&nbsp;<span class="num" id="3020768">0</span>&nbsp;<span class="op" id="3020770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3020774">i</span><span class="op" id="3020775">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020782">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020796">return</span>&nbsp;<span class="ident" id="3020803">i</span><span class="op" id="3020804">*</span><span class="ident" id="3020805">_W</span>&nbsp;<span class="op" id="3020808">+</span>&nbsp;<span class="ident" id="3020810">trailingZeroBits</span><span class="op" id="3020826">(</span><span class="ident" id="3020827">x</span><span class="op" id="3020828">[</span><span class="ident" id="3020829">i</span><span class="op" id="3020830">]</span><span class="op" id="3020831">)</span><br>
<span class="lineno"></span><span class="op" id="3020833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3020836">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3020850">func</span>&nbsp;<span class="op" id="3020855">(</span><span class="ident" id="3020856">z</span>&nbsp;<span class="ident" id="3020858">nat</span><span class="op" id="3020861">)</span>&nbsp;<span class="ident" id="3020863">shl</span><span class="op" id="3020866">(</span><span class="ident" id="3020867">x</span>&nbsp;<span class="ident" id="3020869">nat</span><span class="op" id="3020872">,</span>&nbsp;<span class="ident" id="3020874">s</span>&nbsp;<span class="builtintype" id="3020876">uint</span><span class="op" id="3020880">)</span>&nbsp;<span class="ident" id="3020882">nat</span>&nbsp;<span class="op" id="3020886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3020889">m</span>&nbsp;<span class="op" id="3020891">:=</span>&nbsp;<span class="builtinfunc" id="3020894">len</span><span class="op" id="3020897">(</span><span class="ident" id="3020898">x</span><span class="op" id="3020899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020902">if</span>&nbsp;<span class="ident" id="3020905">m</span>&nbsp;<span class="op" id="3020907">==</span>&nbsp;<span class="num" id="3020910">0</span>&nbsp;<span class="op" id="3020912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3020916">return</span>&nbsp;<span class="ident" id="3020923">z</span><span class="op" id="3020924">.</span><span class="builtinfunc" id="3020925">make</span><span class="op" id="3020929">(</span><span class="num" id="3020930">0</span><span class="op" id="3020931">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3020937">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3020948">n</span>&nbsp;<span class="op" id="3020950">:=</span>&nbsp;<span class="ident" id="3020953">m</span>&nbsp;<span class="op" id="3020955">+</span>&nbsp;<span class="builtintype" id="3020957">int</span><span class="op" id="3020960">(</span><span class="ident" id="3020961">s</span><span class="op" id="3020962">/</span><span class="ident" id="3020963">_W</span><span class="op" id="3020965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3020968">z</span>&nbsp;<span class="op" id="3020970">=</span>&nbsp;<span class="ident" id="3020972">z</span><span class="op" id="3020973">.</span><span class="builtinfunc" id="3020974">make</span><span class="op" id="3020978">(</span><span class="ident" id="3020979">n</span>&nbsp;<span class="op" id="3020981">+</span>&nbsp;<span class="num" id="3020983">1</span><span class="op" id="3020984">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3020987">z</span><span class="op" id="3020988">[</span><span class="ident" id="3020989">n</span><span class="op" id="3020990">]</span>&nbsp;<span class="op" id="3020992">=</span>&nbsp;<span class="ident" id="3020994">shlVU</span><span class="op" id="3020999">(</span><span class="ident" id="3021000">z</span><span class="op" id="3021001">[</span><span class="ident" id="3021002">n</span><span class="op" id="3021003">-</span><span class="ident" id="3021004">m</span><span class="op" id="3021005">:</span><span class="ident" id="3021006">n</span><span class="op" id="3021007">]</span><span class="op" id="3021008">,</span>&nbsp;<span class="ident" id="3021010">x</span><span class="op" id="3021011">,</span>&nbsp;<span class="ident" id="3021013">s</span><span class="op" id="3021014">%</span><span class="ident" id="3021015">_W</span><span class="op" id="3021017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021020">z</span><span class="op" id="3021021">[</span><span class="num" id="3021022">0</span>&nbsp;<span class="op" id="3021024">:</span>&nbsp;<span class="ident" id="3021026">n</span><span class="op" id="3021027">-</span><span class="ident" id="3021028">m</span><span class="op" id="3021029">]</span><span class="op" id="3021030">.</span><span class="ident" id="3021031">clear</span><span class="op" id="3021036">(</span><span class="op" id="3021037">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021041">return</span>&nbsp;<span class="ident" id="3021048">z</span><span class="op" id="3021049">.</span><span class="ident" id="3021050">norm</span><span class="op" id="3021054">(</span><span class="op" id="3021055">)</span><br>
<span class="lineno"></span><span class="op" id="3021057">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3021060">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3021074">func</span>&nbsp;<span class="op" id="3021079">(</span><span class="ident" id="3021080">z</span>&nbsp;<span class="ident" id="3021082">nat</span><span class="op" id="3021085">)</span>&nbsp;<span class="ident" id="3021087">shr</span><span class="op" id="3021090">(</span><span class="ident" id="3021091">x</span>&nbsp;<span class="ident" id="3021093">nat</span><span class="op" id="3021096">,</span>&nbsp;<span class="ident" id="3021098">s</span>&nbsp;<span class="builtintype" id="3021100">uint</span><span class="op" id="3021104">)</span>&nbsp;<span class="ident" id="3021106">nat</span>&nbsp;<span class="op" id="3021110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021113">m</span>&nbsp;<span class="op" id="3021115">:=</span>&nbsp;<span class="builtinfunc" id="3021118">len</span><span class="op" id="3021121">(</span><span class="ident" id="3021122">x</span><span class="op" id="3021123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021126">n</span>&nbsp;<span class="op" id="3021128">:=</span>&nbsp;<span class="ident" id="3021131">m</span>&nbsp;<span class="op" id="3021133">-</span>&nbsp;<span class="builtintype" id="3021135">int</span><span class="op" id="3021138">(</span><span class="ident" id="3021139">s</span><span class="op" id="3021140">/</span><span class="ident" id="3021141">_W</span><span class="op" id="3021143">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021146">if</span>&nbsp;<span class="ident" id="3021149">n</span>&nbsp;<span class="op" id="3021151">&lt;=</span>&nbsp;<span class="num" id="3021154">0</span>&nbsp;<span class="op" id="3021156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021160">return</span>&nbsp;<span class="ident" id="3021167">z</span><span class="op" id="3021168">.</span><span class="builtinfunc" id="3021169">make</span><span class="op" id="3021173">(</span><span class="num" id="3021174">0</span><span class="op" id="3021175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3021181">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021192">z</span>&nbsp;<span class="op" id="3021194">=</span>&nbsp;<span class="ident" id="3021196">z</span><span class="op" id="3021197">.</span><span class="builtinfunc" id="3021198">make</span><span class="op" id="3021202">(</span><span class="ident" id="3021203">n</span><span class="op" id="3021204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021207">shrVU</span><span class="op" id="3021212">(</span><span class="ident" id="3021213">z</span><span class="op" id="3021214">,</span>&nbsp;<span class="ident" id="3021216">x</span><span class="op" id="3021217">[</span><span class="ident" id="3021218">m</span><span class="op" id="3021219">-</span><span class="ident" id="3021220">n</span><span class="op" id="3021221">:</span><span class="op" id="3021222">]</span><span class="op" id="3021223">,</span>&nbsp;<span class="ident" id="3021225">s</span><span class="op" id="3021226">%</span><span class="ident" id="3021227">_W</span><span class="op" id="3021229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021233">return</span>&nbsp;<span class="ident" id="3021240">z</span><span class="op" id="3021241">.</span><span class="ident" id="3021242">norm</span><span class="op" id="3021246">(</span><span class="op" id="3021247">)</span><br>
<span class="lineno"></span><span class="op" id="3021249">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3021252">func</span>&nbsp;<span class="op" id="3021257">(</span><span class="ident" id="3021258">z</span>&nbsp;<span class="ident" id="3021260">nat</span><span class="op" id="3021263">)</span>&nbsp;<span class="ident" id="3021265">setBit</span><span class="op" id="3021271">(</span><span class="ident" id="3021272">x</span>&nbsp;<span class="ident" id="3021274">nat</span><span class="op" id="3021277">,</span>&nbsp;<span class="ident" id="3021279">i</span>&nbsp;<span class="builtintype" id="3021281">uint</span><span class="op" id="3021285">,</span>&nbsp;<span class="ident" id="3021287">b</span>&nbsp;<span class="builtintype" id="3021289">uint</span><span class="op" id="3021293">)</span>&nbsp;<span class="ident" id="3021295">nat</span>&nbsp;<span class="op" id="3021299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021302">j</span>&nbsp;<span class="op" id="3021304">:=</span>&nbsp;<span class="builtintype" id="3021307">int</span><span class="op" id="3021310">(</span><span class="ident" id="3021311">i</span>&nbsp;<span class="op" id="3021313">/</span>&nbsp;<span class="ident" id="3021315">_W</span><span class="op" id="3021317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021320">m</span>&nbsp;<span class="op" id="3021322">:=</span>&nbsp;<span class="ident" id="3021325">Word</span><span class="op" id="3021329">(</span><span class="num" id="3021330">1</span><span class="op" id="3021331">)</span>&nbsp;<span class="op" id="3021333">&lt;&lt;</span>&nbsp;<span class="op" id="3021336">(</span><span class="ident" id="3021337">i</span>&nbsp;<span class="op" id="3021339">%</span>&nbsp;<span class="ident" id="3021341">_W</span><span class="op" id="3021343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021346">n</span>&nbsp;<span class="op" id="3021348">:=</span>&nbsp;<span class="builtinfunc" id="3021351">len</span><span class="op" id="3021354">(</span><span class="ident" id="3021355">x</span><span class="op" id="3021356">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021359">switch</span>&nbsp;<span class="ident" id="3021366">b</span>&nbsp;<span class="op" id="3021368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021371">case</span>&nbsp;<span class="num" id="3021376">0</span><span class="op" id="3021377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021381">z</span>&nbsp;<span class="op" id="3021383">=</span>&nbsp;<span class="ident" id="3021385">z</span><span class="op" id="3021386">.</span><span class="builtinfunc" id="3021387">make</span><span class="op" id="3021391">(</span><span class="ident" id="3021392">n</span><span class="op" id="3021393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3021397">copy</span><span class="op" id="3021401">(</span><span class="ident" id="3021402">z</span><span class="op" id="3021403">,</span>&nbsp;<span class="ident" id="3021405">x</span><span class="op" id="3021406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021410">if</span>&nbsp;<span class="ident" id="3021413">j</span>&nbsp;<span class="op" id="3021415">&gt;=</span>&nbsp;<span class="ident" id="3021418">n</span>&nbsp;<span class="op" id="3021420">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3021425">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021447">return</span>&nbsp;<span class="ident" id="3021454">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021462">z</span><span class="op" id="3021463">[</span><span class="ident" id="3021464">j</span><span class="op" id="3021465">]</span>&nbsp;<span class="op" id="3021467">&amp;^=</span>&nbsp;<span class="ident" id="3021471">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021475">return</span>&nbsp;<span class="ident" id="3021482">z</span><span class="op" id="3021483">.</span><span class="ident" id="3021484">norm</span><span class="op" id="3021488">(</span><span class="op" id="3021489">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021492">case</span>&nbsp;<span class="num" id="3021497">1</span><span class="op" id="3021498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021502">if</span>&nbsp;<span class="ident" id="3021505">j</span>&nbsp;<span class="op" id="3021507">&gt;=</span>&nbsp;<span class="ident" id="3021510">n</span>&nbsp;<span class="op" id="3021512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021517">z</span>&nbsp;<span class="op" id="3021519">=</span>&nbsp;<span class="ident" id="3021521">z</span><span class="op" id="3021522">.</span><span class="builtinfunc" id="3021523">make</span><span class="op" id="3021527">(</span><span class="ident" id="3021528">j</span>&nbsp;<span class="op" id="3021530">+</span>&nbsp;<span class="num" id="3021532">1</span><span class="op" id="3021533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021538">z</span><span class="op" id="3021539">[</span><span class="ident" id="3021540">n</span><span class="op" id="3021541">:</span><span class="op" id="3021542">]</span><span class="op" id="3021543">.</span><span class="ident" id="3021544">clear</span><span class="op" id="3021549">(</span><span class="op" id="3021550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021554">}</span>&nbsp;<span class="keyword" id="3021556">else</span>&nbsp;<span class="op" id="3021561">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021566">z</span>&nbsp;<span class="op" id="3021568">=</span>&nbsp;<span class="ident" id="3021570">z</span><span class="op" id="3021571">.</span><span class="builtinfunc" id="3021572">make</span><span class="op" id="3021576">(</span><span class="ident" id="3021577">n</span><span class="op" id="3021578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3021586">copy</span><span class="op" id="3021590">(</span><span class="ident" id="3021591">z</span><span class="op" id="3021592">,</span>&nbsp;<span class="ident" id="3021594">x</span><span class="op" id="3021595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021599">z</span><span class="op" id="3021600">[</span><span class="ident" id="3021601">j</span><span class="op" id="3021602">]</span>&nbsp;<span class="op" id="3021604">|=</span>&nbsp;<span class="ident" id="3021607">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3021611">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021637">return</span>&nbsp;<span class="ident" id="3021644">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3021650">panic</span><span class="op" id="3021655">(</span><span class="string" id="3021656">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3021679">)</span><br>
<span class="lineno"></span><span class="op" id="3021681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3021684">func</span>&nbsp;<span class="op" id="3021689">(</span><span class="ident" id="3021690">z</span>&nbsp;<span class="ident" id="3021692">nat</span><span class="op" id="3021695">)</span>&nbsp;<span class="ident" id="3021697">bit</span><span class="op" id="3021700">(</span><span class="ident" id="3021701">i</span>&nbsp;<span class="builtintype" id="3021703">uint</span><span class="op" id="3021707">)</span>&nbsp;<span class="builtintype" id="3021709">uint</span>&nbsp;<span class="op" id="3021714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021717">j</span>&nbsp;<span class="op" id="3021719">:=</span>&nbsp;<span class="builtintype" id="3021722">int</span><span class="op" id="3021725">(</span><span class="ident" id="3021726">i</span>&nbsp;<span class="op" id="3021728">/</span>&nbsp;<span class="ident" id="3021730">_W</span><span class="op" id="3021732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021735">if</span>&nbsp;<span class="ident" id="3021738">j</span>&nbsp;<span class="op" id="3021740">&gt;=</span>&nbsp;<span class="builtinfunc" id="3021743">len</span><span class="op" id="3021746">(</span><span class="ident" id="3021747">z</span><span class="op" id="3021748">)</span>&nbsp;<span class="op" id="3021750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021754">return</span>&nbsp;<span class="num" id="3021761">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021764">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021767">return</span>&nbsp;<span class="builtintype" id="3021774">uint</span><span class="op" id="3021778">(</span><span class="ident" id="3021779">z</span><span class="op" id="3021780">[</span><span class="ident" id="3021781">j</span><span class="op" id="3021782">]</span>&nbsp;<span class="op" id="3021784">&gt;&gt;</span>&nbsp;<span class="op" id="3021787">(</span><span class="ident" id="3021788">i</span>&nbsp;<span class="op" id="3021790">%</span>&nbsp;<span class="ident" id="3021792">_W</span><span class="op" id="3021794">)</span>&nbsp;<span class="op" id="3021796">&amp;</span>&nbsp;<span class="num" id="3021798">1</span><span class="op" id="3021799">)</span><br>
<span class="lineno"></span><span class="op" id="3021801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3021804">func</span>&nbsp;<span class="op" id="3021809">(</span><span class="ident" id="3021810">z</span>&nbsp;<span class="ident" id="3021812">nat</span><span class="op" id="3021815">)</span>&nbsp;<span class="ident" id="3021817">and</span><span class="op" id="3021820">(</span><span class="ident" id="3021821">x</span><span class="op" id="3021822">,</span>&nbsp;<span class="ident" id="3021824">y</span>&nbsp;<span class="ident" id="3021826">nat</span><span class="op" id="3021829">)</span>&nbsp;<span class="ident" id="3021831">nat</span>&nbsp;<span class="op" id="3021835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021838">m</span>&nbsp;<span class="op" id="3021840">:=</span>&nbsp;<span class="builtinfunc" id="3021843">len</span><span class="op" id="3021846">(</span><span class="ident" id="3021847">x</span><span class="op" id="3021848">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021851">n</span>&nbsp;<span class="op" id="3021853">:=</span>&nbsp;<span class="builtinfunc" id="3021856">len</span><span class="op" id="3021859">(</span><span class="ident" id="3021860">y</span><span class="op" id="3021861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021864">if</span>&nbsp;<span class="ident" id="3021867">m</span>&nbsp;<span class="op" id="3021869">&gt;</span>&nbsp;<span class="ident" id="3021871">n</span>&nbsp;<span class="op" id="3021873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021877">m</span>&nbsp;<span class="op" id="3021879">=</span>&nbsp;<span class="ident" id="3021881">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3021887">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021899">z</span>&nbsp;<span class="op" id="3021901">=</span>&nbsp;<span class="ident" id="3021903">z</span><span class="op" id="3021904">.</span><span class="builtinfunc" id="3021905">make</span><span class="op" id="3021909">(</span><span class="ident" id="3021910">m</span><span class="op" id="3021911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021914">for</span>&nbsp;<span class="ident" id="3021918">i</span>&nbsp;<span class="op" id="3021920">:=</span>&nbsp;<span class="num" id="3021923">0</span><span class="op" id="3021924">;</span>&nbsp;<span class="ident" id="3021926">i</span>&nbsp;<span class="op" id="3021928">&lt;</span>&nbsp;<span class="ident" id="3021930">m</span><span class="op" id="3021931">;</span>&nbsp;<span class="ident" id="3021933">i</span><span class="op" id="3021934">++</span>&nbsp;<span class="op" id="3021937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3021941">z</span><span class="op" id="3021942">[</span><span class="ident" id="3021943">i</span><span class="op" id="3021944">]</span>&nbsp;<span class="op" id="3021946">=</span>&nbsp;<span class="ident" id="3021948">x</span><span class="op" id="3021949">[</span><span class="ident" id="3021950">i</span><span class="op" id="3021951">]</span>&nbsp;<span class="op" id="3021953">&amp;</span>&nbsp;<span class="ident" id="3021955">y</span><span class="op" id="3021956">[</span><span class="ident" id="3021957">i</span><span class="op" id="3021958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3021961">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3021965">return</span>&nbsp;<span class="ident" id="3021972">z</span><span class="op" id="3021973">.</span><span class="ident" id="3021974">norm</span><span class="op" id="3021978">(</span><span class="op" id="3021979">)</span><br>
<span class="lineno"></span><span class="op" id="3021981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3021984">func</span>&nbsp;<span class="op" id="3021989">(</span><span class="ident" id="3021990">z</span>&nbsp;<span class="ident" id="3021992">nat</span><span class="op" id="3021995">)</span>&nbsp;<span class="ident" id="3021997">andNot</span><span class="op" id="3022003">(</span><span class="ident" id="3022004">x</span><span class="op" id="3022005">,</span>&nbsp;<span class="ident" id="3022007">y</span>&nbsp;<span class="ident" id="3022009">nat</span><span class="op" id="3022012">)</span>&nbsp;<span class="ident" id="3022014">nat</span>&nbsp;<span class="op" id="3022018">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022021">m</span>&nbsp;<span class="op" id="3022023">:=</span>&nbsp;<span class="builtinfunc" id="3022026">len</span><span class="op" id="3022029">(</span><span class="ident" id="3022030">x</span><span class="op" id="3022031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022034">n</span>&nbsp;<span class="op" id="3022036">:=</span>&nbsp;<span class="builtinfunc" id="3022039">len</span><span class="op" id="3022042">(</span><span class="ident" id="3022043">y</span><span class="op" id="3022044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022047">if</span>&nbsp;<span class="ident" id="3022050">n</span>&nbsp;<span class="op" id="3022052">&gt;</span>&nbsp;<span class="ident" id="3022054">m</span>&nbsp;<span class="op" id="3022056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022060">n</span>&nbsp;<span class="op" id="3022062">=</span>&nbsp;<span class="ident" id="3022064">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3022067">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3022070">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022082">z</span>&nbsp;<span class="op" id="3022084">=</span>&nbsp;<span class="ident" id="3022086">z</span><span class="op" id="3022087">.</span><span class="builtinfunc" id="3022088">make</span><span class="op" id="3022092">(</span><span class="ident" id="3022093">m</span><span class="op" id="3022094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022097">for</span>&nbsp;<span class="ident" id="3022101">i</span>&nbsp;<span class="op" id="3022103">:=</span>&nbsp;<span class="num" id="3022106">0</span><span class="op" id="3022107">;</span>&nbsp;<span class="ident" id="3022109">i</span>&nbsp;<span class="op" id="3022111">&lt;</span>&nbsp;<span class="ident" id="3022113">n</span><span class="op" id="3022114">;</span>&nbsp;<span class="ident" id="3022116">i</span><span class="op" id="3022117">++</span>&nbsp;<span class="op" id="3022120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022124">z</span><span class="op" id="3022125">[</span><span class="ident" id="3022126">i</span><span class="op" id="3022127">]</span>&nbsp;<span class="op" id="3022129">=</span>&nbsp;<span class="ident" id="3022131">x</span><span class="op" id="3022132">[</span><span class="ident" id="3022133">i</span><span class="op" id="3022134">]</span>&nbsp;<span class="op" id="3022136">&amp;^</span>&nbsp;<span class="ident" id="3022139">y</span><span class="op" id="3022140">[</span><span class="ident" id="3022141">i</span><span class="op" id="3022142">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3022145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3022148">copy</span><span class="op" id="3022152">(</span><span class="ident" id="3022153">z</span><span class="op" id="3022154">[</span><span class="ident" id="3022155">n</span><span class="op" id="3022156">:</span><span class="ident" id="3022157">m</span><span class="op" id="3022158">]</span><span class="op" id="3022159">,</span>&nbsp;<span class="ident" id="3022161">x</span><span class="op" id="3022162">[</span><span class="ident" id="3022163">n</span><span class="op" id="3022164">:</span><span class="ident" id="3022165">m</span><span class="op" id="3022166">]</span><span class="op" id="3022167">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022171">return</span>&nbsp;<span class="ident" id="3022178">z</span><span class="op" id="3022179">.</span><span class="ident" id="3022180">norm</span><span class="op" id="3022184">(</span><span class="op" id="3022185">)</span><br>
<span class="lineno"></span><span class="op" id="3022187">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3022190">func</span>&nbsp;<span class="op" id="3022195">(</span><span class="ident" id="3022196">z</span>&nbsp;<span class="ident" id="3022198">nat</span><span class="op" id="3022201">)</span>&nbsp;<span class="ident" id="3022203">or</span><span class="op" id="3022205">(</span><span class="ident" id="3022206">x</span><span class="op" id="3022207">,</span>&nbsp;<span class="ident" id="3022209">y</span>&nbsp;<span class="ident" id="3022211">nat</span><span class="op" id="3022214">)</span>&nbsp;<span class="ident" id="3022216">nat</span>&nbsp;<span class="op" id="3022220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022223">m</span>&nbsp;<span class="op" id="3022225">:=</span>&nbsp;<span class="builtinfunc" id="3022228">len</span><span class="op" id="3022231">(</span><span class="ident" id="3022232">x</span><span class="op" id="3022233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022236">n</span>&nbsp;<span class="op" id="3022238">:=</span>&nbsp;<span class="builtinfunc" id="3022241">len</span><span class="op" id="3022244">(</span><span class="ident" id="3022245">y</span><span class="op" id="3022246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022249">s</span>&nbsp;<span class="op" id="3022251">:=</span>&nbsp;<span class="ident" id="3022254">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022257">if</span>&nbsp;<span class="ident" id="3022260">m</span>&nbsp;<span class="op" id="3022262">&lt;</span>&nbsp;<span class="ident" id="3022264">n</span>&nbsp;<span class="op" id="3022266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022270">n</span><span class="op" id="3022271">,</span>&nbsp;<span class="ident" id="3022273">m</span>&nbsp;<span class="op" id="3022275">=</span>&nbsp;<span class="ident" id="3022277">m</span><span class="op" id="3022278">,</span>&nbsp;<span class="ident" id="3022280">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022284">s</span>&nbsp;<span class="op" id="3022286">=</span>&nbsp;<span class="ident" id="3022288">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3022291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3022294">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022306">z</span>&nbsp;<span class="op" id="3022308">=</span>&nbsp;<span class="ident" id="3022310">z</span><span class="op" id="3022311">.</span><span class="builtinfunc" id="3022312">make</span><span class="op" id="3022316">(</span><span class="ident" id="3022317">m</span><span class="op" id="3022318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022321">for</span>&nbsp;<span class="ident" id="3022325">i</span>&nbsp;<span class="op" id="3022327">:=</span>&nbsp;<span class="num" id="3022330">0</span><span class="op" id="3022331">;</span>&nbsp;<span class="ident" id="3022333">i</span>&nbsp;<span class="op" id="3022335">&lt;</span>&nbsp;<span class="ident" id="3022337">n</span><span class="op" id="3022338">;</span>&nbsp;<span class="ident" id="3022340">i</span><span class="op" id="3022341">++</span>&nbsp;<span class="op" id="3022344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022348">z</span><span class="op" id="3022349">[</span><span class="ident" id="3022350">i</span><span class="op" id="3022351">]</span>&nbsp;<span class="op" id="3022353">=</span>&nbsp;<span class="ident" id="3022355">x</span><span class="op" id="3022356">[</span><span class="ident" id="3022357">i</span><span class="op" id="3022358">]</span>&nbsp;<span class="op" id="3022360">|</span>&nbsp;<span class="ident" id="3022362">y</span><span class="op" id="3022363">[</span><span class="ident" id="3022364">i</span><span class="op" id="3022365">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3022368">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3022371">copy</span><span class="op" id="3022375">(</span><span class="ident" id="3022376">z</span><span class="op" id="3022377">[</span><span class="ident" id="3022378">n</span><span class="op" id="3022379">:</span><span class="ident" id="3022380">m</span><span class="op" id="3022381">]</span><span class="op" id="3022382">,</span>&nbsp;<span class="ident" id="3022384">s</span><span class="op" id="3022385">[</span><span class="ident" id="3022386">n</span><span class="op" id="3022387">:</span><span class="ident" id="3022388">m</span><span class="op" id="3022389">]</span><span class="op" id="3022390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022394">return</span>&nbsp;<span class="ident" id="3022401">z</span><span class="op" id="3022402">.</span><span class="ident" id="3022403">norm</span><span class="op" id="3022407">(</span><span class="op" id="3022408">)</span><br>
<span class="lineno"></span><span class="op" id="3022410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3022413">func</span>&nbsp;<span class="op" id="3022418">(</span><span class="ident" id="3022419">z</span>&nbsp;<span class="ident" id="3022421">nat</span><span class="op" id="3022424">)</span>&nbsp;<span class="ident" id="3022426">xor</span><span class="op" id="3022429">(</span><span class="ident" id="3022430">x</span><span class="op" id="3022431">,</span>&nbsp;<span class="ident" id="3022433">y</span>&nbsp;<span class="ident" id="3022435">nat</span><span class="op" id="3022438">)</span>&nbsp;<span class="ident" id="3022440">nat</span>&nbsp;<span class="op" id="3022444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022447">m</span>&nbsp;<span class="op" id="3022449">:=</span>&nbsp;<span class="builtinfunc" id="3022452">len</span><span class="op" id="3022455">(</span><span class="ident" id="3022456">x</span><span class="op" id="3022457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022460">n</span>&nbsp;<span class="op" id="3022462">:=</span>&nbsp;<span class="builtinfunc" id="3022465">len</span><span class="op" id="3022468">(</span><span class="ident" id="3022469">y</span><span class="op" id="3022470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022473">s</span>&nbsp;<span class="op" id="3022475">:=</span>&nbsp;<span class="ident" id="3022478">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022481">if</span>&nbsp;<span class="ident" id="3022484">m</span>&nbsp;<span class="op" id="3022486">&lt;</span>&nbsp;<span class="ident" id="3022488">n</span>&nbsp;<span class="op" id="3022490">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022494">n</span><span class="op" id="3022495">,</span>&nbsp;<span class="ident" id="3022497">m</span>&nbsp;<span class="op" id="3022499">=</span>&nbsp;<span class="ident" id="3022501">m</span><span class="op" id="3022502">,</span>&nbsp;<span class="ident" id="3022504">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022508">s</span>&nbsp;<span class="op" id="3022510">=</span>&nbsp;<span class="ident" id="3022512">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3022515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3022518">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022530">z</span>&nbsp;<span class="op" id="3022532">=</span>&nbsp;<span class="ident" id="3022534">z</span><span class="op" id="3022535">.</span><span class="builtinfunc" id="3022536">make</span><span class="op" id="3022540">(</span><span class="ident" id="3022541">m</span><span class="op" id="3022542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022545">for</span>&nbsp;<span class="ident" id="3022549">i</span>&nbsp;<span class="op" id="3022551">:=</span>&nbsp;<span class="num" id="3022554">0</span><span class="op" id="3022555">;</span>&nbsp;<span class="ident" id="3022557">i</span>&nbsp;<span class="op" id="3022559">&lt;</span>&nbsp;<span class="ident" id="3022561">n</span><span class="op" id="3022562">;</span>&nbsp;<span class="ident" id="3022564">i</span><span class="op" id="3022565">++</span>&nbsp;<span class="op" id="3022568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022572">z</span><span class="op" id="3022573">[</span><span class="ident" id="3022574">i</span><span class="op" id="3022575">]</span>&nbsp;<span class="op" id="3022577">=</span>&nbsp;<span class="ident" id="3022579">x</span><span class="op" id="3022580">[</span><span class="ident" id="3022581">i</span><span class="op" id="3022582">]</span>&nbsp;<span class="op" id="3022584">^</span>&nbsp;<span class="ident" id="3022586">y</span><span class="op" id="3022587">[</span><span class="ident" id="3022588">i</span><span class="op" id="3022589">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3022592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3022595">copy</span><span class="op" id="3022599">(</span><span class="ident" id="3022600">z</span><span class="op" id="3022601">[</span><span class="ident" id="3022602">n</span><span class="op" id="3022603">:</span><span class="ident" id="3022604">m</span><span class="op" id="3022605">]</span><span class="op" id="3022606">,</span>&nbsp;<span class="ident" id="3022608">s</span><span class="op" id="3022609">[</span><span class="ident" id="3022610">n</span><span class="op" id="3022611">:</span><span class="ident" id="3022612">m</span><span class="op" id="3022613">]</span><span class="op" id="3022614">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022618">return</span>&nbsp;<span class="ident" id="3022625">z</span><span class="op" id="3022626">.</span><span class="ident" id="3022627">norm</span><span class="op" id="3022631">(</span><span class="op" id="3022632">)</span><br>
<span class="lineno"></span><span class="op" id="3022634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3022637">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3022699">func</span>&nbsp;<span class="ident" id="3022704">greaterThan</span><span class="op" id="3022715">(</span><span class="ident" id="3022716">x1</span><span class="op" id="3022718">,</span>&nbsp;<span class="ident" id="3022720">x2</span><span class="op" id="3022722">,</span>&nbsp;<span class="ident" id="3022724">y1</span><span class="op" id="3022726">,</span>&nbsp;<span class="ident" id="3022728">y2</span>&nbsp;<span class="ident" id="3022731">Word</span><span class="op" id="3022735">)</span>&nbsp;<span class="builtintype" id="3022737">bool</span>&nbsp;<span class="op" id="3022742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022745">return</span>&nbsp;<span class="ident" id="3022752">x1</span>&nbsp;<span class="op" id="3022755">&gt;</span>&nbsp;<span class="ident" id="3022757">y1</span>&nbsp;<span class="op" id="3022760">||</span>&nbsp;<span class="ident" id="3022763">x1</span>&nbsp;<span class="op" id="3022766">==</span>&nbsp;<span class="ident" id="3022769">y1</span>&nbsp;<span class="op" id="3022772">&amp;&amp;</span>&nbsp;<span class="ident" id="3022775">x2</span>&nbsp;<span class="op" id="3022778">&gt;</span>&nbsp;<span class="ident" id="3022780">y2</span><br>
<span class="lineno"></span><span class="op" id="3022783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3022786">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3022809">func</span>&nbsp;<span class="op" id="3022814">(</span><span class="ident" id="3022815">x</span>&nbsp;<span class="ident" id="3022817">nat</span><span class="op" id="3022820">)</span>&nbsp;<span class="ident" id="3022822">modW</span><span class="op" id="3022826">(</span><span class="ident" id="3022827">d</span>&nbsp;<span class="ident" id="3022829">Word</span><span class="op" id="3022833">)</span>&nbsp;<span class="op" id="3022835">(</span><span class="ident" id="3022836">r</span>&nbsp;<span class="ident" id="3022838">Word</span><span class="op" id="3022842">)</span>&nbsp;<span class="op" id="3022844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3022847">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022907">var</span>&nbsp;<span class="ident" id="3022911">q</span>&nbsp;<span class="ident" id="3022913">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3022918">q</span>&nbsp;<span class="op" id="3022920">=</span>&nbsp;<span class="ident" id="3022922">q</span><span class="op" id="3022923">.</span><span class="builtinfunc" id="3022924">make</span><span class="op" id="3022928">(</span><span class="builtinfunc" id="3022929">len</span><span class="op" id="3022932">(</span><span class="ident" id="3022933">x</span><span class="op" id="3022934">)</span><span class="op" id="3022935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3022938">return</span>&nbsp;<span class="ident" id="3022945">divWVW</span><span class="op" id="3022951">(</span><span class="ident" id="3022952">q</span><span class="op" id="3022953">,</span>&nbsp;<span class="num" id="3022955">0</span><span class="op" id="3022956">,</span>&nbsp;<span class="ident" id="3022958">x</span><span class="op" id="3022959">,</span>&nbsp;<span class="ident" id="3022961">d</span><span class="op" id="3022962">)</span><br>
<span class="lineno">1190</span><span class="op" id="3022964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3022967">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3023041">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3023084">func</span>&nbsp;<span class="op" id="3023089">(</span><span class="ident" id="3023090">z</span>&nbsp;<span class="ident" id="3023092">nat</span><span class="op" id="3023095">)</span>&nbsp;<span class="ident" id="3023097">random</span><span class="op" id="3023103">(</span><span class="ident" id="3023104">rand</span>&nbsp;<span class="op" id="3023109">*</span><span class="ident" id="3023110">rand</span><span class="op" id="3023114">.</span><span class="ident" id="3023115">Rand</span><span class="op" id="3023119">,</span>&nbsp;<span class="ident" id="3023121">limit</span>&nbsp;<span class="ident" id="3023127">nat</span><span class="op" id="3023130">,</span>&nbsp;<span class="ident" id="3023132">n</span>&nbsp;<span class="builtintype" id="3023134">int</span><span class="op" id="3023137">)</span>&nbsp;<span class="ident" id="3023139">nat</span>&nbsp;<span class="op" id="3023143">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023146">if</span>&nbsp;<span class="ident" id="3023149">alias</span><span class="op" id="3023154">(</span><span class="ident" id="3023155">z</span><span class="op" id="3023156">,</span>&nbsp;<span class="ident" id="3023158">limit</span><span class="op" id="3023163">)</span>&nbsp;<span class="op" id="3023165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023169">z</span>&nbsp;<span class="op" id="3023171">=</span>&nbsp;<span class="builtintype" id="3023173">nil</span>&nbsp;<span class="comment" id="3023177">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023223">z</span>&nbsp;<span class="op" id="3023225">=</span>&nbsp;<span class="ident" id="3023227">z</span><span class="op" id="3023228">.</span><span class="builtinfunc" id="3023229">make</span><span class="op" id="3023233">(</span><span class="builtinfunc" id="3023234">len</span><span class="op" id="3023237">(</span><span class="ident" id="3023238">limit</span><span class="op" id="3023243">)</span><span class="op" id="3023244">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023248">bitLengthOfMSW</span>&nbsp;<span class="op" id="3023263">:=</span>&nbsp;<span class="builtintype" id="3023266">uint</span><span class="op" id="3023270">(</span><span class="ident" id="3023271">n</span>&nbsp;<span class="op" id="3023273">%</span>&nbsp;<span class="ident" id="3023275">_W</span><span class="op" id="3023277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023280">if</span>&nbsp;<span class="ident" id="3023283">bitLengthOfMSW</span>&nbsp;<span class="op" id="3023298">==</span>&nbsp;<span class="num" id="3023301">0</span>&nbsp;<span class="op" id="3023303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023307">bitLengthOfMSW</span>&nbsp;<span class="op" id="3023322">=</span>&nbsp;<span class="ident" id="3023324">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023331">mask</span>&nbsp;<span class="op" id="3023336">:=</span>&nbsp;<span class="ident" id="3023339">Word</span><span class="op" id="3023343">(</span><span class="op" id="3023344">(</span><span class="num" id="3023345">1</span>&nbsp;<span class="op" id="3023347">&lt;&lt;</span>&nbsp;<span class="ident" id="3023350">bitLengthOfMSW</span><span class="op" id="3023364">)</span>&nbsp;<span class="op" id="3023366">-</span>&nbsp;<span class="num" id="3023368">1</span><span class="op" id="3023369">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023373">for</span>&nbsp;<span class="op" id="3023377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023381">switch</span>&nbsp;<span class="ident" id="3023388">_W</span>&nbsp;<span class="op" id="3023391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023395">case</span>&nbsp;<span class="num" id="3023400">32</span><span class="op" id="3023402">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023407">for</span>&nbsp;<span class="ident" id="3023411">i</span>&nbsp;<span class="op" id="3023413">:=</span>&nbsp;<span class="keyword" id="3023416">range</span>&nbsp;<span class="ident" id="3023422">z</span>&nbsp;<span class="op" id="3023424">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023430">z</span><span class="op" id="3023431">[</span><span class="ident" id="3023432">i</span><span class="op" id="3023433">]</span>&nbsp;<span class="op" id="3023435">=</span>&nbsp;<span class="ident" id="3023437">Word</span><span class="op" id="3023441">(</span><span class="ident" id="3023442">rand</span><span class="op" id="3023446">.</span><span class="ident" id="3023447">Uint32</span><span class="op" id="3023453">(</span><span class="op" id="3023454">)</span><span class="op" id="3023455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023464">case</span>&nbsp;<span class="num" id="3023469">64</span><span class="op" id="3023471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023476">for</span>&nbsp;<span class="ident" id="3023480">i</span>&nbsp;<span class="op" id="3023482">:=</span>&nbsp;<span class="keyword" id="3023485">range</span>&nbsp;<span class="ident" id="3023491">z</span>&nbsp;<span class="op" id="3023493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023499">z</span><span class="op" id="3023500">[</span><span class="ident" id="3023501">i</span><span class="op" id="3023502">]</span>&nbsp;<span class="op" id="3023504">=</span>&nbsp;<span class="ident" id="3023506">Word</span><span class="op" id="3023510">(</span><span class="ident" id="3023511">rand</span><span class="op" id="3023515">.</span><span class="ident" id="3023516">Uint32</span><span class="op" id="3023522">(</span><span class="op" id="3023523">)</span><span class="op" id="3023524">)</span>&nbsp;<span class="op" id="3023526">|</span>&nbsp;<span class="ident" id="3023528">Word</span><span class="op" id="3023532">(</span><span class="ident" id="3023533">rand</span><span class="op" id="3023537">.</span><span class="ident" id="3023538">Uint32</span><span class="op" id="3023544">(</span><span class="op" id="3023545">)</span><span class="op" id="3023546">)</span><span class="op" id="3023547">&lt;&lt;</span><span class="num" id="3023549">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023559">default</span><span class="op" id="3023566">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3023571">panic</span><span class="op" id="3023576">(</span><span class="string" id="3023577">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3023596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023604">z</span><span class="op" id="3023605">[</span><span class="builtinfunc" id="3023606">len</span><span class="op" id="3023609">(</span><span class="ident" id="3023610">limit</span><span class="op" id="3023615">)</span><span class="op" id="3023616">-</span><span class="num" id="3023617">1</span><span class="op" id="3023618">]</span>&nbsp;<span class="op" id="3023620">&amp;=</span>&nbsp;<span class="ident" id="3023623">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023630">if</span>&nbsp;<span class="ident" id="3023633">z</span><span class="op" id="3023634">.</span><span class="ident" id="3023635">cmp</span><span class="op" id="3023638">(</span><span class="ident" id="3023639">limit</span><span class="op" id="3023644">)</span>&nbsp;<span class="op" id="3023646">&lt;</span>&nbsp;<span class="num" id="3023648">0</span>&nbsp;<span class="op" id="3023650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023655">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023670">return</span>&nbsp;<span class="ident" id="3023677">z</span><span class="op" id="3023678">.</span><span class="ident" id="3023679">norm</span><span class="op" id="3023683">(</span><span class="op" id="3023684">)</span><br>
<span class="lineno"></span><span class="op" id="3023686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3023689">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3023751">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3023813">func</span>&nbsp;<span class="op" id="3023818">(</span><span class="ident" id="3023819">z</span>&nbsp;<span class="ident" id="3023821">nat</span><span class="op" id="3023824">)</span>&nbsp;<span class="ident" id="3023826">expNN</span><span class="op" id="3023831">(</span><span class="ident" id="3023832">x</span><span class="op" id="3023833">,</span>&nbsp;<span class="ident" id="3023835">y</span><span class="op" id="3023836">,</span>&nbsp;<span class="ident" id="3023838">m</span>&nbsp;<span class="ident" id="3023840">nat</span><span class="op" id="3023843">)</span>&nbsp;<span class="ident" id="3023845">nat</span>&nbsp;<span class="op" id="3023849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023852">if</span>&nbsp;<span class="ident" id="3023855">alias</span><span class="op" id="3023860">(</span><span class="ident" id="3023861">z</span><span class="op" id="3023862">,</span>&nbsp;<span class="ident" id="3023864">x</span><span class="op" id="3023865">)</span>&nbsp;<span class="op" id="3023867">||</span>&nbsp;<span class="ident" id="3023870">alias</span><span class="op" id="3023875">(</span><span class="ident" id="3023876">z</span><span class="op" id="3023877">,</span>&nbsp;<span class="ident" id="3023879">y</span><span class="op" id="3023880">)</span>&nbsp;<span class="op" id="3023882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3023886">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3023940">z</span>&nbsp;<span class="op" id="3023942">=</span>&nbsp;<span class="builtintype" id="3023944">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3023949">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3023953">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3023973">if</span>&nbsp;<span class="builtinfunc" id="3023976">len</span><span class="op" id="3023979">(</span><span class="ident" id="3023980">m</span><span class="op" id="3023981">)</span>&nbsp;<span class="op" id="3023983">==</span>&nbsp;<span class="num" id="3023986">1</span>&nbsp;<span class="op" id="3023988">&amp;&amp;</span>&nbsp;<span class="ident" id="3023991">m</span><span class="op" id="3023992">[</span><span class="num" id="3023993">0</span><span class="op" id="3023994">]</span>&nbsp;<span class="op" id="3023996">==</span>&nbsp;<span class="num" id="3023999">1</span>&nbsp;<span class="op" id="3024001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024005">return</span>&nbsp;<span class="ident" id="3024012">z</span><span class="op" id="3024013">.</span><span class="ident" id="3024014">setWord</span><span class="op" id="3024021">(</span><span class="num" id="3024022">0</span><span class="op" id="3024023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3024026">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024029">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024050">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024064">if</span>&nbsp;<span class="builtinfunc" id="3024067">len</span><span class="op" id="3024070">(</span><span class="ident" id="3024071">y</span><span class="op" id="3024072">)</span>&nbsp;<span class="op" id="3024074">==</span>&nbsp;<span class="num" id="3024077">0</span>&nbsp;<span class="op" id="3024079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024083">return</span>&nbsp;<span class="ident" id="3024090">z</span><span class="op" id="3024091">.</span><span class="ident" id="3024092">setWord</span><span class="op" id="3024099">(</span><span class="num" id="3024100">1</span><span class="op" id="3024101">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3024104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024107">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024118">if</span>&nbsp;<span class="builtinfunc" id="3024121">len</span><span class="op" id="3024124">(</span><span class="ident" id="3024125">m</span><span class="op" id="3024126">)</span>&nbsp;<span class="op" id="3024128">!=</span>&nbsp;<span class="num" id="3024131">0</span>&nbsp;<span class="op" id="3024133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024137">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3024189">z</span>&nbsp;<span class="op" id="3024191">=</span>&nbsp;<span class="ident" id="3024193">z</span><span class="op" id="3024194">.</span><span class="builtinfunc" id="3024195">make</span><span class="op" id="3024199">(</span><span class="builtinfunc" id="3024200">len</span><span class="op" id="3024203">(</span><span class="ident" id="3024204">m</span><span class="op" id="3024205">)</span><span class="op" id="3024206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3024209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3024212">z</span>&nbsp;<span class="op" id="3024214">=</span>&nbsp;<span class="ident" id="3024216">z</span><span class="op" id="3024217">.</span><span class="ident" id="3024218">set</span><span class="op" id="3024221">(</span><span class="ident" id="3024222">x</span><span class="op" id="3024223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024227">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024292">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024365">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024435">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024501">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024517">if</span>&nbsp;<span class="builtinfunc" id="3024520">len</span><span class="op" id="3024523">(</span><span class="ident" id="3024524">x</span><span class="op" id="3024525">)</span>&nbsp;<span class="op" id="3024527">&gt;</span>&nbsp;<span class="num" id="3024529">1</span>&nbsp;<span class="op" id="3024531">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3024534">len</span><span class="op" id="3024537">(</span><span class="ident" id="3024538">y</span><span class="op" id="3024539">)</span>&nbsp;<span class="op" id="3024541">&gt;</span>&nbsp;<span class="num" id="3024543">1</span>&nbsp;<span class="op" id="3024545">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3024548">len</span><span class="op" id="3024551">(</span><span class="ident" id="3024552">m</span><span class="op" id="3024553">)</span>&nbsp;<span class="op" id="3024555">&gt;</span>&nbsp;<span class="num" id="3024557">0</span>&nbsp;<span class="op" id="3024559">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024563">return</span>&nbsp;<span class="ident" id="3024570">z</span><span class="op" id="3024571">.</span><span class="ident" id="3024572">expNNWindowed</span><span class="op" id="3024585">(</span><span class="ident" id="3024586">x</span><span class="op" id="3024587">,</span>&nbsp;<span class="ident" id="3024589">y</span><span class="op" id="3024590">,</span>&nbsp;<span class="ident" id="3024592">m</span><span class="op" id="3024593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3024596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3024600">v</span>&nbsp;<span class="op" id="3024602">:=</span>&nbsp;<span class="ident" id="3024605">y</span><span class="op" id="3024606">[</span><span class="builtinfunc" id="3024607">len</span><span class="op" id="3024610">(</span><span class="ident" id="3024611">y</span><span class="op" id="3024612">)</span><span class="op" id="3024613">-</span><span class="num" id="3024614">1</span><span class="op" id="3024615">]</span>&nbsp;<span class="comment" id="3024617">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3024661">shift</span>&nbsp;<span class="op" id="3024667">:=</span>&nbsp;<span class="ident" id="3024670">leadingZeros</span><span class="op" id="3024682">(</span><span class="ident" id="3024683">v</span><span class="op" id="3024684">)</span>&nbsp;<span class="op" id="3024686">+</span>&nbsp;<span class="num" id="3024688">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3024691">v</span>&nbsp;<span class="op" id="3024693">&lt;&lt;=</span>&nbsp;<span class="ident" id="3024697">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024704">var</span>&nbsp;<span class="ident" id="3024708">q</span>&nbsp;<span class="ident" id="3024710">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3024716">const</span>&nbsp;<span class="ident" id="3024722">mask</span>&nbsp;<span class="op" id="3024727">=</span>&nbsp;<span class="num" id="3024729">1</span>&nbsp;<span class="op" id="3024731">&lt;&lt;</span>&nbsp;<span class="op" id="3024734">(</span><span class="ident" id="3024735">_W</span>&nbsp;<span class="op" id="3024738">-</span>&nbsp;<span class="num" id="3024740">1</span><span class="op" id="3024741">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024745">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024815">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024887">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3024945">w</span>&nbsp;<span class="op" id="3024947">:=</span>&nbsp;<span class="ident" id="3024950">_W</span>&nbsp;<span class="op" id="3024953">-</span>&nbsp;<span class="builtintype" id="3024955">int</span><span class="op" id="3024958">(</span><span class="ident" id="3024959">shift</span><span class="op" id="3024964">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3024967">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3025027">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025068">var</span>&nbsp;<span class="ident" id="3025072">zz</span><span class="op" id="3025074">,</span>&nbsp;<span class="ident" id="3025076">r</span>&nbsp;<span class="ident" id="3025078">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025083">for</span>&nbsp;<span class="ident" id="3025087">j</span>&nbsp;<span class="op" id="3025089">:=</span>&nbsp;<span class="num" id="3025092">0</span><span class="op" id="3025093">;</span>&nbsp;<span class="ident" id="3025095">j</span>&nbsp;<span class="op" id="3025097">&lt;</span>&nbsp;<span class="ident" id="3025099">w</span><span class="op" id="3025100">;</span>&nbsp;<span class="ident" id="3025102">j</span><span class="op" id="3025103">++</span>&nbsp;<span class="op" id="3025106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025110">zz</span>&nbsp;<span class="op" id="3025113">=</span>&nbsp;<span class="ident" id="3025115">zz</span><span class="op" id="3025117">.</span><span class="ident" id="3025118">mul</span><span class="op" id="3025121">(</span><span class="ident" id="3025122">z</span><span class="op" id="3025123">,</span>&nbsp;<span class="ident" id="3025125">z</span><span class="op" id="3025126">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025130">zz</span><span class="op" id="3025132">,</span>&nbsp;<span class="ident" id="3025134">z</span>&nbsp;<span class="op" id="3025136">=</span>&nbsp;<span class="ident" id="3025138">z</span><span class="op" id="3025139">,</span>&nbsp;<span class="ident" id="3025141">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025147">if</span>&nbsp;<span class="ident" id="3025150">v</span><span class="op" id="3025151">&amp;</span><span class="ident" id="3025152">mask</span>&nbsp;<span class="op" id="3025157">!=</span>&nbsp;<span class="num" id="3025160">0</span>&nbsp;<span class="op" id="3025162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025167">zz</span>&nbsp;<span class="op" id="3025170">=</span>&nbsp;<span class="ident" id="3025172">zz</span><span class="op" id="3025174">.</span><span class="ident" id="3025175">mul</span><span class="op" id="3025178">(</span><span class="ident" id="3025179">z</span><span class="op" id="3025180">,</span>&nbsp;<span class="ident" id="3025182">x</span><span class="op" id="3025183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025188">zz</span><span class="op" id="3025190">,</span>&nbsp;<span class="ident" id="3025192">z</span>&nbsp;<span class="op" id="3025194">=</span>&nbsp;<span class="ident" id="3025196">z</span><span class="op" id="3025197">,</span>&nbsp;<span class="ident" id="3025199">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025209">if</span>&nbsp;<span class="builtinfunc" id="3025212">len</span><span class="op" id="3025215">(</span><span class="ident" id="3025216">m</span><span class="op" id="3025217">)</span>&nbsp;<span class="op" id="3025219">!=</span>&nbsp;<span class="num" id="3025222">0</span>&nbsp;<span class="op" id="3025224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025229">zz</span><span class="op" id="3025231">,</span>&nbsp;<span class="ident" id="3025233">r</span>&nbsp;<span class="op" id="3025235">=</span>&nbsp;<span class="ident" id="3025237">zz</span><span class="op" id="3025239">.</span><span class="ident" id="3025240">div</span><span class="op" id="3025243">(</span><span class="ident" id="3025244">r</span><span class="op" id="3025245">,</span>&nbsp;<span class="ident" id="3025247">z</span><span class="op" id="3025248">,</span>&nbsp;<span class="ident" id="3025250">m</span><span class="op" id="3025251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025256">zz</span><span class="op" id="3025258">,</span>&nbsp;<span class="ident" id="3025260">r</span><span class="op" id="3025261">,</span>&nbsp;<span class="ident" id="3025263">q</span><span class="op" id="3025264">,</span>&nbsp;<span class="ident" id="3025266">z</span>&nbsp;<span class="op" id="3025268">=</span>&nbsp;<span class="ident" id="3025270">q</span><span class="op" id="3025271">,</span>&nbsp;<span class="ident" id="3025273">z</span><span class="op" id="3025274">,</span>&nbsp;<span class="ident" id="3025276">zz</span><span class="op" id="3025278">,</span>&nbsp;<span class="ident" id="3025280">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025289">v</span>&nbsp;<span class="op" id="3025291">&lt;&lt;=</span>&nbsp;<span class="num" id="3025295">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025302">for</span>&nbsp;<span class="ident" id="3025306">i</span>&nbsp;<span class="op" id="3025308">:=</span>&nbsp;<span class="builtinfunc" id="3025311">len</span><span class="op" id="3025314">(</span><span class="ident" id="3025315">y</span><span class="op" id="3025316">)</span>&nbsp;<span class="op" id="3025318">-</span>&nbsp;<span class="num" id="3025320">2</span><span class="op" id="3025321">;</span>&nbsp;<span class="ident" id="3025323">i</span>&nbsp;<span class="op" id="3025325">&gt;=</span>&nbsp;<span class="num" id="3025328">0</span><span class="op" id="3025329">;</span>&nbsp;<span class="ident" id="3025331">i</span><span class="op" id="3025332">--</span>&nbsp;<span class="op" id="3025335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025339">v</span>&nbsp;<span class="op" id="3025341">=</span>&nbsp;<span class="ident" id="3025343">y</span><span class="op" id="3025344">[</span><span class="ident" id="3025345">i</span><span class="op" id="3025346">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025351">for</span>&nbsp;<span class="ident" id="3025355">j</span>&nbsp;<span class="op" id="3025357">:=</span>&nbsp;<span class="num" id="3025360">0</span><span class="op" id="3025361">;</span>&nbsp;<span class="ident" id="3025363">j</span>&nbsp;<span class="op" id="3025365">&lt;</span>&nbsp;<span class="ident" id="3025367">_W</span><span class="op" id="3025369">;</span>&nbsp;<span class="ident" id="3025371">j</span><span class="op" id="3025372">++</span>&nbsp;<span class="op" id="3025375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025380">zz</span>&nbsp;<span class="op" id="3025383">=</span>&nbsp;<span class="ident" id="3025385">zz</span><span class="op" id="3025387">.</span><span class="ident" id="3025388">mul</span><span class="op" id="3025391">(</span><span class="ident" id="3025392">z</span><span class="op" id="3025393">,</span>&nbsp;<span class="ident" id="3025395">z</span><span class="op" id="3025396">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025401">zz</span><span class="op" id="3025403">,</span>&nbsp;<span class="ident" id="3025405">z</span>&nbsp;<span class="op" id="3025407">=</span>&nbsp;<span class="ident" id="3025409">z</span><span class="op" id="3025410">,</span>&nbsp;<span class="ident" id="3025412">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025419">if</span>&nbsp;<span class="ident" id="3025422">v</span><span class="op" id="3025423">&amp;</span><span class="ident" id="3025424">mask</span>&nbsp;<span class="op" id="3025429">!=</span>&nbsp;<span class="num" id="3025432">0</span>&nbsp;<span class="op" id="3025434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025440">zz</span>&nbsp;<span class="op" id="3025443">=</span>&nbsp;<span class="ident" id="3025445">zz</span><span class="op" id="3025447">.</span><span class="ident" id="3025448">mul</span><span class="op" id="3025451">(</span><span class="ident" id="3025452">z</span><span class="op" id="3025453">,</span>&nbsp;<span class="ident" id="3025455">x</span><span class="op" id="3025456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025462">zz</span><span class="op" id="3025464">,</span>&nbsp;<span class="ident" id="3025466">z</span>&nbsp;<span class="op" id="3025468">=</span>&nbsp;<span class="ident" id="3025470">z</span><span class="op" id="3025471">,</span>&nbsp;<span class="ident" id="3025473">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025485">if</span>&nbsp;<span class="builtinfunc" id="3025488">len</span><span class="op" id="3025491">(</span><span class="ident" id="3025492">m</span><span class="op" id="3025493">)</span>&nbsp;<span class="op" id="3025495">!=</span>&nbsp;<span class="num" id="3025498">0</span>&nbsp;<span class="op" id="3025500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025506">zz</span><span class="op" id="3025508">,</span>&nbsp;<span class="ident" id="3025510">r</span>&nbsp;<span class="op" id="3025512">=</span>&nbsp;<span class="ident" id="3025514">zz</span><span class="op" id="3025516">.</span><span class="ident" id="3025517">div</span><span class="op" id="3025520">(</span><span class="ident" id="3025521">r</span><span class="op" id="3025522">,</span>&nbsp;<span class="ident" id="3025524">z</span><span class="op" id="3025525">,</span>&nbsp;<span class="ident" id="3025527">m</span><span class="op" id="3025528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025534">zz</span><span class="op" id="3025536">,</span>&nbsp;<span class="ident" id="3025538">r</span><span class="op" id="3025539">,</span>&nbsp;<span class="ident" id="3025541">q</span><span class="op" id="3025542">,</span>&nbsp;<span class="ident" id="3025544">z</span>&nbsp;<span class="op" id="3025546">=</span>&nbsp;<span class="ident" id="3025548">q</span><span class="op" id="3025549">,</span>&nbsp;<span class="ident" id="3025551">z</span><span class="op" id="3025552">,</span>&nbsp;<span class="ident" id="3025554">zz</span><span class="op" id="3025556">,</span>&nbsp;<span class="ident" id="3025558">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025569">v</span>&nbsp;<span class="op" id="3025571">&lt;&lt;=</span>&nbsp;<span class="num" id="3025575">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3025582">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025586">return</span>&nbsp;<span class="ident" id="3025593">z</span><span class="op" id="3025594">.</span><span class="ident" id="3025595">norm</span><span class="op" id="3025599">(</span><span class="op" id="3025600">)</span><br>
<span class="lineno"></span><span class="op" id="3025602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3025605">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3025673">func</span>&nbsp;<span class="op" id="3025678">(</span><span class="ident" id="3025679">z</span>&nbsp;<span class="ident" id="3025681">nat</span><span class="op" id="3025684">)</span>&nbsp;<span class="ident" id="3025686">expNNWindowed</span><span class="op" id="3025699">(</span><span class="ident" id="3025700">x</span><span class="op" id="3025701">,</span>&nbsp;<span class="ident" id="3025703">y</span><span class="op" id="3025704">,</span>&nbsp;<span class="ident" id="3025706">m</span>&nbsp;<span class="ident" id="3025708">nat</span><span class="op" id="3025711">)</span>&nbsp;<span class="ident" id="3025713">nat</span>&nbsp;<span class="op" id="3025717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3025720">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3025790">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025821">var</span>&nbsp;<span class="ident" id="3025825">zz</span><span class="op" id="3025827">,</span>&nbsp;<span class="ident" id="3025829">r</span>&nbsp;<span class="ident" id="3025831">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025837">const</span>&nbsp;<span class="ident" id="3025843">n</span>&nbsp;<span class="op" id="3025845">=</span>&nbsp;<span class="num" id="3025847">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3025850">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025878">var</span>&nbsp;<span class="ident" id="3025882">powers</span>&nbsp;<span class="op" id="3025889">[</span><span class="num" id="3025890">1</span>&nbsp;<span class="op" id="3025892">&lt;&lt;</span>&nbsp;<span class="ident" id="3025895">n</span><span class="op" id="3025896">]</span><span class="ident" id="3025897">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025902">powers</span><span class="op" id="3025908">[</span><span class="num" id="3025909">0</span><span class="op" id="3025910">]</span>&nbsp;<span class="op" id="3025912">=</span>&nbsp;<span class="ident" id="3025914">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025922">powers</span><span class="op" id="3025928">[</span><span class="num" id="3025929">1</span><span class="op" id="3025930">]</span>&nbsp;<span class="op" id="3025932">=</span>&nbsp;<span class="ident" id="3025934">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3025937">for</span>&nbsp;<span class="ident" id="3025941">i</span>&nbsp;<span class="op" id="3025943">:=</span>&nbsp;<span class="num" id="3025946">2</span><span class="op" id="3025947">;</span>&nbsp;<span class="ident" id="3025949">i</span>&nbsp;<span class="op" id="3025951">&lt;</span>&nbsp;<span class="num" id="3025953">1</span><span class="op" id="3025954">&lt;&lt;</span><span class="ident" id="3025956">n</span><span class="op" id="3025957">;</span>&nbsp;<span class="ident" id="3025959">i</span>&nbsp;<span class="op" id="3025961">+=</span>&nbsp;<span class="num" id="3025964">2</span>&nbsp;<span class="op" id="3025966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3025970">p2</span><span class="op" id="3025972">,</span>&nbsp;<span class="ident" id="3025974">p</span><span class="op" id="3025975">,</span>&nbsp;<span class="ident" id="3025977">p1</span>&nbsp;<span class="op" id="3025980">:=</span>&nbsp;<span class="op" id="3025983">&amp;</span><span class="ident" id="3025984">powers</span><span class="op" id="3025990">[</span><span class="ident" id="3025991">i</span><span class="op" id="3025992">/</span><span class="num" id="3025993">2</span><span class="op" id="3025994">]</span><span class="op" id="3025995">,</span>&nbsp;<span class="op" id="3025997">&amp;</span><span class="ident" id="3025998">powers</span><span class="op" id="3026004">[</span><span class="ident" id="3026005">i</span><span class="op" id="3026006">]</span><span class="op" id="3026007">,</span>&nbsp;<span class="op" id="3026009">&amp;</span><span class="ident" id="3026010">powers</span><span class="op" id="3026016">[</span><span class="ident" id="3026017">i</span><span class="op" id="3026018">+</span><span class="num" id="3026019">1</span><span class="op" id="3026020">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026024">*</span><span class="ident" id="3026025">p</span>&nbsp;<span class="op" id="3026027">=</span>&nbsp;<span class="ident" id="3026029">p</span><span class="op" id="3026030">.</span><span class="ident" id="3026031">mul</span><span class="op" id="3026034">(</span><span class="op" id="3026035">*</span><span class="ident" id="3026036">p2</span><span class="op" id="3026038">,</span>&nbsp;<span class="op" id="3026040">*</span><span class="ident" id="3026041">p2</span><span class="op" id="3026043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026047">zz</span><span class="op" id="3026049">,</span>&nbsp;<span class="ident" id="3026051">r</span>&nbsp;<span class="op" id="3026053">=</span>&nbsp;<span class="ident" id="3026055">zz</span><span class="op" id="3026057">.</span><span class="ident" id="3026058">div</span><span class="op" id="3026061">(</span><span class="ident" id="3026062">r</span><span class="op" id="3026063">,</span>&nbsp;<span class="op" id="3026065">*</span><span class="ident" id="3026066">p</span><span class="op" id="3026067">,</span>&nbsp;<span class="ident" id="3026069">m</span><span class="op" id="3026070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026074">*</span><span class="ident" id="3026075">p</span><span class="op" id="3026076">,</span>&nbsp;<span class="ident" id="3026078">r</span>&nbsp;<span class="op" id="3026080">=</span>&nbsp;<span class="ident" id="3026082">r</span><span class="op" id="3026083">,</span>&nbsp;<span class="op" id="3026085">*</span><span class="ident" id="3026086">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026090">*</span><span class="ident" id="3026091">p1</span>&nbsp;<span class="op" id="3026094">=</span>&nbsp;<span class="ident" id="3026096">p1</span><span class="op" id="3026098">.</span><span class="ident" id="3026099">mul</span><span class="op" id="3026102">(</span><span class="op" id="3026103">*</span><span class="ident" id="3026104">p</span><span class="op" id="3026105">,</span>&nbsp;<span class="ident" id="3026107">x</span><span class="op" id="3026108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026112">zz</span><span class="op" id="3026114">,</span>&nbsp;<span class="ident" id="3026116">r</span>&nbsp;<span class="op" id="3026118">=</span>&nbsp;<span class="ident" id="3026120">zz</span><span class="op" id="3026122">.</span><span class="ident" id="3026123">div</span><span class="op" id="3026126">(</span><span class="ident" id="3026127">r</span><span class="op" id="3026128">,</span>&nbsp;<span class="op" id="3026130">*</span><span class="ident" id="3026131">p1</span><span class="op" id="3026133">,</span>&nbsp;<span class="ident" id="3026135">m</span><span class="op" id="3026136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026140">*</span><span class="ident" id="3026141">p1</span><span class="op" id="3026143">,</span>&nbsp;<span class="ident" id="3026145">r</span>&nbsp;<span class="op" id="3026147">=</span>&nbsp;<span class="ident" id="3026149">r</span><span class="op" id="3026150">,</span>&nbsp;<span class="op" id="3026152">*</span><span class="ident" id="3026153">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026161">z</span>&nbsp;<span class="op" id="3026163">=</span>&nbsp;<span class="ident" id="3026165">z</span><span class="op" id="3026166">.</span><span class="ident" id="3026167">setWord</span><span class="op" id="3026174">(</span><span class="num" id="3026175">1</span><span class="op" id="3026176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3026180">for</span>&nbsp;<span class="ident" id="3026184">i</span>&nbsp;<span class="op" id="3026186">:=</span>&nbsp;<span class="builtinfunc" id="3026189">len</span><span class="op" id="3026192">(</span><span class="ident" id="3026193">y</span><span class="op" id="3026194">)</span>&nbsp;<span class="op" id="3026196">-</span>&nbsp;<span class="num" id="3026198">1</span><span class="op" id="3026199">;</span>&nbsp;<span class="ident" id="3026201">i</span>&nbsp;<span class="op" id="3026203">&gt;=</span>&nbsp;<span class="num" id="3026206">0</span><span class="op" id="3026207">;</span>&nbsp;<span class="ident" id="3026209">i</span><span class="op" id="3026210">--</span>&nbsp;<span class="op" id="3026213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026217">yi</span>&nbsp;<span class="op" id="3026220">:=</span>&nbsp;<span class="ident" id="3026223">y</span><span class="op" id="3026224">[</span><span class="ident" id="3026225">i</span><span class="op" id="3026226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3026230">for</span>&nbsp;<span class="ident" id="3026234">j</span>&nbsp;<span class="op" id="3026236">:=</span>&nbsp;<span class="num" id="3026239">0</span><span class="op" id="3026240">;</span>&nbsp;<span class="ident" id="3026242">j</span>&nbsp;<span class="op" id="3026244">&lt;</span>&nbsp;<span class="ident" id="3026246">_W</span><span class="op" id="3026248">;</span>&nbsp;<span class="ident" id="3026250">j</span>&nbsp;<span class="op" id="3026252">+=</span>&nbsp;<span class="ident" id="3026255">n</span>&nbsp;<span class="op" id="3026257">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3026262">if</span>&nbsp;<span class="ident" id="3026265">i</span>&nbsp;<span class="op" id="3026267">!=</span>&nbsp;<span class="builtinfunc" id="3026270">len</span><span class="op" id="3026273">(</span><span class="ident" id="3026274">y</span><span class="op" id="3026275">)</span><span class="op" id="3026276">-</span><span class="num" id="3026277">1</span>&nbsp;<span class="op" id="3026279">||</span>&nbsp;<span class="ident" id="3026282">j</span>&nbsp;<span class="op" id="3026284">!=</span>&nbsp;<span class="num" id="3026287">0</span>&nbsp;<span class="op" id="3026289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3026295">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3026344">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3026396">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026447">zz</span>&nbsp;<span class="op" id="3026450">=</span>&nbsp;<span class="ident" id="3026452">zz</span><span class="op" id="3026454">.</span><span class="ident" id="3026455">mul</span><span class="op" id="3026458">(</span><span class="ident" id="3026459">z</span><span class="op" id="3026460">,</span>&nbsp;<span class="ident" id="3026462">z</span><span class="op" id="3026463">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026469">zz</span><span class="op" id="3026471">,</span>&nbsp;<span class="ident" id="3026473">z</span>&nbsp;<span class="op" id="3026475">=</span>&nbsp;<span class="ident" id="3026477">z</span><span class="op" id="3026478">,</span>&nbsp;<span class="ident" id="3026480">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026487">zz</span><span class="op" id="3026489">,</span>&nbsp;<span class="ident" id="3026491">r</span>&nbsp;<span class="op" id="3026493">=</span>&nbsp;<span class="ident" id="3026495">zz</span><span class="op" id="3026497">.</span><span class="ident" id="3026498">div</span><span class="op" id="3026501">(</span><span class="ident" id="3026502">r</span><span class="op" id="3026503">,</span>&nbsp;<span class="ident" id="3026505">z</span><span class="op" id="3026506">,</span>&nbsp;<span class="ident" id="3026508">m</span><span class="op" id="3026509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026515">z</span><span class="op" id="3026516">,</span>&nbsp;<span class="ident" id="3026518">r</span>&nbsp;<span class="op" id="3026520">=</span>&nbsp;<span class="ident" id="3026522">r</span><span class="op" id="3026523">,</span>&nbsp;<span class="ident" id="3026525">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026532">zz</span>&nbsp;<span class="op" id="3026535">=</span>&nbsp;<span class="ident" id="3026537">zz</span><span class="op" id="3026539">.</span><span class="ident" id="3026540">mul</span><span class="op" id="3026543">(</span><span class="ident" id="3026544">z</span><span class="op" id="3026545">,</span>&nbsp;<span class="ident" id="3026547">z</span><span class="op" id="3026548">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026554">zz</span><span class="op" id="3026556">,</span>&nbsp;<span class="ident" id="3026558">z</span>&nbsp;<span class="op" id="3026560">=</span>&nbsp;<span class="ident" id="3026562">z</span><span class="op" id="3026563">,</span>&nbsp;<span class="ident" id="3026565">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026572">zz</span><span class="op" id="3026574">,</span>&nbsp;<span class="ident" id="3026576">r</span>&nbsp;<span class="op" id="3026578">=</span>&nbsp;<span class="ident" id="3026580">zz</span><span class="op" id="3026582">.</span><span class="ident" id="3026583">div</span><span class="op" id="3026586">(</span><span class="ident" id="3026587">r</span><span class="op" id="3026588">,</span>&nbsp;<span class="ident" id="3026590">z</span><span class="op" id="3026591">,</span>&nbsp;<span class="ident" id="3026593">m</span><span class="op" id="3026594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026600">z</span><span class="op" id="3026601">,</span>&nbsp;<span class="ident" id="3026603">r</span>&nbsp;<span class="op" id="3026605">=</span>&nbsp;<span class="ident" id="3026607">r</span><span class="op" id="3026608">,</span>&nbsp;<span class="ident" id="3026610">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026617">zz</span>&nbsp;<span class="op" id="3026620">=</span>&nbsp;<span class="ident" id="3026622">zz</span><span class="op" id="3026624">.</span><span class="ident" id="3026625">mul</span><span class="op" id="3026628">(</span><span class="ident" id="3026629">z</span><span class="op" id="3026630">,</span>&nbsp;<span class="ident" id="3026632">z</span><span class="op" id="3026633">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026639">zz</span><span class="op" id="3026641">,</span>&nbsp;<span class="ident" id="3026643">z</span>&nbsp;<span class="op" id="3026645">=</span>&nbsp;<span class="ident" id="3026647">z</span><span class="op" id="3026648">,</span>&nbsp;<span class="ident" id="3026650">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026657">zz</span><span class="op" id="3026659">,</span>&nbsp;<span class="ident" id="3026661">r</span>&nbsp;<span class="op" id="3026663">=</span>&nbsp;<span class="ident" id="3026665">zz</span><span class="op" id="3026667">.</span><span class="ident" id="3026668">div</span><span class="op" id="3026671">(</span><span class="ident" id="3026672">r</span><span class="op" id="3026673">,</span>&nbsp;<span class="ident" id="3026675">z</span><span class="op" id="3026676">,</span>&nbsp;<span class="ident" id="3026678">m</span><span class="op" id="3026679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026685">z</span><span class="op" id="3026686">,</span>&nbsp;<span class="ident" id="3026688">r</span>&nbsp;<span class="op" id="3026690">=</span>&nbsp;<span class="ident" id="3026692">r</span><span class="op" id="3026693">,</span>&nbsp;<span class="ident" id="3026695">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026702">zz</span>&nbsp;<span class="op" id="3026705">=</span>&nbsp;<span class="ident" id="3026707">zz</span><span class="op" id="3026709">.</span><span class="ident" id="3026710">mul</span><span class="op" id="3026713">(</span><span class="ident" id="3026714">z</span><span class="op" id="3026715">,</span>&nbsp;<span class="ident" id="3026717">z</span><span class="op" id="3026718">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026724">zz</span><span class="op" id="3026726">,</span>&nbsp;<span class="ident" id="3026728">z</span>&nbsp;<span class="op" id="3026730">=</span>&nbsp;<span class="ident" id="3026732">z</span><span class="op" id="3026733">,</span>&nbsp;<span class="ident" id="3026735">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026742">zz</span><span class="op" id="3026744">,</span>&nbsp;<span class="ident" id="3026746">r</span>&nbsp;<span class="op" id="3026748">=</span>&nbsp;<span class="ident" id="3026750">zz</span><span class="op" id="3026752">.</span><span class="ident" id="3026753">div</span><span class="op" id="3026756">(</span><span class="ident" id="3026757">r</span><span class="op" id="3026758">,</span>&nbsp;<span class="ident" id="3026760">z</span><span class="op" id="3026761">,</span>&nbsp;<span class="ident" id="3026763">m</span><span class="op" id="3026764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026770">z</span><span class="op" id="3026771">,</span>&nbsp;<span class="ident" id="3026773">r</span>&nbsp;<span class="op" id="3026775">=</span>&nbsp;<span class="ident" id="3026777">r</span><span class="op" id="3026778">,</span>&nbsp;<span class="ident" id="3026780">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026791">zz</span>&nbsp;<span class="op" id="3026794">=</span>&nbsp;<span class="ident" id="3026796">zz</span><span class="op" id="3026798">.</span><span class="ident" id="3026799">mul</span><span class="op" id="3026802">(</span><span class="ident" id="3026803">z</span><span class="op" id="3026804">,</span>&nbsp;<span class="ident" id="3026806">powers</span><span class="op" id="3026812">[</span><span class="ident" id="3026813">yi</span><span class="op" id="3026815">&gt;&gt;</span><span class="op" id="3026817">(</span><span class="ident" id="3026818">_W</span><span class="op" id="3026820">-</span><span class="ident" id="3026821">n</span><span class="op" id="3026822">)</span><span class="op" id="3026823">]</span><span class="op" id="3026824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026829">zz</span><span class="op" id="3026831">,</span>&nbsp;<span class="ident" id="3026833">z</span>&nbsp;<span class="op" id="3026835">=</span>&nbsp;<span class="ident" id="3026837">z</span><span class="op" id="3026838">,</span>&nbsp;<span class="ident" id="3026840">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026846">zz</span><span class="op" id="3026848">,</span>&nbsp;<span class="ident" id="3026850">r</span>&nbsp;<span class="op" id="3026852">=</span>&nbsp;<span class="ident" id="3026854">zz</span><span class="op" id="3026856">.</span><span class="ident" id="3026857">div</span><span class="op" id="3026860">(</span><span class="ident" id="3026861">r</span><span class="op" id="3026862">,</span>&nbsp;<span class="ident" id="3026864">z</span><span class="op" id="3026865">,</span>&nbsp;<span class="ident" id="3026867">m</span><span class="op" id="3026868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026873">z</span><span class="op" id="3026874">,</span>&nbsp;<span class="ident" id="3026876">r</span>&nbsp;<span class="op" id="3026878">=</span>&nbsp;<span class="ident" id="3026880">r</span><span class="op" id="3026881">,</span>&nbsp;<span class="ident" id="3026883">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3026889">yi</span>&nbsp;<span class="op" id="3026892">&lt;&lt;=</span>&nbsp;<span class="ident" id="3026896">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3026903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3026907">return</span>&nbsp;<span class="ident" id="3026914">z</span><span class="op" id="3026915">.</span><span class="ident" id="3026916">norm</span><span class="op" id="3026920">(</span><span class="op" id="3026921">)</span><br>
<span class="lineno">1380</span><span class="op" id="3026923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3026926">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3027005">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3027070">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3027110">func</span>&nbsp;<span class="op" id="3027115">(</span><span class="ident" id="3027116">n</span>&nbsp;<span class="ident" id="3027118">nat</span><span class="op" id="3027121">)</span>&nbsp;<span class="ident" id="3027123">probablyPrime</span><span class="op" id="3027136">(</span><span class="ident" id="3027137">reps</span>&nbsp;<span class="builtintype" id="3027142">int</span><span class="op" id="3027145">)</span>&nbsp;<span class="builtintype" id="3027147">bool</span>&nbsp;<span class="op" id="3027152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027155">if</span>&nbsp;<span class="builtinfunc" id="3027158">len</span><span class="op" id="3027161">(</span><span class="ident" id="3027162">n</span><span class="op" id="3027163">)</span>&nbsp;<span class="op" id="3027165">==</span>&nbsp;<span class="num" id="3027168">0</span>&nbsp;<span class="op" id="3027170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027174">return</span>&nbsp;<span class="builtintype" id="3027181">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027192">if</span>&nbsp;<span class="builtinfunc" id="3027195">len</span><span class="op" id="3027198">(</span><span class="ident" id="3027199">n</span><span class="op" id="3027200">)</span>&nbsp;<span class="op" id="3027202">==</span>&nbsp;<span class="num" id="3027205">1</span>&nbsp;<span class="op" id="3027207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027211">if</span>&nbsp;<span class="ident" id="3027214">n</span><span class="op" id="3027215">[</span><span class="num" id="3027216">0</span><span class="op" id="3027217">]</span>&nbsp;<span class="op" id="3027219">&lt;</span>&nbsp;<span class="num" id="3027221">2</span>&nbsp;<span class="op" id="3027223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027228">return</span>&nbsp;<span class="builtintype" id="3027235">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027248">if</span>&nbsp;<span class="ident" id="3027251">n</span><span class="op" id="3027252">[</span><span class="num" id="3027253">0</span><span class="op" id="3027254">]</span><span class="op" id="3027255">%</span><span class="num" id="3027256">2</span>&nbsp;<span class="op" id="3027258">==</span>&nbsp;<span class="num" id="3027261">0</span>&nbsp;<span class="op" id="3027263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027268">return</span>&nbsp;<span class="ident" id="3027275">n</span><span class="op" id="3027276">[</span><span class="num" id="3027277">0</span><span class="op" id="3027278">]</span>&nbsp;<span class="op" id="3027280">==</span>&nbsp;<span class="num" id="3027283">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3027292">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3027350">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027389">switch</span>&nbsp;<span class="ident" id="3027396">n</span><span class="op" id="3027397">[</span><span class="num" id="3027398">0</span><span class="op" id="3027399">]</span>&nbsp;<span class="op" id="3027401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027405">case</span>&nbsp;<span class="num" id="3027410">3</span><span class="op" id="3027411">,</span>&nbsp;<span class="num" id="3027413">5</span><span class="op" id="3027414">,</span>&nbsp;<span class="num" id="3027416">7</span><span class="op" id="3027417">,</span>&nbsp;<span class="num" id="3027419">11</span><span class="op" id="3027421">,</span>&nbsp;<span class="num" id="3027423">13</span><span class="op" id="3027425">,</span>&nbsp;<span class="num" id="3027427">17</span><span class="op" id="3027429">,</span>&nbsp;<span class="num" id="3027431">19</span><span class="op" id="3027433">,</span>&nbsp;<span class="num" id="3027435">23</span><span class="op" id="3027437">,</span>&nbsp;<span class="num" id="3027439">29</span><span class="op" id="3027441">,</span>&nbsp;<span class="num" id="3027443">31</span><span class="op" id="3027445">,</span>&nbsp;<span class="num" id="3027447">37</span><span class="op" id="3027449">,</span>&nbsp;<span class="num" id="3027451">41</span><span class="op" id="3027453">,</span>&nbsp;<span class="num" id="3027455">43</span><span class="op" id="3027457">,</span>&nbsp;<span class="num" id="3027459">47</span><span class="op" id="3027461">,</span>&nbsp;<span class="num" id="3027463">53</span><span class="op" id="3027465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027470">return</span>&nbsp;<span class="builtintype" id="3027477">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027484">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027491">const</span>&nbsp;<span class="ident" id="3027497">primesProduct32</span>&nbsp;<span class="op" id="3027513">=</span>&nbsp;<span class="num" id="3027515">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3027534">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027569">const</span>&nbsp;<span class="ident" id="3027575">primesProduct64</span>&nbsp;<span class="op" id="3027591">=</span>&nbsp;<span class="num" id="3027593">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3027612">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027648">var</span>&nbsp;<span class="ident" id="3027652">r</span>&nbsp;<span class="ident" id="3027654">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027660">switch</span>&nbsp;<span class="ident" id="3027667">_W</span>&nbsp;<span class="op" id="3027670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027673">case</span>&nbsp;<span class="num" id="3027678">32</span><span class="op" id="3027680">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3027684">r</span>&nbsp;<span class="op" id="3027686">=</span>&nbsp;<span class="ident" id="3027688">n</span><span class="op" id="3027689">.</span><span class="ident" id="3027690">modW</span><span class="op" id="3027694">(</span><span class="ident" id="3027695">primesProduct32</span><span class="op" id="3027710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027713">case</span>&nbsp;<span class="num" id="3027718">64</span><span class="op" id="3027720">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3027724">r</span>&nbsp;<span class="op" id="3027726">=</span>&nbsp;<span class="ident" id="3027728">n</span><span class="op" id="3027729">.</span><span class="ident" id="3027730">modW</span><span class="op" id="3027734">(</span><span class="ident" id="3027735">primesProduct64</span>&nbsp;<span class="op" id="3027751">&amp;</span>&nbsp;<span class="ident" id="3027753">_M</span><span class="op" id="3027755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027758">default</span><span class="op" id="3027765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3027769">panic</span><span class="op" id="3027774">(</span><span class="string" id="3027775">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3027794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027801">if</span>&nbsp;<span class="ident" id="3027804">r</span><span class="op" id="3027805">%</span><span class="num" id="3027806">3</span>&nbsp;<span class="op" id="3027808">==</span>&nbsp;<span class="num" id="3027811">0</span>&nbsp;<span class="op" id="3027813">||</span>&nbsp;<span class="ident" id="3027816">r</span><span class="op" id="3027817">%</span><span class="num" id="3027818">5</span>&nbsp;<span class="op" id="3027820">==</span>&nbsp;<span class="num" id="3027823">0</span>&nbsp;<span class="op" id="3027825">||</span>&nbsp;<span class="ident" id="3027828">r</span><span class="op" id="3027829">%</span><span class="num" id="3027830">7</span>&nbsp;<span class="op" id="3027832">==</span>&nbsp;<span class="num" id="3027835">0</span>&nbsp;<span class="op" id="3027837">||</span>&nbsp;<span class="ident" id="3027840">r</span><span class="op" id="3027841">%</span><span class="num" id="3027842">11</span>&nbsp;<span class="op" id="3027845">==</span>&nbsp;<span class="num" id="3027848">0</span>&nbsp;<span class="op" id="3027850">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3027855">r</span><span class="op" id="3027856">%</span><span class="num" id="3027857">13</span>&nbsp;<span class="op" id="3027860">==</span>&nbsp;<span class="num" id="3027863">0</span>&nbsp;<span class="op" id="3027865">||</span>&nbsp;<span class="ident" id="3027868">r</span><span class="op" id="3027869">%</span><span class="num" id="3027870">17</span>&nbsp;<span class="op" id="3027873">==</span>&nbsp;<span class="num" id="3027876">0</span>&nbsp;<span class="op" id="3027878">||</span>&nbsp;<span class="ident" id="3027881">r</span><span class="op" id="3027882">%</span><span class="num" id="3027883">19</span>&nbsp;<span class="op" id="3027886">==</span>&nbsp;<span class="num" id="3027889">0</span>&nbsp;<span class="op" id="3027891">||</span>&nbsp;<span class="ident" id="3027894">r</span><span class="op" id="3027895">%</span><span class="num" id="3027896">23</span>&nbsp;<span class="op" id="3027899">==</span>&nbsp;<span class="num" id="3027902">0</span>&nbsp;<span class="op" id="3027904">||</span>&nbsp;<span class="ident" id="3027907">r</span><span class="op" id="3027908">%</span><span class="num" id="3027909">29</span>&nbsp;<span class="op" id="3027912">==</span>&nbsp;<span class="num" id="3027915">0</span>&nbsp;<span class="op" id="3027917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027921">return</span>&nbsp;<span class="builtintype" id="3027928">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3027935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3027939">if</span>&nbsp;<span class="ident" id="3027942">_W</span>&nbsp;<span class="op" id="3027945">==</span>&nbsp;<span class="num" id="3027948">64</span>&nbsp;<span class="op" id="3027951">&amp;&amp;</span>&nbsp;<span class="op" id="3027954">(</span><span class="ident" id="3027955">r</span><span class="op" id="3027956">%</span><span class="num" id="3027957">31</span>&nbsp;<span class="op" id="3027960">==</span>&nbsp;<span class="num" id="3027963">0</span>&nbsp;<span class="op" id="3027965">||</span>&nbsp;<span class="ident" id="3027968">r</span><span class="op" id="3027969">%</span><span class="num" id="3027970">37</span>&nbsp;<span class="op" id="3027973">==</span>&nbsp;<span class="num" id="3027976">0</span>&nbsp;<span class="op" id="3027978">||</span>&nbsp;<span class="ident" id="3027981">r</span><span class="op" id="3027982">%</span><span class="num" id="3027983">41</span>&nbsp;<span class="op" id="3027986">==</span>&nbsp;<span class="num" id="3027989">0</span>&nbsp;<span class="op" id="3027991">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3027996">r</span><span class="op" id="3027997">%</span><span class="num" id="3027998">43</span>&nbsp;<span class="op" id="3028001">==</span>&nbsp;<span class="num" id="3028004">0</span>&nbsp;<span class="op" id="3028006">||</span>&nbsp;<span class="ident" id="3028009">r</span><span class="op" id="3028010">%</span><span class="num" id="3028011">47</span>&nbsp;<span class="op" id="3028014">==</span>&nbsp;<span class="num" id="3028017">0</span>&nbsp;<span class="op" id="3028019">||</span>&nbsp;<span class="ident" id="3028022">r</span><span class="op" id="3028023">%</span><span class="num" id="3028024">53</span>&nbsp;<span class="op" id="3028027">==</span>&nbsp;<span class="num" id="3028030">0</span><span class="op" id="3028031">)</span>&nbsp;<span class="op" id="3028033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028037">return</span>&nbsp;<span class="builtintype" id="3028044">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3028051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028055">nm1</span>&nbsp;<span class="op" id="3028059">:=</span>&nbsp;<span class="ident" id="3028062">nat</span><span class="op" id="3028065">(</span><span class="builtintype" id="3028066">nil</span><span class="op" id="3028069">)</span><span class="op" id="3028070">.</span><span class="ident" id="3028071">sub</span><span class="op" id="3028074">(</span><span class="ident" id="3028075">n</span><span class="op" id="3028076">,</span>&nbsp;<span class="ident" id="3028078">natOne</span><span class="op" id="3028084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3028087">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028129">k</span>&nbsp;<span class="op" id="3028131">:=</span>&nbsp;<span class="ident" id="3028134">nm1</span><span class="op" id="3028137">.</span><span class="ident" id="3028138">trailingZeroBits</span><span class="op" id="3028154">(</span><span class="op" id="3028155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028158">q</span>&nbsp;<span class="op" id="3028160">:=</span>&nbsp;<span class="ident" id="3028163">nat</span><span class="op" id="3028166">(</span><span class="builtintype" id="3028167">nil</span><span class="op" id="3028170">)</span><span class="op" id="3028171">.</span><span class="ident" id="3028172">shr</span><span class="op" id="3028175">(</span><span class="ident" id="3028176">nm1</span><span class="op" id="3028179">,</span>&nbsp;<span class="ident" id="3028181">k</span><span class="op" id="3028182">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028186">nm3</span>&nbsp;<span class="op" id="3028190">:=</span>&nbsp;<span class="ident" id="3028193">nat</span><span class="op" id="3028196">(</span><span class="builtintype" id="3028197">nil</span><span class="op" id="3028200">)</span><span class="op" id="3028201">.</span><span class="ident" id="3028202">sub</span><span class="op" id="3028205">(</span><span class="ident" id="3028206">nm1</span><span class="op" id="3028209">,</span>&nbsp;<span class="ident" id="3028211">natTwo</span><span class="op" id="3028217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028220">rand</span>&nbsp;<span class="op" id="3028225">:=</span>&nbsp;<span class="ident" id="3028228">rand</span><span class="op" id="3028232">.</span><span class="ident" id="3028233">New</span><span class="op" id="3028236">(</span><span class="ident" id="3028237">rand</span><span class="op" id="3028241">.</span><span class="ident" id="3028242">NewSource</span><span class="op" id="3028251">(</span><span class="ident" id="3028252">int64</span><span class="op" id="3028257">(</span><span class="ident" id="3028258">n</span><span class="op" id="3028259">[</span><span class="num" id="3028260">0</span><span class="op" id="3028261">]</span><span class="op" id="3028262">)</span><span class="op" id="3028263">)</span><span class="op" id="3028264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028268">var</span>&nbsp;<span class="ident" id="3028272">x</span><span class="op" id="3028273">,</span>&nbsp;<span class="ident" id="3028275">y</span><span class="op" id="3028276">,</span>&nbsp;<span class="ident" id="3028278">quotient</span>&nbsp;<span class="ident" id="3028287">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028292">nm3Len</span>&nbsp;<span class="op" id="3028299">:=</span>&nbsp;<span class="ident" id="3028302">nm3</span><span class="op" id="3028305">.</span><span class="ident" id="3028306">bitLen</span><span class="op" id="3028312">(</span><span class="op" id="3028313">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3028316">NextRandom</span><span class="op" id="3028326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028329">for</span>&nbsp;<span class="ident" id="3028333">i</span>&nbsp;<span class="op" id="3028335">:=</span>&nbsp;<span class="num" id="3028338">0</span><span class="op" id="3028339">;</span>&nbsp;<span class="ident" id="3028341">i</span>&nbsp;<span class="op" id="3028343">&lt;</span>&nbsp;<span class="ident" id="3028345">reps</span><span class="op" id="3028349">;</span>&nbsp;<span class="ident" id="3028351">i</span><span class="op" id="3028352">++</span>&nbsp;<span class="op" id="3028355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028359">x</span>&nbsp;<span class="op" id="3028361">=</span>&nbsp;<span class="ident" id="3028363">x</span><span class="op" id="3028364">.</span><span class="ident" id="3028365">random</span><span class="op" id="3028371">(</span><span class="ident" id="3028372">rand</span><span class="op" id="3028376">,</span>&nbsp;<span class="ident" id="3028378">nm3</span><span class="op" id="3028381">,</span>&nbsp;<span class="ident" id="3028383">nm3Len</span><span class="op" id="3028389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028393">x</span>&nbsp;<span class="op" id="3028395">=</span>&nbsp;<span class="ident" id="3028397">x</span><span class="op" id="3028398">.</span><span class="ident" id="3028399">add</span><span class="op" id="3028402">(</span><span class="ident" id="3028403">x</span><span class="op" id="3028404">,</span>&nbsp;<span class="ident" id="3028406">natTwo</span><span class="op" id="3028412">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028416">y</span>&nbsp;<span class="op" id="3028418">=</span>&nbsp;<span class="ident" id="3028420">y</span><span class="op" id="3028421">.</span><span class="ident" id="3028422">expNN</span><span class="op" id="3028427">(</span><span class="ident" id="3028428">x</span><span class="op" id="3028429">,</span>&nbsp;<span class="ident" id="3028431">q</span><span class="op" id="3028432">,</span>&nbsp;<span class="ident" id="3028434">n</span><span class="op" id="3028435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028439">if</span>&nbsp;<span class="ident" id="3028442">y</span><span class="op" id="3028443">.</span><span class="ident" id="3028444">cmp</span><span class="op" id="3028447">(</span><span class="ident" id="3028448">natOne</span><span class="op" id="3028454">)</span>&nbsp;<span class="op" id="3028456">==</span>&nbsp;<span class="num" id="3028459">0</span>&nbsp;<span class="op" id="3028461">||</span>&nbsp;<span class="ident" id="3028464">y</span><span class="op" id="3028465">.</span><span class="ident" id="3028466">cmp</span><span class="op" id="3028469">(</span><span class="ident" id="3028470">nm1</span><span class="op" id="3028473">)</span>&nbsp;<span class="op" id="3028475">==</span>&nbsp;<span class="num" id="3028478">0</span>&nbsp;<span class="op" id="3028480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028485">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3028496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028500">for</span>&nbsp;<span class="ident" id="3028504">j</span>&nbsp;<span class="op" id="3028506">:=</span>&nbsp;<span class="builtintype" id="3028509">uint</span><span class="op" id="3028513">(</span><span class="num" id="3028514">1</span><span class="op" id="3028515">)</span><span class="op" id="3028516">;</span>&nbsp;<span class="ident" id="3028518">j</span>&nbsp;<span class="op" id="3028520">&lt;</span>&nbsp;<span class="ident" id="3028522">k</span><span class="op" id="3028523">;</span>&nbsp;<span class="ident" id="3028525">j</span><span class="op" id="3028526">++</span>&nbsp;<span class="op" id="3028529">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028534">y</span>&nbsp;<span class="op" id="3028536">=</span>&nbsp;<span class="ident" id="3028538">y</span><span class="op" id="3028539">.</span><span class="ident" id="3028540">mul</span><span class="op" id="3028543">(</span><span class="ident" id="3028544">y</span><span class="op" id="3028545">,</span>&nbsp;<span class="ident" id="3028547">y</span><span class="op" id="3028548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3028553">quotient</span><span class="op" id="3028561">,</span>&nbsp;<span class="ident" id="3028563">y</span>&nbsp;<span class="op" id="3028565">=</span>&nbsp;<span class="ident" id="3028567">quotient</span><span class="op" id="3028575">.</span><span class="ident" id="3028576">div</span><span class="op" id="3028579">(</span><span class="ident" id="3028580">y</span><span class="op" id="3028581">,</span>&nbsp;<span class="ident" id="3028583">y</span><span class="op" id="3028584">,</span>&nbsp;<span class="ident" id="3028586">n</span><span class="op" id="3028587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028592">if</span>&nbsp;<span class="ident" id="3028595">y</span><span class="op" id="3028596">.</span><span class="ident" id="3028597">cmp</span><span class="op" id="3028600">(</span><span class="ident" id="3028601">nm1</span><span class="op" id="3028604">)</span>&nbsp;<span class="op" id="3028606">==</span>&nbsp;<span class="num" id="3028609">0</span>&nbsp;<span class="op" id="3028611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028617">continue</span>&nbsp;<span class="ident" id="3028626">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3028640">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028645">if</span>&nbsp;<span class="ident" id="3028648">y</span><span class="op" id="3028649">.</span><span class="ident" id="3028650">cmp</span><span class="op" id="3028653">(</span><span class="ident" id="3028654">natOne</span><span class="op" id="3028660">)</span>&nbsp;<span class="op" id="3028662">==</span>&nbsp;<span class="num" id="3028665">0</span>&nbsp;<span class="op" id="3028667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028673">return</span>&nbsp;<span class="builtintype" id="3028680">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3028689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3028693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028697">return</span>&nbsp;<span class="builtintype" id="3028704">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3028711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3028715">return</span>&nbsp;<span class="builtintype" id="3028722">true</span><br>
<span class="lineno"></span><span class="op" id="3028727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3028730">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3028797">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3028864">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3028931">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3028961">func</span>&nbsp;<span class="op" id="3028966">(</span><span class="ident" id="3028967">z</span>&nbsp;<span class="ident" id="3028969">nat</span><span class="op" id="3028972">)</span>&nbsp;<span class="ident" id="3028974">bytes</span><span class="op" id="3028979">(</span><span class="ident" id="3028980">buf</span>&nbsp;<span class="op" id="3028984">[</span><span class="op" id="3028985">]</span><span class="builtintype" id="3028986">byte</span><span class="op" id="3028990">)</span>&nbsp;<span class="op" id="3028992">(</span><span class="ident" id="3028993">i</span>&nbsp;<span class="builtintype" id="3028995">int</span><span class="op" id="3028998">)</span>&nbsp;<span class="op" id="3029000">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029003">i</span>&nbsp;<span class="op" id="3029005">=</span>&nbsp;<span class="builtinfunc" id="3029007">len</span><span class="op" id="3029010">(</span><span class="ident" id="3029011">buf</span><span class="op" id="3029014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029017">for</span>&nbsp;<span class="ident" id="3029021">_</span><span class="op" id="3029022">,</span>&nbsp;<span class="ident" id="3029024">d</span>&nbsp;<span class="op" id="3029026">:=</span>&nbsp;<span class="keyword" id="3029029">range</span>&nbsp;<span class="ident" id="3029035">z</span>&nbsp;<span class="op" id="3029037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029041">for</span>&nbsp;<span class="ident" id="3029045">j</span>&nbsp;<span class="op" id="3029047">:=</span>&nbsp;<span class="num" id="3029050">0</span><span class="op" id="3029051">;</span>&nbsp;<span class="ident" id="3029053">j</span>&nbsp;<span class="op" id="3029055">&lt;</span>&nbsp;<span class="ident" id="3029057">_S</span><span class="op" id="3029059">;</span>&nbsp;<span class="ident" id="3029061">j</span><span class="op" id="3029062">++</span>&nbsp;<span class="op" id="3029065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029070">i</span><span class="op" id="3029071">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029077">buf</span><span class="op" id="3029080">[</span><span class="ident" id="3029081">i</span><span class="op" id="3029082">]</span>&nbsp;<span class="op" id="3029084">=</span>&nbsp;<span class="builtintype" id="3029086">byte</span><span class="op" id="3029090">(</span><span class="ident" id="3029091">d</span><span class="op" id="3029092">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029097">d</span>&nbsp;<span class="op" id="3029099">&gt;&gt;=</span>&nbsp;<span class="num" id="3029103">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029114">for</span>&nbsp;<span class="ident" id="3029118">i</span>&nbsp;<span class="op" id="3029120">&lt;</span>&nbsp;<span class="builtinfunc" id="3029122">len</span><span class="op" id="3029125">(</span><span class="ident" id="3029126">buf</span><span class="op" id="3029129">)</span>&nbsp;<span class="op" id="3029131">&amp;&amp;</span>&nbsp;<span class="ident" id="3029134">buf</span><span class="op" id="3029137">[</span><span class="ident" id="3029138">i</span><span class="op" id="3029139">]</span>&nbsp;<span class="op" id="3029141">==</span>&nbsp;<span class="num" id="3029144">0</span>&nbsp;<span class="op" id="3029146">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029150">i</span><span class="op" id="3029151">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029159">return</span><br>
<span class="lineno"></span><span class="op" id="3029166">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3029169">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3029234">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3029283">func</span>&nbsp;<span class="op" id="3029288">(</span><span class="ident" id="3029289">z</span>&nbsp;<span class="ident" id="3029291">nat</span><span class="op" id="3029294">)</span>&nbsp;<span class="ident" id="3029296">setBytes</span><span class="op" id="3029304">(</span><span class="ident" id="3029305">buf</span>&nbsp;<span class="op" id="3029309">[</span><span class="op" id="3029310">]</span><span class="builtintype" id="3029311">byte</span><span class="op" id="3029315">)</span>&nbsp;<span class="ident" id="3029317">nat</span>&nbsp;<span class="op" id="3029321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029324">z</span>&nbsp;<span class="op" id="3029326">=</span>&nbsp;<span class="ident" id="3029328">z</span><span class="op" id="3029329">.</span><span class="builtinfunc" id="3029330">make</span><span class="op" id="3029334">(</span><span class="op" id="3029335">(</span><span class="builtinfunc" id="3029336">len</span><span class="op" id="3029339">(</span><span class="ident" id="3029340">buf</span><span class="op" id="3029343">)</span>&nbsp;<span class="op" id="3029345">+</span>&nbsp;<span class="ident" id="3029347">_S</span>&nbsp;<span class="op" id="3029350">-</span>&nbsp;<span class="num" id="3029352">1</span><span class="op" id="3029353">)</span>&nbsp;<span class="op" id="3029355">/</span>&nbsp;<span class="ident" id="3029357">_S</span><span class="op" id="3029359">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029363">k</span>&nbsp;<span class="op" id="3029365">:=</span>&nbsp;<span class="num" id="3029368">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029371">s</span>&nbsp;<span class="op" id="3029373">:=</span>&nbsp;<span class="builtintype" id="3029376">uint</span><span class="op" id="3029380">(</span><span class="num" id="3029381">0</span><span class="op" id="3029382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029385">var</span>&nbsp;<span class="ident" id="3029389">d</span>&nbsp;<span class="ident" id="3029391">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029397">for</span>&nbsp;<span class="ident" id="3029401">i</span>&nbsp;<span class="op" id="3029403">:=</span>&nbsp;<span class="builtinfunc" id="3029406">len</span><span class="op" id="3029409">(</span><span class="ident" id="3029410">buf</span><span class="op" id="3029413">)</span><span class="op" id="3029414">;</span>&nbsp;<span class="ident" id="3029416">i</span>&nbsp;<span class="op" id="3029418">&gt;</span>&nbsp;<span class="num" id="3029420">0</span><span class="op" id="3029421">;</span>&nbsp;<span class="ident" id="3029423">i</span><span class="op" id="3029424">--</span>&nbsp;<span class="op" id="3029427">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029431">d</span>&nbsp;<span class="op" id="3029433">|=</span>&nbsp;<span class="ident" id="3029436">Word</span><span class="op" id="3029440">(</span><span class="ident" id="3029441">buf</span><span class="op" id="3029444">[</span><span class="ident" id="3029445">i</span><span class="op" id="3029446">-</span><span class="num" id="3029447">1</span><span class="op" id="3029448">]</span><span class="op" id="3029449">)</span>&nbsp;<span class="op" id="3029451">&lt;&lt;</span>&nbsp;<span class="ident" id="3029454">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029458">if</span>&nbsp;<span class="ident" id="3029461">s</span>&nbsp;<span class="op" id="3029463">+=</span>&nbsp;<span class="num" id="3029466">8</span><span class="op" id="3029467">;</span>&nbsp;<span class="ident" id="3029469">s</span>&nbsp;<span class="op" id="3029471">==</span>&nbsp;<span class="ident" id="3029474">_S</span><span class="op" id="3029476">*</span><span class="num" id="3029477">8</span>&nbsp;<span class="op" id="3029479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029484">z</span><span class="op" id="3029485">[</span><span class="ident" id="3029486">k</span><span class="op" id="3029487">]</span>&nbsp;<span class="op" id="3029489">=</span>&nbsp;<span class="ident" id="3029491">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029496">k</span><span class="op" id="3029497">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029503">s</span>&nbsp;<span class="op" id="3029505">=</span>&nbsp;<span class="num" id="3029507">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029512">d</span>&nbsp;<span class="op" id="3029514">=</span>&nbsp;<span class="num" id="3029516">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029526">if</span>&nbsp;<span class="ident" id="3029529">k</span>&nbsp;<span class="op" id="3029531">&lt;</span>&nbsp;<span class="builtinfunc" id="3029533">len</span><span class="op" id="3029536">(</span><span class="ident" id="3029537">z</span><span class="op" id="3029538">)</span>&nbsp;<span class="op" id="3029540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3029544">z</span><span class="op" id="3029545">[</span><span class="ident" id="3029546">k</span><span class="op" id="3029547">]</span>&nbsp;<span class="op" id="3029549">=</span>&nbsp;<span class="ident" id="3029551">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3029554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3029558">return</span>&nbsp;<span class="ident" id="3029565">z</span><span class="op" id="3029566">.</span><span class="ident" id="3029567">norm</span><span class="op" id="3029571">(</span><span class="op" id="3029572">)</span><br>
<span class="lineno"></span><span class="op" id="3029574">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
