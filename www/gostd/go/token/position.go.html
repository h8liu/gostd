<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html" class="current">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4792761">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4792816">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4792870">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4792921">package</span>&nbsp;<span class="ident" id="4792929">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4792936">import</span>&nbsp;<span class="op" id="4792943">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4792946">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4792953">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4792961">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4792968">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4792971">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4793052">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4793066">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4793117">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="4793167">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="4793217">//</span><br>
<span class="lineno">20</span><span class="keyword" id="4793220">type</span>&nbsp;<span class="ident" id="4793225">Position</span>&nbsp;<span class="keyword" id="4793234">struct</span>&nbsp;<span class="op" id="4793241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793244">Filename</span>&nbsp;<span class="builtintype" id="4793253">string</span>&nbsp;<span class="comment" id="4793260">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793281">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4793290">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4793297">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793323">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4793332">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4793339">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793370">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4793379">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4793386">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="4793436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4793439">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4793489">func</span>&nbsp;<span class="op" id="4793494">(</span><span class="ident" id="4793495">pos</span>&nbsp;<span class="op" id="4793499">*</span><span class="ident" id="4793500">Position</span><span class="op" id="4793508">)</span>&nbsp;<span class="ident" id="4793510">IsValid</span><span class="op" id="4793517">(</span><span class="op" id="4793518">)</span>&nbsp;<span class="builtintype" id="4793520">bool</span>&nbsp;<span class="op" id="4793525">{</span>&nbsp;<span class="keyword" id="4793527">return</span>&nbsp;<span class="ident" id="4793534">pos</span><span class="op" id="4793537">.</span><span class="ident" id="4793538">Line</span>&nbsp;<span class="op" id="4793543">&gt;</span>&nbsp;<span class="num" id="4793545">0</span>&nbsp;<span class="op" id="4793547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4793550">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="4793602">//</span><br>
<span class="lineno"></span><span class="comment" id="4793605">//&nbsp;&nbsp;&nbsp;&nbsp;file:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4793658">//&nbsp;&nbsp;&nbsp;&nbsp;line:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4793714">//&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="4793769">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="4793827">//</span><br>
<span class="lineno"></span><span class="keyword" id="4793830">func</span>&nbsp;<span class="op" id="4793835">(</span><span class="ident" id="4793836">pos</span>&nbsp;<span class="ident" id="4793840">Position</span><span class="op" id="4793848">)</span>&nbsp;<span class="ident" id="4793850">String</span><span class="op" id="4793856">(</span><span class="op" id="4793857">)</span>&nbsp;<span class="builtintype" id="4793859">string</span>&nbsp;<span class="op" id="4793866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793869">s</span>&nbsp;<span class="op" id="4793871">:=</span>&nbsp;<span class="ident" id="4793874">pos</span><span class="op" id="4793877">.</span><span class="ident" id="4793878">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793888">if</span>&nbsp;<span class="ident" id="4793891">pos</span><span class="op" id="4793894">.</span><span class="ident" id="4793895">IsValid</span><span class="op" id="4793902">(</span><span class="op" id="4793903">)</span>&nbsp;<span class="op" id="4793905">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793909">if</span>&nbsp;<span class="ident" id="4793912">s</span>&nbsp;<span class="op" id="4793914">!=</span>&nbsp;<span class="string" id="4793917">&#34;&#34;</span>&nbsp;<span class="op" id="4793920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793925">s</span>&nbsp;<span class="op" id="4793927">+=</span>&nbsp;<span class="string" id="4793930">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4793940">s</span>&nbsp;<span class="op" id="4793942">+=</span>&nbsp;<span class="ident" id="4793945">fmt</span><span class="op" id="4793948">.</span><span class="ident" id="4793949">Sprintf</span><span class="op" id="4793956">(</span><span class="string" id="4793957">&#34;%d:%d&#34;</span><span class="op" id="4793964">,</span>&nbsp;<span class="ident" id="4793966">pos</span><span class="op" id="4793969">.</span><span class="ident" id="4793970">Line</span><span class="op" id="4793974">,</span>&nbsp;<span class="ident" id="4793976">pos</span><span class="op" id="4793979">.</span><span class="ident" id="4793980">Column</span><span class="op" id="4793986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4793989">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4793992">if</span>&nbsp;<span class="ident" id="4793995">s</span>&nbsp;<span class="op" id="4793997">==</span>&nbsp;<span class="string" id="4794000">&#34;&#34;</span>&nbsp;<span class="op" id="4794003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4794007">s</span>&nbsp;<span class="op" id="4794009">=</span>&nbsp;<span class="string" id="4794011">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4794016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4794019">return</span>&nbsp;<span class="ident" id="4794026">s</span><br>
<span class="lineno"></span><span class="op" id="4794028">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4794031">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="4794100">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="4794171">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="4794198">//</span><br>
<span class="lineno">55</span><span class="comment" id="4794201">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="4794279">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="4794357">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="4794369">//</span><br>
<span class="lineno"></span><span class="comment" id="4794372">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="4794439">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="4794508">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="4794577">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4794646">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="4794687">//</span><br>
<span class="lineno">65</span><span class="comment" id="4794690">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="4794766">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4794838">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="4794912">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4794988">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="4795048">//</span><br>
<span class="lineno"></span><span class="keyword" id="4795051">type</span>&nbsp;<span class="ident" id="4795056">Pos</span>&nbsp;<span class="builtintype" id="4795060">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4795065">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4795139">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="4795210">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4795280">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="4795325">//</span><br>
<span class="lineno"></span><span class="keyword" id="4795328">const</span>&nbsp;<span class="ident" id="4795334">NoPos</span>&nbsp;<span class="ident" id="4795340">Pos</span>&nbsp;<span class="op" id="4795344">=</span>&nbsp;<span class="num" id="4795346">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4795349">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4795399">func</span>&nbsp;<span class="op" id="4795404">(</span><span class="ident" id="4795405">p</span>&nbsp;<span class="ident" id="4795407">Pos</span><span class="op" id="4795410">)</span>&nbsp;<span class="ident" id="4795412">IsValid</span><span class="op" id="4795419">(</span><span class="op" id="4795420">)</span>&nbsp;<span class="builtintype" id="4795422">bool</span>&nbsp;<span class="op" id="4795427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4795430">return</span>&nbsp;<span class="ident" id="4795437">p</span>&nbsp;<span class="op" id="4795439">!=</span>&nbsp;<span class="ident" id="4795442">NoPos</span><br>
<span class="lineno"></span><span class="op" id="4795448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="4795451">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4795532">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4795541">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="4795598">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="4795649">//</span><br>
<span class="lineno"></span><span class="keyword" id="4795652">type</span>&nbsp;<span class="ident" id="4795657">File</span>&nbsp;<span class="keyword" id="4795662">struct</span>&nbsp;<span class="op" id="4795669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795672">set</span>&nbsp;&nbsp;<span class="op" id="4795677">*</span><span class="ident" id="4795678">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795687">name</span>&nbsp;<span class="builtintype" id="4795692">string</span>&nbsp;<span class="comment" id="4795699">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795736">base</span>&nbsp;<span class="builtintype" id="4795741">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795748">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795804">size</span>&nbsp;<span class="builtintype" id="4795809">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795816">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4795854">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4795901">lines</span>&nbsp;<span class="op" id="4795907">[</span><span class="op" id="4795908">]</span><span class="builtintype" id="4795909">int</span>&nbsp;<span class="comment" id="4795913">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796010">infos</span>&nbsp;<span class="op" id="4796016">[</span><span class="op" id="4796017">]</span><span class="ident" id="4796018">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="4796027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4796030">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4796098">func</span>&nbsp;<span class="op" id="4796103">(</span><span class="ident" id="4796104">f</span>&nbsp;<span class="op" id="4796106">*</span><span class="ident" id="4796107">File</span><span class="op" id="4796111">)</span>&nbsp;<span class="ident" id="4796113">Name</span><span class="op" id="4796117">(</span><span class="op" id="4796118">)</span>&nbsp;<span class="builtintype" id="4796120">string</span>&nbsp;<span class="op" id="4796127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796130">return</span>&nbsp;<span class="ident" id="4796137">f</span><span class="op" id="4796138">.</span><span class="ident" id="4796139">name</span><br>
<span class="lineno">105</span><span class="op" id="4796144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4796147">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4796217">func</span>&nbsp;<span class="op" id="4796222">(</span><span class="ident" id="4796223">f</span>&nbsp;<span class="op" id="4796225">*</span><span class="ident" id="4796226">File</span><span class="op" id="4796230">)</span>&nbsp;<span class="ident" id="4796232">Base</span><span class="op" id="4796236">(</span><span class="op" id="4796237">)</span>&nbsp;<span class="builtintype" id="4796239">int</span>&nbsp;<span class="op" id="4796243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796246">return</span>&nbsp;<span class="ident" id="4796253">f</span><span class="op" id="4796254">.</span><span class="ident" id="4796255">base</span><br>
<span class="lineno">110</span><span class="op" id="4796260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4796263">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="4796326">func</span>&nbsp;<span class="op" id="4796331">(</span><span class="ident" id="4796332">f</span>&nbsp;<span class="op" id="4796334">*</span><span class="ident" id="4796335">File</span><span class="op" id="4796339">)</span>&nbsp;<span class="ident" id="4796341">Size</span><span class="op" id="4796345">(</span><span class="op" id="4796346">)</span>&nbsp;<span class="builtintype" id="4796348">int</span>&nbsp;<span class="op" id="4796352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796355">return</span>&nbsp;<span class="ident" id="4796362">f</span><span class="op" id="4796363">.</span><span class="ident" id="4796364">size</span><br>
<span class="lineno">115</span><span class="op" id="4796369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4796372">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="4796424">func</span>&nbsp;<span class="op" id="4796429">(</span><span class="ident" id="4796430">f</span>&nbsp;<span class="op" id="4796432">*</span><span class="ident" id="4796433">File</span><span class="op" id="4796437">)</span>&nbsp;<span class="ident" id="4796439">LineCount</span><span class="op" id="4796448">(</span><span class="op" id="4796449">)</span>&nbsp;<span class="builtintype" id="4796451">int</span>&nbsp;<span class="op" id="4796455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796458">f</span><span class="op" id="4796459">.</span><span class="ident" id="4796460">set</span><span class="op" id="4796463">.</span><span class="ident" id="4796464">mutex</span><span class="op" id="4796469">.</span><span class="ident" id="4796470">RLock</span><span class="op" id="4796475">(</span><span class="op" id="4796476">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796479">n</span>&nbsp;<span class="op" id="4796481">:=</span>&nbsp;<span class="builtinfunc" id="4796484">len</span><span class="op" id="4796487">(</span><span class="ident" id="4796488">f</span><span class="op" id="4796489">.</span><span class="ident" id="4796490">lines</span><span class="op" id="4796495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796498">f</span><span class="op" id="4796499">.</span><span class="ident" id="4796500">set</span><span class="op" id="4796503">.</span><span class="ident" id="4796504">mutex</span><span class="op" id="4796509">.</span><span class="ident" id="4796510">RUnlock</span><span class="op" id="4796517">(</span><span class="op" id="4796518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796521">return</span>&nbsp;<span class="ident" id="4796528">n</span><br>
<span class="lineno"></span><span class="op" id="4796530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4796533">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4796581">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4796653">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4796726">//</span><br>
<span class="lineno"></span><span class="keyword" id="4796729">func</span>&nbsp;<span class="op" id="4796734">(</span><span class="ident" id="4796735">f</span>&nbsp;<span class="op" id="4796737">*</span><span class="ident" id="4796738">File</span><span class="op" id="4796742">)</span>&nbsp;<span class="ident" id="4796744">AddLine</span><span class="op" id="4796751">(</span><span class="ident" id="4796752">offset</span>&nbsp;<span class="builtintype" id="4796759">int</span><span class="op" id="4796762">)</span>&nbsp;<span class="op" id="4796764">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796767">f</span><span class="op" id="4796768">.</span><span class="ident" id="4796769">set</span><span class="op" id="4796772">.</span><span class="ident" id="4796773">mutex</span><span class="op" id="4796778">.</span><span class="ident" id="4796779">Lock</span><span class="op" id="4796783">(</span><span class="op" id="4796784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4796787">if</span>&nbsp;<span class="ident" id="4796790">i</span>&nbsp;<span class="op" id="4796792">:=</span>&nbsp;<span class="builtinfunc" id="4796795">len</span><span class="op" id="4796798">(</span><span class="ident" id="4796799">f</span><span class="op" id="4796800">.</span><span class="ident" id="4796801">lines</span><span class="op" id="4796806">)</span><span class="op" id="4796807">;</span>&nbsp;<span class="op" id="4796809">(</span><span class="ident" id="4796810">i</span>&nbsp;<span class="op" id="4796812">==</span>&nbsp;<span class="num" id="4796815">0</span>&nbsp;<span class="op" id="4796817">||</span>&nbsp;<span class="ident" id="4796820">f</span><span class="op" id="4796821">.</span><span class="ident" id="4796822">lines</span><span class="op" id="4796827">[</span><span class="ident" id="4796828">i</span><span class="op" id="4796829">-</span><span class="num" id="4796830">1</span><span class="op" id="4796831">]</span>&nbsp;<span class="op" id="4796833">&lt;</span>&nbsp;<span class="ident" id="4796835">offset</span><span class="op" id="4796841">)</span>&nbsp;<span class="op" id="4796843">&amp;&amp;</span>&nbsp;<span class="ident" id="4796846">offset</span>&nbsp;<span class="op" id="4796853">&lt;</span>&nbsp;<span class="ident" id="4796855">f</span><span class="op" id="4796856">.</span><span class="ident" id="4796857">size</span>&nbsp;<span class="op" id="4796862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796866">f</span><span class="op" id="4796867">.</span><span class="ident" id="4796868">lines</span>&nbsp;<span class="op" id="4796874">=</span>&nbsp;<span class="builtinfunc" id="4796876">append</span><span class="op" id="4796882">(</span><span class="ident" id="4796883">f</span><span class="op" id="4796884">.</span><span class="ident" id="4796885">lines</span><span class="op" id="4796890">,</span>&nbsp;<span class="ident" id="4796892">offset</span><span class="op" id="4796898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4796901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4796904">f</span><span class="op" id="4796905">.</span><span class="ident" id="4796906">set</span><span class="op" id="4796909">.</span><span class="ident" id="4796910">mutex</span><span class="op" id="4796915">.</span><span class="ident" id="4796916">Unlock</span><span class="op" id="4796922">(</span><span class="op" id="4796923">)</span><br>
<span class="lineno">135</span><span class="op" id="4796925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4796928">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="4797004">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4797084">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="4797162">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="4797219">//</span><br>
<span class="lineno"></span><span class="keyword" id="4797222">func</span>&nbsp;<span class="op" id="4797227">(</span><span class="ident" id="4797228">f</span>&nbsp;<span class="op" id="4797230">*</span><span class="ident" id="4797231">File</span><span class="op" id="4797235">)</span>&nbsp;<span class="ident" id="4797237">MergeLine</span><span class="op" id="4797246">(</span><span class="ident" id="4797247">line</span>&nbsp;<span class="builtintype" id="4797252">int</span><span class="op" id="4797255">)</span>&nbsp;<span class="op" id="4797257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797260">if</span>&nbsp;<span class="ident" id="4797263">line</span>&nbsp;<span class="op" id="4797268">&lt;=</span>&nbsp;<span class="num" id="4797271">0</span>&nbsp;<span class="op" id="4797273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4797277">panic</span><span class="op" id="4797282">(</span><span class="string" id="4797283">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="4797333">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797339">f</span><span class="op" id="4797340">.</span><span class="ident" id="4797341">set</span><span class="op" id="4797344">.</span><span class="ident" id="4797345">mutex</span><span class="op" id="4797350">.</span><span class="ident" id="4797351">Lock</span><span class="op" id="4797355">(</span><span class="op" id="4797356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797359">defer</span>&nbsp;<span class="ident" id="4797365">f</span><span class="op" id="4797366">.</span><span class="ident" id="4797367">set</span><span class="op" id="4797370">.</span><span class="ident" id="4797371">mutex</span><span class="op" id="4797376">.</span><span class="ident" id="4797377">Unlock</span><span class="op" id="4797383">(</span><span class="op" id="4797384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4797387">if</span>&nbsp;<span class="ident" id="4797390">line</span>&nbsp;<span class="op" id="4797395">&gt;=</span>&nbsp;<span class="builtinfunc" id="4797398">len</span><span class="op" id="4797401">(</span><span class="ident" id="4797402">f</span><span class="op" id="4797403">.</span><span class="ident" id="4797404">lines</span><span class="op" id="4797409">)</span>&nbsp;<span class="op" id="4797411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4797415">panic</span><span class="op" id="4797420">(</span><span class="string" id="4797421">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="4797442">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4797445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4797448">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4797519">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4797586">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4797654">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4797727">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4797773">copy</span><span class="op" id="4797777">(</span><span class="ident" id="4797778">f</span><span class="op" id="4797779">.</span><span class="ident" id="4797780">lines</span><span class="op" id="4797785">[</span><span class="ident" id="4797786">line</span><span class="op" id="4797790">:</span><span class="op" id="4797791">]</span><span class="op" id="4797792">,</span>&nbsp;<span class="ident" id="4797794">f</span><span class="op" id="4797795">.</span><span class="ident" id="4797796">lines</span><span class="op" id="4797801">[</span><span class="ident" id="4797802">line</span><span class="op" id="4797806">+</span><span class="num" id="4797807">1</span><span class="op" id="4797808">:</span><span class="op" id="4797809">]</span><span class="op" id="4797810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4797813">f</span><span class="op" id="4797814">.</span><span class="ident" id="4797815">lines</span>&nbsp;<span class="op" id="4797821">=</span>&nbsp;<span class="ident" id="4797823">f</span><span class="op" id="4797824">.</span><span class="ident" id="4797825">lines</span><span class="op" id="4797830">[</span><span class="op" id="4797831">:</span><span class="builtinfunc" id="4797832">len</span><span class="op" id="4797835">(</span><span class="ident" id="4797836">f</span><span class="op" id="4797837">.</span><span class="ident" id="4797838">lines</span><span class="op" id="4797843">)</span><span class="op" id="4797844">-</span><span class="num" id="4797845">1</span><span class="op" id="4797846">]</span><br>
<span class="lineno"></span><span class="op" id="4797848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4797851">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="4797928">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="4798001">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="4798072">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="4798121">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="4798194">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4798266">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4798276">//</span><br>
<span class="lineno"></span><span class="keyword" id="4798279">func</span>&nbsp;<span class="op" id="4798284">(</span><span class="ident" id="4798285">f</span>&nbsp;<span class="op" id="4798287">*</span><span class="ident" id="4798288">File</span><span class="op" id="4798292">)</span>&nbsp;<span class="ident" id="4798294">SetLines</span><span class="op" id="4798302">(</span><span class="ident" id="4798303">lines</span>&nbsp;<span class="op" id="4798309">[</span><span class="op" id="4798310">]</span><span class="builtintype" id="4798311">int</span><span class="op" id="4798314">)</span>&nbsp;<span class="builtintype" id="4798316">bool</span>&nbsp;<span class="op" id="4798321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798324">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798359">size</span>&nbsp;<span class="op" id="4798364">:=</span>&nbsp;<span class="ident" id="4798367">f</span><span class="op" id="4798368">.</span><span class="ident" id="4798369">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798375">for</span>&nbsp;<span class="ident" id="4798379">i</span><span class="op" id="4798380">,</span>&nbsp;<span class="ident" id="4798382">offset</span>&nbsp;<span class="op" id="4798389">:=</span>&nbsp;<span class="keyword" id="4798392">range</span>&nbsp;<span class="ident" id="4798398">lines</span>&nbsp;<span class="op" id="4798404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798408">if</span>&nbsp;<span class="ident" id="4798411">i</span>&nbsp;<span class="op" id="4798413">&gt;</span>&nbsp;<span class="num" id="4798415">0</span>&nbsp;<span class="op" id="4798417">&amp;&amp;</span>&nbsp;<span class="ident" id="4798420">offset</span>&nbsp;<span class="op" id="4798427">&lt;=</span>&nbsp;<span class="ident" id="4798430">lines</span><span class="op" id="4798435">[</span><span class="ident" id="4798436">i</span><span class="op" id="4798437">-</span><span class="num" id="4798438">1</span><span class="op" id="4798439">]</span>&nbsp;<span class="op" id="4798441">||</span>&nbsp;<span class="ident" id="4798444">size</span>&nbsp;<span class="op" id="4798449">&lt;=</span>&nbsp;<span class="ident" id="4798452">offset</span>&nbsp;<span class="op" id="4798459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798464">return</span>&nbsp;<span class="builtintype" id="4798471">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798479">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798486">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798506">f</span><span class="op" id="4798507">.</span><span class="ident" id="4798508">set</span><span class="op" id="4798511">.</span><span class="ident" id="4798512">mutex</span><span class="op" id="4798517">.</span><span class="ident" id="4798518">Lock</span><span class="op" id="4798522">(</span><span class="op" id="4798523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798526">f</span><span class="op" id="4798527">.</span><span class="ident" id="4798528">lines</span>&nbsp;<span class="op" id="4798534">=</span>&nbsp;<span class="ident" id="4798536">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798543">f</span><span class="op" id="4798544">.</span><span class="ident" id="4798545">set</span><span class="op" id="4798548">.</span><span class="ident" id="4798549">mutex</span><span class="op" id="4798554">.</span><span class="ident" id="4798555">Unlock</span><span class="op" id="4798561">(</span><span class="op" id="4798562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798565">return</span>&nbsp;<span class="builtintype" id="4798572">true</span><br>
<span class="lineno"></span><span class="op" id="4798577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4798580">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="4798652">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="4798701">func</span>&nbsp;<span class="op" id="4798706">(</span><span class="ident" id="4798707">f</span>&nbsp;<span class="op" id="4798709">*</span><span class="ident" id="4798710">File</span><span class="op" id="4798714">)</span>&nbsp;<span class="ident" id="4798716">SetLinesForContent</span><span class="op" id="4798734">(</span><span class="ident" id="4798735">content</span>&nbsp;<span class="op" id="4798743">[</span><span class="op" id="4798744">]</span><span class="builtintype" id="4798745">byte</span><span class="op" id="4798749">)</span>&nbsp;<span class="op" id="4798751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798754">var</span>&nbsp;<span class="ident" id="4798758">lines</span>&nbsp;<span class="op" id="4798764">[</span><span class="op" id="4798765">]</span><span class="builtintype" id="4798766">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798771">line</span>&nbsp;<span class="op" id="4798776">:=</span>&nbsp;<span class="num" id="4798779">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798782">for</span>&nbsp;<span class="ident" id="4798786">offset</span><span class="op" id="4798792">,</span>&nbsp;<span class="ident" id="4798794">b</span>&nbsp;<span class="op" id="4798796">:=</span>&nbsp;<span class="keyword" id="4798799">range</span>&nbsp;<span class="ident" id="4798805">content</span>&nbsp;<span class="op" id="4798813">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798817">if</span>&nbsp;<span class="ident" id="4798820">line</span>&nbsp;<span class="op" id="4798825">&gt;=</span>&nbsp;<span class="num" id="4798828">0</span>&nbsp;<span class="op" id="4798830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798835">lines</span>&nbsp;<span class="op" id="4798841">=</span>&nbsp;<span class="builtinfunc" id="4798843">append</span><span class="op" id="4798849">(</span><span class="ident" id="4798850">lines</span><span class="op" id="4798855">,</span>&nbsp;<span class="ident" id="4798857">line</span><span class="op" id="4798861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798869">line</span>&nbsp;<span class="op" id="4798874">=</span>&nbsp;<span class="op" id="4798876">-</span><span class="num" id="4798877">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4798881">if</span>&nbsp;<span class="ident" id="4798884">b</span>&nbsp;<span class="op" id="4798886">==</span>&nbsp;<span class="string" id="4798889">&#39;\n&#39;</span>&nbsp;<span class="op" id="4798894">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798899">line</span>&nbsp;<span class="op" id="4798904">=</span>&nbsp;<span class="ident" id="4798906">offset</span>&nbsp;<span class="op" id="4798913">+</span>&nbsp;<span class="num" id="4798915">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4798922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4798926">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798946">f</span><span class="op" id="4798947">.</span><span class="ident" id="4798948">set</span><span class="op" id="4798951">.</span><span class="ident" id="4798952">mutex</span><span class="op" id="4798957">.</span><span class="ident" id="4798958">Lock</span><span class="op" id="4798962">(</span><span class="op" id="4798963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798966">f</span><span class="op" id="4798967">.</span><span class="ident" id="4798968">lines</span>&nbsp;<span class="op" id="4798974">=</span>&nbsp;<span class="ident" id="4798976">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4798983">f</span><span class="op" id="4798984">.</span><span class="ident" id="4798985">set</span><span class="op" id="4798988">.</span><span class="ident" id="4798989">mutex</span><span class="op" id="4798994">.</span><span class="ident" id="4798995">Unlock</span><span class="op" id="4799001">(</span><span class="op" id="4799002">)</span><br>
<span class="lineno"></span><span class="op" id="4799004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="4799007">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4799071">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="4799134">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="4799168">type</span>&nbsp;<span class="ident" id="4799173">lineInfo</span>&nbsp;<span class="keyword" id="4799182">struct</span>&nbsp;<span class="op" id="4799189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4799192">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799247">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4799256">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799261">Filename</span>&nbsp;<span class="builtintype" id="4799270">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799278">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4799287">int</span><br>
<span class="lineno"></span><span class="op" id="4799291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4799294">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4799363">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4799433">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4799500">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4799552">//</span><br>
<span class="lineno">220</span><span class="comment" id="4799555">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4799621">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4799687">//</span><br>
<span class="lineno"></span><span class="keyword" id="4799690">func</span>&nbsp;<span class="op" id="4799695">(</span><span class="ident" id="4799696">f</span>&nbsp;<span class="op" id="4799698">*</span><span class="ident" id="4799699">File</span><span class="op" id="4799703">)</span>&nbsp;<span class="ident" id="4799705">AddLineInfo</span><span class="op" id="4799716">(</span><span class="ident" id="4799717">offset</span>&nbsp;<span class="builtintype" id="4799724">int</span><span class="op" id="4799727">,</span>&nbsp;<span class="ident" id="4799729">filename</span>&nbsp;<span class="builtintype" id="4799738">string</span><span class="op" id="4799744">,</span>&nbsp;<span class="ident" id="4799746">line</span>&nbsp;<span class="builtintype" id="4799751">int</span><span class="op" id="4799754">)</span>&nbsp;<span class="op" id="4799756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799759">f</span><span class="op" id="4799760">.</span><span class="ident" id="4799761">set</span><span class="op" id="4799764">.</span><span class="ident" id="4799765">mutex</span><span class="op" id="4799770">.</span><span class="ident" id="4799771">Lock</span><span class="op" id="4799775">(</span><span class="op" id="4799776">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4799779">if</span>&nbsp;<span class="ident" id="4799782">i</span>&nbsp;<span class="op" id="4799784">:=</span>&nbsp;<span class="builtinfunc" id="4799787">len</span><span class="op" id="4799790">(</span><span class="ident" id="4799791">f</span><span class="op" id="4799792">.</span><span class="ident" id="4799793">infos</span><span class="op" id="4799798">)</span><span class="op" id="4799799">;</span>&nbsp;<span class="ident" id="4799801">i</span>&nbsp;<span class="op" id="4799803">==</span>&nbsp;<span class="num" id="4799806">0</span>&nbsp;<span class="op" id="4799808">||</span>&nbsp;<span class="ident" id="4799811">f</span><span class="op" id="4799812">.</span><span class="ident" id="4799813">infos</span><span class="op" id="4799818">[</span><span class="ident" id="4799819">i</span><span class="op" id="4799820">-</span><span class="num" id="4799821">1</span><span class="op" id="4799822">]</span><span class="op" id="4799823">.</span><span class="ident" id="4799824">Offset</span>&nbsp;<span class="op" id="4799831">&lt;</span>&nbsp;<span class="ident" id="4799833">offset</span>&nbsp;<span class="op" id="4799840">&amp;&amp;</span>&nbsp;<span class="ident" id="4799843">offset</span>&nbsp;<span class="op" id="4799850">&lt;</span>&nbsp;<span class="ident" id="4799852">f</span><span class="op" id="4799853">.</span><span class="ident" id="4799854">size</span>&nbsp;<span class="op" id="4799859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799863">f</span><span class="op" id="4799864">.</span><span class="ident" id="4799865">infos</span>&nbsp;<span class="op" id="4799871">=</span>&nbsp;<span class="builtinfunc" id="4799873">append</span><span class="op" id="4799879">(</span><span class="ident" id="4799880">f</span><span class="op" id="4799881">.</span><span class="ident" id="4799882">infos</span><span class="op" id="4799887">,</span>&nbsp;<span class="ident" id="4799889">lineInfo</span><span class="op" id="4799897">{</span><span class="ident" id="4799898">offset</span><span class="op" id="4799904">,</span>&nbsp;<span class="ident" id="4799906">filename</span><span class="op" id="4799914">,</span>&nbsp;<span class="ident" id="4799916">line</span><span class="op" id="4799920">}</span><span class="op" id="4799921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4799924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4799927">f</span><span class="op" id="4799928">.</span><span class="ident" id="4799929">set</span><span class="op" id="4799932">.</span><span class="ident" id="4799933">mutex</span><span class="op" id="4799938">.</span><span class="ident" id="4799939">Unlock</span><span class="op" id="4799945">(</span><span class="op" id="4799946">)</span><br>
<span class="lineno"></span><span class="op" id="4799948">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4799951">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="4800007">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="4800042">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4800070">//</span><br>
<span class="lineno">235</span><span class="keyword" id="4800073">func</span>&nbsp;<span class="op" id="4800078">(</span><span class="ident" id="4800079">f</span>&nbsp;<span class="op" id="4800081">*</span><span class="ident" id="4800082">File</span><span class="op" id="4800086">)</span>&nbsp;<span class="ident" id="4800088">Pos</span><span class="op" id="4800091">(</span><span class="ident" id="4800092">offset</span>&nbsp;<span class="builtintype" id="4800099">int</span><span class="op" id="4800102">)</span>&nbsp;<span class="ident" id="4800104">Pos</span>&nbsp;<span class="op" id="4800108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800111">if</span>&nbsp;<span class="ident" id="4800114">offset</span>&nbsp;<span class="op" id="4800121">&gt;</span>&nbsp;<span class="ident" id="4800123">f</span><span class="op" id="4800124">.</span><span class="ident" id="4800125">size</span>&nbsp;<span class="op" id="4800130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4800134">panic</span><span class="op" id="4800139">(</span><span class="string" id="4800140">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="4800161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800167">return</span>&nbsp;<span class="ident" id="4800174">Pos</span><span class="op" id="4800177">(</span><span class="ident" id="4800178">f</span><span class="op" id="4800179">.</span><span class="ident" id="4800180">base</span>&nbsp;<span class="op" id="4800185">+</span>&nbsp;<span class="ident" id="4800187">offset</span><span class="op" id="4800193">)</span><br>
<span class="lineno">240</span><span class="op" id="4800195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4800198">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="4800258">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4800303">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="4800341">//</span><br>
<span class="lineno"></span><span class="keyword" id="4800344">func</span>&nbsp;<span class="op" id="4800349">(</span><span class="ident" id="4800350">f</span>&nbsp;<span class="op" id="4800352">*</span><span class="ident" id="4800353">File</span><span class="op" id="4800357">)</span>&nbsp;<span class="ident" id="4800359">Offset</span><span class="op" id="4800365">(</span><span class="ident" id="4800366">p</span>&nbsp;<span class="ident" id="4800368">Pos</span><span class="op" id="4800371">)</span>&nbsp;<span class="builtintype" id="4800373">int</span>&nbsp;<span class="op" id="4800377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800380">if</span>&nbsp;<span class="builtintype" id="4800383">int</span><span class="op" id="4800386">(</span><span class="ident" id="4800387">p</span><span class="op" id="4800388">)</span>&nbsp;<span class="op" id="4800390">&lt;</span>&nbsp;<span class="ident" id="4800392">f</span><span class="op" id="4800393">.</span><span class="ident" id="4800394">base</span>&nbsp;<span class="op" id="4800399">||</span>&nbsp;<span class="builtintype" id="4800402">int</span><span class="op" id="4800405">(</span><span class="ident" id="4800406">p</span><span class="op" id="4800407">)</span>&nbsp;<span class="op" id="4800409">&gt;</span>&nbsp;<span class="ident" id="4800411">f</span><span class="op" id="4800412">.</span><span class="ident" id="4800413">base</span><span class="op" id="4800417">+</span><span class="ident" id="4800418">f</span><span class="op" id="4800419">.</span><span class="ident" id="4800420">size</span>&nbsp;<span class="op" id="4800425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4800429">panic</span><span class="op" id="4800434">(</span><span class="string" id="4800435">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="4800454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4800457">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800460">return</span>&nbsp;<span class="builtintype" id="4800467">int</span><span class="op" id="4800470">(</span><span class="ident" id="4800471">p</span><span class="op" id="4800472">)</span>&nbsp;<span class="op" id="4800474">-</span>&nbsp;<span class="ident" id="4800476">f</span><span class="op" id="4800477">.</span><span class="ident" id="4800478">base</span><br>
<span class="lineno"></span><span class="op" id="4800483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4800486">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="4800549">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="4800597">//</span><br>
<span class="lineno"></span><span class="keyword" id="4800600">func</span>&nbsp;<span class="op" id="4800605">(</span><span class="ident" id="4800606">f</span>&nbsp;<span class="op" id="4800608">*</span><span class="ident" id="4800609">File</span><span class="op" id="4800613">)</span>&nbsp;<span class="ident" id="4800615">Line</span><span class="op" id="4800619">(</span><span class="ident" id="4800620">p</span>&nbsp;<span class="ident" id="4800622">Pos</span><span class="op" id="4800625">)</span>&nbsp;<span class="builtintype" id="4800627">int</span>&nbsp;<span class="op" id="4800631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800634">return</span>&nbsp;<span class="ident" id="4800641">f</span><span class="op" id="4800642">.</span><span class="ident" id="4800643">Position</span><span class="op" id="4800651">(</span><span class="ident" id="4800652">p</span><span class="op" id="4800653">)</span><span class="op" id="4800654">.</span><span class="ident" id="4800655">Line</span><br>
<span class="lineno"></span><span class="op" id="4800660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="4800663">func</span>&nbsp;<span class="ident" id="4800668">searchLineInfos</span><span class="op" id="4800683">(</span><span class="ident" id="4800684">a</span>&nbsp;<span class="op" id="4800686">[</span><span class="op" id="4800687">]</span><span class="ident" id="4800688">lineInfo</span><span class="op" id="4800696">,</span>&nbsp;<span class="ident" id="4800698">x</span>&nbsp;<span class="builtintype" id="4800700">int</span><span class="op" id="4800703">)</span>&nbsp;<span class="builtintype" id="4800705">int</span>&nbsp;<span class="op" id="4800709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4800712">return</span>&nbsp;<span class="ident" id="4800719">sort</span><span class="op" id="4800723">.</span><span class="ident" id="4800724">Search</span><span class="op" id="4800730">(</span><span class="builtinfunc" id="4800731">len</span><span class="op" id="4800734">(</span><span class="ident" id="4800735">a</span><span class="op" id="4800736">)</span><span class="op" id="4800737">,</span>&nbsp;<span class="keyword" id="4800739">func</span><span class="op" id="4800743">(</span><span class="ident" id="4800744">i</span>&nbsp;<span class="builtintype" id="4800746">int</span><span class="op" id="4800749">)</span>&nbsp;<span class="builtintype" id="4800751">bool</span>&nbsp;<span class="op" id="4800756">{</span>&nbsp;<span class="keyword" id="4800758">return</span>&nbsp;<span class="ident" id="4800765">a</span><span class="op" id="4800766">[</span><span class="ident" id="4800767">i</span><span class="op" id="4800768">]</span><span class="op" id="4800769">.</span><span class="ident" id="4800770">Offset</span>&nbsp;<span class="op" id="4800777">&gt;</span>&nbsp;<span class="ident" id="4800779">x</span>&nbsp;<span class="op" id="4800781">}</span><span class="op" id="4800782">)</span>&nbsp;<span class="op" id="4800784">-</span>&nbsp;<span class="num" id="4800786">1</span><br>
<span class="lineno"></span><span class="op" id="4800788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4800791">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="4800868">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4800944">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4801023">//</span><br>
<span class="lineno"></span><span class="keyword" id="4801026">func</span>&nbsp;<span class="op" id="4801031">(</span><span class="ident" id="4801032">f</span>&nbsp;<span class="op" id="4801034">*</span><span class="ident" id="4801035">File</span><span class="op" id="4801039">)</span>&nbsp;<span class="ident" id="4801041">unpack</span><span class="op" id="4801047">(</span><span class="ident" id="4801048">offset</span>&nbsp;<span class="builtintype" id="4801055">int</span><span class="op" id="4801058">,</span>&nbsp;<span class="ident" id="4801060">adjusted</span>&nbsp;<span class="builtintype" id="4801069">bool</span><span class="op" id="4801073">)</span>&nbsp;<span class="op" id="4801075">(</span><span class="ident" id="4801076">filename</span>&nbsp;<span class="builtintype" id="4801085">string</span><span class="op" id="4801091">,</span>&nbsp;<span class="ident" id="4801093">line</span><span class="op" id="4801097">,</span>&nbsp;<span class="ident" id="4801099">column</span>&nbsp;<span class="builtintype" id="4801106">int</span><span class="op" id="4801109">)</span>&nbsp;<span class="op" id="4801111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801114">filename</span>&nbsp;<span class="op" id="4801123">=</span>&nbsp;<span class="ident" id="4801125">f</span><span class="op" id="4801126">.</span><span class="ident" id="4801127">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801133">if</span>&nbsp;<span class="ident" id="4801136">i</span>&nbsp;<span class="op" id="4801138">:=</span>&nbsp;<span class="ident" id="4801141">searchInts</span><span class="op" id="4801151">(</span><span class="ident" id="4801152">f</span><span class="op" id="4801153">.</span><span class="ident" id="4801154">lines</span><span class="op" id="4801159">,</span>&nbsp;<span class="ident" id="4801161">offset</span><span class="op" id="4801167">)</span><span class="op" id="4801168">;</span>&nbsp;<span class="ident" id="4801170">i</span>&nbsp;<span class="op" id="4801172">&gt;=</span>&nbsp;<span class="num" id="4801175">0</span>&nbsp;<span class="op" id="4801177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801181">line</span><span class="op" id="4801185">,</span>&nbsp;<span class="ident" id="4801187">column</span>&nbsp;<span class="op" id="4801194">=</span>&nbsp;<span class="ident" id="4801196">i</span><span class="op" id="4801197">+</span><span class="num" id="4801198">1</span><span class="op" id="4801199">,</span>&nbsp;<span class="ident" id="4801201">offset</span><span class="op" id="4801207">-</span><span class="ident" id="4801208">f</span><span class="op" id="4801209">.</span><span class="ident" id="4801210">lines</span><span class="op" id="4801215">[</span><span class="ident" id="4801216">i</span><span class="op" id="4801217">]</span><span class="op" id="4801218">+</span><span class="num" id="4801219">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801225">if</span>&nbsp;<span class="ident" id="4801228">adjusted</span>&nbsp;<span class="op" id="4801237">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4801240">len</span><span class="op" id="4801243">(</span><span class="ident" id="4801244">f</span><span class="op" id="4801245">.</span><span class="ident" id="4801246">infos</span><span class="op" id="4801251">)</span>&nbsp;<span class="op" id="4801253">&gt;</span>&nbsp;<span class="num" id="4801255">0</span>&nbsp;<span class="op" id="4801257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4801261">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801304">if</span>&nbsp;<span class="ident" id="4801307">i</span>&nbsp;<span class="op" id="4801309">:=</span>&nbsp;<span class="ident" id="4801312">searchLineInfos</span><span class="op" id="4801327">(</span><span class="ident" id="4801328">f</span><span class="op" id="4801329">.</span><span class="ident" id="4801330">infos</span><span class="op" id="4801335">,</span>&nbsp;<span class="ident" id="4801337">offset</span><span class="op" id="4801343">)</span><span class="op" id="4801344">;</span>&nbsp;<span class="ident" id="4801346">i</span>&nbsp;<span class="op" id="4801348">&gt;=</span>&nbsp;<span class="num" id="4801351">0</span>&nbsp;<span class="op" id="4801353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801358">alt</span>&nbsp;<span class="op" id="4801362">:=</span>&nbsp;<span class="op" id="4801365">&amp;</span><span class="ident" id="4801366">f</span><span class="op" id="4801367">.</span><span class="ident" id="4801368">infos</span><span class="op" id="4801373">[</span><span class="ident" id="4801374">i</span><span class="op" id="4801375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801380">filename</span>&nbsp;<span class="op" id="4801389">=</span>&nbsp;<span class="ident" id="4801391">alt</span><span class="op" id="4801394">.</span><span class="ident" id="4801395">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801407">if</span>&nbsp;<span class="ident" id="4801410">i</span>&nbsp;<span class="op" id="4801412">:=</span>&nbsp;<span class="ident" id="4801415">searchInts</span><span class="op" id="4801425">(</span><span class="ident" id="4801426">f</span><span class="op" id="4801427">.</span><span class="ident" id="4801428">lines</span><span class="op" id="4801433">,</span>&nbsp;<span class="ident" id="4801435">alt</span><span class="op" id="4801438">.</span><span class="ident" id="4801439">Offset</span><span class="op" id="4801445">)</span><span class="op" id="4801446">;</span>&nbsp;<span class="ident" id="4801448">i</span>&nbsp;<span class="op" id="4801450">&gt;=</span>&nbsp;<span class="num" id="4801453">0</span>&nbsp;<span class="op" id="4801455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801461">line</span>&nbsp;<span class="op" id="4801466">+=</span>&nbsp;<span class="ident" id="4801469">alt</span><span class="op" id="4801472">.</span><span class="ident" id="4801473">Line</span>&nbsp;<span class="op" id="4801478">-</span>&nbsp;<span class="ident" id="4801480">i</span>&nbsp;<span class="op" id="4801482">-</span>&nbsp;<span class="num" id="4801484">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801499">return</span><br>
<span class="lineno"></span><span class="op" id="4801506">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="4801509">func</span>&nbsp;<span class="op" id="4801514">(</span><span class="ident" id="4801515">f</span>&nbsp;<span class="op" id="4801517">*</span><span class="ident" id="4801518">File</span><span class="op" id="4801522">)</span>&nbsp;<span class="ident" id="4801524">position</span><span class="op" id="4801532">(</span><span class="ident" id="4801533">p</span>&nbsp;<span class="ident" id="4801535">Pos</span><span class="op" id="4801538">,</span>&nbsp;<span class="ident" id="4801540">adjusted</span>&nbsp;<span class="builtintype" id="4801549">bool</span><span class="op" id="4801553">)</span>&nbsp;<span class="op" id="4801555">(</span><span class="ident" id="4801556">pos</span>&nbsp;<span class="ident" id="4801560">Position</span><span class="op" id="4801568">)</span>&nbsp;<span class="op" id="4801570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801573">offset</span>&nbsp;<span class="op" id="4801580">:=</span>&nbsp;<span class="builtintype" id="4801583">int</span><span class="op" id="4801586">(</span><span class="ident" id="4801587">p</span><span class="op" id="4801588">)</span>&nbsp;<span class="op" id="4801590">-</span>&nbsp;<span class="ident" id="4801592">f</span><span class="op" id="4801593">.</span><span class="ident" id="4801594">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801600">pos</span><span class="op" id="4801603">.</span><span class="ident" id="4801604">Offset</span>&nbsp;<span class="op" id="4801611">=</span>&nbsp;<span class="ident" id="4801613">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4801621">pos</span><span class="op" id="4801624">.</span><span class="ident" id="4801625">Filename</span><span class="op" id="4801633">,</span>&nbsp;<span class="ident" id="4801635">pos</span><span class="op" id="4801638">.</span><span class="ident" id="4801639">Line</span><span class="op" id="4801643">,</span>&nbsp;<span class="ident" id="4801645">pos</span><span class="op" id="4801648">.</span><span class="ident" id="4801649">Column</span>&nbsp;<span class="op" id="4801656">=</span>&nbsp;<span class="ident" id="4801658">f</span><span class="op" id="4801659">.</span><span class="ident" id="4801660">unpack</span><span class="op" id="4801666">(</span><span class="ident" id="4801667">offset</span><span class="op" id="4801673">,</span>&nbsp;<span class="ident" id="4801675">adjusted</span><span class="op" id="4801683">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4801686">return</span><br>
<span class="lineno"></span><span class="op" id="4801693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801696">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4801769">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="4801842">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4801900">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="4801940">//</span><br>
<span class="lineno"></span><span class="keyword" id="4801943">func</span>&nbsp;<span class="op" id="4801948">(</span><span class="ident" id="4801949">f</span>&nbsp;<span class="op" id="4801951">*</span><span class="ident" id="4801952">File</span><span class="op" id="4801956">)</span>&nbsp;<span class="ident" id="4801958">PositionFor</span><span class="op" id="4801969">(</span><span class="ident" id="4801970">p</span>&nbsp;<span class="ident" id="4801972">Pos</span><span class="op" id="4801975">,</span>&nbsp;<span class="ident" id="4801977">adjusted</span>&nbsp;<span class="builtintype" id="4801986">bool</span><span class="op" id="4801990">)</span>&nbsp;<span class="op" id="4801992">(</span><span class="ident" id="4801993">pos</span>&nbsp;<span class="ident" id="4801997">Position</span><span class="op" id="4802005">)</span>&nbsp;<span class="op" id="4802007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802010">if</span>&nbsp;<span class="ident" id="4802013">p</span>&nbsp;<span class="op" id="4802015">!=</span>&nbsp;<span class="ident" id="4802018">NoPos</span>&nbsp;<span class="op" id="4802024">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802028">if</span>&nbsp;<span class="builtintype" id="4802031">int</span><span class="op" id="4802034">(</span><span class="ident" id="4802035">p</span><span class="op" id="4802036">)</span>&nbsp;<span class="op" id="4802038">&lt;</span>&nbsp;<span class="ident" id="4802040">f</span><span class="op" id="4802041">.</span><span class="ident" id="4802042">base</span>&nbsp;<span class="op" id="4802047">||</span>&nbsp;<span class="builtintype" id="4802050">int</span><span class="op" id="4802053">(</span><span class="ident" id="4802054">p</span><span class="op" id="4802055">)</span>&nbsp;<span class="op" id="4802057">&gt;</span>&nbsp;<span class="ident" id="4802059">f</span><span class="op" id="4802060">.</span><span class="ident" id="4802061">base</span><span class="op" id="4802065">+</span><span class="ident" id="4802066">f</span><span class="op" id="4802067">.</span><span class="ident" id="4802068">size</span>&nbsp;<span class="op" id="4802073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4802078">panic</span><span class="op" id="4802083">(</span><span class="string" id="4802084">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="4802103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802111">pos</span>&nbsp;<span class="op" id="4802115">=</span>&nbsp;<span class="ident" id="4802117">f</span><span class="op" id="4802118">.</span><span class="ident" id="4802119">position</span><span class="op" id="4802127">(</span><span class="ident" id="4802128">p</span><span class="op" id="4802129">,</span>&nbsp;<span class="ident" id="4802131">adjusted</span><span class="op" id="4802139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802142">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802145">return</span><br>
<span class="lineno"></span><span class="op" id="4802152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802155">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="4802225">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="4802299">//</span><br>
<span class="lineno"></span><span class="keyword" id="4802302">func</span>&nbsp;<span class="op" id="4802307">(</span><span class="ident" id="4802308">f</span>&nbsp;<span class="op" id="4802310">*</span><span class="ident" id="4802311">File</span><span class="op" id="4802315">)</span>&nbsp;<span class="ident" id="4802317">Position</span><span class="op" id="4802325">(</span><span class="ident" id="4802326">p</span>&nbsp;<span class="ident" id="4802328">Pos</span><span class="op" id="4802331">)</span>&nbsp;<span class="op" id="4802333">(</span><span class="ident" id="4802334">pos</span>&nbsp;<span class="ident" id="4802338">Position</span><span class="op" id="4802346">)</span>&nbsp;<span class="op" id="4802348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802351">return</span>&nbsp;<span class="ident" id="4802358">f</span><span class="op" id="4802359">.</span><span class="ident" id="4802360">PositionFor</span><span class="op" id="4802371">(</span><span class="ident" id="4802372">p</span><span class="op" id="4802373">,</span>&nbsp;<span class="builtintype" id="4802375">true</span><span class="op" id="4802379">)</span><br>
<span class="lineno"></span><span class="op" id="4802381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4802384">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4802465">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802477">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4802524">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="4802586">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="4802619">//</span><br>
<span class="lineno"></span><span class="keyword" id="4802622">type</span>&nbsp;<span class="ident" id="4802627">FileSet</span>&nbsp;<span class="keyword" id="4802635">struct</span>&nbsp;<span class="op" id="4802642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802645">mutex</span>&nbsp;<span class="ident" id="4802651">sync</span><span class="op" id="4802655">.</span><span class="ident" id="4802656">RWMutex</span>&nbsp;<span class="comment" id="4802664">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802690">base</span>&nbsp;&nbsp;<span class="builtintype" id="4802696">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4802709">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802743">files</span>&nbsp;<span class="op" id="4802749">[</span><span class="op" id="4802750">]</span><span class="op" id="4802751">*</span><span class="ident" id="4802752">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4802762">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802810">last</span>&nbsp;&nbsp;<span class="op" id="4802816">*</span><span class="ident" id="4802817">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4802829">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="4802861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802864">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="4802902">func</span>&nbsp;<span class="ident" id="4802907">NewFileSet</span><span class="op" id="4802917">(</span><span class="op" id="4802918">)</span>&nbsp;<span class="op" id="4802920">*</span><span class="ident" id="4802921">FileSet</span>&nbsp;<span class="op" id="4802929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4802932">return</span>&nbsp;<span class="op" id="4802939">&amp;</span><span class="ident" id="4802940">FileSet</span><span class="op" id="4802947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4802951">base</span><span class="op" id="4802955">:</span>&nbsp;<span class="num" id="4802957">1</span><span class="op" id="4802958">,</span>&nbsp;<span class="comment" id="4802960">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4802975">}</span><br>
<span class="lineno"></span><span class="op" id="4802977">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="4802980">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4803045">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4803083">//</span><br>
<span class="lineno"></span><span class="keyword" id="4803086">func</span>&nbsp;<span class="op" id="4803091">(</span><span class="ident" id="4803092">s</span>&nbsp;<span class="op" id="4803094">*</span><span class="ident" id="4803095">FileSet</span><span class="op" id="4803102">)</span>&nbsp;<span class="ident" id="4803104">Base</span><span class="op" id="4803108">(</span><span class="op" id="4803109">)</span>&nbsp;<span class="builtintype" id="4803111">int</span>&nbsp;<span class="op" id="4803115">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803118">s</span><span class="op" id="4803119">.</span><span class="ident" id="4803120">mutex</span><span class="op" id="4803125">.</span><span class="ident" id="4803126">RLock</span><span class="op" id="4803131">(</span><span class="op" id="4803132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803135">b</span>&nbsp;<span class="op" id="4803137">:=</span>&nbsp;<span class="ident" id="4803140">s</span><span class="op" id="4803141">.</span><span class="ident" id="4803142">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4803148">s</span><span class="op" id="4803149">.</span><span class="ident" id="4803150">mutex</span><span class="op" id="4803155">.</span><span class="ident" id="4803156">RUnlock</span><span class="op" id="4803163">(</span><span class="op" id="4803164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4803167">return</span>&nbsp;<span class="ident" id="4803174">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="4803177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4803180">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="4803257">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4803333">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="4803409">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="4803490">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4803552">//</span><br>
<span class="lineno"></span><span class="comment" id="4803555">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="4803630">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="4803705">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="4803767">//</span><br>
<span class="lineno"></span><span class="comment" id="4803770">//&nbsp;&nbsp;&nbsp;&nbsp;int(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="4803794">//</span><br>
<span class="lineno"></span><span class="comment" id="4803797">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="4803876">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="4803950">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="4803980">//</span><br>
<span class="lineno"></span><span class="keyword" id="4803983">func</span>&nbsp;<span class="op" id="4803988">(</span><span class="ident" id="4803989">s</span>&nbsp;<span class="op" id="4803991">*</span><span class="ident" id="4803992">FileSet</span><span class="op" id="4803999">)</span>&nbsp;<span class="ident" id="4804001">AddFile</span><span class="op" id="4804008">(</span><span class="ident" id="4804009">filename</span>&nbsp;<span class="builtintype" id="4804018">string</span><span class="op" id="4804024">,</span>&nbsp;<span class="ident" id="4804026">base</span><span class="op" id="4804030">,</span>&nbsp;<span class="ident" id="4804032">size</span>&nbsp;<span class="builtintype" id="4804037">int</span><span class="op" id="4804040">)</span>&nbsp;<span class="op" id="4804042">*</span><span class="ident" id="4804043">File</span>&nbsp;<span class="op" id="4804048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804051">s</span><span class="op" id="4804052">.</span><span class="ident" id="4804053">mutex</span><span class="op" id="4804058">.</span><span class="ident" id="4804059">Lock</span><span class="op" id="4804063">(</span><span class="op" id="4804064">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804067">defer</span>&nbsp;<span class="ident" id="4804073">s</span><span class="op" id="4804074">.</span><span class="ident" id="4804075">mutex</span><span class="op" id="4804080">.</span><span class="ident" id="4804081">Unlock</span><span class="op" id="4804087">(</span><span class="op" id="4804088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804091">if</span>&nbsp;<span class="ident" id="4804094">base</span>&nbsp;<span class="op" id="4804099">&lt;</span>&nbsp;<span class="num" id="4804101">0</span>&nbsp;<span class="op" id="4804103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804107">base</span>&nbsp;<span class="op" id="4804112">=</span>&nbsp;<span class="ident" id="4804114">s</span><span class="op" id="4804115">.</span><span class="ident" id="4804116">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804125">if</span>&nbsp;<span class="ident" id="4804128">base</span>&nbsp;<span class="op" id="4804133">&lt;</span>&nbsp;<span class="ident" id="4804135">s</span><span class="op" id="4804136">.</span><span class="ident" id="4804137">base</span>&nbsp;<span class="op" id="4804142">||</span>&nbsp;<span class="ident" id="4804145">size</span>&nbsp;<span class="op" id="4804150">&lt;</span>&nbsp;<span class="num" id="4804152">0</span>&nbsp;<span class="op" id="4804154">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4804158">panic</span><span class="op" id="4804163">(</span><span class="string" id="4804164">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="4804186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804192">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804224">f</span>&nbsp;<span class="op" id="4804226">:=</span>&nbsp;<span class="op" id="4804229">&amp;</span><span class="ident" id="4804230">File</span><span class="op" id="4804234">{</span><span class="ident" id="4804235">s</span><span class="op" id="4804236">,</span>&nbsp;<span class="ident" id="4804238">filename</span><span class="op" id="4804246">,</span>&nbsp;<span class="ident" id="4804248">base</span><span class="op" id="4804252">,</span>&nbsp;<span class="ident" id="4804254">size</span><span class="op" id="4804258">,</span>&nbsp;<span class="op" id="4804260">[</span><span class="op" id="4804261">]</span><span class="builtintype" id="4804262">int</span><span class="op" id="4804265">{</span><span class="num" id="4804266">0</span><span class="op" id="4804267">}</span><span class="op" id="4804268">,</span>&nbsp;<span class="builtintype" id="4804270">nil</span><span class="op" id="4804273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804276">base</span>&nbsp;<span class="op" id="4804281">+=</span>&nbsp;<span class="ident" id="4804284">size</span>&nbsp;<span class="op" id="4804289">+</span>&nbsp;<span class="num" id="4804291">1</span>&nbsp;<span class="comment" id="4804293">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804332">if</span>&nbsp;<span class="ident" id="4804335">base</span>&nbsp;<span class="op" id="4804340">&lt;</span>&nbsp;<span class="num" id="4804342">0</span>&nbsp;<span class="op" id="4804344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4804348">panic</span><span class="op" id="4804353">(</span><span class="string" id="4804354">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="4804415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4804421">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804454">s</span><span class="op" id="4804455">.</span><span class="ident" id="4804456">base</span>&nbsp;<span class="op" id="4804461">=</span>&nbsp;<span class="ident" id="4804463">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804469">s</span><span class="op" id="4804470">.</span><span class="ident" id="4804471">files</span>&nbsp;<span class="op" id="4804477">=</span>&nbsp;<span class="builtinfunc" id="4804479">append</span><span class="op" id="4804485">(</span><span class="ident" id="4804486">s</span><span class="op" id="4804487">.</span><span class="ident" id="4804488">files</span><span class="op" id="4804493">,</span>&nbsp;<span class="ident" id="4804495">f</span><span class="op" id="4804496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804499">s</span><span class="op" id="4804500">.</span><span class="ident" id="4804501">last</span>&nbsp;<span class="op" id="4804506">=</span>&nbsp;<span class="ident" id="4804508">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804511">return</span>&nbsp;<span class="ident" id="4804518">f</span><br>
<span class="lineno"></span><span class="op" id="4804520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4804523">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="4804601">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="4804627">//</span><br>
<span class="lineno"></span><span class="keyword" id="4804630">func</span>&nbsp;<span class="op" id="4804635">(</span><span class="ident" id="4804636">s</span>&nbsp;<span class="op" id="4804638">*</span><span class="ident" id="4804639">FileSet</span><span class="op" id="4804646">)</span>&nbsp;<span class="ident" id="4804648">Iterate</span><span class="op" id="4804655">(</span><span class="ident" id="4804656">f</span>&nbsp;<span class="keyword" id="4804658">func</span><span class="op" id="4804662">(</span><span class="op" id="4804663">*</span><span class="ident" id="4804664">File</span><span class="op" id="4804668">)</span>&nbsp;<span class="builtintype" id="4804670">bool</span><span class="op" id="4804674">)</span>&nbsp;<span class="op" id="4804676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804679">for</span>&nbsp;<span class="ident" id="4804683">i</span>&nbsp;<span class="op" id="4804685">:=</span>&nbsp;<span class="num" id="4804688">0</span><span class="op" id="4804689">;</span>&nbsp;<span class="op" id="4804691">;</span>&nbsp;<span class="ident" id="4804693">i</span><span class="op" id="4804694">++</span>&nbsp;<span class="op" id="4804697">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804701">var</span>&nbsp;<span class="ident" id="4804705">file</span>&nbsp;<span class="op" id="4804710">*</span><span class="ident" id="4804711">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804718">s</span><span class="op" id="4804719">.</span><span class="ident" id="4804720">mutex</span><span class="op" id="4804725">.</span><span class="ident" id="4804726">RLock</span><span class="op" id="4804731">(</span><span class="op" id="4804732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804736">if</span>&nbsp;<span class="ident" id="4804739">i</span>&nbsp;<span class="op" id="4804741">&lt;</span>&nbsp;<span class="builtinfunc" id="4804743">len</span><span class="op" id="4804746">(</span><span class="ident" id="4804747">s</span><span class="op" id="4804748">.</span><span class="ident" id="4804749">files</span><span class="op" id="4804754">)</span>&nbsp;<span class="op" id="4804756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804761">file</span>&nbsp;<span class="op" id="4804766">=</span>&nbsp;<span class="ident" id="4804768">s</span><span class="op" id="4804769">.</span><span class="ident" id="4804770">files</span><span class="op" id="4804775">[</span><span class="ident" id="4804776">i</span><span class="op" id="4804777">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804781">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4804785">s</span><span class="op" id="4804786">.</span><span class="ident" id="4804787">mutex</span><span class="op" id="4804792">.</span><span class="ident" id="4804793">RUnlock</span><span class="op" id="4804800">(</span><span class="op" id="4804801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804805">if</span>&nbsp;<span class="ident" id="4804808">file</span>&nbsp;<span class="op" id="4804813">==</span>&nbsp;<span class="builtintype" id="4804816">nil</span>&nbsp;<span class="op" id="4804820">||</span>&nbsp;<span class="op" id="4804823">!</span><span class="ident" id="4804824">f</span><span class="op" id="4804825">(</span><span class="ident" id="4804826">file</span><span class="op" id="4804830">)</span>&nbsp;<span class="op" id="4804832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804837">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4804848">}</span><br>
<span class="lineno">400</span><span class="op" id="4804850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4804853">func</span>&nbsp;<span class="ident" id="4804858">searchFiles</span><span class="op" id="4804869">(</span><span class="ident" id="4804870">a</span>&nbsp;<span class="op" id="4804872">[</span><span class="op" id="4804873">]</span><span class="op" id="4804874">*</span><span class="ident" id="4804875">File</span><span class="op" id="4804879">,</span>&nbsp;<span class="ident" id="4804881">x</span>&nbsp;<span class="builtintype" id="4804883">int</span><span class="op" id="4804886">)</span>&nbsp;<span class="builtintype" id="4804888">int</span>&nbsp;<span class="op" id="4804892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4804895">return</span>&nbsp;<span class="ident" id="4804902">sort</span><span class="op" id="4804906">.</span><span class="ident" id="4804907">Search</span><span class="op" id="4804913">(</span><span class="builtinfunc" id="4804914">len</span><span class="op" id="4804917">(</span><span class="ident" id="4804918">a</span><span class="op" id="4804919">)</span><span class="op" id="4804920">,</span>&nbsp;<span class="keyword" id="4804922">func</span><span class="op" id="4804926">(</span><span class="ident" id="4804927">i</span>&nbsp;<span class="builtintype" id="4804929">int</span><span class="op" id="4804932">)</span>&nbsp;<span class="builtintype" id="4804934">bool</span>&nbsp;<span class="op" id="4804939">{</span>&nbsp;<span class="keyword" id="4804941">return</span>&nbsp;<span class="ident" id="4804948">a</span><span class="op" id="4804949">[</span><span class="ident" id="4804950">i</span><span class="op" id="4804951">]</span><span class="op" id="4804952">.</span><span class="ident" id="4804953">base</span>&nbsp;<span class="op" id="4804958">&gt;</span>&nbsp;<span class="ident" id="4804960">x</span>&nbsp;<span class="op" id="4804962">}</span><span class="op" id="4804963">)</span>&nbsp;<span class="op" id="4804965">-</span>&nbsp;<span class="num" id="4804967">1</span><br>
<span class="lineno"></span><span class="op" id="4804969">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4804972">func</span>&nbsp;<span class="op" id="4804977">(</span><span class="ident" id="4804978">s</span>&nbsp;<span class="op" id="4804980">*</span><span class="ident" id="4804981">FileSet</span><span class="op" id="4804988">)</span>&nbsp;<span class="ident" id="4804990">file</span><span class="op" id="4804994">(</span><span class="ident" id="4804995">p</span>&nbsp;<span class="ident" id="4804997">Pos</span><span class="op" id="4805000">)</span>&nbsp;<span class="op" id="4805002">*</span><span class="ident" id="4805003">File</span>&nbsp;<span class="op" id="4805008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805011">s</span><span class="op" id="4805012">.</span><span class="ident" id="4805013">mutex</span><span class="op" id="4805018">.</span><span class="ident" id="4805019">RLock</span><span class="op" id="4805024">(</span><span class="op" id="4805025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805028">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805063">if</span>&nbsp;<span class="ident" id="4805066">f</span>&nbsp;<span class="op" id="4805068">:=</span>&nbsp;<span class="ident" id="4805071">s</span><span class="op" id="4805072">.</span><span class="ident" id="4805073">last</span><span class="op" id="4805077">;</span>&nbsp;<span class="ident" id="4805079">f</span>&nbsp;<span class="op" id="4805081">!=</span>&nbsp;<span class="builtintype" id="4805084">nil</span>&nbsp;<span class="op" id="4805088">&amp;&amp;</span>&nbsp;<span class="ident" id="4805091">f</span><span class="op" id="4805092">.</span><span class="ident" id="4805093">base</span>&nbsp;<span class="op" id="4805098">&lt;=</span>&nbsp;<span class="builtintype" id="4805101">int</span><span class="op" id="4805104">(</span><span class="ident" id="4805105">p</span><span class="op" id="4805106">)</span>&nbsp;<span class="op" id="4805108">&amp;&amp;</span>&nbsp;<span class="builtintype" id="4805111">int</span><span class="op" id="4805114">(</span><span class="ident" id="4805115">p</span><span class="op" id="4805116">)</span>&nbsp;<span class="op" id="4805118">&lt;=</span>&nbsp;<span class="ident" id="4805121">f</span><span class="op" id="4805122">.</span><span class="ident" id="4805123">base</span><span class="op" id="4805127">+</span><span class="ident" id="4805128">f</span><span class="op" id="4805129">.</span><span class="ident" id="4805130">size</span>&nbsp;<span class="op" id="4805135">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805139">s</span><span class="op" id="4805140">.</span><span class="ident" id="4805141">mutex</span><span class="op" id="4805146">.</span><span class="ident" id="4805147">RUnlock</span><span class="op" id="4805154">(</span><span class="op" id="4805155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805159">return</span>&nbsp;<span class="ident" id="4805166">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805172">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805217">if</span>&nbsp;<span class="ident" id="4805220">i</span>&nbsp;<span class="op" id="4805222">:=</span>&nbsp;<span class="ident" id="4805225">searchFiles</span><span class="op" id="4805236">(</span><span class="ident" id="4805237">s</span><span class="op" id="4805238">.</span><span class="ident" id="4805239">files</span><span class="op" id="4805244">,</span>&nbsp;<span class="builtintype" id="4805246">int</span><span class="op" id="4805249">(</span><span class="ident" id="4805250">p</span><span class="op" id="4805251">)</span><span class="op" id="4805252">)</span><span class="op" id="4805253">;</span>&nbsp;<span class="ident" id="4805255">i</span>&nbsp;<span class="op" id="4805257">&gt;=</span>&nbsp;<span class="num" id="4805260">0</span>&nbsp;<span class="op" id="4805262">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805266">f</span>&nbsp;<span class="op" id="4805268">:=</span>&nbsp;<span class="ident" id="4805271">s</span><span class="op" id="4805272">.</span><span class="ident" id="4805273">files</span><span class="op" id="4805278">[</span><span class="ident" id="4805279">i</span><span class="op" id="4805280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4805284">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805335">if</span>&nbsp;<span class="builtintype" id="4805338">int</span><span class="op" id="4805341">(</span><span class="ident" id="4805342">p</span><span class="op" id="4805343">)</span>&nbsp;<span class="op" id="4805345">&lt;=</span>&nbsp;<span class="ident" id="4805348">f</span><span class="op" id="4805349">.</span><span class="ident" id="4805350">base</span><span class="op" id="4805354">+</span><span class="ident" id="4805355">f</span><span class="op" id="4805356">.</span><span class="ident" id="4805357">size</span>&nbsp;<span class="op" id="4805362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805367">s</span><span class="op" id="4805368">.</span><span class="ident" id="4805369">mutex</span><span class="op" id="4805374">.</span><span class="ident" id="4805375">RUnlock</span><span class="op" id="4805382">(</span><span class="op" id="4805383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805388">s</span><span class="op" id="4805389">.</span><span class="ident" id="4805390">mutex</span><span class="op" id="4805395">.</span><span class="ident" id="4805396">Lock</span><span class="op" id="4805400">(</span><span class="op" id="4805401">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805406">s</span><span class="op" id="4805407">.</span><span class="ident" id="4805408">last</span>&nbsp;<span class="op" id="4805413">=</span>&nbsp;<span class="ident" id="4805415">f</span>&nbsp;<span class="comment" id="4805417">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805459">s</span><span class="op" id="4805460">.</span><span class="ident" id="4805461">mutex</span><span class="op" id="4805466">.</span><span class="ident" id="4805467">Unlock</span><span class="op" id="4805473">(</span><span class="op" id="4805474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805479">return</span>&nbsp;<span class="ident" id="4805486">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805493">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805496">s</span><span class="op" id="4805497">.</span><span class="ident" id="4805498">mutex</span><span class="op" id="4805503">.</span><span class="ident" id="4805504">RUnlock</span><span class="op" id="4805511">(</span><span class="op" id="4805512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805515">return</span>&nbsp;<span class="builtintype" id="4805522">nil</span><br>
<span class="lineno"></span><span class="op" id="4805526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4805529">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="4805584">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="4805643">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4805665">//</span><br>
<span class="lineno"></span><span class="keyword" id="4805668">func</span>&nbsp;<span class="op" id="4805673">(</span><span class="ident" id="4805674">s</span>&nbsp;<span class="op" id="4805676">*</span><span class="ident" id="4805677">FileSet</span><span class="op" id="4805684">)</span>&nbsp;<span class="ident" id="4805686">File</span><span class="op" id="4805690">(</span><span class="ident" id="4805691">p</span>&nbsp;<span class="ident" id="4805693">Pos</span><span class="op" id="4805696">)</span>&nbsp;<span class="op" id="4805698">(</span><span class="ident" id="4805699">f</span>&nbsp;<span class="op" id="4805701">*</span><span class="ident" id="4805702">File</span><span class="op" id="4805706">)</span>&nbsp;<span class="op" id="4805708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805711">if</span>&nbsp;<span class="ident" id="4805714">p</span>&nbsp;<span class="op" id="4805716">!=</span>&nbsp;<span class="ident" id="4805719">NoPos</span>&nbsp;<span class="op" id="4805725">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4805729">f</span>&nbsp;<span class="op" id="4805731">=</span>&nbsp;<span class="ident" id="4805733">s</span><span class="op" id="4805734">.</span><span class="ident" id="4805735">file</span><span class="op" id="4805739">(</span><span class="ident" id="4805740">p</span><span class="op" id="4805741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4805744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4805747">return</span><br>
<span class="lineno"></span><span class="op" id="4805754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="4805757">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4805827">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="4805900">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4805958">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="4805998">//</span><br>
<span class="lineno">445</span><span class="keyword" id="4806001">func</span>&nbsp;<span class="op" id="4806006">(</span><span class="ident" id="4806007">s</span>&nbsp;<span class="op" id="4806009">*</span><span class="ident" id="4806010">FileSet</span><span class="op" id="4806017">)</span>&nbsp;<span class="ident" id="4806019">PositionFor</span><span class="op" id="4806030">(</span><span class="ident" id="4806031">p</span>&nbsp;<span class="ident" id="4806033">Pos</span><span class="op" id="4806036">,</span>&nbsp;<span class="ident" id="4806038">adjusted</span>&nbsp;<span class="builtintype" id="4806047">bool</span><span class="op" id="4806051">)</span>&nbsp;<span class="op" id="4806053">(</span><span class="ident" id="4806054">pos</span>&nbsp;<span class="ident" id="4806058">Position</span><span class="op" id="4806066">)</span>&nbsp;<span class="op" id="4806068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806071">if</span>&nbsp;<span class="ident" id="4806074">p</span>&nbsp;<span class="op" id="4806076">!=</span>&nbsp;<span class="ident" id="4806079">NoPos</span>&nbsp;<span class="op" id="4806085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806089">if</span>&nbsp;<span class="ident" id="4806092">f</span>&nbsp;<span class="op" id="4806094">:=</span>&nbsp;<span class="ident" id="4806097">s</span><span class="op" id="4806098">.</span><span class="ident" id="4806099">file</span><span class="op" id="4806103">(</span><span class="ident" id="4806104">p</span><span class="op" id="4806105">)</span><span class="op" id="4806106">;</span>&nbsp;<span class="ident" id="4806108">f</span>&nbsp;<span class="op" id="4806110">!=</span>&nbsp;<span class="builtintype" id="4806113">nil</span>&nbsp;<span class="op" id="4806117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4806122">pos</span>&nbsp;<span class="op" id="4806126">=</span>&nbsp;<span class="ident" id="4806128">f</span><span class="op" id="4806129">.</span><span class="ident" id="4806130">position</span><span class="op" id="4806138">(</span><span class="ident" id="4806139">p</span><span class="op" id="4806140">,</span>&nbsp;<span class="ident" id="4806142">adjusted</span><span class="op" id="4806150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806154">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4806157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806160">return</span><br>
<span class="lineno"></span><span class="op" id="4806167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4806170">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="4806237">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="4806311">//</span><br>
<span class="lineno"></span><span class="keyword" id="4806314">func</span>&nbsp;<span class="op" id="4806319">(</span><span class="ident" id="4806320">s</span>&nbsp;<span class="op" id="4806322">*</span><span class="ident" id="4806323">FileSet</span><span class="op" id="4806330">)</span>&nbsp;<span class="ident" id="4806332">Position</span><span class="op" id="4806340">(</span><span class="ident" id="4806341">p</span>&nbsp;<span class="ident" id="4806343">Pos</span><span class="op" id="4806346">)</span>&nbsp;<span class="op" id="4806348">(</span><span class="ident" id="4806349">pos</span>&nbsp;<span class="ident" id="4806353">Position</span><span class="op" id="4806361">)</span>&nbsp;<span class="op" id="4806363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4806366">return</span>&nbsp;<span class="ident" id="4806373">s</span><span class="op" id="4806374">.</span><span class="ident" id="4806375">PositionFor</span><span class="op" id="4806386">(</span><span class="ident" id="4806387">p</span><span class="op" id="4806388">,</span>&nbsp;<span class="builtintype" id="4806390">true</span><span class="op" id="4806394">)</span><br>
<span class="lineno"></span><span class="op" id="4806396">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="4806399">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4806480">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4806501">func</span>&nbsp;<span class="ident" id="4806506">searchInts</span><span class="op" id="4806516">(</span><span class="ident" id="4806517">a</span>&nbsp;<span class="op" id="4806519">[</span><span class="op" id="4806520">]</span><span class="builtintype" id="4806521">int</span><span class="op" id="4806524">,</span>&nbsp;<span class="ident" id="4806526">x</span>&nbsp;<span class="builtintype" id="4806528">int</span><span class="op" id="4806531">)</span>&nbsp;<span class="builtintype" id="4806533">int</span>&nbsp;<span class="op" id="4806537">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806540">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806597">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806601">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806676">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806680">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806750">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806816">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806883">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4806942">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807000">i</span><span class="op" id="4807001">,</span>&nbsp;<span class="ident" id="4807003">j</span>&nbsp;<span class="op" id="4807005">:=</span>&nbsp;<span class="num" id="4807008">0</span><span class="op" id="4807009">,</span>&nbsp;<span class="builtinfunc" id="4807011">len</span><span class="op" id="4807014">(</span><span class="ident" id="4807015">a</span><span class="op" id="4807016">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807019">for</span>&nbsp;<span class="ident" id="4807023">i</span>&nbsp;<span class="op" id="4807025">&lt;</span>&nbsp;<span class="ident" id="4807027">j</span>&nbsp;<span class="op" id="4807029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807033">h</span>&nbsp;<span class="op" id="4807035">:=</span>&nbsp;<span class="ident" id="4807038">i</span>&nbsp;<span class="op" id="4807040">+</span>&nbsp;<span class="op" id="4807042">(</span><span class="ident" id="4807043">j</span><span class="op" id="4807044">-</span><span class="ident" id="4807045">i</span><span class="op" id="4807046">)</span><span class="op" id="4807047">/</span><span class="num" id="4807048">2</span>&nbsp;<span class="comment" id="4807050">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4807087">//&nbsp;i&nbsp;&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807104">if</span>&nbsp;<span class="ident" id="4807107">a</span><span class="op" id="4807108">[</span><span class="ident" id="4807109">h</span><span class="op" id="4807110">]</span>&nbsp;<span class="op" id="4807112">&lt;=</span>&nbsp;<span class="ident" id="4807115">x</span>&nbsp;<span class="op" id="4807117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807122">i</span>&nbsp;<span class="op" id="4807124">=</span>&nbsp;<span class="ident" id="4807126">h</span>&nbsp;<span class="op" id="4807128">+</span>&nbsp;<span class="num" id="4807130">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807134">}</span>&nbsp;<span class="keyword" id="4807136">else</span>&nbsp;<span class="op" id="4807141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4807146">j</span>&nbsp;<span class="op" id="4807148">=</span>&nbsp;<span class="ident" id="4807150">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4807157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4807160">return</span>&nbsp;<span class="ident" id="4807167">i</span>&nbsp;<span class="op" id="4807169">-</span>&nbsp;<span class="num" id="4807171">1</span><br>
<span class="lineno">485</span><span class="op" id="4807173">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
