<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6932378">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6932433">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6932487">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6932538">package</span>&nbsp;<span class="ident" id="6932546">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6932552">import</span>&nbsp;<span class="op" id="6932559">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6932562">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6932571">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6932580">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6932593">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6932604">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6932611">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6932614">//&nbsp;TestEmpty&nbsp;tests&nbsp;that&nbsp;an&nbsp;empty&nbsp;payload&nbsp;still&nbsp;forms&nbsp;a&nbsp;valid&nbsp;GZIP&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6932688">func</span>&nbsp;<span class="ident" id="6932693">TestEmpty</span><span class="op" id="6932702">(</span><span class="ident" id="6932703">t</span>&nbsp;<span class="op" id="6932705">*</span><span class="ident" id="6932706">testing</span><span class="op" id="6932713">.</span><span class="ident" id="6932714">T</span><span class="op" id="6932715">)</span>&nbsp;<span class="op" id="6932717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932720">buf</span>&nbsp;<span class="op" id="6932724">:=</span>&nbsp;<span class="builtinfunc" id="6932727">new</span><span class="op" id="6932730">(</span><span class="ident" id="6932731">bytes</span><span class="op" id="6932736">.</span><span class="ident" id="6932737">Buffer</span><span class="op" id="6932743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932747">if</span>&nbsp;<span class="ident" id="6932750">err</span>&nbsp;<span class="op" id="6932754">:=</span>&nbsp;<span class="ident" id="6932757">NewWriter</span><span class="op" id="6932766">(</span><span class="ident" id="6932767">buf</span><span class="op" id="6932770">)</span><span class="op" id="6932771">.</span><span class="ident" id="6932772">Close</span><span class="op" id="6932777">(</span><span class="op" id="6932778">)</span><span class="op" id="6932779">;</span>&nbsp;<span class="ident" id="6932781">err</span>&nbsp;<span class="op" id="6932785">!=</span>&nbsp;<span class="ident" id="6932788">nil</span>&nbsp;<span class="op" id="6932792">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932796">t</span><span class="op" id="6932797">.</span><span class="ident" id="6932798">Fatalf</span><span class="op" id="6932804">(</span><span class="string" id="6932805">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6932823">,</span>&nbsp;<span class="ident" id="6932825">err</span><span class="op" id="6932828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6932831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932835">r</span><span class="op" id="6932836">,</span>&nbsp;<span class="ident" id="6932838">err</span>&nbsp;<span class="op" id="6932842">:=</span>&nbsp;<span class="ident" id="6932845">NewReader</span><span class="op" id="6932854">(</span><span class="ident" id="6932855">buf</span><span class="op" id="6932858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932861">if</span>&nbsp;<span class="ident" id="6932864">err</span>&nbsp;<span class="op" id="6932868">!=</span>&nbsp;<span class="ident" id="6932871">nil</span>&nbsp;<span class="op" id="6932875">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932879">t</span><span class="op" id="6932880">.</span><span class="ident" id="6932881">Fatalf</span><span class="op" id="6932887">(</span><span class="string" id="6932888">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6932903">,</span>&nbsp;<span class="ident" id="6932905">err</span><span class="op" id="6932908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6932911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932914">b</span><span class="op" id="6932915">,</span>&nbsp;<span class="ident" id="6932917">err</span>&nbsp;<span class="op" id="6932921">:=</span>&nbsp;<span class="ident" id="6932924">ioutil</span><span class="op" id="6932930">.</span><span class="ident" id="6932931">ReadAll</span><span class="op" id="6932938">(</span><span class="ident" id="6932939">r</span><span class="op" id="6932940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932943">if</span>&nbsp;<span class="ident" id="6932946">err</span>&nbsp;<span class="op" id="6932950">!=</span>&nbsp;<span class="ident" id="6932953">nil</span>&nbsp;<span class="op" id="6932957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932961">t</span><span class="op" id="6932962">.</span><span class="ident" id="6932963">Fatalf</span><span class="op" id="6932969">(</span><span class="string" id="6932970">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6932983">,</span>&nbsp;<span class="ident" id="6932985">err</span><span class="op" id="6932988">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6932991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932994">if</span>&nbsp;<span class="builtinfunc" id="6932997">len</span><span class="op" id="6933000">(</span><span class="ident" id="6933001">b</span><span class="op" id="6933002">)</span>&nbsp;<span class="op" id="6933004">!=</span>&nbsp;<span class="num" id="6933007">0</span>&nbsp;<span class="op" id="6933009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933013">t</span><span class="op" id="6933014">.</span><span class="ident" id="6933015">Fatalf</span><span class="op" id="6933021">(</span><span class="string" id="6933022">&#34;got&nbsp;%d&nbsp;bytes,&nbsp;want&nbsp;0&#34;</span><span class="op" id="6933044">,</span>&nbsp;<span class="builtinfunc" id="6933046">len</span><span class="op" id="6933049">(</span><span class="ident" id="6933050">b</span><span class="op" id="6933051">)</span><span class="op" id="6933052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933058">if</span>&nbsp;<span class="ident" id="6933061">err</span>&nbsp;<span class="op" id="6933065">:=</span>&nbsp;<span class="ident" id="6933068">r</span><span class="op" id="6933069">.</span><span class="ident" id="6933070">Close</span><span class="op" id="6933075">(</span><span class="op" id="6933076">)</span><span class="op" id="6933077">;</span>&nbsp;<span class="ident" id="6933079">err</span>&nbsp;<span class="op" id="6933083">!=</span>&nbsp;<span class="ident" id="6933086">nil</span>&nbsp;<span class="op" id="6933090">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933094">t</span><span class="op" id="6933095">.</span><span class="ident" id="6933096">Fatalf</span><span class="op" id="6933102">(</span><span class="string" id="6933103">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6933121">,</span>&nbsp;<span class="ident" id="6933123">err</span><span class="op" id="6933126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933129">}</span><br>
<span class="lineno"></span><span class="op" id="6933131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6933134">//&nbsp;TestRoundTrip&nbsp;tests&nbsp;that&nbsp;gzipping&nbsp;and&nbsp;then&nbsp;gunzipping&nbsp;is&nbsp;the&nbsp;identity</span><br>
<span class="lineno">40</span><span class="comment" id="6933207">//&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6933220">func</span>&nbsp;<span class="ident" id="6933225">TestRoundTrip</span><span class="op" id="6933238">(</span><span class="ident" id="6933239">t</span>&nbsp;<span class="op" id="6933241">*</span><span class="ident" id="6933242">testing</span><span class="op" id="6933249">.</span><span class="ident" id="6933250">T</span><span class="op" id="6933251">)</span>&nbsp;<span class="op" id="6933253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933256">buf</span>&nbsp;<span class="op" id="6933260">:=</span>&nbsp;<span class="builtinfunc" id="6933263">new</span><span class="op" id="6933266">(</span><span class="ident" id="6933267">bytes</span><span class="op" id="6933272">.</span><span class="ident" id="6933273">Buffer</span><span class="op" id="6933279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933283">w</span>&nbsp;<span class="op" id="6933285">:=</span>&nbsp;<span class="ident" id="6933288">NewWriter</span><span class="op" id="6933297">(</span><span class="ident" id="6933298">buf</span><span class="op" id="6933301">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933304">w</span><span class="op" id="6933305">.</span><span class="ident" id="6933306">Comment</span>&nbsp;<span class="op" id="6933314">=</span>&nbsp;<span class="string" id="6933316">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933327">w</span><span class="op" id="6933328">.</span><span class="ident" id="6933329">Extra</span>&nbsp;<span class="op" id="6933335">=</span>&nbsp;<span class="op" id="6933337">[</span><span class="op" id="6933338">]</span><span class="builtintype" id="6933339">byte</span><span class="op" id="6933343">(</span><span class="string" id="6933344">&#34;extra&#34;</span><span class="op" id="6933351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933354">w</span><span class="op" id="6933355">.</span><span class="ident" id="6933356">ModTime</span>&nbsp;<span class="op" id="6933364">=</span>&nbsp;<span class="ident" id="6933366">time</span><span class="op" id="6933370">.</span><span class="ident" id="6933371">Unix</span><span class="op" id="6933375">(</span><span class="num" id="6933376">1e8</span><span class="op" id="6933379">,</span>&nbsp;<span class="num" id="6933381">0</span><span class="op" id="6933382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933385">w</span><span class="op" id="6933386">.</span><span class="ident" id="6933387">Name</span>&nbsp;<span class="op" id="6933392">=</span>&nbsp;<span class="string" id="6933394">&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933402">if</span>&nbsp;<span class="ident" id="6933405">_</span><span class="op" id="6933406">,</span>&nbsp;<span class="ident" id="6933408">err</span>&nbsp;<span class="op" id="6933412">:=</span>&nbsp;<span class="ident" id="6933415">w</span><span class="op" id="6933416">.</span><span class="ident" id="6933417">Write</span><span class="op" id="6933422">(</span><span class="op" id="6933423">[</span><span class="op" id="6933424">]</span><span class="builtintype" id="6933425">byte</span><span class="op" id="6933429">(</span><span class="string" id="6933430">&#34;payload&#34;</span><span class="op" id="6933439">)</span><span class="op" id="6933440">)</span><span class="op" id="6933441">;</span>&nbsp;<span class="ident" id="6933443">err</span>&nbsp;<span class="op" id="6933447">!=</span>&nbsp;<span class="ident" id="6933450">nil</span>&nbsp;<span class="op" id="6933454">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933458">t</span><span class="op" id="6933459">.</span><span class="ident" id="6933460">Fatalf</span><span class="op" id="6933466">(</span><span class="string" id="6933467">&#34;Write:&nbsp;%v&#34;</span><span class="op" id="6933478">,</span>&nbsp;<span class="ident" id="6933480">err</span><span class="op" id="6933483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933489">if</span>&nbsp;<span class="ident" id="6933492">err</span>&nbsp;<span class="op" id="6933496">:=</span>&nbsp;<span class="ident" id="6933499">w</span><span class="op" id="6933500">.</span><span class="ident" id="6933501">Close</span><span class="op" id="6933506">(</span><span class="op" id="6933507">)</span><span class="op" id="6933508">;</span>&nbsp;<span class="ident" id="6933510">err</span>&nbsp;<span class="op" id="6933514">!=</span>&nbsp;<span class="ident" id="6933517">nil</span>&nbsp;<span class="op" id="6933521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933525">t</span><span class="op" id="6933526">.</span><span class="ident" id="6933527">Fatalf</span><span class="op" id="6933533">(</span><span class="string" id="6933534">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="6933552">,</span>&nbsp;<span class="ident" id="6933554">err</span><span class="op" id="6933557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933560">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933564">r</span><span class="op" id="6933565">,</span>&nbsp;<span class="ident" id="6933567">err</span>&nbsp;<span class="op" id="6933571">:=</span>&nbsp;<span class="ident" id="6933574">NewReader</span><span class="op" id="6933583">(</span><span class="ident" id="6933584">buf</span><span class="op" id="6933587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933590">if</span>&nbsp;<span class="ident" id="6933593">err</span>&nbsp;<span class="op" id="6933597">!=</span>&nbsp;<span class="ident" id="6933600">nil</span>&nbsp;<span class="op" id="6933604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933608">t</span><span class="op" id="6933609">.</span><span class="ident" id="6933610">Fatalf</span><span class="op" id="6933616">(</span><span class="string" id="6933617">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6933632">,</span>&nbsp;<span class="ident" id="6933634">err</span><span class="op" id="6933637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933640">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933643">b</span><span class="op" id="6933644">,</span>&nbsp;<span class="ident" id="6933646">err</span>&nbsp;<span class="op" id="6933650">:=</span>&nbsp;<span class="ident" id="6933653">ioutil</span><span class="op" id="6933659">.</span><span class="ident" id="6933660">ReadAll</span><span class="op" id="6933667">(</span><span class="ident" id="6933668">r</span><span class="op" id="6933669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933672">if</span>&nbsp;<span class="ident" id="6933675">err</span>&nbsp;<span class="op" id="6933679">!=</span>&nbsp;<span class="ident" id="6933682">nil</span>&nbsp;<span class="op" id="6933686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933690">t</span><span class="op" id="6933691">.</span><span class="ident" id="6933692">Fatalf</span><span class="op" id="6933698">(</span><span class="string" id="6933699">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6933712">,</span>&nbsp;<span class="ident" id="6933714">err</span><span class="op" id="6933717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933723">if</span>&nbsp;<span class="builtintype" id="6933726">string</span><span class="op" id="6933732">(</span><span class="ident" id="6933733">b</span><span class="op" id="6933734">)</span>&nbsp;<span class="op" id="6933736">!=</span>&nbsp;<span class="string" id="6933739">&#34;payload&#34;</span>&nbsp;<span class="op" id="6933749">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933753">t</span><span class="op" id="6933754">.</span><span class="ident" id="6933755">Fatalf</span><span class="op" id="6933761">(</span><span class="string" id="6933762">&#34;payload&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6933786">,</span>&nbsp;<span class="builtintype" id="6933788">string</span><span class="op" id="6933794">(</span><span class="ident" id="6933795">b</span><span class="op" id="6933796">)</span><span class="op" id="6933797">,</span>&nbsp;<span class="string" id="6933799">&#34;payload&#34;</span><span class="op" id="6933808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933814">if</span>&nbsp;<span class="ident" id="6933817">r</span><span class="op" id="6933818">.</span><span class="ident" id="6933819">Comment</span>&nbsp;<span class="op" id="6933827">!=</span>&nbsp;<span class="string" id="6933830">&#34;comment&#34;</span>&nbsp;<span class="op" id="6933840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933844">t</span><span class="op" id="6933845">.</span><span class="ident" id="6933846">Fatalf</span><span class="op" id="6933852">(</span><span class="string" id="6933853">&#34;comment&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6933877">,</span>&nbsp;<span class="ident" id="6933879">r</span><span class="op" id="6933880">.</span><span class="ident" id="6933881">Comment</span><span class="op" id="6933888">,</span>&nbsp;<span class="string" id="6933890">&#34;comment&#34;</span><span class="op" id="6933899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933902">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933905">if</span>&nbsp;<span class="builtintype" id="6933908">string</span><span class="op" id="6933914">(</span><span class="ident" id="6933915">r</span><span class="op" id="6933916">.</span><span class="ident" id="6933917">Extra</span><span class="op" id="6933922">)</span>&nbsp;<span class="op" id="6933924">!=</span>&nbsp;<span class="string" id="6933927">&#34;extra&#34;</span>&nbsp;<span class="op" id="6933935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933939">t</span><span class="op" id="6933940">.</span><span class="ident" id="6933941">Fatalf</span><span class="op" id="6933947">(</span><span class="string" id="6933948">&#34;extra&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6933970">,</span>&nbsp;<span class="ident" id="6933972">r</span><span class="op" id="6933973">.</span><span class="ident" id="6933974">Extra</span><span class="op" id="6933979">,</span>&nbsp;<span class="string" id="6933981">&#34;extra&#34;</span><span class="op" id="6933988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933994">if</span>&nbsp;<span class="ident" id="6933997">r</span><span class="op" id="6933998">.</span><span class="ident" id="6933999">ModTime</span><span class="op" id="6934006">.</span><span class="ident" id="6934007">Unix</span><span class="op" id="6934011">(</span><span class="op" id="6934012">)</span>&nbsp;<span class="op" id="6934014">!=</span>&nbsp;<span class="num" id="6934017">1e8</span>&nbsp;<span class="op" id="6934021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934025">t</span><span class="op" id="6934026">.</span><span class="ident" id="6934027">Fatalf</span><span class="op" id="6934033">(</span><span class="string" id="6934034">&#34;mtime&nbsp;is&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6934056">,</span>&nbsp;<span class="ident" id="6934058">r</span><span class="op" id="6934059">.</span><span class="ident" id="6934060">ModTime</span><span class="op" id="6934067">.</span><span class="ident" id="6934068">Unix</span><span class="op" id="6934072">(</span><span class="op" id="6934073">)</span><span class="op" id="6934074">,</span>&nbsp;<span class="builtintype" id="6934076">uint32</span><span class="op" id="6934082">(</span><span class="num" id="6934083">1e8</span><span class="op" id="6934086">)</span><span class="op" id="6934087">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934093">if</span>&nbsp;<span class="ident" id="6934096">r</span><span class="op" id="6934097">.</span><span class="ident" id="6934098">Name</span>&nbsp;<span class="op" id="6934103">!=</span>&nbsp;<span class="string" id="6934106">&#34;name&#34;</span>&nbsp;<span class="op" id="6934113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934117">t</span><span class="op" id="6934118">.</span><span class="ident" id="6934119">Fatalf</span><span class="op" id="6934125">(</span><span class="string" id="6934126">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6934147">,</span>&nbsp;<span class="ident" id="6934149">r</span><span class="op" id="6934150">.</span><span class="ident" id="6934151">Name</span><span class="op" id="6934155">,</span>&nbsp;<span class="string" id="6934157">&#34;name&#34;</span><span class="op" id="6934163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934169">if</span>&nbsp;<span class="ident" id="6934172">err</span>&nbsp;<span class="op" id="6934176">:=</span>&nbsp;<span class="ident" id="6934179">r</span><span class="op" id="6934180">.</span><span class="ident" id="6934181">Close</span><span class="op" id="6934186">(</span><span class="op" id="6934187">)</span><span class="op" id="6934188">;</span>&nbsp;<span class="ident" id="6934190">err</span>&nbsp;<span class="op" id="6934194">!=</span>&nbsp;<span class="ident" id="6934197">nil</span>&nbsp;<span class="op" id="6934201">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934205">t</span><span class="op" id="6934206">.</span><span class="ident" id="6934207">Fatalf</span><span class="op" id="6934213">(</span><span class="string" id="6934214">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6934232">,</span>&nbsp;<span class="ident" id="6934234">err</span><span class="op" id="6934237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934240">}</span><br>
<span class="lineno"></span><span class="op" id="6934242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6934245">//&nbsp;TestLatin1&nbsp;tests&nbsp;the&nbsp;internal&nbsp;functions&nbsp;for&nbsp;converting&nbsp;to&nbsp;and&nbsp;from&nbsp;Latin-1.</span><br>
<span class="lineno">85</span><span class="keyword" id="6934324">func</span>&nbsp;<span class="ident" id="6934329">TestLatin1</span><span class="op" id="6934339">(</span><span class="ident" id="6934340">t</span>&nbsp;<span class="op" id="6934342">*</span><span class="ident" id="6934343">testing</span><span class="op" id="6934350">.</span><span class="ident" id="6934351">T</span><span class="op" id="6934352">)</span>&nbsp;<span class="op" id="6934354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934357">latin1</span>&nbsp;<span class="op" id="6934364">:=</span>&nbsp;<span class="op" id="6934367">[</span><span class="op" id="6934368">]</span><span class="builtintype" id="6934369">byte</span><span class="op" id="6934373">{</span><span class="num" id="6934374">0xc4</span><span class="op" id="6934378">,</span>&nbsp;<span class="string" id="6934380">&#39;u&#39;</span><span class="op" id="6934383">,</span>&nbsp;<span class="num" id="6934385">0xdf</span><span class="op" id="6934389">,</span>&nbsp;<span class="string" id="6934391">&#39;e&#39;</span><span class="op" id="6934394">,</span>&nbsp;<span class="string" id="6934396">&#39;r&#39;</span><span class="op" id="6934399">,</span>&nbsp;<span class="string" id="6934401">&#39;u&#39;</span><span class="op" id="6934404">,</span>&nbsp;<span class="string" id="6934406">&#39;n&#39;</span><span class="op" id="6934409">,</span>&nbsp;<span class="string" id="6934411">&#39;g&#39;</span><span class="op" id="6934414">,</span>&nbsp;<span class="num" id="6934416">0</span><span class="op" id="6934417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934420">utf8</span>&nbsp;<span class="op" id="6934425">:=</span>&nbsp;<span class="string" id="6934428">&#34;Äußerung&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934442">z</span>&nbsp;<span class="op" id="6934444">:=</span>&nbsp;<span class="ident" id="6934447">Reader</span><span class="op" id="6934453">{</span><span class="ident" id="6934454">r</span><span class="op" id="6934455">:</span>&nbsp;<span class="ident" id="6934457">bufio</span><span class="op" id="6934462">.</span><span class="ident" id="6934463">NewReader</span><span class="op" id="6934472">(</span><span class="ident" id="6934473">bytes</span><span class="op" id="6934478">.</span><span class="ident" id="6934479">NewReader</span><span class="op" id="6934488">(</span><span class="ident" id="6934489">latin1</span><span class="op" id="6934495">)</span><span class="op" id="6934496">)</span><span class="op" id="6934497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934500">s</span><span class="op" id="6934501">,</span>&nbsp;<span class="ident" id="6934503">err</span>&nbsp;<span class="op" id="6934507">:=</span>&nbsp;<span class="ident" id="6934510">z</span><span class="op" id="6934511">.</span><span class="ident" id="6934512">readString</span><span class="op" id="6934522">(</span><span class="op" id="6934523">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934526">if</span>&nbsp;<span class="ident" id="6934529">err</span>&nbsp;<span class="op" id="6934533">!=</span>&nbsp;<span class="ident" id="6934536">nil</span>&nbsp;<span class="op" id="6934540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934544">t</span><span class="op" id="6934545">.</span><span class="ident" id="6934546">Fatalf</span><span class="op" id="6934552">(</span><span class="string" id="6934553">&#34;readString:&nbsp;%v&#34;</span><span class="op" id="6934569">,</span>&nbsp;<span class="ident" id="6934571">err</span><span class="op" id="6934574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934580">if</span>&nbsp;<span class="ident" id="6934583">s</span>&nbsp;<span class="op" id="6934585">!=</span>&nbsp;<span class="ident" id="6934588">utf8</span>&nbsp;<span class="op" id="6934593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934597">t</span><span class="op" id="6934598">.</span><span class="ident" id="6934599">Fatalf</span><span class="op" id="6934605">(</span><span class="string" id="6934606">&#34;read&nbsp;latin-1:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6934637">,</span>&nbsp;<span class="ident" id="6934639">s</span><span class="op" id="6934640">,</span>&nbsp;<span class="ident" id="6934642">utf8</span><span class="op" id="6934646">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934653">buf</span>&nbsp;<span class="op" id="6934657">:=</span>&nbsp;<span class="ident" id="6934660">bytes</span><span class="op" id="6934665">.</span><span class="ident" id="6934666">NewBuffer</span><span class="op" id="6934675">(</span><span class="builtinfunc" id="6934676">make</span><span class="op" id="6934680">(</span><span class="op" id="6934681">[</span><span class="op" id="6934682">]</span><span class="builtintype" id="6934683">byte</span><span class="op" id="6934687">,</span>&nbsp;<span class="num" id="6934689">0</span><span class="op" id="6934690">,</span>&nbsp;<span class="builtinfunc" id="6934692">len</span><span class="op" id="6934695">(</span><span class="ident" id="6934696">latin1</span><span class="op" id="6934702">)</span><span class="op" id="6934703">)</span><span class="op" id="6934704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934707">c</span>&nbsp;<span class="op" id="6934709">:=</span>&nbsp;<span class="ident" id="6934712">Writer</span><span class="op" id="6934718">{</span><span class="ident" id="6934719">w</span><span class="op" id="6934720">:</span>&nbsp;<span class="ident" id="6934722">buf</span><span class="op" id="6934725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934728">if</span>&nbsp;<span class="ident" id="6934731">err</span>&nbsp;<span class="op" id="6934735">=</span>&nbsp;<span class="ident" id="6934737">c</span><span class="op" id="6934738">.</span><span class="ident" id="6934739">writeString</span><span class="op" id="6934750">(</span><span class="ident" id="6934751">utf8</span><span class="op" id="6934755">)</span><span class="op" id="6934756">;</span>&nbsp;<span class="ident" id="6934758">err</span>&nbsp;<span class="op" id="6934762">!=</span>&nbsp;<span class="ident" id="6934765">nil</span>&nbsp;<span class="op" id="6934769">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934773">t</span><span class="op" id="6934774">.</span><span class="ident" id="6934775">Fatalf</span><span class="op" id="6934781">(</span><span class="string" id="6934782">&#34;writeString:&nbsp;%v&#34;</span><span class="op" id="6934799">,</span>&nbsp;<span class="ident" id="6934801">err</span><span class="op" id="6934804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934810">s</span>&nbsp;<span class="op" id="6934812">=</span>&nbsp;<span class="ident" id="6934814">buf</span><span class="op" id="6934817">.</span><span class="ident" id="6934818">String</span><span class="op" id="6934824">(</span><span class="op" id="6934825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934828">if</span>&nbsp;<span class="ident" id="6934831">s</span>&nbsp;<span class="op" id="6934833">!=</span>&nbsp;<span class="builtintype" id="6934836">string</span><span class="op" id="6934842">(</span><span class="ident" id="6934843">latin1</span><span class="op" id="6934849">)</span>&nbsp;<span class="op" id="6934851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934855">t</span><span class="op" id="6934856">.</span><span class="ident" id="6934857">Fatalf</span><span class="op" id="6934863">(</span><span class="string" id="6934864">&#34;write&nbsp;utf-8:&nbsp;got&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6934894">,</span>&nbsp;<span class="ident" id="6934896">s</span><span class="op" id="6934897">,</span>&nbsp;<span class="builtintype" id="6934899">string</span><span class="op" id="6934905">(</span><span class="ident" id="6934906">latin1</span><span class="op" id="6934912">)</span><span class="op" id="6934913">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934916">}</span><br>
<span class="lineno"></span><span class="op" id="6934918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6934921">//&nbsp;TestLatin1RoundTrip&nbsp;tests&nbsp;that&nbsp;metadata&nbsp;that&nbsp;is&nbsp;representable&nbsp;in&nbsp;Latin-1</span><br>
<span class="lineno"></span><span class="comment" id="6934997">//&nbsp;survives&nbsp;a&nbsp;round&nbsp;trip.</span><br>
<span class="lineno">110</span><span class="keyword" id="6935023">func</span>&nbsp;<span class="ident" id="6935028">TestLatin1RoundTrip</span><span class="op" id="6935047">(</span><span class="ident" id="6935048">t</span>&nbsp;<span class="op" id="6935050">*</span><span class="ident" id="6935051">testing</span><span class="op" id="6935058">.</span><span class="ident" id="6935059">T</span><span class="op" id="6935060">)</span>&nbsp;<span class="op" id="6935062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935065">testCases</span>&nbsp;<span class="op" id="6935075">:=</span>&nbsp;<span class="op" id="6935078">[</span><span class="op" id="6935079">]</span><span class="keyword" id="6935080">struct</span>&nbsp;<span class="op" id="6935087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935091">name</span>&nbsp;<span class="builtintype" id="6935096">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935105">ok</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6935110">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935116">}</span><span class="op" id="6935117">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935121">{</span><span class="string" id="6935122">&#34;&#34;</span><span class="op" id="6935124">,</span>&nbsp;<span class="builtintype" id="6935126">true</span><span class="op" id="6935130">}</span><span class="op" id="6935131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935135">{</span><span class="string" id="6935136">&#34;ASCII&nbsp;is&nbsp;OK&#34;</span><span class="op" id="6935149">,</span>&nbsp;<span class="builtintype" id="6935151">true</span><span class="op" id="6935155">}</span><span class="op" id="6935156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935160">{</span><span class="string" id="6935161">&#34;unless&nbsp;it&nbsp;contains&nbsp;a&nbsp;NUL\x00&#34;</span><span class="op" id="6935191">,</span>&nbsp;<span class="builtintype" id="6935193">false</span><span class="op" id="6935198">}</span><span class="op" id="6935199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935203">{</span><span class="string" id="6935204">&#34;no&nbsp;matter&nbsp;where&nbsp;\x00&nbsp;occurs&#34;</span><span class="op" id="6935233">,</span>&nbsp;<span class="builtintype" id="6935235">false</span><span class="op" id="6935240">}</span><span class="op" id="6935241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935245">{</span><span class="string" id="6935246">&#34;\x00\x00\x00&#34;</span><span class="op" id="6935260">,</span>&nbsp;<span class="builtintype" id="6935262">false</span><span class="op" id="6935267">}</span><span class="op" id="6935268">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935272">{</span><span class="string" id="6935273">&#34;Látin-1&nbsp;also&nbsp;passes&nbsp;(U+00E1)&#34;</span><span class="op" id="6935304">,</span>&nbsp;<span class="builtintype" id="6935306">true</span><span class="op" id="6935310">}</span><span class="op" id="6935311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935315">{</span><span class="string" id="6935316">&#34;but&nbsp;LĀtin&nbsp;Extended-A&nbsp;(U+0100)&nbsp;does&nbsp;not&#34;</span><span class="op" id="6935357">,</span>&nbsp;<span class="builtintype" id="6935359">false</span><span class="op" id="6935364">}</span><span class="op" id="6935365">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935369">{</span><span class="string" id="6935370">&#34;neither&nbsp;does&nbsp;日本語&#34;</span><span class="op" id="6935394">,</span>&nbsp;<span class="builtintype" id="6935396">false</span><span class="op" id="6935401">}</span><span class="op" id="6935402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935406">{</span><span class="string" id="6935407">&#34;invalid&nbsp;UTF-8&nbsp;also&nbsp;\xffails&#34;</span><span class="op" id="6935436">,</span>&nbsp;<span class="builtintype" id="6935438">false</span><span class="op" id="6935443">}</span><span class="op" id="6935444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935448">{</span><span class="string" id="6935449">&#34;\x00&nbsp;as&nbsp;does&nbsp;Látin-1&nbsp;with&nbsp;NUL&#34;</span><span class="op" id="6935481">,</span>&nbsp;<span class="builtintype" id="6935483">false</span><span class="op" id="6935488">}</span><span class="op" id="6935489">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935495">for</span>&nbsp;<span class="ident" id="6935499">_</span><span class="op" id="6935500">,</span>&nbsp;<span class="ident" id="6935502">tc</span>&nbsp;<span class="op" id="6935505">:=</span>&nbsp;<span class="keyword" id="6935508">range</span>&nbsp;<span class="ident" id="6935514">testCases</span>&nbsp;<span class="op" id="6935524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935528">buf</span>&nbsp;<span class="op" id="6935532">:=</span>&nbsp;<span class="builtinfunc" id="6935535">new</span><span class="op" id="6935538">(</span><span class="ident" id="6935539">bytes</span><span class="op" id="6935544">.</span><span class="ident" id="6935545">Buffer</span><span class="op" id="6935551">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935556">w</span>&nbsp;<span class="op" id="6935558">:=</span>&nbsp;<span class="ident" id="6935561">NewWriter</span><span class="op" id="6935570">(</span><span class="ident" id="6935571">buf</span><span class="op" id="6935574">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935578">w</span><span class="op" id="6935579">.</span><span class="ident" id="6935580">Name</span>&nbsp;<span class="op" id="6935585">=</span>&nbsp;<span class="ident" id="6935587">tc</span><span class="op" id="6935589">.</span><span class="ident" id="6935590">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935597">err</span>&nbsp;<span class="op" id="6935601">:=</span>&nbsp;<span class="ident" id="6935604">w</span><span class="op" id="6935605">.</span><span class="ident" id="6935606">Close</span><span class="op" id="6935611">(</span><span class="op" id="6935612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935616">if</span>&nbsp;<span class="op" id="6935619">(</span><span class="ident" id="6935620">err</span>&nbsp;<span class="op" id="6935624">==</span>&nbsp;<span class="ident" id="6935627">nil</span><span class="op" id="6935630">)</span>&nbsp;<span class="op" id="6935632">!=</span>&nbsp;<span class="ident" id="6935635">tc</span><span class="op" id="6935637">.</span><span class="ident" id="6935638">ok</span>&nbsp;<span class="op" id="6935641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935646">t</span><span class="op" id="6935647">.</span><span class="ident" id="6935648">Errorf</span><span class="op" id="6935654">(</span><span class="string" id="6935655">&#34;Writer.Close:&nbsp;name&nbsp;=&nbsp;%q,&nbsp;err&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6935690">,</span>&nbsp;<span class="ident" id="6935692">tc</span><span class="op" id="6935694">.</span><span class="ident" id="6935695">name</span><span class="op" id="6935699">,</span>&nbsp;<span class="ident" id="6935701">err</span><span class="op" id="6935704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935709">continue</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935724">if</span>&nbsp;<span class="op" id="6935727">!</span><span class="ident" id="6935728">tc</span><span class="op" id="6935730">.</span><span class="ident" id="6935731">ok</span>&nbsp;<span class="op" id="6935734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935739">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935755">r</span><span class="op" id="6935756">,</span>&nbsp;<span class="ident" id="6935758">err</span>&nbsp;<span class="op" id="6935762">:=</span>&nbsp;<span class="ident" id="6935765">NewReader</span><span class="op" id="6935774">(</span><span class="ident" id="6935775">buf</span><span class="op" id="6935778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935782">if</span>&nbsp;<span class="ident" id="6935785">err</span>&nbsp;<span class="op" id="6935789">!=</span>&nbsp;<span class="ident" id="6935792">nil</span>&nbsp;<span class="op" id="6935796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935801">t</span><span class="op" id="6935802">.</span><span class="ident" id="6935803">Errorf</span><span class="op" id="6935809">(</span><span class="string" id="6935810">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="6935825">,</span>&nbsp;<span class="ident" id="6935827">err</span><span class="op" id="6935830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935835">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935846">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935850">_</span><span class="op" id="6935851">,</span>&nbsp;<span class="ident" id="6935853">err</span>&nbsp;<span class="op" id="6935857">=</span>&nbsp;<span class="ident" id="6935859">ioutil</span><span class="op" id="6935865">.</span><span class="ident" id="6935866">ReadAll</span><span class="op" id="6935873">(</span><span class="ident" id="6935874">r</span><span class="op" id="6935875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935879">if</span>&nbsp;<span class="ident" id="6935882">err</span>&nbsp;<span class="op" id="6935886">!=</span>&nbsp;<span class="ident" id="6935889">nil</span>&nbsp;<span class="op" id="6935893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935898">t</span><span class="op" id="6935899">.</span><span class="ident" id="6935900">Errorf</span><span class="op" id="6935906">(</span><span class="string" id="6935907">&#34;ReadAll:&nbsp;%v&#34;</span><span class="op" id="6935920">,</span>&nbsp;<span class="ident" id="6935922">err</span><span class="op" id="6935925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935930">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935941">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935945">if</span>&nbsp;<span class="ident" id="6935948">r</span><span class="op" id="6935949">.</span><span class="ident" id="6935950">Name</span>&nbsp;<span class="op" id="6935955">!=</span>&nbsp;<span class="ident" id="6935958">tc</span><span class="op" id="6935960">.</span><span class="ident" id="6935961">name</span>&nbsp;<span class="op" id="6935966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935971">t</span><span class="op" id="6935972">.</span><span class="ident" id="6935973">Errorf</span><span class="op" id="6935979">(</span><span class="string" id="6935980">&#34;name&nbsp;is&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6936001">,</span>&nbsp;<span class="ident" id="6936003">r</span><span class="op" id="6936004">.</span><span class="ident" id="6936005">Name</span><span class="op" id="6936009">,</span>&nbsp;<span class="ident" id="6936011">tc</span><span class="op" id="6936013">.</span><span class="ident" id="6936014">name</span><span class="op" id="6936018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936023">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936038">if</span>&nbsp;<span class="ident" id="6936041">err</span>&nbsp;<span class="op" id="6936045">:=</span>&nbsp;<span class="ident" id="6936048">r</span><span class="op" id="6936049">.</span><span class="ident" id="6936050">Close</span><span class="op" id="6936055">(</span><span class="op" id="6936056">)</span><span class="op" id="6936057">;</span>&nbsp;<span class="ident" id="6936059">err</span>&nbsp;<span class="op" id="6936063">!=</span>&nbsp;<span class="ident" id="6936066">nil</span>&nbsp;<span class="op" id="6936070">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936075">t</span><span class="op" id="6936076">.</span><span class="ident" id="6936077">Errorf</span><span class="op" id="6936083">(</span><span class="string" id="6936084">&#34;Reader.Close:&nbsp;%v&#34;</span><span class="op" id="6936102">,</span>&nbsp;<span class="ident" id="6936104">err</span><span class="op" id="6936107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936112">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936126">}</span><br>
<span class="lineno"></span><span class="op" id="6936128">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6936131">func</span>&nbsp;<span class="ident" id="6936136">TestWriterFlush</span><span class="op" id="6936151">(</span><span class="ident" id="6936152">t</span>&nbsp;<span class="op" id="6936154">*</span><span class="ident" id="6936155">testing</span><span class="op" id="6936162">.</span><span class="ident" id="6936163">T</span><span class="op" id="6936164">)</span>&nbsp;<span class="op" id="6936166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936169">buf</span>&nbsp;<span class="op" id="6936173">:=</span>&nbsp;<span class="builtinfunc" id="6936176">new</span><span class="op" id="6936179">(</span><span class="ident" id="6936180">bytes</span><span class="op" id="6936185">.</span><span class="ident" id="6936186">Buffer</span><span class="op" id="6936192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936196">w</span>&nbsp;<span class="op" id="6936198">:=</span>&nbsp;<span class="ident" id="6936201">NewWriter</span><span class="op" id="6936210">(</span><span class="ident" id="6936211">buf</span><span class="op" id="6936214">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936217">w</span><span class="op" id="6936218">.</span><span class="ident" id="6936219">Comment</span>&nbsp;<span class="op" id="6936227">=</span>&nbsp;<span class="string" id="6936229">&#34;comment&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936240">w</span><span class="op" id="6936241">.</span><span class="ident" id="6936242">Extra</span>&nbsp;<span class="op" id="6936248">=</span>&nbsp;<span class="op" id="6936250">[</span><span class="op" id="6936251">]</span><span class="builtintype" id="6936252">byte</span><span class="op" id="6936256">(</span><span class="string" id="6936257">&#34;extra&#34;</span><span class="op" id="6936264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936267">w</span><span class="op" id="6936268">.</span><span class="ident" id="6936269">ModTime</span>&nbsp;<span class="op" id="6936277">=</span>&nbsp;<span class="ident" id="6936279">time</span><span class="op" id="6936283">.</span><span class="ident" id="6936284">Unix</span><span class="op" id="6936288">(</span><span class="num" id="6936289">1e8</span><span class="op" id="6936292">,</span>&nbsp;<span class="num" id="6936294">0</span><span class="op" id="6936295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936298">w</span><span class="op" id="6936299">.</span><span class="ident" id="6936300">Name</span>&nbsp;<span class="op" id="6936305">=</span>&nbsp;<span class="string" id="6936307">&#34;name&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936316">n0</span>&nbsp;<span class="op" id="6936319">:=</span>&nbsp;<span class="ident" id="6936322">buf</span><span class="op" id="6936325">.</span><span class="ident" id="6936326">Len</span><span class="op" id="6936329">(</span><span class="op" id="6936330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936333">if</span>&nbsp;<span class="ident" id="6936336">n0</span>&nbsp;<span class="op" id="6936339">!=</span>&nbsp;<span class="num" id="6936342">0</span>&nbsp;<span class="op" id="6936344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936348">t</span><span class="op" id="6936349">.</span><span class="ident" id="6936350">Fatalf</span><span class="op" id="6936356">(</span><span class="string" id="6936357">&#34;buffer&nbsp;size&nbsp;=&nbsp;%d&nbsp;before&nbsp;writes;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6936397">,</span>&nbsp;<span class="ident" id="6936399">n0</span><span class="op" id="6936401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936408">if</span>&nbsp;<span class="ident" id="6936411">err</span>&nbsp;<span class="op" id="6936415">:=</span>&nbsp;<span class="ident" id="6936418">w</span><span class="op" id="6936419">.</span><span class="ident" id="6936420">Flush</span><span class="op" id="6936425">(</span><span class="op" id="6936426">)</span><span class="op" id="6936427">;</span>&nbsp;<span class="ident" id="6936429">err</span>&nbsp;<span class="op" id="6936433">!=</span>&nbsp;<span class="ident" id="6936436">nil</span>&nbsp;<span class="op" id="6936440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936444">t</span><span class="op" id="6936445">.</span><span class="ident" id="6936446">Fatal</span><span class="op" id="6936451">(</span><span class="ident" id="6936452">err</span><span class="op" id="6936455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936462">n1</span>&nbsp;<span class="op" id="6936465">:=</span>&nbsp;<span class="ident" id="6936468">buf</span><span class="op" id="6936471">.</span><span class="ident" id="6936472">Len</span><span class="op" id="6936475">(</span><span class="op" id="6936476">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936479">if</span>&nbsp;<span class="ident" id="6936482">n1</span>&nbsp;<span class="op" id="6936485">==</span>&nbsp;<span class="num" id="6936488">0</span>&nbsp;<span class="op" id="6936490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936494">t</span><span class="op" id="6936495">.</span><span class="ident" id="6936496">Fatal</span><span class="op" id="6936501">(</span><span class="string" id="6936502">&#34;no&nbsp;data&nbsp;after&nbsp;first&nbsp;flush&#34;</span><span class="op" id="6936529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936536">w</span><span class="op" id="6936537">.</span><span class="ident" id="6936538">Write</span><span class="op" id="6936543">(</span><span class="op" id="6936544">[</span><span class="op" id="6936545">]</span><span class="builtintype" id="6936546">byte</span><span class="op" id="6936550">(</span><span class="string" id="6936551">&#34;x&#34;</span><span class="op" id="6936554">)</span><span class="op" id="6936555">)</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936559">n2</span>&nbsp;<span class="op" id="6936562">:=</span>&nbsp;<span class="ident" id="6936565">buf</span><span class="op" id="6936568">.</span><span class="ident" id="6936569">Len</span><span class="op" id="6936572">(</span><span class="op" id="6936573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936576">if</span>&nbsp;<span class="ident" id="6936579">n1</span>&nbsp;<span class="op" id="6936582">!=</span>&nbsp;<span class="ident" id="6936585">n2</span>&nbsp;<span class="op" id="6936588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936592">t</span><span class="op" id="6936593">.</span><span class="ident" id="6936594">Fatalf</span><span class="op" id="6936600">(</span><span class="string" id="6936601">&#34;after&nbsp;writing&nbsp;a&nbsp;single&nbsp;byte,&nbsp;size&nbsp;changed&nbsp;from&nbsp;%d&nbsp;to&nbsp;%d;&nbsp;want&nbsp;no&nbsp;change&#34;</span><span class="op" id="6936674">,</span>&nbsp;<span class="ident" id="6936676">n1</span><span class="op" id="6936678">,</span>&nbsp;<span class="ident" id="6936680">n2</span><span class="op" id="6936682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936685">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936689">if</span>&nbsp;<span class="ident" id="6936692">err</span>&nbsp;<span class="op" id="6936696">:=</span>&nbsp;<span class="ident" id="6936699">w</span><span class="op" id="6936700">.</span><span class="ident" id="6936701">Flush</span><span class="op" id="6936706">(</span><span class="op" id="6936707">)</span><span class="op" id="6936708">;</span>&nbsp;<span class="ident" id="6936710">err</span>&nbsp;<span class="op" id="6936714">!=</span>&nbsp;<span class="ident" id="6936717">nil</span>&nbsp;<span class="op" id="6936721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936725">t</span><span class="op" id="6936726">.</span><span class="ident" id="6936727">Fatal</span><span class="op" id="6936732">(</span><span class="ident" id="6936733">err</span><span class="op" id="6936736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936743">n3</span>&nbsp;<span class="op" id="6936746">:=</span>&nbsp;<span class="ident" id="6936749">buf</span><span class="op" id="6936752">.</span><span class="ident" id="6936753">Len</span><span class="op" id="6936756">(</span><span class="op" id="6936757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936760">if</span>&nbsp;<span class="ident" id="6936763">n2</span>&nbsp;<span class="op" id="6936766">==</span>&nbsp;<span class="ident" id="6936769">n3</span>&nbsp;<span class="op" id="6936772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936776">t</span><span class="op" id="6936777">.</span><span class="ident" id="6936778">Fatal</span><span class="op" id="6936783">(</span><span class="string" id="6936784">&#34;Flush&nbsp;didn&#39;t&nbsp;flush&nbsp;any&nbsp;data&#34;</span><span class="op" id="6936813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936816">}</span><br>
<span class="lineno"></span><span class="op" id="6936818">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6936821">//&nbsp;Multiple&nbsp;gzip&nbsp;files&nbsp;concatenated&nbsp;form&nbsp;a&nbsp;valid&nbsp;gzip&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6936881">func</span>&nbsp;<span class="ident" id="6936886">TestConcat</span><span class="op" id="6936896">(</span><span class="ident" id="6936897">t</span>&nbsp;<span class="op" id="6936899">*</span><span class="ident" id="6936900">testing</span><span class="op" id="6936907">.</span><span class="ident" id="6936908">T</span><span class="op" id="6936909">)</span>&nbsp;<span class="op" id="6936911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936914">var</span>&nbsp;<span class="ident" id="6936918">buf</span>&nbsp;<span class="ident" id="6936922">bytes</span><span class="op" id="6936927">.</span><span class="ident" id="6936928">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936936">w</span>&nbsp;<span class="op" id="6936938">:=</span>&nbsp;<span class="ident" id="6936941">NewWriter</span><span class="op" id="6936950">(</span><span class="op" id="6936951">&amp;</span><span class="ident" id="6936952">buf</span><span class="op" id="6936955">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936958">w</span><span class="op" id="6936959">.</span><span class="ident" id="6936960">Write</span><span class="op" id="6936965">(</span><span class="op" id="6936966">[</span><span class="op" id="6936967">]</span><span class="builtintype" id="6936968">byte</span><span class="op" id="6936972">(</span><span class="string" id="6936973">&#34;hello&nbsp;&#34;</span><span class="op" id="6936981">)</span><span class="op" id="6936982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936985">w</span><span class="op" id="6936986">.</span><span class="ident" id="6936987">Close</span><span class="op" id="6936992">(</span><span class="op" id="6936993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936996">w</span>&nbsp;<span class="op" id="6936998">=</span>&nbsp;<span class="ident" id="6937000">NewWriter</span><span class="op" id="6937009">(</span><span class="op" id="6937010">&amp;</span><span class="ident" id="6937011">buf</span><span class="op" id="6937014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937017">w</span><span class="op" id="6937018">.</span><span class="ident" id="6937019">Write</span><span class="op" id="6937024">(</span><span class="op" id="6937025">[</span><span class="op" id="6937026">]</span><span class="builtintype" id="6937027">byte</span><span class="op" id="6937031">(</span><span class="string" id="6937032">&#34;world\n&#34;</span><span class="op" id="6937041">)</span><span class="op" id="6937042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937045">w</span><span class="op" id="6937046">.</span><span class="ident" id="6937047">Close</span><span class="op" id="6937052">(</span><span class="op" id="6937053">)</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937057">r</span><span class="op" id="6937058">,</span>&nbsp;<span class="ident" id="6937060">err</span>&nbsp;<span class="op" id="6937064">:=</span>&nbsp;<span class="ident" id="6937067">NewReader</span><span class="op" id="6937076">(</span><span class="op" id="6937077">&amp;</span><span class="ident" id="6937078">buf</span><span class="op" id="6937081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937084">data</span><span class="op" id="6937088">,</span>&nbsp;<span class="ident" id="6937090">err</span>&nbsp;<span class="op" id="6937094">:=</span>&nbsp;<span class="ident" id="6937097">ioutil</span><span class="op" id="6937103">.</span><span class="ident" id="6937104">ReadAll</span><span class="op" id="6937111">(</span><span class="ident" id="6937112">r</span><span class="op" id="6937113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937116">if</span>&nbsp;<span class="builtintype" id="6937119">string</span><span class="op" id="6937125">(</span><span class="ident" id="6937126">data</span><span class="op" id="6937130">)</span>&nbsp;<span class="op" id="6937132">!=</span>&nbsp;<span class="string" id="6937135">&#34;hello&nbsp;world\n&#34;</span>&nbsp;<span class="op" id="6937151">||</span>&nbsp;<span class="ident" id="6937154">err</span>&nbsp;<span class="op" id="6937158">!=</span>&nbsp;<span class="ident" id="6937161">nil</span>&nbsp;<span class="op" id="6937165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937169">t</span><span class="op" id="6937170">.</span><span class="ident" id="6937171">Fatalf</span><span class="op" id="6937177">(</span><span class="string" id="6937178">&#34;ReadAll&nbsp;=&nbsp;%q,&nbsp;%v,&nbsp;want&nbsp;%q,&nbsp;nil&#34;</span><span class="op" id="6937210">,</span>&nbsp;<span class="ident" id="6937212">data</span><span class="op" id="6937216">,</span>&nbsp;<span class="ident" id="6937218">err</span><span class="op" id="6937221">,</span>&nbsp;<span class="string" id="6937223">&#34;hello&nbsp;world&#34;</span><span class="op" id="6937236">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6937239">}</span><br>
<span class="lineno"></span><span class="op" id="6937241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937244">func</span>&nbsp;<span class="ident" id="6937249">TestWriterReset</span><span class="op" id="6937264">(</span><span class="ident" id="6937265">t</span>&nbsp;<span class="op" id="6937267">*</span><span class="ident" id="6937268">testing</span><span class="op" id="6937275">.</span><span class="ident" id="6937276">T</span><span class="op" id="6937277">)</span>&nbsp;<span class="op" id="6937279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937282">buf</span>&nbsp;<span class="op" id="6937286">:=</span>&nbsp;<span class="builtinfunc" id="6937289">new</span><span class="op" id="6937292">(</span><span class="ident" id="6937293">bytes</span><span class="op" id="6937298">.</span><span class="ident" id="6937299">Buffer</span><span class="op" id="6937305">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937308">buf2</span>&nbsp;<span class="op" id="6937313">:=</span>&nbsp;<span class="builtinfunc" id="6937316">new</span><span class="op" id="6937319">(</span><span class="ident" id="6937320">bytes</span><span class="op" id="6937325">.</span><span class="ident" id="6937326">Buffer</span><span class="op" id="6937332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937335">z</span>&nbsp;<span class="op" id="6937337">:=</span>&nbsp;<span class="ident" id="6937340">NewWriter</span><span class="op" id="6937349">(</span><span class="ident" id="6937350">buf</span><span class="op" id="6937353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937356">msg</span>&nbsp;<span class="op" id="6937360">:=</span>&nbsp;<span class="op" id="6937363">[</span><span class="op" id="6937364">]</span><span class="builtintype" id="6937365">byte</span><span class="op" id="6937369">(</span><span class="string" id="6937370">&#34;hello&nbsp;world&#34;</span><span class="op" id="6937383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937386">z</span><span class="op" id="6937387">.</span><span class="ident" id="6937388">Write</span><span class="op" id="6937393">(</span><span class="ident" id="6937394">msg</span><span class="op" id="6937397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937400">z</span><span class="op" id="6937401">.</span><span class="ident" id="6937402">Close</span><span class="op" id="6937407">(</span><span class="op" id="6937408">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937411">z</span><span class="op" id="6937412">.</span><span class="ident" id="6937413">Reset</span><span class="op" id="6937418">(</span><span class="ident" id="6937419">buf2</span><span class="op" id="6937423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937426">z</span><span class="op" id="6937427">.</span><span class="ident" id="6937428">Write</span><span class="op" id="6937433">(</span><span class="ident" id="6937434">msg</span><span class="op" id="6937437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937440">z</span><span class="op" id="6937441">.</span><span class="ident" id="6937442">Close</span><span class="op" id="6937447">(</span><span class="op" id="6937448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937451">if</span>&nbsp;<span class="ident" id="6937454">buf</span><span class="op" id="6937457">.</span><span class="ident" id="6937458">String</span><span class="op" id="6937464">(</span><span class="op" id="6937465">)</span>&nbsp;<span class="op" id="6937467">!=</span>&nbsp;<span class="ident" id="6937470">buf2</span><span class="op" id="6937474">.</span><span class="ident" id="6937475">String</span><span class="op" id="6937481">(</span><span class="op" id="6937482">)</span>&nbsp;<span class="op" id="6937484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937488">t</span><span class="op" id="6937489">.</span><span class="ident" id="6937490">Errorf</span><span class="op" id="6937496">(</span><span class="string" id="6937497">&#34;buf2&nbsp;%q&nbsp;!=&nbsp;original&nbsp;buf&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6937528">,</span>&nbsp;<span class="ident" id="6937530">buf2</span><span class="op" id="6937534">.</span><span class="ident" id="6937535">String</span><span class="op" id="6937541">(</span><span class="op" id="6937542">)</span><span class="op" id="6937543">,</span>&nbsp;<span class="ident" id="6937545">buf</span><span class="op" id="6937548">.</span><span class="ident" id="6937549">String</span><span class="op" id="6937555">(</span><span class="op" id="6937556">)</span><span class="op" id="6937557">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6937560">}</span><br>
<span class="lineno"></span><span class="op" id="6937562">}</span>
</div>
</body>
</html>
