<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7719298">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7719353">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7719407">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7719458">package</span>&nbsp;<span class="ident" id="7719466">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7719471">import</span>&nbsp;<span class="op" id="7719478">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719481">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719490">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719497">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719503">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719516">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719522">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719533">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719544">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719555">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7719573">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7719580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7719583">type</span>&nbsp;<span class="ident" id="7719588">writerTestEntry</span>&nbsp;<span class="keyword" id="7719604">struct</span>&nbsp;<span class="op" id="7719611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7719614">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7719623">*</span><span class="ident" id="7719624">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7719632">contents</span>&nbsp;<span class="builtintype" id="7719641">string</span><br>
<span class="lineno"></span><span class="op" id="7719648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7719651">type</span>&nbsp;<span class="ident" id="7719656">writerTest</span>&nbsp;<span class="keyword" id="7719667">struct</span>&nbsp;<span class="op" id="7719674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7719677">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7719685">string</span>&nbsp;<span class="comment" id="7719692">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7719724">entries</span>&nbsp;<span class="op" id="7719732">[</span><span class="op" id="7719733">]</span><span class="op" id="7719734">*</span><span class="ident" id="7719735">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="7719751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7719754">var</span>&nbsp;<span class="ident" id="7719758">writerTests</span>&nbsp;<span class="op" id="7719770">=</span>&nbsp;<span class="op" id="7719772">[</span><span class="op" id="7719773">]</span><span class="op" id="7719774">*</span><span class="ident" id="7719775">writerTest</span><span class="op" id="7719785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7719788">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7719845">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7719868">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7719899">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7719976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7719980">file</span><span class="op" id="7719984">:</span>&nbsp;<span class="string" id="7719986">&#34;testdata/writer.tar&#34;</span><span class="op" id="7720007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720011">entries</span><span class="op" id="7720018">:</span>&nbsp;<span class="op" id="7720020">[</span><span class="op" id="7720021">]</span><span class="op" id="7720022">*</span><span class="ident" id="7720023">writerTestEntry</span><span class="op" id="7720038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720049">header</span><span class="op" id="7720055">:</span>&nbsp;<span class="op" id="7720057">&amp;</span><span class="ident" id="7720058">Header</span><span class="op" id="7720064">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720071">Name</span><span class="op" id="7720075">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720081">&#34;small.txt&#34;</span><span class="op" id="7720092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720099">Mode</span><span class="op" id="7720103">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720109">0640</span><span class="op" id="7720113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720120">Uid</span><span class="op" id="7720123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720130">73025</span><span class="op" id="7720135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720142">Gid</span><span class="op" id="7720145">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720152">5000</span><span class="op" id="7720156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720163">Size</span><span class="op" id="7720167">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720173">5</span><span class="op" id="7720174">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720181">ModTime</span><span class="op" id="7720188">:</span>&nbsp;&nbsp;<span class="ident" id="7720191">time</span><span class="op" id="7720195">.</span><span class="ident" id="7720196">Unix</span><span class="op" id="7720200">(</span><span class="num" id="7720201">1246508266</span><span class="op" id="7720211">,</span>&nbsp;<span class="num" id="7720213">0</span><span class="op" id="7720214">)</span><span class="op" id="7720215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720222">Typeflag</span><span class="op" id="7720230">:</span>&nbsp;<span class="string" id="7720232">&#39;0&#39;</span><span class="op" id="7720235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720242">Uname</span><span class="op" id="7720247">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720252">&#34;dsymonds&#34;</span><span class="op" id="7720262">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720269">Gname</span><span class="op" id="7720274">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720279">&#34;eng&#34;</span><span class="op" id="7720284">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720290">}</span><span class="op" id="7720291">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720297">contents</span><span class="op" id="7720305">:</span>&nbsp;<span class="string" id="7720307">&#34;Kilts&#34;</span><span class="op" id="7720314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720319">}</span><span class="op" id="7720320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720331">header</span><span class="op" id="7720337">:</span>&nbsp;<span class="op" id="7720339">&amp;</span><span class="ident" id="7720340">Header</span><span class="op" id="7720346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720353">Name</span><span class="op" id="7720357">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720363">&#34;small2.txt&#34;</span><span class="op" id="7720375">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720382">Mode</span><span class="op" id="7720386">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720392">0640</span><span class="op" id="7720396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720403">Uid</span><span class="op" id="7720406">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720413">73025</span><span class="op" id="7720418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720425">Gid</span><span class="op" id="7720428">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720435">5000</span><span class="op" id="7720439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720446">Size</span><span class="op" id="7720450">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720456">11</span><span class="op" id="7720458">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720465">ModTime</span><span class="op" id="7720472">:</span>&nbsp;&nbsp;<span class="ident" id="7720475">time</span><span class="op" id="7720479">.</span><span class="ident" id="7720480">Unix</span><span class="op" id="7720484">(</span><span class="num" id="7720485">1245217492</span><span class="op" id="7720495">,</span>&nbsp;<span class="num" id="7720497">0</span><span class="op" id="7720498">)</span><span class="op" id="7720499">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720506">Typeflag</span><span class="op" id="7720514">:</span>&nbsp;<span class="string" id="7720516">&#39;0&#39;</span><span class="op" id="7720519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720526">Uname</span><span class="op" id="7720531">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720536">&#34;dsymonds&#34;</span><span class="op" id="7720546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720553">Gname</span><span class="op" id="7720558">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720563">&#34;eng&#34;</span><span class="op" id="7720568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720574">}</span><span class="op" id="7720575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720581">contents</span><span class="op" id="7720589">:</span>&nbsp;<span class="string" id="7720591">&#34;Google.com\n&#34;</span><span class="op" id="7720605">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720610">}</span><span class="op" id="7720611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720622">header</span><span class="op" id="7720628">:</span>&nbsp;<span class="op" id="7720630">&amp;</span><span class="ident" id="7720631">Header</span><span class="op" id="7720637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720644">Name</span><span class="op" id="7720648">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720654">&#34;link.txt&#34;</span><span class="op" id="7720664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720671">Mode</span><span class="op" id="7720675">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720681">0777</span><span class="op" id="7720685">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720692">Uid</span><span class="op" id="7720695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720702">1000</span><span class="op" id="7720706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720713">Gid</span><span class="op" id="7720716">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720723">1000</span><span class="op" id="7720727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720734">Size</span><span class="op" id="7720738">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7720744">0</span><span class="op" id="7720745">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720752">ModTime</span><span class="op" id="7720759">:</span>&nbsp;&nbsp;<span class="ident" id="7720762">time</span><span class="op" id="7720766">.</span><span class="ident" id="7720767">Unix</span><span class="op" id="7720771">(</span><span class="num" id="7720772">1314603082</span><span class="op" id="7720782">,</span>&nbsp;<span class="num" id="7720784">0</span><span class="op" id="7720785">)</span><span class="op" id="7720786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720793">Typeflag</span><span class="op" id="7720801">:</span>&nbsp;<span class="string" id="7720803">&#39;2&#39;</span><span class="op" id="7720806">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720813">Linkname</span><span class="op" id="7720821">:</span>&nbsp;<span class="string" id="7720823">&#34;small.txt&#34;</span><span class="op" id="7720834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720841">Uname</span><span class="op" id="7720846">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720851">&#34;strings&#34;</span><span class="op" id="7720860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7720867">Gname</span><span class="op" id="7720872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7720877">&#34;strings&#34;</span><span class="op" id="7720886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720892">}</span><span class="op" id="7720893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7720899">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720917">}</span><span class="op" id="7720918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720922">}</span><span class="op" id="7720923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7720926">}</span><span class="op" id="7720927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7720930">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7720993">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7721055">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721133">file</span><span class="op" id="7721137">:</span>&nbsp;<span class="string" id="7721139">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7721164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721168">entries</span><span class="op" id="7721175">:</span>&nbsp;<span class="op" id="7721177">[</span><span class="op" id="7721178">]</span><span class="op" id="7721179">*</span><span class="ident" id="7721180">writerTestEntry</span><span class="op" id="7721195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721200">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721206">header</span><span class="op" id="7721212">:</span>&nbsp;<span class="op" id="7721214">&amp;</span><span class="ident" id="7721215">Header</span><span class="op" id="7721221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721228">Name</span><span class="op" id="7721232">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7721238">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7721253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721260">Mode</span><span class="op" id="7721264">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721270">0640</span><span class="op" id="7721274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721281">Uid</span><span class="op" id="7721284">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721291">73025</span><span class="op" id="7721296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721303">Gid</span><span class="op" id="7721306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721313">5000</span><span class="op" id="7721317">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721324">Size</span><span class="op" id="7721328">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721334">16</span>&nbsp;<span class="op" id="7721337">&lt;&lt;</span>&nbsp;<span class="num" id="7721340">30</span><span class="op" id="7721342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721349">ModTime</span><span class="op" id="7721356">:</span>&nbsp;&nbsp;<span class="ident" id="7721359">time</span><span class="op" id="7721363">.</span><span class="ident" id="7721364">Unix</span><span class="op" id="7721368">(</span><span class="num" id="7721369">1254699560</span><span class="op" id="7721379">,</span>&nbsp;<span class="num" id="7721381">0</span><span class="op" id="7721382">)</span><span class="op" id="7721383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721390">Typeflag</span><span class="op" id="7721398">:</span>&nbsp;<span class="string" id="7721400">&#39;0&#39;</span><span class="op" id="7721403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721410">Uname</span><span class="op" id="7721415">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7721420">&#34;dsymonds&#34;</span><span class="op" id="7721430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721437">Gname</span><span class="op" id="7721442">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7721447">&#34;eng&#34;</span><span class="op" id="7721452">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721458">}</span><span class="op" id="7721459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7721465">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721486">contents</span><span class="op" id="7721494">:</span>&nbsp;<span class="ident" id="7721496">strings</span><span class="op" id="7721503">.</span><span class="ident" id="7721504">Repeat</span><span class="op" id="7721510">(</span><span class="string" id="7721511">&#34;\x00&#34;</span><span class="op" id="7721517">,</span>&nbsp;<span class="num" id="7721519">4</span><span class="op" id="7721520">&lt;&lt;</span><span class="num" id="7721522">10</span><span class="op" id="7721524">)</span><span class="op" id="7721525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721530">}</span><span class="op" id="7721531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721535">}</span><span class="op" id="7721536">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721539">}</span><span class="op" id="7721540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7721543">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7721606">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7721679">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721769">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721773">file</span><span class="op" id="7721777">:</span>&nbsp;<span class="string" id="7721779">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7721809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721813">entries</span><span class="op" id="7721820">:</span>&nbsp;<span class="op" id="7721822">[</span><span class="op" id="7721823">]</span><span class="op" id="7721824">*</span><span class="ident" id="7721825">writerTestEntry</span><span class="op" id="7721840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7721845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721851">header</span><span class="op" id="7721857">:</span>&nbsp;<span class="op" id="7721859">&amp;</span><span class="ident" id="7721860">Header</span><span class="op" id="7721866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721873">Name</span><span class="op" id="7721877">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721883">strings</span><span class="op" id="7721890">.</span><span class="ident" id="7721891">Repeat</span><span class="op" id="7721897">(</span><span class="string" id="7721898">&#34;longname/&#34;</span><span class="op" id="7721909">,</span>&nbsp;<span class="num" id="7721911">15</span><span class="op" id="7721913">)</span>&nbsp;<span class="op" id="7721915">+</span>&nbsp;<span class="string" id="7721917">&#34;16gig.txt&#34;</span><span class="op" id="7721928">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721935">Mode</span><span class="op" id="7721939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721945">0644</span><span class="op" id="7721949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721956">Uid</span><span class="op" id="7721959">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721966">1000</span><span class="op" id="7721970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721977">Gid</span><span class="op" id="7721980">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7721987">1000</span><span class="op" id="7721991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7721998">Size</span><span class="op" id="7722002">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7722008">16</span>&nbsp;<span class="op" id="7722011">&lt;&lt;</span>&nbsp;<span class="num" id="7722014">30</span><span class="op" id="7722016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722023">ModTime</span><span class="op" id="7722030">:</span>&nbsp;&nbsp;<span class="ident" id="7722033">time</span><span class="op" id="7722037">.</span><span class="ident" id="7722038">Unix</span><span class="op" id="7722042">(</span><span class="num" id="7722043">1399583047</span><span class="op" id="7722053">,</span>&nbsp;<span class="num" id="7722055">0</span><span class="op" id="7722056">)</span><span class="op" id="7722057">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722064">Typeflag</span><span class="op" id="7722072">:</span>&nbsp;<span class="string" id="7722074">&#39;0&#39;</span><span class="op" id="7722077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722084">Uname</span><span class="op" id="7722089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7722094">&#34;guillaume&#34;</span><span class="op" id="7722105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722112">Gname</span><span class="op" id="7722117">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7722122">&#34;guillaume&#34;</span><span class="op" id="7722133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722139">}</span><span class="op" id="7722140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7722146">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722167">contents</span><span class="op" id="7722175">:</span>&nbsp;<span class="ident" id="7722177">strings</span><span class="op" id="7722184">.</span><span class="ident" id="7722185">Repeat</span><span class="op" id="7722191">(</span><span class="string" id="7722192">&#34;\x00&#34;</span><span class="op" id="7722198">,</span>&nbsp;<span class="num" id="7722200">4</span><span class="op" id="7722201">&lt;&lt;</span><span class="num" id="7722203">10</span><span class="op" id="7722205">)</span><span class="op" id="7722206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722211">}</span><span class="op" id="7722212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722216">}</span><span class="op" id="7722217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722220">}</span><span class="op" id="7722221">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7722224">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7722270">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722332">file</span><span class="op" id="7722336">:</span>&nbsp;<span class="string" id="7722338">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7722358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722362">entries</span><span class="op" id="7722369">:</span>&nbsp;<span class="op" id="7722371">[</span><span class="op" id="7722372">]</span><span class="op" id="7722373">*</span><span class="ident" id="7722374">writerTestEntry</span><span class="op" id="7722389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722394">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722400">header</span><span class="op" id="7722406">:</span>&nbsp;<span class="op" id="7722408">&amp;</span><span class="ident" id="7722409">Header</span><span class="op" id="7722415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722422">Name</span><span class="op" id="7722426">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722432">strings</span><span class="op" id="7722439">.</span><span class="ident" id="7722440">Repeat</span><span class="op" id="7722446">(</span><span class="string" id="7722447">&#34;longname/&#34;</span><span class="op" id="7722458">,</span>&nbsp;<span class="num" id="7722460">15</span><span class="op" id="7722462">)</span>&nbsp;<span class="op" id="7722464">+</span>&nbsp;<span class="string" id="7722466">&#34;file.txt&#34;</span><span class="op" id="7722476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722483">Mode</span><span class="op" id="7722487">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7722493">0644</span><span class="op" id="7722497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722504">Uid</span><span class="op" id="7722507">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7722514">0765</span><span class="op" id="7722518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722525">Gid</span><span class="op" id="7722528">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7722535">024</span><span class="op" id="7722538">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722545">Size</span><span class="op" id="7722549">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7722555">06</span><span class="op" id="7722557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722564">ModTime</span><span class="op" id="7722571">:</span>&nbsp;&nbsp;<span class="ident" id="7722574">time</span><span class="op" id="7722578">.</span><span class="ident" id="7722579">Unix</span><span class="op" id="7722583">(</span><span class="num" id="7722584">1360135598</span><span class="op" id="7722594">,</span>&nbsp;<span class="num" id="7722596">0</span><span class="op" id="7722597">)</span><span class="op" id="7722598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722605">Typeflag</span><span class="op" id="7722613">:</span>&nbsp;<span class="string" id="7722615">&#39;0&#39;</span><span class="op" id="7722618">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722625">Uname</span><span class="op" id="7722630">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7722635">&#34;shane&#34;</span><span class="op" id="7722642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722649">Gname</span><span class="op" id="7722654">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7722659">&#34;staff&#34;</span><span class="op" id="7722666">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722672">}</span><span class="op" id="7722673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722679">contents</span><span class="op" id="7722687">:</span>&nbsp;<span class="string" id="7722689">&#34;hello\n&#34;</span><span class="op" id="7722698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722703">}</span><span class="op" id="7722704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722708">}</span><span class="op" id="7722709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7722712">}</span><span class="op" id="7722713">,</span><br>
<span class="lineno">150</span><span class="op" id="7722715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7722718">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7722813">func</span>&nbsp;<span class="ident" id="7722818">bytestr</span><span class="op" id="7722825">(</span><span class="ident" id="7722826">offset</span>&nbsp;<span class="builtintype" id="7722833">int</span><span class="op" id="7722836">,</span>&nbsp;<span class="ident" id="7722838">b</span>&nbsp;<span class="op" id="7722840">[</span><span class="op" id="7722841">]</span><span class="builtintype" id="7722842">byte</span><span class="op" id="7722846">)</span>&nbsp;<span class="builtintype" id="7722848">string</span>&nbsp;<span class="op" id="7722855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7722858">const</span>&nbsp;<span class="ident" id="7722864">rowLen</span>&nbsp;<span class="op" id="7722871">=</span>&nbsp;<span class="num" id="7722873">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7722877">s</span>&nbsp;<span class="op" id="7722879">:=</span>&nbsp;<span class="ident" id="7722882">fmt</span><span class="op" id="7722885">.</span><span class="ident" id="7722886">Sprintf</span><span class="op" id="7722893">(</span><span class="string" id="7722894">&#34;%04x&nbsp;&#34;</span><span class="op" id="7722901">,</span>&nbsp;<span class="ident" id="7722903">offset</span><span class="op" id="7722909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7722912">for</span>&nbsp;<span class="ident" id="7722916">_</span><span class="op" id="7722917">,</span>&nbsp;<span class="ident" id="7722919">ch</span>&nbsp;<span class="op" id="7722922">:=</span>&nbsp;<span class="keyword" id="7722925">range</span>&nbsp;<span class="ident" id="7722931">b</span>&nbsp;<span class="op" id="7722933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7722937">switch</span>&nbsp;<span class="op" id="7722944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7722948">case</span>&nbsp;<span class="string" id="7722953">&#39;0&#39;</span>&nbsp;<span class="op" id="7722957">&lt;=</span>&nbsp;<span class="ident" id="7722960">ch</span>&nbsp;<span class="op" id="7722963">&amp;&amp;</span>&nbsp;<span class="ident" id="7722966">ch</span>&nbsp;<span class="op" id="7722969">&lt;=</span>&nbsp;<span class="string" id="7722972">&#39;9&#39;</span><span class="op" id="7722975">,</span>&nbsp;<span class="string" id="7722977">&#39;A&#39;</span>&nbsp;<span class="op" id="7722981">&lt;=</span>&nbsp;<span class="ident" id="7722984">ch</span>&nbsp;<span class="op" id="7722987">&amp;&amp;</span>&nbsp;<span class="ident" id="7722990">ch</span>&nbsp;<span class="op" id="7722993">&lt;=</span>&nbsp;<span class="string" id="7722996">&#39;Z&#39;</span><span class="op" id="7722999">,</span>&nbsp;<span class="string" id="7723001">&#39;a&#39;</span>&nbsp;<span class="op" id="7723005">&lt;=</span>&nbsp;<span class="ident" id="7723008">ch</span>&nbsp;<span class="op" id="7723011">&amp;&amp;</span>&nbsp;<span class="ident" id="7723014">ch</span>&nbsp;<span class="op" id="7723017">&lt;=</span>&nbsp;<span class="string" id="7723020">&#39;z&#39;</span><span class="op" id="7723023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723028">s</span>&nbsp;<span class="op" id="7723030">+=</span>&nbsp;<span class="ident" id="7723033">fmt</span><span class="op" id="7723036">.</span><span class="ident" id="7723037">Sprintf</span><span class="op" id="7723044">(</span><span class="string" id="7723045">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7723051">,</span>&nbsp;<span class="ident" id="7723053">ch</span><span class="op" id="7723055">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723059">default</span><span class="op" id="7723066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723071">s</span>&nbsp;<span class="op" id="7723073">+=</span>&nbsp;<span class="ident" id="7723076">fmt</span><span class="op" id="7723079">.</span><span class="ident" id="7723080">Sprintf</span><span class="op" id="7723087">(</span><span class="string" id="7723088">&#34;&nbsp;%02x&#34;</span><span class="op" id="7723095">,</span>&nbsp;<span class="ident" id="7723097">ch</span><span class="op" id="7723099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723109">return</span>&nbsp;<span class="ident" id="7723116">s</span><br>
<span class="lineno">165</span><span class="op" id="7723118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7723121">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7723174">func</span>&nbsp;<span class="ident" id="7723179">bytediff</span><span class="op" id="7723187">(</span><span class="ident" id="7723188">a</span>&nbsp;<span class="op" id="7723190">[</span><span class="op" id="7723191">]</span><span class="builtintype" id="7723192">byte</span><span class="op" id="7723196">,</span>&nbsp;<span class="ident" id="7723198">b</span>&nbsp;<span class="op" id="7723200">[</span><span class="op" id="7723201">]</span><span class="builtintype" id="7723202">byte</span><span class="op" id="7723206">)</span>&nbsp;<span class="builtintype" id="7723208">string</span>&nbsp;<span class="op" id="7723215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723218">const</span>&nbsp;<span class="ident" id="7723224">rowLen</span>&nbsp;<span class="op" id="7723231">=</span>&nbsp;<span class="num" id="7723233">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723237">s</span>&nbsp;<span class="op" id="7723239">:=</span>&nbsp;<span class="ident" id="7723242">fmt</span><span class="op" id="7723245">.</span><span class="ident" id="7723246">Sprintf</span><span class="op" id="7723253">(</span><span class="string" id="7723254">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7723281">,</span>&nbsp;<span class="builtinfunc" id="7723283">len</span><span class="op" id="7723286">(</span><span class="ident" id="7723287">a</span><span class="op" id="7723288">)</span><span class="op" id="7723289">,</span>&nbsp;<span class="builtinfunc" id="7723291">len</span><span class="op" id="7723294">(</span><span class="ident" id="7723295">b</span><span class="op" id="7723296">)</span><span class="op" id="7723297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723300">for</span>&nbsp;<span class="ident" id="7723304">offset</span>&nbsp;<span class="op" id="7723311">:=</span>&nbsp;<span class="num" id="7723314">0</span><span class="op" id="7723315">;</span>&nbsp;<span class="builtinfunc" id="7723317">len</span><span class="op" id="7723320">(</span><span class="ident" id="7723321">a</span><span class="op" id="7723322">)</span><span class="op" id="7723323">+</span><span class="builtinfunc" id="7723324">len</span><span class="op" id="7723327">(</span><span class="ident" id="7723328">b</span><span class="op" id="7723329">)</span>&nbsp;<span class="op" id="7723331">&gt;</span>&nbsp;<span class="num" id="7723333">0</span><span class="op" id="7723334">;</span>&nbsp;<span class="ident" id="7723336">offset</span>&nbsp;<span class="op" id="7723343">+=</span>&nbsp;<span class="ident" id="7723346">rowLen</span>&nbsp;<span class="op" id="7723353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723357">na</span><span class="op" id="7723359">,</span>&nbsp;<span class="ident" id="7723361">nb</span>&nbsp;<span class="op" id="7723364">:=</span>&nbsp;<span class="ident" id="7723367">rowLen</span><span class="op" id="7723373">,</span>&nbsp;<span class="ident" id="7723375">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723384">if</span>&nbsp;<span class="ident" id="7723387">na</span>&nbsp;<span class="op" id="7723390">&gt;</span>&nbsp;<span class="builtinfunc" id="7723392">len</span><span class="op" id="7723395">(</span><span class="ident" id="7723396">a</span><span class="op" id="7723397">)</span>&nbsp;<span class="op" id="7723399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723404">na</span>&nbsp;<span class="op" id="7723407">=</span>&nbsp;<span class="builtinfunc" id="7723409">len</span><span class="op" id="7723412">(</span><span class="ident" id="7723413">a</span><span class="op" id="7723414">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723422">if</span>&nbsp;<span class="ident" id="7723425">nb</span>&nbsp;<span class="op" id="7723428">&gt;</span>&nbsp;<span class="builtinfunc" id="7723430">len</span><span class="op" id="7723433">(</span><span class="ident" id="7723434">b</span><span class="op" id="7723435">)</span>&nbsp;<span class="op" id="7723437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723442">nb</span>&nbsp;<span class="op" id="7723445">=</span>&nbsp;<span class="builtinfunc" id="7723447">len</span><span class="op" id="7723450">(</span><span class="ident" id="7723451">b</span><span class="op" id="7723452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723460">sa</span>&nbsp;<span class="op" id="7723463">:=</span>&nbsp;<span class="ident" id="7723466">bytestr</span><span class="op" id="7723473">(</span><span class="ident" id="7723474">offset</span><span class="op" id="7723480">,</span>&nbsp;<span class="ident" id="7723482">a</span><span class="op" id="7723483">[</span><span class="num" id="7723484">0</span><span class="op" id="7723485">:</span><span class="ident" id="7723486">na</span><span class="op" id="7723488">]</span><span class="op" id="7723489">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723493">sb</span>&nbsp;<span class="op" id="7723496">:=</span>&nbsp;<span class="ident" id="7723499">bytestr</span><span class="op" id="7723506">(</span><span class="ident" id="7723507">offset</span><span class="op" id="7723513">,</span>&nbsp;<span class="ident" id="7723515">b</span><span class="op" id="7723516">[</span><span class="num" id="7723517">0</span><span class="op" id="7723518">:</span><span class="ident" id="7723519">nb</span><span class="op" id="7723521">]</span><span class="op" id="7723522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723526">if</span>&nbsp;<span class="ident" id="7723529">sa</span>&nbsp;<span class="op" id="7723532">!=</span>&nbsp;<span class="ident" id="7723535">sb</span>&nbsp;<span class="op" id="7723538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723543">s</span>&nbsp;<span class="op" id="7723545">+=</span>&nbsp;<span class="ident" id="7723548">fmt</span><span class="op" id="7723551">.</span><span class="ident" id="7723552">Sprintf</span><span class="op" id="7723559">(</span><span class="string" id="7723560">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7723572">,</span>&nbsp;<span class="ident" id="7723574">sa</span><span class="op" id="7723576">,</span>&nbsp;<span class="ident" id="7723578">sb</span><span class="op" id="7723580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723588">a</span>&nbsp;<span class="op" id="7723590">=</span>&nbsp;<span class="ident" id="7723592">a</span><span class="op" id="7723593">[</span><span class="ident" id="7723594">na</span><span class="op" id="7723596">:</span><span class="op" id="7723597">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723601">b</span>&nbsp;<span class="op" id="7723603">=</span>&nbsp;<span class="ident" id="7723605">b</span><span class="op" id="7723606">[</span><span class="ident" id="7723607">nb</span><span class="op" id="7723609">:</span><span class="op" id="7723610">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723616">return</span>&nbsp;<span class="ident" id="7723623">s</span><br>
<span class="lineno"></span><span class="op" id="7723625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7723628">func</span>&nbsp;<span class="ident" id="7723633">TestWriter</span><span class="op" id="7723643">(</span><span class="ident" id="7723644">t</span>&nbsp;<span class="op" id="7723646">*</span><span class="ident" id="7723647">testing</span><span class="op" id="7723654">.</span><span class="ident" id="7723655">T</span><span class="op" id="7723656">)</span>&nbsp;<span class="op" id="7723658">{</span><br>
<span class="lineno"></span><span class="ident" id="7723660">testLoop</span><span class="op" id="7723668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723671">for</span>&nbsp;<span class="ident" id="7723675">i</span><span class="op" id="7723676">,</span>&nbsp;<span class="ident" id="7723678">test</span>&nbsp;<span class="op" id="7723683">:=</span>&nbsp;<span class="keyword" id="7723686">range</span>&nbsp;<span class="ident" id="7723692">writerTests</span>&nbsp;<span class="op" id="7723704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723708">expected</span><span class="op" id="7723716">,</span>&nbsp;<span class="ident" id="7723718">err</span>&nbsp;<span class="op" id="7723722">:=</span>&nbsp;<span class="ident" id="7723725">ioutil</span><span class="op" id="7723731">.</span><span class="ident" id="7723732">ReadFile</span><span class="op" id="7723740">(</span><span class="ident" id="7723741">test</span><span class="op" id="7723745">.</span><span class="ident" id="7723746">file</span><span class="op" id="7723750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723754">if</span>&nbsp;<span class="ident" id="7723757">err</span>&nbsp;<span class="op" id="7723761">!=</span>&nbsp;<span class="builtintype" id="7723764">nil</span>&nbsp;<span class="op" id="7723768">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723773">t</span><span class="op" id="7723774">.</span><span class="ident" id="7723775">Errorf</span><span class="op" id="7723781">(</span><span class="string" id="7723782">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7723813">,</span>&nbsp;<span class="ident" id="7723815">i</span><span class="op" id="7723816">,</span>&nbsp;<span class="ident" id="7723818">err</span><span class="op" id="7723821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723826">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7723837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723842">buf</span>&nbsp;<span class="op" id="7723846">:=</span>&nbsp;<span class="builtinfunc" id="7723849">new</span><span class="op" id="7723852">(</span><span class="ident" id="7723853">bytes</span><span class="op" id="7723858">.</span><span class="ident" id="7723859">Buffer</span><span class="op" id="7723865">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723869">tw</span>&nbsp;<span class="op" id="7723872">:=</span>&nbsp;<span class="ident" id="7723875">NewWriter</span><span class="op" id="7723884">(</span><span class="ident" id="7723885">iotest</span><span class="op" id="7723891">.</span><span class="ident" id="7723892">TruncateWriter</span><span class="op" id="7723906">(</span><span class="ident" id="7723907">buf</span><span class="op" id="7723910">,</span>&nbsp;<span class="num" id="7723912">4</span><span class="op" id="7723913">&lt;&lt;</span><span class="num" id="7723915">10</span><span class="op" id="7723917">)</span><span class="op" id="7723918">)</span>&nbsp;<span class="comment" id="7723920">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7723951">big</span>&nbsp;<span class="op" id="7723955">:=</span>&nbsp;<span class="builtintype" id="7723958">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7723966">for</span>&nbsp;<span class="ident" id="7723970">j</span><span class="op" id="7723971">,</span>&nbsp;<span class="ident" id="7723973">entry</span>&nbsp;<span class="op" id="7723979">:=</span>&nbsp;<span class="keyword" id="7723982">range</span>&nbsp;<span class="ident" id="7723988">test</span><span class="op" id="7723992">.</span><span class="ident" id="7723993">entries</span>&nbsp;<span class="op" id="7724001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724006">big</span>&nbsp;<span class="op" id="7724010">=</span>&nbsp;<span class="ident" id="7724012">big</span>&nbsp;<span class="op" id="7724016">||</span>&nbsp;<span class="ident" id="7724019">entry</span><span class="op" id="7724024">.</span><span class="ident" id="7724025">header</span><span class="op" id="7724031">.</span><span class="ident" id="7724032">Size</span>&nbsp;<span class="op" id="7724037">&gt;</span>&nbsp;<span class="num" id="7724039">1</span><span class="op" id="7724040">&lt;&lt;</span><span class="num" id="7724042">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724048">if</span>&nbsp;<span class="ident" id="7724051">err</span>&nbsp;<span class="op" id="7724055">:=</span>&nbsp;<span class="ident" id="7724058">tw</span><span class="op" id="7724060">.</span><span class="ident" id="7724061">WriteHeader</span><span class="op" id="7724072">(</span><span class="ident" id="7724073">entry</span><span class="op" id="7724078">.</span><span class="ident" id="7724079">header</span><span class="op" id="7724085">)</span><span class="op" id="7724086">;</span>&nbsp;<span class="ident" id="7724088">err</span>&nbsp;<span class="op" id="7724092">!=</span>&nbsp;<span class="builtintype" id="7724095">nil</span>&nbsp;<span class="op" id="7724099">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724105">t</span><span class="op" id="7724106">.</span><span class="ident" id="7724107">Errorf</span><span class="op" id="7724113">(</span><span class="string" id="7724114">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7724160">,</span>&nbsp;<span class="ident" id="7724162">i</span><span class="op" id="7724163">,</span>&nbsp;<span class="ident" id="7724165">j</span><span class="op" id="7724166">,</span>&nbsp;<span class="ident" id="7724168">err</span><span class="op" id="7724171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724177">continue</span>&nbsp;<span class="ident" id="7724186">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724203">if</span>&nbsp;<span class="ident" id="7724206">_</span><span class="op" id="7724207">,</span>&nbsp;<span class="ident" id="7724209">err</span>&nbsp;<span class="op" id="7724213">:=</span>&nbsp;<span class="ident" id="7724216">io</span><span class="op" id="7724218">.</span><span class="ident" id="7724219">WriteString</span><span class="op" id="7724230">(</span><span class="ident" id="7724231">tw</span><span class="op" id="7724233">,</span>&nbsp;<span class="ident" id="7724235">entry</span><span class="op" id="7724240">.</span><span class="ident" id="7724241">contents</span><span class="op" id="7724249">)</span><span class="op" id="7724250">;</span>&nbsp;<span class="ident" id="7724252">err</span>&nbsp;<span class="op" id="7724256">!=</span>&nbsp;<span class="builtintype" id="7724259">nil</span>&nbsp;<span class="op" id="7724263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724269">t</span><span class="op" id="7724270">.</span><span class="ident" id="7724271">Errorf</span><span class="op" id="7724277">(</span><span class="string" id="7724278">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7724326">,</span>&nbsp;<span class="ident" id="7724328">i</span><span class="op" id="7724329">,</span>&nbsp;<span class="ident" id="7724331">j</span><span class="op" id="7724332">,</span>&nbsp;<span class="ident" id="7724334">err</span><span class="op" id="7724337">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724343">continue</span>&nbsp;<span class="ident" id="7724352">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7724372">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724432">if</span>&nbsp;<span class="ident" id="7724435">err</span>&nbsp;<span class="op" id="7724439">:=</span>&nbsp;<span class="ident" id="7724442">tw</span><span class="op" id="7724444">.</span><span class="ident" id="7724445">Close</span><span class="op" id="7724450">(</span><span class="op" id="7724451">)</span><span class="op" id="7724452">;</span>&nbsp;<span class="ident" id="7724454">err</span>&nbsp;<span class="op" id="7724458">!=</span>&nbsp;<span class="builtintype" id="7724461">nil</span>&nbsp;<span class="op" id="7724465">&amp;&amp;</span>&nbsp;<span class="op" id="7724468">!</span><span class="ident" id="7724469">big</span>&nbsp;<span class="op" id="7724473">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724478">t</span><span class="op" id="7724479">.</span><span class="ident" id="7724480">Errorf</span><span class="op" id="7724486">(</span><span class="string" id="7724487">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7724524">,</span>&nbsp;<span class="ident" id="7724526">i</span><span class="op" id="7724527">,</span>&nbsp;<span class="ident" id="7724529">err</span><span class="op" id="7724532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724537">continue</span>&nbsp;<span class="ident" id="7724546">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724562">actual</span>&nbsp;<span class="op" id="7724569">:=</span>&nbsp;<span class="ident" id="7724572">buf</span><span class="op" id="7724575">.</span><span class="ident" id="7724576">Bytes</span><span class="op" id="7724581">(</span><span class="op" id="7724582">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724586">if</span>&nbsp;<span class="op" id="7724589">!</span><span class="ident" id="7724590">bytes</span><span class="op" id="7724595">.</span><span class="ident" id="7724596">Equal</span><span class="op" id="7724601">(</span><span class="ident" id="7724602">expected</span><span class="op" id="7724610">,</span>&nbsp;<span class="ident" id="7724612">actual</span><span class="op" id="7724618">)</span>&nbsp;<span class="op" id="7724620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724625">t</span><span class="op" id="7724626">.</span><span class="ident" id="7724627">Errorf</span><span class="op" id="7724633">(</span><span class="string" id="7724634">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7724689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724695">i</span><span class="op" id="7724696">,</span>&nbsp;<span class="ident" id="7724698">bytediff</span><span class="op" id="7724706">(</span><span class="ident" id="7724707">expected</span><span class="op" id="7724715">,</span>&nbsp;<span class="ident" id="7724717">actual</span><span class="op" id="7724723">)</span><span class="op" id="7724724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724732">if</span>&nbsp;<span class="ident" id="7724735">testing</span><span class="op" id="7724742">.</span><span class="ident" id="7724743">Short</span><span class="op" id="7724748">(</span><span class="op" id="7724749">)</span>&nbsp;<span class="op" id="7724751">{</span>&nbsp;<span class="comment" id="7724753">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724789">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724800">}</span><br>
<span class="lineno"></span><span class="op" id="7724802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7724805">func</span>&nbsp;<span class="ident" id="7724810">TestPax</span><span class="op" id="7724817">(</span><span class="ident" id="7724818">t</span>&nbsp;<span class="op" id="7724820">*</span><span class="ident" id="7724821">testing</span><span class="op" id="7724828">.</span><span class="ident" id="7724829">T</span><span class="op" id="7724830">)</span>&nbsp;<span class="op" id="7724832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7724835">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724875">fileinfo</span><span class="op" id="7724883">,</span>&nbsp;<span class="ident" id="7724885">err</span>&nbsp;<span class="op" id="7724889">:=</span>&nbsp;<span class="ident" id="7724892">os</span><span class="op" id="7724894">.</span><span class="ident" id="7724895">Stat</span><span class="op" id="7724899">(</span><span class="string" id="7724900">&#34;testdata/small.txt&#34;</span><span class="op" id="7724920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7724923">if</span>&nbsp;<span class="ident" id="7724926">err</span>&nbsp;<span class="op" id="7724930">!=</span>&nbsp;<span class="builtintype" id="7724933">nil</span>&nbsp;<span class="op" id="7724937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724941">t</span><span class="op" id="7724942">.</span><span class="ident" id="7724943">Fatal</span><span class="op" id="7724948">(</span><span class="ident" id="7724949">err</span><span class="op" id="7724952">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7724955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7724958">hdr</span><span class="op" id="7724961">,</span>&nbsp;<span class="ident" id="7724963">err</span>&nbsp;<span class="op" id="7724967">:=</span>&nbsp;<span class="ident" id="7724970">FileInfoHeader</span><span class="op" id="7724984">(</span><span class="ident" id="7724985">fileinfo</span><span class="op" id="7724993">,</span>&nbsp;<span class="string" id="7724995">&#34;&#34;</span><span class="op" id="7724997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725000">if</span>&nbsp;<span class="ident" id="7725003">err</span>&nbsp;<span class="op" id="7725007">!=</span>&nbsp;<span class="builtintype" id="7725010">nil</span>&nbsp;<span class="op" id="7725014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725018">t</span><span class="op" id="7725019">.</span><span class="ident" id="7725020">Fatalf</span><span class="op" id="7725026">(</span><span class="string" id="7725027">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7725040">,</span>&nbsp;<span class="ident" id="7725042">err</span><span class="op" id="7725045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725048">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7725051">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725091">longName</span>&nbsp;<span class="op" id="7725100">:=</span>&nbsp;<span class="ident" id="7725103">strings</span><span class="op" id="7725110">.</span><span class="ident" id="7725111">Repeat</span><span class="op" id="7725117">(</span><span class="string" id="7725118">&#34;ab&#34;</span><span class="op" id="7725122">,</span>&nbsp;<span class="num" id="7725124">100</span><span class="op" id="7725127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725130">contents</span>&nbsp;<span class="op" id="7725139">:=</span>&nbsp;<span class="ident" id="7725142">strings</span><span class="op" id="7725149">.</span><span class="ident" id="7725150">Repeat</span><span class="op" id="7725156">(</span><span class="string" id="7725157">&#34;&nbsp;&#34;</span><span class="op" id="7725160">,</span>&nbsp;<span class="builtintype" id="7725162">int</span><span class="op" id="7725165">(</span><span class="ident" id="7725166">hdr</span><span class="op" id="7725169">.</span><span class="ident" id="7725170">Size</span><span class="op" id="7725174">)</span><span class="op" id="7725175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725178">hdr</span><span class="op" id="7725181">.</span><span class="ident" id="7725182">Name</span>&nbsp;<span class="op" id="7725187">=</span>&nbsp;<span class="ident" id="7725189">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725199">var</span>&nbsp;<span class="ident" id="7725203">buf</span>&nbsp;<span class="ident" id="7725207">bytes</span><span class="op" id="7725212">.</span><span class="ident" id="7725213">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725221">writer</span>&nbsp;<span class="op" id="7725228">:=</span>&nbsp;<span class="ident" id="7725231">NewWriter</span><span class="op" id="7725240">(</span><span class="op" id="7725241">&amp;</span><span class="ident" id="7725242">buf</span><span class="op" id="7725245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725248">if</span>&nbsp;<span class="ident" id="7725251">err</span>&nbsp;<span class="op" id="7725255">:=</span>&nbsp;<span class="ident" id="7725258">writer</span><span class="op" id="7725264">.</span><span class="ident" id="7725265">WriteHeader</span><span class="op" id="7725276">(</span><span class="ident" id="7725277">hdr</span><span class="op" id="7725280">)</span><span class="op" id="7725281">;</span>&nbsp;<span class="ident" id="7725283">err</span>&nbsp;<span class="op" id="7725287">!=</span>&nbsp;<span class="builtintype" id="7725290">nil</span>&nbsp;<span class="op" id="7725294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725298">t</span><span class="op" id="7725299">.</span><span class="ident" id="7725300">Fatal</span><span class="op" id="7725305">(</span><span class="ident" id="7725306">err</span><span class="op" id="7725309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725315">if</span>&nbsp;<span class="ident" id="7725318">_</span><span class="op" id="7725319">,</span>&nbsp;<span class="ident" id="7725321">err</span>&nbsp;<span class="op" id="7725325">=</span>&nbsp;<span class="ident" id="7725327">writer</span><span class="op" id="7725333">.</span><span class="ident" id="7725334">Write</span><span class="op" id="7725339">(</span><span class="op" id="7725340">[</span><span class="op" id="7725341">]</span><span class="builtintype" id="7725342">byte</span><span class="op" id="7725346">(</span><span class="ident" id="7725347">contents</span><span class="op" id="7725355">)</span><span class="op" id="7725356">)</span><span class="op" id="7725357">;</span>&nbsp;<span class="ident" id="7725359">err</span>&nbsp;<span class="op" id="7725363">!=</span>&nbsp;<span class="builtintype" id="7725366">nil</span>&nbsp;<span class="op" id="7725370">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725374">t</span><span class="op" id="7725375">.</span><span class="ident" id="7725376">Fatal</span><span class="op" id="7725381">(</span><span class="ident" id="7725382">err</span><span class="op" id="7725385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725391">if</span>&nbsp;<span class="ident" id="7725394">err</span>&nbsp;<span class="op" id="7725398">:=</span>&nbsp;<span class="ident" id="7725401">writer</span><span class="op" id="7725407">.</span><span class="ident" id="7725408">Close</span><span class="op" id="7725413">(</span><span class="op" id="7725414">)</span><span class="op" id="7725415">;</span>&nbsp;<span class="ident" id="7725417">err</span>&nbsp;<span class="op" id="7725421">!=</span>&nbsp;<span class="builtintype" id="7725424">nil</span>&nbsp;<span class="op" id="7725428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725432">t</span><span class="op" id="7725433">.</span><span class="ident" id="7725434">Fatal</span><span class="op" id="7725439">(</span><span class="ident" id="7725440">err</span><span class="op" id="7725443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725446">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7725449">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725507">if</span>&nbsp;<span class="op" id="7725510">!</span><span class="ident" id="7725511">bytes</span><span class="op" id="7725516">.</span><span class="ident" id="7725517">Contains</span><span class="op" id="7725525">(</span><span class="ident" id="7725526">buf</span><span class="op" id="7725529">.</span><span class="ident" id="7725530">Bytes</span><span class="op" id="7725535">(</span><span class="op" id="7725536">)</span><span class="op" id="7725537">,</span>&nbsp;<span class="op" id="7725539">[</span><span class="op" id="7725540">]</span><span class="builtintype" id="7725541">byte</span><span class="op" id="7725545">(</span><span class="string" id="7725546">&#34;PaxHeaders.&#34;</span><span class="op" id="7725559">)</span><span class="op" id="7725560">)</span>&nbsp;<span class="op" id="7725562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725566">t</span><span class="op" id="7725567">.</span><span class="ident" id="7725568">Fatal</span><span class="op" id="7725573">(</span><span class="string" id="7725574">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7725623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7725629">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725691">reader</span>&nbsp;<span class="op" id="7725698">:=</span>&nbsp;<span class="ident" id="7725701">NewReader</span><span class="op" id="7725710">(</span><span class="op" id="7725711">&amp;</span><span class="ident" id="7725712">buf</span><span class="op" id="7725715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725718">hdr</span><span class="op" id="7725721">,</span>&nbsp;<span class="ident" id="7725723">err</span>&nbsp;<span class="op" id="7725727">=</span>&nbsp;<span class="ident" id="7725729">reader</span><span class="op" id="7725735">.</span><span class="ident" id="7725736">Next</span><span class="op" id="7725740">(</span><span class="op" id="7725741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725744">if</span>&nbsp;<span class="ident" id="7725747">err</span>&nbsp;<span class="op" id="7725751">!=</span>&nbsp;<span class="builtintype" id="7725754">nil</span>&nbsp;<span class="op" id="7725758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725762">t</span><span class="op" id="7725763">.</span><span class="ident" id="7725764">Fatal</span><span class="op" id="7725769">(</span><span class="ident" id="7725770">err</span><span class="op" id="7725773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725776">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725779">if</span>&nbsp;<span class="ident" id="7725782">hdr</span><span class="op" id="7725785">.</span><span class="ident" id="7725786">Name</span>&nbsp;<span class="op" id="7725791">!=</span>&nbsp;<span class="ident" id="7725794">longName</span>&nbsp;<span class="op" id="7725803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725807">t</span><span class="op" id="7725808">.</span><span class="ident" id="7725809">Fatal</span><span class="op" id="7725814">(</span><span class="string" id="7725815">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7725848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7725851">}</span><br>
<span class="lineno"></span><span class="op" id="7725853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7725856">func</span>&nbsp;<span class="ident" id="7725861">TestPaxSymlink</span><span class="op" id="7725875">(</span><span class="ident" id="7725876">t</span>&nbsp;<span class="op" id="7725878">*</span><span class="ident" id="7725879">testing</span><span class="op" id="7725886">.</span><span class="ident" id="7725887">T</span><span class="op" id="7725888">)</span>&nbsp;<span class="op" id="7725890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7725893">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7725937">fileinfo</span><span class="op" id="7725945">,</span>&nbsp;<span class="ident" id="7725947">err</span>&nbsp;<span class="op" id="7725951">:=</span>&nbsp;<span class="ident" id="7725954">os</span><span class="op" id="7725956">.</span><span class="ident" id="7725957">Stat</span><span class="op" id="7725961">(</span><span class="string" id="7725962">&#34;testdata/small.txt&#34;</span><span class="op" id="7725982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7725985">if</span>&nbsp;<span class="ident" id="7725988">err</span>&nbsp;<span class="op" id="7725992">!=</span>&nbsp;<span class="builtintype" id="7725995">nil</span>&nbsp;<span class="op" id="7725999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726003">t</span><span class="op" id="7726004">.</span><span class="ident" id="7726005">Fatal</span><span class="op" id="7726010">(</span><span class="ident" id="7726011">err</span><span class="op" id="7726014">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726020">hdr</span><span class="op" id="7726023">,</span>&nbsp;<span class="ident" id="7726025">err</span>&nbsp;<span class="op" id="7726029">:=</span>&nbsp;<span class="ident" id="7726032">FileInfoHeader</span><span class="op" id="7726046">(</span><span class="ident" id="7726047">fileinfo</span><span class="op" id="7726055">,</span>&nbsp;<span class="string" id="7726057">&#34;&#34;</span><span class="op" id="7726059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726062">hdr</span><span class="op" id="7726065">.</span><span class="ident" id="7726066">Typeflag</span>&nbsp;<span class="op" id="7726075">=</span>&nbsp;<span class="ident" id="7726077">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726090">if</span>&nbsp;<span class="ident" id="7726093">err</span>&nbsp;<span class="op" id="7726097">!=</span>&nbsp;<span class="builtintype" id="7726100">nil</span>&nbsp;<span class="op" id="7726104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726108">t</span><span class="op" id="7726109">.</span><span class="ident" id="7726110">Fatalf</span><span class="op" id="7726116">(</span><span class="string" id="7726117">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7726131">,</span>&nbsp;<span class="ident" id="7726133">err</span><span class="op" id="7726136">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7726142">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726186">longLinkname</span>&nbsp;<span class="op" id="7726199">:=</span>&nbsp;<span class="ident" id="7726202">strings</span><span class="op" id="7726209">.</span><span class="ident" id="7726210">Repeat</span><span class="op" id="7726216">(</span><span class="string" id="7726217">&#34;1234567890/1234567890&#34;</span><span class="op" id="7726240">,</span>&nbsp;<span class="num" id="7726242">10</span><span class="op" id="7726244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726247">hdr</span><span class="op" id="7726250">.</span><span class="ident" id="7726251">Linkname</span>&nbsp;<span class="op" id="7726260">=</span>&nbsp;<span class="ident" id="7726262">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726277">hdr</span><span class="op" id="7726280">.</span><span class="ident" id="7726281">Size</span>&nbsp;<span class="op" id="7726286">=</span>&nbsp;<span class="num" id="7726288">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726291">var</span>&nbsp;<span class="ident" id="7726295">buf</span>&nbsp;<span class="ident" id="7726299">bytes</span><span class="op" id="7726304">.</span><span class="ident" id="7726305">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726313">writer</span>&nbsp;<span class="op" id="7726320">:=</span>&nbsp;<span class="ident" id="7726323">NewWriter</span><span class="op" id="7726332">(</span><span class="op" id="7726333">&amp;</span><span class="ident" id="7726334">buf</span><span class="op" id="7726337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726340">if</span>&nbsp;<span class="ident" id="7726343">err</span>&nbsp;<span class="op" id="7726347">:=</span>&nbsp;<span class="ident" id="7726350">writer</span><span class="op" id="7726356">.</span><span class="ident" id="7726357">WriteHeader</span><span class="op" id="7726368">(</span><span class="ident" id="7726369">hdr</span><span class="op" id="7726372">)</span><span class="op" id="7726373">;</span>&nbsp;<span class="ident" id="7726375">err</span>&nbsp;<span class="op" id="7726379">!=</span>&nbsp;<span class="builtintype" id="7726382">nil</span>&nbsp;<span class="op" id="7726386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726390">t</span><span class="op" id="7726391">.</span><span class="ident" id="7726392">Fatal</span><span class="op" id="7726397">(</span><span class="ident" id="7726398">err</span><span class="op" id="7726401">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726407">if</span>&nbsp;<span class="ident" id="7726410">err</span>&nbsp;<span class="op" id="7726414">:=</span>&nbsp;<span class="ident" id="7726417">writer</span><span class="op" id="7726423">.</span><span class="ident" id="7726424">Close</span><span class="op" id="7726429">(</span><span class="op" id="7726430">)</span><span class="op" id="7726431">;</span>&nbsp;<span class="ident" id="7726433">err</span>&nbsp;<span class="op" id="7726437">!=</span>&nbsp;<span class="builtintype" id="7726440">nil</span>&nbsp;<span class="op" id="7726444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726448">t</span><span class="op" id="7726449">.</span><span class="ident" id="7726450">Fatal</span><span class="op" id="7726455">(</span><span class="ident" id="7726456">err</span><span class="op" id="7726459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7726465">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726523">if</span>&nbsp;<span class="op" id="7726526">!</span><span class="ident" id="7726527">bytes</span><span class="op" id="7726532">.</span><span class="ident" id="7726533">Contains</span><span class="op" id="7726541">(</span><span class="ident" id="7726542">buf</span><span class="op" id="7726545">.</span><span class="ident" id="7726546">Bytes</span><span class="op" id="7726551">(</span><span class="op" id="7726552">)</span><span class="op" id="7726553">,</span>&nbsp;<span class="op" id="7726555">[</span><span class="op" id="7726556">]</span><span class="builtintype" id="7726557">byte</span><span class="op" id="7726561">(</span><span class="string" id="7726562">&#34;PaxHeaders.&#34;</span><span class="op" id="7726575">)</span><span class="op" id="7726576">)</span>&nbsp;<span class="op" id="7726578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726582">t</span><span class="op" id="7726583">.</span><span class="ident" id="7726584">Fatal</span><span class="op" id="7726589">(</span><span class="string" id="7726590">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7726639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7726645">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726707">reader</span>&nbsp;<span class="op" id="7726714">:=</span>&nbsp;<span class="ident" id="7726717">NewReader</span><span class="op" id="7726726">(</span><span class="op" id="7726727">&amp;</span><span class="ident" id="7726728">buf</span><span class="op" id="7726731">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726734">hdr</span><span class="op" id="7726737">,</span>&nbsp;<span class="ident" id="7726739">err</span>&nbsp;<span class="op" id="7726743">=</span>&nbsp;<span class="ident" id="7726745">reader</span><span class="op" id="7726751">.</span><span class="ident" id="7726752">Next</span><span class="op" id="7726756">(</span><span class="op" id="7726757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726760">if</span>&nbsp;<span class="ident" id="7726763">err</span>&nbsp;<span class="op" id="7726767">!=</span>&nbsp;<span class="builtintype" id="7726770">nil</span>&nbsp;<span class="op" id="7726774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726778">t</span><span class="op" id="7726779">.</span><span class="ident" id="7726780">Fatal</span><span class="op" id="7726785">(</span><span class="ident" id="7726786">err</span><span class="op" id="7726789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7726795">if</span>&nbsp;<span class="ident" id="7726798">hdr</span><span class="op" id="7726801">.</span><span class="ident" id="7726802">Linkname</span>&nbsp;<span class="op" id="7726811">!=</span>&nbsp;<span class="ident" id="7726814">longLinkname</span>&nbsp;<span class="op" id="7726827">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726831">t</span><span class="op" id="7726832">.</span><span class="ident" id="7726833">Fatal</span><span class="op" id="7726838">(</span><span class="string" id="7726839">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7726872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7726875">}</span><br>
<span class="lineno"></span><span class="op" id="7726877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7726880">func</span>&nbsp;<span class="ident" id="7726885">TestPaxNonAscii</span><span class="op" id="7726900">(</span><span class="ident" id="7726901">t</span>&nbsp;<span class="op" id="7726903">*</span><span class="ident" id="7726904">testing</span><span class="op" id="7726911">.</span><span class="ident" id="7726912">T</span><span class="op" id="7726913">)</span>&nbsp;<span class="op" id="7726915">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7726918">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7726990">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727045">fileinfo</span><span class="op" id="7727053">,</span>&nbsp;<span class="ident" id="7727055">err</span>&nbsp;<span class="op" id="7727059">:=</span>&nbsp;<span class="ident" id="7727062">os</span><span class="op" id="7727064">.</span><span class="ident" id="7727065">Stat</span><span class="op" id="7727069">(</span><span class="string" id="7727070">&#34;testdata/small.txt&#34;</span><span class="op" id="7727090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727093">if</span>&nbsp;<span class="ident" id="7727096">err</span>&nbsp;<span class="op" id="7727100">!=</span>&nbsp;<span class="builtintype" id="7727103">nil</span>&nbsp;<span class="op" id="7727107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727111">t</span><span class="op" id="7727112">.</span><span class="ident" id="7727113">Fatal</span><span class="op" id="7727118">(</span><span class="ident" id="7727119">err</span><span class="op" id="7727122">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7727125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727129">hdr</span><span class="op" id="7727132">,</span>&nbsp;<span class="ident" id="7727134">err</span>&nbsp;<span class="op" id="7727138">:=</span>&nbsp;<span class="ident" id="7727141">FileInfoHeader</span><span class="op" id="7727155">(</span><span class="ident" id="7727156">fileinfo</span><span class="op" id="7727164">,</span>&nbsp;<span class="string" id="7727166">&#34;&#34;</span><span class="op" id="7727168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727171">if</span>&nbsp;<span class="ident" id="7727174">err</span>&nbsp;<span class="op" id="7727178">!=</span>&nbsp;<span class="builtintype" id="7727181">nil</span>&nbsp;<span class="op" id="7727185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727189">t</span><span class="op" id="7727190">.</span><span class="ident" id="7727191">Fatalf</span><span class="op" id="7727197">(</span><span class="string" id="7727198">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7727212">,</span>&nbsp;<span class="ident" id="7727214">err</span><span class="op" id="7727217">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7727220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7727224">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727245">chineseFilename</span>&nbsp;<span class="op" id="7727261">:=</span>&nbsp;<span class="string" id="7727264">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727277">chineseGroupname</span>&nbsp;<span class="op" id="7727294">:=</span>&nbsp;<span class="string" id="7727297">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727304">chineseUsername</span>&nbsp;<span class="op" id="7727320">:=</span>&nbsp;<span class="string" id="7727323">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727337">hdr</span><span class="op" id="7727340">.</span><span class="ident" id="7727341">Name</span>&nbsp;<span class="op" id="7727346">=</span>&nbsp;<span class="ident" id="7727348">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727365">hdr</span><span class="op" id="7727368">.</span><span class="ident" id="7727369">Gname</span>&nbsp;<span class="op" id="7727375">=</span>&nbsp;<span class="ident" id="7727377">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727395">hdr</span><span class="op" id="7727398">.</span><span class="ident" id="7727399">Uname</span>&nbsp;<span class="op" id="7727405">=</span>&nbsp;<span class="ident" id="7727407">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727425">contents</span>&nbsp;<span class="op" id="7727434">:=</span>&nbsp;<span class="ident" id="7727437">strings</span><span class="op" id="7727444">.</span><span class="ident" id="7727445">Repeat</span><span class="op" id="7727451">(</span><span class="string" id="7727452">&#34;&nbsp;&#34;</span><span class="op" id="7727455">,</span>&nbsp;<span class="builtintype" id="7727457">int</span><span class="op" id="7727460">(</span><span class="ident" id="7727461">hdr</span><span class="op" id="7727464">.</span><span class="ident" id="7727465">Size</span><span class="op" id="7727469">)</span><span class="op" id="7727470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727474">var</span>&nbsp;<span class="ident" id="7727478">buf</span>&nbsp;<span class="ident" id="7727482">bytes</span><span class="op" id="7727487">.</span><span class="ident" id="7727488">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727496">writer</span>&nbsp;<span class="op" id="7727503">:=</span>&nbsp;<span class="ident" id="7727506">NewWriter</span><span class="op" id="7727515">(</span><span class="op" id="7727516">&amp;</span><span class="ident" id="7727517">buf</span><span class="op" id="7727520">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727523">if</span>&nbsp;<span class="ident" id="7727526">err</span>&nbsp;<span class="op" id="7727530">:=</span>&nbsp;<span class="ident" id="7727533">writer</span><span class="op" id="7727539">.</span><span class="ident" id="7727540">WriteHeader</span><span class="op" id="7727551">(</span><span class="ident" id="7727552">hdr</span><span class="op" id="7727555">)</span><span class="op" id="7727556">;</span>&nbsp;<span class="ident" id="7727558">err</span>&nbsp;<span class="op" id="7727562">!=</span>&nbsp;<span class="builtintype" id="7727565">nil</span>&nbsp;<span class="op" id="7727569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727573">t</span><span class="op" id="7727574">.</span><span class="ident" id="7727575">Fatal</span><span class="op" id="7727580">(</span><span class="ident" id="7727581">err</span><span class="op" id="7727584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7727587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727590">if</span>&nbsp;<span class="ident" id="7727593">_</span><span class="op" id="7727594">,</span>&nbsp;<span class="ident" id="7727596">err</span>&nbsp;<span class="op" id="7727600">=</span>&nbsp;<span class="ident" id="7727602">writer</span><span class="op" id="7727608">.</span><span class="ident" id="7727609">Write</span><span class="op" id="7727614">(</span><span class="op" id="7727615">[</span><span class="op" id="7727616">]</span><span class="builtintype" id="7727617">byte</span><span class="op" id="7727621">(</span><span class="ident" id="7727622">contents</span><span class="op" id="7727630">)</span><span class="op" id="7727631">)</span><span class="op" id="7727632">;</span>&nbsp;<span class="ident" id="7727634">err</span>&nbsp;<span class="op" id="7727638">!=</span>&nbsp;<span class="builtintype" id="7727641">nil</span>&nbsp;<span class="op" id="7727645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727649">t</span><span class="op" id="7727650">.</span><span class="ident" id="7727651">Fatal</span><span class="op" id="7727656">(</span><span class="ident" id="7727657">err</span><span class="op" id="7727660">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7727663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727666">if</span>&nbsp;<span class="ident" id="7727669">err</span>&nbsp;<span class="op" id="7727673">:=</span>&nbsp;<span class="ident" id="7727676">writer</span><span class="op" id="7727682">.</span><span class="ident" id="7727683">Close</span><span class="op" id="7727688">(</span><span class="op" id="7727689">)</span><span class="op" id="7727690">;</span>&nbsp;<span class="ident" id="7727692">err</span>&nbsp;<span class="op" id="7727696">!=</span>&nbsp;<span class="builtintype" id="7727699">nil</span>&nbsp;<span class="op" id="7727703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727707">t</span><span class="op" id="7727708">.</span><span class="ident" id="7727709">Fatal</span><span class="op" id="7727714">(</span><span class="ident" id="7727715">err</span><span class="op" id="7727718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7727721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7727724">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7727782">if</span>&nbsp;<span class="op" id="7727785">!</span><span class="ident" id="7727786">bytes</span><span class="op" id="7727791">.</span><span class="ident" id="7727792">Contains</span><span class="op" id="7727800">(</span><span class="ident" id="7727801">buf</span><span class="op" id="7727804">.</span><span class="ident" id="7727805">Bytes</span><span class="op" id="7727810">(</span><span class="op" id="7727811">)</span><span class="op" id="7727812">,</span>&nbsp;<span class="op" id="7727814">[</span><span class="op" id="7727815">]</span><span class="builtintype" id="7727816">byte</span><span class="op" id="7727820">(</span><span class="string" id="7727821">&#34;PaxHeaders.&#34;</span><span class="op" id="7727834">)</span><span class="op" id="7727835">)</span>&nbsp;<span class="op" id="7727837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727841">t</span><span class="op" id="7727842">.</span><span class="ident" id="7727843">Fatal</span><span class="op" id="7727848">(</span><span class="string" id="7727849">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7727898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7727901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7727904">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727966">reader</span>&nbsp;<span class="op" id="7727973">:=</span>&nbsp;<span class="ident" id="7727976">NewReader</span><span class="op" id="7727985">(</span><span class="op" id="7727986">&amp;</span><span class="ident" id="7727987">buf</span><span class="op" id="7727990">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727993">hdr</span><span class="op" id="7727996">,</span>&nbsp;<span class="ident" id="7727998">err</span>&nbsp;<span class="op" id="7728002">=</span>&nbsp;<span class="ident" id="7728004">reader</span><span class="op" id="7728010">.</span><span class="ident" id="7728011">Next</span><span class="op" id="7728015">(</span><span class="op" id="7728016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728019">if</span>&nbsp;<span class="ident" id="7728022">err</span>&nbsp;<span class="op" id="7728026">!=</span>&nbsp;<span class="builtintype" id="7728029">nil</span>&nbsp;<span class="op" id="7728033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728037">t</span><span class="op" id="7728038">.</span><span class="ident" id="7728039">Fatal</span><span class="op" id="7728044">(</span><span class="ident" id="7728045">err</span><span class="op" id="7728048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728054">if</span>&nbsp;<span class="ident" id="7728057">hdr</span><span class="op" id="7728060">.</span><span class="ident" id="7728061">Name</span>&nbsp;<span class="op" id="7728066">!=</span>&nbsp;<span class="ident" id="7728069">chineseFilename</span>&nbsp;<span class="op" id="7728085">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728089">t</span><span class="op" id="7728090">.</span><span class="ident" id="7728091">Fatal</span><span class="op" id="7728096">(</span><span class="string" id="7728097">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7728128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728134">if</span>&nbsp;<span class="ident" id="7728137">hdr</span><span class="op" id="7728140">.</span><span class="ident" id="7728141">Gname</span>&nbsp;<span class="op" id="7728147">!=</span>&nbsp;<span class="ident" id="7728150">chineseGroupname</span>&nbsp;<span class="op" id="7728167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728171">t</span><span class="op" id="7728172">.</span><span class="ident" id="7728173">Fatal</span><span class="op" id="7728178">(</span><span class="string" id="7728179">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7728211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728214">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728217">if</span>&nbsp;<span class="ident" id="7728220">hdr</span><span class="op" id="7728223">.</span><span class="ident" id="7728224">Uname</span>&nbsp;<span class="op" id="7728230">!=</span>&nbsp;<span class="ident" id="7728233">chineseUsername</span>&nbsp;<span class="op" id="7728249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728253">t</span><span class="op" id="7728254">.</span><span class="ident" id="7728255">Fatal</span><span class="op" id="7728260">(</span><span class="string" id="7728261">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7728292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728295">}</span><br>
<span class="lineno"></span><span class="op" id="7728297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7728300">func</span>&nbsp;<span class="ident" id="7728305">TestPaxXattrs</span><span class="op" id="7728318">(</span><span class="ident" id="7728319">t</span>&nbsp;<span class="op" id="7728321">*</span><span class="ident" id="7728322">testing</span><span class="op" id="7728329">.</span><span class="ident" id="7728330">T</span><span class="op" id="7728331">)</span>&nbsp;<span class="op" id="7728333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728336">xattrs</span>&nbsp;<span class="op" id="7728343">:=</span>&nbsp;<span class="keyword" id="7728346">map</span><span class="op" id="7728349">[</span><span class="builtintype" id="7728350">string</span><span class="op" id="7728356">]</span><span class="builtintype" id="7728357">string</span><span class="op" id="7728363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7728367">&#34;user.key&#34;</span><span class="op" id="7728377">:</span>&nbsp;<span class="string" id="7728379">&#34;value&#34;</span><span class="op" id="7728386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7728393">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728429">fileinfo</span><span class="op" id="7728437">,</span>&nbsp;<span class="ident" id="7728439">err</span>&nbsp;<span class="op" id="7728443">:=</span>&nbsp;<span class="ident" id="7728446">os</span><span class="op" id="7728448">.</span><span class="ident" id="7728449">Stat</span><span class="op" id="7728453">(</span><span class="string" id="7728454">&#34;testdata/small.txt&#34;</span><span class="op" id="7728474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728477">if</span>&nbsp;<span class="ident" id="7728480">err</span>&nbsp;<span class="op" id="7728484">!=</span>&nbsp;<span class="builtintype" id="7728487">nil</span>&nbsp;<span class="op" id="7728491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728495">t</span><span class="op" id="7728496">.</span><span class="ident" id="7728497">Fatal</span><span class="op" id="7728502">(</span><span class="ident" id="7728503">err</span><span class="op" id="7728506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728509">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728512">hdr</span><span class="op" id="7728515">,</span>&nbsp;<span class="ident" id="7728517">err</span>&nbsp;<span class="op" id="7728521">:=</span>&nbsp;<span class="ident" id="7728524">FileInfoHeader</span><span class="op" id="7728538">(</span><span class="ident" id="7728539">fileinfo</span><span class="op" id="7728547">,</span>&nbsp;<span class="string" id="7728549">&#34;&#34;</span><span class="op" id="7728551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728554">if</span>&nbsp;<span class="ident" id="7728557">err</span>&nbsp;<span class="op" id="7728561">!=</span>&nbsp;<span class="builtintype" id="7728564">nil</span>&nbsp;<span class="op" id="7728568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728572">t</span><span class="op" id="7728573">.</span><span class="ident" id="7728574">Fatalf</span><span class="op" id="7728580">(</span><span class="string" id="7728581">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7728594">,</span>&nbsp;<span class="ident" id="7728596">err</span><span class="op" id="7728599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728605">contents</span>&nbsp;<span class="op" id="7728614">:=</span>&nbsp;<span class="string" id="7728617">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728626">hdr</span><span class="op" id="7728629">.</span><span class="ident" id="7728630">Xattrs</span>&nbsp;<span class="op" id="7728637">=</span>&nbsp;<span class="ident" id="7728639">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728647">var</span>&nbsp;<span class="ident" id="7728651">buf</span>&nbsp;<span class="ident" id="7728655">bytes</span><span class="op" id="7728660">.</span><span class="ident" id="7728661">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728669">writer</span>&nbsp;<span class="op" id="7728676">:=</span>&nbsp;<span class="ident" id="7728679">NewWriter</span><span class="op" id="7728688">(</span><span class="op" id="7728689">&amp;</span><span class="ident" id="7728690">buf</span><span class="op" id="7728693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728696">if</span>&nbsp;<span class="ident" id="7728699">err</span>&nbsp;<span class="op" id="7728703">:=</span>&nbsp;<span class="ident" id="7728706">writer</span><span class="op" id="7728712">.</span><span class="ident" id="7728713">WriteHeader</span><span class="op" id="7728724">(</span><span class="ident" id="7728725">hdr</span><span class="op" id="7728728">)</span><span class="op" id="7728729">;</span>&nbsp;<span class="ident" id="7728731">err</span>&nbsp;<span class="op" id="7728735">!=</span>&nbsp;<span class="builtintype" id="7728738">nil</span>&nbsp;<span class="op" id="7728742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728746">t</span><span class="op" id="7728747">.</span><span class="ident" id="7728748">Fatal</span><span class="op" id="7728753">(</span><span class="ident" id="7728754">err</span><span class="op" id="7728757">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728763">if</span>&nbsp;<span class="ident" id="7728766">_</span><span class="op" id="7728767">,</span>&nbsp;<span class="ident" id="7728769">err</span>&nbsp;<span class="op" id="7728773">=</span>&nbsp;<span class="ident" id="7728775">writer</span><span class="op" id="7728781">.</span><span class="ident" id="7728782">Write</span><span class="op" id="7728787">(</span><span class="op" id="7728788">[</span><span class="op" id="7728789">]</span><span class="builtintype" id="7728790">byte</span><span class="op" id="7728794">(</span><span class="ident" id="7728795">contents</span><span class="op" id="7728803">)</span><span class="op" id="7728804">)</span><span class="op" id="7728805">;</span>&nbsp;<span class="ident" id="7728807">err</span>&nbsp;<span class="op" id="7728811">!=</span>&nbsp;<span class="builtintype" id="7728814">nil</span>&nbsp;<span class="op" id="7728818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728822">t</span><span class="op" id="7728823">.</span><span class="ident" id="7728824">Fatal</span><span class="op" id="7728829">(</span><span class="ident" id="7728830">err</span><span class="op" id="7728833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7728839">if</span>&nbsp;<span class="ident" id="7728842">err</span>&nbsp;<span class="op" id="7728846">:=</span>&nbsp;<span class="ident" id="7728849">writer</span><span class="op" id="7728855">.</span><span class="ident" id="7728856">Close</span><span class="op" id="7728861">(</span><span class="op" id="7728862">)</span><span class="op" id="7728863">;</span>&nbsp;<span class="ident" id="7728865">err</span>&nbsp;<span class="op" id="7728869">!=</span>&nbsp;<span class="builtintype" id="7728872">nil</span>&nbsp;<span class="op" id="7728876">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728880">t</span><span class="op" id="7728881">.</span><span class="ident" id="7728882">Fatal</span><span class="op" id="7728887">(</span><span class="ident" id="7728888">err</span><span class="op" id="7728891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7728894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7728897">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728958">reader</span>&nbsp;<span class="op" id="7728965">:=</span>&nbsp;<span class="ident" id="7728968">NewReader</span><span class="op" id="7728977">(</span><span class="op" id="7728978">&amp;</span><span class="ident" id="7728979">buf</span><span class="op" id="7728982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7728985">hdr</span><span class="op" id="7728988">,</span>&nbsp;<span class="ident" id="7728990">err</span>&nbsp;<span class="op" id="7728994">=</span>&nbsp;<span class="ident" id="7728996">reader</span><span class="op" id="7729002">.</span><span class="ident" id="7729003">Next</span><span class="op" id="7729007">(</span><span class="op" id="7729008">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7729011">if</span>&nbsp;<span class="ident" id="7729014">err</span>&nbsp;<span class="op" id="7729018">!=</span>&nbsp;<span class="builtintype" id="7729021">nil</span>&nbsp;<span class="op" id="7729025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729029">t</span><span class="op" id="7729030">.</span><span class="ident" id="7729031">Fatal</span><span class="op" id="7729036">(</span><span class="ident" id="7729037">err</span><span class="op" id="7729040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7729046">if</span>&nbsp;<span class="op" id="7729049">!</span><span class="ident" id="7729050">reflect</span><span class="op" id="7729057">.</span><span class="ident" id="7729058">DeepEqual</span><span class="op" id="7729067">(</span><span class="ident" id="7729068">hdr</span><span class="op" id="7729071">.</span><span class="ident" id="7729072">Xattrs</span><span class="op" id="7729078">,</span>&nbsp;<span class="ident" id="7729080">xattrs</span><span class="op" id="7729086">)</span>&nbsp;<span class="op" id="7729088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729092">t</span><span class="op" id="7729093">.</span><span class="ident" id="7729094">Fatalf</span><span class="op" id="7729100">(</span><span class="string" id="7729101">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7729155">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729160">hdr</span><span class="op" id="7729163">.</span><span class="ident" id="7729164">Xattrs</span><span class="op" id="7729170">,</span>&nbsp;<span class="ident" id="7729172">xattrs</span><span class="op" id="7729178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729181">}</span><br>
<span class="lineno"></span><span class="op" id="7729183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7729186">func</span>&nbsp;<span class="ident" id="7729191">TestPAXHeader</span><span class="op" id="7729204">(</span><span class="ident" id="7729205">t</span>&nbsp;<span class="op" id="7729207">*</span><span class="ident" id="7729208">testing</span><span class="op" id="7729215">.</span><span class="ident" id="7729216">T</span><span class="op" id="7729217">)</span>&nbsp;<span class="op" id="7729219">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729222">medName</span>&nbsp;<span class="op" id="7729230">:=</span>&nbsp;<span class="ident" id="7729233">strings</span><span class="op" id="7729240">.</span><span class="ident" id="7729241">Repeat</span><span class="op" id="7729247">(</span><span class="string" id="7729248">&#34;CD&#34;</span><span class="op" id="7729252">,</span>&nbsp;<span class="num" id="7729254">50</span><span class="op" id="7729256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729259">longName</span>&nbsp;<span class="op" id="7729268">:=</span>&nbsp;<span class="ident" id="7729271">strings</span><span class="op" id="7729278">.</span><span class="ident" id="7729279">Repeat</span><span class="op" id="7729285">(</span><span class="string" id="7729286">&#34;AB&#34;</span><span class="op" id="7729290">,</span>&nbsp;<span class="num" id="7729292">100</span><span class="op" id="7729295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729298">paxTests</span>&nbsp;<span class="op" id="7729307">:=</span>&nbsp;<span class="op" id="7729310">[</span><span class="op" id="7729311">]</span><span class="op" id="7729312">[</span><span class="num" id="7729313">2</span><span class="op" id="7729314">]</span><span class="builtintype" id="7729315">string</span><span class="op" id="7729321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729325">{</span><span class="ident" id="7729326">paxPath</span>&nbsp;<span class="op" id="7729334">+</span>&nbsp;<span class="string" id="7729336">&#34;=/etc/hosts&#34;</span><span class="op" id="7729349">,</span>&nbsp;<span class="string" id="7729351">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7729373">}</span><span class="op" id="7729374">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729378">{</span><span class="string" id="7729379">&#34;a=b&#34;</span><span class="op" id="7729384">,</span>&nbsp;<span class="string" id="7729386">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7729395">}</span><span class="op" id="7729396">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7729407">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729432">{</span><span class="string" id="7729433">&#34;a=names&#34;</span><span class="op" id="7729442">,</span>&nbsp;<span class="string" id="7729444">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7729458">}</span><span class="op" id="7729459">,</span>&nbsp;<span class="comment" id="7729461">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729494">{</span><span class="ident" id="7729495">paxPath</span>&nbsp;<span class="op" id="7729503">+</span>&nbsp;<span class="string" id="7729505">&#34;=&#34;</span>&nbsp;<span class="op" id="7729509">+</span>&nbsp;<span class="ident" id="7729511">longName</span><span class="op" id="7729519">,</span>&nbsp;<span class="ident" id="7729521">fmt</span><span class="op" id="7729524">.</span><span class="ident" id="7729525">Sprintf</span><span class="op" id="7729532">(</span><span class="string" id="7729533">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7729548">,</span>&nbsp;<span class="ident" id="7729550">longName</span><span class="op" id="7729558">)</span><span class="op" id="7729559">}</span><span class="op" id="7729560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729564">{</span><span class="ident" id="7729565">paxPath</span>&nbsp;<span class="op" id="7729573">+</span>&nbsp;<span class="string" id="7729575">&#34;=&#34;</span>&nbsp;<span class="op" id="7729579">+</span>&nbsp;<span class="ident" id="7729581">medName</span><span class="op" id="7729588">,</span>&nbsp;<span class="ident" id="7729590">fmt</span><span class="op" id="7729593">.</span><span class="ident" id="7729594">Sprintf</span><span class="op" id="7729601">(</span><span class="string" id="7729602">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7729617">,</span>&nbsp;<span class="ident" id="7729619">medName</span><span class="op" id="7729626">)</span><span class="op" id="7729627">}</span><span class="op" id="7729628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7729632">for</span>&nbsp;<span class="ident" id="7729636">_</span><span class="op" id="7729637">,</span>&nbsp;<span class="ident" id="7729639">test</span>&nbsp;<span class="op" id="7729644">:=</span>&nbsp;<span class="keyword" id="7729647">range</span>&nbsp;<span class="ident" id="7729653">paxTests</span>&nbsp;<span class="op" id="7729662">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729666">key</span><span class="op" id="7729669">,</span>&nbsp;<span class="ident" id="7729671">expected</span>&nbsp;<span class="op" id="7729680">:=</span>&nbsp;<span class="ident" id="7729683">test</span><span class="op" id="7729687">[</span><span class="num" id="7729688">0</span><span class="op" id="7729689">]</span><span class="op" id="7729690">,</span>&nbsp;<span class="ident" id="7729692">test</span><span class="op" id="7729696">[</span><span class="num" id="7729697">1</span><span class="op" id="7729698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7729702">if</span>&nbsp;<span class="ident" id="7729705">result</span>&nbsp;<span class="op" id="7729712">:=</span>&nbsp;<span class="ident" id="7729715">paxHeader</span><span class="op" id="7729724">(</span><span class="ident" id="7729725">key</span><span class="op" id="7729728">)</span><span class="op" id="7729729">;</span>&nbsp;<span class="ident" id="7729731">result</span>&nbsp;<span class="op" id="7729738">!=</span>&nbsp;<span class="ident" id="7729741">expected</span>&nbsp;<span class="op" id="7729750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729755">t</span><span class="op" id="7729756">.</span><span class="ident" id="7729757">Fatalf</span><span class="op" id="7729763">(</span><span class="string" id="7729764">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7729796">,</span>&nbsp;<span class="ident" id="7729798">result</span><span class="op" id="7729804">,</span>&nbsp;<span class="ident" id="7729806">expected</span><span class="op" id="7729814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7729821">}</span><br>
<span class="lineno">420</span><span class="op" id="7729823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7729826">func</span>&nbsp;<span class="ident" id="7729831">TestUSTARLongName</span><span class="op" id="7729848">(</span><span class="ident" id="7729849">t</span>&nbsp;<span class="op" id="7729851">*</span><span class="ident" id="7729852">testing</span><span class="op" id="7729859">.</span><span class="ident" id="7729860">T</span><span class="op" id="7729861">)</span>&nbsp;<span class="op" id="7729863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7729866">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7729964">fileinfo</span><span class="op" id="7729972">,</span>&nbsp;<span class="ident" id="7729974">err</span>&nbsp;<span class="op" id="7729978">:=</span>&nbsp;<span class="ident" id="7729981">os</span><span class="op" id="7729983">.</span><span class="ident" id="7729984">Stat</span><span class="op" id="7729988">(</span><span class="string" id="7729989">&#34;testdata/small.txt&#34;</span><span class="op" id="7730009">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730012">if</span>&nbsp;<span class="ident" id="7730015">err</span>&nbsp;<span class="op" id="7730019">!=</span>&nbsp;<span class="builtintype" id="7730022">nil</span>&nbsp;<span class="op" id="7730026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730030">t</span><span class="op" id="7730031">.</span><span class="ident" id="7730032">Fatal</span><span class="op" id="7730037">(</span><span class="ident" id="7730038">err</span><span class="op" id="7730041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7730044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730047">hdr</span><span class="op" id="7730050">,</span>&nbsp;<span class="ident" id="7730052">err</span>&nbsp;<span class="op" id="7730056">:=</span>&nbsp;<span class="ident" id="7730059">FileInfoHeader</span><span class="op" id="7730073">(</span><span class="ident" id="7730074">fileinfo</span><span class="op" id="7730082">,</span>&nbsp;<span class="string" id="7730084">&#34;&#34;</span><span class="op" id="7730086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730089">hdr</span><span class="op" id="7730092">.</span><span class="ident" id="7730093">Typeflag</span>&nbsp;<span class="op" id="7730102">=</span>&nbsp;<span class="ident" id="7730104">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730113">if</span>&nbsp;<span class="ident" id="7730116">err</span>&nbsp;<span class="op" id="7730120">!=</span>&nbsp;<span class="builtintype" id="7730123">nil</span>&nbsp;<span class="op" id="7730127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730131">t</span><span class="op" id="7730132">.</span><span class="ident" id="7730133">Fatalf</span><span class="op" id="7730139">(</span><span class="string" id="7730140">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7730154">,</span>&nbsp;<span class="ident" id="7730156">err</span><span class="op" id="7730159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7730162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7730165">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7730250">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730329">longName</span>&nbsp;<span class="op" id="7730338">:=</span>&nbsp;<span class="string" id="7730341">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730600">hdr</span><span class="op" id="7730603">.</span><span class="ident" id="7730604">Name</span>&nbsp;<span class="op" id="7730609">=</span>&nbsp;<span class="ident" id="7730611">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730622">hdr</span><span class="op" id="7730625">.</span><span class="ident" id="7730626">Size</span>&nbsp;<span class="op" id="7730631">=</span>&nbsp;<span class="num" id="7730633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730636">var</span>&nbsp;<span class="ident" id="7730640">buf</span>&nbsp;<span class="ident" id="7730644">bytes</span><span class="op" id="7730649">.</span><span class="ident" id="7730650">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730658">writer</span>&nbsp;<span class="op" id="7730665">:=</span>&nbsp;<span class="ident" id="7730668">NewWriter</span><span class="op" id="7730677">(</span><span class="op" id="7730678">&amp;</span><span class="ident" id="7730679">buf</span><span class="op" id="7730682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730685">if</span>&nbsp;<span class="ident" id="7730688">err</span>&nbsp;<span class="op" id="7730692">:=</span>&nbsp;<span class="ident" id="7730695">writer</span><span class="op" id="7730701">.</span><span class="ident" id="7730702">WriteHeader</span><span class="op" id="7730713">(</span><span class="ident" id="7730714">hdr</span><span class="op" id="7730717">)</span><span class="op" id="7730718">;</span>&nbsp;<span class="ident" id="7730720">err</span>&nbsp;<span class="op" id="7730724">!=</span>&nbsp;<span class="builtintype" id="7730727">nil</span>&nbsp;<span class="op" id="7730731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730735">t</span><span class="op" id="7730736">.</span><span class="ident" id="7730737">Fatal</span><span class="op" id="7730742">(</span><span class="ident" id="7730743">err</span><span class="op" id="7730746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7730749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730752">if</span>&nbsp;<span class="ident" id="7730755">err</span>&nbsp;<span class="op" id="7730759">:=</span>&nbsp;<span class="ident" id="7730762">writer</span><span class="op" id="7730768">.</span><span class="ident" id="7730769">Close</span><span class="op" id="7730774">(</span><span class="op" id="7730775">)</span><span class="op" id="7730776">;</span>&nbsp;<span class="ident" id="7730778">err</span>&nbsp;<span class="op" id="7730782">!=</span>&nbsp;<span class="builtintype" id="7730785">nil</span>&nbsp;<span class="op" id="7730789">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730793">t</span><span class="op" id="7730794">.</span><span class="ident" id="7730795">Fatal</span><span class="op" id="7730800">(</span><span class="ident" id="7730801">err</span><span class="op" id="7730804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7730807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7730810">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730872">reader</span>&nbsp;<span class="op" id="7730879">:=</span>&nbsp;<span class="ident" id="7730882">NewReader</span><span class="op" id="7730891">(</span><span class="op" id="7730892">&amp;</span><span class="ident" id="7730893">buf</span><span class="op" id="7730896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730899">hdr</span><span class="op" id="7730902">,</span>&nbsp;<span class="ident" id="7730904">err</span>&nbsp;<span class="op" id="7730908">=</span>&nbsp;<span class="ident" id="7730910">reader</span><span class="op" id="7730916">.</span><span class="ident" id="7730917">Next</span><span class="op" id="7730921">(</span><span class="op" id="7730922">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730925">if</span>&nbsp;<span class="ident" id="7730928">err</span>&nbsp;<span class="op" id="7730932">!=</span>&nbsp;<span class="builtintype" id="7730935">nil</span>&nbsp;<span class="op" id="7730939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730943">t</span><span class="op" id="7730944">.</span><span class="ident" id="7730945">Fatal</span><span class="op" id="7730950">(</span><span class="ident" id="7730951">err</span><span class="op" id="7730954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7730957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7730960">if</span>&nbsp;<span class="ident" id="7730963">hdr</span><span class="op" id="7730966">.</span><span class="ident" id="7730967">Name</span>&nbsp;<span class="op" id="7730972">!=</span>&nbsp;<span class="ident" id="7730975">longName</span>&nbsp;<span class="op" id="7730984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7730988">t</span><span class="op" id="7730989">.</span><span class="ident" id="7730990">Fatal</span><span class="op" id="7730995">(</span><span class="string" id="7730996">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7731024">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731027">}</span><br>
<span class="lineno"></span><span class="op" id="7731029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7731032">func</span>&nbsp;<span class="ident" id="7731037">TestValidTypeflagWithPAXHeader</span><span class="op" id="7731067">(</span><span class="ident" id="7731068">t</span>&nbsp;<span class="op" id="7731070">*</span><span class="ident" id="7731071">testing</span><span class="op" id="7731078">.</span><span class="ident" id="7731079">T</span><span class="op" id="7731080">)</span>&nbsp;<span class="op" id="7731082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731085">var</span>&nbsp;<span class="ident" id="7731089">buffer</span>&nbsp;<span class="ident" id="7731096">bytes</span><span class="op" id="7731101">.</span><span class="ident" id="7731102">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731110">tw</span>&nbsp;<span class="op" id="7731113">:=</span>&nbsp;<span class="ident" id="7731116">NewWriter</span><span class="op" id="7731125">(</span><span class="op" id="7731126">&amp;</span><span class="ident" id="7731127">buffer</span><span class="op" id="7731133">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731137">fileName</span>&nbsp;<span class="op" id="7731146">:=</span>&nbsp;<span class="ident" id="7731149">strings</span><span class="op" id="7731156">.</span><span class="ident" id="7731157">Repeat</span><span class="op" id="7731163">(</span><span class="string" id="7731164">&#34;ab&#34;</span><span class="op" id="7731168">,</span>&nbsp;<span class="num" id="7731170">100</span><span class="op" id="7731173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731177">hdr</span>&nbsp;<span class="op" id="7731181">:=</span>&nbsp;<span class="op" id="7731184">&amp;</span><span class="ident" id="7731185">Header</span><span class="op" id="7731191">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731195">Name</span><span class="op" id="7731199">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731205">fileName</span><span class="op" id="7731213">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731217">Size</span><span class="op" id="7731221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7731227">4</span><span class="op" id="7731228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731232">Typeflag</span><span class="op" id="7731240">:</span>&nbsp;<span class="num" id="7731242">0</span><span class="op" id="7731243">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731249">if</span>&nbsp;<span class="ident" id="7731252">err</span>&nbsp;<span class="op" id="7731256">:=</span>&nbsp;<span class="ident" id="7731259">tw</span><span class="op" id="7731261">.</span><span class="ident" id="7731262">WriteHeader</span><span class="op" id="7731273">(</span><span class="ident" id="7731274">hdr</span><span class="op" id="7731277">)</span><span class="op" id="7731278">;</span>&nbsp;<span class="ident" id="7731280">err</span>&nbsp;<span class="op" id="7731284">!=</span>&nbsp;<span class="builtintype" id="7731287">nil</span>&nbsp;<span class="op" id="7731291">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731295">t</span><span class="op" id="7731296">.</span><span class="ident" id="7731297">Fatalf</span><span class="op" id="7731303">(</span><span class="string" id="7731304">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7731332">,</span>&nbsp;<span class="ident" id="7731334">err</span><span class="op" id="7731337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731343">if</span>&nbsp;<span class="ident" id="7731346">_</span><span class="op" id="7731347">,</span>&nbsp;<span class="ident" id="7731349">err</span>&nbsp;<span class="op" id="7731353">:=</span>&nbsp;<span class="ident" id="7731356">tw</span><span class="op" id="7731358">.</span><span class="ident" id="7731359">Write</span><span class="op" id="7731364">(</span><span class="op" id="7731365">[</span><span class="op" id="7731366">]</span><span class="builtintype" id="7731367">byte</span><span class="op" id="7731371">(</span><span class="string" id="7731372">&#34;fooo&#34;</span><span class="op" id="7731378">)</span><span class="op" id="7731379">)</span><span class="op" id="7731380">;</span>&nbsp;<span class="ident" id="7731382">err</span>&nbsp;<span class="op" id="7731386">!=</span>&nbsp;<span class="builtintype" id="7731389">nil</span>&nbsp;<span class="op" id="7731393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731397">t</span><span class="op" id="7731398">.</span><span class="ident" id="7731399">Fatalf</span><span class="op" id="7731405">(</span><span class="string" id="7731406">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7731443">,</span>&nbsp;<span class="ident" id="7731445">err</span><span class="op" id="7731448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731451">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731454">tw</span><span class="op" id="7731456">.</span><span class="ident" id="7731457">Close</span><span class="op" id="7731462">(</span><span class="op" id="7731463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731467">tr</span>&nbsp;<span class="op" id="7731470">:=</span>&nbsp;<span class="ident" id="7731473">NewReader</span><span class="op" id="7731482">(</span><span class="op" id="7731483">&amp;</span><span class="ident" id="7731484">buffer</span><span class="op" id="7731490">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731494">for</span>&nbsp;<span class="op" id="7731498">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731502">header</span><span class="op" id="7731508">,</span>&nbsp;<span class="ident" id="7731510">err</span>&nbsp;<span class="op" id="7731514">:=</span>&nbsp;<span class="ident" id="7731517">tr</span><span class="op" id="7731519">.</span><span class="ident" id="7731520">Next</span><span class="op" id="7731524">(</span><span class="op" id="7731525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731529">if</span>&nbsp;<span class="ident" id="7731532">err</span>&nbsp;<span class="op" id="7731536">==</span>&nbsp;<span class="ident" id="7731539">io</span><span class="op" id="7731541">.</span><span class="ident" id="7731542">EOF</span>&nbsp;<span class="op" id="7731546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731551">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731563">if</span>&nbsp;<span class="ident" id="7731566">err</span>&nbsp;<span class="op" id="7731570">!=</span>&nbsp;<span class="builtintype" id="7731573">nil</span>&nbsp;<span class="op" id="7731577">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731582">t</span><span class="op" id="7731583">.</span><span class="ident" id="7731584">Fatalf</span><span class="op" id="7731590">(</span><span class="string" id="7731591">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7731618">,</span>&nbsp;<span class="ident" id="7731620">err</span><span class="op" id="7731623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7731631">if</span>&nbsp;<span class="ident" id="7731634">header</span><span class="op" id="7731640">.</span><span class="ident" id="7731641">Typeflag</span>&nbsp;<span class="op" id="7731650">!=</span>&nbsp;<span class="num" id="7731653">0</span>&nbsp;<span class="op" id="7731655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7731660">t</span><span class="op" id="7731661">.</span><span class="ident" id="7731662">Fatalf</span><span class="op" id="7731668">(</span><span class="string" id="7731669">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7731706">,</span>&nbsp;<span class="ident" id="7731708">header</span><span class="op" id="7731714">.</span><span class="ident" id="7731715">Typeflag</span><span class="op" id="7731723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731727">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7731730">}</span><br>
<span class="lineno"></span><span class="op" id="7731732">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
