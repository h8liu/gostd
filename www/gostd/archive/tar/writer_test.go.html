<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6594342">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6594397">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6594451">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6594502">package</span>&nbsp;<span class="ident" id="6594510">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594515">import</span>&nbsp;<span class="op" id="6594522">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594525">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594534">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594541">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594547">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594560">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594566">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594577">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594588">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594599">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594617">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6594624">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6594627">type</span>&nbsp;<span class="ident" id="6594632">writerTestEntry</span>&nbsp;<span class="keyword" id="6594648">struct</span>&nbsp;<span class="op" id="6594655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594658">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6594667">*</span><span class="ident" id="6594668">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594676">contents</span>&nbsp;<span class="builtintype" id="6594685">string</span><br>
<span class="lineno"></span><span class="op" id="6594692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6594695">type</span>&nbsp;<span class="ident" id="6594700">writerTest</span>&nbsp;<span class="keyword" id="6594711">struct</span>&nbsp;<span class="op" id="6594718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594721">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6594729">string</span>&nbsp;<span class="comment" id="6594736">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594768">entries</span>&nbsp;<span class="op" id="6594776">[</span><span class="op" id="6594777">]</span><span class="op" id="6594778">*</span><span class="ident" id="6594779">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="6594795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6594798">var</span>&nbsp;<span class="ident" id="6594802">writerTests</span>&nbsp;<span class="op" id="6594814">=</span>&nbsp;<span class="op" id="6594816">[</span><span class="op" id="6594817">]</span><span class="op" id="6594818">*</span><span class="ident" id="6594819">writerTest</span><span class="op" id="6594829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594832">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594889">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594912">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6594943">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595024">file</span><span class="op" id="6595028">:</span>&nbsp;<span class="string" id="6595030">&#34;testdata/writer.tar&#34;</span><span class="op" id="6595051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595055">entries</span><span class="op" id="6595062">:</span>&nbsp;<span class="op" id="6595064">[</span><span class="op" id="6595065">]</span><span class="op" id="6595066">*</span><span class="ident" id="6595067">writerTestEntry</span><span class="op" id="6595082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595093">header</span><span class="op" id="6595099">:</span>&nbsp;<span class="op" id="6595101">&amp;</span><span class="ident" id="6595102">Header</span><span class="op" id="6595108">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595115">Name</span><span class="op" id="6595119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595125">&#34;small.txt&#34;</span><span class="op" id="6595136">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595143">Mode</span><span class="op" id="6595147">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595153">0640</span><span class="op" id="6595157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595164">Uid</span><span class="op" id="6595167">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595174">73025</span><span class="op" id="6595179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595186">Gid</span><span class="op" id="6595189">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595196">5000</span><span class="op" id="6595200">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595207">Size</span><span class="op" id="6595211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595217">5</span><span class="op" id="6595218">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595225">ModTime</span><span class="op" id="6595232">:</span>&nbsp;&nbsp;<span class="ident" id="6595235">time</span><span class="op" id="6595239">.</span><span class="ident" id="6595240">Unix</span><span class="op" id="6595244">(</span><span class="num" id="6595245">1246508266</span><span class="op" id="6595255">,</span>&nbsp;<span class="num" id="6595257">0</span><span class="op" id="6595258">)</span><span class="op" id="6595259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595266">Typeflag</span><span class="op" id="6595274">:</span>&nbsp;<span class="string" id="6595276">&#39;0&#39;</span><span class="op" id="6595279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595286">Uname</span><span class="op" id="6595291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595296">&#34;dsymonds&#34;</span><span class="op" id="6595306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595313">Gname</span><span class="op" id="6595318">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595323">&#34;eng&#34;</span><span class="op" id="6595328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595334">}</span><span class="op" id="6595335">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595341">contents</span><span class="op" id="6595349">:</span>&nbsp;<span class="string" id="6595351">&#34;Kilts&#34;</span><span class="op" id="6595358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595363">}</span><span class="op" id="6595364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595375">header</span><span class="op" id="6595381">:</span>&nbsp;<span class="op" id="6595383">&amp;</span><span class="ident" id="6595384">Header</span><span class="op" id="6595390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595397">Name</span><span class="op" id="6595401">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595407">&#34;small2.txt&#34;</span><span class="op" id="6595419">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595426">Mode</span><span class="op" id="6595430">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595436">0640</span><span class="op" id="6595440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595447">Uid</span><span class="op" id="6595450">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595457">73025</span><span class="op" id="6595462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595469">Gid</span><span class="op" id="6595472">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595479">5000</span><span class="op" id="6595483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595490">Size</span><span class="op" id="6595494">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595500">11</span><span class="op" id="6595502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595509">ModTime</span><span class="op" id="6595516">:</span>&nbsp;&nbsp;<span class="ident" id="6595519">time</span><span class="op" id="6595523">.</span><span class="ident" id="6595524">Unix</span><span class="op" id="6595528">(</span><span class="num" id="6595529">1245217492</span><span class="op" id="6595539">,</span>&nbsp;<span class="num" id="6595541">0</span><span class="op" id="6595542">)</span><span class="op" id="6595543">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595550">Typeflag</span><span class="op" id="6595558">:</span>&nbsp;<span class="string" id="6595560">&#39;0&#39;</span><span class="op" id="6595563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595570">Uname</span><span class="op" id="6595575">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595580">&#34;dsymonds&#34;</span><span class="op" id="6595590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595597">Gname</span><span class="op" id="6595602">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595607">&#34;eng&#34;</span><span class="op" id="6595612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595618">}</span><span class="op" id="6595619">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595625">contents</span><span class="op" id="6595633">:</span>&nbsp;<span class="string" id="6595635">&#34;Google.com\n&#34;</span><span class="op" id="6595649">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595654">}</span><span class="op" id="6595655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595666">header</span><span class="op" id="6595672">:</span>&nbsp;<span class="op" id="6595674">&amp;</span><span class="ident" id="6595675">Header</span><span class="op" id="6595681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595688">Name</span><span class="op" id="6595692">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595698">&#34;link.txt&#34;</span><span class="op" id="6595708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595715">Mode</span><span class="op" id="6595719">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595725">0777</span><span class="op" id="6595729">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595736">Uid</span><span class="op" id="6595739">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595746">1000</span><span class="op" id="6595750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595757">Gid</span><span class="op" id="6595760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595767">1000</span><span class="op" id="6595771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595778">Size</span><span class="op" id="6595782">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6595788">0</span><span class="op" id="6595789">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595796">ModTime</span><span class="op" id="6595803">:</span>&nbsp;&nbsp;<span class="ident" id="6595806">time</span><span class="op" id="6595810">.</span><span class="ident" id="6595811">Unix</span><span class="op" id="6595815">(</span><span class="num" id="6595816">1314603082</span><span class="op" id="6595826">,</span>&nbsp;<span class="num" id="6595828">0</span><span class="op" id="6595829">)</span><span class="op" id="6595830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595837">Typeflag</span><span class="op" id="6595845">:</span>&nbsp;<span class="string" id="6595847">&#39;2&#39;</span><span class="op" id="6595850">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595857">Linkname</span><span class="op" id="6595865">:</span>&nbsp;<span class="string" id="6595867">&#34;small.txt&#34;</span><span class="op" id="6595878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595885">Uname</span><span class="op" id="6595890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595895">&#34;strings&#34;</span><span class="op" id="6595904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595911">Gname</span><span class="op" id="6595916">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6595921">&#34;strings&#34;</span><span class="op" id="6595930">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595936">}</span><span class="op" id="6595937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6595943">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595961">}</span><span class="op" id="6595962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595966">}</span><span class="op" id="6595967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595970">}</span><span class="op" id="6595971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6595974">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596037">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596099">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596177">file</span><span class="op" id="6596181">:</span>&nbsp;<span class="string" id="6596183">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="6596208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596212">entries</span><span class="op" id="6596219">:</span>&nbsp;<span class="op" id="6596221">[</span><span class="op" id="6596222">]</span><span class="op" id="6596223">*</span><span class="ident" id="6596224">writerTestEntry</span><span class="op" id="6596239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596244">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596250">header</span><span class="op" id="6596256">:</span>&nbsp;<span class="op" id="6596258">&amp;</span><span class="ident" id="6596259">Header</span><span class="op" id="6596265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596272">Name</span><span class="op" id="6596276">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6596282">&#34;tmp/16gig.txt&#34;</span><span class="op" id="6596297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596304">Mode</span><span class="op" id="6596308">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6596314">0640</span><span class="op" id="6596318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596325">Uid</span><span class="op" id="6596328">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6596335">73025</span><span class="op" id="6596340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596347">Gid</span><span class="op" id="6596350">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6596357">5000</span><span class="op" id="6596361">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596368">Size</span><span class="op" id="6596372">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6596378">16</span>&nbsp;<span class="op" id="6596381">&lt;&lt;</span>&nbsp;<span class="num" id="6596384">30</span><span class="op" id="6596386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596393">ModTime</span><span class="op" id="6596400">:</span>&nbsp;&nbsp;<span class="ident" id="6596403">time</span><span class="op" id="6596407">.</span><span class="ident" id="6596408">Unix</span><span class="op" id="6596412">(</span><span class="num" id="6596413">1254699560</span><span class="op" id="6596423">,</span>&nbsp;<span class="num" id="6596425">0</span><span class="op" id="6596426">)</span><span class="op" id="6596427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596434">Typeflag</span><span class="op" id="6596442">:</span>&nbsp;<span class="string" id="6596444">&#39;0&#39;</span><span class="op" id="6596447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596454">Uname</span><span class="op" id="6596459">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6596464">&#34;dsymonds&#34;</span><span class="op" id="6596474">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596481">Gname</span><span class="op" id="6596486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6596491">&#34;eng&#34;</span><span class="op" id="6596496">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596502">}</span><span class="op" id="6596503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596509">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596530">contents</span><span class="op" id="6596538">:</span>&nbsp;<span class="ident" id="6596540">strings</span><span class="op" id="6596547">.</span><span class="ident" id="6596548">Repeat</span><span class="op" id="6596554">(</span><span class="string" id="6596555">&#34;\x00&#34;</span><span class="op" id="6596561">,</span>&nbsp;<span class="num" id="6596563">4</span><span class="op" id="6596564">&lt;&lt;</span><span class="num" id="6596566">10</span><span class="op" id="6596568">)</span><span class="op" id="6596569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596574">}</span><span class="op" id="6596575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596579">}</span><span class="op" id="6596580">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596583">}</span><span class="op" id="6596584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596587">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596650">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596723">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596813">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596817">file</span><span class="op" id="6596821">:</span>&nbsp;<span class="string" id="6596823">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="6596853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596857">entries</span><span class="op" id="6596864">:</span>&nbsp;<span class="op" id="6596866">[</span><span class="op" id="6596867">]</span><span class="op" id="6596868">*</span><span class="ident" id="6596869">writerTestEntry</span><span class="op" id="6596884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596895">header</span><span class="op" id="6596901">:</span>&nbsp;<span class="op" id="6596903">&amp;</span><span class="ident" id="6596904">Header</span><span class="op" id="6596910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596917">Name</span><span class="op" id="6596921">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6596927">strings</span><span class="op" id="6596934">.</span><span class="ident" id="6596935">Repeat</span><span class="op" id="6596941">(</span><span class="string" id="6596942">&#34;longname/&#34;</span><span class="op" id="6596953">,</span>&nbsp;<span class="num" id="6596955">15</span><span class="op" id="6596957">)</span>&nbsp;<span class="op" id="6596959">+</span>&nbsp;<span class="string" id="6596961">&#34;16gig.txt&#34;</span><span class="op" id="6596972">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596979">Mode</span><span class="op" id="6596983">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6596989">0644</span><span class="op" id="6596993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597000">Uid</span><span class="op" id="6597003">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597010">1000</span><span class="op" id="6597014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597021">Gid</span><span class="op" id="6597024">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597031">1000</span><span class="op" id="6597035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597042">Size</span><span class="op" id="6597046">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597052">16</span>&nbsp;<span class="op" id="6597055">&lt;&lt;</span>&nbsp;<span class="num" id="6597058">30</span><span class="op" id="6597060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597067">ModTime</span><span class="op" id="6597074">:</span>&nbsp;&nbsp;<span class="ident" id="6597077">time</span><span class="op" id="6597081">.</span><span class="ident" id="6597082">Unix</span><span class="op" id="6597086">(</span><span class="num" id="6597087">1399583047</span><span class="op" id="6597097">,</span>&nbsp;<span class="num" id="6597099">0</span><span class="op" id="6597100">)</span><span class="op" id="6597101">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597108">Typeflag</span><span class="op" id="6597116">:</span>&nbsp;<span class="string" id="6597118">&#39;0&#39;</span><span class="op" id="6597121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597128">Uname</span><span class="op" id="6597133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6597138">&#34;guillaume&#34;</span><span class="op" id="6597149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597156">Gname</span><span class="op" id="6597161">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6597166">&#34;guillaume&#34;</span><span class="op" id="6597177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597183">}</span><span class="op" id="6597184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6597190">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597211">contents</span><span class="op" id="6597219">:</span>&nbsp;<span class="ident" id="6597221">strings</span><span class="op" id="6597228">.</span><span class="ident" id="6597229">Repeat</span><span class="op" id="6597235">(</span><span class="string" id="6597236">&#34;\x00&#34;</span><span class="op" id="6597242">,</span>&nbsp;<span class="num" id="6597244">4</span><span class="op" id="6597245">&lt;&lt;</span><span class="num" id="6597247">10</span><span class="op" id="6597249">)</span><span class="op" id="6597250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597255">}</span><span class="op" id="6597256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597260">}</span><span class="op" id="6597261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597264">}</span><span class="op" id="6597265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6597268">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6597314">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597376">file</span><span class="op" id="6597380">:</span>&nbsp;<span class="string" id="6597382">&#34;testdata/ustar.tar&#34;</span><span class="op" id="6597402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597406">entries</span><span class="op" id="6597413">:</span>&nbsp;<span class="op" id="6597415">[</span><span class="op" id="6597416">]</span><span class="op" id="6597417">*</span><span class="ident" id="6597418">writerTestEntry</span><span class="op" id="6597433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597438">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597444">header</span><span class="op" id="6597450">:</span>&nbsp;<span class="op" id="6597452">&amp;</span><span class="ident" id="6597453">Header</span><span class="op" id="6597459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597466">Name</span><span class="op" id="6597470">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6597476">strings</span><span class="op" id="6597483">.</span><span class="ident" id="6597484">Repeat</span><span class="op" id="6597490">(</span><span class="string" id="6597491">&#34;longname/&#34;</span><span class="op" id="6597502">,</span>&nbsp;<span class="num" id="6597504">15</span><span class="op" id="6597506">)</span>&nbsp;<span class="op" id="6597508">+</span>&nbsp;<span class="string" id="6597510">&#34;file.txt&#34;</span><span class="op" id="6597520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597527">Mode</span><span class="op" id="6597531">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597537">0644</span><span class="op" id="6597541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597548">Uid</span><span class="op" id="6597551">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597558">0765</span><span class="op" id="6597562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597569">Gid</span><span class="op" id="6597572">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597579">024</span><span class="op" id="6597582">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597589">Size</span><span class="op" id="6597593">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6597599">06</span><span class="op" id="6597601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597608">ModTime</span><span class="op" id="6597615">:</span>&nbsp;&nbsp;<span class="ident" id="6597618">time</span><span class="op" id="6597622">.</span><span class="ident" id="6597623">Unix</span><span class="op" id="6597627">(</span><span class="num" id="6597628">1360135598</span><span class="op" id="6597638">,</span>&nbsp;<span class="num" id="6597640">0</span><span class="op" id="6597641">)</span><span class="op" id="6597642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597649">Typeflag</span><span class="op" id="6597657">:</span>&nbsp;<span class="string" id="6597659">&#39;0&#39;</span><span class="op" id="6597662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597669">Uname</span><span class="op" id="6597674">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6597679">&#34;shane&#34;</span><span class="op" id="6597686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597693">Gname</span><span class="op" id="6597698">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6597703">&#34;staff&#34;</span><span class="op" id="6597710">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597716">}</span><span class="op" id="6597717">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597723">contents</span><span class="op" id="6597731">:</span>&nbsp;<span class="string" id="6597733">&#34;hello\n&#34;</span><span class="op" id="6597742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597747">}</span><span class="op" id="6597748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597752">}</span><span class="op" id="6597753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597756">}</span><span class="op" id="6597757">,</span><br>
<span class="lineno">150</span><span class="op" id="6597759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6597762">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="6597857">func</span>&nbsp;<span class="ident" id="6597862">bytestr</span><span class="op" id="6597869">(</span><span class="ident" id="6597870">offset</span>&nbsp;<span class="builtintype" id="6597877">int</span><span class="op" id="6597880">,</span>&nbsp;<span class="ident" id="6597882">b</span>&nbsp;<span class="op" id="6597884">[</span><span class="op" id="6597885">]</span><span class="builtintype" id="6597886">byte</span><span class="op" id="6597890">)</span>&nbsp;<span class="builtintype" id="6597892">string</span>&nbsp;<span class="op" id="6597899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597902">const</span>&nbsp;<span class="ident" id="6597908">rowLen</span>&nbsp;<span class="op" id="6597915">=</span>&nbsp;<span class="num" id="6597917">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597921">s</span>&nbsp;<span class="op" id="6597923">:=</span>&nbsp;<span class="ident" id="6597926">fmt</span><span class="op" id="6597929">.</span><span class="ident" id="6597930">Sprintf</span><span class="op" id="6597937">(</span><span class="string" id="6597938">&#34;%04x&nbsp;&#34;</span><span class="op" id="6597945">,</span>&nbsp;<span class="ident" id="6597947">offset</span><span class="op" id="6597953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597956">for</span>&nbsp;<span class="ident" id="6597960">_</span><span class="op" id="6597961">,</span>&nbsp;<span class="ident" id="6597963">ch</span>&nbsp;<span class="op" id="6597966">:=</span>&nbsp;<span class="keyword" id="6597969">range</span>&nbsp;<span class="ident" id="6597975">b</span>&nbsp;<span class="op" id="6597977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597981">switch</span>&nbsp;<span class="op" id="6597988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597992">case</span>&nbsp;<span class="string" id="6597997">&#39;0&#39;</span>&nbsp;<span class="op" id="6598001">&lt;=</span>&nbsp;<span class="ident" id="6598004">ch</span>&nbsp;<span class="op" id="6598007">&amp;&amp;</span>&nbsp;<span class="ident" id="6598010">ch</span>&nbsp;<span class="op" id="6598013">&lt;=</span>&nbsp;<span class="string" id="6598016">&#39;9&#39;</span><span class="op" id="6598019">,</span>&nbsp;<span class="string" id="6598021">&#39;A&#39;</span>&nbsp;<span class="op" id="6598025">&lt;=</span>&nbsp;<span class="ident" id="6598028">ch</span>&nbsp;<span class="op" id="6598031">&amp;&amp;</span>&nbsp;<span class="ident" id="6598034">ch</span>&nbsp;<span class="op" id="6598037">&lt;=</span>&nbsp;<span class="string" id="6598040">&#39;Z&#39;</span><span class="op" id="6598043">,</span>&nbsp;<span class="string" id="6598045">&#39;a&#39;</span>&nbsp;<span class="op" id="6598049">&lt;=</span>&nbsp;<span class="ident" id="6598052">ch</span>&nbsp;<span class="op" id="6598055">&amp;&amp;</span>&nbsp;<span class="ident" id="6598058">ch</span>&nbsp;<span class="op" id="6598061">&lt;=</span>&nbsp;<span class="string" id="6598064">&#39;z&#39;</span><span class="op" id="6598067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598072">s</span>&nbsp;<span class="op" id="6598074">+=</span>&nbsp;<span class="ident" id="6598077">fmt</span><span class="op" id="6598080">.</span><span class="ident" id="6598081">Sprintf</span><span class="op" id="6598088">(</span><span class="string" id="6598089">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="6598095">,</span>&nbsp;<span class="ident" id="6598097">ch</span><span class="op" id="6598099">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598103">default</span><span class="op" id="6598110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598115">s</span>&nbsp;<span class="op" id="6598117">+=</span>&nbsp;<span class="ident" id="6598120">fmt</span><span class="op" id="6598123">.</span><span class="ident" id="6598124">Sprintf</span><span class="op" id="6598131">(</span><span class="string" id="6598132">&#34;&nbsp;%02x&#34;</span><span class="op" id="6598139">,</span>&nbsp;<span class="ident" id="6598141">ch</span><span class="op" id="6598143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598153">return</span>&nbsp;<span class="ident" id="6598160">s</span><br>
<span class="lineno">165</span><span class="op" id="6598162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6598165">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6598218">func</span>&nbsp;<span class="ident" id="6598223">bytediff</span><span class="op" id="6598231">(</span><span class="ident" id="6598232">a</span>&nbsp;<span class="op" id="6598234">[</span><span class="op" id="6598235">]</span><span class="builtintype" id="6598236">byte</span><span class="op" id="6598240">,</span>&nbsp;<span class="ident" id="6598242">b</span>&nbsp;<span class="op" id="6598244">[</span><span class="op" id="6598245">]</span><span class="builtintype" id="6598246">byte</span><span class="op" id="6598250">)</span>&nbsp;<span class="builtintype" id="6598252">string</span>&nbsp;<span class="op" id="6598259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598262">const</span>&nbsp;<span class="ident" id="6598268">rowLen</span>&nbsp;<span class="op" id="6598275">=</span>&nbsp;<span class="num" id="6598277">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598281">s</span>&nbsp;<span class="op" id="6598283">:=</span>&nbsp;<span class="ident" id="6598286">fmt</span><span class="op" id="6598289">.</span><span class="ident" id="6598290">Sprintf</span><span class="op" id="6598297">(</span><span class="string" id="6598298">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="6598325">,</span>&nbsp;<span class="builtinfunc" id="6598327">len</span><span class="op" id="6598330">(</span><span class="ident" id="6598331">a</span><span class="op" id="6598332">)</span><span class="op" id="6598333">,</span>&nbsp;<span class="builtinfunc" id="6598335">len</span><span class="op" id="6598338">(</span><span class="ident" id="6598339">b</span><span class="op" id="6598340">)</span><span class="op" id="6598341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598344">for</span>&nbsp;<span class="ident" id="6598348">offset</span>&nbsp;<span class="op" id="6598355">:=</span>&nbsp;<span class="num" id="6598358">0</span><span class="op" id="6598359">;</span>&nbsp;<span class="builtinfunc" id="6598361">len</span><span class="op" id="6598364">(</span><span class="ident" id="6598365">a</span><span class="op" id="6598366">)</span><span class="op" id="6598367">+</span><span class="builtinfunc" id="6598368">len</span><span class="op" id="6598371">(</span><span class="ident" id="6598372">b</span><span class="op" id="6598373">)</span>&nbsp;<span class="op" id="6598375">&gt;</span>&nbsp;<span class="num" id="6598377">0</span><span class="op" id="6598378">;</span>&nbsp;<span class="ident" id="6598380">offset</span>&nbsp;<span class="op" id="6598387">+=</span>&nbsp;<span class="ident" id="6598390">rowLen</span>&nbsp;<span class="op" id="6598397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598401">na</span><span class="op" id="6598403">,</span>&nbsp;<span class="ident" id="6598405">nb</span>&nbsp;<span class="op" id="6598408">:=</span>&nbsp;<span class="ident" id="6598411">rowLen</span><span class="op" id="6598417">,</span>&nbsp;<span class="ident" id="6598419">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598428">if</span>&nbsp;<span class="ident" id="6598431">na</span>&nbsp;<span class="op" id="6598434">&gt;</span>&nbsp;<span class="builtinfunc" id="6598436">len</span><span class="op" id="6598439">(</span><span class="ident" id="6598440">a</span><span class="op" id="6598441">)</span>&nbsp;<span class="op" id="6598443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598448">na</span>&nbsp;<span class="op" id="6598451">=</span>&nbsp;<span class="builtinfunc" id="6598453">len</span><span class="op" id="6598456">(</span><span class="ident" id="6598457">a</span><span class="op" id="6598458">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598466">if</span>&nbsp;<span class="ident" id="6598469">nb</span>&nbsp;<span class="op" id="6598472">&gt;</span>&nbsp;<span class="builtinfunc" id="6598474">len</span><span class="op" id="6598477">(</span><span class="ident" id="6598478">b</span><span class="op" id="6598479">)</span>&nbsp;<span class="op" id="6598481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598486">nb</span>&nbsp;<span class="op" id="6598489">=</span>&nbsp;<span class="builtinfunc" id="6598491">len</span><span class="op" id="6598494">(</span><span class="ident" id="6598495">b</span><span class="op" id="6598496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598504">sa</span>&nbsp;<span class="op" id="6598507">:=</span>&nbsp;<span class="ident" id="6598510">bytestr</span><span class="op" id="6598517">(</span><span class="ident" id="6598518">offset</span><span class="op" id="6598524">,</span>&nbsp;<span class="ident" id="6598526">a</span><span class="op" id="6598527">[</span><span class="num" id="6598528">0</span><span class="op" id="6598529">:</span><span class="ident" id="6598530">na</span><span class="op" id="6598532">]</span><span class="op" id="6598533">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598537">sb</span>&nbsp;<span class="op" id="6598540">:=</span>&nbsp;<span class="ident" id="6598543">bytestr</span><span class="op" id="6598550">(</span><span class="ident" id="6598551">offset</span><span class="op" id="6598557">,</span>&nbsp;<span class="ident" id="6598559">b</span><span class="op" id="6598560">[</span><span class="num" id="6598561">0</span><span class="op" id="6598562">:</span><span class="ident" id="6598563">nb</span><span class="op" id="6598565">]</span><span class="op" id="6598566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598570">if</span>&nbsp;<span class="ident" id="6598573">sa</span>&nbsp;<span class="op" id="6598576">!=</span>&nbsp;<span class="ident" id="6598579">sb</span>&nbsp;<span class="op" id="6598582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598587">s</span>&nbsp;<span class="op" id="6598589">+=</span>&nbsp;<span class="ident" id="6598592">fmt</span><span class="op" id="6598595">.</span><span class="ident" id="6598596">Sprintf</span><span class="op" id="6598603">(</span><span class="string" id="6598604">&#34;-%v\n+%v\n&#34;</span><span class="op" id="6598616">,</span>&nbsp;<span class="ident" id="6598618">sa</span><span class="op" id="6598620">,</span>&nbsp;<span class="ident" id="6598622">sb</span><span class="op" id="6598624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598632">a</span>&nbsp;<span class="op" id="6598634">=</span>&nbsp;<span class="ident" id="6598636">a</span><span class="op" id="6598637">[</span><span class="ident" id="6598638">na</span><span class="op" id="6598640">:</span><span class="op" id="6598641">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598645">b</span>&nbsp;<span class="op" id="6598647">=</span>&nbsp;<span class="ident" id="6598649">b</span><span class="op" id="6598650">[</span><span class="ident" id="6598651">nb</span><span class="op" id="6598653">:</span><span class="op" id="6598654">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598660">return</span>&nbsp;<span class="ident" id="6598667">s</span><br>
<span class="lineno"></span><span class="op" id="6598669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6598672">func</span>&nbsp;<span class="ident" id="6598677">TestWriter</span><span class="op" id="6598687">(</span><span class="ident" id="6598688">t</span>&nbsp;<span class="op" id="6598690">*</span><span class="ident" id="6598691">testing</span><span class="op" id="6598698">.</span><span class="ident" id="6598699">T</span><span class="op" id="6598700">)</span>&nbsp;<span class="op" id="6598702">{</span><br>
<span class="lineno"></span><span class="ident" id="6598704">testLoop</span><span class="op" id="6598712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598715">for</span>&nbsp;<span class="ident" id="6598719">i</span><span class="op" id="6598720">,</span>&nbsp;<span class="ident" id="6598722">test</span>&nbsp;<span class="op" id="6598727">:=</span>&nbsp;<span class="keyword" id="6598730">range</span>&nbsp;<span class="ident" id="6598736">writerTests</span>&nbsp;<span class="op" id="6598748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598752">expected</span><span class="op" id="6598760">,</span>&nbsp;<span class="ident" id="6598762">err</span>&nbsp;<span class="op" id="6598766">:=</span>&nbsp;<span class="ident" id="6598769">ioutil</span><span class="op" id="6598775">.</span><span class="ident" id="6598776">ReadFile</span><span class="op" id="6598784">(</span><span class="ident" id="6598785">test</span><span class="op" id="6598789">.</span><span class="ident" id="6598790">file</span><span class="op" id="6598794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598798">if</span>&nbsp;<span class="ident" id="6598801">err</span>&nbsp;<span class="op" id="6598805">!=</span>&nbsp;<span class="ident" id="6598808">nil</span>&nbsp;<span class="op" id="6598812">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598817">t</span><span class="op" id="6598818">.</span><span class="ident" id="6598819">Errorf</span><span class="op" id="6598825">(</span><span class="string" id="6598826">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="6598857">,</span>&nbsp;<span class="ident" id="6598859">i</span><span class="op" id="6598860">,</span>&nbsp;<span class="ident" id="6598862">err</span><span class="op" id="6598865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598870">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598886">buf</span>&nbsp;<span class="op" id="6598890">:=</span>&nbsp;<span class="builtinfunc" id="6598893">new</span><span class="op" id="6598896">(</span><span class="ident" id="6598897">bytes</span><span class="op" id="6598902">.</span><span class="ident" id="6598903">Buffer</span><span class="op" id="6598909">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598913">tw</span>&nbsp;<span class="op" id="6598916">:=</span>&nbsp;<span class="ident" id="6598919">NewWriter</span><span class="op" id="6598928">(</span><span class="ident" id="6598929">iotest</span><span class="op" id="6598935">.</span><span class="ident" id="6598936">TruncateWriter</span><span class="op" id="6598950">(</span><span class="ident" id="6598951">buf</span><span class="op" id="6598954">,</span>&nbsp;<span class="num" id="6598956">4</span><span class="op" id="6598957">&lt;&lt;</span><span class="num" id="6598959">10</span><span class="op" id="6598961">)</span><span class="op" id="6598962">)</span>&nbsp;<span class="comment" id="6598964">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598995">big</span>&nbsp;<span class="op" id="6598999">:=</span>&nbsp;<span class="builtintype" id="6599002">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599010">for</span>&nbsp;<span class="ident" id="6599014">j</span><span class="op" id="6599015">,</span>&nbsp;<span class="ident" id="6599017">entry</span>&nbsp;<span class="op" id="6599023">:=</span>&nbsp;<span class="keyword" id="6599026">range</span>&nbsp;<span class="ident" id="6599032">test</span><span class="op" id="6599036">.</span><span class="ident" id="6599037">entries</span>&nbsp;<span class="op" id="6599045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599050">big</span>&nbsp;<span class="op" id="6599054">=</span>&nbsp;<span class="ident" id="6599056">big</span>&nbsp;<span class="op" id="6599060">||</span>&nbsp;<span class="ident" id="6599063">entry</span><span class="op" id="6599068">.</span><span class="ident" id="6599069">header</span><span class="op" id="6599075">.</span><span class="ident" id="6599076">Size</span>&nbsp;<span class="op" id="6599081">&gt;</span>&nbsp;<span class="num" id="6599083">1</span><span class="op" id="6599084">&lt;&lt;</span><span class="num" id="6599086">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599092">if</span>&nbsp;<span class="ident" id="6599095">err</span>&nbsp;<span class="op" id="6599099">:=</span>&nbsp;<span class="ident" id="6599102">tw</span><span class="op" id="6599104">.</span><span class="ident" id="6599105">WriteHeader</span><span class="op" id="6599116">(</span><span class="ident" id="6599117">entry</span><span class="op" id="6599122">.</span><span class="ident" id="6599123">header</span><span class="op" id="6599129">)</span><span class="op" id="6599130">;</span>&nbsp;<span class="ident" id="6599132">err</span>&nbsp;<span class="op" id="6599136">!=</span>&nbsp;<span class="ident" id="6599139">nil</span>&nbsp;<span class="op" id="6599143">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599149">t</span><span class="op" id="6599150">.</span><span class="ident" id="6599151">Errorf</span><span class="op" id="6599157">(</span><span class="string" id="6599158">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="6599204">,</span>&nbsp;<span class="ident" id="6599206">i</span><span class="op" id="6599207">,</span>&nbsp;<span class="ident" id="6599209">j</span><span class="op" id="6599210">,</span>&nbsp;<span class="ident" id="6599212">err</span><span class="op" id="6599215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599221">continue</span>&nbsp;<span class="ident" id="6599230">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599247">if</span>&nbsp;<span class="ident" id="6599250">_</span><span class="op" id="6599251">,</span>&nbsp;<span class="ident" id="6599253">err</span>&nbsp;<span class="op" id="6599257">:=</span>&nbsp;<span class="ident" id="6599260">io</span><span class="op" id="6599262">.</span><span class="ident" id="6599263">WriteString</span><span class="op" id="6599274">(</span><span class="ident" id="6599275">tw</span><span class="op" id="6599277">,</span>&nbsp;<span class="ident" id="6599279">entry</span><span class="op" id="6599284">.</span><span class="ident" id="6599285">contents</span><span class="op" id="6599293">)</span><span class="op" id="6599294">;</span>&nbsp;<span class="ident" id="6599296">err</span>&nbsp;<span class="op" id="6599300">!=</span>&nbsp;<span class="ident" id="6599303">nil</span>&nbsp;<span class="op" id="6599307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599313">t</span><span class="op" id="6599314">.</span><span class="ident" id="6599315">Errorf</span><span class="op" id="6599321">(</span><span class="string" id="6599322">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="6599370">,</span>&nbsp;<span class="ident" id="6599372">i</span><span class="op" id="6599373">,</span>&nbsp;<span class="ident" id="6599375">j</span><span class="op" id="6599376">,</span>&nbsp;<span class="ident" id="6599378">err</span><span class="op" id="6599381">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599387">continue</span>&nbsp;<span class="ident" id="6599396">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6599416">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599476">if</span>&nbsp;<span class="ident" id="6599479">err</span>&nbsp;<span class="op" id="6599483">:=</span>&nbsp;<span class="ident" id="6599486">tw</span><span class="op" id="6599488">.</span><span class="ident" id="6599489">Close</span><span class="op" id="6599494">(</span><span class="op" id="6599495">)</span><span class="op" id="6599496">;</span>&nbsp;<span class="ident" id="6599498">err</span>&nbsp;<span class="op" id="6599502">!=</span>&nbsp;<span class="ident" id="6599505">nil</span>&nbsp;<span class="op" id="6599509">&amp;&amp;</span>&nbsp;<span class="op" id="6599512">!</span><span class="ident" id="6599513">big</span>&nbsp;<span class="op" id="6599517">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599522">t</span><span class="op" id="6599523">.</span><span class="ident" id="6599524">Errorf</span><span class="op" id="6599530">(</span><span class="string" id="6599531">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="6599568">,</span>&nbsp;<span class="ident" id="6599570">i</span><span class="op" id="6599571">,</span>&nbsp;<span class="ident" id="6599573">err</span><span class="op" id="6599576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599581">continue</span>&nbsp;<span class="ident" id="6599590">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599606">actual</span>&nbsp;<span class="op" id="6599613">:=</span>&nbsp;<span class="ident" id="6599616">buf</span><span class="op" id="6599619">.</span><span class="ident" id="6599620">Bytes</span><span class="op" id="6599625">(</span><span class="op" id="6599626">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599630">if</span>&nbsp;<span class="op" id="6599633">!</span><span class="ident" id="6599634">bytes</span><span class="op" id="6599639">.</span><span class="ident" id="6599640">Equal</span><span class="op" id="6599645">(</span><span class="ident" id="6599646">expected</span><span class="op" id="6599654">,</span>&nbsp;<span class="ident" id="6599656">actual</span><span class="op" id="6599662">)</span>&nbsp;<span class="op" id="6599664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599669">t</span><span class="op" id="6599670">.</span><span class="ident" id="6599671">Errorf</span><span class="op" id="6599677">(</span><span class="string" id="6599678">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="6599733">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599739">i</span><span class="op" id="6599740">,</span>&nbsp;<span class="ident" id="6599742">bytediff</span><span class="op" id="6599750">(</span><span class="ident" id="6599751">expected</span><span class="op" id="6599759">,</span>&nbsp;<span class="ident" id="6599761">actual</span><span class="op" id="6599767">)</span><span class="op" id="6599768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599776">if</span>&nbsp;<span class="ident" id="6599779">testing</span><span class="op" id="6599786">.</span><span class="ident" id="6599787">Short</span><span class="op" id="6599792">(</span><span class="op" id="6599793">)</span>&nbsp;<span class="op" id="6599795">{</span>&nbsp;<span class="comment" id="6599797">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599833">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599844">}</span><br>
<span class="lineno"></span><span class="op" id="6599846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6599849">func</span>&nbsp;<span class="ident" id="6599854">TestPax</span><span class="op" id="6599861">(</span><span class="ident" id="6599862">t</span>&nbsp;<span class="op" id="6599864">*</span><span class="ident" id="6599865">testing</span><span class="op" id="6599872">.</span><span class="ident" id="6599873">T</span><span class="op" id="6599874">)</span>&nbsp;<span class="op" id="6599876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6599879">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599919">fileinfo</span><span class="op" id="6599927">,</span>&nbsp;<span class="ident" id="6599929">err</span>&nbsp;<span class="op" id="6599933">:=</span>&nbsp;<span class="ident" id="6599936">os</span><span class="op" id="6599938">.</span><span class="ident" id="6599939">Stat</span><span class="op" id="6599943">(</span><span class="string" id="6599944">&#34;testdata/small.txt&#34;</span><span class="op" id="6599964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599967">if</span>&nbsp;<span class="ident" id="6599970">err</span>&nbsp;<span class="op" id="6599974">!=</span>&nbsp;<span class="ident" id="6599977">nil</span>&nbsp;<span class="op" id="6599981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599985">t</span><span class="op" id="6599986">.</span><span class="ident" id="6599987">Fatal</span><span class="op" id="6599992">(</span><span class="ident" id="6599993">err</span><span class="op" id="6599996">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600002">hdr</span><span class="op" id="6600005">,</span>&nbsp;<span class="ident" id="6600007">err</span>&nbsp;<span class="op" id="6600011">:=</span>&nbsp;<span class="ident" id="6600014">FileInfoHeader</span><span class="op" id="6600028">(</span><span class="ident" id="6600029">fileinfo</span><span class="op" id="6600037">,</span>&nbsp;<span class="string" id="6600039">&#34;&#34;</span><span class="op" id="6600041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600044">if</span>&nbsp;<span class="ident" id="6600047">err</span>&nbsp;<span class="op" id="6600051">!=</span>&nbsp;<span class="ident" id="6600054">nil</span>&nbsp;<span class="op" id="6600058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600062">t</span><span class="op" id="6600063">.</span><span class="ident" id="6600064">Fatalf</span><span class="op" id="6600070">(</span><span class="string" id="6600071">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6600084">,</span>&nbsp;<span class="ident" id="6600086">err</span><span class="op" id="6600089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600092">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6600095">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600135">longName</span>&nbsp;<span class="op" id="6600144">:=</span>&nbsp;<span class="ident" id="6600147">strings</span><span class="op" id="6600154">.</span><span class="ident" id="6600155">Repeat</span><span class="op" id="6600161">(</span><span class="string" id="6600162">&#34;ab&#34;</span><span class="op" id="6600166">,</span>&nbsp;<span class="num" id="6600168">100</span><span class="op" id="6600171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600174">contents</span>&nbsp;<span class="op" id="6600183">:=</span>&nbsp;<span class="ident" id="6600186">strings</span><span class="op" id="6600193">.</span><span class="ident" id="6600194">Repeat</span><span class="op" id="6600200">(</span><span class="string" id="6600201">&#34;&nbsp;&#34;</span><span class="op" id="6600204">,</span>&nbsp;<span class="builtintype" id="6600206">int</span><span class="op" id="6600209">(</span><span class="ident" id="6600210">hdr</span><span class="op" id="6600213">.</span><span class="ident" id="6600214">Size</span><span class="op" id="6600218">)</span><span class="op" id="6600219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600222">hdr</span><span class="op" id="6600225">.</span><span class="ident" id="6600226">Name</span>&nbsp;<span class="op" id="6600231">=</span>&nbsp;<span class="ident" id="6600233">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600243">var</span>&nbsp;<span class="ident" id="6600247">buf</span>&nbsp;<span class="ident" id="6600251">bytes</span><span class="op" id="6600256">.</span><span class="ident" id="6600257">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600265">writer</span>&nbsp;<span class="op" id="6600272">:=</span>&nbsp;<span class="ident" id="6600275">NewWriter</span><span class="op" id="6600284">(</span><span class="op" id="6600285">&amp;</span><span class="ident" id="6600286">buf</span><span class="op" id="6600289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600292">if</span>&nbsp;<span class="ident" id="6600295">err</span>&nbsp;<span class="op" id="6600299">:=</span>&nbsp;<span class="ident" id="6600302">writer</span><span class="op" id="6600308">.</span><span class="ident" id="6600309">WriteHeader</span><span class="op" id="6600320">(</span><span class="ident" id="6600321">hdr</span><span class="op" id="6600324">)</span><span class="op" id="6600325">;</span>&nbsp;<span class="ident" id="6600327">err</span>&nbsp;<span class="op" id="6600331">!=</span>&nbsp;<span class="ident" id="6600334">nil</span>&nbsp;<span class="op" id="6600338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600342">t</span><span class="op" id="6600343">.</span><span class="ident" id="6600344">Fatal</span><span class="op" id="6600349">(</span><span class="ident" id="6600350">err</span><span class="op" id="6600353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600359">if</span>&nbsp;<span class="ident" id="6600362">_</span><span class="op" id="6600363">,</span>&nbsp;<span class="ident" id="6600365">err</span>&nbsp;<span class="op" id="6600369">=</span>&nbsp;<span class="ident" id="6600371">writer</span><span class="op" id="6600377">.</span><span class="ident" id="6600378">Write</span><span class="op" id="6600383">(</span><span class="op" id="6600384">[</span><span class="op" id="6600385">]</span><span class="builtintype" id="6600386">byte</span><span class="op" id="6600390">(</span><span class="ident" id="6600391">contents</span><span class="op" id="6600399">)</span><span class="op" id="6600400">)</span><span class="op" id="6600401">;</span>&nbsp;<span class="ident" id="6600403">err</span>&nbsp;<span class="op" id="6600407">!=</span>&nbsp;<span class="ident" id="6600410">nil</span>&nbsp;<span class="op" id="6600414">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600418">t</span><span class="op" id="6600419">.</span><span class="ident" id="6600420">Fatal</span><span class="op" id="6600425">(</span><span class="ident" id="6600426">err</span><span class="op" id="6600429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600435">if</span>&nbsp;<span class="ident" id="6600438">err</span>&nbsp;<span class="op" id="6600442">:=</span>&nbsp;<span class="ident" id="6600445">writer</span><span class="op" id="6600451">.</span><span class="ident" id="6600452">Close</span><span class="op" id="6600457">(</span><span class="op" id="6600458">)</span><span class="op" id="6600459">;</span>&nbsp;<span class="ident" id="6600461">err</span>&nbsp;<span class="op" id="6600465">!=</span>&nbsp;<span class="ident" id="6600468">nil</span>&nbsp;<span class="op" id="6600472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600476">t</span><span class="op" id="6600477">.</span><span class="ident" id="6600478">Fatal</span><span class="op" id="6600483">(</span><span class="ident" id="6600484">err</span><span class="op" id="6600487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600490">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6600493">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600551">if</span>&nbsp;<span class="op" id="6600554">!</span><span class="ident" id="6600555">bytes</span><span class="op" id="6600560">.</span><span class="ident" id="6600561">Contains</span><span class="op" id="6600569">(</span><span class="ident" id="6600570">buf</span><span class="op" id="6600573">.</span><span class="ident" id="6600574">Bytes</span><span class="op" id="6600579">(</span><span class="op" id="6600580">)</span><span class="op" id="6600581">,</span>&nbsp;<span class="op" id="6600583">[</span><span class="op" id="6600584">]</span><span class="builtintype" id="6600585">byte</span><span class="op" id="6600589">(</span><span class="string" id="6600590">&#34;PaxHeaders.&#34;</span><span class="op" id="6600603">)</span><span class="op" id="6600604">)</span>&nbsp;<span class="op" id="6600606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600610">t</span><span class="op" id="6600611">.</span><span class="ident" id="6600612">Fatal</span><span class="op" id="6600617">(</span><span class="string" id="6600618">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6600667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6600673">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600735">reader</span>&nbsp;<span class="op" id="6600742">:=</span>&nbsp;<span class="ident" id="6600745">NewReader</span><span class="op" id="6600754">(</span><span class="op" id="6600755">&amp;</span><span class="ident" id="6600756">buf</span><span class="op" id="6600759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600762">hdr</span><span class="op" id="6600765">,</span>&nbsp;<span class="ident" id="6600767">err</span>&nbsp;<span class="op" id="6600771">=</span>&nbsp;<span class="ident" id="6600773">reader</span><span class="op" id="6600779">.</span><span class="ident" id="6600780">Next</span><span class="op" id="6600784">(</span><span class="op" id="6600785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600788">if</span>&nbsp;<span class="ident" id="6600791">err</span>&nbsp;<span class="op" id="6600795">!=</span>&nbsp;<span class="ident" id="6600798">nil</span>&nbsp;<span class="op" id="6600802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600806">t</span><span class="op" id="6600807">.</span><span class="ident" id="6600808">Fatal</span><span class="op" id="6600813">(</span><span class="ident" id="6600814">err</span><span class="op" id="6600817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600820">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6600823">if</span>&nbsp;<span class="ident" id="6600826">hdr</span><span class="op" id="6600829">.</span><span class="ident" id="6600830">Name</span>&nbsp;<span class="op" id="6600835">!=</span>&nbsp;<span class="ident" id="6600838">longName</span>&nbsp;<span class="op" id="6600847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600851">t</span><span class="op" id="6600852">.</span><span class="ident" id="6600853">Fatal</span><span class="op" id="6600858">(</span><span class="string" id="6600859">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="6600892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6600895">}</span><br>
<span class="lineno"></span><span class="op" id="6600897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="6600900">func</span>&nbsp;<span class="ident" id="6600905">TestPaxSymlink</span><span class="op" id="6600919">(</span><span class="ident" id="6600920">t</span>&nbsp;<span class="op" id="6600922">*</span><span class="ident" id="6600923">testing</span><span class="op" id="6600930">.</span><span class="ident" id="6600931">T</span><span class="op" id="6600932">)</span>&nbsp;<span class="op" id="6600934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6600937">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6600981">fileinfo</span><span class="op" id="6600989">,</span>&nbsp;<span class="ident" id="6600991">err</span>&nbsp;<span class="op" id="6600995">:=</span>&nbsp;<span class="ident" id="6600998">os</span><span class="op" id="6601000">.</span><span class="ident" id="6601001">Stat</span><span class="op" id="6601005">(</span><span class="string" id="6601006">&#34;testdata/small.txt&#34;</span><span class="op" id="6601026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601029">if</span>&nbsp;<span class="ident" id="6601032">err</span>&nbsp;<span class="op" id="6601036">!=</span>&nbsp;<span class="ident" id="6601039">nil</span>&nbsp;<span class="op" id="6601043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601047">t</span><span class="op" id="6601048">.</span><span class="ident" id="6601049">Fatal</span><span class="op" id="6601054">(</span><span class="ident" id="6601055">err</span><span class="op" id="6601058">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601064">hdr</span><span class="op" id="6601067">,</span>&nbsp;<span class="ident" id="6601069">err</span>&nbsp;<span class="op" id="6601073">:=</span>&nbsp;<span class="ident" id="6601076">FileInfoHeader</span><span class="op" id="6601090">(</span><span class="ident" id="6601091">fileinfo</span><span class="op" id="6601099">,</span>&nbsp;<span class="string" id="6601101">&#34;&#34;</span><span class="op" id="6601103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601106">hdr</span><span class="op" id="6601109">.</span><span class="ident" id="6601110">Typeflag</span>&nbsp;<span class="op" id="6601119">=</span>&nbsp;<span class="ident" id="6601121">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601134">if</span>&nbsp;<span class="ident" id="6601137">err</span>&nbsp;<span class="op" id="6601141">!=</span>&nbsp;<span class="ident" id="6601144">nil</span>&nbsp;<span class="op" id="6601148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601152">t</span><span class="op" id="6601153">.</span><span class="ident" id="6601154">Fatalf</span><span class="op" id="6601160">(</span><span class="string" id="6601161">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6601175">,</span>&nbsp;<span class="ident" id="6601177">err</span><span class="op" id="6601180">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6601186">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601230">longLinkname</span>&nbsp;<span class="op" id="6601243">:=</span>&nbsp;<span class="ident" id="6601246">strings</span><span class="op" id="6601253">.</span><span class="ident" id="6601254">Repeat</span><span class="op" id="6601260">(</span><span class="string" id="6601261">&#34;1234567890/1234567890&#34;</span><span class="op" id="6601284">,</span>&nbsp;<span class="num" id="6601286">10</span><span class="op" id="6601288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601291">hdr</span><span class="op" id="6601294">.</span><span class="ident" id="6601295">Linkname</span>&nbsp;<span class="op" id="6601304">=</span>&nbsp;<span class="ident" id="6601306">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601321">hdr</span><span class="op" id="6601324">.</span><span class="ident" id="6601325">Size</span>&nbsp;<span class="op" id="6601330">=</span>&nbsp;<span class="num" id="6601332">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601335">var</span>&nbsp;<span class="ident" id="6601339">buf</span>&nbsp;<span class="ident" id="6601343">bytes</span><span class="op" id="6601348">.</span><span class="ident" id="6601349">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601357">writer</span>&nbsp;<span class="op" id="6601364">:=</span>&nbsp;<span class="ident" id="6601367">NewWriter</span><span class="op" id="6601376">(</span><span class="op" id="6601377">&amp;</span><span class="ident" id="6601378">buf</span><span class="op" id="6601381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601384">if</span>&nbsp;<span class="ident" id="6601387">err</span>&nbsp;<span class="op" id="6601391">:=</span>&nbsp;<span class="ident" id="6601394">writer</span><span class="op" id="6601400">.</span><span class="ident" id="6601401">WriteHeader</span><span class="op" id="6601412">(</span><span class="ident" id="6601413">hdr</span><span class="op" id="6601416">)</span><span class="op" id="6601417">;</span>&nbsp;<span class="ident" id="6601419">err</span>&nbsp;<span class="op" id="6601423">!=</span>&nbsp;<span class="ident" id="6601426">nil</span>&nbsp;<span class="op" id="6601430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601434">t</span><span class="op" id="6601435">.</span><span class="ident" id="6601436">Fatal</span><span class="op" id="6601441">(</span><span class="ident" id="6601442">err</span><span class="op" id="6601445">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601451">if</span>&nbsp;<span class="ident" id="6601454">err</span>&nbsp;<span class="op" id="6601458">:=</span>&nbsp;<span class="ident" id="6601461">writer</span><span class="op" id="6601467">.</span><span class="ident" id="6601468">Close</span><span class="op" id="6601473">(</span><span class="op" id="6601474">)</span><span class="op" id="6601475">;</span>&nbsp;<span class="ident" id="6601477">err</span>&nbsp;<span class="op" id="6601481">!=</span>&nbsp;<span class="ident" id="6601484">nil</span>&nbsp;<span class="op" id="6601488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601492">t</span><span class="op" id="6601493">.</span><span class="ident" id="6601494">Fatal</span><span class="op" id="6601499">(</span><span class="ident" id="6601500">err</span><span class="op" id="6601503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6601509">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601567">if</span>&nbsp;<span class="op" id="6601570">!</span><span class="ident" id="6601571">bytes</span><span class="op" id="6601576">.</span><span class="ident" id="6601577">Contains</span><span class="op" id="6601585">(</span><span class="ident" id="6601586">buf</span><span class="op" id="6601589">.</span><span class="ident" id="6601590">Bytes</span><span class="op" id="6601595">(</span><span class="op" id="6601596">)</span><span class="op" id="6601597">,</span>&nbsp;<span class="op" id="6601599">[</span><span class="op" id="6601600">]</span><span class="builtintype" id="6601601">byte</span><span class="op" id="6601605">(</span><span class="string" id="6601606">&#34;PaxHeaders.&#34;</span><span class="op" id="6601619">)</span><span class="op" id="6601620">)</span>&nbsp;<span class="op" id="6601622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601626">t</span><span class="op" id="6601627">.</span><span class="ident" id="6601628">Fatal</span><span class="op" id="6601633">(</span><span class="string" id="6601634">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6601683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6601689">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601751">reader</span>&nbsp;<span class="op" id="6601758">:=</span>&nbsp;<span class="ident" id="6601761">NewReader</span><span class="op" id="6601770">(</span><span class="op" id="6601771">&amp;</span><span class="ident" id="6601772">buf</span><span class="op" id="6601775">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601778">hdr</span><span class="op" id="6601781">,</span>&nbsp;<span class="ident" id="6601783">err</span>&nbsp;<span class="op" id="6601787">=</span>&nbsp;<span class="ident" id="6601789">reader</span><span class="op" id="6601795">.</span><span class="ident" id="6601796">Next</span><span class="op" id="6601800">(</span><span class="op" id="6601801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601804">if</span>&nbsp;<span class="ident" id="6601807">err</span>&nbsp;<span class="op" id="6601811">!=</span>&nbsp;<span class="ident" id="6601814">nil</span>&nbsp;<span class="op" id="6601818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601822">t</span><span class="op" id="6601823">.</span><span class="ident" id="6601824">Fatal</span><span class="op" id="6601829">(</span><span class="ident" id="6601830">err</span><span class="op" id="6601833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6601839">if</span>&nbsp;<span class="ident" id="6601842">hdr</span><span class="op" id="6601845">.</span><span class="ident" id="6601846">Linkname</span>&nbsp;<span class="op" id="6601855">!=</span>&nbsp;<span class="ident" id="6601858">longLinkname</span>&nbsp;<span class="op" id="6601871">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6601875">t</span><span class="op" id="6601876">.</span><span class="ident" id="6601877">Fatal</span><span class="op" id="6601882">(</span><span class="string" id="6601883">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="6601916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6601919">}</span><br>
<span class="lineno"></span><span class="op" id="6601921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6601924">func</span>&nbsp;<span class="ident" id="6601929">TestPaxNonAscii</span><span class="op" id="6601944">(</span><span class="ident" id="6601945">t</span>&nbsp;<span class="op" id="6601947">*</span><span class="ident" id="6601948">testing</span><span class="op" id="6601955">.</span><span class="ident" id="6601956">T</span><span class="op" id="6601957">)</span>&nbsp;<span class="op" id="6601959">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6601962">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6602034">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602089">fileinfo</span><span class="op" id="6602097">,</span>&nbsp;<span class="ident" id="6602099">err</span>&nbsp;<span class="op" id="6602103">:=</span>&nbsp;<span class="ident" id="6602106">os</span><span class="op" id="6602108">.</span><span class="ident" id="6602109">Stat</span><span class="op" id="6602113">(</span><span class="string" id="6602114">&#34;testdata/small.txt&#34;</span><span class="op" id="6602134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602137">if</span>&nbsp;<span class="ident" id="6602140">err</span>&nbsp;<span class="op" id="6602144">!=</span>&nbsp;<span class="ident" id="6602147">nil</span>&nbsp;<span class="op" id="6602151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602155">t</span><span class="op" id="6602156">.</span><span class="ident" id="6602157">Fatal</span><span class="op" id="6602162">(</span><span class="ident" id="6602163">err</span><span class="op" id="6602166">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6602169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602173">hdr</span><span class="op" id="6602176">,</span>&nbsp;<span class="ident" id="6602178">err</span>&nbsp;<span class="op" id="6602182">:=</span>&nbsp;<span class="ident" id="6602185">FileInfoHeader</span><span class="op" id="6602199">(</span><span class="ident" id="6602200">fileinfo</span><span class="op" id="6602208">,</span>&nbsp;<span class="string" id="6602210">&#34;&#34;</span><span class="op" id="6602212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602215">if</span>&nbsp;<span class="ident" id="6602218">err</span>&nbsp;<span class="op" id="6602222">!=</span>&nbsp;<span class="ident" id="6602225">nil</span>&nbsp;<span class="op" id="6602229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602233">t</span><span class="op" id="6602234">.</span><span class="ident" id="6602235">Fatalf</span><span class="op" id="6602241">(</span><span class="string" id="6602242">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6602256">,</span>&nbsp;<span class="ident" id="6602258">err</span><span class="op" id="6602261">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6602264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6602268">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602289">chineseFilename</span>&nbsp;<span class="op" id="6602305">:=</span>&nbsp;<span class="string" id="6602308">&#34;文件名&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602321">chineseGroupname</span>&nbsp;<span class="op" id="6602338">:=</span>&nbsp;<span class="string" id="6602341">&#34;組&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602348">chineseUsername</span>&nbsp;<span class="op" id="6602364">:=</span>&nbsp;<span class="string" id="6602367">&#34;用戶名&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602381">hdr</span><span class="op" id="6602384">.</span><span class="ident" id="6602385">Name</span>&nbsp;<span class="op" id="6602390">=</span>&nbsp;<span class="ident" id="6602392">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602409">hdr</span><span class="op" id="6602412">.</span><span class="ident" id="6602413">Gname</span>&nbsp;<span class="op" id="6602419">=</span>&nbsp;<span class="ident" id="6602421">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602439">hdr</span><span class="op" id="6602442">.</span><span class="ident" id="6602443">Uname</span>&nbsp;<span class="op" id="6602449">=</span>&nbsp;<span class="ident" id="6602451">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602469">contents</span>&nbsp;<span class="op" id="6602478">:=</span>&nbsp;<span class="ident" id="6602481">strings</span><span class="op" id="6602488">.</span><span class="ident" id="6602489">Repeat</span><span class="op" id="6602495">(</span><span class="string" id="6602496">&#34;&nbsp;&#34;</span><span class="op" id="6602499">,</span>&nbsp;<span class="builtintype" id="6602501">int</span><span class="op" id="6602504">(</span><span class="ident" id="6602505">hdr</span><span class="op" id="6602508">.</span><span class="ident" id="6602509">Size</span><span class="op" id="6602513">)</span><span class="op" id="6602514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602518">var</span>&nbsp;<span class="ident" id="6602522">buf</span>&nbsp;<span class="ident" id="6602526">bytes</span><span class="op" id="6602531">.</span><span class="ident" id="6602532">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602540">writer</span>&nbsp;<span class="op" id="6602547">:=</span>&nbsp;<span class="ident" id="6602550">NewWriter</span><span class="op" id="6602559">(</span><span class="op" id="6602560">&amp;</span><span class="ident" id="6602561">buf</span><span class="op" id="6602564">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602567">if</span>&nbsp;<span class="ident" id="6602570">err</span>&nbsp;<span class="op" id="6602574">:=</span>&nbsp;<span class="ident" id="6602577">writer</span><span class="op" id="6602583">.</span><span class="ident" id="6602584">WriteHeader</span><span class="op" id="6602595">(</span><span class="ident" id="6602596">hdr</span><span class="op" id="6602599">)</span><span class="op" id="6602600">;</span>&nbsp;<span class="ident" id="6602602">err</span>&nbsp;<span class="op" id="6602606">!=</span>&nbsp;<span class="ident" id="6602609">nil</span>&nbsp;<span class="op" id="6602613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602617">t</span><span class="op" id="6602618">.</span><span class="ident" id="6602619">Fatal</span><span class="op" id="6602624">(</span><span class="ident" id="6602625">err</span><span class="op" id="6602628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6602631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602634">if</span>&nbsp;<span class="ident" id="6602637">_</span><span class="op" id="6602638">,</span>&nbsp;<span class="ident" id="6602640">err</span>&nbsp;<span class="op" id="6602644">=</span>&nbsp;<span class="ident" id="6602646">writer</span><span class="op" id="6602652">.</span><span class="ident" id="6602653">Write</span><span class="op" id="6602658">(</span><span class="op" id="6602659">[</span><span class="op" id="6602660">]</span><span class="builtintype" id="6602661">byte</span><span class="op" id="6602665">(</span><span class="ident" id="6602666">contents</span><span class="op" id="6602674">)</span><span class="op" id="6602675">)</span><span class="op" id="6602676">;</span>&nbsp;<span class="ident" id="6602678">err</span>&nbsp;<span class="op" id="6602682">!=</span>&nbsp;<span class="ident" id="6602685">nil</span>&nbsp;<span class="op" id="6602689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602693">t</span><span class="op" id="6602694">.</span><span class="ident" id="6602695">Fatal</span><span class="op" id="6602700">(</span><span class="ident" id="6602701">err</span><span class="op" id="6602704">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6602707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602710">if</span>&nbsp;<span class="ident" id="6602713">err</span>&nbsp;<span class="op" id="6602717">:=</span>&nbsp;<span class="ident" id="6602720">writer</span><span class="op" id="6602726">.</span><span class="ident" id="6602727">Close</span><span class="op" id="6602732">(</span><span class="op" id="6602733">)</span><span class="op" id="6602734">;</span>&nbsp;<span class="ident" id="6602736">err</span>&nbsp;<span class="op" id="6602740">!=</span>&nbsp;<span class="ident" id="6602743">nil</span>&nbsp;<span class="op" id="6602747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602751">t</span><span class="op" id="6602752">.</span><span class="ident" id="6602753">Fatal</span><span class="op" id="6602758">(</span><span class="ident" id="6602759">err</span><span class="op" id="6602762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6602765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6602768">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6602826">if</span>&nbsp;<span class="op" id="6602829">!</span><span class="ident" id="6602830">bytes</span><span class="op" id="6602835">.</span><span class="ident" id="6602836">Contains</span><span class="op" id="6602844">(</span><span class="ident" id="6602845">buf</span><span class="op" id="6602848">.</span><span class="ident" id="6602849">Bytes</span><span class="op" id="6602854">(</span><span class="op" id="6602855">)</span><span class="op" id="6602856">,</span>&nbsp;<span class="op" id="6602858">[</span><span class="op" id="6602859">]</span><span class="builtintype" id="6602860">byte</span><span class="op" id="6602864">(</span><span class="string" id="6602865">&#34;PaxHeaders.&#34;</span><span class="op" id="6602878">)</span><span class="op" id="6602879">)</span>&nbsp;<span class="op" id="6602881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6602885">t</span><span class="op" id="6602886">.</span><span class="ident" id="6602887">Fatal</span><span class="op" id="6602892">(</span><span class="string" id="6602893">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="6602942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6602945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6602948">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603010">reader</span>&nbsp;<span class="op" id="6603017">:=</span>&nbsp;<span class="ident" id="6603020">NewReader</span><span class="op" id="6603029">(</span><span class="op" id="6603030">&amp;</span><span class="ident" id="6603031">buf</span><span class="op" id="6603034">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603037">hdr</span><span class="op" id="6603040">,</span>&nbsp;<span class="ident" id="6603042">err</span>&nbsp;<span class="op" id="6603046">=</span>&nbsp;<span class="ident" id="6603048">reader</span><span class="op" id="6603054">.</span><span class="ident" id="6603055">Next</span><span class="op" id="6603059">(</span><span class="op" id="6603060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603063">if</span>&nbsp;<span class="ident" id="6603066">err</span>&nbsp;<span class="op" id="6603070">!=</span>&nbsp;<span class="ident" id="6603073">nil</span>&nbsp;<span class="op" id="6603077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603081">t</span><span class="op" id="6603082">.</span><span class="ident" id="6603083">Fatal</span><span class="op" id="6603088">(</span><span class="ident" id="6603089">err</span><span class="op" id="6603092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603098">if</span>&nbsp;<span class="ident" id="6603101">hdr</span><span class="op" id="6603104">.</span><span class="ident" id="6603105">Name</span>&nbsp;<span class="op" id="6603110">!=</span>&nbsp;<span class="ident" id="6603113">chineseFilename</span>&nbsp;<span class="op" id="6603129">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603133">t</span><span class="op" id="6603134">.</span><span class="ident" id="6603135">Fatal</span><span class="op" id="6603140">(</span><span class="string" id="6603141">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="6603172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603178">if</span>&nbsp;<span class="ident" id="6603181">hdr</span><span class="op" id="6603184">.</span><span class="ident" id="6603185">Gname</span>&nbsp;<span class="op" id="6603191">!=</span>&nbsp;<span class="ident" id="6603194">chineseGroupname</span>&nbsp;<span class="op" id="6603211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603215">t</span><span class="op" id="6603216">.</span><span class="ident" id="6603217">Fatal</span><span class="op" id="6603222">(</span><span class="string" id="6603223">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="6603255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603258">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603261">if</span>&nbsp;<span class="ident" id="6603264">hdr</span><span class="op" id="6603267">.</span><span class="ident" id="6603268">Uname</span>&nbsp;<span class="op" id="6603274">!=</span>&nbsp;<span class="ident" id="6603277">chineseUsername</span>&nbsp;<span class="op" id="6603293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603297">t</span><span class="op" id="6603298">.</span><span class="ident" id="6603299">Fatal</span><span class="op" id="6603304">(</span><span class="string" id="6603305">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="6603336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603339">}</span><br>
<span class="lineno"></span><span class="op" id="6603341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="6603344">func</span>&nbsp;<span class="ident" id="6603349">TestPaxXattrs</span><span class="op" id="6603362">(</span><span class="ident" id="6603363">t</span>&nbsp;<span class="op" id="6603365">*</span><span class="ident" id="6603366">testing</span><span class="op" id="6603373">.</span><span class="ident" id="6603374">T</span><span class="op" id="6603375">)</span>&nbsp;<span class="op" id="6603377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603380">xattrs</span>&nbsp;<span class="op" id="6603387">:=</span>&nbsp;<span class="keyword" id="6603390">map</span><span class="op" id="6603393">[</span><span class="builtintype" id="6603394">string</span><span class="op" id="6603400">]</span><span class="builtintype" id="6603401">string</span><span class="op" id="6603407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6603411">&#34;user.key&#34;</span><span class="op" id="6603421">:</span>&nbsp;<span class="string" id="6603423">&#34;value&#34;</span><span class="op" id="6603430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6603437">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603473">fileinfo</span><span class="op" id="6603481">,</span>&nbsp;<span class="ident" id="6603483">err</span>&nbsp;<span class="op" id="6603487">:=</span>&nbsp;<span class="ident" id="6603490">os</span><span class="op" id="6603492">.</span><span class="ident" id="6603493">Stat</span><span class="op" id="6603497">(</span><span class="string" id="6603498">&#34;testdata/small.txt&#34;</span><span class="op" id="6603518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603521">if</span>&nbsp;<span class="ident" id="6603524">err</span>&nbsp;<span class="op" id="6603528">!=</span>&nbsp;<span class="ident" id="6603531">nil</span>&nbsp;<span class="op" id="6603535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603539">t</span><span class="op" id="6603540">.</span><span class="ident" id="6603541">Fatal</span><span class="op" id="6603546">(</span><span class="ident" id="6603547">err</span><span class="op" id="6603550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603553">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603556">hdr</span><span class="op" id="6603559">,</span>&nbsp;<span class="ident" id="6603561">err</span>&nbsp;<span class="op" id="6603565">:=</span>&nbsp;<span class="ident" id="6603568">FileInfoHeader</span><span class="op" id="6603582">(</span><span class="ident" id="6603583">fileinfo</span><span class="op" id="6603591">,</span>&nbsp;<span class="string" id="6603593">&#34;&#34;</span><span class="op" id="6603595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603598">if</span>&nbsp;<span class="ident" id="6603601">err</span>&nbsp;<span class="op" id="6603605">!=</span>&nbsp;<span class="ident" id="6603608">nil</span>&nbsp;<span class="op" id="6603612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603616">t</span><span class="op" id="6603617">.</span><span class="ident" id="6603618">Fatalf</span><span class="op" id="6603624">(</span><span class="string" id="6603625">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="6603638">,</span>&nbsp;<span class="ident" id="6603640">err</span><span class="op" id="6603643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603649">contents</span>&nbsp;<span class="op" id="6603658">:=</span>&nbsp;<span class="string" id="6603661">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603670">hdr</span><span class="op" id="6603673">.</span><span class="ident" id="6603674">Xattrs</span>&nbsp;<span class="op" id="6603681">=</span>&nbsp;<span class="ident" id="6603683">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603691">var</span>&nbsp;<span class="ident" id="6603695">buf</span>&nbsp;<span class="ident" id="6603699">bytes</span><span class="op" id="6603704">.</span><span class="ident" id="6603705">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603713">writer</span>&nbsp;<span class="op" id="6603720">:=</span>&nbsp;<span class="ident" id="6603723">NewWriter</span><span class="op" id="6603732">(</span><span class="op" id="6603733">&amp;</span><span class="ident" id="6603734">buf</span><span class="op" id="6603737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603740">if</span>&nbsp;<span class="ident" id="6603743">err</span>&nbsp;<span class="op" id="6603747">:=</span>&nbsp;<span class="ident" id="6603750">writer</span><span class="op" id="6603756">.</span><span class="ident" id="6603757">WriteHeader</span><span class="op" id="6603768">(</span><span class="ident" id="6603769">hdr</span><span class="op" id="6603772">)</span><span class="op" id="6603773">;</span>&nbsp;<span class="ident" id="6603775">err</span>&nbsp;<span class="op" id="6603779">!=</span>&nbsp;<span class="ident" id="6603782">nil</span>&nbsp;<span class="op" id="6603786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603790">t</span><span class="op" id="6603791">.</span><span class="ident" id="6603792">Fatal</span><span class="op" id="6603797">(</span><span class="ident" id="6603798">err</span><span class="op" id="6603801">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603807">if</span>&nbsp;<span class="ident" id="6603810">_</span><span class="op" id="6603811">,</span>&nbsp;<span class="ident" id="6603813">err</span>&nbsp;<span class="op" id="6603817">=</span>&nbsp;<span class="ident" id="6603819">writer</span><span class="op" id="6603825">.</span><span class="ident" id="6603826">Write</span><span class="op" id="6603831">(</span><span class="op" id="6603832">[</span><span class="op" id="6603833">]</span><span class="builtintype" id="6603834">byte</span><span class="op" id="6603838">(</span><span class="ident" id="6603839">contents</span><span class="op" id="6603847">)</span><span class="op" id="6603848">)</span><span class="op" id="6603849">;</span>&nbsp;<span class="ident" id="6603851">err</span>&nbsp;<span class="op" id="6603855">!=</span>&nbsp;<span class="ident" id="6603858">nil</span>&nbsp;<span class="op" id="6603862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603866">t</span><span class="op" id="6603867">.</span><span class="ident" id="6603868">Fatal</span><span class="op" id="6603873">(</span><span class="ident" id="6603874">err</span><span class="op" id="6603877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6603883">if</span>&nbsp;<span class="ident" id="6603886">err</span>&nbsp;<span class="op" id="6603890">:=</span>&nbsp;<span class="ident" id="6603893">writer</span><span class="op" id="6603899">.</span><span class="ident" id="6603900">Close</span><span class="op" id="6603905">(</span><span class="op" id="6603906">)</span><span class="op" id="6603907">;</span>&nbsp;<span class="ident" id="6603909">err</span>&nbsp;<span class="op" id="6603913">!=</span>&nbsp;<span class="ident" id="6603916">nil</span>&nbsp;<span class="op" id="6603920">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6603924">t</span><span class="op" id="6603925">.</span><span class="ident" id="6603926">Fatal</span><span class="op" id="6603931">(</span><span class="ident" id="6603932">err</span><span class="op" id="6603935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6603938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6603941">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604002">reader</span>&nbsp;<span class="op" id="6604009">:=</span>&nbsp;<span class="ident" id="6604012">NewReader</span><span class="op" id="6604021">(</span><span class="op" id="6604022">&amp;</span><span class="ident" id="6604023">buf</span><span class="op" id="6604026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604029">hdr</span><span class="op" id="6604032">,</span>&nbsp;<span class="ident" id="6604034">err</span>&nbsp;<span class="op" id="6604038">=</span>&nbsp;<span class="ident" id="6604040">reader</span><span class="op" id="6604046">.</span><span class="ident" id="6604047">Next</span><span class="op" id="6604051">(</span><span class="op" id="6604052">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604055">if</span>&nbsp;<span class="ident" id="6604058">err</span>&nbsp;<span class="op" id="6604062">!=</span>&nbsp;<span class="ident" id="6604065">nil</span>&nbsp;<span class="op" id="6604069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604073">t</span><span class="op" id="6604074">.</span><span class="ident" id="6604075">Fatal</span><span class="op" id="6604080">(</span><span class="ident" id="6604081">err</span><span class="op" id="6604084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604090">if</span>&nbsp;<span class="op" id="6604093">!</span><span class="ident" id="6604094">reflect</span><span class="op" id="6604101">.</span><span class="ident" id="6604102">DeepEqual</span><span class="op" id="6604111">(</span><span class="ident" id="6604112">hdr</span><span class="op" id="6604115">.</span><span class="ident" id="6604116">Xattrs</span><span class="op" id="6604122">,</span>&nbsp;<span class="ident" id="6604124">xattrs</span><span class="op" id="6604130">)</span>&nbsp;<span class="op" id="6604132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604136">t</span><span class="op" id="6604137">.</span><span class="ident" id="6604138">Fatalf</span><span class="op" id="6604144">(</span><span class="string" id="6604145">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="6604199">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604204">hdr</span><span class="op" id="6604207">.</span><span class="ident" id="6604208">Xattrs</span><span class="op" id="6604214">,</span>&nbsp;<span class="ident" id="6604216">xattrs</span><span class="op" id="6604222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604225">}</span><br>
<span class="lineno"></span><span class="op" id="6604227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604230">func</span>&nbsp;<span class="ident" id="6604235">TestPAXHeader</span><span class="op" id="6604248">(</span><span class="ident" id="6604249">t</span>&nbsp;<span class="op" id="6604251">*</span><span class="ident" id="6604252">testing</span><span class="op" id="6604259">.</span><span class="ident" id="6604260">T</span><span class="op" id="6604261">)</span>&nbsp;<span class="op" id="6604263">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604266">medName</span>&nbsp;<span class="op" id="6604274">:=</span>&nbsp;<span class="ident" id="6604277">strings</span><span class="op" id="6604284">.</span><span class="ident" id="6604285">Repeat</span><span class="op" id="6604291">(</span><span class="string" id="6604292">&#34;CD&#34;</span><span class="op" id="6604296">,</span>&nbsp;<span class="num" id="6604298">50</span><span class="op" id="6604300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604303">longName</span>&nbsp;<span class="op" id="6604312">:=</span>&nbsp;<span class="ident" id="6604315">strings</span><span class="op" id="6604322">.</span><span class="ident" id="6604323">Repeat</span><span class="op" id="6604329">(</span><span class="string" id="6604330">&#34;AB&#34;</span><span class="op" id="6604334">,</span>&nbsp;<span class="num" id="6604336">100</span><span class="op" id="6604339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604342">paxTests</span>&nbsp;<span class="op" id="6604351">:=</span>&nbsp;<span class="op" id="6604354">[</span><span class="op" id="6604355">]</span><span class="op" id="6604356">[</span><span class="num" id="6604357">2</span><span class="op" id="6604358">]</span><span class="builtintype" id="6604359">string</span><span class="op" id="6604365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604369">{</span><span class="ident" id="6604370">paxPath</span>&nbsp;<span class="op" id="6604378">+</span>&nbsp;<span class="string" id="6604380">&#34;=/etc/hosts&#34;</span><span class="op" id="6604393">,</span>&nbsp;<span class="string" id="6604395">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="6604417">}</span><span class="op" id="6604418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604422">{</span><span class="string" id="6604423">&#34;a=b&#34;</span><span class="op" id="6604428">,</span>&nbsp;<span class="string" id="6604430">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="6604439">}</span><span class="op" id="6604440">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6604451">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604476">{</span><span class="string" id="6604477">&#34;a=names&#34;</span><span class="op" id="6604486">,</span>&nbsp;<span class="string" id="6604488">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="6604502">}</span><span class="op" id="6604503">,</span>&nbsp;<span class="comment" id="6604505">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604538">{</span><span class="ident" id="6604539">paxPath</span>&nbsp;<span class="op" id="6604547">+</span>&nbsp;<span class="string" id="6604549">&#34;=&#34;</span>&nbsp;<span class="op" id="6604553">+</span>&nbsp;<span class="ident" id="6604555">longName</span><span class="op" id="6604563">,</span>&nbsp;<span class="ident" id="6604565">fmt</span><span class="op" id="6604568">.</span><span class="ident" id="6604569">Sprintf</span><span class="op" id="6604576">(</span><span class="string" id="6604577">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="6604592">,</span>&nbsp;<span class="ident" id="6604594">longName</span><span class="op" id="6604602">)</span><span class="op" id="6604603">}</span><span class="op" id="6604604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604608">{</span><span class="ident" id="6604609">paxPath</span>&nbsp;<span class="op" id="6604617">+</span>&nbsp;<span class="string" id="6604619">&#34;=&#34;</span>&nbsp;<span class="op" id="6604623">+</span>&nbsp;<span class="ident" id="6604625">medName</span><span class="op" id="6604632">,</span>&nbsp;<span class="ident" id="6604634">fmt</span><span class="op" id="6604637">.</span><span class="ident" id="6604638">Sprintf</span><span class="op" id="6604645">(</span><span class="string" id="6604646">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="6604661">,</span>&nbsp;<span class="ident" id="6604663">medName</span><span class="op" id="6604670">)</span><span class="op" id="6604671">}</span><span class="op" id="6604672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604676">for</span>&nbsp;<span class="ident" id="6604680">_</span><span class="op" id="6604681">,</span>&nbsp;<span class="ident" id="6604683">test</span>&nbsp;<span class="op" id="6604688">:=</span>&nbsp;<span class="keyword" id="6604691">range</span>&nbsp;<span class="ident" id="6604697">paxTests</span>&nbsp;<span class="op" id="6604706">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604710">key</span><span class="op" id="6604713">,</span>&nbsp;<span class="ident" id="6604715">expected</span>&nbsp;<span class="op" id="6604724">:=</span>&nbsp;<span class="ident" id="6604727">test</span><span class="op" id="6604731">[</span><span class="num" id="6604732">0</span><span class="op" id="6604733">]</span><span class="op" id="6604734">,</span>&nbsp;<span class="ident" id="6604736">test</span><span class="op" id="6604740">[</span><span class="num" id="6604741">1</span><span class="op" id="6604742">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6604746">if</span>&nbsp;<span class="ident" id="6604749">result</span>&nbsp;<span class="op" id="6604756">:=</span>&nbsp;<span class="ident" id="6604759">paxHeader</span><span class="op" id="6604768">(</span><span class="ident" id="6604769">key</span><span class="op" id="6604772">)</span><span class="op" id="6604773">;</span>&nbsp;<span class="ident" id="6604775">result</span>&nbsp;<span class="op" id="6604782">!=</span>&nbsp;<span class="ident" id="6604785">expected</span>&nbsp;<span class="op" id="6604794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6604799">t</span><span class="op" id="6604800">.</span><span class="ident" id="6604801">Fatalf</span><span class="op" id="6604807">(</span><span class="string" id="6604808">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="6604840">,</span>&nbsp;<span class="ident" id="6604842">result</span><span class="op" id="6604848">,</span>&nbsp;<span class="ident" id="6604850">expected</span><span class="op" id="6604858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6604865">}</span><br>
<span class="lineno">420</span><span class="op" id="6604867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6604870">func</span>&nbsp;<span class="ident" id="6604875">TestUSTARLongName</span><span class="op" id="6604892">(</span><span class="ident" id="6604893">t</span>&nbsp;<span class="op" id="6604895">*</span><span class="ident" id="6604896">testing</span><span class="op" id="6604903">.</span><span class="ident" id="6604904">T</span><span class="op" id="6604905">)</span>&nbsp;<span class="op" id="6604907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6604910">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605008">fileinfo</span><span class="op" id="6605016">,</span>&nbsp;<span class="ident" id="6605018">err</span>&nbsp;<span class="op" id="6605022">:=</span>&nbsp;<span class="ident" id="6605025">os</span><span class="op" id="6605027">.</span><span class="ident" id="6605028">Stat</span><span class="op" id="6605032">(</span><span class="string" id="6605033">&#34;testdata/small.txt&#34;</span><span class="op" id="6605053">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605056">if</span>&nbsp;<span class="ident" id="6605059">err</span>&nbsp;<span class="op" id="6605063">!=</span>&nbsp;<span class="ident" id="6605066">nil</span>&nbsp;<span class="op" id="6605070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605074">t</span><span class="op" id="6605075">.</span><span class="ident" id="6605076">Fatal</span><span class="op" id="6605081">(</span><span class="ident" id="6605082">err</span><span class="op" id="6605085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605091">hdr</span><span class="op" id="6605094">,</span>&nbsp;<span class="ident" id="6605096">err</span>&nbsp;<span class="op" id="6605100">:=</span>&nbsp;<span class="ident" id="6605103">FileInfoHeader</span><span class="op" id="6605117">(</span><span class="ident" id="6605118">fileinfo</span><span class="op" id="6605126">,</span>&nbsp;<span class="string" id="6605128">&#34;&#34;</span><span class="op" id="6605130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605133">hdr</span><span class="op" id="6605136">.</span><span class="ident" id="6605137">Typeflag</span>&nbsp;<span class="op" id="6605146">=</span>&nbsp;<span class="ident" id="6605148">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605157">if</span>&nbsp;<span class="ident" id="6605160">err</span>&nbsp;<span class="op" id="6605164">!=</span>&nbsp;<span class="ident" id="6605167">nil</span>&nbsp;<span class="op" id="6605171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605175">t</span><span class="op" id="6605176">.</span><span class="ident" id="6605177">Fatalf</span><span class="op" id="6605183">(</span><span class="string" id="6605184">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="6605198">,</span>&nbsp;<span class="ident" id="6605200">err</span><span class="op" id="6605203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6605209">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6605294">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605373">longName</span>&nbsp;<span class="op" id="6605382">:=</span>&nbsp;<span class="string" id="6605385">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605644">hdr</span><span class="op" id="6605647">.</span><span class="ident" id="6605648">Name</span>&nbsp;<span class="op" id="6605653">=</span>&nbsp;<span class="ident" id="6605655">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605666">hdr</span><span class="op" id="6605669">.</span><span class="ident" id="6605670">Size</span>&nbsp;<span class="op" id="6605675">=</span>&nbsp;<span class="num" id="6605677">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605680">var</span>&nbsp;<span class="ident" id="6605684">buf</span>&nbsp;<span class="ident" id="6605688">bytes</span><span class="op" id="6605693">.</span><span class="ident" id="6605694">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605702">writer</span>&nbsp;<span class="op" id="6605709">:=</span>&nbsp;<span class="ident" id="6605712">NewWriter</span><span class="op" id="6605721">(</span><span class="op" id="6605722">&amp;</span><span class="ident" id="6605723">buf</span><span class="op" id="6605726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605729">if</span>&nbsp;<span class="ident" id="6605732">err</span>&nbsp;<span class="op" id="6605736">:=</span>&nbsp;<span class="ident" id="6605739">writer</span><span class="op" id="6605745">.</span><span class="ident" id="6605746">WriteHeader</span><span class="op" id="6605757">(</span><span class="ident" id="6605758">hdr</span><span class="op" id="6605761">)</span><span class="op" id="6605762">;</span>&nbsp;<span class="ident" id="6605764">err</span>&nbsp;<span class="op" id="6605768">!=</span>&nbsp;<span class="ident" id="6605771">nil</span>&nbsp;<span class="op" id="6605775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605779">t</span><span class="op" id="6605780">.</span><span class="ident" id="6605781">Fatal</span><span class="op" id="6605786">(</span><span class="ident" id="6605787">err</span><span class="op" id="6605790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605796">if</span>&nbsp;<span class="ident" id="6605799">err</span>&nbsp;<span class="op" id="6605803">:=</span>&nbsp;<span class="ident" id="6605806">writer</span><span class="op" id="6605812">.</span><span class="ident" id="6605813">Close</span><span class="op" id="6605818">(</span><span class="op" id="6605819">)</span><span class="op" id="6605820">;</span>&nbsp;<span class="ident" id="6605822">err</span>&nbsp;<span class="op" id="6605826">!=</span>&nbsp;<span class="ident" id="6605829">nil</span>&nbsp;<span class="op" id="6605833">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605837">t</span><span class="op" id="6605838">.</span><span class="ident" id="6605839">Fatal</span><span class="op" id="6605844">(</span><span class="ident" id="6605845">err</span><span class="op" id="6605848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6605851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6605854">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605916">reader</span>&nbsp;<span class="op" id="6605923">:=</span>&nbsp;<span class="ident" id="6605926">NewReader</span><span class="op" id="6605935">(</span><span class="op" id="6605936">&amp;</span><span class="ident" id="6605937">buf</span><span class="op" id="6605940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605943">hdr</span><span class="op" id="6605946">,</span>&nbsp;<span class="ident" id="6605948">err</span>&nbsp;<span class="op" id="6605952">=</span>&nbsp;<span class="ident" id="6605954">reader</span><span class="op" id="6605960">.</span><span class="ident" id="6605961">Next</span><span class="op" id="6605965">(</span><span class="op" id="6605966">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6605969">if</span>&nbsp;<span class="ident" id="6605972">err</span>&nbsp;<span class="op" id="6605976">!=</span>&nbsp;<span class="ident" id="6605979">nil</span>&nbsp;<span class="op" id="6605983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6605987">t</span><span class="op" id="6605988">.</span><span class="ident" id="6605989">Fatal</span><span class="op" id="6605994">(</span><span class="ident" id="6605995">err</span><span class="op" id="6605998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606004">if</span>&nbsp;<span class="ident" id="6606007">hdr</span><span class="op" id="6606010">.</span><span class="ident" id="6606011">Name</span>&nbsp;<span class="op" id="6606016">!=</span>&nbsp;<span class="ident" id="6606019">longName</span>&nbsp;<span class="op" id="6606028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606032">t</span><span class="op" id="6606033">.</span><span class="ident" id="6606034">Fatal</span><span class="op" id="6606039">(</span><span class="string" id="6606040">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="6606068">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606071">}</span><br>
<span class="lineno"></span><span class="op" id="6606073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6606076">func</span>&nbsp;<span class="ident" id="6606081">TestValidTypeflagWithPAXHeader</span><span class="op" id="6606111">(</span><span class="ident" id="6606112">t</span>&nbsp;<span class="op" id="6606114">*</span><span class="ident" id="6606115">testing</span><span class="op" id="6606122">.</span><span class="ident" id="6606123">T</span><span class="op" id="6606124">)</span>&nbsp;<span class="op" id="6606126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606129">var</span>&nbsp;<span class="ident" id="6606133">buffer</span>&nbsp;<span class="ident" id="6606140">bytes</span><span class="op" id="6606145">.</span><span class="ident" id="6606146">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606154">tw</span>&nbsp;<span class="op" id="6606157">:=</span>&nbsp;<span class="ident" id="6606160">NewWriter</span><span class="op" id="6606169">(</span><span class="op" id="6606170">&amp;</span><span class="ident" id="6606171">buffer</span><span class="op" id="6606177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606181">fileName</span>&nbsp;<span class="op" id="6606190">:=</span>&nbsp;<span class="ident" id="6606193">strings</span><span class="op" id="6606200">.</span><span class="ident" id="6606201">Repeat</span><span class="op" id="6606207">(</span><span class="string" id="6606208">&#34;ab&#34;</span><span class="op" id="6606212">,</span>&nbsp;<span class="num" id="6606214">100</span><span class="op" id="6606217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606221">hdr</span>&nbsp;<span class="op" id="6606225">:=</span>&nbsp;<span class="op" id="6606228">&amp;</span><span class="ident" id="6606229">Header</span><span class="op" id="6606235">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606239">Name</span><span class="op" id="6606243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6606249">fileName</span><span class="op" id="6606257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606261">Size</span><span class="op" id="6606265">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6606271">4</span><span class="op" id="6606272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606276">Typeflag</span><span class="op" id="6606284">:</span>&nbsp;<span class="num" id="6606286">0</span><span class="op" id="6606287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606293">if</span>&nbsp;<span class="ident" id="6606296">err</span>&nbsp;<span class="op" id="6606300">:=</span>&nbsp;<span class="ident" id="6606303">tw</span><span class="op" id="6606305">.</span><span class="ident" id="6606306">WriteHeader</span><span class="op" id="6606317">(</span><span class="ident" id="6606318">hdr</span><span class="op" id="6606321">)</span><span class="op" id="6606322">;</span>&nbsp;<span class="ident" id="6606324">err</span>&nbsp;<span class="op" id="6606328">!=</span>&nbsp;<span class="ident" id="6606331">nil</span>&nbsp;<span class="op" id="6606335">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606339">t</span><span class="op" id="6606340">.</span><span class="ident" id="6606341">Fatalf</span><span class="op" id="6606347">(</span><span class="string" id="6606348">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6606376">,</span>&nbsp;<span class="ident" id="6606378">err</span><span class="op" id="6606381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606387">if</span>&nbsp;<span class="ident" id="6606390">_</span><span class="op" id="6606391">,</span>&nbsp;<span class="ident" id="6606393">err</span>&nbsp;<span class="op" id="6606397">:=</span>&nbsp;<span class="ident" id="6606400">tw</span><span class="op" id="6606402">.</span><span class="ident" id="6606403">Write</span><span class="op" id="6606408">(</span><span class="op" id="6606409">[</span><span class="op" id="6606410">]</span><span class="builtintype" id="6606411">byte</span><span class="op" id="6606415">(</span><span class="string" id="6606416">&#34;fooo&#34;</span><span class="op" id="6606422">)</span><span class="op" id="6606423">)</span><span class="op" id="6606424">;</span>&nbsp;<span class="ident" id="6606426">err</span>&nbsp;<span class="op" id="6606430">!=</span>&nbsp;<span class="ident" id="6606433">nil</span>&nbsp;<span class="op" id="6606437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606441">t</span><span class="op" id="6606442">.</span><span class="ident" id="6606443">Fatalf</span><span class="op" id="6606449">(</span><span class="string" id="6606450">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="6606487">,</span>&nbsp;<span class="ident" id="6606489">err</span><span class="op" id="6606492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606495">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606498">tw</span><span class="op" id="6606500">.</span><span class="ident" id="6606501">Close</span><span class="op" id="6606506">(</span><span class="op" id="6606507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606511">tr</span>&nbsp;<span class="op" id="6606514">:=</span>&nbsp;<span class="ident" id="6606517">NewReader</span><span class="op" id="6606526">(</span><span class="op" id="6606527">&amp;</span><span class="ident" id="6606528">buffer</span><span class="op" id="6606534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606538">for</span>&nbsp;<span class="op" id="6606542">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606546">header</span><span class="op" id="6606552">,</span>&nbsp;<span class="ident" id="6606554">err</span>&nbsp;<span class="op" id="6606558">:=</span>&nbsp;<span class="ident" id="6606561">tr</span><span class="op" id="6606563">.</span><span class="ident" id="6606564">Next</span><span class="op" id="6606568">(</span><span class="op" id="6606569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606573">if</span>&nbsp;<span class="ident" id="6606576">err</span>&nbsp;<span class="op" id="6606580">==</span>&nbsp;<span class="ident" id="6606583">io</span><span class="op" id="6606585">.</span><span class="ident" id="6606586">EOF</span>&nbsp;<span class="op" id="6606590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606595">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606607">if</span>&nbsp;<span class="ident" id="6606610">err</span>&nbsp;<span class="op" id="6606614">!=</span>&nbsp;<span class="ident" id="6606617">nil</span>&nbsp;<span class="op" id="6606621">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606626">t</span><span class="op" id="6606627">.</span><span class="ident" id="6606628">Fatalf</span><span class="op" id="6606634">(</span><span class="string" id="6606635">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="6606662">,</span>&nbsp;<span class="ident" id="6606664">err</span><span class="op" id="6606667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6606675">if</span>&nbsp;<span class="ident" id="6606678">header</span><span class="op" id="6606684">.</span><span class="ident" id="6606685">Typeflag</span>&nbsp;<span class="op" id="6606694">!=</span>&nbsp;<span class="num" id="6606697">0</span>&nbsp;<span class="op" id="6606699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6606704">t</span><span class="op" id="6606705">.</span><span class="ident" id="6606706">Fatalf</span><span class="op" id="6606712">(</span><span class="string" id="6606713">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="6606750">,</span>&nbsp;<span class="ident" id="6606752">header</span><span class="op" id="6606758">.</span><span class="ident" id="6606759">Typeflag</span><span class="op" id="6606767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606771">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6606774">}</span><br>
<span class="lineno"></span><span class="op" id="6606776">}</span>
</div>
</body>
</html>
