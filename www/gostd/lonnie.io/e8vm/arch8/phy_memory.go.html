<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4801329">package</span>&nbsp;<span class="ident" id="4801337">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801344">//&nbsp;PhyMemory&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;contiguous&nbsp;pages.</span><br>
<span class="lineno"></span><span class="keyword" id="4801394">type</span>&nbsp;<span class="ident" id="4801399">phyMemory</span>&nbsp;<span class="keyword" id="4801409">struct</span>&nbsp;<span class="op" id="4801416">{</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801419">npage</span>&nbsp;<span class="builtintype" id="4801425">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801433">pages</span>&nbsp;<span class="keyword" id="4801439">map</span><span class="op" id="4801442">[</span><span class="builtintype" id="4801443">uint32</span><span class="op" id="4801449">]</span><span class="op" id="4801450">*</span><span class="ident" id="4801451">page</span><br>
<span class="lineno"></span><span class="op" id="4801456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4801459">const</span>&nbsp;<span class="op" id="4801465">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801468">pageVoid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4801482">=</span>&nbsp;<span class="num" id="4801484">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801487">pageInterrupt</span>&nbsp;<span class="op" id="4801501">=</span>&nbsp;<span class="num" id="4801503">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801506">pageBasicIO</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4801520">=</span>&nbsp;<span class="num" id="4801522">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801526">pageBootImage</span>&nbsp;<span class="op" id="4801540">=</span>&nbsp;<span class="num" id="4801542">8</span><br>
<span class="lineno">15</span><span class="op" id="4801544">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4801547">//&nbsp;NewPhyMemory&nbsp;creates&nbsp;a&nbsp;physical&nbsp;memory&nbsp;of&nbsp;size&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4801604">func</span>&nbsp;<span class="ident" id="4801609">newPhyMemory</span><span class="op" id="4801621">(</span><span class="ident" id="4801622">size</span>&nbsp;<span class="builtintype" id="4801627">uint32</span><span class="op" id="4801633">)</span>&nbsp;<span class="op" id="4801635">*</span><span class="ident" id="4801636">phyMemory</span>&nbsp;<span class="op" id="4801646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801649">if</span>&nbsp;<span class="ident" id="4801652">size</span><span class="op" id="4801656">%</span><span class="ident" id="4801657">PageSize</span>&nbsp;<span class="op" id="4801666">!=</span>&nbsp;<span class="num" id="4801669">0</span>&nbsp;<span class="op" id="4801671">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4801675">panic</span><span class="op" id="4801680">(</span><span class="string" id="4801681">&#34;size&nbsp;misaligned&#34;</span><span class="op" id="4801698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801705">ret</span>&nbsp;<span class="op" id="4801709">:=</span>&nbsp;<span class="builtinfunc" id="4801712">new</span><span class="op" id="4801715">(</span><span class="ident" id="4801716">phyMemory</span><span class="op" id="4801725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801728">ret</span><span class="op" id="4801731">.</span><span class="ident" id="4801732">pages</span>&nbsp;<span class="op" id="4801738">=</span>&nbsp;<span class="builtinfunc" id="4801740">make</span><span class="op" id="4801744">(</span><span class="keyword" id="4801745">map</span><span class="op" id="4801748">[</span><span class="builtintype" id="4801749">uint32</span><span class="op" id="4801755">]</span><span class="op" id="4801756">*</span><span class="ident" id="4801757">page</span><span class="op" id="4801761">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801764">ret</span><span class="op" id="4801767">.</span><span class="ident" id="4801768">npage</span>&nbsp;<span class="op" id="4801774">=</span>&nbsp;<span class="ident" id="4801776">size</span>&nbsp;<span class="op" id="4801781">/</span>&nbsp;<span class="ident" id="4801783">PageSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801794">return</span>&nbsp;<span class="ident" id="4801801">ret</span><br>
<span class="lineno"></span><span class="op" id="4801805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4801808">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;physical&nbsp;memory.</span><br>
<span class="lineno"></span><span class="keyword" id="4801857">func</span>&nbsp;<span class="op" id="4801862">(</span><span class="ident" id="4801863">pm</span>&nbsp;<span class="op" id="4801866">*</span><span class="ident" id="4801867">phyMemory</span><span class="op" id="4801876">)</span>&nbsp;<span class="ident" id="4801878">Size</span><span class="op" id="4801882">(</span><span class="op" id="4801883">)</span>&nbsp;<span class="builtintype" id="4801885">uint32</span>&nbsp;<span class="op" id="4801892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801895">return</span>&nbsp;<span class="ident" id="4801902">pm</span><span class="op" id="4801904">.</span><span class="ident" id="4801905">npage</span>&nbsp;<span class="op" id="4801911">*</span>&nbsp;<span class="ident" id="4801913">PageSize</span><br>
<span class="lineno"></span><span class="op" id="4801922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4801925">//&nbsp;Page&nbsp;returns&nbsp;the&nbsp;page&nbsp;for&nbsp;the&nbsp;particular&nbsp;page&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="4801981">//&nbsp;Returns&nbsp;nil&nbsp;when&nbsp;the&nbsp;page&nbsp;number&nbsp;is&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno"></span><span class="keyword" id="4802033">func</span>&nbsp;<span class="op" id="4802038">(</span><span class="ident" id="4802039">pm</span>&nbsp;<span class="op" id="4802042">*</span><span class="ident" id="4802043">phyMemory</span><span class="op" id="4802052">)</span>&nbsp;<span class="ident" id="4802054">Page</span><span class="op" id="4802058">(</span><span class="ident" id="4802059">pn</span>&nbsp;<span class="builtintype" id="4802062">uint32</span><span class="op" id="4802068">)</span>&nbsp;<span class="op" id="4802070">*</span><span class="ident" id="4802071">page</span>&nbsp;<span class="op" id="4802076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802079">if</span>&nbsp;<span class="ident" id="4802082">pn</span>&nbsp;<span class="op" id="4802085">&gt;=</span>&nbsp;<span class="ident" id="4802088">pm</span><span class="op" id="4802090">.</span><span class="ident" id="4802091">npage</span>&nbsp;<span class="op" id="4802097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802101">return</span>&nbsp;<span class="ident" id="4802108">nil</span>&nbsp;<span class="comment" id="4802112">//&nbsp;out&nbsp;of&nbsp;range</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802133">ret</span><span class="op" id="4802136">,</span>&nbsp;<span class="ident" id="4802138">found</span>&nbsp;<span class="op" id="4802144">:=</span>&nbsp;<span class="ident" id="4802147">pm</span><span class="op" id="4802149">.</span><span class="ident" id="4802150">pages</span><span class="op" id="4802155">[</span><span class="ident" id="4802156">pn</span><span class="op" id="4802158">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802161">if</span>&nbsp;<span class="op" id="4802164">!</span><span class="ident" id="4802165">found</span>&nbsp;<span class="op" id="4802171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4802175">//&nbsp;create&nbsp;an&nbsp;empty&nbsp;page&nbsp;on&nbsp;demand</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802211">ret</span>&nbsp;<span class="op" id="4802215">=</span>&nbsp;<span class="ident" id="4802217">newPage</span><span class="op" id="4802224">(</span><span class="op" id="4802225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802229">pm</span><span class="op" id="4802231">.</span><span class="ident" id="4802232">pages</span><span class="op" id="4802237">[</span><span class="ident" id="4802238">pn</span><span class="op" id="4802240">]</span>&nbsp;<span class="op" id="4802242">=</span>&nbsp;<span class="ident" id="4802244">ret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802253">return</span>&nbsp;<span class="ident" id="4802260">ret</span><br>
<span class="lineno">50</span><span class="op" id="4802264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4802267">func</span>&nbsp;<span class="op" id="4802272">(</span><span class="ident" id="4802273">pm</span>&nbsp;<span class="op" id="4802276">*</span><span class="ident" id="4802277">phyMemory</span><span class="op" id="4802286">)</span>&nbsp;<span class="ident" id="4802288">pageForByte</span><span class="op" id="4802299">(</span><span class="ident" id="4802300">addr</span>&nbsp;<span class="builtintype" id="4802305">uint32</span><span class="op" id="4802311">)</span>&nbsp;<span class="op" id="4802313">(</span><span class="op" id="4802314">*</span><span class="ident" id="4802315">page</span><span class="op" id="4802319">,</span>&nbsp;<span class="op" id="4802321">*</span><span class="ident" id="4802322">Excep</span><span class="op" id="4802327">)</span>&nbsp;<span class="op" id="4802329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802332">p</span>&nbsp;<span class="op" id="4802334">:=</span>&nbsp;<span class="ident" id="4802337">pm</span><span class="op" id="4802339">.</span><span class="ident" id="4802340">Page</span><span class="op" id="4802344">(</span><span class="ident" id="4802345">addr</span>&nbsp;<span class="op" id="4802350">/</span>&nbsp;<span class="ident" id="4802352">PageSize</span><span class="op" id="4802360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802363">if</span>&nbsp;<span class="ident" id="4802366">p</span>&nbsp;<span class="op" id="4802368">==</span>&nbsp;<span class="ident" id="4802371">nil</span>&nbsp;<span class="op" id="4802375">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802379">return</span>&nbsp;<span class="ident" id="4802386">nil</span><span class="op" id="4802389">,</span>&nbsp;<span class="ident" id="4802391">errOutOfRange</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802409">return</span>&nbsp;<span class="ident" id="4802416">p</span><span class="op" id="4802417">,</span>&nbsp;<span class="ident" id="4802419">nil</span><br>
<span class="lineno"></span><span class="op" id="4802423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4802426">func</span>&nbsp;<span class="op" id="4802431">(</span><span class="ident" id="4802432">pm</span>&nbsp;<span class="op" id="4802435">*</span><span class="ident" id="4802436">phyMemory</span><span class="op" id="4802445">)</span>&nbsp;<span class="ident" id="4802447">pageForWord</span><span class="op" id="4802458">(</span><span class="ident" id="4802459">addr</span>&nbsp;<span class="builtintype" id="4802464">uint32</span><span class="op" id="4802470">)</span>&nbsp;<span class="op" id="4802472">(</span><span class="op" id="4802473">*</span><span class="ident" id="4802474">page</span><span class="op" id="4802478">,</span>&nbsp;<span class="op" id="4802480">*</span><span class="ident" id="4802481">Excep</span><span class="op" id="4802486">)</span>&nbsp;<span class="op" id="4802488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802491">if</span>&nbsp;<span class="ident" id="4802494">addr</span><span class="op" id="4802498">%</span><span class="num" id="4802499">4</span>&nbsp;<span class="op" id="4802501">!=</span>&nbsp;<span class="num" id="4802504">0</span>&nbsp;<span class="op" id="4802506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802510">return</span>&nbsp;<span class="ident" id="4802517">nil</span><span class="op" id="4802520">,</span>&nbsp;<span class="ident" id="4802522">errMisalign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802538">return</span>&nbsp;<span class="ident" id="4802545">pm</span><span class="op" id="4802547">.</span><span class="ident" id="4802548">pageForByte</span><span class="op" id="4802559">(</span><span class="ident" id="4802560">addr</span><span class="op" id="4802564">)</span><br>
<span class="lineno">65</span><span class="op" id="4802566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802569">//&nbsp;ReadByte&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4802618">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4802674">func</span>&nbsp;<span class="op" id="4802679">(</span><span class="ident" id="4802680">pm</span>&nbsp;<span class="op" id="4802683">*</span><span class="ident" id="4802684">phyMemory</span><span class="op" id="4802693">)</span>&nbsp;<span class="ident" id="4802695">ReadByte</span><span class="op" id="4802703">(</span><span class="ident" id="4802704">addr</span>&nbsp;<span class="builtintype" id="4802709">uint32</span><span class="op" id="4802715">)</span>&nbsp;<span class="op" id="4802717">(</span><span class="builtintype" id="4802718">byte</span><span class="op" id="4802722">,</span>&nbsp;<span class="op" id="4802724">*</span><span class="ident" id="4802725">Excep</span><span class="op" id="4802730">)</span>&nbsp;<span class="op" id="4802732">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802735">p</span><span class="op" id="4802736">,</span>&nbsp;<span class="ident" id="4802738">e</span>&nbsp;<span class="op" id="4802740">:=</span>&nbsp;<span class="ident" id="4802743">pm</span><span class="op" id="4802745">.</span><span class="ident" id="4802746">pageForByte</span><span class="op" id="4802757">(</span><span class="ident" id="4802758">addr</span><span class="op" id="4802762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802765">if</span>&nbsp;<span class="ident" id="4802768">e</span>&nbsp;<span class="op" id="4802770">!=</span>&nbsp;<span class="ident" id="4802773">nil</span>&nbsp;<span class="op" id="4802777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802781">return</span>&nbsp;<span class="num" id="4802788">0</span><span class="op" id="4802789">,</span>&nbsp;<span class="ident" id="4802791">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802797">return</span>&nbsp;<span class="ident" id="4802804">p</span><span class="op" id="4802805">.</span><span class="ident" id="4802806">ReadByte</span><span class="op" id="4802814">(</span><span class="ident" id="4802815">addr</span><span class="op" id="4802819">)</span><span class="op" id="4802820">,</span>&nbsp;<span class="ident" id="4802822">nil</span><br>
<span class="lineno">75</span><span class="op" id="4802826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802829">//&nbsp;WriteByte&nbsp;writes&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4802880">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4802936">func</span>&nbsp;<span class="op" id="4802941">(</span><span class="ident" id="4802942">pm</span>&nbsp;<span class="op" id="4802945">*</span><span class="ident" id="4802946">phyMemory</span><span class="op" id="4802955">)</span>&nbsp;<span class="ident" id="4802957">WriteByte</span><span class="op" id="4802966">(</span><span class="ident" id="4802967">addr</span>&nbsp;<span class="builtintype" id="4802972">uint32</span><span class="op" id="4802978">,</span>&nbsp;<span class="ident" id="4802980">v</span>&nbsp;<span class="builtintype" id="4802982">byte</span><span class="op" id="4802986">)</span>&nbsp;<span class="op" id="4802988">*</span><span class="ident" id="4802989">Excep</span>&nbsp;<span class="op" id="4802995">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802998">p</span><span class="op" id="4802999">,</span>&nbsp;<span class="ident" id="4803001">e</span>&nbsp;<span class="op" id="4803003">:=</span>&nbsp;<span class="ident" id="4803006">pm</span><span class="op" id="4803008">.</span><span class="ident" id="4803009">pageForByte</span><span class="op" id="4803020">(</span><span class="ident" id="4803021">addr</span><span class="op" id="4803025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803028">if</span>&nbsp;<span class="ident" id="4803031">e</span>&nbsp;<span class="op" id="4803033">!=</span>&nbsp;<span class="ident" id="4803036">nil</span>&nbsp;<span class="op" id="4803040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803044">return</span>&nbsp;<span class="ident" id="4803051">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803057">p</span><span class="op" id="4803058">.</span><span class="ident" id="4803059">WriteByte</span><span class="op" id="4803068">(</span><span class="ident" id="4803069">addr</span><span class="op" id="4803073">,</span>&nbsp;<span class="ident" id="4803075">v</span><span class="op" id="4803076">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803079">return</span>&nbsp;<span class="ident" id="4803086">e</span><br>
<span class="lineno"></span><span class="op" id="4803088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4803091">//&nbsp;ReadWord&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4803140">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">90</span><span class="keyword" id="4803218">func</span>&nbsp;<span class="op" id="4803223">(</span><span class="ident" id="4803224">pm</span>&nbsp;<span class="op" id="4803227">*</span><span class="ident" id="4803228">phyMemory</span><span class="op" id="4803237">)</span>&nbsp;<span class="ident" id="4803239">ReadWord</span><span class="op" id="4803247">(</span><span class="ident" id="4803248">addr</span>&nbsp;<span class="builtintype" id="4803253">uint32</span><span class="op" id="4803259">)</span>&nbsp;<span class="op" id="4803261">(</span><span class="builtintype" id="4803262">uint32</span><span class="op" id="4803268">,</span>&nbsp;<span class="op" id="4803270">*</span><span class="ident" id="4803271">Excep</span><span class="op" id="4803276">)</span>&nbsp;<span class="op" id="4803278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803281">p</span><span class="op" id="4803282">,</span>&nbsp;<span class="ident" id="4803284">e</span>&nbsp;<span class="op" id="4803286">:=</span>&nbsp;<span class="ident" id="4803289">pm</span><span class="op" id="4803291">.</span><span class="ident" id="4803292">pageForWord</span><span class="op" id="4803303">(</span><span class="ident" id="4803304">addr</span><span class="op" id="4803308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803311">if</span>&nbsp;<span class="ident" id="4803314">e</span>&nbsp;<span class="op" id="4803316">!=</span>&nbsp;<span class="ident" id="4803319">nil</span>&nbsp;<span class="op" id="4803323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803327">return</span>&nbsp;<span class="num" id="4803334">0</span><span class="op" id="4803335">,</span>&nbsp;<span class="ident" id="4803337">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803340">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803343">return</span>&nbsp;<span class="ident" id="4803350">p</span><span class="op" id="4803351">.</span><span class="ident" id="4803352">ReadWord</span><span class="op" id="4803360">(</span><span class="ident" id="4803361">addr</span><span class="op" id="4803365">)</span><span class="op" id="4803366">,</span>&nbsp;<span class="ident" id="4803368">nil</span><br>
<span class="lineno"></span><span class="op" id="4803372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4803375">//&nbsp;WriteWord&nbsp;reads&nbsp;the&nbsp;byte&nbsp;at&nbsp;the&nbsp;given&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="4803425">//&nbsp;If&nbsp;the&nbsp;address&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;not&nbsp;4-byte&nbsp;aligned,&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">100</span><span class="keyword" id="4803503">func</span>&nbsp;<span class="op" id="4803508">(</span><span class="ident" id="4803509">pm</span>&nbsp;<span class="op" id="4803512">*</span><span class="ident" id="4803513">phyMemory</span><span class="op" id="4803522">)</span>&nbsp;<span class="ident" id="4803524">WriteWord</span><span class="op" id="4803533">(</span><span class="ident" id="4803534">addr</span>&nbsp;<span class="builtintype" id="4803539">uint32</span><span class="op" id="4803545">,</span>&nbsp;<span class="ident" id="4803547">v</span>&nbsp;<span class="builtintype" id="4803549">uint32</span><span class="op" id="4803555">)</span>&nbsp;<span class="op" id="4803557">*</span><span class="ident" id="4803558">Excep</span>&nbsp;<span class="op" id="4803564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803567">p</span><span class="op" id="4803568">,</span>&nbsp;<span class="ident" id="4803570">e</span>&nbsp;<span class="op" id="4803572">:=</span>&nbsp;<span class="ident" id="4803575">pm</span><span class="op" id="4803577">.</span><span class="ident" id="4803578">pageForWord</span><span class="op" id="4803589">(</span><span class="ident" id="4803590">addr</span><span class="op" id="4803594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803597">if</span>&nbsp;<span class="ident" id="4803600">e</span>&nbsp;<span class="op" id="4803602">!=</span>&nbsp;<span class="ident" id="4803605">nil</span>&nbsp;<span class="op" id="4803609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803613">return</span>&nbsp;<span class="ident" id="4803620">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4803623">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4803626">p</span><span class="op" id="4803627">.</span><span class="ident" id="4803628">WriteWord</span><span class="op" id="4803637">(</span><span class="ident" id="4803638">addr</span><span class="op" id="4803642">,</span>&nbsp;<span class="ident" id="4803644">v</span><span class="op" id="4803645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4803648">return</span>&nbsp;<span class="ident" id="4803655">nil</span><br>
<span class="lineno"></span><span class="op" id="4803659">}</span>
</div>
</body>
</html>
