<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6764045">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6764100">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6764154">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6764205">package</span>&nbsp;<span class="ident" id="6764213">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764224">import</span>&nbsp;<span class="op" id="6764231">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764234">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764243">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764260">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764267">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764273">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764286">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764303">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764309">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764320">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6764331">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6764341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6764344">func</span>&nbsp;<span class="ident" id="6764349">TestBoundaryLine</span><span class="op" id="6764365">(</span><span class="ident" id="6764366">t</span>&nbsp;<span class="op" id="6764368">*</span><span class="ident" id="6764369">testing</span><span class="op" id="6764376">.</span><span class="ident" id="6764377">T</span><span class="op" id="6764378">)</span>&nbsp;<span class="op" id="6764380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764383">mr</span>&nbsp;<span class="op" id="6764386">:=</span>&nbsp;<span class="ident" id="6764389">NewReader</span><span class="op" id="6764398">(</span><span class="ident" id="6764399">strings</span><span class="op" id="6764406">.</span><span class="ident" id="6764407">NewReader</span><span class="op" id="6764416">(</span><span class="string" id="6764417">&#34;&#34;</span><span class="op" id="6764419">)</span><span class="op" id="6764420">,</span>&nbsp;<span class="string" id="6764422">&#34;myBoundary&#34;</span><span class="op" id="6764434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764437">if</span>&nbsp;<span class="op" id="6764440">!</span><span class="ident" id="6764441">mr</span><span class="op" id="6764443">.</span><span class="ident" id="6764444">isBoundaryDelimiterLine</span><span class="op" id="6764467">(</span><span class="op" id="6764468">[</span><span class="op" id="6764469">]</span><span class="builtintype" id="6764470">byte</span><span class="op" id="6764474">(</span><span class="string" id="6764475">&#34;--myBoundary\r\n&#34;</span><span class="op" id="6764493">)</span><span class="op" id="6764494">)</span>&nbsp;<span class="op" id="6764496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764500">t</span><span class="op" id="6764501">.</span><span class="ident" id="6764502">Error</span><span class="op" id="6764507">(</span><span class="string" id="6764508">&#34;expected&#34;</span><span class="op" id="6764518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764521">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764524">if</span>&nbsp;<span class="op" id="6764527">!</span><span class="ident" id="6764528">mr</span><span class="op" id="6764530">.</span><span class="ident" id="6764531">isBoundaryDelimiterLine</span><span class="op" id="6764554">(</span><span class="op" id="6764555">[</span><span class="op" id="6764556">]</span><span class="builtintype" id="6764557">byte</span><span class="op" id="6764561">(</span><span class="string" id="6764562">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="6764581">)</span><span class="op" id="6764582">)</span>&nbsp;<span class="op" id="6764584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764588">t</span><span class="op" id="6764589">.</span><span class="ident" id="6764590">Error</span><span class="op" id="6764595">(</span><span class="string" id="6764596">&#34;expected&#34;</span><span class="op" id="6764606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764612">if</span>&nbsp;<span class="op" id="6764615">!</span><span class="ident" id="6764616">mr</span><span class="op" id="6764618">.</span><span class="ident" id="6764619">isBoundaryDelimiterLine</span><span class="op" id="6764642">(</span><span class="op" id="6764643">[</span><span class="op" id="6764644">]</span><span class="builtintype" id="6764645">byte</span><span class="op" id="6764649">(</span><span class="string" id="6764650">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="6764667">)</span><span class="op" id="6764668">)</span>&nbsp;<span class="op" id="6764670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764674">t</span><span class="op" id="6764675">.</span><span class="ident" id="6764676">Error</span><span class="op" id="6764681">(</span><span class="string" id="6764682">&#34;expected&#34;</span><span class="op" id="6764692">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764698">if</span>&nbsp;<span class="ident" id="6764701">mr</span><span class="op" id="6764703">.</span><span class="ident" id="6764704">isBoundaryDelimiterLine</span><span class="op" id="6764727">(</span><span class="op" id="6764728">[</span><span class="op" id="6764729">]</span><span class="builtintype" id="6764730">byte</span><span class="op" id="6764734">(</span><span class="string" id="6764735">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="6764758">)</span><span class="op" id="6764759">)</span>&nbsp;<span class="op" id="6764761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764765">t</span><span class="op" id="6764766">.</span><span class="ident" id="6764767">Error</span><span class="op" id="6764772">(</span><span class="string" id="6764773">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6764788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764794">if</span>&nbsp;<span class="ident" id="6764797">mr</span><span class="op" id="6764799">.</span><span class="ident" id="6764800">isBoundaryDelimiterLine</span><span class="op" id="6764823">(</span><span class="op" id="6764824">[</span><span class="op" id="6764825">]</span><span class="builtintype" id="6764826">byte</span><span class="op" id="6764830">(</span><span class="string" id="6764831">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="6764853">)</span><span class="op" id="6764854">)</span>&nbsp;<span class="op" id="6764856">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764860">t</span><span class="op" id="6764861">.</span><span class="ident" id="6764862">Error</span><span class="op" id="6764867">(</span><span class="string" id="6764868">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6764883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6764886">}</span><br>
<span class="lineno"></span><span class="op" id="6764888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764891">func</span>&nbsp;<span class="ident" id="6764896">escapeString</span><span class="op" id="6764908">(</span><span class="ident" id="6764909">v</span>&nbsp;<span class="builtintype" id="6764911">string</span><span class="op" id="6764917">)</span>&nbsp;<span class="builtintype" id="6764919">string</span>&nbsp;<span class="op" id="6764926">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6764929">bytes</span><span class="op" id="6764934">,</span>&nbsp;<span class="ident" id="6764936">_</span>&nbsp;<span class="op" id="6764938">:=</span>&nbsp;<span class="ident" id="6764941">json</span><span class="op" id="6764945">.</span><span class="ident" id="6764946">Marshal</span><span class="op" id="6764953">(</span><span class="ident" id="6764954">v</span><span class="op" id="6764955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6764958">return</span>&nbsp;<span class="builtintype" id="6764965">string</span><span class="op" id="6764971">(</span><span class="ident" id="6764972">bytes</span><span class="op" id="6764977">)</span><br>
<span class="lineno"></span><span class="op" id="6764979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6764982">func</span>&nbsp;<span class="ident" id="6764987">expectEq</span><span class="op" id="6764995">(</span><span class="ident" id="6764996">t</span>&nbsp;<span class="op" id="6764998">*</span><span class="ident" id="6764999">testing</span><span class="op" id="6765006">.</span><span class="ident" id="6765007">T</span><span class="op" id="6765008">,</span>&nbsp;<span class="ident" id="6765010">expected</span><span class="op" id="6765018">,</span>&nbsp;<span class="ident" id="6765020">actual</span><span class="op" id="6765026">,</span>&nbsp;<span class="ident" id="6765028">what</span>&nbsp;<span class="builtintype" id="6765033">string</span><span class="op" id="6765039">)</span>&nbsp;<span class="op" id="6765041">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765044">if</span>&nbsp;<span class="ident" id="6765047">expected</span>&nbsp;<span class="op" id="6765056">==</span>&nbsp;<span class="ident" id="6765059">actual</span>&nbsp;<span class="op" id="6765066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765070">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765081">t</span><span class="op" id="6765082">.</span><span class="ident" id="6765083">Errorf</span><span class="op" id="6765089">(</span><span class="string" id="6765090">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="6765158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765162">what</span><span class="op" id="6765166">,</span>&nbsp;<span class="ident" id="6765168">escapeString</span><span class="op" id="6765180">(</span><span class="ident" id="6765181">actual</span><span class="op" id="6765187">)</span><span class="op" id="6765188">,</span>&nbsp;<span class="builtinfunc" id="6765190">len</span><span class="op" id="6765193">(</span><span class="ident" id="6765194">actual</span><span class="op" id="6765200">)</span><span class="op" id="6765201">,</span>&nbsp;<span class="ident" id="6765203">escapeString</span><span class="op" id="6765215">(</span><span class="ident" id="6765216">expected</span><span class="op" id="6765224">)</span><span class="op" id="6765225">,</span>&nbsp;<span class="builtinfunc" id="6765227">len</span><span class="op" id="6765230">(</span><span class="ident" id="6765231">expected</span><span class="op" id="6765239">)</span><span class="op" id="6765240">)</span><br>
<span class="lineno">50</span><span class="op" id="6765242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6765245">func</span>&nbsp;<span class="ident" id="6765250">TestNameAccessors</span><span class="op" id="6765267">(</span><span class="ident" id="6765268">t</span>&nbsp;<span class="op" id="6765270">*</span><span class="ident" id="6765271">testing</span><span class="op" id="6765278">.</span><span class="ident" id="6765279">T</span><span class="op" id="6765280">)</span>&nbsp;<span class="op" id="6765282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765285">tests</span>&nbsp;<span class="op" id="6765291">:=</span>&nbsp;<span class="op" id="6765294">[</span><span class="op" id="6765295">...</span><span class="op" id="6765298">]</span><span class="op" id="6765299">[</span><span class="num" id="6765300">3</span><span class="op" id="6765301">]</span><span class="builtintype" id="6765302">string</span><span class="op" id="6765308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765312">{</span><span class="string" id="6765313">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6765336">,</span>&nbsp;<span class="string" id="6765338">&#34;foo&#34;</span><span class="op" id="6765343">,</span>&nbsp;<span class="string" id="6765345">&#34;&#34;</span><span class="op" id="6765347">}</span><span class="op" id="6765348">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765352">{</span><span class="string" id="6765353">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="6765376">,</span>&nbsp;<span class="string" id="6765378">&#34;foo&#34;</span><span class="op" id="6765383">,</span>&nbsp;<span class="string" id="6765385">&#34;&#34;</span><span class="op" id="6765387">}</span><span class="op" id="6765388">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765392">{</span><span class="string" id="6765393">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="6765415">,</span>&nbsp;<span class="string" id="6765417">&#34;foo&#34;</span><span class="op" id="6765422">,</span>&nbsp;<span class="string" id="6765424">&#34;&#34;</span><span class="op" id="6765426">}</span><span class="op" id="6765427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765431">{</span><span class="string" id="6765432">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6765457">,</span>&nbsp;<span class="string" id="6765459">&#34;foo&#34;</span><span class="op" id="6765464">,</span>&nbsp;<span class="string" id="6765466">&#34;&#34;</span><span class="op" id="6765468">}</span><span class="op" id="6765469">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765473">{</span><span class="string" id="6765474">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6765499">,</span>&nbsp;<span class="string" id="6765501">&#34;foo&#34;</span><span class="op" id="6765506">,</span>&nbsp;<span class="string" id="6765508">&#34;&#34;</span><span class="op" id="6765510">}</span><span class="op" id="6765511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765515">{</span><span class="string" id="6765516">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="6765539">,</span>&nbsp;<span class="string" id="6765541">&#34;foo&#34;</span><span class="op" id="6765546">,</span>&nbsp;<span class="string" id="6765548">&#34;&#34;</span><span class="op" id="6765550">}</span><span class="op" id="6765551">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765555">{</span><span class="string" id="6765556">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6765609">,</span>&nbsp;<span class="string" id="6765611">&#34;foo&#34;</span><span class="op" id="6765616">,</span>&nbsp;<span class="string" id="6765618">&#34;foo.txt&#34;</span><span class="op" id="6765627">}</span><span class="op" id="6765628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765632">{</span><span class="string" id="6765633">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6765690">,</span>&nbsp;<span class="string" id="6765692">&#34;&#34;</span><span class="op" id="6765694">,</span>&nbsp;<span class="string" id="6765696">&#34;bar.txt&#34;</span><span class="op" id="6765705">}</span><span class="op" id="6765706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765712">for</span>&nbsp;<span class="ident" id="6765716">i</span><span class="op" id="6765717">,</span>&nbsp;<span class="ident" id="6765719">test</span>&nbsp;<span class="op" id="6765724">:=</span>&nbsp;<span class="keyword" id="6765727">range</span>&nbsp;<span class="ident" id="6765733">tests</span>&nbsp;<span class="op" id="6765739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765743">p</span>&nbsp;<span class="op" id="6765745">:=</span>&nbsp;<span class="op" id="6765748">&amp;</span><span class="ident" id="6765749">Part</span><span class="op" id="6765753">{</span><span class="ident" id="6765754">Header</span><span class="op" id="6765760">:</span>&nbsp;<span class="builtinfunc" id="6765762">make</span><span class="op" id="6765766">(</span><span class="keyword" id="6765767">map</span><span class="op" id="6765770">[</span><span class="builtintype" id="6765771">string</span><span class="op" id="6765777">]</span><span class="op" id="6765778">[</span><span class="op" id="6765779">]</span><span class="builtintype" id="6765780">string</span><span class="op" id="6765786">)</span><span class="op" id="6765787">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765791">p</span><span class="op" id="6765792">.</span><span class="ident" id="6765793">Header</span><span class="op" id="6765799">.</span><span class="ident" id="6765800">Set</span><span class="op" id="6765803">(</span><span class="string" id="6765804">&#34;Content-Disposition&#34;</span><span class="op" id="6765825">,</span>&nbsp;<span class="ident" id="6765827">test</span><span class="op" id="6765831">[</span><span class="num" id="6765832">0</span><span class="op" id="6765833">]</span><span class="op" id="6765834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765838">if</span>&nbsp;<span class="ident" id="6765841">g</span><span class="op" id="6765842">,</span>&nbsp;<span class="ident" id="6765844">e</span>&nbsp;<span class="op" id="6765846">:=</span>&nbsp;<span class="ident" id="6765849">p</span><span class="op" id="6765850">.</span><span class="ident" id="6765851">FormName</span><span class="op" id="6765859">(</span><span class="op" id="6765860">)</span><span class="op" id="6765861">,</span>&nbsp;<span class="ident" id="6765863">test</span><span class="op" id="6765867">[</span><span class="num" id="6765868">1</span><span class="op" id="6765869">]</span><span class="op" id="6765870">;</span>&nbsp;<span class="ident" id="6765872">g</span>&nbsp;<span class="op" id="6765874">!=</span>&nbsp;<span class="ident" id="6765877">e</span>&nbsp;<span class="op" id="6765879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765884">t</span><span class="op" id="6765885">.</span><span class="ident" id="6765886">Errorf</span><span class="op" id="6765892">(</span><span class="string" id="6765893">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6765928">,</span>&nbsp;<span class="ident" id="6765930">i</span><span class="op" id="6765931">,</span>&nbsp;<span class="ident" id="6765933">g</span><span class="op" id="6765934">,</span>&nbsp;<span class="ident" id="6765936">e</span><span class="op" id="6765937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6765941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6765945">if</span>&nbsp;<span class="ident" id="6765948">g</span><span class="op" id="6765949">,</span>&nbsp;<span class="ident" id="6765951">e</span>&nbsp;<span class="op" id="6765953">:=</span>&nbsp;<span class="ident" id="6765956">p</span><span class="op" id="6765957">.</span><span class="ident" id="6765958">FileName</span><span class="op" id="6765966">(</span><span class="op" id="6765967">)</span><span class="op" id="6765968">,</span>&nbsp;<span class="ident" id="6765970">test</span><span class="op" id="6765974">[</span><span class="num" id="6765975">2</span><span class="op" id="6765976">]</span><span class="op" id="6765977">;</span>&nbsp;<span class="ident" id="6765979">g</span>&nbsp;<span class="op" id="6765981">!=</span>&nbsp;<span class="ident" id="6765984">e</span>&nbsp;<span class="op" id="6765986">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6765991">t</span><span class="op" id="6765992">.</span><span class="ident" id="6765993">Errorf</span><span class="op" id="6765999">(</span><span class="string" id="6766000">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6766035">,</span>&nbsp;<span class="ident" id="6766037">i</span><span class="op" id="6766038">,</span>&nbsp;<span class="ident" id="6766040">g</span><span class="op" id="6766041">,</span>&nbsp;<span class="ident" id="6766043">e</span><span class="op" id="6766044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6766051">}</span><br>
<span class="lineno"></span><span class="op" id="6766053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6766056">var</span>&nbsp;<span class="ident" id="6766060">longLine</span>&nbsp;<span class="op" id="6766069">=</span>&nbsp;<span class="ident" id="6766071">strings</span><span class="op" id="6766078">.</span><span class="ident" id="6766079">Repeat</span><span class="op" id="6766085">(</span><span class="string" id="6766086">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="6766106">,</span>&nbsp;<span class="op" id="6766108">(</span><span class="num" id="6766109">1</span><span class="op" id="6766110">&lt;&lt;</span><span class="num" id="6766112">20</span><span class="op" id="6766114">)</span><span class="op" id="6766115">/</span><span class="num" id="6766116">8</span><span class="op" id="6766117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766120">func</span>&nbsp;<span class="ident" id="6766125">testMultipartBody</span><span class="op" id="6766142">(</span><span class="ident" id="6766143">sep</span>&nbsp;<span class="builtintype" id="6766147">string</span><span class="op" id="6766153">)</span>&nbsp;<span class="builtintype" id="6766155">string</span>&nbsp;<span class="op" id="6766162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766165">testBody</span>&nbsp;<span class="op" id="6766174">:=</span>&nbsp;<span class="string" id="6766177">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766534">testBody</span>&nbsp;<span class="op" id="6766543">=</span>&nbsp;<span class="ident" id="6766545">strings</span><span class="op" id="6766552">.</span><span class="ident" id="6766553">Replace</span><span class="op" id="6766560">(</span><span class="ident" id="6766561">testBody</span><span class="op" id="6766569">,</span>&nbsp;<span class="string" id="6766571">&#34;\n&#34;</span><span class="op" id="6766575">,</span>&nbsp;<span class="ident" id="6766577">sep</span><span class="op" id="6766580">,</span>&nbsp;<span class="op" id="6766582">-</span><span class="num" id="6766583">1</span><span class="op" id="6766584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6766587">return</span>&nbsp;<span class="ident" id="6766594">strings</span><span class="op" id="6766601">.</span><span class="ident" id="6766602">Replace</span><span class="op" id="6766609">(</span><span class="ident" id="6766610">testBody</span><span class="op" id="6766618">,</span>&nbsp;<span class="string" id="6766620">&#34;[longline]&#34;</span><span class="op" id="6766632">,</span>&nbsp;<span class="ident" id="6766634">longLine</span><span class="op" id="6766642">,</span>&nbsp;<span class="num" id="6766644">1</span><span class="op" id="6766645">)</span><br>
<span class="lineno">110</span><span class="op" id="6766647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766650">func</span>&nbsp;<span class="ident" id="6766655">TestMultipart</span><span class="op" id="6766668">(</span><span class="ident" id="6766669">t</span>&nbsp;<span class="op" id="6766671">*</span><span class="ident" id="6766672">testing</span><span class="op" id="6766679">.</span><span class="ident" id="6766680">T</span><span class="op" id="6766681">)</span>&nbsp;<span class="op" id="6766683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766686">bodyReader</span>&nbsp;<span class="op" id="6766697">:=</span>&nbsp;<span class="ident" id="6766700">strings</span><span class="op" id="6766707">.</span><span class="ident" id="6766708">NewReader</span><span class="op" id="6766717">(</span><span class="ident" id="6766718">testMultipartBody</span><span class="op" id="6766735">(</span><span class="string" id="6766736">&#34;\r\n&#34;</span><span class="op" id="6766742">)</span><span class="op" id="6766743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766746">testMultipart</span><span class="op" id="6766759">(</span><span class="ident" id="6766760">t</span><span class="op" id="6766761">,</span>&nbsp;<span class="ident" id="6766763">bodyReader</span><span class="op" id="6766773">,</span>&nbsp;<span class="builtintype" id="6766775">false</span><span class="op" id="6766780">)</span><br>
<span class="lineno">115</span><span class="op" id="6766782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766785">func</span>&nbsp;<span class="ident" id="6766790">TestMultipartOnlyNewlines</span><span class="op" id="6766815">(</span><span class="ident" id="6766816">t</span>&nbsp;<span class="op" id="6766818">*</span><span class="ident" id="6766819">testing</span><span class="op" id="6766826">.</span><span class="ident" id="6766827">T</span><span class="op" id="6766828">)</span>&nbsp;<span class="op" id="6766830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766833">bodyReader</span>&nbsp;<span class="op" id="6766844">:=</span>&nbsp;<span class="ident" id="6766847">strings</span><span class="op" id="6766854">.</span><span class="ident" id="6766855">NewReader</span><span class="op" id="6766864">(</span><span class="ident" id="6766865">testMultipartBody</span><span class="op" id="6766882">(</span><span class="string" id="6766883">&#34;\n&#34;</span><span class="op" id="6766887">)</span><span class="op" id="6766888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766891">testMultipart</span><span class="op" id="6766904">(</span><span class="ident" id="6766905">t</span><span class="op" id="6766906">,</span>&nbsp;<span class="ident" id="6766908">bodyReader</span><span class="op" id="6766918">,</span>&nbsp;<span class="builtintype" id="6766920">true</span><span class="op" id="6766924">)</span><br>
<span class="lineno">120</span><span class="op" id="6766926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6766929">func</span>&nbsp;<span class="ident" id="6766934">TestMultipartSlowInput</span><span class="op" id="6766956">(</span><span class="ident" id="6766957">t</span>&nbsp;<span class="op" id="6766959">*</span><span class="ident" id="6766960">testing</span><span class="op" id="6766967">.</span><span class="ident" id="6766968">T</span><span class="op" id="6766969">)</span>&nbsp;<span class="op" id="6766971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6766974">bodyReader</span>&nbsp;<span class="op" id="6766985">:=</span>&nbsp;<span class="ident" id="6766988">strings</span><span class="op" id="6766995">.</span><span class="ident" id="6766996">NewReader</span><span class="op" id="6767005">(</span><span class="ident" id="6767006">testMultipartBody</span><span class="op" id="6767023">(</span><span class="string" id="6767024">&#34;\r\n&#34;</span><span class="op" id="6767030">)</span><span class="op" id="6767031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767034">testMultipart</span><span class="op" id="6767047">(</span><span class="ident" id="6767048">t</span><span class="op" id="6767049">,</span>&nbsp;<span class="op" id="6767051">&amp;</span><span class="ident" id="6767052">slowReader</span><span class="op" id="6767062">{</span><span class="ident" id="6767063">bodyReader</span><span class="op" id="6767073">}</span><span class="op" id="6767074">,</span>&nbsp;<span class="builtintype" id="6767076">false</span><span class="op" id="6767081">)</span><br>
<span class="lineno">125</span><span class="op" id="6767083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6767086">func</span>&nbsp;<span class="ident" id="6767091">testMultipart</span><span class="op" id="6767104">(</span><span class="ident" id="6767105">t</span>&nbsp;<span class="op" id="6767107">*</span><span class="ident" id="6767108">testing</span><span class="op" id="6767115">.</span><span class="ident" id="6767116">T</span><span class="op" id="6767117">,</span>&nbsp;<span class="ident" id="6767119">r</span>&nbsp;<span class="ident" id="6767121">io</span><span class="op" id="6767123">.</span><span class="ident" id="6767124">Reader</span><span class="op" id="6767130">,</span>&nbsp;<span class="ident" id="6767132">onlyNewlines</span>&nbsp;<span class="builtintype" id="6767145">bool</span><span class="op" id="6767149">)</span>&nbsp;<span class="op" id="6767151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767154">reader</span>&nbsp;<span class="op" id="6767161">:=</span>&nbsp;<span class="ident" id="6767164">NewReader</span><span class="op" id="6767173">(</span><span class="ident" id="6767174">r</span><span class="op" id="6767175">,</span>&nbsp;<span class="string" id="6767177">&#34;MyBoundary&#34;</span><span class="op" id="6767189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767192">buf</span>&nbsp;<span class="op" id="6767196">:=</span>&nbsp;<span class="builtinfunc" id="6767199">new</span><span class="op" id="6767202">(</span><span class="ident" id="6767203">bytes</span><span class="op" id="6767208">.</span><span class="ident" id="6767209">Buffer</span><span class="op" id="6767215">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6767219">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767229">part</span><span class="op" id="6767233">,</span>&nbsp;<span class="ident" id="6767235">err</span>&nbsp;<span class="op" id="6767239">:=</span>&nbsp;<span class="ident" id="6767242">reader</span><span class="op" id="6767248">.</span><span class="ident" id="6767249">NextPart</span><span class="op" id="6767257">(</span><span class="op" id="6767258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767261">if</span>&nbsp;<span class="ident" id="6767264">part</span>&nbsp;<span class="op" id="6767269">==</span>&nbsp;<span class="ident" id="6767272">nil</span>&nbsp;<span class="op" id="6767276">||</span>&nbsp;<span class="ident" id="6767279">err</span>&nbsp;<span class="op" id="6767283">!=</span>&nbsp;<span class="ident" id="6767286">nil</span>&nbsp;<span class="op" id="6767290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767294">t</span><span class="op" id="6767295">.</span><span class="ident" id="6767296">Error</span><span class="op" id="6767301">(</span><span class="string" id="6767302">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="6767318">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767322">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767333">if</span>&nbsp;<span class="ident" id="6767336">x</span>&nbsp;<span class="op" id="6767338">:=</span>&nbsp;<span class="ident" id="6767341">part</span><span class="op" id="6767345">.</span><span class="ident" id="6767346">Header</span><span class="op" id="6767352">.</span><span class="ident" id="6767353">Get</span><span class="op" id="6767356">(</span><span class="string" id="6767357">&#34;Header1&#34;</span><span class="op" id="6767366">)</span><span class="op" id="6767367">;</span>&nbsp;<span class="ident" id="6767369">x</span>&nbsp;<span class="op" id="6767371">!=</span>&nbsp;<span class="string" id="6767374">&#34;value1&#34;</span>&nbsp;<span class="op" id="6767383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767387">t</span><span class="op" id="6767388">.</span><span class="ident" id="6767389">Errorf</span><span class="op" id="6767395">(</span><span class="string" id="6767396">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6767431">,</span>&nbsp;<span class="string" id="6767433">&#34;Header1&#34;</span><span class="op" id="6767442">,</span>&nbsp;<span class="ident" id="6767444">x</span><span class="op" id="6767445">,</span>&nbsp;<span class="string" id="6767447">&#34;value1&#34;</span><span class="op" id="6767455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767458">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767461">if</span>&nbsp;<span class="ident" id="6767464">x</span>&nbsp;<span class="op" id="6767466">:=</span>&nbsp;<span class="ident" id="6767469">part</span><span class="op" id="6767473">.</span><span class="ident" id="6767474">Header</span><span class="op" id="6767480">.</span><span class="ident" id="6767481">Get</span><span class="op" id="6767484">(</span><span class="string" id="6767485">&#34;foo-bar&#34;</span><span class="op" id="6767494">)</span><span class="op" id="6767495">;</span>&nbsp;<span class="ident" id="6767497">x</span>&nbsp;<span class="op" id="6767499">!=</span>&nbsp;<span class="string" id="6767502">&#34;baz&#34;</span>&nbsp;<span class="op" id="6767508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767512">t</span><span class="op" id="6767513">.</span><span class="ident" id="6767514">Errorf</span><span class="op" id="6767520">(</span><span class="string" id="6767521">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6767556">,</span>&nbsp;<span class="string" id="6767558">&#34;foo-bar&#34;</span><span class="op" id="6767567">,</span>&nbsp;<span class="ident" id="6767569">x</span><span class="op" id="6767570">,</span>&nbsp;<span class="string" id="6767572">&#34;baz&#34;</span><span class="op" id="6767577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767583">if</span>&nbsp;<span class="ident" id="6767586">x</span>&nbsp;<span class="op" id="6767588">:=</span>&nbsp;<span class="ident" id="6767591">part</span><span class="op" id="6767595">.</span><span class="ident" id="6767596">Header</span><span class="op" id="6767602">.</span><span class="ident" id="6767603">Get</span><span class="op" id="6767606">(</span><span class="string" id="6767607">&#34;Foo-Bar&#34;</span><span class="op" id="6767616">)</span><span class="op" id="6767617">;</span>&nbsp;<span class="ident" id="6767619">x</span>&nbsp;<span class="op" id="6767621">!=</span>&nbsp;<span class="string" id="6767624">&#34;baz&#34;</span>&nbsp;<span class="op" id="6767630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767634">t</span><span class="op" id="6767635">.</span><span class="ident" id="6767636">Errorf</span><span class="op" id="6767642">(</span><span class="string" id="6767643">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6767678">,</span>&nbsp;<span class="string" id="6767680">&#34;Foo-Bar&#34;</span><span class="op" id="6767689">,</span>&nbsp;<span class="ident" id="6767691">x</span><span class="op" id="6767692">,</span>&nbsp;<span class="string" id="6767694">&#34;baz&#34;</span><span class="op" id="6767699">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767705">buf</span><span class="op" id="6767708">.</span><span class="ident" id="6767709">Reset</span><span class="op" id="6767714">(</span><span class="op" id="6767715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767718">if</span>&nbsp;<span class="ident" id="6767721">_</span><span class="op" id="6767722">,</span>&nbsp;<span class="ident" id="6767724">err</span>&nbsp;<span class="op" id="6767728">:=</span>&nbsp;<span class="ident" id="6767731">io</span><span class="op" id="6767733">.</span><span class="ident" id="6767734">Copy</span><span class="op" id="6767738">(</span><span class="ident" id="6767739">buf</span><span class="op" id="6767742">,</span>&nbsp;<span class="ident" id="6767744">part</span><span class="op" id="6767748">)</span><span class="op" id="6767749">;</span>&nbsp;<span class="ident" id="6767751">err</span>&nbsp;<span class="op" id="6767755">!=</span>&nbsp;<span class="ident" id="6767758">nil</span>&nbsp;<span class="op" id="6767762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767766">t</span><span class="op" id="6767767">.</span><span class="ident" id="6767768">Errorf</span><span class="op" id="6767774">(</span><span class="string" id="6767775">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6767792">,</span>&nbsp;<span class="ident" id="6767794">err</span><span class="op" id="6767797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767800">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767804">adjustNewlines</span>&nbsp;<span class="op" id="6767819">:=</span>&nbsp;<span class="keyword" id="6767822">func</span><span class="op" id="6767826">(</span><span class="ident" id="6767827">s</span>&nbsp;<span class="builtintype" id="6767829">string</span><span class="op" id="6767835">)</span>&nbsp;<span class="builtintype" id="6767837">string</span>&nbsp;<span class="op" id="6767844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767848">if</span>&nbsp;<span class="ident" id="6767851">onlyNewlines</span>&nbsp;<span class="op" id="6767864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767869">return</span>&nbsp;<span class="ident" id="6767876">strings</span><span class="op" id="6767883">.</span><span class="ident" id="6767884">Replace</span><span class="op" id="6767891">(</span><span class="ident" id="6767892">s</span><span class="op" id="6767893">,</span>&nbsp;<span class="string" id="6767895">&#34;\r\n&#34;</span><span class="op" id="6767901">,</span>&nbsp;<span class="string" id="6767903">&#34;\n&#34;</span><span class="op" id="6767907">,</span>&nbsp;<span class="op" id="6767909">-</span><span class="num" id="6767910">1</span><span class="op" id="6767911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767915">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6767919">return</span>&nbsp;<span class="ident" id="6767926">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6767929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6767933">expectEq</span><span class="op" id="6767941">(</span><span class="ident" id="6767942">t</span><span class="op" id="6767943">,</span>&nbsp;<span class="ident" id="6767945">adjustNewlines</span><span class="op" id="6767959">(</span><span class="string" id="6767960">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="6767982">)</span><span class="op" id="6767983">,</span>&nbsp;<span class="ident" id="6767985">buf</span><span class="op" id="6767988">.</span><span class="ident" id="6767989">String</span><span class="op" id="6767995">(</span><span class="op" id="6767996">)</span><span class="op" id="6767997">,</span>&nbsp;<span class="string" id="6767999">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="6768020">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6768024">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768034">part</span><span class="op" id="6768038">,</span>&nbsp;<span class="ident" id="6768040">err</span>&nbsp;<span class="op" id="6768044">=</span>&nbsp;<span class="ident" id="6768046">reader</span><span class="op" id="6768052">.</span><span class="ident" id="6768053">NextPart</span><span class="op" id="6768061">(</span><span class="op" id="6768062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768065">if</span>&nbsp;<span class="ident" id="6768068">err</span>&nbsp;<span class="op" id="6768072">!=</span>&nbsp;<span class="ident" id="6768075">nil</span>&nbsp;<span class="op" id="6768079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768083">t</span><span class="op" id="6768084">.</span><span class="ident" id="6768085">Fatalf</span><span class="op" id="6768091">(</span><span class="string" id="6768092">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="6768117">,</span>&nbsp;<span class="ident" id="6768119">err</span><span class="op" id="6768122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768126">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768137">if</span>&nbsp;<span class="ident" id="6768140">e</span><span class="op" id="6768141">,</span>&nbsp;<span class="ident" id="6768143">g</span>&nbsp;<span class="op" id="6768145">:=</span>&nbsp;<span class="string" id="6768148">&#34;bigsection&#34;</span><span class="op" id="6768160">,</span>&nbsp;<span class="ident" id="6768162">part</span><span class="op" id="6768166">.</span><span class="ident" id="6768167">Header</span><span class="op" id="6768173">.</span><span class="ident" id="6768174">Get</span><span class="op" id="6768177">(</span><span class="string" id="6768178">&#34;name&#34;</span><span class="op" id="6768184">)</span><span class="op" id="6768185">;</span>&nbsp;<span class="ident" id="6768187">e</span>&nbsp;<span class="op" id="6768189">!=</span>&nbsp;<span class="ident" id="6768192">g</span>&nbsp;<span class="op" id="6768194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768198">t</span><span class="op" id="6768199">.</span><span class="ident" id="6768200">Errorf</span><span class="op" id="6768206">(</span><span class="string" id="6768207">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6768249">,</span>&nbsp;<span class="ident" id="6768251">e</span><span class="op" id="6768252">,</span>&nbsp;<span class="ident" id="6768254">g</span><span class="op" id="6768255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768261">buf</span><span class="op" id="6768264">.</span><span class="ident" id="6768265">Reset</span><span class="op" id="6768270">(</span><span class="op" id="6768271">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768274">if</span>&nbsp;<span class="ident" id="6768277">_</span><span class="op" id="6768278">,</span>&nbsp;<span class="ident" id="6768280">err</span>&nbsp;<span class="op" id="6768284">:=</span>&nbsp;<span class="ident" id="6768287">io</span><span class="op" id="6768289">.</span><span class="ident" id="6768290">Copy</span><span class="op" id="6768294">(</span><span class="ident" id="6768295">buf</span><span class="op" id="6768298">,</span>&nbsp;<span class="ident" id="6768300">part</span><span class="op" id="6768304">)</span><span class="op" id="6768305">;</span>&nbsp;<span class="ident" id="6768307">err</span>&nbsp;<span class="op" id="6768311">!=</span>&nbsp;<span class="ident" id="6768314">nil</span>&nbsp;<span class="op" id="6768318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768322">t</span><span class="op" id="6768323">.</span><span class="ident" id="6768324">Errorf</span><span class="op" id="6768330">(</span><span class="string" id="6768331">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6768348">,</span>&nbsp;<span class="ident" id="6768350">err</span><span class="op" id="6768353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768359">s</span>&nbsp;<span class="op" id="6768361">:=</span>&nbsp;<span class="ident" id="6768364">buf</span><span class="op" id="6768367">.</span><span class="ident" id="6768368">String</span><span class="op" id="6768374">(</span><span class="op" id="6768375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768378">if</span>&nbsp;<span class="builtinfunc" id="6768381">len</span><span class="op" id="6768384">(</span><span class="ident" id="6768385">s</span><span class="op" id="6768386">)</span>&nbsp;<span class="op" id="6768388">!=</span>&nbsp;<span class="builtinfunc" id="6768391">len</span><span class="op" id="6768394">(</span><span class="ident" id="6768395">longLine</span><span class="op" id="6768403">)</span>&nbsp;<span class="op" id="6768405">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768409">t</span><span class="op" id="6768410">.</span><span class="ident" id="6768411">Errorf</span><span class="op" id="6768417">(</span><span class="string" id="6768418">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="6768477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6768482">len</span><span class="op" id="6768485">(</span><span class="ident" id="6768486">longLine</span><span class="op" id="6768494">)</span><span class="op" id="6768495">,</span>&nbsp;<span class="builtinfunc" id="6768497">len</span><span class="op" id="6768500">(</span><span class="ident" id="6768501">s</span><span class="op" id="6768502">)</span><span class="op" id="6768503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768509">if</span>&nbsp;<span class="ident" id="6768512">s</span>&nbsp;<span class="op" id="6768514">!=</span>&nbsp;<span class="ident" id="6768517">longLine</span>&nbsp;<span class="op" id="6768526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768530">t</span><span class="op" id="6768531">.</span><span class="ident" id="6768532">Errorf</span><span class="op" id="6768538">(</span><span class="string" id="6768539">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="6768569">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6768576">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768586">part</span><span class="op" id="6768590">,</span>&nbsp;<span class="ident" id="6768592">err</span>&nbsp;<span class="op" id="6768596">=</span>&nbsp;<span class="ident" id="6768598">reader</span><span class="op" id="6768604">.</span><span class="ident" id="6768605">NextPart</span><span class="op" id="6768613">(</span><span class="op" id="6768614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768617">if</span>&nbsp;<span class="ident" id="6768620">part</span>&nbsp;<span class="op" id="6768625">==</span>&nbsp;<span class="ident" id="6768628">nil</span>&nbsp;<span class="op" id="6768632">||</span>&nbsp;<span class="ident" id="6768635">err</span>&nbsp;<span class="op" id="6768639">!=</span>&nbsp;<span class="ident" id="6768642">nil</span>&nbsp;<span class="op" id="6768646">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768650">t</span><span class="op" id="6768651">.</span><span class="ident" id="6768652">Error</span><span class="op" id="6768657">(</span><span class="string" id="6768658">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="6768674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768678">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768689">if</span>&nbsp;<span class="ident" id="6768692">part</span><span class="op" id="6768696">.</span><span class="ident" id="6768697">Header</span><span class="op" id="6768703">.</span><span class="ident" id="6768704">Get</span><span class="op" id="6768707">(</span><span class="string" id="6768708">&#34;foo-bar&#34;</span><span class="op" id="6768717">)</span>&nbsp;<span class="op" id="6768719">!=</span>&nbsp;<span class="string" id="6768722">&#34;bazb&#34;</span>&nbsp;<span class="op" id="6768729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768733">t</span><span class="op" id="6768734">.</span><span class="ident" id="6768735">Error</span><span class="op" id="6768740">(</span><span class="string" id="6768741">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="6768765">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768771">buf</span><span class="op" id="6768774">.</span><span class="ident" id="6768775">Reset</span><span class="op" id="6768780">(</span><span class="op" id="6768781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6768784">if</span>&nbsp;<span class="ident" id="6768787">_</span><span class="op" id="6768788">,</span>&nbsp;<span class="ident" id="6768790">err</span>&nbsp;<span class="op" id="6768794">:=</span>&nbsp;<span class="ident" id="6768797">io</span><span class="op" id="6768799">.</span><span class="ident" id="6768800">Copy</span><span class="op" id="6768804">(</span><span class="ident" id="6768805">buf</span><span class="op" id="6768808">,</span>&nbsp;<span class="ident" id="6768810">part</span><span class="op" id="6768814">)</span><span class="op" id="6768815">;</span>&nbsp;<span class="ident" id="6768817">err</span>&nbsp;<span class="op" id="6768821">!=</span>&nbsp;<span class="ident" id="6768824">nil</span>&nbsp;<span class="op" id="6768828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768832">t</span><span class="op" id="6768833">.</span><span class="ident" id="6768834">Errorf</span><span class="op" id="6768840">(</span><span class="string" id="6768841">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6768858">,</span>&nbsp;<span class="ident" id="6768860">err</span><span class="op" id="6768863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6768866">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768869">expectEq</span><span class="op" id="6768877">(</span><span class="ident" id="6768878">t</span><span class="op" id="6768879">,</span>&nbsp;<span class="ident" id="6768881">adjustNewlines</span><span class="op" id="6768895">(</span><span class="string" id="6768896">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="6768961">)</span><span class="op" id="6768962">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6768966">buf</span><span class="op" id="6768969">.</span><span class="ident" id="6768970">String</span><span class="op" id="6768976">(</span><span class="op" id="6768977">)</span><span class="op" id="6768978">,</span>&nbsp;<span class="string" id="6768980">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="6768996">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6769000">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769010">part</span><span class="op" id="6769014">,</span>&nbsp;<span class="ident" id="6769016">err</span>&nbsp;<span class="op" id="6769020">=</span>&nbsp;<span class="ident" id="6769022">reader</span><span class="op" id="6769028">.</span><span class="ident" id="6769029">NextPart</span><span class="op" id="6769037">(</span><span class="op" id="6769038">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769041">if</span>&nbsp;<span class="ident" id="6769044">part</span>&nbsp;<span class="op" id="6769049">==</span>&nbsp;<span class="ident" id="6769052">nil</span>&nbsp;<span class="op" id="6769056">||</span>&nbsp;<span class="ident" id="6769059">err</span>&nbsp;<span class="op" id="6769063">!=</span>&nbsp;<span class="ident" id="6769066">nil</span>&nbsp;<span class="op" id="6769070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769074">t</span><span class="op" id="6769075">.</span><span class="ident" id="6769076">Error</span><span class="op" id="6769081">(</span><span class="string" id="6769082">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="6769114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769118">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6769130">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769153">part</span><span class="op" id="6769157">,</span>&nbsp;<span class="ident" id="6769159">err</span>&nbsp;<span class="op" id="6769163">=</span>&nbsp;<span class="ident" id="6769165">reader</span><span class="op" id="6769171">.</span><span class="ident" id="6769172">NextPart</span><span class="op" id="6769180">(</span><span class="op" id="6769181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769184">if</span>&nbsp;<span class="ident" id="6769187">part</span>&nbsp;<span class="op" id="6769192">!=</span>&nbsp;<span class="ident" id="6769195">nil</span>&nbsp;<span class="op" id="6769199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769203">t</span><span class="op" id="6769204">.</span><span class="ident" id="6769205">Error</span><span class="op" id="6769210">(</span><span class="string" id="6769211">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="6769240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769243">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769246">if</span>&nbsp;<span class="ident" id="6769249">err</span>&nbsp;<span class="op" id="6769253">!=</span>&nbsp;<span class="ident" id="6769256">io</span><span class="op" id="6769258">.</span><span class="ident" id="6769259">EOF</span>&nbsp;<span class="op" id="6769263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769267">t</span><span class="op" id="6769268">.</span><span class="ident" id="6769269">Errorf</span><span class="op" id="6769275">(</span><span class="string" id="6769276">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6769315">,</span>&nbsp;<span class="ident" id="6769317">err</span><span class="op" id="6769320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769323">}</span><br>
<span class="lineno"></span><span class="op" id="6769325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6769328">func</span>&nbsp;<span class="ident" id="6769333">TestVariousTextLineEndings</span><span class="op" id="6769359">(</span><span class="ident" id="6769360">t</span>&nbsp;<span class="op" id="6769362">*</span><span class="ident" id="6769363">testing</span><span class="op" id="6769370">.</span><span class="ident" id="6769371">T</span><span class="op" id="6769372">)</span>&nbsp;<span class="op" id="6769374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769377">tests</span>&nbsp;<span class="op" id="6769383">:=</span>&nbsp;<span class="op" id="6769386">[</span><span class="op" id="6769387">...</span><span class="op" id="6769390">]</span><span class="builtintype" id="6769391">string</span><span class="op" id="6769397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769401">&#34;Foo\nBar&#34;</span><span class="op" id="6769411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769415">&#34;Foo\nBar\n&#34;</span><span class="op" id="6769427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769431">&#34;Foo\r\nBar&#34;</span><span class="op" id="6769443">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769447">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="6769463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769467">&#34;Foo\rBar&#34;</span><span class="op" id="6769477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769481">&#34;Foo\rBar\r&#34;</span><span class="op" id="6769493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769497">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="6769543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769546">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769550">for</span>&nbsp;<span class="ident" id="6769554">testNum</span><span class="op" id="6769561">,</span>&nbsp;<span class="ident" id="6769563">expectedBody</span>&nbsp;<span class="op" id="6769576">:=</span>&nbsp;<span class="keyword" id="6769579">range</span>&nbsp;<span class="ident" id="6769585">tests</span>&nbsp;<span class="op" id="6769591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769595">body</span>&nbsp;<span class="op" id="6769600">:=</span>&nbsp;<span class="string" id="6769603">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="6769620">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769625">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6769678">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769683">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6769690">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769695">expectedBody</span>&nbsp;<span class="op" id="6769708">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6769713">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769738">bodyReader</span>&nbsp;<span class="op" id="6769749">:=</span>&nbsp;<span class="ident" id="6769752">strings</span><span class="op" id="6769759">.</span><span class="ident" id="6769760">NewReader</span><span class="op" id="6769769">(</span><span class="ident" id="6769770">body</span><span class="op" id="6769774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769779">reader</span>&nbsp;<span class="op" id="6769786">:=</span>&nbsp;<span class="ident" id="6769789">NewReader</span><span class="op" id="6769798">(</span><span class="ident" id="6769799">bodyReader</span><span class="op" id="6769809">,</span>&nbsp;<span class="string" id="6769811">&#34;BOUNDARY&#34;</span><span class="op" id="6769821">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769825">buf</span>&nbsp;<span class="op" id="6769829">:=</span>&nbsp;<span class="builtinfunc" id="6769832">new</span><span class="op" id="6769835">(</span><span class="ident" id="6769836">bytes</span><span class="op" id="6769841">.</span><span class="ident" id="6769842">Buffer</span><span class="op" id="6769848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769852">part</span><span class="op" id="6769856">,</span>&nbsp;<span class="ident" id="6769858">err</span>&nbsp;<span class="op" id="6769862">:=</span>&nbsp;<span class="ident" id="6769865">reader</span><span class="op" id="6769871">.</span><span class="ident" id="6769872">NextPart</span><span class="op" id="6769880">(</span><span class="op" id="6769881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769885">if</span>&nbsp;<span class="ident" id="6769888">part</span>&nbsp;<span class="op" id="6769893">==</span>&nbsp;<span class="ident" id="6769896">nil</span>&nbsp;<span class="op" id="6769900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769905">t</span><span class="op" id="6769906">.</span><span class="ident" id="6769907">Errorf</span><span class="op" id="6769913">(</span><span class="string" id="6769914">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="6769947">,</span>&nbsp;<span class="ident" id="6769949">testNum</span><span class="op" id="6769956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769961">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6769972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6769976">if</span>&nbsp;<span class="ident" id="6769979">err</span>&nbsp;<span class="op" id="6769983">!=</span>&nbsp;<span class="ident" id="6769986">nil</span>&nbsp;<span class="op" id="6769990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6769995">t</span><span class="op" id="6769996">.</span><span class="ident" id="6769997">Errorf</span><span class="op" id="6770003">(</span><span class="string" id="6770004">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6770037">,</span>&nbsp;<span class="ident" id="6770039">testNum</span><span class="op" id="6770046">,</span>&nbsp;<span class="ident" id="6770048">err</span><span class="op" id="6770051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770056">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770067">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770071">written</span><span class="op" id="6770078">,</span>&nbsp;<span class="ident" id="6770080">err</span>&nbsp;<span class="op" id="6770084">:=</span>&nbsp;<span class="ident" id="6770087">io</span><span class="op" id="6770089">.</span><span class="ident" id="6770090">Copy</span><span class="op" id="6770094">(</span><span class="ident" id="6770095">buf</span><span class="op" id="6770098">,</span>&nbsp;<span class="ident" id="6770100">part</span><span class="op" id="6770104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770108">expectEq</span><span class="op" id="6770116">(</span><span class="ident" id="6770117">t</span><span class="op" id="6770118">,</span>&nbsp;<span class="ident" id="6770120">expectedBody</span><span class="op" id="6770132">,</span>&nbsp;<span class="ident" id="6770134">buf</span><span class="op" id="6770137">.</span><span class="ident" id="6770138">String</span><span class="op" id="6770144">(</span><span class="op" id="6770145">)</span><span class="op" id="6770146">,</span>&nbsp;<span class="ident" id="6770148">fmt</span><span class="op" id="6770151">.</span><span class="ident" id="6770152">Sprintf</span><span class="op" id="6770159">(</span><span class="string" id="6770160">&#34;test&nbsp;%d&#34;</span><span class="op" id="6770169">,</span>&nbsp;<span class="ident" id="6770171">testNum</span><span class="op" id="6770178">)</span><span class="op" id="6770179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770183">if</span>&nbsp;<span class="ident" id="6770186">err</span>&nbsp;<span class="op" id="6770190">!=</span>&nbsp;<span class="ident" id="6770193">nil</span>&nbsp;<span class="op" id="6770197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770202">t</span><span class="op" id="6770203">.</span><span class="ident" id="6770204">Errorf</span><span class="op" id="6770210">(</span><span class="string" id="6770211">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="6770256">,</span>&nbsp;<span class="ident" id="6770258">written</span><span class="op" id="6770265">,</span>&nbsp;<span class="ident" id="6770267">err</span><span class="op" id="6770270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770274">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770279">part</span><span class="op" id="6770283">,</span>&nbsp;<span class="ident" id="6770285">err</span>&nbsp;<span class="op" id="6770289">=</span>&nbsp;<span class="ident" id="6770291">reader</span><span class="op" id="6770297">.</span><span class="ident" id="6770298">NextPart</span><span class="op" id="6770306">(</span><span class="op" id="6770307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770311">if</span>&nbsp;<span class="ident" id="6770314">part</span>&nbsp;<span class="op" id="6770319">!=</span>&nbsp;<span class="ident" id="6770322">nil</span>&nbsp;<span class="op" id="6770326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770331">t</span><span class="op" id="6770332">.</span><span class="ident" id="6770333">Errorf</span><span class="op" id="6770339">(</span><span class="string" id="6770340">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="6770368">,</span>&nbsp;<span class="ident" id="6770370">testNum</span><span class="op" id="6770377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770381">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770385">if</span>&nbsp;<span class="ident" id="6770388">err</span>&nbsp;<span class="op" id="6770392">!=</span>&nbsp;<span class="ident" id="6770395">io</span><span class="op" id="6770397">.</span><span class="ident" id="6770398">EOF</span>&nbsp;<span class="op" id="6770402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770407">t</span><span class="op" id="6770408">.</span><span class="ident" id="6770409">Errorf</span><span class="op" id="6770415">(</span><span class="string" id="6770416">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6770452">,</span>&nbsp;<span class="ident" id="6770454">testNum</span><span class="op" id="6770461">,</span>&nbsp;<span class="ident" id="6770463">err</span><span class="op" id="6770466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770474">}</span><br>
<span class="lineno">260</span><span class="op" id="6770476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770479">type</span>&nbsp;<span class="ident" id="6770484">maliciousReader</span>&nbsp;<span class="keyword" id="6770500">struct</span>&nbsp;<span class="op" id="6770507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770510">t</span>&nbsp;<span class="op" id="6770512">*</span><span class="ident" id="6770513">testing</span><span class="op" id="6770520">.</span><span class="ident" id="6770521">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770524">n</span>&nbsp;<span class="builtintype" id="6770526">int</span><br>
<span class="lineno">265</span><span class="op" id="6770530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770533">const</span>&nbsp;<span class="ident" id="6770539">maxReadThreshold</span>&nbsp;<span class="op" id="6770556">=</span>&nbsp;<span class="num" id="6770558">1</span>&nbsp;<span class="op" id="6770560">&lt;&lt;</span>&nbsp;<span class="num" id="6770563">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770567">func</span>&nbsp;<span class="op" id="6770572">(</span><span class="ident" id="6770573">mr</span>&nbsp;<span class="op" id="6770576">*</span><span class="ident" id="6770577">maliciousReader</span><span class="op" id="6770592">)</span>&nbsp;<span class="ident" id="6770594">Read</span><span class="op" id="6770598">(</span><span class="ident" id="6770599">b</span>&nbsp;<span class="op" id="6770601">[</span><span class="op" id="6770602">]</span><span class="builtintype" id="6770603">byte</span><span class="op" id="6770607">)</span>&nbsp;<span class="op" id="6770609">(</span><span class="ident" id="6770610">n</span>&nbsp;<span class="builtintype" id="6770612">int</span><span class="op" id="6770615">,</span>&nbsp;<span class="ident" id="6770617">err</span>&nbsp;<span class="builtintype" id="6770621">error</span><span class="op" id="6770626">)</span>&nbsp;<span class="op" id="6770628">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770631">mr</span><span class="op" id="6770633">.</span><span class="ident" id="6770634">n</span>&nbsp;<span class="op" id="6770636">+=</span>&nbsp;<span class="builtinfunc" id="6770639">len</span><span class="op" id="6770642">(</span><span class="ident" id="6770643">b</span><span class="op" id="6770644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770647">if</span>&nbsp;<span class="ident" id="6770650">mr</span><span class="op" id="6770652">.</span><span class="ident" id="6770653">n</span>&nbsp;<span class="op" id="6770655">&gt;=</span>&nbsp;<span class="ident" id="6770658">maxReadThreshold</span>&nbsp;<span class="op" id="6770675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770679">mr</span><span class="op" id="6770681">.</span><span class="ident" id="6770682">t</span><span class="op" id="6770683">.</span><span class="ident" id="6770684">Fatal</span><span class="op" id="6770689">(</span><span class="string" id="6770690">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="6770709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770713">return</span>&nbsp;<span class="num" id="6770720">0</span><span class="op" id="6770721">,</span>&nbsp;<span class="ident" id="6770723">io</span><span class="op" id="6770725">.</span><span class="ident" id="6770726">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770731">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770734">return</span>&nbsp;<span class="builtinfunc" id="6770741">len</span><span class="op" id="6770744">(</span><span class="ident" id="6770745">b</span><span class="op" id="6770746">)</span><span class="op" id="6770747">,</span>&nbsp;<span class="ident" id="6770749">nil</span><br>
<span class="lineno"></span><span class="op" id="6770753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6770756">func</span>&nbsp;<span class="ident" id="6770761">TestLineLimit</span><span class="op" id="6770774">(</span><span class="ident" id="6770775">t</span>&nbsp;<span class="op" id="6770777">*</span><span class="ident" id="6770778">testing</span><span class="op" id="6770785">.</span><span class="ident" id="6770786">T</span><span class="op" id="6770787">)</span>&nbsp;<span class="op" id="6770789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770792">mr</span>&nbsp;<span class="op" id="6770795">:=</span>&nbsp;<span class="op" id="6770798">&amp;</span><span class="ident" id="6770799">maliciousReader</span><span class="op" id="6770814">{</span><span class="ident" id="6770815">t</span><span class="op" id="6770816">:</span>&nbsp;<span class="ident" id="6770818">t</span><span class="op" id="6770819">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770822">r</span>&nbsp;<span class="op" id="6770824">:=</span>&nbsp;<span class="ident" id="6770827">NewReader</span><span class="op" id="6770836">(</span><span class="ident" id="6770837">mr</span><span class="op" id="6770839">,</span>&nbsp;<span class="string" id="6770841">&#34;fooBoundary&#34;</span><span class="op" id="6770854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770857">part</span><span class="op" id="6770861">,</span>&nbsp;<span class="ident" id="6770863">err</span>&nbsp;<span class="op" id="6770867">:=</span>&nbsp;<span class="ident" id="6770870">r</span><span class="op" id="6770871">.</span><span class="ident" id="6770872">NextPart</span><span class="op" id="6770880">(</span><span class="op" id="6770881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770884">if</span>&nbsp;<span class="ident" id="6770887">part</span>&nbsp;<span class="op" id="6770892">!=</span>&nbsp;<span class="ident" id="6770895">nil</span>&nbsp;<span class="op" id="6770899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770903">t</span><span class="op" id="6770904">.</span><span class="ident" id="6770905">Errorf</span><span class="op" id="6770911">(</span><span class="string" id="6770912">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="6770934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770937">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770940">if</span>&nbsp;<span class="ident" id="6770943">err</span>&nbsp;<span class="op" id="6770947">==</span>&nbsp;<span class="ident" id="6770950">nil</span>&nbsp;<span class="op" id="6770954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6770958">t</span><span class="op" id="6770959">.</span><span class="ident" id="6770960">Errorf</span><span class="op" id="6770966">(</span><span class="string" id="6770967">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="6770986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6770989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6770992">if</span>&nbsp;<span class="ident" id="6770995">mr</span><span class="op" id="6770997">.</span><span class="ident" id="6770998">n</span>&nbsp;<span class="op" id="6771000">&gt;=</span>&nbsp;<span class="ident" id="6771003">maxReadThreshold</span>&nbsp;<span class="op" id="6771020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771024">t</span><span class="op" id="6771025">.</span><span class="ident" id="6771026">Errorf</span><span class="op" id="6771032">(</span><span class="string" id="6771033">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6771071">,</span>&nbsp;<span class="ident" id="6771073">maxReadThreshold</span><span class="op" id="6771089">,</span>&nbsp;<span class="ident" id="6771091">mr</span><span class="op" id="6771093">.</span><span class="ident" id="6771094">n</span><span class="op" id="6771095">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771098">}</span><br>
<span class="lineno"></span><span class="op" id="6771100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6771103">func</span>&nbsp;<span class="ident" id="6771108">TestMultipartTruncated</span><span class="op" id="6771130">(</span><span class="ident" id="6771131">t</span>&nbsp;<span class="op" id="6771133">*</span><span class="ident" id="6771134">testing</span><span class="op" id="6771141">.</span><span class="ident" id="6771142">T</span><span class="op" id="6771143">)</span>&nbsp;<span class="op" id="6771145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771148">testBody</span>&nbsp;<span class="op" id="6771157">:=</span>&nbsp;<span class="string" id="6771160">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771267">body</span>&nbsp;<span class="op" id="6771272">:=</span>&nbsp;<span class="ident" id="6771275">strings</span><span class="op" id="6771282">.</span><span class="ident" id="6771283">Replace</span><span class="op" id="6771290">(</span><span class="ident" id="6771291">testBody</span><span class="op" id="6771299">,</span>&nbsp;<span class="string" id="6771301">&#34;\n&#34;</span><span class="op" id="6771305">,</span>&nbsp;<span class="string" id="6771307">&#34;\r\n&#34;</span><span class="op" id="6771313">,</span>&nbsp;<span class="op" id="6771315">-</span><span class="num" id="6771316">1</span><span class="op" id="6771317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771320">bodyReader</span>&nbsp;<span class="op" id="6771331">:=</span>&nbsp;<span class="ident" id="6771334">strings</span><span class="op" id="6771341">.</span><span class="ident" id="6771342">NewReader</span><span class="op" id="6771351">(</span><span class="ident" id="6771352">body</span><span class="op" id="6771356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771359">r</span>&nbsp;<span class="op" id="6771361">:=</span>&nbsp;<span class="ident" id="6771364">NewReader</span><span class="op" id="6771373">(</span><span class="ident" id="6771374">bodyReader</span><span class="op" id="6771384">,</span>&nbsp;<span class="string" id="6771386">&#34;MyBoundary&#34;</span><span class="op" id="6771398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771402">part</span><span class="op" id="6771406">,</span>&nbsp;<span class="ident" id="6771408">err</span>&nbsp;<span class="op" id="6771412">:=</span>&nbsp;<span class="ident" id="6771415">r</span><span class="op" id="6771416">.</span><span class="ident" id="6771417">NextPart</span><span class="op" id="6771425">(</span><span class="op" id="6771426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771429">if</span>&nbsp;<span class="ident" id="6771432">err</span>&nbsp;<span class="op" id="6771436">!=</span>&nbsp;<span class="ident" id="6771439">nil</span>&nbsp;<span class="op" id="6771443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771447">t</span><span class="op" id="6771448">.</span><span class="ident" id="6771449">Fatalf</span><span class="op" id="6771455">(</span><span class="string" id="6771456">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6771475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771481">_</span><span class="op" id="6771482">,</span>&nbsp;<span class="ident" id="6771484">err</span>&nbsp;<span class="op" id="6771488">=</span>&nbsp;<span class="ident" id="6771490">io</span><span class="op" id="6771492">.</span><span class="ident" id="6771493">Copy</span><span class="op" id="6771497">(</span><span class="ident" id="6771498">ioutil</span><span class="op" id="6771504">.</span><span class="ident" id="6771505">Discard</span><span class="op" id="6771512">,</span>&nbsp;<span class="ident" id="6771514">part</span><span class="op" id="6771518">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771521">if</span>&nbsp;<span class="ident" id="6771524">err</span>&nbsp;<span class="op" id="6771528">!=</span>&nbsp;<span class="ident" id="6771531">io</span><span class="op" id="6771533">.</span><span class="ident" id="6771534">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6771551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771555">t</span><span class="op" id="6771556">.</span><span class="ident" id="6771557">Fatalf</span><span class="op" id="6771563">(</span><span class="string" id="6771564">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6771608">,</span>&nbsp;<span class="ident" id="6771610">err</span><span class="op" id="6771613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771616">}</span><br>
<span class="lineno"></span><span class="op" id="6771618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6771621">type</span>&nbsp;<span class="ident" id="6771626">slowReader</span>&nbsp;<span class="keyword" id="6771637">struct</span>&nbsp;<span class="op" id="6771644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6771647">r</span>&nbsp;<span class="ident" id="6771649">io</span><span class="op" id="6771651">.</span><span class="ident" id="6771652">Reader</span><br>
<span class="lineno"></span><span class="op" id="6771659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6771662">func</span>&nbsp;<span class="op" id="6771667">(</span><span class="ident" id="6771668">s</span>&nbsp;<span class="op" id="6771670">*</span><span class="ident" id="6771671">slowReader</span><span class="op" id="6771681">)</span>&nbsp;<span class="ident" id="6771683">Read</span><span class="op" id="6771687">(</span><span class="ident" id="6771688">p</span>&nbsp;<span class="op" id="6771690">[</span><span class="op" id="6771691">]</span><span class="builtintype" id="6771692">byte</span><span class="op" id="6771696">)</span>&nbsp;<span class="op" id="6771698">(</span><span class="builtintype" id="6771699">int</span><span class="op" id="6771702">,</span>&nbsp;<span class="builtintype" id="6771704">error</span><span class="op" id="6771709">)</span>&nbsp;<span class="op" id="6771711">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771714">if</span>&nbsp;<span class="builtinfunc" id="6771717">len</span><span class="op" id="6771720">(</span><span class="ident" id="6771721">p</span><span class="op" id="6771722">)</span>&nbsp;<span class="op" id="6771724">==</span>&nbsp;<span class="num" id="6771727">0</span>&nbsp;<span class="op" id="6771729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771733">return</span>&nbsp;<span class="ident" id="6771740">s</span><span class="op" id="6771741">.</span><span class="ident" id="6771742">r</span><span class="op" id="6771743">.</span><span class="ident" id="6771744">Read</span><span class="op" id="6771748">(</span><span class="ident" id="6771749">p</span><span class="op" id="6771750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6771753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6771756">return</span>&nbsp;<span class="ident" id="6771763">s</span><span class="op" id="6771764">.</span><span class="ident" id="6771765">r</span><span class="op" id="6771766">.</span><span class="ident" id="6771767">Read</span><span class="op" id="6771771">(</span><span class="ident" id="6771772">p</span><span class="op" id="6771773">[</span><span class="op" id="6771774">:</span><span class="num" id="6771775">1</span><span class="op" id="6771776">]</span><span class="op" id="6771777">)</span><br>
<span class="lineno"></span><span class="op" id="6771779">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6771782">func</span>&nbsp;<span class="ident" id="6771787">TestLineContinuation</span><span class="op" id="6771807">(</span><span class="ident" id="6771808">t</span>&nbsp;<span class="op" id="6771810">*</span><span class="ident" id="6771811">testing</span><span class="op" id="6771818">.</span><span class="ident" id="6771819">T</span><span class="op" id="6771820">)</span>&nbsp;<span class="op" id="6771822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771825">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771901">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771913">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6771980">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772041">testBody</span>&nbsp;<span class="op" id="6772050">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6772055">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772551">r</span>&nbsp;<span class="op" id="6772553">:=</span>&nbsp;<span class="ident" id="6772556">NewReader</span><span class="op" id="6772565">(</span><span class="ident" id="6772566">strings</span><span class="op" id="6772573">.</span><span class="ident" id="6772574">NewReader</span><span class="op" id="6772583">(</span><span class="ident" id="6772584">testBody</span><span class="op" id="6772592">)</span><span class="op" id="6772593">,</span>&nbsp;<span class="string" id="6772595">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="6772619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772623">for</span>&nbsp;<span class="ident" id="6772627">i</span>&nbsp;<span class="op" id="6772629">:=</span>&nbsp;<span class="num" id="6772632">0</span><span class="op" id="6772633">;</span>&nbsp;<span class="ident" id="6772635">i</span>&nbsp;<span class="op" id="6772637">&lt;</span>&nbsp;<span class="num" id="6772639">2</span><span class="op" id="6772640">;</span>&nbsp;<span class="ident" id="6772642">i</span><span class="op" id="6772643">++</span>&nbsp;<span class="op" id="6772646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772650">part</span><span class="op" id="6772654">,</span>&nbsp;<span class="ident" id="6772656">err</span>&nbsp;<span class="op" id="6772660">:=</span>&nbsp;<span class="ident" id="6772663">r</span><span class="op" id="6772664">.</span><span class="ident" id="6772665">NextPart</span><span class="op" id="6772673">(</span><span class="op" id="6772674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772678">if</span>&nbsp;<span class="ident" id="6772681">err</span>&nbsp;<span class="op" id="6772685">!=</span>&nbsp;<span class="ident" id="6772688">nil</span>&nbsp;<span class="op" id="6772692">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772697">t</span><span class="op" id="6772698">.</span><span class="ident" id="6772699">Fatalf</span><span class="op" id="6772705">(</span><span class="string" id="6772706">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6772725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772733">var</span>&nbsp;<span class="ident" id="6772737">buf</span>&nbsp;<span class="ident" id="6772741">bytes</span><span class="op" id="6772746">.</span><span class="ident" id="6772747">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772756">n</span><span class="op" id="6772757">,</span>&nbsp;<span class="ident" id="6772759">err</span>&nbsp;<span class="op" id="6772763">:=</span>&nbsp;<span class="ident" id="6772766">io</span><span class="op" id="6772768">.</span><span class="ident" id="6772769">Copy</span><span class="op" id="6772773">(</span><span class="op" id="6772774">&amp;</span><span class="ident" id="6772775">buf</span><span class="op" id="6772778">,</span>&nbsp;<span class="ident" id="6772780">part</span><span class="op" id="6772784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772788">if</span>&nbsp;<span class="ident" id="6772791">err</span>&nbsp;<span class="op" id="6772795">!=</span>&nbsp;<span class="ident" id="6772798">nil</span>&nbsp;<span class="op" id="6772802">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772807">t</span><span class="op" id="6772808">.</span><span class="ident" id="6772809">Errorf</span><span class="op" id="6772815">(</span><span class="string" id="6772816">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="6772857">,</span>&nbsp;<span class="ident" id="6772859">err</span><span class="op" id="6772862">,</span>&nbsp;<span class="ident" id="6772864">buf</span><span class="op" id="6772867">.</span><span class="ident" id="6772868">String</span><span class="op" id="6772874">(</span><span class="op" id="6772875">)</span><span class="op" id="6772876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6772884">if</span>&nbsp;<span class="ident" id="6772887">n</span>&nbsp;<span class="op" id="6772889">&lt;=</span>&nbsp;<span class="num" id="6772892">0</span>&nbsp;<span class="op" id="6772894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6772899">t</span><span class="op" id="6772900">.</span><span class="ident" id="6772901">Errorf</span><span class="op" id="6772907">(</span><span class="string" id="6772908">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="6772936">,</span>&nbsp;<span class="ident" id="6772938">n</span><span class="op" id="6772939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772943">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6772946">}</span><br>
<span class="lineno"></span><span class="op" id="6772948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6772951">func</span>&nbsp;<span class="ident" id="6772956">TestQuotedPrintableEncoding</span><span class="op" id="6772983">(</span><span class="ident" id="6772984">t</span>&nbsp;<span class="op" id="6772986">*</span><span class="ident" id="6772987">testing</span><span class="op" id="6772994">.</span><span class="ident" id="6772995">T</span><span class="op" id="6772996">)</span>&nbsp;<span class="op" id="6772998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6773001">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773039">body</span>&nbsp;<span class="op" id="6773044">:=</span>&nbsp;<span class="string" id="6773047">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773781">r</span>&nbsp;<span class="op" id="6773783">:=</span>&nbsp;<span class="ident" id="6773786">NewReader</span><span class="op" id="6773795">(</span><span class="ident" id="6773796">strings</span><span class="op" id="6773803">.</span><span class="ident" id="6773804">NewReader</span><span class="op" id="6773813">(</span><span class="ident" id="6773814">body</span><span class="op" id="6773818">)</span><span class="op" id="6773819">,</span>&nbsp;<span class="string" id="6773821">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="6773851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773854">part</span><span class="op" id="6773858">,</span>&nbsp;<span class="ident" id="6773860">err</span>&nbsp;<span class="op" id="6773864">:=</span>&nbsp;<span class="ident" id="6773867">r</span><span class="op" id="6773868">.</span><span class="ident" id="6773869">NextPart</span><span class="op" id="6773877">(</span><span class="op" id="6773878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773881">if</span>&nbsp;<span class="ident" id="6773884">err</span>&nbsp;<span class="op" id="6773888">!=</span>&nbsp;<span class="ident" id="6773891">nil</span>&nbsp;<span class="op" id="6773895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773899">t</span><span class="op" id="6773900">.</span><span class="ident" id="6773901">Fatal</span><span class="op" id="6773906">(</span><span class="ident" id="6773907">err</span><span class="op" id="6773910">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6773913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6773916">if</span>&nbsp;<span class="ident" id="6773919">te</span><span class="op" id="6773921">,</span>&nbsp;<span class="ident" id="6773923">ok</span>&nbsp;<span class="op" id="6773926">:=</span>&nbsp;<span class="ident" id="6773929">part</span><span class="op" id="6773933">.</span><span class="ident" id="6773934">Header</span><span class="op" id="6773940">[</span><span class="string" id="6773941">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="6773968">]</span><span class="op" id="6773969">;</span>&nbsp;<span class="ident" id="6773971">ok</span>&nbsp;<span class="op" id="6773974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6773978">t</span><span class="op" id="6773979">.</span><span class="ident" id="6773980">Errorf</span><span class="op" id="6773986">(</span><span class="string" id="6773987">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6774031">,</span>&nbsp;<span class="ident" id="6774033">te</span><span class="op" id="6774035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774041">var</span>&nbsp;<span class="ident" id="6774045">buf</span>&nbsp;<span class="ident" id="6774049">bytes</span><span class="op" id="6774054">.</span><span class="ident" id="6774055">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774063">_</span><span class="op" id="6774064">,</span>&nbsp;<span class="ident" id="6774066">err</span>&nbsp;<span class="op" id="6774070">=</span>&nbsp;<span class="ident" id="6774072">io</span><span class="op" id="6774074">.</span><span class="ident" id="6774075">Copy</span><span class="op" id="6774079">(</span><span class="op" id="6774080">&amp;</span><span class="ident" id="6774081">buf</span><span class="op" id="6774084">,</span>&nbsp;<span class="ident" id="6774086">part</span><span class="op" id="6774090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774093">if</span>&nbsp;<span class="ident" id="6774096">err</span>&nbsp;<span class="op" id="6774100">!=</span>&nbsp;<span class="ident" id="6774103">nil</span>&nbsp;<span class="op" id="6774107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774111">t</span><span class="op" id="6774112">.</span><span class="ident" id="6774113">Error</span><span class="op" id="6774118">(</span><span class="ident" id="6774119">err</span><span class="op" id="6774122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774128">got</span>&nbsp;<span class="op" id="6774132">:=</span>&nbsp;<span class="ident" id="6774135">buf</span><span class="op" id="6774138">.</span><span class="ident" id="6774139">String</span><span class="op" id="6774145">(</span><span class="op" id="6774146">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774149">want</span>&nbsp;<span class="op" id="6774154">:=</span>&nbsp;<span class="string" id="6774157">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774514">if</span>&nbsp;<span class="ident" id="6774517">got</span>&nbsp;<span class="op" id="6774521">!=</span>&nbsp;<span class="ident" id="6774524">want</span>&nbsp;<span class="op" id="6774529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774533">t</span><span class="op" id="6774534">.</span><span class="ident" id="6774535">Errorf</span><span class="op" id="6774541">(</span><span class="string" id="6774542">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="6774581">,</span>&nbsp;<span class="ident" id="6774583">got</span><span class="op" id="6774586">,</span>&nbsp;<span class="ident" id="6774588">want</span><span class="op" id="6774592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774595">}</span><br>
<span class="lineno"></span><span class="op" id="6774597">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6774600">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6774673">func</span>&nbsp;<span class="ident" id="6774678">TestNested</span><span class="op" id="6774688">(</span><span class="ident" id="6774689">t</span>&nbsp;<span class="op" id="6774691">*</span><span class="ident" id="6774692">testing</span><span class="op" id="6774699">.</span><span class="ident" id="6774700">T</span><span class="op" id="6774701">)</span>&nbsp;<span class="op" id="6774703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6774706">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6774766">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774813">f</span><span class="op" id="6774814">,</span>&nbsp;<span class="ident" id="6774816">err</span>&nbsp;<span class="op" id="6774820">:=</span>&nbsp;<span class="ident" id="6774823">os</span><span class="op" id="6774825">.</span><span class="ident" id="6774826">Open</span><span class="op" id="6774830">(</span><span class="string" id="6774831">&#34;testdata/nested-mime&#34;</span><span class="op" id="6774853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774856">if</span>&nbsp;<span class="ident" id="6774859">err</span>&nbsp;<span class="op" id="6774863">!=</span>&nbsp;<span class="ident" id="6774866">nil</span>&nbsp;<span class="op" id="6774870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774874">t</span><span class="op" id="6774875">.</span><span class="ident" id="6774876">Fatal</span><span class="op" id="6774881">(</span><span class="ident" id="6774882">err</span><span class="op" id="6774885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6774888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774891">defer</span>&nbsp;<span class="ident" id="6774897">f</span><span class="op" id="6774898">.</span><span class="ident" id="6774899">Close</span><span class="op" id="6774904">(</span><span class="op" id="6774905">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774908">mr</span>&nbsp;<span class="op" id="6774911">:=</span>&nbsp;<span class="ident" id="6774914">NewReader</span><span class="op" id="6774923">(</span><span class="ident" id="6774924">f</span><span class="op" id="6774925">,</span>&nbsp;<span class="string" id="6774927">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="6774957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6774960">p</span><span class="op" id="6774961">,</span>&nbsp;<span class="ident" id="6774963">err</span>&nbsp;<span class="op" id="6774967">:=</span>&nbsp;<span class="ident" id="6774970">mr</span><span class="op" id="6774972">.</span><span class="ident" id="6774973">NextPart</span><span class="op" id="6774981">(</span><span class="op" id="6774982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6774985">if</span>&nbsp;<span class="ident" id="6774988">err</span>&nbsp;<span class="op" id="6774992">!=</span>&nbsp;<span class="ident" id="6774995">nil</span>&nbsp;<span class="op" id="6774999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775003">t</span><span class="op" id="6775004">.</span><span class="ident" id="6775005">Fatalf</span><span class="op" id="6775011">(</span><span class="string" id="6775012">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="6775059">,</span>&nbsp;<span class="ident" id="6775061">err</span><span class="op" id="6775064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775067">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6775071">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775154">mr2</span>&nbsp;<span class="op" id="6775158">:=</span>&nbsp;<span class="ident" id="6775161">NewReader</span><span class="op" id="6775170">(</span><span class="ident" id="6775171">p</span><span class="op" id="6775172">,</span>&nbsp;<span class="string" id="6775174">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="6775204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775207">p</span><span class="op" id="6775208">,</span>&nbsp;<span class="ident" id="6775210">err</span>&nbsp;<span class="op" id="6775214">=</span>&nbsp;<span class="ident" id="6775216">mr2</span><span class="op" id="6775219">.</span><span class="ident" id="6775220">NextPart</span><span class="op" id="6775228">(</span><span class="op" id="6775229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775232">if</span>&nbsp;<span class="ident" id="6775235">err</span>&nbsp;<span class="op" id="6775239">!=</span>&nbsp;<span class="ident" id="6775242">nil</span>&nbsp;<span class="op" id="6775246">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775250">t</span><span class="op" id="6775251">.</span><span class="ident" id="6775252">Fatalf</span><span class="op" id="6775258">(</span><span class="string" id="6775259">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6775288">,</span>&nbsp;<span class="ident" id="6775290">err</span><span class="op" id="6775293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775299">if</span>&nbsp;<span class="ident" id="6775302">b</span><span class="op" id="6775303">,</span>&nbsp;<span class="ident" id="6775305">err</span>&nbsp;<span class="op" id="6775309">:=</span>&nbsp;<span class="ident" id="6775312">ioutil</span><span class="op" id="6775318">.</span><span class="ident" id="6775319">ReadAll</span><span class="op" id="6775326">(</span><span class="ident" id="6775327">p</span><span class="op" id="6775328">)</span><span class="op" id="6775329">;</span>&nbsp;<span class="builtintype" id="6775331">string</span><span class="op" id="6775337">(</span><span class="ident" id="6775338">b</span><span class="op" id="6775339">)</span>&nbsp;<span class="op" id="6775341">!=</span>&nbsp;<span class="string" id="6775344">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="6775357">||</span>&nbsp;<span class="ident" id="6775360">err</span>&nbsp;<span class="op" id="6775364">!=</span>&nbsp;<span class="ident" id="6775367">nil</span>&nbsp;<span class="op" id="6775371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775375">t</span><span class="op" id="6775376">.</span><span class="ident" id="6775377">Fatalf</span><span class="op" id="6775383">(</span><span class="string" id="6775384">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6775421">,</span>&nbsp;<span class="ident" id="6775423">b</span><span class="op" id="6775424">,</span>&nbsp;<span class="ident" id="6775426">err</span><span class="op" id="6775429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775432">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775435">p</span><span class="op" id="6775436">,</span>&nbsp;<span class="ident" id="6775438">err</span>&nbsp;<span class="op" id="6775442">=</span>&nbsp;<span class="ident" id="6775444">mr2</span><span class="op" id="6775447">.</span><span class="ident" id="6775448">NextPart</span><span class="op" id="6775456">(</span><span class="op" id="6775457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775460">if</span>&nbsp;<span class="ident" id="6775463">err</span>&nbsp;<span class="op" id="6775467">!=</span>&nbsp;<span class="ident" id="6775470">nil</span>&nbsp;<span class="op" id="6775474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775478">t</span><span class="op" id="6775479">.</span><span class="ident" id="6775480">Fatalf</span><span class="op" id="6775486">(</span><span class="string" id="6775487">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6775515">,</span>&nbsp;<span class="ident" id="6775517">err</span><span class="op" id="6775520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775526">if</span>&nbsp;<span class="ident" id="6775529">b</span><span class="op" id="6775530">,</span>&nbsp;<span class="ident" id="6775532">err</span>&nbsp;<span class="op" id="6775536">:=</span>&nbsp;<span class="ident" id="6775539">ioutil</span><span class="op" id="6775545">.</span><span class="ident" id="6775546">ReadAll</span><span class="op" id="6775553">(</span><span class="ident" id="6775554">p</span><span class="op" id="6775555">)</span><span class="op" id="6775556">;</span>&nbsp;<span class="builtintype" id="6775558">string</span><span class="op" id="6775564">(</span><span class="ident" id="6775565">b</span><span class="op" id="6775566">)</span>&nbsp;<span class="op" id="6775568">!=</span>&nbsp;<span class="string" id="6775571">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="6775589">||</span>&nbsp;<span class="ident" id="6775592">err</span>&nbsp;<span class="op" id="6775596">!=</span>&nbsp;<span class="ident" id="6775599">nil</span>&nbsp;<span class="op" id="6775603">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775607">t</span><span class="op" id="6775608">.</span><span class="ident" id="6775609">Fatalf</span><span class="op" id="6775615">(</span><span class="string" id="6775616">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6775652">,</span>&nbsp;<span class="ident" id="6775654">b</span><span class="op" id="6775655">,</span>&nbsp;<span class="ident" id="6775657">err</span><span class="op" id="6775660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775667">p</span><span class="op" id="6775668">,</span>&nbsp;<span class="ident" id="6775670">err</span>&nbsp;<span class="op" id="6775674">=</span>&nbsp;<span class="ident" id="6775676">mr2</span><span class="op" id="6775679">.</span><span class="ident" id="6775680">NextPart</span><span class="op" id="6775688">(</span><span class="op" id="6775689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775692">if</span>&nbsp;<span class="ident" id="6775695">err</span>&nbsp;<span class="op" id="6775699">!=</span>&nbsp;<span class="ident" id="6775702">io</span><span class="op" id="6775704">.</span><span class="ident" id="6775705">EOF</span>&nbsp;<span class="op" id="6775709">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775713">t</span><span class="op" id="6775714">.</span><span class="ident" id="6775715">Fatalf</span><span class="op" id="6775721">(</span><span class="string" id="6775722">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6775762">,</span>&nbsp;<span class="ident" id="6775764">err</span><span class="op" id="6775767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6775774">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775843">_</span><span class="op" id="6775844">,</span>&nbsp;<span class="ident" id="6775846">err</span>&nbsp;<span class="op" id="6775850">=</span>&nbsp;<span class="ident" id="6775852">mr</span><span class="op" id="6775854">.</span><span class="ident" id="6775855">NextPart</span><span class="op" id="6775863">(</span><span class="op" id="6775864">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775867">if</span>&nbsp;<span class="ident" id="6775870">err</span>&nbsp;<span class="op" id="6775874">!=</span>&nbsp;<span class="ident" id="6775877">nil</span>&nbsp;<span class="op" id="6775881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775885">t</span><span class="op" id="6775886">.</span><span class="ident" id="6775887">Fatalf</span><span class="op" id="6775893">(</span><span class="string" id="6775894">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="6775945">,</span>&nbsp;<span class="ident" id="6775947">err</span><span class="op" id="6775950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6775953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6775957">_</span><span class="op" id="6775958">,</span>&nbsp;<span class="ident" id="6775960">err</span>&nbsp;<span class="op" id="6775964">=</span>&nbsp;<span class="ident" id="6775966">mr</span><span class="op" id="6775968">.</span><span class="ident" id="6775969">NextPart</span><span class="op" id="6775977">(</span><span class="op" id="6775978">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6775981">if</span>&nbsp;<span class="ident" id="6775984">err</span>&nbsp;<span class="op" id="6775988">!=</span>&nbsp;<span class="ident" id="6775991">io</span><span class="op" id="6775993">.</span><span class="ident" id="6775994">EOF</span>&nbsp;<span class="op" id="6775998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776002">t</span><span class="op" id="6776003">.</span><span class="ident" id="6776004">Fatalf</span><span class="op" id="6776010">(</span><span class="string" id="6776011">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6776051">,</span>&nbsp;<span class="ident" id="6776053">err</span><span class="op" id="6776056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776059">}</span><br>
<span class="lineno"></span><span class="op" id="6776061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="6776064">type</span>&nbsp;<span class="ident" id="6776069">headerBody</span>&nbsp;<span class="keyword" id="6776080">struct</span>&nbsp;<span class="op" id="6776087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776090">header</span>&nbsp;<span class="ident" id="6776097">textproto</span><span class="op" id="6776106">.</span><span class="ident" id="6776107">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776119">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6776126">string</span><br>
<span class="lineno"></span><span class="op" id="6776133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6776136">func</span>&nbsp;<span class="ident" id="6776141">formData</span><span class="op" id="6776149">(</span><span class="ident" id="6776150">key</span><span class="op" id="6776153">,</span>&nbsp;<span class="ident" id="6776155">value</span>&nbsp;<span class="builtintype" id="6776161">string</span><span class="op" id="6776167">)</span>&nbsp;<span class="ident" id="6776169">headerBody</span>&nbsp;<span class="op" id="6776180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6776183">return</span>&nbsp;<span class="ident" id="6776190">headerBody</span><span class="op" id="6776200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776204">textproto</span><span class="op" id="6776213">.</span><span class="ident" id="6776214">MIMEHeader</span><span class="op" id="6776224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6776229">&#34;Content-Type&#34;</span><span class="op" id="6776243">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776252">{</span><span class="string" id="6776253">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="6776285">}</span><span class="op" id="6776286">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6776291">&#34;Content-Disposition&#34;</span><span class="op" id="6776312">:</span>&nbsp;<span class="op" id="6776314">{</span><span class="string" id="6776315">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="6776334">+</span>&nbsp;<span class="ident" id="6776336">key</span><span class="op" id="6776339">}</span><span class="op" id="6776340">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776344">}</span><span class="op" id="6776345">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776349">value</span><span class="op" id="6776354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776357">}</span><br>
<span class="lineno"></span><span class="op" id="6776359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="6776362">type</span>&nbsp;<span class="ident" id="6776367">parseTest</span>&nbsp;<span class="keyword" id="6776377">struct</span>&nbsp;<span class="op" id="6776384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776387">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6776395">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776403">in</span><span class="op" id="6776405">,</span>&nbsp;<span class="ident" id="6776407">sep</span>&nbsp;<span class="builtintype" id="6776411">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776419">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6776427">[</span><span class="op" id="6776428">]</span><span class="ident" id="6776429">headerBody</span><br>
<span class="lineno"></span><span class="op" id="6776440">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6776443">var</span>&nbsp;<span class="ident" id="6776447">parseTests</span>&nbsp;<span class="op" id="6776458">=</span>&nbsp;<span class="op" id="6776460">[</span><span class="op" id="6776461">]</span><span class="ident" id="6776462">parseTest</span><span class="op" id="6776471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776474">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776544">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776613">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776679">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776742">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6776808">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6776871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776875">name</span><span class="op" id="6776879">:</span>&nbsp;<span class="string" id="6776881">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="6776898">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776902">sep</span><span class="op" id="6776905">:</span>&nbsp;&nbsp;<span class="string" id="6776908">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="6776938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6776942">in</span><span class="op" id="6776944">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6776948">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="6778856">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778860">want</span><span class="op" id="6778864">:</span>&nbsp;<span class="op" id="6778866">[</span><span class="op" id="6778867">]</span><span class="ident" id="6778868">headerBody</span><span class="op" id="6778878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778883">formData</span><span class="op" id="6778891">(</span><span class="string" id="6778892">&#34;otherEmpty1&#34;</span><span class="op" id="6778905">,</span>&nbsp;<span class="string" id="6778907">&#34;&#34;</span><span class="op" id="6778909">)</span><span class="op" id="6778910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778915">formData</span><span class="op" id="6778923">(</span><span class="string" id="6778924">&#34;otherFoo1&#34;</span><span class="op" id="6778935">,</span>&nbsp;<span class="string" id="6778937">&#34;foo&#34;</span><span class="op" id="6778942">)</span><span class="op" id="6778943">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778948">formData</span><span class="op" id="6778956">(</span><span class="string" id="6778957">&#34;otherFoo2&#34;</span><span class="op" id="6778968">,</span>&nbsp;<span class="string" id="6778970">&#34;foo&#34;</span><span class="op" id="6778975">)</span><span class="op" id="6778976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6778981">formData</span><span class="op" id="6778989">(</span><span class="string" id="6778990">&#34;otherEmpty2&#34;</span><span class="op" id="6779003">,</span>&nbsp;<span class="string" id="6779005">&#34;&#34;</span><span class="op" id="6779007">)</span><span class="op" id="6779008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779013">formData</span><span class="op" id="6779021">(</span><span class="string" id="6779022">&#34;otherRepeatFoo&#34;</span><span class="op" id="6779038">,</span>&nbsp;<span class="string" id="6779040">&#34;foo&#34;</span><span class="op" id="6779045">)</span><span class="op" id="6779046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779051">formData</span><span class="op" id="6779059">(</span><span class="string" id="6779060">&#34;otherRepeatFoo&#34;</span><span class="op" id="6779076">,</span>&nbsp;<span class="string" id="6779078">&#34;foo&#34;</span><span class="op" id="6779083">)</span><span class="op" id="6779084">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779089">formData</span><span class="op" id="6779097">(</span><span class="string" id="6779098">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6779116">,</span>&nbsp;<span class="string" id="6779118">&#34;&#34;</span><span class="op" id="6779120">)</span><span class="op" id="6779121">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779126">formData</span><span class="op" id="6779134">(</span><span class="string" id="6779135">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6779153">,</span>&nbsp;<span class="string" id="6779155">&#34;&#34;</span><span class="op" id="6779157">)</span><span class="op" id="6779158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779163">formData</span><span class="op" id="6779171">(</span><span class="string" id="6779172">&#34;submit&#34;</span><span class="op" id="6779180">,</span>&nbsp;<span class="string" id="6779182">&#34;Submit&#34;</span><span class="op" id="6779190">)</span><span class="op" id="6779191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779196">{</span><span class="ident" id="6779197">textproto</span><span class="op" id="6779206">.</span><span class="ident" id="6779207">MIMEHeader</span><span class="op" id="6779217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6779223">&#34;Content-Type&#34;</span><span class="op" id="6779237">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6779246">{</span><span class="string" id="6779247">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="6779463">}</span><span class="op" id="6779464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6779470">&#34;Content-Disposition&#34;</span><span class="op" id="6779491">:</span>&nbsp;<span class="op" id="6779493">{</span><span class="string" id="6779494">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="6779539">}</span><span class="op" id="6779540">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779545">}</span><span class="op" id="6779546">,</span>&nbsp;<span class="string" id="6779548">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="6779795">}</span><span class="op" id="6779796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779800">}</span><span class="op" id="6779801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779804">}</span><span class="op" id="6779805">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6779809">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6779881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779885">name</span><span class="op" id="6779889">:</span>&nbsp;<span class="string" id="6779891">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="6779922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779926">sep</span><span class="op" id="6779929">:</span>&nbsp;&nbsp;<span class="string" id="6779932">&#34;abc&#34;</span><span class="op" id="6779937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779941">in</span><span class="op" id="6779943">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6779947">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="6779981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6779985">want</span><span class="op" id="6779989">:</span>&nbsp;<span class="op" id="6779991">[</span><span class="op" id="6779992">]</span><span class="ident" id="6779993">headerBody</span><span class="op" id="6780003">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780008">{</span><span class="ident" id="6780009">textproto</span><span class="op" id="6780018">.</span><span class="ident" id="6780019">MIMEHeader</span><span class="op" id="6780029">{</span><span class="string" id="6780030">&#34;Foo&#34;</span><span class="op" id="6780035">:</span>&nbsp;<span class="op" id="6780037">{</span><span class="string" id="6780038">&#34;bar&#34;</span><span class="op" id="6780043">}</span><span class="op" id="6780044">}</span><span class="op" id="6780045">,</span>&nbsp;<span class="string" id="6780047">&#34;&#34;</span><span class="op" id="6780049">}</span><span class="op" id="6780050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780054">}</span><span class="op" id="6780055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780058">}</span><span class="op" id="6780059">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6780063">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780143">name</span><span class="op" id="6780147">:</span>&nbsp;<span class="string" id="6780149">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="6780184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780188">sep</span><span class="op" id="6780191">:</span>&nbsp;&nbsp;<span class="string" id="6780194">&#34;abc&#34;</span><span class="op" id="6780199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780203">in</span><span class="op" id="6780205">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6780209">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="6780247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780251">want</span><span class="op" id="6780255">:</span>&nbsp;<span class="op" id="6780257">[</span><span class="op" id="6780258">]</span><span class="ident" id="6780259">headerBody</span><span class="op" id="6780269">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780274">{</span><span class="ident" id="6780275">textproto</span><span class="op" id="6780284">.</span><span class="ident" id="6780285">MIMEHeader</span><span class="op" id="6780295">{</span><span class="string" id="6780296">&#34;Foo&#34;</span><span class="op" id="6780301">:</span>&nbsp;<span class="op" id="6780303">{</span><span class="string" id="6780304">&#34;bar&#34;</span><span class="op" id="6780309">}</span><span class="op" id="6780310">}</span><span class="op" id="6780311">,</span>&nbsp;<span class="string" id="6780313">&#34;&#34;</span><span class="op" id="6780315">}</span><span class="op" id="6780316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780320">}</span><span class="op" id="6780321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780324">}</span><span class="op" id="6780325">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6780329">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780355">name</span><span class="op" id="6780359">:</span>&nbsp;<span class="string" id="6780361">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="6780379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780383">sep</span><span class="op" id="6780386">:</span>&nbsp;&nbsp;<span class="string" id="6780389">&#34;abc&#34;</span><span class="op" id="6780394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780398">in</span><span class="op" id="6780400">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6780404">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="6780465">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780469">want</span><span class="op" id="6780473">:</span>&nbsp;<span class="op" id="6780475">[</span><span class="op" id="6780476">]</span><span class="ident" id="6780477">headerBody</span><span class="op" id="6780487">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780492">{</span><span class="ident" id="6780493">textproto</span><span class="op" id="6780502">.</span><span class="ident" id="6780503">MIMEHeader</span><span class="op" id="6780513">{</span><span class="string" id="6780514">&#34;Foo&#34;</span><span class="op" id="6780519">:</span>&nbsp;<span class="op" id="6780521">{</span><span class="string" id="6780522">&#34;bar&#34;</span><span class="op" id="6780527">}</span><span class="op" id="6780528">}</span><span class="op" id="6780529">,</span>&nbsp;<span class="string" id="6780531">&#34;&#34;</span><span class="op" id="6780533">}</span><span class="op" id="6780534">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780539">{</span><span class="ident" id="6780540">textproto</span><span class="op" id="6780549">.</span><span class="ident" id="6780550">MIMEHeader</span><span class="op" id="6780560">{</span><span class="string" id="6780561">&#34;Foo2&#34;</span><span class="op" id="6780567">:</span>&nbsp;<span class="op" id="6780569">{</span><span class="string" id="6780570">&#34;bar2&#34;</span><span class="op" id="6780576">}</span><span class="op" id="6780577">}</span><span class="op" id="6780578">,</span>&nbsp;<span class="string" id="6780580">&#34;&#34;</span><span class="op" id="6780582">}</span><span class="op" id="6780583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780587">}</span><span class="op" id="6780588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780591">}</span><span class="op" id="6780592">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6780596">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780658">name</span><span class="op" id="6780662">:</span>&nbsp;<span class="string" id="6780664">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="6780692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780696">sep</span><span class="op" id="6780699">:</span>&nbsp;&nbsp;<span class="string" id="6780702">&#34;abc&#34;</span><span class="op" id="6780707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780711">in</span><span class="op" id="6780713">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6780717">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="6780755">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780759">want</span><span class="op" id="6780763">:</span>&nbsp;<span class="op" id="6780765">[</span><span class="op" id="6780766">]</span><span class="ident" id="6780767">headerBody</span><span class="op" id="6780777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780782">{</span><span class="ident" id="6780783">textproto</span><span class="op" id="6780792">.</span><span class="ident" id="6780793">MIMEHeader</span><span class="op" id="6780803">{</span><span class="string" id="6780804">&#34;Foo&#34;</span><span class="op" id="6780809">:</span>&nbsp;<span class="op" id="6780811">{</span><span class="string" id="6780812">&#34;bar&#34;</span><span class="op" id="6780817">}</span><span class="op" id="6780818">}</span><span class="op" id="6780819">,</span>&nbsp;<span class="string" id="6780821">&#34;&#34;</span><span class="op" id="6780823">}</span><span class="op" id="6780824">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780828">}</span><span class="op" id="6780829">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780832">}</span><span class="op" id="6780833">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6780837">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6780897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780901">name</span><span class="op" id="6780905">:</span>&nbsp;<span class="string" id="6780907">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="6780935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780939">sep</span><span class="op" id="6780942">:</span>&nbsp;&nbsp;<span class="string" id="6780945">&#34;abc&#34;</span><span class="op" id="6780950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6780954">in</span><span class="op" id="6780956">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6780960">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="6780997">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781001">want</span><span class="op" id="6781005">:</span>&nbsp;<span class="op" id="6781007">[</span><span class="op" id="6781008">]</span><span class="ident" id="6781009">headerBody</span><span class="op" id="6781019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781024">{</span><span class="ident" id="6781025">textproto</span><span class="op" id="6781034">.</span><span class="ident" id="6781035">MIMEHeader</span><span class="op" id="6781045">{</span><span class="string" id="6781046">&#34;Foo&#34;</span><span class="op" id="6781051">:</span>&nbsp;<span class="op" id="6781053">{</span><span class="string" id="6781054">&#34;bar&#34;</span><span class="op" id="6781059">}</span><span class="op" id="6781060">}</span><span class="op" id="6781061">,</span>&nbsp;<span class="string" id="6781063">&#34;&#34;</span><span class="op" id="6781065">}</span><span class="op" id="6781066">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781070">}</span><span class="op" id="6781071">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781074">}</span><span class="op" id="6781075">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6781079">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781132">name</span><span class="op" id="6781136">:</span>&nbsp;<span class="string" id="6781138">&#34;no&nbsp;parts&#34;</span><span class="op" id="6781148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781152">sep</span><span class="op" id="6781155">:</span>&nbsp;&nbsp;<span class="string" id="6781158">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="6781198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781202">in</span><span class="op" id="6781204">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6781208">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="6781256">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781260">want</span><span class="op" id="6781264">:</span>&nbsp;<span class="op" id="6781266">[</span><span class="op" id="6781267">]</span><span class="ident" id="6781268">headerBody</span><span class="op" id="6781278">{</span><span class="op" id="6781279">}</span><span class="op" id="6781280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781283">}</span><span class="op" id="6781284">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6781288">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781369">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781373">name</span><span class="op" id="6781377">:</span>&nbsp;<span class="string" id="6781379">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="6781403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781407">sep</span><span class="op" id="6781410">:</span>&nbsp;&nbsp;<span class="string" id="6781413">&#34;sep&#34;</span><span class="op" id="6781418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781422">in</span><span class="op" id="6781424">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6781428">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="6781475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781479">want</span><span class="op" id="6781483">:</span>&nbsp;<span class="op" id="6781485">[</span><span class="op" id="6781486">]</span><span class="ident" id="6781487">headerBody</span><span class="op" id="6781497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781502">{</span><span class="ident" id="6781503">textproto</span><span class="op" id="6781512">.</span><span class="ident" id="6781513">MIMEHeader</span><span class="op" id="6781523">{</span><span class="string" id="6781524">&#34;Foo&#34;</span><span class="op" id="6781529">:</span>&nbsp;<span class="op" id="6781531">{</span><span class="string" id="6781532">&#34;bar&#34;</span><span class="op" id="6781537">}</span><span class="op" id="6781538">}</span><span class="op" id="6781539">,</span>&nbsp;<span class="string" id="6781541">&#34;--sepFAKE&#34;</span><span class="op" id="6781552">}</span><span class="op" id="6781553">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781557">}</span><span class="op" id="6781558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781561">}</span><span class="op" id="6781562">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6781566">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781627">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781631">name</span><span class="op" id="6781635">:</span>&nbsp;<span class="string" id="6781637">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="6781663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781667">sep</span><span class="op" id="6781670">:</span>&nbsp;&nbsp;<span class="string" id="6781673">&#34;sep&#34;</span><span class="op" id="6781678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781682">in</span><span class="op" id="6781684">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6781688">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="6781731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781735">want</span><span class="op" id="6781739">:</span>&nbsp;<span class="op" id="6781741">[</span><span class="op" id="6781742">]</span><span class="ident" id="6781743">headerBody</span><span class="op" id="6781753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781758">{</span><span class="ident" id="6781759">textproto</span><span class="op" id="6781768">.</span><span class="ident" id="6781769">MIMEHeader</span><span class="op" id="6781779">{</span><span class="string" id="6781780">&#34;Foo&#34;</span><span class="op" id="6781785">:</span>&nbsp;<span class="op" id="6781787">{</span><span class="string" id="6781788">&#34;bar&#34;</span><span class="op" id="6781793">}</span><span class="op" id="6781794">}</span><span class="op" id="6781795">,</span>&nbsp;<span class="string" id="6781797">&#34;text&#34;</span><span class="op" id="6781803">}</span><span class="op" id="6781804">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781808">}</span><span class="op" id="6781809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781812">}</span><span class="op" id="6781813">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6781817">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6781848">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781852">name</span><span class="op" id="6781856">:</span>&nbsp;<span class="string" id="6781858">&#34;leading&nbsp;line&#34;</span><span class="op" id="6781872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781876">sep</span><span class="op" id="6781879">:</span>&nbsp;&nbsp;<span class="string" id="6781882">&#34;MyBoundary&#34;</span><span class="op" id="6781894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6781898">in</span><span class="op" id="6781900">:</span>&nbsp;<span class="ident" id="6781902">strings</span><span class="op" id="6781909">.</span><span class="ident" id="6781910">Replace</span><span class="op" id="6781917">(</span><span class="string" id="6781918">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="6782011">,</span>&nbsp;<span class="string" id="6782013">&#34;\n&#34;</span><span class="op" id="6782017">,</span>&nbsp;<span class="string" id="6782019">&#34;\r\n&#34;</span><span class="op" id="6782025">,</span>&nbsp;<span class="op" id="6782027">-</span><span class="num" id="6782028">1</span><span class="op" id="6782029">)</span><span class="op" id="6782030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782034">want</span><span class="op" id="6782038">:</span>&nbsp;<span class="op" id="6782040">[</span><span class="op" id="6782041">]</span><span class="ident" id="6782042">headerBody</span><span class="op" id="6782052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782057">{</span><span class="ident" id="6782058">textproto</span><span class="op" id="6782067">.</span><span class="ident" id="6782068">MIMEHeader</span><span class="op" id="6782078">{</span><span class="string" id="6782079">&#34;Foo&#34;</span><span class="op" id="6782084">:</span>&nbsp;<span class="op" id="6782086">{</span><span class="string" id="6782087">&#34;bar&#34;</span><span class="op" id="6782092">}</span><span class="op" id="6782093">}</span><span class="op" id="6782094">,</span>&nbsp;<span class="string" id="6782096">&#34;&#34;</span><span class="op" id="6782098">}</span><span class="op" id="6782099">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782103">}</span><span class="op" id="6782104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782107">}</span><span class="op" id="6782108">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782112">roundTripParseTest</span><span class="op" id="6782130">(</span><span class="op" id="6782131">)</span><span class="op" id="6782132">,</span><br>
<span class="lineno"></span><span class="op" id="6782134">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="6782137">func</span>&nbsp;<span class="ident" id="6782142">TestParse</span><span class="op" id="6782151">(</span><span class="ident" id="6782152">t</span>&nbsp;<span class="op" id="6782154">*</span><span class="ident" id="6782155">testing</span><span class="op" id="6782162">.</span><span class="ident" id="6782163">T</span><span class="op" id="6782164">)</span>&nbsp;<span class="op" id="6782166">{</span><br>
<span class="lineno"></span><span class="ident" id="6782168">Cases</span><span class="op" id="6782173">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782176">for</span>&nbsp;<span class="ident" id="6782180">_</span><span class="op" id="6782181">,</span>&nbsp;<span class="ident" id="6782183">tt</span>&nbsp;<span class="op" id="6782186">:=</span>&nbsp;<span class="keyword" id="6782189">range</span>&nbsp;<span class="ident" id="6782195">parseTests</span>&nbsp;<span class="op" id="6782206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782210">r</span>&nbsp;<span class="op" id="6782212">:=</span>&nbsp;<span class="ident" id="6782215">NewReader</span><span class="op" id="6782224">(</span><span class="ident" id="6782225">strings</span><span class="op" id="6782232">.</span><span class="ident" id="6782233">NewReader</span><span class="op" id="6782242">(</span><span class="ident" id="6782243">tt</span><span class="op" id="6782245">.</span><span class="ident" id="6782246">in</span><span class="op" id="6782248">)</span><span class="op" id="6782249">,</span>&nbsp;<span class="ident" id="6782251">tt</span><span class="op" id="6782253">.</span><span class="ident" id="6782254">sep</span><span class="op" id="6782257">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782261">got</span>&nbsp;<span class="op" id="6782265">:=</span>&nbsp;<span class="op" id="6782268">[</span><span class="op" id="6782269">]</span><span class="ident" id="6782270">headerBody</span><span class="op" id="6782280">{</span><span class="op" id="6782281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782285">for</span>&nbsp;<span class="op" id="6782289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782294">p</span><span class="op" id="6782295">,</span>&nbsp;<span class="ident" id="6782297">err</span>&nbsp;<span class="op" id="6782301">:=</span>&nbsp;<span class="ident" id="6782304">r</span><span class="op" id="6782305">.</span><span class="ident" id="6782306">NextPart</span><span class="op" id="6782314">(</span><span class="op" id="6782315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782320">if</span>&nbsp;<span class="ident" id="6782323">err</span>&nbsp;<span class="op" id="6782327">==</span>&nbsp;<span class="ident" id="6782330">io</span><span class="op" id="6782332">.</span><span class="ident" id="6782333">EOF</span>&nbsp;<span class="op" id="6782337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782343">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782357">if</span>&nbsp;<span class="ident" id="6782360">err</span>&nbsp;<span class="op" id="6782364">!=</span>&nbsp;<span class="ident" id="6782367">nil</span>&nbsp;<span class="op" id="6782371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782377">t</span><span class="op" id="6782378">.</span><span class="ident" id="6782379">Errorf</span><span class="op" id="6782385">(</span><span class="string" id="6782386">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="6782412">,</span>&nbsp;<span class="ident" id="6782414">tt</span><span class="op" id="6782416">.</span><span class="ident" id="6782417">name</span><span class="op" id="6782421">,</span>&nbsp;<span class="ident" id="6782423">err</span><span class="op" id="6782426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782432">continue</span>&nbsp;<span class="ident" id="6782441">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782450">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782455">pbody</span><span class="op" id="6782460">,</span>&nbsp;<span class="ident" id="6782462">err</span>&nbsp;<span class="op" id="6782466">:=</span>&nbsp;<span class="ident" id="6782469">ioutil</span><span class="op" id="6782475">.</span><span class="ident" id="6782476">ReadAll</span><span class="op" id="6782483">(</span><span class="ident" id="6782484">p</span><span class="op" id="6782485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782490">if</span>&nbsp;<span class="ident" id="6782493">err</span>&nbsp;<span class="op" id="6782497">!=</span>&nbsp;<span class="ident" id="6782500">nil</span>&nbsp;<span class="op" id="6782504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782510">t</span><span class="op" id="6782511">.</span><span class="ident" id="6782512">Errorf</span><span class="op" id="6782518">(</span><span class="string" id="6782519">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6782555">,</span>&nbsp;<span class="ident" id="6782557">tt</span><span class="op" id="6782559">.</span><span class="ident" id="6782560">name</span><span class="op" id="6782564">,</span>&nbsp;<span class="ident" id="6782566">err</span><span class="op" id="6782569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782575">continue</span>&nbsp;<span class="ident" id="6782584">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782593">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782598">got</span>&nbsp;<span class="op" id="6782602">=</span>&nbsp;<span class="builtinfunc" id="6782604">append</span><span class="op" id="6782610">(</span><span class="ident" id="6782611">got</span><span class="op" id="6782614">,</span>&nbsp;<span class="ident" id="6782616">headerBody</span><span class="op" id="6782626">{</span><span class="ident" id="6782627">p</span><span class="op" id="6782628">.</span><span class="ident" id="6782629">Header</span><span class="op" id="6782635">,</span>&nbsp;<span class="builtintype" id="6782637">string</span><span class="op" id="6782643">(</span><span class="ident" id="6782644">pbody</span><span class="op" id="6782649">)</span><span class="op" id="6782650">}</span><span class="op" id="6782651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782659">if</span>&nbsp;<span class="op" id="6782662">!</span><span class="ident" id="6782663">reflect</span><span class="op" id="6782670">.</span><span class="ident" id="6782671">DeepEqual</span><span class="op" id="6782680">(</span><span class="ident" id="6782681">tt</span><span class="op" id="6782683">.</span><span class="ident" id="6782684">want</span><span class="op" id="6782688">,</span>&nbsp;<span class="ident" id="6782690">got</span><span class="op" id="6782693">)</span>&nbsp;<span class="op" id="6782695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782700">t</span><span class="op" id="6782701">.</span><span class="ident" id="6782702">Errorf</span><span class="op" id="6782708">(</span><span class="string" id="6782709">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6782739">,</span>&nbsp;<span class="ident" id="6782741">tt</span><span class="op" id="6782743">.</span><span class="ident" id="6782744">name</span><span class="op" id="6782748">,</span>&nbsp;<span class="ident" id="6782750">got</span><span class="op" id="6782753">,</span>&nbsp;<span class="ident" id="6782755">tt</span><span class="op" id="6782757">.</span><span class="ident" id="6782758">want</span><span class="op" id="6782762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782767">if</span>&nbsp;<span class="builtinfunc" id="6782770">len</span><span class="op" id="6782773">(</span><span class="ident" id="6782774">tt</span><span class="op" id="6782776">.</span><span class="ident" id="6782777">want</span><span class="op" id="6782781">)</span>&nbsp;<span class="op" id="6782783">!=</span>&nbsp;<span class="builtinfunc" id="6782786">len</span><span class="op" id="6782789">(</span><span class="ident" id="6782790">got</span><span class="op" id="6782793">)</span>&nbsp;<span class="op" id="6782795">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782801">t</span><span class="op" id="6782802">.</span><span class="ident" id="6782803">Errorf</span><span class="op" id="6782809">(</span><span class="string" id="6782810">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6782842">,</span>&nbsp;<span class="ident" id="6782844">tt</span><span class="op" id="6782846">.</span><span class="ident" id="6782847">name</span><span class="op" id="6782851">,</span>&nbsp;<span class="builtinfunc" id="6782853">len</span><span class="op" id="6782856">(</span><span class="ident" id="6782857">got</span><span class="op" id="6782860">)</span><span class="op" id="6782861">,</span>&nbsp;<span class="builtinfunc" id="6782863">len</span><span class="op" id="6782866">(</span><span class="ident" id="6782867">tt</span><span class="op" id="6782869">.</span><span class="ident" id="6782870">want</span><span class="op" id="6782874">)</span><span class="op" id="6782875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6782880">}</span>&nbsp;<span class="keyword" id="6782882">else</span>&nbsp;<span class="keyword" id="6782887">if</span>&nbsp;<span class="builtinfunc" id="6782890">len</span><span class="op" id="6782893">(</span><span class="ident" id="6782894">got</span><span class="op" id="6782897">)</span>&nbsp;<span class="op" id="6782899">&gt;</span>&nbsp;<span class="num" id="6782901">1</span>&nbsp;<span class="op" id="6782903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782909">for</span>&nbsp;<span class="ident" id="6782913">pi</span><span class="op" id="6782915">,</span>&nbsp;<span class="ident" id="6782917">wantPart</span>&nbsp;<span class="op" id="6782926">:=</span>&nbsp;<span class="keyword" id="6782929">range</span>&nbsp;<span class="ident" id="6782935">tt</span><span class="op" id="6782937">.</span><span class="ident" id="6782938">want</span>&nbsp;<span class="op" id="6782943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6782950">if</span>&nbsp;<span class="op" id="6782953">!</span><span class="ident" id="6782954">reflect</span><span class="op" id="6782961">.</span><span class="ident" id="6782962">DeepEqual</span><span class="op" id="6782971">(</span><span class="ident" id="6782972">wantPart</span><span class="op" id="6782980">,</span>&nbsp;<span class="ident" id="6782982">got</span><span class="op" id="6782985">[</span><span class="ident" id="6782986">pi</span><span class="op" id="6782988">]</span><span class="op" id="6782989">)</span>&nbsp;<span class="op" id="6782991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6782999">t</span><span class="op" id="6783000">.</span><span class="ident" id="6783001">Errorf</span><span class="op" id="6783007">(</span><span class="string" id="6783008">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6783047">,</span>&nbsp;<span class="ident" id="6783049">tt</span><span class="op" id="6783051">.</span><span class="ident" id="6783052">name</span><span class="op" id="6783056">,</span>&nbsp;<span class="ident" id="6783058">pi</span><span class="op" id="6783060">,</span>&nbsp;<span class="ident" id="6783062">got</span><span class="op" id="6783065">[</span><span class="ident" id="6783066">pi</span><span class="op" id="6783068">]</span><span class="op" id="6783069">,</span>&nbsp;<span class="ident" id="6783071">wantPart</span><span class="op" id="6783079">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783104">}</span><br>
<span class="lineno">605</span><span class="op" id="6783106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6783109">func</span>&nbsp;<span class="ident" id="6783114">roundTripParseTest</span><span class="op" id="6783132">(</span><span class="op" id="6783133">)</span>&nbsp;<span class="ident" id="6783135">parseTest</span>&nbsp;<span class="op" id="6783145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783148">t</span>&nbsp;<span class="op" id="6783150">:=</span>&nbsp;<span class="ident" id="6783153">parseTest</span><span class="op" id="6783162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783166">name</span><span class="op" id="6783170">:</span>&nbsp;<span class="string" id="6783172">&#34;round&nbsp;trip&#34;</span><span class="op" id="6783184">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783188">want</span><span class="op" id="6783192">:</span>&nbsp;<span class="op" id="6783194">[</span><span class="op" id="6783195">]</span><span class="ident" id="6783196">headerBody</span><span class="op" id="6783206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783211">formData</span><span class="op" id="6783219">(</span><span class="string" id="6783220">&#34;empty&#34;</span><span class="op" id="6783227">,</span>&nbsp;<span class="string" id="6783229">&#34;&#34;</span><span class="op" id="6783231">)</span><span class="op" id="6783232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783237">formData</span><span class="op" id="6783245">(</span><span class="string" id="6783246">&#34;lf&#34;</span><span class="op" id="6783250">,</span>&nbsp;<span class="string" id="6783252">&#34;\n&#34;</span><span class="op" id="6783256">)</span><span class="op" id="6783257">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783262">formData</span><span class="op" id="6783270">(</span><span class="string" id="6783271">&#34;cr&#34;</span><span class="op" id="6783275">,</span>&nbsp;<span class="string" id="6783277">&#34;\r&#34;</span><span class="op" id="6783281">)</span><span class="op" id="6783282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783287">formData</span><span class="op" id="6783295">(</span><span class="string" id="6783296">&#34;crlf&#34;</span><span class="op" id="6783302">,</span>&nbsp;<span class="string" id="6783304">&#34;\r\n&#34;</span><span class="op" id="6783310">)</span><span class="op" id="6783311">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783316">formData</span><span class="op" id="6783324">(</span><span class="string" id="6783325">&#34;foo&#34;</span><span class="op" id="6783330">,</span>&nbsp;<span class="string" id="6783332">&#34;bar&#34;</span><span class="op" id="6783337">)</span><span class="op" id="6783338">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783342">}</span><span class="op" id="6783343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783349">var</span>&nbsp;<span class="ident" id="6783353">buf</span>&nbsp;<span class="ident" id="6783357">bytes</span><span class="op" id="6783362">.</span><span class="ident" id="6783363">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783371">w</span>&nbsp;<span class="op" id="6783373">:=</span>&nbsp;<span class="ident" id="6783376">NewWriter</span><span class="op" id="6783385">(</span><span class="op" id="6783386">&amp;</span><span class="ident" id="6783387">buf</span><span class="op" id="6783390">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783393">for</span>&nbsp;<span class="ident" id="6783397">_</span><span class="op" id="6783398">,</span>&nbsp;<span class="ident" id="6783400">p</span>&nbsp;<span class="op" id="6783402">:=</span>&nbsp;<span class="keyword" id="6783405">range</span>&nbsp;<span class="ident" id="6783411">t</span><span class="op" id="6783412">.</span><span class="ident" id="6783413">want</span>&nbsp;<span class="op" id="6783418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783422">pw</span><span class="op" id="6783424">,</span>&nbsp;<span class="ident" id="6783426">err</span>&nbsp;<span class="op" id="6783430">:=</span>&nbsp;<span class="ident" id="6783433">w</span><span class="op" id="6783434">.</span><span class="ident" id="6783435">CreatePart</span><span class="op" id="6783445">(</span><span class="ident" id="6783446">p</span><span class="op" id="6783447">.</span><span class="ident" id="6783448">header</span><span class="op" id="6783454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783458">if</span>&nbsp;<span class="ident" id="6783461">err</span>&nbsp;<span class="op" id="6783465">!=</span>&nbsp;<span class="ident" id="6783468">nil</span>&nbsp;<span class="op" id="6783472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6783477">panic</span><span class="op" id="6783482">(</span><span class="ident" id="6783483">err</span><span class="op" id="6783486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783490">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783494">_</span><span class="op" id="6783495">,</span>&nbsp;<span class="ident" id="6783497">err</span>&nbsp;<span class="op" id="6783501">=</span>&nbsp;<span class="ident" id="6783503">pw</span><span class="op" id="6783505">.</span><span class="ident" id="6783506">Write</span><span class="op" id="6783511">(</span><span class="op" id="6783512">[</span><span class="op" id="6783513">]</span><span class="builtintype" id="6783514">byte</span><span class="op" id="6783518">(</span><span class="ident" id="6783519">p</span><span class="op" id="6783520">.</span><span class="ident" id="6783521">body</span><span class="op" id="6783525">)</span><span class="op" id="6783526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783530">if</span>&nbsp;<span class="ident" id="6783533">err</span>&nbsp;<span class="op" id="6783537">!=</span>&nbsp;<span class="ident" id="6783540">nil</span>&nbsp;<span class="op" id="6783544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6783549">panic</span><span class="op" id="6783554">(</span><span class="ident" id="6783555">err</span><span class="op" id="6783558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6783565">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783568">w</span><span class="op" id="6783569">.</span><span class="ident" id="6783570">Close</span><span class="op" id="6783575">(</span><span class="op" id="6783576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783579">t</span><span class="op" id="6783580">.</span><span class="ident" id="6783581">in</span>&nbsp;<span class="op" id="6783584">=</span>&nbsp;<span class="ident" id="6783586">buf</span><span class="op" id="6783589">.</span><span class="ident" id="6783590">String</span><span class="op" id="6783596">(</span><span class="op" id="6783597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6783600">t</span><span class="op" id="6783601">.</span><span class="ident" id="6783602">sep</span>&nbsp;<span class="op" id="6783606">=</span>&nbsp;<span class="ident" id="6783608">w</span><span class="op" id="6783609">.</span><span class="ident" id="6783610">Boundary</span><span class="op" id="6783618">(</span><span class="op" id="6783619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6783622">return</span>&nbsp;<span class="ident" id="6783629">t</span><br>
<span class="lineno"></span><span class="op" id="6783631">}</span>
</div>
</body>
</html>
