<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html" class="current">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1563997">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1564052">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1564106">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1564157">package</span>&nbsp;<span class="ident" id="1564165">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564174">import</span>&nbsp;<span class="string" id="1564181">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564191">var</span>&nbsp;<span class="ident" id="1564195">indexError</span>&nbsp;<span class="op" id="1564206">=</span>&nbsp;<span class="builtintype" id="1564208">error</span><span class="op" id="1564213">(</span><span class="ident" id="1564214">errorString</span><span class="op" id="1564225">(</span><span class="string" id="1564226">&#34;index&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1564246">)</span><span class="op" id="1564247">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1564250">func</span>&nbsp;<span class="ident" id="1564255">panicindex</span><span class="op" id="1564265">(</span><span class="op" id="1564266">)</span>&nbsp;<span class="op" id="1564268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1564271">panic</span><span class="op" id="1564276">(</span><span class="ident" id="1564277">indexError</span><span class="op" id="1564287">)</span><br>
<span class="lineno"></span><span class="op" id="1564289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1564292">var</span>&nbsp;<span class="ident" id="1564296">sliceError</span>&nbsp;<span class="op" id="1564307">=</span>&nbsp;<span class="builtintype" id="1564309">error</span><span class="op" id="1564314">(</span><span class="ident" id="1564315">errorString</span><span class="op" id="1564326">(</span><span class="string" id="1564327">&#34;slice&nbsp;bounds&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1564354">)</span><span class="op" id="1564355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564358">func</span>&nbsp;<span class="ident" id="1564363">panicslice</span><span class="op" id="1564373">(</span><span class="op" id="1564374">)</span>&nbsp;<span class="op" id="1564376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1564379">panic</span><span class="op" id="1564384">(</span><span class="ident" id="1564385">sliceError</span><span class="op" id="1564395">)</span><br>
<span class="lineno"></span><span class="op" id="1564397">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1564400">var</span>&nbsp;<span class="ident" id="1564404">divideError</span>&nbsp;<span class="op" id="1564416">=</span>&nbsp;<span class="builtintype" id="1564418">error</span><span class="op" id="1564423">(</span><span class="ident" id="1564424">errorString</span><span class="op" id="1564435">(</span><span class="string" id="1564436">&#34;integer&nbsp;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1564460">)</span><span class="op" id="1564461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564464">func</span>&nbsp;<span class="ident" id="1564469">panicdivide</span><span class="op" id="1564480">(</span><span class="op" id="1564481">)</span>&nbsp;<span class="op" id="1564483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1564486">panic</span><span class="op" id="1564491">(</span><span class="ident" id="1564492">divideError</span><span class="op" id="1564503">)</span><br>
<span class="lineno">25</span><span class="op" id="1564505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564508">var</span>&nbsp;<span class="ident" id="1564512">overflowError</span>&nbsp;<span class="op" id="1564526">=</span>&nbsp;<span class="builtintype" id="1564528">error</span><span class="op" id="1564533">(</span><span class="ident" id="1564534">errorString</span><span class="op" id="1564545">(</span><span class="string" id="1564546">&#34;integer&nbsp;overflow&#34;</span><span class="op" id="1564564">)</span><span class="op" id="1564565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564568">func</span>&nbsp;<span class="ident" id="1564573">panicoverflow</span><span class="op" id="1564586">(</span><span class="op" id="1564587">)</span>&nbsp;<span class="op" id="1564589">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1564592">panic</span><span class="op" id="1564597">(</span><span class="ident" id="1564598">overflowError</span><span class="op" id="1564611">)</span><br>
<span class="lineno"></span><span class="op" id="1564613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564616">var</span>&nbsp;<span class="ident" id="1564620">floatError</span>&nbsp;<span class="op" id="1564631">=</span>&nbsp;<span class="builtintype" id="1564633">error</span><span class="op" id="1564638">(</span><span class="ident" id="1564639">errorString</span><span class="op" id="1564650">(</span><span class="string" id="1564651">&#34;floating&nbsp;point&nbsp;error&#34;</span><span class="op" id="1564673">)</span><span class="op" id="1564674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1564677">func</span>&nbsp;<span class="ident" id="1564682">panicfloat</span><span class="op" id="1564692">(</span><span class="op" id="1564693">)</span>&nbsp;<span class="op" id="1564695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1564698">panic</span><span class="op" id="1564703">(</span><span class="ident" id="1564704">floatError</span><span class="op" id="1564714">)</span><br>
<span class="lineno"></span><span class="op" id="1564716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564719">var</span>&nbsp;<span class="ident" id="1564723">memoryError</span>&nbsp;<span class="op" id="1564735">=</span>&nbsp;<span class="builtintype" id="1564737">error</span><span class="op" id="1564742">(</span><span class="ident" id="1564743">errorString</span><span class="op" id="1564754">(</span><span class="string" id="1564755">&#34;invalid&nbsp;memory&nbsp;address&nbsp;or&nbsp;nil&nbsp;pointer&nbsp;dereference&#34;</span><span class="op" id="1564806">)</span><span class="op" id="1564807">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1564810">func</span>&nbsp;<span class="ident" id="1564815">panicmem</span><span class="op" id="1564823">(</span><span class="op" id="1564824">)</span>&nbsp;<span class="op" id="1564826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1564829">panic</span><span class="op" id="1564834">(</span><span class="ident" id="1564835">memoryError</span><span class="op" id="1564846">)</span><br>
<span class="lineno"></span><span class="op" id="1564848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1564851">func</span>&nbsp;<span class="ident" id="1564856">throwreturn</span><span class="op" id="1564867">(</span><span class="op" id="1564868">)</span>&nbsp;<span class="op" id="1564870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1564873">gothrow</span><span class="op" id="1564880">(</span><span class="string" id="1564881">&#34;no&nbsp;return&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;typed&nbsp;function&nbsp;-&nbsp;compiler&nbsp;is&nbsp;broken&#34;</span><span class="op" id="1564940">)</span><br>
<span class="lineno"></span><span class="op" id="1564942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564945">func</span>&nbsp;<span class="ident" id="1564950">throwinit</span><span class="op" id="1564959">(</span><span class="op" id="1564960">)</span>&nbsp;<span class="op" id="1564962">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1564965">gothrow</span><span class="op" id="1564972">(</span><span class="string" id="1564973">&#34;recursive&nbsp;call&nbsp;during&nbsp;initialization&nbsp;-&nbsp;linker&nbsp;skew&#34;</span><span class="op" id="1565025">)</span><br>
<span class="lineno"></span><span class="op" id="1565027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1565030">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;deferred&nbsp;function&nbsp;fn&nbsp;with&nbsp;siz&nbsp;bytes&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1565096">//&nbsp;The&nbsp;compiler&nbsp;turns&nbsp;a&nbsp;defer&nbsp;statement&nbsp;into&nbsp;a&nbsp;call&nbsp;to&nbsp;this.</span><br>
<span class="lineno">55</span><span class="comment" id="1565157">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1565170">func</span>&nbsp;<span class="ident" id="1565175">deferproc</span><span class="op" id="1565184">(</span><span class="ident" id="1565185">siz</span>&nbsp;<span class="builtintype" id="1565189">int32</span><span class="op" id="1565194">,</span>&nbsp;<span class="ident" id="1565196">fn</span>&nbsp;<span class="op" id="1565199">*</span><span class="ident" id="1565200">funcval</span><span class="op" id="1565207">)</span>&nbsp;<span class="op" id="1565209">{</span>&nbsp;<span class="comment" id="1565211">//&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;follow&nbsp;fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565241">//&nbsp;the&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;are&nbsp;in&nbsp;a&nbsp;perilous&nbsp;state.&nbsp;&nbsp;The&nbsp;stack&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565305">//&nbsp;for&nbsp;deferproc&nbsp;does&nbsp;not&nbsp;describe&nbsp;them.&nbsp;&nbsp;So&nbsp;we&nbsp;can&#39;t&nbsp;let&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565372">//&nbsp;collection&nbsp;or&nbsp;stack&nbsp;copying&nbsp;trigger&nbsp;until&nbsp;we&#39;ve&nbsp;copied&nbsp;them&nbsp;out</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565440">//&nbsp;to&nbsp;somewhere&nbsp;safe.&nbsp;&nbsp;deferproc_m&nbsp;does&nbsp;that.&nbsp;&nbsp;Until&nbsp;deferproc_m,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565507">//&nbsp;we&nbsp;can&nbsp;only&nbsp;call&nbsp;nosplit&nbsp;routines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565546">argp</span>&nbsp;<span class="op" id="1565551">:=</span>&nbsp;<span class="builtintype" id="1565554">uintptr</span><span class="op" id="1565561">(</span><span class="ident" id="1565562">unsafe</span><span class="op" id="1565568">.</span><span class="ident" id="1565569">Pointer</span><span class="op" id="1565576">(</span><span class="op" id="1565577">&amp;</span><span class="ident" id="1565578">fn</span><span class="op" id="1565580">)</span><span class="op" id="1565581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565584">argp</span>&nbsp;<span class="op" id="1565589">+=</span>&nbsp;<span class="ident" id="1565592">unsafe</span><span class="op" id="1565598">.</span><span class="ident" id="1565599">Sizeof</span><span class="op" id="1565605">(</span><span class="ident" id="1565606">fn</span><span class="op" id="1565608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1565611">if</span>&nbsp;<span class="ident" id="1565614">GOARCH</span>&nbsp;<span class="op" id="1565621">==</span>&nbsp;<span class="string" id="1565624">&#34;arm&#34;</span>&nbsp;<span class="op" id="1565630">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565634">argp</span>&nbsp;<span class="op" id="1565639">+=</span>&nbsp;<span class="ident" id="1565642">ptrSize</span>&nbsp;<span class="comment" id="1565650">//&nbsp;skip&nbsp;caller&#39;s&nbsp;saved&nbsp;link&nbsp;register</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1565688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565691">mp</span>&nbsp;<span class="op" id="1565694">:=</span>&nbsp;<span class="ident" id="1565697">acquirem</span><span class="op" id="1565705">(</span><span class="op" id="1565706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565709">mp</span><span class="op" id="1565711">.</span><span class="ident" id="1565712">scalararg</span><span class="op" id="1565721">[</span><span class="num" id="1565722">0</span><span class="op" id="1565723">]</span>&nbsp;<span class="op" id="1565725">=</span>&nbsp;<span class="builtintype" id="1565727">uintptr</span><span class="op" id="1565734">(</span><span class="ident" id="1565735">siz</span><span class="op" id="1565738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565741">mp</span><span class="op" id="1565743">.</span><span class="ident" id="1565744">ptrarg</span><span class="op" id="1565750">[</span><span class="num" id="1565751">0</span><span class="op" id="1565752">]</span>&nbsp;<span class="op" id="1565754">=</span>&nbsp;<span class="ident" id="1565756">unsafe</span><span class="op" id="1565762">.</span><span class="ident" id="1565763">Pointer</span><span class="op" id="1565770">(</span><span class="ident" id="1565771">fn</span><span class="op" id="1565773">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565776">mp</span><span class="op" id="1565778">.</span><span class="ident" id="1565779">scalararg</span><span class="op" id="1565788">[</span><span class="num" id="1565789">1</span><span class="op" id="1565790">]</span>&nbsp;<span class="op" id="1565792">=</span>&nbsp;<span class="ident" id="1565794">argp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565800">mp</span><span class="op" id="1565802">.</span><span class="ident" id="1565803">scalararg</span><span class="op" id="1565812">[</span><span class="num" id="1565813">2</span><span class="op" id="1565814">]</span>&nbsp;<span class="op" id="1565816">=</span>&nbsp;<span class="ident" id="1565818">getcallerpc</span><span class="op" id="1565829">(</span><span class="ident" id="1565830">unsafe</span><span class="op" id="1565836">.</span><span class="ident" id="1565837">Pointer</span><span class="op" id="1565844">(</span><span class="op" id="1565845">&amp;</span><span class="ident" id="1565846">siz</span><span class="op" id="1565849">)</span><span class="op" id="1565850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1565854">if</span>&nbsp;<span class="ident" id="1565857">mp</span><span class="op" id="1565859">.</span><span class="ident" id="1565860">curg</span>&nbsp;<span class="op" id="1565865">!=</span>&nbsp;<span class="ident" id="1565868">getg</span><span class="op" id="1565872">(</span><span class="op" id="1565873">)</span>&nbsp;<span class="op" id="1565875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565879">//&nbsp;go&nbsp;code&nbsp;on&nbsp;the&nbsp;m&nbsp;stack&nbsp;can&#39;t&nbsp;defer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565919">gothrow</span><span class="op" id="1565926">(</span><span class="string" id="1565927">&#34;defer&nbsp;on&nbsp;m&#34;</span><span class="op" id="1565939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1565942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565946">onM</span><span class="op" id="1565949">(</span><span class="ident" id="1565950">deferproc_m</span><span class="op" id="1565961">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1565965">releasem</span><span class="op" id="1565973">(</span><span class="ident" id="1565974">mp</span><span class="op" id="1565976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1565980">//&nbsp;deferproc&nbsp;returns&nbsp;0&nbsp;normally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566014">//&nbsp;a&nbsp;deferred&nbsp;func&nbsp;that&nbsp;stops&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566053">//&nbsp;makes&nbsp;the&nbsp;deferproc&nbsp;return&nbsp;1.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566087">//&nbsp;the&nbsp;code&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566130">//&nbsp;checks&nbsp;the&nbsp;return&nbsp;value&nbsp;and&nbsp;jumps&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566175">//&nbsp;end&nbsp;of&nbsp;the&nbsp;function&nbsp;if&nbsp;deferproc&nbsp;returns&nbsp;!=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1566226">return0</span><span class="op" id="1566233">(</span><span class="op" id="1566234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566237">//&nbsp;No&nbsp;code&nbsp;can&nbsp;go&nbsp;here&nbsp;-&nbsp;the&nbsp;C&nbsp;return&nbsp;register&nbsp;has</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1566289">//&nbsp;been&nbsp;set&nbsp;and&nbsp;must&nbsp;not&nbsp;be&nbsp;clobbered.</span><br>
<span class="lineno"></span><span class="op" id="1566328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1566331">//&nbsp;Small&nbsp;malloc&nbsp;size&nbsp;classes&nbsp;&gt;=&nbsp;16&nbsp;are&nbsp;the&nbsp;multiples&nbsp;of&nbsp;16:&nbsp;16,&nbsp;32,&nbsp;48,&nbsp;64,&nbsp;80,&nbsp;96,&nbsp;112,&nbsp;128,&nbsp;144,&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1566434">//&nbsp;Each&nbsp;P&nbsp;holds&nbsp;a&nbsp;pool&nbsp;for&nbsp;defers&nbsp;with&nbsp;small&nbsp;arg&nbsp;sizes.</span><br>
<span class="lineno">95</span><span class="comment" id="1566490">//&nbsp;Assign&nbsp;defer&nbsp;allocations&nbsp;to&nbsp;pools&nbsp;by&nbsp;rounding&nbsp;to&nbsp;16,&nbsp;to&nbsp;match&nbsp;malloc&nbsp;size&nbsp;classes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1566577">const</span>&nbsp;<span class="op" id="1566583">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1566586">deferHeaderSize</span>&nbsp;<span class="op" id="1566602">=</span>&nbsp;<span class="ident" id="1566604">unsafe</span><span class="op" id="1566610">.</span><span class="ident" id="1566611">Sizeof</span><span class="op" id="1566617">(</span><span class="ident" id="1566618">_defer</span><span class="op" id="1566624">{</span><span class="op" id="1566625">}</span><span class="op" id="1566626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1566629">minDeferAlloc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1566645">=</span>&nbsp;<span class="op" id="1566647">(</span><span class="ident" id="1566648">deferHeaderSize</span>&nbsp;<span class="op" id="1566664">+</span>&nbsp;<span class="num" id="1566666">15</span><span class="op" id="1566668">)</span>&nbsp;<span class="op" id="1566670">&amp;^</span>&nbsp;<span class="num" id="1566673">15</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1566677">minDeferArgs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1566693">=</span>&nbsp;<span class="ident" id="1566695">minDeferAlloc</span>&nbsp;<span class="op" id="1566709">-</span>&nbsp;<span class="ident" id="1566711">deferHeaderSize</span><br>
<span class="lineno"></span><span class="op" id="1566727">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1566730">//&nbsp;defer&nbsp;size&nbsp;class&nbsp;for&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="comment" id="1566766">//go:nosplit</span><br>
<span class="lineno">105</span><span class="keyword" id="1566779">func</span>&nbsp;<span class="ident" id="1566784">deferclass</span><span class="op" id="1566794">(</span><span class="ident" id="1566795">siz</span>&nbsp;<span class="builtintype" id="1566799">uintptr</span><span class="op" id="1566806">)</span>&nbsp;<span class="builtintype" id="1566808">uintptr</span>&nbsp;<span class="op" id="1566816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1566819">if</span>&nbsp;<span class="ident" id="1566822">siz</span>&nbsp;<span class="op" id="1566826">&lt;=</span>&nbsp;<span class="ident" id="1566829">minDeferArgs</span>&nbsp;<span class="op" id="1566842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1566846">return</span>&nbsp;<span class="num" id="1566853">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1566856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1566859">return</span>&nbsp;<span class="op" id="1566866">(</span><span class="ident" id="1566867">siz</span>&nbsp;<span class="op" id="1566871">-</span>&nbsp;<span class="ident" id="1566873">minDeferArgs</span>&nbsp;<span class="op" id="1566886">+</span>&nbsp;<span class="num" id="1566888">15</span><span class="op" id="1566890">)</span>&nbsp;<span class="op" id="1566892">/</span>&nbsp;<span class="num" id="1566894">16</span><br>
<span class="lineno">110</span><span class="op" id="1566897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1566900">//&nbsp;total&nbsp;size&nbsp;of&nbsp;memory&nbsp;block&nbsp;for&nbsp;defer&nbsp;with&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="keyword" id="1566957">func</span>&nbsp;<span class="ident" id="1566962">totaldefersize</span><span class="op" id="1566976">(</span><span class="ident" id="1566977">siz</span>&nbsp;<span class="builtintype" id="1566981">uintptr</span><span class="op" id="1566988">)</span>&nbsp;<span class="builtintype" id="1566990">uintptr</span>&nbsp;<span class="op" id="1566998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567001">if</span>&nbsp;<span class="ident" id="1567004">siz</span>&nbsp;<span class="op" id="1567008">&lt;=</span>&nbsp;<span class="ident" id="1567011">minDeferArgs</span>&nbsp;<span class="op" id="1567024">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567028">return</span>&nbsp;<span class="ident" id="1567035">minDeferAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1567050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567053">return</span>&nbsp;<span class="ident" id="1567060">deferHeaderSize</span>&nbsp;<span class="op" id="1567076">+</span>&nbsp;<span class="ident" id="1567078">siz</span><br>
<span class="lineno"></span><span class="op" id="1567082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="1567085">//&nbsp;Ensure&nbsp;that&nbsp;defer&nbsp;arg&nbsp;sizes&nbsp;that&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;defer&nbsp;size&nbsp;class</span><br>
<span class="lineno"></span><span class="comment" id="1567154">//&nbsp;also&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;malloc&nbsp;size&nbsp;class.</span><br>
<span class="lineno"></span><span class="keyword" id="1567197">func</span>&nbsp;<span class="ident" id="1567202">testdefersizes</span><span class="op" id="1567216">(</span><span class="op" id="1567217">)</span>&nbsp;<span class="op" id="1567219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567222">var</span>&nbsp;<span class="ident" id="1567226">m</span>&nbsp;<span class="op" id="1567228">[</span><span class="builtinfunc" id="1567229">len</span><span class="op" id="1567232">(</span><span class="ident" id="1567233">p</span><span class="op" id="1567234">{</span><span class="op" id="1567235">}</span><span class="op" id="1567236">.</span><span class="ident" id="1567237">deferpool</span><span class="op" id="1567246">)</span><span class="op" id="1567247">]</span><span class="builtintype" id="1567248">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567256">for</span>&nbsp;<span class="ident" id="1567260">i</span>&nbsp;<span class="op" id="1567262">:=</span>&nbsp;<span class="keyword" id="1567265">range</span>&nbsp;<span class="ident" id="1567271">m</span>&nbsp;<span class="op" id="1567273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567277">m</span><span class="op" id="1567278">[</span><span class="ident" id="1567279">i</span><span class="op" id="1567280">]</span>&nbsp;<span class="op" id="1567282">=</span>&nbsp;<span class="op" id="1567284">-</span><span class="num" id="1567285">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1567288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567291">for</span>&nbsp;<span class="ident" id="1567295">i</span>&nbsp;<span class="op" id="1567297">:=</span>&nbsp;<span class="builtintype" id="1567300">uintptr</span><span class="op" id="1567307">(</span><span class="num" id="1567308">0</span><span class="op" id="1567309">)</span><span class="op" id="1567310">;</span>&nbsp;<span class="op" id="1567312">;</span>&nbsp;<span class="ident" id="1567314">i</span><span class="op" id="1567315">++</span>&nbsp;<span class="op" id="1567318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567322">defersc</span>&nbsp;<span class="op" id="1567330">:=</span>&nbsp;<span class="ident" id="1567333">deferclass</span><span class="op" id="1567343">(</span><span class="ident" id="1567344">i</span><span class="op" id="1567345">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567349">if</span>&nbsp;<span class="ident" id="1567352">defersc</span>&nbsp;<span class="op" id="1567360">&gt;=</span>&nbsp;<span class="builtintype" id="1567363">uintptr</span><span class="op" id="1567370">(</span><span class="builtinfunc" id="1567371">len</span><span class="op" id="1567374">(</span><span class="ident" id="1567375">m</span><span class="op" id="1567376">)</span><span class="op" id="1567377">)</span>&nbsp;<span class="op" id="1567379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567384">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1567392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567396">siz</span>&nbsp;<span class="op" id="1567400">:=</span>&nbsp;<span class="ident" id="1567403">goroundupsize</span><span class="op" id="1567416">(</span><span class="ident" id="1567417">totaldefersize</span><span class="op" id="1567431">(</span><span class="ident" id="1567432">i</span><span class="op" id="1567433">)</span><span class="op" id="1567434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567438">if</span>&nbsp;<span class="ident" id="1567441">m</span><span class="op" id="1567442">[</span><span class="ident" id="1567443">defersc</span><span class="op" id="1567450">]</span>&nbsp;<span class="op" id="1567452">&lt;</span>&nbsp;<span class="num" id="1567454">0</span>&nbsp;<span class="op" id="1567456">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567461">m</span><span class="op" id="1567462">[</span><span class="ident" id="1567463">defersc</span><span class="op" id="1567470">]</span>&nbsp;<span class="op" id="1567472">=</span>&nbsp;<span class="builtintype" id="1567474">int32</span><span class="op" id="1567479">(</span><span class="ident" id="1567480">siz</span><span class="op" id="1567483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567488">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1567499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567503">if</span>&nbsp;<span class="ident" id="1567506">m</span><span class="op" id="1567507">[</span><span class="ident" id="1567508">defersc</span><span class="op" id="1567515">]</span>&nbsp;<span class="op" id="1567517">!=</span>&nbsp;<span class="builtintype" id="1567520">int32</span><span class="op" id="1567525">(</span><span class="ident" id="1567526">siz</span><span class="op" id="1567529">)</span>&nbsp;<span class="op" id="1567531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1567536">print</span><span class="op" id="1567541">(</span><span class="string" id="1567542">&#34;bad&nbsp;defer&nbsp;size&nbsp;class:&nbsp;i=&#34;</span><span class="op" id="1567568">,</span>&nbsp;<span class="ident" id="1567570">i</span><span class="op" id="1567571">,</span>&nbsp;<span class="string" id="1567573">&#34;&nbsp;siz=&#34;</span><span class="op" id="1567580">,</span>&nbsp;<span class="ident" id="1567582">siz</span><span class="op" id="1567585">,</span>&nbsp;<span class="string" id="1567587">&#34;&nbsp;defersc=&#34;</span><span class="op" id="1567598">,</span>&nbsp;<span class="ident" id="1567600">defersc</span><span class="op" id="1567607">,</span>&nbsp;<span class="string" id="1567609">&#34;\n&#34;</span><span class="op" id="1567613">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567618">gothrow</span><span class="op" id="1567625">(</span><span class="string" id="1567626">&#34;bad&nbsp;defer&nbsp;size&nbsp;class&#34;</span><span class="op" id="1567648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1567652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1567655">}</span><br>
<span class="lineno"></span><span class="op" id="1567657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1567660">//&nbsp;The&nbsp;arguments&nbsp;associated&nbsp;with&nbsp;a&nbsp;deferred&nbsp;call&nbsp;are&nbsp;stored</span><br>
<span class="lineno"></span><span class="comment" id="1567720">//&nbsp;immediately&nbsp;after&nbsp;the&nbsp;_defer&nbsp;header&nbsp;in&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1567770">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1567783">func</span>&nbsp;<span class="ident" id="1567788">deferArgs</span><span class="op" id="1567797">(</span><span class="ident" id="1567798">d</span>&nbsp;<span class="op" id="1567800">*</span><span class="ident" id="1567801">_defer</span><span class="op" id="1567807">)</span>&nbsp;<span class="ident" id="1567809">unsafe</span><span class="op" id="1567815">.</span><span class="ident" id="1567816">Pointer</span>&nbsp;<span class="op" id="1567824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567827">return</span>&nbsp;<span class="ident" id="1567834">add</span><span class="op" id="1567837">(</span><span class="ident" id="1567838">unsafe</span><span class="op" id="1567844">.</span><span class="ident" id="1567845">Pointer</span><span class="op" id="1567852">(</span><span class="ident" id="1567853">d</span><span class="op" id="1567854">)</span><span class="op" id="1567855">,</span>&nbsp;<span class="ident" id="1567857">unsafe</span><span class="op" id="1567863">.</span><span class="ident" id="1567864">Sizeof</span><span class="op" id="1567870">(</span><span class="op" id="1567871">*</span><span class="ident" id="1567872">d</span><span class="op" id="1567873">)</span><span class="op" id="1567874">)</span><br>
<span class="lineno">150</span><span class="op" id="1567876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1567879">var</span>&nbsp;<span class="ident" id="1567883">deferType</span>&nbsp;<span class="op" id="1567893">*</span><span class="ident" id="1567894">_type</span>&nbsp;<span class="comment" id="1567900">//&nbsp;type&nbsp;of&nbsp;_defer&nbsp;struct</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1567926">func</span>&nbsp;<span class="ident" id="1567931">init</span><span class="op" id="1567935">(</span><span class="op" id="1567936">)</span>&nbsp;<span class="op" id="1567938">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1567941">var</span>&nbsp;<span class="ident" id="1567945">x</span>&nbsp;<span class="keyword" id="1567947">interface</span><span class="op" id="1567956">{</span><span class="op" id="1567957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567960">x</span>&nbsp;<span class="op" id="1567962">=</span>&nbsp;<span class="op" id="1567964">(</span><span class="op" id="1567965">*</span><span class="ident" id="1567966">_defer</span><span class="op" id="1567972">)</span><span class="op" id="1567973">(</span><span class="builtintype" id="1567974">nil</span><span class="op" id="1567977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1567980">deferType</span>&nbsp;<span class="op" id="1567990">=</span>&nbsp;<span class="op" id="1567992">(</span><span class="op" id="1567993">*</span><span class="op" id="1567994">(</span><span class="op" id="1567995">*</span><span class="op" id="1567996">*</span><span class="ident" id="1567997">ptrtype</span><span class="op" id="1568004">)</span><span class="op" id="1568005">(</span><span class="ident" id="1568006">unsafe</span><span class="op" id="1568012">.</span><span class="ident" id="1568013">Pointer</span><span class="op" id="1568020">(</span><span class="op" id="1568021">&amp;</span><span class="ident" id="1568022">x</span><span class="op" id="1568023">)</span><span class="op" id="1568024">)</span><span class="op" id="1568025">)</span><span class="op" id="1568026">.</span><span class="ident" id="1568027">elem</span><br>
<span class="lineno"></span><span class="op" id="1568032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1568035">//&nbsp;Allocate&nbsp;a&nbsp;Defer,&nbsp;usually&nbsp;using&nbsp;per-P&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="1568082">//&nbsp;Each&nbsp;defer&nbsp;must&nbsp;be&nbsp;released&nbsp;with&nbsp;freedefer.</span><br>
<span class="lineno"></span><span class="comment" id="1568129">//&nbsp;Note:&nbsp;runs&nbsp;on&nbsp;M&nbsp;stack</span><br>
<span class="lineno"></span><span class="keyword" id="1568154">func</span>&nbsp;<span class="ident" id="1568159">newdefer</span><span class="op" id="1568167">(</span><span class="ident" id="1568168">siz</span>&nbsp;<span class="builtintype" id="1568172">int32</span><span class="op" id="1568177">)</span>&nbsp;<span class="op" id="1568179">*</span><span class="ident" id="1568180">_defer</span>&nbsp;<span class="op" id="1568187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568190">var</span>&nbsp;<span class="ident" id="1568194">d</span>&nbsp;<span class="op" id="1568196">*</span><span class="ident" id="1568197">_defer</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568205">sc</span>&nbsp;<span class="op" id="1568208">:=</span>&nbsp;<span class="ident" id="1568211">deferclass</span><span class="op" id="1568221">(</span><span class="builtintype" id="1568222">uintptr</span><span class="op" id="1568229">(</span><span class="ident" id="1568230">siz</span><span class="op" id="1568233">)</span><span class="op" id="1568234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568237">mp</span>&nbsp;<span class="op" id="1568240">:=</span>&nbsp;<span class="ident" id="1568243">acquirem</span><span class="op" id="1568251">(</span><span class="op" id="1568252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568255">if</span>&nbsp;<span class="ident" id="1568258">sc</span>&nbsp;<span class="op" id="1568261">&lt;</span>&nbsp;<span class="builtintype" id="1568263">uintptr</span><span class="op" id="1568270">(</span><span class="builtinfunc" id="1568271">len</span><span class="op" id="1568274">(</span><span class="ident" id="1568275">p</span><span class="op" id="1568276">{</span><span class="op" id="1568277">}</span><span class="op" id="1568278">.</span><span class="ident" id="1568279">deferpool</span><span class="op" id="1568288">)</span><span class="op" id="1568289">)</span>&nbsp;<span class="op" id="1568291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568295">pp</span>&nbsp;<span class="op" id="1568298">:=</span>&nbsp;<span class="ident" id="1568301">mp</span><span class="op" id="1568303">.</span><span class="ident" id="1568304">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568308">d</span>&nbsp;<span class="op" id="1568310">=</span>&nbsp;<span class="ident" id="1568312">pp</span><span class="op" id="1568314">.</span><span class="ident" id="1568315">deferpool</span><span class="op" id="1568324">[</span><span class="ident" id="1568325">sc</span><span class="op" id="1568327">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568331">if</span>&nbsp;<span class="ident" id="1568334">d</span>&nbsp;<span class="op" id="1568336">!=</span>&nbsp;<span class="builtintype" id="1568339">nil</span>&nbsp;<span class="op" id="1568343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568348">pp</span><span class="op" id="1568350">.</span><span class="ident" id="1568351">deferpool</span><span class="op" id="1568360">[</span><span class="ident" id="1568361">sc</span><span class="op" id="1568363">]</span>&nbsp;<span class="op" id="1568365">=</span>&nbsp;<span class="ident" id="1568367">d</span><span class="op" id="1568368">.</span><span class="ident" id="1568369">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1568376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1568379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568382">if</span>&nbsp;<span class="ident" id="1568385">d</span>&nbsp;<span class="op" id="1568387">==</span>&nbsp;<span class="builtintype" id="1568390">nil</span>&nbsp;<span class="op" id="1568394">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1568398">//&nbsp;Allocate&nbsp;new&nbsp;defer+args.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568428">total</span>&nbsp;<span class="op" id="1568434">:=</span>&nbsp;<span class="ident" id="1568437">goroundupsize</span><span class="op" id="1568450">(</span><span class="ident" id="1568451">totaldefersize</span><span class="op" id="1568465">(</span><span class="builtintype" id="1568466">uintptr</span><span class="op" id="1568473">(</span><span class="ident" id="1568474">siz</span><span class="op" id="1568477">)</span><span class="op" id="1568478">)</span><span class="op" id="1568479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568483">d</span>&nbsp;<span class="op" id="1568485">=</span>&nbsp;<span class="op" id="1568487">(</span><span class="op" id="1568488">*</span><span class="ident" id="1568489">_defer</span><span class="op" id="1568495">)</span><span class="op" id="1568496">(</span><span class="ident" id="1568497">mallocgc</span><span class="op" id="1568505">(</span><span class="ident" id="1568506">total</span><span class="op" id="1568511">,</span>&nbsp;<span class="ident" id="1568513">deferType</span><span class="op" id="1568522">,</span>&nbsp;<span class="num" id="1568524">0</span><span class="op" id="1568525">)</span><span class="op" id="1568526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1568529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568532">d</span><span class="op" id="1568533">.</span><span class="ident" id="1568534">siz</span>&nbsp;<span class="op" id="1568538">=</span>&nbsp;<span class="ident" id="1568540">siz</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568545">gp</span>&nbsp;<span class="op" id="1568548">:=</span>&nbsp;<span class="ident" id="1568551">mp</span><span class="op" id="1568553">.</span><span class="ident" id="1568554">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568560">d</span><span class="op" id="1568561">.</span><span class="ident" id="1568562">link</span>&nbsp;<span class="op" id="1568567">=</span>&nbsp;<span class="ident" id="1568569">gp</span><span class="op" id="1568571">.</span><span class="ident" id="1568572">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568580">gp</span><span class="op" id="1568582">.</span><span class="ident" id="1568583">_defer</span>&nbsp;<span class="op" id="1568590">=</span>&nbsp;<span class="ident" id="1568592">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568595">releasem</span><span class="op" id="1568603">(</span><span class="ident" id="1568604">mp</span><span class="op" id="1568606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568609">return</span>&nbsp;<span class="ident" id="1568616">d</span><br>
<span class="lineno">185</span><span class="op" id="1568618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1568621">//&nbsp;Free&nbsp;the&nbsp;given&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1568646">//&nbsp;The&nbsp;defer&nbsp;cannot&nbsp;be&nbsp;used&nbsp;after&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="1568691">//go:nosplit</span><br>
<span class="lineno">190</span><span class="keyword" id="1568704">func</span>&nbsp;<span class="ident" id="1568709">freedefer</span><span class="op" id="1568718">(</span><span class="ident" id="1568719">d</span>&nbsp;<span class="op" id="1568721">*</span><span class="ident" id="1568722">_defer</span><span class="op" id="1568728">)</span>&nbsp;<span class="op" id="1568730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568733">if</span>&nbsp;<span class="ident" id="1568736">d</span><span class="op" id="1568737">.</span><span class="ident" id="1568738">_panic</span>&nbsp;<span class="op" id="1568745">!=</span>&nbsp;<span class="builtintype" id="1568748">nil</span>&nbsp;<span class="op" id="1568752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568756">freedeferpanic</span><span class="op" id="1568770">(</span><span class="op" id="1568771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1568774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568777">if</span>&nbsp;<span class="ident" id="1568780">d</span><span class="op" id="1568781">.</span><span class="ident" id="1568782">fn</span>&nbsp;<span class="op" id="1568785">!=</span>&nbsp;<span class="builtintype" id="1568788">nil</span>&nbsp;<span class="op" id="1568792">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568796">freedeferfn</span><span class="op" id="1568807">(</span><span class="op" id="1568808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1568811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568814">sc</span>&nbsp;<span class="op" id="1568817">:=</span>&nbsp;<span class="ident" id="1568820">deferclass</span><span class="op" id="1568830">(</span><span class="builtintype" id="1568831">uintptr</span><span class="op" id="1568838">(</span><span class="ident" id="1568839">d</span><span class="op" id="1568840">.</span><span class="ident" id="1568841">siz</span><span class="op" id="1568844">)</span><span class="op" id="1568845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1568848">if</span>&nbsp;<span class="ident" id="1568851">sc</span>&nbsp;<span class="op" id="1568854">&lt;</span>&nbsp;<span class="builtintype" id="1568856">uintptr</span><span class="op" id="1568863">(</span><span class="builtinfunc" id="1568864">len</span><span class="op" id="1568867">(</span><span class="ident" id="1568868">p</span><span class="op" id="1568869">{</span><span class="op" id="1568870">}</span><span class="op" id="1568871">.</span><span class="ident" id="1568872">deferpool</span><span class="op" id="1568881">)</span><span class="op" id="1568882">)</span>&nbsp;<span class="op" id="1568884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568888">mp</span>&nbsp;<span class="op" id="1568891">:=</span>&nbsp;<span class="ident" id="1568894">acquirem</span><span class="op" id="1568902">(</span><span class="op" id="1568903">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568907">pp</span>&nbsp;<span class="op" id="1568910">:=</span>&nbsp;<span class="ident" id="1568913">mp</span><span class="op" id="1568915">.</span><span class="ident" id="1568916">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1568920">*</span><span class="ident" id="1568921">d</span>&nbsp;<span class="op" id="1568923">=</span>&nbsp;<span class="ident" id="1568925">_defer</span><span class="op" id="1568931">{</span><span class="op" id="1568932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568936">d</span><span class="op" id="1568937">.</span><span class="ident" id="1568938">link</span>&nbsp;<span class="op" id="1568943">=</span>&nbsp;<span class="ident" id="1568945">pp</span><span class="op" id="1568947">.</span><span class="ident" id="1568948">deferpool</span><span class="op" id="1568957">[</span><span class="ident" id="1568958">sc</span><span class="op" id="1568960">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568964">pp</span><span class="op" id="1568966">.</span><span class="ident" id="1568967">deferpool</span><span class="op" id="1568976">[</span><span class="ident" id="1568977">sc</span><span class="op" id="1568979">]</span>&nbsp;<span class="op" id="1568981">=</span>&nbsp;<span class="ident" id="1568983">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1568987">releasem</span><span class="op" id="1568995">(</span><span class="ident" id="1568996">mp</span><span class="op" id="1568998">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1569001">}</span><br>
<span class="lineno"></span><span class="op" id="1569003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1569006">//&nbsp;Separate&nbsp;function&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1569055">//&nbsp;Windows&nbsp;otherwise&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;space.</span><br>
<span class="lineno">210</span><span class="keyword" id="1569101">func</span>&nbsp;<span class="ident" id="1569106">freedeferpanic</span><span class="op" id="1569120">(</span><span class="op" id="1569121">)</span>&nbsp;<span class="op" id="1569123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1569126">//&nbsp;_panic&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1569183">gothrow</span><span class="op" id="1569190">(</span><span class="string" id="1569191">&#34;freedefer&nbsp;with&nbsp;d._panic&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1569223">)</span><br>
<span class="lineno"></span><span class="op" id="1569225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1569228">func</span>&nbsp;<span class="ident" id="1569233">freedeferfn</span><span class="op" id="1569244">(</span><span class="op" id="1569245">)</span>&nbsp;<span class="op" id="1569247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1569250">//&nbsp;fn&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1569303">gothrow</span><span class="op" id="1569310">(</span><span class="string" id="1569311">&#34;freedefer&nbsp;with&nbsp;d.fn&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1569339">)</span><br>
<span class="lineno"></span><span class="op" id="1569341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1569344">//&nbsp;Run&nbsp;a&nbsp;deferred&nbsp;function&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1569388">//&nbsp;The&nbsp;compiler&nbsp;inserts&nbsp;a&nbsp;call&nbsp;to&nbsp;this&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1569445">//&nbsp;function&nbsp;which&nbsp;calls&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1569476">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;deferred&nbsp;function,&nbsp;this&nbsp;will&nbsp;call&nbsp;runtime·jmpdefer,</span><br>
<span class="lineno"></span><span class="comment" id="1569546">//&nbsp;which&nbsp;will&nbsp;jump&nbsp;to&nbsp;the&nbsp;deferred&nbsp;function&nbsp;such&nbsp;that&nbsp;it&nbsp;appears</span><br>
<span class="lineno">225</span><span class="comment" id="1569611">//&nbsp;to&nbsp;have&nbsp;been&nbsp;called&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;deferreturn&nbsp;at&nbsp;the&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1569676">//&nbsp;just&nbsp;before&nbsp;deferreturn&nbsp;was&nbsp;called.&nbsp;&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;deferreturn</span><br>
<span class="lineno"></span><span class="comment" id="1569747">//&nbsp;is&nbsp;called&nbsp;again&nbsp;and&nbsp;again&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;deferred&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1569820">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;we&nbsp;reuse&nbsp;the&nbsp;caller&#39;s&nbsp;frame&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1569885">//&nbsp;call&nbsp;the&nbsp;deferred&nbsp;function.</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1569917">//&nbsp;The&nbsp;single&nbsp;argument&nbsp;isn&#39;t&nbsp;actually&nbsp;used&nbsp;-&nbsp;it&nbsp;just&nbsp;has&nbsp;its&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1569986">//&nbsp;taken&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;matched&nbsp;against&nbsp;pending&nbsp;defers.</span><br>
<span class="lineno"></span><span class="comment" id="1570040">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1570053">func</span>&nbsp;<span class="ident" id="1570058">deferreturn</span><span class="op" id="1570069">(</span><span class="ident" id="1570070">arg0</span>&nbsp;<span class="builtintype" id="1570075">uintptr</span><span class="op" id="1570082">)</span>&nbsp;<span class="op" id="1570084">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570087">gp</span>&nbsp;<span class="op" id="1570090">:=</span>&nbsp;<span class="ident" id="1570093">getg</span><span class="op" id="1570097">(</span><span class="op" id="1570098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570101">d</span>&nbsp;<span class="op" id="1570103">:=</span>&nbsp;<span class="ident" id="1570106">gp</span><span class="op" id="1570108">.</span><span class="ident" id="1570109">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1570117">if</span>&nbsp;<span class="ident" id="1570120">d</span>&nbsp;<span class="op" id="1570122">==</span>&nbsp;<span class="builtintype" id="1570125">nil</span>&nbsp;<span class="op" id="1570129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1570133">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1570141">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570144">argp</span>&nbsp;<span class="op" id="1570149">:=</span>&nbsp;<span class="builtintype" id="1570152">uintptr</span><span class="op" id="1570159">(</span><span class="ident" id="1570160">unsafe</span><span class="op" id="1570166">.</span><span class="ident" id="1570167">Pointer</span><span class="op" id="1570174">(</span><span class="op" id="1570175">&amp;</span><span class="ident" id="1570176">arg0</span><span class="op" id="1570180">)</span><span class="op" id="1570181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1570184">if</span>&nbsp;<span class="ident" id="1570187">d</span><span class="op" id="1570188">.</span><span class="ident" id="1570189">argp</span>&nbsp;<span class="op" id="1570194">!=</span>&nbsp;<span class="ident" id="1570197">argp</span>&nbsp;<span class="op" id="1570202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1570206">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1570214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1570218">//&nbsp;Moving&nbsp;arguments&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1570247">//&nbsp;Do&nbsp;not&nbsp;allow&nbsp;preemption&nbsp;here,&nbsp;because&nbsp;the&nbsp;garbage&nbsp;collector</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1570311">//&nbsp;won&#39;t&nbsp;know&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;arguments&nbsp;until&nbsp;the&nbsp;jmpdefer&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1570375">//&nbsp;flip&nbsp;the&nbsp;PC&nbsp;over&nbsp;to&nbsp;fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570403">mp</span>&nbsp;<span class="op" id="1570406">:=</span>&nbsp;<span class="ident" id="1570409">acquirem</span><span class="op" id="1570417">(</span><span class="op" id="1570418">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570421">memmove</span><span class="op" id="1570428">(</span><span class="ident" id="1570429">unsafe</span><span class="op" id="1570435">.</span><span class="ident" id="1570436">Pointer</span><span class="op" id="1570443">(</span><span class="ident" id="1570444">argp</span><span class="op" id="1570448">)</span><span class="op" id="1570449">,</span>&nbsp;<span class="ident" id="1570451">deferArgs</span><span class="op" id="1570460">(</span><span class="ident" id="1570461">d</span><span class="op" id="1570462">)</span><span class="op" id="1570463">,</span>&nbsp;<span class="builtintype" id="1570465">uintptr</span><span class="op" id="1570472">(</span><span class="ident" id="1570473">d</span><span class="op" id="1570474">.</span><span class="ident" id="1570475">siz</span><span class="op" id="1570478">)</span><span class="op" id="1570479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570482">fn</span>&nbsp;<span class="op" id="1570485">:=</span>&nbsp;<span class="ident" id="1570488">d</span><span class="op" id="1570489">.</span><span class="ident" id="1570490">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570494">d</span><span class="op" id="1570495">.</span><span class="ident" id="1570496">fn</span>&nbsp;<span class="op" id="1570499">=</span>&nbsp;<span class="builtintype" id="1570501">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570506">gp</span><span class="op" id="1570508">.</span><span class="ident" id="1570509">_defer</span>&nbsp;<span class="op" id="1570516">=</span>&nbsp;<span class="ident" id="1570518">d</span><span class="op" id="1570519">.</span><span class="ident" id="1570520">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570526">freedefer</span><span class="op" id="1570535">(</span><span class="ident" id="1570536">d</span><span class="op" id="1570537">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570540">releasem</span><span class="op" id="1570548">(</span><span class="ident" id="1570549">mp</span><span class="op" id="1570551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1570554">jmpdefer</span><span class="op" id="1570562">(</span><span class="ident" id="1570563">fn</span><span class="op" id="1570565">,</span>&nbsp;<span class="ident" id="1570567">argp</span><span class="op" id="1570571">)</span><br>
<span class="lineno"></span><span class="op" id="1570573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1570576">//&nbsp;Goexit&nbsp;terminates&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.&nbsp;&nbsp;No&nbsp;other&nbsp;goroutine&nbsp;is&nbsp;affected.</span><br>
<span class="lineno">260</span><span class="comment" id="1570659">//&nbsp;Goexit&nbsp;runs&nbsp;all&nbsp;deferred&nbsp;calls&nbsp;before&nbsp;terminating&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;Because&nbsp;Goexit</span><br>
<span class="lineno"></span><span class="comment" id="1570743">//&nbsp;is&nbsp;not&nbsp;panic,&nbsp;however,&nbsp;any&nbsp;recover&nbsp;calls&nbsp;in&nbsp;those&nbsp;deferred&nbsp;functions&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1570832">//</span><br>
<span class="lineno"></span><span class="comment" id="1570835">//&nbsp;Calling&nbsp;Goexit&nbsp;from&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;terminates&nbsp;that&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1570903">//&nbsp;without&nbsp;func&nbsp;main&nbsp;returning.&nbsp;Since&nbsp;func&nbsp;main&nbsp;has&nbsp;not&nbsp;returned,</span><br>
<span class="lineno">265</span><span class="comment" id="1570969">//&nbsp;the&nbsp;program&nbsp;continues&nbsp;execution&nbsp;of&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1571025">//&nbsp;If&nbsp;all&nbsp;other&nbsp;goroutines&nbsp;exit,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="1571079">func</span>&nbsp;<span class="ident" id="1571084">Goexit</span><span class="op" id="1571090">(</span><span class="op" id="1571091">)</span>&nbsp;<span class="op" id="1571093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1571096">//&nbsp;Run&nbsp;all&nbsp;deferred&nbsp;functions&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1571154">//&nbsp;This&nbsp;code&nbsp;is&nbsp;similar&nbsp;to&nbsp;gopanic,&nbsp;see&nbsp;that&nbsp;implementation</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1571215">//&nbsp;for&nbsp;detailed&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571242">gp</span>&nbsp;<span class="op" id="1571245">:=</span>&nbsp;<span class="ident" id="1571248">getg</span><span class="op" id="1571252">(</span><span class="op" id="1571253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571256">for</span>&nbsp;<span class="op" id="1571260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571264">d</span>&nbsp;<span class="op" id="1571266">:=</span>&nbsp;<span class="ident" id="1571269">gp</span><span class="op" id="1571271">.</span><span class="ident" id="1571272">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571281">if</span>&nbsp;<span class="ident" id="1571284">d</span>&nbsp;<span class="op" id="1571286">==</span>&nbsp;<span class="builtintype" id="1571289">nil</span>&nbsp;<span class="op" id="1571293">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571298">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1571306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571310">if</span>&nbsp;<span class="ident" id="1571313">d</span><span class="op" id="1571314">.</span><span class="ident" id="1571315">started</span>&nbsp;<span class="op" id="1571323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571328">if</span>&nbsp;<span class="ident" id="1571331">d</span><span class="op" id="1571332">.</span><span class="ident" id="1571333">_panic</span>&nbsp;<span class="op" id="1571340">!=</span>&nbsp;<span class="builtintype" id="1571343">nil</span>&nbsp;<span class="op" id="1571347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571353">d</span><span class="op" id="1571354">.</span><span class="ident" id="1571355">_panic</span><span class="op" id="1571361">.</span><span class="ident" id="1571362">aborted</span>&nbsp;<span class="op" id="1571370">=</span>&nbsp;<span class="builtintype" id="1571372">true</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571381">d</span><span class="op" id="1571382">.</span><span class="ident" id="1571383">_panic</span>&nbsp;<span class="op" id="1571390">=</span>&nbsp;<span class="builtintype" id="1571392">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1571399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571404">d</span><span class="op" id="1571405">.</span><span class="ident" id="1571406">fn</span>&nbsp;<span class="op" id="1571409">=</span>&nbsp;<span class="builtintype" id="1571411">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571418">gp</span><span class="op" id="1571420">.</span><span class="ident" id="1571421">_defer</span>&nbsp;<span class="op" id="1571428">=</span>&nbsp;<span class="ident" id="1571430">d</span><span class="op" id="1571431">.</span><span class="ident" id="1571432">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571440">freedefer</span><span class="op" id="1571449">(</span><span class="ident" id="1571450">d</span><span class="op" id="1571451">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571456">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1571467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571471">d</span><span class="op" id="1571472">.</span><span class="ident" id="1571473">started</span>&nbsp;<span class="op" id="1571481">=</span>&nbsp;<span class="builtintype" id="1571483">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571490">reflectcall</span><span class="op" id="1571501">(</span><span class="ident" id="1571502">unsafe</span><span class="op" id="1571508">.</span><span class="ident" id="1571509">Pointer</span><span class="op" id="1571516">(</span><span class="ident" id="1571517">d</span><span class="op" id="1571518">.</span><span class="ident" id="1571519">fn</span><span class="op" id="1571521">)</span><span class="op" id="1571522">,</span>&nbsp;<span class="ident" id="1571524">deferArgs</span><span class="op" id="1571533">(</span><span class="ident" id="1571534">d</span><span class="op" id="1571535">)</span><span class="op" id="1571536">,</span>&nbsp;<span class="builtintype" id="1571538">uint32</span><span class="op" id="1571544">(</span><span class="ident" id="1571545">d</span><span class="op" id="1571546">.</span><span class="ident" id="1571547">siz</span><span class="op" id="1571550">)</span><span class="op" id="1571551">,</span>&nbsp;<span class="builtintype" id="1571553">uint32</span><span class="op" id="1571559">(</span><span class="ident" id="1571560">d</span><span class="op" id="1571561">.</span><span class="ident" id="1571562">siz</span><span class="op" id="1571565">)</span><span class="op" id="1571566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571570">if</span>&nbsp;<span class="ident" id="1571573">gp</span><span class="op" id="1571575">.</span><span class="ident" id="1571576">_defer</span>&nbsp;<span class="op" id="1571583">!=</span>&nbsp;<span class="ident" id="1571586">d</span>&nbsp;<span class="op" id="1571588">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571593">gothrow</span><span class="op" id="1571600">(</span><span class="string" id="1571601">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;Goexit&#34;</span><span class="op" id="1571628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1571632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571636">d</span><span class="op" id="1571637">.</span><span class="ident" id="1571638">_panic</span>&nbsp;<span class="op" id="1571645">=</span>&nbsp;<span class="builtintype" id="1571647">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571653">d</span><span class="op" id="1571654">.</span><span class="ident" id="1571655">fn</span>&nbsp;<span class="op" id="1571658">=</span>&nbsp;<span class="builtintype" id="1571660">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571666">gp</span><span class="op" id="1571668">.</span><span class="ident" id="1571669">_defer</span>&nbsp;<span class="op" id="1571676">=</span>&nbsp;<span class="ident" id="1571678">d</span><span class="op" id="1571679">.</span><span class="ident" id="1571680">link</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571687">freedefer</span><span class="op" id="1571696">(</span><span class="ident" id="1571697">d</span><span class="op" id="1571698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1571702">//&nbsp;Note:&nbsp;we&nbsp;ignore&nbsp;recovers&nbsp;here&nbsp;because&nbsp;Goexit&nbsp;isn&#39;t&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1571765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571768">goexit</span><span class="op" id="1571774">(</span><span class="op" id="1571775">)</span><br>
<span class="lineno"></span><span class="op" id="1571777">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="1571780">func</span>&nbsp;<span class="ident" id="1571785">canpanic</span><span class="op" id="1571793">(</span><span class="op" id="1571794">*</span><span class="ident" id="1571795">g</span><span class="op" id="1571796">)</span>&nbsp;<span class="builtintype" id="1571798">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1571804">//&nbsp;Print&nbsp;all&nbsp;currently&nbsp;active&nbsp;panics.&nbsp;&nbsp;Used&nbsp;when&nbsp;crashing.</span><br>
<span class="lineno"></span><span class="keyword" id="1571863">func</span>&nbsp;<span class="ident" id="1571868">printpanics</span><span class="op" id="1571879">(</span><span class="ident" id="1571880">p</span>&nbsp;<span class="op" id="1571882">*</span><span class="ident" id="1571883">_panic</span><span class="op" id="1571889">)</span>&nbsp;<span class="op" id="1571891">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571894">if</span>&nbsp;<span class="ident" id="1571897">p</span><span class="op" id="1571898">.</span><span class="ident" id="1571899">link</span>&nbsp;<span class="op" id="1571904">!=</span>&nbsp;<span class="builtintype" id="1571907">nil</span>&nbsp;<span class="op" id="1571911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571915">printpanics</span><span class="op" id="1571926">(</span><span class="ident" id="1571927">p</span><span class="op" id="1571928">.</span><span class="ident" id="1571929">link</span><span class="op" id="1571933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1571937">print</span><span class="op" id="1571942">(</span><span class="string" id="1571943">&#34;\t&#34;</span><span class="op" id="1571947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1571950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1571953">print</span><span class="op" id="1571958">(</span><span class="string" id="1571959">&#34;panic:&nbsp;&#34;</span><span class="op" id="1571968">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1571971">printany</span><span class="op" id="1571979">(</span><span class="ident" id="1571980">p</span><span class="op" id="1571981">.</span><span class="ident" id="1571982">arg</span><span class="op" id="1571985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1571988">if</span>&nbsp;<span class="ident" id="1571991">p</span><span class="op" id="1571992">.</span><span class="ident" id="1571993">recovered</span>&nbsp;<span class="op" id="1572003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572007">print</span><span class="op" id="1572012">(</span><span class="string" id="1572013">&#34;&nbsp;[recovered]&#34;</span><span class="op" id="1572027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572033">print</span><span class="op" id="1572038">(</span><span class="string" id="1572039">&#34;\n&#34;</span><span class="op" id="1572043">)</span><br>
<span class="lineno">315</span><span class="op" id="1572045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1572048">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="1572105">func</span>&nbsp;<span class="ident" id="1572110">gopanic</span><span class="op" id="1572117">(</span><span class="ident" id="1572118">e</span>&nbsp;<span class="keyword" id="1572120">interface</span><span class="op" id="1572129">{</span><span class="op" id="1572130">}</span><span class="op" id="1572131">)</span>&nbsp;<span class="op" id="1572133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572136">gp</span>&nbsp;<span class="op" id="1572139">:=</span>&nbsp;<span class="ident" id="1572142">getg</span><span class="op" id="1572146">(</span><span class="op" id="1572147">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572150">if</span>&nbsp;<span class="ident" id="1572153">gp</span><span class="op" id="1572155">.</span><span class="ident" id="1572156">m</span><span class="op" id="1572157">.</span><span class="ident" id="1572158">curg</span>&nbsp;<span class="op" id="1572163">!=</span>&nbsp;<span class="ident" id="1572166">gp</span>&nbsp;<span class="op" id="1572169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572173">gothrow</span><span class="op" id="1572180">(</span><span class="string" id="1572181">&#34;panic&nbsp;on&nbsp;m&nbsp;stack&#34;</span><span class="op" id="1572199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1572206">//&nbsp;m.softfloat&nbsp;is&nbsp;set&nbsp;during&nbsp;software&nbsp;floating&nbsp;point.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1572261">//&nbsp;It&nbsp;increments&nbsp;m.locks&nbsp;to&nbsp;avoid&nbsp;preemption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1572308">//&nbsp;We&nbsp;moved&nbsp;the&nbsp;memory&nbsp;loads&nbsp;out,&nbsp;so&nbsp;there&nbsp;shouldn&#39;t&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1572365">//&nbsp;any&nbsp;reason&nbsp;for&nbsp;it&nbsp;to&nbsp;panic&nbsp;anymore.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572405">if</span>&nbsp;<span class="ident" id="1572408">gp</span><span class="op" id="1572410">.</span><span class="ident" id="1572411">m</span><span class="op" id="1572412">.</span><span class="ident" id="1572413">softfloat</span>&nbsp;<span class="op" id="1572423">!=</span>&nbsp;<span class="num" id="1572426">0</span>&nbsp;<span class="op" id="1572428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572432">gp</span><span class="op" id="1572434">.</span><span class="ident" id="1572435">m</span><span class="op" id="1572436">.</span><span class="ident" id="1572437">locks</span><span class="op" id="1572442">--</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572447">gp</span><span class="op" id="1572449">.</span><span class="ident" id="1572450">m</span><span class="op" id="1572451">.</span><span class="ident" id="1572452">softfloat</span>&nbsp;<span class="op" id="1572462">=</span>&nbsp;<span class="num" id="1572464">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572468">gothrow</span><span class="op" id="1572475">(</span><span class="string" id="1572476">&#34;panic&nbsp;during&nbsp;softfloat&#34;</span><span class="op" id="1572500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572506">if</span>&nbsp;<span class="ident" id="1572509">gp</span><span class="op" id="1572511">.</span><span class="ident" id="1572512">m</span><span class="op" id="1572513">.</span><span class="ident" id="1572514">mallocing</span>&nbsp;<span class="op" id="1572524">!=</span>&nbsp;<span class="num" id="1572527">0</span>&nbsp;<span class="op" id="1572529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572533">print</span><span class="op" id="1572538">(</span><span class="string" id="1572539">&#34;panic:&nbsp;&#34;</span><span class="op" id="1572548">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572552">printany</span><span class="op" id="1572560">(</span><span class="ident" id="1572561">e</span><span class="op" id="1572562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572566">print</span><span class="op" id="1572571">(</span><span class="string" id="1572572">&#34;\n&#34;</span><span class="op" id="1572576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572580">gothrow</span><span class="op" id="1572587">(</span><span class="string" id="1572588">&#34;panic&nbsp;during&nbsp;malloc&#34;</span><span class="op" id="1572609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572615">if</span>&nbsp;<span class="ident" id="1572618">gp</span><span class="op" id="1572620">.</span><span class="ident" id="1572621">m</span><span class="op" id="1572622">.</span><span class="ident" id="1572623">gcing</span>&nbsp;<span class="op" id="1572629">!=</span>&nbsp;<span class="num" id="1572632">0</span>&nbsp;<span class="op" id="1572634">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572638">print</span><span class="op" id="1572643">(</span><span class="string" id="1572644">&#34;panic:&nbsp;&#34;</span><span class="op" id="1572653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572657">printany</span><span class="op" id="1572665">(</span><span class="ident" id="1572666">e</span><span class="op" id="1572667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572671">print</span><span class="op" id="1572676">(</span><span class="string" id="1572677">&#34;\n&#34;</span><span class="op" id="1572681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572685">gothrow</span><span class="op" id="1572692">(</span><span class="string" id="1572693">&#34;panic&nbsp;during&nbsp;gc&#34;</span><span class="op" id="1572710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572713">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572716">if</span>&nbsp;<span class="ident" id="1572719">gp</span><span class="op" id="1572721">.</span><span class="ident" id="1572722">m</span><span class="op" id="1572723">.</span><span class="ident" id="1572724">locks</span>&nbsp;<span class="op" id="1572730">!=</span>&nbsp;<span class="num" id="1572733">0</span>&nbsp;<span class="op" id="1572735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572739">print</span><span class="op" id="1572744">(</span><span class="string" id="1572745">&#34;panic:&nbsp;&#34;</span><span class="op" id="1572754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572758">printany</span><span class="op" id="1572766">(</span><span class="ident" id="1572767">e</span><span class="op" id="1572768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1572772">print</span><span class="op" id="1572777">(</span><span class="string" id="1572778">&#34;\n&#34;</span><span class="op" id="1572782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572786">gothrow</span><span class="op" id="1572793">(</span><span class="string" id="1572794">&#34;panic&nbsp;holding&nbsp;locks&#34;</span><span class="op" id="1572815">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572822">var</span>&nbsp;<span class="ident" id="1572826">p</span>&nbsp;<span class="ident" id="1572828">_panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572836">p</span><span class="op" id="1572837">.</span><span class="ident" id="1572838">arg</span>&nbsp;<span class="op" id="1572842">=</span>&nbsp;<span class="ident" id="1572844">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572847">p</span><span class="op" id="1572848">.</span><span class="ident" id="1572849">link</span>&nbsp;<span class="op" id="1572854">=</span>&nbsp;<span class="ident" id="1572856">gp</span><span class="op" id="1572858">.</span><span class="ident" id="1572859">_panic</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572867">gp</span><span class="op" id="1572869">.</span><span class="ident" id="1572870">_panic</span>&nbsp;<span class="op" id="1572877">=</span>&nbsp;<span class="op" id="1572879">(</span><span class="op" id="1572880">*</span><span class="ident" id="1572881">_panic</span><span class="op" id="1572887">)</span><span class="op" id="1572888">(</span><span class="ident" id="1572889">noescape</span><span class="op" id="1572897">(</span><span class="ident" id="1572898">unsafe</span><span class="op" id="1572904">.</span><span class="ident" id="1572905">Pointer</span><span class="op" id="1572912">(</span><span class="op" id="1572913">&amp;</span><span class="ident" id="1572914">p</span><span class="op" id="1572915">)</span><span class="op" id="1572916">)</span><span class="op" id="1572917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572921">for</span>&nbsp;<span class="op" id="1572925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1572929">d</span>&nbsp;<span class="op" id="1572931">:=</span>&nbsp;<span class="ident" id="1572934">gp</span><span class="op" id="1572936">.</span><span class="ident" id="1572937">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572946">if</span>&nbsp;<span class="ident" id="1572949">d</span>&nbsp;<span class="op" id="1572951">==</span>&nbsp;<span class="builtintype" id="1572954">nil</span>&nbsp;<span class="op" id="1572958">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1572963">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1572971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1572976">//&nbsp;If&nbsp;defer&nbsp;was&nbsp;started&nbsp;by&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;(and,&nbsp;since&nbsp;we&#39;re&nbsp;back&nbsp;here,&nbsp;that&nbsp;triggered&nbsp;a&nbsp;new&nbsp;panic),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573087">//&nbsp;take&nbsp;defer&nbsp;off&nbsp;list.&nbsp;The&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;will&nbsp;not&nbsp;continue&nbsp;running.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1573168">if</span>&nbsp;<span class="ident" id="1573171">d</span><span class="op" id="1573172">.</span><span class="ident" id="1573173">started</span>&nbsp;<span class="op" id="1573181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1573186">if</span>&nbsp;<span class="ident" id="1573189">d</span><span class="op" id="1573190">.</span><span class="ident" id="1573191">_panic</span>&nbsp;<span class="op" id="1573198">!=</span>&nbsp;<span class="builtintype" id="1573201">nil</span>&nbsp;<span class="op" id="1573205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573211">d</span><span class="op" id="1573212">.</span><span class="ident" id="1573213">_panic</span><span class="op" id="1573219">.</span><span class="ident" id="1573220">aborted</span>&nbsp;<span class="op" id="1573228">=</span>&nbsp;<span class="builtintype" id="1573230">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1573238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573243">d</span><span class="op" id="1573244">.</span><span class="ident" id="1573245">_panic</span>&nbsp;<span class="op" id="1573252">=</span>&nbsp;<span class="builtintype" id="1573254">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573261">d</span><span class="op" id="1573262">.</span><span class="ident" id="1573263">fn</span>&nbsp;<span class="op" id="1573266">=</span>&nbsp;<span class="builtintype" id="1573268">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573275">gp</span><span class="op" id="1573277">.</span><span class="ident" id="1573278">_defer</span>&nbsp;<span class="op" id="1573285">=</span>&nbsp;<span class="ident" id="1573287">d</span><span class="op" id="1573288">.</span><span class="ident" id="1573289">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573297">freedefer</span><span class="op" id="1573306">(</span><span class="ident" id="1573307">d</span><span class="op" id="1573308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1573313">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1573324">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573329">//&nbsp;Mark&nbsp;defer&nbsp;as&nbsp;started,&nbsp;but&nbsp;keep&nbsp;on&nbsp;list,&nbsp;so&nbsp;that&nbsp;traceback</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573393">//&nbsp;can&nbsp;find&nbsp;and&nbsp;update&nbsp;the&nbsp;defer&#39;s&nbsp;argument&nbsp;frame&nbsp;if&nbsp;stack&nbsp;growth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573461">//&nbsp;or&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;hapens&nbsp;before&nbsp;reflectcall&nbsp;starts&nbsp;executing&nbsp;d.fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573539">d</span><span class="op" id="1573540">.</span><span class="ident" id="1573541">started</span>&nbsp;<span class="op" id="1573549">=</span>&nbsp;<span class="builtintype" id="1573551">true</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573559">//&nbsp;Record&nbsp;the&nbsp;panic&nbsp;that&nbsp;is&nbsp;running&nbsp;the&nbsp;defer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573608">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;new&nbsp;panic&nbsp;during&nbsp;the&nbsp;deferred&nbsp;call,&nbsp;that&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573674">//&nbsp;will&nbsp;find&nbsp;d&nbsp;in&nbsp;the&nbsp;list&nbsp;and&nbsp;will&nbsp;mark&nbsp;d._panic&nbsp;(this&nbsp;panic)&nbsp;aborted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573748">d</span><span class="op" id="1573749">.</span><span class="ident" id="1573750">_panic</span>&nbsp;<span class="op" id="1573757">=</span>&nbsp;<span class="op" id="1573759">(</span><span class="op" id="1573760">*</span><span class="ident" id="1573761">_panic</span><span class="op" id="1573767">)</span><span class="op" id="1573768">(</span><span class="ident" id="1573769">noescape</span><span class="op" id="1573777">(</span><span class="op" id="1573778">(</span><span class="ident" id="1573779">unsafe</span><span class="op" id="1573785">.</span><span class="ident" id="1573786">Pointer</span><span class="op" id="1573793">)</span><span class="op" id="1573794">(</span><span class="op" id="1573795">&amp;</span><span class="ident" id="1573796">p</span><span class="op" id="1573797">)</span><span class="op" id="1573798">)</span><span class="op" id="1573799">)</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573804">p</span><span class="op" id="1573805">.</span><span class="ident" id="1573806">argp</span>&nbsp;<span class="op" id="1573811">=</span>&nbsp;<span class="ident" id="1573813">unsafe</span><span class="op" id="1573819">.</span><span class="ident" id="1573820">Pointer</span><span class="op" id="1573827">(</span><span class="ident" id="1573828">getargp</span><span class="op" id="1573835">(</span><span class="num" id="1573836">0</span><span class="op" id="1573837">)</span><span class="op" id="1573838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573842">reflectcall</span><span class="op" id="1573853">(</span><span class="ident" id="1573854">unsafe</span><span class="op" id="1573860">.</span><span class="ident" id="1573861">Pointer</span><span class="op" id="1573868">(</span><span class="ident" id="1573869">d</span><span class="op" id="1573870">.</span><span class="ident" id="1573871">fn</span><span class="op" id="1573873">)</span><span class="op" id="1573874">,</span>&nbsp;<span class="ident" id="1573876">deferArgs</span><span class="op" id="1573885">(</span><span class="ident" id="1573886">d</span><span class="op" id="1573887">)</span><span class="op" id="1573888">,</span>&nbsp;<span class="builtintype" id="1573890">uint32</span><span class="op" id="1573896">(</span><span class="ident" id="1573897">d</span><span class="op" id="1573898">.</span><span class="ident" id="1573899">siz</span><span class="op" id="1573902">)</span><span class="op" id="1573903">,</span>&nbsp;<span class="builtintype" id="1573905">uint32</span><span class="op" id="1573911">(</span><span class="ident" id="1573912">d</span><span class="op" id="1573913">.</span><span class="ident" id="1573914">siz</span><span class="op" id="1573917">)</span><span class="op" id="1573918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1573922">p</span><span class="op" id="1573923">.</span><span class="ident" id="1573924">argp</span>&nbsp;<span class="op" id="1573929">=</span>&nbsp;<span class="builtintype" id="1573931">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1573938">//&nbsp;reflectcall&nbsp;did&nbsp;not&nbsp;panic.&nbsp;Remove&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1573980">if</span>&nbsp;<span class="ident" id="1573983">gp</span><span class="op" id="1573985">.</span><span class="ident" id="1573986">_defer</span>&nbsp;<span class="op" id="1573993">!=</span>&nbsp;<span class="ident" id="1573996">d</span>&nbsp;<span class="op" id="1573998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574003">gothrow</span><span class="op" id="1574010">(</span><span class="string" id="1574011">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;panic&#34;</span><span class="op" id="1574037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1574041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574045">d</span><span class="op" id="1574046">.</span><span class="ident" id="1574047">_panic</span>&nbsp;<span class="op" id="1574054">=</span>&nbsp;<span class="builtintype" id="1574056">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574062">d</span><span class="op" id="1574063">.</span><span class="ident" id="1574064">fn</span>&nbsp;<span class="op" id="1574067">=</span>&nbsp;<span class="builtintype" id="1574069">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574075">gp</span><span class="op" id="1574077">.</span><span class="ident" id="1574078">_defer</span>&nbsp;<span class="op" id="1574085">=</span>&nbsp;<span class="ident" id="1574087">d</span><span class="op" id="1574088">.</span><span class="ident" id="1574089">link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574097">//&nbsp;trigger&nbsp;shrinkage&nbsp;to&nbsp;test&nbsp;stack&nbsp;copy.&nbsp;&nbsp;See&nbsp;stack_test.go:TestStackPanic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574174">//GC()</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574184">pc</span>&nbsp;<span class="op" id="1574187">:=</span>&nbsp;<span class="ident" id="1574190">d</span><span class="op" id="1574191">.</span><span class="ident" id="1574192">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574197">argp</span>&nbsp;<span class="op" id="1574202">:=</span>&nbsp;<span class="ident" id="1574205">unsafe</span><span class="op" id="1574211">.</span><span class="ident" id="1574212">Pointer</span><span class="op" id="1574219">(</span><span class="ident" id="1574220">d</span><span class="op" id="1574221">.</span><span class="ident" id="1574222">argp</span><span class="op" id="1574226">)</span>&nbsp;<span class="comment" id="1574228">//&nbsp;must&nbsp;be&nbsp;pointer&nbsp;so&nbsp;it&nbsp;gets&nbsp;adjusted&nbsp;during&nbsp;stack&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574287">freedefer</span><span class="op" id="1574296">(</span><span class="ident" id="1574297">d</span><span class="op" id="1574298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1574302">if</span>&nbsp;<span class="ident" id="1574305">p</span><span class="op" id="1574306">.</span><span class="ident" id="1574307">recovered</span>&nbsp;<span class="op" id="1574317">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574322">gp</span><span class="op" id="1574324">.</span><span class="ident" id="1574325">_panic</span>&nbsp;<span class="op" id="1574332">=</span>&nbsp;<span class="ident" id="1574334">p</span><span class="op" id="1574335">.</span><span class="ident" id="1574336">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574344">//&nbsp;Aborted&nbsp;panics&nbsp;are&nbsp;marked&nbsp;but&nbsp;remain&nbsp;on&nbsp;the&nbsp;g.panic&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574408">//&nbsp;Remove&nbsp;them&nbsp;from&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1574441">for</span>&nbsp;<span class="ident" id="1574445">gp</span><span class="op" id="1574447">.</span><span class="ident" id="1574448">_panic</span>&nbsp;<span class="op" id="1574455">!=</span>&nbsp;<span class="builtintype" id="1574458">nil</span>&nbsp;<span class="op" id="1574462">&amp;&amp;</span>&nbsp;<span class="ident" id="1574465">gp</span><span class="op" id="1574467">.</span><span class="ident" id="1574468">_panic</span><span class="op" id="1574474">.</span><span class="ident" id="1574475">aborted</span>&nbsp;<span class="op" id="1574483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574489">gp</span><span class="op" id="1574491">.</span><span class="ident" id="1574492">_panic</span>&nbsp;<span class="op" id="1574499">=</span>&nbsp;<span class="ident" id="1574501">gp</span><span class="op" id="1574503">.</span><span class="ident" id="1574504">_panic</span><span class="op" id="1574510">.</span><span class="ident" id="1574511">link</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1574519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1574524">if</span>&nbsp;<span class="ident" id="1574527">gp</span><span class="op" id="1574529">.</span><span class="ident" id="1574530">_panic</span>&nbsp;<span class="op" id="1574537">==</span>&nbsp;<span class="builtintype" id="1574540">nil</span>&nbsp;<span class="op" id="1574544">{</span>&nbsp;<span class="comment" id="1574546">//&nbsp;must&nbsp;be&nbsp;done&nbsp;with&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574578">gp</span><span class="op" id="1574580">.</span><span class="ident" id="1574581">sig</span>&nbsp;<span class="op" id="1574585">=</span>&nbsp;<span class="num" id="1574587">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1574592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574597">//&nbsp;Pass&nbsp;information&nbsp;about&nbsp;recovering&nbsp;frame&nbsp;to&nbsp;recovery.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574656">gp</span><span class="op" id="1574658">.</span><span class="ident" id="1574659">sigcode0</span>&nbsp;<span class="op" id="1574668">=</span>&nbsp;<span class="builtintype" id="1574670">uintptr</span><span class="op" id="1574677">(</span><span class="ident" id="1574678">argp</span><span class="op" id="1574682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574687">gp</span><span class="op" id="1574689">.</span><span class="ident" id="1574690">sigcode1</span>&nbsp;<span class="op" id="1574699">=</span>&nbsp;<span class="ident" id="1574701">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574707">mcall</span><span class="op" id="1574712">(</span><span class="ident" id="1574713">recovery_m</span><span class="op" id="1574723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574728">gothrow</span><span class="op" id="1574735">(</span><span class="string" id="1574736">&#34;recovery&nbsp;failed&#34;</span><span class="op" id="1574753">)</span>&nbsp;<span class="comment" id="1574755">//&nbsp;mcall&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1574784">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1574787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574791">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;deferred&nbsp;calls&nbsp;-&nbsp;old-school&nbsp;panic&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574844">startpanic</span><span class="op" id="1574854">(</span><span class="op" id="1574855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574858">printpanics</span><span class="op" id="1574869">(</span><span class="ident" id="1574870">gp</span><span class="op" id="1574872">.</span><span class="ident" id="1574873">_panic</span><span class="op" id="1574879">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1574882">dopanic</span><span class="op" id="1574889">(</span><span class="num" id="1574890">0</span><span class="op" id="1574891">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1574899">//&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1574921">*</span><span class="op" id="1574922">(</span><span class="op" id="1574923">*</span><span class="builtintype" id="1574924">int</span><span class="op" id="1574927">)</span><span class="op" id="1574928">(</span><span class="builtintype" id="1574929">nil</span><span class="op" id="1574932">)</span>&nbsp;<span class="op" id="1574934">=</span>&nbsp;<span class="num" id="1574936">0</span>&nbsp;<span class="comment" id="1574938">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1574953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1574956">//&nbsp;getargp&nbsp;returns&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;caller</span><br>
<span class="lineno">430</span><span class="comment" id="1575005">//&nbsp;writes&nbsp;outgoing&nbsp;function&nbsp;call&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1575049">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1575062">func</span>&nbsp;<span class="ident" id="1575067">getargp</span><span class="op" id="1575074">(</span><span class="ident" id="1575075">x</span>&nbsp;<span class="builtintype" id="1575077">int</span><span class="op" id="1575080">)</span>&nbsp;<span class="builtintype" id="1575082">uintptr</span>&nbsp;<span class="op" id="1575090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575093">//&nbsp;x&nbsp;is&nbsp;an&nbsp;argument&nbsp;mainly&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;return&nbsp;its&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575156">//&nbsp;However,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;the&nbsp;function&nbsp;complex&nbsp;enough</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575213">//&nbsp;that&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;inlined.&nbsp;We&nbsp;always&nbsp;pass&nbsp;x&nbsp;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575278">//&nbsp;does&nbsp;nothing&nbsp;other&nbsp;than&nbsp;keep&nbsp;the&nbsp;compiler&nbsp;from&nbsp;thinking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575338">//&nbsp;the&nbsp;function&nbsp;is&nbsp;simple&nbsp;enough&nbsp;to&nbsp;inline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1575383">if</span>&nbsp;<span class="ident" id="1575386">x</span>&nbsp;<span class="op" id="1575388">&gt;</span>&nbsp;<span class="num" id="1575390">0</span>&nbsp;<span class="op" id="1575392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1575396">return</span>&nbsp;<span class="ident" id="1575403">getcallersp</span><span class="op" id="1575414">(</span><span class="ident" id="1575415">unsafe</span><span class="op" id="1575421">.</span><span class="ident" id="1575422">Pointer</span><span class="op" id="1575429">(</span><span class="op" id="1575430">&amp;</span><span class="ident" id="1575431">x</span><span class="op" id="1575432">)</span><span class="op" id="1575433">)</span>&nbsp;<span class="op" id="1575435">*</span>&nbsp;<span class="num" id="1575437">0</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1575440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1575443">return</span>&nbsp;<span class="builtintype" id="1575450">uintptr</span><span class="op" id="1575457">(</span><span class="ident" id="1575458">noescape</span><span class="op" id="1575466">(</span><span class="ident" id="1575467">unsafe</span><span class="op" id="1575473">.</span><span class="ident" id="1575474">Pointer</span><span class="op" id="1575481">(</span><span class="op" id="1575482">&amp;</span><span class="ident" id="1575483">x</span><span class="op" id="1575484">)</span><span class="op" id="1575485">)</span><span class="op" id="1575486">)</span><br>
<span class="lineno"></span><span class="op" id="1575488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1575491">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;recover.</span><br>
<span class="lineno">445</span><span class="comment" id="1575550">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;it&nbsp;needs&nbsp;to&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="1575605">//&nbsp;find&nbsp;the&nbsp;stack&nbsp;segment&nbsp;of&nbsp;its&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1575646">//</span><br>
<span class="lineno"></span><span class="comment" id="1575649">//&nbsp;TODO(rsc):&nbsp;Once&nbsp;we&nbsp;commit&nbsp;to&nbsp;CopyStackAlways,</span><br>
<span class="lineno"></span><span class="comment" id="1575698">//&nbsp;this&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;nosplit.</span><br>
<span class="lineno">450</span><span class="comment" id="1575734">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1575747">func</span>&nbsp;<span class="ident" id="1575752">gorecover</span><span class="op" id="1575761">(</span><span class="ident" id="1575762">argp</span>&nbsp;<span class="builtintype" id="1575767">uintptr</span><span class="op" id="1575774">)</span>&nbsp;<span class="keyword" id="1575776">interface</span><span class="op" id="1575785">{</span><span class="op" id="1575786">}</span>&nbsp;<span class="op" id="1575788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575791">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;a&nbsp;function&nbsp;running&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;deferred&nbsp;call&nbsp;during&nbsp;the&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575870">//&nbsp;Must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;topmost&nbsp;function&nbsp;of&nbsp;the&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575927">//&nbsp;(the&nbsp;function&nbsp;used&nbsp;in&nbsp;the&nbsp;defer&nbsp;statement).</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1575975">//&nbsp;p.argp&nbsp;is&nbsp;the&nbsp;argument&nbsp;pointer&nbsp;of&nbsp;that&nbsp;topmost&nbsp;deferred&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1576050">//&nbsp;Compare&nbsp;against&nbsp;argp&nbsp;reported&nbsp;by&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1576095">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;who&nbsp;can&nbsp;recover.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576153">gp</span>&nbsp;<span class="op" id="1576156">:=</span>&nbsp;<span class="ident" id="1576159">getg</span><span class="op" id="1576163">(</span><span class="op" id="1576164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576167">p</span>&nbsp;<span class="op" id="1576169">:=</span>&nbsp;<span class="ident" id="1576172">gp</span><span class="op" id="1576174">.</span><span class="ident" id="1576175">_panic</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1576183">if</span>&nbsp;<span class="ident" id="1576186">p</span>&nbsp;<span class="op" id="1576188">!=</span>&nbsp;<span class="builtintype" id="1576191">nil</span>&nbsp;<span class="op" id="1576195">&amp;&amp;</span>&nbsp;<span class="op" id="1576198">!</span><span class="ident" id="1576199">p</span><span class="op" id="1576200">.</span><span class="ident" id="1576201">recovered</span>&nbsp;<span class="op" id="1576211">&amp;&amp;</span>&nbsp;<span class="ident" id="1576214">argp</span>&nbsp;<span class="op" id="1576219">==</span>&nbsp;<span class="builtintype" id="1576222">uintptr</span><span class="op" id="1576229">(</span><span class="ident" id="1576230">p</span><span class="op" id="1576231">.</span><span class="ident" id="1576232">argp</span><span class="op" id="1576236">)</span>&nbsp;<span class="op" id="1576238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576242">p</span><span class="op" id="1576243">.</span><span class="ident" id="1576244">recovered</span>&nbsp;<span class="op" id="1576254">=</span>&nbsp;<span class="builtintype" id="1576256">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1576263">return</span>&nbsp;<span class="ident" id="1576270">p</span><span class="op" id="1576271">.</span><span class="ident" id="1576272">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1576277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1576280">return</span>&nbsp;<span class="builtintype" id="1576287">nil</span><br>
<span class="lineno">465</span><span class="op" id="1576291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1576294">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1576307">func</span>&nbsp;<span class="ident" id="1576312">startpanic</span><span class="op" id="1576322">(</span><span class="op" id="1576323">)</span>&nbsp;<span class="op" id="1576325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576328">onM_signalok</span><span class="op" id="1576340">(</span><span class="ident" id="1576341">startpanic_m</span><span class="op" id="1576353">)</span><br>
<span class="lineno">470</span><span class="op" id="1576355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1576358">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1576371">func</span>&nbsp;<span class="ident" id="1576376">dopanic</span><span class="op" id="1576383">(</span><span class="ident" id="1576384">unused</span>&nbsp;<span class="builtintype" id="1576391">int</span><span class="op" id="1576394">)</span>&nbsp;<span class="op" id="1576396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576399">gp</span>&nbsp;<span class="op" id="1576402">:=</span>&nbsp;<span class="ident" id="1576405">getg</span><span class="op" id="1576409">(</span><span class="op" id="1576410">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576413">mp</span>&nbsp;<span class="op" id="1576416">:=</span>&nbsp;<span class="ident" id="1576419">acquirem</span><span class="op" id="1576427">(</span><span class="op" id="1576428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576431">mp</span><span class="op" id="1576433">.</span><span class="ident" id="1576434">ptrarg</span><span class="op" id="1576440">[</span><span class="num" id="1576441">0</span><span class="op" id="1576442">]</span>&nbsp;<span class="op" id="1576444">=</span>&nbsp;<span class="ident" id="1576446">unsafe</span><span class="op" id="1576452">.</span><span class="ident" id="1576453">Pointer</span><span class="op" id="1576460">(</span><span class="ident" id="1576461">gp</span><span class="op" id="1576463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576466">mp</span><span class="op" id="1576468">.</span><span class="ident" id="1576469">scalararg</span><span class="op" id="1576478">[</span><span class="num" id="1576479">0</span><span class="op" id="1576480">]</span>&nbsp;<span class="op" id="1576482">=</span>&nbsp;<span class="ident" id="1576484">getcallerpc</span><span class="op" id="1576495">(</span><span class="op" id="1576496">(</span><span class="ident" id="1576497">unsafe</span><span class="op" id="1576503">.</span><span class="ident" id="1576504">Pointer</span><span class="op" id="1576511">)</span><span class="op" id="1576512">(</span><span class="op" id="1576513">&amp;</span><span class="ident" id="1576514">unused</span><span class="op" id="1576520">)</span><span class="op" id="1576521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576524">mp</span><span class="op" id="1576526">.</span><span class="ident" id="1576527">scalararg</span><span class="op" id="1576536">[</span><span class="num" id="1576537">1</span><span class="op" id="1576538">]</span>&nbsp;<span class="op" id="1576540">=</span>&nbsp;<span class="ident" id="1576542">getcallersp</span><span class="op" id="1576553">(</span><span class="op" id="1576554">(</span><span class="ident" id="1576555">unsafe</span><span class="op" id="1576561">.</span><span class="ident" id="1576562">Pointer</span><span class="op" id="1576569">)</span><span class="op" id="1576570">(</span><span class="op" id="1576571">&amp;</span><span class="ident" id="1576572">unused</span><span class="op" id="1576578">)</span><span class="op" id="1576579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576582">onM_signalok</span><span class="op" id="1576594">(</span><span class="ident" id="1576595">dopanic_m</span><span class="op" id="1576604">)</span>&nbsp;<span class="comment" id="1576606">//&nbsp;should&nbsp;never&nbsp;return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1576630">*</span><span class="op" id="1576631">(</span><span class="op" id="1576632">*</span><span class="builtintype" id="1576633">int</span><span class="op" id="1576636">)</span><span class="op" id="1576637">(</span><span class="builtintype" id="1576638">nil</span><span class="op" id="1576641">)</span>&nbsp;<span class="op" id="1576643">=</span>&nbsp;<span class="num" id="1576645">0</span><br>
<span class="lineno"></span><span class="op" id="1576647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1576650">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1576663">func</span>&nbsp;<span class="ident" id="1576668">throw</span><span class="op" id="1576673">(</span><span class="ident" id="1576674">s</span>&nbsp;<span class="op" id="1576676">*</span><span class="builtintype" id="1576677">byte</span><span class="op" id="1576681">)</span>&nbsp;<span class="op" id="1576683">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576686">gp</span>&nbsp;<span class="op" id="1576689">:=</span>&nbsp;<span class="ident" id="1576692">getg</span><span class="op" id="1576696">(</span><span class="op" id="1576697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1576700">if</span>&nbsp;<span class="ident" id="1576703">gp</span><span class="op" id="1576705">.</span><span class="ident" id="1576706">m</span><span class="op" id="1576707">.</span><span class="ident" id="1576708">throwing</span>&nbsp;<span class="op" id="1576717">==</span>&nbsp;<span class="num" id="1576720">0</span>&nbsp;<span class="op" id="1576722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576726">gp</span><span class="op" id="1576728">.</span><span class="ident" id="1576729">m</span><span class="op" id="1576730">.</span><span class="ident" id="1576731">throwing</span>&nbsp;<span class="op" id="1576740">=</span>&nbsp;<span class="num" id="1576742">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1576745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576748">startpanic</span><span class="op" id="1576758">(</span><span class="op" id="1576759">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1576762">print</span><span class="op" id="1576767">(</span><span class="string" id="1576768">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1576783">,</span>&nbsp;<span class="ident" id="1576785">gostringnocopy</span><span class="op" id="1576799">(</span><span class="ident" id="1576800">s</span><span class="op" id="1576801">)</span><span class="op" id="1576802">,</span>&nbsp;<span class="string" id="1576804">&#34;\n&#34;</span><span class="op" id="1576808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576811">dopanic</span><span class="op" id="1576818">(</span><span class="num" id="1576819">0</span><span class="op" id="1576820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1576823">*</span><span class="op" id="1576824">(</span><span class="op" id="1576825">*</span><span class="builtintype" id="1576826">int</span><span class="op" id="1576829">)</span><span class="op" id="1576830">(</span><span class="builtintype" id="1576831">nil</span><span class="op" id="1576834">)</span>&nbsp;<span class="op" id="1576836">=</span>&nbsp;<span class="num" id="1576838">0</span>&nbsp;<span class="comment" id="1576840">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1576855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1576858">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1576871">func</span>&nbsp;<span class="ident" id="1576876">gothrow</span><span class="op" id="1576883">(</span><span class="ident" id="1576884">s</span>&nbsp;<span class="builtintype" id="1576886">string</span><span class="op" id="1576892">)</span>&nbsp;<span class="op" id="1576894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576897">gp</span>&nbsp;<span class="op" id="1576900">:=</span>&nbsp;<span class="ident" id="1576903">getg</span><span class="op" id="1576907">(</span><span class="op" id="1576908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1576911">if</span>&nbsp;<span class="ident" id="1576914">gp</span><span class="op" id="1576916">.</span><span class="ident" id="1576917">m</span><span class="op" id="1576918">.</span><span class="ident" id="1576919">throwing</span>&nbsp;<span class="op" id="1576928">==</span>&nbsp;<span class="num" id="1576931">0</span>&nbsp;<span class="op" id="1576933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576937">gp</span><span class="op" id="1576939">.</span><span class="ident" id="1576940">m</span><span class="op" id="1576941">.</span><span class="ident" id="1576942">throwing</span>&nbsp;<span class="op" id="1576951">=</span>&nbsp;<span class="num" id="1576953">1</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1576956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1576959">startpanic</span><span class="op" id="1576969">(</span><span class="op" id="1576970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1576973">print</span><span class="op" id="1576978">(</span><span class="string" id="1576979">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1576994">,</span>&nbsp;<span class="ident" id="1576996">s</span><span class="op" id="1576997">,</span>&nbsp;<span class="string" id="1576999">&#34;\n&#34;</span><span class="op" id="1577003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1577006">dopanic</span><span class="op" id="1577013">(</span><span class="num" id="1577014">0</span><span class="op" id="1577015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1577018">*</span><span class="op" id="1577019">(</span><span class="op" id="1577020">*</span><span class="builtintype" id="1577021">int</span><span class="op" id="1577024">)</span><span class="op" id="1577025">(</span><span class="builtintype" id="1577026">nil</span><span class="op" id="1577029">)</span>&nbsp;<span class="op" id="1577031">=</span>&nbsp;<span class="num" id="1577033">0</span>&nbsp;<span class="comment" id="1577035">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno">505</span><span class="op" id="1577050">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
