<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7653873">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7653928">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7653982">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7654033">//&nbsp;Tests&nbsp;a&nbsp;Go&nbsp;CGI&nbsp;program&nbsp;running&nbsp;under&nbsp;a&nbsp;Go&nbsp;CGI&nbsp;host&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="7654096">//&nbsp;Further,&nbsp;the&nbsp;two&nbsp;programs&nbsp;are&nbsp;the&nbsp;same&nbsp;binary,&nbsp;just&nbsp;checking</span><br>
<span class="lineno"></span><span class="comment" id="7654160">//&nbsp;their&nbsp;environment&nbsp;to&nbsp;figure&nbsp;out&nbsp;what&nbsp;mode&nbsp;to&nbsp;run&nbsp;in.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7654217">package</span>&nbsp;<span class="ident" id="7654225">cgi</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="7654230">import</span>&nbsp;<span class="op" id="7654237">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654240">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654249">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654259">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654266">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654272">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654284">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654305">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654311">&#34;runtime&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654322">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654333">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7654340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7654343">//&nbsp;This&nbsp;test&nbsp;is&nbsp;a&nbsp;CGI&nbsp;host&nbsp;(testing&nbsp;host.go)&nbsp;that&nbsp;runs&nbsp;its&nbsp;own&nbsp;binary</span><br>
<span class="lineno">25</span><span class="comment" id="7654413">//&nbsp;as&nbsp;a&nbsp;child&nbsp;process&nbsp;testing&nbsp;the&nbsp;other&nbsp;half&nbsp;of&nbsp;CGI&nbsp;(child.go).</span><br>
<span class="lineno"></span><span class="keyword" id="7654477">func</span>&nbsp;<span class="ident" id="7654482">TestHostingOurselves</span><span class="op" id="7654502">(</span><span class="ident" id="7654503">t</span>&nbsp;<span class="op" id="7654505">*</span><span class="ident" id="7654506">testing</span><span class="op" id="7654513">.</span><span class="ident" id="7654514">T</span><span class="op" id="7654515">)</span>&nbsp;<span class="op" id="7654517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7654520">if</span>&nbsp;<span class="ident" id="7654523">runtime</span><span class="op" id="7654530">.</span><span class="ident" id="7654531">GOOS</span>&nbsp;<span class="op" id="7654536">==</span>&nbsp;<span class="string" id="7654539">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7654546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654550">t</span><span class="op" id="7654551">.</span><span class="ident" id="7654552">Skip</span><span class="op" id="7654556">(</span><span class="string" id="7654557">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="7654575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654578">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654582">h</span>&nbsp;<span class="op" id="7654584">:=</span>&nbsp;<span class="op" id="7654587">&amp;</span><span class="ident" id="7654588">Handler</span><span class="op" id="7654595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654599">Path</span><span class="op" id="7654603">:</span>&nbsp;<span class="ident" id="7654605">os</span><span class="op" id="7654607">.</span><span class="ident" id="7654608">Args</span><span class="op" id="7654612">[</span><span class="num" id="7654613">0</span><span class="op" id="7654614">]</span><span class="op" id="7654615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654619">Root</span><span class="op" id="7654623">:</span>&nbsp;<span class="string" id="7654625">&#34;/test.go&#34;</span><span class="op" id="7654635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654639">Args</span><span class="op" id="7654643">:</span>&nbsp;<span class="op" id="7654645">[</span><span class="op" id="7654646">]</span><span class="builtintype" id="7654647">string</span><span class="op" id="7654653">{</span><span class="string" id="7654654">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7654687">}</span><span class="op" id="7654688">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7654691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7654694">expectedMap</span>&nbsp;<span class="op" id="7654706">:=</span>&nbsp;<span class="keyword" id="7654709">map</span><span class="op" id="7654712">[</span><span class="builtintype" id="7654713">string</span><span class="op" id="7654719">]</span><span class="builtintype" id="7654720">string</span><span class="op" id="7654726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654730">&#34;test&#34;</span><span class="op" id="7654736">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7654755">&#34;Hello&nbsp;CGI-in-CGI&#34;</span><span class="op" id="7654773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654777">&#34;param-a&#34;</span><span class="op" id="7654786">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7654802">&#34;b&#34;</span><span class="op" id="7654805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654809">&#34;param-foo&#34;</span><span class="op" id="7654820">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7654834">&#34;bar&#34;</span><span class="op" id="7654839">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654843">&#34;env-GATEWAY_INTERFACE&#34;</span><span class="op" id="7654866">:</span>&nbsp;<span class="string" id="7654868">&#34;CGI/1.1&#34;</span><span class="op" id="7654877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654881">&#34;env-HTTP_HOST&#34;</span><span class="op" id="7654896">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7654906">&#34;example.com&#34;</span><span class="op" id="7654919">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654923">&#34;env-PATH_INFO&#34;</span><span class="op" id="7654938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7654948">&#34;&#34;</span><span class="op" id="7654950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654954">&#34;env-QUERY_STRING&#34;</span><span class="op" id="7654972">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7654979">&#34;foo=bar&amp;a=b&#34;</span><span class="op" id="7654992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7654996">&#34;env-REMOTE_ADDR&#34;</span><span class="op" id="7655013">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655021">&#34;1.2.3.4&#34;</span><span class="op" id="7655030">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655034">&#34;env-REMOTE_HOST&#34;</span><span class="op" id="7655051">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655059">&#34;1.2.3.4&#34;</span><span class="op" id="7655068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655072">&#34;env-REQUEST_METHOD&#34;</span><span class="op" id="7655092">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655097">&#34;GET&#34;</span><span class="op" id="7655102">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655106">&#34;env-REQUEST_URI&#34;</span><span class="op" id="7655123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655131">&#34;/test.go?foo=bar&amp;a=b&#34;</span><span class="op" id="7655153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655157">&#34;env-SCRIPT_FILENAME&#34;</span><span class="op" id="7655178">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7655182">os</span><span class="op" id="7655184">.</span><span class="ident" id="7655185">Args</span><span class="op" id="7655189">[</span><span class="num" id="7655190">0</span><span class="op" id="7655191">]</span><span class="op" id="7655192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655196">&#34;env-SCRIPT_NAME&#34;</span><span class="op" id="7655213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655221">&#34;/test.go&#34;</span><span class="op" id="7655231">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655235">&#34;env-SERVER_NAME&#34;</span><span class="op" id="7655252">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655260">&#34;example.com&#34;</span><span class="op" id="7655273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655277">&#34;env-SERVER_PORT&#34;</span><span class="op" id="7655294">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7655302">&#34;80&#34;</span><span class="op" id="7655306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7655310">&#34;env-SERVER_SOFTWARE&#34;</span><span class="op" id="7655331">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7655335">&#34;go&#34;</span><span class="op" id="7655339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655345">replay</span>&nbsp;<span class="op" id="7655352">:=</span>&nbsp;<span class="ident" id="7655355">runCgiTest</span><span class="op" id="7655365">(</span><span class="ident" id="7655366">t</span><span class="op" id="7655367">,</span>&nbsp;<span class="ident" id="7655369">h</span><span class="op" id="7655370">,</span>&nbsp;<span class="string" id="7655372">&#34;GET&nbsp;/test.go?foo=bar&amp;a=b&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7655430">,</span>&nbsp;<span class="ident" id="7655432">expectedMap</span><span class="op" id="7655443">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655447">if</span>&nbsp;<span class="ident" id="7655450">expected</span><span class="op" id="7655458">,</span>&nbsp;<span class="ident" id="7655460">got</span>&nbsp;<span class="op" id="7655464">:=</span>&nbsp;<span class="string" id="7655467">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="7655493">,</span>&nbsp;<span class="ident" id="7655495">replay</span><span class="op" id="7655501">.</span><span class="ident" id="7655502">Header</span><span class="op" id="7655508">(</span><span class="op" id="7655509">)</span><span class="op" id="7655510">.</span><span class="ident" id="7655511">Get</span><span class="op" id="7655514">(</span><span class="string" id="7655515">&#34;Content-Type&#34;</span><span class="op" id="7655529">)</span><span class="op" id="7655530">;</span>&nbsp;<span class="ident" id="7655532">got</span>&nbsp;<span class="op" id="7655536">!=</span>&nbsp;<span class="ident" id="7655539">expected</span>&nbsp;<span class="op" id="7655548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655552">t</span><span class="op" id="7655553">.</span><span class="ident" id="7655554">Errorf</span><span class="op" id="7655560">(</span><span class="string" id="7655561">&#34;got&nbsp;a&nbsp;Content-Type&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7655600">,</span>&nbsp;<span class="ident" id="7655602">got</span><span class="op" id="7655605">,</span>&nbsp;<span class="ident" id="7655607">expected</span><span class="op" id="7655615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655621">if</span>&nbsp;<span class="ident" id="7655624">expected</span><span class="op" id="7655632">,</span>&nbsp;<span class="ident" id="7655634">got</span>&nbsp;<span class="op" id="7655638">:=</span>&nbsp;<span class="string" id="7655641">&#34;X-Test-Value&#34;</span><span class="op" id="7655655">,</span>&nbsp;<span class="ident" id="7655657">replay</span><span class="op" id="7655663">.</span><span class="ident" id="7655664">Header</span><span class="op" id="7655670">(</span><span class="op" id="7655671">)</span><span class="op" id="7655672">.</span><span class="ident" id="7655673">Get</span><span class="op" id="7655676">(</span><span class="string" id="7655677">&#34;X-Test-Header&#34;</span><span class="op" id="7655692">)</span><span class="op" id="7655693">;</span>&nbsp;<span class="ident" id="7655695">got</span>&nbsp;<span class="op" id="7655699">!=</span>&nbsp;<span class="ident" id="7655702">expected</span>&nbsp;<span class="op" id="7655711">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655715">t</span><span class="op" id="7655716">.</span><span class="ident" id="7655717">Errorf</span><span class="op" id="7655723">(</span><span class="string" id="7655724">&#34;got&nbsp;a&nbsp;X-Test-Header&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7655764">,</span>&nbsp;<span class="ident" id="7655766">got</span><span class="op" id="7655769">,</span>&nbsp;<span class="ident" id="7655771">expected</span><span class="op" id="7655779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655782">}</span><br>
<span class="lineno"></span><span class="op" id="7655784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7655787">type</span>&nbsp;<span class="ident" id="7655792">customWriterRecorder</span>&nbsp;<span class="keyword" id="7655813">struct</span>&nbsp;<span class="op" id="7655820">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655823">w</span>&nbsp;<span class="ident" id="7655825">io</span><span class="op" id="7655827">.</span><span class="ident" id="7655828">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7655836">*</span><span class="ident" id="7655837">httptest</span><span class="op" id="7655845">.</span><span class="ident" id="7655846">ResponseRecorder</span><br>
<span class="lineno"></span><span class="op" id="7655863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7655866">func</span>&nbsp;<span class="op" id="7655871">(</span><span class="ident" id="7655872">r</span>&nbsp;<span class="op" id="7655874">*</span><span class="ident" id="7655875">customWriterRecorder</span><span class="op" id="7655895">)</span>&nbsp;<span class="ident" id="7655897">Write</span><span class="op" id="7655902">(</span><span class="ident" id="7655903">p</span>&nbsp;<span class="op" id="7655905">[</span><span class="op" id="7655906">]</span><span class="builtintype" id="7655907">byte</span><span class="op" id="7655911">)</span>&nbsp;<span class="op" id="7655913">(</span><span class="ident" id="7655914">n</span>&nbsp;<span class="builtintype" id="7655916">int</span><span class="op" id="7655919">,</span>&nbsp;<span class="ident" id="7655921">err</span>&nbsp;<span class="builtintype" id="7655925">error</span><span class="op" id="7655930">)</span>&nbsp;<span class="op" id="7655932">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7655935">return</span>&nbsp;<span class="ident" id="7655942">r</span><span class="op" id="7655943">.</span><span class="ident" id="7655944">w</span><span class="op" id="7655945">.</span><span class="ident" id="7655946">Write</span><span class="op" id="7655951">(</span><span class="ident" id="7655952">p</span><span class="op" id="7655953">)</span><br>
<span class="lineno"></span><span class="op" id="7655955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7655958">type</span>&nbsp;<span class="ident" id="7655963">limitWriter</span>&nbsp;<span class="keyword" id="7655975">struct</span>&nbsp;<span class="op" id="7655982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655985">w</span>&nbsp;<span class="ident" id="7655987">io</span><span class="op" id="7655989">.</span><span class="ident" id="7655990">Writer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7655998">n</span>&nbsp;<span class="builtintype" id="7656000">int</span><br>
<span class="lineno"></span><span class="op" id="7656004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7656007">func</span>&nbsp;<span class="op" id="7656012">(</span><span class="ident" id="7656013">w</span>&nbsp;<span class="op" id="7656015">*</span><span class="ident" id="7656016">limitWriter</span><span class="op" id="7656027">)</span>&nbsp;<span class="ident" id="7656029">Write</span><span class="op" id="7656034">(</span><span class="ident" id="7656035">p</span>&nbsp;<span class="op" id="7656037">[</span><span class="op" id="7656038">]</span><span class="builtintype" id="7656039">byte</span><span class="op" id="7656043">)</span>&nbsp;<span class="op" id="7656045">(</span><span class="ident" id="7656046">n</span>&nbsp;<span class="builtintype" id="7656048">int</span><span class="op" id="7656051">,</span>&nbsp;<span class="ident" id="7656053">err</span>&nbsp;<span class="builtintype" id="7656057">error</span><span class="op" id="7656062">)</span>&nbsp;<span class="op" id="7656064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656067">if</span>&nbsp;<span class="builtinfunc" id="7656070">len</span><span class="op" id="7656073">(</span><span class="ident" id="7656074">p</span><span class="op" id="7656075">)</span>&nbsp;<span class="op" id="7656077">&gt;</span>&nbsp;<span class="ident" id="7656079">w</span><span class="op" id="7656080">.</span><span class="ident" id="7656081">n</span>&nbsp;<span class="op" id="7656083">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656087">p</span>&nbsp;<span class="op" id="7656089">=</span>&nbsp;<span class="ident" id="7656091">p</span><span class="op" id="7656092">[</span><span class="op" id="7656093">:</span><span class="ident" id="7656094">w</span><span class="op" id="7656095">.</span><span class="ident" id="7656096">n</span><span class="op" id="7656097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656103">if</span>&nbsp;<span class="builtinfunc" id="7656106">len</span><span class="op" id="7656109">(</span><span class="ident" id="7656110">p</span><span class="op" id="7656111">)</span>&nbsp;<span class="op" id="7656113">&gt;</span>&nbsp;<span class="num" id="7656115">0</span>&nbsp;<span class="op" id="7656117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656121">n</span><span class="op" id="7656122">,</span>&nbsp;<span class="ident" id="7656124">err</span>&nbsp;<span class="op" id="7656128">=</span>&nbsp;<span class="ident" id="7656130">w</span><span class="op" id="7656131">.</span><span class="ident" id="7656132">w</span><span class="op" id="7656133">.</span><span class="ident" id="7656134">Write</span><span class="op" id="7656139">(</span><span class="ident" id="7656140">p</span><span class="op" id="7656141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656145">w</span><span class="op" id="7656146">.</span><span class="ident" id="7656147">n</span>&nbsp;<span class="op" id="7656149">-=</span>&nbsp;<span class="ident" id="7656152">n</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656158">if</span>&nbsp;<span class="ident" id="7656161">w</span><span class="op" id="7656162">.</span><span class="ident" id="7656163">n</span>&nbsp;<span class="op" id="7656165">==</span>&nbsp;<span class="num" id="7656168">0</span>&nbsp;<span class="op" id="7656170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656174">err</span>&nbsp;<span class="op" id="7656178">=</span>&nbsp;<span class="ident" id="7656180">errors</span><span class="op" id="7656186">.</span><span class="ident" id="7656187">New</span><span class="op" id="7656190">(</span><span class="string" id="7656191">&#34;past&nbsp;write&nbsp;limit&#34;</span><span class="op" id="7656209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656215">return</span><br>
<span class="lineno">90</span><span class="op" id="7656222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7656225">//&nbsp;If&nbsp;there&#39;s&nbsp;an&nbsp;error&nbsp;copying&nbsp;the&nbsp;child&#39;s&nbsp;output&nbsp;to&nbsp;the&nbsp;parent,&nbsp;test</span><br>
<span class="lineno"></span><span class="comment" id="7656295">//&nbsp;that&nbsp;we&nbsp;kill&nbsp;the&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="7656322">func</span>&nbsp;<span class="ident" id="7656327">TestKillChildAfterCopyError</span><span class="op" id="7656354">(</span><span class="ident" id="7656355">t</span>&nbsp;<span class="op" id="7656357">*</span><span class="ident" id="7656358">testing</span><span class="op" id="7656365">.</span><span class="ident" id="7656366">T</span><span class="op" id="7656367">)</span>&nbsp;<span class="op" id="7656369">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656372">if</span>&nbsp;<span class="ident" id="7656375">runtime</span><span class="op" id="7656382">.</span><span class="ident" id="7656383">GOOS</span>&nbsp;<span class="op" id="7656388">==</span>&nbsp;<span class="string" id="7656391">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7656398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656402">t</span><span class="op" id="7656403">.</span><span class="ident" id="7656404">Skip</span><span class="op" id="7656408">(</span><span class="string" id="7656409">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="7656427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656434">defer</span>&nbsp;<span class="keyword" id="7656440">func</span><span class="op" id="7656444">(</span><span class="op" id="7656445">)</span>&nbsp;<span class="op" id="7656447">{</span>&nbsp;<span class="ident" id="7656449">testHookStartProcess</span>&nbsp;<span class="op" id="7656470">=</span>&nbsp;<span class="ident" id="7656472">nil</span>&nbsp;<span class="op" id="7656476">}</span><span class="op" id="7656477">(</span><span class="op" id="7656478">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656481">proc</span>&nbsp;<span class="op" id="7656486">:=</span>&nbsp;<span class="builtinfunc" id="7656489">make</span><span class="op" id="7656493">(</span><span class="keyword" id="7656494">chan</span>&nbsp;<span class="op" id="7656499">*</span><span class="ident" id="7656500">os</span><span class="op" id="7656502">.</span><span class="ident" id="7656503">Process</span><span class="op" id="7656510">,</span>&nbsp;<span class="num" id="7656512">1</span><span class="op" id="7656513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656516">testHookStartProcess</span>&nbsp;<span class="op" id="7656537">=</span>&nbsp;<span class="keyword" id="7656539">func</span><span class="op" id="7656543">(</span><span class="ident" id="7656544">p</span>&nbsp;<span class="op" id="7656546">*</span><span class="ident" id="7656547">os</span><span class="op" id="7656549">.</span><span class="ident" id="7656550">Process</span><span class="op" id="7656557">)</span>&nbsp;<span class="op" id="7656559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656563">proc</span>&nbsp;<span class="op" id="7656568">&lt;-</span>&nbsp;<span class="ident" id="7656571">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656578">h</span>&nbsp;<span class="op" id="7656580">:=</span>&nbsp;<span class="op" id="7656583">&amp;</span><span class="ident" id="7656584">Handler</span><span class="op" id="7656591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656595">Path</span><span class="op" id="7656599">:</span>&nbsp;<span class="ident" id="7656601">os</span><span class="op" id="7656603">.</span><span class="ident" id="7656604">Args</span><span class="op" id="7656608">[</span><span class="num" id="7656609">0</span><span class="op" id="7656610">]</span><span class="op" id="7656611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656615">Root</span><span class="op" id="7656619">:</span>&nbsp;<span class="string" id="7656621">&#34;/test.go&#34;</span><span class="op" id="7656631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656635">Args</span><span class="op" id="7656639">:</span>&nbsp;<span class="op" id="7656641">[</span><span class="op" id="7656642">]</span><span class="builtintype" id="7656643">string</span><span class="op" id="7656649">{</span><span class="string" id="7656650">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7656683">}</span><span class="op" id="7656684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7656687">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656690">req</span><span class="op" id="7656693">,</span>&nbsp;<span class="ident" id="7656695">_</span>&nbsp;<span class="op" id="7656697">:=</span>&nbsp;<span class="ident" id="7656700">http</span><span class="op" id="7656704">.</span><span class="ident" id="7656705">NewRequest</span><span class="op" id="7656715">(</span><span class="string" id="7656716">&#34;GET&#34;</span><span class="op" id="7656721">,</span>&nbsp;<span class="string" id="7656723">&#34;http://example.com/test.cgi?write-forever=1&#34;</span><span class="op" id="7656768">,</span>&nbsp;<span class="ident" id="7656770">nil</span><span class="op" id="7656773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656776">rec</span>&nbsp;<span class="op" id="7656780">:=</span>&nbsp;<span class="ident" id="7656783">httptest</span><span class="op" id="7656791">.</span><span class="ident" id="7656792">NewRecorder</span><span class="op" id="7656803">(</span><span class="op" id="7656804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656807">var</span>&nbsp;<span class="ident" id="7656811">out</span>&nbsp;<span class="ident" id="7656815">bytes</span><span class="op" id="7656820">.</span><span class="ident" id="7656821">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656829">const</span>&nbsp;<span class="ident" id="7656835">writeLen</span>&nbsp;<span class="op" id="7656844">=</span>&nbsp;<span class="num" id="7656846">50</span>&nbsp;<span class="op" id="7656849">&lt;&lt;</span>&nbsp;<span class="num" id="7656852">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656856">rw</span>&nbsp;<span class="op" id="7656859">:=</span>&nbsp;<span class="op" id="7656862">&amp;</span><span class="ident" id="7656863">customWriterRecorder</span><span class="op" id="7656883">{</span><span class="op" id="7656884">&amp;</span><span class="ident" id="7656885">limitWriter</span><span class="op" id="7656896">{</span><span class="op" id="7656897">&amp;</span><span class="ident" id="7656898">out</span><span class="op" id="7656901">,</span>&nbsp;<span class="ident" id="7656903">writeLen</span><span class="op" id="7656911">}</span><span class="op" id="7656912">,</span>&nbsp;<span class="ident" id="7656914">rec</span><span class="op" id="7656917">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656921">donec</span>&nbsp;<span class="op" id="7656927">:=</span>&nbsp;<span class="builtinfunc" id="7656930">make</span><span class="op" id="7656934">(</span><span class="keyword" id="7656935">chan</span>&nbsp;<span class="builtintype" id="7656940">bool</span><span class="op" id="7656944">,</span>&nbsp;<span class="num" id="7656946">1</span><span class="op" id="7656947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7656950">go</span>&nbsp;<span class="keyword" id="7656953">func</span><span class="op" id="7656957">(</span><span class="op" id="7656958">)</span>&nbsp;<span class="op" id="7656960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656964">h</span><span class="op" id="7656965">.</span><span class="ident" id="7656966">ServeHTTP</span><span class="op" id="7656975">(</span><span class="ident" id="7656976">rw</span><span class="op" id="7656978">,</span>&nbsp;<span class="ident" id="7656980">req</span><span class="op" id="7656983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7656987">donec</span>&nbsp;<span class="op" id="7656993">&lt;-</span>&nbsp;<span class="builtintype" id="7656996">true</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657002">}</span><span class="op" id="7657003">(</span><span class="op" id="7657004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657008">select</span>&nbsp;<span class="op" id="7657015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657018">case</span>&nbsp;<span class="op" id="7657023">&lt;-</span><span class="ident" id="7657025">donec</span><span class="op" id="7657030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657034">if</span>&nbsp;<span class="ident" id="7657037">out</span><span class="op" id="7657040">.</span><span class="ident" id="7657041">Len</span><span class="op" id="7657044">(</span><span class="op" id="7657045">)</span>&nbsp;<span class="op" id="7657047">!=</span>&nbsp;<span class="ident" id="7657050">writeLen</span>&nbsp;<span class="op" id="7657059">||</span>&nbsp;<span class="ident" id="7657062">out</span><span class="op" id="7657065">.</span><span class="ident" id="7657066">Bytes</span><span class="op" id="7657071">(</span><span class="op" id="7657072">)</span><span class="op" id="7657073">[</span><span class="num" id="7657074">0</span><span class="op" id="7657075">]</span>&nbsp;<span class="op" id="7657077">!=</span>&nbsp;<span class="string" id="7657080">&#39;a&#39;</span>&nbsp;<span class="op" id="7657084">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657089">t</span><span class="op" id="7657090">.</span><span class="ident" id="7657091">Errorf</span><span class="op" id="7657097">(</span><span class="string" id="7657098">&#34;unexpected&nbsp;output:&nbsp;%q&#34;</span><span class="op" id="7657121">,</span>&nbsp;<span class="ident" id="7657123">out</span><span class="op" id="7657126">.</span><span class="ident" id="7657127">Bytes</span><span class="op" id="7657132">(</span><span class="op" id="7657133">)</span><span class="op" id="7657134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657141">case</span>&nbsp;<span class="op" id="7657146">&lt;-</span><span class="ident" id="7657148">time</span><span class="op" id="7657152">.</span><span class="ident" id="7657153">After</span><span class="op" id="7657158">(</span><span class="num" id="7657159">5</span>&nbsp;<span class="op" id="7657161">*</span>&nbsp;<span class="ident" id="7657163">time</span><span class="op" id="7657167">.</span><span class="ident" id="7657168">Second</span><span class="op" id="7657174">)</span><span class="op" id="7657175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657179">t</span><span class="op" id="7657180">.</span><span class="ident" id="7657181">Errorf</span><span class="op" id="7657187">(</span><span class="string" id="7657188">&#34;timeout.&nbsp;ServeHTTP&nbsp;hung&nbsp;and&nbsp;didn&#39;t&nbsp;kill&nbsp;the&nbsp;child&nbsp;process?&#34;</span><span class="op" id="7657248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657252">select</span>&nbsp;<span class="op" id="7657259">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657263">case</span>&nbsp;<span class="ident" id="7657268">p</span>&nbsp;<span class="op" id="7657270">:=</span>&nbsp;<span class="op" id="7657273">&lt;-</span><span class="ident" id="7657275">proc</span><span class="op" id="7657279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657284">p</span><span class="op" id="7657285">.</span><span class="ident" id="7657286">Kill</span><span class="op" id="7657290">(</span><span class="op" id="7657291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657296">t</span><span class="op" id="7657297">.</span><span class="ident" id="7657298">Logf</span><span class="op" id="7657302">(</span><span class="string" id="7657303">&#34;killed&nbsp;process&#34;</span><span class="op" id="7657319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657323">default</span><span class="op" id="7657330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657335">t</span><span class="op" id="7657336">.</span><span class="ident" id="7657337">Logf</span><span class="op" id="7657341">(</span><span class="string" id="7657342">&#34;didn&#39;t&nbsp;kill&nbsp;process&#34;</span><span class="op" id="7657363">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657370">}</span><br>
<span class="lineno"></span><span class="op" id="7657372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7657375">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;child&nbsp;handler&nbsp;writing&nbsp;only&nbsp;headers&nbsp;works.</span><br>
<span class="lineno">140</span><span class="comment" id="7657432">//&nbsp;golang.org/issue/7196</span><br>
<span class="lineno"></span><span class="keyword" id="7657457">func</span>&nbsp;<span class="ident" id="7657462">TestChildOnlyHeaders</span><span class="op" id="7657482">(</span><span class="ident" id="7657483">t</span>&nbsp;<span class="op" id="7657485">*</span><span class="ident" id="7657486">testing</span><span class="op" id="7657493">.</span><span class="ident" id="7657494">T</span><span class="op" id="7657495">)</span>&nbsp;<span class="op" id="7657497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657500">if</span>&nbsp;<span class="ident" id="7657503">runtime</span><span class="op" id="7657510">.</span><span class="ident" id="7657511">GOOS</span>&nbsp;<span class="op" id="7657516">==</span>&nbsp;<span class="string" id="7657519">&#34;nacl&#34;</span>&nbsp;<span class="op" id="7657526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657530">t</span><span class="op" id="7657531">.</span><span class="ident" id="7657532">Skip</span><span class="op" id="7657536">(</span><span class="string" id="7657537">&#34;skipping&nbsp;on&nbsp;nacl&#34;</span><span class="op" id="7657555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657558">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657562">h</span>&nbsp;<span class="op" id="7657564">:=</span>&nbsp;<span class="op" id="7657567">&amp;</span><span class="ident" id="7657568">Handler</span><span class="op" id="7657575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657579">Path</span><span class="op" id="7657583">:</span>&nbsp;<span class="ident" id="7657585">os</span><span class="op" id="7657587">.</span><span class="ident" id="7657588">Args</span><span class="op" id="7657592">[</span><span class="num" id="7657593">0</span><span class="op" id="7657594">]</span><span class="op" id="7657595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657599">Root</span><span class="op" id="7657603">:</span>&nbsp;<span class="string" id="7657605">&#34;/test.go&#34;</span><span class="op" id="7657615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657619">Args</span><span class="op" id="7657623">:</span>&nbsp;<span class="op" id="7657625">[</span><span class="op" id="7657626">]</span><span class="builtintype" id="7657627">string</span><span class="op" id="7657633">{</span><span class="string" id="7657634">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7657667">}</span><span class="op" id="7657668">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657674">expectedMap</span>&nbsp;<span class="op" id="7657686">:=</span>&nbsp;<span class="keyword" id="7657689">map</span><span class="op" id="7657692">[</span><span class="builtintype" id="7657693">string</span><span class="op" id="7657699">]</span><span class="builtintype" id="7657700">string</span><span class="op" id="7657706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7657710">&#34;_body&#34;</span><span class="op" id="7657717">:</span>&nbsp;<span class="string" id="7657719">&#34;&#34;</span><span class="op" id="7657721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657727">replay</span>&nbsp;<span class="op" id="7657734">:=</span>&nbsp;<span class="ident" id="7657737">runCgiTest</span><span class="op" id="7657747">(</span><span class="ident" id="7657748">t</span><span class="op" id="7657749">,</span>&nbsp;<span class="ident" id="7657751">h</span><span class="op" id="7657752">,</span>&nbsp;<span class="string" id="7657754">&#34;GET&nbsp;/test.go?no-body=1&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7657810">,</span>&nbsp;<span class="ident" id="7657812">expectedMap</span><span class="op" id="7657823">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7657826">if</span>&nbsp;<span class="ident" id="7657829">expected</span><span class="op" id="7657837">,</span>&nbsp;<span class="ident" id="7657839">got</span>&nbsp;<span class="op" id="7657843">:=</span>&nbsp;<span class="string" id="7657846">&#34;X-Test-Value&#34;</span><span class="op" id="7657860">,</span>&nbsp;<span class="ident" id="7657862">replay</span><span class="op" id="7657868">.</span><span class="ident" id="7657869">Header</span><span class="op" id="7657875">(</span><span class="op" id="7657876">)</span><span class="op" id="7657877">.</span><span class="ident" id="7657878">Get</span><span class="op" id="7657881">(</span><span class="string" id="7657882">&#34;X-Test-Header&#34;</span><span class="op" id="7657897">)</span><span class="op" id="7657898">;</span>&nbsp;<span class="ident" id="7657900">got</span>&nbsp;<span class="op" id="7657904">!=</span>&nbsp;<span class="ident" id="7657907">expected</span>&nbsp;<span class="op" id="7657916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7657920">t</span><span class="op" id="7657921">.</span><span class="ident" id="7657922">Errorf</span><span class="op" id="7657928">(</span><span class="string" id="7657929">&#34;got&nbsp;a&nbsp;X-Test-Header&nbsp;of&nbsp;%q;&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7657969">,</span>&nbsp;<span class="ident" id="7657971">got</span><span class="op" id="7657974">,</span>&nbsp;<span class="ident" id="7657976">expected</span><span class="op" id="7657984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7657987">}</span><br>
<span class="lineno"></span><span class="op" id="7657989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="7657992">//&nbsp;golang.org/issue/7198</span><br>
<span class="lineno"></span><span class="keyword" id="7658017">func</span>&nbsp;<span class="ident" id="7658022">Test500WithNoHeaders</span><span class="op" id="7658042">(</span><span class="ident" id="7658043">t</span>&nbsp;<span class="op" id="7658045">*</span><span class="ident" id="7658046">testing</span><span class="op" id="7658053">.</span><span class="ident" id="7658054">T</span><span class="op" id="7658055">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7658061">{</span>&nbsp;<span class="ident" id="7658063">want500Test</span><span class="op" id="7658074">(</span><span class="ident" id="7658075">t</span><span class="op" id="7658076">,</span>&nbsp;<span class="string" id="7658078">&#34;/immediate-disconnect&#34;</span><span class="op" id="7658101">)</span>&nbsp;<span class="op" id="7658103">}</span><br>
<span class="lineno"></span><span class="keyword" id="7658105">func</span>&nbsp;<span class="ident" id="7658110">Test500WithNoContentType</span><span class="op" id="7658134">(</span><span class="ident" id="7658135">t</span>&nbsp;<span class="op" id="7658137">*</span><span class="ident" id="7658138">testing</span><span class="op" id="7658145">.</span><span class="ident" id="7658146">T</span><span class="op" id="7658147">)</span>&nbsp;<span class="op" id="7658149">{</span>&nbsp;<span class="ident" id="7658151">want500Test</span><span class="op" id="7658162">(</span><span class="ident" id="7658163">t</span><span class="op" id="7658164">,</span>&nbsp;<span class="string" id="7658166">&#34;/no-content-type&#34;</span><span class="op" id="7658184">)</span>&nbsp;<span class="op" id="7658186">}</span><br>
<span class="lineno"></span><span class="keyword" id="7658188">func</span>&nbsp;<span class="ident" id="7658193">Test500WithEmptyHeaders</span><span class="op" id="7658216">(</span><span class="ident" id="7658217">t</span>&nbsp;<span class="op" id="7658219">*</span><span class="ident" id="7658220">testing</span><span class="op" id="7658227">.</span><span class="ident" id="7658228">T</span><span class="op" id="7658229">)</span>&nbsp;&nbsp;<span class="op" id="7658232">{</span>&nbsp;<span class="ident" id="7658234">want500Test</span><span class="op" id="7658245">(</span><span class="ident" id="7658246">t</span><span class="op" id="7658247">,</span>&nbsp;<span class="string" id="7658249">&#34;/empty-headers&#34;</span><span class="op" id="7658265">)</span>&nbsp;<span class="op" id="7658267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7658270">func</span>&nbsp;<span class="ident" id="7658275">want500Test</span><span class="op" id="7658286">(</span><span class="ident" id="7658287">t</span>&nbsp;<span class="op" id="7658289">*</span><span class="ident" id="7658290">testing</span><span class="op" id="7658297">.</span><span class="ident" id="7658298">T</span><span class="op" id="7658299">,</span>&nbsp;<span class="ident" id="7658301">path</span>&nbsp;<span class="builtintype" id="7658306">string</span><span class="op" id="7658312">)</span>&nbsp;<span class="op" id="7658314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658317">h</span>&nbsp;<span class="op" id="7658319">:=</span>&nbsp;<span class="op" id="7658322">&amp;</span><span class="ident" id="7658323">Handler</span><span class="op" id="7658330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658334">Path</span><span class="op" id="7658338">:</span>&nbsp;<span class="ident" id="7658340">os</span><span class="op" id="7658342">.</span><span class="ident" id="7658343">Args</span><span class="op" id="7658347">[</span><span class="num" id="7658348">0</span><span class="op" id="7658349">]</span><span class="op" id="7658350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658354">Root</span><span class="op" id="7658358">:</span>&nbsp;<span class="string" id="7658360">&#34;/test.go&#34;</span><span class="op" id="7658370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658374">Args</span><span class="op" id="7658378">:</span>&nbsp;<span class="op" id="7658380">[</span><span class="op" id="7658381">]</span><span class="builtintype" id="7658382">string</span><span class="op" id="7658388">{</span><span class="string" id="7658389">&#34;-test.run=TestBeChildCGIProcess&#34;</span><span class="op" id="7658422">}</span><span class="op" id="7658423">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658429">expectedMap</span>&nbsp;<span class="op" id="7658441">:=</span>&nbsp;<span class="keyword" id="7658444">map</span><span class="op" id="7658447">[</span><span class="builtintype" id="7658448">string</span><span class="op" id="7658454">]</span><span class="builtintype" id="7658455">string</span><span class="op" id="7658461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7658465">&#34;_body&#34;</span><span class="op" id="7658472">:</span>&nbsp;<span class="string" id="7658474">&#34;&#34;</span><span class="op" id="7658476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658482">replay</span>&nbsp;<span class="op" id="7658489">:=</span>&nbsp;<span class="ident" id="7658492">runCgiTest</span><span class="op" id="7658502">(</span><span class="ident" id="7658503">t</span><span class="op" id="7658504">,</span>&nbsp;<span class="ident" id="7658506">h</span><span class="op" id="7658507">,</span>&nbsp;<span class="string" id="7658509">&#34;GET&nbsp;&#34;</span><span class="op" id="7658515">+</span><span class="ident" id="7658516">path</span><span class="op" id="7658520">+</span><span class="string" id="7658521">&#34;&nbsp;HTTP/1.0\nHost:&nbsp;example.com\n\n&#34;</span><span class="op" id="7658555">,</span>&nbsp;<span class="ident" id="7658557">expectedMap</span><span class="op" id="7658568">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658571">if</span>&nbsp;<span class="ident" id="7658574">replay</span><span class="op" id="7658580">.</span><span class="ident" id="7658581">Code</span>&nbsp;<span class="op" id="7658586">!=</span>&nbsp;<span class="num" id="7658589">500</span>&nbsp;<span class="op" id="7658593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658597">t</span><span class="op" id="7658598">.</span><span class="ident" id="7658599">Errorf</span><span class="op" id="7658605">(</span><span class="string" id="7658606">&#34;Got&nbsp;code&nbsp;%d;&nbsp;want&nbsp;500&#34;</span><span class="op" id="7658629">,</span>&nbsp;<span class="ident" id="7658631">replay</span><span class="op" id="7658637">.</span><span class="ident" id="7658638">Code</span><span class="op" id="7658642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658645">}</span><br>
<span class="lineno"></span><span class="op" id="7658647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="7658650">type</span>&nbsp;<span class="ident" id="7658655">neverEnding</span>&nbsp;<span class="builtintype" id="7658667">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7658673">func</span>&nbsp;<span class="op" id="7658678">(</span><span class="ident" id="7658679">b</span>&nbsp;<span class="ident" id="7658681">neverEnding</span><span class="op" id="7658692">)</span>&nbsp;<span class="ident" id="7658694">Read</span><span class="op" id="7658698">(</span><span class="ident" id="7658699">p</span>&nbsp;<span class="op" id="7658701">[</span><span class="op" id="7658702">]</span><span class="builtintype" id="7658703">byte</span><span class="op" id="7658707">)</span>&nbsp;<span class="op" id="7658709">(</span><span class="ident" id="7658710">n</span>&nbsp;<span class="builtintype" id="7658712">int</span><span class="op" id="7658715">,</span>&nbsp;<span class="ident" id="7658717">err</span>&nbsp;<span class="builtintype" id="7658721">error</span><span class="op" id="7658726">)</span>&nbsp;<span class="op" id="7658728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658731">for</span>&nbsp;<span class="ident" id="7658735">i</span>&nbsp;<span class="op" id="7658737">:=</span>&nbsp;<span class="keyword" id="7658740">range</span>&nbsp;<span class="ident" id="7658746">p</span>&nbsp;<span class="op" id="7658748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7658752">p</span><span class="op" id="7658753">[</span><span class="ident" id="7658754">i</span><span class="op" id="7658755">]</span>&nbsp;<span class="op" id="7658757">=</span>&nbsp;<span class="builtintype" id="7658759">byte</span><span class="op" id="7658763">(</span><span class="ident" id="7658764">b</span><span class="op" id="7658765">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658771">return</span>&nbsp;<span class="builtinfunc" id="7658778">len</span><span class="op" id="7658781">(</span><span class="ident" id="7658782">p</span><span class="op" id="7658783">)</span><span class="op" id="7658784">,</span>&nbsp;<span class="ident" id="7658786">nil</span><br>
<span class="lineno"></span><span class="op" id="7658790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7658793">//&nbsp;Note:&nbsp;not&nbsp;actually&nbsp;a&nbsp;test.</span><br>
<span class="lineno">190</span><span class="keyword" id="7658823">func</span>&nbsp;<span class="ident" id="7658828">TestBeChildCGIProcess</span><span class="op" id="7658849">(</span><span class="ident" id="7658850">t</span>&nbsp;<span class="op" id="7658852">*</span><span class="ident" id="7658853">testing</span><span class="op" id="7658860">.</span><span class="ident" id="7658861">T</span><span class="op" id="7658862">)</span>&nbsp;<span class="op" id="7658864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658867">if</span>&nbsp;<span class="ident" id="7658870">os</span><span class="op" id="7658872">.</span><span class="ident" id="7658873">Getenv</span><span class="op" id="7658879">(</span><span class="string" id="7658880">&#34;REQUEST_METHOD&#34;</span><span class="op" id="7658896">)</span>&nbsp;<span class="op" id="7658898">==</span>&nbsp;<span class="string" id="7658901">&#34;&#34;</span>&nbsp;<span class="op" id="7658904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7658908">//&nbsp;Not&nbsp;in&nbsp;a&nbsp;CGI&nbsp;environment;&nbsp;skipping&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658954">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7658962">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7658965">switch</span>&nbsp;<span class="ident" id="7658972">os</span><span class="op" id="7658974">.</span><span class="ident" id="7658975">Getenv</span><span class="op" id="7658981">(</span><span class="string" id="7658982">&#34;REQUEST_URI&#34;</span><span class="op" id="7658995">)</span>&nbsp;<span class="op" id="7658997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659000">case</span>&nbsp;<span class="string" id="7659005">&#34;/immediate-disconnect&#34;</span><span class="op" id="7659028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659032">os</span><span class="op" id="7659034">.</span><span class="ident" id="7659035">Exit</span><span class="op" id="7659039">(</span><span class="num" id="7659040">0</span><span class="op" id="7659041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659044">case</span>&nbsp;<span class="string" id="7659049">&#34;/no-content-type&#34;</span><span class="op" id="7659067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659071">fmt</span><span class="op" id="7659074">.</span><span class="ident" id="7659075">Printf</span><span class="op" id="7659081">(</span><span class="string" id="7659082">&#34;Content-Length:&nbsp;6\n\nHello\n&#34;</span><span class="op" id="7659112">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659116">os</span><span class="op" id="7659118">.</span><span class="ident" id="7659119">Exit</span><span class="op" id="7659123">(</span><span class="num" id="7659124">0</span><span class="op" id="7659125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659128">case</span>&nbsp;<span class="string" id="7659133">&#34;/empty-headers&#34;</span><span class="op" id="7659149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659153">fmt</span><span class="op" id="7659156">.</span><span class="ident" id="7659157">Printf</span><span class="op" id="7659163">(</span><span class="string" id="7659164">&#34;\nHello&#34;</span><span class="op" id="7659173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659177">os</span><span class="op" id="7659179">.</span><span class="ident" id="7659180">Exit</span><span class="op" id="7659184">(</span><span class="num" id="7659185">0</span><span class="op" id="7659186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659189">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659192">Serve</span><span class="op" id="7659197">(</span><span class="ident" id="7659198">http</span><span class="op" id="7659202">.</span><span class="ident" id="7659203">HandlerFunc</span><span class="op" id="7659214">(</span><span class="keyword" id="7659215">func</span><span class="op" id="7659219">(</span><span class="ident" id="7659220">rw</span>&nbsp;<span class="ident" id="7659223">http</span><span class="op" id="7659227">.</span><span class="ident" id="7659228">ResponseWriter</span><span class="op" id="7659242">,</span>&nbsp;<span class="ident" id="7659244">req</span>&nbsp;<span class="op" id="7659248">*</span><span class="ident" id="7659249">http</span><span class="op" id="7659253">.</span><span class="ident" id="7659254">Request</span><span class="op" id="7659261">)</span>&nbsp;<span class="op" id="7659263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659267">rw</span><span class="op" id="7659269">.</span><span class="ident" id="7659270">Header</span><span class="op" id="7659276">(</span><span class="op" id="7659277">)</span><span class="op" id="7659278">.</span><span class="ident" id="7659279">Set</span><span class="op" id="7659282">(</span><span class="string" id="7659283">&#34;X-Test-Header&#34;</span><span class="op" id="7659298">,</span>&nbsp;<span class="string" id="7659300">&#34;X-Test-Value&#34;</span><span class="op" id="7659314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659318">req</span><span class="op" id="7659321">.</span><span class="ident" id="7659322">ParseForm</span><span class="op" id="7659331">(</span><span class="op" id="7659332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659336">if</span>&nbsp;<span class="ident" id="7659339">req</span><span class="op" id="7659342">.</span><span class="ident" id="7659343">FormValue</span><span class="op" id="7659352">(</span><span class="string" id="7659353">&#34;no-body&#34;</span><span class="op" id="7659362">)</span>&nbsp;<span class="op" id="7659364">==</span>&nbsp;<span class="string" id="7659367">&#34;1&#34;</span>&nbsp;<span class="op" id="7659371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659376">return</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659389">if</span>&nbsp;<span class="ident" id="7659392">req</span><span class="op" id="7659395">.</span><span class="ident" id="7659396">FormValue</span><span class="op" id="7659405">(</span><span class="string" id="7659406">&#34;write-forever&#34;</span><span class="op" id="7659421">)</span>&nbsp;<span class="op" id="7659423">==</span>&nbsp;<span class="string" id="7659426">&#34;1&#34;</span>&nbsp;<span class="op" id="7659430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659435">io</span><span class="op" id="7659437">.</span><span class="ident" id="7659438">Copy</span><span class="op" id="7659442">(</span><span class="ident" id="7659443">rw</span><span class="op" id="7659445">,</span>&nbsp;<span class="ident" id="7659447">neverEnding</span><span class="op" id="7659458">(</span><span class="string" id="7659459">&#39;a&#39;</span><span class="op" id="7659462">)</span><span class="op" id="7659463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659468">for</span>&nbsp;<span class="op" id="7659472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659478">time</span><span class="op" id="7659482">.</span><span class="ident" id="7659483">Sleep</span><span class="op" id="7659488">(</span><span class="num" id="7659489">5</span>&nbsp;<span class="op" id="7659491">*</span>&nbsp;<span class="ident" id="7659493">time</span><span class="op" id="7659497">.</span><span class="ident" id="7659498">Second</span><span class="op" id="7659504">)</span>&nbsp;<span class="comment" id="7659506">//&nbsp;hang&nbsp;forever,&nbsp;until&nbsp;killed</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659547">fmt</span><span class="op" id="7659550">.</span><span class="ident" id="7659551">Fprintf</span><span class="op" id="7659558">(</span><span class="ident" id="7659559">rw</span><span class="op" id="7659561">,</span>&nbsp;<span class="string" id="7659563">&#34;test=Hello&nbsp;CGI-in-CGI\n&#34;</span><span class="op" id="7659588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659592">for</span>&nbsp;<span class="ident" id="7659596">k</span><span class="op" id="7659597">,</span>&nbsp;<span class="ident" id="7659599">vv</span>&nbsp;<span class="op" id="7659602">:=</span>&nbsp;<span class="keyword" id="7659605">range</span>&nbsp;<span class="ident" id="7659611">req</span><span class="op" id="7659614">.</span><span class="ident" id="7659615">Form</span>&nbsp;<span class="op" id="7659620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659625">for</span>&nbsp;<span class="ident" id="7659629">_</span><span class="op" id="7659630">,</span>&nbsp;<span class="ident" id="7659632">v</span>&nbsp;<span class="op" id="7659634">:=</span>&nbsp;<span class="keyword" id="7659637">range</span>&nbsp;<span class="ident" id="7659643">vv</span>&nbsp;<span class="op" id="7659646">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659652">fmt</span><span class="op" id="7659655">.</span><span class="ident" id="7659656">Fprintf</span><span class="op" id="7659663">(</span><span class="ident" id="7659664">rw</span><span class="op" id="7659666">,</span>&nbsp;<span class="string" id="7659668">&#34;param-%s=%s\n&#34;</span><span class="op" id="7659683">,</span>&nbsp;<span class="ident" id="7659685">k</span><span class="op" id="7659686">,</span>&nbsp;<span class="ident" id="7659688">v</span><span class="op" id="7659689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7659702">for</span>&nbsp;<span class="ident" id="7659706">_</span><span class="op" id="7659707">,</span>&nbsp;<span class="ident" id="7659709">kv</span>&nbsp;<span class="op" id="7659712">:=</span>&nbsp;<span class="keyword" id="7659715">range</span>&nbsp;<span class="ident" id="7659721">os</span><span class="op" id="7659723">.</span><span class="ident" id="7659724">Environ</span><span class="op" id="7659731">(</span><span class="op" id="7659732">)</span>&nbsp;<span class="op" id="7659734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659739">fmt</span><span class="op" id="7659742">.</span><span class="ident" id="7659743">Fprintf</span><span class="op" id="7659750">(</span><span class="ident" id="7659751">rw</span><span class="op" id="7659753">,</span>&nbsp;<span class="string" id="7659755">&#34;env-%s\n&#34;</span><span class="op" id="7659765">,</span>&nbsp;<span class="ident" id="7659767">kv</span><span class="op" id="7659769">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7659776">}</span><span class="op" id="7659777">)</span><span class="op" id="7659778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7659781">os</span><span class="op" id="7659783">.</span><span class="ident" id="7659784">Exit</span><span class="op" id="7659788">(</span><span class="num" id="7659789">0</span><span class="op" id="7659790">)</span><br>
<span class="lineno"></span><span class="op" id="7659792">}</span>
</div>
</body>
</html>
