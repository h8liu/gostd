<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3669370">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3669426">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3669480">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3669531">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3669568">package</span>&nbsp;<span class="ident" id="3669576">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3669581">import</span>&nbsp;<span class="op" id="3669588">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669591">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3669601">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3669608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3669611">var</span>&nbsp;<span class="op" id="3669615">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669618">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669678">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669708">supportsIPv4</span>&nbsp;<span class="builtintype" id="3669721">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669728">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669788">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3669818">supportsIPv6</span>&nbsp;<span class="builtintype" id="3669831">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669838">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669896">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3669960">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670019">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3670035">bool</span><br>
<span class="lineno"></span><span class="op" id="3670040">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3670043">func</span>&nbsp;<span class="ident" id="3670048">init</span><span class="op" id="3670052">(</span><span class="op" id="3670053">)</span>&nbsp;<span class="op" id="3670055">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670058">sysInit</span><span class="op" id="3670065">(</span><span class="op" id="3670066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670069">supportsIPv4</span>&nbsp;<span class="op" id="3670082">=</span>&nbsp;<span class="ident" id="3670084">probeIPv4Stack</span><span class="op" id="3670098">(</span><span class="op" id="3670099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670102">supportsIPv6</span><span class="op" id="3670114">,</span>&nbsp;<span class="ident" id="3670116">supportsIPv4map</span>&nbsp;<span class="op" id="3670132">=</span>&nbsp;<span class="ident" id="3670134">probeIPv6Stack</span><span class="op" id="3670148">(</span><span class="op" id="3670149">)</span><br>
<span class="lineno"></span><span class="op" id="3670151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3670154">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3670218">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3670249">type</span>&nbsp;<span class="ident" id="3670254">netaddr</span>&nbsp;<span class="keyword" id="3670262">interface</span>&nbsp;<span class="op" id="3670272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670275">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670337">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3670393">toAddr</span><span class="op" id="3670399">(</span><span class="op" id="3670400">)</span>&nbsp;<span class="ident" id="3670402">Addr</span><br>
<span class="lineno"></span><span class="op" id="3670407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3670410">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3670474">type</span>&nbsp;<span class="ident" id="3670479">addrList</span>&nbsp;<span class="op" id="3670488">[</span><span class="op" id="3670489">]</span><span class="ident" id="3670490">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3670499">func</span>&nbsp;<span class="op" id="3670504">(</span><span class="ident" id="3670505">al</span>&nbsp;<span class="ident" id="3670508">addrList</span><span class="op" id="3670516">)</span>&nbsp;<span class="ident" id="3670518">toAddr</span><span class="op" id="3670524">(</span><span class="op" id="3670525">)</span>&nbsp;<span class="ident" id="3670527">Addr</span>&nbsp;<span class="op" id="3670532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670535">switch</span>&nbsp;<span class="builtinfunc" id="3670542">len</span><span class="op" id="3670545">(</span><span class="ident" id="3670546">al</span><span class="op" id="3670548">)</span>&nbsp;<span class="op" id="3670550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670553">case</span>&nbsp;<span class="num" id="3670558">0</span><span class="op" id="3670559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670563">return</span>&nbsp;<span class="ident" id="3670570">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670575">case</span>&nbsp;<span class="num" id="3670580">1</span><span class="op" id="3670581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670585">return</span>&nbsp;<span class="ident" id="3670592">al</span><span class="op" id="3670594">[</span><span class="num" id="3670595">0</span><span class="op" id="3670596">]</span><span class="op" id="3670597">.</span><span class="ident" id="3670598">toAddr</span><span class="op" id="3670604">(</span><span class="op" id="3670605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670608">default</span><span class="op" id="3670615">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670619">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670670">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670724">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3670778">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3670796">return</span>&nbsp;<span class="ident" id="3670803">al</span><span class="op" id="3670805">[</span><span class="num" id="3670806">0</span><span class="op" id="3670807">]</span><span class="op" id="3670808">.</span><span class="ident" id="3670809">toAddr</span><span class="op" id="3670815">(</span><span class="op" id="3670816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3670819">}</span><br>
<span class="lineno"></span><span class="op" id="3670821">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3670824">var</span>&nbsp;<span class="ident" id="3670828">errNoSuitableAddress</span>&nbsp;<span class="op" id="3670849">=</span>&nbsp;<span class="ident" id="3670851">errors</span><span class="op" id="3670857">.</span><span class="ident" id="3670858">New</span><span class="op" id="3670861">(</span><span class="string" id="3670862">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3670889">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3670892">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3670960">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3671028">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3671099">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3671151">func</span>&nbsp;<span class="ident" id="3671156">firstFavoriteAddr</span><span class="op" id="3671173">(</span><span class="ident" id="3671174">filter</span>&nbsp;<span class="keyword" id="3671181">func</span><span class="op" id="3671185">(</span><span class="ident" id="3671186">IP</span><span class="op" id="3671188">)</span>&nbsp;<span class="ident" id="3671190">IP</span><span class="op" id="3671192">,</span>&nbsp;<span class="ident" id="3671194">ips</span>&nbsp;<span class="op" id="3671198">[</span><span class="op" id="3671199">]</span><span class="ident" id="3671200">IP</span><span class="op" id="3671202">,</span>&nbsp;<span class="ident" id="3671204">inetaddr</span>&nbsp;<span class="keyword" id="3671213">func</span><span class="op" id="3671217">(</span><span class="ident" id="3671218">IP</span><span class="op" id="3671220">)</span>&nbsp;<span class="ident" id="3671222">netaddr</span><span class="op" id="3671229">)</span>&nbsp;<span class="op" id="3671231">(</span><span class="ident" id="3671232">netaddr</span><span class="op" id="3671239">,</span>&nbsp;<span class="builtintype" id="3671241">error</span><span class="op" id="3671246">)</span>&nbsp;<span class="op" id="3671248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671251">if</span>&nbsp;<span class="ident" id="3671254">filter</span>&nbsp;<span class="op" id="3671261">!=</span>&nbsp;<span class="ident" id="3671264">nil</span>&nbsp;<span class="op" id="3671268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671272">return</span>&nbsp;<span class="ident" id="3671279">firstSupportedAddr</span><span class="op" id="3671297">(</span><span class="ident" id="3671298">filter</span><span class="op" id="3671304">,</span>&nbsp;<span class="ident" id="3671306">ips</span><span class="op" id="3671309">,</span>&nbsp;<span class="ident" id="3671311">inetaddr</span><span class="op" id="3671319">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671325">var</span>&nbsp;<span class="op" id="3671329">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671333">ipv4</span><span class="op" id="3671337">,</span>&nbsp;<span class="ident" id="3671339">ipv6</span><span class="op" id="3671343">,</span>&nbsp;<span class="ident" id="3671345">swap</span>&nbsp;<span class="builtintype" id="3671350">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671357">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3671374">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671384">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671387">for</span>&nbsp;<span class="ident" id="3671391">_</span><span class="op" id="3671392">,</span>&nbsp;<span class="ident" id="3671394">ip</span>&nbsp;<span class="op" id="3671397">:=</span>&nbsp;<span class="keyword" id="3671400">range</span>&nbsp;<span class="ident" id="3671406">ips</span>&nbsp;<span class="op" id="3671410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671414">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671468">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671514">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671565">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671621">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3671676">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671728">if</span>&nbsp;<span class="ident" id="3671731">ip4</span>&nbsp;<span class="op" id="3671735">:=</span>&nbsp;<span class="ident" id="3671738">ipv4only</span><span class="op" id="3671746">(</span><span class="ident" id="3671747">ip</span><span class="op" id="3671749">)</span><span class="op" id="3671750">;</span>&nbsp;<span class="ident" id="3671752">ip4</span>&nbsp;<span class="op" id="3671756">!=</span>&nbsp;<span class="ident" id="3671759">nil</span>&nbsp;<span class="op" id="3671763">&amp;&amp;</span>&nbsp;<span class="op" id="3671766">!</span><span class="ident" id="3671767">ipv4</span>&nbsp;<span class="op" id="3671772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671777">list</span>&nbsp;<span class="op" id="3671782">=</span>&nbsp;<span class="builtinfunc" id="3671784">append</span><span class="op" id="3671790">(</span><span class="ident" id="3671791">list</span><span class="op" id="3671795">,</span>&nbsp;<span class="ident" id="3671797">inetaddr</span><span class="op" id="3671805">(</span><span class="ident" id="3671806">ip4</span><span class="op" id="3671809">)</span><span class="op" id="3671810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671815">ipv4</span>&nbsp;<span class="op" id="3671820">=</span>&nbsp;<span class="builtintype" id="3671822">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671830">if</span>&nbsp;<span class="ident" id="3671833">ipv6</span>&nbsp;<span class="op" id="3671838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671844">swap</span>&nbsp;<span class="op" id="3671849">=</span>&nbsp;<span class="builtintype" id="3671851">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671863">}</span>&nbsp;<span class="keyword" id="3671865">else</span>&nbsp;<span class="keyword" id="3671870">if</span>&nbsp;<span class="ident" id="3671873">ip6</span>&nbsp;<span class="op" id="3671877">:=</span>&nbsp;<span class="ident" id="3671880">ipv6only</span><span class="op" id="3671888">(</span><span class="ident" id="3671889">ip</span><span class="op" id="3671891">)</span><span class="op" id="3671892">;</span>&nbsp;<span class="ident" id="3671894">ip6</span>&nbsp;<span class="op" id="3671898">!=</span>&nbsp;<span class="ident" id="3671901">nil</span>&nbsp;<span class="op" id="3671905">&amp;&amp;</span>&nbsp;<span class="op" id="3671908">!</span><span class="ident" id="3671909">ipv6</span>&nbsp;<span class="op" id="3671914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671919">list</span>&nbsp;<span class="op" id="3671924">=</span>&nbsp;<span class="builtinfunc" id="3671926">append</span><span class="op" id="3671932">(</span><span class="ident" id="3671933">list</span><span class="op" id="3671937">,</span>&nbsp;<span class="ident" id="3671939">inetaddr</span><span class="op" id="3671947">(</span><span class="ident" id="3671948">ip6</span><span class="op" id="3671951">)</span><span class="op" id="3671952">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3671957">ipv6</span>&nbsp;<span class="op" id="3671962">=</span>&nbsp;<span class="builtintype" id="3671964">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3671971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671975">if</span>&nbsp;<span class="ident" id="3671978">ipv4</span>&nbsp;<span class="op" id="3671983">&amp;&amp;</span>&nbsp;<span class="ident" id="3671986">ipv6</span>&nbsp;<span class="op" id="3671991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3671996">if</span>&nbsp;<span class="ident" id="3671999">swap</span>&nbsp;<span class="op" id="3672004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3672010">list</span><span class="op" id="3672014">[</span><span class="num" id="3672015">0</span><span class="op" id="3672016">]</span><span class="op" id="3672017">,</span>&nbsp;<span class="ident" id="3672019">list</span><span class="op" id="3672023">[</span><span class="num" id="3672024">1</span><span class="op" id="3672025">]</span>&nbsp;<span class="op" id="3672027">=</span>&nbsp;<span class="ident" id="3672029">list</span><span class="op" id="3672033">[</span><span class="num" id="3672034">1</span><span class="op" id="3672035">]</span><span class="op" id="3672036">,</span>&nbsp;<span class="ident" id="3672038">list</span><span class="op" id="3672042">[</span><span class="num" id="3672043">0</span><span class="op" id="3672044">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672054">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672068">switch</span>&nbsp;<span class="builtinfunc" id="3672075">len</span><span class="op" id="3672078">(</span><span class="ident" id="3672079">list</span><span class="op" id="3672083">)</span>&nbsp;<span class="op" id="3672085">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672088">case</span>&nbsp;<span class="num" id="3672093">0</span><span class="op" id="3672094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672098">return</span>&nbsp;<span class="ident" id="3672105">nil</span><span class="op" id="3672108">,</span>&nbsp;<span class="ident" id="3672110">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672132">case</span>&nbsp;<span class="num" id="3672137">1</span><span class="op" id="3672138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672142">return</span>&nbsp;<span class="ident" id="3672149">list</span><span class="op" id="3672153">[</span><span class="num" id="3672154">0</span><span class="op" id="3672155">]</span><span class="op" id="3672156">,</span>&nbsp;<span class="ident" id="3672158">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672163">default</span><span class="op" id="3672170">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672174">return</span>&nbsp;<span class="ident" id="3672181">list</span><span class="op" id="3672185">,</span>&nbsp;<span class="ident" id="3672187">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672192">}</span><br>
<span class="lineno"></span><span class="op" id="3672194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3672197">func</span>&nbsp;<span class="ident" id="3672202">firstSupportedAddr</span><span class="op" id="3672220">(</span><span class="ident" id="3672221">filter</span>&nbsp;<span class="keyword" id="3672228">func</span><span class="op" id="3672232">(</span><span class="ident" id="3672233">IP</span><span class="op" id="3672235">)</span>&nbsp;<span class="ident" id="3672237">IP</span><span class="op" id="3672239">,</span>&nbsp;<span class="ident" id="3672241">ips</span>&nbsp;<span class="op" id="3672245">[</span><span class="op" id="3672246">]</span><span class="ident" id="3672247">IP</span><span class="op" id="3672249">,</span>&nbsp;<span class="ident" id="3672251">inetaddr</span>&nbsp;<span class="keyword" id="3672260">func</span><span class="op" id="3672264">(</span><span class="ident" id="3672265">IP</span><span class="op" id="3672267">)</span>&nbsp;<span class="ident" id="3672269">netaddr</span><span class="op" id="3672276">)</span>&nbsp;<span class="op" id="3672278">(</span><span class="ident" id="3672279">netaddr</span><span class="op" id="3672286">,</span>&nbsp;<span class="builtintype" id="3672288">error</span><span class="op" id="3672293">)</span>&nbsp;<span class="op" id="3672295">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672298">for</span>&nbsp;<span class="ident" id="3672302">_</span><span class="op" id="3672303">,</span>&nbsp;<span class="ident" id="3672305">ip</span>&nbsp;<span class="op" id="3672308">:=</span>&nbsp;<span class="keyword" id="3672311">range</span>&nbsp;<span class="ident" id="3672317">ips</span>&nbsp;<span class="op" id="3672321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672325">if</span>&nbsp;<span class="ident" id="3672328">ip</span>&nbsp;<span class="op" id="3672331">:=</span>&nbsp;<span class="ident" id="3672334">filter</span><span class="op" id="3672340">(</span><span class="ident" id="3672341">ip</span><span class="op" id="3672343">)</span><span class="op" id="3672344">;</span>&nbsp;<span class="ident" id="3672346">ip</span>&nbsp;<span class="op" id="3672349">!=</span>&nbsp;<span class="ident" id="3672352">nil</span>&nbsp;<span class="op" id="3672356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672361">return</span>&nbsp;<span class="ident" id="3672368">inetaddr</span><span class="op" id="3672376">(</span><span class="ident" id="3672377">ip</span><span class="op" id="3672379">)</span><span class="op" id="3672380">,</span>&nbsp;<span class="ident" id="3672382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672391">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672394">return</span>&nbsp;<span class="ident" id="3672401">nil</span><span class="op" id="3672404">,</span>&nbsp;<span class="ident" id="3672406">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3672427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3672430">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3672499">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3672572">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3672601">func</span>&nbsp;<span class="ident" id="3672606">ipv4only</span><span class="op" id="3672614">(</span><span class="ident" id="3672615">ip</span>&nbsp;<span class="ident" id="3672618">IP</span><span class="op" id="3672620">)</span>&nbsp;<span class="ident" id="3672622">IP</span>&nbsp;<span class="op" id="3672625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672628">if</span>&nbsp;<span class="ident" id="3672631">supportsIPv4</span>&nbsp;<span class="op" id="3672644">&amp;&amp;</span>&nbsp;<span class="ident" id="3672647">ip</span><span class="op" id="3672649">.</span><span class="ident" id="3672650">To4</span><span class="op" id="3672653">(</span><span class="op" id="3672654">)</span>&nbsp;<span class="op" id="3672656">!=</span>&nbsp;<span class="ident" id="3672659">nil</span>&nbsp;<span class="op" id="3672663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672667">return</span>&nbsp;<span class="ident" id="3672674">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672678">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672681">return</span>&nbsp;<span class="ident" id="3672688">nil</span><br>
<span class="lineno"></span><span class="op" id="3672692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3672695">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3672764">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3672832">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3672896">func</span>&nbsp;<span class="ident" id="3672901">ipv6only</span><span class="op" id="3672909">(</span><span class="ident" id="3672910">ip</span>&nbsp;<span class="ident" id="3672913">IP</span><span class="op" id="3672915">)</span>&nbsp;<span class="ident" id="3672917">IP</span>&nbsp;<span class="op" id="3672920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672923">if</span>&nbsp;<span class="ident" id="3672926">supportsIPv6</span>&nbsp;<span class="op" id="3672939">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3672942">len</span><span class="op" id="3672945">(</span><span class="ident" id="3672946">ip</span><span class="op" id="3672948">)</span>&nbsp;<span class="op" id="3672950">==</span>&nbsp;<span class="ident" id="3672953">IPv6len</span>&nbsp;<span class="op" id="3672961">&amp;&amp;</span>&nbsp;<span class="ident" id="3672964">ip</span><span class="op" id="3672966">.</span><span class="ident" id="3672967">To4</span><span class="op" id="3672970">(</span><span class="op" id="3672971">)</span>&nbsp;<span class="op" id="3672973">==</span>&nbsp;<span class="ident" id="3672976">nil</span>&nbsp;<span class="op" id="3672980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672984">return</span>&nbsp;<span class="ident" id="3672991">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3672995">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3672998">return</span>&nbsp;<span class="ident" id="3673005">nil</span><br>
<span class="lineno"></span><span class="op" id="3673009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3673012">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3673079">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3673136">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3673205">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3673263">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3673311">func</span>&nbsp;<span class="ident" id="3673316">SplitHostPort</span><span class="op" id="3673329">(</span><span class="ident" id="3673330">hostport</span>&nbsp;<span class="builtintype" id="3673339">string</span><span class="op" id="3673345">)</span>&nbsp;<span class="op" id="3673347">(</span><span class="ident" id="3673348">host</span><span class="op" id="3673352">,</span>&nbsp;<span class="ident" id="3673354">port</span>&nbsp;<span class="builtintype" id="3673359">string</span><span class="op" id="3673365">,</span>&nbsp;<span class="ident" id="3673367">err</span>&nbsp;<span class="builtintype" id="3673371">error</span><span class="op" id="3673376">)</span>&nbsp;<span class="op" id="3673378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673381">j</span><span class="op" id="3673382">,</span>&nbsp;<span class="ident" id="3673384">k</span>&nbsp;<span class="op" id="3673386">:=</span>&nbsp;<span class="num" id="3673389">0</span><span class="op" id="3673390">,</span>&nbsp;<span class="num" id="3673392">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673396">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673438">i</span>&nbsp;<span class="op" id="3673440">:=</span>&nbsp;<span class="ident" id="3673443">last</span><span class="op" id="3673447">(</span><span class="ident" id="3673448">hostport</span><span class="op" id="3673456">,</span>&nbsp;<span class="string" id="3673458">&#39;:&#39;</span><span class="op" id="3673461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673464">if</span>&nbsp;<span class="ident" id="3673467">i</span>&nbsp;<span class="op" id="3673469">&lt;</span>&nbsp;<span class="num" id="3673471">0</span>&nbsp;<span class="op" id="3673473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673477">goto</span>&nbsp;<span class="ident" id="3673482">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673499">if</span>&nbsp;<span class="ident" id="3673502">hostport</span><span class="op" id="3673510">[</span><span class="num" id="3673511">0</span><span class="op" id="3673512">]</span>&nbsp;<span class="op" id="3673514">==</span>&nbsp;<span class="string" id="3673517">&#39;[&#39;</span>&nbsp;<span class="op" id="3673521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673525">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673577">end</span>&nbsp;<span class="op" id="3673581">:=</span>&nbsp;<span class="ident" id="3673584">byteIndex</span><span class="op" id="3673593">(</span><span class="ident" id="3673594">hostport</span><span class="op" id="3673602">,</span>&nbsp;<span class="string" id="3673604">&#39;]&#39;</span><span class="op" id="3673607">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673611">if</span>&nbsp;<span class="ident" id="3673614">end</span>&nbsp;<span class="op" id="3673618">&lt;</span>&nbsp;<span class="num" id="3673620">0</span>&nbsp;<span class="op" id="3673622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3673627">err</span>&nbsp;<span class="op" id="3673631">=</span>&nbsp;<span class="op" id="3673633">&amp;</span><span class="ident" id="3673634">AddrError</span><span class="op" id="3673643">{</span><span class="string" id="3673644">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3673668">,</span>&nbsp;<span class="ident" id="3673670">hostport</span><span class="op" id="3673678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673683">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3673692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673696">switch</span>&nbsp;<span class="ident" id="3673703">end</span>&nbsp;<span class="op" id="3673707">+</span>&nbsp;<span class="num" id="3673709">1</span>&nbsp;<span class="op" id="3673711">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673715">case</span>&nbsp;<span class="builtinfunc" id="3673720">len</span><span class="op" id="3673723">(</span><span class="ident" id="3673724">hostport</span><span class="op" id="3673732">)</span><span class="op" id="3673733">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673738">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673785">goto</span>&nbsp;<span class="ident" id="3673790">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673804">case</span>&nbsp;<span class="ident" id="3673809">i</span><span class="op" id="3673810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673815">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673841">default</span><span class="op" id="3673848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673853">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3673906">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673958">if</span>&nbsp;<span class="ident" id="3673961">hostport</span><span class="op" id="3673969">[</span><span class="ident" id="3673970">end</span><span class="op" id="3673973">+</span><span class="num" id="3673974">1</span><span class="op" id="3673975">]</span>&nbsp;<span class="op" id="3673977">==</span>&nbsp;<span class="string" id="3673980">&#39;:&#39;</span>&nbsp;<span class="op" id="3673984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3673990">goto</span>&nbsp;<span class="ident" id="3673995">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674017">goto</span>&nbsp;<span class="ident" id="3674022">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674040">host</span>&nbsp;<span class="op" id="3674045">=</span>&nbsp;<span class="ident" id="3674047">hostport</span><span class="op" id="3674055">[</span><span class="num" id="3674056">1</span><span class="op" id="3674057">:</span><span class="ident" id="3674058">end</span><span class="op" id="3674061">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674065">j</span><span class="op" id="3674066">,</span>&nbsp;<span class="ident" id="3674068">k</span>&nbsp;<span class="op" id="3674070">=</span>&nbsp;<span class="num" id="3674072">1</span><span class="op" id="3674073">,</span>&nbsp;<span class="ident" id="3674075">end</span><span class="op" id="3674078">+</span><span class="num" id="3674079">1</span>&nbsp;<span class="comment" id="3674081">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674139">}</span>&nbsp;<span class="keyword" id="3674141">else</span>&nbsp;<span class="op" id="3674146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674150">host</span>&nbsp;<span class="op" id="3674155">=</span>&nbsp;<span class="ident" id="3674157">hostport</span><span class="op" id="3674165">[</span><span class="op" id="3674166">:</span><span class="ident" id="3674167">i</span><span class="op" id="3674168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674172">if</span>&nbsp;<span class="ident" id="3674175">byteIndex</span><span class="op" id="3674184">(</span><span class="ident" id="3674185">host</span><span class="op" id="3674189">,</span>&nbsp;<span class="string" id="3674191">&#39;:&#39;</span><span class="op" id="3674194">)</span>&nbsp;<span class="op" id="3674196">&gt;=</span>&nbsp;<span class="num" id="3674199">0</span>&nbsp;<span class="op" id="3674201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674206">goto</span>&nbsp;<span class="ident" id="3674211">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674227">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674231">if</span>&nbsp;<span class="ident" id="3674234">byteIndex</span><span class="op" id="3674243">(</span><span class="ident" id="3674244">host</span><span class="op" id="3674248">,</span>&nbsp;<span class="string" id="3674250">&#39;%&#39;</span><span class="op" id="3674253">)</span>&nbsp;<span class="op" id="3674255">&gt;=</span>&nbsp;<span class="num" id="3674258">0</span>&nbsp;<span class="op" id="3674260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674265">goto</span>&nbsp;<span class="ident" id="3674270">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674294">if</span>&nbsp;<span class="ident" id="3674297">byteIndex</span><span class="op" id="3674306">(</span><span class="ident" id="3674307">hostport</span><span class="op" id="3674315">[</span><span class="ident" id="3674316">j</span><span class="op" id="3674317">:</span><span class="op" id="3674318">]</span><span class="op" id="3674319">,</span>&nbsp;<span class="string" id="3674321">&#39;[&#39;</span><span class="op" id="3674324">)</span>&nbsp;<span class="op" id="3674326">&gt;=</span>&nbsp;<span class="num" id="3674329">0</span>&nbsp;<span class="op" id="3674331">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674335">err</span>&nbsp;<span class="op" id="3674339">=</span>&nbsp;<span class="op" id="3674341">&amp;</span><span class="ident" id="3674342">AddrError</span><span class="op" id="3674351">{</span><span class="string" id="3674352">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3674379">,</span>&nbsp;<span class="ident" id="3674381">hostport</span><span class="op" id="3674389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674393">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674404">if</span>&nbsp;<span class="ident" id="3674407">byteIndex</span><span class="op" id="3674416">(</span><span class="ident" id="3674417">hostport</span><span class="op" id="3674425">[</span><span class="ident" id="3674426">k</span><span class="op" id="3674427">:</span><span class="op" id="3674428">]</span><span class="op" id="3674429">,</span>&nbsp;<span class="string" id="3674431">&#39;]&#39;</span><span class="op" id="3674434">)</span>&nbsp;<span class="op" id="3674436">&gt;=</span>&nbsp;<span class="num" id="3674439">0</span>&nbsp;<span class="op" id="3674441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674445">err</span>&nbsp;<span class="op" id="3674449">=</span>&nbsp;<span class="op" id="3674451">&amp;</span><span class="ident" id="3674452">AddrError</span><span class="op" id="3674461">{</span><span class="string" id="3674462">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3674489">,</span>&nbsp;<span class="ident" id="3674491">hostport</span><span class="op" id="3674499">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674503">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674515">port</span>&nbsp;<span class="op" id="3674520">=</span>&nbsp;<span class="ident" id="3674522">hostport</span><span class="op" id="3674530">[</span><span class="ident" id="3674531">i</span><span class="op" id="3674532">+</span><span class="num" id="3674533">1</span><span class="op" id="3674534">:</span><span class="op" id="3674535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674538">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3674546">missingPort</span><span class="op" id="3674557">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674560">err</span>&nbsp;<span class="op" id="3674564">=</span>&nbsp;<span class="op" id="3674566">&amp;</span><span class="ident" id="3674567">AddrError</span><span class="op" id="3674576">{</span><span class="string" id="3674577">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3674602">,</span>&nbsp;<span class="ident" id="3674604">hostport</span><span class="op" id="3674612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674615">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3674623">tooManyColons</span><span class="op" id="3674636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674639">err</span>&nbsp;<span class="op" id="3674643">=</span>&nbsp;<span class="op" id="3674645">&amp;</span><span class="ident" id="3674646">AddrError</span><span class="op" id="3674655">{</span><span class="string" id="3674656">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3674684">,</span>&nbsp;<span class="ident" id="3674686">hostport</span><span class="op" id="3674694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674697">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3674705">missingBrackets</span><span class="op" id="3674720">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674723">err</span>&nbsp;<span class="op" id="3674727">=</span>&nbsp;<span class="op" id="3674729">&amp;</span><span class="ident" id="3674730">AddrError</span><span class="op" id="3674739">{</span><span class="string" id="3674740">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3674769">,</span>&nbsp;<span class="ident" id="3674771">hostport</span><span class="op" id="3674779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674782">return</span><br>
<span class="lineno"></span><span class="op" id="3674789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3674792">func</span>&nbsp;<span class="ident" id="3674797">splitHostZone</span><span class="op" id="3674810">(</span><span class="ident" id="3674811">s</span>&nbsp;<span class="builtintype" id="3674813">string</span><span class="op" id="3674819">)</span>&nbsp;<span class="op" id="3674821">(</span><span class="ident" id="3674822">host</span><span class="op" id="3674826">,</span>&nbsp;<span class="ident" id="3674828">zone</span>&nbsp;<span class="builtintype" id="3674833">string</span><span class="op" id="3674839">)</span>&nbsp;<span class="op" id="3674841">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674844">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3674908">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3674931">if</span>&nbsp;<span class="ident" id="3674934">i</span>&nbsp;<span class="op" id="3674936">:=</span>&nbsp;<span class="ident" id="3674939">last</span><span class="op" id="3674943">(</span><span class="ident" id="3674944">s</span><span class="op" id="3674945">,</span>&nbsp;<span class="string" id="3674947">&#39;%&#39;</span><span class="op" id="3674950">)</span><span class="op" id="3674951">;</span>&nbsp;<span class="ident" id="3674953">i</span>&nbsp;<span class="op" id="3674955">&gt;</span>&nbsp;<span class="num" id="3674957">0</span>&nbsp;<span class="op" id="3674959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3674963">host</span><span class="op" id="3674967">,</span>&nbsp;<span class="ident" id="3674969">zone</span>&nbsp;<span class="op" id="3674974">=</span>&nbsp;<span class="ident" id="3674976">s</span><span class="op" id="3674977">[</span><span class="op" id="3674978">:</span><span class="ident" id="3674979">i</span><span class="op" id="3674980">]</span><span class="op" id="3674981">,</span>&nbsp;<span class="ident" id="3674983">s</span><span class="op" id="3674984">[</span><span class="ident" id="3674985">i</span><span class="op" id="3674986">+</span><span class="num" id="3674987">1</span><span class="op" id="3674988">:</span><span class="op" id="3674989">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3674992">}</span>&nbsp;<span class="keyword" id="3674994">else</span>&nbsp;<span class="op" id="3674999">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675003">host</span>&nbsp;<span class="op" id="3675008">=</span>&nbsp;<span class="ident" id="3675010">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675016">return</span><br>
<span class="lineno"></span><span class="op" id="3675023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3675026">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3675095">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3675163">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3675181">func</span>&nbsp;<span class="ident" id="3675186">JoinHostPort</span><span class="op" id="3675198">(</span><span class="ident" id="3675199">host</span><span class="op" id="3675203">,</span>&nbsp;<span class="ident" id="3675205">port</span>&nbsp;<span class="builtintype" id="3675210">string</span><span class="op" id="3675216">)</span>&nbsp;<span class="builtintype" id="3675218">string</span>&nbsp;<span class="op" id="3675225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3675228">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675290">if</span>&nbsp;<span class="ident" id="3675293">byteIndex</span><span class="op" id="3675302">(</span><span class="ident" id="3675303">host</span><span class="op" id="3675307">,</span>&nbsp;<span class="string" id="3675309">&#39;:&#39;</span><span class="op" id="3675312">)</span>&nbsp;<span class="op" id="3675314">&gt;=</span>&nbsp;<span class="num" id="3675317">0</span>&nbsp;<span class="op" id="3675319">||</span>&nbsp;<span class="ident" id="3675322">byteIndex</span><span class="op" id="3675331">(</span><span class="ident" id="3675332">host</span><span class="op" id="3675336">,</span>&nbsp;<span class="string" id="3675338">&#39;%&#39;</span><span class="op" id="3675341">)</span>&nbsp;<span class="op" id="3675343">&gt;=</span>&nbsp;<span class="num" id="3675346">0</span>&nbsp;<span class="op" id="3675348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675352">return</span>&nbsp;<span class="string" id="3675359">&#34;[&#34;</span>&nbsp;<span class="op" id="3675363">+</span>&nbsp;<span class="ident" id="3675365">host</span>&nbsp;<span class="op" id="3675370">+</span>&nbsp;<span class="string" id="3675372">&#34;]:&#34;</span>&nbsp;<span class="op" id="3675377">+</span>&nbsp;<span class="ident" id="3675379">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675388">return</span>&nbsp;<span class="ident" id="3675395">host</span>&nbsp;<span class="op" id="3675400">+</span>&nbsp;<span class="string" id="3675402">&#34;:&#34;</span>&nbsp;<span class="op" id="3675406">+</span>&nbsp;<span class="ident" id="3675408">port</span><br>
<span class="lineno"></span><span class="op" id="3675413">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3675416">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3675481">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3675546">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3675610">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3675679">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3675748">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3675778">func</span>&nbsp;<span class="ident" id="3675783">resolveInternetAddr</span><span class="op" id="3675802">(</span><span class="ident" id="3675803">net</span><span class="op" id="3675806">,</span>&nbsp;<span class="ident" id="3675808">addr</span>&nbsp;<span class="builtintype" id="3675813">string</span><span class="op" id="3675819">,</span>&nbsp;<span class="ident" id="3675821">deadline</span>&nbsp;<span class="ident" id="3675830">time</span><span class="op" id="3675834">.</span><span class="ident" id="3675835">Time</span><span class="op" id="3675839">)</span>&nbsp;<span class="op" id="3675841">(</span><span class="ident" id="3675842">netaddr</span><span class="op" id="3675849">,</span>&nbsp;<span class="builtintype" id="3675851">error</span><span class="op" id="3675856">)</span>&nbsp;<span class="op" id="3675858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675861">var</span>&nbsp;<span class="op" id="3675865">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675869">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3675886">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675894">host</span><span class="op" id="3675898">,</span>&nbsp;<span class="ident" id="3675900">port</span><span class="op" id="3675904">,</span>&nbsp;<span class="ident" id="3675906">zone</span>&nbsp;<span class="builtintype" id="3675911">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3675920">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3675937">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3675942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675945">switch</span>&nbsp;<span class="ident" id="3675952">net</span>&nbsp;<span class="op" id="3675956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3675959">case</span>&nbsp;<span class="string" id="3675964">&#34;tcp&#34;</span><span class="op" id="3675969">,</span>&nbsp;<span class="string" id="3675971">&#34;tcp4&#34;</span><span class="op" id="3675977">,</span>&nbsp;<span class="string" id="3675979">&#34;tcp6&#34;</span><span class="op" id="3675985">,</span>&nbsp;<span class="string" id="3675987">&#34;udp&#34;</span><span class="op" id="3675992">,</span>&nbsp;<span class="string" id="3675994">&#34;udp4&#34;</span><span class="op" id="3676000">,</span>&nbsp;<span class="string" id="3676002">&#34;udp6&#34;</span><span class="op" id="3676008">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676012">if</span>&nbsp;<span class="ident" id="3676015">addr</span>&nbsp;<span class="op" id="3676020">!=</span>&nbsp;<span class="string" id="3676023">&#34;&#34;</span>&nbsp;<span class="op" id="3676026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676031">if</span>&nbsp;<span class="ident" id="3676034">host</span><span class="op" id="3676038">,</span>&nbsp;<span class="ident" id="3676040">port</span><span class="op" id="3676044">,</span>&nbsp;<span class="ident" id="3676046">err</span>&nbsp;<span class="op" id="3676050">=</span>&nbsp;<span class="ident" id="3676052">SplitHostPort</span><span class="op" id="3676065">(</span><span class="ident" id="3676066">addr</span><span class="op" id="3676070">)</span><span class="op" id="3676071">;</span>&nbsp;<span class="ident" id="3676073">err</span>&nbsp;<span class="op" id="3676077">!=</span>&nbsp;<span class="ident" id="3676080">nil</span>&nbsp;<span class="op" id="3676084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676090">return</span>&nbsp;<span class="ident" id="3676097">nil</span><span class="op" id="3676100">,</span>&nbsp;<span class="ident" id="3676102">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676114">if</span>&nbsp;<span class="ident" id="3676117">portnum</span><span class="op" id="3676124">,</span>&nbsp;<span class="ident" id="3676126">err</span>&nbsp;<span class="op" id="3676130">=</span>&nbsp;<span class="ident" id="3676132">parsePort</span><span class="op" id="3676141">(</span><span class="ident" id="3676142">net</span><span class="op" id="3676145">,</span>&nbsp;<span class="ident" id="3676147">port</span><span class="op" id="3676151">)</span><span class="op" id="3676152">;</span>&nbsp;<span class="ident" id="3676154">err</span>&nbsp;<span class="op" id="3676158">!=</span>&nbsp;<span class="ident" id="3676161">nil</span>&nbsp;<span class="op" id="3676165">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676171">return</span>&nbsp;<span class="ident" id="3676178">nil</span><span class="op" id="3676181">,</span>&nbsp;<span class="ident" id="3676183">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676197">case</span>&nbsp;<span class="string" id="3676202">&#34;ip&#34;</span><span class="op" id="3676206">,</span>&nbsp;<span class="string" id="3676208">&#34;ip4&#34;</span><span class="op" id="3676213">,</span>&nbsp;<span class="string" id="3676215">&#34;ip6&#34;</span><span class="op" id="3676220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676224">if</span>&nbsp;<span class="ident" id="3676227">addr</span>&nbsp;<span class="op" id="3676232">!=</span>&nbsp;<span class="string" id="3676235">&#34;&#34;</span>&nbsp;<span class="op" id="3676238">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676243">host</span>&nbsp;<span class="op" id="3676248">=</span>&nbsp;<span class="ident" id="3676250">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676260">default</span><span class="op" id="3676267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676271">return</span>&nbsp;<span class="ident" id="3676278">nil</span><span class="op" id="3676281">,</span>&nbsp;<span class="ident" id="3676283">UnknownNetworkError</span><span class="op" id="3676302">(</span><span class="ident" id="3676303">net</span><span class="op" id="3676306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676309">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676312">inetaddr</span>&nbsp;<span class="op" id="3676321">:=</span>&nbsp;<span class="keyword" id="3676324">func</span><span class="op" id="3676328">(</span><span class="ident" id="3676329">ip</span>&nbsp;<span class="ident" id="3676332">IP</span><span class="op" id="3676334">)</span>&nbsp;<span class="ident" id="3676336">netaddr</span>&nbsp;<span class="op" id="3676344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676348">switch</span>&nbsp;<span class="ident" id="3676355">net</span>&nbsp;<span class="op" id="3676359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676363">case</span>&nbsp;<span class="string" id="3676368">&#34;tcp&#34;</span><span class="op" id="3676373">,</span>&nbsp;<span class="string" id="3676375">&#34;tcp4&#34;</span><span class="op" id="3676381">,</span>&nbsp;<span class="string" id="3676383">&#34;tcp6&#34;</span><span class="op" id="3676389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676394">return</span>&nbsp;<span class="op" id="3676401">&amp;</span><span class="ident" id="3676402">TCPAddr</span><span class="op" id="3676409">{</span><span class="ident" id="3676410">IP</span><span class="op" id="3676412">:</span>&nbsp;<span class="ident" id="3676414">ip</span><span class="op" id="3676416">,</span>&nbsp;<span class="ident" id="3676418">Port</span><span class="op" id="3676422">:</span>&nbsp;<span class="ident" id="3676424">portnum</span><span class="op" id="3676431">,</span>&nbsp;<span class="ident" id="3676433">Zone</span><span class="op" id="3676437">:</span>&nbsp;<span class="ident" id="3676439">zone</span><span class="op" id="3676443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676447">case</span>&nbsp;<span class="string" id="3676452">&#34;udp&#34;</span><span class="op" id="3676457">,</span>&nbsp;<span class="string" id="3676459">&#34;udp4&#34;</span><span class="op" id="3676465">,</span>&nbsp;<span class="string" id="3676467">&#34;udp6&#34;</span><span class="op" id="3676473">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676478">return</span>&nbsp;<span class="op" id="3676485">&amp;</span><span class="ident" id="3676486">UDPAddr</span><span class="op" id="3676493">{</span><span class="ident" id="3676494">IP</span><span class="op" id="3676496">:</span>&nbsp;<span class="ident" id="3676498">ip</span><span class="op" id="3676500">,</span>&nbsp;<span class="ident" id="3676502">Port</span><span class="op" id="3676506">:</span>&nbsp;<span class="ident" id="3676508">portnum</span><span class="op" id="3676515">,</span>&nbsp;<span class="ident" id="3676517">Zone</span><span class="op" id="3676521">:</span>&nbsp;<span class="ident" id="3676523">zone</span><span class="op" id="3676527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676531">case</span>&nbsp;<span class="string" id="3676536">&#34;ip&#34;</span><span class="op" id="3676540">,</span>&nbsp;<span class="string" id="3676542">&#34;ip4&#34;</span><span class="op" id="3676547">,</span>&nbsp;<span class="string" id="3676549">&#34;ip6&#34;</span><span class="op" id="3676554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676559">return</span>&nbsp;<span class="op" id="3676566">&amp;</span><span class="ident" id="3676567">IPAddr</span><span class="op" id="3676573">{</span><span class="ident" id="3676574">IP</span><span class="op" id="3676576">:</span>&nbsp;<span class="ident" id="3676578">ip</span><span class="op" id="3676580">,</span>&nbsp;<span class="ident" id="3676582">Zone</span><span class="op" id="3676586">:</span>&nbsp;<span class="ident" id="3676588">zone</span><span class="op" id="3676592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676596">default</span><span class="op" id="3676603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3676608">panic</span><span class="op" id="3676613">(</span><span class="string" id="3676614">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3676637">+</span>&nbsp;<span class="ident" id="3676639">net</span><span class="op" id="3676642">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676652">if</span>&nbsp;<span class="ident" id="3676655">host</span>&nbsp;<span class="op" id="3676660">==</span>&nbsp;<span class="string" id="3676663">&#34;&#34;</span>&nbsp;<span class="op" id="3676666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676670">return</span>&nbsp;<span class="ident" id="3676677">inetaddr</span><span class="op" id="3676685">(</span><span class="ident" id="3676686">nil</span><span class="op" id="3676689">)</span><span class="op" id="3676690">,</span>&nbsp;<span class="ident" id="3676692">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676697">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676700">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676733">var</span>&nbsp;<span class="ident" id="3676737">ip</span>&nbsp;<span class="ident" id="3676740">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676744">if</span>&nbsp;<span class="ident" id="3676747">ip</span>&nbsp;<span class="op" id="3676750">=</span>&nbsp;<span class="ident" id="3676752">parseIPv4</span><span class="op" id="3676761">(</span><span class="ident" id="3676762">host</span><span class="op" id="3676766">)</span><span class="op" id="3676767">;</span>&nbsp;<span class="ident" id="3676769">ip</span>&nbsp;<span class="op" id="3676772">!=</span>&nbsp;<span class="ident" id="3676775">nil</span>&nbsp;<span class="op" id="3676779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676783">return</span>&nbsp;<span class="ident" id="3676790">inetaddr</span><span class="op" id="3676798">(</span><span class="ident" id="3676799">ip</span><span class="op" id="3676801">)</span><span class="op" id="3676802">,</span>&nbsp;<span class="ident" id="3676804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676809">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676812">if</span>&nbsp;<span class="ident" id="3676815">ip</span><span class="op" id="3676817">,</span>&nbsp;<span class="ident" id="3676819">zone</span>&nbsp;<span class="op" id="3676824">=</span>&nbsp;<span class="ident" id="3676826">parseIPv6</span><span class="op" id="3676835">(</span><span class="ident" id="3676836">host</span><span class="op" id="3676840">,</span>&nbsp;<span class="builtintype" id="3676842">true</span><span class="op" id="3676846">)</span><span class="op" id="3676847">;</span>&nbsp;<span class="ident" id="3676849">ip</span>&nbsp;<span class="op" id="3676852">!=</span>&nbsp;<span class="ident" id="3676855">nil</span>&nbsp;<span class="op" id="3676859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676863">return</span>&nbsp;<span class="ident" id="3676870">inetaddr</span><span class="op" id="3676878">(</span><span class="ident" id="3676879">ip</span><span class="op" id="3676881">)</span><span class="op" id="3676882">,</span>&nbsp;<span class="ident" id="3676884">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3676889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3676892">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676915">host</span><span class="op" id="3676919">,</span>&nbsp;<span class="ident" id="3676921">zone</span>&nbsp;<span class="op" id="3676926">=</span>&nbsp;<span class="ident" id="3676928">splitHostZone</span><span class="op" id="3676941">(</span><span class="ident" id="3676942">host</span><span class="op" id="3676946">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3676949">ips</span><span class="op" id="3676952">,</span>&nbsp;<span class="ident" id="3676954">err</span>&nbsp;<span class="op" id="3676958">:=</span>&nbsp;<span class="ident" id="3676961">lookupIPDeadline</span><span class="op" id="3676977">(</span><span class="ident" id="3676978">host</span><span class="op" id="3676982">,</span>&nbsp;<span class="ident" id="3676984">deadline</span><span class="op" id="3676992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3676995">if</span>&nbsp;<span class="ident" id="3676998">err</span>&nbsp;<span class="op" id="3677002">!=</span>&nbsp;<span class="ident" id="3677005">nil</span>&nbsp;<span class="op" id="3677009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677013">return</span>&nbsp;<span class="ident" id="3677020">nil</span><span class="op" id="3677023">,</span>&nbsp;<span class="ident" id="3677025">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677033">var</span>&nbsp;<span class="ident" id="3677037">filter</span>&nbsp;<span class="keyword" id="3677044">func</span><span class="op" id="3677048">(</span><span class="ident" id="3677049">IP</span><span class="op" id="3677051">)</span>&nbsp;<span class="ident" id="3677053">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677057">if</span>&nbsp;<span class="ident" id="3677060">net</span>&nbsp;<span class="op" id="3677064">!=</span>&nbsp;<span class="string" id="3677067">&#34;&#34;</span>&nbsp;<span class="op" id="3677070">&amp;&amp;</span>&nbsp;<span class="ident" id="3677073">net</span><span class="op" id="3677076">[</span><span class="builtinfunc" id="3677077">len</span><span class="op" id="3677080">(</span><span class="ident" id="3677081">net</span><span class="op" id="3677084">)</span><span class="op" id="3677085">-</span><span class="num" id="3677086">1</span><span class="op" id="3677087">]</span>&nbsp;<span class="op" id="3677089">==</span>&nbsp;<span class="string" id="3677092">&#39;4&#39;</span>&nbsp;<span class="op" id="3677096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677100">filter</span>&nbsp;<span class="op" id="3677107">=</span>&nbsp;<span class="ident" id="3677109">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677122">if</span>&nbsp;<span class="ident" id="3677125">net</span>&nbsp;<span class="op" id="3677129">!=</span>&nbsp;<span class="string" id="3677132">&#34;&#34;</span>&nbsp;<span class="op" id="3677135">&amp;&amp;</span>&nbsp;<span class="ident" id="3677138">net</span><span class="op" id="3677141">[</span><span class="builtinfunc" id="3677142">len</span><span class="op" id="3677145">(</span><span class="ident" id="3677146">net</span><span class="op" id="3677149">)</span><span class="op" id="3677150">-</span><span class="num" id="3677151">1</span><span class="op" id="3677152">]</span>&nbsp;<span class="op" id="3677154">==</span>&nbsp;<span class="string" id="3677157">&#39;6&#39;</span>&nbsp;<span class="op" id="3677161">||</span>&nbsp;<span class="ident" id="3677164">zone</span>&nbsp;<span class="op" id="3677169">!=</span>&nbsp;<span class="string" id="3677172">&#34;&#34;</span>&nbsp;<span class="op" id="3677175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677179">filter</span>&nbsp;<span class="op" id="3677186">=</span>&nbsp;<span class="ident" id="3677188">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677201">return</span>&nbsp;<span class="ident" id="3677208">firstFavoriteAddr</span><span class="op" id="3677225">(</span><span class="ident" id="3677226">filter</span><span class="op" id="3677232">,</span>&nbsp;<span class="ident" id="3677234">ips</span><span class="op" id="3677237">,</span>&nbsp;<span class="ident" id="3677239">inetaddr</span><span class="op" id="3677247">)</span><br>
<span class="lineno"></span><span class="op" id="3677249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3677252">func</span>&nbsp;<span class="ident" id="3677257">zoneToString</span><span class="op" id="3677269">(</span><span class="ident" id="3677270">zone</span>&nbsp;<span class="builtintype" id="3677275">int</span><span class="op" id="3677278">)</span>&nbsp;<span class="builtintype" id="3677280">string</span>&nbsp;<span class="op" id="3677287">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677290">if</span>&nbsp;<span class="ident" id="3677293">zone</span>&nbsp;<span class="op" id="3677298">==</span>&nbsp;<span class="num" id="3677301">0</span>&nbsp;<span class="op" id="3677303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677307">return</span>&nbsp;<span class="string" id="3677314">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677321">if</span>&nbsp;<span class="ident" id="3677324">ifi</span><span class="op" id="3677327">,</span>&nbsp;<span class="ident" id="3677329">err</span>&nbsp;<span class="op" id="3677333">:=</span>&nbsp;<span class="ident" id="3677336">InterfaceByIndex</span><span class="op" id="3677352">(</span><span class="ident" id="3677353">zone</span><span class="op" id="3677357">)</span><span class="op" id="3677358">;</span>&nbsp;<span class="ident" id="3677360">err</span>&nbsp;<span class="op" id="3677364">==</span>&nbsp;<span class="ident" id="3677367">nil</span>&nbsp;<span class="op" id="3677371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677375">return</span>&nbsp;<span class="ident" id="3677382">ifi</span><span class="op" id="3677385">.</span><span class="ident" id="3677386">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677395">return</span>&nbsp;<span class="ident" id="3677402">itod</span><span class="op" id="3677406">(</span><span class="builtintype" id="3677407">uint</span><span class="op" id="3677411">(</span><span class="ident" id="3677412">zone</span><span class="op" id="3677416">)</span><span class="op" id="3677417">)</span><br>
<span class="lineno"></span><span class="op" id="3677419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3677422">func</span>&nbsp;<span class="ident" id="3677427">zoneToInt</span><span class="op" id="3677436">(</span><span class="ident" id="3677437">zone</span>&nbsp;<span class="builtintype" id="3677442">string</span><span class="op" id="3677448">)</span>&nbsp;<span class="builtintype" id="3677450">int</span>&nbsp;<span class="op" id="3677454">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677457">if</span>&nbsp;<span class="ident" id="3677460">zone</span>&nbsp;<span class="op" id="3677465">==</span>&nbsp;<span class="string" id="3677468">&#34;&#34;</span>&nbsp;<span class="op" id="3677471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677475">return</span>&nbsp;<span class="num" id="3677482">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677488">if</span>&nbsp;<span class="ident" id="3677491">ifi</span><span class="op" id="3677494">,</span>&nbsp;<span class="ident" id="3677496">err</span>&nbsp;<span class="op" id="3677500">:=</span>&nbsp;<span class="ident" id="3677503">InterfaceByName</span><span class="op" id="3677518">(</span><span class="ident" id="3677519">zone</span><span class="op" id="3677523">)</span><span class="op" id="3677524">;</span>&nbsp;<span class="ident" id="3677526">err</span>&nbsp;<span class="op" id="3677530">==</span>&nbsp;<span class="ident" id="3677533">nil</span>&nbsp;<span class="op" id="3677537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677541">return</span>&nbsp;<span class="ident" id="3677548">ifi</span><span class="op" id="3677551">.</span><span class="ident" id="3677552">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3677559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3677562">n</span><span class="op" id="3677563">,</span>&nbsp;<span class="ident" id="3677565">_</span><span class="op" id="3677566">,</span>&nbsp;<span class="ident" id="3677568">_</span>&nbsp;<span class="op" id="3677570">:=</span>&nbsp;<span class="ident" id="3677573">dtoi</span><span class="op" id="3677577">(</span><span class="ident" id="3677578">zone</span><span class="op" id="3677582">,</span>&nbsp;<span class="num" id="3677584">0</span><span class="op" id="3677585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3677588">return</span>&nbsp;<span class="ident" id="3677595">n</span><br>
<span class="lineno"></span><span class="op" id="3677597">}</span>
</div>
</body>
</html>
