<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html" class="current">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3059430">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3059485">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3059539">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3059590">package</span>&nbsp;<span class="ident" id="3059598">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3059608">import</span>&nbsp;<span class="op" id="3059615">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3059618">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3059627">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3059637">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3059640">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="3059719">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3059797">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="3059875">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="3059885">var</span>&nbsp;<span class="ident" id="3059889">transitionFunc</span>&nbsp;<span class="op" id="3059904">=</span>&nbsp;<span class="op" id="3059906">[</span><span class="op" id="3059907">...</span><span class="op" id="3059910">]</span><span class="keyword" id="3059911">func</span><span class="op" id="3059915">(</span><span class="ident" id="3059916">context</span><span class="op" id="3059923">,</span>&nbsp;<span class="op" id="3059925">[</span><span class="op" id="3059926">]</span><span class="builtintype" id="3059927">byte</span><span class="op" id="3059931">)</span>&nbsp;<span class="op" id="3059933">(</span><span class="ident" id="3059934">context</span><span class="op" id="3059941">,</span>&nbsp;<span class="builtintype" id="3059943">int</span><span class="op" id="3059946">)</span><span class="op" id="3059947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3059950">stateText</span><span class="op" id="3059959">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3059968">tText</span><span class="op" id="3059973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3059976">stateTag</span><span class="op" id="3059984">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3059994">tTag</span><span class="op" id="3059998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060001">stateAttrName</span><span class="op" id="3060014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060019">tAttrName</span><span class="op" id="3060028">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060031">stateAfterName</span><span class="op" id="3060045">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3060049">tAfterName</span><span class="op" id="3060059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060062">stateBeforeValue</span><span class="op" id="3060078">:</span>&nbsp;<span class="ident" id="3060080">tBeforeValue</span><span class="op" id="3060092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060095">stateHTMLCmt</span><span class="op" id="3060107">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060113">tHTMLCmt</span><span class="op" id="3060121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060124">stateRCDATA</span><span class="op" id="3060135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060142">tSpecialTagEnd</span><span class="op" id="3060156">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060159">stateAttr</span><span class="op" id="3060168">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060177">tAttr</span><span class="op" id="3060182">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060185">stateURL</span><span class="op" id="3060193">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060203">tURL</span><span class="op" id="3060207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060210">stateJS</span><span class="op" id="3060217">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060228">tJS</span><span class="op" id="3060231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060234">stateJSDqStr</span><span class="op" id="3060246">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060252">tJSDelimited</span><span class="op" id="3060264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060267">stateJSSqStr</span><span class="op" id="3060279">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060285">tJSDelimited</span><span class="op" id="3060297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060300">stateJSRegexp</span><span class="op" id="3060313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060318">tJSDelimited</span><span class="op" id="3060330">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060333">stateJSBlockCmt</span><span class="op" id="3060348">:</span>&nbsp;&nbsp;<span class="ident" id="3060351">tBlockCmt</span><span class="op" id="3060360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060363">stateJSLineCmt</span><span class="op" id="3060377">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3060381">tLineCmt</span><span class="op" id="3060389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060392">stateCSS</span><span class="op" id="3060400">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060410">tCSS</span><span class="op" id="3060414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060417">stateCSSDqStr</span><span class="op" id="3060430">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060435">tCSSStr</span><span class="op" id="3060442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060445">stateCSSSqStr</span><span class="op" id="3060458">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060463">tCSSStr</span><span class="op" id="3060470">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060473">stateCSSDqURL</span><span class="op" id="3060486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060491">tCSSStr</span><span class="op" id="3060498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060501">stateCSSSqURL</span><span class="op" id="3060514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060519">tCSSStr</span><span class="op" id="3060526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060529">stateCSSURL</span><span class="op" id="3060540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060547">tCSSStr</span><span class="op" id="3060554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060557">stateCSSBlockCmt</span><span class="op" id="3060573">:</span>&nbsp;<span class="ident" id="3060575">tBlockCmt</span><span class="op" id="3060584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060587">stateCSSLineCmt</span><span class="op" id="3060602">:</span>&nbsp;&nbsp;<span class="ident" id="3060605">tLineCmt</span><span class="op" id="3060613">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060616">stateError</span><span class="op" id="3060626">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060634">tError</span><span class="op" id="3060640">,</span><br>
<span class="lineno"></span><span class="op" id="3060642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3060645">var</span>&nbsp;<span class="ident" id="3060649">commentStart</span>&nbsp;<span class="op" id="3060662">=</span>&nbsp;<span class="op" id="3060664">[</span><span class="op" id="3060665">]</span><span class="builtintype" id="3060666">byte</span><span class="op" id="3060670">(</span><span class="string" id="3060671">&#34;&lt;!--&#34;</span><span class="op" id="3060677">)</span><br>
<span class="lineno"></span><span class="keyword" id="3060679">var</span>&nbsp;<span class="ident" id="3060683">commentEnd</span>&nbsp;<span class="op" id="3060694">=</span>&nbsp;<span class="op" id="3060696">[</span><span class="op" id="3060697">]</span><span class="builtintype" id="3060698">byte</span><span class="op" id="3060702">(</span><span class="string" id="3060703">&#34;--&gt;&#34;</span><span class="op" id="3060708">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3060711">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3060775">func</span>&nbsp;<span class="ident" id="3060780">tText</span><span class="op" id="3060785">(</span><span class="ident" id="3060786">c</span>&nbsp;<span class="ident" id="3060788">context</span><span class="op" id="3060795">,</span>&nbsp;<span class="ident" id="3060797">s</span>&nbsp;<span class="op" id="3060799">[</span><span class="op" id="3060800">]</span><span class="builtintype" id="3060801">byte</span><span class="op" id="3060805">)</span>&nbsp;<span class="op" id="3060807">(</span><span class="ident" id="3060808">context</span><span class="op" id="3060815">,</span>&nbsp;<span class="builtintype" id="3060817">int</span><span class="op" id="3060820">)</span>&nbsp;<span class="op" id="3060822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060825">k</span>&nbsp;<span class="op" id="3060827">:=</span>&nbsp;<span class="num" id="3060830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3060833">for</span>&nbsp;<span class="op" id="3060837">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3060841">i</span>&nbsp;<span class="op" id="3060843">:=</span>&nbsp;<span class="ident" id="3060846">k</span>&nbsp;<span class="op" id="3060848">+</span>&nbsp;<span class="ident" id="3060850">bytes</span><span class="op" id="3060855">.</span><span class="ident" id="3060856">IndexByte</span><span class="op" id="3060865">(</span><span class="ident" id="3060866">s</span><span class="op" id="3060867">[</span><span class="ident" id="3060868">k</span><span class="op" id="3060869">:</span><span class="op" id="3060870">]</span><span class="op" id="3060871">,</span>&nbsp;<span class="string" id="3060873">&#39;&lt;&#39;</span><span class="op" id="3060876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3060880">if</span>&nbsp;<span class="ident" id="3060883">i</span>&nbsp;<span class="op" id="3060885">&lt;</span>&nbsp;<span class="ident" id="3060887">k</span>&nbsp;<span class="op" id="3060889">||</span>&nbsp;<span class="ident" id="3060892">i</span><span class="op" id="3060893">+</span><span class="num" id="3060894">1</span>&nbsp;<span class="op" id="3060896">==</span>&nbsp;<span class="builtinfunc" id="3060899">len</span><span class="op" id="3060902">(</span><span class="ident" id="3060903">s</span><span class="op" id="3060904">)</span>&nbsp;<span class="op" id="3060906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3060911">return</span>&nbsp;<span class="ident" id="3060918">c</span><span class="op" id="3060919">,</span>&nbsp;<span class="builtinfunc" id="3060921">len</span><span class="op" id="3060924">(</span><span class="ident" id="3060925">s</span><span class="op" id="3060926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3060930">}</span>&nbsp;<span class="keyword" id="3060932">else</span>&nbsp;<span class="keyword" id="3060937">if</span>&nbsp;<span class="ident" id="3060940">i</span><span class="op" id="3060941">+</span><span class="num" id="3060942">4</span>&nbsp;<span class="op" id="3060944">&lt;=</span>&nbsp;<span class="builtinfunc" id="3060947">len</span><span class="op" id="3060950">(</span><span class="ident" id="3060951">s</span><span class="op" id="3060952">)</span>&nbsp;<span class="op" id="3060954">&amp;&amp;</span>&nbsp;<span class="ident" id="3060957">bytes</span><span class="op" id="3060962">.</span><span class="ident" id="3060963">Equal</span><span class="op" id="3060968">(</span><span class="ident" id="3060969">commentStart</span><span class="op" id="3060981">,</span>&nbsp;<span class="ident" id="3060983">s</span><span class="op" id="3060984">[</span><span class="ident" id="3060985">i</span><span class="op" id="3060986">:</span><span class="ident" id="3060987">i</span><span class="op" id="3060988">+</span><span class="num" id="3060989">4</span><span class="op" id="3060990">]</span><span class="op" id="3060991">)</span>&nbsp;<span class="op" id="3060993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3060998">return</span>&nbsp;<span class="ident" id="3061005">context</span><span class="op" id="3061012">{</span><span class="ident" id="3061013">state</span><span class="op" id="3061018">:</span>&nbsp;<span class="ident" id="3061020">stateHTMLCmt</span><span class="op" id="3061032">}</span><span class="op" id="3061033">,</span>&nbsp;<span class="ident" id="3061035">i</span>&nbsp;<span class="op" id="3061037">+</span>&nbsp;<span class="num" id="3061039">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061047">i</span><span class="op" id="3061048">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061053">end</span>&nbsp;<span class="op" id="3061057">:=</span>&nbsp;<span class="builtintype" id="3061060">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061068">if</span>&nbsp;<span class="ident" id="3061071">s</span><span class="op" id="3061072">[</span><span class="ident" id="3061073">i</span><span class="op" id="3061074">]</span>&nbsp;<span class="op" id="3061076">==</span>&nbsp;<span class="string" id="3061079">&#39;/&#39;</span>&nbsp;<span class="op" id="3061083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061088">if</span>&nbsp;<span class="ident" id="3061091">i</span><span class="op" id="3061092">+</span><span class="num" id="3061093">1</span>&nbsp;<span class="op" id="3061095">==</span>&nbsp;<span class="builtinfunc" id="3061098">len</span><span class="op" id="3061101">(</span><span class="ident" id="3061102">s</span><span class="op" id="3061103">)</span>&nbsp;<span class="op" id="3061105">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061111">return</span>&nbsp;<span class="ident" id="3061118">c</span><span class="op" id="3061119">,</span>&nbsp;<span class="builtinfunc" id="3061121">len</span><span class="op" id="3061124">(</span><span class="ident" id="3061125">s</span><span class="op" id="3061126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061136">end</span><span class="op" id="3061139">,</span>&nbsp;<span class="ident" id="3061141">i</span>&nbsp;<span class="op" id="3061143">=</span>&nbsp;<span class="builtintype" id="3061145">true</span><span class="op" id="3061149">,</span>&nbsp;<span class="ident" id="3061151">i</span><span class="op" id="3061152">+</span><span class="num" id="3061153">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061161">j</span><span class="op" id="3061162">,</span>&nbsp;<span class="ident" id="3061164">e</span>&nbsp;<span class="op" id="3061166">:=</span>&nbsp;<span class="ident" id="3061169">eatTagName</span><span class="op" id="3061179">(</span><span class="ident" id="3061180">s</span><span class="op" id="3061181">,</span>&nbsp;<span class="ident" id="3061183">i</span><span class="op" id="3061184">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061188">if</span>&nbsp;<span class="ident" id="3061191">j</span>&nbsp;<span class="op" id="3061193">!=</span>&nbsp;<span class="ident" id="3061196">i</span>&nbsp;<span class="op" id="3061198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061203">if</span>&nbsp;<span class="ident" id="3061206">end</span>&nbsp;<span class="op" id="3061210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061216">e</span>&nbsp;<span class="op" id="3061218">=</span>&nbsp;<span class="ident" id="3061220">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3061240">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061271">return</span>&nbsp;<span class="ident" id="3061278">context</span><span class="op" id="3061285">{</span><span class="ident" id="3061286">state</span><span class="op" id="3061291">:</span>&nbsp;<span class="ident" id="3061293">stateTag</span><span class="op" id="3061301">,</span>&nbsp;<span class="ident" id="3061303">element</span><span class="op" id="3061310">:</span>&nbsp;<span class="ident" id="3061312">e</span><span class="op" id="3061313">}</span><span class="op" id="3061314">,</span>&nbsp;<span class="ident" id="3061316">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061324">k</span>&nbsp;<span class="op" id="3061326">=</span>&nbsp;<span class="ident" id="3061328">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061331">}</span><br>
<span class="lineno"></span><span class="op" id="3061333">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="3061336">var</span>&nbsp;<span class="ident" id="3061340">elementContentType</span>&nbsp;<span class="op" id="3061359">=</span>&nbsp;<span class="op" id="3061361">[</span><span class="op" id="3061362">...</span><span class="op" id="3061365">]</span><span class="ident" id="3061366">state</span><span class="op" id="3061371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061374">elementNone</span><span class="op" id="3061385">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061391">stateText</span><span class="op" id="3061400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061403">elementScript</span><span class="op" id="3061416">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3061420">stateJS</span><span class="op" id="3061427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061430">elementStyle</span><span class="op" id="3061442">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061447">stateCSS</span><span class="op" id="3061455">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061458">elementTextarea</span><span class="op" id="3061473">:</span>&nbsp;<span class="ident" id="3061475">stateRCDATA</span><span class="op" id="3061486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061489">elementTitle</span><span class="op" id="3061501">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061506">stateRCDATA</span><span class="op" id="3061517">,</span><br>
<span class="lineno"></span><span class="op" id="3061519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3061522">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="3061584">func</span>&nbsp;<span class="ident" id="3061589">tTag</span><span class="op" id="3061593">(</span><span class="ident" id="3061594">c</span>&nbsp;<span class="ident" id="3061596">context</span><span class="op" id="3061603">,</span>&nbsp;<span class="ident" id="3061605">s</span>&nbsp;<span class="op" id="3061607">[</span><span class="op" id="3061608">]</span><span class="builtintype" id="3061609">byte</span><span class="op" id="3061613">)</span>&nbsp;<span class="op" id="3061615">(</span><span class="ident" id="3061616">context</span><span class="op" id="3061623">,</span>&nbsp;<span class="builtintype" id="3061625">int</span><span class="op" id="3061628">)</span>&nbsp;<span class="op" id="3061630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3061633">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061662">i</span>&nbsp;<span class="op" id="3061664">:=</span>&nbsp;<span class="ident" id="3061667">eatWhiteSpace</span><span class="op" id="3061680">(</span><span class="ident" id="3061681">s</span><span class="op" id="3061682">,</span>&nbsp;<span class="num" id="3061684">0</span><span class="op" id="3061685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061688">if</span>&nbsp;<span class="ident" id="3061691">i</span>&nbsp;<span class="op" id="3061693">==</span>&nbsp;<span class="builtinfunc" id="3061696">len</span><span class="op" id="3061699">(</span><span class="ident" id="3061700">s</span><span class="op" id="3061701">)</span>&nbsp;<span class="op" id="3061703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061707">return</span>&nbsp;<span class="ident" id="3061714">c</span><span class="op" id="3061715">,</span>&nbsp;<span class="builtinfunc" id="3061717">len</span><span class="op" id="3061720">(</span><span class="ident" id="3061721">s</span><span class="op" id="3061722">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061728">if</span>&nbsp;<span class="ident" id="3061731">s</span><span class="op" id="3061732">[</span><span class="ident" id="3061733">i</span><span class="op" id="3061734">]</span>&nbsp;<span class="op" id="3061736">==</span>&nbsp;<span class="string" id="3061739">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="3061743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061747">return</span>&nbsp;<span class="ident" id="3061754">context</span><span class="op" id="3061761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061766">state</span><span class="op" id="3061771">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3061775">elementContentType</span><span class="op" id="3061793">[</span><span class="ident" id="3061794">c</span><span class="op" id="3061795">.</span><span class="ident" id="3061796">element</span><span class="op" id="3061803">]</span><span class="op" id="3061804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061809">element</span><span class="op" id="3061816">:</span>&nbsp;<span class="ident" id="3061818">c</span><span class="op" id="3061819">.</span><span class="ident" id="3061820">element</span><span class="op" id="3061827">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061831">}</span><span class="op" id="3061832">,</span>&nbsp;<span class="ident" id="3061834">i</span>&nbsp;<span class="op" id="3061836">+</span>&nbsp;<span class="num" id="3061838">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061844">j</span><span class="op" id="3061845">,</span>&nbsp;<span class="ident" id="3061847">err</span>&nbsp;<span class="op" id="3061851">:=</span>&nbsp;<span class="ident" id="3061854">eatAttrName</span><span class="op" id="3061865">(</span><span class="ident" id="3061866">s</span><span class="op" id="3061867">,</span>&nbsp;<span class="ident" id="3061869">i</span><span class="op" id="3061870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061873">if</span>&nbsp;<span class="ident" id="3061876">err</span>&nbsp;<span class="op" id="3061880">!=</span>&nbsp;<span class="builtintype" id="3061883">nil</span>&nbsp;<span class="op" id="3061887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061891">return</span>&nbsp;<span class="ident" id="3061898">context</span><span class="op" id="3061905">{</span><span class="ident" id="3061906">state</span><span class="op" id="3061911">:</span>&nbsp;<span class="ident" id="3061913">stateError</span><span class="op" id="3061923">,</span>&nbsp;<span class="ident" id="3061925">err</span><span class="op" id="3061928">:</span>&nbsp;<span class="ident" id="3061930">err</span><span class="op" id="3061933">}</span><span class="op" id="3061934">,</span>&nbsp;<span class="builtinfunc" id="3061936">len</span><span class="op" id="3061939">(</span><span class="ident" id="3061940">s</span><span class="op" id="3061941">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3061944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3061947">state</span><span class="op" id="3061952">,</span>&nbsp;<span class="ident" id="3061954">attr</span>&nbsp;<span class="op" id="3061959">:=</span>&nbsp;<span class="ident" id="3061962">stateTag</span><span class="op" id="3061970">,</span>&nbsp;<span class="ident" id="3061972">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061982">if</span>&nbsp;<span class="ident" id="3061985">i</span>&nbsp;<span class="op" id="3061987">==</span>&nbsp;<span class="ident" id="3061990">j</span>&nbsp;<span class="op" id="3061992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3061996">return</span>&nbsp;<span class="ident" id="3062003">context</span><span class="op" id="3062010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062015">state</span><span class="op" id="3062020">:</span>&nbsp;<span class="ident" id="3062022">stateError</span><span class="op" id="3062032">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062037">err</span><span class="op" id="3062040">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3062044">errorf</span><span class="op" id="3062050">(</span><span class="ident" id="3062051">ErrBadHTML</span><span class="op" id="3062061">,</span>&nbsp;<span class="builtintype" id="3062063">nil</span><span class="op" id="3062066">,</span>&nbsp;<span class="num" id="3062068">0</span><span class="op" id="3062069">,</span>&nbsp;<span class="string" id="3062071">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="3062125">,</span>&nbsp;<span class="ident" id="3062127">s</span><span class="op" id="3062128">[</span><span class="ident" id="3062129">i</span><span class="op" id="3062130">:</span><span class="op" id="3062131">]</span><span class="op" id="3062132">)</span><span class="op" id="3062133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062137">}</span><span class="op" id="3062138">,</span>&nbsp;<span class="builtinfunc" id="3062140">len</span><span class="op" id="3062143">(</span><span class="ident" id="3062144">s</span><span class="op" id="3062145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062151">switch</span>&nbsp;<span class="ident" id="3062158">attrType</span><span class="op" id="3062166">(</span><span class="builtintype" id="3062167">string</span><span class="op" id="3062173">(</span><span class="ident" id="3062174">s</span><span class="op" id="3062175">[</span><span class="ident" id="3062176">i</span><span class="op" id="3062177">:</span><span class="ident" id="3062178">j</span><span class="op" id="3062179">]</span><span class="op" id="3062180">)</span><span class="op" id="3062181">)</span>&nbsp;<span class="op" id="3062183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062186">case</span>&nbsp;<span class="ident" id="3062191">contentTypeURL</span><span class="op" id="3062205">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062209">attr</span>&nbsp;<span class="op" id="3062214">=</span>&nbsp;<span class="ident" id="3062216">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062225">case</span>&nbsp;<span class="ident" id="3062230">contentTypeCSS</span><span class="op" id="3062244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062248">attr</span>&nbsp;<span class="op" id="3062253">=</span>&nbsp;<span class="ident" id="3062255">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062266">case</span>&nbsp;<span class="ident" id="3062271">contentTypeJS</span><span class="op" id="3062284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062288">attr</span>&nbsp;<span class="op" id="3062293">=</span>&nbsp;<span class="ident" id="3062295">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062310">if</span>&nbsp;<span class="ident" id="3062313">j</span>&nbsp;<span class="op" id="3062315">==</span>&nbsp;<span class="builtinfunc" id="3062318">len</span><span class="op" id="3062321">(</span><span class="ident" id="3062322">s</span><span class="op" id="3062323">)</span>&nbsp;<span class="op" id="3062325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062329">state</span>&nbsp;<span class="op" id="3062335">=</span>&nbsp;<span class="ident" id="3062337">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062352">}</span>&nbsp;<span class="keyword" id="3062354">else</span>&nbsp;<span class="op" id="3062359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062363">state</span>&nbsp;<span class="op" id="3062369">=</span>&nbsp;<span class="ident" id="3062371">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062390">return</span>&nbsp;<span class="ident" id="3062397">context</span><span class="op" id="3062404">{</span><span class="ident" id="3062405">state</span><span class="op" id="3062410">:</span>&nbsp;<span class="ident" id="3062412">state</span><span class="op" id="3062417">,</span>&nbsp;<span class="ident" id="3062419">element</span><span class="op" id="3062426">:</span>&nbsp;<span class="ident" id="3062428">c</span><span class="op" id="3062429">.</span><span class="ident" id="3062430">element</span><span class="op" id="3062437">,</span>&nbsp;<span class="ident" id="3062439">attr</span><span class="op" id="3062443">:</span>&nbsp;<span class="ident" id="3062445">attr</span><span class="op" id="3062449">}</span><span class="op" id="3062450">,</span>&nbsp;<span class="ident" id="3062452">j</span><br>
<span class="lineno"></span><span class="op" id="3062454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3062457">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="3062524">func</span>&nbsp;<span class="ident" id="3062529">tAttrName</span><span class="op" id="3062538">(</span><span class="ident" id="3062539">c</span>&nbsp;<span class="ident" id="3062541">context</span><span class="op" id="3062548">,</span>&nbsp;<span class="ident" id="3062550">s</span>&nbsp;<span class="op" id="3062552">[</span><span class="op" id="3062553">]</span><span class="builtintype" id="3062554">byte</span><span class="op" id="3062558">)</span>&nbsp;<span class="op" id="3062560">(</span><span class="ident" id="3062561">context</span><span class="op" id="3062568">,</span>&nbsp;<span class="builtintype" id="3062570">int</span><span class="op" id="3062573">)</span>&nbsp;<span class="op" id="3062575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062578">i</span><span class="op" id="3062579">,</span>&nbsp;<span class="ident" id="3062581">err</span>&nbsp;<span class="op" id="3062585">:=</span>&nbsp;<span class="ident" id="3062588">eatAttrName</span><span class="op" id="3062599">(</span><span class="ident" id="3062600">s</span><span class="op" id="3062601">,</span>&nbsp;<span class="num" id="3062603">0</span><span class="op" id="3062604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062607">if</span>&nbsp;<span class="ident" id="3062610">err</span>&nbsp;<span class="op" id="3062614">!=</span>&nbsp;<span class="builtintype" id="3062617">nil</span>&nbsp;<span class="op" id="3062621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062625">return</span>&nbsp;<span class="ident" id="3062632">context</span><span class="op" id="3062639">{</span><span class="ident" id="3062640">state</span><span class="op" id="3062645">:</span>&nbsp;<span class="ident" id="3062647">stateError</span><span class="op" id="3062657">,</span>&nbsp;<span class="ident" id="3062659">err</span><span class="op" id="3062662">:</span>&nbsp;<span class="ident" id="3062664">err</span><span class="op" id="3062667">}</span><span class="op" id="3062668">,</span>&nbsp;<span class="builtinfunc" id="3062670">len</span><span class="op" id="3062673">(</span><span class="ident" id="3062674">s</span><span class="op" id="3062675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062678">}</span>&nbsp;<span class="keyword" id="3062680">else</span>&nbsp;<span class="keyword" id="3062685">if</span>&nbsp;<span class="ident" id="3062688">i</span>&nbsp;<span class="op" id="3062690">!=</span>&nbsp;<span class="builtinfunc" id="3062693">len</span><span class="op" id="3062696">(</span><span class="ident" id="3062697">s</span><span class="op" id="3062698">)</span>&nbsp;<span class="op" id="3062700">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062704">c</span><span class="op" id="3062705">.</span><span class="ident" id="3062706">state</span>&nbsp;<span class="op" id="3062712">=</span>&nbsp;<span class="ident" id="3062714">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062733">return</span>&nbsp;<span class="ident" id="3062740">c</span><span class="op" id="3062741">,</span>&nbsp;<span class="ident" id="3062743">i</span><br>
<span class="lineno"></span><span class="op" id="3062745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="3062748">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="3062817">func</span>&nbsp;<span class="ident" id="3062822">tAfterName</span><span class="op" id="3062832">(</span><span class="ident" id="3062833">c</span>&nbsp;<span class="ident" id="3062835">context</span><span class="op" id="3062842">,</span>&nbsp;<span class="ident" id="3062844">s</span>&nbsp;<span class="op" id="3062846">[</span><span class="op" id="3062847">]</span><span class="builtintype" id="3062848">byte</span><span class="op" id="3062852">)</span>&nbsp;<span class="op" id="3062854">(</span><span class="ident" id="3062855">context</span><span class="op" id="3062862">,</span>&nbsp;<span class="builtintype" id="3062864">int</span><span class="op" id="3062867">)</span>&nbsp;<span class="op" id="3062869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3062872">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3062909">i</span>&nbsp;<span class="op" id="3062911">:=</span>&nbsp;<span class="ident" id="3062914">eatWhiteSpace</span><span class="op" id="3062927">(</span><span class="ident" id="3062928">s</span><span class="op" id="3062929">,</span>&nbsp;<span class="num" id="3062931">0</span><span class="op" id="3062932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062935">if</span>&nbsp;<span class="ident" id="3062938">i</span>&nbsp;<span class="op" id="3062940">==</span>&nbsp;<span class="builtinfunc" id="3062943">len</span><span class="op" id="3062946">(</span><span class="ident" id="3062947">s</span><span class="op" id="3062948">)</span>&nbsp;<span class="op" id="3062950">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3062954">return</span>&nbsp;<span class="ident" id="3062961">c</span><span class="op" id="3062962">,</span>&nbsp;<span class="builtinfunc" id="3062964">len</span><span class="op" id="3062967">(</span><span class="ident" id="3062968">s</span><span class="op" id="3062969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3062972">}</span>&nbsp;<span class="keyword" id="3062974">else</span>&nbsp;<span class="keyword" id="3062979">if</span>&nbsp;<span class="ident" id="3062982">s</span><span class="op" id="3062983">[</span><span class="ident" id="3062984">i</span><span class="op" id="3062985">]</span>&nbsp;<span class="op" id="3062987">!=</span>&nbsp;<span class="string" id="3062990">&#39;=&#39;</span>&nbsp;<span class="op" id="3062994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3062998">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063058">c</span><span class="op" id="3063059">.</span><span class="ident" id="3063060">state</span>&nbsp;<span class="op" id="3063066">=</span>&nbsp;<span class="ident" id="3063068">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063079">return</span>&nbsp;<span class="ident" id="3063086">c</span><span class="op" id="3063087">,</span>&nbsp;<span class="ident" id="3063089">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3063092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063095">c</span><span class="op" id="3063096">.</span><span class="ident" id="3063097">state</span>&nbsp;<span class="op" id="3063103">=</span>&nbsp;<span class="ident" id="3063105">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3063123">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063144">return</span>&nbsp;<span class="ident" id="3063151">c</span><span class="op" id="3063152">,</span>&nbsp;<span class="ident" id="3063154">i</span>&nbsp;<span class="op" id="3063156">+</span>&nbsp;<span class="num" id="3063158">1</span><br>
<span class="lineno"></span><span class="op" id="3063160">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="3063163">var</span>&nbsp;<span class="ident" id="3063167">attrStartStates</span>&nbsp;<span class="op" id="3063183">=</span>&nbsp;<span class="op" id="3063185">[</span><span class="op" id="3063186">...</span><span class="op" id="3063189">]</span><span class="ident" id="3063190">state</span><span class="op" id="3063195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063198">attrNone</span><span class="op" id="3063206">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3063210">stateAttr</span><span class="op" id="3063219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063222">attrScript</span><span class="op" id="3063232">:</span>&nbsp;<span class="ident" id="3063234">stateJS</span><span class="op" id="3063241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063244">attrStyle</span><span class="op" id="3063253">:</span>&nbsp;&nbsp;<span class="ident" id="3063256">stateCSS</span><span class="op" id="3063264">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063267">attrURL</span><span class="op" id="3063274">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063279">stateURL</span><span class="op" id="3063287">,</span><br>
<span class="lineno"></span><span class="op" id="3063289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063292">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="3063365">func</span>&nbsp;<span class="ident" id="3063370">tBeforeValue</span><span class="op" id="3063382">(</span><span class="ident" id="3063383">c</span>&nbsp;<span class="ident" id="3063385">context</span><span class="op" id="3063392">,</span>&nbsp;<span class="ident" id="3063394">s</span>&nbsp;<span class="op" id="3063396">[</span><span class="op" id="3063397">]</span><span class="builtintype" id="3063398">byte</span><span class="op" id="3063402">)</span>&nbsp;<span class="op" id="3063404">(</span><span class="ident" id="3063405">context</span><span class="op" id="3063412">,</span>&nbsp;<span class="builtintype" id="3063414">int</span><span class="op" id="3063417">)</span>&nbsp;<span class="op" id="3063419">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063422">i</span>&nbsp;<span class="op" id="3063424">:=</span>&nbsp;<span class="ident" id="3063427">eatWhiteSpace</span><span class="op" id="3063440">(</span><span class="ident" id="3063441">s</span><span class="op" id="3063442">,</span>&nbsp;<span class="num" id="3063444">0</span><span class="op" id="3063445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063448">if</span>&nbsp;<span class="ident" id="3063451">i</span>&nbsp;<span class="op" id="3063453">==</span>&nbsp;<span class="builtinfunc" id="3063456">len</span><span class="op" id="3063459">(</span><span class="ident" id="3063460">s</span><span class="op" id="3063461">)</span>&nbsp;<span class="op" id="3063463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063467">return</span>&nbsp;<span class="ident" id="3063474">c</span><span class="op" id="3063475">,</span>&nbsp;<span class="builtinfunc" id="3063477">len</span><span class="op" id="3063480">(</span><span class="ident" id="3063481">s</span><span class="op" id="3063482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3063485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3063488">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063522">delim</span>&nbsp;<span class="op" id="3063528">:=</span>&nbsp;<span class="ident" id="3063531">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063551">switch</span>&nbsp;<span class="ident" id="3063558">s</span><span class="op" id="3063559">[</span><span class="ident" id="3063560">i</span><span class="op" id="3063561">]</span>&nbsp;<span class="op" id="3063563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063566">case</span>&nbsp;<span class="string" id="3063571">&#39;\&#39;&#39;</span><span class="op" id="3063575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063579">delim</span><span class="op" id="3063584">,</span>&nbsp;<span class="ident" id="3063586">i</span>&nbsp;<span class="op" id="3063588">=</span>&nbsp;<span class="ident" id="3063590">delimSingleQuote</span><span class="op" id="3063606">,</span>&nbsp;<span class="ident" id="3063608">i</span><span class="op" id="3063609">+</span><span class="num" id="3063610">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063613">case</span>&nbsp;<span class="string" id="3063618">&#39;&#34;&#39;</span><span class="op" id="3063621">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063625">delim</span><span class="op" id="3063630">,</span>&nbsp;<span class="ident" id="3063632">i</span>&nbsp;<span class="op" id="3063634">=</span>&nbsp;<span class="ident" id="3063636">delimDoubleQuote</span><span class="op" id="3063652">,</span>&nbsp;<span class="ident" id="3063654">i</span><span class="op" id="3063655">+</span><span class="num" id="3063656">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3063659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3063662">c</span><span class="op" id="3063663">.</span><span class="ident" id="3063664">state</span><span class="op" id="3063669">,</span>&nbsp;<span class="ident" id="3063671">c</span><span class="op" id="3063672">.</span><span class="ident" id="3063673">delim</span><span class="op" id="3063678">,</span>&nbsp;<span class="ident" id="3063680">c</span><span class="op" id="3063681">.</span><span class="ident" id="3063682">attr</span>&nbsp;<span class="op" id="3063687">=</span>&nbsp;<span class="ident" id="3063689">attrStartStates</span><span class="op" id="3063704">[</span><span class="ident" id="3063705">c</span><span class="op" id="3063706">.</span><span class="ident" id="3063707">attr</span><span class="op" id="3063711">]</span><span class="op" id="3063712">,</span>&nbsp;<span class="ident" id="3063714">delim</span><span class="op" id="3063719">,</span>&nbsp;<span class="ident" id="3063721">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063731">return</span>&nbsp;<span class="ident" id="3063738">c</span><span class="op" id="3063739">,</span>&nbsp;<span class="ident" id="3063741">i</span><br>
<span class="lineno"></span><span class="op" id="3063743">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3063746">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="3063811">func</span>&nbsp;<span class="ident" id="3063816">tHTMLCmt</span><span class="op" id="3063824">(</span><span class="ident" id="3063825">c</span>&nbsp;<span class="ident" id="3063827">context</span><span class="op" id="3063834">,</span>&nbsp;<span class="ident" id="3063836">s</span>&nbsp;<span class="op" id="3063838">[</span><span class="op" id="3063839">]</span><span class="builtintype" id="3063840">byte</span><span class="op" id="3063844">)</span>&nbsp;<span class="op" id="3063846">(</span><span class="ident" id="3063847">context</span><span class="op" id="3063854">,</span>&nbsp;<span class="builtintype" id="3063856">int</span><span class="op" id="3063859">)</span>&nbsp;<span class="op" id="3063861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063864">if</span>&nbsp;<span class="ident" id="3063867">i</span>&nbsp;<span class="op" id="3063869">:=</span>&nbsp;<span class="ident" id="3063872">bytes</span><span class="op" id="3063877">.</span><span class="ident" id="3063878">Index</span><span class="op" id="3063883">(</span><span class="ident" id="3063884">s</span><span class="op" id="3063885">,</span>&nbsp;<span class="ident" id="3063887">commentEnd</span><span class="op" id="3063897">)</span><span class="op" id="3063898">;</span>&nbsp;<span class="ident" id="3063900">i</span>&nbsp;<span class="op" id="3063902">!=</span>&nbsp;<span class="op" id="3063905">-</span><span class="num" id="3063906">1</span>&nbsp;<span class="op" id="3063908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063912">return</span>&nbsp;<span class="ident" id="3063919">context</span><span class="op" id="3063926">{</span><span class="op" id="3063927">}</span><span class="op" id="3063928">,</span>&nbsp;<span class="ident" id="3063930">i</span>&nbsp;<span class="op" id="3063932">+</span>&nbsp;<span class="num" id="3063934">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3063937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3063940">return</span>&nbsp;<span class="ident" id="3063947">c</span><span class="op" id="3063948">,</span>&nbsp;<span class="builtinfunc" id="3063950">len</span><span class="op" id="3063953">(</span><span class="ident" id="3063954">s</span><span class="op" id="3063955">)</span><br>
<span class="lineno"></span><span class="op" id="3063957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3063960">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="3064034">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="3064097">var</span>&nbsp;<span class="ident" id="3064101">specialTagEndMarkers</span>&nbsp;<span class="op" id="3064122">=</span>&nbsp;<span class="op" id="3064124">[</span><span class="op" id="3064125">...</span><span class="op" id="3064128">]</span><span class="builtintype" id="3064129">string</span><span class="op" id="3064135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064138">elementScript</span><span class="op" id="3064151">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3064155">&#34;&lt;/script&#34;</span><span class="op" id="3064165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064168">elementStyle</span><span class="op" id="3064180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3064185">&#34;&lt;/style&#34;</span><span class="op" id="3064194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064197">elementTextarea</span><span class="op" id="3064212">:</span>&nbsp;<span class="string" id="3064214">&#34;&lt;/textarea&#34;</span><span class="op" id="3064226">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064229">elementTitle</span><span class="op" id="3064241">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3064246">&#34;&lt;/title&#34;</span><span class="op" id="3064255">,</span><br>
<span class="lineno"></span><span class="op" id="3064257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3064260">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="3064337">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="3064356">func</span>&nbsp;<span class="ident" id="3064361">tSpecialTagEnd</span><span class="op" id="3064375">(</span><span class="ident" id="3064376">c</span>&nbsp;<span class="ident" id="3064378">context</span><span class="op" id="3064385">,</span>&nbsp;<span class="ident" id="3064387">s</span>&nbsp;<span class="op" id="3064389">[</span><span class="op" id="3064390">]</span><span class="builtintype" id="3064391">byte</span><span class="op" id="3064395">)</span>&nbsp;<span class="op" id="3064397">(</span><span class="ident" id="3064398">context</span><span class="op" id="3064405">,</span>&nbsp;<span class="builtintype" id="3064407">int</span><span class="op" id="3064410">)</span>&nbsp;<span class="op" id="3064412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064415">if</span>&nbsp;<span class="ident" id="3064418">c</span><span class="op" id="3064419">.</span><span class="ident" id="3064420">element</span>&nbsp;<span class="op" id="3064428">!=</span>&nbsp;<span class="ident" id="3064431">elementNone</span>&nbsp;<span class="op" id="3064443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064447">if</span>&nbsp;<span class="ident" id="3064450">i</span>&nbsp;<span class="op" id="3064452">:=</span>&nbsp;<span class="ident" id="3064455">strings</span><span class="op" id="3064462">.</span><span class="ident" id="3064463">Index</span><span class="op" id="3064468">(</span><span class="ident" id="3064469">strings</span><span class="op" id="3064476">.</span><span class="ident" id="3064477">ToLower</span><span class="op" id="3064484">(</span><span class="builtintype" id="3064485">string</span><span class="op" id="3064491">(</span><span class="ident" id="3064492">s</span><span class="op" id="3064493">)</span><span class="op" id="3064494">)</span><span class="op" id="3064495">,</span>&nbsp;<span class="ident" id="3064497">specialTagEndMarkers</span><span class="op" id="3064517">[</span><span class="ident" id="3064518">c</span><span class="op" id="3064519">.</span><span class="ident" id="3064520">element</span><span class="op" id="3064527">]</span><span class="op" id="3064528">)</span><span class="op" id="3064529">;</span>&nbsp;<span class="ident" id="3064531">i</span>&nbsp;<span class="op" id="3064533">!=</span>&nbsp;<span class="op" id="3064536">-</span><span class="num" id="3064537">1</span>&nbsp;<span class="op" id="3064539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064544">return</span>&nbsp;<span class="ident" id="3064551">context</span><span class="op" id="3064558">{</span><span class="op" id="3064559">}</span><span class="op" id="3064560">,</span>&nbsp;<span class="ident" id="3064562">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064566">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064572">return</span>&nbsp;<span class="ident" id="3064579">c</span><span class="op" id="3064580">,</span>&nbsp;<span class="builtinfunc" id="3064582">len</span><span class="op" id="3064585">(</span><span class="ident" id="3064586">s</span><span class="op" id="3064587">)</span><br>
<span class="lineno"></span><span class="op" id="3064589">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3064592">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="3064661">func</span>&nbsp;<span class="ident" id="3064666">tAttr</span><span class="op" id="3064671">(</span><span class="ident" id="3064672">c</span>&nbsp;<span class="ident" id="3064674">context</span><span class="op" id="3064681">,</span>&nbsp;<span class="ident" id="3064683">s</span>&nbsp;<span class="op" id="3064685">[</span><span class="op" id="3064686">]</span><span class="builtintype" id="3064687">byte</span><span class="op" id="3064691">)</span>&nbsp;<span class="op" id="3064693">(</span><span class="ident" id="3064694">context</span><span class="op" id="3064701">,</span>&nbsp;<span class="builtintype" id="3064703">int</span><span class="op" id="3064706">)</span>&nbsp;<span class="op" id="3064708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064711">return</span>&nbsp;<span class="ident" id="3064718">c</span><span class="op" id="3064719">,</span>&nbsp;<span class="builtinfunc" id="3064721">len</span><span class="op" id="3064724">(</span><span class="ident" id="3064725">s</span><span class="op" id="3064726">)</span><br>
<span class="lineno"></span><span class="op" id="3064728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3064731">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="3064793">func</span>&nbsp;<span class="ident" id="3064798">tURL</span><span class="op" id="3064802">(</span><span class="ident" id="3064803">c</span>&nbsp;<span class="ident" id="3064805">context</span><span class="op" id="3064812">,</span>&nbsp;<span class="ident" id="3064814">s</span>&nbsp;<span class="op" id="3064816">[</span><span class="op" id="3064817">]</span><span class="builtintype" id="3064818">byte</span><span class="op" id="3064822">)</span>&nbsp;<span class="op" id="3064824">(</span><span class="ident" id="3064825">context</span><span class="op" id="3064832">,</span>&nbsp;<span class="builtintype" id="3064834">int</span><span class="op" id="3064837">)</span>&nbsp;<span class="op" id="3064839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3064842">if</span>&nbsp;<span class="ident" id="3064845">bytes</span><span class="op" id="3064850">.</span><span class="ident" id="3064851">IndexAny</span><span class="op" id="3064859">(</span><span class="ident" id="3064860">s</span><span class="op" id="3064861">,</span>&nbsp;<span class="string" id="3064863">&#34;#?&#34;</span><span class="op" id="3064867">)</span>&nbsp;<span class="op" id="3064869">&gt;=</span>&nbsp;<span class="num" id="3064872">0</span>&nbsp;<span class="op" id="3064874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3064878">c</span><span class="op" id="3064879">.</span><span class="ident" id="3064880">urlPart</span>&nbsp;<span class="op" id="3064888">=</span>&nbsp;<span class="ident" id="3064890">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3064910">}</span>&nbsp;<span class="keyword" id="3064912">else</span>&nbsp;<span class="keyword" id="3064917">if</span>&nbsp;<span class="builtinfunc" id="3064920">len</span><span class="op" id="3064923">(</span><span class="ident" id="3064924">s</span><span class="op" id="3064925">)</span>&nbsp;<span class="op" id="3064927">!=</span>&nbsp;<span class="ident" id="3064930">eatWhiteSpace</span><span class="op" id="3064943">(</span><span class="ident" id="3064944">s</span><span class="op" id="3064945">,</span>&nbsp;<span class="num" id="3064947">0</span><span class="op" id="3064948">)</span>&nbsp;<span class="op" id="3064950">&amp;&amp;</span>&nbsp;<span class="ident" id="3064953">c</span><span class="op" id="3064954">.</span><span class="ident" id="3064955">urlPart</span>&nbsp;<span class="op" id="3064963">==</span>&nbsp;<span class="ident" id="3064966">urlPartNone</span>&nbsp;<span class="op" id="3064978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3064982">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065047">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065110">c</span><span class="op" id="3065111">.</span><span class="ident" id="3065112">urlPart</span>&nbsp;<span class="op" id="3065120">=</span>&nbsp;<span class="ident" id="3065122">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3065139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065142">return</span>&nbsp;<span class="ident" id="3065149">c</span><span class="op" id="3065150">,</span>&nbsp;<span class="builtinfunc" id="3065152">len</span><span class="op" id="3065155">(</span><span class="ident" id="3065156">s</span><span class="op" id="3065157">)</span><br>
<span class="lineno"></span><span class="op" id="3065159">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3065162">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3065222">func</span>&nbsp;<span class="ident" id="3065227">tJS</span><span class="op" id="3065230">(</span><span class="ident" id="3065231">c</span>&nbsp;<span class="ident" id="3065233">context</span><span class="op" id="3065240">,</span>&nbsp;<span class="ident" id="3065242">s</span>&nbsp;<span class="op" id="3065244">[</span><span class="op" id="3065245">]</span><span class="builtintype" id="3065246">byte</span><span class="op" id="3065250">)</span>&nbsp;<span class="op" id="3065252">(</span><span class="ident" id="3065253">context</span><span class="op" id="3065260">,</span>&nbsp;<span class="builtintype" id="3065262">int</span><span class="op" id="3065265">)</span>&nbsp;<span class="op" id="3065267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065270">i</span>&nbsp;<span class="op" id="3065272">:=</span>&nbsp;<span class="ident" id="3065275">bytes</span><span class="op" id="3065280">.</span><span class="ident" id="3065281">IndexAny</span><span class="op" id="3065289">(</span><span class="ident" id="3065290">s</span><span class="op" id="3065291">,</span>&nbsp;<span class="string" id="3065293">`&#34;&#39;/`</span><span class="op" id="3065298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065301">if</span>&nbsp;<span class="ident" id="3065304">i</span>&nbsp;<span class="op" id="3065306">==</span>&nbsp;<span class="op" id="3065309">-</span><span class="num" id="3065310">1</span>&nbsp;<span class="op" id="3065312">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3065316">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065373">c</span><span class="op" id="3065374">.</span><span class="ident" id="3065375">jsCtx</span>&nbsp;<span class="op" id="3065381">=</span>&nbsp;<span class="ident" id="3065383">nextJSCtx</span><span class="op" id="3065392">(</span><span class="ident" id="3065393">s</span><span class="op" id="3065394">,</span>&nbsp;<span class="ident" id="3065396">c</span><span class="op" id="3065397">.</span><span class="ident" id="3065398">jsCtx</span><span class="op" id="3065403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065407">return</span>&nbsp;<span class="ident" id="3065414">c</span><span class="op" id="3065415">,</span>&nbsp;<span class="builtinfunc" id="3065417">len</span><span class="op" id="3065420">(</span><span class="ident" id="3065421">s</span><span class="op" id="3065422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3065425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065428">c</span><span class="op" id="3065429">.</span><span class="ident" id="3065430">jsCtx</span>&nbsp;<span class="op" id="3065436">=</span>&nbsp;<span class="ident" id="3065438">nextJSCtx</span><span class="op" id="3065447">(</span><span class="ident" id="3065448">s</span><span class="op" id="3065449">[</span><span class="op" id="3065450">:</span><span class="ident" id="3065451">i</span><span class="op" id="3065452">]</span><span class="op" id="3065453">,</span>&nbsp;<span class="ident" id="3065455">c</span><span class="op" id="3065456">.</span><span class="ident" id="3065457">jsCtx</span><span class="op" id="3065462">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065465">switch</span>&nbsp;<span class="ident" id="3065472">s</span><span class="op" id="3065473">[</span><span class="ident" id="3065474">i</span><span class="op" id="3065475">]</span>&nbsp;<span class="op" id="3065477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065480">case</span>&nbsp;<span class="string" id="3065485">&#39;&#34;&#39;</span><span class="op" id="3065488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065492">c</span><span class="op" id="3065493">.</span><span class="ident" id="3065494">state</span><span class="op" id="3065499">,</span>&nbsp;<span class="ident" id="3065501">c</span><span class="op" id="3065502">.</span><span class="ident" id="3065503">jsCtx</span>&nbsp;<span class="op" id="3065509">=</span>&nbsp;<span class="ident" id="3065511">stateJSDqStr</span><span class="op" id="3065523">,</span>&nbsp;<span class="ident" id="3065525">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065538">case</span>&nbsp;<span class="string" id="3065543">&#39;\&#39;&#39;</span><span class="op" id="3065547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065551">c</span><span class="op" id="3065552">.</span><span class="ident" id="3065553">state</span><span class="op" id="3065558">,</span>&nbsp;<span class="ident" id="3065560">c</span><span class="op" id="3065561">.</span><span class="ident" id="3065562">jsCtx</span>&nbsp;<span class="op" id="3065568">=</span>&nbsp;<span class="ident" id="3065570">stateJSSqStr</span><span class="op" id="3065582">,</span>&nbsp;<span class="ident" id="3065584">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065597">case</span>&nbsp;<span class="string" id="3065602">&#39;/&#39;</span><span class="op" id="3065605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065609">switch</span>&nbsp;<span class="op" id="3065616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065620">case</span>&nbsp;<span class="ident" id="3065625">i</span><span class="op" id="3065626">+</span><span class="num" id="3065627">1</span>&nbsp;<span class="op" id="3065629">&lt;</span>&nbsp;<span class="builtinfunc" id="3065631">len</span><span class="op" id="3065634">(</span><span class="ident" id="3065635">s</span><span class="op" id="3065636">)</span>&nbsp;<span class="op" id="3065638">&amp;&amp;</span>&nbsp;<span class="ident" id="3065641">s</span><span class="op" id="3065642">[</span><span class="ident" id="3065643">i</span><span class="op" id="3065644">+</span><span class="num" id="3065645">1</span><span class="op" id="3065646">]</span>&nbsp;<span class="op" id="3065648">==</span>&nbsp;<span class="string" id="3065651">&#39;/&#39;</span><span class="op" id="3065654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065659">c</span><span class="op" id="3065660">.</span><span class="ident" id="3065661">state</span><span class="op" id="3065666">,</span>&nbsp;<span class="ident" id="3065668">i</span>&nbsp;<span class="op" id="3065670">=</span>&nbsp;<span class="ident" id="3065672">stateJSLineCmt</span><span class="op" id="3065686">,</span>&nbsp;<span class="ident" id="3065688">i</span><span class="op" id="3065689">+</span><span class="num" id="3065690">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065694">case</span>&nbsp;<span class="ident" id="3065699">i</span><span class="op" id="3065700">+</span><span class="num" id="3065701">1</span>&nbsp;<span class="op" id="3065703">&lt;</span>&nbsp;<span class="builtinfunc" id="3065705">len</span><span class="op" id="3065708">(</span><span class="ident" id="3065709">s</span><span class="op" id="3065710">)</span>&nbsp;<span class="op" id="3065712">&amp;&amp;</span>&nbsp;<span class="ident" id="3065715">s</span><span class="op" id="3065716">[</span><span class="ident" id="3065717">i</span><span class="op" id="3065718">+</span><span class="num" id="3065719">1</span><span class="op" id="3065720">]</span>&nbsp;<span class="op" id="3065722">==</span>&nbsp;<span class="string" id="3065725">&#39;*&#39;</span><span class="op" id="3065728">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065733">c</span><span class="op" id="3065734">.</span><span class="ident" id="3065735">state</span><span class="op" id="3065740">,</span>&nbsp;<span class="ident" id="3065742">i</span>&nbsp;<span class="op" id="3065744">=</span>&nbsp;<span class="ident" id="3065746">stateJSBlockCmt</span><span class="op" id="3065761">,</span>&nbsp;<span class="ident" id="3065763">i</span><span class="op" id="3065764">+</span><span class="num" id="3065765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065769">case</span>&nbsp;<span class="ident" id="3065774">c</span><span class="op" id="3065775">.</span><span class="ident" id="3065776">jsCtx</span>&nbsp;<span class="op" id="3065782">==</span>&nbsp;<span class="ident" id="3065785">jsCtxRegexp</span><span class="op" id="3065796">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065801">c</span><span class="op" id="3065802">.</span><span class="ident" id="3065803">state</span>&nbsp;<span class="op" id="3065809">=</span>&nbsp;<span class="ident" id="3065811">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065827">case</span>&nbsp;<span class="ident" id="3065832">c</span><span class="op" id="3065833">.</span><span class="ident" id="3065834">jsCtx</span>&nbsp;<span class="op" id="3065840">==</span>&nbsp;<span class="ident" id="3065843">jsCtxDivOp</span><span class="op" id="3065853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065858">c</span><span class="op" id="3065859">.</span><span class="ident" id="3065860">jsCtx</span>&nbsp;<span class="op" id="3065866">=</span>&nbsp;<span class="ident" id="3065868">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065882">default</span><span class="op" id="3065889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3065894">return</span>&nbsp;<span class="ident" id="3065901">context</span><span class="op" id="3065908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065914">state</span><span class="op" id="3065919">:</span>&nbsp;<span class="ident" id="3065921">stateError</span><span class="op" id="3065931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3065937">err</span><span class="op" id="3065940">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3065944">errorf</span><span class="op" id="3065950">(</span><span class="ident" id="3065951">ErrSlashAmbig</span><span class="op" id="3065964">,</span>&nbsp;<span class="builtintype" id="3065966">nil</span><span class="op" id="3065969">,</span>&nbsp;<span class="num" id="3065971">0</span><span class="op" id="3065972">,</span>&nbsp;<span class="string" id="3065974">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="3066019">,</span>&nbsp;<span class="ident" id="3066021">s</span><span class="op" id="3066022">[</span><span class="ident" id="3066023">i</span><span class="op" id="3066024">:</span><span class="op" id="3066025">]</span><span class="op" id="3066026">)</span><span class="op" id="3066027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066032">}</span><span class="op" id="3066033">,</span>&nbsp;<span class="builtinfunc" id="3066035">len</span><span class="op" id="3066038">(</span><span class="ident" id="3066039">s</span><span class="op" id="3066040">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066047">default</span><span class="op" id="3066054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3066058">panic</span><span class="op" id="3066063">(</span><span class="string" id="3066064">&#34;unreachable&#34;</span><span class="op" id="3066077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066083">return</span>&nbsp;<span class="ident" id="3066090">c</span><span class="op" id="3066091">,</span>&nbsp;<span class="ident" id="3066093">i</span>&nbsp;<span class="op" id="3066095">+</span>&nbsp;<span class="num" id="3066097">1</span><br>
<span class="lineno">255</span><span class="op" id="3066099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3066102">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="3066182">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="3066193">func</span>&nbsp;<span class="ident" id="3066198">tJSDelimited</span><span class="op" id="3066210">(</span><span class="ident" id="3066211">c</span>&nbsp;<span class="ident" id="3066213">context</span><span class="op" id="3066220">,</span>&nbsp;<span class="ident" id="3066222">s</span>&nbsp;<span class="op" id="3066224">[</span><span class="op" id="3066225">]</span><span class="builtintype" id="3066226">byte</span><span class="op" id="3066230">)</span>&nbsp;<span class="op" id="3066232">(</span><span class="ident" id="3066233">context</span><span class="op" id="3066240">,</span>&nbsp;<span class="builtintype" id="3066242">int</span><span class="op" id="3066245">)</span>&nbsp;<span class="op" id="3066247">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066250">specials</span>&nbsp;<span class="op" id="3066259">:=</span>&nbsp;<span class="string" id="3066262">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066268">switch</span>&nbsp;<span class="ident" id="3066275">c</span><span class="op" id="3066276">.</span><span class="ident" id="3066277">state</span>&nbsp;<span class="op" id="3066283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066286">case</span>&nbsp;<span class="ident" id="3066291">stateJSSqStr</span><span class="op" id="3066303">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066307">specials</span>&nbsp;<span class="op" id="3066316">=</span>&nbsp;<span class="string" id="3066318">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066324">case</span>&nbsp;<span class="ident" id="3066329">stateJSRegexp</span><span class="op" id="3066342">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066346">specials</span>&nbsp;<span class="op" id="3066355">=</span>&nbsp;<span class="string" id="3066357">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066369">k</span><span class="op" id="3066370">,</span>&nbsp;<span class="ident" id="3066372">inCharset</span>&nbsp;<span class="op" id="3066382">:=</span>&nbsp;<span class="num" id="3066385">0</span><span class="op" id="3066386">,</span>&nbsp;<span class="builtintype" id="3066388">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066395">for</span>&nbsp;<span class="op" id="3066399">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066403">i</span>&nbsp;<span class="op" id="3066405">:=</span>&nbsp;<span class="ident" id="3066408">k</span>&nbsp;<span class="op" id="3066410">+</span>&nbsp;<span class="ident" id="3066412">bytes</span><span class="op" id="3066417">.</span><span class="ident" id="3066418">IndexAny</span><span class="op" id="3066426">(</span><span class="ident" id="3066427">s</span><span class="op" id="3066428">[</span><span class="ident" id="3066429">k</span><span class="op" id="3066430">:</span><span class="op" id="3066431">]</span><span class="op" id="3066432">,</span>&nbsp;<span class="ident" id="3066434">specials</span><span class="op" id="3066442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066446">if</span>&nbsp;<span class="ident" id="3066449">i</span>&nbsp;<span class="op" id="3066451">&lt;</span>&nbsp;<span class="ident" id="3066453">k</span>&nbsp;<span class="op" id="3066455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066460">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066472">switch</span>&nbsp;<span class="ident" id="3066479">s</span><span class="op" id="3066480">[</span><span class="ident" id="3066481">i</span><span class="op" id="3066482">]</span>&nbsp;<span class="op" id="3066484">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066488">case</span>&nbsp;<span class="string" id="3066493">&#39;\\&#39;</span><span class="op" id="3066497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066502">i</span><span class="op" id="3066503">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066509">if</span>&nbsp;<span class="ident" id="3066512">i</span>&nbsp;<span class="op" id="3066514">==</span>&nbsp;<span class="builtinfunc" id="3066517">len</span><span class="op" id="3066520">(</span><span class="ident" id="3066521">s</span><span class="op" id="3066522">)</span>&nbsp;<span class="op" id="3066524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066530">return</span>&nbsp;<span class="ident" id="3066537">context</span><span class="op" id="3066544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066551">state</span><span class="op" id="3066556">:</span>&nbsp;<span class="ident" id="3066558">stateError</span><span class="op" id="3066568">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066575">err</span><span class="op" id="3066578">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3066582">errorf</span><span class="op" id="3066588">(</span><span class="ident" id="3066589">ErrPartialEscape</span><span class="op" id="3066605">,</span>&nbsp;<span class="builtintype" id="3066607">nil</span><span class="op" id="3066610">,</span>&nbsp;<span class="num" id="3066612">0</span><span class="op" id="3066613">,</span>&nbsp;<span class="string" id="3066615">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="3066660">,</span>&nbsp;<span class="ident" id="3066662">s</span><span class="op" id="3066663">)</span><span class="op" id="3066664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066670">}</span><span class="op" id="3066671">,</span>&nbsp;<span class="builtinfunc" id="3066673">len</span><span class="op" id="3066676">(</span><span class="ident" id="3066677">s</span><span class="op" id="3066678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066687">case</span>&nbsp;<span class="string" id="3066692">&#39;[&#39;</span><span class="op" id="3066695">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066700">inCharset</span>&nbsp;<span class="op" id="3066710">=</span>&nbsp;<span class="builtintype" id="3066712">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066719">case</span>&nbsp;<span class="string" id="3066724">&#39;]&#39;</span><span class="op" id="3066727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066732">inCharset</span>&nbsp;<span class="op" id="3066742">=</span>&nbsp;<span class="builtintype" id="3066744">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066752">default</span><span class="op" id="3066759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3066764">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066784">if</span>&nbsp;<span class="op" id="3066787">!</span><span class="ident" id="3066788">inCharset</span>&nbsp;<span class="op" id="3066798">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066804">c</span><span class="op" id="3066805">.</span><span class="ident" id="3066806">state</span><span class="op" id="3066811">,</span>&nbsp;<span class="ident" id="3066813">c</span><span class="op" id="3066814">.</span><span class="ident" id="3066815">jsCtx</span>&nbsp;<span class="op" id="3066821">=</span>&nbsp;<span class="ident" id="3066823">stateJS</span><span class="op" id="3066830">,</span>&nbsp;<span class="ident" id="3066832">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066847">return</span>&nbsp;<span class="ident" id="3066854">c</span><span class="op" id="3066855">,</span>&nbsp;<span class="ident" id="3066857">i</span>&nbsp;<span class="op" id="3066859">+</span>&nbsp;<span class="num" id="3066861">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3066874">k</span>&nbsp;<span class="op" id="3066876">=</span>&nbsp;<span class="ident" id="3066878">i</span>&nbsp;<span class="op" id="3066880">+</span>&nbsp;<span class="num" id="3066882">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3066885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3066889">if</span>&nbsp;<span class="ident" id="3066892">inCharset</span>&nbsp;<span class="op" id="3066902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3066906">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3066971">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067002">return</span>&nbsp;<span class="ident" id="3067009">context</span><span class="op" id="3067016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067021">state</span><span class="op" id="3067026">:</span>&nbsp;<span class="ident" id="3067028">stateError</span><span class="op" id="3067038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067043">err</span><span class="op" id="3067046">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3067050">errorf</span><span class="op" id="3067056">(</span><span class="ident" id="3067057">ErrPartialCharset</span><span class="op" id="3067074">,</span>&nbsp;<span class="builtintype" id="3067076">nil</span><span class="op" id="3067079">,</span>&nbsp;<span class="num" id="3067081">0</span><span class="op" id="3067082">,</span>&nbsp;<span class="string" id="3067084">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="3067118">,</span>&nbsp;<span class="ident" id="3067120">s</span><span class="op" id="3067121">)</span><span class="op" id="3067122">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3067126">}</span><span class="op" id="3067127">,</span>&nbsp;<span class="builtinfunc" id="3067129">len</span><span class="op" id="3067132">(</span><span class="ident" id="3067133">s</span><span class="op" id="3067134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3067137">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067141">return</span>&nbsp;<span class="ident" id="3067148">c</span><span class="op" id="3067149">,</span>&nbsp;<span class="builtinfunc" id="3067151">len</span><span class="op" id="3067154">(</span><span class="ident" id="3067155">s</span><span class="op" id="3067156">)</span><br>
<span class="lineno"></span><span class="op" id="3067158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3067161">var</span>&nbsp;<span class="ident" id="3067165">blockCommentEnd</span>&nbsp;<span class="op" id="3067181">=</span>&nbsp;<span class="op" id="3067183">[</span><span class="op" id="3067184">]</span><span class="builtintype" id="3067185">byte</span><span class="op" id="3067189">(</span><span class="string" id="3067190">&#34;*/&#34;</span><span class="op" id="3067194">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="3067197">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="3067269">func</span>&nbsp;<span class="ident" id="3067274">tBlockCmt</span><span class="op" id="3067283">(</span><span class="ident" id="3067284">c</span>&nbsp;<span class="ident" id="3067286">context</span><span class="op" id="3067293">,</span>&nbsp;<span class="ident" id="3067295">s</span>&nbsp;<span class="op" id="3067297">[</span><span class="op" id="3067298">]</span><span class="builtintype" id="3067299">byte</span><span class="op" id="3067303">)</span>&nbsp;<span class="op" id="3067305">(</span><span class="ident" id="3067306">context</span><span class="op" id="3067313">,</span>&nbsp;<span class="builtintype" id="3067315">int</span><span class="op" id="3067318">)</span>&nbsp;<span class="op" id="3067320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067323">i</span>&nbsp;<span class="op" id="3067325">:=</span>&nbsp;<span class="ident" id="3067328">bytes</span><span class="op" id="3067333">.</span><span class="ident" id="3067334">Index</span><span class="op" id="3067339">(</span><span class="ident" id="3067340">s</span><span class="op" id="3067341">,</span>&nbsp;<span class="ident" id="3067343">blockCommentEnd</span><span class="op" id="3067358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067361">if</span>&nbsp;<span class="ident" id="3067364">i</span>&nbsp;<span class="op" id="3067366">==</span>&nbsp;<span class="op" id="3067369">-</span><span class="num" id="3067370">1</span>&nbsp;<span class="op" id="3067372">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067376">return</span>&nbsp;<span class="ident" id="3067383">c</span><span class="op" id="3067384">,</span>&nbsp;<span class="builtinfunc" id="3067386">len</span><span class="op" id="3067389">(</span><span class="ident" id="3067390">s</span><span class="op" id="3067391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3067394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067397">switch</span>&nbsp;<span class="ident" id="3067404">c</span><span class="op" id="3067405">.</span><span class="ident" id="3067406">state</span>&nbsp;<span class="op" id="3067412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067415">case</span>&nbsp;<span class="ident" id="3067420">stateJSBlockCmt</span><span class="op" id="3067435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067439">c</span><span class="op" id="3067440">.</span><span class="ident" id="3067441">state</span>&nbsp;<span class="op" id="3067447">=</span>&nbsp;<span class="ident" id="3067449">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067458">case</span>&nbsp;<span class="ident" id="3067463">stateCSSBlockCmt</span><span class="op" id="3067479">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067483">c</span><span class="op" id="3067484">.</span><span class="ident" id="3067485">state</span>&nbsp;<span class="op" id="3067491">=</span>&nbsp;<span class="ident" id="3067493">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067503">default</span><span class="op" id="3067510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3067514">panic</span><span class="op" id="3067519">(</span><span class="ident" id="3067520">c</span><span class="op" id="3067521">.</span><span class="ident" id="3067522">state</span><span class="op" id="3067527">.</span><span class="ident" id="3067528">String</span><span class="op" id="3067534">(</span><span class="op" id="3067535">)</span><span class="op" id="3067536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3067539">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067542">return</span>&nbsp;<span class="ident" id="3067549">c</span><span class="op" id="3067550">,</span>&nbsp;<span class="ident" id="3067552">i</span>&nbsp;<span class="op" id="3067554">+</span>&nbsp;<span class="num" id="3067556">2</span><br>
<span class="lineno"></span><span class="op" id="3067558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3067561">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="3067630">func</span>&nbsp;<span class="ident" id="3067635">tLineCmt</span><span class="op" id="3067643">(</span><span class="ident" id="3067644">c</span>&nbsp;<span class="ident" id="3067646">context</span><span class="op" id="3067653">,</span>&nbsp;<span class="ident" id="3067655">s</span>&nbsp;<span class="op" id="3067657">[</span><span class="op" id="3067658">]</span><span class="builtintype" id="3067659">byte</span><span class="op" id="3067663">)</span>&nbsp;<span class="op" id="3067665">(</span><span class="ident" id="3067666">context</span><span class="op" id="3067673">,</span>&nbsp;<span class="builtintype" id="3067675">int</span><span class="op" id="3067678">)</span>&nbsp;<span class="op" id="3067680">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067683">var</span>&nbsp;<span class="ident" id="3067687">lineTerminators</span>&nbsp;<span class="builtintype" id="3067703">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067711">var</span>&nbsp;<span class="ident" id="3067715">endState</span>&nbsp;<span class="ident" id="3067724">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067731">switch</span>&nbsp;<span class="ident" id="3067738">c</span><span class="op" id="3067739">.</span><span class="ident" id="3067740">state</span>&nbsp;<span class="op" id="3067746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067749">case</span>&nbsp;<span class="ident" id="3067754">stateJSLineCmt</span><span class="op" id="3067768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067772">lineTerminators</span><span class="op" id="3067787">,</span>&nbsp;<span class="ident" id="3067789">endState</span>&nbsp;<span class="op" id="3067798">=</span>&nbsp;<span class="string" id="3067800">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="3067818">,</span>&nbsp;<span class="ident" id="3067820">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3067829">case</span>&nbsp;<span class="ident" id="3067834">stateCSSLineCmt</span><span class="op" id="3067849">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3067853">lineTerminators</span><span class="op" id="3067868">,</span>&nbsp;<span class="ident" id="3067870">endState</span>&nbsp;<span class="op" id="3067879">=</span>&nbsp;<span class="string" id="3067881">&#34;\n\f\r&#34;</span><span class="op" id="3067889">,</span>&nbsp;<span class="ident" id="3067891">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3067902">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3067968">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068012">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068047">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068088">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068151">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068166">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3068207">default</span><span class="op" id="3068214">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3068218">panic</span><span class="op" id="3068223">(</span><span class="ident" id="3068224">c</span><span class="op" id="3068225">.</span><span class="ident" id="3068226">state</span><span class="op" id="3068231">.</span><span class="ident" id="3068232">String</span><span class="op" id="3068238">(</span><span class="op" id="3068239">)</span><span class="op" id="3068240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3068243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3068247">i</span>&nbsp;<span class="op" id="3068249">:=</span>&nbsp;<span class="ident" id="3068252">bytes</span><span class="op" id="3068257">.</span><span class="ident" id="3068258">IndexAny</span><span class="op" id="3068266">(</span><span class="ident" id="3068267">s</span><span class="op" id="3068268">,</span>&nbsp;<span class="ident" id="3068270">lineTerminators</span><span class="op" id="3068285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3068288">if</span>&nbsp;<span class="ident" id="3068291">i</span>&nbsp;<span class="op" id="3068293">==</span>&nbsp;<span class="op" id="3068296">-</span><span class="num" id="3068297">1</span>&nbsp;<span class="op" id="3068299">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3068303">return</span>&nbsp;<span class="ident" id="3068310">c</span><span class="op" id="3068311">,</span>&nbsp;<span class="builtinfunc" id="3068313">len</span><span class="op" id="3068316">(</span><span class="ident" id="3068317">s</span><span class="op" id="3068318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3068321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3068324">c</span><span class="op" id="3068325">.</span><span class="ident" id="3068326">state</span>&nbsp;<span class="op" id="3068332">=</span>&nbsp;<span class="ident" id="3068334">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068344">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068410">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068473">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068533">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068599">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3068663">return</span>&nbsp;<span class="ident" id="3068670">c</span><span class="op" id="3068671">,</span>&nbsp;<span class="ident" id="3068673">i</span><br>
<span class="lineno"></span><span class="op" id="3068675">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="3068678">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="3068740">func</span>&nbsp;<span class="ident" id="3068745">tCSS</span><span class="op" id="3068749">(</span><span class="ident" id="3068750">c</span>&nbsp;<span class="ident" id="3068752">context</span><span class="op" id="3068759">,</span>&nbsp;<span class="ident" id="3068761">s</span>&nbsp;<span class="op" id="3068763">[</span><span class="op" id="3068764">]</span><span class="builtintype" id="3068765">byte</span><span class="op" id="3068769">)</span>&nbsp;<span class="op" id="3068771">(</span><span class="ident" id="3068772">context</span><span class="op" id="3068779">,</span>&nbsp;<span class="builtintype" id="3068781">int</span><span class="op" id="3068784">)</span>&nbsp;<span class="op" id="3068786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068789">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068846">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068888">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3068954">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069016">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069031">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069084">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069130">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069181">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069242">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069258">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069315">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069385">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069389">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069452">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069487">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069491">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069545">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069614">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069686">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069707">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069775">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069845">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069906">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3069977">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3070046">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070085">k</span>&nbsp;<span class="op" id="3070087">:=</span>&nbsp;<span class="num" id="3070090">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070093">for</span>&nbsp;<span class="op" id="3070097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070101">i</span>&nbsp;<span class="op" id="3070103">:=</span>&nbsp;<span class="ident" id="3070106">k</span>&nbsp;<span class="op" id="3070108">+</span>&nbsp;<span class="ident" id="3070110">bytes</span><span class="op" id="3070115">.</span><span class="ident" id="3070116">IndexAny</span><span class="op" id="3070124">(</span><span class="ident" id="3070125">s</span><span class="op" id="3070126">[</span><span class="ident" id="3070127">k</span><span class="op" id="3070128">:</span><span class="op" id="3070129">]</span><span class="op" id="3070130">,</span>&nbsp;<span class="string" id="3070132">`(&#34;&#39;/`</span><span class="op" id="3070138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070142">if</span>&nbsp;<span class="ident" id="3070145">i</span>&nbsp;<span class="op" id="3070147">&lt;</span>&nbsp;<span class="ident" id="3070149">k</span>&nbsp;<span class="op" id="3070151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070156">return</span>&nbsp;<span class="ident" id="3070163">c</span><span class="op" id="3070164">,</span>&nbsp;<span class="builtinfunc" id="3070166">len</span><span class="op" id="3070169">(</span><span class="ident" id="3070170">s</span><span class="op" id="3070171">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070179">switch</span>&nbsp;<span class="ident" id="3070186">s</span><span class="op" id="3070187">[</span><span class="ident" id="3070188">i</span><span class="op" id="3070189">]</span>&nbsp;<span class="op" id="3070191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070195">case</span>&nbsp;<span class="string" id="3070200">&#39;(&#39;</span><span class="op" id="3070203">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3070208">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070240">p</span>&nbsp;<span class="op" id="3070242">:=</span>&nbsp;<span class="ident" id="3070245">bytes</span><span class="op" id="3070250">.</span><span class="ident" id="3070251">TrimRight</span><span class="op" id="3070260">(</span><span class="ident" id="3070261">s</span><span class="op" id="3070262">[</span><span class="op" id="3070263">:</span><span class="ident" id="3070264">i</span><span class="op" id="3070265">]</span><span class="op" id="3070266">,</span>&nbsp;<span class="string" id="3070268">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="3070279">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070284">if</span>&nbsp;<span class="ident" id="3070287">endsWithCSSKeyword</span><span class="op" id="3070305">(</span><span class="ident" id="3070306">p</span><span class="op" id="3070307">,</span>&nbsp;<span class="string" id="3070309">&#34;url&#34;</span><span class="op" id="3070314">)</span>&nbsp;<span class="op" id="3070316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070322">j</span>&nbsp;<span class="op" id="3070324">:=</span>&nbsp;<span class="builtinfunc" id="3070327">len</span><span class="op" id="3070330">(</span><span class="ident" id="3070331">s</span><span class="op" id="3070332">)</span>&nbsp;<span class="op" id="3070334">-</span>&nbsp;<span class="builtinfunc" id="3070336">len</span><span class="op" id="3070339">(</span><span class="ident" id="3070340">bytes</span><span class="op" id="3070345">.</span><span class="ident" id="3070346">TrimLeft</span><span class="op" id="3070354">(</span><span class="ident" id="3070355">s</span><span class="op" id="3070356">[</span><span class="ident" id="3070357">i</span><span class="op" id="3070358">+</span><span class="num" id="3070359">1</span><span class="op" id="3070360">:</span><span class="op" id="3070361">]</span><span class="op" id="3070362">,</span>&nbsp;<span class="string" id="3070364">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="3070375">)</span><span class="op" id="3070376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070382">switch</span>&nbsp;<span class="op" id="3070389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070395">case</span>&nbsp;<span class="ident" id="3070400">j</span>&nbsp;<span class="op" id="3070402">!=</span>&nbsp;<span class="builtinfunc" id="3070405">len</span><span class="op" id="3070408">(</span><span class="ident" id="3070409">s</span><span class="op" id="3070410">)</span>&nbsp;<span class="op" id="3070412">&amp;&amp;</span>&nbsp;<span class="ident" id="3070415">s</span><span class="op" id="3070416">[</span><span class="ident" id="3070417">j</span><span class="op" id="3070418">]</span>&nbsp;<span class="op" id="3070420">==</span>&nbsp;<span class="string" id="3070423">&#39;&#34;&#39;</span><span class="op" id="3070426">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070433">c</span><span class="op" id="3070434">.</span><span class="ident" id="3070435">state</span><span class="op" id="3070440">,</span>&nbsp;<span class="ident" id="3070442">j</span>&nbsp;<span class="op" id="3070444">=</span>&nbsp;<span class="ident" id="3070446">stateCSSDqURL</span><span class="op" id="3070459">,</span>&nbsp;<span class="ident" id="3070461">j</span><span class="op" id="3070462">+</span><span class="num" id="3070463">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070469">case</span>&nbsp;<span class="ident" id="3070474">j</span>&nbsp;<span class="op" id="3070476">!=</span>&nbsp;<span class="builtinfunc" id="3070479">len</span><span class="op" id="3070482">(</span><span class="ident" id="3070483">s</span><span class="op" id="3070484">)</span>&nbsp;<span class="op" id="3070486">&amp;&amp;</span>&nbsp;<span class="ident" id="3070489">s</span><span class="op" id="3070490">[</span><span class="ident" id="3070491">j</span><span class="op" id="3070492">]</span>&nbsp;<span class="op" id="3070494">==</span>&nbsp;<span class="string" id="3070497">&#39;\&#39;&#39;</span><span class="op" id="3070501">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070508">c</span><span class="op" id="3070509">.</span><span class="ident" id="3070510">state</span><span class="op" id="3070515">,</span>&nbsp;<span class="ident" id="3070517">j</span>&nbsp;<span class="op" id="3070519">=</span>&nbsp;<span class="ident" id="3070521">stateCSSSqURL</span><span class="op" id="3070534">,</span>&nbsp;<span class="ident" id="3070536">j</span><span class="op" id="3070537">+</span><span class="num" id="3070538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070544">default</span><span class="op" id="3070551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070558">c</span><span class="op" id="3070559">.</span><span class="ident" id="3070560">state</span>&nbsp;<span class="op" id="3070566">=</span>&nbsp;<span class="ident" id="3070568">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070584">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070590">return</span>&nbsp;<span class="ident" id="3070597">c</span><span class="op" id="3070598">,</span>&nbsp;<span class="ident" id="3070600">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070609">case</span>&nbsp;<span class="string" id="3070614">&#39;/&#39;</span><span class="op" id="3070617">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070622">if</span>&nbsp;<span class="ident" id="3070625">i</span><span class="op" id="3070626">+</span><span class="num" id="3070627">1</span>&nbsp;<span class="op" id="3070629">&lt;</span>&nbsp;<span class="builtinfunc" id="3070631">len</span><span class="op" id="3070634">(</span><span class="ident" id="3070635">s</span><span class="op" id="3070636">)</span>&nbsp;<span class="op" id="3070638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070644">switch</span>&nbsp;<span class="ident" id="3070651">s</span><span class="op" id="3070652">[</span><span class="ident" id="3070653">i</span><span class="op" id="3070654">+</span><span class="num" id="3070655">1</span><span class="op" id="3070656">]</span>&nbsp;<span class="op" id="3070658">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070664">case</span>&nbsp;<span class="string" id="3070669">&#39;/&#39;</span><span class="op" id="3070672">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070679">c</span><span class="op" id="3070680">.</span><span class="ident" id="3070681">state</span>&nbsp;<span class="op" id="3070687">=</span>&nbsp;<span class="ident" id="3070689">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070710">return</span>&nbsp;<span class="ident" id="3070717">c</span><span class="op" id="3070718">,</span>&nbsp;<span class="ident" id="3070720">i</span>&nbsp;<span class="op" id="3070722">+</span>&nbsp;<span class="num" id="3070724">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070730">case</span>&nbsp;<span class="string" id="3070735">&#39;*&#39;</span><span class="op" id="3070738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070745">c</span><span class="op" id="3070746">.</span><span class="ident" id="3070747">state</span>&nbsp;<span class="op" id="3070753">=</span>&nbsp;<span class="ident" id="3070755">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070777">return</span>&nbsp;<span class="ident" id="3070784">c</span><span class="op" id="3070785">,</span>&nbsp;<span class="ident" id="3070787">i</span>&nbsp;<span class="op" id="3070789">+</span>&nbsp;<span class="num" id="3070791">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070806">case</span>&nbsp;<span class="string" id="3070811">&#39;&#34;&#39;</span><span class="op" id="3070814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070819">c</span><span class="op" id="3070820">.</span><span class="ident" id="3070821">state</span>&nbsp;<span class="op" id="3070827">=</span>&nbsp;<span class="ident" id="3070829">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070846">return</span>&nbsp;<span class="ident" id="3070853">c</span><span class="op" id="3070854">,</span>&nbsp;<span class="ident" id="3070856">i</span>&nbsp;<span class="op" id="3070858">+</span>&nbsp;<span class="num" id="3070860">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070864">case</span>&nbsp;<span class="string" id="3070869">&#39;\&#39;&#39;</span><span class="op" id="3070873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070878">c</span><span class="op" id="3070879">.</span><span class="ident" id="3070880">state</span>&nbsp;<span class="op" id="3070886">=</span>&nbsp;<span class="ident" id="3070888">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3070905">return</span>&nbsp;<span class="ident" id="3070912">c</span><span class="op" id="3070913">,</span>&nbsp;<span class="ident" id="3070915">i</span>&nbsp;<span class="op" id="3070917">+</span>&nbsp;<span class="num" id="3070919">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070923">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3070927">k</span>&nbsp;<span class="op" id="3070929">=</span>&nbsp;<span class="ident" id="3070931">i</span>&nbsp;<span class="op" id="3070933">+</span>&nbsp;<span class="num" id="3070935">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3070938">}</span><br>
<span class="lineno"></span><span class="op" id="3070940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3070943">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="3071024">func</span>&nbsp;<span class="ident" id="3071029">tCSSStr</span><span class="op" id="3071036">(</span><span class="ident" id="3071037">c</span>&nbsp;<span class="ident" id="3071039">context</span><span class="op" id="3071046">,</span>&nbsp;<span class="ident" id="3071048">s</span>&nbsp;<span class="op" id="3071050">[</span><span class="op" id="3071051">]</span><span class="builtintype" id="3071052">byte</span><span class="op" id="3071056">)</span>&nbsp;<span class="op" id="3071058">(</span><span class="ident" id="3071059">context</span><span class="op" id="3071066">,</span>&nbsp;<span class="builtintype" id="3071068">int</span><span class="op" id="3071071">)</span>&nbsp;<span class="op" id="3071073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071076">var</span>&nbsp;<span class="ident" id="3071080">endAndEsc</span>&nbsp;<span class="builtintype" id="3071090">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071098">switch</span>&nbsp;<span class="ident" id="3071105">c</span><span class="op" id="3071106">.</span><span class="ident" id="3071107">state</span>&nbsp;<span class="op" id="3071113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071116">case</span>&nbsp;<span class="ident" id="3071121">stateCSSDqStr</span><span class="op" id="3071134">,</span>&nbsp;<span class="ident" id="3071136">stateCSSDqURL</span><span class="op" id="3071149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071153">endAndEsc</span>&nbsp;<span class="op" id="3071163">=</span>&nbsp;<span class="string" id="3071165">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071171">case</span>&nbsp;<span class="ident" id="3071176">stateCSSSqStr</span><span class="op" id="3071189">,</span>&nbsp;<span class="ident" id="3071191">stateCSSSqURL</span><span class="op" id="3071204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071208">endAndEsc</span>&nbsp;<span class="op" id="3071218">=</span>&nbsp;<span class="string" id="3071220">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071226">case</span>&nbsp;<span class="ident" id="3071231">stateCSSURL</span><span class="op" id="3071242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3071246">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3071306">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071368">endAndEsc</span>&nbsp;<span class="op" id="3071378">=</span>&nbsp;<span class="string" id="3071380">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071396">default</span><span class="op" id="3071403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3071407">panic</span><span class="op" id="3071412">(</span><span class="ident" id="3071413">c</span><span class="op" id="3071414">.</span><span class="ident" id="3071415">state</span><span class="op" id="3071420">.</span><span class="ident" id="3071421">String</span><span class="op" id="3071427">(</span><span class="op" id="3071428">)</span><span class="op" id="3071429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071436">k</span>&nbsp;<span class="op" id="3071438">:=</span>&nbsp;<span class="num" id="3071441">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071444">for</span>&nbsp;<span class="op" id="3071448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071452">i</span>&nbsp;<span class="op" id="3071454">:=</span>&nbsp;<span class="ident" id="3071457">k</span>&nbsp;<span class="op" id="3071459">+</span>&nbsp;<span class="ident" id="3071461">bytes</span><span class="op" id="3071466">.</span><span class="ident" id="3071467">IndexAny</span><span class="op" id="3071475">(</span><span class="ident" id="3071476">s</span><span class="op" id="3071477">[</span><span class="ident" id="3071478">k</span><span class="op" id="3071479">:</span><span class="op" id="3071480">]</span><span class="op" id="3071481">,</span>&nbsp;<span class="ident" id="3071483">endAndEsc</span><span class="op" id="3071492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071496">if</span>&nbsp;<span class="ident" id="3071499">i</span>&nbsp;<span class="op" id="3071501">&lt;</span>&nbsp;<span class="ident" id="3071503">k</span>&nbsp;<span class="op" id="3071505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071510">c</span><span class="op" id="3071511">,</span>&nbsp;<span class="ident" id="3071513">nread</span>&nbsp;<span class="op" id="3071519">:=</span>&nbsp;<span class="ident" id="3071522">tURL</span><span class="op" id="3071526">(</span><span class="ident" id="3071527">c</span><span class="op" id="3071528">,</span>&nbsp;<span class="ident" id="3071530">decodeCSS</span><span class="op" id="3071539">(</span><span class="ident" id="3071540">s</span><span class="op" id="3071541">[</span><span class="ident" id="3071542">k</span><span class="op" id="3071543">:</span><span class="op" id="3071544">]</span><span class="op" id="3071545">)</span><span class="op" id="3071546">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071551">return</span>&nbsp;<span class="ident" id="3071558">c</span><span class="op" id="3071559">,</span>&nbsp;<span class="ident" id="3071561">k</span>&nbsp;<span class="op" id="3071563">+</span>&nbsp;<span class="ident" id="3071565">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071577">if</span>&nbsp;<span class="ident" id="3071580">s</span><span class="op" id="3071581">[</span><span class="ident" id="3071582">i</span><span class="op" id="3071583">]</span>&nbsp;<span class="op" id="3071585">==</span>&nbsp;<span class="string" id="3071588">&#39;\\&#39;</span>&nbsp;<span class="op" id="3071593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071598">i</span><span class="op" id="3071599">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071605">if</span>&nbsp;<span class="ident" id="3071608">i</span>&nbsp;<span class="op" id="3071610">==</span>&nbsp;<span class="builtinfunc" id="3071613">len</span><span class="op" id="3071616">(</span><span class="ident" id="3071617">s</span><span class="op" id="3071618">)</span>&nbsp;<span class="op" id="3071620">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071626">return</span>&nbsp;<span class="ident" id="3071633">context</span><span class="op" id="3071640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071647">state</span><span class="op" id="3071652">:</span>&nbsp;<span class="ident" id="3071654">stateError</span><span class="op" id="3071664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071671">err</span><span class="op" id="3071674">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3071678">errorf</span><span class="op" id="3071684">(</span><span class="ident" id="3071685">ErrPartialEscape</span><span class="op" id="3071701">,</span>&nbsp;<span class="builtintype" id="3071703">nil</span><span class="op" id="3071706">,</span>&nbsp;<span class="num" id="3071708">0</span><span class="op" id="3071709">,</span>&nbsp;<span class="string" id="3071711">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="3071757">,</span>&nbsp;<span class="ident" id="3071759">s</span><span class="op" id="3071760">)</span><span class="op" id="3071761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071767">}</span><span class="op" id="3071768">,</span>&nbsp;<span class="builtinfunc" id="3071770">len</span><span class="op" id="3071773">(</span><span class="ident" id="3071774">s</span><span class="op" id="3071775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071780">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071784">}</span>&nbsp;<span class="keyword" id="3071786">else</span>&nbsp;<span class="op" id="3071791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071796">c</span><span class="op" id="3071797">.</span><span class="ident" id="3071798">state</span>&nbsp;<span class="op" id="3071804">=</span>&nbsp;<span class="ident" id="3071806">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3071818">return</span>&nbsp;<span class="ident" id="3071825">c</span><span class="op" id="3071826">,</span>&nbsp;<span class="ident" id="3071828">i</span>&nbsp;<span class="op" id="3071830">+</span>&nbsp;<span class="num" id="3071832">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071840">c</span><span class="op" id="3071841">,</span>&nbsp;<span class="ident" id="3071843">_</span>&nbsp;<span class="op" id="3071845">=</span>&nbsp;<span class="ident" id="3071847">tURL</span><span class="op" id="3071851">(</span><span class="ident" id="3071852">c</span><span class="op" id="3071853">,</span>&nbsp;<span class="ident" id="3071855">decodeCSS</span><span class="op" id="3071864">(</span><span class="ident" id="3071865">s</span><span class="op" id="3071866">[</span><span class="op" id="3071867">:</span><span class="ident" id="3071868">i</span><span class="op" id="3071869">+</span><span class="num" id="3071870">1</span><span class="op" id="3071871">]</span><span class="op" id="3071872">)</span><span class="op" id="3071873">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3071877">k</span>&nbsp;<span class="op" id="3071879">=</span>&nbsp;<span class="ident" id="3071881">i</span>&nbsp;<span class="op" id="3071883">+</span>&nbsp;<span class="num" id="3071885">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3071888">}</span><br>
<span class="lineno"></span><span class="op" id="3071890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3071893">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="3071959">func</span>&nbsp;<span class="ident" id="3071964">tError</span><span class="op" id="3071970">(</span><span class="ident" id="3071971">c</span>&nbsp;<span class="ident" id="3071973">context</span><span class="op" id="3071980">,</span>&nbsp;<span class="ident" id="3071982">s</span>&nbsp;<span class="op" id="3071984">[</span><span class="op" id="3071985">]</span><span class="builtintype" id="3071986">byte</span><span class="op" id="3071990">)</span>&nbsp;<span class="op" id="3071992">(</span><span class="ident" id="3071993">context</span><span class="op" id="3072000">,</span>&nbsp;<span class="builtintype" id="3072002">int</span><span class="op" id="3072005">)</span>&nbsp;<span class="op" id="3072007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072010">return</span>&nbsp;<span class="ident" id="3072017">c</span><span class="op" id="3072018">,</span>&nbsp;<span class="builtinfunc" id="3072020">len</span><span class="op" id="3072023">(</span><span class="ident" id="3072024">s</span><span class="op" id="3072025">)</span><br>
<span class="lineno"></span><span class="op" id="3072027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3072030">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="3072106">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3072175">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="3072248">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="3072264">func</span>&nbsp;<span class="ident" id="3072269">eatAttrName</span><span class="op" id="3072280">(</span><span class="ident" id="3072281">s</span>&nbsp;<span class="op" id="3072283">[</span><span class="op" id="3072284">]</span><span class="builtintype" id="3072285">byte</span><span class="op" id="3072289">,</span>&nbsp;<span class="ident" id="3072291">i</span>&nbsp;<span class="builtintype" id="3072293">int</span><span class="op" id="3072296">)</span>&nbsp;<span class="op" id="3072298">(</span><span class="builtintype" id="3072299">int</span><span class="op" id="3072302">,</span>&nbsp;<span class="op" id="3072304">*</span><span class="ident" id="3072305">Error</span><span class="op" id="3072310">)</span>&nbsp;<span class="op" id="3072312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072315">for</span>&nbsp;<span class="ident" id="3072319">j</span>&nbsp;<span class="op" id="3072321">:=</span>&nbsp;<span class="ident" id="3072324">i</span><span class="op" id="3072325">;</span>&nbsp;<span class="ident" id="3072327">j</span>&nbsp;<span class="op" id="3072329">&lt;</span>&nbsp;<span class="builtinfunc" id="3072331">len</span><span class="op" id="3072334">(</span><span class="ident" id="3072335">s</span><span class="op" id="3072336">)</span><span class="op" id="3072337">;</span>&nbsp;<span class="ident" id="3072339">j</span><span class="op" id="3072340">++</span>&nbsp;<span class="op" id="3072343">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072347">switch</span>&nbsp;<span class="ident" id="3072354">s</span><span class="op" id="3072355">[</span><span class="ident" id="3072356">j</span><span class="op" id="3072357">]</span>&nbsp;<span class="op" id="3072359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072363">case</span>&nbsp;<span class="string" id="3072368">&#39;&nbsp;&#39;</span><span class="op" id="3072371">,</span>&nbsp;<span class="string" id="3072373">&#39;\t&#39;</span><span class="op" id="3072377">,</span>&nbsp;<span class="string" id="3072379">&#39;\n&#39;</span><span class="op" id="3072383">,</span>&nbsp;<span class="string" id="3072385">&#39;\f&#39;</span><span class="op" id="3072389">,</span>&nbsp;<span class="string" id="3072391">&#39;\r&#39;</span><span class="op" id="3072395">,</span>&nbsp;<span class="string" id="3072397">&#39;=&#39;</span><span class="op" id="3072400">,</span>&nbsp;<span class="string" id="3072402">&#39;&gt;&#39;</span><span class="op" id="3072405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072410">return</span>&nbsp;<span class="ident" id="3072417">j</span><span class="op" id="3072418">,</span>&nbsp;<span class="builtintype" id="3072420">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072426">case</span>&nbsp;<span class="string" id="3072431">&#39;\&#39;&#39;</span><span class="op" id="3072435">,</span>&nbsp;<span class="string" id="3072437">&#39;&#34;&#39;</span><span class="op" id="3072440">,</span>&nbsp;<span class="string" id="3072442">&#39;&lt;&#39;</span><span class="op" id="3072445">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3072450">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3072505">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3072561">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072587">return</span>&nbsp;<span class="op" id="3072594">-</span><span class="num" id="3072595">1</span><span class="op" id="3072596">,</span>&nbsp;<span class="ident" id="3072598">errorf</span><span class="op" id="3072604">(</span><span class="ident" id="3072605">ErrBadHTML</span><span class="op" id="3072615">,</span>&nbsp;<span class="builtintype" id="3072617">nil</span><span class="op" id="3072620">,</span>&nbsp;<span class="num" id="3072622">0</span><span class="op" id="3072623">,</span>&nbsp;<span class="string" id="3072625">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="3072654">,</span>&nbsp;<span class="ident" id="3072656">s</span><span class="op" id="3072657">[</span><span class="ident" id="3072658">j</span><span class="op" id="3072659">:</span><span class="ident" id="3072660">j</span><span class="op" id="3072661">+</span><span class="num" id="3072662">1</span><span class="op" id="3072663">]</span><span class="op" id="3072664">,</span>&nbsp;<span class="ident" id="3072666">s</span><span class="op" id="3072667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072671">default</span><span class="op" id="3072678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3072683">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3072695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3072698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072701">return</span>&nbsp;<span class="builtinfunc" id="3072708">len</span><span class="op" id="3072711">(</span><span class="ident" id="3072712">s</span><span class="op" id="3072713">)</span><span class="op" id="3072714">,</span>&nbsp;<span class="builtintype" id="3072716">nil</span><br>
<span class="lineno"></span><span class="op" id="3072720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="3072723">var</span>&nbsp;<span class="ident" id="3072727">elementNameMap</span>&nbsp;<span class="op" id="3072742">=</span>&nbsp;<span class="keyword" id="3072744">map</span><span class="op" id="3072747">[</span><span class="builtintype" id="3072748">string</span><span class="op" id="3072754">]</span><span class="ident" id="3072755">element</span><span class="op" id="3072762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3072765">&#34;script&#34;</span><span class="op" id="3072773">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3072777">elementScript</span><span class="op" id="3072790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3072793">&#34;style&#34;</span><span class="op" id="3072800">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3072805">elementStyle</span><span class="op" id="3072817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3072820">&#34;textarea&#34;</span><span class="op" id="3072830">:</span>&nbsp;<span class="ident" id="3072832">elementTextarea</span><span class="op" id="3072847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3072850">&#34;title&#34;</span><span class="op" id="3072857">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3072862">elementTitle</span><span class="op" id="3072874">,</span><br>
<span class="lineno">505</span><span class="op" id="3072876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3072879">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="3072931">func</span>&nbsp;<span class="ident" id="3072936">asciiAlpha</span><span class="op" id="3072946">(</span><span class="ident" id="3072947">c</span>&nbsp;<span class="builtintype" id="3072949">byte</span><span class="op" id="3072953">)</span>&nbsp;<span class="builtintype" id="3072955">bool</span>&nbsp;<span class="op" id="3072960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3072963">return</span>&nbsp;<span class="string" id="3072970">&#39;A&#39;</span>&nbsp;<span class="op" id="3072974">&lt;=</span>&nbsp;<span class="ident" id="3072977">c</span>&nbsp;<span class="op" id="3072979">&amp;&amp;</span>&nbsp;<span class="ident" id="3072982">c</span>&nbsp;<span class="op" id="3072984">&lt;=</span>&nbsp;<span class="string" id="3072987">&#39;Z&#39;</span>&nbsp;<span class="op" id="3072991">||</span>&nbsp;<span class="string" id="3072994">&#39;a&#39;</span>&nbsp;<span class="op" id="3072998">&lt;=</span>&nbsp;<span class="ident" id="3073001">c</span>&nbsp;<span class="op" id="3073003">&amp;&amp;</span>&nbsp;<span class="ident" id="3073006">c</span>&nbsp;<span class="op" id="3073008">&lt;=</span>&nbsp;<span class="string" id="3073011">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="3073015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3073018">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="3073082">func</span>&nbsp;<span class="ident" id="3073087">asciiAlphaNum</span><span class="op" id="3073100">(</span><span class="ident" id="3073101">c</span>&nbsp;<span class="builtintype" id="3073103">byte</span><span class="op" id="3073107">)</span>&nbsp;<span class="builtintype" id="3073109">bool</span>&nbsp;<span class="op" id="3073114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073117">return</span>&nbsp;<span class="ident" id="3073124">asciiAlpha</span><span class="op" id="3073134">(</span><span class="ident" id="3073135">c</span><span class="op" id="3073136">)</span>&nbsp;<span class="op" id="3073138">||</span>&nbsp;<span class="string" id="3073141">&#39;0&#39;</span>&nbsp;<span class="op" id="3073145">&lt;=</span>&nbsp;<span class="ident" id="3073148">c</span>&nbsp;<span class="op" id="3073150">&amp;&amp;</span>&nbsp;<span class="ident" id="3073153">c</span>&nbsp;<span class="op" id="3073155">&lt;=</span>&nbsp;<span class="string" id="3073158">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="3073162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3073165">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3073250">func</span>&nbsp;<span class="ident" id="3073255">eatTagName</span><span class="op" id="3073265">(</span><span class="ident" id="3073266">s</span>&nbsp;<span class="op" id="3073268">[</span><span class="op" id="3073269">]</span><span class="builtintype" id="3073270">byte</span><span class="op" id="3073274">,</span>&nbsp;<span class="ident" id="3073276">i</span>&nbsp;<span class="builtintype" id="3073278">int</span><span class="op" id="3073281">)</span>&nbsp;<span class="op" id="3073283">(</span><span class="builtintype" id="3073284">int</span><span class="op" id="3073287">,</span>&nbsp;<span class="ident" id="3073289">element</span><span class="op" id="3073296">)</span>&nbsp;<span class="op" id="3073298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073301">if</span>&nbsp;<span class="ident" id="3073304">i</span>&nbsp;<span class="op" id="3073306">==</span>&nbsp;<span class="builtinfunc" id="3073309">len</span><span class="op" id="3073312">(</span><span class="ident" id="3073313">s</span><span class="op" id="3073314">)</span>&nbsp;<span class="op" id="3073316">||</span>&nbsp;<span class="op" id="3073319">!</span><span class="ident" id="3073320">asciiAlpha</span><span class="op" id="3073330">(</span><span class="ident" id="3073331">s</span><span class="op" id="3073332">[</span><span class="ident" id="3073333">i</span><span class="op" id="3073334">]</span><span class="op" id="3073335">)</span>&nbsp;<span class="op" id="3073337">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073341">return</span>&nbsp;<span class="ident" id="3073348">i</span><span class="op" id="3073349">,</span>&nbsp;<span class="ident" id="3073351">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3073364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3073367">j</span>&nbsp;<span class="op" id="3073369">:=</span>&nbsp;<span class="ident" id="3073372">i</span>&nbsp;<span class="op" id="3073374">+</span>&nbsp;<span class="num" id="3073376">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073379">for</span>&nbsp;<span class="ident" id="3073383">j</span>&nbsp;<span class="op" id="3073385">&lt;</span>&nbsp;<span class="builtinfunc" id="3073387">len</span><span class="op" id="3073390">(</span><span class="ident" id="3073391">s</span><span class="op" id="3073392">)</span>&nbsp;<span class="op" id="3073394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3073398">x</span>&nbsp;<span class="op" id="3073400">:=</span>&nbsp;<span class="ident" id="3073403">s</span><span class="op" id="3073404">[</span><span class="ident" id="3073405">j</span><span class="op" id="3073406">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073410">if</span>&nbsp;<span class="ident" id="3073413">asciiAlphaNum</span><span class="op" id="3073426">(</span><span class="ident" id="3073427">x</span><span class="op" id="3073428">)</span>&nbsp;<span class="op" id="3073430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3073435">j</span><span class="op" id="3073436">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073442">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3073453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3073457">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073514">if</span>&nbsp;<span class="op" id="3073517">(</span><span class="ident" id="3073518">x</span>&nbsp;<span class="op" id="3073520">==</span>&nbsp;<span class="string" id="3073523">&#39;:&#39;</span>&nbsp;<span class="op" id="3073527">||</span>&nbsp;<span class="ident" id="3073530">x</span>&nbsp;<span class="op" id="3073532">==</span>&nbsp;<span class="string" id="3073535">&#39;-&#39;</span><span class="op" id="3073538">)</span>&nbsp;<span class="op" id="3073540">&amp;&amp;</span>&nbsp;<span class="ident" id="3073543">j</span><span class="op" id="3073544">+</span><span class="num" id="3073545">1</span>&nbsp;<span class="op" id="3073547">&lt;</span>&nbsp;<span class="builtinfunc" id="3073549">len</span><span class="op" id="3073552">(</span><span class="ident" id="3073553">s</span><span class="op" id="3073554">)</span>&nbsp;<span class="op" id="3073556">&amp;&amp;</span>&nbsp;<span class="ident" id="3073559">asciiAlphaNum</span><span class="op" id="3073572">(</span><span class="ident" id="3073573">s</span><span class="op" id="3073574">[</span><span class="ident" id="3073575">j</span><span class="op" id="3073576">+</span><span class="num" id="3073577">1</span><span class="op" id="3073578">]</span><span class="op" id="3073579">)</span>&nbsp;<span class="op" id="3073581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3073586">j</span>&nbsp;<span class="op" id="3073588">+=</span>&nbsp;<span class="num" id="3073591">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073596">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3073607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073611">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3073618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073621">return</span>&nbsp;<span class="ident" id="3073628">j</span><span class="op" id="3073629">,</span>&nbsp;<span class="ident" id="3073631">elementNameMap</span><span class="op" id="3073645">[</span><span class="ident" id="3073646">strings</span><span class="op" id="3073653">.</span><span class="ident" id="3073654">ToLower</span><span class="op" id="3073661">(</span><span class="builtintype" id="3073662">string</span><span class="op" id="3073668">(</span><span class="ident" id="3073669">s</span><span class="op" id="3073670">[</span><span class="ident" id="3073671">i</span><span class="op" id="3073672">:</span><span class="ident" id="3073673">j</span><span class="op" id="3073674">]</span><span class="op" id="3073675">)</span><span class="op" id="3073676">)</span><span class="op" id="3073677">]</span><br>
<span class="lineno"></span><span class="op" id="3073679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3073682">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="3073754">func</span>&nbsp;<span class="ident" id="3073759">eatWhiteSpace</span><span class="op" id="3073772">(</span><span class="ident" id="3073773">s</span>&nbsp;<span class="op" id="3073775">[</span><span class="op" id="3073776">]</span><span class="builtintype" id="3073777">byte</span><span class="op" id="3073781">,</span>&nbsp;<span class="ident" id="3073783">i</span>&nbsp;<span class="builtintype" id="3073785">int</span><span class="op" id="3073788">)</span>&nbsp;<span class="builtintype" id="3073790">int</span>&nbsp;<span class="op" id="3073794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073797">for</span>&nbsp;<span class="ident" id="3073801">j</span>&nbsp;<span class="op" id="3073803">:=</span>&nbsp;<span class="ident" id="3073806">i</span><span class="op" id="3073807">;</span>&nbsp;<span class="ident" id="3073809">j</span>&nbsp;<span class="op" id="3073811">&lt;</span>&nbsp;<span class="builtinfunc" id="3073813">len</span><span class="op" id="3073816">(</span><span class="ident" id="3073817">s</span><span class="op" id="3073818">)</span><span class="op" id="3073819">;</span>&nbsp;<span class="ident" id="3073821">j</span><span class="op" id="3073822">++</span>&nbsp;<span class="op" id="3073825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073829">switch</span>&nbsp;<span class="ident" id="3073836">s</span><span class="op" id="3073837">[</span><span class="ident" id="3073838">j</span><span class="op" id="3073839">]</span>&nbsp;<span class="op" id="3073841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073845">case</span>&nbsp;<span class="string" id="3073850">&#39;&nbsp;&#39;</span><span class="op" id="3073853">,</span>&nbsp;<span class="string" id="3073855">&#39;\t&#39;</span><span class="op" id="3073859">,</span>&nbsp;<span class="string" id="3073861">&#39;\n&#39;</span><span class="op" id="3073865">,</span>&nbsp;<span class="string" id="3073867">&#39;\f&#39;</span><span class="op" id="3073871">,</span>&nbsp;<span class="string" id="3073873">&#39;\r&#39;</span><span class="op" id="3073877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3073882">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073894">default</span><span class="op" id="3073901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073906">return</span>&nbsp;<span class="ident" id="3073913">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3073917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3073920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3073923">return</span>&nbsp;<span class="builtinfunc" id="3073930">len</span><span class="op" id="3073933">(</span><span class="ident" id="3073934">s</span><span class="op" id="3073935">)</span><br>
<span class="lineno">550</span><span class="op" id="3073937">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
