<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5259266">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5259321">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5259375">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5259426">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="5259506">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="5259535">package</span>&nbsp;<span class="ident" id="5259543">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259549">import</span>&nbsp;<span class="op" id="5259556">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259559">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259568">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259586">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259596">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259604">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259618">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5259624">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5259631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259634">const</span>&nbsp;<span class="op" id="5259640">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259643">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259655">=</span>&nbsp;<span class="num" id="5259657">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259663">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259675">=</span>&nbsp;<span class="num" id="5259677">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259683">gzipDeflate</span>&nbsp;<span class="op" id="5259695">=</span>&nbsp;<span class="num" id="5259697">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259700">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259712">=</span>&nbsp;<span class="num" id="5259714">1</span>&nbsp;<span class="op" id="5259716">&lt;&lt;</span>&nbsp;<span class="num" id="5259719">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259722">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="5259734">=</span>&nbsp;<span class="num" id="5259736">1</span>&nbsp;<span class="op" id="5259738">&lt;&lt;</span>&nbsp;<span class="num" id="5259741">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259744">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5259756">=</span>&nbsp;<span class="num" id="5259758">1</span>&nbsp;<span class="op" id="5259760">&lt;&lt;</span>&nbsp;<span class="num" id="5259763">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259766">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5259778">=</span>&nbsp;<span class="num" id="5259780">1</span>&nbsp;<span class="op" id="5259782">&lt;&lt;</span>&nbsp;<span class="num" id="5259785">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259788">flagComment</span>&nbsp;<span class="op" id="5259800">=</span>&nbsp;<span class="num" id="5259802">1</span>&nbsp;<span class="op" id="5259804">&lt;&lt;</span>&nbsp;<span class="num" id="5259807">4</span><br>
<span class="lineno"></span><span class="op" id="5259809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="5259812">func</span>&nbsp;<span class="ident" id="5259817">makeReader</span><span class="op" id="5259827">(</span><span class="ident" id="5259828">r</span>&nbsp;<span class="ident" id="5259830">io</span><span class="op" id="5259832">.</span><span class="ident" id="5259833">Reader</span><span class="op" id="5259839">)</span>&nbsp;<span class="ident" id="5259841">flate</span><span class="op" id="5259846">.</span><span class="ident" id="5259847">Reader</span>&nbsp;<span class="op" id="5259854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259857">if</span>&nbsp;<span class="ident" id="5259860">rr</span><span class="op" id="5259862">,</span>&nbsp;<span class="ident" id="5259864">ok</span>&nbsp;<span class="op" id="5259867">:=</span>&nbsp;<span class="ident" id="5259870">r</span><span class="op" id="5259871">.</span><span class="op" id="5259872">(</span><span class="ident" id="5259873">flate</span><span class="op" id="5259878">.</span><span class="ident" id="5259879">Reader</span><span class="op" id="5259885">)</span><span class="op" id="5259886">;</span>&nbsp;<span class="ident" id="5259888">ok</span>&nbsp;<span class="op" id="5259891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259895">return</span>&nbsp;<span class="ident" id="5259902">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259909">return</span>&nbsp;<span class="ident" id="5259916">bufio</span><span class="op" id="5259921">.</span><span class="ident" id="5259922">NewReader</span><span class="op" id="5259931">(</span><span class="ident" id="5259932">r</span><span class="op" id="5259933">)</span><br>
<span class="lineno">35</span><span class="op" id="5259935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5259938">var</span>&nbsp;<span class="op" id="5259942">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259945">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260026">ErrChecksum</span>&nbsp;<span class="op" id="5260038">=</span>&nbsp;<span class="ident" id="5260040">errors</span><span class="op" id="5260046">.</span><span class="ident" id="5260047">New</span><span class="op" id="5260050">(</span><span class="string" id="5260051">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="5260075">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5260078">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260155">ErrHeader</span>&nbsp;<span class="op" id="5260165">=</span>&nbsp;<span class="ident" id="5260167">errors</span><span class="op" id="5260173">.</span><span class="ident" id="5260174">New</span><span class="op" id="5260177">(</span><span class="string" id="5260178">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="5260200">)</span><br>
<span class="lineno"></span><span class="op" id="5260202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260205">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="5260281">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="5260355">type</span>&nbsp;<span class="ident" id="5260360">Header</span>&nbsp;<span class="keyword" id="5260367">struct</span>&nbsp;<span class="op" id="5260374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260377">Comment</span>&nbsp;<span class="builtintype" id="5260385">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5260395">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260407">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5260415">[</span><span class="op" id="5260416">]</span><span class="builtintype" id="5260417">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5260425">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260442">ModTime</span>&nbsp;<span class="ident" id="5260450">time</span><span class="op" id="5260454">.</span><span class="ident" id="5260455">Time</span>&nbsp;<span class="comment" id="5260460">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260482">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5260490">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5260500">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260514">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5260522">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5260532">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="5260557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260560">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="5260617">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5260674">//</span><br>
<span class="lineno"></span><span class="comment" id="5260677">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="5260742">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="5260794">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="5260856">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="5260915">//</span><br>
<span class="lineno"></span><span class="comment" id="5260918">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5260986">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5261036">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="5261095">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5261163">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="5261226">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5261258">type</span>&nbsp;<span class="ident" id="5261263">Reader</span>&nbsp;<span class="keyword" id="5261270">struct</span>&nbsp;<span class="op" id="5261277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261280">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261288">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261301">flate</span><span class="op" id="5261306">.</span><span class="ident" id="5261307">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261315">decompressor</span>&nbsp;<span class="ident" id="5261328">io</span><span class="op" id="5261330">.</span><span class="ident" id="5261331">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261343">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5261356">hash</span><span class="op" id="5261360">.</span><span class="ident" id="5261361">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261369">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5261382">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261390">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5261403">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261409">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5261422">[</span><span class="num" id="5261423">512</span><span class="op" id="5261426">]</span><span class="builtintype" id="5261427">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261433">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5261446">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261453">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="5261466">bool</span><br>
<span class="lineno"></span><span class="op" id="5261471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5261474">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="5261534">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5261581">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5261643">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="5261719">func</span>&nbsp;<span class="ident" id="5261724">NewReader</span><span class="op" id="5261733">(</span><span class="ident" id="5261734">r</span>&nbsp;<span class="ident" id="5261736">io</span><span class="op" id="5261738">.</span><span class="ident" id="5261739">Reader</span><span class="op" id="5261745">)</span>&nbsp;<span class="op" id="5261747">(</span><span class="op" id="5261748">*</span><span class="ident" id="5261749">Reader</span><span class="op" id="5261755">,</span>&nbsp;<span class="builtintype" id="5261757">error</span><span class="op" id="5261762">)</span>&nbsp;<span class="op" id="5261764">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261767">z</span>&nbsp;<span class="op" id="5261769">:=</span>&nbsp;<span class="builtinfunc" id="5261772">new</span><span class="op" id="5261775">(</span><span class="ident" id="5261776">Reader</span><span class="op" id="5261782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261785">z</span><span class="op" id="5261786">.</span><span class="ident" id="5261787">r</span>&nbsp;<span class="op" id="5261789">=</span>&nbsp;<span class="ident" id="5261791">makeReader</span><span class="op" id="5261801">(</span><span class="ident" id="5261802">r</span><span class="op" id="5261803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261806">z</span><span class="op" id="5261807">.</span><span class="ident" id="5261808">multistream</span>&nbsp;<span class="op" id="5261820">=</span>&nbsp;<span class="builtintype" id="5261822">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261828">z</span><span class="op" id="5261829">.</span><span class="ident" id="5261830">digest</span>&nbsp;<span class="op" id="5261837">=</span>&nbsp;<span class="ident" id="5261839">crc32</span><span class="op" id="5261844">.</span><span class="ident" id="5261845">NewIEEE</span><span class="op" id="5261852">(</span><span class="op" id="5261853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261856">if</span>&nbsp;<span class="ident" id="5261859">err</span>&nbsp;<span class="op" id="5261863">:=</span>&nbsp;<span class="ident" id="5261866">z</span><span class="op" id="5261867">.</span><span class="ident" id="5261868">readHeader</span><span class="op" id="5261878">(</span><span class="builtintype" id="5261879">true</span><span class="op" id="5261883">)</span><span class="op" id="5261884">;</span>&nbsp;<span class="ident" id="5261886">err</span>&nbsp;<span class="op" id="5261890">!=</span>&nbsp;<span class="ident" id="5261893">nil</span>&nbsp;<span class="op" id="5261897">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261901">return</span>&nbsp;<span class="ident" id="5261908">nil</span><span class="op" id="5261911">,</span>&nbsp;<span class="ident" id="5261913">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261921">return</span>&nbsp;<span class="ident" id="5261928">z</span><span class="op" id="5261929">,</span>&nbsp;<span class="ident" id="5261931">nil</span><br>
<span class="lineno"></span><span class="op" id="5261935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5261938">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5262008">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5262084">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="5262151">func</span>&nbsp;<span class="op" id="5262156">(</span><span class="ident" id="5262157">z</span>&nbsp;<span class="op" id="5262159">*</span><span class="ident" id="5262160">Reader</span><span class="op" id="5262166">)</span>&nbsp;<span class="ident" id="5262168">Reset</span><span class="op" id="5262173">(</span><span class="ident" id="5262174">r</span>&nbsp;<span class="ident" id="5262176">io</span><span class="op" id="5262178">.</span><span class="ident" id="5262179">Reader</span><span class="op" id="5262185">)</span>&nbsp;<span class="builtintype" id="5262187">error</span>&nbsp;<span class="op" id="5262193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262196">z</span><span class="op" id="5262197">.</span><span class="ident" id="5262198">r</span>&nbsp;<span class="op" id="5262200">=</span>&nbsp;<span class="ident" id="5262202">makeReader</span><span class="op" id="5262212">(</span><span class="ident" id="5262213">r</span><span class="op" id="5262214">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262217">if</span>&nbsp;<span class="ident" id="5262220">z</span><span class="op" id="5262221">.</span><span class="ident" id="5262222">digest</span>&nbsp;<span class="op" id="5262229">==</span>&nbsp;<span class="ident" id="5262232">nil</span>&nbsp;<span class="op" id="5262236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262240">z</span><span class="op" id="5262241">.</span><span class="ident" id="5262242">digest</span>&nbsp;<span class="op" id="5262249">=</span>&nbsp;<span class="ident" id="5262251">crc32</span><span class="op" id="5262256">.</span><span class="ident" id="5262257">NewIEEE</span><span class="op" id="5262264">(</span><span class="op" id="5262265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262268">}</span>&nbsp;<span class="keyword" id="5262270">else</span>&nbsp;<span class="op" id="5262275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262279">z</span><span class="op" id="5262280">.</span><span class="ident" id="5262281">digest</span><span class="op" id="5262287">.</span><span class="ident" id="5262288">Reset</span><span class="op" id="5262293">(</span><span class="op" id="5262294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262297">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262300">z</span><span class="op" id="5262301">.</span><span class="ident" id="5262302">size</span>&nbsp;<span class="op" id="5262307">=</span>&nbsp;<span class="num" id="5262309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262312">z</span><span class="op" id="5262313">.</span><span class="ident" id="5262314">err</span>&nbsp;<span class="op" id="5262318">=</span>&nbsp;<span class="ident" id="5262320">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262325">z</span><span class="op" id="5262326">.</span><span class="ident" id="5262327">multistream</span>&nbsp;<span class="op" id="5262339">=</span>&nbsp;<span class="builtintype" id="5262341">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262347">return</span>&nbsp;<span class="ident" id="5262354">z</span><span class="op" id="5262355">.</span><span class="ident" id="5262356">readHeader</span><span class="op" id="5262366">(</span><span class="builtintype" id="5262367">true</span><span class="op" id="5262371">)</span><br>
<span class="lineno"></span><span class="op" id="5262373">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="5262376">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5262447">//</span><br>
<span class="lineno"></span><span class="comment" id="5262450">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5262525">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="5262595">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="5262673">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5262751">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="5262815">//</span><br>
<span class="lineno"></span><span class="comment" id="5262818">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="5262895">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="5262971">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5263037">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5263106">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5263181">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="5263239">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="5263318">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="5263380">func</span>&nbsp;<span class="op" id="5263385">(</span><span class="ident" id="5263386">z</span>&nbsp;<span class="op" id="5263388">*</span><span class="ident" id="5263389">Reader</span><span class="op" id="5263395">)</span>&nbsp;<span class="ident" id="5263397">Multistream</span><span class="op" id="5263408">(</span><span class="ident" id="5263409">ok</span>&nbsp;<span class="builtintype" id="5263412">bool</span><span class="op" id="5263416">)</span>&nbsp;<span class="op" id="5263418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263421">z</span><span class="op" id="5263422">.</span><span class="ident" id="5263423">multistream</span>&nbsp;<span class="op" id="5263435">=</span>&nbsp;<span class="ident" id="5263437">ok</span><br>
<span class="lineno"></span><span class="op" id="5263440">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="5263443">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="5263504">func</span>&nbsp;<span class="ident" id="5263509">get4</span><span class="op" id="5263513">(</span><span class="ident" id="5263514">p</span>&nbsp;<span class="op" id="5263516">[</span><span class="op" id="5263517">]</span><span class="builtintype" id="5263518">byte</span><span class="op" id="5263522">)</span>&nbsp;<span class="builtintype" id="5263524">uint32</span>&nbsp;<span class="op" id="5263531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263534">return</span>&nbsp;<span class="builtintype" id="5263541">uint32</span><span class="op" id="5263547">(</span><span class="ident" id="5263548">p</span><span class="op" id="5263549">[</span><span class="num" id="5263550">0</span><span class="op" id="5263551">]</span><span class="op" id="5263552">)</span>&nbsp;<span class="op" id="5263554">|</span>&nbsp;<span class="builtintype" id="5263556">uint32</span><span class="op" id="5263562">(</span><span class="ident" id="5263563">p</span><span class="op" id="5263564">[</span><span class="num" id="5263565">1</span><span class="op" id="5263566">]</span><span class="op" id="5263567">)</span><span class="op" id="5263568">&lt;&lt;</span><span class="num" id="5263570">8</span>&nbsp;<span class="op" id="5263572">|</span>&nbsp;<span class="builtintype" id="5263574">uint32</span><span class="op" id="5263580">(</span><span class="ident" id="5263581">p</span><span class="op" id="5263582">[</span><span class="num" id="5263583">2</span><span class="op" id="5263584">]</span><span class="op" id="5263585">)</span><span class="op" id="5263586">&lt;&lt;</span><span class="num" id="5263588">16</span>&nbsp;<span class="op" id="5263591">|</span>&nbsp;<span class="builtintype" id="5263593">uint32</span><span class="op" id="5263599">(</span><span class="ident" id="5263600">p</span><span class="op" id="5263601">[</span><span class="num" id="5263602">3</span><span class="op" id="5263603">]</span><span class="op" id="5263604">)</span><span class="op" id="5263605">&lt;&lt;</span><span class="num" id="5263607">24</span><br>
<span class="lineno"></span><span class="op" id="5263610">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5263613">func</span>&nbsp;<span class="op" id="5263618">(</span><span class="ident" id="5263619">z</span>&nbsp;<span class="op" id="5263621">*</span><span class="ident" id="5263622">Reader</span><span class="op" id="5263628">)</span>&nbsp;<span class="ident" id="5263630">readString</span><span class="op" id="5263640">(</span><span class="op" id="5263641">)</span>&nbsp;<span class="op" id="5263643">(</span><span class="builtintype" id="5263644">string</span><span class="op" id="5263650">,</span>&nbsp;<span class="builtintype" id="5263652">error</span><span class="op" id="5263657">)</span>&nbsp;<span class="op" id="5263659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263662">var</span>&nbsp;<span class="ident" id="5263666">err</span>&nbsp;<span class="builtintype" id="5263670">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263677">needconv</span>&nbsp;<span class="op" id="5263686">:=</span>&nbsp;<span class="builtintype" id="5263689">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263696">for</span>&nbsp;<span class="ident" id="5263700">i</span>&nbsp;<span class="op" id="5263702">:=</span>&nbsp;<span class="num" id="5263705">0</span><span class="op" id="5263706">;</span>&nbsp;<span class="op" id="5263708">;</span>&nbsp;<span class="ident" id="5263710">i</span><span class="op" id="5263711">++</span>&nbsp;<span class="op" id="5263714">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263718">if</span>&nbsp;<span class="ident" id="5263721">i</span>&nbsp;<span class="op" id="5263723">&gt;=</span>&nbsp;<span class="builtinfunc" id="5263726">len</span><span class="op" id="5263729">(</span><span class="ident" id="5263730">z</span><span class="op" id="5263731">.</span><span class="ident" id="5263732">buf</span><span class="op" id="5263735">)</span>&nbsp;<span class="op" id="5263737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263742">return</span>&nbsp;<span class="string" id="5263749">&#34;&#34;</span><span class="op" id="5263751">,</span>&nbsp;<span class="ident" id="5263753">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263769">z</span><span class="op" id="5263770">.</span><span class="ident" id="5263771">buf</span><span class="op" id="5263774">[</span><span class="ident" id="5263775">i</span><span class="op" id="5263776">]</span><span class="op" id="5263777">,</span>&nbsp;<span class="ident" id="5263779">err</span>&nbsp;<span class="op" id="5263783">=</span>&nbsp;<span class="ident" id="5263785">z</span><span class="op" id="5263786">.</span><span class="ident" id="5263787">r</span><span class="op" id="5263788">.</span><span class="ident" id="5263789">ReadByte</span><span class="op" id="5263797">(</span><span class="op" id="5263798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263802">if</span>&nbsp;<span class="ident" id="5263805">err</span>&nbsp;<span class="op" id="5263809">!=</span>&nbsp;<span class="ident" id="5263812">nil</span>&nbsp;<span class="op" id="5263816">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263821">return</span>&nbsp;<span class="string" id="5263828">&#34;&#34;</span><span class="op" id="5263830">,</span>&nbsp;<span class="ident" id="5263832">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263842">if</span>&nbsp;<span class="ident" id="5263845">z</span><span class="op" id="5263846">.</span><span class="ident" id="5263847">buf</span><span class="op" id="5263850">[</span><span class="ident" id="5263851">i</span><span class="op" id="5263852">]</span>&nbsp;<span class="op" id="5263854">&gt;</span>&nbsp;<span class="num" id="5263856">0x7f</span>&nbsp;<span class="op" id="5263861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263866">needconv</span>&nbsp;<span class="op" id="5263875">=</span>&nbsp;<span class="builtintype" id="5263877">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263884">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263888">if</span>&nbsp;<span class="ident" id="5263891">z</span><span class="op" id="5263892">.</span><span class="ident" id="5263893">buf</span><span class="op" id="5263896">[</span><span class="ident" id="5263897">i</span><span class="op" id="5263898">]</span>&nbsp;<span class="op" id="5263900">==</span>&nbsp;<span class="num" id="5263903">0</span>&nbsp;<span class="op" id="5263905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263910">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263996">if</span>&nbsp;<span class="ident" id="5263999">needconv</span>&nbsp;<span class="op" id="5264008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264014">s</span>&nbsp;<span class="op" id="5264016">:=</span>&nbsp;<span class="builtinfunc" id="5264019">make</span><span class="op" id="5264023">(</span><span class="op" id="5264024">[</span><span class="op" id="5264025">]</span><span class="builtintype" id="5264026">rune</span><span class="op" id="5264030">,</span>&nbsp;<span class="num" id="5264032">0</span><span class="op" id="5264033">,</span>&nbsp;<span class="ident" id="5264035">i</span><span class="op" id="5264036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264042">for</span>&nbsp;<span class="ident" id="5264046">_</span><span class="op" id="5264047">,</span>&nbsp;<span class="ident" id="5264049">v</span>&nbsp;<span class="op" id="5264051">:=</span>&nbsp;<span class="keyword" id="5264054">range</span>&nbsp;<span class="ident" id="5264060">z</span><span class="op" id="5264061">.</span><span class="ident" id="5264062">buf</span><span class="op" id="5264065">[</span><span class="num" id="5264066">0</span><span class="op" id="5264067">:</span><span class="ident" id="5264068">i</span><span class="op" id="5264069">]</span>&nbsp;<span class="op" id="5264071">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264078">s</span>&nbsp;<span class="op" id="5264080">=</span>&nbsp;<span class="builtinfunc" id="5264082">append</span><span class="op" id="5264088">(</span><span class="ident" id="5264089">s</span><span class="op" id="5264090">,</span>&nbsp;<span class="builtintype" id="5264092">rune</span><span class="op" id="5264096">(</span><span class="ident" id="5264097">v</span><span class="op" id="5264098">)</span><span class="op" id="5264099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264111">return</span>&nbsp;<span class="builtintype" id="5264118">string</span><span class="op" id="5264124">(</span><span class="ident" id="5264125">s</span><span class="op" id="5264126">)</span><span class="op" id="5264127">,</span>&nbsp;<span class="ident" id="5264129">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264141">return</span>&nbsp;<span class="builtintype" id="5264148">string</span><span class="op" id="5264154">(</span><span class="ident" id="5264155">z</span><span class="op" id="5264156">.</span><span class="ident" id="5264157">buf</span><span class="op" id="5264160">[</span><span class="num" id="5264161">0</span><span class="op" id="5264162">:</span><span class="ident" id="5264163">i</span><span class="op" id="5264164">]</span><span class="op" id="5264165">)</span><span class="op" id="5264166">,</span>&nbsp;<span class="ident" id="5264168">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264177">}</span><br>
<span class="lineno"></span><span class="op" id="5264179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5264182">func</span>&nbsp;<span class="op" id="5264187">(</span><span class="ident" id="5264188">z</span>&nbsp;<span class="op" id="5264190">*</span><span class="ident" id="5264191">Reader</span><span class="op" id="5264197">)</span>&nbsp;<span class="ident" id="5264199">read2</span><span class="op" id="5264204">(</span><span class="op" id="5264205">)</span>&nbsp;<span class="op" id="5264207">(</span><span class="builtintype" id="5264208">uint32</span><span class="op" id="5264214">,</span>&nbsp;<span class="builtintype" id="5264216">error</span><span class="op" id="5264221">)</span>&nbsp;<span class="op" id="5264223">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264226">_</span><span class="op" id="5264227">,</span>&nbsp;<span class="ident" id="5264229">err</span>&nbsp;<span class="op" id="5264233">:=</span>&nbsp;<span class="ident" id="5264236">io</span><span class="op" id="5264238">.</span><span class="ident" id="5264239">ReadFull</span><span class="op" id="5264247">(</span><span class="ident" id="5264248">z</span><span class="op" id="5264249">.</span><span class="ident" id="5264250">r</span><span class="op" id="5264251">,</span>&nbsp;<span class="ident" id="5264253">z</span><span class="op" id="5264254">.</span><span class="ident" id="5264255">buf</span><span class="op" id="5264258">[</span><span class="num" id="5264259">0</span><span class="op" id="5264260">:</span><span class="num" id="5264261">2</span><span class="op" id="5264262">]</span><span class="op" id="5264263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264266">if</span>&nbsp;<span class="ident" id="5264269">err</span>&nbsp;<span class="op" id="5264273">!=</span>&nbsp;<span class="ident" id="5264276">nil</span>&nbsp;<span class="op" id="5264280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264284">return</span>&nbsp;<span class="num" id="5264291">0</span><span class="op" id="5264292">,</span>&nbsp;<span class="ident" id="5264294">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264302">return</span>&nbsp;<span class="builtintype" id="5264309">uint32</span><span class="op" id="5264315">(</span><span class="ident" id="5264316">z</span><span class="op" id="5264317">.</span><span class="ident" id="5264318">buf</span><span class="op" id="5264321">[</span><span class="num" id="5264322">0</span><span class="op" id="5264323">]</span><span class="op" id="5264324">)</span>&nbsp;<span class="op" id="5264326">|</span>&nbsp;<span class="builtintype" id="5264328">uint32</span><span class="op" id="5264334">(</span><span class="ident" id="5264335">z</span><span class="op" id="5264336">.</span><span class="ident" id="5264337">buf</span><span class="op" id="5264340">[</span><span class="num" id="5264341">1</span><span class="op" id="5264342">]</span><span class="op" id="5264343">)</span><span class="op" id="5264344">&lt;&lt;</span><span class="num" id="5264346">8</span><span class="op" id="5264347">,</span>&nbsp;<span class="ident" id="5264349">nil</span><br>
<span class="lineno">170</span><span class="op" id="5264353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5264356">func</span>&nbsp;<span class="op" id="5264361">(</span><span class="ident" id="5264362">z</span>&nbsp;<span class="op" id="5264364">*</span><span class="ident" id="5264365">Reader</span><span class="op" id="5264371">)</span>&nbsp;<span class="ident" id="5264373">readHeader</span><span class="op" id="5264383">(</span><span class="ident" id="5264384">save</span>&nbsp;<span class="builtintype" id="5264389">bool</span><span class="op" id="5264393">)</span>&nbsp;<span class="builtintype" id="5264395">error</span>&nbsp;<span class="op" id="5264401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264404">_</span><span class="op" id="5264405">,</span>&nbsp;<span class="ident" id="5264407">err</span>&nbsp;<span class="op" id="5264411">:=</span>&nbsp;<span class="ident" id="5264414">io</span><span class="op" id="5264416">.</span><span class="ident" id="5264417">ReadFull</span><span class="op" id="5264425">(</span><span class="ident" id="5264426">z</span><span class="op" id="5264427">.</span><span class="ident" id="5264428">r</span><span class="op" id="5264429">,</span>&nbsp;<span class="ident" id="5264431">z</span><span class="op" id="5264432">.</span><span class="ident" id="5264433">buf</span><span class="op" id="5264436">[</span><span class="num" id="5264437">0</span><span class="op" id="5264438">:</span><span class="num" id="5264439">10</span><span class="op" id="5264441">]</span><span class="op" id="5264442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264445">if</span>&nbsp;<span class="ident" id="5264448">err</span>&nbsp;<span class="op" id="5264452">!=</span>&nbsp;<span class="ident" id="5264455">nil</span>&nbsp;<span class="op" id="5264459">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264463">return</span>&nbsp;<span class="ident" id="5264470">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264478">if</span>&nbsp;<span class="ident" id="5264481">z</span><span class="op" id="5264482">.</span><span class="ident" id="5264483">buf</span><span class="op" id="5264486">[</span><span class="num" id="5264487">0</span><span class="op" id="5264488">]</span>&nbsp;<span class="op" id="5264490">!=</span>&nbsp;<span class="ident" id="5264493">gzipID1</span>&nbsp;<span class="op" id="5264501">||</span>&nbsp;<span class="ident" id="5264504">z</span><span class="op" id="5264505">.</span><span class="ident" id="5264506">buf</span><span class="op" id="5264509">[</span><span class="num" id="5264510">1</span><span class="op" id="5264511">]</span>&nbsp;<span class="op" id="5264513">!=</span>&nbsp;<span class="ident" id="5264516">gzipID2</span>&nbsp;<span class="op" id="5264524">||</span>&nbsp;<span class="ident" id="5264527">z</span><span class="op" id="5264528">.</span><span class="ident" id="5264529">buf</span><span class="op" id="5264532">[</span><span class="num" id="5264533">2</span><span class="op" id="5264534">]</span>&nbsp;<span class="op" id="5264536">!=</span>&nbsp;<span class="ident" id="5264539">gzipDeflate</span>&nbsp;<span class="op" id="5264551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264555">return</span>&nbsp;<span class="ident" id="5264562">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264573">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264576">z</span><span class="op" id="5264577">.</span><span class="ident" id="5264578">flg</span>&nbsp;<span class="op" id="5264582">=</span>&nbsp;<span class="ident" id="5264584">z</span><span class="op" id="5264585">.</span><span class="ident" id="5264586">buf</span><span class="op" id="5264589">[</span><span class="num" id="5264590">3</span><span class="op" id="5264591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264594">if</span>&nbsp;<span class="ident" id="5264597">save</span>&nbsp;<span class="op" id="5264602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264606">z</span><span class="op" id="5264607">.</span><span class="ident" id="5264608">ModTime</span>&nbsp;<span class="op" id="5264616">=</span>&nbsp;<span class="ident" id="5264618">time</span><span class="op" id="5264622">.</span><span class="ident" id="5264623">Unix</span><span class="op" id="5264627">(</span><span class="ident" id="5264628">int64</span><span class="op" id="5264633">(</span><span class="ident" id="5264634">get4</span><span class="op" id="5264638">(</span><span class="ident" id="5264639">z</span><span class="op" id="5264640">.</span><span class="ident" id="5264641">buf</span><span class="op" id="5264644">[</span><span class="num" id="5264645">4</span><span class="op" id="5264646">:</span><span class="num" id="5264647">8</span><span class="op" id="5264648">]</span><span class="op" id="5264649">)</span><span class="op" id="5264650">)</span><span class="op" id="5264651">,</span>&nbsp;<span class="num" id="5264653">0</span><span class="op" id="5264654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264658">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264688">z</span><span class="op" id="5264689">.</span><span class="ident" id="5264690">OS</span>&nbsp;<span class="op" id="5264693">=</span>&nbsp;<span class="ident" id="5264695">z</span><span class="op" id="5264696">.</span><span class="ident" id="5264697">buf</span><span class="op" id="5264700">[</span><span class="num" id="5264701">9</span><span class="op" id="5264702">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264708">z</span><span class="op" id="5264709">.</span><span class="ident" id="5264710">digest</span><span class="op" id="5264716">.</span><span class="ident" id="5264717">Reset</span><span class="op" id="5264722">(</span><span class="op" id="5264723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264726">z</span><span class="op" id="5264727">.</span><span class="ident" id="5264728">digest</span><span class="op" id="5264734">.</span><span class="ident" id="5264735">Write</span><span class="op" id="5264740">(</span><span class="ident" id="5264741">z</span><span class="op" id="5264742">.</span><span class="ident" id="5264743">buf</span><span class="op" id="5264746">[</span><span class="num" id="5264747">0</span><span class="op" id="5264748">:</span><span class="num" id="5264749">10</span><span class="op" id="5264751">]</span><span class="op" id="5264752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264756">if</span>&nbsp;<span class="ident" id="5264759">z</span><span class="op" id="5264760">.</span><span class="ident" id="5264761">flg</span><span class="op" id="5264764">&amp;</span><span class="ident" id="5264765">flagExtra</span>&nbsp;<span class="op" id="5264775">!=</span>&nbsp;<span class="num" id="5264778">0</span>&nbsp;<span class="op" id="5264780">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264784">n</span><span class="op" id="5264785">,</span>&nbsp;<span class="ident" id="5264787">err</span>&nbsp;<span class="op" id="5264791">:=</span>&nbsp;<span class="ident" id="5264794">z</span><span class="op" id="5264795">.</span><span class="ident" id="5264796">read2</span><span class="op" id="5264801">(</span><span class="op" id="5264802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264806">if</span>&nbsp;<span class="ident" id="5264809">err</span>&nbsp;<span class="op" id="5264813">!=</span>&nbsp;<span class="ident" id="5264816">nil</span>&nbsp;<span class="op" id="5264820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264825">return</span>&nbsp;<span class="ident" id="5264832">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264842">data</span>&nbsp;<span class="op" id="5264847">:=</span>&nbsp;<span class="builtinfunc" id="5264850">make</span><span class="op" id="5264854">(</span><span class="op" id="5264855">[</span><span class="op" id="5264856">]</span><span class="builtintype" id="5264857">byte</span><span class="op" id="5264861">,</span>&nbsp;<span class="ident" id="5264863">n</span><span class="op" id="5264864">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264868">if</span>&nbsp;<span class="ident" id="5264871">_</span><span class="op" id="5264872">,</span>&nbsp;<span class="ident" id="5264874">err</span>&nbsp;<span class="op" id="5264878">=</span>&nbsp;<span class="ident" id="5264880">io</span><span class="op" id="5264882">.</span><span class="ident" id="5264883">ReadFull</span><span class="op" id="5264891">(</span><span class="ident" id="5264892">z</span><span class="op" id="5264893">.</span><span class="ident" id="5264894">r</span><span class="op" id="5264895">,</span>&nbsp;<span class="ident" id="5264897">data</span><span class="op" id="5264901">)</span><span class="op" id="5264902">;</span>&nbsp;<span class="ident" id="5264904">err</span>&nbsp;<span class="op" id="5264908">!=</span>&nbsp;<span class="ident" id="5264911">nil</span>&nbsp;<span class="op" id="5264915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264920">return</span>&nbsp;<span class="ident" id="5264927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264937">if</span>&nbsp;<span class="ident" id="5264940">save</span>&nbsp;<span class="op" id="5264945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264950">z</span><span class="op" id="5264951">.</span><span class="ident" id="5264952">Extra</span>&nbsp;<span class="op" id="5264958">=</span>&nbsp;<span class="ident" id="5264960">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264974">var</span>&nbsp;<span class="ident" id="5264978">s</span>&nbsp;<span class="builtintype" id="5264980">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264988">if</span>&nbsp;<span class="ident" id="5264991">z</span><span class="op" id="5264992">.</span><span class="ident" id="5264993">flg</span><span class="op" id="5264996">&amp;</span><span class="ident" id="5264997">flagName</span>&nbsp;<span class="op" id="5265006">!=</span>&nbsp;<span class="num" id="5265009">0</span>&nbsp;<span class="op" id="5265011">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265015">if</span>&nbsp;<span class="ident" id="5265018">s</span><span class="op" id="5265019">,</span>&nbsp;<span class="ident" id="5265021">err</span>&nbsp;<span class="op" id="5265025">=</span>&nbsp;<span class="ident" id="5265027">z</span><span class="op" id="5265028">.</span><span class="ident" id="5265029">readString</span><span class="op" id="5265039">(</span><span class="op" id="5265040">)</span><span class="op" id="5265041">;</span>&nbsp;<span class="ident" id="5265043">err</span>&nbsp;<span class="op" id="5265047">!=</span>&nbsp;<span class="ident" id="5265050">nil</span>&nbsp;<span class="op" id="5265054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265059">return</span>&nbsp;<span class="ident" id="5265066">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265076">if</span>&nbsp;<span class="ident" id="5265079">save</span>&nbsp;<span class="op" id="5265084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265089">z</span><span class="op" id="5265090">.</span><span class="ident" id="5265091">Name</span>&nbsp;<span class="op" id="5265096">=</span>&nbsp;<span class="ident" id="5265098">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265109">if</span>&nbsp;<span class="ident" id="5265112">z</span><span class="op" id="5265113">.</span><span class="ident" id="5265114">flg</span><span class="op" id="5265117">&amp;</span><span class="ident" id="5265118">flagComment</span>&nbsp;<span class="op" id="5265130">!=</span>&nbsp;<span class="num" id="5265133">0</span>&nbsp;<span class="op" id="5265135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265139">if</span>&nbsp;<span class="ident" id="5265142">s</span><span class="op" id="5265143">,</span>&nbsp;<span class="ident" id="5265145">err</span>&nbsp;<span class="op" id="5265149">=</span>&nbsp;<span class="ident" id="5265151">z</span><span class="op" id="5265152">.</span><span class="ident" id="5265153">readString</span><span class="op" id="5265163">(</span><span class="op" id="5265164">)</span><span class="op" id="5265165">;</span>&nbsp;<span class="ident" id="5265167">err</span>&nbsp;<span class="op" id="5265171">!=</span>&nbsp;<span class="ident" id="5265174">nil</span>&nbsp;<span class="op" id="5265178">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265183">return</span>&nbsp;<span class="ident" id="5265190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265200">if</span>&nbsp;<span class="ident" id="5265203">save</span>&nbsp;<span class="op" id="5265208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265213">z</span><span class="op" id="5265214">.</span><span class="ident" id="5265215">Comment</span>&nbsp;<span class="op" id="5265223">=</span>&nbsp;<span class="ident" id="5265225">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265229">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265236">if</span>&nbsp;<span class="ident" id="5265239">z</span><span class="op" id="5265240">.</span><span class="ident" id="5265241">flg</span><span class="op" id="5265244">&amp;</span><span class="ident" id="5265245">flagHdrCrc</span>&nbsp;<span class="op" id="5265256">!=</span>&nbsp;<span class="num" id="5265259">0</span>&nbsp;<span class="op" id="5265261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265265">n</span><span class="op" id="5265266">,</span>&nbsp;<span class="ident" id="5265268">err</span>&nbsp;<span class="op" id="5265272">:=</span>&nbsp;<span class="ident" id="5265275">z</span><span class="op" id="5265276">.</span><span class="ident" id="5265277">read2</span><span class="op" id="5265282">(</span><span class="op" id="5265283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265287">if</span>&nbsp;<span class="ident" id="5265290">err</span>&nbsp;<span class="op" id="5265294">!=</span>&nbsp;<span class="ident" id="5265297">nil</span>&nbsp;<span class="op" id="5265301">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265306">return</span>&nbsp;<span class="ident" id="5265313">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265323">sum</span>&nbsp;<span class="op" id="5265327">:=</span>&nbsp;<span class="ident" id="5265330">z</span><span class="op" id="5265331">.</span><span class="ident" id="5265332">digest</span><span class="op" id="5265338">.</span><span class="ident" id="5265339">Sum32</span><span class="op" id="5265344">(</span><span class="op" id="5265345">)</span>&nbsp;<span class="op" id="5265347">&amp;</span>&nbsp;<span class="num" id="5265349">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265358">if</span>&nbsp;<span class="ident" id="5265361">n</span>&nbsp;<span class="op" id="5265363">!=</span>&nbsp;<span class="ident" id="5265366">sum</span>&nbsp;<span class="op" id="5265370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265375">return</span>&nbsp;<span class="ident" id="5265382">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265401">z</span><span class="op" id="5265402">.</span><span class="ident" id="5265403">digest</span><span class="op" id="5265409">.</span><span class="ident" id="5265410">Reset</span><span class="op" id="5265415">(</span><span class="op" id="5265416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265419">if</span>&nbsp;<span class="ident" id="5265422">z</span><span class="op" id="5265423">.</span><span class="ident" id="5265424">decompressor</span>&nbsp;<span class="op" id="5265437">==</span>&nbsp;<span class="ident" id="5265440">nil</span>&nbsp;<span class="op" id="5265444">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265448">z</span><span class="op" id="5265449">.</span><span class="ident" id="5265450">decompressor</span>&nbsp;<span class="op" id="5265463">=</span>&nbsp;<span class="ident" id="5265465">flate</span><span class="op" id="5265470">.</span><span class="ident" id="5265471">NewReader</span><span class="op" id="5265480">(</span><span class="ident" id="5265481">z</span><span class="op" id="5265482">.</span><span class="ident" id="5265483">r</span><span class="op" id="5265484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265487">}</span>&nbsp;<span class="keyword" id="5265489">else</span>&nbsp;<span class="op" id="5265494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265498">z</span><span class="op" id="5265499">.</span><span class="ident" id="5265500">decompressor</span><span class="op" id="5265512">.</span><span class="op" id="5265513">(</span><span class="ident" id="5265514">flate</span><span class="op" id="5265519">.</span><span class="ident" id="5265520">Resetter</span><span class="op" id="5265528">)</span><span class="op" id="5265529">.</span><span class="ident" id="5265530">Reset</span><span class="op" id="5265535">(</span><span class="ident" id="5265536">z</span><span class="op" id="5265537">.</span><span class="ident" id="5265538">r</span><span class="op" id="5265539">,</span>&nbsp;<span class="ident" id="5265541">nil</span><span class="op" id="5265544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265550">return</span>&nbsp;<span class="ident" id="5265557">nil</span><br>
<span class="lineno">240</span><span class="op" id="5265561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5265564">func</span>&nbsp;<span class="op" id="5265569">(</span><span class="ident" id="5265570">z</span>&nbsp;<span class="op" id="5265572">*</span><span class="ident" id="5265573">Reader</span><span class="op" id="5265579">)</span>&nbsp;<span class="ident" id="5265581">Read</span><span class="op" id="5265585">(</span><span class="ident" id="5265586">p</span>&nbsp;<span class="op" id="5265588">[</span><span class="op" id="5265589">]</span><span class="builtintype" id="5265590">byte</span><span class="op" id="5265594">)</span>&nbsp;<span class="op" id="5265596">(</span><span class="ident" id="5265597">n</span>&nbsp;<span class="builtintype" id="5265599">int</span><span class="op" id="5265602">,</span>&nbsp;<span class="ident" id="5265604">err</span>&nbsp;<span class="builtintype" id="5265608">error</span><span class="op" id="5265613">)</span>&nbsp;<span class="op" id="5265615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265618">if</span>&nbsp;<span class="ident" id="5265621">z</span><span class="op" id="5265622">.</span><span class="ident" id="5265623">err</span>&nbsp;<span class="op" id="5265627">!=</span>&nbsp;<span class="ident" id="5265630">nil</span>&nbsp;<span class="op" id="5265634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265638">return</span>&nbsp;<span class="num" id="5265645">0</span><span class="op" id="5265646">,</span>&nbsp;<span class="ident" id="5265648">z</span><span class="op" id="5265649">.</span><span class="ident" id="5265650">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265658">if</span>&nbsp;<span class="builtinfunc" id="5265661">len</span><span class="op" id="5265664">(</span><span class="ident" id="5265665">p</span><span class="op" id="5265666">)</span>&nbsp;<span class="op" id="5265668">==</span>&nbsp;<span class="num" id="5265671">0</span>&nbsp;<span class="op" id="5265673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265677">return</span>&nbsp;<span class="num" id="5265684">0</span><span class="op" id="5265685">,</span>&nbsp;<span class="ident" id="5265687">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265696">n</span><span class="op" id="5265697">,</span>&nbsp;<span class="ident" id="5265699">err</span>&nbsp;<span class="op" id="5265703">=</span>&nbsp;<span class="ident" id="5265705">z</span><span class="op" id="5265706">.</span><span class="ident" id="5265707">decompressor</span><span class="op" id="5265719">.</span><span class="ident" id="5265720">Read</span><span class="op" id="5265724">(</span><span class="ident" id="5265725">p</span><span class="op" id="5265726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265729">z</span><span class="op" id="5265730">.</span><span class="ident" id="5265731">digest</span><span class="op" id="5265737">.</span><span class="ident" id="5265738">Write</span><span class="op" id="5265743">(</span><span class="ident" id="5265744">p</span><span class="op" id="5265745">[</span><span class="num" id="5265746">0</span><span class="op" id="5265747">:</span><span class="ident" id="5265748">n</span><span class="op" id="5265749">]</span><span class="op" id="5265750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265753">z</span><span class="op" id="5265754">.</span><span class="ident" id="5265755">size</span>&nbsp;<span class="op" id="5265760">+=</span>&nbsp;<span class="builtintype" id="5265763">uint32</span><span class="op" id="5265769">(</span><span class="ident" id="5265770">n</span><span class="op" id="5265771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265774">if</span>&nbsp;<span class="ident" id="5265777">n</span>&nbsp;<span class="op" id="5265779">!=</span>&nbsp;<span class="num" id="5265782">0</span>&nbsp;<span class="op" id="5265784">||</span>&nbsp;<span class="ident" id="5265787">err</span>&nbsp;<span class="op" id="5265791">!=</span>&nbsp;<span class="ident" id="5265794">io</span><span class="op" id="5265796">.</span><span class="ident" id="5265797">EOF</span>&nbsp;<span class="op" id="5265801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265805">z</span><span class="op" id="5265806">.</span><span class="ident" id="5265807">err</span>&nbsp;<span class="op" id="5265811">=</span>&nbsp;<span class="ident" id="5265813">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265819">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265831">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265873">if</span>&nbsp;<span class="ident" id="5265876">_</span><span class="op" id="5265877">,</span>&nbsp;<span class="ident" id="5265879">err</span>&nbsp;<span class="op" id="5265883">:=</span>&nbsp;<span class="ident" id="5265886">io</span><span class="op" id="5265888">.</span><span class="ident" id="5265889">ReadFull</span><span class="op" id="5265897">(</span><span class="ident" id="5265898">z</span><span class="op" id="5265899">.</span><span class="ident" id="5265900">r</span><span class="op" id="5265901">,</span>&nbsp;<span class="ident" id="5265903">z</span><span class="op" id="5265904">.</span><span class="ident" id="5265905">buf</span><span class="op" id="5265908">[</span><span class="num" id="5265909">0</span><span class="op" id="5265910">:</span><span class="num" id="5265911">8</span><span class="op" id="5265912">]</span><span class="op" id="5265913">)</span><span class="op" id="5265914">;</span>&nbsp;<span class="ident" id="5265916">err</span>&nbsp;<span class="op" id="5265920">!=</span>&nbsp;<span class="ident" id="5265923">nil</span>&nbsp;<span class="op" id="5265927">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265931">z</span><span class="op" id="5265932">.</span><span class="ident" id="5265933">err</span>&nbsp;<span class="op" id="5265937">=</span>&nbsp;<span class="ident" id="5265939">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265945">return</span>&nbsp;<span class="num" id="5265952">0</span><span class="op" id="5265953">,</span>&nbsp;<span class="ident" id="5265955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265963">crc32</span><span class="op" id="5265968">,</span>&nbsp;<span class="ident" id="5265970">isize</span>&nbsp;<span class="op" id="5265976">:=</span>&nbsp;<span class="ident" id="5265979">get4</span><span class="op" id="5265983">(</span><span class="ident" id="5265984">z</span><span class="op" id="5265985">.</span><span class="ident" id="5265986">buf</span><span class="op" id="5265989">[</span><span class="num" id="5265990">0</span><span class="op" id="5265991">:</span><span class="num" id="5265992">4</span><span class="op" id="5265993">]</span><span class="op" id="5265994">)</span><span class="op" id="5265995">,</span>&nbsp;<span class="ident" id="5265997">get4</span><span class="op" id="5266001">(</span><span class="ident" id="5266002">z</span><span class="op" id="5266003">.</span><span class="ident" id="5266004">buf</span><span class="op" id="5266007">[</span><span class="num" id="5266008">4</span><span class="op" id="5266009">:</span><span class="num" id="5266010">8</span><span class="op" id="5266011">]</span><span class="op" id="5266012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266015">sum</span>&nbsp;<span class="op" id="5266019">:=</span>&nbsp;<span class="ident" id="5266022">z</span><span class="op" id="5266023">.</span><span class="ident" id="5266024">digest</span><span class="op" id="5266030">.</span><span class="ident" id="5266031">Sum32</span><span class="op" id="5266036">(</span><span class="op" id="5266037">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266040">if</span>&nbsp;<span class="ident" id="5266043">sum</span>&nbsp;<span class="op" id="5266047">!=</span>&nbsp;<span class="ident" id="5266050">crc32</span>&nbsp;<span class="op" id="5266056">||</span>&nbsp;<span class="ident" id="5266059">isize</span>&nbsp;<span class="op" id="5266065">!=</span>&nbsp;<span class="ident" id="5266068">z</span><span class="op" id="5266069">.</span><span class="ident" id="5266070">size</span>&nbsp;<span class="op" id="5266075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266079">z</span><span class="op" id="5266080">.</span><span class="ident" id="5266081">err</span>&nbsp;<span class="op" id="5266085">=</span>&nbsp;<span class="ident" id="5266087">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266101">return</span>&nbsp;<span class="num" id="5266108">0</span><span class="op" id="5266109">,</span>&nbsp;<span class="ident" id="5266111">z</span><span class="op" id="5266112">.</span><span class="ident" id="5266113">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266122">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266156">if</span>&nbsp;<span class="op" id="5266159">!</span><span class="ident" id="5266160">z</span><span class="op" id="5266161">.</span><span class="ident" id="5266162">multistream</span>&nbsp;<span class="op" id="5266174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266178">return</span>&nbsp;<span class="num" id="5266185">0</span><span class="op" id="5266186">,</span>&nbsp;<span class="ident" id="5266188">io</span><span class="op" id="5266190">.</span><span class="ident" id="5266191">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266200">if</span>&nbsp;<span class="ident" id="5266203">err</span>&nbsp;<span class="op" id="5266207">=</span>&nbsp;<span class="ident" id="5266209">z</span><span class="op" id="5266210">.</span><span class="ident" id="5266211">readHeader</span><span class="op" id="5266221">(</span><span class="builtintype" id="5266222">false</span><span class="op" id="5266227">)</span><span class="op" id="5266228">;</span>&nbsp;<span class="ident" id="5266230">err</span>&nbsp;<span class="op" id="5266234">!=</span>&nbsp;<span class="ident" id="5266237">nil</span>&nbsp;<span class="op" id="5266241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266245">z</span><span class="op" id="5266246">.</span><span class="ident" id="5266247">err</span>&nbsp;<span class="op" id="5266251">=</span>&nbsp;<span class="ident" id="5266253">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266259">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266271">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266305">z</span><span class="op" id="5266306">.</span><span class="ident" id="5266307">digest</span><span class="op" id="5266313">.</span><span class="ident" id="5266314">Reset</span><span class="op" id="5266319">(</span><span class="op" id="5266320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266323">z</span><span class="op" id="5266324">.</span><span class="ident" id="5266325">size</span>&nbsp;<span class="op" id="5266330">=</span>&nbsp;<span class="num" id="5266332">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266335">return</span>&nbsp;<span class="ident" id="5266342">z</span><span class="op" id="5266343">.</span><span class="ident" id="5266344">Read</span><span class="op" id="5266348">(</span><span class="ident" id="5266349">p</span><span class="op" id="5266350">)</span><br>
<span class="lineno"></span><span class="op" id="5266352">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="5266355">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="5266427">func</span>&nbsp;<span class="op" id="5266432">(</span><span class="ident" id="5266433">z</span>&nbsp;<span class="op" id="5266435">*</span><span class="ident" id="5266436">Reader</span><span class="op" id="5266442">)</span>&nbsp;<span class="ident" id="5266444">Close</span><span class="op" id="5266449">(</span><span class="op" id="5266450">)</span>&nbsp;<span class="builtintype" id="5266452">error</span>&nbsp;<span class="op" id="5266458">{</span>&nbsp;<span class="keyword" id="5266460">return</span>&nbsp;<span class="ident" id="5266467">z</span><span class="op" id="5266468">.</span><span class="ident" id="5266469">decompressor</span><span class="op" id="5266481">.</span><span class="ident" id="5266482">Close</span><span class="op" id="5266487">(</span><span class="op" id="5266488">)</span>&nbsp;<span class="op" id="5266490">}</span>
</div>
</body>
</html>
