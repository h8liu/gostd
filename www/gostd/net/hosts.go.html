<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html" class="current">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3907844">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3907899">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3907953">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3908004">//&nbsp;Read&nbsp;static&nbsp;host/IP&nbsp;entries&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3908053">package</span>&nbsp;<span class="ident" id="3908061">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3908066">import</span>&nbsp;<span class="op" id="3908073">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3908076">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3908084">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3908091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3908094">const</span>&nbsp;<span class="ident" id="3908100">cacheMaxAge</span>&nbsp;<span class="op" id="3908112">=</span>&nbsp;<span class="num" id="3908114">5</span>&nbsp;<span class="op" id="3908116">*</span>&nbsp;<span class="ident" id="3908118">time</span><span class="op" id="3908122">.</span><span class="ident" id="3908123">Minute</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3908131">//&nbsp;hostsPath&nbsp;points&nbsp;to&nbsp;the&nbsp;file&nbsp;with&nbsp;static&nbsp;IP/address&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3908195">var</span>&nbsp;<span class="ident" id="3908199">hostsPath</span>&nbsp;<span class="op" id="3908209">=</span>&nbsp;<span class="string" id="3908211">&#34;/etc/hosts&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3908225">//&nbsp;Simple&nbsp;cache.</span><br>
<span class="lineno">20</span><span class="keyword" id="3908242">var</span>&nbsp;<span class="ident" id="3908246">hosts</span>&nbsp;<span class="keyword" id="3908252">struct</span>&nbsp;<span class="op" id="3908259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908262">sync</span><span class="op" id="3908266">.</span><span class="ident" id="3908267">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908274">byName</span>&nbsp;<span class="keyword" id="3908281">map</span><span class="op" id="3908284">[</span><span class="builtintype" id="3908285">string</span><span class="op" id="3908291">]</span><span class="op" id="3908292">[</span><span class="op" id="3908293">]</span><span class="builtintype" id="3908294">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908302">byAddr</span>&nbsp;<span class="keyword" id="3908309">map</span><span class="op" id="3908312">[</span><span class="builtintype" id="3908313">string</span><span class="op" id="3908319">]</span><span class="op" id="3908320">[</span><span class="op" id="3908321">]</span><span class="builtintype" id="3908322">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908330">expire</span>&nbsp;<span class="ident" id="3908337">time</span><span class="op" id="3908341">.</span><span class="ident" id="3908342">Time</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908348">path</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3908355">string</span><br>
<span class="lineno"></span><span class="op" id="3908362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3908365">func</span>&nbsp;<span class="ident" id="3908370">readHosts</span><span class="op" id="3908379">(</span><span class="op" id="3908380">)</span>&nbsp;<span class="op" id="3908382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908385">now</span>&nbsp;<span class="op" id="3908389">:=</span>&nbsp;<span class="ident" id="3908392">time</span><span class="op" id="3908396">.</span><span class="ident" id="3908397">Now</span><span class="op" id="3908400">(</span><span class="op" id="3908401">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908404">hp</span>&nbsp;<span class="op" id="3908407">:=</span>&nbsp;<span class="ident" id="3908410">hostsPath</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908421">if</span>&nbsp;<span class="builtinfunc" id="3908424">len</span><span class="op" id="3908427">(</span><span class="ident" id="3908428">hosts</span><span class="op" id="3908433">.</span><span class="ident" id="3908434">byName</span><span class="op" id="3908440">)</span>&nbsp;<span class="op" id="3908442">==</span>&nbsp;<span class="num" id="3908445">0</span>&nbsp;<span class="op" id="3908447">||</span>&nbsp;<span class="ident" id="3908450">now</span><span class="op" id="3908453">.</span><span class="ident" id="3908454">After</span><span class="op" id="3908459">(</span><span class="ident" id="3908460">hosts</span><span class="op" id="3908465">.</span><span class="ident" id="3908466">expire</span><span class="op" id="3908472">)</span>&nbsp;<span class="op" id="3908474">||</span>&nbsp;<span class="ident" id="3908477">hosts</span><span class="op" id="3908482">.</span><span class="ident" id="3908483">path</span>&nbsp;<span class="op" id="3908488">!=</span>&nbsp;<span class="ident" id="3908491">hp</span>&nbsp;<span class="op" id="3908494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908498">hs</span>&nbsp;<span class="op" id="3908501">:=</span>&nbsp;<span class="builtinfunc" id="3908504">make</span><span class="op" id="3908508">(</span><span class="keyword" id="3908509">map</span><span class="op" id="3908512">[</span><span class="builtintype" id="3908513">string</span><span class="op" id="3908519">]</span><span class="op" id="3908520">[</span><span class="op" id="3908521">]</span><span class="builtintype" id="3908522">string</span><span class="op" id="3908528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908532">is</span>&nbsp;<span class="op" id="3908535">:=</span>&nbsp;<span class="builtinfunc" id="3908538">make</span><span class="op" id="3908542">(</span><span class="keyword" id="3908543">map</span><span class="op" id="3908546">[</span><span class="builtintype" id="3908547">string</span><span class="op" id="3908553">]</span><span class="op" id="3908554">[</span><span class="op" id="3908555">]</span><span class="builtintype" id="3908556">string</span><span class="op" id="3908562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908566">var</span>&nbsp;<span class="ident" id="3908570">file</span>&nbsp;<span class="op" id="3908575">*</span><span class="ident" id="3908576">file</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908583">if</span>&nbsp;<span class="ident" id="3908586">file</span><span class="op" id="3908590">,</span>&nbsp;<span class="ident" id="3908592">_</span>&nbsp;<span class="op" id="3908594">=</span>&nbsp;<span class="ident" id="3908596">open</span><span class="op" id="3908600">(</span><span class="ident" id="3908601">hp</span><span class="op" id="3908603">)</span><span class="op" id="3908604">;</span>&nbsp;<span class="ident" id="3908606">file</span>&nbsp;<span class="op" id="3908611">==</span>&nbsp;<span class="builtintype" id="3908614">nil</span>&nbsp;<span class="op" id="3908618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908623">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908636">for</span>&nbsp;<span class="ident" id="3908640">line</span><span class="op" id="3908644">,</span>&nbsp;<span class="ident" id="3908646">ok</span>&nbsp;<span class="op" id="3908649">:=</span>&nbsp;<span class="ident" id="3908652">file</span><span class="op" id="3908656">.</span><span class="ident" id="3908657">readLine</span><span class="op" id="3908665">(</span><span class="op" id="3908666">)</span><span class="op" id="3908667">;</span>&nbsp;<span class="ident" id="3908669">ok</span><span class="op" id="3908671">;</span>&nbsp;<span class="ident" id="3908673">line</span><span class="op" id="3908677">,</span>&nbsp;<span class="ident" id="3908679">ok</span>&nbsp;<span class="op" id="3908682">=</span>&nbsp;<span class="ident" id="3908684">file</span><span class="op" id="3908688">.</span><span class="ident" id="3908689">readLine</span><span class="op" id="3908697">(</span><span class="op" id="3908698">)</span>&nbsp;<span class="op" id="3908700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908705">if</span>&nbsp;<span class="ident" id="3908708">i</span>&nbsp;<span class="op" id="3908710">:=</span>&nbsp;<span class="ident" id="3908713">byteIndex</span><span class="op" id="3908722">(</span><span class="ident" id="3908723">line</span><span class="op" id="3908727">,</span>&nbsp;<span class="string" id="3908729">&#39;#&#39;</span><span class="op" id="3908732">)</span><span class="op" id="3908733">;</span>&nbsp;<span class="ident" id="3908735">i</span>&nbsp;<span class="op" id="3908737">&gt;=</span>&nbsp;<span class="num" id="3908740">0</span>&nbsp;<span class="op" id="3908742">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3908748">//&nbsp;Discard&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908773">line</span>&nbsp;<span class="op" id="3908778">=</span>&nbsp;<span class="ident" id="3908780">line</span><span class="op" id="3908784">[</span><span class="num" id="3908785">0</span><span class="op" id="3908786">:</span><span class="ident" id="3908787">i</span><span class="op" id="3908788">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908798">f</span>&nbsp;<span class="op" id="3908800">:=</span>&nbsp;<span class="ident" id="3908803">getFields</span><span class="op" id="3908812">(</span><span class="ident" id="3908813">line</span><span class="op" id="3908817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908822">if</span>&nbsp;<span class="builtinfunc" id="3908825">len</span><span class="op" id="3908828">(</span><span class="ident" id="3908829">f</span><span class="op" id="3908830">)</span>&nbsp;<span class="op" id="3908832">&lt;</span>&nbsp;<span class="num" id="3908834">2</span>&nbsp;<span class="op" id="3908836">||</span>&nbsp;<span class="ident" id="3908839">ParseIP</span><span class="op" id="3908846">(</span><span class="ident" id="3908847">f</span><span class="op" id="3908848">[</span><span class="num" id="3908849">0</span><span class="op" id="3908850">]</span><span class="op" id="3908851">)</span>&nbsp;<span class="op" id="3908853">==</span>&nbsp;<span class="builtintype" id="3908856">nil</span>&nbsp;<span class="op" id="3908860">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908866">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3908883">for</span>&nbsp;<span class="ident" id="3908887">i</span>&nbsp;<span class="op" id="3908889">:=</span>&nbsp;<span class="num" id="3908892">1</span><span class="op" id="3908893">;</span>&nbsp;<span class="ident" id="3908895">i</span>&nbsp;<span class="op" id="3908897">&lt;</span>&nbsp;<span class="builtinfunc" id="3908899">len</span><span class="op" id="3908902">(</span><span class="ident" id="3908903">f</span><span class="op" id="3908904">)</span><span class="op" id="3908905">;</span>&nbsp;<span class="ident" id="3908907">i</span><span class="op" id="3908908">++</span>&nbsp;<span class="op" id="3908911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908917">h</span>&nbsp;<span class="op" id="3908919">:=</span>&nbsp;<span class="ident" id="3908922">f</span><span class="op" id="3908923">[</span><span class="ident" id="3908924">i</span><span class="op" id="3908925">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908931">hs</span><span class="op" id="3908933">[</span><span class="ident" id="3908934">h</span><span class="op" id="3908935">]</span>&nbsp;<span class="op" id="3908937">=</span>&nbsp;<span class="builtinfunc" id="3908939">append</span><span class="op" id="3908945">(</span><span class="ident" id="3908946">hs</span><span class="op" id="3908948">[</span><span class="ident" id="3908949">h</span><span class="op" id="3908950">]</span><span class="op" id="3908951">,</span>&nbsp;<span class="ident" id="3908953">f</span><span class="op" id="3908954">[</span><span class="num" id="3908955">0</span><span class="op" id="3908956">]</span><span class="op" id="3908957">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3908963">is</span><span class="op" id="3908965">[</span><span class="ident" id="3908966">f</span><span class="op" id="3908967">[</span><span class="num" id="3908968">0</span><span class="op" id="3908969">]</span><span class="op" id="3908970">]</span>&nbsp;<span class="op" id="3908972">=</span>&nbsp;<span class="builtinfunc" id="3908974">append</span><span class="op" id="3908980">(</span><span class="ident" id="3908981">is</span><span class="op" id="3908983">[</span><span class="ident" id="3908984">f</span><span class="op" id="3908985">[</span><span class="num" id="3908986">0</span><span class="op" id="3908987">]</span><span class="op" id="3908988">]</span><span class="op" id="3908989">,</span>&nbsp;<span class="ident" id="3908991">h</span><span class="op" id="3908992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3908997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3909005">//&nbsp;Update&nbsp;the&nbsp;data&nbsp;cache.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909033">hosts</span><span class="op" id="3909038">.</span><span class="ident" id="3909039">expire</span>&nbsp;<span class="op" id="3909046">=</span>&nbsp;<span class="ident" id="3909048">now</span><span class="op" id="3909051">.</span><span class="ident" id="3909052">Add</span><span class="op" id="3909055">(</span><span class="ident" id="3909056">cacheMaxAge</span><span class="op" id="3909067">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909071">hosts</span><span class="op" id="3909076">.</span><span class="ident" id="3909077">path</span>&nbsp;<span class="op" id="3909082">=</span>&nbsp;<span class="ident" id="3909084">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909089">hosts</span><span class="op" id="3909094">.</span><span class="ident" id="3909095">byName</span>&nbsp;<span class="op" id="3909102">=</span>&nbsp;<span class="ident" id="3909104">hs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909109">hosts</span><span class="op" id="3909114">.</span><span class="ident" id="3909115">byAddr</span>&nbsp;<span class="op" id="3909122">=</span>&nbsp;<span class="ident" id="3909124">is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909129">file</span><span class="op" id="3909133">.</span><span class="builtinfunc" id="3909134">close</span><span class="op" id="3909139">(</span><span class="op" id="3909140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909143">}</span><br>
<span class="lineno">60</span><span class="op" id="3909145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3909148">//&nbsp;lookupStaticHost&nbsp;looks&nbsp;up&nbsp;the&nbsp;addresses&nbsp;for&nbsp;the&nbsp;given&nbsp;host&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3909227">func</span>&nbsp;<span class="ident" id="3909232">lookupStaticHost</span><span class="op" id="3909248">(</span><span class="ident" id="3909249">host</span>&nbsp;<span class="builtintype" id="3909254">string</span><span class="op" id="3909260">)</span>&nbsp;<span class="op" id="3909262">[</span><span class="op" id="3909263">]</span><span class="builtintype" id="3909264">string</span>&nbsp;<span class="op" id="3909271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909274">hosts</span><span class="op" id="3909279">.</span><span class="ident" id="3909280">Lock</span><span class="op" id="3909284">(</span><span class="op" id="3909285">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909288">defer</span>&nbsp;<span class="ident" id="3909294">hosts</span><span class="op" id="3909299">.</span><span class="ident" id="3909300">Unlock</span><span class="op" id="3909306">(</span><span class="op" id="3909307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909310">readHosts</span><span class="op" id="3909319">(</span><span class="op" id="3909320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909323">if</span>&nbsp;<span class="builtinfunc" id="3909326">len</span><span class="op" id="3909329">(</span><span class="ident" id="3909330">hosts</span><span class="op" id="3909335">.</span><span class="ident" id="3909336">byName</span><span class="op" id="3909342">)</span>&nbsp;<span class="op" id="3909344">!=</span>&nbsp;<span class="num" id="3909347">0</span>&nbsp;<span class="op" id="3909349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909353">if</span>&nbsp;<span class="ident" id="3909356">ips</span><span class="op" id="3909359">,</span>&nbsp;<span class="ident" id="3909361">ok</span>&nbsp;<span class="op" id="3909364">:=</span>&nbsp;<span class="ident" id="3909367">hosts</span><span class="op" id="3909372">.</span><span class="ident" id="3909373">byName</span><span class="op" id="3909379">[</span><span class="ident" id="3909380">host</span><span class="op" id="3909384">]</span><span class="op" id="3909385">;</span>&nbsp;<span class="ident" id="3909387">ok</span>&nbsp;<span class="op" id="3909390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909395">return</span>&nbsp;<span class="ident" id="3909402">ips</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909414">return</span>&nbsp;<span class="builtintype" id="3909421">nil</span><br>
<span class="lineno"></span><span class="op" id="3909425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="3909428">//&nbsp;lookupStaticAddr&nbsp;looks&nbsp;up&nbsp;the&nbsp;hosts&nbsp;for&nbsp;the&nbsp;given&nbsp;address&nbsp;from&nbsp;/etc/hosts.</span><br>
<span class="lineno"></span><span class="keyword" id="3909506">func</span>&nbsp;<span class="ident" id="3909511">lookupStaticAddr</span><span class="op" id="3909527">(</span><span class="ident" id="3909528">addr</span>&nbsp;<span class="builtintype" id="3909533">string</span><span class="op" id="3909539">)</span>&nbsp;<span class="op" id="3909541">[</span><span class="op" id="3909542">]</span><span class="builtintype" id="3909543">string</span>&nbsp;<span class="op" id="3909550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909553">hosts</span><span class="op" id="3909558">.</span><span class="ident" id="3909559">Lock</span><span class="op" id="3909563">(</span><span class="op" id="3909564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909567">defer</span>&nbsp;<span class="ident" id="3909573">hosts</span><span class="op" id="3909578">.</span><span class="ident" id="3909579">Unlock</span><span class="op" id="3909585">(</span><span class="op" id="3909586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3909589">readHosts</span><span class="op" id="3909598">(</span><span class="op" id="3909599">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909602">if</span>&nbsp;<span class="builtinfunc" id="3909605">len</span><span class="op" id="3909608">(</span><span class="ident" id="3909609">hosts</span><span class="op" id="3909614">.</span><span class="ident" id="3909615">byAddr</span><span class="op" id="3909621">)</span>&nbsp;<span class="op" id="3909623">!=</span>&nbsp;<span class="num" id="3909626">0</span>&nbsp;<span class="op" id="3909628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909632">if</span>&nbsp;<span class="ident" id="3909635">hosts</span><span class="op" id="3909640">,</span>&nbsp;<span class="ident" id="3909642">ok</span>&nbsp;<span class="op" id="3909645">:=</span>&nbsp;<span class="ident" id="3909648">hosts</span><span class="op" id="3909653">.</span><span class="ident" id="3909654">byAddr</span><span class="op" id="3909660">[</span><span class="ident" id="3909661">addr</span><span class="op" id="3909665">]</span><span class="op" id="3909666">;</span>&nbsp;<span class="ident" id="3909668">ok</span>&nbsp;<span class="op" id="3909671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909676">return</span>&nbsp;<span class="ident" id="3909683">hosts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3909694">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3909697">return</span>&nbsp;<span class="builtintype" id="3909704">nil</span><br>
<span class="lineno"></span><span class="op" id="3909708">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
