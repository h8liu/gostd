<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html" class="current">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3754965">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3755020">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3755074">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3755125">//&nbsp;Package&nbsp;subtle&nbsp;implements&nbsp;functions&nbsp;that&nbsp;are&nbsp;often&nbsp;useful&nbsp;in&nbsp;cryptographic</span><br>
<span class="lineno"></span><span class="comment" id="3755203">//&nbsp;code&nbsp;but&nbsp;require&nbsp;careful&nbsp;thought&nbsp;to&nbsp;use&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="keyword" id="3755257">package</span>&nbsp;<span class="ident" id="3755265">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3755273">//&nbsp;ConstantTimeCompare&nbsp;returns&nbsp;1&nbsp;iff&nbsp;the&nbsp;two&nbsp;slices,&nbsp;x</span><br>
<span class="lineno">10</span><span class="comment" id="3755328">//&nbsp;and&nbsp;y,&nbsp;have&nbsp;equal&nbsp;contents.&nbsp;The&nbsp;time&nbsp;taken&nbsp;is&nbsp;a&nbsp;function&nbsp;of&nbsp;the&nbsp;length&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3755405">//&nbsp;the&nbsp;slices&nbsp;and&nbsp;is&nbsp;independent&nbsp;of&nbsp;the&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="3755455">func</span>&nbsp;<span class="ident" id="3755460">ConstantTimeCompare</span><span class="op" id="3755479">(</span><span class="ident" id="3755480">x</span><span class="op" id="3755481">,</span>&nbsp;<span class="ident" id="3755483">y</span>&nbsp;<span class="op" id="3755485">[</span><span class="op" id="3755486">]</span><span class="builtintype" id="3755487">byte</span><span class="op" id="3755491">)</span>&nbsp;<span class="builtintype" id="3755493">int</span>&nbsp;<span class="op" id="3755497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755500">if</span>&nbsp;<span class="builtinfunc" id="3755503">len</span><span class="op" id="3755506">(</span><span class="ident" id="3755507">x</span><span class="op" id="3755508">)</span>&nbsp;<span class="op" id="3755510">!=</span>&nbsp;<span class="builtinfunc" id="3755513">len</span><span class="op" id="3755516">(</span><span class="ident" id="3755517">y</span><span class="op" id="3755518">)</span>&nbsp;<span class="op" id="3755520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755524">return</span>&nbsp;<span class="num" id="3755531">0</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755538">var</span>&nbsp;<span class="ident" id="3755542">v</span>&nbsp;<span class="builtintype" id="3755544">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755551">for</span>&nbsp;<span class="ident" id="3755555">i</span>&nbsp;<span class="op" id="3755557">:=</span>&nbsp;<span class="num" id="3755560">0</span><span class="op" id="3755561">;</span>&nbsp;<span class="ident" id="3755563">i</span>&nbsp;<span class="op" id="3755565">&lt;</span>&nbsp;<span class="builtinfunc" id="3755567">len</span><span class="op" id="3755570">(</span><span class="ident" id="3755571">x</span><span class="op" id="3755572">)</span><span class="op" id="3755573">;</span>&nbsp;<span class="ident" id="3755575">i</span><span class="op" id="3755576">++</span>&nbsp;<span class="op" id="3755579">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755583">v</span>&nbsp;<span class="op" id="3755585">|=</span>&nbsp;<span class="ident" id="3755588">x</span><span class="op" id="3755589">[</span><span class="ident" id="3755590">i</span><span class="op" id="3755591">]</span>&nbsp;<span class="op" id="3755593">^</span>&nbsp;<span class="ident" id="3755595">y</span><span class="op" id="3755596">[</span><span class="ident" id="3755597">i</span><span class="op" id="3755598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3755601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755605">return</span>&nbsp;<span class="ident" id="3755612">ConstantTimeByteEq</span><span class="op" id="3755630">(</span><span class="ident" id="3755631">v</span><span class="op" id="3755632">,</span>&nbsp;<span class="num" id="3755634">0</span><span class="op" id="3755635">)</span><br>
<span class="lineno"></span><span class="op" id="3755637">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="3755640">//&nbsp;ConstantTimeSelect&nbsp;returns&nbsp;x&nbsp;if&nbsp;v&nbsp;is&nbsp;1&nbsp;and&nbsp;y&nbsp;if&nbsp;v&nbsp;is&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="3755699">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3755756">func</span>&nbsp;<span class="ident" id="3755761">ConstantTimeSelect</span><span class="op" id="3755779">(</span><span class="ident" id="3755780">v</span><span class="op" id="3755781">,</span>&nbsp;<span class="ident" id="3755783">x</span><span class="op" id="3755784">,</span>&nbsp;<span class="ident" id="3755786">y</span>&nbsp;<span class="builtintype" id="3755788">int</span><span class="op" id="3755791">)</span>&nbsp;<span class="builtintype" id="3755793">int</span>&nbsp;<span class="op" id="3755797">{</span>&nbsp;<span class="keyword" id="3755799">return</span>&nbsp;<span class="op" id="3755806">^</span><span class="op" id="3755807">(</span><span class="ident" id="3755808">v</span><span class="op" id="3755809">-</span><span class="num" id="3755810">1</span><span class="op" id="3755811">)</span><span class="op" id="3755812">&amp;</span><span class="ident" id="3755813">x</span>&nbsp;<span class="op" id="3755815">|</span>&nbsp;<span class="op" id="3755817">(</span><span class="ident" id="3755818">v</span><span class="op" id="3755819">-</span><span class="num" id="3755820">1</span><span class="op" id="3755821">)</span><span class="op" id="3755822">&amp;</span><span class="ident" id="3755823">y</span>&nbsp;<span class="op" id="3755825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3755828">//&nbsp;ConstantTimeByteEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3755887">func</span>&nbsp;<span class="ident" id="3755892">ConstantTimeByteEq</span><span class="op" id="3755910">(</span><span class="ident" id="3755911">x</span><span class="op" id="3755912">,</span>&nbsp;<span class="ident" id="3755914">y</span>&nbsp;<span class="builtintype" id="3755916">uint8</span><span class="op" id="3755921">)</span>&nbsp;<span class="builtintype" id="3755923">int</span>&nbsp;<span class="op" id="3755927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755930">z</span>&nbsp;<span class="op" id="3755932">:=</span>&nbsp;<span class="op" id="3755935">^</span><span class="op" id="3755936">(</span><span class="ident" id="3755937">x</span>&nbsp;<span class="op" id="3755939">^</span>&nbsp;<span class="ident" id="3755941">y</span><span class="op" id="3755942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755945">z</span>&nbsp;<span class="op" id="3755947">&amp;=</span>&nbsp;<span class="ident" id="3755950">z</span>&nbsp;<span class="op" id="3755952">&gt;&gt;</span>&nbsp;<span class="num" id="3755955">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755958">z</span>&nbsp;<span class="op" id="3755960">&amp;=</span>&nbsp;<span class="ident" id="3755963">z</span>&nbsp;<span class="op" id="3755965">&gt;&gt;</span>&nbsp;<span class="num" id="3755968">2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3755971">z</span>&nbsp;<span class="op" id="3755973">&amp;=</span>&nbsp;<span class="ident" id="3755976">z</span>&nbsp;<span class="op" id="3755978">&gt;&gt;</span>&nbsp;<span class="num" id="3755981">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3755985">return</span>&nbsp;<span class="builtintype" id="3755992">int</span><span class="op" id="3755995">(</span><span class="ident" id="3755996">z</span><span class="op" id="3755997">)</span><br>
<span class="lineno"></span><span class="op" id="3755999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3756002">//&nbsp;ConstantTimeEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;==&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3756057">func</span>&nbsp;<span class="ident" id="3756062">ConstantTimeEq</span><span class="op" id="3756076">(</span><span class="ident" id="3756077">x</span><span class="op" id="3756078">,</span>&nbsp;<span class="ident" id="3756080">y</span>&nbsp;<span class="builtintype" id="3756082">int32</span><span class="op" id="3756087">)</span>&nbsp;<span class="builtintype" id="3756089">int</span>&nbsp;<span class="op" id="3756093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756096">z</span>&nbsp;<span class="op" id="3756098">:=</span>&nbsp;<span class="op" id="3756101">^</span><span class="op" id="3756102">(</span><span class="ident" id="3756103">x</span>&nbsp;<span class="op" id="3756105">^</span>&nbsp;<span class="ident" id="3756107">y</span><span class="op" id="3756108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756111">z</span>&nbsp;<span class="op" id="3756113">&amp;=</span>&nbsp;<span class="ident" id="3756116">z</span>&nbsp;<span class="op" id="3756118">&gt;&gt;</span>&nbsp;<span class="num" id="3756121">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756125">z</span>&nbsp;<span class="op" id="3756127">&amp;=</span>&nbsp;<span class="ident" id="3756130">z</span>&nbsp;<span class="op" id="3756132">&gt;&gt;</span>&nbsp;<span class="num" id="3756135">8</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756138">z</span>&nbsp;<span class="op" id="3756140">&amp;=</span>&nbsp;<span class="ident" id="3756143">z</span>&nbsp;<span class="op" id="3756145">&gt;&gt;</span>&nbsp;<span class="num" id="3756148">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756151">z</span>&nbsp;<span class="op" id="3756153">&amp;=</span>&nbsp;<span class="ident" id="3756156">z</span>&nbsp;<span class="op" id="3756158">&gt;&gt;</span>&nbsp;<span class="num" id="3756161">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756164">z</span>&nbsp;<span class="op" id="3756166">&amp;=</span>&nbsp;<span class="ident" id="3756169">z</span>&nbsp;<span class="op" id="3756171">&gt;&gt;</span>&nbsp;<span class="num" id="3756174">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756178">return</span>&nbsp;<span class="builtintype" id="3756185">int</span><span class="op" id="3756188">(</span><span class="ident" id="3756189">z</span>&nbsp;<span class="op" id="3756191">&amp;</span>&nbsp;<span class="num" id="3756193">1</span><span class="op" id="3756194">)</span><br>
<span class="lineno">50</span><span class="op" id="3756196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3756199">//&nbsp;ConstantTimeCopy&nbsp;copies&nbsp;the&nbsp;contents&nbsp;of&nbsp;y&nbsp;into&nbsp;x&nbsp;(a&nbsp;slice&nbsp;of&nbsp;equal&nbsp;length)</span><br>
<span class="lineno"></span><span class="comment" id="3756277">//&nbsp;if&nbsp;v&nbsp;==&nbsp;1.&nbsp;If&nbsp;v&nbsp;==&nbsp;0,&nbsp;x&nbsp;is&nbsp;left&nbsp;unchanged.&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;v</span><br>
<span class="lineno"></span><span class="comment" id="3756354">//&nbsp;takes&nbsp;any&nbsp;other&nbsp;value.</span><br>
<span class="lineno">55</span><span class="keyword" id="3756380">func</span>&nbsp;<span class="ident" id="3756385">ConstantTimeCopy</span><span class="op" id="3756401">(</span><span class="ident" id="3756402">v</span>&nbsp;<span class="builtintype" id="3756404">int</span><span class="op" id="3756407">,</span>&nbsp;<span class="ident" id="3756409">x</span><span class="op" id="3756410">,</span>&nbsp;<span class="ident" id="3756412">y</span>&nbsp;<span class="op" id="3756414">[</span><span class="op" id="3756415">]</span><span class="builtintype" id="3756416">byte</span><span class="op" id="3756420">)</span>&nbsp;<span class="op" id="3756422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756425">if</span>&nbsp;<span class="builtinfunc" id="3756428">len</span><span class="op" id="3756431">(</span><span class="ident" id="3756432">x</span><span class="op" id="3756433">)</span>&nbsp;<span class="op" id="3756435">!=</span>&nbsp;<span class="builtinfunc" id="3756438">len</span><span class="op" id="3756441">(</span><span class="ident" id="3756442">y</span><span class="op" id="3756443">)</span>&nbsp;<span class="op" id="3756445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3756449">panic</span><span class="op" id="3756454">(</span><span class="string" id="3756455">&#34;subtle:&nbsp;slices&nbsp;have&nbsp;different&nbsp;lengths&#34;</span><span class="op" id="3756494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3756497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756501">xmask</span>&nbsp;<span class="op" id="3756507">:=</span>&nbsp;<span class="builtintype" id="3756510">byte</span><span class="op" id="3756514">(</span><span class="ident" id="3756515">v</span>&nbsp;<span class="op" id="3756517">-</span>&nbsp;<span class="num" id="3756519">1</span><span class="op" id="3756520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756523">ymask</span>&nbsp;<span class="op" id="3756529">:=</span>&nbsp;<span class="builtintype" id="3756532">byte</span><span class="op" id="3756536">(</span><span class="op" id="3756537">^</span><span class="op" id="3756538">(</span><span class="ident" id="3756539">v</span>&nbsp;<span class="op" id="3756541">-</span>&nbsp;<span class="num" id="3756543">1</span><span class="op" id="3756544">)</span><span class="op" id="3756545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756548">for</span>&nbsp;<span class="ident" id="3756552">i</span>&nbsp;<span class="op" id="3756554">:=</span>&nbsp;<span class="num" id="3756557">0</span><span class="op" id="3756558">;</span>&nbsp;<span class="ident" id="3756560">i</span>&nbsp;<span class="op" id="3756562">&lt;</span>&nbsp;<span class="builtinfunc" id="3756564">len</span><span class="op" id="3756567">(</span><span class="ident" id="3756568">x</span><span class="op" id="3756569">)</span><span class="op" id="3756570">;</span>&nbsp;<span class="ident" id="3756572">i</span><span class="op" id="3756573">++</span>&nbsp;<span class="op" id="3756576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756580">x</span><span class="op" id="3756581">[</span><span class="ident" id="3756582">i</span><span class="op" id="3756583">]</span>&nbsp;<span class="op" id="3756585">=</span>&nbsp;<span class="ident" id="3756587">x</span><span class="op" id="3756588">[</span><span class="ident" id="3756589">i</span><span class="op" id="3756590">]</span><span class="op" id="3756591">&amp;</span><span class="ident" id="3756592">xmask</span>&nbsp;<span class="op" id="3756598">|</span>&nbsp;<span class="ident" id="3756600">y</span><span class="op" id="3756601">[</span><span class="ident" id="3756602">i</span><span class="op" id="3756603">]</span><span class="op" id="3756604">&amp;</span><span class="ident" id="3756605">ymask</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3756612">}</span><br>
<span class="lineno">65</span><span class="op" id="3756614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3756617">//&nbsp;ConstantTimeLessOrEq&nbsp;returns&nbsp;1&nbsp;if&nbsp;x&nbsp;&lt;=&nbsp;y&nbsp;and&nbsp;0&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3756678">//&nbsp;Its&nbsp;behavior&nbsp;is&nbsp;undefined&nbsp;if&nbsp;x&nbsp;or&nbsp;y&nbsp;are&nbsp;negative&nbsp;or&nbsp;&gt;&nbsp;2**31&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3756746">func</span>&nbsp;<span class="ident" id="3756751">ConstantTimeLessOrEq</span><span class="op" id="3756771">(</span><span class="ident" id="3756772">x</span><span class="op" id="3756773">,</span>&nbsp;<span class="ident" id="3756775">y</span>&nbsp;<span class="builtintype" id="3756777">int</span><span class="op" id="3756780">)</span>&nbsp;<span class="builtintype" id="3756782">int</span>&nbsp;<span class="op" id="3756786">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756789">x32</span>&nbsp;<span class="op" id="3756793">:=</span>&nbsp;<span class="builtintype" id="3756796">int32</span><span class="op" id="3756801">(</span><span class="ident" id="3756802">x</span><span class="op" id="3756803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3756806">y32</span>&nbsp;<span class="op" id="3756810">:=</span>&nbsp;<span class="builtintype" id="3756813">int32</span><span class="op" id="3756818">(</span><span class="ident" id="3756819">y</span><span class="op" id="3756820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3756823">return</span>&nbsp;<span class="builtintype" id="3756830">int</span><span class="op" id="3756833">(</span><span class="op" id="3756834">(</span><span class="op" id="3756835">(</span><span class="ident" id="3756836">x32</span>&nbsp;<span class="op" id="3756840">-</span>&nbsp;<span class="ident" id="3756842">y32</span>&nbsp;<span class="op" id="3756846">-</span>&nbsp;<span class="num" id="3756848">1</span><span class="op" id="3756849">)</span>&nbsp;<span class="op" id="3756851">&gt;&gt;</span>&nbsp;<span class="num" id="3756854">31</span><span class="op" id="3756856">)</span>&nbsp;<span class="op" id="3756858">&amp;</span>&nbsp;<span class="num" id="3756860">1</span><span class="op" id="3756861">)</span><br>
<span class="lineno"></span><span class="op" id="3756863">}</span>
</div>
</body>
</html>
