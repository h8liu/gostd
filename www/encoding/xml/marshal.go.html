<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6405597">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6405652">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6405706">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6405757">package</span>&nbsp;<span class="ident" id="6405765">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6405770">import</span>&nbsp;<span class="op" id="6405777">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405780">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405789">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405798">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405810">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405817">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405823">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405834">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6405845">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6405855">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6405858">const</span>&nbsp;<span class="op" id="6405864">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6405867">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6405937">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6406004">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6406041">Header</span>&nbsp;<span class="op" id="6406048">=</span>&nbsp;<span class="string" id="6406050">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="6406091">+</span>&nbsp;<span class="string" id="6406093">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="6406098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6406101">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="6406143">//</span><br>
<span class="lineno"></span><span class="comment" id="6406146">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="6406220">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6406298">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="6406376">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6406451">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="6406530">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6406563">//</span><br>
<span class="lineno"></span><span class="comment" id="6406566">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="6406638">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="6406701">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="6406758">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6406819">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6406881">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="6406922">//</span><br>
<span class="lineno"></span><span class="comment" id="6406925">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6407002">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="6407059">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="6407116">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="6407158">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6407222">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6407266">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6407330">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6407370">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="6407438">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6407470">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="6407541">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="6407586">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6407657">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="6407730">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6407766">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="6407838">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6407911">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6407982">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="6408014">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6408084">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="6408130">//</span><br>
<span class="lineno"></span><span class="comment" id="6408133">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="6408208">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="6408285">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6408341">//</span><br>
<span class="lineno"></span><span class="comment" id="6408344">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="6408381">//</span><br>
<span class="lineno"></span><span class="comment" id="6408384">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="6408465">func</span>&nbsp;<span class="ident" id="6408470">Marshal</span><span class="op" id="6408477">(</span><span class="ident" id="6408478">v</span>&nbsp;<span class="keyword" id="6408480">interface</span><span class="op" id="6408489">{</span><span class="op" id="6408490">}</span><span class="op" id="6408491">)</span>&nbsp;<span class="op" id="6408493">(</span><span class="op" id="6408494">[</span><span class="op" id="6408495">]</span><span class="builtintype" id="6408496">byte</span><span class="op" id="6408500">,</span>&nbsp;<span class="builtintype" id="6408502">error</span><span class="op" id="6408507">)</span>&nbsp;<span class="op" id="6408509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408512">var</span>&nbsp;<span class="ident" id="6408516">b</span>&nbsp;<span class="ident" id="6408518">bytes</span><span class="op" id="6408523">.</span><span class="ident" id="6408524">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408532">if</span>&nbsp;<span class="ident" id="6408535">err</span>&nbsp;<span class="op" id="6408539">:=</span>&nbsp;<span class="ident" id="6408542">NewEncoder</span><span class="op" id="6408552">(</span><span class="op" id="6408553">&amp;</span><span class="ident" id="6408554">b</span><span class="op" id="6408555">)</span><span class="op" id="6408556">.</span><span class="ident" id="6408557">Encode</span><span class="op" id="6408563">(</span><span class="ident" id="6408564">v</span><span class="op" id="6408565">)</span><span class="op" id="6408566">;</span>&nbsp;<span class="ident" id="6408568">err</span>&nbsp;<span class="op" id="6408572">!=</span>&nbsp;<span class="ident" id="6408575">nil</span>&nbsp;<span class="op" id="6408579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408583">return</span>&nbsp;<span class="ident" id="6408590">nil</span><span class="op" id="6408593">,</span>&nbsp;<span class="ident" id="6408595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6408600">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6408603">return</span>&nbsp;<span class="ident" id="6408610">b</span><span class="op" id="6408611">.</span><span class="ident" id="6408612">Bytes</span><span class="op" id="6408617">(</span><span class="op" id="6408618">)</span><span class="op" id="6408619">,</span>&nbsp;<span class="ident" id="6408621">nil</span><br>
<span class="lineno"></span><span class="op" id="6408625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6408628">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="6408698">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="6408737">//</span><br>
<span class="lineno"></span><span class="comment" id="6408740">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="6408805">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="6408876">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="6408907">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="6408971">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="6409037">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="6409054">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="6409119">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="6409184">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="6409223">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="6409292">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6409343">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="6409409">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="6409426">type</span>&nbsp;<span class="ident" id="6409431">Marshaler</span>&nbsp;<span class="keyword" id="6409441">interface</span>&nbsp;<span class="op" id="6409451">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6409454">MarshalXML</span><span class="op" id="6409464">(</span><span class="ident" id="6409465">e</span>&nbsp;<span class="op" id="6409467">*</span><span class="ident" id="6409468">Encoder</span><span class="op" id="6409475">,</span>&nbsp;<span class="ident" id="6409477">start</span>&nbsp;<span class="ident" id="6409483">StartElement</span><span class="op" id="6409495">)</span>&nbsp;<span class="builtintype" id="6409497">error</span><br>
<span class="lineno"></span><span class="op" id="6409503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6409506">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="6409580">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="6409621">//</span><br>
<span class="lineno"></span><span class="comment" id="6409624">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="6409707">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="6409773">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="6409836">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="6409853">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="6409922">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6409958">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6410016">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="6410051">type</span>&nbsp;<span class="ident" id="6410056">MarshalerAttr</span>&nbsp;<span class="keyword" id="6410070">interface</span>&nbsp;<span class="op" id="6410080">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410083">MarshalXMLAttr</span><span class="op" id="6410097">(</span><span class="ident" id="6410098">name</span>&nbsp;<span class="ident" id="6410103">Name</span><span class="op" id="6410107">)</span>&nbsp;<span class="op" id="6410109">(</span><span class="ident" id="6410110">Attr</span><span class="op" id="6410114">,</span>&nbsp;<span class="builtintype" id="6410116">error</span><span class="op" id="6410121">)</span><br>
<span class="lineno"></span><span class="op" id="6410123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6410126">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="6410200">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="6410272">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6410324">func</span>&nbsp;<span class="ident" id="6410329">MarshalIndent</span><span class="op" id="6410342">(</span><span class="ident" id="6410343">v</span>&nbsp;<span class="keyword" id="6410345">interface</span><span class="op" id="6410354">{</span><span class="op" id="6410355">}</span><span class="op" id="6410356">,</span>&nbsp;<span class="ident" id="6410358">prefix</span><span class="op" id="6410364">,</span>&nbsp;<span class="ident" id="6410366">indent</span>&nbsp;<span class="builtintype" id="6410373">string</span><span class="op" id="6410379">)</span>&nbsp;<span class="op" id="6410381">(</span><span class="op" id="6410382">[</span><span class="op" id="6410383">]</span><span class="builtintype" id="6410384">byte</span><span class="op" id="6410388">,</span>&nbsp;<span class="builtintype" id="6410390">error</span><span class="op" id="6410395">)</span>&nbsp;<span class="op" id="6410397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410400">var</span>&nbsp;<span class="ident" id="6410404">b</span>&nbsp;<span class="ident" id="6410406">bytes</span><span class="op" id="6410411">.</span><span class="ident" id="6410412">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410420">enc</span>&nbsp;<span class="op" id="6410424">:=</span>&nbsp;<span class="ident" id="6410427">NewEncoder</span><span class="op" id="6410437">(</span><span class="op" id="6410438">&amp;</span><span class="ident" id="6410439">b</span><span class="op" id="6410440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410443">enc</span><span class="op" id="6410446">.</span><span class="ident" id="6410447">Indent</span><span class="op" id="6410453">(</span><span class="ident" id="6410454">prefix</span><span class="op" id="6410460">,</span>&nbsp;<span class="ident" id="6410462">indent</span><span class="op" id="6410468">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410471">if</span>&nbsp;<span class="ident" id="6410474">err</span>&nbsp;<span class="op" id="6410478">:=</span>&nbsp;<span class="ident" id="6410481">enc</span><span class="op" id="6410484">.</span><span class="ident" id="6410485">Encode</span><span class="op" id="6410491">(</span><span class="ident" id="6410492">v</span><span class="op" id="6410493">)</span><span class="op" id="6410494">;</span>&nbsp;<span class="ident" id="6410496">err</span>&nbsp;<span class="op" id="6410500">!=</span>&nbsp;<span class="ident" id="6410503">nil</span>&nbsp;<span class="op" id="6410507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410511">return</span>&nbsp;<span class="ident" id="6410518">nil</span><span class="op" id="6410521">,</span>&nbsp;<span class="ident" id="6410523">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6410528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410531">return</span>&nbsp;<span class="ident" id="6410538">b</span><span class="op" id="6410539">.</span><span class="ident" id="6410540">Bytes</span><span class="op" id="6410545">(</span><span class="op" id="6410546">)</span><span class="op" id="6410547">,</span>&nbsp;<span class="ident" id="6410549">nil</span><br>
<span class="lineno"></span><span class="op" id="6410553">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="6410556">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6410607">type</span>&nbsp;<span class="ident" id="6410612">Encoder</span>&nbsp;<span class="keyword" id="6410620">struct</span>&nbsp;<span class="op" id="6410627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410630">p</span>&nbsp;<span class="ident" id="6410632">printer</span><br>
<span class="lineno"></span><span class="op" id="6410640">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="6410643">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6410697">func</span>&nbsp;<span class="ident" id="6410702">NewEncoder</span><span class="op" id="6410712">(</span><span class="ident" id="6410713">w</span>&nbsp;<span class="ident" id="6410715">io</span><span class="op" id="6410717">.</span><span class="ident" id="6410718">Writer</span><span class="op" id="6410724">)</span>&nbsp;<span class="op" id="6410726">*</span><span class="ident" id="6410727">Encoder</span>&nbsp;<span class="op" id="6410735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410738">e</span>&nbsp;<span class="op" id="6410740">:=</span>&nbsp;<span class="op" id="6410743">&amp;</span><span class="ident" id="6410744">Encoder</span><span class="op" id="6410751">{</span><span class="ident" id="6410752">printer</span><span class="op" id="6410759">{</span><span class="ident" id="6410760">Writer</span><span class="op" id="6410766">:</span>&nbsp;<span class="ident" id="6410768">bufio</span><span class="op" id="6410773">.</span><span class="ident" id="6410774">NewWriter</span><span class="op" id="6410783">(</span><span class="ident" id="6410784">w</span><span class="op" id="6410785">)</span><span class="op" id="6410786">}</span><span class="op" id="6410787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6410790">e</span><span class="op" id="6410791">.</span><span class="ident" id="6410792">p</span><span class="op" id="6410793">.</span><span class="ident" id="6410794">encoder</span>&nbsp;<span class="op" id="6410802">=</span>&nbsp;<span class="ident" id="6410804">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6410807">return</span>&nbsp;<span class="ident" id="6410814">e</span><br>
<span class="lineno"></span><span class="op" id="6410816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6410819">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="6410884">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="6410960">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6411024">func</span>&nbsp;<span class="op" id="6411029">(</span><span class="ident" id="6411030">enc</span>&nbsp;<span class="op" id="6411034">*</span><span class="ident" id="6411035">Encoder</span><span class="op" id="6411042">)</span>&nbsp;<span class="ident" id="6411044">Indent</span><span class="op" id="6411050">(</span><span class="ident" id="6411051">prefix</span><span class="op" id="6411057">,</span>&nbsp;<span class="ident" id="6411059">indent</span>&nbsp;<span class="builtintype" id="6411066">string</span><span class="op" id="6411072">)</span>&nbsp;<span class="op" id="6411074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411077">enc</span><span class="op" id="6411080">.</span><span class="ident" id="6411081">p</span><span class="op" id="6411082">.</span><span class="ident" id="6411083">prefix</span>&nbsp;<span class="op" id="6411090">=</span>&nbsp;<span class="ident" id="6411092">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411100">enc</span><span class="op" id="6411103">.</span><span class="ident" id="6411104">p</span><span class="op" id="6411105">.</span><span class="ident" id="6411106">indent</span>&nbsp;<span class="op" id="6411113">=</span>&nbsp;<span class="ident" id="6411115">indent</span><br>
<span class="lineno"></span><span class="op" id="6411122">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="6411125">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="6411179">//</span><br>
<span class="lineno"></span><span class="comment" id="6411182">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="6411252">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="6411276">//</span><br>
<span class="lineno"></span><span class="comment" id="6411279">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="6411319">func</span>&nbsp;<span class="op" id="6411324">(</span><span class="ident" id="6411325">enc</span>&nbsp;<span class="op" id="6411329">*</span><span class="ident" id="6411330">Encoder</span><span class="op" id="6411337">)</span>&nbsp;<span class="ident" id="6411339">Encode</span><span class="op" id="6411345">(</span><span class="ident" id="6411346">v</span>&nbsp;<span class="keyword" id="6411348">interface</span><span class="op" id="6411357">{</span><span class="op" id="6411358">}</span><span class="op" id="6411359">)</span>&nbsp;<span class="builtintype" id="6411361">error</span>&nbsp;<span class="op" id="6411367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411370">err</span>&nbsp;<span class="op" id="6411374">:=</span>&nbsp;<span class="ident" id="6411377">enc</span><span class="op" id="6411380">.</span><span class="ident" id="6411381">p</span><span class="op" id="6411382">.</span><span class="ident" id="6411383">marshalValue</span><span class="op" id="6411395">(</span><span class="ident" id="6411396">reflect</span><span class="op" id="6411403">.</span><span class="ident" id="6411404">ValueOf</span><span class="op" id="6411411">(</span><span class="ident" id="6411412">v</span><span class="op" id="6411413">)</span><span class="op" id="6411414">,</span>&nbsp;<span class="ident" id="6411416">nil</span><span class="op" id="6411419">,</span>&nbsp;<span class="ident" id="6411421">nil</span><span class="op" id="6411424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411427">if</span>&nbsp;<span class="ident" id="6411430">err</span>&nbsp;<span class="op" id="6411434">!=</span>&nbsp;<span class="ident" id="6411437">nil</span>&nbsp;<span class="op" id="6411441">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411445">return</span>&nbsp;<span class="ident" id="6411452">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411460">return</span>&nbsp;<span class="ident" id="6411467">enc</span><span class="op" id="6411470">.</span><span class="ident" id="6411471">p</span><span class="op" id="6411472">.</span><span class="ident" id="6411473">Flush</span><span class="op" id="6411478">(</span><span class="op" id="6411479">)</span><br>
<span class="lineno"></span><span class="op" id="6411481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6411484">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="6411545">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="6411598">//</span><br>
<span class="lineno"></span><span class="comment" id="6411601">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="6411671">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="6411695">//</span><br>
<span class="lineno"></span><span class="comment" id="6411698">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="6411745">func</span>&nbsp;<span class="op" id="6411750">(</span><span class="ident" id="6411751">enc</span>&nbsp;<span class="op" id="6411755">*</span><span class="ident" id="6411756">Encoder</span><span class="op" id="6411763">)</span>&nbsp;<span class="ident" id="6411765">EncodeElement</span><span class="op" id="6411778">(</span><span class="ident" id="6411779">v</span>&nbsp;<span class="keyword" id="6411781">interface</span><span class="op" id="6411790">{</span><span class="op" id="6411791">}</span><span class="op" id="6411792">,</span>&nbsp;<span class="ident" id="6411794">start</span>&nbsp;<span class="ident" id="6411800">StartElement</span><span class="op" id="6411812">)</span>&nbsp;<span class="builtintype" id="6411814">error</span>&nbsp;<span class="op" id="6411820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411823">err</span>&nbsp;<span class="op" id="6411827">:=</span>&nbsp;<span class="ident" id="6411830">enc</span><span class="op" id="6411833">.</span><span class="ident" id="6411834">p</span><span class="op" id="6411835">.</span><span class="ident" id="6411836">marshalValue</span><span class="op" id="6411848">(</span><span class="ident" id="6411849">reflect</span><span class="op" id="6411856">.</span><span class="ident" id="6411857">ValueOf</span><span class="op" id="6411864">(</span><span class="ident" id="6411865">v</span><span class="op" id="6411866">)</span><span class="op" id="6411867">,</span>&nbsp;<span class="ident" id="6411869">nil</span><span class="op" id="6411872">,</span>&nbsp;<span class="op" id="6411874">&amp;</span><span class="ident" id="6411875">start</span><span class="op" id="6411880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411883">if</span>&nbsp;<span class="ident" id="6411886">err</span>&nbsp;<span class="op" id="6411890">!=</span>&nbsp;<span class="ident" id="6411893">nil</span>&nbsp;<span class="op" id="6411897">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411901">return</span>&nbsp;<span class="ident" id="6411908">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6411913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6411916">return</span>&nbsp;<span class="ident" id="6411923">enc</span><span class="op" id="6411926">.</span><span class="ident" id="6411927">p</span><span class="op" id="6411928">.</span><span class="ident" id="6411929">Flush</span><span class="op" id="6411934">(</span><span class="op" id="6411935">)</span><br>
<span class="lineno"></span><span class="op" id="6411937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6411940">var</span>&nbsp;<span class="op" id="6411944">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411947">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6411960">=</span>&nbsp;<span class="op" id="6411962">[</span><span class="op" id="6411963">]</span><span class="builtintype" id="6411964">byte</span><span class="op" id="6411968">(</span><span class="string" id="6411969">&#34;--&gt;&#34;</span><span class="op" id="6411974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6411977">endProcInst</span>&nbsp;&nbsp;<span class="op" id="6411990">=</span>&nbsp;<span class="op" id="6411992">[</span><span class="op" id="6411993">]</span><span class="builtintype" id="6411994">byte</span><span class="op" id="6411998">(</span><span class="string" id="6411999">&#34;?&gt;&#34;</span><span class="op" id="6412003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412006">endDirective</span>&nbsp;<span class="op" id="6412019">=</span>&nbsp;<span class="op" id="6412021">[</span><span class="op" id="6412022">]</span><span class="builtintype" id="6412023">byte</span><span class="op" id="6412027">(</span><span class="string" id="6412028">&#34;&gt;&#34;</span><span class="op" id="6412031">)</span><br>
<span class="lineno"></span><span class="op" id="6412033">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="6412036">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="6412093">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="6412180">//</span><br>
<span class="lineno"></span><span class="comment" id="6412183">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="6412268">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="6412347">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="6412406">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6412486">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6412563">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="6412616">//</span><br>
<span class="lineno"></span><span class="comment" id="6412619">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="6412709">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6412727">func</span>&nbsp;<span class="op" id="6412732">(</span><span class="ident" id="6412733">enc</span>&nbsp;<span class="op" id="6412737">*</span><span class="ident" id="6412738">Encoder</span><span class="op" id="6412745">)</span>&nbsp;<span class="ident" id="6412747">EncodeToken</span><span class="op" id="6412758">(</span><span class="ident" id="6412759">t</span>&nbsp;<span class="ident" id="6412761">Token</span><span class="op" id="6412766">)</span>&nbsp;<span class="builtintype" id="6412768">error</span>&nbsp;<span class="op" id="6412774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412777">p</span>&nbsp;<span class="op" id="6412779">:=</span>&nbsp;<span class="op" id="6412782">&amp;</span><span class="ident" id="6412783">enc</span><span class="op" id="6412786">.</span><span class="ident" id="6412787">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412790">switch</span>&nbsp;<span class="ident" id="6412797">t</span>&nbsp;<span class="op" id="6412799">:=</span>&nbsp;<span class="ident" id="6412802">t</span><span class="op" id="6412803">.</span><span class="op" id="6412804">(</span><span class="keyword" id="6412805">type</span><span class="op" id="6412809">)</span>&nbsp;<span class="op" id="6412811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412814">case</span>&nbsp;<span class="ident" id="6412819">StartElement</span><span class="op" id="6412831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412835">if</span>&nbsp;<span class="ident" id="6412838">err</span>&nbsp;<span class="op" id="6412842">:=</span>&nbsp;<span class="ident" id="6412845">p</span><span class="op" id="6412846">.</span><span class="ident" id="6412847">writeStart</span><span class="op" id="6412857">(</span><span class="op" id="6412858">&amp;</span><span class="ident" id="6412859">t</span><span class="op" id="6412860">)</span><span class="op" id="6412861">;</span>&nbsp;<span class="ident" id="6412863">err</span>&nbsp;<span class="op" id="6412867">!=</span>&nbsp;<span class="ident" id="6412870">nil</span>&nbsp;<span class="op" id="6412874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412879">return</span>&nbsp;<span class="ident" id="6412886">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412892">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412895">case</span>&nbsp;<span class="ident" id="6412900">EndElement</span><span class="op" id="6412910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412914">if</span>&nbsp;<span class="ident" id="6412917">err</span>&nbsp;<span class="op" id="6412921">:=</span>&nbsp;<span class="ident" id="6412924">p</span><span class="op" id="6412925">.</span><span class="ident" id="6412926">writeEnd</span><span class="op" id="6412934">(</span><span class="ident" id="6412935">t</span><span class="op" id="6412936">.</span><span class="ident" id="6412937">Name</span><span class="op" id="6412941">)</span><span class="op" id="6412942">;</span>&nbsp;<span class="ident" id="6412944">err</span>&nbsp;<span class="op" id="6412948">!=</span>&nbsp;<span class="ident" id="6412951">nil</span>&nbsp;<span class="op" id="6412955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412960">return</span>&nbsp;<span class="ident" id="6412967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6412973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6412976">case</span>&nbsp;<span class="ident" id="6412981">CharData</span><span class="op" id="6412989">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6412993">EscapeText</span><span class="op" id="6413003">(</span><span class="ident" id="6413004">p</span><span class="op" id="6413005">,</span>&nbsp;<span class="ident" id="6413007">t</span><span class="op" id="6413008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413011">case</span>&nbsp;<span class="ident" id="6413016">Comment</span><span class="op" id="6413023">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413027">if</span>&nbsp;<span class="ident" id="6413030">bytes</span><span class="op" id="6413035">.</span><span class="ident" id="6413036">Contains</span><span class="op" id="6413044">(</span><span class="ident" id="6413045">t</span><span class="op" id="6413046">,</span>&nbsp;<span class="ident" id="6413048">endComment</span><span class="op" id="6413058">)</span>&nbsp;<span class="op" id="6413060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413065">return</span>&nbsp;<span class="ident" id="6413072">fmt</span><span class="op" id="6413075">.</span><span class="ident" id="6413076">Errorf</span><span class="op" id="6413082">(</span><span class="string" id="6413083">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="6413134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413138">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413142">p</span><span class="op" id="6413143">.</span><span class="ident" id="6413144">WriteString</span><span class="op" id="6413155">(</span><span class="string" id="6413156">&#34;&lt;!--&#34;</span><span class="op" id="6413162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413166">p</span><span class="op" id="6413167">.</span><span class="ident" id="6413168">Write</span><span class="op" id="6413173">(</span><span class="ident" id="6413174">t</span><span class="op" id="6413175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413179">p</span><span class="op" id="6413180">.</span><span class="ident" id="6413181">WriteString</span><span class="op" id="6413192">(</span><span class="string" id="6413193">&#34;--&gt;&#34;</span><span class="op" id="6413198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413202">return</span>&nbsp;<span class="ident" id="6413209">p</span><span class="op" id="6413210">.</span><span class="ident" id="6413211">cachedWriteError</span><span class="op" id="6413227">(</span><span class="op" id="6413228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413231">case</span>&nbsp;<span class="ident" id="6413236">ProcInst</span><span class="op" id="6413244">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6413248">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6413323">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413403">if</span>&nbsp;<span class="ident" id="6413406">t</span><span class="op" id="6413407">.</span><span class="ident" id="6413408">Target</span>&nbsp;<span class="op" id="6413415">==</span>&nbsp;<span class="string" id="6413418">&#34;xml&#34;</span>&nbsp;<span class="op" id="6413424">&amp;&amp;</span>&nbsp;<span class="ident" id="6413427">p</span><span class="op" id="6413428">.</span><span class="ident" id="6413429">Buffered</span><span class="op" id="6413437">(</span><span class="op" id="6413438">)</span>&nbsp;<span class="op" id="6413440">!=</span>&nbsp;<span class="num" id="6413443">0</span>&nbsp;<span class="op" id="6413445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413450">return</span>&nbsp;<span class="ident" id="6413457">fmt</span><span class="op" id="6413460">.</span><span class="ident" id="6413461">Errorf</span><span class="op" id="6413467">(</span><span class="string" id="6413468">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="6413561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413565">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413569">if</span>&nbsp;<span class="op" id="6413572">!</span><span class="ident" id="6413573">isNameString</span><span class="op" id="6413585">(</span><span class="ident" id="6413586">t</span><span class="op" id="6413587">.</span><span class="ident" id="6413588">Target</span><span class="op" id="6413594">)</span>&nbsp;<span class="op" id="6413596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413601">return</span>&nbsp;<span class="ident" id="6413608">fmt</span><span class="op" id="6413611">.</span><span class="ident" id="6413612">Errorf</span><span class="op" id="6413618">(</span><span class="string" id="6413619">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="6413669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413677">if</span>&nbsp;<span class="ident" id="6413680">bytes</span><span class="op" id="6413685">.</span><span class="ident" id="6413686">Contains</span><span class="op" id="6413694">(</span><span class="ident" id="6413695">t</span><span class="op" id="6413696">.</span><span class="ident" id="6413697">Inst</span><span class="op" id="6413701">,</span>&nbsp;<span class="ident" id="6413703">endProcInst</span><span class="op" id="6413714">)</span>&nbsp;<span class="op" id="6413716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413721">return</span>&nbsp;<span class="ident" id="6413728">fmt</span><span class="op" id="6413731">.</span><span class="ident" id="6413732">Errorf</span><span class="op" id="6413738">(</span><span class="string" id="6413739">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="6413790">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413798">p</span><span class="op" id="6413799">.</span><span class="ident" id="6413800">WriteString</span><span class="op" id="6413811">(</span><span class="string" id="6413812">&#34;&lt;?&#34;</span><span class="op" id="6413816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413820">p</span><span class="op" id="6413821">.</span><span class="ident" id="6413822">WriteString</span><span class="op" id="6413833">(</span><span class="ident" id="6413834">t</span><span class="op" id="6413835">.</span><span class="ident" id="6413836">Target</span><span class="op" id="6413842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413846">if</span>&nbsp;<span class="builtinfunc" id="6413849">len</span><span class="op" id="6413852">(</span><span class="ident" id="6413853">t</span><span class="op" id="6413854">.</span><span class="ident" id="6413855">Inst</span><span class="op" id="6413859">)</span>&nbsp;<span class="op" id="6413861">&gt;</span>&nbsp;<span class="num" id="6413863">0</span>&nbsp;<span class="op" id="6413865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413870">p</span><span class="op" id="6413871">.</span><span class="ident" id="6413872">WriteByte</span><span class="op" id="6413881">(</span><span class="string" id="6413882">&#39;&nbsp;&#39;</span><span class="op" id="6413885">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413890">p</span><span class="op" id="6413891">.</span><span class="ident" id="6413892">Write</span><span class="op" id="6413897">(</span><span class="ident" id="6413898">t</span><span class="op" id="6413899">.</span><span class="ident" id="6413900">Inst</span><span class="op" id="6413904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6413908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6413912">p</span><span class="op" id="6413913">.</span><span class="ident" id="6413914">WriteString</span><span class="op" id="6413925">(</span><span class="string" id="6413926">&#34;?&gt;&#34;</span><span class="op" id="6413930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413933">case</span>&nbsp;<span class="ident" id="6413938">Directive</span><span class="op" id="6413947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413951">if</span>&nbsp;<span class="ident" id="6413954">bytes</span><span class="op" id="6413959">.</span><span class="ident" id="6413960">Contains</span><span class="op" id="6413968">(</span><span class="ident" id="6413969">t</span><span class="op" id="6413970">,</span>&nbsp;<span class="ident" id="6413972">endDirective</span><span class="op" id="6413984">)</span>&nbsp;<span class="op" id="6413986">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6413991">return</span>&nbsp;<span class="ident" id="6413998">fmt</span><span class="op" id="6414001">.</span><span class="ident" id="6414002">Errorf</span><span class="op" id="6414008">(</span><span class="string" id="6414009">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="6414060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414068">p</span><span class="op" id="6414069">.</span><span class="ident" id="6414070">WriteString</span><span class="op" id="6414081">(</span><span class="string" id="6414082">&#34;&lt;!&#34;</span><span class="op" id="6414086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414090">p</span><span class="op" id="6414091">.</span><span class="ident" id="6414092">Write</span><span class="op" id="6414097">(</span><span class="ident" id="6414098">t</span><span class="op" id="6414099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414103">p</span><span class="op" id="6414104">.</span><span class="ident" id="6414105">WriteString</span><span class="op" id="6414116">(</span><span class="string" id="6414117">&#34;&gt;&#34;</span><span class="op" id="6414120">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414126">return</span>&nbsp;<span class="ident" id="6414133">p</span><span class="op" id="6414134">.</span><span class="ident" id="6414135">cachedWriteError</span><span class="op" id="6414151">(</span><span class="op" id="6414152">)</span><br>
<span class="lineno"></span><span class="op" id="6414154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6414157">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="6414217">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6414294">func</span>&nbsp;<span class="op" id="6414299">(</span><span class="ident" id="6414300">enc</span>&nbsp;<span class="op" id="6414304">*</span><span class="ident" id="6414305">Encoder</span><span class="op" id="6414312">)</span>&nbsp;<span class="ident" id="6414314">Flush</span><span class="op" id="6414319">(</span><span class="op" id="6414320">)</span>&nbsp;<span class="builtintype" id="6414322">error</span>&nbsp;<span class="op" id="6414328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414331">return</span>&nbsp;<span class="ident" id="6414338">enc</span><span class="op" id="6414341">.</span><span class="ident" id="6414342">p</span><span class="op" id="6414343">.</span><span class="ident" id="6414344">Flush</span><span class="op" id="6414349">(</span><span class="op" id="6414350">)</span><br>
<span class="lineno"></span><span class="op" id="6414352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6414355">type</span>&nbsp;<span class="ident" id="6414360">printer</span>&nbsp;<span class="keyword" id="6414368">struct</span>&nbsp;<span class="op" id="6414375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414378">*</span><span class="ident" id="6414379">bufio</span><span class="op" id="6414384">.</span><span class="ident" id="6414385">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414393">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6414404">*</span><span class="ident" id="6414405">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414414">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6414425">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414430">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6414441">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414449">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6414460">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414468">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6414479">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414484">indentedIn</span>&nbsp;<span class="builtintype" id="6414495">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414501">putNewline</span>&nbsp;<span class="builtintype" id="6414512">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414518">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6414529">map</span><span class="op" id="6414532">[</span><span class="builtintype" id="6414533">string</span><span class="op" id="6414539">]</span><span class="builtintype" id="6414540">string</span>&nbsp;<span class="comment" id="6414547">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414576">attrPrefix</span>&nbsp;<span class="keyword" id="6414587">map</span><span class="op" id="6414590">[</span><span class="builtintype" id="6414591">string</span><span class="op" id="6414597">]</span><span class="builtintype" id="6414598">string</span>&nbsp;<span class="comment" id="6414605">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414634">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6414645">[</span><span class="op" id="6414646">]</span><span class="builtintype" id="6414647">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414655">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6414666">[</span><span class="op" id="6414667">]</span><span class="ident" id="6414668">Name</span><br>
<span class="lineno"></span><span class="op" id="6414673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="6414676">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="6414767">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6414829">func</span>&nbsp;<span class="op" id="6414834">(</span><span class="ident" id="6414835">p</span>&nbsp;<span class="op" id="6414837">*</span><span class="ident" id="6414838">printer</span><span class="op" id="6414845">)</span>&nbsp;<span class="ident" id="6414847">createAttrPrefix</span><span class="op" id="6414863">(</span><span class="ident" id="6414864">url</span>&nbsp;<span class="builtintype" id="6414868">string</span><span class="op" id="6414874">)</span>&nbsp;<span class="builtintype" id="6414876">string</span>&nbsp;<span class="op" id="6414883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414886">if</span>&nbsp;<span class="ident" id="6414889">prefix</span>&nbsp;<span class="op" id="6414896">:=</span>&nbsp;<span class="ident" id="6414899">p</span><span class="op" id="6414900">.</span><span class="ident" id="6414901">attrPrefix</span><span class="op" id="6414911">[</span><span class="ident" id="6414912">url</span><span class="op" id="6414915">]</span><span class="op" id="6414916">;</span>&nbsp;<span class="ident" id="6414918">prefix</span>&nbsp;<span class="op" id="6414925">!=</span>&nbsp;<span class="string" id="6414928">&#34;&#34;</span>&nbsp;<span class="op" id="6414931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6414935">return</span>&nbsp;<span class="ident" id="6414942">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6414950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6414954">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415035">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415073">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415156">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415235">if</span>&nbsp;<span class="ident" id="6415238">url</span>&nbsp;<span class="op" id="6415242">==</span>&nbsp;<span class="ident" id="6415245">xmlURL</span>&nbsp;<span class="op" id="6415252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415256">return</span>&nbsp;<span class="string" id="6415263">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415274">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415311">if</span>&nbsp;<span class="ident" id="6415314">p</span><span class="op" id="6415315">.</span><span class="ident" id="6415316">attrPrefix</span>&nbsp;<span class="op" id="6415327">==</span>&nbsp;<span class="ident" id="6415330">nil</span>&nbsp;<span class="op" id="6415334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415338">p</span><span class="op" id="6415339">.</span><span class="ident" id="6415340">attrPrefix</span>&nbsp;<span class="op" id="6415351">=</span>&nbsp;<span class="builtinfunc" id="6415353">make</span><span class="op" id="6415357">(</span><span class="keyword" id="6415358">map</span><span class="op" id="6415361">[</span><span class="builtintype" id="6415362">string</span><span class="op" id="6415368">]</span><span class="builtintype" id="6415369">string</span><span class="op" id="6415375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415379">p</span><span class="op" id="6415380">.</span><span class="ident" id="6415381">attrNS</span>&nbsp;<span class="op" id="6415388">=</span>&nbsp;<span class="builtinfunc" id="6415390">make</span><span class="op" id="6415394">(</span><span class="keyword" id="6415395">map</span><span class="op" id="6415398">[</span><span class="builtintype" id="6415399">string</span><span class="op" id="6415405">]</span><span class="builtintype" id="6415406">string</span><span class="op" id="6415412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415415">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415419">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415480">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415504">prefix</span>&nbsp;<span class="op" id="6415511">:=</span>&nbsp;<span class="ident" id="6415514">strings</span><span class="op" id="6415521">.</span><span class="ident" id="6415522">TrimRight</span><span class="op" id="6415531">(</span><span class="ident" id="6415532">url</span><span class="op" id="6415535">,</span>&nbsp;<span class="string" id="6415537">&#34;/&#34;</span><span class="op" id="6415540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415543">if</span>&nbsp;<span class="ident" id="6415546">i</span>&nbsp;<span class="op" id="6415548">:=</span>&nbsp;<span class="ident" id="6415551">strings</span><span class="op" id="6415558">.</span><span class="ident" id="6415559">LastIndex</span><span class="op" id="6415568">(</span><span class="ident" id="6415569">prefix</span><span class="op" id="6415575">,</span>&nbsp;<span class="string" id="6415577">&#34;/&#34;</span><span class="op" id="6415580">)</span><span class="op" id="6415581">;</span>&nbsp;<span class="ident" id="6415583">i</span>&nbsp;<span class="op" id="6415585">&gt;=</span>&nbsp;<span class="num" id="6415588">0</span>&nbsp;<span class="op" id="6415590">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415594">prefix</span>&nbsp;<span class="op" id="6415601">=</span>&nbsp;<span class="ident" id="6415603">prefix</span><span class="op" id="6415609">[</span><span class="ident" id="6415610">i</span><span class="op" id="6415611">+</span><span class="num" id="6415612">1</span><span class="op" id="6415613">:</span><span class="op" id="6415614">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415620">if</span>&nbsp;<span class="ident" id="6415623">prefix</span>&nbsp;<span class="op" id="6415630">==</span>&nbsp;<span class="string" id="6415633">&#34;&#34;</span>&nbsp;<span class="op" id="6415636">||</span>&nbsp;<span class="op" id="6415639">!</span><span class="ident" id="6415640">isName</span><span class="op" id="6415646">(</span><span class="op" id="6415647">[</span><span class="op" id="6415648">]</span><span class="builtintype" id="6415649">byte</span><span class="op" id="6415653">(</span><span class="ident" id="6415654">prefix</span><span class="op" id="6415660">)</span><span class="op" id="6415661">)</span>&nbsp;<span class="op" id="6415663">||</span>&nbsp;<span class="ident" id="6415666">strings</span><span class="op" id="6415673">.</span><span class="ident" id="6415674">Contains</span><span class="op" id="6415682">(</span><span class="ident" id="6415683">prefix</span><span class="op" id="6415689">,</span>&nbsp;<span class="string" id="6415691">&#34;:&#34;</span><span class="op" id="6415694">)</span>&nbsp;<span class="op" id="6415696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415700">prefix</span>&nbsp;<span class="op" id="6415707">=</span>&nbsp;<span class="string" id="6415709">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415714">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415717">if</span>&nbsp;<span class="ident" id="6415720">strings</span><span class="op" id="6415727">.</span><span class="ident" id="6415728">HasPrefix</span><span class="op" id="6415737">(</span><span class="ident" id="6415738">prefix</span><span class="op" id="6415744">,</span>&nbsp;<span class="string" id="6415746">&#34;xml&#34;</span><span class="op" id="6415751">)</span>&nbsp;<span class="op" id="6415753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415757">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415787">prefix</span>&nbsp;<span class="op" id="6415794">=</span>&nbsp;<span class="string" id="6415796">&#34;_&#34;</span>&nbsp;<span class="op" id="6415800">+</span>&nbsp;<span class="ident" id="6415802">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415813">if</span>&nbsp;<span class="ident" id="6415816">p</span><span class="op" id="6415817">.</span><span class="ident" id="6415818">attrNS</span><span class="op" id="6415824">[</span><span class="ident" id="6415825">prefix</span><span class="op" id="6415831">]</span>&nbsp;<span class="op" id="6415833">!=</span>&nbsp;<span class="string" id="6415836">&#34;&#34;</span>&nbsp;<span class="op" id="6415839">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415843">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415882">for</span>&nbsp;<span class="ident" id="6415886">p</span><span class="op" id="6415887">.</span><span class="ident" id="6415888">seq</span><span class="op" id="6415891">++</span><span class="op" id="6415893">;</span>&nbsp;<span class="op" id="6415895">;</span>&nbsp;<span class="ident" id="6415897">p</span><span class="op" id="6415898">.</span><span class="ident" id="6415899">seq</span><span class="op" id="6415902">++</span>&nbsp;<span class="op" id="6415905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415910">if</span>&nbsp;<span class="ident" id="6415913">id</span>&nbsp;<span class="op" id="6415916">:=</span>&nbsp;<span class="ident" id="6415919">prefix</span>&nbsp;<span class="op" id="6415926">+</span>&nbsp;<span class="string" id="6415928">&#34;_&#34;</span>&nbsp;<span class="op" id="6415932">+</span>&nbsp;<span class="ident" id="6415934">strconv</span><span class="op" id="6415941">.</span><span class="ident" id="6415942">Itoa</span><span class="op" id="6415946">(</span><span class="ident" id="6415947">p</span><span class="op" id="6415948">.</span><span class="ident" id="6415949">seq</span><span class="op" id="6415952">)</span><span class="op" id="6415953">;</span>&nbsp;<span class="ident" id="6415955">p</span><span class="op" id="6415956">.</span><span class="ident" id="6415957">attrNS</span><span class="op" id="6415963">[</span><span class="ident" id="6415964">id</span><span class="op" id="6415966">]</span>&nbsp;<span class="op" id="6415968">==</span>&nbsp;<span class="string" id="6415971">&#34;&#34;</span>&nbsp;<span class="op" id="6415974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415980">prefix</span>&nbsp;<span class="op" id="6415987">=</span>&nbsp;<span class="ident" id="6415989">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415996">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416016">p</span><span class="op" id="6416017">.</span><span class="ident" id="6416018">attrPrefix</span><span class="op" id="6416028">[</span><span class="ident" id="6416029">url</span><span class="op" id="6416032">]</span>&nbsp;<span class="op" id="6416034">=</span>&nbsp;<span class="ident" id="6416036">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416044">p</span><span class="op" id="6416045">.</span><span class="ident" id="6416046">attrNS</span><span class="op" id="6416052">[</span><span class="ident" id="6416053">prefix</span><span class="op" id="6416059">]</span>&nbsp;<span class="op" id="6416061">=</span>&nbsp;<span class="ident" id="6416063">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416069">p</span><span class="op" id="6416070">.</span><span class="ident" id="6416071">WriteString</span><span class="op" id="6416082">(</span><span class="string" id="6416083">`xmlns:`</span><span class="op" id="6416091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416094">p</span><span class="op" id="6416095">.</span><span class="ident" id="6416096">WriteString</span><span class="op" id="6416107">(</span><span class="ident" id="6416108">prefix</span><span class="op" id="6416114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416117">p</span><span class="op" id="6416118">.</span><span class="ident" id="6416119">WriteString</span><span class="op" id="6416130">(</span><span class="string" id="6416131">`=&#34;`</span><span class="op" id="6416135">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416138">EscapeText</span><span class="op" id="6416148">(</span><span class="ident" id="6416149">p</span><span class="op" id="6416150">,</span>&nbsp;<span class="op" id="6416152">[</span><span class="op" id="6416153">]</span><span class="builtintype" id="6416154">byte</span><span class="op" id="6416158">(</span><span class="ident" id="6416159">url</span><span class="op" id="6416162">)</span><span class="op" id="6416163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416166">p</span><span class="op" id="6416167">.</span><span class="ident" id="6416168">WriteString</span><span class="op" id="6416179">(</span><span class="string" id="6416180">`&#34;&nbsp;`</span><span class="op" id="6416184">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416188">p</span><span class="op" id="6416189">.</span><span class="ident" id="6416190">prefixes</span>&nbsp;<span class="op" id="6416199">=</span>&nbsp;<span class="builtinfunc" id="6416201">append</span><span class="op" id="6416207">(</span><span class="ident" id="6416208">p</span><span class="op" id="6416209">.</span><span class="ident" id="6416210">prefixes</span><span class="op" id="6416218">,</span>&nbsp;<span class="ident" id="6416220">prefix</span><span class="op" id="6416226">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416230">return</span>&nbsp;<span class="ident" id="6416237">prefix</span><br>
<span class="lineno"></span><span class="op" id="6416244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6416247">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6416307">func</span>&nbsp;<span class="op" id="6416312">(</span><span class="ident" id="6416313">p</span>&nbsp;<span class="op" id="6416315">*</span><span class="ident" id="6416316">printer</span><span class="op" id="6416323">)</span>&nbsp;<span class="ident" id="6416325">deleteAttrPrefix</span><span class="op" id="6416341">(</span><span class="ident" id="6416342">prefix</span>&nbsp;<span class="builtintype" id="6416349">string</span><span class="op" id="6416355">)</span>&nbsp;<span class="op" id="6416357">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6416360">delete</span><span class="op" id="6416366">(</span><span class="ident" id="6416367">p</span><span class="op" id="6416368">.</span><span class="ident" id="6416369">attrPrefix</span><span class="op" id="6416379">,</span>&nbsp;<span class="ident" id="6416381">p</span><span class="op" id="6416382">.</span><span class="ident" id="6416383">attrNS</span><span class="op" id="6416389">[</span><span class="ident" id="6416390">prefix</span><span class="op" id="6416396">]</span><span class="op" id="6416397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6416400">delete</span><span class="op" id="6416406">(</span><span class="ident" id="6416407">p</span><span class="op" id="6416408">.</span><span class="ident" id="6416409">attrNS</span><span class="op" id="6416415">,</span>&nbsp;<span class="ident" id="6416417">prefix</span><span class="op" id="6416423">)</span><br>
<span class="lineno"></span><span class="op" id="6416425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6416428">func</span>&nbsp;<span class="op" id="6416433">(</span><span class="ident" id="6416434">p</span>&nbsp;<span class="op" id="6416436">*</span><span class="ident" id="6416437">printer</span><span class="op" id="6416444">)</span>&nbsp;<span class="ident" id="6416446">markPrefix</span><span class="op" id="6416456">(</span><span class="op" id="6416457">)</span>&nbsp;<span class="op" id="6416459">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416462">p</span><span class="op" id="6416463">.</span><span class="ident" id="6416464">prefixes</span>&nbsp;<span class="op" id="6416473">=</span>&nbsp;<span class="builtinfunc" id="6416475">append</span><span class="op" id="6416481">(</span><span class="ident" id="6416482">p</span><span class="op" id="6416483">.</span><span class="ident" id="6416484">prefixes</span><span class="op" id="6416492">,</span>&nbsp;<span class="string" id="6416494">&#34;&#34;</span><span class="op" id="6416496">)</span><br>
<span class="lineno"></span><span class="op" id="6416498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6416501">func</span>&nbsp;<span class="op" id="6416506">(</span><span class="ident" id="6416507">p</span>&nbsp;<span class="op" id="6416509">*</span><span class="ident" id="6416510">printer</span><span class="op" id="6416517">)</span>&nbsp;<span class="ident" id="6416519">popPrefix</span><span class="op" id="6416528">(</span><span class="op" id="6416529">)</span>&nbsp;<span class="op" id="6416531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416534">for</span>&nbsp;<span class="builtinfunc" id="6416538">len</span><span class="op" id="6416541">(</span><span class="ident" id="6416542">p</span><span class="op" id="6416543">.</span><span class="ident" id="6416544">prefixes</span><span class="op" id="6416552">)</span>&nbsp;<span class="op" id="6416554">&gt;</span>&nbsp;<span class="num" id="6416556">0</span>&nbsp;<span class="op" id="6416558">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416562">prefix</span>&nbsp;<span class="op" id="6416569">:=</span>&nbsp;<span class="ident" id="6416572">p</span><span class="op" id="6416573">.</span><span class="ident" id="6416574">prefixes</span><span class="op" id="6416582">[</span><span class="builtinfunc" id="6416583">len</span><span class="op" id="6416586">(</span><span class="ident" id="6416587">p</span><span class="op" id="6416588">.</span><span class="ident" id="6416589">prefixes</span><span class="op" id="6416597">)</span><span class="op" id="6416598">-</span><span class="num" id="6416599">1</span><span class="op" id="6416600">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416604">p</span><span class="op" id="6416605">.</span><span class="ident" id="6416606">prefixes</span>&nbsp;<span class="op" id="6416615">=</span>&nbsp;<span class="ident" id="6416617">p</span><span class="op" id="6416618">.</span><span class="ident" id="6416619">prefixes</span><span class="op" id="6416627">[</span><span class="op" id="6416628">:</span><span class="builtinfunc" id="6416629">len</span><span class="op" id="6416632">(</span><span class="ident" id="6416633">p</span><span class="op" id="6416634">.</span><span class="ident" id="6416635">prefixes</span><span class="op" id="6416643">)</span><span class="op" id="6416644">-</span><span class="num" id="6416645">1</span><span class="op" id="6416646">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416650">if</span>&nbsp;<span class="ident" id="6416653">prefix</span>&nbsp;<span class="op" id="6416660">==</span>&nbsp;<span class="string" id="6416663">&#34;&#34;</span>&nbsp;<span class="op" id="6416666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416671">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416679">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416683">p</span><span class="op" id="6416684">.</span><span class="ident" id="6416685">deleteAttrPrefix</span><span class="op" id="6416701">(</span><span class="ident" id="6416702">prefix</span><span class="op" id="6416708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416711">}</span><br>
<span class="lineno"></span><span class="op" id="6416713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6416716">var</span>&nbsp;<span class="op" id="6416720">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416723">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6416741">=</span>&nbsp;<span class="ident" id="6416743">reflect</span><span class="op" id="6416750">.</span><span class="ident" id="6416751">TypeOf</span><span class="op" id="6416757">(</span><span class="op" id="6416758">(</span><span class="op" id="6416759">*</span><span class="ident" id="6416760">Marshaler</span><span class="op" id="6416769">)</span><span class="op" id="6416770">(</span><span class="ident" id="6416771">nil</span><span class="op" id="6416774">)</span><span class="op" id="6416775">)</span><span class="op" id="6416776">.</span><span class="ident" id="6416777">Elem</span><span class="op" id="6416781">(</span><span class="op" id="6416782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416785">marshalerAttrType</span>&nbsp;<span class="op" id="6416803">=</span>&nbsp;<span class="ident" id="6416805">reflect</span><span class="op" id="6416812">.</span><span class="ident" id="6416813">TypeOf</span><span class="op" id="6416819">(</span><span class="op" id="6416820">(</span><span class="op" id="6416821">*</span><span class="ident" id="6416822">MarshalerAttr</span><span class="op" id="6416835">)</span><span class="op" id="6416836">(</span><span class="ident" id="6416837">nil</span><span class="op" id="6416840">)</span><span class="op" id="6416841">)</span><span class="op" id="6416842">.</span><span class="ident" id="6416843">Elem</span><span class="op" id="6416847">(</span><span class="op" id="6416848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416851">textMarshalerType</span>&nbsp;<span class="op" id="6416869">=</span>&nbsp;<span class="ident" id="6416871">reflect</span><span class="op" id="6416878">.</span><span class="ident" id="6416879">TypeOf</span><span class="op" id="6416885">(</span><span class="op" id="6416886">(</span><span class="op" id="6416887">*</span><span class="ident" id="6416888">encoding</span><span class="op" id="6416896">.</span><span class="ident" id="6416897">TextMarshaler</span><span class="op" id="6416910">)</span><span class="op" id="6416911">(</span><span class="ident" id="6416912">nil</span><span class="op" id="6416915">)</span><span class="op" id="6416916">)</span><span class="op" id="6416917">.</span><span class="ident" id="6416918">Elem</span><span class="op" id="6416922">(</span><span class="op" id="6416923">)</span><br>
<span class="lineno"></span><span class="op" id="6416925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="6416928">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="6416994">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="6417067">func</span>&nbsp;<span class="op" id="6417072">(</span><span class="ident" id="6417073">p</span>&nbsp;<span class="op" id="6417075">*</span><span class="ident" id="6417076">printer</span><span class="op" id="6417083">)</span>&nbsp;<span class="ident" id="6417085">marshalValue</span><span class="op" id="6417097">(</span><span class="ident" id="6417098">val</span>&nbsp;<span class="ident" id="6417102">reflect</span><span class="op" id="6417109">.</span><span class="ident" id="6417110">Value</span><span class="op" id="6417115">,</span>&nbsp;<span class="ident" id="6417117">finfo</span>&nbsp;<span class="op" id="6417123">*</span><span class="ident" id="6417124">fieldInfo</span><span class="op" id="6417133">,</span>&nbsp;<span class="ident" id="6417135">startTemplate</span>&nbsp;<span class="op" id="6417149">*</span><span class="ident" id="6417150">StartElement</span><span class="op" id="6417162">)</span>&nbsp;<span class="builtintype" id="6417164">error</span>&nbsp;<span class="op" id="6417170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417173">if</span>&nbsp;<span class="ident" id="6417176">startTemplate</span>&nbsp;<span class="op" id="6417190">!=</span>&nbsp;<span class="ident" id="6417193">nil</span>&nbsp;<span class="op" id="6417197">&amp;&amp;</span>&nbsp;<span class="ident" id="6417200">startTemplate</span><span class="op" id="6417213">.</span><span class="ident" id="6417214">Name</span><span class="op" id="6417218">.</span><span class="ident" id="6417219">Local</span>&nbsp;<span class="op" id="6417225">==</span>&nbsp;<span class="string" id="6417228">&#34;&#34;</span>&nbsp;<span class="op" id="6417231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417235">return</span>&nbsp;<span class="ident" id="6417242">fmt</span><span class="op" id="6417245">.</span><span class="ident" id="6417246">Errorf</span><span class="op" id="6417252">(</span><span class="string" id="6417253">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="6417307">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417314">if</span>&nbsp;<span class="op" id="6417317">!</span><span class="ident" id="6417318">val</span><span class="op" id="6417321">.</span><span class="ident" id="6417322">IsValid</span><span class="op" id="6417329">(</span><span class="op" id="6417330">)</span>&nbsp;<span class="op" id="6417332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417336">return</span>&nbsp;<span class="ident" id="6417343">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417348">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417351">if</span>&nbsp;<span class="ident" id="6417354">finfo</span>&nbsp;<span class="op" id="6417360">!=</span>&nbsp;<span class="ident" id="6417363">nil</span>&nbsp;<span class="op" id="6417367">&amp;&amp;</span>&nbsp;<span class="ident" id="6417370">finfo</span><span class="op" id="6417375">.</span><span class="ident" id="6417376">flags</span><span class="op" id="6417381">&amp;</span><span class="ident" id="6417382">fOmitEmpty</span>&nbsp;<span class="op" id="6417393">!=</span>&nbsp;<span class="num" id="6417396">0</span>&nbsp;<span class="op" id="6417398">&amp;&amp;</span>&nbsp;<span class="ident" id="6417401">isEmptyValue</span><span class="op" id="6417413">(</span><span class="ident" id="6417414">val</span><span class="op" id="6417417">)</span>&nbsp;<span class="op" id="6417419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417423">return</span>&nbsp;<span class="ident" id="6417430">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417439">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417479">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417541">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417579">for</span>&nbsp;<span class="ident" id="6417583">val</span><span class="op" id="6417586">.</span><span class="ident" id="6417587">Kind</span><span class="op" id="6417591">(</span><span class="op" id="6417592">)</span>&nbsp;<span class="op" id="6417594">==</span>&nbsp;<span class="ident" id="6417597">reflect</span><span class="op" id="6417604">.</span><span class="ident" id="6417605">Interface</span>&nbsp;<span class="op" id="6417615">||</span>&nbsp;<span class="ident" id="6417618">val</span><span class="op" id="6417621">.</span><span class="ident" id="6417622">Kind</span><span class="op" id="6417626">(</span><span class="op" id="6417627">)</span>&nbsp;<span class="op" id="6417629">==</span>&nbsp;<span class="ident" id="6417632">reflect</span><span class="op" id="6417639">.</span><span class="ident" id="6417640">Ptr</span>&nbsp;<span class="op" id="6417644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417648">if</span>&nbsp;<span class="ident" id="6417651">val</span><span class="op" id="6417654">.</span><span class="ident" id="6417655">IsNil</span><span class="op" id="6417660">(</span><span class="op" id="6417661">)</span>&nbsp;<span class="op" id="6417663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417668">return</span>&nbsp;<span class="ident" id="6417675">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417685">val</span>&nbsp;<span class="op" id="6417689">=</span>&nbsp;<span class="ident" id="6417691">val</span><span class="op" id="6417694">.</span><span class="ident" id="6417695">Elem</span><span class="op" id="6417699">(</span><span class="op" id="6417700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417707">kind</span>&nbsp;<span class="op" id="6417712">:=</span>&nbsp;<span class="ident" id="6417715">val</span><span class="op" id="6417718">.</span><span class="ident" id="6417719">Kind</span><span class="op" id="6417723">(</span><span class="op" id="6417724">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417727">typ</span>&nbsp;<span class="op" id="6417731">:=</span>&nbsp;<span class="ident" id="6417734">val</span><span class="op" id="6417737">.</span><span class="ident" id="6417738">Type</span><span class="op" id="6417742">(</span><span class="op" id="6417743">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417747">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417772">if</span>&nbsp;<span class="ident" id="6417775">val</span><span class="op" id="6417778">.</span><span class="ident" id="6417779">CanInterface</span><span class="op" id="6417791">(</span><span class="op" id="6417792">)</span>&nbsp;<span class="op" id="6417794">&amp;&amp;</span>&nbsp;<span class="ident" id="6417797">typ</span><span class="op" id="6417800">.</span><span class="ident" id="6417801">Implements</span><span class="op" id="6417811">(</span><span class="ident" id="6417812">marshalerType</span><span class="op" id="6417825">)</span>&nbsp;<span class="op" id="6417827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417831">return</span>&nbsp;<span class="ident" id="6417838">p</span><span class="op" id="6417839">.</span><span class="ident" id="6417840">marshalInterface</span><span class="op" id="6417856">(</span><span class="ident" id="6417857">val</span><span class="op" id="6417860">.</span><span class="ident" id="6417861">Interface</span><span class="op" id="6417870">(</span><span class="op" id="6417871">)</span><span class="op" id="6417872">.</span><span class="op" id="6417873">(</span><span class="ident" id="6417874">Marshaler</span><span class="op" id="6417883">)</span><span class="op" id="6417884">,</span>&nbsp;<span class="ident" id="6417886">defaultStart</span><span class="op" id="6417898">(</span><span class="ident" id="6417899">typ</span><span class="op" id="6417902">,</span>&nbsp;<span class="ident" id="6417904">finfo</span><span class="op" id="6417909">,</span>&nbsp;<span class="ident" id="6417911">startTemplate</span><span class="op" id="6417924">)</span><span class="op" id="6417925">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417931">if</span>&nbsp;<span class="ident" id="6417934">val</span><span class="op" id="6417937">.</span><span class="ident" id="6417938">CanAddr</span><span class="op" id="6417945">(</span><span class="op" id="6417946">)</span>&nbsp;<span class="op" id="6417948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417952">pv</span>&nbsp;<span class="op" id="6417955">:=</span>&nbsp;<span class="ident" id="6417958">val</span><span class="op" id="6417961">.</span><span class="ident" id="6417962">Addr</span><span class="op" id="6417966">(</span><span class="op" id="6417967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417971">if</span>&nbsp;<span class="ident" id="6417974">pv</span><span class="op" id="6417976">.</span><span class="ident" id="6417977">CanInterface</span><span class="op" id="6417989">(</span><span class="op" id="6417990">)</span>&nbsp;<span class="op" id="6417992">&amp;&amp;</span>&nbsp;<span class="ident" id="6417995">pv</span><span class="op" id="6417997">.</span><span class="ident" id="6417998">Type</span><span class="op" id="6418002">(</span><span class="op" id="6418003">)</span><span class="op" id="6418004">.</span><span class="ident" id="6418005">Implements</span><span class="op" id="6418015">(</span><span class="ident" id="6418016">marshalerType</span><span class="op" id="6418029">)</span>&nbsp;<span class="op" id="6418031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418036">return</span>&nbsp;<span class="ident" id="6418043">p</span><span class="op" id="6418044">.</span><span class="ident" id="6418045">marshalInterface</span><span class="op" id="6418061">(</span><span class="ident" id="6418062">pv</span><span class="op" id="6418064">.</span><span class="ident" id="6418065">Interface</span><span class="op" id="6418074">(</span><span class="op" id="6418075">)</span><span class="op" id="6418076">.</span><span class="op" id="6418077">(</span><span class="ident" id="6418078">Marshaler</span><span class="op" id="6418087">)</span><span class="op" id="6418088">,</span>&nbsp;<span class="ident" id="6418090">defaultStart</span><span class="op" id="6418102">(</span><span class="ident" id="6418103">pv</span><span class="op" id="6418105">.</span><span class="ident" id="6418106">Type</span><span class="op" id="6418110">(</span><span class="op" id="6418111">)</span><span class="op" id="6418112">,</span>&nbsp;<span class="ident" id="6418114">finfo</span><span class="op" id="6418119">,</span>&nbsp;<span class="ident" id="6418121">startTemplate</span><span class="op" id="6418134">)</span><span class="op" id="6418135">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6418146">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418176">if</span>&nbsp;<span class="ident" id="6418179">val</span><span class="op" id="6418182">.</span><span class="ident" id="6418183">CanInterface</span><span class="op" id="6418195">(</span><span class="op" id="6418196">)</span>&nbsp;<span class="op" id="6418198">&amp;&amp;</span>&nbsp;<span class="ident" id="6418201">typ</span><span class="op" id="6418204">.</span><span class="ident" id="6418205">Implements</span><span class="op" id="6418215">(</span><span class="ident" id="6418216">textMarshalerType</span><span class="op" id="6418233">)</span>&nbsp;<span class="op" id="6418235">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418239">return</span>&nbsp;<span class="ident" id="6418246">p</span><span class="op" id="6418247">.</span><span class="ident" id="6418248">marshalTextInterface</span><span class="op" id="6418268">(</span><span class="ident" id="6418269">val</span><span class="op" id="6418272">.</span><span class="ident" id="6418273">Interface</span><span class="op" id="6418282">(</span><span class="op" id="6418283">)</span><span class="op" id="6418284">.</span><span class="op" id="6418285">(</span><span class="ident" id="6418286">encoding</span><span class="op" id="6418294">.</span><span class="ident" id="6418295">TextMarshaler</span><span class="op" id="6418308">)</span><span class="op" id="6418309">,</span>&nbsp;<span class="ident" id="6418311">defaultStart</span><span class="op" id="6418323">(</span><span class="ident" id="6418324">typ</span><span class="op" id="6418327">,</span>&nbsp;<span class="ident" id="6418329">finfo</span><span class="op" id="6418334">,</span>&nbsp;<span class="ident" id="6418336">startTemplate</span><span class="op" id="6418349">)</span><span class="op" id="6418350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418356">if</span>&nbsp;<span class="ident" id="6418359">val</span><span class="op" id="6418362">.</span><span class="ident" id="6418363">CanAddr</span><span class="op" id="6418370">(</span><span class="op" id="6418371">)</span>&nbsp;<span class="op" id="6418373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418377">pv</span>&nbsp;<span class="op" id="6418380">:=</span>&nbsp;<span class="ident" id="6418383">val</span><span class="op" id="6418386">.</span><span class="ident" id="6418387">Addr</span><span class="op" id="6418391">(</span><span class="op" id="6418392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418396">if</span>&nbsp;<span class="ident" id="6418399">pv</span><span class="op" id="6418401">.</span><span class="ident" id="6418402">CanInterface</span><span class="op" id="6418414">(</span><span class="op" id="6418415">)</span>&nbsp;<span class="op" id="6418417">&amp;&amp;</span>&nbsp;<span class="ident" id="6418420">pv</span><span class="op" id="6418422">.</span><span class="ident" id="6418423">Type</span><span class="op" id="6418427">(</span><span class="op" id="6418428">)</span><span class="op" id="6418429">.</span><span class="ident" id="6418430">Implements</span><span class="op" id="6418440">(</span><span class="ident" id="6418441">textMarshalerType</span><span class="op" id="6418458">)</span>&nbsp;<span class="op" id="6418460">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418465">return</span>&nbsp;<span class="ident" id="6418472">p</span><span class="op" id="6418473">.</span><span class="ident" id="6418474">marshalTextInterface</span><span class="op" id="6418494">(</span><span class="ident" id="6418495">pv</span><span class="op" id="6418497">.</span><span class="ident" id="6418498">Interface</span><span class="op" id="6418507">(</span><span class="op" id="6418508">)</span><span class="op" id="6418509">.</span><span class="op" id="6418510">(</span><span class="ident" id="6418511">encoding</span><span class="op" id="6418519">.</span><span class="ident" id="6418520">TextMarshaler</span><span class="op" id="6418533">)</span><span class="op" id="6418534">,</span>&nbsp;<span class="ident" id="6418536">defaultStart</span><span class="op" id="6418548">(</span><span class="ident" id="6418549">pv</span><span class="op" id="6418551">.</span><span class="ident" id="6418552">Type</span><span class="op" id="6418556">(</span><span class="op" id="6418557">)</span><span class="op" id="6418558">,</span>&nbsp;<span class="ident" id="6418560">finfo</span><span class="op" id="6418565">,</span>&nbsp;<span class="ident" id="6418567">startTemplate</span><span class="op" id="6418580">)</span><span class="op" id="6418581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6418592">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418676">if</span>&nbsp;<span class="op" id="6418679">(</span><span class="ident" id="6418680">kind</span>&nbsp;<span class="op" id="6418685">==</span>&nbsp;<span class="ident" id="6418688">reflect</span><span class="op" id="6418695">.</span><span class="ident" id="6418696">Slice</span>&nbsp;<span class="op" id="6418702">||</span>&nbsp;<span class="ident" id="6418705">kind</span>&nbsp;<span class="op" id="6418710">==</span>&nbsp;<span class="ident" id="6418713">reflect</span><span class="op" id="6418720">.</span><span class="ident" id="6418721">Array</span><span class="op" id="6418726">)</span>&nbsp;<span class="op" id="6418728">&amp;&amp;</span>&nbsp;<span class="ident" id="6418731">typ</span><span class="op" id="6418734">.</span><span class="ident" id="6418735">Elem</span><span class="op" id="6418739">(</span><span class="op" id="6418740">)</span><span class="op" id="6418741">.</span><span class="ident" id="6418742">Kind</span><span class="op" id="6418746">(</span><span class="op" id="6418747">)</span>&nbsp;<span class="op" id="6418749">!=</span>&nbsp;<span class="ident" id="6418752">reflect</span><span class="op" id="6418759">.</span><span class="ident" id="6418760">Uint8</span>&nbsp;<span class="op" id="6418766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418770">for</span>&nbsp;<span class="ident" id="6418774">i</span><span class="op" id="6418775">,</span>&nbsp;<span class="ident" id="6418777">n</span>&nbsp;<span class="op" id="6418779">:=</span>&nbsp;<span class="num" id="6418782">0</span><span class="op" id="6418783">,</span>&nbsp;<span class="ident" id="6418785">val</span><span class="op" id="6418788">.</span><span class="ident" id="6418789">Len</span><span class="op" id="6418792">(</span><span class="op" id="6418793">)</span><span class="op" id="6418794">;</span>&nbsp;<span class="ident" id="6418796">i</span>&nbsp;<span class="op" id="6418798">&lt;</span>&nbsp;<span class="ident" id="6418800">n</span><span class="op" id="6418801">;</span>&nbsp;<span class="ident" id="6418803">i</span><span class="op" id="6418804">++</span>&nbsp;<span class="op" id="6418807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418812">if</span>&nbsp;<span class="ident" id="6418815">err</span>&nbsp;<span class="op" id="6418819">:=</span>&nbsp;<span class="ident" id="6418822">p</span><span class="op" id="6418823">.</span><span class="ident" id="6418824">marshalValue</span><span class="op" id="6418836">(</span><span class="ident" id="6418837">val</span><span class="op" id="6418840">.</span><span class="ident" id="6418841">Index</span><span class="op" id="6418846">(</span><span class="ident" id="6418847">i</span><span class="op" id="6418848">)</span><span class="op" id="6418849">,</span>&nbsp;<span class="ident" id="6418851">finfo</span><span class="op" id="6418856">,</span>&nbsp;<span class="ident" id="6418858">startTemplate</span><span class="op" id="6418871">)</span><span class="op" id="6418872">;</span>&nbsp;<span class="ident" id="6418874">err</span>&nbsp;<span class="op" id="6418878">!=</span>&nbsp;<span class="ident" id="6418881">nil</span>&nbsp;<span class="op" id="6418885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418891">return</span>&nbsp;<span class="ident" id="6418898">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418905">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418913">return</span>&nbsp;<span class="ident" id="6418920">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418929">tinfo</span><span class="op" id="6418934">,</span>&nbsp;<span class="ident" id="6418936">err</span>&nbsp;<span class="op" id="6418940">:=</span>&nbsp;<span class="ident" id="6418943">getTypeInfo</span><span class="op" id="6418954">(</span><span class="ident" id="6418955">typ</span><span class="op" id="6418958">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418961">if</span>&nbsp;<span class="ident" id="6418964">err</span>&nbsp;<span class="op" id="6418968">!=</span>&nbsp;<span class="ident" id="6418971">nil</span>&nbsp;<span class="op" id="6418975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418979">return</span>&nbsp;<span class="ident" id="6418986">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6418995">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419021">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419065">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419086">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419129">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419176">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419193">var</span>&nbsp;<span class="ident" id="6419197">start</span>&nbsp;<span class="ident" id="6419203">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419218">if</span>&nbsp;<span class="ident" id="6419221">startTemplate</span>&nbsp;<span class="op" id="6419235">!=</span>&nbsp;<span class="ident" id="6419238">nil</span>&nbsp;<span class="op" id="6419242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419246">start</span><span class="op" id="6419251">.</span><span class="ident" id="6419252">Name</span>&nbsp;<span class="op" id="6419257">=</span>&nbsp;<span class="ident" id="6419259">startTemplate</span><span class="op" id="6419272">.</span><span class="ident" id="6419273">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419280">start</span><span class="op" id="6419285">.</span><span class="ident" id="6419286">Attr</span>&nbsp;<span class="op" id="6419291">=</span>&nbsp;<span class="builtinfunc" id="6419293">append</span><span class="op" id="6419299">(</span><span class="ident" id="6419300">start</span><span class="op" id="6419305">.</span><span class="ident" id="6419306">Attr</span><span class="op" id="6419310">,</span>&nbsp;<span class="ident" id="6419312">startTemplate</span><span class="op" id="6419325">.</span><span class="ident" id="6419326">Attr</span><span class="op" id="6419330">...</span><span class="op" id="6419333">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419336">}</span>&nbsp;<span class="keyword" id="6419338">else</span>&nbsp;<span class="keyword" id="6419343">if</span>&nbsp;<span class="ident" id="6419346">tinfo</span><span class="op" id="6419351">.</span><span class="ident" id="6419352">xmlname</span>&nbsp;<span class="op" id="6419360">!=</span>&nbsp;<span class="ident" id="6419363">nil</span>&nbsp;<span class="op" id="6419367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419371">xmlname</span>&nbsp;<span class="op" id="6419379">:=</span>&nbsp;<span class="ident" id="6419382">tinfo</span><span class="op" id="6419387">.</span><span class="ident" id="6419388">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419398">if</span>&nbsp;<span class="ident" id="6419401">xmlname</span><span class="op" id="6419408">.</span><span class="ident" id="6419409">name</span>&nbsp;<span class="op" id="6419414">!=</span>&nbsp;<span class="string" id="6419417">&#34;&#34;</span>&nbsp;<span class="op" id="6419420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419425">start</span><span class="op" id="6419430">.</span><span class="ident" id="6419431">Name</span><span class="op" id="6419435">.</span><span class="ident" id="6419436">Space</span><span class="op" id="6419441">,</span>&nbsp;<span class="ident" id="6419443">start</span><span class="op" id="6419448">.</span><span class="ident" id="6419449">Name</span><span class="op" id="6419453">.</span><span class="ident" id="6419454">Local</span>&nbsp;<span class="op" id="6419460">=</span>&nbsp;<span class="ident" id="6419462">xmlname</span><span class="op" id="6419469">.</span><span class="ident" id="6419470">xmlns</span><span class="op" id="6419475">,</span>&nbsp;<span class="ident" id="6419477">xmlname</span><span class="op" id="6419484">.</span><span class="ident" id="6419485">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419492">}</span>&nbsp;<span class="keyword" id="6419494">else</span>&nbsp;<span class="keyword" id="6419499">if</span>&nbsp;<span class="ident" id="6419502">v</span><span class="op" id="6419503">,</span>&nbsp;<span class="ident" id="6419505">ok</span>&nbsp;<span class="op" id="6419508">:=</span>&nbsp;<span class="ident" id="6419511">xmlname</span><span class="op" id="6419518">.</span><span class="ident" id="6419519">value</span><span class="op" id="6419524">(</span><span class="ident" id="6419525">val</span><span class="op" id="6419528">)</span><span class="op" id="6419529">.</span><span class="ident" id="6419530">Interface</span><span class="op" id="6419539">(</span><span class="op" id="6419540">)</span><span class="op" id="6419541">.</span><span class="op" id="6419542">(</span><span class="ident" id="6419543">Name</span><span class="op" id="6419547">)</span><span class="op" id="6419548">;</span>&nbsp;<span class="ident" id="6419550">ok</span>&nbsp;<span class="op" id="6419553">&amp;&amp;</span>&nbsp;<span class="ident" id="6419556">v</span><span class="op" id="6419557">.</span><span class="ident" id="6419558">Local</span>&nbsp;<span class="op" id="6419564">!=</span>&nbsp;<span class="string" id="6419567">&#34;&#34;</span>&nbsp;<span class="op" id="6419570">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419575">start</span><span class="op" id="6419580">.</span><span class="ident" id="6419581">Name</span>&nbsp;<span class="op" id="6419586">=</span>&nbsp;<span class="ident" id="6419588">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419598">if</span>&nbsp;<span class="ident" id="6419601">start</span><span class="op" id="6419606">.</span><span class="ident" id="6419607">Name</span><span class="op" id="6419611">.</span><span class="ident" id="6419612">Local</span>&nbsp;<span class="op" id="6419618">==</span>&nbsp;<span class="string" id="6419621">&#34;&#34;</span>&nbsp;<span class="op" id="6419624">&amp;&amp;</span>&nbsp;<span class="ident" id="6419627">finfo</span>&nbsp;<span class="op" id="6419633">!=</span>&nbsp;<span class="ident" id="6419636">nil</span>&nbsp;<span class="op" id="6419640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419644">start</span><span class="op" id="6419649">.</span><span class="ident" id="6419650">Name</span><span class="op" id="6419654">.</span><span class="ident" id="6419655">Space</span><span class="op" id="6419660">,</span>&nbsp;<span class="ident" id="6419662">start</span><span class="op" id="6419667">.</span><span class="ident" id="6419668">Name</span><span class="op" id="6419672">.</span><span class="ident" id="6419673">Local</span>&nbsp;<span class="op" id="6419679">=</span>&nbsp;<span class="ident" id="6419681">finfo</span><span class="op" id="6419686">.</span><span class="ident" id="6419687">xmlns</span><span class="op" id="6419692">,</span>&nbsp;<span class="ident" id="6419694">finfo</span><span class="op" id="6419699">.</span><span class="ident" id="6419700">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419709">if</span>&nbsp;<span class="ident" id="6419712">start</span><span class="op" id="6419717">.</span><span class="ident" id="6419718">Name</span><span class="op" id="6419722">.</span><span class="ident" id="6419723">Local</span>&nbsp;<span class="op" id="6419729">==</span>&nbsp;<span class="string" id="6419732">&#34;&#34;</span>&nbsp;<span class="op" id="6419735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419739">name</span>&nbsp;<span class="op" id="6419744">:=</span>&nbsp;<span class="ident" id="6419747">typ</span><span class="op" id="6419750">.</span><span class="ident" id="6419751">Name</span><span class="op" id="6419755">(</span><span class="op" id="6419756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419760">if</span>&nbsp;<span class="ident" id="6419763">name</span>&nbsp;<span class="op" id="6419768">==</span>&nbsp;<span class="string" id="6419771">&#34;&#34;</span>&nbsp;<span class="op" id="6419774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419779">return</span>&nbsp;<span class="op" id="6419786">&amp;</span><span class="ident" id="6419787">UnsupportedTypeError</span><span class="op" id="6419807">{</span><span class="ident" id="6419808">typ</span><span class="op" id="6419811">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419819">start</span><span class="op" id="6419824">.</span><span class="ident" id="6419825">Name</span><span class="op" id="6419829">.</span><span class="ident" id="6419830">Local</span>&nbsp;<span class="op" id="6419836">=</span>&nbsp;<span class="ident" id="6419838">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419848">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419863">for</span>&nbsp;<span class="ident" id="6419867">i</span>&nbsp;<span class="op" id="6419869">:=</span>&nbsp;<span class="keyword" id="6419872">range</span>&nbsp;<span class="ident" id="6419878">tinfo</span><span class="op" id="6419883">.</span><span class="ident" id="6419884">fields</span>&nbsp;<span class="op" id="6419891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419895">finfo</span>&nbsp;<span class="op" id="6419901">:=</span>&nbsp;<span class="op" id="6419904">&amp;</span><span class="ident" id="6419905">tinfo</span><span class="op" id="6419910">.</span><span class="ident" id="6419911">fields</span><span class="op" id="6419917">[</span><span class="ident" id="6419918">i</span><span class="op" id="6419919">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419923">if</span>&nbsp;<span class="ident" id="6419926">finfo</span><span class="op" id="6419931">.</span><span class="ident" id="6419932">flags</span><span class="op" id="6419937">&amp;</span><span class="ident" id="6419938">fAttr</span>&nbsp;<span class="op" id="6419944">==</span>&nbsp;<span class="num" id="6419947">0</span>&nbsp;<span class="op" id="6419949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419954">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419965">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419969">fv</span>&nbsp;<span class="op" id="6419972">:=</span>&nbsp;<span class="ident" id="6419975">finfo</span><span class="op" id="6419980">.</span><span class="ident" id="6419981">value</span><span class="op" id="6419986">(</span><span class="ident" id="6419987">val</span><span class="op" id="6419990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419994">name</span>&nbsp;<span class="op" id="6419999">:=</span>&nbsp;<span class="ident" id="6420002">Name</span><span class="op" id="6420006">{</span><span class="ident" id="6420007">Space</span><span class="op" id="6420012">:</span>&nbsp;<span class="ident" id="6420014">finfo</span><span class="op" id="6420019">.</span><span class="ident" id="6420020">xmlns</span><span class="op" id="6420025">,</span>&nbsp;<span class="ident" id="6420027">Local</span><span class="op" id="6420032">:</span>&nbsp;<span class="ident" id="6420034">finfo</span><span class="op" id="6420039">.</span><span class="ident" id="6420040">name</span><span class="op" id="6420044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420049">if</span>&nbsp;<span class="ident" id="6420052">finfo</span><span class="op" id="6420057">.</span><span class="ident" id="6420058">flags</span><span class="op" id="6420063">&amp;</span><span class="ident" id="6420064">fOmitEmpty</span>&nbsp;<span class="op" id="6420075">!=</span>&nbsp;<span class="num" id="6420078">0</span>&nbsp;<span class="op" id="6420080">&amp;&amp;</span>&nbsp;<span class="ident" id="6420083">isEmptyValue</span><span class="op" id="6420095">(</span><span class="ident" id="6420096">fv</span><span class="op" id="6420098">)</span>&nbsp;<span class="op" id="6420100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420105">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420121">if</span>&nbsp;<span class="ident" id="6420124">fv</span><span class="op" id="6420126">.</span><span class="ident" id="6420127">Kind</span><span class="op" id="6420131">(</span><span class="op" id="6420132">)</span>&nbsp;<span class="op" id="6420134">==</span>&nbsp;<span class="ident" id="6420137">reflect</span><span class="op" id="6420144">.</span><span class="ident" id="6420145">Interface</span>&nbsp;<span class="op" id="6420155">&amp;&amp;</span>&nbsp;<span class="ident" id="6420158">fv</span><span class="op" id="6420160">.</span><span class="ident" id="6420161">IsNil</span><span class="op" id="6420166">(</span><span class="op" id="6420167">)</span>&nbsp;<span class="op" id="6420169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420174">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420185">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420190">if</span>&nbsp;<span class="ident" id="6420193">fv</span><span class="op" id="6420195">.</span><span class="ident" id="6420196">CanInterface</span><span class="op" id="6420208">(</span><span class="op" id="6420209">)</span>&nbsp;<span class="op" id="6420211">&amp;&amp;</span>&nbsp;<span class="ident" id="6420214">fv</span><span class="op" id="6420216">.</span><span class="ident" id="6420217">Type</span><span class="op" id="6420221">(</span><span class="op" id="6420222">)</span><span class="op" id="6420223">.</span><span class="ident" id="6420224">Implements</span><span class="op" id="6420234">(</span><span class="ident" id="6420235">marshalerAttrType</span><span class="op" id="6420252">)</span>&nbsp;<span class="op" id="6420254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420259">attr</span><span class="op" id="6420263">,</span>&nbsp;<span class="ident" id="6420265">err</span>&nbsp;<span class="op" id="6420269">:=</span>&nbsp;<span class="ident" id="6420272">fv</span><span class="op" id="6420274">.</span><span class="ident" id="6420275">Interface</span><span class="op" id="6420284">(</span><span class="op" id="6420285">)</span><span class="op" id="6420286">.</span><span class="op" id="6420287">(</span><span class="ident" id="6420288">MarshalerAttr</span><span class="op" id="6420301">)</span><span class="op" id="6420302">.</span><span class="ident" id="6420303">MarshalXMLAttr</span><span class="op" id="6420317">(</span><span class="ident" id="6420318">name</span><span class="op" id="6420322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420327">if</span>&nbsp;<span class="ident" id="6420330">err</span>&nbsp;<span class="op" id="6420334">!=</span>&nbsp;<span class="ident" id="6420337">nil</span>&nbsp;<span class="op" id="6420341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420347">return</span>&nbsp;<span class="ident" id="6420354">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420366">if</span>&nbsp;<span class="ident" id="6420369">attr</span><span class="op" id="6420373">.</span><span class="ident" id="6420374">Name</span><span class="op" id="6420378">.</span><span class="ident" id="6420379">Local</span>&nbsp;<span class="op" id="6420385">!=</span>&nbsp;<span class="string" id="6420388">&#34;&#34;</span>&nbsp;<span class="op" id="6420391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420397">start</span><span class="op" id="6420402">.</span><span class="ident" id="6420403">Attr</span>&nbsp;<span class="op" id="6420408">=</span>&nbsp;<span class="builtinfunc" id="6420410">append</span><span class="op" id="6420416">(</span><span class="ident" id="6420417">start</span><span class="op" id="6420422">.</span><span class="ident" id="6420423">Attr</span><span class="op" id="6420427">,</span>&nbsp;<span class="ident" id="6420429">attr</span><span class="op" id="6420433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420443">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420459">if</span>&nbsp;<span class="ident" id="6420462">fv</span><span class="op" id="6420464">.</span><span class="ident" id="6420465">CanAddr</span><span class="op" id="6420472">(</span><span class="op" id="6420473">)</span>&nbsp;<span class="op" id="6420475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420480">pv</span>&nbsp;<span class="op" id="6420483">:=</span>&nbsp;<span class="ident" id="6420486">fv</span><span class="op" id="6420488">.</span><span class="ident" id="6420489">Addr</span><span class="op" id="6420493">(</span><span class="op" id="6420494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420499">if</span>&nbsp;<span class="ident" id="6420502">pv</span><span class="op" id="6420504">.</span><span class="ident" id="6420505">CanInterface</span><span class="op" id="6420517">(</span><span class="op" id="6420518">)</span>&nbsp;<span class="op" id="6420520">&amp;&amp;</span>&nbsp;<span class="ident" id="6420523">pv</span><span class="op" id="6420525">.</span><span class="ident" id="6420526">Type</span><span class="op" id="6420530">(</span><span class="op" id="6420531">)</span><span class="op" id="6420532">.</span><span class="ident" id="6420533">Implements</span><span class="op" id="6420543">(</span><span class="ident" id="6420544">marshalerAttrType</span><span class="op" id="6420561">)</span>&nbsp;<span class="op" id="6420563">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420569">attr</span><span class="op" id="6420573">,</span>&nbsp;<span class="ident" id="6420575">err</span>&nbsp;<span class="op" id="6420579">:=</span>&nbsp;<span class="ident" id="6420582">pv</span><span class="op" id="6420584">.</span><span class="ident" id="6420585">Interface</span><span class="op" id="6420594">(</span><span class="op" id="6420595">)</span><span class="op" id="6420596">.</span><span class="op" id="6420597">(</span><span class="ident" id="6420598">MarshalerAttr</span><span class="op" id="6420611">)</span><span class="op" id="6420612">.</span><span class="ident" id="6420613">MarshalXMLAttr</span><span class="op" id="6420627">(</span><span class="ident" id="6420628">name</span><span class="op" id="6420632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420638">if</span>&nbsp;<span class="ident" id="6420641">err</span>&nbsp;<span class="op" id="6420645">!=</span>&nbsp;<span class="ident" id="6420648">nil</span>&nbsp;<span class="op" id="6420652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420659">return</span>&nbsp;<span class="ident" id="6420666">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420680">if</span>&nbsp;<span class="ident" id="6420683">attr</span><span class="op" id="6420687">.</span><span class="ident" id="6420688">Name</span><span class="op" id="6420692">.</span><span class="ident" id="6420693">Local</span>&nbsp;<span class="op" id="6420699">!=</span>&nbsp;<span class="string" id="6420702">&#34;&#34;</span>&nbsp;<span class="op" id="6420705">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420712">start</span><span class="op" id="6420717">.</span><span class="ident" id="6420718">Attr</span>&nbsp;<span class="op" id="6420723">=</span>&nbsp;<span class="builtinfunc" id="6420725">append</span><span class="op" id="6420731">(</span><span class="ident" id="6420732">start</span><span class="op" id="6420737">.</span><span class="ident" id="6420738">Attr</span><span class="op" id="6420742">,</span>&nbsp;<span class="ident" id="6420744">attr</span><span class="op" id="6420748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420760">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420776">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420781">if</span>&nbsp;<span class="ident" id="6420784">fv</span><span class="op" id="6420786">.</span><span class="ident" id="6420787">CanInterface</span><span class="op" id="6420799">(</span><span class="op" id="6420800">)</span>&nbsp;<span class="op" id="6420802">&amp;&amp;</span>&nbsp;<span class="ident" id="6420805">fv</span><span class="op" id="6420807">.</span><span class="ident" id="6420808">Type</span><span class="op" id="6420812">(</span><span class="op" id="6420813">)</span><span class="op" id="6420814">.</span><span class="ident" id="6420815">Implements</span><span class="op" id="6420825">(</span><span class="ident" id="6420826">textMarshalerType</span><span class="op" id="6420843">)</span>&nbsp;<span class="op" id="6420845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420850">text</span><span class="op" id="6420854">,</span>&nbsp;<span class="ident" id="6420856">err</span>&nbsp;<span class="op" id="6420860">:=</span>&nbsp;<span class="ident" id="6420863">fv</span><span class="op" id="6420865">.</span><span class="ident" id="6420866">Interface</span><span class="op" id="6420875">(</span><span class="op" id="6420876">)</span><span class="op" id="6420877">.</span><span class="op" id="6420878">(</span><span class="ident" id="6420879">encoding</span><span class="op" id="6420887">.</span><span class="ident" id="6420888">TextMarshaler</span><span class="op" id="6420901">)</span><span class="op" id="6420902">.</span><span class="ident" id="6420903">MarshalText</span><span class="op" id="6420914">(</span><span class="op" id="6420915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420920">if</span>&nbsp;<span class="ident" id="6420923">err</span>&nbsp;<span class="op" id="6420927">!=</span>&nbsp;<span class="ident" id="6420930">nil</span>&nbsp;<span class="op" id="6420934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420940">return</span>&nbsp;<span class="ident" id="6420947">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420959">start</span><span class="op" id="6420964">.</span><span class="ident" id="6420965">Attr</span>&nbsp;<span class="op" id="6420970">=</span>&nbsp;<span class="builtinfunc" id="6420972">append</span><span class="op" id="6420978">(</span><span class="ident" id="6420979">start</span><span class="op" id="6420984">.</span><span class="ident" id="6420985">Attr</span><span class="op" id="6420989">,</span>&nbsp;<span class="ident" id="6420991">Attr</span><span class="op" id="6420995">{</span><span class="ident" id="6420996">name</span><span class="op" id="6421000">,</span>&nbsp;<span class="builtintype" id="6421002">string</span><span class="op" id="6421008">(</span><span class="ident" id="6421009">text</span><span class="op" id="6421013">)</span><span class="op" id="6421014">}</span><span class="op" id="6421015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421020">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421036">if</span>&nbsp;<span class="ident" id="6421039">fv</span><span class="op" id="6421041">.</span><span class="ident" id="6421042">CanAddr</span><span class="op" id="6421049">(</span><span class="op" id="6421050">)</span>&nbsp;<span class="op" id="6421052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421057">pv</span>&nbsp;<span class="op" id="6421060">:=</span>&nbsp;<span class="ident" id="6421063">fv</span><span class="op" id="6421065">.</span><span class="ident" id="6421066">Addr</span><span class="op" id="6421070">(</span><span class="op" id="6421071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421076">if</span>&nbsp;<span class="ident" id="6421079">pv</span><span class="op" id="6421081">.</span><span class="ident" id="6421082">CanInterface</span><span class="op" id="6421094">(</span><span class="op" id="6421095">)</span>&nbsp;<span class="op" id="6421097">&amp;&amp;</span>&nbsp;<span class="ident" id="6421100">pv</span><span class="op" id="6421102">.</span><span class="ident" id="6421103">Type</span><span class="op" id="6421107">(</span><span class="op" id="6421108">)</span><span class="op" id="6421109">.</span><span class="ident" id="6421110">Implements</span><span class="op" id="6421120">(</span><span class="ident" id="6421121">textMarshalerType</span><span class="op" id="6421138">)</span>&nbsp;<span class="op" id="6421140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421146">text</span><span class="op" id="6421150">,</span>&nbsp;<span class="ident" id="6421152">err</span>&nbsp;<span class="op" id="6421156">:=</span>&nbsp;<span class="ident" id="6421159">pv</span><span class="op" id="6421161">.</span><span class="ident" id="6421162">Interface</span><span class="op" id="6421171">(</span><span class="op" id="6421172">)</span><span class="op" id="6421173">.</span><span class="op" id="6421174">(</span><span class="ident" id="6421175">encoding</span><span class="op" id="6421183">.</span><span class="ident" id="6421184">TextMarshaler</span><span class="op" id="6421197">)</span><span class="op" id="6421198">.</span><span class="ident" id="6421199">MarshalText</span><span class="op" id="6421210">(</span><span class="op" id="6421211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421217">if</span>&nbsp;<span class="ident" id="6421220">err</span>&nbsp;<span class="op" id="6421224">!=</span>&nbsp;<span class="ident" id="6421227">nil</span>&nbsp;<span class="op" id="6421231">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421238">return</span>&nbsp;<span class="ident" id="6421245">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421259">start</span><span class="op" id="6421264">.</span><span class="ident" id="6421265">Attr</span>&nbsp;<span class="op" id="6421270">=</span>&nbsp;<span class="builtinfunc" id="6421272">append</span><span class="op" id="6421278">(</span><span class="ident" id="6421279">start</span><span class="op" id="6421284">.</span><span class="ident" id="6421285">Attr</span><span class="op" id="6421289">,</span>&nbsp;<span class="ident" id="6421291">Attr</span><span class="op" id="6421295">{</span><span class="ident" id="6421296">name</span><span class="op" id="6421300">,</span>&nbsp;<span class="builtintype" id="6421302">string</span><span class="op" id="6421308">(</span><span class="ident" id="6421309">text</span><span class="op" id="6421313">)</span><span class="op" id="6421314">}</span><span class="op" id="6421315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421321">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421333">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6421342">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421398">switch</span>&nbsp;<span class="ident" id="6421405">fv</span><span class="op" id="6421407">.</span><span class="ident" id="6421408">Kind</span><span class="op" id="6421412">(</span><span class="op" id="6421413">)</span>&nbsp;<span class="op" id="6421415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421419">case</span>&nbsp;<span class="ident" id="6421424">reflect</span><span class="op" id="6421431">.</span><span class="ident" id="6421432">Ptr</span><span class="op" id="6421435">,</span>&nbsp;<span class="ident" id="6421437">reflect</span><span class="op" id="6421444">.</span><span class="ident" id="6421445">Interface</span><span class="op" id="6421454">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421459">if</span>&nbsp;<span class="ident" id="6421462">fv</span><span class="op" id="6421464">.</span><span class="ident" id="6421465">IsNil</span><span class="op" id="6421470">(</span><span class="op" id="6421471">)</span>&nbsp;<span class="op" id="6421473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421479">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421496">fv</span>&nbsp;<span class="op" id="6421499">=</span>&nbsp;<span class="ident" id="6421501">fv</span><span class="op" id="6421503">.</span><span class="ident" id="6421504">Elem</span><span class="op" id="6421508">(</span><span class="op" id="6421509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421513">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421518">s</span><span class="op" id="6421519">,</span>&nbsp;<span class="ident" id="6421521">b</span><span class="op" id="6421522">,</span>&nbsp;<span class="ident" id="6421524">err</span>&nbsp;<span class="op" id="6421528">:=</span>&nbsp;<span class="ident" id="6421531">p</span><span class="op" id="6421532">.</span><span class="ident" id="6421533">marshalSimple</span><span class="op" id="6421546">(</span><span class="ident" id="6421547">fv</span><span class="op" id="6421549">.</span><span class="ident" id="6421550">Type</span><span class="op" id="6421554">(</span><span class="op" id="6421555">)</span><span class="op" id="6421556">,</span>&nbsp;<span class="ident" id="6421558">fv</span><span class="op" id="6421560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421564">if</span>&nbsp;<span class="ident" id="6421567">err</span>&nbsp;<span class="op" id="6421571">!=</span>&nbsp;<span class="ident" id="6421574">nil</span>&nbsp;<span class="op" id="6421578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421583">return</span>&nbsp;<span class="ident" id="6421590">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421596">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421600">if</span>&nbsp;<span class="ident" id="6421603">b</span>&nbsp;<span class="op" id="6421605">!=</span>&nbsp;<span class="ident" id="6421608">nil</span>&nbsp;<span class="op" id="6421612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421617">s</span>&nbsp;<span class="op" id="6421619">=</span>&nbsp;<span class="builtintype" id="6421621">string</span><span class="op" id="6421627">(</span><span class="ident" id="6421628">b</span><span class="op" id="6421629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421637">start</span><span class="op" id="6421642">.</span><span class="ident" id="6421643">Attr</span>&nbsp;<span class="op" id="6421648">=</span>&nbsp;<span class="builtinfunc" id="6421650">append</span><span class="op" id="6421656">(</span><span class="ident" id="6421657">start</span><span class="op" id="6421662">.</span><span class="ident" id="6421663">Attr</span><span class="op" id="6421667">,</span>&nbsp;<span class="ident" id="6421669">Attr</span><span class="op" id="6421673">{</span><span class="ident" id="6421674">name</span><span class="op" id="6421678">,</span>&nbsp;<span class="ident" id="6421680">s</span><span class="op" id="6421681">}</span><span class="op" id="6421682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421685">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421689">if</span>&nbsp;<span class="ident" id="6421692">err</span>&nbsp;<span class="op" id="6421696">:=</span>&nbsp;<span class="ident" id="6421699">p</span><span class="op" id="6421700">.</span><span class="ident" id="6421701">writeStart</span><span class="op" id="6421711">(</span><span class="op" id="6421712">&amp;</span><span class="ident" id="6421713">start</span><span class="op" id="6421718">)</span><span class="op" id="6421719">;</span>&nbsp;<span class="ident" id="6421721">err</span>&nbsp;<span class="op" id="6421725">!=</span>&nbsp;<span class="ident" id="6421728">nil</span>&nbsp;<span class="op" id="6421732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421736">return</span>&nbsp;<span class="ident" id="6421743">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421752">if</span>&nbsp;<span class="ident" id="6421755">val</span><span class="op" id="6421758">.</span><span class="ident" id="6421759">Kind</span><span class="op" id="6421763">(</span><span class="op" id="6421764">)</span>&nbsp;<span class="op" id="6421766">==</span>&nbsp;<span class="ident" id="6421769">reflect</span><span class="op" id="6421776">.</span><span class="ident" id="6421777">Struct</span>&nbsp;<span class="op" id="6421784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421788">err</span>&nbsp;<span class="op" id="6421792">=</span>&nbsp;<span class="ident" id="6421794">p</span><span class="op" id="6421795">.</span><span class="ident" id="6421796">marshalStruct</span><span class="op" id="6421809">(</span><span class="ident" id="6421810">tinfo</span><span class="op" id="6421815">,</span>&nbsp;<span class="ident" id="6421817">val</span><span class="op" id="6421820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421823">}</span>&nbsp;<span class="keyword" id="6421825">else</span>&nbsp;<span class="op" id="6421830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421834">s</span><span class="op" id="6421835">,</span>&nbsp;<span class="ident" id="6421837">b</span><span class="op" id="6421838">,</span>&nbsp;<span class="ident" id="6421840">err1</span>&nbsp;<span class="op" id="6421845">:=</span>&nbsp;<span class="ident" id="6421848">p</span><span class="op" id="6421849">.</span><span class="ident" id="6421850">marshalSimple</span><span class="op" id="6421863">(</span><span class="ident" id="6421864">typ</span><span class="op" id="6421867">,</span>&nbsp;<span class="ident" id="6421869">val</span><span class="op" id="6421872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421876">if</span>&nbsp;<span class="ident" id="6421879">err1</span>&nbsp;<span class="op" id="6421884">!=</span>&nbsp;<span class="ident" id="6421887">nil</span>&nbsp;<span class="op" id="6421891">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421896">err</span>&nbsp;<span class="op" id="6421900">=</span>&nbsp;<span class="ident" id="6421902">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421909">}</span>&nbsp;<span class="keyword" id="6421911">else</span>&nbsp;<span class="keyword" id="6421916">if</span>&nbsp;<span class="ident" id="6421919">b</span>&nbsp;<span class="op" id="6421921">!=</span>&nbsp;<span class="ident" id="6421924">nil</span>&nbsp;<span class="op" id="6421928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421933">EscapeText</span><span class="op" id="6421943">(</span><span class="ident" id="6421944">p</span><span class="op" id="6421945">,</span>&nbsp;<span class="ident" id="6421947">b</span><span class="op" id="6421948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421952">}</span>&nbsp;<span class="keyword" id="6421954">else</span>&nbsp;<span class="op" id="6421959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421964">p</span><span class="op" id="6421965">.</span><span class="ident" id="6421966">EscapeString</span><span class="op" id="6421978">(</span><span class="ident" id="6421979">s</span><span class="op" id="6421980">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421990">if</span>&nbsp;<span class="ident" id="6421993">err</span>&nbsp;<span class="op" id="6421997">!=</span>&nbsp;<span class="ident" id="6422000">nil</span>&nbsp;<span class="op" id="6422004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422008">return</span>&nbsp;<span class="ident" id="6422015">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422020">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422024">if</span>&nbsp;<span class="ident" id="6422027">err</span>&nbsp;<span class="op" id="6422031">:=</span>&nbsp;<span class="ident" id="6422034">p</span><span class="op" id="6422035">.</span><span class="ident" id="6422036">writeEnd</span><span class="op" id="6422044">(</span><span class="ident" id="6422045">start</span><span class="op" id="6422050">.</span><span class="ident" id="6422051">Name</span><span class="op" id="6422055">)</span><span class="op" id="6422056">;</span>&nbsp;<span class="ident" id="6422058">err</span>&nbsp;<span class="op" id="6422062">!=</span>&nbsp;<span class="ident" id="6422065">nil</span>&nbsp;<span class="op" id="6422069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422073">return</span>&nbsp;<span class="ident" id="6422080">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422089">return</span>&nbsp;<span class="ident" id="6422096">p</span><span class="op" id="6422097">.</span><span class="ident" id="6422098">cachedWriteError</span><span class="op" id="6422114">(</span><span class="op" id="6422115">)</span><br>
<span class="lineno"></span><span class="op" id="6422117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6422120">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="6422178">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="6422237">func</span>&nbsp;<span class="ident" id="6422242">defaultStart</span><span class="op" id="6422254">(</span><span class="ident" id="6422255">typ</span>&nbsp;<span class="ident" id="6422259">reflect</span><span class="op" id="6422266">.</span><span class="ident" id="6422267">Type</span><span class="op" id="6422271">,</span>&nbsp;<span class="ident" id="6422273">finfo</span>&nbsp;<span class="op" id="6422279">*</span><span class="ident" id="6422280">fieldInfo</span><span class="op" id="6422289">,</span>&nbsp;<span class="ident" id="6422291">startTemplate</span>&nbsp;<span class="op" id="6422305">*</span><span class="ident" id="6422306">StartElement</span><span class="op" id="6422318">)</span>&nbsp;<span class="ident" id="6422320">StartElement</span>&nbsp;<span class="op" id="6422333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422336">var</span>&nbsp;<span class="ident" id="6422340">start</span>&nbsp;<span class="ident" id="6422346">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422360">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422413">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422480">if</span>&nbsp;<span class="ident" id="6422483">startTemplate</span>&nbsp;<span class="op" id="6422497">!=</span>&nbsp;<span class="ident" id="6422500">nil</span>&nbsp;<span class="op" id="6422504">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422508">start</span><span class="op" id="6422513">.</span><span class="ident" id="6422514">Name</span>&nbsp;<span class="op" id="6422519">=</span>&nbsp;<span class="ident" id="6422521">startTemplate</span><span class="op" id="6422534">.</span><span class="ident" id="6422535">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422542">start</span><span class="op" id="6422547">.</span><span class="ident" id="6422548">Attr</span>&nbsp;<span class="op" id="6422553">=</span>&nbsp;<span class="builtinfunc" id="6422555">append</span><span class="op" id="6422561">(</span><span class="ident" id="6422562">start</span><span class="op" id="6422567">.</span><span class="ident" id="6422568">Attr</span><span class="op" id="6422572">,</span>&nbsp;<span class="ident" id="6422574">startTemplate</span><span class="op" id="6422587">.</span><span class="ident" id="6422588">Attr</span><span class="op" id="6422592">...</span><span class="op" id="6422595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422598">}</span>&nbsp;<span class="keyword" id="6422600">else</span>&nbsp;<span class="keyword" id="6422605">if</span>&nbsp;<span class="ident" id="6422608">finfo</span>&nbsp;<span class="op" id="6422614">!=</span>&nbsp;<span class="ident" id="6422617">nil</span>&nbsp;<span class="op" id="6422621">&amp;&amp;</span>&nbsp;<span class="ident" id="6422624">finfo</span><span class="op" id="6422629">.</span><span class="ident" id="6422630">name</span>&nbsp;<span class="op" id="6422635">!=</span>&nbsp;<span class="string" id="6422638">&#34;&#34;</span>&nbsp;<span class="op" id="6422641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422645">start</span><span class="op" id="6422650">.</span><span class="ident" id="6422651">Name</span><span class="op" id="6422655">.</span><span class="ident" id="6422656">Local</span>&nbsp;<span class="op" id="6422662">=</span>&nbsp;<span class="ident" id="6422664">finfo</span><span class="op" id="6422669">.</span><span class="ident" id="6422670">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422677">start</span><span class="op" id="6422682">.</span><span class="ident" id="6422683">Name</span><span class="op" id="6422687">.</span><span class="ident" id="6422688">Space</span>&nbsp;<span class="op" id="6422694">=</span>&nbsp;<span class="ident" id="6422696">finfo</span><span class="op" id="6422701">.</span><span class="ident" id="6422702">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422709">}</span>&nbsp;<span class="keyword" id="6422711">else</span>&nbsp;<span class="keyword" id="6422716">if</span>&nbsp;<span class="ident" id="6422719">typ</span><span class="op" id="6422722">.</span><span class="ident" id="6422723">Name</span><span class="op" id="6422727">(</span><span class="op" id="6422728">)</span>&nbsp;<span class="op" id="6422730">!=</span>&nbsp;<span class="string" id="6422733">&#34;&#34;</span>&nbsp;<span class="op" id="6422736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422740">start</span><span class="op" id="6422745">.</span><span class="ident" id="6422746">Name</span><span class="op" id="6422750">.</span><span class="ident" id="6422751">Local</span>&nbsp;<span class="op" id="6422757">=</span>&nbsp;<span class="ident" id="6422759">typ</span><span class="op" id="6422762">.</span><span class="ident" id="6422763">Name</span><span class="op" id="6422767">(</span><span class="op" id="6422768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422771">}</span>&nbsp;<span class="keyword" id="6422773">else</span>&nbsp;<span class="op" id="6422778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422782">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422822">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422863">start</span><span class="op" id="6422868">.</span><span class="ident" id="6422869">Name</span><span class="op" id="6422873">.</span><span class="ident" id="6422874">Local</span>&nbsp;<span class="op" id="6422880">=</span>&nbsp;<span class="ident" id="6422882">typ</span><span class="op" id="6422885">.</span><span class="ident" id="6422886">Elem</span><span class="op" id="6422890">(</span><span class="op" id="6422891">)</span><span class="op" id="6422892">.</span><span class="ident" id="6422893">Name</span><span class="op" id="6422897">(</span><span class="op" id="6422898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422904">return</span>&nbsp;<span class="ident" id="6422911">start</span><br>
<span class="lineno"></span><span class="op" id="6422917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="6422920">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="6422978">func</span>&nbsp;<span class="op" id="6422983">(</span><span class="ident" id="6422984">p</span>&nbsp;<span class="op" id="6422986">*</span><span class="ident" id="6422987">printer</span><span class="op" id="6422994">)</span>&nbsp;<span class="ident" id="6422996">marshalInterface</span><span class="op" id="6423012">(</span><span class="ident" id="6423013">val</span>&nbsp;<span class="ident" id="6423017">Marshaler</span><span class="op" id="6423026">,</span>&nbsp;<span class="ident" id="6423028">start</span>&nbsp;<span class="ident" id="6423034">StartElement</span><span class="op" id="6423046">)</span>&nbsp;<span class="builtintype" id="6423048">error</span>&nbsp;<span class="op" id="6423054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6423057">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6423113">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423165">p</span><span class="op" id="6423166">.</span><span class="ident" id="6423167">tags</span>&nbsp;<span class="op" id="6423172">=</span>&nbsp;<span class="builtinfunc" id="6423174">append</span><span class="op" id="6423180">(</span><span class="ident" id="6423181">p</span><span class="op" id="6423182">.</span><span class="ident" id="6423183">tags</span><span class="op" id="6423187">,</span>&nbsp;<span class="ident" id="6423189">Name</span><span class="op" id="6423193">{</span><span class="op" id="6423194">}</span><span class="op" id="6423195">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423198">n</span>&nbsp;<span class="op" id="6423200">:=</span>&nbsp;<span class="builtinfunc" id="6423203">len</span><span class="op" id="6423206">(</span><span class="ident" id="6423207">p</span><span class="op" id="6423208">.</span><span class="ident" id="6423209">tags</span><span class="op" id="6423213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423217">err</span>&nbsp;<span class="op" id="6423221">:=</span>&nbsp;<span class="ident" id="6423224">val</span><span class="op" id="6423227">.</span><span class="ident" id="6423228">MarshalXML</span><span class="op" id="6423238">(</span><span class="ident" id="6423239">p</span><span class="op" id="6423240">.</span><span class="ident" id="6423241">encoder</span><span class="op" id="6423248">,</span>&nbsp;<span class="ident" id="6423250">start</span><span class="op" id="6423255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423258">if</span>&nbsp;<span class="ident" id="6423261">err</span>&nbsp;<span class="op" id="6423265">!=</span>&nbsp;<span class="ident" id="6423268">nil</span>&nbsp;<span class="op" id="6423272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423276">return</span>&nbsp;<span class="ident" id="6423283">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6423292">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423363">if</span>&nbsp;<span class="builtinfunc" id="6423366">len</span><span class="op" id="6423369">(</span><span class="ident" id="6423370">p</span><span class="op" id="6423371">.</span><span class="ident" id="6423372">tags</span><span class="op" id="6423376">)</span>&nbsp;<span class="op" id="6423378">&gt;</span>&nbsp;<span class="ident" id="6423380">n</span>&nbsp;<span class="op" id="6423382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423386">return</span>&nbsp;<span class="ident" id="6423393">fmt</span><span class="op" id="6423396">.</span><span class="ident" id="6423397">Errorf</span><span class="op" id="6423403">(</span><span class="string" id="6423404">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="6423459">,</span>&nbsp;<span class="ident" id="6423461">receiverType</span><span class="op" id="6423473">(</span><span class="ident" id="6423474">val</span><span class="op" id="6423477">)</span><span class="op" id="6423478">,</span>&nbsp;<span class="ident" id="6423480">p</span><span class="op" id="6423481">.</span><span class="ident" id="6423482">tags</span><span class="op" id="6423486">[</span><span class="builtinfunc" id="6423487">len</span><span class="op" id="6423490">(</span><span class="ident" id="6423491">p</span><span class="op" id="6423492">.</span><span class="ident" id="6423493">tags</span><span class="op" id="6423497">)</span><span class="op" id="6423498">-</span><span class="num" id="6423499">1</span><span class="op" id="6423500">]</span><span class="op" id="6423501">.</span><span class="ident" id="6423502">Local</span><span class="op" id="6423507">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423513">p</span><span class="op" id="6423514">.</span><span class="ident" id="6423515">tags</span>&nbsp;<span class="op" id="6423520">=</span>&nbsp;<span class="ident" id="6423522">p</span><span class="op" id="6423523">.</span><span class="ident" id="6423524">tags</span><span class="op" id="6423528">[</span><span class="op" id="6423529">:</span><span class="ident" id="6423530">n</span><span class="op" id="6423531">-</span><span class="num" id="6423532">1</span><span class="op" id="6423533">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423536">return</span>&nbsp;<span class="ident" id="6423543">nil</span><br>
<span class="lineno"></span><span class="op" id="6423547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="6423550">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="6423616">func</span>&nbsp;<span class="op" id="6423621">(</span><span class="ident" id="6423622">p</span>&nbsp;<span class="op" id="6423624">*</span><span class="ident" id="6423625">printer</span><span class="op" id="6423632">)</span>&nbsp;<span class="ident" id="6423634">marshalTextInterface</span><span class="op" id="6423654">(</span><span class="ident" id="6423655">val</span>&nbsp;<span class="ident" id="6423659">encoding</span><span class="op" id="6423667">.</span><span class="ident" id="6423668">TextMarshaler</span><span class="op" id="6423681">,</span>&nbsp;<span class="ident" id="6423683">start</span>&nbsp;<span class="ident" id="6423689">StartElement</span><span class="op" id="6423701">)</span>&nbsp;<span class="builtintype" id="6423703">error</span>&nbsp;<span class="op" id="6423709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423712">if</span>&nbsp;<span class="ident" id="6423715">err</span>&nbsp;<span class="op" id="6423719">:=</span>&nbsp;<span class="ident" id="6423722">p</span><span class="op" id="6423723">.</span><span class="ident" id="6423724">writeStart</span><span class="op" id="6423734">(</span><span class="op" id="6423735">&amp;</span><span class="ident" id="6423736">start</span><span class="op" id="6423741">)</span><span class="op" id="6423742">;</span>&nbsp;<span class="ident" id="6423744">err</span>&nbsp;<span class="op" id="6423748">!=</span>&nbsp;<span class="ident" id="6423751">nil</span>&nbsp;<span class="op" id="6423755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423759">return</span>&nbsp;<span class="ident" id="6423766">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423771">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423774">text</span><span class="op" id="6423778">,</span>&nbsp;<span class="ident" id="6423780">err</span>&nbsp;<span class="op" id="6423784">:=</span>&nbsp;<span class="ident" id="6423787">val</span><span class="op" id="6423790">.</span><span class="ident" id="6423791">MarshalText</span><span class="op" id="6423802">(</span><span class="op" id="6423803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423806">if</span>&nbsp;<span class="ident" id="6423809">err</span>&nbsp;<span class="op" id="6423813">!=</span>&nbsp;<span class="ident" id="6423816">nil</span>&nbsp;<span class="op" id="6423820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423824">return</span>&nbsp;<span class="ident" id="6423831">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423839">EscapeText</span><span class="op" id="6423849">(</span><span class="ident" id="6423850">p</span><span class="op" id="6423851">,</span>&nbsp;<span class="ident" id="6423853">text</span><span class="op" id="6423857">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423860">return</span>&nbsp;<span class="ident" id="6423867">p</span><span class="op" id="6423868">.</span><span class="ident" id="6423869">writeEnd</span><span class="op" id="6423877">(</span><span class="ident" id="6423878">start</span><span class="op" id="6423883">.</span><span class="ident" id="6423884">Name</span><span class="op" id="6423888">)</span><br>
<span class="lineno"></span><span class="op" id="6423890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6423893">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="6423939">func</span>&nbsp;<span class="op" id="6423944">(</span><span class="ident" id="6423945">p</span>&nbsp;<span class="op" id="6423947">*</span><span class="ident" id="6423948">printer</span><span class="op" id="6423955">)</span>&nbsp;<span class="ident" id="6423957">writeStart</span><span class="op" id="6423967">(</span><span class="ident" id="6423968">start</span>&nbsp;<span class="op" id="6423974">*</span><span class="ident" id="6423975">StartElement</span><span class="op" id="6423987">)</span>&nbsp;<span class="builtintype" id="6423989">error</span>&nbsp;<span class="op" id="6423995">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423998">if</span>&nbsp;<span class="ident" id="6424001">start</span><span class="op" id="6424006">.</span><span class="ident" id="6424007">Name</span><span class="op" id="6424011">.</span><span class="ident" id="6424012">Local</span>&nbsp;<span class="op" id="6424018">==</span>&nbsp;<span class="string" id="6424021">&#34;&#34;</span>&nbsp;<span class="op" id="6424024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424028">return</span>&nbsp;<span class="ident" id="6424035">fmt</span><span class="op" id="6424038">.</span><span class="ident" id="6424039">Errorf</span><span class="op" id="6424045">(</span><span class="string" id="6424046">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="6424075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424082">p</span><span class="op" id="6424083">.</span><span class="ident" id="6424084">tags</span>&nbsp;<span class="op" id="6424089">=</span>&nbsp;<span class="builtinfunc" id="6424091">append</span><span class="op" id="6424097">(</span><span class="ident" id="6424098">p</span><span class="op" id="6424099">.</span><span class="ident" id="6424100">tags</span><span class="op" id="6424104">,</span>&nbsp;<span class="ident" id="6424106">start</span><span class="op" id="6424111">.</span><span class="ident" id="6424112">Name</span><span class="op" id="6424116">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424119">p</span><span class="op" id="6424120">.</span><span class="ident" id="6424121">markPrefix</span><span class="op" id="6424131">(</span><span class="op" id="6424132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424136">p</span><span class="op" id="6424137">.</span><span class="ident" id="6424138">writeIndent</span><span class="op" id="6424149">(</span><span class="num" id="6424150">1</span><span class="op" id="6424151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424154">p</span><span class="op" id="6424155">.</span><span class="ident" id="6424156">WriteByte</span><span class="op" id="6424165">(</span><span class="string" id="6424166">&#39;&lt;&#39;</span><span class="op" id="6424169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424172">p</span><span class="op" id="6424173">.</span><span class="ident" id="6424174">WriteString</span><span class="op" id="6424185">(</span><span class="ident" id="6424186">start</span><span class="op" id="6424191">.</span><span class="ident" id="6424192">Name</span><span class="op" id="6424196">.</span><span class="ident" id="6424197">Local</span><span class="op" id="6424202">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424206">if</span>&nbsp;<span class="ident" id="6424209">start</span><span class="op" id="6424214">.</span><span class="ident" id="6424215">Name</span><span class="op" id="6424219">.</span><span class="ident" id="6424220">Space</span>&nbsp;<span class="op" id="6424226">!=</span>&nbsp;<span class="string" id="6424229">&#34;&#34;</span>&nbsp;<span class="op" id="6424232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424236">p</span><span class="op" id="6424237">.</span><span class="ident" id="6424238">WriteString</span><span class="op" id="6424249">(</span><span class="string" id="6424250">`&nbsp;xmlns=&#34;`</span><span class="op" id="6424260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424264">p</span><span class="op" id="6424265">.</span><span class="ident" id="6424266">EscapeString</span><span class="op" id="6424278">(</span><span class="ident" id="6424279">start</span><span class="op" id="6424284">.</span><span class="ident" id="6424285">Name</span><span class="op" id="6424289">.</span><span class="ident" id="6424290">Space</span><span class="op" id="6424295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424299">p</span><span class="op" id="6424300">.</span><span class="ident" id="6424301">WriteByte</span><span class="op" id="6424310">(</span><span class="string" id="6424311">&#39;&#34;&#39;</span><span class="op" id="6424314">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6424321">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424336">for</span>&nbsp;<span class="ident" id="6424340">_</span><span class="op" id="6424341">,</span>&nbsp;<span class="ident" id="6424343">attr</span>&nbsp;<span class="op" id="6424348">:=</span>&nbsp;<span class="keyword" id="6424351">range</span>&nbsp;<span class="ident" id="6424357">start</span><span class="op" id="6424362">.</span><span class="ident" id="6424363">Attr</span>&nbsp;<span class="op" id="6424368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424372">name</span>&nbsp;<span class="op" id="6424377">:=</span>&nbsp;<span class="ident" id="6424380">attr</span><span class="op" id="6424384">.</span><span class="ident" id="6424385">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424392">if</span>&nbsp;<span class="ident" id="6424395">name</span><span class="op" id="6424399">.</span><span class="ident" id="6424400">Local</span>&nbsp;<span class="op" id="6424406">==</span>&nbsp;<span class="string" id="6424409">&#34;&#34;</span>&nbsp;<span class="op" id="6424412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424417">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424432">p</span><span class="op" id="6424433">.</span><span class="ident" id="6424434">WriteByte</span><span class="op" id="6424443">(</span><span class="string" id="6424444">&#39;&nbsp;&#39;</span><span class="op" id="6424447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424451">if</span>&nbsp;<span class="ident" id="6424454">name</span><span class="op" id="6424458">.</span><span class="ident" id="6424459">Space</span>&nbsp;<span class="op" id="6424465">!=</span>&nbsp;<span class="string" id="6424468">&#34;&#34;</span>&nbsp;<span class="op" id="6424471">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424476">p</span><span class="op" id="6424477">.</span><span class="ident" id="6424478">WriteString</span><span class="op" id="6424489">(</span><span class="ident" id="6424490">p</span><span class="op" id="6424491">.</span><span class="ident" id="6424492">createAttrPrefix</span><span class="op" id="6424508">(</span><span class="ident" id="6424509">name</span><span class="op" id="6424513">.</span><span class="ident" id="6424514">Space</span><span class="op" id="6424519">)</span><span class="op" id="6424520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424525">p</span><span class="op" id="6424526">.</span><span class="ident" id="6424527">WriteByte</span><span class="op" id="6424536">(</span><span class="string" id="6424537">&#39;:&#39;</span><span class="op" id="6424540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424548">p</span><span class="op" id="6424549">.</span><span class="ident" id="6424550">WriteString</span><span class="op" id="6424561">(</span><span class="ident" id="6424562">name</span><span class="op" id="6424566">.</span><span class="ident" id="6424567">Local</span><span class="op" id="6424572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424576">p</span><span class="op" id="6424577">.</span><span class="ident" id="6424578">WriteString</span><span class="op" id="6424589">(</span><span class="string" id="6424590">`=&#34;`</span><span class="op" id="6424594">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424598">p</span><span class="op" id="6424599">.</span><span class="ident" id="6424600">EscapeString</span><span class="op" id="6424612">(</span><span class="ident" id="6424613">attr</span><span class="op" id="6424617">.</span><span class="ident" id="6424618">Value</span><span class="op" id="6424623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424627">p</span><span class="op" id="6424628">.</span><span class="ident" id="6424629">WriteByte</span><span class="op" id="6424638">(</span><span class="string" id="6424639">&#39;&#34;&#39;</span><span class="op" id="6424642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424648">p</span><span class="op" id="6424649">.</span><span class="ident" id="6424650">WriteByte</span><span class="op" id="6424659">(</span><span class="string" id="6424660">&#39;&gt;&#39;</span><span class="op" id="6424663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424666">return</span>&nbsp;<span class="ident" id="6424673">nil</span><br>
<span class="lineno">645</span><span class="op" id="6424677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6424680">func</span>&nbsp;<span class="op" id="6424685">(</span><span class="ident" id="6424686">p</span>&nbsp;<span class="op" id="6424688">*</span><span class="ident" id="6424689">printer</span><span class="op" id="6424696">)</span>&nbsp;<span class="ident" id="6424698">writeEnd</span><span class="op" id="6424706">(</span><span class="ident" id="6424707">name</span>&nbsp;<span class="ident" id="6424712">Name</span><span class="op" id="6424716">)</span>&nbsp;<span class="builtintype" id="6424718">error</span>&nbsp;<span class="op" id="6424724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424727">if</span>&nbsp;<span class="ident" id="6424730">name</span><span class="op" id="6424734">.</span><span class="ident" id="6424735">Local</span>&nbsp;<span class="op" id="6424741">==</span>&nbsp;<span class="string" id="6424744">&#34;&#34;</span>&nbsp;<span class="op" id="6424747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424751">return</span>&nbsp;<span class="ident" id="6424758">fmt</span><span class="op" id="6424761">.</span><span class="ident" id="6424762">Errorf</span><span class="op" id="6424768">(</span><span class="string" id="6424769">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="6424796">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424802">if</span>&nbsp;<span class="builtinfunc" id="6424805">len</span><span class="op" id="6424808">(</span><span class="ident" id="6424809">p</span><span class="op" id="6424810">.</span><span class="ident" id="6424811">tags</span><span class="op" id="6424815">)</span>&nbsp;<span class="op" id="6424817">==</span>&nbsp;<span class="num" id="6424820">0</span>&nbsp;<span class="op" id="6424822">||</span>&nbsp;<span class="ident" id="6424825">p</span><span class="op" id="6424826">.</span><span class="ident" id="6424827">tags</span><span class="op" id="6424831">[</span><span class="builtinfunc" id="6424832">len</span><span class="op" id="6424835">(</span><span class="ident" id="6424836">p</span><span class="op" id="6424837">.</span><span class="ident" id="6424838">tags</span><span class="op" id="6424842">)</span><span class="op" id="6424843">-</span><span class="num" id="6424844">1</span><span class="op" id="6424845">]</span><span class="op" id="6424846">.</span><span class="ident" id="6424847">Local</span>&nbsp;<span class="op" id="6424853">==</span>&nbsp;<span class="string" id="6424856">&#34;&#34;</span>&nbsp;<span class="op" id="6424859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424863">return</span>&nbsp;<span class="ident" id="6424870">fmt</span><span class="op" id="6424873">.</span><span class="ident" id="6424874">Errorf</span><span class="op" id="6424880">(</span><span class="string" id="6424881">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="6424919">,</span>&nbsp;<span class="ident" id="6424921">name</span><span class="op" id="6424925">.</span><span class="ident" id="6424926">Local</span><span class="op" id="6424931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424937">if</span>&nbsp;<span class="ident" id="6424940">top</span>&nbsp;<span class="op" id="6424944">:=</span>&nbsp;<span class="ident" id="6424947">p</span><span class="op" id="6424948">.</span><span class="ident" id="6424949">tags</span><span class="op" id="6424953">[</span><span class="builtinfunc" id="6424954">len</span><span class="op" id="6424957">(</span><span class="ident" id="6424958">p</span><span class="op" id="6424959">.</span><span class="ident" id="6424960">tags</span><span class="op" id="6424964">)</span><span class="op" id="6424965">-</span><span class="num" id="6424966">1</span><span class="op" id="6424967">]</span><span class="op" id="6424968">;</span>&nbsp;<span class="ident" id="6424970">top</span>&nbsp;<span class="op" id="6424974">!=</span>&nbsp;<span class="ident" id="6424977">name</span>&nbsp;<span class="op" id="6424982">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424986">if</span>&nbsp;<span class="ident" id="6424989">top</span><span class="op" id="6424992">.</span><span class="ident" id="6424993">Local</span>&nbsp;<span class="op" id="6424999">!=</span>&nbsp;<span class="ident" id="6425002">name</span><span class="op" id="6425006">.</span><span class="ident" id="6425007">Local</span>&nbsp;<span class="op" id="6425013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425018">return</span>&nbsp;<span class="ident" id="6425025">fmt</span><span class="op" id="6425028">.</span><span class="ident" id="6425029">Errorf</span><span class="op" id="6425035">(</span><span class="string" id="6425036">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="6425086">,</span>&nbsp;<span class="ident" id="6425088">name</span><span class="op" id="6425092">.</span><span class="ident" id="6425093">Local</span><span class="op" id="6425098">,</span>&nbsp;<span class="ident" id="6425100">top</span><span class="op" id="6425103">.</span><span class="ident" id="6425104">Local</span><span class="op" id="6425109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425117">return</span>&nbsp;<span class="ident" id="6425124">fmt</span><span class="op" id="6425127">.</span><span class="ident" id="6425128">Errorf</span><span class="op" id="6425134">(</span><span class="string" id="6425135">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="6425217">,</span>&nbsp;<span class="ident" id="6425219">name</span><span class="op" id="6425223">.</span><span class="ident" id="6425224">Local</span><span class="op" id="6425229">,</span>&nbsp;<span class="ident" id="6425231">name</span><span class="op" id="6425235">.</span><span class="ident" id="6425236">Space</span><span class="op" id="6425241">,</span>&nbsp;<span class="ident" id="6425243">top</span><span class="op" id="6425246">.</span><span class="ident" id="6425247">Local</span><span class="op" id="6425252">,</span>&nbsp;<span class="ident" id="6425254">top</span><span class="op" id="6425257">.</span><span class="ident" id="6425258">Space</span><span class="op" id="6425263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425266">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425269">p</span><span class="op" id="6425270">.</span><span class="ident" id="6425271">tags</span>&nbsp;<span class="op" id="6425276">=</span>&nbsp;<span class="ident" id="6425278">p</span><span class="op" id="6425279">.</span><span class="ident" id="6425280">tags</span><span class="op" id="6425284">[</span><span class="op" id="6425285">:</span><span class="builtinfunc" id="6425286">len</span><span class="op" id="6425289">(</span><span class="ident" id="6425290">p</span><span class="op" id="6425291">.</span><span class="ident" id="6425292">tags</span><span class="op" id="6425296">)</span><span class="op" id="6425297">-</span><span class="num" id="6425298">1</span><span class="op" id="6425299">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425303">p</span><span class="op" id="6425304">.</span><span class="ident" id="6425305">writeIndent</span><span class="op" id="6425316">(</span><span class="op" id="6425317">-</span><span class="num" id="6425318">1</span><span class="op" id="6425319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425322">p</span><span class="op" id="6425323">.</span><span class="ident" id="6425324">WriteByte</span><span class="op" id="6425333">(</span><span class="string" id="6425334">&#39;&lt;&#39;</span><span class="op" id="6425337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425340">p</span><span class="op" id="6425341">.</span><span class="ident" id="6425342">WriteByte</span><span class="op" id="6425351">(</span><span class="string" id="6425352">&#39;/&#39;</span><span class="op" id="6425355">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425358">p</span><span class="op" id="6425359">.</span><span class="ident" id="6425360">WriteString</span><span class="op" id="6425371">(</span><span class="ident" id="6425372">name</span><span class="op" id="6425376">.</span><span class="ident" id="6425377">Local</span><span class="op" id="6425382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425385">p</span><span class="op" id="6425386">.</span><span class="ident" id="6425387">WriteByte</span><span class="op" id="6425396">(</span><span class="string" id="6425397">&#39;&gt;&#39;</span><span class="op" id="6425400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425403">p</span><span class="op" id="6425404">.</span><span class="ident" id="6425405">popPrefix</span><span class="op" id="6425414">(</span><span class="op" id="6425415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425418">return</span>&nbsp;<span class="ident" id="6425425">nil</span><br>
<span class="lineno"></span><span class="op" id="6425429">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="6425432">func</span>&nbsp;<span class="op" id="6425437">(</span><span class="ident" id="6425438">p</span>&nbsp;<span class="op" id="6425440">*</span><span class="ident" id="6425441">printer</span><span class="op" id="6425448">)</span>&nbsp;<span class="ident" id="6425450">marshalSimple</span><span class="op" id="6425463">(</span><span class="ident" id="6425464">typ</span>&nbsp;<span class="ident" id="6425468">reflect</span><span class="op" id="6425475">.</span><span class="ident" id="6425476">Type</span><span class="op" id="6425480">,</span>&nbsp;<span class="ident" id="6425482">val</span>&nbsp;<span class="ident" id="6425486">reflect</span><span class="op" id="6425493">.</span><span class="ident" id="6425494">Value</span><span class="op" id="6425499">)</span>&nbsp;<span class="op" id="6425501">(</span><span class="builtintype" id="6425502">string</span><span class="op" id="6425508">,</span>&nbsp;<span class="op" id="6425510">[</span><span class="op" id="6425511">]</span><span class="builtintype" id="6425512">byte</span><span class="op" id="6425516">,</span>&nbsp;<span class="builtintype" id="6425518">error</span><span class="op" id="6425523">)</span>&nbsp;<span class="op" id="6425525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425528">switch</span>&nbsp;<span class="ident" id="6425535">val</span><span class="op" id="6425538">.</span><span class="ident" id="6425539">Kind</span><span class="op" id="6425543">(</span><span class="op" id="6425544">)</span>&nbsp;<span class="op" id="6425546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425549">case</span>&nbsp;<span class="ident" id="6425554">reflect</span><span class="op" id="6425561">.</span><span class="ident" id="6425562">Int</span><span class="op" id="6425565">,</span>&nbsp;<span class="ident" id="6425567">reflect</span><span class="op" id="6425574">.</span><span class="ident" id="6425575">Int8</span><span class="op" id="6425579">,</span>&nbsp;<span class="ident" id="6425581">reflect</span><span class="op" id="6425588">.</span><span class="ident" id="6425589">Int16</span><span class="op" id="6425594">,</span>&nbsp;<span class="ident" id="6425596">reflect</span><span class="op" id="6425603">.</span><span class="ident" id="6425604">Int32</span><span class="op" id="6425609">,</span>&nbsp;<span class="ident" id="6425611">reflect</span><span class="op" id="6425618">.</span><span class="ident" id="6425619">Int64</span><span class="op" id="6425624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425628">return</span>&nbsp;<span class="ident" id="6425635">strconv</span><span class="op" id="6425642">.</span><span class="ident" id="6425643">FormatInt</span><span class="op" id="6425652">(</span><span class="ident" id="6425653">val</span><span class="op" id="6425656">.</span><span class="ident" id="6425657">Int</span><span class="op" id="6425660">(</span><span class="op" id="6425661">)</span><span class="op" id="6425662">,</span>&nbsp;<span class="num" id="6425664">10</span><span class="op" id="6425666">)</span><span class="op" id="6425667">,</span>&nbsp;<span class="ident" id="6425669">nil</span><span class="op" id="6425672">,</span>&nbsp;<span class="ident" id="6425674">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425679">case</span>&nbsp;<span class="ident" id="6425684">reflect</span><span class="op" id="6425691">.</span><span class="ident" id="6425692">Uint</span><span class="op" id="6425696">,</span>&nbsp;<span class="ident" id="6425698">reflect</span><span class="op" id="6425705">.</span><span class="ident" id="6425706">Uint8</span><span class="op" id="6425711">,</span>&nbsp;<span class="ident" id="6425713">reflect</span><span class="op" id="6425720">.</span><span class="ident" id="6425721">Uint16</span><span class="op" id="6425727">,</span>&nbsp;<span class="ident" id="6425729">reflect</span><span class="op" id="6425736">.</span><span class="ident" id="6425737">Uint32</span><span class="op" id="6425743">,</span>&nbsp;<span class="ident" id="6425745">reflect</span><span class="op" id="6425752">.</span><span class="ident" id="6425753">Uint64</span><span class="op" id="6425759">,</span>&nbsp;<span class="ident" id="6425761">reflect</span><span class="op" id="6425768">.</span><span class="ident" id="6425769">Uintptr</span><span class="op" id="6425776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425780">return</span>&nbsp;<span class="ident" id="6425787">strconv</span><span class="op" id="6425794">.</span><span class="ident" id="6425795">FormatUint</span><span class="op" id="6425805">(</span><span class="ident" id="6425806">val</span><span class="op" id="6425809">.</span><span class="ident" id="6425810">Uint</span><span class="op" id="6425814">(</span><span class="op" id="6425815">)</span><span class="op" id="6425816">,</span>&nbsp;<span class="num" id="6425818">10</span><span class="op" id="6425820">)</span><span class="op" id="6425821">,</span>&nbsp;<span class="ident" id="6425823">nil</span><span class="op" id="6425826">,</span>&nbsp;<span class="ident" id="6425828">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425833">case</span>&nbsp;<span class="ident" id="6425838">reflect</span><span class="op" id="6425845">.</span><span class="ident" id="6425846">Float32</span><span class="op" id="6425853">,</span>&nbsp;<span class="ident" id="6425855">reflect</span><span class="op" id="6425862">.</span><span class="ident" id="6425863">Float64</span><span class="op" id="6425870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425874">return</span>&nbsp;<span class="ident" id="6425881">strconv</span><span class="op" id="6425888">.</span><span class="ident" id="6425889">FormatFloat</span><span class="op" id="6425900">(</span><span class="ident" id="6425901">val</span><span class="op" id="6425904">.</span><span class="ident" id="6425905">Float</span><span class="op" id="6425910">(</span><span class="op" id="6425911">)</span><span class="op" id="6425912">,</span>&nbsp;<span class="string" id="6425914">&#39;g&#39;</span><span class="op" id="6425917">,</span>&nbsp;<span class="op" id="6425919">-</span><span class="num" id="6425920">1</span><span class="op" id="6425921">,</span>&nbsp;<span class="ident" id="6425923">val</span><span class="op" id="6425926">.</span><span class="ident" id="6425927">Type</span><span class="op" id="6425931">(</span><span class="op" id="6425932">)</span><span class="op" id="6425933">.</span><span class="ident" id="6425934">Bits</span><span class="op" id="6425938">(</span><span class="op" id="6425939">)</span><span class="op" id="6425940">)</span><span class="op" id="6425941">,</span>&nbsp;<span class="ident" id="6425943">nil</span><span class="op" id="6425946">,</span>&nbsp;<span class="ident" id="6425948">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425953">case</span>&nbsp;<span class="ident" id="6425958">reflect</span><span class="op" id="6425965">.</span><span class="ident" id="6425966">String</span><span class="op" id="6425972">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425976">return</span>&nbsp;<span class="ident" id="6425983">val</span><span class="op" id="6425986">.</span><span class="ident" id="6425987">String</span><span class="op" id="6425993">(</span><span class="op" id="6425994">)</span><span class="op" id="6425995">,</span>&nbsp;<span class="ident" id="6425997">nil</span><span class="op" id="6426000">,</span>&nbsp;<span class="ident" id="6426002">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426007">case</span>&nbsp;<span class="ident" id="6426012">reflect</span><span class="op" id="6426019">.</span><span class="ident" id="6426020">Bool</span><span class="op" id="6426024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426028">return</span>&nbsp;<span class="ident" id="6426035">strconv</span><span class="op" id="6426042">.</span><span class="ident" id="6426043">FormatBool</span><span class="op" id="6426053">(</span><span class="ident" id="6426054">val</span><span class="op" id="6426057">.</span><span class="ident" id="6426058">Bool</span><span class="op" id="6426062">(</span><span class="op" id="6426063">)</span><span class="op" id="6426064">)</span><span class="op" id="6426065">,</span>&nbsp;<span class="ident" id="6426067">nil</span><span class="op" id="6426070">,</span>&nbsp;<span class="ident" id="6426072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426077">case</span>&nbsp;<span class="ident" id="6426082">reflect</span><span class="op" id="6426089">.</span><span class="ident" id="6426090">Array</span><span class="op" id="6426095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426099">if</span>&nbsp;<span class="ident" id="6426102">typ</span><span class="op" id="6426105">.</span><span class="ident" id="6426106">Elem</span><span class="op" id="6426110">(</span><span class="op" id="6426111">)</span><span class="op" id="6426112">.</span><span class="ident" id="6426113">Kind</span><span class="op" id="6426117">(</span><span class="op" id="6426118">)</span>&nbsp;<span class="op" id="6426120">!=</span>&nbsp;<span class="ident" id="6426123">reflect</span><span class="op" id="6426130">.</span><span class="ident" id="6426131">Uint8</span>&nbsp;<span class="op" id="6426137">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426142">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426154">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426169">var</span>&nbsp;<span class="ident" id="6426173">bytes</span>&nbsp;<span class="op" id="6426179">[</span><span class="op" id="6426180">]</span><span class="builtintype" id="6426181">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426188">if</span>&nbsp;<span class="ident" id="6426191">val</span><span class="op" id="6426194">.</span><span class="ident" id="6426195">CanAddr</span><span class="op" id="6426202">(</span><span class="op" id="6426203">)</span>&nbsp;<span class="op" id="6426205">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426210">bytes</span>&nbsp;<span class="op" id="6426216">=</span>&nbsp;<span class="ident" id="6426218">val</span><span class="op" id="6426221">.</span><span class="ident" id="6426222">Slice</span><span class="op" id="6426227">(</span><span class="num" id="6426228">0</span><span class="op" id="6426229">,</span>&nbsp;<span class="ident" id="6426231">val</span><span class="op" id="6426234">.</span><span class="ident" id="6426235">Len</span><span class="op" id="6426238">(</span><span class="op" id="6426239">)</span><span class="op" id="6426240">)</span><span class="op" id="6426241">.</span><span class="ident" id="6426242">Bytes</span><span class="op" id="6426247">(</span><span class="op" id="6426248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426252">}</span>&nbsp;<span class="keyword" id="6426254">else</span>&nbsp;<span class="op" id="6426259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426264">bytes</span>&nbsp;<span class="op" id="6426270">=</span>&nbsp;<span class="builtinfunc" id="6426272">make</span><span class="op" id="6426276">(</span><span class="op" id="6426277">[</span><span class="op" id="6426278">]</span><span class="builtintype" id="6426279">byte</span><span class="op" id="6426283">,</span>&nbsp;<span class="ident" id="6426285">val</span><span class="op" id="6426288">.</span><span class="ident" id="6426289">Len</span><span class="op" id="6426292">(</span><span class="op" id="6426293">)</span><span class="op" id="6426294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426299">reflect</span><span class="op" id="6426306">.</span><span class="ident" id="6426307">Copy</span><span class="op" id="6426311">(</span><span class="ident" id="6426312">reflect</span><span class="op" id="6426319">.</span><span class="ident" id="6426320">ValueOf</span><span class="op" id="6426327">(</span><span class="ident" id="6426328">bytes</span><span class="op" id="6426333">)</span><span class="op" id="6426334">,</span>&nbsp;<span class="ident" id="6426336">val</span><span class="op" id="6426339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426343">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426347">return</span>&nbsp;<span class="string" id="6426354">&#34;&#34;</span><span class="op" id="6426356">,</span>&nbsp;<span class="ident" id="6426358">bytes</span><span class="op" id="6426363">,</span>&nbsp;<span class="ident" id="6426365">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426370">case</span>&nbsp;<span class="ident" id="6426375">reflect</span><span class="op" id="6426382">.</span><span class="ident" id="6426383">Slice</span><span class="op" id="6426388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426392">if</span>&nbsp;<span class="ident" id="6426395">typ</span><span class="op" id="6426398">.</span><span class="ident" id="6426399">Elem</span><span class="op" id="6426403">(</span><span class="op" id="6426404">)</span><span class="op" id="6426405">.</span><span class="ident" id="6426406">Kind</span><span class="op" id="6426410">(</span><span class="op" id="6426411">)</span>&nbsp;<span class="op" id="6426413">!=</span>&nbsp;<span class="ident" id="6426416">reflect</span><span class="op" id="6426423">.</span><span class="ident" id="6426424">Uint8</span>&nbsp;<span class="op" id="6426430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426435">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426443">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426447">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426459">return</span>&nbsp;<span class="string" id="6426466">&#34;&#34;</span><span class="op" id="6426468">,</span>&nbsp;<span class="ident" id="6426470">val</span><span class="op" id="6426473">.</span><span class="ident" id="6426474">Bytes</span><span class="op" id="6426479">(</span><span class="op" id="6426480">)</span><span class="op" id="6426481">,</span>&nbsp;<span class="ident" id="6426483">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426491">return</span>&nbsp;<span class="string" id="6426498">&#34;&#34;</span><span class="op" id="6426500">,</span>&nbsp;<span class="ident" id="6426502">nil</span><span class="op" id="6426505">,</span>&nbsp;<span class="op" id="6426507">&amp;</span><span class="ident" id="6426508">UnsupportedTypeError</span><span class="op" id="6426528">{</span><span class="ident" id="6426529">typ</span><span class="op" id="6426532">}</span><br>
<span class="lineno"></span><span class="op" id="6426534">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="6426537">var</span>&nbsp;<span class="ident" id="6426541">ddBytes</span>&nbsp;<span class="op" id="6426549">=</span>&nbsp;<span class="op" id="6426551">[</span><span class="op" id="6426552">]</span><span class="builtintype" id="6426553">byte</span><span class="op" id="6426557">(</span><span class="string" id="6426558">&#34;--&#34;</span><span class="op" id="6426562">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6426565">func</span>&nbsp;<span class="op" id="6426570">(</span><span class="ident" id="6426571">p</span>&nbsp;<span class="op" id="6426573">*</span><span class="ident" id="6426574">printer</span><span class="op" id="6426581">)</span>&nbsp;<span class="ident" id="6426583">marshalStruct</span><span class="op" id="6426596">(</span><span class="ident" id="6426597">tinfo</span>&nbsp;<span class="op" id="6426603">*</span><span class="ident" id="6426604">typeInfo</span><span class="op" id="6426612">,</span>&nbsp;<span class="ident" id="6426614">val</span>&nbsp;<span class="ident" id="6426618">reflect</span><span class="op" id="6426625">.</span><span class="ident" id="6426626">Value</span><span class="op" id="6426631">)</span>&nbsp;<span class="builtintype" id="6426633">error</span>&nbsp;<span class="op" id="6426639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426642">s</span>&nbsp;<span class="op" id="6426644">:=</span>&nbsp;<span class="ident" id="6426647">parentStack</span><span class="op" id="6426658">{</span><span class="ident" id="6426659">p</span><span class="op" id="6426660">:</span>&nbsp;<span class="ident" id="6426662">p</span><span class="op" id="6426663">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426666">for</span>&nbsp;<span class="ident" id="6426670">i</span>&nbsp;<span class="op" id="6426672">:=</span>&nbsp;<span class="keyword" id="6426675">range</span>&nbsp;<span class="ident" id="6426681">tinfo</span><span class="op" id="6426686">.</span><span class="ident" id="6426687">fields</span>&nbsp;<span class="op" id="6426694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426698">finfo</span>&nbsp;<span class="op" id="6426704">:=</span>&nbsp;<span class="op" id="6426707">&amp;</span><span class="ident" id="6426708">tinfo</span><span class="op" id="6426713">.</span><span class="ident" id="6426714">fields</span><span class="op" id="6426720">[</span><span class="ident" id="6426721">i</span><span class="op" id="6426722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426726">if</span>&nbsp;<span class="ident" id="6426729">finfo</span><span class="op" id="6426734">.</span><span class="ident" id="6426735">flags</span><span class="op" id="6426740">&amp;</span><span class="ident" id="6426741">fAttr</span>&nbsp;<span class="op" id="6426747">!=</span>&nbsp;<span class="num" id="6426750">0</span>&nbsp;<span class="op" id="6426752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426757">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426768">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426772">vf</span>&nbsp;<span class="op" id="6426775">:=</span>&nbsp;<span class="ident" id="6426778">finfo</span><span class="op" id="6426783">.</span><span class="ident" id="6426784">value</span><span class="op" id="6426789">(</span><span class="ident" id="6426790">val</span><span class="op" id="6426793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6426798">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426854">switch</span>&nbsp;<span class="ident" id="6426861">vf</span><span class="op" id="6426863">.</span><span class="ident" id="6426864">Kind</span><span class="op" id="6426868">(</span><span class="op" id="6426869">)</span>&nbsp;<span class="op" id="6426871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426875">case</span>&nbsp;<span class="ident" id="6426880">reflect</span><span class="op" id="6426887">.</span><span class="ident" id="6426888">Ptr</span><span class="op" id="6426891">,</span>&nbsp;<span class="ident" id="6426893">reflect</span><span class="op" id="6426900">.</span><span class="ident" id="6426901">Interface</span><span class="op" id="6426910">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426915">if</span>&nbsp;<span class="op" id="6426918">!</span><span class="ident" id="6426919">vf</span><span class="op" id="6426921">.</span><span class="ident" id="6426922">IsNil</span><span class="op" id="6426927">(</span><span class="op" id="6426928">)</span>&nbsp;<span class="op" id="6426930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426936">vf</span>&nbsp;<span class="op" id="6426939">=</span>&nbsp;<span class="ident" id="6426941">vf</span><span class="op" id="6426943">.</span><span class="ident" id="6426944">Elem</span><span class="op" id="6426948">(</span><span class="op" id="6426949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426963">switch</span>&nbsp;<span class="ident" id="6426970">finfo</span><span class="op" id="6426975">.</span><span class="ident" id="6426976">flags</span>&nbsp;<span class="op" id="6426982">&amp;</span>&nbsp;<span class="ident" id="6426984">fMode</span>&nbsp;<span class="op" id="6426990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426994">case</span>&nbsp;<span class="ident" id="6426999">fCharData</span><span class="op" id="6427008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427013">if</span>&nbsp;<span class="ident" id="6427016">vf</span><span class="op" id="6427018">.</span><span class="ident" id="6427019">CanInterface</span><span class="op" id="6427031">(</span><span class="op" id="6427032">)</span>&nbsp;<span class="op" id="6427034">&amp;&amp;</span>&nbsp;<span class="ident" id="6427037">vf</span><span class="op" id="6427039">.</span><span class="ident" id="6427040">Type</span><span class="op" id="6427044">(</span><span class="op" id="6427045">)</span><span class="op" id="6427046">.</span><span class="ident" id="6427047">Implements</span><span class="op" id="6427057">(</span><span class="ident" id="6427058">textMarshalerType</span><span class="op" id="6427075">)</span>&nbsp;<span class="op" id="6427077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427083">data</span><span class="op" id="6427087">,</span>&nbsp;<span class="ident" id="6427089">err</span>&nbsp;<span class="op" id="6427093">:=</span>&nbsp;<span class="ident" id="6427096">vf</span><span class="op" id="6427098">.</span><span class="ident" id="6427099">Interface</span><span class="op" id="6427108">(</span><span class="op" id="6427109">)</span><span class="op" id="6427110">.</span><span class="op" id="6427111">(</span><span class="ident" id="6427112">encoding</span><span class="op" id="6427120">.</span><span class="ident" id="6427121">TextMarshaler</span><span class="op" id="6427134">)</span><span class="op" id="6427135">.</span><span class="ident" id="6427136">MarshalText</span><span class="op" id="6427147">(</span><span class="op" id="6427148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427154">if</span>&nbsp;<span class="ident" id="6427157">err</span>&nbsp;<span class="op" id="6427161">!=</span>&nbsp;<span class="ident" id="6427164">nil</span>&nbsp;<span class="op" id="6427168">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427175">return</span>&nbsp;<span class="ident" id="6427182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427196">Escape</span><span class="op" id="6427202">(</span><span class="ident" id="6427203">p</span><span class="op" id="6427204">,</span>&nbsp;<span class="ident" id="6427206">data</span><span class="op" id="6427210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427216">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427228">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427233">if</span>&nbsp;<span class="ident" id="6427236">vf</span><span class="op" id="6427238">.</span><span class="ident" id="6427239">CanAddr</span><span class="op" id="6427246">(</span><span class="op" id="6427247">)</span>&nbsp;<span class="op" id="6427249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427255">pv</span>&nbsp;<span class="op" id="6427258">:=</span>&nbsp;<span class="ident" id="6427261">vf</span><span class="op" id="6427263">.</span><span class="ident" id="6427264">Addr</span><span class="op" id="6427268">(</span><span class="op" id="6427269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427275">if</span>&nbsp;<span class="ident" id="6427278">pv</span><span class="op" id="6427280">.</span><span class="ident" id="6427281">CanInterface</span><span class="op" id="6427293">(</span><span class="op" id="6427294">)</span>&nbsp;<span class="op" id="6427296">&amp;&amp;</span>&nbsp;<span class="ident" id="6427299">pv</span><span class="op" id="6427301">.</span><span class="ident" id="6427302">Type</span><span class="op" id="6427306">(</span><span class="op" id="6427307">)</span><span class="op" id="6427308">.</span><span class="ident" id="6427309">Implements</span><span class="op" id="6427319">(</span><span class="ident" id="6427320">textMarshalerType</span><span class="op" id="6427337">)</span>&nbsp;<span class="op" id="6427339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427346">data</span><span class="op" id="6427350">,</span>&nbsp;<span class="ident" id="6427352">err</span>&nbsp;<span class="op" id="6427356">:=</span>&nbsp;<span class="ident" id="6427359">pv</span><span class="op" id="6427361">.</span><span class="ident" id="6427362">Interface</span><span class="op" id="6427371">(</span><span class="op" id="6427372">)</span><span class="op" id="6427373">.</span><span class="op" id="6427374">(</span><span class="ident" id="6427375">encoding</span><span class="op" id="6427383">.</span><span class="ident" id="6427384">TextMarshaler</span><span class="op" id="6427397">)</span><span class="op" id="6427398">.</span><span class="ident" id="6427399">MarshalText</span><span class="op" id="6427410">(</span><span class="op" id="6427411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427418">if</span>&nbsp;<span class="ident" id="6427421">err</span>&nbsp;<span class="op" id="6427425">!=</span>&nbsp;<span class="ident" id="6427428">nil</span>&nbsp;<span class="op" id="6427432">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427440">return</span>&nbsp;<span class="ident" id="6427447">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427463">Escape</span><span class="op" id="6427469">(</span><span class="ident" id="6427470">p</span><span class="op" id="6427471">,</span>&nbsp;<span class="ident" id="6427473">data</span><span class="op" id="6427477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427484">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427497">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6427502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427507">var</span>&nbsp;<span class="ident" id="6427511">scratch</span>&nbsp;<span class="op" id="6427519">[</span><span class="num" id="6427520">64</span><span class="op" id="6427522">]</span><span class="builtintype" id="6427523">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427531">switch</span>&nbsp;<span class="ident" id="6427538">vf</span><span class="op" id="6427540">.</span><span class="ident" id="6427541">Kind</span><span class="op" id="6427545">(</span><span class="op" id="6427546">)</span>&nbsp;<span class="op" id="6427548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427553">case</span>&nbsp;<span class="ident" id="6427558">reflect</span><span class="op" id="6427565">.</span><span class="ident" id="6427566">Int</span><span class="op" id="6427569">,</span>&nbsp;<span class="ident" id="6427571">reflect</span><span class="op" id="6427578">.</span><span class="ident" id="6427579">Int8</span><span class="op" id="6427583">,</span>&nbsp;<span class="ident" id="6427585">reflect</span><span class="op" id="6427592">.</span><span class="ident" id="6427593">Int16</span><span class="op" id="6427598">,</span>&nbsp;<span class="ident" id="6427600">reflect</span><span class="op" id="6427607">.</span><span class="ident" id="6427608">Int32</span><span class="op" id="6427613">,</span>&nbsp;<span class="ident" id="6427615">reflect</span><span class="op" id="6427622">.</span><span class="ident" id="6427623">Int64</span><span class="op" id="6427628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427634">Escape</span><span class="op" id="6427640">(</span><span class="ident" id="6427641">p</span><span class="op" id="6427642">,</span>&nbsp;<span class="ident" id="6427644">strconv</span><span class="op" id="6427651">.</span><span class="ident" id="6427652">AppendInt</span><span class="op" id="6427661">(</span><span class="ident" id="6427662">scratch</span><span class="op" id="6427669">[</span><span class="op" id="6427670">:</span><span class="num" id="6427671">0</span><span class="op" id="6427672">]</span><span class="op" id="6427673">,</span>&nbsp;<span class="ident" id="6427675">vf</span><span class="op" id="6427677">.</span><span class="ident" id="6427678">Int</span><span class="op" id="6427681">(</span><span class="op" id="6427682">)</span><span class="op" id="6427683">,</span>&nbsp;<span class="num" id="6427685">10</span><span class="op" id="6427687">)</span><span class="op" id="6427688">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427693">case</span>&nbsp;<span class="ident" id="6427698">reflect</span><span class="op" id="6427705">.</span><span class="ident" id="6427706">Uint</span><span class="op" id="6427710">,</span>&nbsp;<span class="ident" id="6427712">reflect</span><span class="op" id="6427719">.</span><span class="ident" id="6427720">Uint8</span><span class="op" id="6427725">,</span>&nbsp;<span class="ident" id="6427727">reflect</span><span class="op" id="6427734">.</span><span class="ident" id="6427735">Uint16</span><span class="op" id="6427741">,</span>&nbsp;<span class="ident" id="6427743">reflect</span><span class="op" id="6427750">.</span><span class="ident" id="6427751">Uint32</span><span class="op" id="6427757">,</span>&nbsp;<span class="ident" id="6427759">reflect</span><span class="op" id="6427766">.</span><span class="ident" id="6427767">Uint64</span><span class="op" id="6427773">,</span>&nbsp;<span class="ident" id="6427775">reflect</span><span class="op" id="6427782">.</span><span class="ident" id="6427783">Uintptr</span><span class="op" id="6427790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427796">Escape</span><span class="op" id="6427802">(</span><span class="ident" id="6427803">p</span><span class="op" id="6427804">,</span>&nbsp;<span class="ident" id="6427806">strconv</span><span class="op" id="6427813">.</span><span class="ident" id="6427814">AppendUint</span><span class="op" id="6427824">(</span><span class="ident" id="6427825">scratch</span><span class="op" id="6427832">[</span><span class="op" id="6427833">:</span><span class="num" id="6427834">0</span><span class="op" id="6427835">]</span><span class="op" id="6427836">,</span>&nbsp;<span class="ident" id="6427838">vf</span><span class="op" id="6427840">.</span><span class="ident" id="6427841">Uint</span><span class="op" id="6427845">(</span><span class="op" id="6427846">)</span><span class="op" id="6427847">,</span>&nbsp;<span class="num" id="6427849">10</span><span class="op" id="6427851">)</span><span class="op" id="6427852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427857">case</span>&nbsp;<span class="ident" id="6427862">reflect</span><span class="op" id="6427869">.</span><span class="ident" id="6427870">Float32</span><span class="op" id="6427877">,</span>&nbsp;<span class="ident" id="6427879">reflect</span><span class="op" id="6427886">.</span><span class="ident" id="6427887">Float64</span><span class="op" id="6427894">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6427900">Escape</span><span class="op" id="6427906">(</span><span class="ident" id="6427907">p</span><span class="op" id="6427908">,</span>&nbsp;<span class="ident" id="6427910">strconv</span><span class="op" id="6427917">.</span><span class="ident" id="6427918">AppendFloat</span><span class="op" id="6427929">(</span><span class="ident" id="6427930">scratch</span><span class="op" id="6427937">[</span><span class="op" id="6427938">:</span><span class="num" id="6427939">0</span><span class="op" id="6427940">]</span><span class="op" id="6427941">,</span>&nbsp;<span class="ident" id="6427943">vf</span><span class="op" id="6427945">.</span><span class="ident" id="6427946">Float</span><span class="op" id="6427951">(</span><span class="op" id="6427952">)</span><span class="op" id="6427953">,</span>&nbsp;<span class="string" id="6427955">&#39;g&#39;</span><span class="op" id="6427958">,</span>&nbsp;<span class="op" id="6427960">-</span><span class="num" id="6427961">1</span><span class="op" id="6427962">,</span>&nbsp;<span class="ident" id="6427964">vf</span><span class="op" id="6427966">.</span><span class="ident" id="6427967">Type</span><span class="op" id="6427971">(</span><span class="op" id="6427972">)</span><span class="op" id="6427973">.</span><span class="ident" id="6427974">Bits</span><span class="op" id="6427978">(</span><span class="op" id="6427979">)</span><span class="op" id="6427980">)</span><span class="op" id="6427981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6427986">case</span>&nbsp;<span class="ident" id="6427991">reflect</span><span class="op" id="6427998">.</span><span class="ident" id="6427999">Bool</span><span class="op" id="6428003">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428009">Escape</span><span class="op" id="6428015">(</span><span class="ident" id="6428016">p</span><span class="op" id="6428017">,</span>&nbsp;<span class="ident" id="6428019">strconv</span><span class="op" id="6428026">.</span><span class="ident" id="6428027">AppendBool</span><span class="op" id="6428037">(</span><span class="ident" id="6428038">scratch</span><span class="op" id="6428045">[</span><span class="op" id="6428046">:</span><span class="num" id="6428047">0</span><span class="op" id="6428048">]</span><span class="op" id="6428049">,</span>&nbsp;<span class="ident" id="6428051">vf</span><span class="op" id="6428053">.</span><span class="ident" id="6428054">Bool</span><span class="op" id="6428058">(</span><span class="op" id="6428059">)</span><span class="op" id="6428060">)</span><span class="op" id="6428061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428066">case</span>&nbsp;<span class="ident" id="6428071">reflect</span><span class="op" id="6428078">.</span><span class="ident" id="6428079">String</span><span class="op" id="6428085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428091">if</span>&nbsp;<span class="ident" id="6428094">err</span>&nbsp;<span class="op" id="6428098">:=</span>&nbsp;<span class="ident" id="6428101">EscapeText</span><span class="op" id="6428111">(</span><span class="ident" id="6428112">p</span><span class="op" id="6428113">,</span>&nbsp;<span class="op" id="6428115">[</span><span class="op" id="6428116">]</span><span class="builtintype" id="6428117">byte</span><span class="op" id="6428121">(</span><span class="ident" id="6428122">vf</span><span class="op" id="6428124">.</span><span class="ident" id="6428125">String</span><span class="op" id="6428131">(</span><span class="op" id="6428132">)</span><span class="op" id="6428133">)</span><span class="op" id="6428134">)</span><span class="op" id="6428135">;</span>&nbsp;<span class="ident" id="6428137">err</span>&nbsp;<span class="op" id="6428141">!=</span>&nbsp;<span class="ident" id="6428144">nil</span>&nbsp;<span class="op" id="6428148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428155">return</span>&nbsp;<span class="ident" id="6428162">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428170">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428175">case</span>&nbsp;<span class="ident" id="6428180">reflect</span><span class="op" id="6428187">.</span><span class="ident" id="6428188">Slice</span><span class="op" id="6428193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428199">if</span>&nbsp;<span class="ident" id="6428202">elem</span><span class="op" id="6428206">,</span>&nbsp;<span class="ident" id="6428208">ok</span>&nbsp;<span class="op" id="6428211">:=</span>&nbsp;<span class="ident" id="6428214">vf</span><span class="op" id="6428216">.</span><span class="ident" id="6428217">Interface</span><span class="op" id="6428226">(</span><span class="op" id="6428227">)</span><span class="op" id="6428228">.</span><span class="op" id="6428229">(</span><span class="op" id="6428230">[</span><span class="op" id="6428231">]</span><span class="builtintype" id="6428232">byte</span><span class="op" id="6428236">)</span><span class="op" id="6428237">;</span>&nbsp;<span class="ident" id="6428239">ok</span>&nbsp;<span class="op" id="6428242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428249">if</span>&nbsp;<span class="ident" id="6428252">err</span>&nbsp;<span class="op" id="6428256">:=</span>&nbsp;<span class="ident" id="6428259">EscapeText</span><span class="op" id="6428269">(</span><span class="ident" id="6428270">p</span><span class="op" id="6428271">,</span>&nbsp;<span class="ident" id="6428273">elem</span><span class="op" id="6428277">)</span><span class="op" id="6428278">;</span>&nbsp;<span class="ident" id="6428280">err</span>&nbsp;<span class="op" id="6428284">!=</span>&nbsp;<span class="ident" id="6428287">nil</span>&nbsp;<span class="op" id="6428291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428299">return</span>&nbsp;<span class="ident" id="6428306">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428315">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428331">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428343">case</span>&nbsp;<span class="ident" id="6428348">fComment</span><span class="op" id="6428356">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428361">k</span>&nbsp;<span class="op" id="6428363">:=</span>&nbsp;<span class="ident" id="6428366">vf</span><span class="op" id="6428368">.</span><span class="ident" id="6428369">Kind</span><span class="op" id="6428373">(</span><span class="op" id="6428374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428379">if</span>&nbsp;<span class="op" id="6428382">!</span><span class="op" id="6428383">(</span><span class="ident" id="6428384">k</span>&nbsp;<span class="op" id="6428386">==</span>&nbsp;<span class="ident" id="6428389">reflect</span><span class="op" id="6428396">.</span><span class="ident" id="6428397">String</span>&nbsp;<span class="op" id="6428404">||</span>&nbsp;<span class="ident" id="6428407">k</span>&nbsp;<span class="op" id="6428409">==</span>&nbsp;<span class="ident" id="6428412">reflect</span><span class="op" id="6428419">.</span><span class="ident" id="6428420">Slice</span>&nbsp;<span class="op" id="6428426">&amp;&amp;</span>&nbsp;<span class="ident" id="6428429">vf</span><span class="op" id="6428431">.</span><span class="ident" id="6428432">Type</span><span class="op" id="6428436">(</span><span class="op" id="6428437">)</span><span class="op" id="6428438">.</span><span class="ident" id="6428439">Elem</span><span class="op" id="6428443">(</span><span class="op" id="6428444">)</span><span class="op" id="6428445">.</span><span class="ident" id="6428446">Kind</span><span class="op" id="6428450">(</span><span class="op" id="6428451">)</span>&nbsp;<span class="op" id="6428453">==</span>&nbsp;<span class="ident" id="6428456">reflect</span><span class="op" id="6428463">.</span><span class="ident" id="6428464">Uint8</span><span class="op" id="6428469">)</span>&nbsp;<span class="op" id="6428471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428477">return</span>&nbsp;<span class="ident" id="6428484">fmt</span><span class="op" id="6428487">.</span><span class="ident" id="6428488">Errorf</span><span class="op" id="6428494">(</span><span class="string" id="6428495">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="6428534">,</span>&nbsp;<span class="ident" id="6428536">val</span><span class="op" id="6428539">.</span><span class="ident" id="6428540">Type</span><span class="op" id="6428544">(</span><span class="op" id="6428545">)</span><span class="op" id="6428546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428556">if</span>&nbsp;<span class="ident" id="6428559">vf</span><span class="op" id="6428561">.</span><span class="ident" id="6428562">Len</span><span class="op" id="6428565">(</span><span class="op" id="6428566">)</span>&nbsp;<span class="op" id="6428568">==</span>&nbsp;<span class="num" id="6428571">0</span>&nbsp;<span class="op" id="6428573">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428579">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428596">p</span><span class="op" id="6428597">.</span><span class="ident" id="6428598">writeIndent</span><span class="op" id="6428609">(</span><span class="num" id="6428610">0</span><span class="op" id="6428611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428616">p</span><span class="op" id="6428617">.</span><span class="ident" id="6428618">WriteString</span><span class="op" id="6428629">(</span><span class="string" id="6428630">&#34;&lt;!--&#34;</span><span class="op" id="6428636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428641">dashDash</span>&nbsp;<span class="op" id="6428650">:=</span>&nbsp;<span class="ident" id="6428653">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428662">dashLast</span>&nbsp;<span class="op" id="6428671">:=</span>&nbsp;<span class="ident" id="6428674">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428683">switch</span>&nbsp;<span class="ident" id="6428690">k</span>&nbsp;<span class="op" id="6428692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428697">case</span>&nbsp;<span class="ident" id="6428702">reflect</span><span class="op" id="6428709">.</span><span class="ident" id="6428710">String</span><span class="op" id="6428716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428722">s</span>&nbsp;<span class="op" id="6428724">:=</span>&nbsp;<span class="ident" id="6428727">vf</span><span class="op" id="6428729">.</span><span class="ident" id="6428730">String</span><span class="op" id="6428736">(</span><span class="op" id="6428737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428743">dashDash</span>&nbsp;<span class="op" id="6428752">=</span>&nbsp;<span class="ident" id="6428754">strings</span><span class="op" id="6428761">.</span><span class="ident" id="6428762">Index</span><span class="op" id="6428767">(</span><span class="ident" id="6428768">s</span><span class="op" id="6428769">,</span>&nbsp;<span class="string" id="6428771">&#34;--&#34;</span><span class="op" id="6428775">)</span>&nbsp;<span class="op" id="6428777">&gt;=</span>&nbsp;<span class="num" id="6428780">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428786">dashLast</span>&nbsp;<span class="op" id="6428795">=</span>&nbsp;<span class="ident" id="6428797">s</span><span class="op" id="6428798">[</span><span class="builtinfunc" id="6428799">len</span><span class="op" id="6428802">(</span><span class="ident" id="6428803">s</span><span class="op" id="6428804">)</span><span class="op" id="6428805">-</span><span class="num" id="6428806">1</span><span class="op" id="6428807">]</span>&nbsp;<span class="op" id="6428809">==</span>&nbsp;<span class="string" id="6428812">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428820">if</span>&nbsp;<span class="op" id="6428823">!</span><span class="ident" id="6428824">dashDash</span>&nbsp;<span class="op" id="6428833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428840">p</span><span class="op" id="6428841">.</span><span class="ident" id="6428842">WriteString</span><span class="op" id="6428853">(</span><span class="ident" id="6428854">s</span><span class="op" id="6428855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6428861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428866">case</span>&nbsp;<span class="ident" id="6428871">reflect</span><span class="op" id="6428878">.</span><span class="ident" id="6428879">Slice</span><span class="op" id="6428884">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428890">b</span>&nbsp;<span class="op" id="6428892">:=</span>&nbsp;<span class="ident" id="6428895">vf</span><span class="op" id="6428897">.</span><span class="ident" id="6428898">Bytes</span><span class="op" id="6428903">(</span><span class="op" id="6428904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428910">dashDash</span>&nbsp;<span class="op" id="6428919">=</span>&nbsp;<span class="ident" id="6428921">bytes</span><span class="op" id="6428926">.</span><span class="ident" id="6428927">Index</span><span class="op" id="6428932">(</span><span class="ident" id="6428933">b</span><span class="op" id="6428934">,</span>&nbsp;<span class="ident" id="6428936">ddBytes</span><span class="op" id="6428943">)</span>&nbsp;<span class="op" id="6428945">&gt;=</span>&nbsp;<span class="num" id="6428948">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6428954">dashLast</span>&nbsp;<span class="op" id="6428963">=</span>&nbsp;<span class="ident" id="6428965">b</span><span class="op" id="6428966">[</span><span class="builtinfunc" id="6428967">len</span><span class="op" id="6428970">(</span><span class="ident" id="6428971">b</span><span class="op" id="6428972">)</span><span class="op" id="6428973">-</span><span class="num" id="6428974">1</span><span class="op" id="6428975">]</span>&nbsp;<span class="op" id="6428977">==</span>&nbsp;<span class="string" id="6428980">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6428988">if</span>&nbsp;<span class="op" id="6428991">!</span><span class="ident" id="6428992">dashDash</span>&nbsp;<span class="op" id="6429001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429008">p</span><span class="op" id="6429009">.</span><span class="ident" id="6429010">Write</span><span class="op" id="6429015">(</span><span class="ident" id="6429016">b</span><span class="op" id="6429017">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429028">default</span><span class="op" id="6429035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6429041">panic</span><span class="op" id="6429046">(</span><span class="string" id="6429047">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="6429061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429071">if</span>&nbsp;<span class="ident" id="6429074">dashDash</span>&nbsp;<span class="op" id="6429083">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429089">return</span>&nbsp;<span class="ident" id="6429096">fmt</span><span class="op" id="6429099">.</span><span class="ident" id="6429100">Errorf</span><span class="op" id="6429106">(</span><span class="string" id="6429107">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="6429144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429154">if</span>&nbsp;<span class="ident" id="6429157">dashLast</span>&nbsp;<span class="op" id="6429166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6429172">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429222">p</span><span class="op" id="6429223">.</span><span class="ident" id="6429224">WriteByte</span><span class="op" id="6429233">(</span><span class="string" id="6429234">&#39;&nbsp;&#39;</span><span class="op" id="6429237">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429247">p</span><span class="op" id="6429248">.</span><span class="ident" id="6429249">WriteString</span><span class="op" id="6429260">(</span><span class="string" id="6429261">&#34;--&gt;&#34;</span><span class="op" id="6429266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429271">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429283">case</span>&nbsp;<span class="ident" id="6429288">fInnerXml</span><span class="op" id="6429297">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429302">iface</span>&nbsp;<span class="op" id="6429308">:=</span>&nbsp;<span class="ident" id="6429311">vf</span><span class="op" id="6429313">.</span><span class="ident" id="6429314">Interface</span><span class="op" id="6429323">(</span><span class="op" id="6429324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429329">switch</span>&nbsp;<span class="ident" id="6429336">raw</span>&nbsp;<span class="op" id="6429340">:=</span>&nbsp;<span class="ident" id="6429343">iface</span><span class="op" id="6429348">.</span><span class="op" id="6429349">(</span><span class="keyword" id="6429350">type</span><span class="op" id="6429354">)</span>&nbsp;<span class="op" id="6429356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429361">case</span>&nbsp;<span class="op" id="6429366">[</span><span class="op" id="6429367">]</span><span class="builtintype" id="6429368">byte</span><span class="op" id="6429372">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429378">p</span><span class="op" id="6429379">.</span><span class="ident" id="6429380">Write</span><span class="op" id="6429385">(</span><span class="ident" id="6429386">raw</span><span class="op" id="6429389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429395">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429407">case</span>&nbsp;<span class="builtintype" id="6429412">string</span><span class="op" id="6429418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429424">p</span><span class="op" id="6429425">.</span><span class="ident" id="6429426">WriteString</span><span class="op" id="6429437">(</span><span class="ident" id="6429438">raw</span><span class="op" id="6429441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429447">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429464">case</span>&nbsp;<span class="ident" id="6429469">fElement</span><span class="op" id="6429477">,</span>&nbsp;<span class="ident" id="6429479">fElement</span>&nbsp;<span class="op" id="6429488">|</span>&nbsp;<span class="ident" id="6429490">fAny</span><span class="op" id="6429494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429499">if</span>&nbsp;<span class="ident" id="6429502">err</span>&nbsp;<span class="op" id="6429506">:=</span>&nbsp;<span class="ident" id="6429509">s</span><span class="op" id="6429510">.</span><span class="ident" id="6429511">trim</span><span class="op" id="6429515">(</span><span class="ident" id="6429516">finfo</span><span class="op" id="6429521">.</span><span class="ident" id="6429522">parents</span><span class="op" id="6429529">)</span><span class="op" id="6429530">;</span>&nbsp;<span class="ident" id="6429532">err</span>&nbsp;<span class="op" id="6429536">!=</span>&nbsp;<span class="ident" id="6429539">nil</span>&nbsp;<span class="op" id="6429543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429549">return</span>&nbsp;<span class="ident" id="6429556">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429568">if</span>&nbsp;<span class="builtinfunc" id="6429571">len</span><span class="op" id="6429574">(</span><span class="ident" id="6429575">finfo</span><span class="op" id="6429580">.</span><span class="ident" id="6429581">parents</span><span class="op" id="6429588">)</span>&nbsp;<span class="op" id="6429590">&gt;</span>&nbsp;<span class="builtinfunc" id="6429592">len</span><span class="op" id="6429595">(</span><span class="ident" id="6429596">s</span><span class="op" id="6429597">.</span><span class="ident" id="6429598">stack</span><span class="op" id="6429603">)</span>&nbsp;<span class="op" id="6429605">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429611">if</span>&nbsp;<span class="ident" id="6429614">vf</span><span class="op" id="6429616">.</span><span class="ident" id="6429617">Kind</span><span class="op" id="6429621">(</span><span class="op" id="6429622">)</span>&nbsp;<span class="op" id="6429624">!=</span>&nbsp;<span class="ident" id="6429627">reflect</span><span class="op" id="6429634">.</span><span class="ident" id="6429635">Ptr</span>&nbsp;<span class="op" id="6429639">&amp;&amp;</span>&nbsp;<span class="ident" id="6429642">vf</span><span class="op" id="6429644">.</span><span class="ident" id="6429645">Kind</span><span class="op" id="6429649">(</span><span class="op" id="6429650">)</span>&nbsp;<span class="op" id="6429652">!=</span>&nbsp;<span class="ident" id="6429655">reflect</span><span class="op" id="6429662">.</span><span class="ident" id="6429663">Interface</span>&nbsp;<span class="op" id="6429673">||</span>&nbsp;<span class="op" id="6429676">!</span><span class="ident" id="6429677">vf</span><span class="op" id="6429679">.</span><span class="ident" id="6429680">IsNil</span><span class="op" id="6429685">(</span><span class="op" id="6429686">)</span>&nbsp;<span class="op" id="6429688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429695">if</span>&nbsp;<span class="ident" id="6429698">err</span>&nbsp;<span class="op" id="6429702">:=</span>&nbsp;<span class="ident" id="6429705">s</span><span class="op" id="6429706">.</span><span class="ident" id="6429707">push</span><span class="op" id="6429711">(</span><span class="ident" id="6429712">finfo</span><span class="op" id="6429717">.</span><span class="ident" id="6429718">parents</span><span class="op" id="6429725">[</span><span class="builtinfunc" id="6429726">len</span><span class="op" id="6429729">(</span><span class="ident" id="6429730">s</span><span class="op" id="6429731">.</span><span class="ident" id="6429732">stack</span><span class="op" id="6429737">)</span><span class="op" id="6429738">:</span><span class="op" id="6429739">]</span><span class="op" id="6429740">)</span><span class="op" id="6429741">;</span>&nbsp;<span class="ident" id="6429743">err</span>&nbsp;<span class="op" id="6429747">!=</span>&nbsp;<span class="ident" id="6429750">nil</span>&nbsp;<span class="op" id="6429754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429762">return</span>&nbsp;<span class="ident" id="6429769">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429784">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429797">if</span>&nbsp;<span class="ident" id="6429800">err</span>&nbsp;<span class="op" id="6429804">:=</span>&nbsp;<span class="ident" id="6429807">p</span><span class="op" id="6429808">.</span><span class="ident" id="6429809">marshalValue</span><span class="op" id="6429821">(</span><span class="ident" id="6429822">vf</span><span class="op" id="6429824">,</span>&nbsp;<span class="ident" id="6429826">finfo</span><span class="op" id="6429831">,</span>&nbsp;<span class="ident" id="6429833">nil</span><span class="op" id="6429836">)</span><span class="op" id="6429837">;</span>&nbsp;<span class="ident" id="6429839">err</span>&nbsp;<span class="op" id="6429843">!=</span>&nbsp;<span class="ident" id="6429846">nil</span>&nbsp;<span class="op" id="6429850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429855">return</span>&nbsp;<span class="ident" id="6429862">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429868">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6429871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6429874">s</span><span class="op" id="6429875">.</span><span class="ident" id="6429876">trim</span><span class="op" id="6429880">(</span><span class="ident" id="6429881">nil</span><span class="op" id="6429884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6429887">return</span>&nbsp;<span class="ident" id="6429894">p</span><span class="op" id="6429895">.</span><span class="ident" id="6429896">cachedWriteError</span><span class="op" id="6429912">(</span><span class="op" id="6429913">)</span><br>
<span class="lineno"></span><span class="op" id="6429915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="6429918">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="6429966">func</span>&nbsp;<span class="op" id="6429971">(</span><span class="ident" id="6429972">p</span>&nbsp;<span class="op" id="6429974">*</span><span class="ident" id="6429975">printer</span><span class="op" id="6429982">)</span>&nbsp;<span class="ident" id="6429984">cachedWriteError</span><span class="op" id="6430000">(</span><span class="op" id="6430001">)</span>&nbsp;<span class="builtintype" id="6430003">error</span>&nbsp;<span class="op" id="6430009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430012">_</span><span class="op" id="6430013">,</span>&nbsp;<span class="ident" id="6430015">err</span>&nbsp;<span class="op" id="6430019">:=</span>&nbsp;<span class="ident" id="6430022">p</span><span class="op" id="6430023">.</span><span class="ident" id="6430024">Write</span><span class="op" id="6430029">(</span><span class="ident" id="6430030">nil</span><span class="op" id="6430033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430036">return</span>&nbsp;<span class="ident" id="6430043">err</span><br>
<span class="lineno"></span><span class="op" id="6430047">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="6430050">func</span>&nbsp;<span class="op" id="6430055">(</span><span class="ident" id="6430056">p</span>&nbsp;<span class="op" id="6430058">*</span><span class="ident" id="6430059">printer</span><span class="op" id="6430066">)</span>&nbsp;<span class="ident" id="6430068">writeIndent</span><span class="op" id="6430079">(</span><span class="ident" id="6430080">depthDelta</span>&nbsp;<span class="builtintype" id="6430091">int</span><span class="op" id="6430094">)</span>&nbsp;<span class="op" id="6430096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430099">if</span>&nbsp;<span class="builtinfunc" id="6430102">len</span><span class="op" id="6430105">(</span><span class="ident" id="6430106">p</span><span class="op" id="6430107">.</span><span class="ident" id="6430108">prefix</span><span class="op" id="6430114">)</span>&nbsp;<span class="op" id="6430116">==</span>&nbsp;<span class="num" id="6430119">0</span>&nbsp;<span class="op" id="6430121">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6430124">len</span><span class="op" id="6430127">(</span><span class="ident" id="6430128">p</span><span class="op" id="6430129">.</span><span class="ident" id="6430130">indent</span><span class="op" id="6430136">)</span>&nbsp;<span class="op" id="6430138">==</span>&nbsp;<span class="num" id="6430141">0</span>&nbsp;<span class="op" id="6430143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430147">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430155">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430158">if</span>&nbsp;<span class="ident" id="6430161">depthDelta</span>&nbsp;<span class="op" id="6430172">&lt;</span>&nbsp;<span class="num" id="6430174">0</span>&nbsp;<span class="op" id="6430176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430180">p</span><span class="op" id="6430181">.</span><span class="ident" id="6430182">depth</span><span class="op" id="6430187">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430192">if</span>&nbsp;<span class="ident" id="6430195">p</span><span class="op" id="6430196">.</span><span class="ident" id="6430197">indentedIn</span>&nbsp;<span class="op" id="6430208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430213">p</span><span class="op" id="6430214">.</span><span class="ident" id="6430215">indentedIn</span>&nbsp;<span class="op" id="6430226">=</span>&nbsp;<span class="ident" id="6430228">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430237">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430250">p</span><span class="op" id="6430251">.</span><span class="ident" id="6430252">indentedIn</span>&nbsp;<span class="op" id="6430263">=</span>&nbsp;<span class="ident" id="6430265">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430275">if</span>&nbsp;<span class="ident" id="6430278">p</span><span class="op" id="6430279">.</span><span class="ident" id="6430280">putNewline</span>&nbsp;<span class="op" id="6430291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430295">p</span><span class="op" id="6430296">.</span><span class="ident" id="6430297">WriteByte</span><span class="op" id="6430306">(</span><span class="string" id="6430307">&#39;\n&#39;</span><span class="op" id="6430311">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430314">}</span>&nbsp;<span class="keyword" id="6430316">else</span>&nbsp;<span class="op" id="6430321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430325">p</span><span class="op" id="6430326">.</span><span class="ident" id="6430327">putNewline</span>&nbsp;<span class="op" id="6430338">=</span>&nbsp;<span class="ident" id="6430340">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430349">if</span>&nbsp;<span class="builtinfunc" id="6430352">len</span><span class="op" id="6430355">(</span><span class="ident" id="6430356">p</span><span class="op" id="6430357">.</span><span class="ident" id="6430358">prefix</span><span class="op" id="6430364">)</span>&nbsp;<span class="op" id="6430366">&gt;</span>&nbsp;<span class="num" id="6430368">0</span>&nbsp;<span class="op" id="6430370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430374">p</span><span class="op" id="6430375">.</span><span class="ident" id="6430376">WriteString</span><span class="op" id="6430387">(</span><span class="ident" id="6430388">p</span><span class="op" id="6430389">.</span><span class="ident" id="6430390">prefix</span><span class="op" id="6430396">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430402">if</span>&nbsp;<span class="builtinfunc" id="6430405">len</span><span class="op" id="6430408">(</span><span class="ident" id="6430409">p</span><span class="op" id="6430410">.</span><span class="ident" id="6430411">indent</span><span class="op" id="6430417">)</span>&nbsp;<span class="op" id="6430419">&gt;</span>&nbsp;<span class="num" id="6430421">0</span>&nbsp;<span class="op" id="6430423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430427">for</span>&nbsp;<span class="ident" id="6430431">i</span>&nbsp;<span class="op" id="6430433">:=</span>&nbsp;<span class="num" id="6430436">0</span><span class="op" id="6430437">;</span>&nbsp;<span class="ident" id="6430439">i</span>&nbsp;<span class="op" id="6430441">&lt;</span>&nbsp;<span class="ident" id="6430443">p</span><span class="op" id="6430444">.</span><span class="ident" id="6430445">depth</span><span class="op" id="6430450">;</span>&nbsp;<span class="ident" id="6430452">i</span><span class="op" id="6430453">++</span>&nbsp;<span class="op" id="6430456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430461">p</span><span class="op" id="6430462">.</span><span class="ident" id="6430463">WriteString</span><span class="op" id="6430474">(</span><span class="ident" id="6430475">p</span><span class="op" id="6430476">.</span><span class="ident" id="6430477">indent</span><span class="op" id="6430483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430487">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430493">if</span>&nbsp;<span class="ident" id="6430496">depthDelta</span>&nbsp;<span class="op" id="6430507">&gt;</span>&nbsp;<span class="num" id="6430509">0</span>&nbsp;<span class="op" id="6430511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430515">p</span><span class="op" id="6430516">.</span><span class="ident" id="6430517">depth</span><span class="op" id="6430522">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430527">p</span><span class="op" id="6430528">.</span><span class="ident" id="6430529">indentedIn</span>&nbsp;<span class="op" id="6430540">=</span>&nbsp;<span class="ident" id="6430542">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6430548">}</span><br>
<span class="lineno">875</span><span class="op" id="6430550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6430553">type</span>&nbsp;<span class="ident" id="6430558">parentStack</span>&nbsp;<span class="keyword" id="6430570">struct</span>&nbsp;<span class="op" id="6430577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430580">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6430586">*</span><span class="ident" id="6430587">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430596">stack</span>&nbsp;<span class="op" id="6430602">[</span><span class="op" id="6430603">]</span><span class="builtintype" id="6430604">string</span><br>
<span class="lineno">880</span><span class="op" id="6430611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6430614">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="6430694">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="6430768">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="6430837">func</span>&nbsp;<span class="op" id="6430842">(</span><span class="ident" id="6430843">s</span>&nbsp;<span class="op" id="6430845">*</span><span class="ident" id="6430846">parentStack</span><span class="op" id="6430857">)</span>&nbsp;<span class="ident" id="6430859">trim</span><span class="op" id="6430863">(</span><span class="ident" id="6430864">parents</span>&nbsp;<span class="op" id="6430872">[</span><span class="op" id="6430873">]</span><span class="builtintype" id="6430874">string</span><span class="op" id="6430880">)</span>&nbsp;<span class="builtintype" id="6430882">error</span>&nbsp;<span class="op" id="6430888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6430891">split</span>&nbsp;<span class="op" id="6430897">:=</span>&nbsp;<span class="num" id="6430900">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430903">for</span>&nbsp;<span class="op" id="6430907">;</span>&nbsp;<span class="ident" id="6430909">split</span>&nbsp;<span class="op" id="6430915">&lt;</span>&nbsp;<span class="builtinfunc" id="6430917">len</span><span class="op" id="6430920">(</span><span class="ident" id="6430921">parents</span><span class="op" id="6430928">)</span>&nbsp;<span class="op" id="6430930">&amp;&amp;</span>&nbsp;<span class="ident" id="6430933">split</span>&nbsp;<span class="op" id="6430939">&lt;</span>&nbsp;<span class="builtinfunc" id="6430941">len</span><span class="op" id="6430944">(</span><span class="ident" id="6430945">s</span><span class="op" id="6430946">.</span><span class="ident" id="6430947">stack</span><span class="op" id="6430952">)</span><span class="op" id="6430953">;</span>&nbsp;<span class="ident" id="6430955">split</span><span class="op" id="6430960">++</span>&nbsp;<span class="op" id="6430963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6430967">if</span>&nbsp;<span class="ident" id="6430970">parents</span><span class="op" id="6430977">[</span><span class="ident" id="6430978">split</span><span class="op" id="6430983">]</span>&nbsp;<span class="op" id="6430985">!=</span>&nbsp;<span class="ident" id="6430988">s</span><span class="op" id="6430989">.</span><span class="ident" id="6430990">stack</span><span class="op" id="6430995">[</span><span class="ident" id="6430996">split</span><span class="op" id="6431001">]</span>&nbsp;<span class="op" id="6431003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431008">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431022">for</span>&nbsp;<span class="ident" id="6431026">i</span>&nbsp;<span class="op" id="6431028">:=</span>&nbsp;<span class="builtinfunc" id="6431031">len</span><span class="op" id="6431034">(</span><span class="ident" id="6431035">s</span><span class="op" id="6431036">.</span><span class="ident" id="6431037">stack</span><span class="op" id="6431042">)</span>&nbsp;<span class="op" id="6431044">-</span>&nbsp;<span class="num" id="6431046">1</span><span class="op" id="6431047">;</span>&nbsp;<span class="ident" id="6431049">i</span>&nbsp;<span class="op" id="6431051">&gt;=</span>&nbsp;<span class="ident" id="6431054">split</span><span class="op" id="6431059">;</span>&nbsp;<span class="ident" id="6431061">i</span><span class="op" id="6431062">--</span>&nbsp;<span class="op" id="6431065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431069">if</span>&nbsp;<span class="ident" id="6431072">err</span>&nbsp;<span class="op" id="6431076">:=</span>&nbsp;<span class="ident" id="6431079">s</span><span class="op" id="6431080">.</span><span class="ident" id="6431081">p</span><span class="op" id="6431082">.</span><span class="ident" id="6431083">writeEnd</span><span class="op" id="6431091">(</span><span class="ident" id="6431092">Name</span><span class="op" id="6431096">{</span><span class="ident" id="6431097">Local</span><span class="op" id="6431102">:</span>&nbsp;<span class="ident" id="6431104">s</span><span class="op" id="6431105">.</span><span class="ident" id="6431106">stack</span><span class="op" id="6431111">[</span><span class="ident" id="6431112">i</span><span class="op" id="6431113">]</span><span class="op" id="6431114">}</span><span class="op" id="6431115">)</span><span class="op" id="6431116">;</span>&nbsp;<span class="ident" id="6431118">err</span>&nbsp;<span class="op" id="6431122">!=</span>&nbsp;<span class="ident" id="6431125">nil</span>&nbsp;<span class="op" id="6431129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431134">return</span>&nbsp;<span class="ident" id="6431141">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431153">s</span><span class="op" id="6431154">.</span><span class="ident" id="6431155">stack</span>&nbsp;<span class="op" id="6431161">=</span>&nbsp;<span class="ident" id="6431163">parents</span><span class="op" id="6431170">[</span><span class="op" id="6431171">:</span><span class="ident" id="6431172">split</span><span class="op" id="6431177">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431180">return</span>&nbsp;<span class="ident" id="6431187">nil</span><br>
<span class="lineno"></span><span class="op" id="6431191">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="6431194">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="6431258">func</span>&nbsp;<span class="op" id="6431263">(</span><span class="ident" id="6431264">s</span>&nbsp;<span class="op" id="6431266">*</span><span class="ident" id="6431267">parentStack</span><span class="op" id="6431278">)</span>&nbsp;<span class="ident" id="6431280">push</span><span class="op" id="6431284">(</span><span class="ident" id="6431285">parents</span>&nbsp;<span class="op" id="6431293">[</span><span class="op" id="6431294">]</span><span class="builtintype" id="6431295">string</span><span class="op" id="6431301">)</span>&nbsp;<span class="builtintype" id="6431303">error</span>&nbsp;<span class="op" id="6431309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431312">for</span>&nbsp;<span class="ident" id="6431316">i</span>&nbsp;<span class="op" id="6431318">:=</span>&nbsp;<span class="num" id="6431321">0</span><span class="op" id="6431322">;</span>&nbsp;<span class="ident" id="6431324">i</span>&nbsp;<span class="op" id="6431326">&lt;</span>&nbsp;<span class="builtinfunc" id="6431328">len</span><span class="op" id="6431331">(</span><span class="ident" id="6431332">parents</span><span class="op" id="6431339">)</span><span class="op" id="6431340">;</span>&nbsp;<span class="ident" id="6431342">i</span><span class="op" id="6431343">++</span>&nbsp;<span class="op" id="6431346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431350">if</span>&nbsp;<span class="ident" id="6431353">err</span>&nbsp;<span class="op" id="6431357">:=</span>&nbsp;<span class="ident" id="6431360">s</span><span class="op" id="6431361">.</span><span class="ident" id="6431362">p</span><span class="op" id="6431363">.</span><span class="ident" id="6431364">writeStart</span><span class="op" id="6431374">(</span><span class="op" id="6431375">&amp;</span><span class="ident" id="6431376">StartElement</span><span class="op" id="6431388">{</span><span class="ident" id="6431389">Name</span><span class="op" id="6431393">:</span>&nbsp;<span class="ident" id="6431395">Name</span><span class="op" id="6431399">{</span><span class="ident" id="6431400">Local</span><span class="op" id="6431405">:</span>&nbsp;<span class="ident" id="6431407">parents</span><span class="op" id="6431414">[</span><span class="ident" id="6431415">i</span><span class="op" id="6431416">]</span><span class="op" id="6431417">}</span><span class="op" id="6431418">}</span><span class="op" id="6431419">)</span><span class="op" id="6431420">;</span>&nbsp;<span class="ident" id="6431422">err</span>&nbsp;<span class="op" id="6431426">!=</span>&nbsp;<span class="ident" id="6431429">nil</span>&nbsp;<span class="op" id="6431433">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431438">return</span>&nbsp;<span class="ident" id="6431445">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431457">s</span><span class="op" id="6431458">.</span><span class="ident" id="6431459">stack</span>&nbsp;<span class="op" id="6431465">=</span>&nbsp;<span class="builtinfunc" id="6431467">append</span><span class="op" id="6431473">(</span><span class="ident" id="6431474">s</span><span class="op" id="6431475">.</span><span class="ident" id="6431476">stack</span><span class="op" id="6431481">,</span>&nbsp;<span class="ident" id="6431483">parents</span><span class="op" id="6431490">...</span><span class="op" id="6431493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431496">return</span>&nbsp;<span class="ident" id="6431503">nil</span><br>
<span class="lineno">910</span><span class="op" id="6431507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6431510">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="6431574">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="6431612">type</span>&nbsp;<span class="ident" id="6431617">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="6431638">struct</span>&nbsp;<span class="op" id="6431645">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431648">Type</span>&nbsp;<span class="ident" id="6431653">reflect</span><span class="op" id="6431660">.</span><span class="ident" id="6431661">Type</span><br>
<span class="lineno"></span><span class="op" id="6431666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431669">func</span>&nbsp;<span class="op" id="6431674">(</span><span class="ident" id="6431675">e</span>&nbsp;<span class="op" id="6431677">*</span><span class="ident" id="6431678">UnsupportedTypeError</span><span class="op" id="6431698">)</span>&nbsp;<span class="ident" id="6431700">Error</span><span class="op" id="6431705">(</span><span class="op" id="6431706">)</span>&nbsp;<span class="builtintype" id="6431708">string</span>&nbsp;<span class="op" id="6431715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431718">return</span>&nbsp;<span class="string" id="6431725">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="6431751">+</span>&nbsp;<span class="ident" id="6431753">e</span><span class="op" id="6431754">.</span><span class="ident" id="6431755">Type</span><span class="op" id="6431759">.</span><span class="ident" id="6431760">String</span><span class="op" id="6431766">(</span><span class="op" id="6431767">)</span><br>
<span class="lineno">920</span><span class="op" id="6431769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431772">func</span>&nbsp;<span class="ident" id="6431777">isEmptyValue</span><span class="op" id="6431789">(</span><span class="ident" id="6431790">v</span>&nbsp;<span class="ident" id="6431792">reflect</span><span class="op" id="6431799">.</span><span class="ident" id="6431800">Value</span><span class="op" id="6431805">)</span>&nbsp;<span class="builtintype" id="6431807">bool</span>&nbsp;<span class="op" id="6431812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431815">switch</span>&nbsp;<span class="ident" id="6431822">v</span><span class="op" id="6431823">.</span><span class="ident" id="6431824">Kind</span><span class="op" id="6431828">(</span><span class="op" id="6431829">)</span>&nbsp;<span class="op" id="6431831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431834">case</span>&nbsp;<span class="ident" id="6431839">reflect</span><span class="op" id="6431846">.</span><span class="ident" id="6431847">Array</span><span class="op" id="6431852">,</span>&nbsp;<span class="ident" id="6431854">reflect</span><span class="op" id="6431861">.</span><span class="ident" id="6431862">Map</span><span class="op" id="6431865">,</span>&nbsp;<span class="ident" id="6431867">reflect</span><span class="op" id="6431874">.</span><span class="ident" id="6431875">Slice</span><span class="op" id="6431880">,</span>&nbsp;<span class="ident" id="6431882">reflect</span><span class="op" id="6431889">.</span><span class="ident" id="6431890">String</span><span class="op" id="6431896">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431900">return</span>&nbsp;<span class="ident" id="6431907">v</span><span class="op" id="6431908">.</span><span class="ident" id="6431909">Len</span><span class="op" id="6431912">(</span><span class="op" id="6431913">)</span>&nbsp;<span class="op" id="6431915">==</span>&nbsp;<span class="num" id="6431918">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431921">case</span>&nbsp;<span class="ident" id="6431926">reflect</span><span class="op" id="6431933">.</span><span class="ident" id="6431934">Bool</span><span class="op" id="6431938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431942">return</span>&nbsp;<span class="op" id="6431949">!</span><span class="ident" id="6431950">v</span><span class="op" id="6431951">.</span><span class="ident" id="6431952">Bool</span><span class="op" id="6431956">(</span><span class="op" id="6431957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431960">case</span>&nbsp;<span class="ident" id="6431965">reflect</span><span class="op" id="6431972">.</span><span class="ident" id="6431973">Int</span><span class="op" id="6431976">,</span>&nbsp;<span class="ident" id="6431978">reflect</span><span class="op" id="6431985">.</span><span class="ident" id="6431986">Int8</span><span class="op" id="6431990">,</span>&nbsp;<span class="ident" id="6431992">reflect</span><span class="op" id="6431999">.</span><span class="ident" id="6432000">Int16</span><span class="op" id="6432005">,</span>&nbsp;<span class="ident" id="6432007">reflect</span><span class="op" id="6432014">.</span><span class="ident" id="6432015">Int32</span><span class="op" id="6432020">,</span>&nbsp;<span class="ident" id="6432022">reflect</span><span class="op" id="6432029">.</span><span class="ident" id="6432030">Int64</span><span class="op" id="6432035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432039">return</span>&nbsp;<span class="ident" id="6432046">v</span><span class="op" id="6432047">.</span><span class="ident" id="6432048">Int</span><span class="op" id="6432051">(</span><span class="op" id="6432052">)</span>&nbsp;<span class="op" id="6432054">==</span>&nbsp;<span class="num" id="6432057">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432060">case</span>&nbsp;<span class="ident" id="6432065">reflect</span><span class="op" id="6432072">.</span><span class="ident" id="6432073">Uint</span><span class="op" id="6432077">,</span>&nbsp;<span class="ident" id="6432079">reflect</span><span class="op" id="6432086">.</span><span class="ident" id="6432087">Uint8</span><span class="op" id="6432092">,</span>&nbsp;<span class="ident" id="6432094">reflect</span><span class="op" id="6432101">.</span><span class="ident" id="6432102">Uint16</span><span class="op" id="6432108">,</span>&nbsp;<span class="ident" id="6432110">reflect</span><span class="op" id="6432117">.</span><span class="ident" id="6432118">Uint32</span><span class="op" id="6432124">,</span>&nbsp;<span class="ident" id="6432126">reflect</span><span class="op" id="6432133">.</span><span class="ident" id="6432134">Uint64</span><span class="op" id="6432140">,</span>&nbsp;<span class="ident" id="6432142">reflect</span><span class="op" id="6432149">.</span><span class="ident" id="6432150">Uintptr</span><span class="op" id="6432157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432161">return</span>&nbsp;<span class="ident" id="6432168">v</span><span class="op" id="6432169">.</span><span class="ident" id="6432170">Uint</span><span class="op" id="6432174">(</span><span class="op" id="6432175">)</span>&nbsp;<span class="op" id="6432177">==</span>&nbsp;<span class="num" id="6432180">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432183">case</span>&nbsp;<span class="ident" id="6432188">reflect</span><span class="op" id="6432195">.</span><span class="ident" id="6432196">Float32</span><span class="op" id="6432203">,</span>&nbsp;<span class="ident" id="6432205">reflect</span><span class="op" id="6432212">.</span><span class="ident" id="6432213">Float64</span><span class="op" id="6432220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432224">return</span>&nbsp;<span class="ident" id="6432231">v</span><span class="op" id="6432232">.</span><span class="ident" id="6432233">Float</span><span class="op" id="6432238">(</span><span class="op" id="6432239">)</span>&nbsp;<span class="op" id="6432241">==</span>&nbsp;<span class="num" id="6432244">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432247">case</span>&nbsp;<span class="ident" id="6432252">reflect</span><span class="op" id="6432259">.</span><span class="ident" id="6432260">Interface</span><span class="op" id="6432269">,</span>&nbsp;<span class="ident" id="6432271">reflect</span><span class="op" id="6432278">.</span><span class="ident" id="6432279">Ptr</span><span class="op" id="6432282">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432286">return</span>&nbsp;<span class="ident" id="6432293">v</span><span class="op" id="6432294">.</span><span class="ident" id="6432295">IsNil</span><span class="op" id="6432300">(</span><span class="op" id="6432301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6432304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6432307">return</span>&nbsp;<span class="ident" id="6432314">false</span><br>
<span class="lineno"></span><span class="op" id="6432320">}</span>
</div>
</body>
</html>
