<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2965408">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2965463">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2965517">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2965568">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="2965598">//</span><br>
<span class="lineno"></span><span class="comment" id="2965601">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="2965645">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2965698">package</span>&nbsp;<span class="ident" id="2965706">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2965712">import</span>&nbsp;<span class="op" id="2965719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965722">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965741">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965751">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965758">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965764">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965777">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965784">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965795">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965806">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2965814">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="2965821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2965824">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2965891">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="2965936">//</span><br>
<span class="lineno"></span><span class="comment" id="2965939">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="2966006">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="2966073">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="2966144">//</span><br>
<span class="lineno"></span><span class="comment" id="2966147">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="2966215">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2966276">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="2966290">type</span>&nbsp;<span class="ident" id="2966295">Client</span>&nbsp;<span class="keyword" id="2966302">struct</span>&nbsp;<span class="op" id="2966309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966312">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966370">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966398">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2966436">Transport</span>&nbsp;<span class="ident" id="2966446">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966461">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966524">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966584">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966646">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966709">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966772">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966822">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966884">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966913">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966917">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2966982">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967034">CheckRedirect</span>&nbsp;<span class="keyword" id="2967048">func</span><span class="op" id="2967052">(</span><span class="ident" id="2967053">req</span>&nbsp;<span class="op" id="2967057">*</span><span class="ident" id="2967058">Request</span><span class="op" id="2967065">,</span>&nbsp;<span class="ident" id="2967067">via</span>&nbsp;<span class="op" id="2967071">[</span><span class="op" id="2967072">]</span><span class="op" id="2967073">*</span><span class="ident" id="2967074">Request</span><span class="op" id="2967081">)</span>&nbsp;<span class="builtintype" id="2967083">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967091">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967125">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967189">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967207">Jar</span>&nbsp;<span class="ident" id="2967211">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967223">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967284">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967338">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967402">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967459">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967503">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967507">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967547">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967551">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967609">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967673">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2967733">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2967790">Timeout</span>&nbsp;<span class="ident" id="2967798">time</span><span class="op" id="2967802">.</span><span class="ident" id="2967803">Duration</span><br>
<span class="lineno"></span><span class="op" id="2967812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2967815">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="2967890">var</span>&nbsp;<span class="ident" id="2967894">DefaultClient</span>&nbsp;<span class="op" id="2967908">=</span>&nbsp;<span class="op" id="2967910">&amp;</span><span class="ident" id="2967911">Client</span><span class="op" id="2967917">{</span><span class="op" id="2967918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2967921">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2967991">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="2968063">//</span><br>
<span class="lineno">80</span><span class="comment" id="2968066">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="2968128">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="2968143">type</span>&nbsp;<span class="ident" id="2968148">RoundTripper</span>&nbsp;<span class="keyword" id="2968161">interface</span>&nbsp;<span class="op" id="2968171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968174">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968234">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968294">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968349">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968413">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968475">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968536">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968590">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968643">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968675">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968679">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968735">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968796">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2968853">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2968870">RoundTrip</span><span class="op" id="2968879">(</span><span class="op" id="2968880">*</span><span class="ident" id="2968881">Request</span><span class="op" id="2968888">)</span>&nbsp;<span class="op" id="2968890">(</span><span class="op" id="2968891">*</span><span class="ident" id="2968892">Response</span><span class="op" id="2968900">,</span>&nbsp;<span class="builtintype" id="2968902">error</span><span class="op" id="2968907">)</span><br>
<span class="lineno"></span><span class="op" id="2968909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2968912">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2968990">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="2969036">func</span>&nbsp;<span class="ident" id="2969041">hasPort</span><span class="op" id="2969048">(</span><span class="ident" id="2969049">s</span>&nbsp;<span class="builtintype" id="2969051">string</span><span class="op" id="2969057">)</span>&nbsp;<span class="builtintype" id="2969059">bool</span>&nbsp;<span class="op" id="2969064">{</span>&nbsp;<span class="keyword" id="2969066">return</span>&nbsp;<span class="ident" id="2969073">strings</span><span class="op" id="2969080">.</span><span class="ident" id="2969081">LastIndex</span><span class="op" id="2969090">(</span><span class="ident" id="2969091">s</span><span class="op" id="2969092">,</span>&nbsp;<span class="string" id="2969094">&#34;:&#34;</span><span class="op" id="2969097">)</span>&nbsp;<span class="op" id="2969099">&gt;</span>&nbsp;<span class="ident" id="2969101">strings</span><span class="op" id="2969108">.</span><span class="ident" id="2969109">LastIndex</span><span class="op" id="2969118">(</span><span class="ident" id="2969119">s</span><span class="op" id="2969120">,</span>&nbsp;<span class="string" id="2969122">&#34;]&#34;</span><span class="op" id="2969125">)</span>&nbsp;<span class="op" id="2969127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2969130">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="2969200">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="2969273">func</span>&nbsp;<span class="ident" id="2969278">refererForURL</span><span class="op" id="2969291">(</span><span class="ident" id="2969292">lastReq</span><span class="op" id="2969299">,</span>&nbsp;<span class="ident" id="2969301">newReq</span>&nbsp;<span class="op" id="2969308">*</span><span class="ident" id="2969309">url</span><span class="op" id="2969312">.</span><span class="ident" id="2969313">URL</span><span class="op" id="2969316">)</span>&nbsp;<span class="builtintype" id="2969318">string</span>&nbsp;<span class="op" id="2969325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969328">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969382">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969444">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969503">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2969547">if</span>&nbsp;<span class="ident" id="2969550">lastReq</span><span class="op" id="2969557">.</span><span class="ident" id="2969558">Scheme</span>&nbsp;<span class="op" id="2969565">==</span>&nbsp;<span class="string" id="2969568">&#34;https&#34;</span>&nbsp;<span class="op" id="2969576">&amp;&amp;</span>&nbsp;<span class="ident" id="2969579">newReq</span><span class="op" id="2969585">.</span><span class="ident" id="2969586">Scheme</span>&nbsp;<span class="op" id="2969593">==</span>&nbsp;<span class="string" id="2969596">&#34;http&#34;</span>&nbsp;<span class="op" id="2969603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2969607">return</span>&nbsp;<span class="string" id="2969614">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2969618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969621">referer</span>&nbsp;<span class="op" id="2969629">:=</span>&nbsp;<span class="ident" id="2969632">lastReq</span><span class="op" id="2969639">.</span><span class="ident" id="2969640">String</span><span class="op" id="2969646">(</span><span class="op" id="2969647">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2969650">if</span>&nbsp;<span class="ident" id="2969653">lastReq</span><span class="op" id="2969660">.</span><span class="ident" id="2969661">User</span>&nbsp;<span class="op" id="2969666">!=</span>&nbsp;<span class="ident" id="2969669">nil</span>&nbsp;<span class="op" id="2969673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969677">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969733">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969750">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969789">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969822">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2969880">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969922">auth</span>&nbsp;<span class="op" id="2969927">:=</span>&nbsp;<span class="ident" id="2969930">lastReq</span><span class="op" id="2969937">.</span><span class="ident" id="2969938">User</span><span class="op" id="2969942">.</span><span class="ident" id="2969943">String</span><span class="op" id="2969949">(</span><span class="op" id="2969950">)</span>&nbsp;<span class="op" id="2969952">+</span>&nbsp;<span class="string" id="2969954">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2969960">referer</span>&nbsp;<span class="op" id="2969968">=</span>&nbsp;<span class="ident" id="2969970">strings</span><span class="op" id="2969977">.</span><span class="ident" id="2969978">Replace</span><span class="op" id="2969985">(</span><span class="ident" id="2969986">referer</span><span class="op" id="2969993">,</span>&nbsp;<span class="ident" id="2969995">auth</span><span class="op" id="2969999">,</span>&nbsp;<span class="string" id="2970001">&#34;&#34;</span><span class="op" id="2970003">,</span>&nbsp;<span class="num" id="2970005">1</span><span class="op" id="2970006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970009">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970012">return</span>&nbsp;<span class="ident" id="2970019">referer</span><br>
<span class="lineno"></span><span class="op" id="2970027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2970030">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2970098">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="2970169">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="2970192">type</span>&nbsp;<span class="ident" id="2970197">readClose</span>&nbsp;<span class="keyword" id="2970207">struct</span>&nbsp;<span class="op" id="2970214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970217">io</span><span class="op" id="2970219">.</span><span class="ident" id="2970220">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970228">io</span><span class="op" id="2970230">.</span><span class="ident" id="2970231">Closer</span><br>
<span class="lineno"></span><span class="op" id="2970238">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="2970241">func</span>&nbsp;<span class="op" id="2970246">(</span><span class="ident" id="2970247">c</span>&nbsp;<span class="op" id="2970249">*</span><span class="ident" id="2970250">Client</span><span class="op" id="2970256">)</span>&nbsp;<span class="ident" id="2970258">send</span><span class="op" id="2970262">(</span><span class="ident" id="2970263">req</span>&nbsp;<span class="op" id="2970267">*</span><span class="ident" id="2970268">Request</span><span class="op" id="2970275">)</span>&nbsp;<span class="op" id="2970277">(</span><span class="op" id="2970278">*</span><span class="ident" id="2970279">Response</span><span class="op" id="2970287">,</span>&nbsp;<span class="builtintype" id="2970289">error</span><span class="op" id="2970294">)</span>&nbsp;<span class="op" id="2970296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970299">if</span>&nbsp;<span class="ident" id="2970302">c</span><span class="op" id="2970303">.</span><span class="ident" id="2970304">Jar</span>&nbsp;<span class="op" id="2970308">!=</span>&nbsp;<span class="ident" id="2970311">nil</span>&nbsp;<span class="op" id="2970315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970319">for</span>&nbsp;<span class="ident" id="2970323">_</span><span class="op" id="2970324">,</span>&nbsp;<span class="ident" id="2970326">cookie</span>&nbsp;<span class="op" id="2970333">:=</span>&nbsp;<span class="keyword" id="2970336">range</span>&nbsp;<span class="ident" id="2970342">c</span><span class="op" id="2970343">.</span><span class="ident" id="2970344">Jar</span><span class="op" id="2970347">.</span><span class="ident" id="2970348">Cookies</span><span class="op" id="2970355">(</span><span class="ident" id="2970356">req</span><span class="op" id="2970359">.</span><span class="ident" id="2970360">URL</span><span class="op" id="2970363">)</span>&nbsp;<span class="op" id="2970365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970370">req</span><span class="op" id="2970373">.</span><span class="ident" id="2970374">AddCookie</span><span class="op" id="2970383">(</span><span class="ident" id="2970384">cookie</span><span class="op" id="2970390">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970400">resp</span><span class="op" id="2970404">,</span>&nbsp;<span class="ident" id="2970406">err</span>&nbsp;<span class="op" id="2970410">:=</span>&nbsp;<span class="ident" id="2970413">send</span><span class="op" id="2970417">(</span><span class="ident" id="2970418">req</span><span class="op" id="2970421">,</span>&nbsp;<span class="ident" id="2970423">c</span><span class="op" id="2970424">.</span><span class="ident" id="2970425">transport</span><span class="op" id="2970434">(</span><span class="op" id="2970435">)</span><span class="op" id="2970436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970439">if</span>&nbsp;<span class="ident" id="2970442">err</span>&nbsp;<span class="op" id="2970446">!=</span>&nbsp;<span class="ident" id="2970449">nil</span>&nbsp;<span class="op" id="2970453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970457">return</span>&nbsp;<span class="ident" id="2970464">nil</span><span class="op" id="2970467">,</span>&nbsp;<span class="ident" id="2970469">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970477">if</span>&nbsp;<span class="ident" id="2970480">c</span><span class="op" id="2970481">.</span><span class="ident" id="2970482">Jar</span>&nbsp;<span class="op" id="2970486">!=</span>&nbsp;<span class="ident" id="2970489">nil</span>&nbsp;<span class="op" id="2970493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970497">if</span>&nbsp;<span class="ident" id="2970500">rc</span>&nbsp;<span class="op" id="2970503">:=</span>&nbsp;<span class="ident" id="2970506">resp</span><span class="op" id="2970510">.</span><span class="ident" id="2970511">Cookies</span><span class="op" id="2970518">(</span><span class="op" id="2970519">)</span><span class="op" id="2970520">;</span>&nbsp;<span class="builtinfunc" id="2970522">len</span><span class="op" id="2970525">(</span><span class="ident" id="2970526">rc</span><span class="op" id="2970528">)</span>&nbsp;<span class="op" id="2970530">&gt;</span>&nbsp;<span class="num" id="2970532">0</span>&nbsp;<span class="op" id="2970534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2970539">c</span><span class="op" id="2970540">.</span><span class="ident" id="2970541">Jar</span><span class="op" id="2970544">.</span><span class="ident" id="2970545">SetCookies</span><span class="op" id="2970555">(</span><span class="ident" id="2970556">req</span><span class="op" id="2970559">.</span><span class="ident" id="2970560">URL</span><span class="op" id="2970563">,</span>&nbsp;<span class="ident" id="2970565">rc</span><span class="op" id="2970567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970571">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2970574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2970577">return</span>&nbsp;<span class="ident" id="2970584">resp</span><span class="op" id="2970588">,</span>&nbsp;<span class="ident" id="2970590">err</span><br>
<span class="lineno"></span><span class="op" id="2970594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2970597">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="2970665">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="2970736">//</span><br>
<span class="lineno"></span><span class="comment" id="2970739">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="2970799">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2970858">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="2970904">//</span><br>
<span class="lineno"></span><span class="comment" id="2970907">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2970969">//</span><br>
<span class="lineno"></span><span class="comment" id="2970972">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2971036">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="2971101">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="2971169">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="2971236">//</span><br>
<span class="lineno"></span><span class="comment" id="2971239">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="2971305">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="2971335">//</span><br>
<span class="lineno"></span><span class="comment" id="2971338">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="2971402">func</span>&nbsp;<span class="op" id="2971407">(</span><span class="ident" id="2971408">c</span>&nbsp;<span class="op" id="2971410">*</span><span class="ident" id="2971411">Client</span><span class="op" id="2971417">)</span>&nbsp;<span class="ident" id="2971419">Do</span><span class="op" id="2971421">(</span><span class="ident" id="2971422">req</span>&nbsp;<span class="op" id="2971426">*</span><span class="ident" id="2971427">Request</span><span class="op" id="2971434">)</span>&nbsp;<span class="op" id="2971436">(</span><span class="ident" id="2971437">resp</span>&nbsp;<span class="op" id="2971442">*</span><span class="ident" id="2971443">Response</span><span class="op" id="2971451">,</span>&nbsp;<span class="ident" id="2971453">err</span>&nbsp;<span class="builtintype" id="2971457">error</span><span class="op" id="2971462">)</span>&nbsp;<span class="op" id="2971464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971467">if</span>&nbsp;<span class="ident" id="2971470">req</span><span class="op" id="2971473">.</span><span class="ident" id="2971474">Method</span>&nbsp;<span class="op" id="2971481">==</span>&nbsp;<span class="string" id="2971484">&#34;GET&#34;</span>&nbsp;<span class="op" id="2971490">||</span>&nbsp;<span class="ident" id="2971493">req</span><span class="op" id="2971496">.</span><span class="ident" id="2971497">Method</span>&nbsp;<span class="op" id="2971504">==</span>&nbsp;<span class="string" id="2971507">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="2971514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971518">return</span>&nbsp;<span class="ident" id="2971525">c</span><span class="op" id="2971526">.</span><span class="ident" id="2971527">doFollowingRedirects</span><span class="op" id="2971547">(</span><span class="ident" id="2971548">req</span><span class="op" id="2971551">,</span>&nbsp;<span class="ident" id="2971553">shouldRedirectGet</span><span class="op" id="2971570">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971576">if</span>&nbsp;<span class="ident" id="2971579">req</span><span class="op" id="2971582">.</span><span class="ident" id="2971583">Method</span>&nbsp;<span class="op" id="2971590">==</span>&nbsp;<span class="string" id="2971593">&#34;POST&#34;</span>&nbsp;<span class="op" id="2971600">||</span>&nbsp;<span class="ident" id="2971603">req</span><span class="op" id="2971606">.</span><span class="ident" id="2971607">Method</span>&nbsp;<span class="op" id="2971614">==</span>&nbsp;<span class="string" id="2971617">&#34;PUT&#34;</span>&nbsp;<span class="op" id="2971623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971627">return</span>&nbsp;<span class="ident" id="2971634">c</span><span class="op" id="2971635">.</span><span class="ident" id="2971636">doFollowingRedirects</span><span class="op" id="2971656">(</span><span class="ident" id="2971657">req</span><span class="op" id="2971660">,</span>&nbsp;<span class="ident" id="2971662">shouldRedirectPost</span><span class="op" id="2971680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971686">return</span>&nbsp;<span class="ident" id="2971693">c</span><span class="op" id="2971694">.</span><span class="ident" id="2971695">send</span><span class="op" id="2971699">(</span><span class="ident" id="2971700">req</span><span class="op" id="2971703">)</span><br>
<span class="lineno">180</span><span class="op" id="2971705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2971708">func</span>&nbsp;<span class="op" id="2971713">(</span><span class="ident" id="2971714">c</span>&nbsp;<span class="op" id="2971716">*</span><span class="ident" id="2971717">Client</span><span class="op" id="2971723">)</span>&nbsp;<span class="ident" id="2971725">transport</span><span class="op" id="2971734">(</span><span class="op" id="2971735">)</span>&nbsp;<span class="ident" id="2971737">RoundTripper</span>&nbsp;<span class="op" id="2971750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971753">if</span>&nbsp;<span class="ident" id="2971756">c</span><span class="op" id="2971757">.</span><span class="ident" id="2971758">Transport</span>&nbsp;<span class="op" id="2971768">!=</span>&nbsp;<span class="ident" id="2971771">nil</span>&nbsp;<span class="op" id="2971775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971779">return</span>&nbsp;<span class="ident" id="2971786">c</span><span class="op" id="2971787">.</span><span class="ident" id="2971788">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2971799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971802">return</span>&nbsp;<span class="ident" id="2971809">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="2971826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2971829">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="2971861">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="2971921">func</span>&nbsp;<span class="ident" id="2971926">send</span><span class="op" id="2971930">(</span><span class="ident" id="2971931">req</span>&nbsp;<span class="op" id="2971935">*</span><span class="ident" id="2971936">Request</span><span class="op" id="2971943">,</span>&nbsp;<span class="ident" id="2971945">t</span>&nbsp;<span class="ident" id="2971947">RoundTripper</span><span class="op" id="2971959">)</span>&nbsp;<span class="op" id="2971961">(</span><span class="ident" id="2971962">resp</span>&nbsp;<span class="op" id="2971967">*</span><span class="ident" id="2971968">Response</span><span class="op" id="2971976">,</span>&nbsp;<span class="ident" id="2971978">err</span>&nbsp;<span class="builtintype" id="2971982">error</span><span class="op" id="2971987">)</span>&nbsp;<span class="op" id="2971989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2971992">if</span>&nbsp;<span class="ident" id="2971995">t</span>&nbsp;<span class="op" id="2971997">==</span>&nbsp;<span class="ident" id="2972000">nil</span>&nbsp;<span class="op" id="2972004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972008">req</span><span class="op" id="2972011">.</span><span class="ident" id="2972012">closeBody</span><span class="op" id="2972021">(</span><span class="op" id="2972022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972026">return</span>&nbsp;<span class="ident" id="2972033">nil</span><span class="op" id="2972036">,</span>&nbsp;<span class="ident" id="2972038">errors</span><span class="op" id="2972044">.</span><span class="ident" id="2972045">New</span><span class="op" id="2972048">(</span><span class="string" id="2972049">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="2972096">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972103">if</span>&nbsp;<span class="ident" id="2972106">req</span><span class="op" id="2972109">.</span><span class="ident" id="2972110">URL</span>&nbsp;<span class="op" id="2972114">==</span>&nbsp;<span class="ident" id="2972117">nil</span>&nbsp;<span class="op" id="2972121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972125">req</span><span class="op" id="2972128">.</span><span class="ident" id="2972129">closeBody</span><span class="op" id="2972138">(</span><span class="op" id="2972139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972143">return</span>&nbsp;<span class="ident" id="2972150">nil</span><span class="op" id="2972153">,</span>&nbsp;<span class="ident" id="2972155">errors</span><span class="op" id="2972161">.</span><span class="ident" id="2972162">New</span><span class="op" id="2972165">(</span><span class="string" id="2972166">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="2972189">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972196">if</span>&nbsp;<span class="ident" id="2972199">req</span><span class="op" id="2972202">.</span><span class="ident" id="2972203">RequestURI</span>&nbsp;<span class="op" id="2972214">!=</span>&nbsp;<span class="string" id="2972217">&#34;&#34;</span>&nbsp;<span class="op" id="2972220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972224">req</span><span class="op" id="2972227">.</span><span class="ident" id="2972228">closeBody</span><span class="op" id="2972237">(</span><span class="op" id="2972238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972242">return</span>&nbsp;<span class="ident" id="2972249">nil</span><span class="op" id="2972252">,</span>&nbsp;<span class="ident" id="2972254">errors</span><span class="op" id="2972260">.</span><span class="ident" id="2972261">New</span><span class="op" id="2972264">(</span><span class="string" id="2972265">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="2972324">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2972331">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2972390">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2972450">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972504">if</span>&nbsp;<span class="ident" id="2972507">req</span><span class="op" id="2972510">.</span><span class="ident" id="2972511">Header</span>&nbsp;<span class="op" id="2972518">==</span>&nbsp;<span class="ident" id="2972521">nil</span>&nbsp;<span class="op" id="2972525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972529">req</span><span class="op" id="2972532">.</span><span class="ident" id="2972533">Header</span>&nbsp;<span class="op" id="2972540">=</span>&nbsp;<span class="builtinfunc" id="2972542">make</span><span class="op" id="2972546">(</span><span class="ident" id="2972547">Header</span><span class="op" id="2972553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972560">if</span>&nbsp;<span class="ident" id="2972563">u</span>&nbsp;<span class="op" id="2972565">:=</span>&nbsp;<span class="ident" id="2972568">req</span><span class="op" id="2972571">.</span><span class="ident" id="2972572">URL</span><span class="op" id="2972575">.</span><span class="ident" id="2972576">User</span><span class="op" id="2972580">;</span>&nbsp;<span class="ident" id="2972582">u</span>&nbsp;<span class="op" id="2972584">!=</span>&nbsp;<span class="ident" id="2972587">nil</span>&nbsp;<span class="op" id="2972591">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972595">username</span>&nbsp;<span class="op" id="2972604">:=</span>&nbsp;<span class="ident" id="2972607">u</span><span class="op" id="2972608">.</span><span class="ident" id="2972609">Username</span><span class="op" id="2972617">(</span><span class="op" id="2972618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972622">password</span><span class="op" id="2972630">,</span>&nbsp;<span class="ident" id="2972632">_</span>&nbsp;<span class="op" id="2972634">:=</span>&nbsp;<span class="ident" id="2972637">u</span><span class="op" id="2972638">.</span><span class="ident" id="2972639">Password</span><span class="op" id="2972647">(</span><span class="op" id="2972648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972652">req</span><span class="op" id="2972655">.</span><span class="ident" id="2972656">Header</span><span class="op" id="2972662">.</span><span class="ident" id="2972663">Set</span><span class="op" id="2972666">(</span><span class="string" id="2972667">&#34;Authorization&#34;</span><span class="op" id="2972682">,</span>&nbsp;<span class="string" id="2972684">&#34;Basic&nbsp;&#34;</span><span class="op" id="2972692">+</span><span class="ident" id="2972693">basicAuth</span><span class="op" id="2972702">(</span><span class="ident" id="2972703">username</span><span class="op" id="2972711">,</span>&nbsp;<span class="ident" id="2972713">password</span><span class="op" id="2972721">)</span><span class="op" id="2972722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972728">resp</span><span class="op" id="2972732">,</span>&nbsp;<span class="ident" id="2972734">err</span>&nbsp;<span class="op" id="2972738">=</span>&nbsp;<span class="ident" id="2972740">t</span><span class="op" id="2972741">.</span><span class="ident" id="2972742">RoundTrip</span><span class="op" id="2972751">(</span><span class="ident" id="2972752">req</span><span class="op" id="2972755">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972758">if</span>&nbsp;<span class="ident" id="2972761">err</span>&nbsp;<span class="op" id="2972765">!=</span>&nbsp;<span class="ident" id="2972768">nil</span>&nbsp;<span class="op" id="2972772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972776">if</span>&nbsp;<span class="ident" id="2972779">resp</span>&nbsp;<span class="op" id="2972784">!=</span>&nbsp;<span class="ident" id="2972787">nil</span>&nbsp;<span class="op" id="2972791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2972796">log</span><span class="op" id="2972799">.</span><span class="ident" id="2972800">Printf</span><span class="op" id="2972806">(</span><span class="string" id="2972807">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="2972868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972876">return</span>&nbsp;<span class="ident" id="2972883">nil</span><span class="op" id="2972886">,</span>&nbsp;<span class="ident" id="2972888">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2972893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2972896">return</span>&nbsp;<span class="ident" id="2972903">resp</span><span class="op" id="2972907">,</span>&nbsp;<span class="ident" id="2972909">nil</span><br>
<span class="lineno"></span><span class="op" id="2972913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2972916">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="2972977">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="2973049">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="2973113">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2973152">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="2973189">func</span>&nbsp;<span class="ident" id="2973194">basicAuth</span><span class="op" id="2973203">(</span><span class="ident" id="2973204">username</span><span class="op" id="2973212">,</span>&nbsp;<span class="ident" id="2973214">password</span>&nbsp;<span class="builtintype" id="2973223">string</span><span class="op" id="2973229">)</span>&nbsp;<span class="builtintype" id="2973231">string</span>&nbsp;<span class="op" id="2973238">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2973241">auth</span>&nbsp;<span class="op" id="2973246">:=</span>&nbsp;<span class="ident" id="2973249">username</span>&nbsp;<span class="op" id="2973258">+</span>&nbsp;<span class="string" id="2973260">&#34;:&#34;</span>&nbsp;<span class="op" id="2973264">+</span>&nbsp;<span class="ident" id="2973266">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973276">return</span>&nbsp;<span class="ident" id="2973283">base64</span><span class="op" id="2973289">.</span><span class="ident" id="2973290">StdEncoding</span><span class="op" id="2973301">.</span><span class="ident" id="2973302">EncodeToString</span><span class="op" id="2973316">(</span><span class="op" id="2973317">[</span><span class="op" id="2973318">]</span><span class="builtintype" id="2973319">byte</span><span class="op" id="2973323">(</span><span class="ident" id="2973324">auth</span><span class="op" id="2973328">)</span><span class="op" id="2973329">)</span><br>
<span class="lineno"></span><span class="op" id="2973331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2973334">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="2973416">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="2973443">func</span>&nbsp;<span class="ident" id="2973448">shouldRedirectGet</span><span class="op" id="2973465">(</span><span class="ident" id="2973466">statusCode</span>&nbsp;<span class="builtintype" id="2973477">int</span><span class="op" id="2973480">)</span>&nbsp;<span class="builtintype" id="2973482">bool</span>&nbsp;<span class="op" id="2973487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973490">switch</span>&nbsp;<span class="ident" id="2973497">statusCode</span>&nbsp;<span class="op" id="2973508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973511">case</span>&nbsp;<span class="ident" id="2973516">StatusMovedPermanently</span><span class="op" id="2973538">,</span>&nbsp;<span class="ident" id="2973540">StatusFound</span><span class="op" id="2973551">,</span>&nbsp;<span class="ident" id="2973553">StatusSeeOther</span><span class="op" id="2973567">,</span>&nbsp;<span class="ident" id="2973569">StatusTemporaryRedirect</span><span class="op" id="2973592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973596">return</span>&nbsp;<span class="builtintype" id="2973603">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973612">return</span>&nbsp;<span class="builtintype" id="2973619">false</span><br>
<span class="lineno"></span><span class="op" id="2973625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2973628">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="2973711">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="2973738">func</span>&nbsp;<span class="ident" id="2973743">shouldRedirectPost</span><span class="op" id="2973761">(</span><span class="ident" id="2973762">statusCode</span>&nbsp;<span class="builtintype" id="2973773">int</span><span class="op" id="2973776">)</span>&nbsp;<span class="builtintype" id="2973778">bool</span>&nbsp;<span class="op" id="2973783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973786">switch</span>&nbsp;<span class="ident" id="2973793">statusCode</span>&nbsp;<span class="op" id="2973804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973807">case</span>&nbsp;<span class="ident" id="2973812">StatusFound</span><span class="op" id="2973823">,</span>&nbsp;<span class="ident" id="2973825">StatusSeeOther</span><span class="op" id="2973839">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973843">return</span>&nbsp;<span class="builtintype" id="2973850">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2973856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2973859">return</span>&nbsp;<span class="builtintype" id="2973866">false</span><br>
<span class="lineno"></span><span class="op" id="2973872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2973875">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="2973958">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="2974036">//</span><br>
<span class="lineno"></span><span class="comment" id="2974039">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2974069">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="2974087">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="2974109">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="2974140">//</span><br>
<span class="lineno"></span><span class="comment" id="2974143">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="2974212">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2974279">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="2974289">//</span><br>
<span class="lineno"></span><span class="comment" id="2974292">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2974354">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2974414">//</span><br>
<span class="lineno"></span><span class="comment" id="2974417">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="2974463">func</span>&nbsp;<span class="ident" id="2974468">Get</span><span class="op" id="2974471">(</span><span class="ident" id="2974472">url</span>&nbsp;<span class="builtintype" id="2974476">string</span><span class="op" id="2974482">)</span>&nbsp;<span class="op" id="2974484">(</span><span class="ident" id="2974485">resp</span>&nbsp;<span class="op" id="2974490">*</span><span class="ident" id="2974491">Response</span><span class="op" id="2974499">,</span>&nbsp;<span class="ident" id="2974501">err</span>&nbsp;<span class="builtintype" id="2974505">error</span><span class="op" id="2974510">)</span>&nbsp;<span class="op" id="2974512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2974515">return</span>&nbsp;<span class="ident" id="2974522">DefaultClient</span><span class="op" id="2974535">.</span><span class="ident" id="2974536">Get</span><span class="op" id="2974539">(</span><span class="ident" id="2974540">url</span><span class="op" id="2974543">)</span><br>
<span class="lineno"></span><span class="op" id="2974545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2974548">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="2974621">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2974693">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2974729">//</span><br>
<span class="lineno"></span><span class="comment" id="2974732">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2974762">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="2974780">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="2974802">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="2974833">//</span><br>
<span class="lineno"></span><span class="comment" id="2974836">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="2974905">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="2974975">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2974994">//</span><br>
<span class="lineno"></span><span class="comment" id="2974997">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2975059">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="2975119">func</span>&nbsp;<span class="op" id="2975124">(</span><span class="ident" id="2975125">c</span>&nbsp;<span class="op" id="2975127">*</span><span class="ident" id="2975128">Client</span><span class="op" id="2975134">)</span>&nbsp;<span class="ident" id="2975136">Get</span><span class="op" id="2975139">(</span><span class="ident" id="2975140">url</span>&nbsp;<span class="builtintype" id="2975144">string</span><span class="op" id="2975150">)</span>&nbsp;<span class="op" id="2975152">(</span><span class="ident" id="2975153">resp</span>&nbsp;<span class="op" id="2975158">*</span><span class="ident" id="2975159">Response</span><span class="op" id="2975167">,</span>&nbsp;<span class="ident" id="2975169">err</span>&nbsp;<span class="builtintype" id="2975173">error</span><span class="op" id="2975178">)</span>&nbsp;<span class="op" id="2975180">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975183">req</span><span class="op" id="2975186">,</span>&nbsp;<span class="ident" id="2975188">err</span>&nbsp;<span class="op" id="2975192">:=</span>&nbsp;<span class="ident" id="2975195">NewRequest</span><span class="op" id="2975205">(</span><span class="string" id="2975206">&#34;GET&#34;</span><span class="op" id="2975211">,</span>&nbsp;<span class="ident" id="2975213">url</span><span class="op" id="2975216">,</span>&nbsp;<span class="ident" id="2975218">nil</span><span class="op" id="2975221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975224">if</span>&nbsp;<span class="ident" id="2975227">err</span>&nbsp;<span class="op" id="2975231">!=</span>&nbsp;<span class="ident" id="2975234">nil</span>&nbsp;<span class="op" id="2975238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975242">return</span>&nbsp;<span class="ident" id="2975249">nil</span><span class="op" id="2975252">,</span>&nbsp;<span class="ident" id="2975254">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975262">return</span>&nbsp;<span class="ident" id="2975269">c</span><span class="op" id="2975270">.</span><span class="ident" id="2975271">doFollowingRedirects</span><span class="op" id="2975291">(</span><span class="ident" id="2975292">req</span><span class="op" id="2975295">,</span>&nbsp;<span class="ident" id="2975297">shouldRedirectGet</span><span class="op" id="2975314">)</span><br>
<span class="lineno">300</span><span class="op" id="2975316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2975319">func</span>&nbsp;<span class="op" id="2975324">(</span><span class="ident" id="2975325">c</span>&nbsp;<span class="op" id="2975327">*</span><span class="ident" id="2975328">Client</span><span class="op" id="2975334">)</span>&nbsp;<span class="ident" id="2975336">doFollowingRedirects</span><span class="op" id="2975356">(</span><span class="ident" id="2975357">ireq</span>&nbsp;<span class="op" id="2975362">*</span><span class="ident" id="2975363">Request</span><span class="op" id="2975370">,</span>&nbsp;<span class="ident" id="2975372">shouldRedirect</span>&nbsp;<span class="keyword" id="2975387">func</span><span class="op" id="2975391">(</span><span class="builtintype" id="2975392">int</span><span class="op" id="2975395">)</span>&nbsp;<span class="builtintype" id="2975397">bool</span><span class="op" id="2975401">)</span>&nbsp;<span class="op" id="2975403">(</span><span class="ident" id="2975404">resp</span>&nbsp;<span class="op" id="2975409">*</span><span class="ident" id="2975410">Response</span><span class="op" id="2975418">,</span>&nbsp;<span class="ident" id="2975420">err</span>&nbsp;<span class="builtintype" id="2975424">error</span><span class="op" id="2975429">)</span>&nbsp;<span class="op" id="2975431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975434">var</span>&nbsp;<span class="ident" id="2975438">base</span>&nbsp;<span class="op" id="2975443">*</span><span class="ident" id="2975444">url</span><span class="op" id="2975447">.</span><span class="ident" id="2975448">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975453">redirectChecker</span>&nbsp;<span class="op" id="2975469">:=</span>&nbsp;<span class="ident" id="2975472">c</span><span class="op" id="2975473">.</span><span class="ident" id="2975474">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975489">if</span>&nbsp;<span class="ident" id="2975492">redirectChecker</span>&nbsp;<span class="op" id="2975508">==</span>&nbsp;<span class="ident" id="2975511">nil</span>&nbsp;<span class="op" id="2975515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975519">redirectChecker</span>&nbsp;<span class="op" id="2975535">=</span>&nbsp;<span class="ident" id="2975537">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975562">var</span>&nbsp;<span class="ident" id="2975566">via</span>&nbsp;<span class="op" id="2975570">[</span><span class="op" id="2975571">]</span><span class="op" id="2975572">*</span><span class="ident" id="2975573">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975583">if</span>&nbsp;<span class="ident" id="2975586">ireq</span><span class="op" id="2975590">.</span><span class="ident" id="2975591">URL</span>&nbsp;<span class="op" id="2975595">==</span>&nbsp;<span class="ident" id="2975598">nil</span>&nbsp;<span class="op" id="2975602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975606">ireq</span><span class="op" id="2975610">.</span><span class="ident" id="2975611">closeBody</span><span class="op" id="2975620">(</span><span class="op" id="2975621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975625">return</span>&nbsp;<span class="ident" id="2975632">nil</span><span class="op" id="2975635">,</span>&nbsp;<span class="ident" id="2975637">errors</span><span class="op" id="2975643">.</span><span class="ident" id="2975644">New</span><span class="op" id="2975647">(</span><span class="string" id="2975648">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="2975671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975678">var</span>&nbsp;<span class="ident" id="2975682">reqmu</span>&nbsp;<span class="ident" id="2975688">sync</span><span class="op" id="2975692">.</span><span class="ident" id="2975693">Mutex</span>&nbsp;<span class="comment" id="2975699">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975714">req</span>&nbsp;<span class="op" id="2975718">:=</span>&nbsp;<span class="ident" id="2975721">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975728">var</span>&nbsp;<span class="ident" id="2975732">timer</span>&nbsp;<span class="op" id="2975738">*</span><span class="ident" id="2975739">time</span><span class="op" id="2975743">.</span><span class="ident" id="2975744">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975751">if</span>&nbsp;<span class="ident" id="2975754">c</span><span class="op" id="2975755">.</span><span class="ident" id="2975756">Timeout</span>&nbsp;<span class="op" id="2975764">&gt;</span>&nbsp;<span class="num" id="2975766">0</span>&nbsp;<span class="op" id="2975768">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975772">type</span>&nbsp;<span class="ident" id="2975777">canceler</span>&nbsp;<span class="keyword" id="2975786">interface</span>&nbsp;<span class="op" id="2975796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975801">CancelRequest</span><span class="op" id="2975814">(</span><span class="op" id="2975815">*</span><span class="ident" id="2975816">Request</span><span class="op" id="2975823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2975827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2975831">tr</span><span class="op" id="2975833">,</span>&nbsp;<span class="ident" id="2975835">ok</span>&nbsp;<span class="op" id="2975838">:=</span>&nbsp;<span class="ident" id="2975841">c</span><span class="op" id="2975842">.</span><span class="ident" id="2975843">transport</span><span class="op" id="2975852">(</span><span class="op" id="2975853">)</span><span class="op" id="2975854">.</span><span class="op" id="2975855">(</span><span class="ident" id="2975856">canceler</span><span class="op" id="2975864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975868">if</span>&nbsp;<span class="op" id="2975871">!</span><span class="ident" id="2975872">ok</span>&nbsp;<span class="op" id="2975875">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2975880">return</span>&nbsp;<span class="ident" id="2975887">nil</span><span class="op" id="2975890">,</span>&nbsp;<span class="ident" id="2975892">fmt</span><span class="op" id="2975895">.</span><span class="ident" id="2975896">Errorf</span><span class="op" id="2975902">(</span><span class="string" id="2975903">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="2975995">,</span>&nbsp;<span class="ident" id="2975997">c</span><span class="op" id="2975998">.</span><span class="ident" id="2975999">transport</span><span class="op" id="2976008">(</span><span class="op" id="2976009">)</span><span class="op" id="2976010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976018">timer</span>&nbsp;<span class="op" id="2976024">=</span>&nbsp;<span class="ident" id="2976026">time</span><span class="op" id="2976030">.</span><span class="ident" id="2976031">AfterFunc</span><span class="op" id="2976040">(</span><span class="ident" id="2976041">c</span><span class="op" id="2976042">.</span><span class="ident" id="2976043">Timeout</span><span class="op" id="2976050">,</span>&nbsp;<span class="keyword" id="2976052">func</span><span class="op" id="2976056">(</span><span class="op" id="2976057">)</span>&nbsp;<span class="op" id="2976059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976064">reqmu</span><span class="op" id="2976069">.</span><span class="ident" id="2976070">Lock</span><span class="op" id="2976074">(</span><span class="op" id="2976075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976080">defer</span>&nbsp;<span class="ident" id="2976086">reqmu</span><span class="op" id="2976091">.</span><span class="ident" id="2976092">Unlock</span><span class="op" id="2976098">(</span><span class="op" id="2976099">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976104">tr</span><span class="op" id="2976106">.</span><span class="ident" id="2976107">CancelRequest</span><span class="op" id="2976120">(</span><span class="ident" id="2976121">req</span><span class="op" id="2976124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976128">}</span><span class="op" id="2976129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976136">urlStr</span>&nbsp;<span class="op" id="2976143">:=</span>&nbsp;<span class="string" id="2976146">&#34;&#34;</span>&nbsp;<span class="comment" id="2976149">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976214">redirectFailed</span>&nbsp;<span class="op" id="2976229">:=</span>&nbsp;<span class="builtintype" id="2976232">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976239">for</span>&nbsp;<span class="ident" id="2976243">redirect</span>&nbsp;<span class="op" id="2976252">:=</span>&nbsp;<span class="num" id="2976255">0</span><span class="op" id="2976256">;</span>&nbsp;<span class="op" id="2976258">;</span>&nbsp;<span class="ident" id="2976260">redirect</span><span class="op" id="2976268">++</span>&nbsp;<span class="op" id="2976271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976275">if</span>&nbsp;<span class="ident" id="2976278">redirect</span>&nbsp;<span class="op" id="2976287">!=</span>&nbsp;<span class="num" id="2976290">0</span>&nbsp;<span class="op" id="2976292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976297">nreq</span>&nbsp;<span class="op" id="2976302">:=</span>&nbsp;<span class="builtinfunc" id="2976305">new</span><span class="op" id="2976308">(</span><span class="ident" id="2976309">Request</span><span class="op" id="2976316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976321">nreq</span><span class="op" id="2976325">.</span><span class="ident" id="2976326">Method</span>&nbsp;<span class="op" id="2976333">=</span>&nbsp;<span class="ident" id="2976335">ireq</span><span class="op" id="2976339">.</span><span class="ident" id="2976340">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976350">if</span>&nbsp;<span class="ident" id="2976353">ireq</span><span class="op" id="2976357">.</span><span class="ident" id="2976358">Method</span>&nbsp;<span class="op" id="2976365">==</span>&nbsp;<span class="string" id="2976368">&#34;POST&#34;</span>&nbsp;<span class="op" id="2976375">||</span>&nbsp;<span class="ident" id="2976378">ireq</span><span class="op" id="2976382">.</span><span class="ident" id="2976383">Method</span>&nbsp;<span class="op" id="2976390">==</span>&nbsp;<span class="string" id="2976393">&#34;PUT&#34;</span>&nbsp;<span class="op" id="2976399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976405">nreq</span><span class="op" id="2976409">.</span><span class="ident" id="2976410">Method</span>&nbsp;<span class="op" id="2976417">=</span>&nbsp;<span class="string" id="2976419">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976433">nreq</span><span class="op" id="2976437">.</span><span class="ident" id="2976438">Header</span>&nbsp;<span class="op" id="2976445">=</span>&nbsp;<span class="builtinfunc" id="2976447">make</span><span class="op" id="2976451">(</span><span class="ident" id="2976452">Header</span><span class="op" id="2976458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976463">nreq</span><span class="op" id="2976467">.</span><span class="ident" id="2976468">URL</span><span class="op" id="2976471">,</span>&nbsp;<span class="ident" id="2976473">err</span>&nbsp;<span class="op" id="2976477">=</span>&nbsp;<span class="ident" id="2976479">base</span><span class="op" id="2976483">.</span><span class="ident" id="2976484">Parse</span><span class="op" id="2976489">(</span><span class="ident" id="2976490">urlStr</span><span class="op" id="2976496">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976501">if</span>&nbsp;<span class="ident" id="2976504">err</span>&nbsp;<span class="op" id="2976508">!=</span>&nbsp;<span class="ident" id="2976511">nil</span>&nbsp;<span class="op" id="2976515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976521">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976535">if</span>&nbsp;<span class="builtinfunc" id="2976538">len</span><span class="op" id="2976541">(</span><span class="ident" id="2976542">via</span><span class="op" id="2976545">)</span>&nbsp;<span class="op" id="2976547">&gt;</span>&nbsp;<span class="num" id="2976549">0</span>&nbsp;<span class="op" id="2976551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2976557">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976588">lastReq</span>&nbsp;<span class="op" id="2976596">:=</span>&nbsp;<span class="ident" id="2976599">via</span><span class="op" id="2976602">[</span><span class="builtinfunc" id="2976603">len</span><span class="op" id="2976606">(</span><span class="ident" id="2976607">via</span><span class="op" id="2976610">)</span><span class="op" id="2976611">-</span><span class="num" id="2976612">1</span><span class="op" id="2976613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976619">if</span>&nbsp;<span class="ident" id="2976622">ref</span>&nbsp;<span class="op" id="2976626">:=</span>&nbsp;<span class="ident" id="2976629">refererForURL</span><span class="op" id="2976642">(</span><span class="ident" id="2976643">lastReq</span><span class="op" id="2976650">.</span><span class="ident" id="2976651">URL</span><span class="op" id="2976654">,</span>&nbsp;<span class="ident" id="2976656">nreq</span><span class="op" id="2976660">.</span><span class="ident" id="2976661">URL</span><span class="op" id="2976664">)</span><span class="op" id="2976665">;</span>&nbsp;<span class="ident" id="2976667">ref</span>&nbsp;<span class="op" id="2976671">!=</span>&nbsp;<span class="string" id="2976674">&#34;&#34;</span>&nbsp;<span class="op" id="2976677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976684">nreq</span><span class="op" id="2976688">.</span><span class="ident" id="2976689">Header</span><span class="op" id="2976695">.</span><span class="ident" id="2976696">Set</span><span class="op" id="2976699">(</span><span class="string" id="2976700">&#34;Referer&#34;</span><span class="op" id="2976709">,</span>&nbsp;<span class="ident" id="2976711">ref</span><span class="op" id="2976714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976727">err</span>&nbsp;<span class="op" id="2976731">=</span>&nbsp;<span class="ident" id="2976733">redirectChecker</span><span class="op" id="2976748">(</span><span class="ident" id="2976749">nreq</span><span class="op" id="2976753">,</span>&nbsp;<span class="ident" id="2976755">via</span><span class="op" id="2976758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976764">if</span>&nbsp;<span class="ident" id="2976767">err</span>&nbsp;<span class="op" id="2976771">!=</span>&nbsp;<span class="ident" id="2976774">nil</span>&nbsp;<span class="op" id="2976778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976785">redirectFailed</span>&nbsp;<span class="op" id="2976800">=</span>&nbsp;<span class="builtintype" id="2976802">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976812">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976822">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976832">reqmu</span><span class="op" id="2976837">.</span><span class="ident" id="2976838">Lock</span><span class="op" id="2976842">(</span><span class="op" id="2976843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976848">req</span>&nbsp;<span class="op" id="2976852">=</span>&nbsp;<span class="ident" id="2976854">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976862">reqmu</span><span class="op" id="2976867">.</span><span class="ident" id="2976868">Unlock</span><span class="op" id="2976874">(</span><span class="op" id="2976875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976879">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2976884">urlStr</span>&nbsp;<span class="op" id="2976891">=</span>&nbsp;<span class="ident" id="2976893">req</span><span class="op" id="2976896">.</span><span class="ident" id="2976897">URL</span><span class="op" id="2976900">.</span><span class="ident" id="2976901">String</span><span class="op" id="2976907">(</span><span class="op" id="2976908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976912">if</span>&nbsp;<span class="ident" id="2976915">resp</span><span class="op" id="2976919">,</span>&nbsp;<span class="ident" id="2976921">err</span>&nbsp;<span class="op" id="2976925">=</span>&nbsp;<span class="ident" id="2976927">c</span><span class="op" id="2976928">.</span><span class="ident" id="2976929">send</span><span class="op" id="2976933">(</span><span class="ident" id="2976934">req</span><span class="op" id="2976937">)</span><span class="op" id="2976938">;</span>&nbsp;<span class="ident" id="2976940">err</span>&nbsp;<span class="op" id="2976944">!=</span>&nbsp;<span class="ident" id="2976947">nil</span>&nbsp;<span class="op" id="2976951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976956">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2976964">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2976969">if</span>&nbsp;<span class="ident" id="2976972">shouldRedirect</span><span class="op" id="2976986">(</span><span class="ident" id="2976987">resp</span><span class="op" id="2976991">.</span><span class="ident" id="2976992">StatusCode</span><span class="op" id="2977002">)</span>&nbsp;<span class="op" id="2977004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2977009">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2977084">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977165">const</span>&nbsp;<span class="ident" id="2977171">maxBodySlurpSize</span>&nbsp;<span class="op" id="2977188">=</span>&nbsp;<span class="num" id="2977190">2</span>&nbsp;<span class="op" id="2977192">&lt;&lt;</span>&nbsp;<span class="num" id="2977195">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977201">if</span>&nbsp;<span class="ident" id="2977204">resp</span><span class="op" id="2977208">.</span><span class="ident" id="2977209">ContentLength</span>&nbsp;<span class="op" id="2977223">==</span>&nbsp;<span class="op" id="2977226">-</span><span class="num" id="2977227">1</span>&nbsp;<span class="op" id="2977229">||</span>&nbsp;<span class="ident" id="2977232">resp</span><span class="op" id="2977236">.</span><span class="ident" id="2977237">ContentLength</span>&nbsp;<span class="op" id="2977251">&lt;=</span>&nbsp;<span class="ident" id="2977254">maxBodySlurpSize</span>&nbsp;<span class="op" id="2977271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977277">io</span><span class="op" id="2977279">.</span><span class="ident" id="2977280">CopyN</span><span class="op" id="2977285">(</span><span class="ident" id="2977286">ioutil</span><span class="op" id="2977292">.</span><span class="ident" id="2977293">Discard</span><span class="op" id="2977300">,</span>&nbsp;<span class="ident" id="2977302">resp</span><span class="op" id="2977306">.</span><span class="ident" id="2977307">Body</span><span class="op" id="2977311">,</span>&nbsp;<span class="ident" id="2977313">maxBodySlurpSize</span><span class="op" id="2977329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977339">resp</span><span class="op" id="2977343">.</span><span class="ident" id="2977344">Body</span><span class="op" id="2977348">.</span><span class="ident" id="2977349">Close</span><span class="op" id="2977354">(</span><span class="op" id="2977355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977360">if</span>&nbsp;<span class="ident" id="2977363">urlStr</span>&nbsp;<span class="op" id="2977370">=</span>&nbsp;<span class="ident" id="2977372">resp</span><span class="op" id="2977376">.</span><span class="ident" id="2977377">Header</span><span class="op" id="2977383">.</span><span class="ident" id="2977384">Get</span><span class="op" id="2977387">(</span><span class="string" id="2977388">&#34;Location&#34;</span><span class="op" id="2977398">)</span><span class="op" id="2977399">;</span>&nbsp;<span class="ident" id="2977401">urlStr</span>&nbsp;<span class="op" id="2977408">==</span>&nbsp;<span class="string" id="2977411">&#34;&#34;</span>&nbsp;<span class="op" id="2977414">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977420">err</span>&nbsp;<span class="op" id="2977424">=</span>&nbsp;<span class="ident" id="2977426">errors</span><span class="op" id="2977432">.</span><span class="ident" id="2977433">New</span><span class="op" id="2977436">(</span><span class="ident" id="2977437">fmt</span><span class="op" id="2977440">.</span><span class="ident" id="2977441">Sprintf</span><span class="op" id="2977448">(</span><span class="string" id="2977449">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="2977486">,</span>&nbsp;<span class="ident" id="2977488">resp</span><span class="op" id="2977492">.</span><span class="ident" id="2977493">StatusCode</span><span class="op" id="2977503">)</span><span class="op" id="2977504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977510">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977524">base</span>&nbsp;<span class="op" id="2977529">=</span>&nbsp;<span class="ident" id="2977531">req</span><span class="op" id="2977534">.</span><span class="ident" id="2977535">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977542">via</span>&nbsp;<span class="op" id="2977546">=</span>&nbsp;<span class="builtinfunc" id="2977548">append</span><span class="op" id="2977554">(</span><span class="ident" id="2977555">via</span><span class="op" id="2977558">,</span>&nbsp;<span class="ident" id="2977560">req</span><span class="op" id="2977563">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977568">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977583">if</span>&nbsp;<span class="ident" id="2977586">timer</span>&nbsp;<span class="op" id="2977592">!=</span>&nbsp;<span class="ident" id="2977595">nil</span>&nbsp;<span class="op" id="2977599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977604">resp</span><span class="op" id="2977608">.</span><span class="ident" id="2977609">Body</span>&nbsp;<span class="op" id="2977614">=</span>&nbsp;<span class="op" id="2977616">&amp;</span><span class="ident" id="2977617">cancelTimerBody</span><span class="op" id="2977632">{</span><span class="ident" id="2977633">timer</span><span class="op" id="2977638">,</span>&nbsp;<span class="ident" id="2977640">resp</span><span class="op" id="2977644">.</span><span class="ident" id="2977645">Body</span><span class="op" id="2977649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977653">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977657">return</span>&nbsp;<span class="ident" id="2977664">resp</span><span class="op" id="2977668">,</span>&nbsp;<span class="ident" id="2977670">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977679">method</span>&nbsp;<span class="op" id="2977686">:=</span>&nbsp;<span class="ident" id="2977689">ireq</span><span class="op" id="2977693">.</span><span class="ident" id="2977694">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977702">urlErr</span>&nbsp;<span class="op" id="2977709">:=</span>&nbsp;<span class="op" id="2977712">&amp;</span><span class="ident" id="2977713">url</span><span class="op" id="2977716">.</span><span class="ident" id="2977717">Error</span><span class="op" id="2977722">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977726">Op</span><span class="op" id="2977728">:</span>&nbsp;&nbsp;<span class="ident" id="2977731">method</span><span class="op" id="2977737">[</span><span class="num" id="2977738">0</span><span class="op" id="2977739">:</span><span class="num" id="2977740">1</span><span class="op" id="2977741">]</span>&nbsp;<span class="op" id="2977743">+</span>&nbsp;<span class="ident" id="2977745">strings</span><span class="op" id="2977752">.</span><span class="ident" id="2977753">ToLower</span><span class="op" id="2977760">(</span><span class="ident" id="2977761">method</span><span class="op" id="2977767">[</span><span class="num" id="2977768">1</span><span class="op" id="2977769">:</span><span class="op" id="2977770">]</span><span class="op" id="2977771">)</span><span class="op" id="2977772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977776">URL</span><span class="op" id="2977779">:</span>&nbsp;<span class="ident" id="2977781">urlStr</span><span class="op" id="2977787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2977791">Err</span><span class="op" id="2977794">:</span>&nbsp;<span class="ident" id="2977796">err</span><span class="op" id="2977799">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2977802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977806">if</span>&nbsp;<span class="ident" id="2977809">redirectFailed</span>&nbsp;<span class="op" id="2977824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2977828">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2977895">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2977951">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2977989">return</span>&nbsp;<span class="ident" id="2977996">resp</span><span class="op" id="2978000">,</span>&nbsp;<span class="ident" id="2978002">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978014">if</span>&nbsp;<span class="ident" id="2978017">resp</span>&nbsp;<span class="op" id="2978022">!=</span>&nbsp;<span class="ident" id="2978025">nil</span>&nbsp;<span class="op" id="2978029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978033">resp</span><span class="op" id="2978037">.</span><span class="ident" id="2978038">Body</span><span class="op" id="2978042">.</span><span class="ident" id="2978043">Close</span><span class="op" id="2978048">(</span><span class="op" id="2978049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978052">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978055">return</span>&nbsp;<span class="ident" id="2978062">nil</span><span class="op" id="2978065">,</span>&nbsp;<span class="ident" id="2978067">urlErr</span><br>
<span class="lineno"></span><span class="op" id="2978074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2978077">func</span>&nbsp;<span class="ident" id="2978082">defaultCheckRedirect</span><span class="op" id="2978102">(</span><span class="ident" id="2978103">req</span>&nbsp;<span class="op" id="2978107">*</span><span class="ident" id="2978108">Request</span><span class="op" id="2978115">,</span>&nbsp;<span class="ident" id="2978117">via</span>&nbsp;<span class="op" id="2978121">[</span><span class="op" id="2978122">]</span><span class="op" id="2978123">*</span><span class="ident" id="2978124">Request</span><span class="op" id="2978131">)</span>&nbsp;<span class="builtintype" id="2978133">error</span>&nbsp;<span class="op" id="2978139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978142">if</span>&nbsp;<span class="builtinfunc" id="2978145">len</span><span class="op" id="2978148">(</span><span class="ident" id="2978149">via</span><span class="op" id="2978152">)</span>&nbsp;<span class="op" id="2978154">&gt;=</span>&nbsp;<span class="num" id="2978157">10</span>&nbsp;<span class="op" id="2978160">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978164">return</span>&nbsp;<span class="ident" id="2978171">errors</span><span class="op" id="2978177">.</span><span class="ident" id="2978178">New</span><span class="op" id="2978181">(</span><span class="string" id="2978182">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="2978210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978216">return</span>&nbsp;<span class="ident" id="2978223">nil</span><br>
<span class="lineno"></span><span class="op" id="2978227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="2978230">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="2978274">//</span><br>
<span class="lineno"></span><span class="comment" id="2978277">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2978337">//</span><br>
<span class="lineno"></span><span class="comment" id="2978340">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="2978387">func</span>&nbsp;<span class="ident" id="2978392">Post</span><span class="op" id="2978396">(</span><span class="ident" id="2978397">url</span>&nbsp;<span class="builtintype" id="2978401">string</span><span class="op" id="2978407">,</span>&nbsp;<span class="ident" id="2978409">bodyType</span>&nbsp;<span class="builtintype" id="2978418">string</span><span class="op" id="2978424">,</span>&nbsp;<span class="ident" id="2978426">body</span>&nbsp;<span class="ident" id="2978431">io</span><span class="op" id="2978433">.</span><span class="ident" id="2978434">Reader</span><span class="op" id="2978440">)</span>&nbsp;<span class="op" id="2978442">(</span><span class="ident" id="2978443">resp</span>&nbsp;<span class="op" id="2978448">*</span><span class="ident" id="2978449">Response</span><span class="op" id="2978457">,</span>&nbsp;<span class="ident" id="2978459">err</span>&nbsp;<span class="builtintype" id="2978463">error</span><span class="op" id="2978468">)</span>&nbsp;<span class="op" id="2978470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978473">return</span>&nbsp;<span class="ident" id="2978480">DefaultClient</span><span class="op" id="2978493">.</span><span class="ident" id="2978494">Post</span><span class="op" id="2978498">(</span><span class="ident" id="2978499">url</span><span class="op" id="2978502">,</span>&nbsp;<span class="ident" id="2978504">bodyType</span><span class="op" id="2978512">,</span>&nbsp;<span class="ident" id="2978514">body</span><span class="op" id="2978518">)</span><br>
<span class="lineno"></span><span class="op" id="2978520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2978523">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="2978567">//</span><br>
<span class="lineno"></span><span class="comment" id="2978570">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2978630">//</span><br>
<span class="lineno"></span><span class="comment" id="2978633">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2978702">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="2978714">func</span>&nbsp;<span class="op" id="2978719">(</span><span class="ident" id="2978720">c</span>&nbsp;<span class="op" id="2978722">*</span><span class="ident" id="2978723">Client</span><span class="op" id="2978729">)</span>&nbsp;<span class="ident" id="2978731">Post</span><span class="op" id="2978735">(</span><span class="ident" id="2978736">url</span>&nbsp;<span class="builtintype" id="2978740">string</span><span class="op" id="2978746">,</span>&nbsp;<span class="ident" id="2978748">bodyType</span>&nbsp;<span class="builtintype" id="2978757">string</span><span class="op" id="2978763">,</span>&nbsp;<span class="ident" id="2978765">body</span>&nbsp;<span class="ident" id="2978770">io</span><span class="op" id="2978772">.</span><span class="ident" id="2978773">Reader</span><span class="op" id="2978779">)</span>&nbsp;<span class="op" id="2978781">(</span><span class="ident" id="2978782">resp</span>&nbsp;<span class="op" id="2978787">*</span><span class="ident" id="2978788">Response</span><span class="op" id="2978796">,</span>&nbsp;<span class="ident" id="2978798">err</span>&nbsp;<span class="builtintype" id="2978802">error</span><span class="op" id="2978807">)</span>&nbsp;<span class="op" id="2978809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978812">req</span><span class="op" id="2978815">,</span>&nbsp;<span class="ident" id="2978817">err</span>&nbsp;<span class="op" id="2978821">:=</span>&nbsp;<span class="ident" id="2978824">NewRequest</span><span class="op" id="2978834">(</span><span class="string" id="2978835">&#34;POST&#34;</span><span class="op" id="2978841">,</span>&nbsp;<span class="ident" id="2978843">url</span><span class="op" id="2978846">,</span>&nbsp;<span class="ident" id="2978848">body</span><span class="op" id="2978852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978855">if</span>&nbsp;<span class="ident" id="2978858">err</span>&nbsp;<span class="op" id="2978862">!=</span>&nbsp;<span class="ident" id="2978865">nil</span>&nbsp;<span class="op" id="2978869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978873">return</span>&nbsp;<span class="ident" id="2978880">nil</span><span class="op" id="2978883">,</span>&nbsp;<span class="ident" id="2978885">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2978890">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2978893">req</span><span class="op" id="2978896">.</span><span class="ident" id="2978897">Header</span><span class="op" id="2978903">.</span><span class="ident" id="2978904">Set</span><span class="op" id="2978907">(</span><span class="string" id="2978908">&#34;Content-Type&#34;</span><span class="op" id="2978922">,</span>&nbsp;<span class="ident" id="2978924">bodyType</span><span class="op" id="2978932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2978935">return</span>&nbsp;<span class="ident" id="2978942">c</span><span class="op" id="2978943">.</span><span class="ident" id="2978944">doFollowingRedirects</span><span class="op" id="2978964">(</span><span class="ident" id="2978965">req</span><span class="op" id="2978968">,</span>&nbsp;<span class="ident" id="2978970">shouldRedirectPost</span><span class="op" id="2978988">)</span><br>
<span class="lineno"></span><span class="op" id="2978990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2978993">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="2979062">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="2979105">//</span><br>
<span class="lineno"></span><span class="comment" id="2979108">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2979170">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="2979230">//</span><br>
<span class="lineno">450</span><span class="comment" id="2979233">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="2979288">func</span>&nbsp;<span class="ident" id="2979293">PostForm</span><span class="op" id="2979301">(</span><span class="ident" id="2979302">url</span>&nbsp;<span class="builtintype" id="2979306">string</span><span class="op" id="2979312">,</span>&nbsp;<span class="ident" id="2979314">data</span>&nbsp;<span class="ident" id="2979319">url</span><span class="op" id="2979322">.</span><span class="ident" id="2979323">Values</span><span class="op" id="2979329">)</span>&nbsp;<span class="op" id="2979331">(</span><span class="ident" id="2979332">resp</span>&nbsp;<span class="op" id="2979337">*</span><span class="ident" id="2979338">Response</span><span class="op" id="2979346">,</span>&nbsp;<span class="ident" id="2979348">err</span>&nbsp;<span class="builtintype" id="2979352">error</span><span class="op" id="2979357">)</span>&nbsp;<span class="op" id="2979359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2979362">return</span>&nbsp;<span class="ident" id="2979369">DefaultClient</span><span class="op" id="2979382">.</span><span class="ident" id="2979383">PostForm</span><span class="op" id="2979391">(</span><span class="ident" id="2979392">url</span><span class="op" id="2979395">,</span>&nbsp;<span class="ident" id="2979397">data</span><span class="op" id="2979401">)</span><br>
<span class="lineno"></span><span class="op" id="2979403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="2979406">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="2979454">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="2979517">//</span><br>
<span class="lineno"></span><span class="comment" id="2979520">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="2979582">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="2979642">func</span>&nbsp;<span class="op" id="2979647">(</span><span class="ident" id="2979648">c</span>&nbsp;<span class="op" id="2979650">*</span><span class="ident" id="2979651">Client</span><span class="op" id="2979657">)</span>&nbsp;<span class="ident" id="2979659">PostForm</span><span class="op" id="2979667">(</span><span class="ident" id="2979668">url</span>&nbsp;<span class="builtintype" id="2979672">string</span><span class="op" id="2979678">,</span>&nbsp;<span class="ident" id="2979680">data</span>&nbsp;<span class="ident" id="2979685">url</span><span class="op" id="2979688">.</span><span class="ident" id="2979689">Values</span><span class="op" id="2979695">)</span>&nbsp;<span class="op" id="2979697">(</span><span class="ident" id="2979698">resp</span>&nbsp;<span class="op" id="2979703">*</span><span class="ident" id="2979704">Response</span><span class="op" id="2979712">,</span>&nbsp;<span class="ident" id="2979714">err</span>&nbsp;<span class="builtintype" id="2979718">error</span><span class="op" id="2979723">)</span>&nbsp;<span class="op" id="2979725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2979728">return</span>&nbsp;<span class="ident" id="2979735">c</span><span class="op" id="2979736">.</span><span class="ident" id="2979737">Post</span><span class="op" id="2979741">(</span><span class="ident" id="2979742">url</span><span class="op" id="2979745">,</span>&nbsp;<span class="string" id="2979747">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="2979782">,</span>&nbsp;<span class="ident" id="2979784">strings</span><span class="op" id="2979791">.</span><span class="ident" id="2979792">NewReader</span><span class="op" id="2979801">(</span><span class="ident" id="2979802">data</span><span class="op" id="2979806">.</span><span class="ident" id="2979807">Encode</span><span class="op" id="2979813">(</span><span class="op" id="2979814">)</span><span class="op" id="2979815">)</span><span class="op" id="2979816">)</span><br>
<span class="lineno"></span><span class="op" id="2979818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2979821">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="2979896">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2979969">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2980005">//</span><br>
<span class="lineno"></span><span class="comment" id="2980008">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2980038">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="2980056">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="2980078">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="2980109">//</span><br>
<span class="lineno"></span><span class="comment" id="2980112">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="2980159">func</span>&nbsp;<span class="ident" id="2980164">Head</span><span class="op" id="2980168">(</span><span class="ident" id="2980169">url</span>&nbsp;<span class="builtintype" id="2980173">string</span><span class="op" id="2980179">)</span>&nbsp;<span class="op" id="2980181">(</span><span class="ident" id="2980182">resp</span>&nbsp;<span class="op" id="2980187">*</span><span class="ident" id="2980188">Response</span><span class="op" id="2980196">,</span>&nbsp;<span class="ident" id="2980198">err</span>&nbsp;<span class="builtintype" id="2980202">error</span><span class="op" id="2980207">)</span>&nbsp;<span class="op" id="2980209">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980212">return</span>&nbsp;<span class="ident" id="2980219">DefaultClient</span><span class="op" id="2980232">.</span><span class="ident" id="2980233">Head</span><span class="op" id="2980237">(</span><span class="ident" id="2980238">url</span><span class="op" id="2980241">)</span><br>
<span class="lineno"></span><span class="op" id="2980243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2980246">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2980321">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="2980394">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="2980430">//</span><br>
<span class="lineno"></span><span class="comment" id="2980433">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="2980463">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="2980481">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="2980503">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="2980534">func</span>&nbsp;<span class="op" id="2980539">(</span><span class="ident" id="2980540">c</span>&nbsp;<span class="op" id="2980542">*</span><span class="ident" id="2980543">Client</span><span class="op" id="2980549">)</span>&nbsp;<span class="ident" id="2980551">Head</span><span class="op" id="2980555">(</span><span class="ident" id="2980556">url</span>&nbsp;<span class="builtintype" id="2980560">string</span><span class="op" id="2980566">)</span>&nbsp;<span class="op" id="2980568">(</span><span class="ident" id="2980569">resp</span>&nbsp;<span class="op" id="2980574">*</span><span class="ident" id="2980575">Response</span><span class="op" id="2980583">,</span>&nbsp;<span class="ident" id="2980585">err</span>&nbsp;<span class="builtintype" id="2980589">error</span><span class="op" id="2980594">)</span>&nbsp;<span class="op" id="2980596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980599">req</span><span class="op" id="2980602">,</span>&nbsp;<span class="ident" id="2980604">err</span>&nbsp;<span class="op" id="2980608">:=</span>&nbsp;<span class="ident" id="2980611">NewRequest</span><span class="op" id="2980621">(</span><span class="string" id="2980622">&#34;HEAD&#34;</span><span class="op" id="2980628">,</span>&nbsp;<span class="ident" id="2980630">url</span><span class="op" id="2980633">,</span>&nbsp;<span class="ident" id="2980635">nil</span><span class="op" id="2980638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980641">if</span>&nbsp;<span class="ident" id="2980644">err</span>&nbsp;<span class="op" id="2980648">!=</span>&nbsp;<span class="ident" id="2980651">nil</span>&nbsp;<span class="op" id="2980655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980659">return</span>&nbsp;<span class="ident" id="2980666">nil</span><span class="op" id="2980669">,</span>&nbsp;<span class="ident" id="2980671">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2980676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980679">return</span>&nbsp;<span class="ident" id="2980686">c</span><span class="op" id="2980687">.</span><span class="ident" id="2980688">doFollowingRedirects</span><span class="op" id="2980708">(</span><span class="ident" id="2980709">req</span><span class="op" id="2980712">,</span>&nbsp;<span class="ident" id="2980714">shouldRedirectGet</span><span class="op" id="2980731">)</span><br>
<span class="lineno"></span><span class="op" id="2980733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2980736">type</span>&nbsp;<span class="ident" id="2980741">cancelTimerBody</span>&nbsp;<span class="keyword" id="2980757">struct</span>&nbsp;<span class="op" id="2980764">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980767">t</span>&nbsp;&nbsp;<span class="op" id="2980770">*</span><span class="ident" id="2980771">time</span><span class="op" id="2980775">.</span><span class="ident" id="2980776">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980783">rc</span>&nbsp;<span class="ident" id="2980786">io</span><span class="op" id="2980788">.</span><span class="ident" id="2980789">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="2980800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2980803">func</span>&nbsp;<span class="op" id="2980808">(</span><span class="ident" id="2980809">b</span>&nbsp;<span class="op" id="2980811">*</span><span class="ident" id="2980812">cancelTimerBody</span><span class="op" id="2980827">)</span>&nbsp;<span class="ident" id="2980829">Read</span><span class="op" id="2980833">(</span><span class="ident" id="2980834">p</span>&nbsp;<span class="op" id="2980836">[</span><span class="op" id="2980837">]</span><span class="builtintype" id="2980838">byte</span><span class="op" id="2980842">)</span>&nbsp;<span class="op" id="2980844">(</span><span class="ident" id="2980845">n</span>&nbsp;<span class="builtintype" id="2980847">int</span><span class="op" id="2980850">,</span>&nbsp;<span class="ident" id="2980852">err</span>&nbsp;<span class="builtintype" id="2980856">error</span><span class="op" id="2980861">)</span>&nbsp;<span class="op" id="2980863">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980866">n</span><span class="op" id="2980867">,</span>&nbsp;<span class="ident" id="2980869">err</span>&nbsp;<span class="op" id="2980873">=</span>&nbsp;<span class="ident" id="2980875">b</span><span class="op" id="2980876">.</span><span class="ident" id="2980877">rc</span><span class="op" id="2980879">.</span><span class="ident" id="2980880">Read</span><span class="op" id="2980884">(</span><span class="ident" id="2980885">p</span><span class="op" id="2980886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980889">if</span>&nbsp;<span class="ident" id="2980892">err</span>&nbsp;<span class="op" id="2980896">==</span>&nbsp;<span class="ident" id="2980899">io</span><span class="op" id="2980901">.</span><span class="ident" id="2980902">EOF</span>&nbsp;<span class="op" id="2980906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980910">b</span><span class="op" id="2980911">.</span><span class="ident" id="2980912">t</span><span class="op" id="2980913">.</span><span class="ident" id="2980914">Stop</span><span class="op" id="2980918">(</span><span class="op" id="2980919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2980922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2980925">return</span><br>
<span class="lineno">505</span><span class="op" id="2980932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2980935">func</span>&nbsp;<span class="op" id="2980940">(</span><span class="ident" id="2980941">b</span>&nbsp;<span class="op" id="2980943">*</span><span class="ident" id="2980944">cancelTimerBody</span><span class="op" id="2980959">)</span>&nbsp;<span class="ident" id="2980961">Close</span><span class="op" id="2980966">(</span><span class="op" id="2980967">)</span>&nbsp;<span class="builtintype" id="2980969">error</span>&nbsp;<span class="op" id="2980975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980978">err</span>&nbsp;<span class="op" id="2980982">:=</span>&nbsp;<span class="ident" id="2980985">b</span><span class="op" id="2980986">.</span><span class="ident" id="2980987">rc</span><span class="op" id="2980989">.</span><span class="ident" id="2980990">Close</span><span class="op" id="2980995">(</span><span class="op" id="2980996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2980999">b</span><span class="op" id="2981000">.</span><span class="ident" id="2981001">t</span><span class="op" id="2981002">.</span><span class="ident" id="2981003">Stop</span><span class="op" id="2981007">(</span><span class="op" id="2981008">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2981011">return</span>&nbsp;<span class="ident" id="2981018">err</span><br>
<span class="lineno"></span><span class="op" id="2981022">}</span>
</div>
</body>
</html>
