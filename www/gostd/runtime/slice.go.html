<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1669177">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1669232">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1669286">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1669337">package</span>&nbsp;<span class="ident" id="1669345">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1669354">import</span>&nbsp;<span class="op" id="1669361">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1669364">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1669373">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1669376">type</span>&nbsp;<span class="ident" id="1669381">sliceStruct</span>&nbsp;<span class="keyword" id="1669393">struct</span>&nbsp;<span class="op" id="1669400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669403">array</span>&nbsp;<span class="ident" id="1669409">unsafe</span><span class="op" id="1669415">.</span><span class="ident" id="1669416">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1669425">len</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1669431">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1669436">cap</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1669442">int</span><br>
<span class="lineno">15</span><span class="op" id="1669446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1669449">//&nbsp;TODO:&nbsp;take&nbsp;uintptrs&nbsp;instead&nbsp;of&nbsp;int64s?</span><br>
<span class="lineno"></span><span class="keyword" id="1669491">func</span>&nbsp;<span class="ident" id="1669496">makeslice</span><span class="op" id="1669505">(</span><span class="ident" id="1669506">t</span>&nbsp;<span class="op" id="1669508">*</span><span class="ident" id="1669509">slicetype</span><span class="op" id="1669518">,</span>&nbsp;<span class="ident" id="1669520">len64</span>&nbsp;<span class="ident" id="1669526">int64</span><span class="op" id="1669531">,</span>&nbsp;<span class="ident" id="1669533">cap64</span>&nbsp;<span class="ident" id="1669539">int64</span><span class="op" id="1669544">)</span>&nbsp;<span class="ident" id="1669546">sliceStruct</span>&nbsp;<span class="op" id="1669558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669561">//&nbsp;NOTE:&nbsp;The&nbsp;len&nbsp;&gt;&nbsp;MaxMem/elemsize&nbsp;check&nbsp;here&nbsp;is&nbsp;not&nbsp;strictly&nbsp;necessary,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669635">//&nbsp;but&nbsp;it&nbsp;produces&nbsp;a&nbsp;&#39;len&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error&nbsp;instead&nbsp;of&nbsp;a&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669720">//&nbsp;when&nbsp;someone&nbsp;does&nbsp;make([]T,&nbsp;bignumber).&nbsp;&#39;cap&nbsp;out&nbsp;of&nbsp;range&#39;&nbsp;is&nbsp;true&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669796">//&nbsp;but&nbsp;since&nbsp;the&nbsp;cap&nbsp;is&nbsp;only&nbsp;being&nbsp;supplied&nbsp;implicitly,&nbsp;saying&nbsp;len&nbsp;is&nbsp;clearer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669876">//&nbsp;See&nbsp;issue&nbsp;4085.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1669896">len</span>&nbsp;<span class="op" id="1669900">:=</span>&nbsp;<span class="builtintype" id="1669903">int</span><span class="op" id="1669906">(</span><span class="ident" id="1669907">len64</span><span class="op" id="1669912">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669915">if</span>&nbsp;<span class="ident" id="1669918">len64</span>&nbsp;<span class="op" id="1669924">&lt;</span>&nbsp;<span class="num" id="1669926">0</span>&nbsp;<span class="op" id="1669928">||</span>&nbsp;<span class="ident" id="1669931">int64</span><span class="op" id="1669936">(</span><span class="builtinfunc" id="1669937">len</span><span class="op" id="1669940">)</span>&nbsp;<span class="op" id="1669942">!=</span>&nbsp;<span class="ident" id="1669945">len64</span>&nbsp;<span class="op" id="1669951">||</span>&nbsp;<span class="ident" id="1669954">t</span><span class="op" id="1669955">.</span><span class="ident" id="1669956">elem</span><span class="op" id="1669960">.</span><span class="ident" id="1669961">size</span>&nbsp;<span class="op" id="1669966">&gt;</span>&nbsp;<span class="num" id="1669968">0</span>&nbsp;<span class="op" id="1669970">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1669973">uintptr</span><span class="op" id="1669980">(</span><span class="builtinfunc" id="1669981">len</span><span class="op" id="1669984">)</span>&nbsp;<span class="op" id="1669986">&gt;</span>&nbsp;<span class="ident" id="1669988">maxmem</span><span class="op" id="1669994">/</span><span class="builtintype" id="1669995">uintptr</span><span class="op" id="1670002">(</span><span class="ident" id="1670003">t</span><span class="op" id="1670004">.</span><span class="ident" id="1670005">elem</span><span class="op" id="1670009">.</span><span class="ident" id="1670010">size</span><span class="op" id="1670014">)</span>&nbsp;<span class="op" id="1670016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1670020">panic</span><span class="op" id="1670025">(</span><span class="ident" id="1670026">errorString</span><span class="op" id="1670037">(</span><span class="string" id="1670038">&#34;makeslice:&nbsp;len&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1670067">)</span><span class="op" id="1670068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1670074">cap</span>&nbsp;<span class="op" id="1670078">:=</span>&nbsp;<span class="builtintype" id="1670081">int</span><span class="op" id="1670084">(</span><span class="ident" id="1670085">cap64</span><span class="op" id="1670090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670093">if</span>&nbsp;<span class="builtinfunc" id="1670096">cap</span>&nbsp;<span class="op" id="1670100">&lt;</span>&nbsp;<span class="builtinfunc" id="1670102">len</span>&nbsp;<span class="op" id="1670106">||</span>&nbsp;<span class="ident" id="1670109">int64</span><span class="op" id="1670114">(</span><span class="builtinfunc" id="1670115">cap</span><span class="op" id="1670118">)</span>&nbsp;<span class="op" id="1670120">!=</span>&nbsp;<span class="ident" id="1670123">cap64</span>&nbsp;<span class="op" id="1670129">||</span>&nbsp;<span class="ident" id="1670132">t</span><span class="op" id="1670133">.</span><span class="ident" id="1670134">elem</span><span class="op" id="1670138">.</span><span class="ident" id="1670139">size</span>&nbsp;<span class="op" id="1670144">&gt;</span>&nbsp;<span class="num" id="1670146">0</span>&nbsp;<span class="op" id="1670148">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1670151">uintptr</span><span class="op" id="1670158">(</span><span class="builtinfunc" id="1670159">cap</span><span class="op" id="1670162">)</span>&nbsp;<span class="op" id="1670164">&gt;</span>&nbsp;<span class="ident" id="1670166">maxmem</span><span class="op" id="1670172">/</span><span class="builtintype" id="1670173">uintptr</span><span class="op" id="1670180">(</span><span class="ident" id="1670181">t</span><span class="op" id="1670182">.</span><span class="ident" id="1670183">elem</span><span class="op" id="1670187">.</span><span class="ident" id="1670188">size</span><span class="op" id="1670192">)</span>&nbsp;<span class="op" id="1670194">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1670198">panic</span><span class="op" id="1670203">(</span><span class="ident" id="1670204">errorString</span><span class="op" id="1670215">(</span><span class="string" id="1670216">&#34;makeslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1670245">)</span><span class="op" id="1670246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670252">p</span>&nbsp;<span class="op" id="1670254">:=</span>&nbsp;<span class="ident" id="1670257">newarray</span><span class="op" id="1670265">(</span><span class="ident" id="1670266">t</span><span class="op" id="1670267">.</span><span class="ident" id="1670268">elem</span><span class="op" id="1670272">,</span>&nbsp;<span class="builtintype" id="1670274">uintptr</span><span class="op" id="1670281">(</span><span class="builtinfunc" id="1670282">cap</span><span class="op" id="1670285">)</span><span class="op" id="1670286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670289">return</span>&nbsp;<span class="ident" id="1670296">sliceStruct</span><span class="op" id="1670307">{</span><span class="ident" id="1670308">p</span><span class="op" id="1670309">,</span>&nbsp;<span class="builtinfunc" id="1670311">len</span><span class="op" id="1670314">,</span>&nbsp;<span class="builtinfunc" id="1670316">cap</span><span class="op" id="1670319">}</span><br>
<span class="lineno"></span><span class="op" id="1670321">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1670324">//&nbsp;TODO:&nbsp;take&nbsp;uintptr&nbsp;instead&nbsp;of&nbsp;int64?</span><br>
<span class="lineno"></span><span class="keyword" id="1670364">func</span>&nbsp;<span class="ident" id="1670369">growslice</span><span class="op" id="1670378">(</span><span class="ident" id="1670379">t</span>&nbsp;<span class="op" id="1670381">*</span><span class="ident" id="1670382">slicetype</span><span class="op" id="1670391">,</span>&nbsp;<span class="ident" id="1670393">old</span>&nbsp;<span class="ident" id="1670397">sliceStruct</span><span class="op" id="1670408">,</span>&nbsp;<span class="ident" id="1670410">n</span>&nbsp;<span class="ident" id="1670412">int64</span><span class="op" id="1670417">)</span>&nbsp;<span class="ident" id="1670419">sliceStruct</span>&nbsp;<span class="op" id="1670431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670434">if</span>&nbsp;<span class="ident" id="1670437">n</span>&nbsp;<span class="op" id="1670439">&lt;</span>&nbsp;<span class="num" id="1670441">1</span>&nbsp;<span class="op" id="1670443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1670447">panic</span><span class="op" id="1670452">(</span><span class="ident" id="1670453">errorString</span><span class="op" id="1670464">(</span><span class="string" id="1670465">&#34;growslice:&nbsp;invalid&nbsp;n&#34;</span><span class="op" id="1670487">)</span><span class="op" id="1670488">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670495">cap64</span>&nbsp;<span class="op" id="1670501">:=</span>&nbsp;<span class="ident" id="1670504">int64</span><span class="op" id="1670509">(</span><span class="ident" id="1670510">old</span><span class="op" id="1670513">.</span><span class="builtinfunc" id="1670514">cap</span><span class="op" id="1670517">)</span>&nbsp;<span class="op" id="1670519">+</span>&nbsp;<span class="ident" id="1670521">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1670524">cap</span>&nbsp;<span class="op" id="1670528">:=</span>&nbsp;<span class="builtintype" id="1670531">int</span><span class="op" id="1670534">(</span><span class="ident" id="1670535">cap64</span><span class="op" id="1670540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670544">if</span>&nbsp;<span class="ident" id="1670547">int64</span><span class="op" id="1670552">(</span><span class="builtinfunc" id="1670553">cap</span><span class="op" id="1670556">)</span>&nbsp;<span class="op" id="1670558">!=</span>&nbsp;<span class="ident" id="1670561">cap64</span>&nbsp;<span class="op" id="1670567">||</span>&nbsp;<span class="builtinfunc" id="1670570">cap</span>&nbsp;<span class="op" id="1670574">&lt;</span>&nbsp;<span class="ident" id="1670576">old</span><span class="op" id="1670579">.</span><span class="builtinfunc" id="1670580">cap</span>&nbsp;<span class="op" id="1670584">||</span>&nbsp;<span class="ident" id="1670587">t</span><span class="op" id="1670588">.</span><span class="ident" id="1670589">elem</span><span class="op" id="1670593">.</span><span class="ident" id="1670594">size</span>&nbsp;<span class="op" id="1670599">&gt;</span>&nbsp;<span class="num" id="1670601">0</span>&nbsp;<span class="op" id="1670603">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1670606">uintptr</span><span class="op" id="1670613">(</span><span class="builtinfunc" id="1670614">cap</span><span class="op" id="1670617">)</span>&nbsp;<span class="op" id="1670619">&gt;</span>&nbsp;<span class="ident" id="1670621">maxmem</span><span class="op" id="1670627">/</span><span class="builtintype" id="1670628">uintptr</span><span class="op" id="1670635">(</span><span class="ident" id="1670636">t</span><span class="op" id="1670637">.</span><span class="ident" id="1670638">elem</span><span class="op" id="1670642">.</span><span class="ident" id="1670643">size</span><span class="op" id="1670647">)</span>&nbsp;<span class="op" id="1670649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1670653">panic</span><span class="op" id="1670658">(</span><span class="ident" id="1670659">errorString</span><span class="op" id="1670670">(</span><span class="string" id="1670671">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1670700">)</span><span class="op" id="1670701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670708">if</span>&nbsp;<span class="ident" id="1670711">raceenabled</span>&nbsp;<span class="op" id="1670723">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670727">callerpc</span>&nbsp;<span class="op" id="1670736">:=</span>&nbsp;<span class="ident" id="1670739">getcallerpc</span><span class="op" id="1670750">(</span><span class="ident" id="1670751">unsafe</span><span class="op" id="1670757">.</span><span class="ident" id="1670758">Pointer</span><span class="op" id="1670765">(</span><span class="op" id="1670766">&amp;</span><span class="ident" id="1670767">t</span><span class="op" id="1670768">)</span><span class="op" id="1670769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670773">racereadrangepc</span><span class="op" id="1670788">(</span><span class="ident" id="1670789">old</span><span class="op" id="1670792">.</span><span class="ident" id="1670793">array</span><span class="op" id="1670798">,</span>&nbsp;<span class="builtintype" id="1670800">uintptr</span><span class="op" id="1670807">(</span><span class="ident" id="1670808">old</span><span class="op" id="1670811">.</span><span class="builtinfunc" id="1670812">len</span><span class="op" id="1670815">*</span><span class="builtintype" id="1670816">int</span><span class="op" id="1670819">(</span><span class="ident" id="1670820">t</span><span class="op" id="1670821">.</span><span class="ident" id="1670822">elem</span><span class="op" id="1670826">.</span><span class="ident" id="1670827">size</span><span class="op" id="1670831">)</span><span class="op" id="1670832">)</span><span class="op" id="1670833">,</span>&nbsp;<span class="ident" id="1670835">callerpc</span><span class="op" id="1670843">,</span>&nbsp;<span class="ident" id="1670845">funcPC</span><span class="op" id="1670851">(</span><span class="ident" id="1670852">growslice</span><span class="op" id="1670861">)</span><span class="op" id="1670862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670869">et</span>&nbsp;<span class="op" id="1670872">:=</span>&nbsp;<span class="ident" id="1670875">t</span><span class="op" id="1670876">.</span><span class="ident" id="1670877">elem</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670883">if</span>&nbsp;<span class="ident" id="1670886">et</span><span class="op" id="1670888">.</span><span class="ident" id="1670889">size</span>&nbsp;<span class="op" id="1670894">==</span>&nbsp;<span class="num" id="1670897">0</span>&nbsp;<span class="op" id="1670899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670903">return</span>&nbsp;<span class="ident" id="1670910">sliceStruct</span><span class="op" id="1670921">{</span><span class="ident" id="1670922">old</span><span class="op" id="1670925">.</span><span class="ident" id="1670926">array</span><span class="op" id="1670931">,</span>&nbsp;<span class="ident" id="1670933">old</span><span class="op" id="1670936">.</span><span class="builtinfunc" id="1670937">len</span><span class="op" id="1670940">,</span>&nbsp;<span class="builtinfunc" id="1670942">cap</span><span class="op" id="1670945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670952">newcap</span>&nbsp;<span class="op" id="1670959">:=</span>&nbsp;<span class="ident" id="1670962">old</span><span class="op" id="1670965">.</span><span class="builtinfunc" id="1670966">cap</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670971">if</span>&nbsp;<span class="ident" id="1670974">newcap</span><span class="op" id="1670980">+</span><span class="ident" id="1670981">newcap</span>&nbsp;<span class="op" id="1670988">&lt;</span>&nbsp;<span class="builtinfunc" id="1670990">cap</span>&nbsp;<span class="op" id="1670994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670998">newcap</span>&nbsp;<span class="op" id="1671005">=</span>&nbsp;<span class="builtinfunc" id="1671007">cap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671012">}</span>&nbsp;<span class="keyword" id="1671014">else</span>&nbsp;<span class="op" id="1671019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671023">for</span>&nbsp;<span class="op" id="1671027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671032">if</span>&nbsp;<span class="ident" id="1671035">old</span><span class="op" id="1671038">.</span><span class="builtinfunc" id="1671039">len</span>&nbsp;<span class="op" id="1671043">&lt;</span>&nbsp;<span class="num" id="1671045">1024</span>&nbsp;<span class="op" id="1671050">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671056">newcap</span>&nbsp;<span class="op" id="1671063">+=</span>&nbsp;<span class="ident" id="1671066">newcap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671076">}</span>&nbsp;<span class="keyword" id="1671078">else</span>&nbsp;<span class="op" id="1671083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671089">newcap</span>&nbsp;<span class="op" id="1671096">+=</span>&nbsp;<span class="ident" id="1671099">newcap</span>&nbsp;<span class="op" id="1671106">/</span>&nbsp;<span class="num" id="1671108">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671118">if</span>&nbsp;<span class="ident" id="1671121">newcap</span>&nbsp;<span class="op" id="1671128">&gt;=</span>&nbsp;<span class="builtinfunc" id="1671131">cap</span>&nbsp;<span class="op" id="1671135">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671141">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671161">if</span>&nbsp;<span class="builtintype" id="1671164">uintptr</span><span class="op" id="1671171">(</span><span class="ident" id="1671172">newcap</span><span class="op" id="1671178">)</span>&nbsp;<span class="op" id="1671180">&gt;=</span>&nbsp;<span class="ident" id="1671183">maxmem</span><span class="op" id="1671189">/</span><span class="builtintype" id="1671190">uintptr</span><span class="op" id="1671197">(</span><span class="ident" id="1671198">et</span><span class="op" id="1671200">.</span><span class="ident" id="1671201">size</span><span class="op" id="1671205">)</span>&nbsp;<span class="op" id="1671207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1671211">panic</span><span class="op" id="1671216">(</span><span class="ident" id="1671217">errorString</span><span class="op" id="1671228">(</span><span class="string" id="1671229">&#34;growslice:&nbsp;cap&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1671258">)</span><span class="op" id="1671259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671265">lenmem</span>&nbsp;<span class="op" id="1671272">:=</span>&nbsp;<span class="builtintype" id="1671275">uintptr</span><span class="op" id="1671282">(</span><span class="ident" id="1671283">old</span><span class="op" id="1671286">.</span><span class="builtinfunc" id="1671287">len</span><span class="op" id="1671290">)</span>&nbsp;<span class="op" id="1671292">*</span>&nbsp;<span class="builtintype" id="1671294">uintptr</span><span class="op" id="1671301">(</span><span class="ident" id="1671302">et</span><span class="op" id="1671304">.</span><span class="ident" id="1671305">size</span><span class="op" id="1671309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671312">capmem</span>&nbsp;<span class="op" id="1671319">:=</span>&nbsp;<span class="ident" id="1671322">goroundupsize</span><span class="op" id="1671335">(</span><span class="builtintype" id="1671336">uintptr</span><span class="op" id="1671343">(</span><span class="ident" id="1671344">newcap</span><span class="op" id="1671350">)</span>&nbsp;<span class="op" id="1671352">*</span>&nbsp;<span class="builtintype" id="1671354">uintptr</span><span class="op" id="1671361">(</span><span class="ident" id="1671362">et</span><span class="op" id="1671364">.</span><span class="ident" id="1671365">size</span><span class="op" id="1671369">)</span><span class="op" id="1671370">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671373">newcap</span>&nbsp;<span class="op" id="1671380">=</span>&nbsp;<span class="builtintype" id="1671382">int</span><span class="op" id="1671385">(</span><span class="ident" id="1671386">capmem</span>&nbsp;<span class="op" id="1671393">/</span>&nbsp;<span class="builtintype" id="1671395">uintptr</span><span class="op" id="1671402">(</span><span class="ident" id="1671403">et</span><span class="op" id="1671405">.</span><span class="ident" id="1671406">size</span><span class="op" id="1671410">)</span><span class="op" id="1671411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671414">var</span>&nbsp;<span class="ident" id="1671418">p</span>&nbsp;<span class="ident" id="1671420">unsafe</span><span class="op" id="1671426">.</span><span class="ident" id="1671427">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671436">if</span>&nbsp;<span class="ident" id="1671439">et</span><span class="op" id="1671441">.</span><span class="ident" id="1671442">kind</span><span class="op" id="1671446">&amp;</span><span class="ident" id="1671447">kindNoPointers</span>&nbsp;<span class="op" id="1671462">!=</span>&nbsp;<span class="num" id="1671465">0</span>&nbsp;<span class="op" id="1671467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671471">p</span>&nbsp;<span class="op" id="1671473">=</span>&nbsp;<span class="ident" id="1671475">rawmem</span><span class="op" id="1671481">(</span><span class="ident" id="1671482">capmem</span><span class="op" id="1671488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671492">memclr</span><span class="op" id="1671498">(</span><span class="ident" id="1671499">add</span><span class="op" id="1671502">(</span><span class="ident" id="1671503">p</span><span class="op" id="1671504">,</span>&nbsp;<span class="ident" id="1671506">lenmem</span><span class="op" id="1671512">)</span><span class="op" id="1671513">,</span>&nbsp;<span class="ident" id="1671515">capmem</span><span class="op" id="1671521">-</span><span class="ident" id="1671522">lenmem</span><span class="op" id="1671528">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671531">}</span>&nbsp;<span class="keyword" id="1671533">else</span>&nbsp;<span class="op" id="1671538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671542">//&nbsp;Note:&nbsp;can&#39;t&nbsp;use&nbsp;rawmem&nbsp;(which&nbsp;avoids&nbsp;zeroing&nbsp;of&nbsp;memory),&nbsp;because&nbsp;then&nbsp;GC&nbsp;can&nbsp;scan&nbsp;unitialized&nbsp;memory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671648">p</span>&nbsp;<span class="op" id="1671650">=</span>&nbsp;<span class="ident" id="1671652">newarray</span><span class="op" id="1671660">(</span><span class="ident" id="1671661">et</span><span class="op" id="1671663">,</span>&nbsp;<span class="builtintype" id="1671665">uintptr</span><span class="op" id="1671672">(</span><span class="ident" id="1671673">newcap</span><span class="op" id="1671679">)</span><span class="op" id="1671680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671686">memmove</span><span class="op" id="1671693">(</span><span class="ident" id="1671694">p</span><span class="op" id="1671695">,</span>&nbsp;<span class="ident" id="1671697">old</span><span class="op" id="1671700">.</span><span class="ident" id="1671701">array</span><span class="op" id="1671706">,</span>&nbsp;<span class="ident" id="1671708">lenmem</span><span class="op" id="1671714">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671718">return</span>&nbsp;<span class="ident" id="1671725">sliceStruct</span><span class="op" id="1671736">{</span><span class="ident" id="1671737">p</span><span class="op" id="1671738">,</span>&nbsp;<span class="ident" id="1671740">old</span><span class="op" id="1671743">.</span><span class="builtinfunc" id="1671744">len</span><span class="op" id="1671747">,</span>&nbsp;<span class="ident" id="1671749">newcap</span><span class="op" id="1671755">}</span><br>
<span class="lineno"></span><span class="op" id="1671757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1671760">func</span>&nbsp;<span class="ident" id="1671765">slicecopy</span><span class="op" id="1671774">(</span><span class="ident" id="1671775">to</span>&nbsp;<span class="ident" id="1671778">sliceStruct</span><span class="op" id="1671789">,</span>&nbsp;<span class="ident" id="1671791">fm</span>&nbsp;<span class="ident" id="1671794">sliceStruct</span><span class="op" id="1671805">,</span>&nbsp;<span class="ident" id="1671807">width</span>&nbsp;<span class="builtintype" id="1671813">uintptr</span><span class="op" id="1671820">)</span>&nbsp;<span class="builtintype" id="1671822">int</span>&nbsp;<span class="op" id="1671826">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671829">if</span>&nbsp;<span class="ident" id="1671832">fm</span><span class="op" id="1671834">.</span><span class="builtinfunc" id="1671835">len</span>&nbsp;<span class="op" id="1671839">==</span>&nbsp;<span class="num" id="1671842">0</span>&nbsp;<span class="op" id="1671844">||</span>&nbsp;<span class="ident" id="1671847">to</span><span class="op" id="1671849">.</span><span class="builtinfunc" id="1671850">len</span>&nbsp;<span class="op" id="1671854">==</span>&nbsp;<span class="num" id="1671857">0</span>&nbsp;<span class="op" id="1671859">||</span>&nbsp;<span class="ident" id="1671862">width</span>&nbsp;<span class="op" id="1671868">==</span>&nbsp;<span class="num" id="1671871">0</span>&nbsp;<span class="op" id="1671873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671877">return</span>&nbsp;<span class="num" id="1671884">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671891">n</span>&nbsp;<span class="op" id="1671893">:=</span>&nbsp;<span class="ident" id="1671896">fm</span><span class="op" id="1671898">.</span><span class="builtinfunc" id="1671899">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671904">if</span>&nbsp;<span class="ident" id="1671907">to</span><span class="op" id="1671909">.</span><span class="builtinfunc" id="1671910">len</span>&nbsp;<span class="op" id="1671914">&lt;</span>&nbsp;<span class="ident" id="1671916">n</span>&nbsp;<span class="op" id="1671918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671922">n</span>&nbsp;<span class="op" id="1671924">=</span>&nbsp;<span class="ident" id="1671926">to</span><span class="op" id="1671928">.</span><span class="builtinfunc" id="1671929">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671938">if</span>&nbsp;<span class="ident" id="1671941">raceenabled</span>&nbsp;<span class="op" id="1671953">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671957">callerpc</span>&nbsp;<span class="op" id="1671966">:=</span>&nbsp;<span class="ident" id="1671969">getcallerpc</span><span class="op" id="1671980">(</span><span class="ident" id="1671981">unsafe</span><span class="op" id="1671987">.</span><span class="ident" id="1671988">Pointer</span><span class="op" id="1671995">(</span><span class="op" id="1671996">&amp;</span><span class="ident" id="1671997">to</span><span class="op" id="1671999">)</span><span class="op" id="1672000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672004">pc</span>&nbsp;<span class="op" id="1672007">:=</span>&nbsp;<span class="ident" id="1672010">funcPC</span><span class="op" id="1672016">(</span><span class="ident" id="1672017">slicecopy</span><span class="op" id="1672026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672030">racewriterangepc</span><span class="op" id="1672046">(</span><span class="ident" id="1672047">to</span><span class="op" id="1672049">.</span><span class="ident" id="1672050">array</span><span class="op" id="1672055">,</span>&nbsp;<span class="builtintype" id="1672057">uintptr</span><span class="op" id="1672064">(</span><span class="ident" id="1672065">n</span><span class="op" id="1672066">*</span><span class="builtintype" id="1672067">int</span><span class="op" id="1672070">(</span><span class="ident" id="1672071">width</span><span class="op" id="1672076">)</span><span class="op" id="1672077">)</span><span class="op" id="1672078">,</span>&nbsp;<span class="ident" id="1672080">callerpc</span><span class="op" id="1672088">,</span>&nbsp;<span class="ident" id="1672090">pc</span><span class="op" id="1672092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672096">racereadrangepc</span><span class="op" id="1672111">(</span><span class="ident" id="1672112">fm</span><span class="op" id="1672114">.</span><span class="ident" id="1672115">array</span><span class="op" id="1672120">,</span>&nbsp;<span class="builtintype" id="1672122">uintptr</span><span class="op" id="1672129">(</span><span class="ident" id="1672130">n</span><span class="op" id="1672131">*</span><span class="builtintype" id="1672132">int</span><span class="op" id="1672135">(</span><span class="ident" id="1672136">width</span><span class="op" id="1672141">)</span><span class="op" id="1672142">)</span><span class="op" id="1672143">,</span>&nbsp;<span class="ident" id="1672145">callerpc</span><span class="op" id="1672153">,</span>&nbsp;<span class="ident" id="1672155">pc</span><span class="op" id="1672157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672160">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672164">size</span>&nbsp;<span class="op" id="1672169">:=</span>&nbsp;<span class="builtintype" id="1672172">uintptr</span><span class="op" id="1672179">(</span><span class="ident" id="1672180">n</span><span class="op" id="1672181">)</span>&nbsp;<span class="op" id="1672183">*</span>&nbsp;<span class="ident" id="1672185">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672192">if</span>&nbsp;<span class="ident" id="1672195">size</span>&nbsp;<span class="op" id="1672200">==</span>&nbsp;<span class="num" id="1672203">1</span>&nbsp;<span class="op" id="1672205">{</span>&nbsp;<span class="comment" id="1672207">//&nbsp;common&nbsp;case&nbsp;worth&nbsp;about&nbsp;2x&nbsp;to&nbsp;do&nbsp;here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1672250">//&nbsp;TODO:&nbsp;is&nbsp;this&nbsp;still&nbsp;worth&nbsp;it&nbsp;with&nbsp;new&nbsp;memmove&nbsp;impl?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672307">*</span><span class="op" id="1672308">(</span><span class="op" id="1672309">*</span><span class="builtintype" id="1672310">byte</span><span class="op" id="1672314">)</span><span class="op" id="1672315">(</span><span class="ident" id="1672316">to</span><span class="op" id="1672318">.</span><span class="ident" id="1672319">array</span><span class="op" id="1672324">)</span>&nbsp;<span class="op" id="1672326">=</span>&nbsp;<span class="op" id="1672328">*</span><span class="op" id="1672329">(</span><span class="op" id="1672330">*</span><span class="builtintype" id="1672331">byte</span><span class="op" id="1672335">)</span><span class="op" id="1672336">(</span><span class="ident" id="1672337">fm</span><span class="op" id="1672339">.</span><span class="ident" id="1672340">array</span><span class="op" id="1672345">)</span>&nbsp;<span class="comment" id="1672347">//&nbsp;known&nbsp;to&nbsp;be&nbsp;a&nbsp;byte&nbsp;pointer</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672378">}</span>&nbsp;<span class="keyword" id="1672380">else</span>&nbsp;<span class="op" id="1672385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672389">memmove</span><span class="op" id="1672396">(</span><span class="ident" id="1672397">to</span><span class="op" id="1672399">.</span><span class="ident" id="1672400">array</span><span class="op" id="1672405">,</span>&nbsp;<span class="ident" id="1672407">fm</span><span class="op" id="1672409">.</span><span class="ident" id="1672410">array</span><span class="op" id="1672415">,</span>&nbsp;<span class="ident" id="1672417">size</span><span class="op" id="1672421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672427">return</span>&nbsp;<span class="builtintype" id="1672434">int</span><span class="op" id="1672437">(</span><span class="ident" id="1672438">n</span><span class="op" id="1672439">)</span><br>
<span class="lineno"></span><span class="op" id="1672441">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="1672444">func</span>&nbsp;<span class="ident" id="1672449">slicestringcopy</span><span class="op" id="1672464">(</span><span class="ident" id="1672465">to</span>&nbsp;<span class="op" id="1672468">[</span><span class="op" id="1672469">]</span><span class="builtintype" id="1672470">byte</span><span class="op" id="1672474">,</span>&nbsp;<span class="ident" id="1672476">fm</span>&nbsp;<span class="builtintype" id="1672479">string</span><span class="op" id="1672485">)</span>&nbsp;<span class="builtintype" id="1672487">int</span>&nbsp;<span class="op" id="1672491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672494">if</span>&nbsp;<span class="builtinfunc" id="1672497">len</span><span class="op" id="1672500">(</span><span class="ident" id="1672501">fm</span><span class="op" id="1672503">)</span>&nbsp;<span class="op" id="1672505">==</span>&nbsp;<span class="num" id="1672508">0</span>&nbsp;<span class="op" id="1672510">||</span>&nbsp;<span class="builtinfunc" id="1672513">len</span><span class="op" id="1672516">(</span><span class="ident" id="1672517">to</span><span class="op" id="1672519">)</span>&nbsp;<span class="op" id="1672521">==</span>&nbsp;<span class="num" id="1672524">0</span>&nbsp;<span class="op" id="1672526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672530">return</span>&nbsp;<span class="num" id="1672537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672540">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672544">n</span>&nbsp;<span class="op" id="1672546">:=</span>&nbsp;<span class="builtinfunc" id="1672549">len</span><span class="op" id="1672552">(</span><span class="ident" id="1672553">fm</span><span class="op" id="1672555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672558">if</span>&nbsp;<span class="builtinfunc" id="1672561">len</span><span class="op" id="1672564">(</span><span class="ident" id="1672565">to</span><span class="op" id="1672567">)</span>&nbsp;<span class="op" id="1672569">&lt;</span>&nbsp;<span class="ident" id="1672571">n</span>&nbsp;<span class="op" id="1672573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672577">n</span>&nbsp;<span class="op" id="1672579">=</span>&nbsp;<span class="builtinfunc" id="1672581">len</span><span class="op" id="1672584">(</span><span class="ident" id="1672585">to</span><span class="op" id="1672587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672590">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672594">if</span>&nbsp;<span class="ident" id="1672597">raceenabled</span>&nbsp;<span class="op" id="1672609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672613">callerpc</span>&nbsp;<span class="op" id="1672622">:=</span>&nbsp;<span class="ident" id="1672625">getcallerpc</span><span class="op" id="1672636">(</span><span class="ident" id="1672637">unsafe</span><span class="op" id="1672643">.</span><span class="ident" id="1672644">Pointer</span><span class="op" id="1672651">(</span><span class="op" id="1672652">&amp;</span><span class="ident" id="1672653">to</span><span class="op" id="1672655">)</span><span class="op" id="1672656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672660">pc</span>&nbsp;<span class="op" id="1672663">:=</span>&nbsp;<span class="ident" id="1672666">funcPC</span><span class="op" id="1672672">(</span><span class="ident" id="1672673">slicestringcopy</span><span class="op" id="1672688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672692">racewriterangepc</span><span class="op" id="1672708">(</span><span class="ident" id="1672709">unsafe</span><span class="op" id="1672715">.</span><span class="ident" id="1672716">Pointer</span><span class="op" id="1672723">(</span><span class="op" id="1672724">&amp;</span><span class="ident" id="1672725">to</span><span class="op" id="1672727">[</span><span class="num" id="1672728">0</span><span class="op" id="1672729">]</span><span class="op" id="1672730">)</span><span class="op" id="1672731">,</span>&nbsp;<span class="builtintype" id="1672733">uintptr</span><span class="op" id="1672740">(</span><span class="ident" id="1672741">n</span><span class="op" id="1672742">)</span><span class="op" id="1672743">,</span>&nbsp;<span class="ident" id="1672745">callerpc</span><span class="op" id="1672753">,</span>&nbsp;<span class="ident" id="1672755">pc</span><span class="op" id="1672757">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1672760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1672764">memmove</span><span class="op" id="1672771">(</span><span class="ident" id="1672772">unsafe</span><span class="op" id="1672778">.</span><span class="ident" id="1672779">Pointer</span><span class="op" id="1672786">(</span><span class="op" id="1672787">&amp;</span><span class="ident" id="1672788">to</span><span class="op" id="1672790">[</span><span class="num" id="1672791">0</span><span class="op" id="1672792">]</span><span class="op" id="1672793">)</span><span class="op" id="1672794">,</span>&nbsp;<span class="ident" id="1672796">unsafe</span><span class="op" id="1672802">.</span><span class="ident" id="1672803">Pointer</span><span class="op" id="1672810">(</span><span class="op" id="1672811">(</span><span class="op" id="1672812">*</span><span class="ident" id="1672813">stringStruct</span><span class="op" id="1672825">)</span><span class="op" id="1672826">(</span><span class="ident" id="1672827">unsafe</span><span class="op" id="1672833">.</span><span class="ident" id="1672834">Pointer</span><span class="op" id="1672841">(</span><span class="op" id="1672842">&amp;</span><span class="ident" id="1672843">fm</span><span class="op" id="1672845">)</span><span class="op" id="1672846">)</span><span class="op" id="1672847">.</span><span class="ident" id="1672848">str</span><span class="op" id="1672851">)</span><span class="op" id="1672852">,</span>&nbsp;<span class="builtintype" id="1672854">uintptr</span><span class="op" id="1672861">(</span><span class="ident" id="1672862">n</span><span class="op" id="1672863">)</span><span class="op" id="1672864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1672867">return</span>&nbsp;<span class="ident" id="1672874">n</span><br>
<span class="lineno"></span><span class="op" id="1672876">}</span>
</div>
</body>
</html>
