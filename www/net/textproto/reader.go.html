<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3988086">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3988142">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3988196">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3988247">package</span>&nbsp;<span class="ident" id="3988255">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3988266">import</span>&nbsp;<span class="op" id="3988273">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3988276">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3988285">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3988294">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3988300">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3988313">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3988324">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3988334">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3988337">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3988402">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3988467">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3988517">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3988581">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3988638">type</span>&nbsp;<span class="ident" id="3988643">Reader</span>&nbsp;<span class="keyword" id="3988650">struct</span>&nbsp;<span class="op" id="3988657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988660">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3988664">*</span><span class="ident" id="3988665"><a href="/net/textproto/reader.go.html#3988276">bufio</a></span><span class="op" id="3988670">.</span><span class="ident" id="3988671">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988679">dot</span>&nbsp;<span class="op" id="3988683">*</span><span class="ident" id="3988684"><a href="/net/textproto/reader.go.html#3996264">dotReader</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3988695">buf</span>&nbsp;<span class="op" id="3988699">[</span><span class="op" id="3988700">]</span><span class="builtintype" id="3988701">byte</span>&nbsp;<span class="comment" id="3988706">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3988755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3988758">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3988808">func</span>&nbsp;<span class="ident" id="3988813">NewReader</span><span class="op" id="3988822">(</span><span class="ident" id="3988823">r</span>&nbsp;<span class="op" id="3988825">*</span><span class="ident" id="3988826"><a href="/net/textproto/reader.go.html#3988276">bufio</a></span><span class="op" id="3988831">.</span><span class="ident" id="3988832">Reader</span><span class="op" id="3988838">)</span>&nbsp;<span class="op" id="3988840">*</span><span class="ident" id="3988841"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span>&nbsp;<span class="op" id="3988848">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3988851">return</span>&nbsp;<span class="op" id="3988858">&amp;</span><span class="ident" id="3988859"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3988865">{</span><span class="ident" id="3988866">R</span><span class="op" id="3988867">:</span>&nbsp;<span class="ident" id="3988869"><a href="/net/textproto/reader.go.html#3988823">r</a></span><span class="op" id="3988870">}</span><br>
<span class="lineno"></span><span class="op" id="3988872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3988875">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3988915">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3988973">func</span>&nbsp;<span class="op" id="3988978">(</span><span class="ident" id="3988979">r</span>&nbsp;<span class="op" id="3988981">*</span><span class="ident" id="3988982"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3988988">)</span>&nbsp;<span class="ident" id="3988990">ReadLine</span><span class="op" id="3988998">(</span><span class="op" id="3988999">)</span>&nbsp;<span class="op" id="3989001">(</span><span class="builtintype" id="3989002">string</span><span class="op" id="3989008">,</span>&nbsp;<span class="builtintype" id="3989010">error</span><span class="op" id="3989015">)</span>&nbsp;<span class="op" id="3989017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989020">line</span><span class="op" id="3989024">,</span>&nbsp;<span class="ident" id="3989026">err</span>&nbsp;<span class="op" id="3989030">:=</span>&nbsp;<span class="ident" id="3989033"><a href="/net/textproto/reader.go.html#3988979">r</a></span><span class="op" id="3989034">.</span><span class="ident" id="3989035">readLineSlice</span><span class="op" id="3989048">(</span><span class="op" id="3989049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989052">return</span>&nbsp;<span class="builtintype" id="3989059">string</span><span class="op" id="3989065">(</span><span class="ident" id="3989066"><a href="/net/textproto/reader.go.html#3989020">line</a></span><span class="op" id="3989070">)</span><span class="op" id="3989071">,</span>&nbsp;<span class="ident" id="3989073"><a href="/net/textproto/reader.go.html#3989026">err</a></span><br>
<span class="lineno"></span><span class="op" id="3989077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3989080">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3989156">func</span>&nbsp;<span class="op" id="3989161">(</span><span class="ident" id="3989162">r</span>&nbsp;<span class="op" id="3989164">*</span><span class="ident" id="3989165"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3989171">)</span>&nbsp;<span class="ident" id="3989173">ReadLineBytes</span><span class="op" id="3989186">(</span><span class="op" id="3989187">)</span>&nbsp;<span class="op" id="3989189">(</span><span class="op" id="3989190">[</span><span class="op" id="3989191">]</span><span class="builtintype" id="3989192">byte</span><span class="op" id="3989196">,</span>&nbsp;<span class="builtintype" id="3989198">error</span><span class="op" id="3989203">)</span>&nbsp;<span class="op" id="3989205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989208">line</span><span class="op" id="3989212">,</span>&nbsp;<span class="ident" id="3989214">err</span>&nbsp;<span class="op" id="3989218">:=</span>&nbsp;<span class="ident" id="3989221"><a href="/net/textproto/reader.go.html#3989162">r</a></span><span class="op" id="3989222">.</span><span class="ident" id="3989223">readLineSlice</span><span class="op" id="3989236">(</span><span class="op" id="3989237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989240">if</span>&nbsp;<span class="ident" id="3989243"><a href="/net/textproto/reader.go.html#3989208">line</a></span>&nbsp;<span class="op" id="3989248">!=</span>&nbsp;<span class="ident" id="3989251">nil</span>&nbsp;<span class="op" id="3989255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989259">buf</span>&nbsp;<span class="op" id="3989263">:=</span>&nbsp;<span class="builtinfunc" id="3989266">make</span><span class="op" id="3989270">(</span><span class="op" id="3989271">[</span><span class="op" id="3989272">]</span><span class="builtintype" id="3989273">byte</span><span class="op" id="3989277">,</span>&nbsp;<span class="builtinfunc" id="3989279">len</span><span class="op" id="3989282">(</span><span class="ident" id="3989283"><a href="/net/textproto/reader.go.html#3989208">line</a></span><span class="op" id="3989287">)</span><span class="op" id="3989288">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3989292">copy</span><span class="op" id="3989296">(</span><span class="ident" id="3989297"><a href="/net/textproto/reader.go.html#3989259">buf</a></span><span class="op" id="3989300">,</span>&nbsp;<span class="ident" id="3989302"><a href="/net/textproto/reader.go.html#3989208">line</a></span><span class="op" id="3989306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989310"><a href="/net/textproto/reader.go.html#3989208">line</a></span>&nbsp;<span class="op" id="3989315">=</span>&nbsp;<span class="ident" id="3989317"><a href="/net/textproto/reader.go.html#3989259">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989325">return</span>&nbsp;<span class="ident" id="3989332"><a href="/net/textproto/reader.go.html#3989208">line</a></span><span class="op" id="3989336">,</span>&nbsp;<span class="ident" id="3989338"><a href="/net/textproto/reader.go.html#3989214">err</a></span><br>
<span class="lineno"></span><span class="op" id="3989342">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3989345">func</span>&nbsp;<span class="op" id="3989350">(</span><span class="ident" id="3989351">r</span>&nbsp;<span class="op" id="3989353">*</span><span class="ident" id="3989354"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3989360">)</span>&nbsp;<span class="ident" id="3989362">readLineSlice</span><span class="op" id="3989375">(</span><span class="op" id="3989376">)</span>&nbsp;<span class="op" id="3989378">(</span><span class="op" id="3989379">[</span><span class="op" id="3989380">]</span><span class="builtintype" id="3989381">byte</span><span class="op" id="3989385">,</span>&nbsp;<span class="builtintype" id="3989387">error</span><span class="op" id="3989392">)</span>&nbsp;<span class="op" id="3989394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989397"><a href="/net/textproto/reader.go.html#3989351">r</a></span><span class="op" id="3989398">.</span><span class="ident" id="3989399">closeDot</span><span class="op" id="3989407">(</span><span class="op" id="3989408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989411">var</span>&nbsp;<span class="ident" id="3989415">line</span>&nbsp;<span class="op" id="3989420">[</span><span class="op" id="3989421">]</span><span class="builtintype" id="3989422">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989428">for</span>&nbsp;<span class="op" id="3989432">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989436">l</span><span class="op" id="3989437">,</span>&nbsp;<span class="ident" id="3989439">more</span><span class="op" id="3989443">,</span>&nbsp;<span class="ident" id="3989445">err</span>&nbsp;<span class="op" id="3989449">:=</span>&nbsp;<span class="ident" id="3989452"><a href="/net/textproto/reader.go.html#3989351">r</a></span><span class="op" id="3989453">.</span><span class="ident" id="3989454">R</span><span class="op" id="3989455">.</span><span class="ident" id="3989456">ReadLine</span><span class="op" id="3989464">(</span><span class="op" id="3989465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989469">if</span>&nbsp;<span class="ident" id="3989472"><a href="/net/textproto/reader.go.html#3989445">err</a></span>&nbsp;<span class="op" id="3989476">!=</span>&nbsp;<span class="ident" id="3989479">nil</span>&nbsp;<span class="op" id="3989483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989488">return</span>&nbsp;<span class="ident" id="3989495">nil</span><span class="op" id="3989498">,</span>&nbsp;<span class="ident" id="3989500"><a href="/net/textproto/reader.go.html#3989445">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3989510">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989570">if</span>&nbsp;<span class="ident" id="3989573"><a href="/net/textproto/reader.go.html#3989415">line</a></span>&nbsp;<span class="op" id="3989578">==</span>&nbsp;<span class="ident" id="3989581">nil</span>&nbsp;<span class="op" id="3989585">&amp;&amp;</span>&nbsp;<span class="op" id="3989588">!</span><span class="ident" id="3989589"><a href="/net/textproto/reader.go.html#3989439">more</a></span>&nbsp;<span class="op" id="3989594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989599">return</span>&nbsp;<span class="ident" id="3989606"><a href="/net/textproto/reader.go.html#3989436">l</a></span><span class="op" id="3989607">,</span>&nbsp;<span class="ident" id="3989609">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3989619"><a href="/net/textproto/reader.go.html#3989415">line</a></span>&nbsp;<span class="op" id="3989624">=</span>&nbsp;<span class="builtinfunc" id="3989626">append</span><span class="op" id="3989632">(</span><span class="ident" id="3989633"><a href="/net/textproto/reader.go.html#3989415">line</a></span><span class="op" id="3989637">,</span>&nbsp;<span class="ident" id="3989639"><a href="/net/textproto/reader.go.html#3989436">l</a></span><span class="op" id="3989640">...</span><span class="op" id="3989643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989647">if</span>&nbsp;<span class="op" id="3989650">!</span><span class="ident" id="3989651"><a href="/net/textproto/reader.go.html#3989439">more</a></span>&nbsp;<span class="op" id="3989656">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989661">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3989672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3989675">return</span>&nbsp;<span class="ident" id="3989682"><a href="/net/textproto/reader.go.html#3989415">line</a></span><span class="op" id="3989686">,</span>&nbsp;<span class="ident" id="3989688">nil</span><br>
<span class="lineno"></span><span class="op" id="3989692">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3989695">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3989756">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3989805">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3989867">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3989930">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3989989">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3990052">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3990068">//</span><br>
<span class="lineno"></span><span class="comment" id="3990071">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3990108">//</span><br>
<span class="lineno"></span><span class="comment" id="3990111">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3990121">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3990139">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3990149">//</span><br>
<span class="lineno">85</span><span class="comment" id="3990152">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3990225">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3990265">//</span><br>
<span class="lineno"></span><span class="comment" id="3990268">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3990329">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3990332">func</span>&nbsp;<span class="op" id="3990337">(</span><span class="ident" id="3990338">r</span>&nbsp;<span class="op" id="3990340">*</span><span class="ident" id="3990341"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3990347">)</span>&nbsp;<span class="ident" id="3990349">ReadContinuedLine</span><span class="op" id="3990366">(</span><span class="op" id="3990367">)</span>&nbsp;<span class="op" id="3990369">(</span><span class="builtintype" id="3990370">string</span><span class="op" id="3990376">,</span>&nbsp;<span class="builtintype" id="3990378">error</span><span class="op" id="3990383">)</span>&nbsp;<span class="op" id="3990385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990388">line</span><span class="op" id="3990392">,</span>&nbsp;<span class="ident" id="3990394">err</span>&nbsp;<span class="op" id="3990398">:=</span>&nbsp;<span class="ident" id="3990401"><a href="/net/textproto/reader.go.html#3990338">r</a></span><span class="op" id="3990402">.</span><span class="ident" id="3990403">readContinuedLineSlice</span><span class="op" id="3990425">(</span><span class="op" id="3990426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990429">return</span>&nbsp;<span class="builtintype" id="3990436">string</span><span class="op" id="3990442">(</span><span class="ident" id="3990443"><a href="/net/textproto/reader.go.html#3990388">line</a></span><span class="op" id="3990447">)</span><span class="op" id="3990448">,</span>&nbsp;<span class="ident" id="3990450"><a href="/net/textproto/reader.go.html#3990394">err</a></span><br>
<span class="lineno"></span><span class="op" id="3990454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3990457">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3990526">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3990566">func</span>&nbsp;<span class="ident" id="3990571">trim</span><span class="op" id="3990575">(</span><span class="ident" id="3990576">s</span>&nbsp;<span class="op" id="3990578">[</span><span class="op" id="3990579">]</span><span class="builtintype" id="3990580">byte</span><span class="op" id="3990584">)</span>&nbsp;<span class="op" id="3990586">[</span><span class="op" id="3990587">]</span><span class="builtintype" id="3990588">byte</span>&nbsp;<span class="op" id="3990593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990596">i</span>&nbsp;<span class="op" id="3990598">:=</span>&nbsp;<span class="num" id="3990601">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990604">for</span>&nbsp;<span class="ident" id="3990608"><a href="/net/textproto/reader.go.html#3990596">i</a></span>&nbsp;<span class="op" id="3990610">&lt;</span>&nbsp;<span class="builtinfunc" id="3990612">len</span><span class="op" id="3990615">(</span><span class="ident" id="3990616"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990617">)</span>&nbsp;<span class="op" id="3990619">&amp;&amp;</span>&nbsp;<span class="op" id="3990622">(</span><span class="ident" id="3990623"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990624">[</span><span class="ident" id="3990625"><a href="/net/textproto/reader.go.html#3990596">i</a></span><span class="op" id="3990626">]</span>&nbsp;<span class="op" id="3990628">==</span>&nbsp;<span class="string" id="3990631">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3990635">||</span>&nbsp;<span class="ident" id="3990638"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990639">[</span><span class="ident" id="3990640"><a href="/net/textproto/reader.go.html#3990596">i</a></span><span class="op" id="3990641">]</span>&nbsp;<span class="op" id="3990643">==</span>&nbsp;<span class="string" id="3990646">&#39;\t&#39;</span><span class="op" id="3990650">)</span>&nbsp;<span class="op" id="3990652">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990656"><a href="/net/textproto/reader.go.html#3990596">i</a></span><span class="op" id="3990657">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990664">n</span>&nbsp;<span class="op" id="3990666">:=</span>&nbsp;<span class="builtinfunc" id="3990669">len</span><span class="op" id="3990672">(</span><span class="ident" id="3990673"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990677">for</span>&nbsp;<span class="ident" id="3990681"><a href="/net/textproto/reader.go.html#3990664">n</a></span>&nbsp;<span class="op" id="3990683">&gt;</span>&nbsp;<span class="ident" id="3990685"><a href="/net/textproto/reader.go.html#3990596">i</a></span>&nbsp;<span class="op" id="3990687">&amp;&amp;</span>&nbsp;<span class="op" id="3990690">(</span><span class="ident" id="3990691"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990692">[</span><span class="ident" id="3990693"><a href="/net/textproto/reader.go.html#3990664">n</a></span><span class="op" id="3990694">-</span><span class="num" id="3990695">1</span><span class="op" id="3990696">]</span>&nbsp;<span class="op" id="3990698">==</span>&nbsp;<span class="string" id="3990701">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3990705">||</span>&nbsp;<span class="ident" id="3990708"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990709">[</span><span class="ident" id="3990710"><a href="/net/textproto/reader.go.html#3990664">n</a></span><span class="op" id="3990711">-</span><span class="num" id="3990712">1</span><span class="op" id="3990713">]</span>&nbsp;<span class="op" id="3990715">==</span>&nbsp;<span class="string" id="3990718">&#39;\t&#39;</span><span class="op" id="3990722">)</span>&nbsp;<span class="op" id="3990724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990728"><a href="/net/textproto/reader.go.html#3990664">n</a></span><span class="op" id="3990729">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3990733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990736">return</span>&nbsp;<span class="ident" id="3990743"><a href="/net/textproto/reader.go.html#3990576">s</a></span><span class="op" id="3990744">[</span><span class="ident" id="3990745"><a href="/net/textproto/reader.go.html#3990596">i</a></span><span class="op" id="3990746">:</span><span class="ident" id="3990747"><a href="/net/textproto/reader.go.html#3990664">n</a></span><span class="op" id="3990748">]</span><br>
<span class="lineno"></span><span class="op" id="3990750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3990753">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3990809">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3990850">func</span>&nbsp;<span class="op" id="3990855">(</span><span class="ident" id="3990856">r</span>&nbsp;<span class="op" id="3990858">*</span><span class="ident" id="3990859"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3990865">)</span>&nbsp;<span class="ident" id="3990867">ReadContinuedLineBytes</span><span class="op" id="3990889">(</span><span class="op" id="3990890">)</span>&nbsp;<span class="op" id="3990892">(</span><span class="op" id="3990893">[</span><span class="op" id="3990894">]</span><span class="builtintype" id="3990895">byte</span><span class="op" id="3990899">,</span>&nbsp;<span class="builtintype" id="3990901">error</span><span class="op" id="3990906">)</span>&nbsp;<span class="op" id="3990908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990911">line</span><span class="op" id="3990915">,</span>&nbsp;<span class="ident" id="3990917">err</span>&nbsp;<span class="op" id="3990921">:=</span>&nbsp;<span class="ident" id="3990924"><a href="/net/textproto/reader.go.html#3990856">r</a></span><span class="op" id="3990925">.</span><span class="ident" id="3990926">readContinuedLineSlice</span><span class="op" id="3990948">(</span><span class="op" id="3990949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3990952">if</span>&nbsp;<span class="ident" id="3990955"><a href="/net/textproto/reader.go.html#3990911">line</a></span>&nbsp;<span class="op" id="3990960">!=</span>&nbsp;<span class="ident" id="3990963">nil</span>&nbsp;<span class="op" id="3990967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3990971">buf</span>&nbsp;<span class="op" id="3990975">:=</span>&nbsp;<span class="builtinfunc" id="3990978">make</span><span class="op" id="3990982">(</span><span class="op" id="3990983">[</span><span class="op" id="3990984">]</span><span class="builtintype" id="3990985">byte</span><span class="op" id="3990989">,</span>&nbsp;<span class="builtinfunc" id="3990991">len</span><span class="op" id="3990994">(</span><span class="ident" id="3990995"><a href="/net/textproto/reader.go.html#3990911">line</a></span><span class="op" id="3990999">)</span><span class="op" id="3991000">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3991004">copy</span><span class="op" id="3991008">(</span><span class="ident" id="3991009"><a href="/net/textproto/reader.go.html#3990971">buf</a></span><span class="op" id="3991012">,</span>&nbsp;<span class="ident" id="3991014"><a href="/net/textproto/reader.go.html#3990911">line</a></span><span class="op" id="3991018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991022"><a href="/net/textproto/reader.go.html#3990911">line</a></span>&nbsp;<span class="op" id="3991027">=</span>&nbsp;<span class="ident" id="3991029"><a href="/net/textproto/reader.go.html#3990971">buf</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991037">return</span>&nbsp;<span class="ident" id="3991044"><a href="/net/textproto/reader.go.html#3990911">line</a></span><span class="op" id="3991048">,</span>&nbsp;<span class="ident" id="3991050"><a href="/net/textproto/reader.go.html#3990917">err</a></span><br>
<span class="lineno"></span><span class="op" id="3991054">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3991057">func</span>&nbsp;<span class="op" id="3991062">(</span><span class="ident" id="3991063">r</span>&nbsp;<span class="op" id="3991065">*</span><span class="ident" id="3991066"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3991072">)</span>&nbsp;<span class="ident" id="3991074">readContinuedLineSlice</span><span class="op" id="3991096">(</span><span class="op" id="3991097">)</span>&nbsp;<span class="op" id="3991099">(</span><span class="op" id="3991100">[</span><span class="op" id="3991101">]</span><span class="builtintype" id="3991102">byte</span><span class="op" id="3991106">,</span>&nbsp;<span class="builtintype" id="3991108">error</span><span class="op" id="3991113">)</span>&nbsp;<span class="op" id="3991115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991118">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991143">line</span><span class="op" id="3991147">,</span>&nbsp;<span class="ident" id="3991149">err</span>&nbsp;<span class="op" id="3991153">:=</span>&nbsp;<span class="ident" id="3991156"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991157">.</span><span class="ident" id="3991158">readLineSlice</span><span class="op" id="3991171">(</span><span class="op" id="3991172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991175">if</span>&nbsp;<span class="ident" id="3991178"><a href="/net/textproto/reader.go.html#3991149">err</a></span>&nbsp;<span class="op" id="3991182">!=</span>&nbsp;<span class="ident" id="3991185">nil</span>&nbsp;<span class="op" id="3991189">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991193">return</span>&nbsp;<span class="ident" id="3991200">nil</span><span class="op" id="3991203">,</span>&nbsp;<span class="ident" id="3991205"><a href="/net/textproto/reader.go.html#3991149">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991213">if</span>&nbsp;<span class="builtinfunc" id="3991216">len</span><span class="op" id="3991219">(</span><span class="ident" id="3991220"><a href="/net/textproto/reader.go.html#3991143">line</a></span><span class="op" id="3991224">)</span>&nbsp;<span class="op" id="3991226">==</span>&nbsp;<span class="num" id="3991229">0</span>&nbsp;<span class="op" id="3991231">{</span>&nbsp;<span class="comment" id="3991233">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991267">return</span>&nbsp;<span class="ident" id="3991274"><a href="/net/textproto/reader.go.html#3991143">line</a></span><span class="op" id="3991278">,</span>&nbsp;<span class="ident" id="3991280">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991285">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991289">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991360">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991432">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991504">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991533">if</span>&nbsp;<span class="ident" id="3991536"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991537">.</span><span class="ident" id="3991538">R</span><span class="op" id="3991539">.</span><span class="ident" id="3991540">Buffered</span><span class="op" id="3991548">(</span><span class="op" id="3991549">)</span>&nbsp;<span class="op" id="3991551">&gt;</span>&nbsp;<span class="num" id="3991553">1</span>&nbsp;<span class="op" id="3991555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991559">peek</span><span class="op" id="3991563">,</span>&nbsp;<span class="ident" id="3991565">err</span>&nbsp;<span class="op" id="3991569">:=</span>&nbsp;<span class="ident" id="3991572"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991573">.</span><span class="ident" id="3991574">R</span><span class="op" id="3991575">.</span><span class="ident" id="3991576">Peek</span><span class="op" id="3991580">(</span><span class="num" id="3991581">1</span><span class="op" id="3991582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991586">if</span>&nbsp;<span class="ident" id="3991589"><a href="/net/textproto/reader.go.html#3991565">err</a></span>&nbsp;<span class="op" id="3991593">==</span>&nbsp;<span class="ident" id="3991596">nil</span>&nbsp;<span class="op" id="3991600">&amp;&amp;</span>&nbsp;<span class="ident" id="3991603"><a href="/net/textproto/textproto.go.html#4008068">isASCIILetter</a></span><span class="op" id="3991616">(</span><span class="ident" id="3991617"><a href="/net/textproto/reader.go.html#3991559">peek</a></span><span class="op" id="3991621">[</span><span class="num" id="3991622">0</span><span class="op" id="3991623">]</span><span class="op" id="3991624">)</span>&nbsp;<span class="op" id="3991626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991631">return</span>&nbsp;<span class="ident" id="3991638"><a href="/net/textproto/reader.go.html#3990571">trim</a></span><span class="op" id="3991642">(</span><span class="ident" id="3991643"><a href="/net/textproto/reader.go.html#3991143">line</a></span><span class="op" id="3991647">)</span><span class="op" id="3991648">,</span>&nbsp;<span class="ident" id="3991650">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991656">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991663">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991730">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991759"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991760">.</span><span class="ident" id="3991761">buf</span>&nbsp;<span class="op" id="3991765">=</span>&nbsp;<span class="builtinfunc" id="3991767">append</span><span class="op" id="3991773">(</span><span class="ident" id="3991774"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991775">.</span><span class="ident" id="3991776">buf</span><span class="op" id="3991779">[</span><span class="op" id="3991780">:</span><span class="num" id="3991781">0</span><span class="op" id="3991782">]</span><span class="op" id="3991783">,</span>&nbsp;<span class="ident" id="3991785"><a href="/net/textproto/reader.go.html#3990571">trim</a></span><span class="op" id="3991789">(</span><span class="ident" id="3991790"><a href="/net/textproto/reader.go.html#3991143">line</a></span><span class="op" id="3991794">)</span><span class="op" id="3991795">...</span><span class="op" id="3991798">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3991802">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991831">for</span>&nbsp;<span class="ident" id="3991835"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991836">.</span><span class="ident" id="3991837">skipSpace</span><span class="op" id="3991846">(</span><span class="op" id="3991847">)</span>&nbsp;<span class="op" id="3991849">&gt;</span>&nbsp;<span class="num" id="3991851">0</span>&nbsp;<span class="op" id="3991853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991857">line</span><span class="op" id="3991861">,</span>&nbsp;<span class="ident" id="3991863">err</span>&nbsp;<span class="op" id="3991867">:=</span>&nbsp;<span class="ident" id="3991870"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991871">.</span><span class="ident" id="3991872">readLineSlice</span><span class="op" id="3991885">(</span><span class="op" id="3991886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991890">if</span>&nbsp;<span class="ident" id="3991893"><a href="/net/textproto/reader.go.html#3991863">err</a></span>&nbsp;<span class="op" id="3991897">!=</span>&nbsp;<span class="ident" id="3991900">nil</span>&nbsp;<span class="op" id="3991904">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991909">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991921"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991922">.</span><span class="ident" id="3991923">buf</span>&nbsp;<span class="op" id="3991927">=</span>&nbsp;<span class="builtinfunc" id="3991929">append</span><span class="op" id="3991935">(</span><span class="ident" id="3991936"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991937">.</span><span class="ident" id="3991938">buf</span><span class="op" id="3991941">,</span>&nbsp;<span class="string" id="3991943">&#39;&nbsp;&#39;</span><span class="op" id="3991946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3991950"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991951">.</span><span class="ident" id="3991952">buf</span>&nbsp;<span class="op" id="3991956">=</span>&nbsp;<span class="builtinfunc" id="3991958">append</span><span class="op" id="3991964">(</span><span class="ident" id="3991965"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991966">.</span><span class="ident" id="3991967">buf</span><span class="op" id="3991970">,</span>&nbsp;<span class="ident" id="3991972"><a href="/net/textproto/reader.go.html#3991857">line</a></span><span class="op" id="3991976">...</span><span class="op" id="3991979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3991982">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3991985">return</span>&nbsp;<span class="ident" id="3991992"><a href="/net/textproto/reader.go.html#3991063">r</a></span><span class="op" id="3991993">.</span><span class="ident" id="3991994">buf</span><span class="op" id="3991997">,</span>&nbsp;<span class="ident" id="3991999">nil</span><br>
<span class="lineno"></span><span class="op" id="3992003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3992006">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3992084">func</span>&nbsp;<span class="op" id="3992089">(</span><span class="ident" id="3992090">r</span>&nbsp;<span class="op" id="3992092">*</span><span class="ident" id="3992093"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3992099">)</span>&nbsp;<span class="ident" id="3992101">skipSpace</span><span class="op" id="3992110">(</span><span class="op" id="3992111">)</span>&nbsp;<span class="builtintype" id="3992113">int</span>&nbsp;<span class="op" id="3992117">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992120">n</span>&nbsp;<span class="op" id="3992122">:=</span>&nbsp;<span class="num" id="3992125">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992128">for</span>&nbsp;<span class="op" id="3992132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992136">c</span><span class="op" id="3992137">,</span>&nbsp;<span class="ident" id="3992139">err</span>&nbsp;<span class="op" id="3992143">:=</span>&nbsp;<span class="ident" id="3992146"><a href="/net/textproto/reader.go.html#3992090">r</a></span><span class="op" id="3992147">.</span><span class="ident" id="3992148">R</span><span class="op" id="3992149">.</span><span class="ident" id="3992150">ReadByte</span><span class="op" id="3992158">(</span><span class="op" id="3992159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992163">if</span>&nbsp;<span class="ident" id="3992166"><a href="/net/textproto/reader.go.html#3992139">err</a></span>&nbsp;<span class="op" id="3992170">!=</span>&nbsp;<span class="ident" id="3992173">nil</span>&nbsp;<span class="op" id="3992177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3992182">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992225">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992237">if</span>&nbsp;<span class="ident" id="3992240"><a href="/net/textproto/reader.go.html#3992136">c</a></span>&nbsp;<span class="op" id="3992242">!=</span>&nbsp;<span class="string" id="3992245">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3992249">&amp;&amp;</span>&nbsp;<span class="ident" id="3992252"><a href="/net/textproto/reader.go.html#3992136">c</a></span>&nbsp;<span class="op" id="3992254">!=</span>&nbsp;<span class="string" id="3992257">&#39;\t&#39;</span>&nbsp;<span class="op" id="3992262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992267"><a href="/net/textproto/reader.go.html#3992090">r</a></span><span class="op" id="3992268">.</span><span class="ident" id="3992269">R</span><span class="op" id="3992270">.</span><span class="ident" id="3992271">UnreadByte</span><span class="op" id="3992281">(</span><span class="op" id="3992282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992287">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992299"><a href="/net/textproto/reader.go.html#3992120">n</a></span><span class="op" id="3992300">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992307">return</span>&nbsp;<span class="ident" id="3992314"><a href="/net/textproto/reader.go.html#3992120">n</a></span><br>
<span class="lineno"></span><span class="op" id="3992316">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3992319">func</span>&nbsp;<span class="op" id="3992324">(</span><span class="ident" id="3992325">r</span>&nbsp;<span class="op" id="3992327">*</span><span class="ident" id="3992328"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3992334">)</span>&nbsp;<span class="ident" id="3992336">readCodeLine</span><span class="op" id="3992348">(</span><span class="ident" id="3992349">expectCode</span>&nbsp;<span class="builtintype" id="3992360">int</span><span class="op" id="3992363">)</span>&nbsp;<span class="op" id="3992365">(</span><span class="ident" id="3992366">code</span>&nbsp;<span class="builtintype" id="3992371">int</span><span class="op" id="3992374">,</span>&nbsp;<span class="ident" id="3992376">continued</span>&nbsp;<span class="builtintype" id="3992386">bool</span><span class="op" id="3992390">,</span>&nbsp;<span class="ident" id="3992392">message</span>&nbsp;<span class="builtintype" id="3992400">string</span><span class="op" id="3992406">,</span>&nbsp;<span class="ident" id="3992408">err</span>&nbsp;<span class="builtintype" id="3992412">error</span><span class="op" id="3992417">)</span>&nbsp;<span class="op" id="3992419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992422">line</span><span class="op" id="3992426">,</span>&nbsp;<span class="ident" id="3992428"><a href="/net/textproto/reader.go.html#3992408">err</a></span>&nbsp;<span class="op" id="3992432">:=</span>&nbsp;<span class="ident" id="3992435"><a href="/net/textproto/reader.go.html#3992325">r</a></span><span class="op" id="3992436">.</span><span class="ident" id="3992437">ReadLine</span><span class="op" id="3992445">(</span><span class="op" id="3992446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992449">if</span>&nbsp;<span class="ident" id="3992452"><a href="/net/textproto/reader.go.html#3992408">err</a></span>&nbsp;<span class="op" id="3992456">!=</span>&nbsp;<span class="ident" id="3992459">nil</span>&nbsp;<span class="op" id="3992463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992467">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992478">return</span>&nbsp;<span class="ident" id="3992485"><a href="/net/textproto/reader.go.html#3992525">parseCodeLine</a></span><span class="op" id="3992498">(</span><span class="ident" id="3992499"><a href="/net/textproto/reader.go.html#3992422">line</a></span><span class="op" id="3992503">,</span>&nbsp;<span class="ident" id="3992505"><a href="/net/textproto/reader.go.html#3992349">expectCode</a></span><span class="op" id="3992515">)</span><br>
<span class="lineno"></span><span class="op" id="3992517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3992520">func</span>&nbsp;<span class="ident" id="3992525">parseCodeLine</span><span class="op" id="3992538">(</span><span class="ident" id="3992539">line</span>&nbsp;<span class="builtintype" id="3992544">string</span><span class="op" id="3992550">,</span>&nbsp;<span class="ident" id="3992552">expectCode</span>&nbsp;<span class="builtintype" id="3992563">int</span><span class="op" id="3992566">)</span>&nbsp;<span class="op" id="3992568">(</span><span class="ident" id="3992569">code</span>&nbsp;<span class="builtintype" id="3992574">int</span><span class="op" id="3992577">,</span>&nbsp;<span class="ident" id="3992579">continued</span>&nbsp;<span class="builtintype" id="3992589">bool</span><span class="op" id="3992593">,</span>&nbsp;<span class="ident" id="3992595">message</span>&nbsp;<span class="builtintype" id="3992603">string</span><span class="op" id="3992609">,</span>&nbsp;<span class="ident" id="3992611">err</span>&nbsp;<span class="builtintype" id="3992615">error</span><span class="op" id="3992620">)</span>&nbsp;<span class="op" id="3992622">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992625">if</span>&nbsp;<span class="builtinfunc" id="3992628">len</span><span class="op" id="3992631">(</span><span class="ident" id="3992632"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992636">)</span>&nbsp;<span class="op" id="3992638">&lt;</span>&nbsp;<span class="num" id="3992640">4</span>&nbsp;<span class="op" id="3992642">||</span>&nbsp;<span class="ident" id="3992645"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992649">[</span><span class="num" id="3992650">3</span><span class="op" id="3992651">]</span>&nbsp;<span class="op" id="3992653">!=</span>&nbsp;<span class="string" id="3992656">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3992660">&amp;&amp;</span>&nbsp;<span class="ident" id="3992663"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992667">[</span><span class="num" id="3992668">3</span><span class="op" id="3992669">]</span>&nbsp;<span class="op" id="3992671">!=</span>&nbsp;<span class="string" id="3992674">&#39;-&#39;</span>&nbsp;<span class="op" id="3992678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992682"><a href="/net/textproto/reader.go.html#3992611">err</a></span>&nbsp;<span class="op" id="3992686">=</span>&nbsp;<span class="ident" id="3992688"><a href="/net/textproto/textproto.go.html#4005580">ProtocolError</a></span><span class="op" id="3992701">(</span><span class="string" id="3992702">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3992721">+</span>&nbsp;<span class="ident" id="3992723"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992731">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992742"><a href="/net/textproto/reader.go.html#3992579">continued</a></span>&nbsp;<span class="op" id="3992752">=</span>&nbsp;<span class="ident" id="3992754"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992758">[</span><span class="num" id="3992759">3</span><span class="op" id="3992760">]</span>&nbsp;<span class="op" id="3992762">==</span>&nbsp;<span class="string" id="3992765">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992770"><a href="/net/textproto/reader.go.html#3992569">code</a></span><span class="op" id="3992774">,</span>&nbsp;<span class="ident" id="3992776"><a href="/net/textproto/reader.go.html#3992611">err</a></span>&nbsp;<span class="op" id="3992780">=</span>&nbsp;<span class="ident" id="3992782"><a href="/net/textproto/reader.go.html#3988313">strconv</a></span><span class="op" id="3992789">.</span><span class="ident" id="3992790">Atoi</span><span class="op" id="3992794">(</span><span class="ident" id="3992795"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992799">[</span><span class="num" id="3992800">0</span><span class="op" id="3992801">:</span><span class="num" id="3992802">3</span><span class="op" id="3992803">]</span><span class="op" id="3992804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992807">if</span>&nbsp;<span class="ident" id="3992810"><a href="/net/textproto/reader.go.html#3992611">err</a></span>&nbsp;<span class="op" id="3992814">!=</span>&nbsp;<span class="ident" id="3992817">nil</span>&nbsp;<span class="op" id="3992821">||</span>&nbsp;<span class="ident" id="3992824"><a href="/net/textproto/reader.go.html#3992569">code</a></span>&nbsp;<span class="op" id="3992829">&lt;</span>&nbsp;<span class="num" id="3992831">100</span>&nbsp;<span class="op" id="3992835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992839"><a href="/net/textproto/reader.go.html#3992611">err</a></span>&nbsp;<span class="op" id="3992843">=</span>&nbsp;<span class="ident" id="3992845"><a href="/net/textproto/textproto.go.html#4005580">ProtocolError</a></span><span class="op" id="3992858">(</span><span class="string" id="3992859">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3992885">+</span>&nbsp;<span class="ident" id="3992887"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992895">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3992903">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3992906"><a href="/net/textproto/reader.go.html#3992595">message</a></span>&nbsp;<span class="op" id="3992914">=</span>&nbsp;<span class="ident" id="3992916"><a href="/net/textproto/reader.go.html#3992539">line</a></span><span class="op" id="3992920">[</span><span class="num" id="3992921">4</span><span class="op" id="3992922">:</span><span class="op" id="3992923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3992926">if</span>&nbsp;<span class="num" id="3992929">1</span>&nbsp;<span class="op" id="3992931">&lt;=</span>&nbsp;<span class="ident" id="3992934"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3992945">&amp;&amp;</span>&nbsp;<span class="ident" id="3992948"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3992959">&lt;</span>&nbsp;<span class="num" id="3992961">10</span>&nbsp;<span class="op" id="3992964">&amp;&amp;</span>&nbsp;<span class="ident" id="3992967"><a href="/net/textproto/reader.go.html#3992569">code</a></span><span class="op" id="3992971">/</span><span class="num" id="3992972">100</span>&nbsp;<span class="op" id="3992976">!=</span>&nbsp;<span class="ident" id="3992979"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3992990">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3992995">10</span>&nbsp;<span class="op" id="3992998">&lt;=</span>&nbsp;<span class="ident" id="3993001"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3993012">&amp;&amp;</span>&nbsp;<span class="ident" id="3993015"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3993026">&lt;</span>&nbsp;<span class="num" id="3993028">100</span>&nbsp;<span class="op" id="3993032">&amp;&amp;</span>&nbsp;<span class="ident" id="3993035"><a href="/net/textproto/reader.go.html#3992569">code</a></span><span class="op" id="3993039">/</span><span class="num" id="3993040">10</span>&nbsp;<span class="op" id="3993043">!=</span>&nbsp;<span class="ident" id="3993046"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3993057">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3993062">100</span>&nbsp;<span class="op" id="3993066">&lt;=</span>&nbsp;<span class="ident" id="3993069"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3993080">&amp;&amp;</span>&nbsp;<span class="ident" id="3993083"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3993094">&lt;</span>&nbsp;<span class="num" id="3993096">1000</span>&nbsp;<span class="op" id="3993101">&amp;&amp;</span>&nbsp;<span class="ident" id="3993104"><a href="/net/textproto/reader.go.html#3992569">code</a></span>&nbsp;<span class="op" id="3993109">!=</span>&nbsp;<span class="ident" id="3993112"><a href="/net/textproto/reader.go.html#3992552">expectCode</a></span>&nbsp;<span class="op" id="3993123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993127"><a href="/net/textproto/reader.go.html#3992611">err</a></span>&nbsp;<span class="op" id="3993131">=</span>&nbsp;<span class="op" id="3993133">&amp;</span><span class="ident" id="3993134"><a href="/net/textproto/textproto.go.html#4005346">Error</a></span><span class="op" id="3993139">{</span><span class="ident" id="3993140"><a href="/net/textproto/reader.go.html#3992569">code</a></span><span class="op" id="3993144">,</span>&nbsp;<span class="ident" id="3993146"><a href="/net/textproto/reader.go.html#3992595">message</a></span><span class="op" id="3993153">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3993156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993159">return</span><br>
<span class="lineno"></span><span class="op" id="3993166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3993169">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3993224">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3993240">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3993299">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3993366">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3993399">//</span><br>
<span class="lineno">210</span><span class="comment" id="3993402">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3993474">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3993537">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3993603">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3993648">//</span><br>
<span class="lineno">215</span><span class="comment" id="3993651">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3993716">//</span><br>
<span class="lineno"></span><span class="comment" id="3993719">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3993780">//</span><br>
<span class="lineno"></span><span class="keyword" id="3993783">func</span>&nbsp;<span class="op" id="3993788">(</span><span class="ident" id="3993789">r</span>&nbsp;<span class="op" id="3993791">*</span><span class="ident" id="3993792"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3993798">)</span>&nbsp;<span class="ident" id="3993800">ReadCodeLine</span><span class="op" id="3993812">(</span><span class="ident" id="3993813">expectCode</span>&nbsp;<span class="builtintype" id="3993824">int</span><span class="op" id="3993827">)</span>&nbsp;<span class="op" id="3993829">(</span><span class="ident" id="3993830">code</span>&nbsp;<span class="builtintype" id="3993835">int</span><span class="op" id="3993838">,</span>&nbsp;<span class="ident" id="3993840">message</span>&nbsp;<span class="builtintype" id="3993848">string</span><span class="op" id="3993854">,</span>&nbsp;<span class="ident" id="3993856">err</span>&nbsp;<span class="builtintype" id="3993860">error</span><span class="op" id="3993865">)</span>&nbsp;<span class="op" id="3993867">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993870"><a href="/net/textproto/reader.go.html#3993830">code</a></span><span class="op" id="3993874">,</span>&nbsp;<span class="ident" id="3993876">continued</span><span class="op" id="3993885">,</span>&nbsp;<span class="ident" id="3993887"><a href="/net/textproto/reader.go.html#3993840">message</a></span><span class="op" id="3993894">,</span>&nbsp;<span class="ident" id="3993896"><a href="/net/textproto/reader.go.html#3993856">err</a></span>&nbsp;<span class="op" id="3993900">:=</span>&nbsp;<span class="ident" id="3993903"><a href="/net/textproto/reader.go.html#3993789">r</a></span><span class="op" id="3993904">.</span><span class="ident" id="3993905">readCodeLine</span><span class="op" id="3993917">(</span><span class="ident" id="3993918"><a href="/net/textproto/reader.go.html#3993813">expectCode</a></span><span class="op" id="3993928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3993931">if</span>&nbsp;<span class="ident" id="3993934"><a href="/net/textproto/reader.go.html#3993856">err</a></span>&nbsp;<span class="op" id="3993938">==</span>&nbsp;<span class="ident" id="3993941">nil</span>&nbsp;<span class="op" id="3993945">&amp;&amp;</span>&nbsp;<span class="ident" id="3993948"><a href="/net/textproto/reader.go.html#3993876">continued</a></span>&nbsp;<span class="op" id="3993958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3993962"><a href="/net/textproto/reader.go.html#3993856">err</a></span>&nbsp;<span class="op" id="3993966">=</span>&nbsp;<span class="ident" id="3993968"><a href="/net/textproto/textproto.go.html#4005580">ProtocolError</a></span><span class="op" id="3993981">(</span><span class="string" id="3993982">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3994017">+</span>&nbsp;<span class="ident" id="3994019"><a href="/net/textproto/reader.go.html#3993840">message</a></span><span class="op" id="3994026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3994029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994032">return</span><br>
<span class="lineno">225</span><span class="op" id="3994039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3994042">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3994099">//</span><br>
<span class="lineno"></span><span class="comment" id="3994102">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3994125">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3994148">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3994155">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3994178">//</span><br>
<span class="lineno"></span><span class="comment" id="3994181">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3994256">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3994327">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3994394">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3994426">//</span><br>
<span class="lineno"></span><span class="comment" id="3994429">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3994496">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3994508">//</span><br>
<span class="lineno"></span><span class="comment" id="3994511">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3994583">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3994646">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3994712">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3994757">//</span><br>
<span class="lineno"></span><span class="comment" id="3994760">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3994821">//</span><br>
<span class="lineno"></span><span class="keyword" id="3994824">func</span>&nbsp;<span class="op" id="3994829">(</span><span class="ident" id="3994830">r</span>&nbsp;<span class="op" id="3994832">*</span><span class="ident" id="3994833"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3994839">)</span>&nbsp;<span class="ident" id="3994841">ReadResponse</span><span class="op" id="3994853">(</span><span class="ident" id="3994854">expectCode</span>&nbsp;<span class="builtintype" id="3994865">int</span><span class="op" id="3994868">)</span>&nbsp;<span class="op" id="3994870">(</span><span class="ident" id="3994871">code</span>&nbsp;<span class="builtintype" id="3994876">int</span><span class="op" id="3994879">,</span>&nbsp;<span class="ident" id="3994881">message</span>&nbsp;<span class="builtintype" id="3994889">string</span><span class="op" id="3994895">,</span>&nbsp;<span class="ident" id="3994897">err</span>&nbsp;<span class="builtintype" id="3994901">error</span><span class="op" id="3994906">)</span>&nbsp;<span class="op" id="3994908">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3994911"><a href="/net/textproto/reader.go.html#3994871">code</a></span><span class="op" id="3994915">,</span>&nbsp;<span class="ident" id="3994917">continued</span><span class="op" id="3994926">,</span>&nbsp;<span class="ident" id="3994928"><a href="/net/textproto/reader.go.html#3994881">message</a></span><span class="op" id="3994935">,</span>&nbsp;<span class="ident" id="3994937"><a href="/net/textproto/reader.go.html#3994897">err</a></span>&nbsp;<span class="op" id="3994941">:=</span>&nbsp;<span class="ident" id="3994944"><a href="/net/textproto/reader.go.html#3994830">r</a></span><span class="op" id="3994945">.</span><span class="ident" id="3994946">readCodeLine</span><span class="op" id="3994958">(</span><span class="ident" id="3994959"><a href="/net/textproto/reader.go.html#3994854">expectCode</a></span><span class="op" id="3994969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3994972">for</span>&nbsp;<span class="ident" id="3994976"><a href="/net/textproto/reader.go.html#3994897">err</a></span>&nbsp;<span class="op" id="3994980">==</span>&nbsp;<span class="ident" id="3994983">nil</span>&nbsp;<span class="op" id="3994987">&amp;&amp;</span>&nbsp;<span class="ident" id="3994990"><a href="/net/textproto/reader.go.html#3994917">continued</a></span>&nbsp;<span class="op" id="3995000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995004">line</span><span class="op" id="3995008">,</span>&nbsp;<span class="ident" id="3995010">err</span>&nbsp;<span class="op" id="3995014">:=</span>&nbsp;<span class="ident" id="3995017"><a href="/net/textproto/reader.go.html#3994830">r</a></span><span class="op" id="3995018">.</span><span class="ident" id="3995019">ReadLine</span><span class="op" id="3995027">(</span><span class="op" id="3995028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995032">if</span>&nbsp;<span class="ident" id="3995035"><a href="/net/textproto/reader.go.html#3995010">err</a></span>&nbsp;<span class="op" id="3995039">!=</span>&nbsp;<span class="ident" id="3995042">nil</span>&nbsp;<span class="op" id="3995046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995051">return</span>&nbsp;<span class="num" id="3995058">0</span><span class="op" id="3995059">,</span>&nbsp;<span class="string" id="3995061">&#34;&#34;</span><span class="op" id="3995063">,</span>&nbsp;<span class="ident" id="3995065"><a href="/net/textproto/reader.go.html#3995010">err</a></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995076">var</span>&nbsp;<span class="ident" id="3995080">code2</span>&nbsp;<span class="builtintype" id="3995086">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995092">var</span>&nbsp;<span class="ident" id="3995096">moreMessage</span>&nbsp;<span class="builtintype" id="3995108">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995117"><a href="/net/textproto/reader.go.html#3995080">code2</a></span><span class="op" id="3995122">,</span>&nbsp;<span class="ident" id="3995124"><a href="/net/textproto/reader.go.html#3994917">continued</a></span><span class="op" id="3995133">,</span>&nbsp;<span class="ident" id="3995135"><a href="/net/textproto/reader.go.html#3995096">moreMessage</a></span><span class="op" id="3995146">,</span>&nbsp;<span class="ident" id="3995148"><a href="/net/textproto/reader.go.html#3995010">err</a></span>&nbsp;<span class="op" id="3995152">=</span>&nbsp;<span class="ident" id="3995154"><a href="/net/textproto/reader.go.html#3992525">parseCodeLine</a></span><span class="op" id="3995167">(</span><span class="ident" id="3995168"><a href="/net/textproto/reader.go.html#3995004">line</a></span><span class="op" id="3995172">,</span>&nbsp;<span class="ident" id="3995174"><a href="/net/textproto/reader.go.html#3994854">expectCode</a></span><span class="op" id="3995184">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995188">if</span>&nbsp;<span class="ident" id="3995191"><a href="/net/textproto/reader.go.html#3995010">err</a></span>&nbsp;<span class="op" id="3995195">!=</span>&nbsp;<span class="ident" id="3995198">nil</span>&nbsp;<span class="op" id="3995202">||</span>&nbsp;<span class="ident" id="3995205"><a href="/net/textproto/reader.go.html#3995080">code2</a></span>&nbsp;<span class="op" id="3995211">!=</span>&nbsp;<span class="ident" id="3995214"><a href="/net/textproto/reader.go.html#3994871">code</a></span>&nbsp;<span class="op" id="3995219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995224"><a href="/net/textproto/reader.go.html#3994881">message</a></span>&nbsp;<span class="op" id="3995232">+=</span>&nbsp;<span class="string" id="3995235">&#34;\n&#34;</span>&nbsp;<span class="op" id="3995240">+</span>&nbsp;<span class="ident" id="3995242"><a href="/net/textproto/reader.go.html#3988324">strings</a></span><span class="op" id="3995249">.</span><span class="ident" id="3995250">TrimRight</span><span class="op" id="3995259">(</span><span class="ident" id="3995260"><a href="/net/textproto/reader.go.html#3995004">line</a></span><span class="op" id="3995264">,</span>&nbsp;<span class="string" id="3995266">&#34;\r\n&#34;</span><span class="op" id="3995272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995277"><a href="/net/textproto/reader.go.html#3994917">continued</a></span>&nbsp;<span class="op" id="3995287">=</span>&nbsp;<span class="ident" id="3995289">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995297">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995308">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3995312"><a href="/net/textproto/reader.go.html#3994881">message</a></span>&nbsp;<span class="op" id="3995320">+=</span>&nbsp;<span class="string" id="3995323">&#34;\n&#34;</span>&nbsp;<span class="op" id="3995328">+</span>&nbsp;<span class="ident" id="3995330"><a href="/net/textproto/reader.go.html#3995096">moreMessage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3995343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3995346">return</span><br>
<span class="lineno"></span><span class="op" id="3995353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3995356">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3995421">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3995473">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3995530">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3995551">//</span><br>
<span class="lineno">275</span><span class="comment" id="3995554">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3995611">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3995679">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3995743">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3995810">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3995868">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3995909">//</span><br>
<span class="lineno"></span><span class="comment" id="3995912">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3995969">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3996028">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3996099">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3996161">func</span>&nbsp;<span class="op" id="3996166">(</span><span class="ident" id="3996167">r</span>&nbsp;<span class="op" id="3996169">*</span><span class="ident" id="3996170"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3996176">)</span>&nbsp;<span class="ident" id="3996178">DotReader</span><span class="op" id="3996187">(</span><span class="op" id="3996188">)</span>&nbsp;<span class="ident" id="3996190"><a href="/net/textproto/reader.go.html#3988294">io</a></span><span class="op" id="3996192">.</span><span class="ident" id="3996193">Reader</span>&nbsp;<span class="op" id="3996200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996203"><a href="/net/textproto/reader.go.html#3996167">r</a></span><span class="op" id="3996204">.</span><span class="ident" id="3996205">closeDot</span><span class="op" id="3996213">(</span><span class="op" id="3996214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996217"><a href="/net/textproto/reader.go.html#3996167">r</a></span><span class="op" id="3996218">.</span><span class="ident" id="3996219">dot</span>&nbsp;<span class="op" id="3996223">=</span>&nbsp;<span class="op" id="3996225">&amp;</span><span class="ident" id="3996226"><a href="/net/textproto/reader.go.html#3996264">dotReader</a></span><span class="op" id="3996235">{</span><span class="ident" id="3996236">r</span><span class="op" id="3996237">:</span>&nbsp;<span class="ident" id="3996239"><a href="/net/textproto/reader.go.html#3996167">r</a></span><span class="op" id="3996240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996243">return</span>&nbsp;<span class="ident" id="3996250"><a href="/net/textproto/reader.go.html#3996167">r</a></span><span class="op" id="3996251">.</span><span class="ident" id="3996252">dot</span><br>
<span class="lineno">290</span><span class="op" id="3996256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3996259">type</span>&nbsp;<span class="ident" id="3996264">dotReader</span>&nbsp;<span class="keyword" id="3996274">struct</span>&nbsp;<span class="op" id="3996281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996284">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3996290">*</span><span class="ident" id="3996291"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996299">state</span>&nbsp;<span class="builtintype" id="3996305">int</span><br>
<span class="lineno">295</span><span class="op" id="3996309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3996312">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3996380">func</span>&nbsp;<span class="op" id="3996385">(</span><span class="ident" id="3996386">d</span>&nbsp;<span class="op" id="3996388">*</span><span class="ident" id="3996389"><a href="/net/textproto/reader.go.html#3996264">dotReader</a></span><span class="op" id="3996398">)</span>&nbsp;<span class="ident" id="3996400">Read</span><span class="op" id="3996404">(</span><span class="ident" id="3996405">b</span>&nbsp;<span class="op" id="3996407">[</span><span class="op" id="3996408">]</span><span class="builtintype" id="3996409">byte</span><span class="op" id="3996413">)</span>&nbsp;<span class="op" id="3996415">(</span><span class="ident" id="3996416">n</span>&nbsp;<span class="builtintype" id="3996418">int</span><span class="op" id="3996421">,</span>&nbsp;<span class="ident" id="3996423">err</span>&nbsp;<span class="builtintype" id="3996427">error</span><span class="op" id="3996432">)</span>&nbsp;<span class="op" id="3996434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996437">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996484">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3996539">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996573">const</span>&nbsp;<span class="op" id="3996579">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996583">stateBeginLine</span>&nbsp;<span class="op" id="3996598">=</span>&nbsp;<span class="ident" id="3996600">iota</span>&nbsp;<span class="comment" id="3996605">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996657">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996679">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996712">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996734">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996769">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996791">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996830">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996852">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996888">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3996910">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3996944">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3996947">br</span>&nbsp;<span class="op" id="3996950">:=</span>&nbsp;<span class="ident" id="3996953"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3996954">.</span><span class="ident" id="3996955">r</span><span class="op" id="3996956">.</span><span class="ident" id="3996957">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3996960">for</span>&nbsp;<span class="ident" id="3996964"><a href="/net/textproto/reader.go.html#3996416">n</a></span>&nbsp;<span class="op" id="3996966">&lt;</span>&nbsp;<span class="builtinfunc" id="3996968">len</span><span class="op" id="3996971">(</span><span class="ident" id="3996972"><a href="/net/textproto/reader.go.html#3996405">b</a></span><span class="op" id="3996973">)</span>&nbsp;<span class="op" id="3996975">&amp;&amp;</span>&nbsp;<span class="ident" id="3996978"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3996979">.</span><span class="ident" id="3996980">state</span>&nbsp;<span class="op" id="3996986">!=</span>&nbsp;<span class="ident" id="3996989"><a href="/net/textproto/reader.go.html#3996888">stateEOF</a></span>&nbsp;<span class="op" id="3996998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997002">var</span>&nbsp;<span class="ident" id="3997006">c</span>&nbsp;<span class="builtintype" id="3997008">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997015"><a href="/net/textproto/reader.go.html#3997006">c</a></span><span class="op" id="3997016">,</span>&nbsp;<span class="ident" id="3997018"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3997022">=</span>&nbsp;<span class="ident" id="3997024"><a href="/net/textproto/reader.go.html#3996947">br</a></span><span class="op" id="3997026">.</span><span class="ident" id="3997027">ReadByte</span><span class="op" id="3997035">(</span><span class="op" id="3997036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997040">if</span>&nbsp;<span class="ident" id="3997043"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3997047">!=</span>&nbsp;<span class="ident" id="3997050">nil</span>&nbsp;<span class="op" id="3997054">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997059">if</span>&nbsp;<span class="ident" id="3997062"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3997066">==</span>&nbsp;<span class="ident" id="3997069"><a href="/net/textproto/reader.go.html#3988294">io</a></span><span class="op" id="3997071">.</span><span class="ident" id="3997072">EOF</span>&nbsp;<span class="op" id="3997076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997082"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3997086">=</span>&nbsp;<span class="ident" id="3997088"><a href="/net/textproto/reader.go.html#3988294">io</a></span><span class="op" id="3997090">.</span><span class="ident" id="3997091">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997116">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997124">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997128">switch</span>&nbsp;<span class="ident" id="3997135"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997136">.</span><span class="ident" id="3997137">state</span>&nbsp;<span class="op" id="3997143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997147">case</span>&nbsp;<span class="ident" id="3997152"><a href="/net/textproto/reader.go.html#3996583">stateBeginLine</a></span><span class="op" id="3997166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997171">if</span>&nbsp;<span class="ident" id="3997174"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997176">==</span>&nbsp;<span class="string" id="3997179">&#39;.&#39;</span>&nbsp;<span class="op" id="3997183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997189"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997190">.</span><span class="ident" id="3997191">state</span>&nbsp;<span class="op" id="3997197">=</span>&nbsp;<span class="ident" id="3997199"><a href="/net/textproto/reader.go.html#3996657">stateDot</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997212">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997229">if</span>&nbsp;<span class="ident" id="3997232"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997234">==</span>&nbsp;<span class="string" id="3997237">&#39;\r&#39;</span>&nbsp;<span class="op" id="3997242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997248"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997249">.</span><span class="ident" id="3997250">state</span>&nbsp;<span class="op" id="3997256">=</span>&nbsp;<span class="ident" id="3997258"><a href="/net/textproto/reader.go.html#3996769">stateCR</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997270">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997282">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997287"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997288">.</span><span class="ident" id="3997289">state</span>&nbsp;<span class="op" id="3997295">=</span>&nbsp;<span class="ident" id="3997297"><a href="/net/textproto/reader.go.html#3996830">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997310">case</span>&nbsp;<span class="ident" id="3997315"><a href="/net/textproto/reader.go.html#3996657">stateDot</a></span><span class="op" id="3997323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997328">if</span>&nbsp;<span class="ident" id="3997331"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997333">==</span>&nbsp;<span class="string" id="3997336">&#39;\r&#39;</span>&nbsp;<span class="op" id="3997341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997347"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997348">.</span><span class="ident" id="3997349">state</span>&nbsp;<span class="op" id="3997355">=</span>&nbsp;<span class="ident" id="3997357"><a href="/net/textproto/reader.go.html#3996712">stateDotCR</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997372">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997389">if</span>&nbsp;<span class="ident" id="3997392"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997394">==</span>&nbsp;<span class="string" id="3997397">&#39;\n&#39;</span>&nbsp;<span class="op" id="3997402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997408"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997409">.</span><span class="ident" id="3997410">state</span>&nbsp;<span class="op" id="3997416">=</span>&nbsp;<span class="ident" id="3997418"><a href="/net/textproto/reader.go.html#3996888">stateEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997431">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997448"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997449">.</span><span class="ident" id="3997450">state</span>&nbsp;<span class="op" id="3997456">=</span>&nbsp;<span class="ident" id="3997458"><a href="/net/textproto/reader.go.html#3996830">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997471">case</span>&nbsp;<span class="ident" id="3997476"><a href="/net/textproto/reader.go.html#3996712">stateDotCR</a></span><span class="op" id="3997486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997491">if</span>&nbsp;<span class="ident" id="3997494"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997496">==</span>&nbsp;<span class="string" id="3997499">&#39;\n&#39;</span>&nbsp;<span class="op" id="3997504">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997510"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997511">.</span><span class="ident" id="3997512">state</span>&nbsp;<span class="op" id="3997518">=</span>&nbsp;<span class="ident" id="3997520"><a href="/net/textproto/reader.go.html#3996888">stateEOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997533">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997550">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997575">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997620"><a href="/net/textproto/reader.go.html#3996947">br</a></span><span class="op" id="3997622">.</span><span class="ident" id="3997623">UnreadByte</span><span class="op" id="3997633">(</span><span class="op" id="3997634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997639"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997641">=</span>&nbsp;<span class="string" id="3997643">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997651"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997652">.</span><span class="ident" id="3997653">state</span>&nbsp;<span class="op" id="3997659">=</span>&nbsp;<span class="ident" id="3997661"><a href="/net/textproto/reader.go.html#3996830">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997674">case</span>&nbsp;<span class="ident" id="3997679"><a href="/net/textproto/reader.go.html#3996769">stateCR</a></span><span class="op" id="3997686">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997691">if</span>&nbsp;<span class="ident" id="3997694"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997696">==</span>&nbsp;<span class="string" id="3997699">&#39;\n&#39;</span>&nbsp;<span class="op" id="3997704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997710"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997711">.</span><span class="ident" id="3997712">state</span>&nbsp;<span class="op" id="3997718">=</span>&nbsp;<span class="ident" id="3997720"><a href="/net/textproto/reader.go.html#3996583">stateBeginLine</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997739">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3997753">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997792"><a href="/net/textproto/reader.go.html#3996947">br</a></span><span class="op" id="3997794">.</span><span class="ident" id="3997795">UnreadByte</span><span class="op" id="3997805">(</span><span class="op" id="3997806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997811"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997813">=</span>&nbsp;<span class="string" id="3997815">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997823"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997824">.</span><span class="ident" id="3997825">state</span>&nbsp;<span class="op" id="3997831">=</span>&nbsp;<span class="ident" id="3997833"><a href="/net/textproto/reader.go.html#3996830">stateData</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997846">case</span>&nbsp;<span class="ident" id="3997851"><a href="/net/textproto/reader.go.html#3996830">stateData</a></span><span class="op" id="3997860">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997865">if</span>&nbsp;<span class="ident" id="3997868"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997870">==</span>&nbsp;<span class="string" id="3997873">&#39;\r&#39;</span>&nbsp;<span class="op" id="3997878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997884"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997885">.</span><span class="ident" id="3997886">state</span>&nbsp;<span class="op" id="3997892">=</span>&nbsp;<span class="ident" id="3997894"><a href="/net/textproto/reader.go.html#3996769">stateCR</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997906">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997923">if</span>&nbsp;<span class="ident" id="3997926"><a href="/net/textproto/reader.go.html#3997006">c</a></span>&nbsp;<span class="op" id="3997928">==</span>&nbsp;<span class="string" id="3997931">&#39;\n&#39;</span>&nbsp;<span class="op" id="3997936">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997942"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3997943">.</span><span class="ident" id="3997944">state</span>&nbsp;<span class="op" id="3997950">=</span>&nbsp;<span class="ident" id="3997952"><a href="/net/textproto/reader.go.html#3996583">stateBeginLine</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997978"><a href="/net/textproto/reader.go.html#3996405">b</a></span><span class="op" id="3997979">[</span><span class="ident" id="3997980"><a href="/net/textproto/reader.go.html#3996416">n</a></span><span class="op" id="3997981">]</span>&nbsp;<span class="op" id="3997983">=</span>&nbsp;<span class="ident" id="3997985"><a href="/net/textproto/reader.go.html#3997006">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3997989"><a href="/net/textproto/reader.go.html#3996416">n</a></span><span class="op" id="3997990">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3997994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3997997">if</span>&nbsp;<span class="ident" id="3998000"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3998004">==</span>&nbsp;<span class="ident" id="3998007">nil</span>&nbsp;<span class="op" id="3998011">&amp;&amp;</span>&nbsp;<span class="ident" id="3998014"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3998015">.</span><span class="ident" id="3998016">state</span>&nbsp;<span class="op" id="3998022">==</span>&nbsp;<span class="ident" id="3998025"><a href="/net/textproto/reader.go.html#3996888">stateEOF</a></span>&nbsp;<span class="op" id="3998034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998038"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3998042">=</span>&nbsp;<span class="ident" id="3998044"><a href="/net/textproto/reader.go.html#3988294">io</a></span><span class="op" id="3998046">.</span><span class="ident" id="3998047">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998055">if</span>&nbsp;<span class="ident" id="3998058"><a href="/net/textproto/reader.go.html#3996423">err</a></span>&nbsp;<span class="op" id="3998062">!=</span>&nbsp;<span class="ident" id="3998065">nil</span>&nbsp;<span class="op" id="3998069">&amp;&amp;</span>&nbsp;<span class="ident" id="3998072"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3998073">.</span><span class="ident" id="3998074">r</span><span class="op" id="3998075">.</span><span class="ident" id="3998076">dot</span>&nbsp;<span class="op" id="3998080">==</span>&nbsp;<span class="ident" id="3998083"><a href="/net/textproto/reader.go.html#3996386">d</a></span>&nbsp;<span class="op" id="3998085">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998089"><a href="/net/textproto/reader.go.html#3996386">d</a></span><span class="op" id="3998090">.</span><span class="ident" id="3998091">r</span><span class="op" id="3998092">.</span><span class="ident" id="3998093">dot</span>&nbsp;<span class="op" id="3998097">=</span>&nbsp;<span class="ident" id="3998099">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998107">return</span><br>
<span class="lineno"></span><span class="op" id="3998114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3998117">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3998166">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3998222">func</span>&nbsp;<span class="op" id="3998227">(</span><span class="ident" id="3998228">r</span>&nbsp;<span class="op" id="3998230">*</span><span class="ident" id="3998231"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3998237">)</span>&nbsp;<span class="ident" id="3998239">closeDot</span><span class="op" id="3998247">(</span><span class="op" id="3998248">)</span>&nbsp;<span class="op" id="3998250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998253">if</span>&nbsp;<span class="ident" id="3998256"><a href="/net/textproto/reader.go.html#3998228">r</a></span><span class="op" id="3998257">.</span><span class="ident" id="3998258">dot</span>&nbsp;<span class="op" id="3998262">==</span>&nbsp;<span class="ident" id="3998265">nil</span>&nbsp;<span class="op" id="3998269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998273">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998284">buf</span>&nbsp;<span class="op" id="3998288">:=</span>&nbsp;<span class="builtinfunc" id="3998291">make</span><span class="op" id="3998295">(</span><span class="op" id="3998296">[</span><span class="op" id="3998297">]</span><span class="builtintype" id="3998298">byte</span><span class="op" id="3998302">,</span>&nbsp;<span class="num" id="3998304">128</span><span class="op" id="3998307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998310">for</span>&nbsp;<span class="ident" id="3998314"><a href="/net/textproto/reader.go.html#3998228">r</a></span><span class="op" id="3998315">.</span><span class="ident" id="3998316">dot</span>&nbsp;<span class="op" id="3998320">!=</span>&nbsp;<span class="ident" id="3998323">nil</span>&nbsp;<span class="op" id="3998327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998331">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998371">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3998402"><a href="/net/textproto/reader.go.html#3998228">r</a></span><span class="op" id="3998403">.</span><span class="ident" id="3998404">dot</span><span class="op" id="3998407">.</span><span class="ident" id="3998408">Read</span><span class="op" id="3998412">(</span><span class="ident" id="3998413"><a href="/net/textproto/reader.go.html#3998284">buf</a></span><span class="op" id="3998416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3998419">}</span><br>
<span class="lineno"></span><span class="op" id="3998421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3998424">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3998491">//</span><br>
<span class="lineno"></span><span class="comment" id="3998494">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3998576">func</span>&nbsp;<span class="op" id="3998581">(</span><span class="ident" id="3998582">r</span>&nbsp;<span class="op" id="3998584">*</span><span class="ident" id="3998585"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3998591">)</span>&nbsp;<span class="ident" id="3998593">ReadDotBytes</span><span class="op" id="3998605">(</span><span class="op" id="3998606">)</span>&nbsp;<span class="op" id="3998608">(</span><span class="op" id="3998609">[</span><span class="op" id="3998610">]</span><span class="builtintype" id="3998611">byte</span><span class="op" id="3998615">,</span>&nbsp;<span class="builtintype" id="3998617">error</span><span class="op" id="3998622">)</span>&nbsp;<span class="op" id="3998624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3998627">return</span>&nbsp;<span class="ident" id="3998634"><a href="/net/textproto/reader.go.html#3988300">ioutil</a></span><span class="op" id="3998640">.</span><span class="ident" id="3998641">ReadAll</span><span class="op" id="3998648">(</span><span class="ident" id="3998649"><a href="/net/textproto/reader.go.html#3998582">r</a></span><span class="op" id="3998650">.</span><span class="ident" id="3998651">DotReader</span><span class="op" id="3998660">(</span><span class="op" id="3998661">)</span><span class="op" id="3998662">)</span><br>
<span class="lineno"></span><span class="op" id="3998664">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3998667">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3998724">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3998801">//</span><br>
<span class="lineno"></span><span class="comment" id="3998804">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3998886">func</span>&nbsp;<span class="op" id="3998891">(</span><span class="ident" id="3998892">r</span>&nbsp;<span class="op" id="3998894">*</span><span class="ident" id="3998895"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="3998901">)</span>&nbsp;<span class="ident" id="3998903">ReadDotLines</span><span class="op" id="3998915">(</span><span class="op" id="3998916">)</span>&nbsp;<span class="op" id="3998918">(</span><span class="op" id="3998919">[</span><span class="op" id="3998920">]</span><span class="builtintype" id="3998921">string</span><span class="op" id="3998927">,</span>&nbsp;<span class="builtintype" id="3998929">error</span><span class="op" id="3998934">)</span>&nbsp;<span class="op" id="3998936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998939">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3998988">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3999038">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999091">var</span>&nbsp;<span class="ident" id="3999095">v</span>&nbsp;<span class="op" id="3999097">[</span><span class="op" id="3999098">]</span><span class="builtintype" id="3999099">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999107">var</span>&nbsp;<span class="ident" id="3999111">err</span>&nbsp;<span class="builtintype" id="3999115">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999122">for</span>&nbsp;<span class="op" id="3999126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999130">var</span>&nbsp;<span class="ident" id="3999134">line</span>&nbsp;<span class="builtintype" id="3999139">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999148"><a href="/net/textproto/reader.go.html#3999134">line</a></span><span class="op" id="3999152">,</span>&nbsp;<span class="ident" id="3999154"><a href="/net/textproto/reader.go.html#3999111">err</a></span>&nbsp;<span class="op" id="3999158">=</span>&nbsp;<span class="ident" id="3999160"><a href="/net/textproto/reader.go.html#3998892">r</a></span><span class="op" id="3999161">.</span><span class="ident" id="3999162">ReadLine</span><span class="op" id="3999170">(</span><span class="op" id="3999171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999175">if</span>&nbsp;<span class="ident" id="3999178"><a href="/net/textproto/reader.go.html#3999111">err</a></span>&nbsp;<span class="op" id="3999182">!=</span>&nbsp;<span class="ident" id="3999185">nil</span>&nbsp;<span class="op" id="3999189">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999194">if</span>&nbsp;<span class="ident" id="3999197"><a href="/net/textproto/reader.go.html#3999111">err</a></span>&nbsp;<span class="op" id="3999201">==</span>&nbsp;<span class="ident" id="3999204"><a href="/net/textproto/reader.go.html#3988294">io</a></span><span class="op" id="3999206">.</span><span class="ident" id="3999207">EOF</span>&nbsp;<span class="op" id="3999211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999217"><a href="/net/textproto/reader.go.html#3999111">err</a></span>&nbsp;<span class="op" id="3999221">=</span>&nbsp;<span class="ident" id="3999223"><a href="/net/textproto/reader.go.html#3988294">io</a></span><span class="op" id="3999225">.</span><span class="ident" id="3999226">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999251">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999259">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3999264">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999317">if</span>&nbsp;<span class="builtinfunc" id="3999320">len</span><span class="op" id="3999323">(</span><span class="ident" id="3999324"><a href="/net/textproto/reader.go.html#3999134">line</a></span><span class="op" id="3999328">)</span>&nbsp;<span class="op" id="3999330">&gt;</span>&nbsp;<span class="num" id="3999332">0</span>&nbsp;<span class="op" id="3999334">&amp;&amp;</span>&nbsp;<span class="ident" id="3999337"><a href="/net/textproto/reader.go.html#3999134">line</a></span><span class="op" id="3999341">[</span><span class="num" id="3999342">0</span><span class="op" id="3999343">]</span>&nbsp;<span class="op" id="3999345">==</span>&nbsp;<span class="string" id="3999348">&#39;.&#39;</span>&nbsp;<span class="op" id="3999352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999357">if</span>&nbsp;<span class="builtinfunc" id="3999360">len</span><span class="op" id="3999363">(</span><span class="ident" id="3999364"><a href="/net/textproto/reader.go.html#3999134">line</a></span><span class="op" id="3999368">)</span>&nbsp;<span class="op" id="3999370">==</span>&nbsp;<span class="num" id="3999373">1</span>&nbsp;<span class="op" id="3999375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999381">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999395"><a href="/net/textproto/reader.go.html#3999134">line</a></span>&nbsp;<span class="op" id="3999400">=</span>&nbsp;<span class="ident" id="3999402"><a href="/net/textproto/reader.go.html#3999134">line</a></span><span class="op" id="3999406">[</span><span class="num" id="3999407">1</span><span class="op" id="3999408">:</span><span class="op" id="3999409">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3999417"><a href="/net/textproto/reader.go.html#3999095">v</a></span>&nbsp;<span class="op" id="3999419">=</span>&nbsp;<span class="builtinfunc" id="3999421">append</span><span class="op" id="3999427">(</span><span class="ident" id="3999428"><a href="/net/textproto/reader.go.html#3999095">v</a></span><span class="op" id="3999429">,</span>&nbsp;<span class="ident" id="3999431"><a href="/net/textproto/reader.go.html#3999134">line</a></span><span class="op" id="3999435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3999438">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3999441">return</span>&nbsp;<span class="ident" id="3999448"><a href="/net/textproto/reader.go.html#3999095">v</a></span><span class="op" id="3999449">,</span>&nbsp;<span class="ident" id="3999451"><a href="/net/textproto/reader.go.html#3999111">err</a></span><br>
<span class="lineno"></span><span class="op" id="3999455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3999458">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3999510">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3999577">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3999604">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3999664">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3999730">//</span><br>
<span class="lineno"></span><span class="comment" id="3999733">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3999770">//</span><br>
<span class="lineno"></span><span class="comment" id="3999773">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3999792">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3999810">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3999833">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3999852">//</span><br>
<span class="lineno"></span><span class="comment" id="3999855">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3999908">//</span><br>
<span class="lineno"></span><span class="comment" id="3999911">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3999935">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3999973">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="4000012">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="4000017">//</span><br>
<span class="lineno"></span><span class="keyword" id="4000020">func</span>&nbsp;<span class="op" id="4000025">(</span><span class="ident" id="4000026">r</span>&nbsp;<span class="op" id="4000028">*</span><span class="ident" id="4000029"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="4000035">)</span>&nbsp;<span class="ident" id="4000037">ReadMIMEHeader</span><span class="op" id="4000051">(</span><span class="op" id="4000052">)</span>&nbsp;<span class="op" id="4000054">(</span><span class="ident" id="4000055"><a href="/net/textproto/header.go.html#3984090">MIMEHeader</a></span><span class="op" id="4000065">,</span>&nbsp;<span class="builtintype" id="4000067">error</span><span class="op" id="4000072">)</span>&nbsp;<span class="op" id="4000074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000077">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000143">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000203">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000271">var</span>&nbsp;<span class="ident" id="4000275">strs</span>&nbsp;<span class="op" id="4000280">[</span><span class="op" id="4000281">]</span><span class="builtintype" id="4000282">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000290">hint</span>&nbsp;<span class="op" id="4000295">:=</span>&nbsp;<span class="ident" id="4000298"><a href="/net/textproto/reader.go.html#4000026">r</a></span><span class="op" id="4000299">.</span><span class="ident" id="4000300">upcomingHeaderNewlines</span><span class="op" id="4000322">(</span><span class="op" id="4000323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000326">if</span>&nbsp;<span class="ident" id="4000329"><a href="/net/textproto/reader.go.html#4000290">hint</a></span>&nbsp;<span class="op" id="4000334">&gt;</span>&nbsp;<span class="num" id="4000336">0</span>&nbsp;<span class="op" id="4000338">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000342"><a href="/net/textproto/reader.go.html#4000275">strs</a></span>&nbsp;<span class="op" id="4000347">=</span>&nbsp;<span class="builtinfunc" id="4000349">make</span><span class="op" id="4000353">(</span><span class="op" id="4000354">[</span><span class="op" id="4000355">]</span><span class="builtintype" id="4000356">string</span><span class="op" id="4000362">,</span>&nbsp;<span class="ident" id="4000364"><a href="/net/textproto/reader.go.html#4000290">hint</a></span><span class="op" id="4000368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4000371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000375">m</span>&nbsp;<span class="op" id="4000377">:=</span>&nbsp;<span class="builtinfunc" id="4000380">make</span><span class="op" id="4000384">(</span><span class="ident" id="4000385"><a href="/net/textproto/header.go.html#3984090">MIMEHeader</a></span><span class="op" id="4000395">,</span>&nbsp;<span class="ident" id="4000397"><a href="/net/textproto/reader.go.html#4000290">hint</a></span><span class="op" id="4000401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000404">for</span>&nbsp;<span class="op" id="4000408">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000412">kv</span><span class="op" id="4000414">,</span>&nbsp;<span class="ident" id="4000416">err</span>&nbsp;<span class="op" id="4000420">:=</span>&nbsp;<span class="ident" id="4000423"><a href="/net/textproto/reader.go.html#4000026">r</a></span><span class="op" id="4000424">.</span><span class="ident" id="4000425">readContinuedLineSlice</span><span class="op" id="4000447">(</span><span class="op" id="4000448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000452">if</span>&nbsp;<span class="builtinfunc" id="4000455">len</span><span class="op" id="4000458">(</span><span class="ident" id="4000459"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000461">)</span>&nbsp;<span class="op" id="4000463">==</span>&nbsp;<span class="num" id="4000466">0</span>&nbsp;<span class="op" id="4000468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000473">return</span>&nbsp;<span class="ident" id="4000480"><a href="/net/textproto/reader.go.html#4000375">m</a></span><span class="op" id="4000481">,</span>&nbsp;<span class="ident" id="4000483"><a href="/net/textproto/reader.go.html#4000416">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4000489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000494">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000551">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000604">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000633">i</span>&nbsp;<span class="op" id="4000635">:=</span>&nbsp;<span class="ident" id="4000638"><a href="/net/textproto/reader.go.html#3988285">bytes</a></span><span class="op" id="4000643">.</span><span class="ident" id="4000644">IndexByte</span><span class="op" id="4000653">(</span><span class="ident" id="4000654"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000656">,</span>&nbsp;<span class="string" id="4000658">&#39;:&#39;</span><span class="op" id="4000661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000665">if</span>&nbsp;<span class="ident" id="4000668"><a href="/net/textproto/reader.go.html#4000633">i</a></span>&nbsp;<span class="op" id="4000670">&lt;</span>&nbsp;<span class="num" id="4000672">0</span>&nbsp;<span class="op" id="4000674">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000679">return</span>&nbsp;<span class="ident" id="4000686"><a href="/net/textproto/reader.go.html#4000375">m</a></span><span class="op" id="4000687">,</span>&nbsp;<span class="ident" id="4000689"><a href="/net/textproto/textproto.go.html#4005580">ProtocolError</a></span><span class="op" id="4000702">(</span><span class="string" id="4000703">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="4000734">+</span>&nbsp;<span class="builtintype" id="4000736">string</span><span class="op" id="4000742">(</span><span class="ident" id="4000743"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000745">)</span><span class="op" id="4000746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4000750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000754">endKey</span>&nbsp;<span class="op" id="4000761">:=</span>&nbsp;<span class="ident" id="4000764"><a href="/net/textproto/reader.go.html#4000633">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000768">for</span>&nbsp;<span class="ident" id="4000772"><a href="/net/textproto/reader.go.html#4000754">endKey</a></span>&nbsp;<span class="op" id="4000779">&gt;</span>&nbsp;<span class="num" id="4000781">0</span>&nbsp;<span class="op" id="4000783">&amp;&amp;</span>&nbsp;<span class="ident" id="4000786"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000788">[</span><span class="ident" id="4000789"><a href="/net/textproto/reader.go.html#4000754">endKey</a></span><span class="op" id="4000795">-</span><span class="num" id="4000796">1</span><span class="op" id="4000797">]</span>&nbsp;<span class="op" id="4000799">==</span>&nbsp;<span class="string" id="4000802">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4000806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000811"><a href="/net/textproto/reader.go.html#4000754">endKey</a></span><span class="op" id="4000817">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4000822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000826">key</span>&nbsp;<span class="op" id="4000830">:=</span>&nbsp;<span class="ident" id="4000833"><a href="/net/textproto/reader.go.html#4002900">canonicalMIMEHeaderKey</a></span><span class="op" id="4000855">(</span><span class="ident" id="4000856"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000858">[</span><span class="op" id="4000859">:</span><span class="ident" id="4000860"><a href="/net/textproto/reader.go.html#4000754">endKey</a></span><span class="op" id="4000866">]</span><span class="op" id="4000867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4000872">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000907"><a href="/net/textproto/reader.go.html#4000633">i</a></span><span class="op" id="4000908">++</span>&nbsp;<span class="comment" id="4000911">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4000927">for</span>&nbsp;<span class="ident" id="4000931"><a href="/net/textproto/reader.go.html#4000633">i</a></span>&nbsp;<span class="op" id="4000933">&lt;</span>&nbsp;<span class="builtinfunc" id="4000935">len</span><span class="op" id="4000938">(</span><span class="ident" id="4000939"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000941">)</span>&nbsp;<span class="op" id="4000943">&amp;&amp;</span>&nbsp;<span class="op" id="4000946">(</span><span class="ident" id="4000947"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000949">[</span><span class="ident" id="4000950"><a href="/net/textproto/reader.go.html#4000633">i</a></span><span class="op" id="4000951">]</span>&nbsp;<span class="op" id="4000953">==</span>&nbsp;<span class="string" id="4000956">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4000960">||</span>&nbsp;<span class="ident" id="4000963"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4000965">[</span><span class="ident" id="4000966"><a href="/net/textproto/reader.go.html#4000633">i</a></span><span class="op" id="4000967">]</span>&nbsp;<span class="op" id="4000969">==</span>&nbsp;<span class="string" id="4000972">&#39;\t&#39;</span><span class="op" id="4000976">)</span>&nbsp;<span class="op" id="4000978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000983"><a href="/net/textproto/reader.go.html#4000633">i</a></span><span class="op" id="4000984">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4000989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4000993">value</span>&nbsp;<span class="op" id="4000999">:=</span>&nbsp;<span class="builtintype" id="4001002">string</span><span class="op" id="4001008">(</span><span class="ident" id="4001009"><a href="/net/textproto/reader.go.html#4000412">kv</a></span><span class="op" id="4001011">[</span><span class="ident" id="4001012"><a href="/net/textproto/reader.go.html#4000633">i</a></span><span class="op" id="4001013">:</span><span class="op" id="4001014">]</span><span class="op" id="4001015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001020">vv</span>&nbsp;<span class="op" id="4001023">:=</span>&nbsp;<span class="ident" id="4001026"><a href="/net/textproto/reader.go.html#4000375">m</a></span><span class="op" id="4001027">[</span><span class="ident" id="4001028"><a href="/net/textproto/reader.go.html#4000826">key</a></span><span class="op" id="4001031">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001035">if</span>&nbsp;<span class="ident" id="4001038"><a href="/net/textproto/reader.go.html#4001020">vv</a></span>&nbsp;<span class="op" id="4001041">==</span>&nbsp;<span class="ident" id="4001044">nil</span>&nbsp;<span class="op" id="4001048">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4001051">len</span><span class="op" id="4001054">(</span><span class="ident" id="4001055"><a href="/net/textproto/reader.go.html#4000275">strs</a></span><span class="op" id="4001059">)</span>&nbsp;<span class="op" id="4001061">&gt;</span>&nbsp;<span class="num" id="4001063">0</span>&nbsp;<span class="op" id="4001065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001070">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001128">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001168">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001229">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001282"><a href="/net/textproto/reader.go.html#4001020">vv</a></span><span class="op" id="4001284">,</span>&nbsp;<span class="ident" id="4001286"><a href="/net/textproto/reader.go.html#4000275">strs</a></span>&nbsp;<span class="op" id="4001291">=</span>&nbsp;<span class="ident" id="4001293"><a href="/net/textproto/reader.go.html#4000275">strs</a></span><span class="op" id="4001297">[</span><span class="op" id="4001298">:</span><span class="num" id="4001299">1</span><span class="op" id="4001300">:</span><span class="num" id="4001301">1</span><span class="op" id="4001302">]</span><span class="op" id="4001303">,</span>&nbsp;<span class="ident" id="4001305"><a href="/net/textproto/reader.go.html#4000275">strs</a></span><span class="op" id="4001309">[</span><span class="num" id="4001310">1</span><span class="op" id="4001311">:</span><span class="op" id="4001312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001317"><a href="/net/textproto/reader.go.html#4001020">vv</a></span><span class="op" id="4001319">[</span><span class="num" id="4001320">0</span><span class="op" id="4001321">]</span>&nbsp;<span class="op" id="4001323">=</span>&nbsp;<span class="ident" id="4001325"><a href="/net/textproto/reader.go.html#4000993">value</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001334"><a href="/net/textproto/reader.go.html#4000375">m</a></span><span class="op" id="4001335">[</span><span class="ident" id="4001336"><a href="/net/textproto/reader.go.html#4000826">key</a></span><span class="op" id="4001339">]</span>&nbsp;<span class="op" id="4001341">=</span>&nbsp;<span class="ident" id="4001343"><a href="/net/textproto/reader.go.html#4001020">vv</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001348">}</span>&nbsp;<span class="keyword" id="4001350">else</span>&nbsp;<span class="op" id="4001355">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001360"><a href="/net/textproto/reader.go.html#4000375">m</a></span><span class="op" id="4001361">[</span><span class="ident" id="4001362"><a href="/net/textproto/reader.go.html#4000826">key</a></span><span class="op" id="4001365">]</span>&nbsp;<span class="op" id="4001367">=</span>&nbsp;<span class="builtinfunc" id="4001369">append</span><span class="op" id="4001375">(</span><span class="ident" id="4001376"><a href="/net/textproto/reader.go.html#4001020">vv</a></span><span class="op" id="4001378">,</span>&nbsp;<span class="ident" id="4001380"><a href="/net/textproto/reader.go.html#4000993">value</a></span><span class="op" id="4001385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001394">if</span>&nbsp;<span class="ident" id="4001397"><a href="/net/textproto/reader.go.html#4000416">err</a></span>&nbsp;<span class="op" id="4001401">!=</span>&nbsp;<span class="ident" id="4001404">nil</span>&nbsp;<span class="op" id="4001408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001413">return</span>&nbsp;<span class="ident" id="4001420"><a href="/net/textproto/reader.go.html#4000375">m</a></span><span class="op" id="4001421">,</span>&nbsp;<span class="ident" id="4001423"><a href="/net/textproto/reader.go.html#4000416">err</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001432">}</span><br>
<span class="lineno"></span><span class="op" id="4001434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4001437">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="4001514">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="4001581">func</span>&nbsp;<span class="op" id="4001586">(</span><span class="ident" id="4001587">r</span>&nbsp;<span class="op" id="4001589">*</span><span class="ident" id="4001590"><a href="/net/textproto/reader.go.html#3988643">Reader</a></span><span class="op" id="4001596">)</span>&nbsp;<span class="ident" id="4001598">upcomingHeaderNewlines</span><span class="op" id="4001620">(</span><span class="op" id="4001621">)</span>&nbsp;<span class="op" id="4001623">(</span><span class="ident" id="4001624">n</span>&nbsp;<span class="builtintype" id="4001626">int</span><span class="op" id="4001629">)</span>&nbsp;<span class="op" id="4001631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001634">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001672"><a href="/net/textproto/reader.go.html#4001587">r</a></span><span class="op" id="4001673">.</span><span class="ident" id="4001674">R</span><span class="op" id="4001675">.</span><span class="ident" id="4001676">Peek</span><span class="op" id="4001680">(</span><span class="num" id="4001681">1</span><span class="op" id="4001682">)</span>&nbsp;<span class="comment" id="4001684">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001717">s</span>&nbsp;<span class="op" id="4001719">:=</span>&nbsp;<span class="ident" id="4001722"><a href="/net/textproto/reader.go.html#4001587">r</a></span><span class="op" id="4001723">.</span><span class="ident" id="4001724">R</span><span class="op" id="4001725">.</span><span class="ident" id="4001726">Buffered</span><span class="op" id="4001734">(</span><span class="op" id="4001735">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001738">if</span>&nbsp;<span class="ident" id="4001741"><a href="/net/textproto/reader.go.html#4001717">s</a></span>&nbsp;<span class="op" id="4001743">==</span>&nbsp;<span class="num" id="4001746">0</span>&nbsp;<span class="op" id="4001748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001752">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001763">peek</span><span class="op" id="4001767">,</span>&nbsp;<span class="ident" id="4001769">_</span>&nbsp;<span class="op" id="4001771">:=</span>&nbsp;<span class="ident" id="4001774"><a href="/net/textproto/reader.go.html#4001587">r</a></span><span class="op" id="4001775">.</span><span class="ident" id="4001776">R</span><span class="op" id="4001777">.</span><span class="ident" id="4001778">Peek</span><span class="op" id="4001782">(</span><span class="ident" id="4001783"><a href="/net/textproto/reader.go.html#4001717">s</a></span><span class="op" id="4001784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001787">for</span>&nbsp;<span class="builtinfunc" id="4001791">len</span><span class="op" id="4001794">(</span><span class="ident" id="4001795"><a href="/net/textproto/reader.go.html#4001763">peek</a></span><span class="op" id="4001799">)</span>&nbsp;<span class="op" id="4001801">&gt;</span>&nbsp;<span class="num" id="4001803">0</span>&nbsp;<span class="op" id="4001805">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001809">i</span>&nbsp;<span class="op" id="4001811">:=</span>&nbsp;<span class="ident" id="4001814"><a href="/net/textproto/reader.go.html#3988285">bytes</a></span><span class="op" id="4001819">.</span><span class="ident" id="4001820">IndexByte</span><span class="op" id="4001829">(</span><span class="ident" id="4001830"><a href="/net/textproto/reader.go.html#4001763">peek</a></span><span class="op" id="4001834">,</span>&nbsp;<span class="string" id="4001836">&#39;\n&#39;</span><span class="op" id="4001840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001844">if</span>&nbsp;<span class="ident" id="4001847"><a href="/net/textproto/reader.go.html#4001809">i</a></span>&nbsp;<span class="op" id="4001849">&lt;</span>&nbsp;<span class="num" id="4001851">3</span>&nbsp;<span class="op" id="4001853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001858">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4001917">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4001972">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4001981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001985"><a href="/net/textproto/reader.go.html#4001624">n</a></span><span class="op" id="4001986">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4001991"><a href="/net/textproto/reader.go.html#4001763">peek</a></span>&nbsp;<span class="op" id="4001996">=</span>&nbsp;<span class="ident" id="4001998"><a href="/net/textproto/reader.go.html#4001763">peek</a></span><span class="op" id="4002002">[</span><span class="ident" id="4002003"><a href="/net/textproto/reader.go.html#4001809">i</a></span><span class="op" id="4002004">+</span><span class="num" id="4002005">1</span><span class="op" id="4002006">:</span><span class="op" id="4002007">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002013">return</span><br>
<span class="lineno">535</span><span class="op" id="4002020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4002023">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4002085">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4002148">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="4002207">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4002265">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4002326">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="4002376">func</span>&nbsp;<span class="ident" id="4002381">CanonicalMIMEHeaderKey</span><span class="op" id="4002403">(</span><span class="ident" id="4002404">s</span>&nbsp;<span class="builtintype" id="4002406">string</span><span class="op" id="4002412">)</span>&nbsp;<span class="builtintype" id="4002414">string</span>&nbsp;<span class="op" id="4002421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002424">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002464">upper</span>&nbsp;<span class="op" id="4002470">:=</span>&nbsp;<span class="ident" id="4002473">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002479">for</span>&nbsp;<span class="ident" id="4002483">i</span>&nbsp;<span class="op" id="4002485">:=</span>&nbsp;<span class="num" id="4002488">0</span><span class="op" id="4002489">;</span>&nbsp;<span class="ident" id="4002491"><a href="/net/textproto/reader.go.html#4002483">i</a></span>&nbsp;<span class="op" id="4002493">&lt;</span>&nbsp;<span class="builtinfunc" id="4002495">len</span><span class="op" id="4002498">(</span><span class="ident" id="4002499"><a href="/net/textproto/reader.go.html#4002404">s</a></span><span class="op" id="4002500">)</span><span class="op" id="4002501">;</span>&nbsp;<span class="ident" id="4002503"><a href="/net/textproto/reader.go.html#4002483">i</a></span><span class="op" id="4002504">++</span>&nbsp;<span class="op" id="4002507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002511">c</span>&nbsp;<span class="op" id="4002513">:=</span>&nbsp;<span class="ident" id="4002516"><a href="/net/textproto/reader.go.html#4002404">s</a></span><span class="op" id="4002517">[</span><span class="ident" id="4002518"><a href="/net/textproto/reader.go.html#4002483">i</a></span><span class="op" id="4002519">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002523">if</span>&nbsp;<span class="ident" id="4002526"><a href="/net/textproto/reader.go.html#4002464">upper</a></span>&nbsp;<span class="op" id="4002532">&amp;&amp;</span>&nbsp;<span class="string" id="4002535">&#39;a&#39;</span>&nbsp;<span class="op" id="4002539">&lt;=</span>&nbsp;<span class="ident" id="4002542"><a href="/net/textproto/reader.go.html#4002511">c</a></span>&nbsp;<span class="op" id="4002544">&amp;&amp;</span>&nbsp;<span class="ident" id="4002547"><a href="/net/textproto/reader.go.html#4002511">c</a></span>&nbsp;<span class="op" id="4002549">&lt;=</span>&nbsp;<span class="string" id="4002552">&#39;z&#39;</span>&nbsp;<span class="op" id="4002556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002561">return</span>&nbsp;<span class="ident" id="4002568"><a href="/net/textproto/reader.go.html#4002900">canonicalMIMEHeaderKey</a></span><span class="op" id="4002590">(</span><span class="op" id="4002591">[</span><span class="op" id="4002592">]</span><span class="builtintype" id="4002593">byte</span><span class="op" id="4002597">(</span><span class="ident" id="4002598"><a href="/net/textproto/reader.go.html#4002404">s</a></span><span class="op" id="4002599">)</span><span class="op" id="4002600">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002608">if</span>&nbsp;<span class="op" id="4002611">!</span><span class="ident" id="4002612"><a href="/net/textproto/reader.go.html#4002464">upper</a></span>&nbsp;<span class="op" id="4002618">&amp;&amp;</span>&nbsp;<span class="string" id="4002621">&#39;A&#39;</span>&nbsp;<span class="op" id="4002625">&lt;=</span>&nbsp;<span class="ident" id="4002628"><a href="/net/textproto/reader.go.html#4002511">c</a></span>&nbsp;<span class="op" id="4002630">&amp;&amp;</span>&nbsp;<span class="ident" id="4002633"><a href="/net/textproto/reader.go.html#4002511">c</a></span>&nbsp;<span class="op" id="4002635">&lt;=</span>&nbsp;<span class="string" id="4002638">&#39;Z&#39;</span>&nbsp;<span class="op" id="4002642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002647">return</span>&nbsp;<span class="ident" id="4002654"><a href="/net/textproto/reader.go.html#4002900">canonicalMIMEHeaderKey</a></span><span class="op" id="4002676">(</span><span class="op" id="4002677">[</span><span class="op" id="4002678">]</span><span class="builtintype" id="4002679">byte</span><span class="op" id="4002683">(</span><span class="ident" id="4002684"><a href="/net/textproto/reader.go.html#4002404">s</a></span><span class="op" id="4002685">)</span><span class="op" id="4002686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002694"><a href="/net/textproto/reader.go.html#4002464">upper</a></span>&nbsp;<span class="op" id="4002700">=</span>&nbsp;<span class="ident" id="4002702"><a href="/net/textproto/reader.go.html#4002511">c</a></span>&nbsp;<span class="op" id="4002704">==</span>&nbsp;<span class="string" id="4002707">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4002712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002715">return</span>&nbsp;<span class="ident" id="4002722"><a href="/net/textproto/reader.go.html#4002404">s</a></span><br>
<span class="lineno"></span><span class="op" id="4002724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4002727">const</span>&nbsp;<span class="ident" id="4002733">toLower</span>&nbsp;<span class="op" id="4002741">=</span>&nbsp;<span class="string" id="4002743">&#39;a&#39;</span>&nbsp;<span class="op" id="4002747">-</span>&nbsp;<span class="string" id="4002749">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="4002754">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4002818">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4002884">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="4002895">func</span>&nbsp;<span class="ident" id="4002900">canonicalMIMEHeaderKey</span><span class="op" id="4002922">(</span><span class="ident" id="4002923">a</span>&nbsp;<span class="op" id="4002925">[</span><span class="op" id="4002926">]</span><span class="builtintype" id="4002927">byte</span><span class="op" id="4002931">)</span>&nbsp;<span class="builtintype" id="4002933">string</span>&nbsp;<span class="op" id="4002940">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4002943">upper</span>&nbsp;<span class="op" id="4002949">:=</span>&nbsp;<span class="ident" id="4002952">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4002958">for</span>&nbsp;<span class="ident" id="4002962">i</span><span class="op" id="4002963">,</span>&nbsp;<span class="ident" id="4002965">c</span>&nbsp;<span class="op" id="4002967">:=</span>&nbsp;<span class="keyword" id="4002970">range</span>&nbsp;<span class="ident" id="4002976"><a href="/net/textproto/reader.go.html#4002923">a</a></span>&nbsp;<span class="op" id="4002978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4002982">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003025">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003062">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003106">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003162">if</span>&nbsp;<span class="ident" id="4003165"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003167">==</span>&nbsp;<span class="string" id="4003170">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4003174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003179"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003181">=</span>&nbsp;<span class="string" id="4003183">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003189">}</span>&nbsp;<span class="keyword" id="4003191">else</span>&nbsp;<span class="keyword" id="4003196">if</span>&nbsp;<span class="ident" id="4003199"><a href="/net/textproto/reader.go.html#4002943">upper</a></span>&nbsp;<span class="op" id="4003205">&amp;&amp;</span>&nbsp;<span class="string" id="4003208">&#39;a&#39;</span>&nbsp;<span class="op" id="4003212">&lt;=</span>&nbsp;<span class="ident" id="4003215"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003217">&amp;&amp;</span>&nbsp;<span class="ident" id="4003220"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003222">&lt;=</span>&nbsp;<span class="string" id="4003225">&#39;z&#39;</span>&nbsp;<span class="op" id="4003229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003234"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003236">-=</span>&nbsp;<span class="ident" id="4003239"><a href="/net/textproto/reader.go.html#4002733">toLower</a></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003249">}</span>&nbsp;<span class="keyword" id="4003251">else</span>&nbsp;<span class="keyword" id="4003256">if</span>&nbsp;<span class="op" id="4003259">!</span><span class="ident" id="4003260"><a href="/net/textproto/reader.go.html#4002943">upper</a></span>&nbsp;<span class="op" id="4003266">&amp;&amp;</span>&nbsp;<span class="string" id="4003269">&#39;A&#39;</span>&nbsp;<span class="op" id="4003273">&lt;=</span>&nbsp;<span class="ident" id="4003276"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003278">&amp;&amp;</span>&nbsp;<span class="ident" id="4003281"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003283">&lt;=</span>&nbsp;<span class="string" id="4003286">&#39;Z&#39;</span>&nbsp;<span class="op" id="4003290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003295"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003297">+=</span>&nbsp;<span class="ident" id="4003300"><a href="/net/textproto/reader.go.html#4002733">toLower</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003314"><a href="/net/textproto/reader.go.html#4002923">a</a></span><span class="op" id="4003315">[</span><span class="ident" id="4003316"><a href="/net/textproto/reader.go.html#4002962">i</a></span><span class="op" id="4003317">]</span>&nbsp;<span class="op" id="4003319">=</span>&nbsp;<span class="ident" id="4003321"><a href="/net/textproto/reader.go.html#4002965">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4003325"><a href="/net/textproto/reader.go.html#4002943">upper</a></span>&nbsp;<span class="op" id="4003331">=</span>&nbsp;<span class="ident" id="4003333"><a href="/net/textproto/reader.go.html#4002965">c</a></span>&nbsp;<span class="op" id="4003335">==</span>&nbsp;<span class="string" id="4003338">&#39;-&#39;</span>&nbsp;<span class="comment" id="4003342">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003363">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003425">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4003485">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003516">if</span>&nbsp;<span class="ident" id="4003519">v</span>&nbsp;<span class="op" id="4003521">:=</span>&nbsp;<span class="ident" id="4003524"><a href="/net/textproto/reader.go.html#4003645">commonHeader</a></span><span class="op" id="4003536">[</span><span class="builtintype" id="4003537">string</span><span class="op" id="4003543">(</span><span class="ident" id="4003544"><a href="/net/textproto/reader.go.html#4002923">a</a></span><span class="op" id="4003545">)</span><span class="op" id="4003546">]</span><span class="op" id="4003547">;</span>&nbsp;<span class="ident" id="4003549"><a href="/net/textproto/reader.go.html#4003519">v</a></span>&nbsp;<span class="op" id="4003551">!=</span>&nbsp;<span class="string" id="4003554">&#34;&#34;</span>&nbsp;<span class="op" id="4003557">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003561">return</span>&nbsp;<span class="ident" id="4003568"><a href="/net/textproto/reader.go.html#4003519">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4003571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003574">return</span>&nbsp;<span class="builtintype" id="4003581">string</span><span class="op" id="4003587">(</span><span class="ident" id="4003588"><a href="/net/textproto/reader.go.html#4002923">a</a></span><span class="op" id="4003589">)</span><br>
<span class="lineno"></span><span class="op" id="4003591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4003594">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="4003641">var</span>&nbsp;<span class="ident" id="4003645">commonHeader</span>&nbsp;<span class="op" id="4003658">=</span>&nbsp;<span class="builtinfunc" id="4003660">make</span><span class="op" id="4003664">(</span><span class="keyword" id="4003665">map</span><span class="op" id="4003668">[</span><span class="builtintype" id="4003669">string</span><span class="op" id="4003675">]</span><span class="builtintype" id="4003676">string</span><span class="op" id="4003682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4003685">func</span>&nbsp;<span class="ident" id="4003690">init</span><span class="op" id="4003694">(</span><span class="op" id="4003695">)</span>&nbsp;<span class="op" id="4003697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4003700">for</span>&nbsp;<span class="ident" id="4003704">_</span><span class="op" id="4003705">,</span>&nbsp;<span class="ident" id="4003707">v</span>&nbsp;<span class="op" id="4003709">:=</span>&nbsp;<span class="keyword" id="4003712">range</span>&nbsp;<span class="op" id="4003718">[</span><span class="op" id="4003719">]</span><span class="builtintype" id="4003720">string</span><span class="op" id="4003726">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003730">&#34;Accept&#34;</span><span class="op" id="4003738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003742">&#34;Accept-Charset&#34;</span><span class="op" id="4003758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003762">&#34;Accept-Encoding&#34;</span><span class="op" id="4003779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003783">&#34;Accept-Language&#34;</span><span class="op" id="4003800">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003804">&#34;Accept-Ranges&#34;</span><span class="op" id="4003819">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003823">&#34;Cache-Control&#34;</span><span class="op" id="4003838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003842">&#34;Cc&#34;</span><span class="op" id="4003846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003850">&#34;Connection&#34;</span><span class="op" id="4003862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003866">&#34;Content-Id&#34;</span><span class="op" id="4003878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003882">&#34;Content-Language&#34;</span><span class="op" id="4003900">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003904">&#34;Content-Length&#34;</span><span class="op" id="4003920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003924">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="4003951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003955">&#34;Content-Type&#34;</span><span class="op" id="4003969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003973">&#34;Cookie&#34;</span><span class="op" id="4003981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003985">&#34;Date&#34;</span><span class="op" id="4003991">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4003995">&#34;Dkim-Signature&#34;</span><span class="op" id="4004011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004015">&#34;Etag&#34;</span><span class="op" id="4004021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004025">&#34;Expires&#34;</span><span class="op" id="4004034">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004038">&#34;From&#34;</span><span class="op" id="4004044">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004048">&#34;Host&#34;</span><span class="op" id="4004054">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004058">&#34;If-Modified-Since&#34;</span><span class="op" id="4004077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004081">&#34;If-None-Match&#34;</span><span class="op" id="4004096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004100">&#34;In-Reply-To&#34;</span><span class="op" id="4004113">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004117">&#34;Last-Modified&#34;</span><span class="op" id="4004132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004136">&#34;Location&#34;</span><span class="op" id="4004146">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004150">&#34;Message-Id&#34;</span><span class="op" id="4004162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004166">&#34;Mime-Version&#34;</span><span class="op" id="4004180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004184">&#34;Pragma&#34;</span><span class="op" id="4004192">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004196">&#34;Received&#34;</span><span class="op" id="4004206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004210">&#34;Return-Path&#34;</span><span class="op" id="4004223">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004227">&#34;Server&#34;</span><span class="op" id="4004235">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004239">&#34;Set-Cookie&#34;</span><span class="op" id="4004251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004255">&#34;Subject&#34;</span><span class="op" id="4004264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004268">&#34;To&#34;</span><span class="op" id="4004272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004276">&#34;User-Agent&#34;</span><span class="op" id="4004288">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004292">&#34;Via&#34;</span><span class="op" id="4004297">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004301">&#34;X-Forwarded-For&#34;</span><span class="op" id="4004318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004322">&#34;X-Imforwards&#34;</span><span class="op" id="4004336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4004340">&#34;X-Powered-By&#34;</span><span class="op" id="4004354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004357">}</span>&nbsp;<span class="op" id="4004359">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4004363"><a href="/net/textproto/reader.go.html#4003645">commonHeader</a></span><span class="op" id="4004375">[</span><span class="ident" id="4004376"><a href="/net/textproto/reader.go.html#4003707">v</a></span><span class="op" id="4004377">]</span>&nbsp;<span class="op" id="4004379">=</span>&nbsp;<span class="ident" id="4004381"><a href="/net/textproto/reader.go.html#4003707">v</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4004384">}</span><br>
<span class="lineno"></span><span class="op" id="4004386">}</span>
</div>
</body>
</html>
