<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5991103">package</span>&nbsp;<span class="ident" id="5991111">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991118">import</span>&nbsp;<span class="op" id="5991125">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5991128">&#34;math/rand&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5991141">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5991148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5991151">//&nbsp;Ticker&nbsp;is&nbsp;a&nbsp;device&nbsp;that&nbsp;generates&nbsp;time&nbsp;interrupts.</span><br>
<span class="lineno"></span><span class="keyword" id="5991205">type</span>&nbsp;<span class="ident" id="5991210">ticker</span>&nbsp;<span class="keyword" id="5991217">struct</span>&nbsp;<span class="op" id="5991224">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991227">intBus</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5991236"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5972384">intBus</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991244">nextTick</span>&nbsp;<span class="builtintype" id="5991253">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991261">Interval</span>&nbsp;<span class="builtintype" id="5991270">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991277">Noise</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5991286">int32</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991293">Rand</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5991302">*</span><span class="ident" id="5991303"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991128">rand</a></span><span class="op" id="5991307">.</span><span class="ident" id="5991308">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991314">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5991323">byte</span><br>
<span class="lineno"></span><span class="op" id="5991328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5991331">//&nbsp;NewTicker&nbsp;creates&nbsp;a&nbsp;new&nbsp;time&nbsp;interrupt&nbsp;generator.</span><br>
<span class="lineno">20</span><span class="keyword" id="5991384">func</span>&nbsp;<span class="ident" id="5991389">newTicker</span><span class="op" id="5991398">(</span><span class="ident" id="5991399">bus</span>&nbsp;<span class="ident" id="5991403"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5972384">intBus</a></span><span class="op" id="5991409">)</span>&nbsp;<span class="op" id="5991411">*</span><span class="ident" id="5991412"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991210">ticker</a></span>&nbsp;<span class="op" id="5991419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991422">ret</span>&nbsp;<span class="op" id="5991426">:=</span>&nbsp;<span class="builtinfunc" id="5991429">new</span><span class="op" id="5991432">(</span><span class="ident" id="5991433"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991210">ticker</a></span><span class="op" id="5991439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991442"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><span class="op" id="5991445">.</span><span class="ident" id="5991446">intBus</span>&nbsp;<span class="op" id="5991453">=</span>&nbsp;<span class="ident" id="5991455"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991399">bus</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991461"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><span class="op" id="5991464">.</span><span class="ident" id="5991465">Interval</span>&nbsp;<span class="op" id="5991474">=</span>&nbsp;<span class="num" id="5991476">1000</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991482"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><span class="op" id="5991485">.</span><span class="ident" id="5991486">Noise</span>&nbsp;<span class="op" id="5991492">=</span>&nbsp;<span class="num" id="5991494">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991498"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><span class="op" id="5991501">.</span><span class="ident" id="5991502">Rand</span>&nbsp;<span class="op" id="5991507">=</span>&nbsp;<span class="ident" id="5991509"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991128">rand</a></span><span class="op" id="5991513">.</span><span class="ident" id="5991514">New</span><span class="op" id="5991517">(</span><span class="ident" id="5991518"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991128">rand</a></span><span class="op" id="5991522">.</span><span class="ident" id="5991523">NewSource</span><span class="op" id="5991532">(</span><span class="ident" id="5991533"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991141">time</a></span><span class="op" id="5991537">.</span><span class="ident" id="5991538">Now</span><span class="op" id="5991541">(</span><span class="op" id="5991542">)</span><span class="op" id="5991543">.</span><span class="ident" id="5991544">UnixNano</span><span class="op" id="5991552">(</span><span class="op" id="5991553">)</span><span class="op" id="5991554">)</span><span class="op" id="5991555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991558"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><span class="op" id="5991561">.</span><span class="ident" id="5991562">Code</span>&nbsp;<span class="op" id="5991567">=</span>&nbsp;<span class="num" id="5991569">2</span>&nbsp;<span class="comment" id="5991571">//&nbsp;time&nbsp;interrupt&nbsp;code</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991596"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><span class="op" id="5991599">.</span><span class="ident" id="5991600">reset</span><span class="op" id="5991605">(</span><span class="op" id="5991606">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991610">return</span>&nbsp;<span class="ident" id="5991617"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991422">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5991621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5991624">func</span>&nbsp;<span class="op" id="5991629">(</span><span class="ident" id="5991630">t</span>&nbsp;<span class="op" id="5991632">*</span><span class="ident" id="5991633"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991210">ticker</a></span><span class="op" id="5991639">)</span>&nbsp;<span class="ident" id="5991641">reset</span><span class="op" id="5991646">(</span><span class="op" id="5991647">)</span>&nbsp;<span class="op" id="5991649">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991652">if</span>&nbsp;<span class="ident" id="5991655"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991656">.</span><span class="ident" id="5991657">Noise</span>&nbsp;<span class="op" id="5991663">&lt;</span>&nbsp;<span class="num" id="5991665">0</span>&nbsp;<span class="op" id="5991667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5991671">panic</span><span class="op" id="5991676">(</span><span class="string" id="5991677">&#34;negative&nbsp;ticker&nbsp;noise&#34;</span><span class="op" id="5991700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991706">if</span>&nbsp;<span class="ident" id="5991709"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991710">.</span><span class="ident" id="5991711">Interval</span>&nbsp;<span class="op" id="5991720">&lt;</span>&nbsp;<span class="num" id="5991722">0</span>&nbsp;<span class="op" id="5991724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5991728">panic</span><span class="op" id="5991733">(</span><span class="string" id="5991734">&#34;negative&nbsp;ticker&nbsp;interval&#34;</span><span class="op" id="5991760">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991767">noise</span>&nbsp;<span class="op" id="5991773">:=</span>&nbsp;<span class="builtintype" id="5991776">int32</span><span class="op" id="5991781">(</span><span class="num" id="5991782">0</span><span class="op" id="5991783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991786">if</span>&nbsp;<span class="ident" id="5991789"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991790">.</span><span class="ident" id="5991791">Noise</span>&nbsp;<span class="op" id="5991797">&gt;</span>&nbsp;<span class="num" id="5991799">0</span>&nbsp;<span class="op" id="5991801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991805"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991767">noise</a></span>&nbsp;<span class="op" id="5991811">=</span>&nbsp;<span class="ident" id="5991813"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991814">.</span><span class="ident" id="5991815">Rand</span><span class="op" id="5991819">.</span><span class="ident" id="5991820">Int31n</span><span class="op" id="5991826">(</span><span class="ident" id="5991827"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991828">.</span><span class="ident" id="5991829">Noise</span><span class="op" id="5991834">)</span>&nbsp;<span class="op" id="5991836">-</span>&nbsp;<span class="ident" id="5991838"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991839">.</span><span class="ident" id="5991840">Noise</span><span class="op" id="5991845">/</span><span class="num" id="5991846">2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991853">next</span>&nbsp;<span class="op" id="5991858">:=</span>&nbsp;<span class="ident" id="5991861"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991862">.</span><span class="ident" id="5991863">Interval</span>&nbsp;<span class="op" id="5991872">+</span>&nbsp;<span class="ident" id="5991874"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991767">noise</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5991881">if</span>&nbsp;<span class="ident" id="5991884"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991853">next</a></span>&nbsp;<span class="op" id="5991889">&lt;</span>&nbsp;<span class="num" id="5991891">0</span>&nbsp;<span class="op" id="5991893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991897"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991853">next</a></span>&nbsp;<span class="op" id="5991902">=</span>&nbsp;<span class="num" id="5991904">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5991907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991911"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991630">t</a></span><span class="op" id="5991912">.</span><span class="ident" id="5991913">nextTick</span>&nbsp;<span class="op" id="5991922">=</span>&nbsp;<span class="ident" id="5991924"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991853">next</a></span><br>
<span class="lineno"></span><span class="op" id="5991929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5991932">//&nbsp;Tick&nbsp;decreases&nbsp;the&nbsp;ticking&nbsp;counter.&nbsp;If&nbsp;the&nbsp;counter&nbsp;reaches&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="5991997">//&nbsp;it&nbsp;will&nbsp;issue&nbsp;interrupts&nbsp;to&nbsp;all&nbsp;cores&nbsp;and&nbsp;reset&nbsp;the&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="5992061">func</span>&nbsp;<span class="op" id="5992066">(</span><span class="ident" id="5992067">t</span>&nbsp;<span class="op" id="5992069">*</span><span class="ident" id="5992070"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5991210">ticker</a></span><span class="op" id="5992076">)</span>&nbsp;<span class="ident" id="5992078">Tick</span><span class="op" id="5992082">(</span><span class="op" id="5992083">)</span>&nbsp;<span class="op" id="5992085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992088">if</span>&nbsp;<span class="ident" id="5992091"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5992067">t</a></span><span class="op" id="5992092">.</span><span class="ident" id="5992093">nextTick</span>&nbsp;<span class="op" id="5992102">&lt;</span>&nbsp;<span class="num" id="5992104">0</span>&nbsp;<span class="op" id="5992106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5992110">panic</span><span class="op" id="5992115">(</span><span class="string" id="5992116">&#34;bug&#34;</span><span class="op" id="5992121">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5992128">if</span>&nbsp;<span class="ident" id="5992131"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5992067">t</a></span><span class="op" id="5992132">.</span><span class="ident" id="5992133">nextTick</span>&nbsp;<span class="op" id="5992142">==</span>&nbsp;<span class="num" id="5992145">0</span>&nbsp;<span class="op" id="5992147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992151"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5972520">intAllCores</a></span><span class="op" id="5992162">(</span><span class="ident" id="5992163"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5992067">t</a></span><span class="op" id="5992164">.</span><span class="ident" id="5992165">intBus</span><span class="op" id="5992171">,</span>&nbsp;<span class="ident" id="5992173"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5992067">t</a></span><span class="op" id="5992174">.</span><span class="ident" id="5992175">Code</span><span class="op" id="5992179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992183"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5992067">t</a></span><span class="op" id="5992184">.</span><span class="ident" id="5992185">reset</span><span class="op" id="5992190">(</span><span class="op" id="5992191">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992194">}</span>&nbsp;<span class="keyword" id="5992196">else</span>&nbsp;<span class="op" id="5992201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5992205"><a href="/lonnie.io/e8vm/arch8/ticker.go.html#5992067">t</a></span><span class="op" id="5992206">.</span><span class="ident" id="5992207">nextTick</span><span class="op" id="5992215">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5992219">}</span><br>
<span class="lineno"></span><span class="op" id="5992221">}</span>
</div>
</body>
</html>
