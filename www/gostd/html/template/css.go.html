<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4550297">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4550352">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4550406">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4550457">package</span>&nbsp;<span class="ident" id="4550465">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4550475">import</span>&nbsp;<span class="op" id="4550482">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550485">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550494">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550501">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4550512">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4550527">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4550530">//&nbsp;endsWithCSSKeyword&nbsp;reports&nbsp;whether&nbsp;b&nbsp;ends&nbsp;with&nbsp;an&nbsp;ident&nbsp;that</span><br>
<span class="lineno">15</span><span class="comment" id="4550594">//&nbsp;case-insensitively&nbsp;matches&nbsp;the&nbsp;lower-case&nbsp;kw.</span><br>
<span class="lineno"></span><span class="keyword" id="4550643">func</span>&nbsp;<span class="ident" id="4550648">endsWithCSSKeyword</span><span class="op" id="4550666">(</span><span class="ident" id="4550667">b</span>&nbsp;<span class="op" id="4550669">[</span><span class="op" id="4550670">]</span><span class="builtintype" id="4550671">byte</span><span class="op" id="4550675">,</span>&nbsp;<span class="ident" id="4550677">kw</span>&nbsp;<span class="builtintype" id="4550680">string</span><span class="op" id="4550686">)</span>&nbsp;<span class="builtintype" id="4550688">bool</span>&nbsp;<span class="op" id="4550693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550696">i</span>&nbsp;<span class="op" id="4550698">:=</span>&nbsp;<span class="builtinfunc" id="4550701">len</span><span class="op" id="4550704">(</span><span class="ident" id="4550705">b</span><span class="op" id="4550706">)</span>&nbsp;<span class="op" id="4550708">-</span>&nbsp;<span class="builtinfunc" id="4550710">len</span><span class="op" id="4550713">(</span><span class="ident" id="4550714">kw</span><span class="op" id="4550716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550719">if</span>&nbsp;<span class="ident" id="4550722">i</span>&nbsp;<span class="op" id="4550724">&lt;</span>&nbsp;<span class="num" id="4550726">0</span>&nbsp;<span class="op" id="4550728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4550732">//&nbsp;Too&nbsp;short.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550748">return</span>&nbsp;<span class="builtintype" id="4550755">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550765">if</span>&nbsp;<span class="ident" id="4550768">i</span>&nbsp;<span class="op" id="4550770">!=</span>&nbsp;<span class="num" id="4550773">0</span>&nbsp;<span class="op" id="4550775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4550779">r</span><span class="op" id="4550780">,</span>&nbsp;<span class="ident" id="4550782">_</span>&nbsp;<span class="op" id="4550784">:=</span>&nbsp;<span class="ident" id="4550787">utf8</span><span class="op" id="4550791">.</span><span class="ident" id="4550792">DecodeLastRune</span><span class="op" id="4550806">(</span><span class="ident" id="4550807">b</span><span class="op" id="4550808">[</span><span class="op" id="4550809">:</span><span class="ident" id="4550810">i</span><span class="op" id="4550811">]</span><span class="op" id="4550812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550816">if</span>&nbsp;<span class="ident" id="4550819">isCSSNmchar</span><span class="op" id="4550830">(</span><span class="ident" id="4550831">r</span><span class="op" id="4550832">)</span>&nbsp;<span class="op" id="4550834">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4550839">//&nbsp;Too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4550855">return</span>&nbsp;<span class="builtintype" id="4550862">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4550873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4550876">//&nbsp;Many&nbsp;CSS&nbsp;keywords,&nbsp;such&nbsp;as&nbsp;&#34;!important&#34;&nbsp;can&nbsp;have&nbsp;characters&nbsp;encoded,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4550949">//&nbsp;but&nbsp;the&nbsp;URI&nbsp;production&nbsp;does&nbsp;not&nbsp;allow&nbsp;that&nbsp;according&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551009">//&nbsp;http://www.w3.org/TR/css3-syntax/#TOK-URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551055">//&nbsp;This&nbsp;does&nbsp;not&nbsp;attempt&nbsp;to&nbsp;recognize&nbsp;encoded&nbsp;keywords.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551125">//&nbsp;given&nbsp;&#34;\75\72\6c&#34;&nbsp;and&nbsp;&#34;url&#34;&nbsp;this&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551176">return</span>&nbsp;<span class="builtintype" id="4551183">string</span><span class="op" id="4551189">(</span><span class="ident" id="4551190">bytes</span><span class="op" id="4551195">.</span><span class="ident" id="4551196">ToLower</span><span class="op" id="4551203">(</span><span class="ident" id="4551204">b</span><span class="op" id="4551205">[</span><span class="ident" id="4551206">i</span><span class="op" id="4551207">:</span><span class="op" id="4551208">]</span><span class="op" id="4551209">)</span><span class="op" id="4551210">)</span>&nbsp;<span class="op" id="4551212">==</span>&nbsp;<span class="ident" id="4551215">kw</span><br>
<span class="lineno">35</span><span class="op" id="4551218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4551221">//&nbsp;isCSSNmchar&nbsp;reports&nbsp;whether&nbsp;rune&nbsp;is&nbsp;allowed&nbsp;anywhere&nbsp;in&nbsp;a&nbsp;CSS&nbsp;identifier.</span><br>
<span class="lineno"></span><span class="keyword" id="4551298">func</span>&nbsp;<span class="ident" id="4551303">isCSSNmchar</span><span class="op" id="4551314">(</span><span class="ident" id="4551315">r</span>&nbsp;<span class="builtintype" id="4551317">rune</span><span class="op" id="4551321">)</span>&nbsp;<span class="builtintype" id="4551323">bool</span>&nbsp;<span class="op" id="4551328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551331">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;CSS3&nbsp;nmchar&nbsp;production&nbsp;but&nbsp;ignores&nbsp;multi-rune&nbsp;escape</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551401">//&nbsp;sequences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551416">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nmchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4551468">return</span>&nbsp;<span class="string" id="4551475">&#39;a&#39;</span>&nbsp;<span class="op" id="4551479">&lt;=</span>&nbsp;<span class="ident" id="4551482">r</span>&nbsp;<span class="op" id="4551484">&amp;&amp;</span>&nbsp;<span class="ident" id="4551487">r</span>&nbsp;<span class="op" id="4551489">&lt;=</span>&nbsp;<span class="string" id="4551492">&#39;z&#39;</span>&nbsp;<span class="op" id="4551496">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4551501">&#39;A&#39;</span>&nbsp;<span class="op" id="4551505">&lt;=</span>&nbsp;<span class="ident" id="4551508">r</span>&nbsp;<span class="op" id="4551510">&amp;&amp;</span>&nbsp;<span class="ident" id="4551513">r</span>&nbsp;<span class="op" id="4551515">&lt;=</span>&nbsp;<span class="string" id="4551518">&#39;Z&#39;</span>&nbsp;<span class="op" id="4551522">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4551527">&#39;0&#39;</span>&nbsp;<span class="op" id="4551531">&lt;=</span>&nbsp;<span class="ident" id="4551534">r</span>&nbsp;<span class="op" id="4551536">&amp;&amp;</span>&nbsp;<span class="ident" id="4551539">r</span>&nbsp;<span class="op" id="4551541">&lt;=</span>&nbsp;<span class="string" id="4551544">&#39;9&#39;</span>&nbsp;<span class="op" id="4551548">||</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551553">r</span>&nbsp;<span class="op" id="4551555">==</span>&nbsp;<span class="string" id="4551558">&#39;-&#39;</span>&nbsp;<span class="op" id="4551562">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551567">r</span>&nbsp;<span class="op" id="4551569">==</span>&nbsp;<span class="string" id="4551572">&#39;_&#39;</span>&nbsp;<span class="op" id="4551576">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4551581">//&nbsp;Non-ASCII&nbsp;cases&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4551609">0x80</span>&nbsp;<span class="op" id="4551614">&lt;=</span>&nbsp;<span class="ident" id="4551617">r</span>&nbsp;<span class="op" id="4551619">&amp;&amp;</span>&nbsp;<span class="ident" id="4551622">r</span>&nbsp;<span class="op" id="4551624">&lt;=</span>&nbsp;<span class="num" id="4551627">0xd7ff</span>&nbsp;<span class="op" id="4551634">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4551639">0xe000</span>&nbsp;<span class="op" id="4551646">&lt;=</span>&nbsp;<span class="ident" id="4551649">r</span>&nbsp;<span class="op" id="4551651">&amp;&amp;</span>&nbsp;<span class="ident" id="4551654">r</span>&nbsp;<span class="op" id="4551656">&lt;=</span>&nbsp;<span class="num" id="4551659">0xfffd</span>&nbsp;<span class="op" id="4551666">||</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4551671">0x10000</span>&nbsp;<span class="op" id="4551679">&lt;=</span>&nbsp;<span class="ident" id="4551682">r</span>&nbsp;<span class="op" id="4551684">&amp;&amp;</span>&nbsp;<span class="ident" id="4551687">r</span>&nbsp;<span class="op" id="4551689">&lt;=</span>&nbsp;<span class="num" id="4551692">0x10ffff</span><br>
<span class="lineno"></span><span class="op" id="4551701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4551704">//&nbsp;decodeCSS&nbsp;decodes&nbsp;CSS3&nbsp;escapes&nbsp;given&nbsp;a&nbsp;sequence&nbsp;of&nbsp;stringchars.</span><br>
<span class="lineno"></span><span class="comment" id="4551771">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;change,&nbsp;it&nbsp;returns&nbsp;the&nbsp;input,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno">55</span><span class="comment" id="4551848">//&nbsp;backed&nbsp;by&nbsp;a&nbsp;new&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4551874">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-stringchar&nbsp;defines&nbsp;stringchar.</span><br>
<span class="lineno"></span><span class="keyword" id="4551949">func</span>&nbsp;<span class="ident" id="4551954">decodeCSS</span><span class="op" id="4551963">(</span><span class="ident" id="4551964">s</span>&nbsp;<span class="op" id="4551966">[</span><span class="op" id="4551967">]</span><span class="builtintype" id="4551968">byte</span><span class="op" id="4551972">)</span>&nbsp;<span class="op" id="4551974">[</span><span class="op" id="4551975">]</span><span class="builtintype" id="4551976">byte</span>&nbsp;<span class="op" id="4551981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4551984">i</span>&nbsp;<span class="op" id="4551986">:=</span>&nbsp;<span class="ident" id="4551989">bytes</span><span class="op" id="4551994">.</span><span class="ident" id="4551995">IndexByte</span><span class="op" id="4552004">(</span><span class="ident" id="4552005">s</span><span class="op" id="4552006">,</span>&nbsp;<span class="string" id="4552008">&#39;\\&#39;</span><span class="op" id="4552012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552015">if</span>&nbsp;<span class="ident" id="4552018">i</span>&nbsp;<span class="op" id="4552020">==</span>&nbsp;<span class="op" id="4552023">-</span><span class="num" id="4552024">1</span>&nbsp;<span class="op" id="4552026">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552030">return</span>&nbsp;<span class="ident" id="4552037">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552043">//&nbsp;The&nbsp;UTF-8&nbsp;sequence&nbsp;for&nbsp;a&nbsp;codepoint&nbsp;is&nbsp;never&nbsp;longer&nbsp;than&nbsp;1&nbsp;+&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552111">//&nbsp;number&nbsp;hex&nbsp;digits&nbsp;need&nbsp;to&nbsp;represent&nbsp;that&nbsp;codepoint,&nbsp;so&nbsp;len(s)&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552183">//&nbsp;upper&nbsp;bound&nbsp;on&nbsp;the&nbsp;output&nbsp;length.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552221">b</span>&nbsp;<span class="op" id="4552223">:=</span>&nbsp;<span class="builtinfunc" id="4552226">make</span><span class="op" id="4552230">(</span><span class="op" id="4552231">[</span><span class="op" id="4552232">]</span><span class="builtintype" id="4552233">byte</span><span class="op" id="4552237">,</span>&nbsp;<span class="num" id="4552239">0</span><span class="op" id="4552240">,</span>&nbsp;<span class="builtinfunc" id="4552242">len</span><span class="op" id="4552245">(</span><span class="ident" id="4552246">s</span><span class="op" id="4552247">)</span><span class="op" id="4552248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552251">for</span>&nbsp;<span class="builtinfunc" id="4552255">len</span><span class="op" id="4552258">(</span><span class="ident" id="4552259">s</span><span class="op" id="4552260">)</span>&nbsp;<span class="op" id="4552262">!=</span>&nbsp;<span class="num" id="4552265">0</span>&nbsp;<span class="op" id="4552267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552271">i</span>&nbsp;<span class="op" id="4552273">:=</span>&nbsp;<span class="ident" id="4552276">bytes</span><span class="op" id="4552281">.</span><span class="ident" id="4552282">IndexByte</span><span class="op" id="4552291">(</span><span class="ident" id="4552292">s</span><span class="op" id="4552293">,</span>&nbsp;<span class="string" id="4552295">&#39;\\&#39;</span><span class="op" id="4552299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552303">if</span>&nbsp;<span class="ident" id="4552306">i</span>&nbsp;<span class="op" id="4552308">==</span>&nbsp;<span class="op" id="4552311">-</span><span class="num" id="4552312">1</span>&nbsp;<span class="op" id="4552314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552319">i</span>&nbsp;<span class="op" id="4552321">=</span>&nbsp;<span class="builtinfunc" id="4552323">len</span><span class="op" id="4552326">(</span><span class="ident" id="4552327">s</span><span class="op" id="4552328">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552336">b</span><span class="op" id="4552337">,</span>&nbsp;<span class="ident" id="4552339">s</span>&nbsp;<span class="op" id="4552341">=</span>&nbsp;<span class="builtinfunc" id="4552343">append</span><span class="op" id="4552349">(</span><span class="ident" id="4552350">b</span><span class="op" id="4552351">,</span>&nbsp;<span class="ident" id="4552353">s</span><span class="op" id="4552354">[</span><span class="op" id="4552355">:</span><span class="ident" id="4552356">i</span><span class="op" id="4552357">]</span><span class="op" id="4552358">...</span><span class="op" id="4552361">)</span><span class="op" id="4552362">,</span>&nbsp;<span class="ident" id="4552364">s</span><span class="op" id="4552365">[</span><span class="ident" id="4552366">i</span><span class="op" id="4552367">:</span><span class="op" id="4552368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552372">if</span>&nbsp;<span class="builtinfunc" id="4552375">len</span><span class="op" id="4552378">(</span><span class="ident" id="4552379">s</span><span class="op" id="4552380">)</span>&nbsp;<span class="op" id="4552382">&lt;</span>&nbsp;<span class="num" id="4552384">2</span>&nbsp;<span class="op" id="4552386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552391">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552399">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552403">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552456">//&nbsp;escape&nbsp;::=&nbsp;unicode&nbsp;|&nbsp;&#39;\&#39;&nbsp;[#x20-#x7E#x80-#xD7FF#xE000-#xFFFD#x10000-#x10FFFF]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552538">if</span>&nbsp;<span class="ident" id="4552541">isHex</span><span class="op" id="4552546">(</span><span class="ident" id="4552547">s</span><span class="op" id="4552548">[</span><span class="num" id="4552549">1</span><span class="op" id="4552550">]</span><span class="op" id="4552551">)</span>&nbsp;<span class="op" id="4552553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552558">//&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-unicode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552613">//&nbsp;&nbsp;&nbsp;unicode&nbsp;::=&nbsp;&#39;\&#39;&nbsp;[0-9a-fA-F]{1,6}&nbsp;wc?</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552658">j</span>&nbsp;<span class="op" id="4552660">:=</span>&nbsp;<span class="num" id="4552663">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552668">for</span>&nbsp;<span class="ident" id="4552672">j</span>&nbsp;<span class="op" id="4552674">&lt;</span>&nbsp;<span class="builtinfunc" id="4552676">len</span><span class="op" id="4552679">(</span><span class="ident" id="4552680">s</span><span class="op" id="4552681">)</span>&nbsp;<span class="op" id="4552683">&amp;&amp;</span>&nbsp;<span class="ident" id="4552686">j</span>&nbsp;<span class="op" id="4552688">&lt;</span>&nbsp;<span class="num" id="4552690">7</span>&nbsp;<span class="op" id="4552692">&amp;&amp;</span>&nbsp;<span class="ident" id="4552695">isHex</span><span class="op" id="4552700">(</span><span class="ident" id="4552701">s</span><span class="op" id="4552702">[</span><span class="ident" id="4552703">j</span><span class="op" id="4552704">]</span><span class="op" id="4552705">)</span>&nbsp;<span class="op" id="4552707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552713">j</span><span class="op" id="4552714">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552725">r</span>&nbsp;<span class="op" id="4552727">:=</span>&nbsp;<span class="ident" id="4552730">hexDecode</span><span class="op" id="4552739">(</span><span class="ident" id="4552740">s</span><span class="op" id="4552741">[</span><span class="num" id="4552742">1</span><span class="op" id="4552743">:</span><span class="ident" id="4552744">j</span><span class="op" id="4552745">]</span><span class="op" id="4552746">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4552751">if</span>&nbsp;<span class="ident" id="4552754">r</span>&nbsp;<span class="op" id="4552756">&gt;</span>&nbsp;<span class="ident" id="4552758">unicode</span><span class="op" id="4552765">.</span><span class="ident" id="4552766">MaxRune</span>&nbsp;<span class="op" id="4552774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552780">r</span><span class="op" id="4552781">,</span>&nbsp;<span class="ident" id="4552783">j</span>&nbsp;<span class="op" id="4552785">=</span>&nbsp;<span class="ident" id="4552787">r</span><span class="op" id="4552788">/</span><span class="num" id="4552789">16</span><span class="op" id="4552791">,</span>&nbsp;<span class="ident" id="4552793">j</span><span class="op" id="4552794">-</span><span class="num" id="4552795">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4552800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552805">n</span>&nbsp;<span class="op" id="4552807">:=</span>&nbsp;<span class="ident" id="4552810">utf8</span><span class="op" id="4552814">.</span><span class="ident" id="4552815">EncodeRune</span><span class="op" id="4552825">(</span><span class="ident" id="4552826">b</span><span class="op" id="4552827">[</span><span class="builtinfunc" id="4552828">len</span><span class="op" id="4552831">(</span><span class="ident" id="4552832">b</span><span class="op" id="4552833">)</span><span class="op" id="4552834">:</span><span class="builtinfunc" id="4552835">cap</span><span class="op" id="4552838">(</span><span class="ident" id="4552839">b</span><span class="op" id="4552840">)</span><span class="op" id="4552841">]</span><span class="op" id="4552842">,</span>&nbsp;<span class="ident" id="4552844">r</span><span class="op" id="4552845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552850">//&nbsp;The&nbsp;optional&nbsp;space&nbsp;at&nbsp;the&nbsp;end&nbsp;allows&nbsp;a&nbsp;hex</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552899">//&nbsp;sequence&nbsp;to&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;literal&nbsp;hex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4552947">//&nbsp;string(decodeCSS([]byte(`\A&nbsp;B`)))&nbsp;==&nbsp;&#34;\nB&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4552996">b</span><span class="op" id="4552997">,</span>&nbsp;<span class="ident" id="4552999">s</span>&nbsp;<span class="op" id="4553001">=</span>&nbsp;<span class="ident" id="4553003">b</span><span class="op" id="4553004">[</span><span class="op" id="4553005">:</span><span class="builtinfunc" id="4553006">len</span><span class="op" id="4553009">(</span><span class="ident" id="4553010">b</span><span class="op" id="4553011">)</span><span class="op" id="4553012">+</span><span class="ident" id="4553013">n</span><span class="op" id="4553014">]</span><span class="op" id="4553015">,</span>&nbsp;<span class="ident" id="4553017">skipCSSSpace</span><span class="op" id="4553029">(</span><span class="ident" id="4553030">s</span><span class="op" id="4553031">[</span><span class="ident" id="4553032">j</span><span class="op" id="4553033">:</span><span class="op" id="4553034">]</span><span class="op" id="4553035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553039">}</span>&nbsp;<span class="keyword" id="4553041">else</span>&nbsp;<span class="op" id="4553046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553051">//&nbsp;`\\`&nbsp;decodes&nbsp;to&nbsp;`\`&nbsp;and&nbsp;`\&#34;`&nbsp;to&nbsp;`&#34;`.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553094">_</span><span class="op" id="4553095">,</span>&nbsp;<span class="ident" id="4553097">n</span>&nbsp;<span class="op" id="4553099">:=</span>&nbsp;<span class="ident" id="4553102">utf8</span><span class="op" id="4553106">.</span><span class="ident" id="4553107">DecodeRune</span><span class="op" id="4553117">(</span><span class="ident" id="4553118">s</span><span class="op" id="4553119">[</span><span class="num" id="4553120">1</span><span class="op" id="4553121">:</span><span class="op" id="4553122">]</span><span class="op" id="4553123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553128">b</span><span class="op" id="4553129">,</span>&nbsp;<span class="ident" id="4553131">s</span>&nbsp;<span class="op" id="4553133">=</span>&nbsp;<span class="builtinfunc" id="4553135">append</span><span class="op" id="4553141">(</span><span class="ident" id="4553142">b</span><span class="op" id="4553143">,</span>&nbsp;<span class="ident" id="4553145">s</span><span class="op" id="4553146">[</span><span class="num" id="4553147">1</span><span class="op" id="4553148">:</span><span class="num" id="4553149">1</span><span class="op" id="4553150">+</span><span class="ident" id="4553151">n</span><span class="op" id="4553152">]</span><span class="op" id="4553153">...</span><span class="op" id="4553156">)</span><span class="op" id="4553157">,</span>&nbsp;<span class="ident" id="4553159">s</span><span class="op" id="4553160">[</span><span class="num" id="4553161">1</span><span class="op" id="4553162">+</span><span class="ident" id="4553163">n</span><span class="op" id="4553164">:</span><span class="op" id="4553165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553175">return</span>&nbsp;<span class="ident" id="4553182">b</span><br>
<span class="lineno">100</span><span class="op" id="4553184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4553187">//&nbsp;isHex&nbsp;reports&nbsp;whether&nbsp;the&nbsp;given&nbsp;character&nbsp;is&nbsp;a&nbsp;hex&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="4553248">func</span>&nbsp;<span class="ident" id="4553253">isHex</span><span class="op" id="4553258">(</span><span class="ident" id="4553259">c</span>&nbsp;<span class="builtintype" id="4553261">byte</span><span class="op" id="4553265">)</span>&nbsp;<span class="builtintype" id="4553267">bool</span>&nbsp;<span class="op" id="4553272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553275">return</span>&nbsp;<span class="string" id="4553282">&#39;0&#39;</span>&nbsp;<span class="op" id="4553286">&lt;=</span>&nbsp;<span class="ident" id="4553289">c</span>&nbsp;<span class="op" id="4553291">&amp;&amp;</span>&nbsp;<span class="ident" id="4553294">c</span>&nbsp;<span class="op" id="4553296">&lt;=</span>&nbsp;<span class="string" id="4553299">&#39;9&#39;</span>&nbsp;<span class="op" id="4553303">||</span>&nbsp;<span class="string" id="4553306">&#39;a&#39;</span>&nbsp;<span class="op" id="4553310">&lt;=</span>&nbsp;<span class="ident" id="4553313">c</span>&nbsp;<span class="op" id="4553315">&amp;&amp;</span>&nbsp;<span class="ident" id="4553318">c</span>&nbsp;<span class="op" id="4553320">&lt;=</span>&nbsp;<span class="string" id="4553323">&#39;f&#39;</span>&nbsp;<span class="op" id="4553327">||</span>&nbsp;<span class="string" id="4553330">&#39;A&#39;</span>&nbsp;<span class="op" id="4553334">&lt;=</span>&nbsp;<span class="ident" id="4553337">c</span>&nbsp;<span class="op" id="4553339">&amp;&amp;</span>&nbsp;<span class="ident" id="4553342">c</span>&nbsp;<span class="op" id="4553344">&lt;=</span>&nbsp;<span class="string" id="4553347">&#39;F&#39;</span><br>
<span class="lineno">105</span><span class="op" id="4553351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4553354">//&nbsp;hexDecode&nbsp;decodes&nbsp;a&nbsp;short&nbsp;hex&nbsp;digit&nbsp;sequence:&nbsp;&#34;10&#34;&nbsp;-&gt;&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="4553415">func</span>&nbsp;<span class="ident" id="4553420">hexDecode</span><span class="op" id="4553429">(</span><span class="ident" id="4553430">s</span>&nbsp;<span class="op" id="4553432">[</span><span class="op" id="4553433">]</span><span class="builtintype" id="4553434">byte</span><span class="op" id="4553438">)</span>&nbsp;<span class="builtintype" id="4553440">rune</span>&nbsp;<span class="op" id="4553445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553448">n</span>&nbsp;<span class="op" id="4553450">:=</span>&nbsp;<span class="string" id="4553453">&#39;\x00&#39;</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553461">for</span>&nbsp;<span class="ident" id="4553465">_</span><span class="op" id="4553466">,</span>&nbsp;<span class="ident" id="4553468">c</span>&nbsp;<span class="op" id="4553470">:=</span>&nbsp;<span class="keyword" id="4553473">range</span>&nbsp;<span class="ident" id="4553479">s</span>&nbsp;<span class="op" id="4553481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553485">n</span>&nbsp;<span class="op" id="4553487">&lt;&lt;=</span>&nbsp;<span class="num" id="4553491">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553495">switch</span>&nbsp;<span class="op" id="4553502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553506">case</span>&nbsp;<span class="string" id="4553511">&#39;0&#39;</span>&nbsp;<span class="op" id="4553515">&lt;=</span>&nbsp;<span class="ident" id="4553518">c</span>&nbsp;<span class="op" id="4553520">&amp;&amp;</span>&nbsp;<span class="ident" id="4553523">c</span>&nbsp;<span class="op" id="4553525">&lt;=</span>&nbsp;<span class="string" id="4553528">&#39;9&#39;</span><span class="op" id="4553531">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553536">n</span>&nbsp;<span class="op" id="4553538">|=</span>&nbsp;<span class="builtintype" id="4553541">rune</span><span class="op" id="4553545">(</span><span class="ident" id="4553546">c</span>&nbsp;<span class="op" id="4553548">-</span>&nbsp;<span class="string" id="4553550">&#39;0&#39;</span><span class="op" id="4553553">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553557">case</span>&nbsp;<span class="string" id="4553562">&#39;a&#39;</span>&nbsp;<span class="op" id="4553566">&lt;=</span>&nbsp;<span class="ident" id="4553569">c</span>&nbsp;<span class="op" id="4553571">&amp;&amp;</span>&nbsp;<span class="ident" id="4553574">c</span>&nbsp;<span class="op" id="4553576">&lt;=</span>&nbsp;<span class="string" id="4553579">&#39;f&#39;</span><span class="op" id="4553582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553587">n</span>&nbsp;<span class="op" id="4553589">|=</span>&nbsp;<span class="builtintype" id="4553592">rune</span><span class="op" id="4553596">(</span><span class="ident" id="4553597">c</span><span class="op" id="4553598">-</span><span class="string" id="4553599">&#39;a&#39;</span><span class="op" id="4553602">)</span>&nbsp;<span class="op" id="4553604">+</span>&nbsp;<span class="num" id="4553606">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553611">case</span>&nbsp;<span class="string" id="4553616">&#39;A&#39;</span>&nbsp;<span class="op" id="4553620">&lt;=</span>&nbsp;<span class="ident" id="4553623">c</span>&nbsp;<span class="op" id="4553625">&amp;&amp;</span>&nbsp;<span class="ident" id="4553628">c</span>&nbsp;<span class="op" id="4553630">&lt;=</span>&nbsp;<span class="string" id="4553633">&#39;F&#39;</span><span class="op" id="4553636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4553641">n</span>&nbsp;<span class="op" id="4553643">|=</span>&nbsp;<span class="builtintype" id="4553646">rune</span><span class="op" id="4553650">(</span><span class="ident" id="4553651">c</span><span class="op" id="4553652">-</span><span class="string" id="4553653">&#39;A&#39;</span><span class="op" id="4553656">)</span>&nbsp;<span class="op" id="4553658">+</span>&nbsp;<span class="num" id="4553660">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553665">default</span><span class="op" id="4553672">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4553677">panic</span><span class="op" id="4553682">(</span><span class="ident" id="4553683">fmt</span><span class="op" id="4553686">.</span><span class="ident" id="4553687">Sprintf</span><span class="op" id="4553694">(</span><span class="string" id="4553695">&#34;Bad&nbsp;hex&nbsp;digit&nbsp;in&nbsp;%q&#34;</span><span class="op" id="4553716">,</span>&nbsp;<span class="ident" id="4553718">s</span><span class="op" id="4553719">)</span><span class="op" id="4553720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553730">return</span>&nbsp;<span class="ident" id="4553737">n</span><br>
<span class="lineno"></span><span class="op" id="4553739">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="4553742">//&nbsp;skipCSSSpace&nbsp;returns&nbsp;a&nbsp;suffix&nbsp;of&nbsp;c,&nbsp;skipping&nbsp;over&nbsp;a&nbsp;single&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="4553811">func</span>&nbsp;<span class="ident" id="4553816">skipCSSSpace</span><span class="op" id="4553828">(</span><span class="ident" id="4553829">c</span>&nbsp;<span class="op" id="4553831">[</span><span class="op" id="4553832">]</span><span class="builtintype" id="4553833">byte</span><span class="op" id="4553837">)</span>&nbsp;<span class="op" id="4553839">[</span><span class="op" id="4553840">]</span><span class="builtintype" id="4553841">byte</span>&nbsp;<span class="op" id="4553846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553849">if</span>&nbsp;<span class="builtinfunc" id="4553852">len</span><span class="op" id="4553855">(</span><span class="ident" id="4553856">c</span><span class="op" id="4553857">)</span>&nbsp;<span class="op" id="4553859">==</span>&nbsp;<span class="num" id="4553862">0</span>&nbsp;<span class="op" id="4553864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553868">return</span>&nbsp;<span class="ident" id="4553875">c</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4553878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553881">//&nbsp;wc&nbsp;::=&nbsp;#x9&nbsp;|&nbsp;#xA&nbsp;|&nbsp;#xC&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#x20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553921">switch</span>&nbsp;<span class="ident" id="4553928">c</span><span class="op" id="4553929">[</span><span class="num" id="4553930">0</span><span class="op" id="4553931">]</span>&nbsp;<span class="op" id="4553933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553936">case</span>&nbsp;<span class="string" id="4553941">&#39;\t&#39;</span><span class="op" id="4553945">,</span>&nbsp;<span class="string" id="4553947">&#39;\n&#39;</span><span class="op" id="4553951">,</span>&nbsp;<span class="string" id="4553953">&#39;\f&#39;</span><span class="op" id="4553957">,</span>&nbsp;<span class="string" id="4553959">&#39;&nbsp;&#39;</span><span class="op" id="4553962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553966">return</span>&nbsp;<span class="ident" id="4553973">c</span><span class="op" id="4553974">[</span><span class="num" id="4553975">1</span><span class="op" id="4553976">:</span><span class="op" id="4553977">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4553980">case</span>&nbsp;<span class="string" id="4553985">&#39;\r&#39;</span><span class="op" id="4553989">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4553993">//&nbsp;This&nbsp;differs&nbsp;from&nbsp;CSS3&#39;s&nbsp;wc&nbsp;production&nbsp;because&nbsp;it&nbsp;contains&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554059">//&nbsp;probable&nbsp;spec&nbsp;error&nbsp;whereby&nbsp;wc&nbsp;contains&nbsp;all&nbsp;the&nbsp;single&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554124">//&nbsp;sequences&nbsp;in&nbsp;nl&nbsp;(newline)&nbsp;but&nbsp;not&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554169">if</span>&nbsp;<span class="builtinfunc" id="4554172">len</span><span class="op" id="4554175">(</span><span class="ident" id="4554176">c</span><span class="op" id="4554177">)</span>&nbsp;<span class="op" id="4554179">&gt;=</span>&nbsp;<span class="num" id="4554182">2</span>&nbsp;<span class="op" id="4554184">&amp;&amp;</span>&nbsp;<span class="ident" id="4554187">c</span><span class="op" id="4554188">[</span><span class="num" id="4554189">1</span><span class="op" id="4554190">]</span>&nbsp;<span class="op" id="4554192">==</span>&nbsp;<span class="string" id="4554195">&#39;\n&#39;</span>&nbsp;<span class="op" id="4554200">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554205">return</span>&nbsp;<span class="ident" id="4554212">c</span><span class="op" id="4554213">[</span><span class="num" id="4554214">2</span><span class="op" id="4554215">:</span><span class="op" id="4554216">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554224">return</span>&nbsp;<span class="ident" id="4554231">c</span><span class="op" id="4554232">[</span><span class="num" id="4554233">1</span><span class="op" id="4554234">:</span><span class="op" id="4554235">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554241">return</span>&nbsp;<span class="ident" id="4554248">c</span><br>
<span class="lineno">145</span><span class="op" id="4554250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4554253">//&nbsp;isCSSSpace&nbsp;reports&nbsp;whether&nbsp;b&nbsp;is&nbsp;a&nbsp;CSS&nbsp;space&nbsp;char&nbsp;as&nbsp;defined&nbsp;in&nbsp;wc.</span><br>
<span class="lineno"></span><span class="keyword" id="4554323">func</span>&nbsp;<span class="ident" id="4554328">isCSSSpace</span><span class="op" id="4554338">(</span><span class="ident" id="4554339">b</span>&nbsp;<span class="builtintype" id="4554341">byte</span><span class="op" id="4554345">)</span>&nbsp;<span class="builtintype" id="4554347">bool</span>&nbsp;<span class="op" id="4554352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554355">switch</span>&nbsp;<span class="ident" id="4554362">b</span>&nbsp;<span class="op" id="4554364">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554367">case</span>&nbsp;<span class="string" id="4554372">&#39;\t&#39;</span><span class="op" id="4554376">,</span>&nbsp;<span class="string" id="4554378">&#39;\n&#39;</span><span class="op" id="4554382">,</span>&nbsp;<span class="string" id="4554384">&#39;\f&#39;</span><span class="op" id="4554388">,</span>&nbsp;<span class="string" id="4554390">&#39;\r&#39;</span><span class="op" id="4554394">,</span>&nbsp;<span class="string" id="4554396">&#39;&nbsp;&#39;</span><span class="op" id="4554399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554403">return</span>&nbsp;<span class="builtintype" id="4554410">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4554416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554419">return</span>&nbsp;<span class="builtintype" id="4554426">false</span><br>
<span class="lineno"></span><span class="op" id="4554432">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4554435">//&nbsp;cssEscaper&nbsp;escapes&nbsp;HTML&nbsp;and&nbsp;CSS&nbsp;special&nbsp;characters&nbsp;using&nbsp;\&lt;hex&gt;+&nbsp;escapes.</span><br>
<span class="lineno"></span><span class="keyword" id="4554512">func</span>&nbsp;<span class="ident" id="4554517">cssEscaper</span><span class="op" id="4554527">(</span><span class="ident" id="4554528">args</span>&nbsp;<span class="op" id="4554533">...</span><span class="keyword" id="4554536">interface</span><span class="op" id="4554545">{</span><span class="op" id="4554546">}</span><span class="op" id="4554547">)</span>&nbsp;<span class="builtintype" id="4554549">string</span>&nbsp;<span class="op" id="4554556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554559">s</span><span class="op" id="4554560">,</span>&nbsp;<span class="ident" id="4554562">_</span>&nbsp;<span class="op" id="4554564">:=</span>&nbsp;<span class="ident" id="4554567">stringify</span><span class="op" id="4554576">(</span><span class="ident" id="4554577">args</span><span class="op" id="4554581">...</span><span class="op" id="4554584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554587">var</span>&nbsp;<span class="ident" id="4554591">b</span>&nbsp;<span class="ident" id="4554593">bytes</span><span class="op" id="4554598">.</span><span class="ident" id="4554599">Buffer</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554607">written</span>&nbsp;<span class="op" id="4554615">:=</span>&nbsp;<span class="num" id="4554618">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554621">for</span>&nbsp;<span class="ident" id="4554625">i</span><span class="op" id="4554626">,</span>&nbsp;<span class="ident" id="4554628">r</span>&nbsp;<span class="op" id="4554630">:=</span>&nbsp;<span class="keyword" id="4554633">range</span>&nbsp;<span class="ident" id="4554639">s</span>&nbsp;<span class="op" id="4554641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554645">var</span>&nbsp;<span class="ident" id="4554649">repl</span>&nbsp;<span class="builtintype" id="4554654">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554663">switch</span>&nbsp;<span class="ident" id="4554670">r</span>&nbsp;<span class="op" id="4554672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554676">case</span>&nbsp;<span class="num" id="4554681">0</span><span class="op" id="4554682">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554687">repl</span>&nbsp;<span class="op" id="4554692">=</span>&nbsp;<span class="string" id="4554694">`\0`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554701">case</span>&nbsp;<span class="string" id="4554706">&#39;\t&#39;</span><span class="op" id="4554710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554715">repl</span>&nbsp;<span class="op" id="4554720">=</span>&nbsp;<span class="string" id="4554722">`\9`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554729">case</span>&nbsp;<span class="string" id="4554734">&#39;\n&#39;</span><span class="op" id="4554738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554743">repl</span>&nbsp;<span class="op" id="4554748">=</span>&nbsp;<span class="string" id="4554750">`\a`</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554757">case</span>&nbsp;<span class="string" id="4554762">&#39;\f&#39;</span><span class="op" id="4554766">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554771">repl</span>&nbsp;<span class="op" id="4554776">=</span>&nbsp;<span class="string" id="4554778">`\c`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554785">case</span>&nbsp;<span class="string" id="4554790">&#39;\r&#39;</span><span class="op" id="4554794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554799">repl</span>&nbsp;<span class="op" id="4554804">=</span>&nbsp;<span class="string" id="4554806">`\d`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554813">//&nbsp;Encode&nbsp;HTML&nbsp;specials&nbsp;as&nbsp;hex&nbsp;so&nbsp;the&nbsp;output&nbsp;can&nbsp;be&nbsp;embedded</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4554876">//&nbsp;in&nbsp;HTML&nbsp;attributes&nbsp;without&nbsp;further&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554926">case</span>&nbsp;<span class="string" id="4554931">&#39;&#34;&#39;</span><span class="op" id="4554934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554939">repl</span>&nbsp;<span class="op" id="4554944">=</span>&nbsp;<span class="string" id="4554946">`\22`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554954">case</span>&nbsp;<span class="string" id="4554959">&#39;&amp;&#39;</span><span class="op" id="4554962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554967">repl</span>&nbsp;<span class="op" id="4554972">=</span>&nbsp;<span class="string" id="4554974">`\26`</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4554982">case</span>&nbsp;<span class="string" id="4554987">&#39;\&#39;&#39;</span><span class="op" id="4554991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4554996">repl</span>&nbsp;<span class="op" id="4555001">=</span>&nbsp;<span class="string" id="4555003">`\27`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555011">case</span>&nbsp;<span class="string" id="4555016">&#39;(&#39;</span><span class="op" id="4555019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555024">repl</span>&nbsp;<span class="op" id="4555029">=</span>&nbsp;<span class="string" id="4555031">`\28`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555039">case</span>&nbsp;<span class="string" id="4555044">&#39;)&#39;</span><span class="op" id="4555047">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555052">repl</span>&nbsp;<span class="op" id="4555057">=</span>&nbsp;<span class="string" id="4555059">`\29`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555067">case</span>&nbsp;<span class="string" id="4555072">&#39;+&#39;</span><span class="op" id="4555075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555080">repl</span>&nbsp;<span class="op" id="4555085">=</span>&nbsp;<span class="string" id="4555087">`\2b`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555095">case</span>&nbsp;<span class="string" id="4555100">&#39;/&#39;</span><span class="op" id="4555103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555108">repl</span>&nbsp;<span class="op" id="4555113">=</span>&nbsp;<span class="string" id="4555115">`\2f`</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555123">case</span>&nbsp;<span class="string" id="4555128">&#39;:&#39;</span><span class="op" id="4555131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555136">repl</span>&nbsp;<span class="op" id="4555141">=</span>&nbsp;<span class="string" id="4555143">`\3a`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555151">case</span>&nbsp;<span class="string" id="4555156">&#39;;&#39;</span><span class="op" id="4555159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555164">repl</span>&nbsp;<span class="op" id="4555169">=</span>&nbsp;<span class="string" id="4555171">`\3b`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555179">case</span>&nbsp;<span class="string" id="4555184">&#39;&lt;&#39;</span><span class="op" id="4555187">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555192">repl</span>&nbsp;<span class="op" id="4555197">=</span>&nbsp;<span class="string" id="4555199">`\3c`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555207">case</span>&nbsp;<span class="string" id="4555212">&#39;&gt;&#39;</span><span class="op" id="4555215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555220">repl</span>&nbsp;<span class="op" id="4555225">=</span>&nbsp;<span class="string" id="4555227">`\3e`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555235">case</span>&nbsp;<span class="string" id="4555240">&#39;\\&#39;</span><span class="op" id="4555244">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555249">repl</span>&nbsp;<span class="op" id="4555254">=</span>&nbsp;<span class="string" id="4555256">`\\`</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555263">case</span>&nbsp;<span class="string" id="4555268">&#39;{&#39;</span><span class="op" id="4555271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555276">repl</span>&nbsp;<span class="op" id="4555281">=</span>&nbsp;<span class="string" id="4555283">`\7b`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555291">case</span>&nbsp;<span class="string" id="4555296">&#39;}&#39;</span><span class="op" id="4555299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555304">repl</span>&nbsp;<span class="op" id="4555309">=</span>&nbsp;<span class="string" id="4555311">`\7d`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555319">default</span><span class="op" id="4555326">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555331">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555346">b</span><span class="op" id="4555347">.</span><span class="ident" id="4555348">WriteString</span><span class="op" id="4555359">(</span><span class="ident" id="4555360">s</span><span class="op" id="4555361">[</span><span class="ident" id="4555362">written</span><span class="op" id="4555369">:</span><span class="ident" id="4555370">i</span><span class="op" id="4555371">]</span><span class="op" id="4555372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555376">b</span><span class="op" id="4555377">.</span><span class="ident" id="4555378">WriteString</span><span class="op" id="4555389">(</span><span class="ident" id="4555390">repl</span><span class="op" id="4555394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555398">written</span>&nbsp;<span class="op" id="4555406">=</span>&nbsp;<span class="ident" id="4555408">i</span>&nbsp;<span class="op" id="4555410">+</span>&nbsp;<span class="ident" id="4555412">utf8</span><span class="op" id="4555416">.</span><span class="ident" id="4555417">RuneLen</span><span class="op" id="4555424">(</span><span class="ident" id="4555425">r</span><span class="op" id="4555426">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555430">if</span>&nbsp;<span class="ident" id="4555433">repl</span>&nbsp;<span class="op" id="4555438">!=</span>&nbsp;<span class="string" id="4555441">`\\`</span>&nbsp;<span class="op" id="4555446">&amp;&amp;</span>&nbsp;<span class="op" id="4555449">(</span><span class="ident" id="4555450">written</span>&nbsp;<span class="op" id="4555458">==</span>&nbsp;<span class="builtinfunc" id="4555461">len</span><span class="op" id="4555464">(</span><span class="ident" id="4555465">s</span><span class="op" id="4555466">)</span>&nbsp;<span class="op" id="4555468">||</span>&nbsp;<span class="ident" id="4555471">isHex</span><span class="op" id="4555476">(</span><span class="ident" id="4555477">s</span><span class="op" id="4555478">[</span><span class="ident" id="4555479">written</span><span class="op" id="4555486">]</span><span class="op" id="4555487">)</span>&nbsp;<span class="op" id="4555489">||</span>&nbsp;<span class="ident" id="4555492">isCSSSpace</span><span class="op" id="4555502">(</span><span class="ident" id="4555503">s</span><span class="op" id="4555504">[</span><span class="ident" id="4555505">written</span><span class="op" id="4555512">]</span><span class="op" id="4555513">)</span><span class="op" id="4555514">)</span>&nbsp;<span class="op" id="4555516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555521">b</span><span class="op" id="4555522">.</span><span class="ident" id="4555523">WriteByte</span><span class="op" id="4555532">(</span><span class="string" id="4555533">&#39;&nbsp;&#39;</span><span class="op" id="4555536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555546">if</span>&nbsp;<span class="ident" id="4555549">written</span>&nbsp;<span class="op" id="4555557">==</span>&nbsp;<span class="num" id="4555560">0</span>&nbsp;<span class="op" id="4555562">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555566">return</span>&nbsp;<span class="ident" id="4555573">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4555576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4555579">b</span><span class="op" id="4555580">.</span><span class="ident" id="4555581">WriteString</span><span class="op" id="4555592">(</span><span class="ident" id="4555593">s</span><span class="op" id="4555594">[</span><span class="ident" id="4555595">written</span><span class="op" id="4555602">:</span><span class="op" id="4555603">]</span><span class="op" id="4555604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4555607">return</span>&nbsp;<span class="ident" id="4555614">b</span><span class="op" id="4555615">.</span><span class="ident" id="4555616">String</span><span class="op" id="4555622">(</span><span class="op" id="4555623">)</span><br>
<span class="lineno"></span><span class="op" id="4555625">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="4555628">var</span>&nbsp;<span class="ident" id="4555632">expressionBytes</span>&nbsp;<span class="op" id="4555648">=</span>&nbsp;<span class="op" id="4555650">[</span><span class="op" id="4555651">]</span><span class="builtintype" id="4555652">byte</span><span class="op" id="4555656">(</span><span class="string" id="4555657">&#34;expression&#34;</span><span class="op" id="4555669">)</span><br>
<span class="lineno"></span><span class="keyword" id="4555671">var</span>&nbsp;<span class="ident" id="4555675">mozBindingBytes</span>&nbsp;<span class="op" id="4555691">=</span>&nbsp;<span class="op" id="4555693">[</span><span class="op" id="4555694">]</span><span class="builtintype" id="4555695">byte</span><span class="op" id="4555699">(</span><span class="string" id="4555700">&#34;mozbinding&#34;</span><span class="op" id="4555712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4555715">//&nbsp;cssValueFilter&nbsp;allows&nbsp;innocuous&nbsp;CSS&nbsp;values&nbsp;in&nbsp;the&nbsp;output&nbsp;including&nbsp;CSS</span><br>
<span class="lineno">225</span><span class="comment" id="4555789">//&nbsp;quantities&nbsp;(10px&nbsp;or&nbsp;25%),&nbsp;ID&nbsp;or&nbsp;class&nbsp;literals&nbsp;(#foo,&nbsp;.bar),&nbsp;keyword&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4555868">//&nbsp;(inherit,&nbsp;blue),&nbsp;and&nbsp;colors&nbsp;(#888).</span><br>
<span class="lineno"></span><span class="comment" id="4555907">//&nbsp;It&nbsp;filters&nbsp;out&nbsp;unsafe&nbsp;values,&nbsp;such&nbsp;as&nbsp;those&nbsp;that&nbsp;affect&nbsp;token&nbsp;boundaries,</span><br>
<span class="lineno"></span><span class="comment" id="4555984">//&nbsp;and&nbsp;anything&nbsp;that&nbsp;might&nbsp;execute&nbsp;scripts.</span><br>
<span class="lineno"></span><span class="keyword" id="4556028">func</span>&nbsp;<span class="ident" id="4556033">cssValueFilter</span><span class="op" id="4556047">(</span><span class="ident" id="4556048">args</span>&nbsp;<span class="op" id="4556053">...</span><span class="keyword" id="4556056">interface</span><span class="op" id="4556065">{</span><span class="op" id="4556066">}</span><span class="op" id="4556067">)</span>&nbsp;<span class="builtintype" id="4556069">string</span>&nbsp;<span class="op" id="4556076">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556079">s</span><span class="op" id="4556080">,</span>&nbsp;<span class="ident" id="4556082">t</span>&nbsp;<span class="op" id="4556084">:=</span>&nbsp;<span class="ident" id="4556087">stringify</span><span class="op" id="4556096">(</span><span class="ident" id="4556097">args</span><span class="op" id="4556101">...</span><span class="op" id="4556104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556107">if</span>&nbsp;<span class="ident" id="4556110">t</span>&nbsp;<span class="op" id="4556112">==</span>&nbsp;<span class="ident" id="4556115">contentTypeCSS</span>&nbsp;<span class="op" id="4556130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556134">return</span>&nbsp;<span class="ident" id="4556141">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4556144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4556147">b</span><span class="op" id="4556148">,</span>&nbsp;<span class="ident" id="4556150">id</span>&nbsp;<span class="op" id="4556153">:=</span>&nbsp;<span class="ident" id="4556156">decodeCSS</span><span class="op" id="4556165">(</span><span class="op" id="4556166">[</span><span class="op" id="4556167">]</span><span class="builtintype" id="4556168">byte</span><span class="op" id="4556172">(</span><span class="ident" id="4556173">s</span><span class="op" id="4556174">)</span><span class="op" id="4556175">)</span><span class="op" id="4556176">,</span>&nbsp;<span class="builtinfunc" id="4556178">make</span><span class="op" id="4556182">(</span><span class="op" id="4556183">[</span><span class="op" id="4556184">]</span><span class="builtintype" id="4556185">byte</span><span class="op" id="4556189">,</span>&nbsp;<span class="num" id="4556191">0</span><span class="op" id="4556192">,</span>&nbsp;<span class="num" id="4556194">64</span><span class="op" id="4556196">)</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556200">//&nbsp;CSS3&nbsp;error&nbsp;handling&nbsp;is&nbsp;specified&nbsp;as&nbsp;honoring&nbsp;string&nbsp;boundaries&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556271">//&nbsp;http://www.w3.org/TR/css3-syntax/#error-handling&nbsp;:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556326">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Malformed&nbsp;declarations.&nbsp;User&nbsp;agents&nbsp;must&nbsp;handle&nbsp;unexpected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556393">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;tokens&nbsp;encountered&nbsp;while&nbsp;parsing&nbsp;a&nbsp;declaration&nbsp;by&nbsp;reading&nbsp;until</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556465">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;declaration,&nbsp;while&nbsp;observing&nbsp;the&nbsp;rules&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556531">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;matching&nbsp;pairs&nbsp;of&nbsp;(),&nbsp;[],&nbsp;{},&nbsp;&#34;&#34;,&nbsp;and&nbsp;&#39;&#39;,&nbsp;and&nbsp;correctly&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556604">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;a&nbsp;malformed&nbsp;declaration&nbsp;may&nbsp;be&nbsp;missing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556675">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property,&nbsp;colon&nbsp;(:)&nbsp;or&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556713">//&nbsp;So&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;values&nbsp;do&nbsp;not&nbsp;have&nbsp;mismatched&nbsp;bracket</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556784">//&nbsp;or&nbsp;quote&nbsp;characters&nbsp;to&nbsp;prevent&nbsp;the&nbsp;browser&nbsp;from&nbsp;restarting&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4556855">//&nbsp;inside&nbsp;a&nbsp;string&nbsp;that&nbsp;might&nbsp;embed&nbsp;JavaScript&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556911">for</span>&nbsp;<span class="ident" id="4556915">i</span><span class="op" id="4556916">,</span>&nbsp;<span class="ident" id="4556918">c</span>&nbsp;<span class="op" id="4556920">:=</span>&nbsp;<span class="keyword" id="4556923">range</span>&nbsp;<span class="ident" id="4556929">b</span>&nbsp;<span class="op" id="4556931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556935">switch</span>&nbsp;<span class="ident" id="4556942">c</span>&nbsp;<span class="op" id="4556944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556948">case</span>&nbsp;<span class="num" id="4556953">0</span><span class="op" id="4556954">,</span>&nbsp;<span class="string" id="4556956">&#39;&#34;&#39;</span><span class="op" id="4556959">,</span>&nbsp;<span class="string" id="4556961">&#39;\&#39;&#39;</span><span class="op" id="4556965">,</span>&nbsp;<span class="string" id="4556967">&#39;(&#39;</span><span class="op" id="4556970">,</span>&nbsp;<span class="string" id="4556972">&#39;)&#39;</span><span class="op" id="4556975">,</span>&nbsp;<span class="string" id="4556977">&#39;/&#39;</span><span class="op" id="4556980">,</span>&nbsp;<span class="string" id="4556982">&#39;;&#39;</span><span class="op" id="4556985">,</span>&nbsp;<span class="string" id="4556987">&#39;@&#39;</span><span class="op" id="4556990">,</span>&nbsp;<span class="string" id="4556992">&#39;[&#39;</span><span class="op" id="4556995">,</span>&nbsp;<span class="string" id="4556997">&#39;\\&#39;</span><span class="op" id="4557001">,</span>&nbsp;<span class="string" id="4557003">&#39;]&#39;</span><span class="op" id="4557006">,</span>&nbsp;<span class="string" id="4557008">&#39;`&#39;</span><span class="op" id="4557011">,</span>&nbsp;<span class="string" id="4557013">&#39;{&#39;</span><span class="op" id="4557016">,</span>&nbsp;<span class="string" id="4557018">&#39;}&#39;</span><span class="op" id="4557021">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557026">return</span>&nbsp;<span class="ident" id="4557033">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557050">case</span>&nbsp;<span class="string" id="4557055">&#39;-&#39;</span><span class="op" id="4557058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4557063">//&nbsp;Disallow&nbsp;&lt;!--&nbsp;or&nbsp;--&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4557091">//&nbsp;--&nbsp;should&nbsp;not&nbsp;appear&nbsp;in&nbsp;valid&nbsp;identifiers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557140">if</span>&nbsp;<span class="ident" id="4557143">i</span>&nbsp;<span class="op" id="4557145">!=</span>&nbsp;<span class="num" id="4557148">0</span>&nbsp;<span class="op" id="4557150">&amp;&amp;</span>&nbsp;<span class="ident" id="4557153">b</span><span class="op" id="4557154">[</span><span class="ident" id="4557155">i</span><span class="op" id="4557156">-</span><span class="num" id="4557157">1</span><span class="op" id="4557158">]</span>&nbsp;<span class="op" id="4557160">==</span>&nbsp;<span class="string" id="4557163">&#39;-&#39;</span>&nbsp;<span class="op" id="4557167">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557173">return</span>&nbsp;<span class="ident" id="4557180">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557202">default</span><span class="op" id="4557209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557214">if</span>&nbsp;<span class="ident" id="4557217">c</span>&nbsp;<span class="op" id="4557219">&lt;</span>&nbsp;<span class="num" id="4557221">0x80</span>&nbsp;<span class="op" id="4557226">&amp;&amp;</span>&nbsp;<span class="ident" id="4557229">isCSSNmchar</span><span class="op" id="4557240">(</span><span class="builtintype" id="4557241">rune</span><span class="op" id="4557245">(</span><span class="ident" id="4557246">c</span><span class="op" id="4557247">)</span><span class="op" id="4557248">)</span>&nbsp;<span class="op" id="4557250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557256">id</span>&nbsp;<span class="op" id="4557259">=</span>&nbsp;<span class="builtinfunc" id="4557261">append</span><span class="op" id="4557267">(</span><span class="ident" id="4557268">id</span><span class="op" id="4557270">,</span>&nbsp;<span class="ident" id="4557272">c</span><span class="op" id="4557273">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557288">id</span>&nbsp;<span class="op" id="4557291">=</span>&nbsp;<span class="ident" id="4557293">bytes</span><span class="op" id="4557298">.</span><span class="ident" id="4557299">ToLower</span><span class="op" id="4557306">(</span><span class="ident" id="4557307">id</span><span class="op" id="4557309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557312">if</span>&nbsp;<span class="ident" id="4557315">bytes</span><span class="op" id="4557320">.</span><span class="ident" id="4557321">Index</span><span class="op" id="4557326">(</span><span class="ident" id="4557327">id</span><span class="op" id="4557329">,</span>&nbsp;<span class="ident" id="4557331">expressionBytes</span><span class="op" id="4557346">)</span>&nbsp;<span class="op" id="4557348">!=</span>&nbsp;<span class="op" id="4557351">-</span><span class="num" id="4557352">1</span>&nbsp;<span class="op" id="4557354">||</span>&nbsp;<span class="ident" id="4557357">bytes</span><span class="op" id="4557362">.</span><span class="ident" id="4557363">Index</span><span class="op" id="4557368">(</span><span class="ident" id="4557369">id</span><span class="op" id="4557371">,</span>&nbsp;<span class="ident" id="4557373">mozBindingBytes</span><span class="op" id="4557388">)</span>&nbsp;<span class="op" id="4557390">!=</span>&nbsp;<span class="op" id="4557393">-</span><span class="num" id="4557394">1</span>&nbsp;<span class="op" id="4557396">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557400">return</span>&nbsp;<span class="ident" id="4557407">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557426">return</span>&nbsp;<span class="builtintype" id="4557433">string</span><span class="op" id="4557439">(</span><span class="ident" id="4557440">b</span><span class="op" id="4557441">)</span><br>
<span class="lineno"></span><span class="op" id="4557443">}</span>
</div>
</body>
</html>
