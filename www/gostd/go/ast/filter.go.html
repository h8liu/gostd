<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3599990">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3600045">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3600099">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3600150">package</span>&nbsp;<span class="ident" id="3600158">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3600163">import</span>&nbsp;<span class="op" id="3600170">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3600173">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3600185">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3600192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3600195">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3600275">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3600296">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="3600368">func</span>&nbsp;<span class="ident" id="3600373">exportFilter</span><span class="op" id="3600385">(</span><span class="ident" id="3600386">name</span>&nbsp;<span class="builtintype" id="3600391">string</span><span class="op" id="3600397">)</span>&nbsp;<span class="builtintype" id="3600399">bool</span>&nbsp;<span class="op" id="3600404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3600407">return</span>&nbsp;<span class="ident" id="3600414">IsExported</span><span class="op" id="3600424">(</span><span class="ident" id="3600425">name</span><span class="op" id="3600429">)</span><br>
<span class="lineno"></span><span class="op" id="3600431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3600434">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3600503">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="3600583">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="3600661">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3600737">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="3600789">//</span><br>
<span class="lineno"></span><span class="comment" id="3600792">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="3600856">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3600887">//</span><br>
<span class="lineno"></span><span class="keyword" id="3600890">func</span>&nbsp;<span class="ident" id="3600895">FileExports</span><span class="op" id="3600906">(</span><span class="ident" id="3600907">src</span>&nbsp;<span class="op" id="3600911">*</span><span class="ident" id="3600912">File</span><span class="op" id="3600916">)</span>&nbsp;<span class="builtintype" id="3600918">bool</span>&nbsp;<span class="op" id="3600923">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3600926">return</span>&nbsp;<span class="ident" id="3600933">filterFile</span><span class="op" id="3600943">(</span><span class="ident" id="3600944">src</span><span class="op" id="3600947">,</span>&nbsp;<span class="ident" id="3600949">exportFilter</span><span class="op" id="3600961">,</span>&nbsp;<span class="builtintype" id="3600963">true</span><span class="op" id="3600967">)</span><br>
<span class="lineno"></span><span class="op" id="3600969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3600972">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3601040">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="3601114">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="3601175">//</span><br>
<span class="lineno"></span><span class="comment" id="3601178">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="3601245">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3601276">//</span><br>
<span class="lineno">40</span><span class="keyword" id="3601279">func</span>&nbsp;<span class="ident" id="3601284">PackageExports</span><span class="op" id="3601298">(</span><span class="ident" id="3601299">pkg</span>&nbsp;<span class="op" id="3601303">*</span><span class="ident" id="3601304">Package</span><span class="op" id="3601311">)</span>&nbsp;<span class="builtintype" id="3601313">bool</span>&nbsp;<span class="op" id="3601318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601321">return</span>&nbsp;<span class="ident" id="3601328">filterPackage</span><span class="op" id="3601341">(</span><span class="ident" id="3601342">pkg</span><span class="op" id="3601345">,</span>&nbsp;<span class="ident" id="3601347">exportFilter</span><span class="op" id="3601359">,</span>&nbsp;<span class="builtintype" id="3601361">true</span><span class="op" id="3601365">)</span><br>
<span class="lineno"></span><span class="op" id="3601367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3601370">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="3601450">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3601472">type</span>&nbsp;<span class="ident" id="3601477">Filter</span>&nbsp;<span class="keyword" id="3601484">func</span><span class="op" id="3601488">(</span><span class="builtintype" id="3601489">string</span><span class="op" id="3601495">)</span>&nbsp;<span class="builtintype" id="3601497">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3601503">func</span>&nbsp;<span class="ident" id="3601508">filterIdentList</span><span class="op" id="3601523">(</span><span class="ident" id="3601524">list</span>&nbsp;<span class="op" id="3601529">[</span><span class="op" id="3601530">]</span><span class="op" id="3601531">*</span><span class="ident" id="3601532">Ident</span><span class="op" id="3601537">,</span>&nbsp;<span class="ident" id="3601539">f</span>&nbsp;<span class="ident" id="3601541">Filter</span><span class="op" id="3601547">)</span>&nbsp;<span class="op" id="3601549">[</span><span class="op" id="3601550">]</span><span class="op" id="3601551">*</span><span class="ident" id="3601552">Ident</span>&nbsp;<span class="op" id="3601558">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3601561">j</span>&nbsp;<span class="op" id="3601563">:=</span>&nbsp;<span class="num" id="3601566">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601569">for</span>&nbsp;<span class="ident" id="3601573">_</span><span class="op" id="3601574">,</span>&nbsp;<span class="ident" id="3601576">x</span>&nbsp;<span class="op" id="3601578">:=</span>&nbsp;<span class="keyword" id="3601581">range</span>&nbsp;<span class="ident" id="3601587">list</span>&nbsp;<span class="op" id="3601592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601596">if</span>&nbsp;<span class="ident" id="3601599">f</span><span class="op" id="3601600">(</span><span class="ident" id="3601601">x</span><span class="op" id="3601602">.</span><span class="ident" id="3601603">Name</span><span class="op" id="3601607">)</span>&nbsp;<span class="op" id="3601609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3601614">list</span><span class="op" id="3601618">[</span><span class="ident" id="3601619">j</span><span class="op" id="3601620">]</span>&nbsp;<span class="op" id="3601622">=</span>&nbsp;<span class="ident" id="3601624">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3601629">j</span><span class="op" id="3601630">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3601635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3601638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601641">return</span>&nbsp;<span class="ident" id="3601648">list</span><span class="op" id="3601652">[</span><span class="num" id="3601653">0</span><span class="op" id="3601654">:</span><span class="ident" id="3601655">j</span><span class="op" id="3601656">]</span><br>
<span class="lineno"></span><span class="op" id="3601658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3601661">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3601727">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="3601794">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="3601833">//</span><br>
<span class="lineno"></span><span class="keyword" id="3601836">func</span>&nbsp;<span class="ident" id="3601841">fieldName</span><span class="op" id="3601850">(</span><span class="ident" id="3601851">x</span>&nbsp;<span class="ident" id="3601853">Expr</span><span class="op" id="3601857">)</span>&nbsp;<span class="op" id="3601859">*</span><span class="ident" id="3601860">Ident</span>&nbsp;<span class="op" id="3601866">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601869">switch</span>&nbsp;<span class="ident" id="3601876">t</span>&nbsp;<span class="op" id="3601878">:=</span>&nbsp;<span class="ident" id="3601881">x</span><span class="op" id="3601882">.</span><span class="op" id="3601883">(</span><span class="keyword" id="3601884">type</span><span class="op" id="3601888">)</span>&nbsp;<span class="op" id="3601890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601893">case</span>&nbsp;<span class="op" id="3601898">*</span><span class="ident" id="3601899">Ident</span><span class="op" id="3601904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601908">return</span>&nbsp;<span class="ident" id="3601915">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601918">case</span>&nbsp;<span class="op" id="3601923">*</span><span class="ident" id="3601924">SelectorExpr</span><span class="op" id="3601936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601940">if</span>&nbsp;<span class="ident" id="3601943">_</span><span class="op" id="3601944">,</span>&nbsp;<span class="ident" id="3601946">ok</span>&nbsp;<span class="op" id="3601949">:=</span>&nbsp;<span class="ident" id="3601952">t</span><span class="op" id="3601953">.</span><span class="ident" id="3601954">X</span><span class="op" id="3601955">.</span><span class="op" id="3601956">(</span><span class="op" id="3601957">*</span><span class="ident" id="3601958">Ident</span><span class="op" id="3601963">)</span><span class="op" id="3601964">;</span>&nbsp;<span class="ident" id="3601966">ok</span>&nbsp;<span class="op" id="3601969">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601974">return</span>&nbsp;<span class="ident" id="3601981">t</span><span class="op" id="3601982">.</span><span class="ident" id="3601983">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3601989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3601992">case</span>&nbsp;<span class="op" id="3601997">*</span><span class="ident" id="3601998">StarExpr</span><span class="op" id="3602006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602010">return</span>&nbsp;<span class="ident" id="3602017">fieldName</span><span class="op" id="3602026">(</span><span class="ident" id="3602027">t</span><span class="op" id="3602028">.</span><span class="ident" id="3602029">X</span><span class="op" id="3602030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602033">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602036">return</span>&nbsp;<span class="ident" id="3602043">nil</span><br>
<span class="lineno"></span><span class="op" id="3602047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3602050">func</span>&nbsp;<span class="ident" id="3602055">filterFieldList</span><span class="op" id="3602070">(</span><span class="ident" id="3602071">fields</span>&nbsp;<span class="op" id="3602078">*</span><span class="ident" id="3602079">FieldList</span><span class="op" id="3602088">,</span>&nbsp;<span class="ident" id="3602090">filter</span>&nbsp;<span class="ident" id="3602097">Filter</span><span class="op" id="3602103">,</span>&nbsp;<span class="ident" id="3602105">export</span>&nbsp;<span class="builtintype" id="3602112">bool</span><span class="op" id="3602116">)</span>&nbsp;<span class="op" id="3602118">(</span><span class="ident" id="3602119">removedFields</span>&nbsp;<span class="builtintype" id="3602133">bool</span><span class="op" id="3602137">)</span>&nbsp;<span class="op" id="3602139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602142">if</span>&nbsp;<span class="ident" id="3602145">fields</span>&nbsp;<span class="op" id="3602152">==</span>&nbsp;<span class="ident" id="3602155">nil</span>&nbsp;<span class="op" id="3602159">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602163">return</span>&nbsp;<span class="builtintype" id="3602170">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602180">list</span>&nbsp;<span class="op" id="3602185">:=</span>&nbsp;<span class="ident" id="3602188">fields</span><span class="op" id="3602194">.</span><span class="ident" id="3602195">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602201">j</span>&nbsp;<span class="op" id="3602203">:=</span>&nbsp;<span class="num" id="3602206">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602209">for</span>&nbsp;<span class="ident" id="3602213">_</span><span class="op" id="3602214">,</span>&nbsp;<span class="ident" id="3602216">f</span>&nbsp;<span class="op" id="3602218">:=</span>&nbsp;<span class="keyword" id="3602221">range</span>&nbsp;<span class="ident" id="3602227">list</span>&nbsp;<span class="op" id="3602232">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602236">keepField</span>&nbsp;<span class="op" id="3602246">:=</span>&nbsp;<span class="builtintype" id="3602249">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602257">if</span>&nbsp;<span class="builtinfunc" id="3602260">len</span><span class="op" id="3602263">(</span><span class="ident" id="3602264">f</span><span class="op" id="3602265">.</span><span class="ident" id="3602266">Names</span><span class="op" id="3602271">)</span>&nbsp;<span class="op" id="3602273">==</span>&nbsp;<span class="num" id="3602276">0</span>&nbsp;<span class="op" id="3602278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3602283">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602305">name</span>&nbsp;<span class="op" id="3602310">:=</span>&nbsp;<span class="ident" id="3602313">fieldName</span><span class="op" id="3602322">(</span><span class="ident" id="3602323">f</span><span class="op" id="3602324">.</span><span class="ident" id="3602325">Type</span><span class="op" id="3602329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602334">keepField</span>&nbsp;<span class="op" id="3602344">=</span>&nbsp;<span class="ident" id="3602346">name</span>&nbsp;<span class="op" id="3602351">!=</span>&nbsp;<span class="ident" id="3602354">nil</span>&nbsp;<span class="op" id="3602358">&amp;&amp;</span>&nbsp;<span class="ident" id="3602361">filter</span><span class="op" id="3602367">(</span><span class="ident" id="3602368">name</span><span class="op" id="3602372">.</span><span class="ident" id="3602373">Name</span><span class="op" id="3602377">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602381">}</span>&nbsp;<span class="keyword" id="3602383">else</span>&nbsp;<span class="op" id="3602388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602393">n</span>&nbsp;<span class="op" id="3602395">:=</span>&nbsp;<span class="builtinfunc" id="3602398">len</span><span class="op" id="3602401">(</span><span class="ident" id="3602402">f</span><span class="op" id="3602403">.</span><span class="ident" id="3602404">Names</span><span class="op" id="3602409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602414">f</span><span class="op" id="3602415">.</span><span class="ident" id="3602416">Names</span>&nbsp;<span class="op" id="3602422">=</span>&nbsp;<span class="ident" id="3602424">filterIdentList</span><span class="op" id="3602439">(</span><span class="ident" id="3602440">f</span><span class="op" id="3602441">.</span><span class="ident" id="3602442">Names</span><span class="op" id="3602447">,</span>&nbsp;<span class="ident" id="3602449">filter</span><span class="op" id="3602455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602460">if</span>&nbsp;<span class="builtinfunc" id="3602463">len</span><span class="op" id="3602466">(</span><span class="ident" id="3602467">f</span><span class="op" id="3602468">.</span><span class="ident" id="3602469">Names</span><span class="op" id="3602474">)</span>&nbsp;<span class="op" id="3602476">&lt;</span>&nbsp;<span class="ident" id="3602478">n</span>&nbsp;<span class="op" id="3602480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602486">removedFields</span>&nbsp;<span class="op" id="3602500">=</span>&nbsp;<span class="builtintype" id="3602502">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602515">keepField</span>&nbsp;<span class="op" id="3602525">=</span>&nbsp;<span class="builtinfunc" id="3602527">len</span><span class="op" id="3602530">(</span><span class="ident" id="3602531">f</span><span class="op" id="3602532">.</span><span class="ident" id="3602533">Names</span><span class="op" id="3602538">)</span>&nbsp;<span class="op" id="3602540">&gt;</span>&nbsp;<span class="num" id="3602542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602550">if</span>&nbsp;<span class="ident" id="3602553">keepField</span>&nbsp;<span class="op" id="3602563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602568">if</span>&nbsp;<span class="ident" id="3602571">export</span>&nbsp;<span class="op" id="3602578">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602584">filterType</span><span class="op" id="3602594">(</span><span class="ident" id="3602595">f</span><span class="op" id="3602596">.</span><span class="ident" id="3602597">Type</span><span class="op" id="3602601">,</span>&nbsp;<span class="ident" id="3602603">filter</span><span class="op" id="3602609">,</span>&nbsp;<span class="ident" id="3602611">export</span><span class="op" id="3602617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602627">list</span><span class="op" id="3602631">[</span><span class="ident" id="3602632">j</span><span class="op" id="3602633">]</span>&nbsp;<span class="op" id="3602635">=</span>&nbsp;<span class="ident" id="3602637">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602642">j</span><span class="op" id="3602643">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602648">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602654">if</span>&nbsp;<span class="ident" id="3602657">j</span>&nbsp;<span class="op" id="3602659">&lt;</span>&nbsp;<span class="builtinfunc" id="3602661">len</span><span class="op" id="3602664">(</span><span class="ident" id="3602665">list</span><span class="op" id="3602669">)</span>&nbsp;<span class="op" id="3602671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602675">removedFields</span>&nbsp;<span class="op" id="3602689">=</span>&nbsp;<span class="builtintype" id="3602691">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602700">fields</span><span class="op" id="3602706">.</span><span class="ident" id="3602707">List</span>&nbsp;<span class="op" id="3602712">=</span>&nbsp;<span class="ident" id="3602714">list</span><span class="op" id="3602718">[</span><span class="num" id="3602719">0</span><span class="op" id="3602720">:</span><span class="ident" id="3602721">j</span><span class="op" id="3602722">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602725">return</span><br>
<span class="lineno"></span><span class="op" id="3602732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3602735">func</span>&nbsp;<span class="ident" id="3602740">filterParamList</span><span class="op" id="3602755">(</span><span class="ident" id="3602756">fields</span>&nbsp;<span class="op" id="3602763">*</span><span class="ident" id="3602764">FieldList</span><span class="op" id="3602773">,</span>&nbsp;<span class="ident" id="3602775">filter</span>&nbsp;<span class="ident" id="3602782">Filter</span><span class="op" id="3602788">,</span>&nbsp;<span class="ident" id="3602790">export</span>&nbsp;<span class="builtintype" id="3602797">bool</span><span class="op" id="3602801">)</span>&nbsp;<span class="builtintype" id="3602803">bool</span>&nbsp;<span class="op" id="3602808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602811">if</span>&nbsp;<span class="ident" id="3602814">fields</span>&nbsp;<span class="op" id="3602821">==</span>&nbsp;<span class="ident" id="3602824">nil</span>&nbsp;<span class="op" id="3602828">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602832">return</span>&nbsp;<span class="builtintype" id="3602839">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602849">var</span>&nbsp;<span class="ident" id="3602853">b</span>&nbsp;<span class="builtintype" id="3602855">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602861">for</span>&nbsp;<span class="ident" id="3602865">_</span><span class="op" id="3602866">,</span>&nbsp;<span class="ident" id="3602868">f</span>&nbsp;<span class="op" id="3602870">:=</span>&nbsp;<span class="keyword" id="3602873">range</span>&nbsp;<span class="ident" id="3602879">fields</span><span class="op" id="3602885">.</span><span class="ident" id="3602886">List</span>&nbsp;<span class="op" id="3602891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602895">if</span>&nbsp;<span class="ident" id="3602898">filterType</span><span class="op" id="3602908">(</span><span class="ident" id="3602909">f</span><span class="op" id="3602910">.</span><span class="ident" id="3602911">Type</span><span class="op" id="3602915">,</span>&nbsp;<span class="ident" id="3602917">filter</span><span class="op" id="3602923">,</span>&nbsp;<span class="ident" id="3602925">export</span><span class="op" id="3602931">)</span>&nbsp;<span class="op" id="3602933">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3602938">b</span>&nbsp;<span class="op" id="3602940">=</span>&nbsp;<span class="builtintype" id="3602942">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3602952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3602955">return</span>&nbsp;<span class="ident" id="3602962">b</span><br>
<span class="lineno"></span><span class="op" id="3602964">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3602967">func</span>&nbsp;<span class="ident" id="3602972">filterType</span><span class="op" id="3602982">(</span><span class="ident" id="3602983">typ</span>&nbsp;<span class="ident" id="3602987">Expr</span><span class="op" id="3602991">,</span>&nbsp;<span class="ident" id="3602993">f</span>&nbsp;<span class="ident" id="3602995">Filter</span><span class="op" id="3603001">,</span>&nbsp;<span class="ident" id="3603003">export</span>&nbsp;<span class="builtintype" id="3603010">bool</span><span class="op" id="3603014">)</span>&nbsp;<span class="builtintype" id="3603016">bool</span>&nbsp;<span class="op" id="3603021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603024">switch</span>&nbsp;<span class="ident" id="3603031">t</span>&nbsp;<span class="op" id="3603033">:=</span>&nbsp;<span class="ident" id="3603036">typ</span><span class="op" id="3603039">.</span><span class="op" id="3603040">(</span><span class="keyword" id="3603041">type</span><span class="op" id="3603045">)</span>&nbsp;<span class="op" id="3603047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603050">case</span>&nbsp;<span class="op" id="3603055">*</span><span class="ident" id="3603056">Ident</span><span class="op" id="3603061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603065">return</span>&nbsp;<span class="ident" id="3603072">f</span><span class="op" id="3603073">(</span><span class="ident" id="3603074">t</span><span class="op" id="3603075">.</span><span class="ident" id="3603076">Name</span><span class="op" id="3603080">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603083">case</span>&nbsp;<span class="op" id="3603088">*</span><span class="ident" id="3603089">ParenExpr</span><span class="op" id="3603098">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603102">return</span>&nbsp;<span class="ident" id="3603109">filterType</span><span class="op" id="3603119">(</span><span class="ident" id="3603120">t</span><span class="op" id="3603121">.</span><span class="ident" id="3603122">X</span><span class="op" id="3603123">,</span>&nbsp;<span class="ident" id="3603125">f</span><span class="op" id="3603126">,</span>&nbsp;<span class="ident" id="3603128">export</span><span class="op" id="3603134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603137">case</span>&nbsp;<span class="op" id="3603142">*</span><span class="ident" id="3603143">ArrayType</span><span class="op" id="3603152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603156">return</span>&nbsp;<span class="ident" id="3603163">filterType</span><span class="op" id="3603173">(</span><span class="ident" id="3603174">t</span><span class="op" id="3603175">.</span><span class="ident" id="3603176">Elt</span><span class="op" id="3603179">,</span>&nbsp;<span class="ident" id="3603181">f</span><span class="op" id="3603182">,</span>&nbsp;<span class="ident" id="3603184">export</span><span class="op" id="3603190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603193">case</span>&nbsp;<span class="op" id="3603198">*</span><span class="ident" id="3603199">StructType</span><span class="op" id="3603209">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603213">if</span>&nbsp;<span class="ident" id="3603216">filterFieldList</span><span class="op" id="3603231">(</span><span class="ident" id="3603232">t</span><span class="op" id="3603233">.</span><span class="ident" id="3603234">Fields</span><span class="op" id="3603240">,</span>&nbsp;<span class="ident" id="3603242">f</span><span class="op" id="3603243">,</span>&nbsp;<span class="ident" id="3603245">export</span><span class="op" id="3603251">)</span>&nbsp;<span class="op" id="3603253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603258">t</span><span class="op" id="3603259">.</span><span class="ident" id="3603260">Incomplete</span>&nbsp;<span class="op" id="3603271">=</span>&nbsp;<span class="builtintype" id="3603273">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3603280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603284">return</span>&nbsp;<span class="builtinfunc" id="3603291">len</span><span class="op" id="3603294">(</span><span class="ident" id="3603295">t</span><span class="op" id="3603296">.</span><span class="ident" id="3603297">Fields</span><span class="op" id="3603303">.</span><span class="ident" id="3603304">List</span><span class="op" id="3603308">)</span>&nbsp;<span class="op" id="3603310">&gt;</span>&nbsp;<span class="num" id="3603312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603315">case</span>&nbsp;<span class="op" id="3603320">*</span><span class="ident" id="3603321">FuncType</span><span class="op" id="3603329">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603333">b1</span>&nbsp;<span class="op" id="3603336">:=</span>&nbsp;<span class="ident" id="3603339">filterParamList</span><span class="op" id="3603354">(</span><span class="ident" id="3603355">t</span><span class="op" id="3603356">.</span><span class="ident" id="3603357">Params</span><span class="op" id="3603363">,</span>&nbsp;<span class="ident" id="3603365">f</span><span class="op" id="3603366">,</span>&nbsp;<span class="ident" id="3603368">export</span><span class="op" id="3603374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603378">b2</span>&nbsp;<span class="op" id="3603381">:=</span>&nbsp;<span class="ident" id="3603384">filterParamList</span><span class="op" id="3603399">(</span><span class="ident" id="3603400">t</span><span class="op" id="3603401">.</span><span class="ident" id="3603402">Results</span><span class="op" id="3603409">,</span>&nbsp;<span class="ident" id="3603411">f</span><span class="op" id="3603412">,</span>&nbsp;<span class="ident" id="3603414">export</span><span class="op" id="3603420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603424">return</span>&nbsp;<span class="ident" id="3603431">b1</span>&nbsp;<span class="op" id="3603434">||</span>&nbsp;<span class="ident" id="3603437">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603441">case</span>&nbsp;<span class="op" id="3603446">*</span><span class="ident" id="3603447">InterfaceType</span><span class="op" id="3603460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603464">if</span>&nbsp;<span class="ident" id="3603467">filterFieldList</span><span class="op" id="3603482">(</span><span class="ident" id="3603483">t</span><span class="op" id="3603484">.</span><span class="ident" id="3603485">Methods</span><span class="op" id="3603492">,</span>&nbsp;<span class="ident" id="3603494">f</span><span class="op" id="3603495">,</span>&nbsp;<span class="ident" id="3603497">export</span><span class="op" id="3603503">)</span>&nbsp;<span class="op" id="3603505">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603510">t</span><span class="op" id="3603511">.</span><span class="ident" id="3603512">Incomplete</span>&nbsp;<span class="op" id="3603523">=</span>&nbsp;<span class="builtintype" id="3603525">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3603532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603536">return</span>&nbsp;<span class="builtinfunc" id="3603543">len</span><span class="op" id="3603546">(</span><span class="ident" id="3603547">t</span><span class="op" id="3603548">.</span><span class="ident" id="3603549">Methods</span><span class="op" id="3603556">.</span><span class="ident" id="3603557">List</span><span class="op" id="3603561">)</span>&nbsp;<span class="op" id="3603563">&gt;</span>&nbsp;<span class="num" id="3603565">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603568">case</span>&nbsp;<span class="op" id="3603573">*</span><span class="ident" id="3603574">MapType</span><span class="op" id="3603581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603585">b1</span>&nbsp;<span class="op" id="3603588">:=</span>&nbsp;<span class="ident" id="3603591">filterType</span><span class="op" id="3603601">(</span><span class="ident" id="3603602">t</span><span class="op" id="3603603">.</span><span class="ident" id="3603604">Key</span><span class="op" id="3603607">,</span>&nbsp;<span class="ident" id="3603609">f</span><span class="op" id="3603610">,</span>&nbsp;<span class="ident" id="3603612">export</span><span class="op" id="3603618">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603622">b2</span>&nbsp;<span class="op" id="3603625">:=</span>&nbsp;<span class="ident" id="3603628">filterType</span><span class="op" id="3603638">(</span><span class="ident" id="3603639">t</span><span class="op" id="3603640">.</span><span class="ident" id="3603641">Value</span><span class="op" id="3603646">,</span>&nbsp;<span class="ident" id="3603648">f</span><span class="op" id="3603649">,</span>&nbsp;<span class="ident" id="3603651">export</span><span class="op" id="3603657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603661">return</span>&nbsp;<span class="ident" id="3603668">b1</span>&nbsp;<span class="op" id="3603671">||</span>&nbsp;<span class="ident" id="3603674">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603678">case</span>&nbsp;<span class="op" id="3603683">*</span><span class="ident" id="3603684">ChanType</span><span class="op" id="3603692">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603696">return</span>&nbsp;<span class="ident" id="3603703">filterType</span><span class="op" id="3603713">(</span><span class="ident" id="3603714">t</span><span class="op" id="3603715">.</span><span class="ident" id="3603716">Value</span><span class="op" id="3603721">,</span>&nbsp;<span class="ident" id="3603723">f</span><span class="op" id="3603724">,</span>&nbsp;<span class="ident" id="3603726">export</span><span class="op" id="3603732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3603735">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603738">return</span>&nbsp;<span class="builtintype" id="3603745">false</span><br>
<span class="lineno"></span><span class="op" id="3603751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3603754">func</span>&nbsp;<span class="ident" id="3603759">filterSpec</span><span class="op" id="3603769">(</span><span class="ident" id="3603770">spec</span>&nbsp;<span class="ident" id="3603775">Spec</span><span class="op" id="3603779">,</span>&nbsp;<span class="ident" id="3603781">f</span>&nbsp;<span class="ident" id="3603783">Filter</span><span class="op" id="3603789">,</span>&nbsp;<span class="ident" id="3603791">export</span>&nbsp;<span class="builtintype" id="3603798">bool</span><span class="op" id="3603802">)</span>&nbsp;<span class="builtintype" id="3603804">bool</span>&nbsp;<span class="op" id="3603809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603812">switch</span>&nbsp;<span class="ident" id="3603819">s</span>&nbsp;<span class="op" id="3603821">:=</span>&nbsp;<span class="ident" id="3603824">spec</span><span class="op" id="3603828">.</span><span class="op" id="3603829">(</span><span class="keyword" id="3603830">type</span><span class="op" id="3603834">)</span>&nbsp;<span class="op" id="3603836">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603839">case</span>&nbsp;<span class="op" id="3603844">*</span><span class="ident" id="3603845">ValueSpec</span><span class="op" id="3603854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603858">s</span><span class="op" id="3603859">.</span><span class="ident" id="3603860">Names</span>&nbsp;<span class="op" id="3603866">=</span>&nbsp;<span class="ident" id="3603868">filterIdentList</span><span class="op" id="3603883">(</span><span class="ident" id="3603884">s</span><span class="op" id="3603885">.</span><span class="ident" id="3603886">Names</span><span class="op" id="3603891">,</span>&nbsp;<span class="ident" id="3603893">f</span><span class="op" id="3603894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603898">if</span>&nbsp;<span class="builtinfunc" id="3603901">len</span><span class="op" id="3603904">(</span><span class="ident" id="3603905">s</span><span class="op" id="3603906">.</span><span class="ident" id="3603907">Names</span><span class="op" id="3603912">)</span>&nbsp;<span class="op" id="3603914">&gt;</span>&nbsp;<span class="num" id="3603916">0</span>&nbsp;<span class="op" id="3603918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603923">if</span>&nbsp;<span class="ident" id="3603926">export</span>&nbsp;<span class="op" id="3603933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3603939">filterType</span><span class="op" id="3603949">(</span><span class="ident" id="3603950">s</span><span class="op" id="3603951">.</span><span class="ident" id="3603952">Type</span><span class="op" id="3603956">,</span>&nbsp;<span class="ident" id="3603958">f</span><span class="op" id="3603959">,</span>&nbsp;<span class="ident" id="3603961">export</span><span class="op" id="3603967">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3603972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603977">return</span>&nbsp;<span class="builtintype" id="3603984">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3603991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3603994">case</span>&nbsp;<span class="op" id="3603999">*</span><span class="ident" id="3604000">TypeSpec</span><span class="op" id="3604008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604012">if</span>&nbsp;<span class="ident" id="3604015">f</span><span class="op" id="3604016">(</span><span class="ident" id="3604017">s</span><span class="op" id="3604018">.</span><span class="ident" id="3604019">Name</span><span class="op" id="3604023">.</span><span class="ident" id="3604024">Name</span><span class="op" id="3604028">)</span>&nbsp;<span class="op" id="3604030">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604035">if</span>&nbsp;<span class="ident" id="3604038">export</span>&nbsp;<span class="op" id="3604045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3604051">filterType</span><span class="op" id="3604061">(</span><span class="ident" id="3604062">s</span><span class="op" id="3604063">.</span><span class="ident" id="3604064">Type</span><span class="op" id="3604068">,</span>&nbsp;<span class="ident" id="3604070">f</span><span class="op" id="3604071">,</span>&nbsp;<span class="ident" id="3604073">export</span><span class="op" id="3604079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3604084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604089">return</span>&nbsp;<span class="builtintype" id="3604096">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3604103">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604107">if</span>&nbsp;<span class="op" id="3604110">!</span><span class="ident" id="3604111">export</span>&nbsp;<span class="op" id="3604118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3604123">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3604171">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3604218">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3604229">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3604275">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604303">return</span>&nbsp;<span class="ident" id="3604310">filterType</span><span class="op" id="3604320">(</span><span class="ident" id="3604321">s</span><span class="op" id="3604322">.</span><span class="ident" id="3604323">Type</span><span class="op" id="3604327">,</span>&nbsp;<span class="ident" id="3604329">f</span><span class="op" id="3604330">,</span>&nbsp;<span class="ident" id="3604332">export</span><span class="op" id="3604338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3604342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3604345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604348">return</span>&nbsp;<span class="builtintype" id="3604355">false</span><br>
<span class="lineno">185</span><span class="op" id="3604361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3604364">func</span>&nbsp;<span class="ident" id="3604369">filterSpecList</span><span class="op" id="3604383">(</span><span class="ident" id="3604384">list</span>&nbsp;<span class="op" id="3604389">[</span><span class="op" id="3604390">]</span><span class="ident" id="3604391">Spec</span><span class="op" id="3604395">,</span>&nbsp;<span class="ident" id="3604397">f</span>&nbsp;<span class="ident" id="3604399">Filter</span><span class="op" id="3604405">,</span>&nbsp;<span class="ident" id="3604407">export</span>&nbsp;<span class="builtintype" id="3604414">bool</span><span class="op" id="3604418">)</span>&nbsp;<span class="op" id="3604420">[</span><span class="op" id="3604421">]</span><span class="ident" id="3604422">Spec</span>&nbsp;<span class="op" id="3604427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3604430">j</span>&nbsp;<span class="op" id="3604432">:=</span>&nbsp;<span class="num" id="3604435">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604438">for</span>&nbsp;<span class="ident" id="3604442">_</span><span class="op" id="3604443">,</span>&nbsp;<span class="ident" id="3604445">s</span>&nbsp;<span class="op" id="3604447">:=</span>&nbsp;<span class="keyword" id="3604450">range</span>&nbsp;<span class="ident" id="3604456">list</span>&nbsp;<span class="op" id="3604461">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604465">if</span>&nbsp;<span class="ident" id="3604468">filterSpec</span><span class="op" id="3604478">(</span><span class="ident" id="3604479">s</span><span class="op" id="3604480">,</span>&nbsp;<span class="ident" id="3604482">f</span><span class="op" id="3604483">,</span>&nbsp;<span class="ident" id="3604485">export</span><span class="op" id="3604491">)</span>&nbsp;<span class="op" id="3604493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3604498">list</span><span class="op" id="3604502">[</span><span class="ident" id="3604503">j</span><span class="op" id="3604504">]</span>&nbsp;<span class="op" id="3604506">=</span>&nbsp;<span class="ident" id="3604508">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3604513">j</span><span class="op" id="3604514">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3604519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3604522">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604525">return</span>&nbsp;<span class="ident" id="3604532">list</span><span class="op" id="3604536">[</span><span class="num" id="3604537">0</span><span class="op" id="3604538">:</span><span class="ident" id="3604539">j</span><span class="op" id="3604540">]</span><br>
<span class="lineno"></span><span class="op" id="3604542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3604545">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="3604615">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="3604684">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="3604751">//</span><br>
<span class="lineno"></span><span class="comment" id="3604754">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="3604824">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3604866">//</span><br>
<span class="lineno">205</span><span class="keyword" id="3604869">func</span>&nbsp;<span class="ident" id="3604874">FilterDecl</span><span class="op" id="3604884">(</span><span class="ident" id="3604885">decl</span>&nbsp;<span class="ident" id="3604890">Decl</span><span class="op" id="3604894">,</span>&nbsp;<span class="ident" id="3604896">f</span>&nbsp;<span class="ident" id="3604898">Filter</span><span class="op" id="3604904">)</span>&nbsp;<span class="builtintype" id="3604906">bool</span>&nbsp;<span class="op" id="3604911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3604914">return</span>&nbsp;<span class="ident" id="3604921">filterDecl</span><span class="op" id="3604931">(</span><span class="ident" id="3604932">decl</span><span class="op" id="3604936">,</span>&nbsp;<span class="ident" id="3604938">f</span><span class="op" id="3604939">,</span>&nbsp;<span class="builtintype" id="3604941">false</span><span class="op" id="3604946">)</span><br>
<span class="lineno"></span><span class="op" id="3604948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3604951">func</span>&nbsp;<span class="ident" id="3604956">filterDecl</span><span class="op" id="3604966">(</span><span class="ident" id="3604967">decl</span>&nbsp;<span class="ident" id="3604972">Decl</span><span class="op" id="3604976">,</span>&nbsp;<span class="ident" id="3604978">f</span>&nbsp;<span class="ident" id="3604980">Filter</span><span class="op" id="3604986">,</span>&nbsp;<span class="ident" id="3604988">export</span>&nbsp;<span class="builtintype" id="3604995">bool</span><span class="op" id="3604999">)</span>&nbsp;<span class="builtintype" id="3605001">bool</span>&nbsp;<span class="op" id="3605006">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605009">switch</span>&nbsp;<span class="ident" id="3605016">d</span>&nbsp;<span class="op" id="3605018">:=</span>&nbsp;<span class="ident" id="3605021">decl</span><span class="op" id="3605025">.</span><span class="op" id="3605026">(</span><span class="keyword" id="3605027">type</span><span class="op" id="3605031">)</span>&nbsp;<span class="op" id="3605033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605036">case</span>&nbsp;<span class="op" id="3605041">*</span><span class="ident" id="3605042">GenDecl</span><span class="op" id="3605049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3605053">d</span><span class="op" id="3605054">.</span><span class="ident" id="3605055">Specs</span>&nbsp;<span class="op" id="3605061">=</span>&nbsp;<span class="ident" id="3605063">filterSpecList</span><span class="op" id="3605077">(</span><span class="ident" id="3605078">d</span><span class="op" id="3605079">.</span><span class="ident" id="3605080">Specs</span><span class="op" id="3605085">,</span>&nbsp;<span class="ident" id="3605087">f</span><span class="op" id="3605088">,</span>&nbsp;<span class="ident" id="3605090">export</span><span class="op" id="3605096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605100">return</span>&nbsp;<span class="builtinfunc" id="3605107">len</span><span class="op" id="3605110">(</span><span class="ident" id="3605111">d</span><span class="op" id="3605112">.</span><span class="ident" id="3605113">Specs</span><span class="op" id="3605118">)</span>&nbsp;<span class="op" id="3605120">&gt;</span>&nbsp;<span class="num" id="3605122">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605125">case</span>&nbsp;<span class="op" id="3605130">*</span><span class="ident" id="3605131">FuncDecl</span><span class="op" id="3605139">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605143">return</span>&nbsp;<span class="ident" id="3605150">f</span><span class="op" id="3605151">(</span><span class="ident" id="3605152">d</span><span class="op" id="3605153">.</span><span class="ident" id="3605154">Name</span><span class="op" id="3605158">.</span><span class="ident" id="3605159">Name</span><span class="op" id="3605163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3605166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605169">return</span>&nbsp;<span class="builtintype" id="3605176">false</span><br>
<span class="lineno"></span><span class="op" id="3605182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3605185">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="3605252">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3605317">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3605385">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="3605455">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="3605522">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="3605541">//</span><br>
<span class="lineno"></span><span class="comment" id="3605544">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="3605611">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3605664">//</span><br>
<span class="lineno">230</span><span class="keyword" id="3605667">func</span>&nbsp;<span class="ident" id="3605672">FilterFile</span><span class="op" id="3605682">(</span><span class="ident" id="3605683">src</span>&nbsp;<span class="op" id="3605687">*</span><span class="ident" id="3605688">File</span><span class="op" id="3605692">,</span>&nbsp;<span class="ident" id="3605694">f</span>&nbsp;<span class="ident" id="3605696">Filter</span><span class="op" id="3605702">)</span>&nbsp;<span class="builtintype" id="3605704">bool</span>&nbsp;<span class="op" id="3605709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605712">return</span>&nbsp;<span class="ident" id="3605719">filterFile</span><span class="op" id="3605729">(</span><span class="ident" id="3605730">src</span><span class="op" id="3605733">,</span>&nbsp;<span class="ident" id="3605735">f</span><span class="op" id="3605736">,</span>&nbsp;<span class="builtintype" id="3605738">false</span><span class="op" id="3605743">)</span><br>
<span class="lineno"></span><span class="op" id="3605745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3605748">func</span>&nbsp;<span class="ident" id="3605753">filterFile</span><span class="op" id="3605763">(</span><span class="ident" id="3605764">src</span>&nbsp;<span class="op" id="3605768">*</span><span class="ident" id="3605769">File</span><span class="op" id="3605773">,</span>&nbsp;<span class="ident" id="3605775">f</span>&nbsp;<span class="ident" id="3605777">Filter</span><span class="op" id="3605783">,</span>&nbsp;<span class="ident" id="3605785">export</span>&nbsp;<span class="builtintype" id="3605792">bool</span><span class="op" id="3605796">)</span>&nbsp;<span class="builtintype" id="3605798">bool</span>&nbsp;<span class="op" id="3605803">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3605806">j</span>&nbsp;<span class="op" id="3605808">:=</span>&nbsp;<span class="num" id="3605811">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605814">for</span>&nbsp;<span class="ident" id="3605818">_</span><span class="op" id="3605819">,</span>&nbsp;<span class="ident" id="3605821">d</span>&nbsp;<span class="op" id="3605823">:=</span>&nbsp;<span class="keyword" id="3605826">range</span>&nbsp;<span class="ident" id="3605832">src</span><span class="op" id="3605835">.</span><span class="ident" id="3605836">Decls</span>&nbsp;<span class="op" id="3605842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605846">if</span>&nbsp;<span class="ident" id="3605849">filterDecl</span><span class="op" id="3605859">(</span><span class="ident" id="3605860">d</span><span class="op" id="3605861">,</span>&nbsp;<span class="ident" id="3605863">f</span><span class="op" id="3605864">,</span>&nbsp;<span class="ident" id="3605866">export</span><span class="op" id="3605872">)</span>&nbsp;<span class="op" id="3605874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3605879">src</span><span class="op" id="3605882">.</span><span class="ident" id="3605883">Decls</span><span class="op" id="3605888">[</span><span class="ident" id="3605889">j</span><span class="op" id="3605890">]</span>&nbsp;<span class="op" id="3605892">=</span>&nbsp;<span class="ident" id="3605894">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3605899">j</span><span class="op" id="3605900">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3605905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3605908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3605911">src</span><span class="op" id="3605914">.</span><span class="ident" id="3605915">Decls</span>&nbsp;<span class="op" id="3605921">=</span>&nbsp;<span class="ident" id="3605923">src</span><span class="op" id="3605926">.</span><span class="ident" id="3605927">Decls</span><span class="op" id="3605932">[</span><span class="num" id="3605933">0</span><span class="op" id="3605934">:</span><span class="ident" id="3605935">j</span><span class="op" id="3605936">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3605939">return</span>&nbsp;<span class="ident" id="3605946">j</span>&nbsp;<span class="op" id="3605948">&gt;</span>&nbsp;<span class="num" id="3605950">0</span><br>
<span class="lineno"></span><span class="op" id="3605952">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="3605955">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="3606024">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3606093">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3606161">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="3606231">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3606301">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="3606373">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="3606382">//</span><br>
<span class="lineno"></span><span class="comment" id="3606385">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="3606455">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="3606508">//</span><br>
<span class="lineno"></span><span class="keyword" id="3606511">func</span>&nbsp;<span class="ident" id="3606516">FilterPackage</span><span class="op" id="3606529">(</span><span class="ident" id="3606530">pkg</span>&nbsp;<span class="op" id="3606534">*</span><span class="ident" id="3606535">Package</span><span class="op" id="3606542">,</span>&nbsp;<span class="ident" id="3606544">f</span>&nbsp;<span class="ident" id="3606546">Filter</span><span class="op" id="3606552">)</span>&nbsp;<span class="builtintype" id="3606554">bool</span>&nbsp;<span class="op" id="3606559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3606562">return</span>&nbsp;<span class="ident" id="3606569">filterPackage</span><span class="op" id="3606582">(</span><span class="ident" id="3606583">pkg</span><span class="op" id="3606586">,</span>&nbsp;<span class="ident" id="3606588">f</span><span class="op" id="3606589">,</span>&nbsp;<span class="builtintype" id="3606591">false</span><span class="op" id="3606596">)</span><br>
<span class="lineno"></span><span class="op" id="3606598">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="3606601">func</span>&nbsp;<span class="ident" id="3606606">filterPackage</span><span class="op" id="3606619">(</span><span class="ident" id="3606620">pkg</span>&nbsp;<span class="op" id="3606624">*</span><span class="ident" id="3606625">Package</span><span class="op" id="3606632">,</span>&nbsp;<span class="ident" id="3606634">f</span>&nbsp;<span class="ident" id="3606636">Filter</span><span class="op" id="3606642">,</span>&nbsp;<span class="ident" id="3606644">export</span>&nbsp;<span class="builtintype" id="3606651">bool</span><span class="op" id="3606655">)</span>&nbsp;<span class="builtintype" id="3606657">bool</span>&nbsp;<span class="op" id="3606662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3606665">hasDecls</span>&nbsp;<span class="op" id="3606674">:=</span>&nbsp;<span class="builtintype" id="3606677">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3606684">for</span>&nbsp;<span class="ident" id="3606688">_</span><span class="op" id="3606689">,</span>&nbsp;<span class="ident" id="3606691">src</span>&nbsp;<span class="op" id="3606695">:=</span>&nbsp;<span class="keyword" id="3606698">range</span>&nbsp;<span class="ident" id="3606704">pkg</span><span class="op" id="3606707">.</span><span class="ident" id="3606708">Files</span>&nbsp;<span class="op" id="3606714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3606718">if</span>&nbsp;<span class="ident" id="3606721">filterFile</span><span class="op" id="3606731">(</span><span class="ident" id="3606732">src</span><span class="op" id="3606735">,</span>&nbsp;<span class="ident" id="3606737">f</span><span class="op" id="3606738">,</span>&nbsp;<span class="ident" id="3606740">export</span><span class="op" id="3606746">)</span>&nbsp;<span class="op" id="3606748">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3606753">hasDecls</span>&nbsp;<span class="op" id="3606762">=</span>&nbsp;<span class="builtintype" id="3606764">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3606771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3606774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3606777">return</span>&nbsp;<span class="ident" id="3606784">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="3606793">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="3606796">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="3606876">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3606905">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="3606971">type</span>&nbsp;<span class="ident" id="3606976">MergeMode</span>&nbsp;<span class="builtintype" id="3606986">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3606992">const</span>&nbsp;<span class="op" id="3606998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607001">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3607059">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="3607080">MergeMode</span>&nbsp;<span class="op" id="3607090">=</span>&nbsp;<span class="num" id="3607092">1</span>&nbsp;<span class="op" id="3607094">&lt;&lt;</span>&nbsp;<span class="ident" id="3607097">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607103">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607164">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3607211">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607239">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3607295">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="3607318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3607321">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3607387">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3607454">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="3607498">//</span><br>
<span class="lineno"></span><span class="keyword" id="3607501">func</span>&nbsp;<span class="ident" id="3607506">nameOf</span><span class="op" id="3607512">(</span><span class="ident" id="3607513">f</span>&nbsp;<span class="op" id="3607515">*</span><span class="ident" id="3607516">FuncDecl</span><span class="op" id="3607524">)</span>&nbsp;<span class="builtintype" id="3607526">string</span>&nbsp;<span class="op" id="3607533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3607536">if</span>&nbsp;<span class="ident" id="3607539">r</span>&nbsp;<span class="op" id="3607541">:=</span>&nbsp;<span class="ident" id="3607544">f</span><span class="op" id="3607545">.</span><span class="ident" id="3607546">Recv</span><span class="op" id="3607550">;</span>&nbsp;<span class="ident" id="3607552">r</span>&nbsp;<span class="op" id="3607554">!=</span>&nbsp;<span class="ident" id="3607557">nil</span>&nbsp;<span class="op" id="3607561">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3607564">len</span><span class="op" id="3607567">(</span><span class="ident" id="3607568">r</span><span class="op" id="3607569">.</span><span class="ident" id="3607570">List</span><span class="op" id="3607574">)</span>&nbsp;<span class="op" id="3607576">==</span>&nbsp;<span class="num" id="3607579">1</span>&nbsp;<span class="op" id="3607581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607585">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3607632">t</span>&nbsp;<span class="op" id="3607634">:=</span>&nbsp;<span class="ident" id="3607637">r</span><span class="op" id="3607638">.</span><span class="ident" id="3607639">List</span><span class="op" id="3607643">[</span><span class="num" id="3607644">0</span><span class="op" id="3607645">]</span><span class="op" id="3607646">.</span><span class="ident" id="3607647">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607654">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3607694">if</span>&nbsp;<span class="ident" id="3607697">p</span><span class="op" id="3607698">,</span>&nbsp;<span class="ident" id="3607700">_</span>&nbsp;<span class="op" id="3607702">:=</span>&nbsp;<span class="ident" id="3607705">t</span><span class="op" id="3607706">.</span><span class="op" id="3607707">(</span><span class="op" id="3607708">*</span><span class="ident" id="3607709">StarExpr</span><span class="op" id="3607717">)</span><span class="op" id="3607718">;</span>&nbsp;<span class="ident" id="3607720">p</span>&nbsp;<span class="op" id="3607722">!=</span>&nbsp;<span class="ident" id="3607725">nil</span>&nbsp;<span class="op" id="3607729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3607734">t</span>&nbsp;<span class="op" id="3607736">=</span>&nbsp;<span class="ident" id="3607738">p</span><span class="op" id="3607739">.</span><span class="ident" id="3607740">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3607744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607748">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3607791">if</span>&nbsp;<span class="ident" id="3607794">p</span><span class="op" id="3607795">,</span>&nbsp;<span class="ident" id="3607797">_</span>&nbsp;<span class="op" id="3607799">:=</span>&nbsp;<span class="ident" id="3607802">t</span><span class="op" id="3607803">.</span><span class="op" id="3607804">(</span><span class="op" id="3607805">*</span><span class="ident" id="3607806">Ident</span><span class="op" id="3607811">)</span><span class="op" id="3607812">;</span>&nbsp;<span class="ident" id="3607814">p</span>&nbsp;<span class="op" id="3607816">!=</span>&nbsp;<span class="ident" id="3607819">nil</span>&nbsp;<span class="op" id="3607823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3607828">return</span>&nbsp;<span class="ident" id="3607835">p</span><span class="op" id="3607836">.</span><span class="ident" id="3607837">Name</span>&nbsp;<span class="op" id="3607842">+</span>&nbsp;<span class="string" id="3607844">&#34;.&#34;</span>&nbsp;<span class="op" id="3607848">+</span>&nbsp;<span class="ident" id="3607850">f</span><span class="op" id="3607851">.</span><span class="ident" id="3607852">Name</span><span class="op" id="3607856">.</span><span class="ident" id="3607857">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3607864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3607868">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3607908">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3607911">return</span>&nbsp;<span class="ident" id="3607918">f</span><span class="op" id="3607919">.</span><span class="ident" id="3607920">Name</span><span class="op" id="3607924">.</span><span class="ident" id="3607925">Name</span><br>
<span class="lineno"></span><span class="op" id="3607930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3607933">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="3608004">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="3608079">//</span><br>
<span class="lineno"></span><span class="keyword" id="3608082">var</span>&nbsp;<span class="ident" id="3608086">separator</span>&nbsp;<span class="op" id="3608096">=</span>&nbsp;<span class="op" id="3608098">&amp;</span><span class="ident" id="3608099">Comment</span><span class="op" id="3608106">{</span><span class="ident" id="3608107">token</span><span class="op" id="3608112">.</span><span class="ident" id="3608113">NoPos</span><span class="op" id="3608118">,</span>&nbsp;<span class="string" id="3608120">&#34;//&#34;</span><span class="op" id="3608124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3608127">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3608194">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="3608268">//</span><br>
<span class="lineno"></span><span class="keyword" id="3608271">func</span>&nbsp;<span class="ident" id="3608276">MergePackageFiles</span><span class="op" id="3608293">(</span><span class="ident" id="3608294">pkg</span>&nbsp;<span class="op" id="3608298">*</span><span class="ident" id="3608299">Package</span><span class="op" id="3608306">,</span>&nbsp;<span class="ident" id="3608308">mode</span>&nbsp;<span class="ident" id="3608313">MergeMode</span><span class="op" id="3608322">)</span>&nbsp;<span class="op" id="3608324">*</span><span class="ident" id="3608325">File</span>&nbsp;<span class="op" id="3608330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3608333">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3608404">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3608475">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608539">ndocs</span>&nbsp;<span class="op" id="3608545">:=</span>&nbsp;<span class="num" id="3608548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608551">ncomments</span>&nbsp;<span class="op" id="3608561">:=</span>&nbsp;<span class="num" id="3608564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608567">ndecls</span>&nbsp;<span class="op" id="3608574">:=</span>&nbsp;<span class="num" id="3608577">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608580">filenames</span>&nbsp;<span class="op" id="3608590">:=</span>&nbsp;<span class="builtinfunc" id="3608593">make</span><span class="op" id="3608597">(</span><span class="op" id="3608598">[</span><span class="op" id="3608599">]</span><span class="builtintype" id="3608600">string</span><span class="op" id="3608606">,</span>&nbsp;<span class="builtinfunc" id="3608608">len</span><span class="op" id="3608611">(</span><span class="ident" id="3608612">pkg</span><span class="op" id="3608615">.</span><span class="ident" id="3608616">Files</span><span class="op" id="3608621">)</span><span class="op" id="3608622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608625">i</span>&nbsp;<span class="op" id="3608627">:=</span>&nbsp;<span class="num" id="3608630">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3608633">for</span>&nbsp;<span class="ident" id="3608637">filename</span><span class="op" id="3608645">,</span>&nbsp;<span class="ident" id="3608647">f</span>&nbsp;<span class="op" id="3608649">:=</span>&nbsp;<span class="keyword" id="3608652">range</span>&nbsp;<span class="ident" id="3608658">pkg</span><span class="op" id="3608661">.</span><span class="ident" id="3608662">Files</span>&nbsp;<span class="op" id="3608668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608672">filenames</span><span class="op" id="3608681">[</span><span class="ident" id="3608682">i</span><span class="op" id="3608683">]</span>&nbsp;<span class="op" id="3608685">=</span>&nbsp;<span class="ident" id="3608687">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608698">i</span><span class="op" id="3608699">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3608704">if</span>&nbsp;<span class="ident" id="3608707">f</span><span class="op" id="3608708">.</span><span class="ident" id="3608709">Doc</span>&nbsp;<span class="op" id="3608713">!=</span>&nbsp;<span class="ident" id="3608716">nil</span>&nbsp;<span class="op" id="3608720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608725">ndocs</span>&nbsp;<span class="op" id="3608731">+=</span>&nbsp;<span class="builtinfunc" id="3608734">len</span><span class="op" id="3608737">(</span><span class="ident" id="3608738">f</span><span class="op" id="3608739">.</span><span class="ident" id="3608740">Doc</span><span class="op" id="3608743">.</span><span class="ident" id="3608744">List</span><span class="op" id="3608748">)</span>&nbsp;<span class="op" id="3608750">+</span>&nbsp;<span class="num" id="3608752">1</span>&nbsp;<span class="comment" id="3608754">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3608776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608780">ncomments</span>&nbsp;<span class="op" id="3608790">+=</span>&nbsp;<span class="builtinfunc" id="3608793">len</span><span class="op" id="3608796">(</span><span class="ident" id="3608797">f</span><span class="op" id="3608798">.</span><span class="ident" id="3608799">Comments</span><span class="op" id="3608807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608811">ndecls</span>&nbsp;<span class="op" id="3608818">+=</span>&nbsp;<span class="builtinfunc" id="3608821">len</span><span class="op" id="3608824">(</span><span class="ident" id="3608825">f</span><span class="op" id="3608826">.</span><span class="ident" id="3608827">Decls</span><span class="op" id="3608832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3608835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3608838">sort</span><span class="op" id="3608842">.</span><span class="ident" id="3608843">Strings</span><span class="op" id="3608850">(</span><span class="ident" id="3608851">filenames</span><span class="op" id="3608860">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3608864">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3608930">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3608997">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3609064">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609130">var</span>&nbsp;<span class="ident" id="3609134">doc</span>&nbsp;<span class="op" id="3609138">*</span><span class="ident" id="3609139">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609153">var</span>&nbsp;<span class="ident" id="3609157">pos</span>&nbsp;<span class="ident" id="3609161">token</span><span class="op" id="3609166">.</span><span class="ident" id="3609167">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609172">if</span>&nbsp;<span class="ident" id="3609175">ndocs</span>&nbsp;<span class="op" id="3609181">&gt;</span>&nbsp;<span class="num" id="3609183">0</span>&nbsp;<span class="op" id="3609185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609189">list</span>&nbsp;<span class="op" id="3609194">:=</span>&nbsp;<span class="builtinfunc" id="3609197">make</span><span class="op" id="3609201">(</span><span class="op" id="3609202">[</span><span class="op" id="3609203">]</span><span class="op" id="3609204">*</span><span class="ident" id="3609205">Comment</span><span class="op" id="3609212">,</span>&nbsp;<span class="ident" id="3609214">ndocs</span><span class="op" id="3609219">-</span><span class="num" id="3609220">1</span><span class="op" id="3609221">)</span>&nbsp;<span class="comment" id="3609223">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609264">i</span>&nbsp;<span class="op" id="3609266">:=</span>&nbsp;<span class="num" id="3609269">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609273">for</span>&nbsp;<span class="ident" id="3609277">_</span><span class="op" id="3609278">,</span>&nbsp;<span class="ident" id="3609280">filename</span>&nbsp;<span class="op" id="3609289">:=</span>&nbsp;<span class="keyword" id="3609292">range</span>&nbsp;<span class="ident" id="3609298">filenames</span>&nbsp;<span class="op" id="3609308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609313">f</span>&nbsp;<span class="op" id="3609315">:=</span>&nbsp;<span class="ident" id="3609318">pkg</span><span class="op" id="3609321">.</span><span class="ident" id="3609322">Files</span><span class="op" id="3609327">[</span><span class="ident" id="3609328">filename</span><span class="op" id="3609336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609341">if</span>&nbsp;<span class="ident" id="3609344">f</span><span class="op" id="3609345">.</span><span class="ident" id="3609346">Doc</span>&nbsp;<span class="op" id="3609350">!=</span>&nbsp;<span class="ident" id="3609353">nil</span>&nbsp;<span class="op" id="3609357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609363">if</span>&nbsp;<span class="ident" id="3609366">i</span>&nbsp;<span class="op" id="3609368">&gt;</span>&nbsp;<span class="num" id="3609370">0</span>&nbsp;<span class="op" id="3609372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3609379">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609423">list</span><span class="op" id="3609427">[</span><span class="ident" id="3609428">i</span><span class="op" id="3609429">]</span>&nbsp;<span class="op" id="3609431">=</span>&nbsp;<span class="ident" id="3609433">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609448">i</span><span class="op" id="3609449">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3609456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609462">for</span>&nbsp;<span class="ident" id="3609466">_</span><span class="op" id="3609467">,</span>&nbsp;<span class="ident" id="3609469">c</span>&nbsp;<span class="op" id="3609471">:=</span>&nbsp;<span class="keyword" id="3609474">range</span>&nbsp;<span class="ident" id="3609480">f</span><span class="op" id="3609481">.</span><span class="ident" id="3609482">Doc</span><span class="op" id="3609485">.</span><span class="ident" id="3609486">List</span>&nbsp;<span class="op" id="3609491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609498">list</span><span class="op" id="3609502">[</span><span class="ident" id="3609503">i</span><span class="op" id="3609504">]</span>&nbsp;<span class="op" id="3609506">=</span>&nbsp;<span class="ident" id="3609508">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609515">i</span><span class="op" id="3609516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3609523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609529">if</span>&nbsp;<span class="ident" id="3609532">f</span><span class="op" id="3609533">.</span><span class="ident" id="3609534">Package</span>&nbsp;<span class="op" id="3609542">&gt;</span>&nbsp;<span class="ident" id="3609544">pos</span>&nbsp;<span class="op" id="3609548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3609555">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3609607">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3609661">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609676">pos</span>&nbsp;<span class="op" id="3609680">=</span>&nbsp;<span class="ident" id="3609682">f</span><span class="op" id="3609683">.</span><span class="ident" id="3609684">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3609696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3609701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3609705">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609709">doc</span>&nbsp;<span class="op" id="3609713">=</span>&nbsp;<span class="op" id="3609715">&amp;</span><span class="ident" id="3609716">CommentGroup</span><span class="op" id="3609728">{</span><span class="ident" id="3609729">list</span><span class="op" id="3609733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3609736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3609740">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609789">var</span>&nbsp;<span class="ident" id="3609793">decls</span>&nbsp;<span class="op" id="3609799">[</span><span class="op" id="3609800">]</span><span class="ident" id="3609801">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3609807">if</span>&nbsp;<span class="ident" id="3609810">ndecls</span>&nbsp;<span class="op" id="3609817">&gt;</span>&nbsp;<span class="num" id="3609819">0</span>&nbsp;<span class="op" id="3609821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609825">decls</span>&nbsp;<span class="op" id="3609831">=</span>&nbsp;<span class="builtinfunc" id="3609833">make</span><span class="op" id="3609837">(</span><span class="op" id="3609838">[</span><span class="op" id="3609839">]</span><span class="ident" id="3609840">Decl</span><span class="op" id="3609844">,</span>&nbsp;<span class="ident" id="3609846">ndecls</span><span class="op" id="3609852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609856">funcs</span>&nbsp;<span class="op" id="3609862">:=</span>&nbsp;<span class="builtinfunc" id="3609865">make</span><span class="op" id="3609869">(</span><span class="keyword" id="3609870">map</span><span class="op" id="3609873">[</span><span class="builtintype" id="3609874">string</span><span class="op" id="3609880">]</span><span class="builtintype" id="3609881">int</span><span class="op" id="3609884">)</span>&nbsp;<span class="comment" id="3609886">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609923">i</span>&nbsp;<span class="op" id="3609925">:=</span>&nbsp;<span class="num" id="3609928">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3609953">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3609972">n</span>&nbsp;<span class="op" id="3609974">:=</span>&nbsp;<span class="num" id="3609977">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3610002">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3610034">for</span>&nbsp;<span class="ident" id="3610038">_</span><span class="op" id="3610039">,</span>&nbsp;<span class="ident" id="3610041">filename</span>&nbsp;<span class="op" id="3610050">:=</span>&nbsp;<span class="keyword" id="3610053">range</span>&nbsp;<span class="ident" id="3610059">filenames</span>&nbsp;<span class="op" id="3610069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3610074">f</span>&nbsp;<span class="op" id="3610076">:=</span>&nbsp;<span class="ident" id="3610079">pkg</span><span class="op" id="3610082">.</span><span class="ident" id="3610083">Files</span><span class="op" id="3610088">[</span><span class="ident" id="3610089">filename</span><span class="op" id="3610097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3610102">for</span>&nbsp;<span class="ident" id="3610106">_</span><span class="op" id="3610107">,</span>&nbsp;<span class="ident" id="3610109">d</span>&nbsp;<span class="op" id="3610111">:=</span>&nbsp;<span class="keyword" id="3610114">range</span>&nbsp;<span class="ident" id="3610120">f</span><span class="op" id="3610121">.</span><span class="ident" id="3610122">Decls</span>&nbsp;<span class="op" id="3610128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3610134">if</span>&nbsp;<span class="ident" id="3610137">mode</span><span class="op" id="3610141">&amp;</span><span class="ident" id="3610142">FilterFuncDuplicates</span>&nbsp;<span class="op" id="3610163">!=</span>&nbsp;<span class="num" id="3610166">0</span>&nbsp;<span class="op" id="3610168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610175">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610226">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610276">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610324">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610374">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610427">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610435">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610485">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610536">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3610589">if</span>&nbsp;<span class="ident" id="3610592">f</span><span class="op" id="3610593">,</span>&nbsp;<span class="ident" id="3610595">isFun</span>&nbsp;<span class="op" id="3610601">:=</span>&nbsp;<span class="ident" id="3610604">d</span><span class="op" id="3610605">.</span><span class="op" id="3610606">(</span><span class="op" id="3610607">*</span><span class="ident" id="3610608">FuncDecl</span><span class="op" id="3610616">)</span><span class="op" id="3610617">;</span>&nbsp;<span class="ident" id="3610619">isFun</span>&nbsp;<span class="op" id="3610625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3610633">name</span>&nbsp;<span class="op" id="3610638">:=</span>&nbsp;<span class="ident" id="3610641">nameOf</span><span class="op" id="3610647">(</span><span class="ident" id="3610648">f</span><span class="op" id="3610649">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3610657">if</span>&nbsp;<span class="ident" id="3610660">j</span><span class="op" id="3610661">,</span>&nbsp;<span class="ident" id="3610663">exists</span>&nbsp;<span class="op" id="3610670">:=</span>&nbsp;<span class="ident" id="3610673">funcs</span><span class="op" id="3610678">[</span><span class="ident" id="3610679">name</span><span class="op" id="3610683">]</span><span class="op" id="3610684">;</span>&nbsp;<span class="ident" id="3610686">exists</span>&nbsp;<span class="op" id="3610693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610702">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3610738">if</span>&nbsp;<span class="ident" id="3610741">decls</span><span class="op" id="3610746">[</span><span class="ident" id="3610747">j</span><span class="op" id="3610748">]</span>&nbsp;<span class="op" id="3610750">!=</span>&nbsp;<span class="ident" id="3610753">nil</span>&nbsp;<span class="op" id="3610757">&amp;&amp;</span>&nbsp;<span class="ident" id="3610760">decls</span><span class="op" id="3610765">[</span><span class="ident" id="3610766">j</span><span class="op" id="3610767">]</span><span class="op" id="3610768">.</span><span class="op" id="3610769">(</span><span class="op" id="3610770">*</span><span class="ident" id="3610771">FuncDecl</span><span class="op" id="3610779">)</span><span class="op" id="3610780">.</span><span class="ident" id="3610781">Doc</span>&nbsp;<span class="op" id="3610785">==</span>&nbsp;<span class="ident" id="3610788">nil</span>&nbsp;<span class="op" id="3610792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610802">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610856">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3610899">decls</span><span class="op" id="3610904">[</span><span class="ident" id="3610905">j</span><span class="op" id="3610906">]</span>&nbsp;<span class="op" id="3610908">=</span>&nbsp;<span class="ident" id="3610910">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3610921">}</span>&nbsp;<span class="keyword" id="3610923">else</span>&nbsp;<span class="op" id="3610928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3610938">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3610976">d</span>&nbsp;<span class="op" id="3610978">=</span>&nbsp;<span class="ident" id="3610980">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3610991">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611000">n</span><span class="op" id="3611001">++</span>&nbsp;<span class="comment" id="3611004">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611031">}</span>&nbsp;<span class="keyword" id="3611033">else</span>&nbsp;<span class="op" id="3611038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611047">funcs</span><span class="op" id="3611052">[</span><span class="ident" id="3611053">name</span><span class="op" id="3611057">]</span>&nbsp;<span class="op" id="3611059">=</span>&nbsp;<span class="ident" id="3611061">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611076">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611088">decls</span><span class="op" id="3611093">[</span><span class="ident" id="3611094">i</span><span class="op" id="3611095">]</span>&nbsp;<span class="op" id="3611097">=</span>&nbsp;<span class="ident" id="3611099">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611105">i</span><span class="op" id="3611106">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611116">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611121">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611184">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611251">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611318">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611383">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611416">if</span>&nbsp;<span class="ident" id="3611419">n</span>&nbsp;<span class="op" id="3611421">&gt;</span>&nbsp;<span class="num" id="3611423">0</span>&nbsp;<span class="op" id="3611425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611430">i</span>&nbsp;<span class="op" id="3611432">=</span>&nbsp;<span class="num" id="3611434">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611439">for</span>&nbsp;<span class="ident" id="3611443">_</span><span class="op" id="3611444">,</span>&nbsp;<span class="ident" id="3611446">d</span>&nbsp;<span class="op" id="3611448">:=</span>&nbsp;<span class="keyword" id="3611451">range</span>&nbsp;<span class="ident" id="3611457">decls</span>&nbsp;<span class="op" id="3611463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611469">if</span>&nbsp;<span class="ident" id="3611472">d</span>&nbsp;<span class="op" id="3611474">!=</span>&nbsp;<span class="ident" id="3611477">nil</span>&nbsp;<span class="op" id="3611481">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611488">decls</span><span class="op" id="3611493">[</span><span class="ident" id="3611494">i</span><span class="op" id="3611495">]</span>&nbsp;<span class="op" id="3611497">=</span>&nbsp;<span class="ident" id="3611499">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611506">i</span><span class="op" id="3611507">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611524">decls</span>&nbsp;<span class="op" id="3611530">=</span>&nbsp;<span class="ident" id="3611532">decls</span><span class="op" id="3611537">[</span><span class="num" id="3611538">0</span><span class="op" id="3611539">:</span><span class="ident" id="3611540">i</span><span class="op" id="3611541">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3611548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611552">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611601">var</span>&nbsp;<span class="ident" id="3611605">imports</span>&nbsp;<span class="op" id="3611613">[</span><span class="op" id="3611614">]</span><span class="op" id="3611615">*</span><span class="ident" id="3611616">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611628">if</span>&nbsp;<span class="ident" id="3611631">mode</span><span class="op" id="3611635">&amp;</span><span class="ident" id="3611636">FilterImportDuplicates</span>&nbsp;<span class="op" id="3611659">!=</span>&nbsp;<span class="num" id="3611662">0</span>&nbsp;<span class="op" id="3611664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611668">seen</span>&nbsp;<span class="op" id="3611673">:=</span>&nbsp;<span class="builtinfunc" id="3611676">make</span><span class="op" id="3611680">(</span><span class="keyword" id="3611681">map</span><span class="op" id="3611684">[</span><span class="builtintype" id="3611685">string</span><span class="op" id="3611691">]</span><span class="builtintype" id="3611692">bool</span><span class="op" id="3611696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611700">for</span>&nbsp;<span class="ident" id="3611704">_</span><span class="op" id="3611705">,</span>&nbsp;<span class="ident" id="3611707">filename</span>&nbsp;<span class="op" id="3611716">:=</span>&nbsp;<span class="keyword" id="3611719">range</span>&nbsp;<span class="ident" id="3611725">filenames</span>&nbsp;<span class="op" id="3611735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3611740">f</span>&nbsp;<span class="op" id="3611742">:=</span>&nbsp;<span class="ident" id="3611745">pkg</span><span class="op" id="3611748">.</span><span class="ident" id="3611749">Files</span><span class="op" id="3611754">[</span><span class="ident" id="3611755">filename</span><span class="op" id="3611763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611768">for</span>&nbsp;<span class="ident" id="3611772">_</span><span class="op" id="3611773">,</span>&nbsp;<span class="ident" id="3611775">imp</span>&nbsp;<span class="op" id="3611779">:=</span>&nbsp;<span class="keyword" id="3611782">range</span>&nbsp;<span class="ident" id="3611788">f</span><span class="op" id="3611789">.</span><span class="ident" id="3611790">Imports</span>&nbsp;<span class="op" id="3611798">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3611804">if</span>&nbsp;<span class="ident" id="3611807">path</span>&nbsp;<span class="op" id="3611812">:=</span>&nbsp;<span class="ident" id="3611815">imp</span><span class="op" id="3611818">.</span><span class="ident" id="3611819">Path</span><span class="op" id="3611823">.</span><span class="ident" id="3611824">Value</span><span class="op" id="3611829">;</span>&nbsp;<span class="op" id="3611831">!</span><span class="ident" id="3611832">seen</span><span class="op" id="3611836">[</span><span class="ident" id="3611837">path</span><span class="op" id="3611841">]</span>&nbsp;<span class="op" id="3611843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611850">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611895">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3611951">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3612009">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3612038">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3612091">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3612146">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3612176">imports</span>&nbsp;<span class="op" id="3612184">=</span>&nbsp;<span class="builtinfunc" id="3612186">append</span><span class="op" id="3612192">(</span><span class="ident" id="3612193">imports</span><span class="op" id="3612200">,</span>&nbsp;<span class="ident" id="3612202">imp</span><span class="op" id="3612205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3612212">seen</span><span class="op" id="3612216">[</span><span class="ident" id="3612217">path</span><span class="op" id="3612221">]</span>&nbsp;<span class="op" id="3612223">=</span>&nbsp;<span class="builtintype" id="3612225">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612246">}</span>&nbsp;<span class="keyword" id="3612248">else</span>&nbsp;<span class="op" id="3612253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3612257">for</span>&nbsp;<span class="ident" id="3612261">_</span><span class="op" id="3612262">,</span>&nbsp;<span class="ident" id="3612264">f</span>&nbsp;<span class="op" id="3612266">:=</span>&nbsp;<span class="keyword" id="3612269">range</span>&nbsp;<span class="ident" id="3612275">pkg</span><span class="op" id="3612278">.</span><span class="ident" id="3612279">Files</span>&nbsp;<span class="op" id="3612285">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3612290">imports</span>&nbsp;<span class="op" id="3612298">=</span>&nbsp;<span class="builtinfunc" id="3612300">append</span><span class="op" id="3612306">(</span><span class="ident" id="3612307">imports</span><span class="op" id="3612314">,</span>&nbsp;<span class="ident" id="3612316">f</span><span class="op" id="3612317">.</span><span class="ident" id="3612318">Imports</span><span class="op" id="3612325">...</span><span class="op" id="3612328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3612339">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3612384">var</span>&nbsp;<span class="ident" id="3612388">comments</span>&nbsp;<span class="op" id="3612397">[</span><span class="op" id="3612398">]</span><span class="op" id="3612399">*</span><span class="ident" id="3612400">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3612414">if</span>&nbsp;<span class="ident" id="3612417">mode</span><span class="op" id="3612421">&amp;</span><span class="ident" id="3612422">FilterUnassociatedComments</span>&nbsp;<span class="op" id="3612449">==</span>&nbsp;<span class="num" id="3612452">0</span>&nbsp;<span class="op" id="3612454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3612458">comments</span>&nbsp;<span class="op" id="3612467">=</span>&nbsp;<span class="builtinfunc" id="3612469">make</span><span class="op" id="3612473">(</span><span class="op" id="3612474">[</span><span class="op" id="3612475">]</span><span class="op" id="3612476">*</span><span class="ident" id="3612477">CommentGroup</span><span class="op" id="3612489">,</span>&nbsp;<span class="ident" id="3612491">ncomments</span><span class="op" id="3612500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3612504">i</span>&nbsp;<span class="op" id="3612506">:=</span>&nbsp;<span class="num" id="3612509">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3612513">for</span>&nbsp;<span class="ident" id="3612517">_</span><span class="op" id="3612518">,</span>&nbsp;<span class="ident" id="3612520">f</span>&nbsp;<span class="op" id="3612522">:=</span>&nbsp;<span class="keyword" id="3612525">range</span>&nbsp;<span class="ident" id="3612531">pkg</span><span class="op" id="3612534">.</span><span class="ident" id="3612535">Files</span>&nbsp;<span class="op" id="3612541">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3612546">i</span>&nbsp;<span class="op" id="3612548">+=</span>&nbsp;<span class="builtinfunc" id="3612551">copy</span><span class="op" id="3612555">(</span><span class="ident" id="3612556">comments</span><span class="op" id="3612564">[</span><span class="ident" id="3612565">i</span><span class="op" id="3612566">:</span><span class="op" id="3612567">]</span><span class="op" id="3612568">,</span>&nbsp;<span class="ident" id="3612570">f</span><span class="op" id="3612571">.</span><span class="ident" id="3612572">Comments</span><span class="op" id="3612580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3612587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3612591">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3612645">return</span>&nbsp;<span class="op" id="3612652">&amp;</span><span class="ident" id="3612653">File</span><span class="op" id="3612657">{</span><span class="ident" id="3612658">doc</span><span class="op" id="3612661">,</span>&nbsp;<span class="ident" id="3612663">pos</span><span class="op" id="3612666">,</span>&nbsp;<span class="ident" id="3612668">NewIdent</span><span class="op" id="3612676">(</span><span class="ident" id="3612677">pkg</span><span class="op" id="3612680">.</span><span class="ident" id="3612681">Name</span><span class="op" id="3612685">)</span><span class="op" id="3612686">,</span>&nbsp;<span class="ident" id="3612688">decls</span><span class="op" id="3612693">,</span>&nbsp;<span class="ident" id="3612695">pkg</span><span class="op" id="3612698">.</span><span class="ident" id="3612699">Scope</span><span class="op" id="3612704">,</span>&nbsp;<span class="ident" id="3612706">imports</span><span class="op" id="3612713">,</span>&nbsp;<span class="ident" id="3612715">nil</span><span class="op" id="3612718">,</span>&nbsp;<span class="ident" id="3612720">comments</span><span class="op" id="3612728">}</span><br>
<span class="lineno"></span><span class="op" id="3612730">}</span>
</div>
</body>
</html>
