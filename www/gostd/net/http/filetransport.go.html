<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2992155">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2992210">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2992264">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2992315">package</span>&nbsp;<span class="ident" id="2992323">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2992329">import</span>&nbsp;<span class="op" id="2992336">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2992339">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2992346">&#34;io&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2992351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992354">//&nbsp;fileTransport&nbsp;implements&nbsp;RoundTripper&nbsp;for&nbsp;the&nbsp;&#39;file&#39;&nbsp;protocol.</span><br>
<span class="lineno"></span><span class="keyword" id="2992420">type</span>&nbsp;<span class="ident" id="2992425">fileTransport</span>&nbsp;<span class="keyword" id="2992439">struct</span>&nbsp;<span class="op" id="2992446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2992449">fh</span>&nbsp;<span class="ident" id="2992452">fileHandler</span><br>
<span class="lineno">15</span><span class="op" id="2992464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2992467">//&nbsp;NewFileTransport&nbsp;returns&nbsp;a&nbsp;new&nbsp;RoundTripper,&nbsp;serving&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="2992536">//&nbsp;FileSystem.&nbsp;The&nbsp;returned&nbsp;RoundTripper&nbsp;ignores&nbsp;the&nbsp;URL&nbsp;host&nbsp;in&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="2992605">//&nbsp;incoming&nbsp;requests,&nbsp;as&nbsp;well&nbsp;as&nbsp;most&nbsp;other&nbsp;properties&nbsp;of&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="2992667">//&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="2992679">//</span><br>
<span class="lineno"></span><span class="comment" id="2992682">//&nbsp;The&nbsp;typical&nbsp;use&nbsp;case&nbsp;for&nbsp;NewFileTransport&nbsp;is&nbsp;to&nbsp;register&nbsp;the&nbsp;&#34;file&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2992753">//&nbsp;protocol&nbsp;with&nbsp;a&nbsp;Transport,&nbsp;as&nbsp;in:</span><br>
<span class="lineno"></span><span class="comment" id="2992790">//</span><br>
<span class="lineno">25</span><span class="comment" id="2992793">//&nbsp;&nbsp;&nbsp;t&nbsp;:=&nbsp;&amp;http.Transport{}</span><br>
<span class="lineno"></span><span class="comment" id="2992821">//&nbsp;&nbsp;&nbsp;t.RegisterProtocol(&#34;file&#34;,&nbsp;http.NewFileTransport(http.Dir(&#34;/&#34;)))</span><br>
<span class="lineno"></span><span class="comment" id="2992891">//&nbsp;&nbsp;&nbsp;c&nbsp;:=&nbsp;&amp;http.Client{Transport:&nbsp;t}</span><br>
<span class="lineno"></span><span class="comment" id="2992928">//&nbsp;&nbsp;&nbsp;res,&nbsp;err&nbsp;:=&nbsp;c.Get(&#34;file:///etc/passwd&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2992973">//&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno">30</span><span class="keyword" id="2992982">func</span>&nbsp;<span class="ident" id="2992987">NewFileTransport</span><span class="op" id="2993003">(</span><span class="ident" id="2993004">fs</span>&nbsp;<span class="ident" id="2993007">FileSystem</span><span class="op" id="2993017">)</span>&nbsp;<span class="ident" id="2993019">RoundTripper</span>&nbsp;<span class="op" id="2993032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2993035">return</span>&nbsp;<span class="ident" id="2993042">fileTransport</span><span class="op" id="2993055">{</span><span class="ident" id="2993056">fileHandler</span><span class="op" id="2993067">{</span><span class="ident" id="2993068">fs</span><span class="op" id="2993070">}</span><span class="op" id="2993071">}</span><br>
<span class="lineno"></span><span class="op" id="2993073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2993076">func</span>&nbsp;<span class="op" id="2993081">(</span><span class="ident" id="2993082">t</span>&nbsp;<span class="ident" id="2993084">fileTransport</span><span class="op" id="2993097">)</span>&nbsp;<span class="ident" id="2993099">RoundTrip</span><span class="op" id="2993108">(</span><span class="ident" id="2993109">req</span>&nbsp;<span class="op" id="2993113">*</span><span class="ident" id="2993114">Request</span><span class="op" id="2993121">)</span>&nbsp;<span class="op" id="2993123">(</span><span class="ident" id="2993124">resp</span>&nbsp;<span class="op" id="2993129">*</span><span class="ident" id="2993130">Response</span><span class="op" id="2993138">,</span>&nbsp;<span class="ident" id="2993140">err</span>&nbsp;<span class="builtintype" id="2993144">error</span><span class="op" id="2993149">)</span>&nbsp;<span class="op" id="2993151">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993154">//&nbsp;We&nbsp;start&nbsp;ServeHTTP&nbsp;in&nbsp;a&nbsp;goroutine,&nbsp;which&nbsp;may&nbsp;take&nbsp;a&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993215">//&nbsp;time&nbsp;if&nbsp;the&nbsp;file&nbsp;is&nbsp;large.&nbsp;&nbsp;The&nbsp;newPopulateResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993277">//&nbsp;call&nbsp;returns&nbsp;a&nbsp;channel&nbsp;which&nbsp;either&nbsp;ServeHTTP&nbsp;or&nbsp;finish()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993339">//&nbsp;sends&nbsp;our&nbsp;*Response&nbsp;on,&nbsp;once&nbsp;the&nbsp;*Response&nbsp;itself&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993402">//&nbsp;populated&nbsp;(even&nbsp;if&nbsp;the&nbsp;body&nbsp;itself&nbsp;is&nbsp;still&nbsp;being</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2993456">//&nbsp;written&nbsp;to&nbsp;the&nbsp;res.Body,&nbsp;a&nbsp;pipe)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993493">rw</span><span class="op" id="2993495">,</span>&nbsp;<span class="ident" id="2993497">resc</span>&nbsp;<span class="op" id="2993502">:=</span>&nbsp;<span class="ident" id="2993505">newPopulateResponseWriter</span><span class="op" id="2993530">(</span><span class="op" id="2993531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2993534">go</span>&nbsp;<span class="keyword" id="2993537">func</span><span class="op" id="2993541">(</span><span class="op" id="2993542">)</span>&nbsp;<span class="op" id="2993544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993548">t</span><span class="op" id="2993549">.</span><span class="ident" id="2993550">fh</span><span class="op" id="2993552">.</span><span class="ident" id="2993553">ServeHTTP</span><span class="op" id="2993562">(</span><span class="ident" id="2993563">rw</span><span class="op" id="2993565">,</span>&nbsp;<span class="ident" id="2993567">req</span><span class="op" id="2993570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993574">rw</span><span class="op" id="2993576">.</span><span class="ident" id="2993577">finish</span><span class="op" id="2993583">(</span><span class="op" id="2993584">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2993587">}</span><span class="op" id="2993588">(</span><span class="op" id="2993589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2993592">return</span>&nbsp;<span class="op" id="2993599">&lt;-</span><span class="ident" id="2993601">resc</span><span class="op" id="2993605">,</span>&nbsp;<span class="ident" id="2993607">nil</span><br>
<span class="lineno"></span><span class="op" id="2993611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2993614">func</span>&nbsp;<span class="ident" id="2993619">newPopulateResponseWriter</span><span class="op" id="2993644">(</span><span class="op" id="2993645">)</span>&nbsp;<span class="op" id="2993647">(</span><span class="op" id="2993648">*</span><span class="ident" id="2993649">populateResponse</span><span class="op" id="2993665">,</span>&nbsp;<span class="op" id="2993667">&lt;-</span><span class="keyword" id="2993669">chan</span>&nbsp;<span class="op" id="2993674">*</span><span class="ident" id="2993675">Response</span><span class="op" id="2993683">)</span>&nbsp;<span class="op" id="2993685">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993688">pr</span><span class="op" id="2993690">,</span>&nbsp;<span class="ident" id="2993692">pw</span>&nbsp;<span class="op" id="2993695">:=</span>&nbsp;<span class="ident" id="2993698">io</span><span class="op" id="2993700">.</span><span class="ident" id="2993701">Pipe</span><span class="op" id="2993705">(</span><span class="op" id="2993706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993709">rw</span>&nbsp;<span class="op" id="2993712">:=</span>&nbsp;<span class="op" id="2993715">&amp;</span><span class="ident" id="2993716">populateResponse</span><span class="op" id="2993732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993736">ch</span><span class="op" id="2993738">:</span>&nbsp;<span class="builtinfunc" id="2993740">make</span><span class="op" id="2993744">(</span><span class="keyword" id="2993745">chan</span>&nbsp;<span class="op" id="2993750">*</span><span class="ident" id="2993751">Response</span><span class="op" id="2993759">)</span><span class="op" id="2993760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993764">pw</span><span class="op" id="2993766">:</span>&nbsp;<span class="ident" id="2993768">pw</span><span class="op" id="2993770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993774">res</span><span class="op" id="2993777">:</span>&nbsp;<span class="op" id="2993779">&amp;</span><span class="ident" id="2993780">Response</span><span class="op" id="2993788">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993793">Proto</span><span class="op" id="2993798">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2993805">&#34;HTTP/1.0&#34;</span><span class="op" id="2993815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993820">ProtoMajor</span><span class="op" id="2993830">:</span>&nbsp;<span class="num" id="2993832">1</span><span class="op" id="2993833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993838">Header</span><span class="op" id="2993844">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2993850">make</span><span class="op" id="2993854">(</span><span class="ident" id="2993855">Header</span><span class="op" id="2993861">)</span><span class="op" id="2993862">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993867">Close</span><span class="op" id="2993872">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2993879">true</span><span class="op" id="2993883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2993888">Body</span><span class="op" id="2993892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2993900">pr</span><span class="op" id="2993902">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2993906">}</span><span class="op" id="2993907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2993910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2993913">return</span>&nbsp;<span class="ident" id="2993920">rw</span><span class="op" id="2993922">,</span>&nbsp;<span class="ident" id="2993924">rw</span><span class="op" id="2993926">.</span><span class="ident" id="2993927">ch</span><br>
<span class="lineno"></span><span class="op" id="2993930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="2993933">//&nbsp;populateResponse&nbsp;is&nbsp;a&nbsp;ResponseWriter&nbsp;that&nbsp;populates&nbsp;the&nbsp;*Response</span><br>
<span class="lineno"></span><span class="comment" id="2994002">//&nbsp;in&nbsp;res,&nbsp;and&nbsp;writes&nbsp;its&nbsp;body&nbsp;to&nbsp;a&nbsp;pipe&nbsp;connected&nbsp;to&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="comment" id="2994069">//&nbsp;body.&nbsp;Once&nbsp;writes&nbsp;begin&nbsp;or&nbsp;finish()&nbsp;is&nbsp;called,&nbsp;the&nbsp;response&nbsp;is&nbsp;sent</span><br>
<span class="lineno"></span><span class="comment" id="2994140">//&nbsp;on&nbsp;ch.</span><br>
<span class="lineno"></span><span class="keyword" id="2994150">type</span>&nbsp;<span class="ident" id="2994155">populateResponse</span>&nbsp;<span class="keyword" id="2994172">struct</span>&nbsp;<span class="op" id="2994179">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994182">res</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994195">*</span><span class="ident" id="2994196">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994206">ch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2994219">chan</span>&nbsp;<span class="op" id="2994224">*</span><span class="ident" id="2994225">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994235">wroteHeader</span>&nbsp;&nbsp;<span class="builtintype" id="2994248">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994254">hasContent</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2994267">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994273">sentResponse</span>&nbsp;<span class="builtintype" id="2994286">bool</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994292">pw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2994305">*</span><span class="ident" id="2994306">io</span><span class="op" id="2994308">.</span><span class="ident" id="2994309">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="2994320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2994323">func</span>&nbsp;<span class="op" id="2994328">(</span><span class="ident" id="2994329">pr</span>&nbsp;<span class="op" id="2994332">*</span><span class="ident" id="2994333">populateResponse</span><span class="op" id="2994349">)</span>&nbsp;<span class="ident" id="2994351">finish</span><span class="op" id="2994357">(</span><span class="op" id="2994358">)</span>&nbsp;<span class="op" id="2994360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994363">if</span>&nbsp;<span class="op" id="2994366">!</span><span class="ident" id="2994367">pr</span><span class="op" id="2994369">.</span><span class="ident" id="2994370">wroteHeader</span>&nbsp;<span class="op" id="2994382">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994386">pr</span><span class="op" id="2994388">.</span><span class="ident" id="2994389">WriteHeader</span><span class="op" id="2994400">(</span><span class="num" id="2994401">500</span><span class="op" id="2994404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994410">if</span>&nbsp;<span class="op" id="2994413">!</span><span class="ident" id="2994414">pr</span><span class="op" id="2994416">.</span><span class="ident" id="2994417">sentResponse</span>&nbsp;<span class="op" id="2994430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994434">pr</span><span class="op" id="2994436">.</span><span class="ident" id="2994437">sendResponse</span><span class="op" id="2994449">(</span><span class="op" id="2994450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994453">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994456">pr</span><span class="op" id="2994458">.</span><span class="ident" id="2994459">pw</span><span class="op" id="2994461">.</span><span class="ident" id="2994462">Close</span><span class="op" id="2994467">(</span><span class="op" id="2994468">)</span><br>
<span class="lineno"></span><span class="op" id="2994470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2994473">func</span>&nbsp;<span class="op" id="2994478">(</span><span class="ident" id="2994479">pr</span>&nbsp;<span class="op" id="2994482">*</span><span class="ident" id="2994483">populateResponse</span><span class="op" id="2994499">)</span>&nbsp;<span class="ident" id="2994501">sendResponse</span><span class="op" id="2994513">(</span><span class="op" id="2994514">)</span>&nbsp;<span class="op" id="2994516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994519">if</span>&nbsp;<span class="ident" id="2994522">pr</span><span class="op" id="2994524">.</span><span class="ident" id="2994525">sentResponse</span>&nbsp;<span class="op" id="2994538">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994542">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994553">pr</span><span class="op" id="2994555">.</span><span class="ident" id="2994556">sentResponse</span>&nbsp;<span class="op" id="2994569">=</span>&nbsp;<span class="builtintype" id="2994571">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994578">if</span>&nbsp;<span class="ident" id="2994581">pr</span><span class="op" id="2994583">.</span><span class="ident" id="2994584">hasContent</span>&nbsp;<span class="op" id="2994595">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994599">pr</span><span class="op" id="2994601">.</span><span class="ident" id="2994602">res</span><span class="op" id="2994605">.</span><span class="ident" id="2994606">ContentLength</span>&nbsp;<span class="op" id="2994620">=</span>&nbsp;<span class="op" id="2994622">-</span><span class="num" id="2994623">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994629">pr</span><span class="op" id="2994631">.</span><span class="ident" id="2994632">ch</span>&nbsp;<span class="op" id="2994635">&lt;-</span>&nbsp;<span class="ident" id="2994638">pr</span><span class="op" id="2994640">.</span><span class="ident" id="2994641">res</span><br>
<span class="lineno"></span><span class="op" id="2994645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="2994648">func</span>&nbsp;<span class="op" id="2994653">(</span><span class="ident" id="2994654">pr</span>&nbsp;<span class="op" id="2994657">*</span><span class="ident" id="2994658">populateResponse</span><span class="op" id="2994674">)</span>&nbsp;<span class="ident" id="2994676">Header</span><span class="op" id="2994682">(</span><span class="op" id="2994683">)</span>&nbsp;<span class="ident" id="2994685">Header</span>&nbsp;<span class="op" id="2994692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994695">return</span>&nbsp;<span class="ident" id="2994702">pr</span><span class="op" id="2994704">.</span><span class="ident" id="2994705">res</span><span class="op" id="2994708">.</span><span class="ident" id="2994709">Header</span><br>
<span class="lineno"></span><span class="op" id="2994716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2994719">func</span>&nbsp;<span class="op" id="2994724">(</span><span class="ident" id="2994725">pr</span>&nbsp;<span class="op" id="2994728">*</span><span class="ident" id="2994729">populateResponse</span><span class="op" id="2994745">)</span>&nbsp;<span class="ident" id="2994747">WriteHeader</span><span class="op" id="2994758">(</span><span class="ident" id="2994759">code</span>&nbsp;<span class="builtintype" id="2994764">int</span><span class="op" id="2994767">)</span>&nbsp;<span class="op" id="2994769">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994772">if</span>&nbsp;<span class="ident" id="2994775">pr</span><span class="op" id="2994777">.</span><span class="ident" id="2994778">wroteHeader</span>&nbsp;<span class="op" id="2994790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994794">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2994802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994805">pr</span><span class="op" id="2994807">.</span><span class="ident" id="2994808">wroteHeader</span>&nbsp;<span class="op" id="2994820">=</span>&nbsp;<span class="builtintype" id="2994822">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994829">pr</span><span class="op" id="2994831">.</span><span class="ident" id="2994832">res</span><span class="op" id="2994835">.</span><span class="ident" id="2994836">StatusCode</span>&nbsp;<span class="op" id="2994847">=</span>&nbsp;<span class="ident" id="2994849">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2994855">pr</span><span class="op" id="2994857">.</span><span class="ident" id="2994858">res</span><span class="op" id="2994861">.</span><span class="ident" id="2994862">Status</span>&nbsp;<span class="op" id="2994869">=</span>&nbsp;<span class="ident" id="2994871">fmt</span><span class="op" id="2994874">.</span><span class="ident" id="2994875">Sprintf</span><span class="op" id="2994882">(</span><span class="string" id="2994883">&#34;%d&nbsp;%s&#34;</span><span class="op" id="2994890">,</span>&nbsp;<span class="ident" id="2994892">code</span><span class="op" id="2994896">,</span>&nbsp;<span class="ident" id="2994898">StatusText</span><span class="op" id="2994908">(</span><span class="ident" id="2994909">code</span><span class="op" id="2994913">)</span><span class="op" id="2994914">)</span><br>
<span class="lineno"></span><span class="op" id="2994916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2994919">func</span>&nbsp;<span class="op" id="2994924">(</span><span class="ident" id="2994925">pr</span>&nbsp;<span class="op" id="2994928">*</span><span class="ident" id="2994929">populateResponse</span><span class="op" id="2994945">)</span>&nbsp;<span class="ident" id="2994947">Write</span><span class="op" id="2994952">(</span><span class="ident" id="2994953">p</span>&nbsp;<span class="op" id="2994955">[</span><span class="op" id="2994956">]</span><span class="builtintype" id="2994957">byte</span><span class="op" id="2994961">)</span>&nbsp;<span class="op" id="2994963">(</span><span class="ident" id="2994964">n</span>&nbsp;<span class="builtintype" id="2994966">int</span><span class="op" id="2994969">,</span>&nbsp;<span class="ident" id="2994971">err</span>&nbsp;<span class="builtintype" id="2994975">error</span><span class="op" id="2994980">)</span>&nbsp;<span class="op" id="2994982">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2994985">if</span>&nbsp;<span class="op" id="2994988">!</span><span class="ident" id="2994989">pr</span><span class="op" id="2994991">.</span><span class="ident" id="2994992">wroteHeader</span>&nbsp;<span class="op" id="2995004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995008">pr</span><span class="op" id="2995010">.</span><span class="ident" id="2995011">WriteHeader</span><span class="op" id="2995022">(</span><span class="ident" id="2995023">StatusOK</span><span class="op" id="2995031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995037">pr</span><span class="op" id="2995039">.</span><span class="ident" id="2995040">hasContent</span>&nbsp;<span class="op" id="2995051">=</span>&nbsp;<span class="builtintype" id="2995053">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995059">if</span>&nbsp;<span class="op" id="2995062">!</span><span class="ident" id="2995063">pr</span><span class="op" id="2995065">.</span><span class="ident" id="2995066">sentResponse</span>&nbsp;<span class="op" id="2995079">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2995083">pr</span><span class="op" id="2995085">.</span><span class="ident" id="2995086">sendResponse</span><span class="op" id="2995098">(</span><span class="op" id="2995099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2995102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2995105">return</span>&nbsp;<span class="ident" id="2995112">pr</span><span class="op" id="2995114">.</span><span class="ident" id="2995115">pw</span><span class="op" id="2995117">.</span><span class="ident" id="2995118">Write</span><span class="op" id="2995123">(</span><span class="ident" id="2995124">p</span><span class="op" id="2995125">)</span><br>
<span class="lineno"></span><span class="op" id="2995127">}</span>
</div>
</body>
</html>
