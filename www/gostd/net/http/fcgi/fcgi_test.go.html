<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/fcgi</h2>
<ul>
<li><a href="/gostd/net/http/fcgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi.go.html">fcgi.go</a></li>
<li><a href="/gostd/net/http/fcgi/fcgi_test.go.html">fcgi_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7027117">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7027172">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7027226">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7027277">package</span>&nbsp;<span class="ident" id="7027285">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7027291">import</span>&nbsp;<span class="op" id="7027298">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7027301">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7027310">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7027320">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7027326">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7027336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7027339">var</span>&nbsp;<span class="ident" id="7027343">sizeTests</span>&nbsp;<span class="op" id="7027353">=</span>&nbsp;<span class="op" id="7027355">[</span><span class="op" id="7027356">]</span><span class="keyword" id="7027357">struct</span>&nbsp;<span class="op" id="7027364">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027367">size</span>&nbsp;&nbsp;<span class="builtintype" id="7027373">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027381">bytes</span>&nbsp;<span class="op" id="7027387">[</span><span class="op" id="7027388">]</span><span class="builtintype" id="7027389">byte</span><br>
<span class="lineno"></span><span class="op" id="7027394">}</span><span class="op" id="7027395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027398">{</span><span class="num" id="7027399">0</span><span class="op" id="7027400">,</span>&nbsp;<span class="op" id="7027402">[</span><span class="op" id="7027403">]</span><span class="builtintype" id="7027404">byte</span><span class="op" id="7027408">{</span><span class="num" id="7027409">0x00</span><span class="op" id="7027413">}</span><span class="op" id="7027414">}</span><span class="op" id="7027415">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027418">{</span><span class="num" id="7027419">127</span><span class="op" id="7027422">,</span>&nbsp;<span class="op" id="7027424">[</span><span class="op" id="7027425">]</span><span class="builtintype" id="7027426">byte</span><span class="op" id="7027430">{</span><span class="num" id="7027431">0x7F</span><span class="op" id="7027435">}</span><span class="op" id="7027436">}</span><span class="op" id="7027437">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027440">{</span><span class="num" id="7027441">128</span><span class="op" id="7027444">,</span>&nbsp;<span class="op" id="7027446">[</span><span class="op" id="7027447">]</span><span class="builtintype" id="7027448">byte</span><span class="op" id="7027452">{</span><span class="num" id="7027453">0x80</span><span class="op" id="7027457">,</span>&nbsp;<span class="num" id="7027459">0x00</span><span class="op" id="7027463">,</span>&nbsp;<span class="num" id="7027465">0x00</span><span class="op" id="7027469">,</span>&nbsp;<span class="num" id="7027471">0x80</span><span class="op" id="7027475">}</span><span class="op" id="7027476">}</span><span class="op" id="7027477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027480">{</span><span class="num" id="7027481">1000</span><span class="op" id="7027485">,</span>&nbsp;<span class="op" id="7027487">[</span><span class="op" id="7027488">]</span><span class="builtintype" id="7027489">byte</span><span class="op" id="7027493">{</span><span class="num" id="7027494">0x80</span><span class="op" id="7027498">,</span>&nbsp;<span class="num" id="7027500">0x00</span><span class="op" id="7027504">,</span>&nbsp;<span class="num" id="7027506">0x03</span><span class="op" id="7027510">,</span>&nbsp;<span class="num" id="7027512">0xE8</span><span class="op" id="7027516">}</span><span class="op" id="7027517">}</span><span class="op" id="7027518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027521">{</span><span class="num" id="7027522">33554431</span><span class="op" id="7027530">,</span>&nbsp;<span class="op" id="7027532">[</span><span class="op" id="7027533">]</span><span class="builtintype" id="7027534">byte</span><span class="op" id="7027538">{</span><span class="num" id="7027539">0x81</span><span class="op" id="7027543">,</span>&nbsp;<span class="num" id="7027545">0xFF</span><span class="op" id="7027549">,</span>&nbsp;<span class="num" id="7027551">0xFF</span><span class="op" id="7027555">,</span>&nbsp;<span class="num" id="7027557">0xFF</span><span class="op" id="7027561">}</span><span class="op" id="7027562">}</span><span class="op" id="7027563">,</span><br>
<span class="lineno"></span><span class="op" id="7027565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7027568">func</span>&nbsp;<span class="ident" id="7027573">TestSize</span><span class="op" id="7027581">(</span><span class="ident" id="7027582">t</span>&nbsp;<span class="op" id="7027584">*</span><span class="ident" id="7027585">testing</span><span class="op" id="7027592">.</span><span class="ident" id="7027593">T</span><span class="op" id="7027594">)</span>&nbsp;<span class="op" id="7027596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027599">b</span>&nbsp;<span class="op" id="7027601">:=</span>&nbsp;<span class="builtinfunc" id="7027604">make</span><span class="op" id="7027608">(</span><span class="op" id="7027609">[</span><span class="op" id="7027610">]</span><span class="builtintype" id="7027611">byte</span><span class="op" id="7027615">,</span>&nbsp;<span class="num" id="7027617">4</span><span class="op" id="7027618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027621">for</span>&nbsp;<span class="ident" id="7027625">i</span><span class="op" id="7027626">,</span>&nbsp;<span class="ident" id="7027628">test</span>&nbsp;<span class="op" id="7027633">:=</span>&nbsp;<span class="keyword" id="7027636">range</span>&nbsp;<span class="ident" id="7027642">sizeTests</span>&nbsp;<span class="op" id="7027652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027656">n</span>&nbsp;<span class="op" id="7027658">:=</span>&nbsp;<span class="ident" id="7027661">encodeSize</span><span class="op" id="7027671">(</span><span class="ident" id="7027672">b</span><span class="op" id="7027673">,</span>&nbsp;<span class="ident" id="7027675">test</span><span class="op" id="7027679">.</span><span class="ident" id="7027680">size</span><span class="op" id="7027684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027688">if</span>&nbsp;<span class="op" id="7027691">!</span><span class="ident" id="7027692">bytes</span><span class="op" id="7027697">.</span><span class="ident" id="7027698">Equal</span><span class="op" id="7027703">(</span><span class="ident" id="7027704">b</span><span class="op" id="7027705">[</span><span class="op" id="7027706">:</span><span class="ident" id="7027707">n</span><span class="op" id="7027708">]</span><span class="op" id="7027709">,</span>&nbsp;<span class="ident" id="7027711">test</span><span class="op" id="7027715">.</span><span class="ident" id="7027716">bytes</span><span class="op" id="7027721">)</span>&nbsp;<span class="op" id="7027723">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027728">t</span><span class="op" id="7027729">.</span><span class="ident" id="7027730">Errorf</span><span class="op" id="7027736">(</span><span class="string" id="7027737">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="7027765">,</span>&nbsp;<span class="ident" id="7027767">i</span><span class="op" id="7027768">,</span>&nbsp;<span class="ident" id="7027770">test</span><span class="op" id="7027774">.</span><span class="ident" id="7027775">bytes</span><span class="op" id="7027780">,</span>&nbsp;<span class="ident" id="7027782">b</span><span class="op" id="7027783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027791">size</span><span class="op" id="7027795">,</span>&nbsp;<span class="ident" id="7027797">n</span>&nbsp;<span class="op" id="7027799">:=</span>&nbsp;<span class="ident" id="7027802">readSize</span><span class="op" id="7027810">(</span><span class="ident" id="7027811">test</span><span class="op" id="7027815">.</span><span class="ident" id="7027816">bytes</span><span class="op" id="7027821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027825">if</span>&nbsp;<span class="ident" id="7027828">size</span>&nbsp;<span class="op" id="7027833">!=</span>&nbsp;<span class="ident" id="7027836">test</span><span class="op" id="7027840">.</span><span class="ident" id="7027841">size</span>&nbsp;<span class="op" id="7027846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027851">t</span><span class="op" id="7027852">.</span><span class="ident" id="7027853">Errorf</span><span class="op" id="7027859">(</span><span class="string" id="7027860">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="7027885">,</span>&nbsp;<span class="ident" id="7027887">i</span><span class="op" id="7027888">,</span>&nbsp;<span class="ident" id="7027890">test</span><span class="op" id="7027894">.</span><span class="ident" id="7027895">size</span><span class="op" id="7027899">,</span>&nbsp;<span class="ident" id="7027901">size</span><span class="op" id="7027905">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7027913">if</span>&nbsp;<span class="builtinfunc" id="7027916">len</span><span class="op" id="7027919">(</span><span class="ident" id="7027920">test</span><span class="op" id="7027924">.</span><span class="ident" id="7027925">bytes</span><span class="op" id="7027930">)</span>&nbsp;<span class="op" id="7027932">!=</span>&nbsp;<span class="ident" id="7027935">n</span>&nbsp;<span class="op" id="7027937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7027942">t</span><span class="op" id="7027943">.</span><span class="ident" id="7027944">Errorf</span><span class="op" id="7027950">(</span><span class="string" id="7027951">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="7027985">,</span>&nbsp;<span class="ident" id="7027987">i</span><span class="op" id="7027988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7027995">}</span><br>
<span class="lineno">40</span><span class="op" id="7027997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028000">var</span>&nbsp;<span class="ident" id="7028004">streamTests</span>&nbsp;<span class="op" id="7028016">=</span>&nbsp;<span class="op" id="7028018">[</span><span class="op" id="7028019">]</span><span class="keyword" id="7028020">struct</span>&nbsp;<span class="op" id="7028027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028030">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7028038">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028046">recType</span>&nbsp;<span class="ident" id="7028054">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028063">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7028071">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028079">content</span>&nbsp;<span class="op" id="7028087">[</span><span class="op" id="7028088">]</span><span class="builtintype" id="7028089">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028095">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7028103">[</span><span class="op" id="7028104">]</span><span class="builtintype" id="7028105">byte</span><br>
<span class="lineno"></span><span class="op" id="7028110">}</span><span class="op" id="7028111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028114">{</span><span class="string" id="7028115">&#34;single&nbsp;record&#34;</span><span class="op" id="7028130">,</span>&nbsp;<span class="ident" id="7028132">typeStdout</span><span class="op" id="7028142">,</span>&nbsp;<span class="num" id="7028144">1</span><span class="op" id="7028145">,</span>&nbsp;<span class="ident" id="7028147">nil</span><span class="op" id="7028150">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028154">[</span><span class="op" id="7028155">]</span><span class="builtintype" id="7028156">byte</span><span class="op" id="7028160">{</span><span class="num" id="7028161">1</span><span class="op" id="7028162">,</span>&nbsp;<span class="builtintype" id="7028164">byte</span><span class="op" id="7028168">(</span><span class="ident" id="7028169">typeStdout</span><span class="op" id="7028179">)</span><span class="op" id="7028180">,</span>&nbsp;<span class="num" id="7028182">0</span><span class="op" id="7028183">,</span>&nbsp;<span class="num" id="7028185">1</span><span class="op" id="7028186">,</span>&nbsp;<span class="num" id="7028188">0</span><span class="op" id="7028189">,</span>&nbsp;<span class="num" id="7028191">0</span><span class="op" id="7028192">,</span>&nbsp;<span class="num" id="7028194">0</span><span class="op" id="7028195">,</span>&nbsp;<span class="num" id="7028197">0</span><span class="op" id="7028198">}</span><span class="op" id="7028199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028202">}</span><span class="op" id="7028203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7028206">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028259">{</span><span class="string" id="7028260">&#34;two&nbsp;records&#34;</span><span class="op" id="7028273">,</span>&nbsp;<span class="ident" id="7028275">typeStdin</span><span class="op" id="7028284">,</span>&nbsp;<span class="num" id="7028286">300</span><span class="op" id="7028289">,</span>&nbsp;<span class="builtinfunc" id="7028291">make</span><span class="op" id="7028295">(</span><span class="op" id="7028296">[</span><span class="op" id="7028297">]</span><span class="builtintype" id="7028298">byte</span><span class="op" id="7028302">,</span>&nbsp;<span class="num" id="7028304">66000</span><span class="op" id="7028309">)</span><span class="op" id="7028310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028314">bytes</span><span class="op" id="7028319">.</span><span class="ident" id="7028320">Join</span><span class="op" id="7028324">(</span><span class="op" id="7028325">[</span><span class="op" id="7028326">]</span><span class="op" id="7028327">[</span><span class="op" id="7028328">]</span><span class="builtintype" id="7028329">byte</span><span class="op" id="7028333">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7028338">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028372">{</span><span class="num" id="7028373">1</span><span class="op" id="7028374">,</span>&nbsp;<span class="builtintype" id="7028376">byte</span><span class="op" id="7028380">(</span><span class="ident" id="7028381">typeStdin</span><span class="op" id="7028390">)</span><span class="op" id="7028391">,</span>&nbsp;<span class="num" id="7028393">0x01</span><span class="op" id="7028397">,</span>&nbsp;<span class="num" id="7028399">0x2C</span><span class="op" id="7028403">,</span>&nbsp;<span class="num" id="7028405">0xFF</span><span class="op" id="7028409">,</span>&nbsp;<span class="num" id="7028411">0xFF</span><span class="op" id="7028415">,</span>&nbsp;<span class="num" id="7028417">1</span><span class="op" id="7028418">,</span>&nbsp;<span class="num" id="7028420">0</span><span class="op" id="7028421">}</span><span class="op" id="7028422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7028427">make</span><span class="op" id="7028431">(</span><span class="op" id="7028432">[</span><span class="op" id="7028433">]</span><span class="builtintype" id="7028434">byte</span><span class="op" id="7028438">,</span>&nbsp;<span class="num" id="7028440">65536</span><span class="op" id="7028445">)</span><span class="op" id="7028446">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7028451">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028479">{</span><span class="num" id="7028480">1</span><span class="op" id="7028481">,</span>&nbsp;<span class="builtintype" id="7028483">byte</span><span class="op" id="7028487">(</span><span class="ident" id="7028488">typeStdin</span><span class="op" id="7028497">)</span><span class="op" id="7028498">,</span>&nbsp;<span class="num" id="7028500">0x01</span><span class="op" id="7028504">,</span>&nbsp;<span class="num" id="7028506">0x2C</span><span class="op" id="7028510">,</span>&nbsp;<span class="num" id="7028512">0x01</span><span class="op" id="7028516">,</span>&nbsp;<span class="num" id="7028518">0xD1</span><span class="op" id="7028522">,</span>&nbsp;<span class="num" id="7028524">7</span><span class="op" id="7028525">,</span>&nbsp;<span class="num" id="7028527">0</span><span class="op" id="7028528">}</span><span class="op" id="7028529">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7028534">make</span><span class="op" id="7028538">(</span><span class="op" id="7028539">[</span><span class="op" id="7028540">]</span><span class="builtintype" id="7028541">byte</span><span class="op" id="7028545">,</span>&nbsp;<span class="num" id="7028547">472</span><span class="op" id="7028550">)</span><span class="op" id="7028551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7028556">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028590">{</span><span class="num" id="7028591">1</span><span class="op" id="7028592">,</span>&nbsp;<span class="builtintype" id="7028594">byte</span><span class="op" id="7028598">(</span><span class="ident" id="7028599">typeStdin</span><span class="op" id="7028608">)</span><span class="op" id="7028609">,</span>&nbsp;<span class="num" id="7028611">0x01</span><span class="op" id="7028615">,</span>&nbsp;<span class="num" id="7028617">0x2C</span><span class="op" id="7028621">,</span>&nbsp;<span class="num" id="7028623">0</span><span class="op" id="7028624">,</span>&nbsp;<span class="num" id="7028626">0</span><span class="op" id="7028627">,</span>&nbsp;<span class="num" id="7028629">0</span><span class="op" id="7028630">,</span>&nbsp;<span class="num" id="7028632">0</span><span class="op" id="7028633">}</span><span class="op" id="7028634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028638">}</span><span class="op" id="7028639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028644">nil</span><span class="op" id="7028647">)</span><span class="op" id="7028648">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7028651">}</span><span class="op" id="7028652">,</span><br>
<span class="lineno"></span><span class="op" id="7028654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028657">type</span>&nbsp;<span class="ident" id="7028662">nilCloser</span>&nbsp;<span class="keyword" id="7028672">struct</span>&nbsp;<span class="op" id="7028679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028682">io</span><span class="op" id="7028684">.</span><span class="ident" id="7028685">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="7028696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028699">func</span>&nbsp;<span class="op" id="7028704">(</span><span class="ident" id="7028705">c</span>&nbsp;<span class="op" id="7028707">*</span><span class="ident" id="7028708">nilCloser</span><span class="op" id="7028717">)</span>&nbsp;<span class="ident" id="7028719">Close</span><span class="op" id="7028724">(</span><span class="op" id="7028725">)</span>&nbsp;<span class="builtintype" id="7028727">error</span>&nbsp;<span class="op" id="7028733">{</span>&nbsp;<span class="keyword" id="7028735">return</span>&nbsp;<span class="ident" id="7028742">nil</span>&nbsp;<span class="op" id="7028746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7028749">func</span>&nbsp;<span class="ident" id="7028754">TestStreams</span><span class="op" id="7028765">(</span><span class="ident" id="7028766">t</span>&nbsp;<span class="op" id="7028768">*</span><span class="ident" id="7028769">testing</span><span class="op" id="7028776">.</span><span class="ident" id="7028777">T</span><span class="op" id="7028778">)</span>&nbsp;<span class="op" id="7028780">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028783">var</span>&nbsp;<span class="ident" id="7028787">rec</span>&nbsp;<span class="ident" id="7028791">record</span><br>
<span class="lineno"></span><span class="ident" id="7028798">outer</span><span class="op" id="7028803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028806">for</span>&nbsp;<span class="ident" id="7028810">_</span><span class="op" id="7028811">,</span>&nbsp;<span class="ident" id="7028813">test</span>&nbsp;<span class="op" id="7028818">:=</span>&nbsp;<span class="keyword" id="7028821">range</span>&nbsp;<span class="ident" id="7028827">streamTests</span>&nbsp;<span class="op" id="7028839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028843">buf</span>&nbsp;<span class="op" id="7028847">:=</span>&nbsp;<span class="ident" id="7028850">bytes</span><span class="op" id="7028855">.</span><span class="ident" id="7028856">NewBuffer</span><span class="op" id="7028865">(</span><span class="ident" id="7028866">test</span><span class="op" id="7028870">.</span><span class="ident" id="7028871">raw</span><span class="op" id="7028874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028878">var</span>&nbsp;<span class="ident" id="7028882">content</span>&nbsp;<span class="op" id="7028890">[</span><span class="op" id="7028891">]</span><span class="builtintype" id="7028892">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028899">for</span>&nbsp;<span class="ident" id="7028903">buf</span><span class="op" id="7028906">.</span><span class="ident" id="7028907">Len</span><span class="op" id="7028910">(</span><span class="op" id="7028911">)</span>&nbsp;<span class="op" id="7028913">&gt;</span>&nbsp;<span class="num" id="7028915">0</span>&nbsp;<span class="op" id="7028917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7028922">if</span>&nbsp;<span class="ident" id="7028925">err</span>&nbsp;<span class="op" id="7028929">:=</span>&nbsp;<span class="ident" id="7028932">rec</span><span class="op" id="7028935">.</span><span class="ident" id="7028936">read</span><span class="op" id="7028940">(</span><span class="ident" id="7028941">buf</span><span class="op" id="7028944">)</span><span class="op" id="7028945">;</span>&nbsp;<span class="ident" id="7028947">err</span>&nbsp;<span class="op" id="7028951">!=</span>&nbsp;<span class="ident" id="7028954">nil</span>&nbsp;<span class="op" id="7028958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7028964">t</span><span class="op" id="7028965">.</span><span class="ident" id="7028966">Errorf</span><span class="op" id="7028972">(</span><span class="string" id="7028973">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7029003">,</span>&nbsp;<span class="ident" id="7029005">test</span><span class="op" id="7029009">.</span><span class="ident" id="7029010">desc</span><span class="op" id="7029014">,</span>&nbsp;<span class="ident" id="7029016">err</span><span class="op" id="7029019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029025">continue</span>&nbsp;<span class="ident" id="7029034">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029043">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029048">content</span>&nbsp;<span class="op" id="7029056">=</span>&nbsp;<span class="builtinfunc" id="7029058">append</span><span class="op" id="7029064">(</span><span class="ident" id="7029065">content</span><span class="op" id="7029072">,</span>&nbsp;<span class="ident" id="7029074">rec</span><span class="op" id="7029077">.</span><span class="ident" id="7029078">content</span><span class="op" id="7029085">(</span><span class="op" id="7029086">)</span><span class="op" id="7029087">...</span><span class="op" id="7029090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029098">if</span>&nbsp;<span class="ident" id="7029101">rec</span><span class="op" id="7029104">.</span><span class="ident" id="7029105">h</span><span class="op" id="7029106">.</span><span class="ident" id="7029107">Type</span>&nbsp;<span class="op" id="7029112">!=</span>&nbsp;<span class="ident" id="7029115">test</span><span class="op" id="7029119">.</span><span class="ident" id="7029120">recType</span>&nbsp;<span class="op" id="7029128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029133">t</span><span class="op" id="7029134">.</span><span class="ident" id="7029135">Errorf</span><span class="op" id="7029141">(</span><span class="string" id="7029142">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7029171">,</span>&nbsp;<span class="ident" id="7029173">test</span><span class="op" id="7029177">.</span><span class="ident" id="7029178">desc</span><span class="op" id="7029182">,</span>&nbsp;<span class="ident" id="7029184">rec</span><span class="op" id="7029187">.</span><span class="ident" id="7029188">h</span><span class="op" id="7029189">.</span><span class="ident" id="7029190">Type</span><span class="op" id="7029194">,</span>&nbsp;<span class="ident" id="7029196">test</span><span class="op" id="7029200">.</span><span class="ident" id="7029201">recType</span><span class="op" id="7029208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029213">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029228">if</span>&nbsp;<span class="ident" id="7029231">rec</span><span class="op" id="7029234">.</span><span class="ident" id="7029235">h</span><span class="op" id="7029236">.</span><span class="ident" id="7029237">Id</span>&nbsp;<span class="op" id="7029240">!=</span>&nbsp;<span class="ident" id="7029243">test</span><span class="op" id="7029247">.</span><span class="ident" id="7029248">reqId</span>&nbsp;<span class="op" id="7029254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029259">t</span><span class="op" id="7029260">.</span><span class="ident" id="7029261">Errorf</span><span class="op" id="7029267">(</span><span class="string" id="7029268">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7029303">,</span>&nbsp;<span class="ident" id="7029305">test</span><span class="op" id="7029309">.</span><span class="ident" id="7029310">desc</span><span class="op" id="7029314">,</span>&nbsp;<span class="ident" id="7029316">rec</span><span class="op" id="7029319">.</span><span class="ident" id="7029320">h</span><span class="op" id="7029321">.</span><span class="ident" id="7029322">Id</span><span class="op" id="7029324">,</span>&nbsp;<span class="ident" id="7029326">test</span><span class="op" id="7029330">.</span><span class="ident" id="7029331">reqId</span><span class="op" id="7029336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029341">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029352">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029356">if</span>&nbsp;<span class="op" id="7029359">!</span><span class="ident" id="7029360">bytes</span><span class="op" id="7029365">.</span><span class="ident" id="7029366">Equal</span><span class="op" id="7029371">(</span><span class="ident" id="7029372">content</span><span class="op" id="7029379">,</span>&nbsp;<span class="ident" id="7029381">test</span><span class="op" id="7029385">.</span><span class="ident" id="7029386">content</span><span class="op" id="7029393">)</span>&nbsp;<span class="op" id="7029395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029400">t</span><span class="op" id="7029401">.</span><span class="ident" id="7029402">Errorf</span><span class="op" id="7029408">(</span><span class="string" id="7029409">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7029433">,</span>&nbsp;<span class="ident" id="7029435">test</span><span class="op" id="7029439">.</span><span class="ident" id="7029440">desc</span><span class="op" id="7029444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029449">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029464">buf</span><span class="op" id="7029467">.</span><span class="ident" id="7029468">Reset</span><span class="op" id="7029473">(</span><span class="op" id="7029474">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029478">c</span>&nbsp;<span class="op" id="7029480">:=</span>&nbsp;<span class="ident" id="7029483">newConn</span><span class="op" id="7029490">(</span><span class="op" id="7029491">&amp;</span><span class="ident" id="7029492">nilCloser</span><span class="op" id="7029501">{</span><span class="ident" id="7029502">buf</span><span class="op" id="7029505">}</span><span class="op" id="7029506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029510">w</span>&nbsp;<span class="op" id="7029512">:=</span>&nbsp;<span class="ident" id="7029515">newWriter</span><span class="op" id="7029524">(</span><span class="ident" id="7029525">c</span><span class="op" id="7029526">,</span>&nbsp;<span class="ident" id="7029528">test</span><span class="op" id="7029532">.</span><span class="ident" id="7029533">recType</span><span class="op" id="7029540">,</span>&nbsp;<span class="ident" id="7029542">test</span><span class="op" id="7029546">.</span><span class="ident" id="7029547">reqId</span><span class="op" id="7029552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029556">if</span>&nbsp;<span class="ident" id="7029559">_</span><span class="op" id="7029560">,</span>&nbsp;<span class="ident" id="7029562">err</span>&nbsp;<span class="op" id="7029566">:=</span>&nbsp;<span class="ident" id="7029569">w</span><span class="op" id="7029570">.</span><span class="ident" id="7029571">Write</span><span class="op" id="7029576">(</span><span class="ident" id="7029577">test</span><span class="op" id="7029581">.</span><span class="ident" id="7029582">content</span><span class="op" id="7029589">)</span><span class="op" id="7029590">;</span>&nbsp;<span class="ident" id="7029592">err</span>&nbsp;<span class="op" id="7029596">!=</span>&nbsp;<span class="ident" id="7029599">nil</span>&nbsp;<span class="op" id="7029603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029608">t</span><span class="op" id="7029609">.</span><span class="ident" id="7029610">Errorf</span><span class="op" id="7029616">(</span><span class="string" id="7029617">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="7029647">,</span>&nbsp;<span class="ident" id="7029649">test</span><span class="op" id="7029653">.</span><span class="ident" id="7029654">desc</span><span class="op" id="7029658">,</span>&nbsp;<span class="ident" id="7029660">err</span><span class="op" id="7029663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029668">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029683">if</span>&nbsp;<span class="ident" id="7029686">err</span>&nbsp;<span class="op" id="7029690">:=</span>&nbsp;<span class="ident" id="7029693">w</span><span class="op" id="7029694">.</span><span class="ident" id="7029695">Close</span><span class="op" id="7029700">(</span><span class="op" id="7029701">)</span><span class="op" id="7029702">;</span>&nbsp;<span class="ident" id="7029704">err</span>&nbsp;<span class="op" id="7029708">!=</span>&nbsp;<span class="ident" id="7029711">nil</span>&nbsp;<span class="op" id="7029715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029720">t</span><span class="op" id="7029721">.</span><span class="ident" id="7029722">Errorf</span><span class="op" id="7029728">(</span><span class="string" id="7029729">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="7029759">,</span>&nbsp;<span class="ident" id="7029761">test</span><span class="op" id="7029765">.</span><span class="ident" id="7029766">desc</span><span class="op" id="7029770">,</span>&nbsp;<span class="ident" id="7029772">err</span><span class="op" id="7029775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029780">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029791">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7029795">if</span>&nbsp;<span class="op" id="7029798">!</span><span class="ident" id="7029799">bytes</span><span class="op" id="7029804">.</span><span class="ident" id="7029805">Equal</span><span class="op" id="7029810">(</span><span class="ident" id="7029811">buf</span><span class="op" id="7029814">.</span><span class="ident" id="7029815">Bytes</span><span class="op" id="7029820">(</span><span class="op" id="7029821">)</span><span class="op" id="7029822">,</span>&nbsp;<span class="ident" id="7029824">test</span><span class="op" id="7029828">.</span><span class="ident" id="7029829">raw</span><span class="op" id="7029832">)</span>&nbsp;<span class="op" id="7029834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029839">t</span><span class="op" id="7029840">.</span><span class="ident" id="7029841">Errorf</span><span class="op" id="7029847">(</span><span class="string" id="7029848">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="7029873">,</span>&nbsp;<span class="ident" id="7029875">test</span><span class="op" id="7029879">.</span><span class="ident" id="7029880">desc</span><span class="op" id="7029884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7029891">}</span><br>
<span class="lineno"></span><span class="op" id="7029893">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7029896">type</span>&nbsp;<span class="ident" id="7029901">writeOnlyConn</span>&nbsp;<span class="keyword" id="7029915">struct</span>&nbsp;<span class="op" id="7029922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029925">buf</span>&nbsp;<span class="op" id="7029929">[</span><span class="op" id="7029930">]</span><span class="builtintype" id="7029931">byte</span><br>
<span class="lineno"></span><span class="op" id="7029936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7029939">func</span>&nbsp;<span class="op" id="7029944">(</span><span class="ident" id="7029945">c</span>&nbsp;<span class="op" id="7029947">*</span><span class="ident" id="7029948">writeOnlyConn</span><span class="op" id="7029961">)</span>&nbsp;<span class="ident" id="7029963">Write</span><span class="op" id="7029968">(</span><span class="ident" id="7029969">p</span>&nbsp;<span class="op" id="7029971">[</span><span class="op" id="7029972">]</span><span class="builtintype" id="7029973">byte</span><span class="op" id="7029977">)</span>&nbsp;<span class="op" id="7029979">(</span><span class="builtintype" id="7029980">int</span><span class="op" id="7029983">,</span>&nbsp;<span class="builtintype" id="7029985">error</span><span class="op" id="7029990">)</span>&nbsp;<span class="op" id="7029992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7029995">c</span><span class="op" id="7029996">.</span><span class="ident" id="7029997">buf</span>&nbsp;<span class="op" id="7030001">=</span>&nbsp;<span class="builtinfunc" id="7030003">append</span><span class="op" id="7030009">(</span><span class="ident" id="7030010">c</span><span class="op" id="7030011">.</span><span class="ident" id="7030012">buf</span><span class="op" id="7030015">,</span>&nbsp;<span class="ident" id="7030017">p</span><span class="op" id="7030018">...</span><span class="op" id="7030021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030024">return</span>&nbsp;<span class="builtinfunc" id="7030031">len</span><span class="op" id="7030034">(</span><span class="ident" id="7030035">p</span><span class="op" id="7030036">)</span><span class="op" id="7030037">,</span>&nbsp;<span class="ident" id="7030039">nil</span><br>
<span class="lineno"></span><span class="op" id="7030043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="7030046">func</span>&nbsp;<span class="op" id="7030051">(</span><span class="ident" id="7030052">c</span>&nbsp;<span class="op" id="7030054">*</span><span class="ident" id="7030055">writeOnlyConn</span><span class="op" id="7030068">)</span>&nbsp;<span class="ident" id="7030070">Read</span><span class="op" id="7030074">(</span><span class="ident" id="7030075">p</span>&nbsp;<span class="op" id="7030077">[</span><span class="op" id="7030078">]</span><span class="builtintype" id="7030079">byte</span><span class="op" id="7030083">)</span>&nbsp;<span class="op" id="7030085">(</span><span class="builtintype" id="7030086">int</span><span class="op" id="7030089">,</span>&nbsp;<span class="builtintype" id="7030091">error</span><span class="op" id="7030096">)</span>&nbsp;<span class="op" id="7030098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030101">return</span>&nbsp;<span class="num" id="7030108">0</span><span class="op" id="7030109">,</span>&nbsp;<span class="ident" id="7030111">errors</span><span class="op" id="7030117">.</span><span class="ident" id="7030118">New</span><span class="op" id="7030121">(</span><span class="string" id="7030122">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="7030142">)</span><br>
<span class="lineno"></span><span class="op" id="7030144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7030147">func</span>&nbsp;<span class="op" id="7030152">(</span><span class="ident" id="7030153">c</span>&nbsp;<span class="op" id="7030155">*</span><span class="ident" id="7030156">writeOnlyConn</span><span class="op" id="7030169">)</span>&nbsp;<span class="ident" id="7030171">Close</span><span class="op" id="7030176">(</span><span class="op" id="7030177">)</span>&nbsp;<span class="builtintype" id="7030179">error</span>&nbsp;<span class="op" id="7030185">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030188">return</span>&nbsp;<span class="ident" id="7030195">nil</span><br>
<span class="lineno"></span><span class="op" id="7030199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7030202">func</span>&nbsp;<span class="ident" id="7030207">TestGetValues</span><span class="op" id="7030220">(</span><span class="ident" id="7030221">t</span>&nbsp;<span class="op" id="7030223">*</span><span class="ident" id="7030224">testing</span><span class="op" id="7030231">.</span><span class="ident" id="7030232">T</span><span class="op" id="7030233">)</span>&nbsp;<span class="op" id="7030235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030238">var</span>&nbsp;<span class="ident" id="7030242">rec</span>&nbsp;<span class="ident" id="7030246">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7030254">rec</span><span class="op" id="7030257">.</span><span class="ident" id="7030258">h</span><span class="op" id="7030259">.</span><span class="ident" id="7030260">Type</span>&nbsp;<span class="op" id="7030265">=</span>&nbsp;<span class="ident" id="7030267">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7030283">wc</span>&nbsp;<span class="op" id="7030286">:=</span>&nbsp;<span class="builtinfunc" id="7030289">new</span><span class="op" id="7030292">(</span><span class="ident" id="7030293">writeOnlyConn</span><span class="op" id="7030306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7030309">c</span>&nbsp;<span class="op" id="7030311">:=</span>&nbsp;<span class="ident" id="7030314">newChild</span><span class="op" id="7030322">(</span><span class="ident" id="7030323">wc</span><span class="op" id="7030325">,</span>&nbsp;<span class="ident" id="7030327">nil</span><span class="op" id="7030330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7030333">err</span>&nbsp;<span class="op" id="7030337">:=</span>&nbsp;<span class="ident" id="7030340">c</span><span class="op" id="7030341">.</span><span class="ident" id="7030342">handleRecord</span><span class="op" id="7030354">(</span><span class="op" id="7030355">&amp;</span><span class="ident" id="7030356">rec</span><span class="op" id="7030359">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030362">if</span>&nbsp;<span class="ident" id="7030365">err</span>&nbsp;<span class="op" id="7030369">!=</span>&nbsp;<span class="ident" id="7030372">nil</span>&nbsp;<span class="op" id="7030376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7030380">t</span><span class="op" id="7030381">.</span><span class="ident" id="7030382">Fatalf</span><span class="op" id="7030388">(</span><span class="string" id="7030389">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="7030407">,</span>&nbsp;<span class="ident" id="7030409">err</span><span class="op" id="7030412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7030415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030419">const</span>&nbsp;<span class="ident" id="7030425">want</span>&nbsp;<span class="op" id="7030430">=</span>&nbsp;<span class="string" id="7030432">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="7030465">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7030469">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="7030496">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7030500">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7030558">if</span>&nbsp;<span class="ident" id="7030561">got</span>&nbsp;<span class="op" id="7030565">:=</span>&nbsp;<span class="builtintype" id="7030568">string</span><span class="op" id="7030574">(</span><span class="ident" id="7030575">wc</span><span class="op" id="7030577">.</span><span class="ident" id="7030578">buf</span><span class="op" id="7030581">)</span><span class="op" id="7030582">;</span>&nbsp;<span class="ident" id="7030584">got</span>&nbsp;<span class="op" id="7030588">!=</span>&nbsp;<span class="ident" id="7030591">want</span>&nbsp;<span class="op" id="7030596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7030600">t</span><span class="op" id="7030601">.</span><span class="ident" id="7030602">Errorf</span><span class="op" id="7030608">(</span><span class="string" id="7030609">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7030631">,</span>&nbsp;<span class="ident" id="7030633">got</span><span class="op" id="7030636">,</span>&nbsp;<span class="ident" id="7030638">want</span><span class="op" id="7030642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7030645">}</span><br>
<span class="lineno">150</span><span class="op" id="7030647">}</span>
</div>
</body>
</html>
