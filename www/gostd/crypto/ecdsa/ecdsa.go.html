<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/ecdsa</h2>
<ul>
<li><a href="/gostd/crypto/ecdsa/ecdsa.go.html" class="current">ecdsa.go</a></li>
<li><a href="/gostd/crypto/ecdsa/ecdsa_test.go.html">ecdsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4542199">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4542254">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4542308">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4542359">//&nbsp;Package&nbsp;ecdsa&nbsp;implements&nbsp;the&nbsp;Elliptic&nbsp;Curve&nbsp;Digital&nbsp;Signature&nbsp;Algorithm,&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4542438">//&nbsp;defined&nbsp;in&nbsp;FIPS&nbsp;186-3.</span><br>
<span class="lineno"></span><span class="keyword" id="4542464">package</span>&nbsp;<span class="ident" id="4542472">ecdsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4542479">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="4542494">//&nbsp;&nbsp;&nbsp;[NSA]:&nbsp;Suite&nbsp;B&nbsp;implementer&#39;s&nbsp;guide&nbsp;to&nbsp;FIPS&nbsp;186-3,</span><br>
<span class="lineno"></span><span class="comment" id="4542549">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.nsa.gov/ia/_files/ecdsa.pdf</span><br>
<span class="lineno"></span><span class="comment" id="4542595">//&nbsp;&nbsp;&nbsp;[SECG]:&nbsp;SECG,&nbsp;SEC1</span><br>
<span class="lineno"></span><span class="comment" id="4542619">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://www.secg.org/download/aid-780/sec1-v2.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4542676">import</span>&nbsp;<span class="op" id="4542683">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4542686">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4542696">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4542715">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4542732">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4542738">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4542749">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4542752">//&nbsp;PublicKey&nbsp;represents&nbsp;an&nbsp;ECDSA&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4542797">type</span>&nbsp;<span class="ident" id="4542802">PublicKey</span>&nbsp;<span class="keyword" id="4542812">struct</span>&nbsp;<span class="op" id="4542819">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542822">elliptic</span><span class="op" id="4542830">.</span><span class="ident" id="4542831">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542838">X</span><span class="op" id="4542839">,</span>&nbsp;<span class="ident" id="4542841">Y</span>&nbsp;<span class="op" id="4542843">*</span><span class="ident" id="4542844">big</span><span class="op" id="4542847">.</span><span class="ident" id="4542848">Int</span><br>
<span class="lineno"></span><span class="op" id="4542852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4542855">//&nbsp;PrivateKey&nbsp;represents&nbsp;a&nbsp;ECDSA&nbsp;private&nbsp;key.</span><br>
<span class="lineno">30</span><span class="keyword" id="4542901">type</span>&nbsp;<span class="ident" id="4542906">PrivateKey</span>&nbsp;<span class="keyword" id="4542917">struct</span>&nbsp;<span class="op" id="4542924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542927">PublicKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542938">D</span>&nbsp;<span class="op" id="4542940">*</span><span class="ident" id="4542941">big</span><span class="op" id="4542944">.</span><span class="ident" id="4542945">Int</span><br>
<span class="lineno"></span><span class="op" id="4542949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="4542952">type</span>&nbsp;<span class="ident" id="4542957">ecdsaSignature</span>&nbsp;<span class="keyword" id="4542972">struct</span>&nbsp;<span class="op" id="4542979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4542982">R</span><span class="op" id="4542983">,</span>&nbsp;<span class="ident" id="4542985">S</span>&nbsp;<span class="op" id="4542987">*</span><span class="ident" id="4542988">big</span><span class="op" id="4542991">.</span><span class="ident" id="4542992">Int</span><br>
<span class="lineno"></span><span class="op" id="4542996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4542999">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno">40</span><span class="keyword" id="4543055">func</span>&nbsp;<span class="op" id="4543060">(</span><span class="ident" id="4543061">priv</span>&nbsp;<span class="op" id="4543066">*</span><span class="ident" id="4543067">PrivateKey</span><span class="op" id="4543077">)</span>&nbsp;<span class="ident" id="4543079">Public</span><span class="op" id="4543085">(</span><span class="op" id="4543086">)</span>&nbsp;<span class="ident" id="4543088">crypto</span><span class="op" id="4543094">.</span><span class="ident" id="4543095">PublicKey</span>&nbsp;<span class="op" id="4543105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543108">return</span>&nbsp;<span class="op" id="4543115">&amp;</span><span class="ident" id="4543116">priv</span><span class="op" id="4543120">.</span><span class="ident" id="4543121">PublicKey</span><br>
<span class="lineno"></span><span class="op" id="4543131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4543134">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;This&nbsp;method&nbsp;is</span><br>
<span class="lineno">45</span><span class="comment" id="4543208">//&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4543286">//&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign&nbsp;function&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4543363">//&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4543376">func</span>&nbsp;<span class="op" id="4543381">(</span><span class="ident" id="4543382">priv</span>&nbsp;<span class="op" id="4543387">*</span><span class="ident" id="4543388">PrivateKey</span><span class="op" id="4543398">)</span>&nbsp;<span class="ident" id="4543400">Sign</span><span class="op" id="4543404">(</span><span class="ident" id="4543405">rand</span>&nbsp;<span class="ident" id="4543410">io</span><span class="op" id="4543412">.</span><span class="ident" id="4543413">Reader</span><span class="op" id="4543419">,</span>&nbsp;<span class="ident" id="4543421">msg</span>&nbsp;<span class="op" id="4543425">[</span><span class="op" id="4543426">]</span><span class="builtintype" id="4543427">byte</span><span class="op" id="4543431">,</span>&nbsp;<span class="ident" id="4543433">opts</span>&nbsp;<span class="ident" id="4543438">crypto</span><span class="op" id="4543444">.</span><span class="ident" id="4543445">SignerOpts</span><span class="op" id="4543455">)</span>&nbsp;<span class="op" id="4543457">(</span><span class="op" id="4543458">[</span><span class="op" id="4543459">]</span><span class="builtintype" id="4543460">byte</span><span class="op" id="4543464">,</span>&nbsp;<span class="builtintype" id="4543466">error</span><span class="op" id="4543471">)</span>&nbsp;<span class="op" id="4543473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543476">r</span><span class="op" id="4543477">,</span>&nbsp;<span class="ident" id="4543479">s</span><span class="op" id="4543480">,</span>&nbsp;<span class="ident" id="4543482">err</span>&nbsp;<span class="op" id="4543486">:=</span>&nbsp;<span class="ident" id="4543489">Sign</span><span class="op" id="4543493">(</span><span class="ident" id="4543494">rand</span><span class="op" id="4543498">,</span>&nbsp;<span class="ident" id="4543500">priv</span><span class="op" id="4543504">,</span>&nbsp;<span class="ident" id="4543506">msg</span><span class="op" id="4543509">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543512">if</span>&nbsp;<span class="ident" id="4543515">err</span>&nbsp;<span class="op" id="4543519">!=</span>&nbsp;<span class="builtintype" id="4543522">nil</span>&nbsp;<span class="op" id="4543526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543530">return</span>&nbsp;<span class="builtintype" id="4543537">nil</span><span class="op" id="4543540">,</span>&nbsp;<span class="ident" id="4543542">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543551">return</span>&nbsp;<span class="ident" id="4543558">asn1</span><span class="op" id="4543562">.</span><span class="ident" id="4543563">Marshal</span><span class="op" id="4543570">(</span><span class="ident" id="4543571">ecdsaSignature</span><span class="op" id="4543585">{</span><span class="ident" id="4543586">r</span><span class="op" id="4543587">,</span>&nbsp;<span class="ident" id="4543589">s</span><span class="op" id="4543590">}</span><span class="op" id="4543591">)</span><br>
<span class="lineno">55</span><span class="op" id="4543593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4543596">var</span>&nbsp;<span class="ident" id="4543600">one</span>&nbsp;<span class="op" id="4543604">=</span>&nbsp;<span class="builtinfunc" id="4543606">new</span><span class="op" id="4543609">(</span><span class="ident" id="4543610">big</span><span class="op" id="4543613">.</span><span class="ident" id="4543614">Int</span><span class="op" id="4543617">)</span><span class="op" id="4543618">.</span><span class="ident" id="4543619">SetInt64</span><span class="op" id="4543627">(</span><span class="num" id="4543628">1</span><span class="op" id="4543629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4543632">//&nbsp;randFieldElement&nbsp;returns&nbsp;a&nbsp;random&nbsp;element&nbsp;of&nbsp;the&nbsp;field&nbsp;underlying&nbsp;the&nbsp;given</span><br>
<span class="lineno">60</span><span class="comment" id="4543711">//&nbsp;curve&nbsp;using&nbsp;the&nbsp;procedure&nbsp;given&nbsp;in&nbsp;[NSA]&nbsp;A.2.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4543762">func</span>&nbsp;<span class="ident" id="4543767">randFieldElement</span><span class="op" id="4543783">(</span><span class="ident" id="4543784">c</span>&nbsp;<span class="ident" id="4543786">elliptic</span><span class="op" id="4543794">.</span><span class="ident" id="4543795">Curve</span><span class="op" id="4543800">,</span>&nbsp;<span class="ident" id="4543802">rand</span>&nbsp;<span class="ident" id="4543807">io</span><span class="op" id="4543809">.</span><span class="ident" id="4543810">Reader</span><span class="op" id="4543816">)</span>&nbsp;<span class="op" id="4543818">(</span><span class="ident" id="4543819">k</span>&nbsp;<span class="op" id="4543821">*</span><span class="ident" id="4543822">big</span><span class="op" id="4543825">.</span><span class="ident" id="4543826">Int</span><span class="op" id="4543829">,</span>&nbsp;<span class="ident" id="4543831">err</span>&nbsp;<span class="builtintype" id="4543835">error</span><span class="op" id="4543840">)</span>&nbsp;<span class="op" id="4543842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543845">params</span>&nbsp;<span class="op" id="4543852">:=</span>&nbsp;<span class="ident" id="4543855">c</span><span class="op" id="4543856">.</span><span class="ident" id="4543857">Params</span><span class="op" id="4543863">(</span><span class="op" id="4543864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543867">b</span>&nbsp;<span class="op" id="4543869">:=</span>&nbsp;<span class="builtinfunc" id="4543872">make</span><span class="op" id="4543876">(</span><span class="op" id="4543877">[</span><span class="op" id="4543878">]</span><span class="builtintype" id="4543879">byte</span><span class="op" id="4543883">,</span>&nbsp;<span class="ident" id="4543885">params</span><span class="op" id="4543891">.</span><span class="ident" id="4543892">BitSize</span><span class="op" id="4543899">/</span><span class="num" id="4543900">8</span><span class="op" id="4543901">+</span><span class="num" id="4543902">8</span><span class="op" id="4543903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543906">_</span><span class="op" id="4543907">,</span>&nbsp;<span class="ident" id="4543909">err</span>&nbsp;<span class="op" id="4543913">=</span>&nbsp;<span class="ident" id="4543915">io</span><span class="op" id="4543917">.</span><span class="ident" id="4543918">ReadFull</span><span class="op" id="4543926">(</span><span class="ident" id="4543927">rand</span><span class="op" id="4543931">,</span>&nbsp;<span class="ident" id="4543933">b</span><span class="op" id="4543934">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543937">if</span>&nbsp;<span class="ident" id="4543940">err</span>&nbsp;<span class="op" id="4543944">!=</span>&nbsp;<span class="builtintype" id="4543947">nil</span>&nbsp;<span class="op" id="4543951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4543955">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4543963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543967">k</span>&nbsp;<span class="op" id="4543969">=</span>&nbsp;<span class="builtinfunc" id="4543971">new</span><span class="op" id="4543974">(</span><span class="ident" id="4543975">big</span><span class="op" id="4543978">.</span><span class="ident" id="4543979">Int</span><span class="op" id="4543982">)</span><span class="op" id="4543983">.</span><span class="ident" id="4543984">SetBytes</span><span class="op" id="4543992">(</span><span class="ident" id="4543993">b</span><span class="op" id="4543994">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4543997">n</span>&nbsp;<span class="op" id="4543999">:=</span>&nbsp;<span class="builtinfunc" id="4544002">new</span><span class="op" id="4544005">(</span><span class="ident" id="4544006">big</span><span class="op" id="4544009">.</span><span class="ident" id="4544010">Int</span><span class="op" id="4544013">)</span><span class="op" id="4544014">.</span><span class="ident" id="4544015">Sub</span><span class="op" id="4544018">(</span><span class="ident" id="4544019">params</span><span class="op" id="4544025">.</span><span class="ident" id="4544026">N</span><span class="op" id="4544027">,</span>&nbsp;<span class="ident" id="4544029">one</span><span class="op" id="4544032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544035">k</span><span class="op" id="4544036">.</span><span class="ident" id="4544037">Mod</span><span class="op" id="4544040">(</span><span class="ident" id="4544041">k</span><span class="op" id="4544042">,</span>&nbsp;<span class="ident" id="4544044">n</span><span class="op" id="4544045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544048">k</span><span class="op" id="4544049">.</span><span class="ident" id="4544050">Add</span><span class="op" id="4544053">(</span><span class="ident" id="4544054">k</span><span class="op" id="4544055">,</span>&nbsp;<span class="ident" id="4544057">one</span><span class="op" id="4544060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544063">return</span><br>
<span class="lineno"></span><span class="op" id="4544070">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="4544073">//&nbsp;GenerateKey&nbsp;generates&nbsp;a&nbsp;public&nbsp;and&nbsp;private&nbsp;key&nbsp;pair.</span><br>
<span class="lineno"></span><span class="keyword" id="4544129">func</span>&nbsp;<span class="ident" id="4544134">GenerateKey</span><span class="op" id="4544145">(</span><span class="ident" id="4544146">c</span>&nbsp;<span class="ident" id="4544148">elliptic</span><span class="op" id="4544156">.</span><span class="ident" id="4544157">Curve</span><span class="op" id="4544162">,</span>&nbsp;<span class="ident" id="4544164">rand</span>&nbsp;<span class="ident" id="4544169">io</span><span class="op" id="4544171">.</span><span class="ident" id="4544172">Reader</span><span class="op" id="4544178">)</span>&nbsp;<span class="op" id="4544180">(</span><span class="ident" id="4544181">priv</span>&nbsp;<span class="op" id="4544186">*</span><span class="ident" id="4544187">PrivateKey</span><span class="op" id="4544197">,</span>&nbsp;<span class="ident" id="4544199">err</span>&nbsp;<span class="builtintype" id="4544203">error</span><span class="op" id="4544208">)</span>&nbsp;<span class="op" id="4544210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544213">k</span><span class="op" id="4544214">,</span>&nbsp;<span class="ident" id="4544216">err</span>&nbsp;<span class="op" id="4544220">:=</span>&nbsp;<span class="ident" id="4544223">randFieldElement</span><span class="op" id="4544239">(</span><span class="ident" id="4544240">c</span><span class="op" id="4544241">,</span>&nbsp;<span class="ident" id="4544243">rand</span><span class="op" id="4544247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544250">if</span>&nbsp;<span class="ident" id="4544253">err</span>&nbsp;<span class="op" id="4544257">!=</span>&nbsp;<span class="builtintype" id="4544260">nil</span>&nbsp;<span class="op" id="4544264">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4544276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544280">priv</span>&nbsp;<span class="op" id="4544285">=</span>&nbsp;<span class="builtinfunc" id="4544287">new</span><span class="op" id="4544290">(</span><span class="ident" id="4544291">PrivateKey</span><span class="op" id="4544301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544304">priv</span><span class="op" id="4544308">.</span><span class="ident" id="4544309">PublicKey</span><span class="op" id="4544318">.</span><span class="ident" id="4544319">Curve</span>&nbsp;<span class="op" id="4544325">=</span>&nbsp;<span class="ident" id="4544327">c</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544330">priv</span><span class="op" id="4544334">.</span><span class="ident" id="4544335">D</span>&nbsp;<span class="op" id="4544337">=</span>&nbsp;<span class="ident" id="4544339">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544342">priv</span><span class="op" id="4544346">.</span><span class="ident" id="4544347">PublicKey</span><span class="op" id="4544356">.</span><span class="ident" id="4544357">X</span><span class="op" id="4544358">,</span>&nbsp;<span class="ident" id="4544360">priv</span><span class="op" id="4544364">.</span><span class="ident" id="4544365">PublicKey</span><span class="op" id="4544374">.</span><span class="ident" id="4544375">Y</span>&nbsp;<span class="op" id="4544377">=</span>&nbsp;<span class="ident" id="4544379">c</span><span class="op" id="4544380">.</span><span class="ident" id="4544381">ScalarBaseMult</span><span class="op" id="4544395">(</span><span class="ident" id="4544396">k</span><span class="op" id="4544397">.</span><span class="ident" id="4544398">Bytes</span><span class="op" id="4544403">(</span><span class="op" id="4544404">)</span><span class="op" id="4544405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544408">return</span><br>
<span class="lineno"></span><span class="op" id="4544415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="4544418">//&nbsp;hashToInt&nbsp;converts&nbsp;a&nbsp;hash&nbsp;value&nbsp;to&nbsp;an&nbsp;integer.&nbsp;There&nbsp;is&nbsp;some&nbsp;disagreement</span><br>
<span class="lineno"></span><span class="comment" id="4544495">//&nbsp;about&nbsp;how&nbsp;this&nbsp;is&nbsp;done.&nbsp;[NSA]&nbsp;suggests&nbsp;that&nbsp;this&nbsp;is&nbsp;done&nbsp;in&nbsp;the&nbsp;obvious</span><br>
<span class="lineno"></span><span class="comment" id="4544570">//&nbsp;manner,&nbsp;but&nbsp;[SECG]&nbsp;truncates&nbsp;the&nbsp;hash&nbsp;to&nbsp;the&nbsp;bit-length&nbsp;of&nbsp;the&nbsp;curve&nbsp;order</span><br>
<span class="lineno"></span><span class="comment" id="4544648">//&nbsp;first.&nbsp;We&nbsp;follow&nbsp;[SECG]&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;OpenSSL&nbsp;does.&nbsp;Additionally,</span><br>
<span class="lineno"></span><span class="comment" id="4544723">//&nbsp;OpenSSL&nbsp;right&nbsp;shifts&nbsp;excess&nbsp;bits&nbsp;from&nbsp;the&nbsp;number&nbsp;if&nbsp;the&nbsp;hash&nbsp;is&nbsp;too&nbsp;large</span><br>
<span class="lineno">95</span><span class="comment" id="4544800">//&nbsp;and&nbsp;we&nbsp;mirror&nbsp;that&nbsp;too.</span><br>
<span class="lineno"></span><span class="keyword" id="4544827">func</span>&nbsp;<span class="ident" id="4544832">hashToInt</span><span class="op" id="4544841">(</span><span class="ident" id="4544842">hash</span>&nbsp;<span class="op" id="4544847">[</span><span class="op" id="4544848">]</span><span class="builtintype" id="4544849">byte</span><span class="op" id="4544853">,</span>&nbsp;<span class="ident" id="4544855">c</span>&nbsp;<span class="ident" id="4544857">elliptic</span><span class="op" id="4544865">.</span><span class="ident" id="4544866">Curve</span><span class="op" id="4544871">)</span>&nbsp;<span class="op" id="4544873">*</span><span class="ident" id="4544874">big</span><span class="op" id="4544877">.</span><span class="ident" id="4544878">Int</span>&nbsp;<span class="op" id="4544882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544885">orderBits</span>&nbsp;<span class="op" id="4544895">:=</span>&nbsp;<span class="ident" id="4544898">c</span><span class="op" id="4544899">.</span><span class="ident" id="4544900">Params</span><span class="op" id="4544906">(</span><span class="op" id="4544907">)</span><span class="op" id="4544908">.</span><span class="ident" id="4544909">N</span><span class="op" id="4544910">.</span><span class="ident" id="4544911">BitLen</span><span class="op" id="4544917">(</span><span class="op" id="4544918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544921">orderBytes</span>&nbsp;<span class="op" id="4544932">:=</span>&nbsp;<span class="op" id="4544935">(</span><span class="ident" id="4544936">orderBits</span>&nbsp;<span class="op" id="4544946">+</span>&nbsp;<span class="num" id="4544948">7</span><span class="op" id="4544949">)</span>&nbsp;<span class="op" id="4544951">/</span>&nbsp;<span class="num" id="4544953">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4544956">if</span>&nbsp;<span class="builtinfunc" id="4544959">len</span><span class="op" id="4544962">(</span><span class="ident" id="4544963">hash</span><span class="op" id="4544967">)</span>&nbsp;<span class="op" id="4544969">&gt;</span>&nbsp;<span class="ident" id="4544971">orderBytes</span>&nbsp;<span class="op" id="4544982">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4544986">hash</span>&nbsp;<span class="op" id="4544991">=</span>&nbsp;<span class="ident" id="4544993">hash</span><span class="op" id="4544997">[</span><span class="op" id="4544998">:</span><span class="ident" id="4544999">orderBytes</span><span class="op" id="4545009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545016">ret</span>&nbsp;<span class="op" id="4545020">:=</span>&nbsp;<span class="builtinfunc" id="4545023">new</span><span class="op" id="4545026">(</span><span class="ident" id="4545027">big</span><span class="op" id="4545030">.</span><span class="ident" id="4545031">Int</span><span class="op" id="4545034">)</span><span class="op" id="4545035">.</span><span class="ident" id="4545036">SetBytes</span><span class="op" id="4545044">(</span><span class="ident" id="4545045">hash</span><span class="op" id="4545049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545052">excess</span>&nbsp;<span class="op" id="4545059">:=</span>&nbsp;<span class="builtinfunc" id="4545062">len</span><span class="op" id="4545065">(</span><span class="ident" id="4545066">hash</span><span class="op" id="4545070">)</span><span class="op" id="4545071">*</span><span class="num" id="4545072">8</span>&nbsp;<span class="op" id="4545074">-</span>&nbsp;<span class="ident" id="4545076">orderBits</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545087">if</span>&nbsp;<span class="ident" id="4545090">excess</span>&nbsp;<span class="op" id="4545097">&gt;</span>&nbsp;<span class="num" id="4545099">0</span>&nbsp;<span class="op" id="4545101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545105">ret</span><span class="op" id="4545108">.</span><span class="ident" id="4545109">Rsh</span><span class="op" id="4545112">(</span><span class="ident" id="4545113">ret</span><span class="op" id="4545116">,</span>&nbsp;<span class="builtintype" id="4545118">uint</span><span class="op" id="4545122">(</span><span class="ident" id="4545123">excess</span><span class="op" id="4545129">)</span><span class="op" id="4545130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4545133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545136">return</span>&nbsp;<span class="ident" id="4545143">ret</span><br>
<span class="lineno"></span><span class="op" id="4545147">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4545150">//&nbsp;fermatInverse&nbsp;calculates&nbsp;the&nbsp;inverse&nbsp;of&nbsp;k&nbsp;in&nbsp;GF(P)&nbsp;using&nbsp;Fermat&#39;s&nbsp;method.</span><br>
<span class="lineno"></span><span class="comment" id="4545227">//&nbsp;This&nbsp;has&nbsp;better&nbsp;constant-time&nbsp;properties&nbsp;than&nbsp;Euclid&#39;s&nbsp;method&nbsp;(implemented</span><br>
<span class="lineno"></span><span class="comment" id="4545305">//&nbsp;in&nbsp;math/big.Int.ModInverse)&nbsp;although&nbsp;math/big&nbsp;itself&nbsp;isn&#39;t&nbsp;strictly</span><br>
<span class="lineno"></span><span class="comment" id="4545376">//&nbsp;constant-time&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;perfect.</span><br>
<span class="lineno">115</span><span class="keyword" id="4545414">func</span>&nbsp;<span class="ident" id="4545419">fermatInverse</span><span class="op" id="4545432">(</span><span class="ident" id="4545433">k</span><span class="op" id="4545434">,</span>&nbsp;<span class="ident" id="4545436">N</span>&nbsp;<span class="op" id="4545438">*</span><span class="ident" id="4545439">big</span><span class="op" id="4545442">.</span><span class="ident" id="4545443">Int</span><span class="op" id="4545446">)</span>&nbsp;<span class="op" id="4545448">*</span><span class="ident" id="4545449">big</span><span class="op" id="4545452">.</span><span class="ident" id="4545453">Int</span>&nbsp;<span class="op" id="4545457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545460">two</span>&nbsp;<span class="op" id="4545464">:=</span>&nbsp;<span class="ident" id="4545467">big</span><span class="op" id="4545470">.</span><span class="ident" id="4545471">NewInt</span><span class="op" id="4545477">(</span><span class="num" id="4545478">2</span><span class="op" id="4545479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545482">nMinus2</span>&nbsp;<span class="op" id="4545490">:=</span>&nbsp;<span class="builtinfunc" id="4545493">new</span><span class="op" id="4545496">(</span><span class="ident" id="4545497">big</span><span class="op" id="4545500">.</span><span class="ident" id="4545501">Int</span><span class="op" id="4545504">)</span><span class="op" id="4545505">.</span><span class="ident" id="4545506">Sub</span><span class="op" id="4545509">(</span><span class="ident" id="4545510">N</span><span class="op" id="4545511">,</span>&nbsp;<span class="ident" id="4545513">two</span><span class="op" id="4545516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545519">return</span>&nbsp;<span class="builtinfunc" id="4545526">new</span><span class="op" id="4545529">(</span><span class="ident" id="4545530">big</span><span class="op" id="4545533">.</span><span class="ident" id="4545534">Int</span><span class="op" id="4545537">)</span><span class="op" id="4545538">.</span><span class="ident" id="4545539">Exp</span><span class="op" id="4545542">(</span><span class="ident" id="4545543">k</span><span class="op" id="4545544">,</span>&nbsp;<span class="ident" id="4545546">nMinus2</span><span class="op" id="4545553">,</span>&nbsp;<span class="ident" id="4545555">N</span><span class="op" id="4545556">)</span><br>
<span class="lineno"></span><span class="op" id="4545558">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="4545561">//&nbsp;Sign&nbsp;signs&nbsp;an&nbsp;arbitrary&nbsp;length&nbsp;hash&nbsp;(which&nbsp;should&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4545641">//&nbsp;larger&nbsp;message)&nbsp;using&nbsp;the&nbsp;private&nbsp;key,&nbsp;priv.&nbsp;It&nbsp;returns&nbsp;the&nbsp;signature&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4545719">//&nbsp;pair&nbsp;of&nbsp;integers.&nbsp;The&nbsp;security&nbsp;of&nbsp;the&nbsp;private&nbsp;key&nbsp;depends&nbsp;on&nbsp;the&nbsp;entropy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4545798">//&nbsp;rand.</span><br>
<span class="lineno">125</span><span class="keyword" id="4545807">func</span>&nbsp;<span class="ident" id="4545812">Sign</span><span class="op" id="4545816">(</span><span class="ident" id="4545817">rand</span>&nbsp;<span class="ident" id="4545822">io</span><span class="op" id="4545824">.</span><span class="ident" id="4545825">Reader</span><span class="op" id="4545831">,</span>&nbsp;<span class="ident" id="4545833">priv</span>&nbsp;<span class="op" id="4545838">*</span><span class="ident" id="4545839">PrivateKey</span><span class="op" id="4545849">,</span>&nbsp;<span class="ident" id="4545851">hash</span>&nbsp;<span class="op" id="4545856">[</span><span class="op" id="4545857">]</span><span class="builtintype" id="4545858">byte</span><span class="op" id="4545862">)</span>&nbsp;<span class="op" id="4545864">(</span><span class="ident" id="4545865">r</span><span class="op" id="4545866">,</span>&nbsp;<span class="ident" id="4545868">s</span>&nbsp;<span class="op" id="4545870">*</span><span class="ident" id="4545871">big</span><span class="op" id="4545874">.</span><span class="ident" id="4545875">Int</span><span class="op" id="4545878">,</span>&nbsp;<span class="ident" id="4545880">err</span>&nbsp;<span class="builtintype" id="4545884">error</span><span class="op" id="4545889">)</span>&nbsp;<span class="op" id="4545891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4545894">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545914">c</span>&nbsp;<span class="op" id="4545916">:=</span>&nbsp;<span class="ident" id="4545919">priv</span><span class="op" id="4545923">.</span><span class="ident" id="4545924">PublicKey</span><span class="op" id="4545933">.</span><span class="ident" id="4545934">Curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4545941">N</span>&nbsp;<span class="op" id="4545943">:=</span>&nbsp;<span class="ident" id="4545946">c</span><span class="op" id="4545947">.</span><span class="ident" id="4545948">Params</span><span class="op" id="4545954">(</span><span class="op" id="4545955">)</span><span class="op" id="4545956">.</span><span class="ident" id="4545957">N</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545961">var</span>&nbsp;<span class="ident" id="4545965">k</span><span class="op" id="4545966">,</span>&nbsp;<span class="ident" id="4545968">kInv</span>&nbsp;<span class="op" id="4545973">*</span><span class="ident" id="4545974">big</span><span class="op" id="4545977">.</span><span class="ident" id="4545978">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545983">for</span>&nbsp;<span class="op" id="4545987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4545991">for</span>&nbsp;<span class="op" id="4545995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546000">k</span><span class="op" id="4546001">,</span>&nbsp;<span class="ident" id="4546003">err</span>&nbsp;<span class="op" id="4546007">=</span>&nbsp;<span class="ident" id="4546009">randFieldElement</span><span class="op" id="4546025">(</span><span class="ident" id="4546026">c</span><span class="op" id="4546027">,</span>&nbsp;<span class="ident" id="4546029">rand</span><span class="op" id="4546033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546038">if</span>&nbsp;<span class="ident" id="4546041">err</span>&nbsp;<span class="op" id="4546045">!=</span>&nbsp;<span class="builtintype" id="4546048">nil</span>&nbsp;<span class="op" id="4546052">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546058">r</span>&nbsp;<span class="op" id="4546060">=</span>&nbsp;<span class="builtintype" id="4546062">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546070">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546086">kInv</span>&nbsp;<span class="op" id="4546091">=</span>&nbsp;<span class="ident" id="4546093">fermatInverse</span><span class="op" id="4546106">(</span><span class="ident" id="4546107">k</span><span class="op" id="4546108">,</span>&nbsp;<span class="ident" id="4546110">N</span><span class="op" id="4546111">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546116">r</span><span class="op" id="4546117">,</span>&nbsp;<span class="ident" id="4546119">_</span>&nbsp;<span class="op" id="4546121">=</span>&nbsp;<span class="ident" id="4546123">priv</span><span class="op" id="4546127">.</span><span class="ident" id="4546128">Curve</span><span class="op" id="4546133">.</span><span class="ident" id="4546134">ScalarBaseMult</span><span class="op" id="4546148">(</span><span class="ident" id="4546149">k</span><span class="op" id="4546150">.</span><span class="ident" id="4546151">Bytes</span><span class="op" id="4546156">(</span><span class="op" id="4546157">)</span><span class="op" id="4546158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546163">r</span><span class="op" id="4546164">.</span><span class="ident" id="4546165">Mod</span><span class="op" id="4546168">(</span><span class="ident" id="4546169">r</span><span class="op" id="4546170">,</span>&nbsp;<span class="ident" id="4546172">N</span><span class="op" id="4546173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546178">if</span>&nbsp;<span class="ident" id="4546181">r</span><span class="op" id="4546182">.</span><span class="ident" id="4546183">Sign</span><span class="op" id="4546187">(</span><span class="op" id="4546188">)</span>&nbsp;<span class="op" id="4546190">!=</span>&nbsp;<span class="num" id="4546193">0</span>&nbsp;<span class="op" id="4546195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546201">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546210">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546219">e</span>&nbsp;<span class="op" id="4546221">:=</span>&nbsp;<span class="ident" id="4546224">hashToInt</span><span class="op" id="4546233">(</span><span class="ident" id="4546234">hash</span><span class="op" id="4546238">,</span>&nbsp;<span class="ident" id="4546240">c</span><span class="op" id="4546241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546245">s</span>&nbsp;<span class="op" id="4546247">=</span>&nbsp;<span class="builtinfunc" id="4546249">new</span><span class="op" id="4546252">(</span><span class="ident" id="4546253">big</span><span class="op" id="4546256">.</span><span class="ident" id="4546257">Int</span><span class="op" id="4546260">)</span><span class="op" id="4546261">.</span><span class="ident" id="4546262">Mul</span><span class="op" id="4546265">(</span><span class="ident" id="4546266">priv</span><span class="op" id="4546270">.</span><span class="ident" id="4546271">D</span><span class="op" id="4546272">,</span>&nbsp;<span class="ident" id="4546274">r</span><span class="op" id="4546275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546279">s</span><span class="op" id="4546280">.</span><span class="ident" id="4546281">Add</span><span class="op" id="4546284">(</span><span class="ident" id="4546285">s</span><span class="op" id="4546286">,</span>&nbsp;<span class="ident" id="4546288">e</span><span class="op" id="4546289">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546293">s</span><span class="op" id="4546294">.</span><span class="ident" id="4546295">Mul</span><span class="op" id="4546298">(</span><span class="ident" id="4546299">s</span><span class="op" id="4546300">,</span>&nbsp;<span class="ident" id="4546302">kInv</span><span class="op" id="4546306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546310">s</span><span class="op" id="4546311">.</span><span class="ident" id="4546312">Mod</span><span class="op" id="4546315">(</span><span class="ident" id="4546316">s</span><span class="op" id="4546317">,</span>&nbsp;<span class="ident" id="4546319">N</span><span class="op" id="4546320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546324">if</span>&nbsp;<span class="ident" id="4546327">s</span><span class="op" id="4546328">.</span><span class="ident" id="4546329">Sign</span><span class="op" id="4546333">(</span><span class="op" id="4546334">)</span>&nbsp;<span class="op" id="4546336">!=</span>&nbsp;<span class="num" id="4546339">0</span>&nbsp;<span class="op" id="4546341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546346">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546354">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546361">return</span><br>
<span class="lineno"></span><span class="op" id="4546368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="4546371">//&nbsp;Verify&nbsp;verifies&nbsp;the&nbsp;signature&nbsp;in&nbsp;r,&nbsp;s&nbsp;of&nbsp;hash&nbsp;using&nbsp;the&nbsp;public&nbsp;key,&nbsp;pub.&nbsp;Its</span><br>
<span class="lineno"></span><span class="comment" id="4546451">//&nbsp;return&nbsp;value&nbsp;records&nbsp;whether&nbsp;the&nbsp;signature&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4546507">func</span>&nbsp;<span class="ident" id="4546512">Verify</span><span class="op" id="4546518">(</span><span class="ident" id="4546519">pub</span>&nbsp;<span class="op" id="4546523">*</span><span class="ident" id="4546524">PublicKey</span><span class="op" id="4546533">,</span>&nbsp;<span class="ident" id="4546535">hash</span>&nbsp;<span class="op" id="4546540">[</span><span class="op" id="4546541">]</span><span class="builtintype" id="4546542">byte</span><span class="op" id="4546546">,</span>&nbsp;<span class="ident" id="4546548">r</span><span class="op" id="4546549">,</span>&nbsp;<span class="ident" id="4546551">s</span>&nbsp;<span class="op" id="4546553">*</span><span class="ident" id="4546554">big</span><span class="op" id="4546557">.</span><span class="ident" id="4546558">Int</span><span class="op" id="4546561">)</span>&nbsp;<span class="builtintype" id="4546563">bool</span>&nbsp;<span class="op" id="4546568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4546571">//&nbsp;See&nbsp;[NSA]&nbsp;3.4.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546591">c</span>&nbsp;<span class="op" id="4546593">:=</span>&nbsp;<span class="ident" id="4546596">pub</span><span class="op" id="4546599">.</span><span class="ident" id="4546600">Curve</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546607">N</span>&nbsp;<span class="op" id="4546609">:=</span>&nbsp;<span class="ident" id="4546612">c</span><span class="op" id="4546613">.</span><span class="ident" id="4546614">Params</span><span class="op" id="4546620">(</span><span class="op" id="4546621">)</span><span class="op" id="4546622">.</span><span class="ident" id="4546623">N</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546627">if</span>&nbsp;<span class="ident" id="4546630">r</span><span class="op" id="4546631">.</span><span class="ident" id="4546632">Sign</span><span class="op" id="4546636">(</span><span class="op" id="4546637">)</span>&nbsp;<span class="op" id="4546639">==</span>&nbsp;<span class="num" id="4546642">0</span>&nbsp;<span class="op" id="4546644">||</span>&nbsp;<span class="ident" id="4546647">s</span><span class="op" id="4546648">.</span><span class="ident" id="4546649">Sign</span><span class="op" id="4546653">(</span><span class="op" id="4546654">)</span>&nbsp;<span class="op" id="4546656">==</span>&nbsp;<span class="num" id="4546659">0</span>&nbsp;<span class="op" id="4546661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546665">return</span>&nbsp;<span class="builtintype" id="4546672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546679">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546682">if</span>&nbsp;<span class="ident" id="4546685">r</span><span class="op" id="4546686">.</span><span class="ident" id="4546687">Cmp</span><span class="op" id="4546690">(</span><span class="ident" id="4546691">N</span><span class="op" id="4546692">)</span>&nbsp;<span class="op" id="4546694">&gt;=</span>&nbsp;<span class="num" id="4546697">0</span>&nbsp;<span class="op" id="4546699">||</span>&nbsp;<span class="ident" id="4546702">s</span><span class="op" id="4546703">.</span><span class="ident" id="4546704">Cmp</span><span class="op" id="4546707">(</span><span class="ident" id="4546708">N</span><span class="op" id="4546709">)</span>&nbsp;<span class="op" id="4546711">&gt;=</span>&nbsp;<span class="num" id="4546714">0</span>&nbsp;<span class="op" id="4546716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546720">return</span>&nbsp;<span class="builtintype" id="4546727">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4546734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546737">e</span>&nbsp;<span class="op" id="4546739">:=</span>&nbsp;<span class="ident" id="4546742">hashToInt</span><span class="op" id="4546751">(</span><span class="ident" id="4546752">hash</span><span class="op" id="4546756">,</span>&nbsp;<span class="ident" id="4546758">c</span><span class="op" id="4546759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546762">w</span>&nbsp;<span class="op" id="4546764">:=</span>&nbsp;<span class="builtinfunc" id="4546767">new</span><span class="op" id="4546770">(</span><span class="ident" id="4546771">big</span><span class="op" id="4546774">.</span><span class="ident" id="4546775">Int</span><span class="op" id="4546778">)</span><span class="op" id="4546779">.</span><span class="ident" id="4546780">ModInverse</span><span class="op" id="4546790">(</span><span class="ident" id="4546791">s</span><span class="op" id="4546792">,</span>&nbsp;<span class="ident" id="4546794">N</span><span class="op" id="4546795">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546799">u1</span>&nbsp;<span class="op" id="4546802">:=</span>&nbsp;<span class="ident" id="4546805">e</span><span class="op" id="4546806">.</span><span class="ident" id="4546807">Mul</span><span class="op" id="4546810">(</span><span class="ident" id="4546811">e</span><span class="op" id="4546812">,</span>&nbsp;<span class="ident" id="4546814">w</span><span class="op" id="4546815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546818">u1</span><span class="op" id="4546820">.</span><span class="ident" id="4546821">Mod</span><span class="op" id="4546824">(</span><span class="ident" id="4546825">u1</span><span class="op" id="4546827">,</span>&nbsp;<span class="ident" id="4546829">N</span><span class="op" id="4546830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546833">u2</span>&nbsp;<span class="op" id="4546836">:=</span>&nbsp;<span class="ident" id="4546839">w</span><span class="op" id="4546840">.</span><span class="ident" id="4546841">Mul</span><span class="op" id="4546844">(</span><span class="ident" id="4546845">r</span><span class="op" id="4546846">,</span>&nbsp;<span class="ident" id="4546848">w</span><span class="op" id="4546849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546852">u2</span><span class="op" id="4546854">.</span><span class="ident" id="4546855">Mod</span><span class="op" id="4546858">(</span><span class="ident" id="4546859">u2</span><span class="op" id="4546861">,</span>&nbsp;<span class="ident" id="4546863">N</span><span class="op" id="4546864">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546868">x1</span><span class="op" id="4546870">,</span>&nbsp;<span class="ident" id="4546872">y1</span>&nbsp;<span class="op" id="4546875">:=</span>&nbsp;<span class="ident" id="4546878">c</span><span class="op" id="4546879">.</span><span class="ident" id="4546880">ScalarBaseMult</span><span class="op" id="4546894">(</span><span class="ident" id="4546895">u1</span><span class="op" id="4546897">.</span><span class="ident" id="4546898">Bytes</span><span class="op" id="4546903">(</span><span class="op" id="4546904">)</span><span class="op" id="4546905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546908">x2</span><span class="op" id="4546910">,</span>&nbsp;<span class="ident" id="4546912">y2</span>&nbsp;<span class="op" id="4546915">:=</span>&nbsp;<span class="ident" id="4546918">c</span><span class="op" id="4546919">.</span><span class="ident" id="4546920">ScalarMult</span><span class="op" id="4546930">(</span><span class="ident" id="4546931">pub</span><span class="op" id="4546934">.</span><span class="ident" id="4546935">X</span><span class="op" id="4546936">,</span>&nbsp;<span class="ident" id="4546938">pub</span><span class="op" id="4546941">.</span><span class="ident" id="4546942">Y</span><span class="op" id="4546943">,</span>&nbsp;<span class="ident" id="4546945">u2</span><span class="op" id="4546947">.</span><span class="ident" id="4546948">Bytes</span><span class="op" id="4546953">(</span><span class="op" id="4546954">)</span><span class="op" id="4546955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4546958">x</span><span class="op" id="4546959">,</span>&nbsp;<span class="ident" id="4546961">y</span>&nbsp;<span class="op" id="4546963">:=</span>&nbsp;<span class="ident" id="4546966">c</span><span class="op" id="4546967">.</span><span class="ident" id="4546968">Add</span><span class="op" id="4546971">(</span><span class="ident" id="4546972">x1</span><span class="op" id="4546974">,</span>&nbsp;<span class="ident" id="4546976">y1</span><span class="op" id="4546978">,</span>&nbsp;<span class="ident" id="4546980">x2</span><span class="op" id="4546982">,</span>&nbsp;<span class="ident" id="4546984">y2</span><span class="op" id="4546986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4546989">if</span>&nbsp;<span class="ident" id="4546992">x</span><span class="op" id="4546993">.</span><span class="ident" id="4546994">Sign</span><span class="op" id="4546998">(</span><span class="op" id="4546999">)</span>&nbsp;<span class="op" id="4547001">==</span>&nbsp;<span class="num" id="4547004">0</span>&nbsp;<span class="op" id="4547006">&amp;&amp;</span>&nbsp;<span class="ident" id="4547009">y</span><span class="op" id="4547010">.</span><span class="ident" id="4547011">Sign</span><span class="op" id="4547015">(</span><span class="op" id="4547016">)</span>&nbsp;<span class="op" id="4547018">==</span>&nbsp;<span class="num" id="4547021">0</span>&nbsp;<span class="op" id="4547023">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547027">return</span>&nbsp;<span class="builtintype" id="4547034">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4547041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4547044">x</span><span class="op" id="4547045">.</span><span class="ident" id="4547046">Mod</span><span class="op" id="4547049">(</span><span class="ident" id="4547050">x</span><span class="op" id="4547051">,</span>&nbsp;<span class="ident" id="4547053">N</span><span class="op" id="4547054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4547057">return</span>&nbsp;<span class="ident" id="4547064">x</span><span class="op" id="4547065">.</span><span class="ident" id="4547066">Cmp</span><span class="op" id="4547069">(</span><span class="ident" id="4547070">r</span><span class="op" id="4547071">)</span>&nbsp;<span class="op" id="4547073">==</span>&nbsp;<span class="num" id="4547076">0</span><br>
<span class="lineno"></span><span class="op" id="4547078">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
