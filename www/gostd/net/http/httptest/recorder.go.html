<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/httptest</h2>
<ul>
<li><a href="/gostd/net/http/httptest/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder.go.html">recorder.go</a></li>
<li><a href="/gostd/net/http/httptest/recorder_test.go.html">recorder_test.go</a></li>
<li><a href="/gostd/net/http/httptest/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/httptest/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6357739">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6357794">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6357848">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6357899">//&nbsp;Package&nbsp;httptest&nbsp;provides&nbsp;utilities&nbsp;for&nbsp;HTTP&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6357956">package</span>&nbsp;<span class="ident" id="6357964">httptest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6357974">import</span>&nbsp;<span class="op" id="6357981">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6357984">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6357993">&#34;net/http&#34;</span><br>
<span class="lineno"></span><span class="op" id="6358004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358007">//&nbsp;ResponseRecorder&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;http.ResponseWriter&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6358076">//&nbsp;records&nbsp;its&nbsp;mutations&nbsp;for&nbsp;later&nbsp;inspection&nbsp;in&nbsp;tests.</span><br>
<span class="lineno">15</span><span class="keyword" id="6358132">type</span>&nbsp;<span class="ident" id="6358137">ResponseRecorder</span>&nbsp;<span class="keyword" id="6358154">struct</span>&nbsp;<span class="op" id="6358161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358164">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6358174">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6358188">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;code&nbsp;from&nbsp;WriteHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358232">HeaderMap</span>&nbsp;<span class="ident" id="6358242">http</span><span class="op" id="6358246">.</span><span class="ident" id="6358247">Header</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6358256">//&nbsp;the&nbsp;HTTP&nbsp;response&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358286">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6358296">*</span><span class="ident" id="6358297">bytes</span><span class="op" id="6358302">.</span><span class="ident" id="6358303">Buffer</span>&nbsp;<span class="comment" id="6358310">//&nbsp;if&nbsp;non-nil,&nbsp;the&nbsp;bytes.Buffer&nbsp;to&nbsp;append&nbsp;written&nbsp;data&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358369">Flushed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6358379">bool</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358386">wroteHeader</span>&nbsp;<span class="builtintype" id="6358398">bool</span><br>
<span class="lineno"></span><span class="op" id="6358403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358406">//&nbsp;NewRecorder&nbsp;returns&nbsp;an&nbsp;initialized&nbsp;ResponseRecorder.</span><br>
<span class="lineno">25</span><span class="keyword" id="6358462">func</span>&nbsp;<span class="ident" id="6358467">NewRecorder</span><span class="op" id="6358478">(</span><span class="op" id="6358479">)</span>&nbsp;<span class="op" id="6358481">*</span><span class="ident" id="6358482">ResponseRecorder</span>&nbsp;<span class="op" id="6358499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358502">return</span>&nbsp;<span class="op" id="6358509">&amp;</span><span class="ident" id="6358510">ResponseRecorder</span><span class="op" id="6358526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358530">HeaderMap</span><span class="op" id="6358539">:</span>&nbsp;<span class="builtinfunc" id="6358541">make</span><span class="op" id="6358545">(</span><span class="ident" id="6358546">http</span><span class="op" id="6358550">.</span><span class="ident" id="6358551">Header</span><span class="op" id="6358557">)</span><span class="op" id="6358558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358562">Body</span><span class="op" id="6358566">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6358573">new</span><span class="op" id="6358576">(</span><span class="ident" id="6358577">bytes</span><span class="op" id="6358582">.</span><span class="ident" id="6358583">Buffer</span><span class="op" id="6358589">)</span><span class="op" id="6358590">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358594">Code</span><span class="op" id="6358598">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="6358605">200</span><span class="op" id="6358608">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358611">}</span><br>
<span class="lineno"></span><span class="op" id="6358613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358616">//&nbsp;DefaultRemoteAddr&nbsp;is&nbsp;the&nbsp;default&nbsp;remote&nbsp;address&nbsp;to&nbsp;return&nbsp;in&nbsp;RemoteAddr&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6358694">//&nbsp;an&nbsp;explicit&nbsp;DefaultRemoteAddr&nbsp;isn&#39;t&nbsp;set&nbsp;on&nbsp;ResponseRecorder.</span><br>
<span class="lineno">35</span><span class="keyword" id="6358758">const</span>&nbsp;<span class="ident" id="6358764">DefaultRemoteAddr</span>&nbsp;<span class="op" id="6358782">=</span>&nbsp;<span class="string" id="6358784">&#34;1.2.3.4&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358795">//&nbsp;Header&nbsp;returns&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="6358835">func</span>&nbsp;<span class="op" id="6358840">(</span><span class="ident" id="6358841">rw</span>&nbsp;<span class="op" id="6358844">*</span><span class="ident" id="6358845">ResponseRecorder</span><span class="op" id="6358861">)</span>&nbsp;<span class="ident" id="6358863">Header</span><span class="op" id="6358869">(</span><span class="op" id="6358870">)</span>&nbsp;<span class="ident" id="6358872">http</span><span class="op" id="6358876">.</span><span class="ident" id="6358877">Header</span>&nbsp;<span class="op" id="6358884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358887">m</span>&nbsp;<span class="op" id="6358889">:=</span>&nbsp;<span class="ident" id="6358892">rw</span><span class="op" id="6358894">.</span><span class="ident" id="6358895">HeaderMap</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358906">if</span>&nbsp;<span class="ident" id="6358909">m</span>&nbsp;<span class="op" id="6358911">==</span>&nbsp;<span class="ident" id="6358914">nil</span>&nbsp;<span class="op" id="6358918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358922">m</span>&nbsp;<span class="op" id="6358924">=</span>&nbsp;<span class="builtinfunc" id="6358926">make</span><span class="op" id="6358930">(</span><span class="ident" id="6358931">http</span><span class="op" id="6358935">.</span><span class="ident" id="6358936">Header</span><span class="op" id="6358942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358946">rw</span><span class="op" id="6358948">.</span><span class="ident" id="6358949">HeaderMap</span>&nbsp;<span class="op" id="6358959">=</span>&nbsp;<span class="ident" id="6358961">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358967">return</span>&nbsp;<span class="ident" id="6358974">m</span><br>
<span class="lineno">45</span><span class="op" id="6358976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6358979">//&nbsp;Write&nbsp;always&nbsp;succeeds&nbsp;and&nbsp;writes&nbsp;to&nbsp;rw.Body,&nbsp;if&nbsp;not&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6359039">func</span>&nbsp;<span class="op" id="6359044">(</span><span class="ident" id="6359045">rw</span>&nbsp;<span class="op" id="6359048">*</span><span class="ident" id="6359049">ResponseRecorder</span><span class="op" id="6359065">)</span>&nbsp;<span class="ident" id="6359067">Write</span><span class="op" id="6359072">(</span><span class="ident" id="6359073">buf</span>&nbsp;<span class="op" id="6359077">[</span><span class="op" id="6359078">]</span><span class="builtintype" id="6359079">byte</span><span class="op" id="6359083">)</span>&nbsp;<span class="op" id="6359085">(</span><span class="builtintype" id="6359086">int</span><span class="op" id="6359089">,</span>&nbsp;<span class="builtintype" id="6359091">error</span><span class="op" id="6359096">)</span>&nbsp;<span class="op" id="6359098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359101">if</span>&nbsp;<span class="op" id="6359104">!</span><span class="ident" id="6359105">rw</span><span class="op" id="6359107">.</span><span class="ident" id="6359108">wroteHeader</span>&nbsp;<span class="op" id="6359120">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359124">rw</span><span class="op" id="6359126">.</span><span class="ident" id="6359127">WriteHeader</span><span class="op" id="6359138">(</span><span class="num" id="6359139">200</span><span class="op" id="6359142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359148">if</span>&nbsp;<span class="ident" id="6359151">rw</span><span class="op" id="6359153">.</span><span class="ident" id="6359154">Body</span>&nbsp;<span class="op" id="6359159">!=</span>&nbsp;<span class="ident" id="6359162">nil</span>&nbsp;<span class="op" id="6359166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359170">rw</span><span class="op" id="6359172">.</span><span class="ident" id="6359173">Body</span><span class="op" id="6359177">.</span><span class="ident" id="6359178">Write</span><span class="op" id="6359183">(</span><span class="ident" id="6359184">buf</span><span class="op" id="6359187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359190">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359193">return</span>&nbsp;<span class="builtinfunc" id="6359200">len</span><span class="op" id="6359203">(</span><span class="ident" id="6359204">buf</span><span class="op" id="6359207">)</span><span class="op" id="6359208">,</span>&nbsp;<span class="ident" id="6359210">nil</span><br>
<span class="lineno"></span><span class="op" id="6359214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6359217">//&nbsp;WriteHeader&nbsp;sets&nbsp;rw.Code.</span><br>
<span class="lineno"></span><span class="keyword" id="6359246">func</span>&nbsp;<span class="op" id="6359251">(</span><span class="ident" id="6359252">rw</span>&nbsp;<span class="op" id="6359255">*</span><span class="ident" id="6359256">ResponseRecorder</span><span class="op" id="6359272">)</span>&nbsp;<span class="ident" id="6359274">WriteHeader</span><span class="op" id="6359285">(</span><span class="ident" id="6359286">code</span>&nbsp;<span class="builtintype" id="6359291">int</span><span class="op" id="6359294">)</span>&nbsp;<span class="op" id="6359296">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359299">if</span>&nbsp;<span class="op" id="6359302">!</span><span class="ident" id="6359303">rw</span><span class="op" id="6359305">.</span><span class="ident" id="6359306">wroteHeader</span>&nbsp;<span class="op" id="6359318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359322">rw</span><span class="op" id="6359324">.</span><span class="ident" id="6359325">Code</span>&nbsp;<span class="op" id="6359330">=</span>&nbsp;<span class="ident" id="6359332">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359341">rw</span><span class="op" id="6359343">.</span><span class="ident" id="6359344">wroteHeader</span>&nbsp;<span class="op" id="6359356">=</span>&nbsp;<span class="builtintype" id="6359358">true</span><br>
<span class="lineno"></span><span class="op" id="6359363">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="6359366">//&nbsp;Flush&nbsp;sets&nbsp;rw.Flushed&nbsp;to&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="6359400">func</span>&nbsp;<span class="op" id="6359405">(</span><span class="ident" id="6359406">rw</span>&nbsp;<span class="op" id="6359409">*</span><span class="ident" id="6359410">ResponseRecorder</span><span class="op" id="6359426">)</span>&nbsp;<span class="ident" id="6359428">Flush</span><span class="op" id="6359433">(</span><span class="op" id="6359434">)</span>&nbsp;<span class="op" id="6359436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359439">if</span>&nbsp;<span class="op" id="6359442">!</span><span class="ident" id="6359443">rw</span><span class="op" id="6359445">.</span><span class="ident" id="6359446">wroteHeader</span>&nbsp;<span class="op" id="6359458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359462">rw</span><span class="op" id="6359464">.</span><span class="ident" id="6359465">WriteHeader</span><span class="op" id="6359476">(</span><span class="num" id="6359477">200</span><span class="op" id="6359480">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359486">rw</span><span class="op" id="6359488">.</span><span class="ident" id="6359489">Flushed</span>&nbsp;<span class="op" id="6359497">=</span>&nbsp;<span class="builtintype" id="6359499">true</span><br>
<span class="lineno"></span><span class="op" id="6359504">}</span>
</div>
</body>
</html>
