<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5639452">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5639507">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5639561">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5639612">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5639689">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5639719">//</span><br>
<span class="lineno"></span><span class="comment" id="5639722">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5639738">//</span><br>
<span class="lineno">10</span><span class="comment" id="5639741">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5639774">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5639808">//</span><br>
<span class="lineno"></span><span class="comment" id="5639811">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5639837">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5639922">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5640013">//</span><br>
<span class="lineno"></span><span class="keyword" id="5640016">package</span>&nbsp;<span class="ident" id="5640024">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5640037">import</span>&nbsp;<span class="op" id="5640044">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640047">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640056">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640075">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640081">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5640091">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5640098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5640101">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5640163">type</span>&nbsp;<span class="ident" id="5640168">Index</span>&nbsp;<span class="keyword" id="5640174">struct</span>&nbsp;<span class="op" id="5640181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640184">data</span>&nbsp;<span class="op" id="5640189">[</span><span class="op" id="5640190">]</span><span class="builtintype" id="5640191">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640197">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5640202">[</span><span class="op" id="5640203">]</span><span class="builtintype" id="5640204">int</span>&nbsp;<span class="comment" id="5640208">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5640255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5640258">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5640295">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5640352">func</span>&nbsp;<span class="ident" id="5640357">New</span><span class="op" id="5640360">(</span><span class="ident" id="5640361">data</span>&nbsp;<span class="op" id="5640366">[</span><span class="op" id="5640367">]</span><span class="builtintype" id="5640368">byte</span><span class="op" id="5640372">)</span>&nbsp;<span class="op" id="5640374">*</span><span class="ident" id="5640375">Index</span>&nbsp;<span class="op" id="5640381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640384">return</span>&nbsp;<span class="op" id="5640391">&amp;</span><span class="ident" id="5640392">Index</span><span class="op" id="5640397">{</span><span class="ident" id="5640398">data</span><span class="op" id="5640402">,</span>&nbsp;<span class="ident" id="5640404">qsufsort</span><span class="op" id="5640412">(</span><span class="ident" id="5640413">data</span><span class="op" id="5640417">)</span><span class="op" id="5640418">}</span><br>
<span class="lineno"></span><span class="op" id="5640420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5640423">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5640487">func</span>&nbsp;<span class="ident" id="5640492">writeInt</span><span class="op" id="5640500">(</span><span class="ident" id="5640501">w</span>&nbsp;<span class="ident" id="5640503">io</span><span class="op" id="5640505">.</span><span class="ident" id="5640506">Writer</span><span class="op" id="5640512">,</span>&nbsp;<span class="ident" id="5640514">buf</span>&nbsp;<span class="op" id="5640518">[</span><span class="op" id="5640519">]</span><span class="builtintype" id="5640520">byte</span><span class="op" id="5640524">,</span>&nbsp;<span class="ident" id="5640526">x</span>&nbsp;<span class="builtintype" id="5640528">int</span><span class="op" id="5640531">)</span>&nbsp;<span class="builtintype" id="5640533">error</span>&nbsp;<span class="op" id="5640539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640542">binary</span><span class="op" id="5640548">.</span><span class="ident" id="5640549">PutVarint</span><span class="op" id="5640558">(</span><span class="ident" id="5640559">buf</span><span class="op" id="5640562">,</span>&nbsp;<span class="ident" id="5640564">int64</span><span class="op" id="5640569">(</span><span class="ident" id="5640570">x</span><span class="op" id="5640571">)</span><span class="op" id="5640572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640575">_</span><span class="op" id="5640576">,</span>&nbsp;<span class="ident" id="5640578">err</span>&nbsp;<span class="op" id="5640582">:=</span>&nbsp;<span class="ident" id="5640585">w</span><span class="op" id="5640586">.</span><span class="ident" id="5640587">Write</span><span class="op" id="5640592">(</span><span class="ident" id="5640593">buf</span><span class="op" id="5640596">[</span><span class="num" id="5640597">0</span><span class="op" id="5640598">:</span><span class="ident" id="5640599">binary</span><span class="op" id="5640605">.</span><span class="ident" id="5640606">MaxVarintLen64</span><span class="op" id="5640620">]</span><span class="op" id="5640621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640624">return</span>&nbsp;<span class="ident" id="5640631">err</span><br>
<span class="lineno"></span><span class="op" id="5640635">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5640638">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5640715">func</span>&nbsp;<span class="ident" id="5640720">readInt</span><span class="op" id="5640727">(</span><span class="ident" id="5640728">r</span>&nbsp;<span class="ident" id="5640730">io</span><span class="op" id="5640732">.</span><span class="ident" id="5640733">Reader</span><span class="op" id="5640739">,</span>&nbsp;<span class="ident" id="5640741">buf</span>&nbsp;<span class="op" id="5640745">[</span><span class="op" id="5640746">]</span><span class="builtintype" id="5640747">byte</span><span class="op" id="5640751">)</span>&nbsp;<span class="op" id="5640753">(</span><span class="builtintype" id="5640754">int</span><span class="op" id="5640757">,</span>&nbsp;<span class="builtintype" id="5640759">error</span><span class="op" id="5640764">)</span>&nbsp;<span class="op" id="5640766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640769">_</span><span class="op" id="5640770">,</span>&nbsp;<span class="ident" id="5640772">err</span>&nbsp;<span class="op" id="5640776">:=</span>&nbsp;<span class="ident" id="5640779">io</span><span class="op" id="5640781">.</span><span class="ident" id="5640782">ReadFull</span><span class="op" id="5640790">(</span><span class="ident" id="5640791">r</span><span class="op" id="5640792">,</span>&nbsp;<span class="ident" id="5640794">buf</span><span class="op" id="5640797">[</span><span class="num" id="5640798">0</span><span class="op" id="5640799">:</span><span class="ident" id="5640800">binary</span><span class="op" id="5640806">.</span><span class="ident" id="5640807">MaxVarintLen64</span><span class="op" id="5640821">]</span><span class="op" id="5640822">)</span>&nbsp;<span class="comment" id="5640824">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5640854">x</span><span class="op" id="5640855">,</span>&nbsp;<span class="ident" id="5640857">_</span>&nbsp;<span class="op" id="5640859">:=</span>&nbsp;<span class="ident" id="5640862">binary</span><span class="op" id="5640868">.</span><span class="ident" id="5640869">Varint</span><span class="op" id="5640875">(</span><span class="ident" id="5640876">buf</span><span class="op" id="5640879">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5640882">return</span>&nbsp;<span class="builtintype" id="5640889">int</span><span class="op" id="5640892">(</span><span class="ident" id="5640893">x</span><span class="op" id="5640894">)</span><span class="op" id="5640895">,</span>&nbsp;<span class="ident" id="5640897">err</span><br>
<span class="lineno"></span><span class="op" id="5640901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5640904">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5640954">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5640990">func</span>&nbsp;<span class="ident" id="5640995">writeSlice</span><span class="op" id="5641005">(</span><span class="ident" id="5641006">w</span>&nbsp;<span class="ident" id="5641008">io</span><span class="op" id="5641010">.</span><span class="ident" id="5641011">Writer</span><span class="op" id="5641017">,</span>&nbsp;<span class="ident" id="5641019">buf</span>&nbsp;<span class="op" id="5641023">[</span><span class="op" id="5641024">]</span><span class="builtintype" id="5641025">byte</span><span class="op" id="5641029">,</span>&nbsp;<span class="ident" id="5641031">data</span>&nbsp;<span class="op" id="5641036">[</span><span class="op" id="5641037">]</span><span class="builtintype" id="5641038">int</span><span class="op" id="5641041">)</span>&nbsp;<span class="op" id="5641043">(</span><span class="ident" id="5641044">n</span>&nbsp;<span class="builtintype" id="5641046">int</span><span class="op" id="5641049">,</span>&nbsp;<span class="ident" id="5641051">err</span>&nbsp;<span class="builtintype" id="5641055">error</span><span class="op" id="5641060">)</span>&nbsp;<span class="op" id="5641062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641065">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641109">p</span>&nbsp;<span class="op" id="5641111">:=</span>&nbsp;<span class="ident" id="5641114">binary</span><span class="op" id="5641120">.</span><span class="ident" id="5641121">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641137">for</span>&nbsp;<span class="op" id="5641141">;</span>&nbsp;<span class="ident" id="5641143">n</span>&nbsp;<span class="op" id="5641145">&lt;</span>&nbsp;<span class="builtinfunc" id="5641147">len</span><span class="op" id="5641150">(</span><span class="ident" id="5641151">data</span><span class="op" id="5641155">)</span>&nbsp;<span class="op" id="5641157">&amp;&amp;</span>&nbsp;<span class="ident" id="5641160">p</span><span class="op" id="5641161">+</span><span class="ident" id="5641162">binary</span><span class="op" id="5641168">.</span><span class="ident" id="5641169">MaxVarintLen64</span>&nbsp;<span class="op" id="5641184">&lt;=</span>&nbsp;<span class="builtinfunc" id="5641187">len</span><span class="op" id="5641190">(</span><span class="ident" id="5641191">buf</span><span class="op" id="5641194">)</span><span class="op" id="5641195">;</span>&nbsp;<span class="ident" id="5641197">n</span><span class="op" id="5641198">++</span>&nbsp;<span class="op" id="5641201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641205">p</span>&nbsp;<span class="op" id="5641207">+=</span>&nbsp;<span class="ident" id="5641210">binary</span><span class="op" id="5641216">.</span><span class="ident" id="5641217">PutUvarint</span><span class="op" id="5641227">(</span><span class="ident" id="5641228">buf</span><span class="op" id="5641231">[</span><span class="ident" id="5641232">p</span><span class="op" id="5641233">:</span><span class="op" id="5641234">]</span><span class="op" id="5641235">,</span>&nbsp;<span class="ident" id="5641237">uint64</span><span class="op" id="5641243">(</span><span class="ident" id="5641244">data</span><span class="op" id="5641248">[</span><span class="ident" id="5641249">n</span><span class="op" id="5641250">]</span><span class="op" id="5641251">)</span><span class="op" id="5641252">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641259">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641282">binary</span><span class="op" id="5641288">.</span><span class="ident" id="5641289">PutVarint</span><span class="op" id="5641298">(</span><span class="ident" id="5641299">buf</span><span class="op" id="5641302">,</span>&nbsp;<span class="ident" id="5641304">int64</span><span class="op" id="5641309">(</span><span class="ident" id="5641310">p</span><span class="op" id="5641311">)</span><span class="op" id="5641312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641316">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641333">_</span><span class="op" id="5641334">,</span>&nbsp;<span class="ident" id="5641336">err</span>&nbsp;<span class="op" id="5641340">=</span>&nbsp;<span class="ident" id="5641342">w</span><span class="op" id="5641343">.</span><span class="ident" id="5641344">Write</span><span class="op" id="5641349">(</span><span class="ident" id="5641350">buf</span><span class="op" id="5641353">[</span><span class="num" id="5641354">0</span><span class="op" id="5641355">:</span><span class="ident" id="5641356">p</span><span class="op" id="5641357">]</span><span class="op" id="5641358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641361">return</span><br>
<span class="lineno"></span><span class="op" id="5641368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5641371">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5641421">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5641456">func</span>&nbsp;<span class="ident" id="5641461">readSlice</span><span class="op" id="5641470">(</span><span class="ident" id="5641471">r</span>&nbsp;<span class="ident" id="5641473">io</span><span class="op" id="5641475">.</span><span class="ident" id="5641476">Reader</span><span class="op" id="5641482">,</span>&nbsp;<span class="ident" id="5641484">buf</span>&nbsp;<span class="op" id="5641488">[</span><span class="op" id="5641489">]</span><span class="builtintype" id="5641490">byte</span><span class="op" id="5641494">,</span>&nbsp;<span class="ident" id="5641496">data</span>&nbsp;<span class="op" id="5641501">[</span><span class="op" id="5641502">]</span><span class="builtintype" id="5641503">int</span><span class="op" id="5641506">)</span>&nbsp;<span class="op" id="5641508">(</span><span class="ident" id="5641509">n</span>&nbsp;<span class="builtintype" id="5641511">int</span><span class="op" id="5641514">,</span>&nbsp;<span class="ident" id="5641516">err</span>&nbsp;<span class="builtintype" id="5641520">error</span><span class="op" id="5641525">)</span>&nbsp;<span class="op" id="5641527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641530">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641551">var</span>&nbsp;<span class="ident" id="5641555">size</span>&nbsp;<span class="builtintype" id="5641560">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641565">size</span><span class="op" id="5641569">,</span>&nbsp;<span class="ident" id="5641571">err</span>&nbsp;<span class="op" id="5641575">=</span>&nbsp;<span class="ident" id="5641577">readInt</span><span class="op" id="5641584">(</span><span class="ident" id="5641585">r</span><span class="op" id="5641586">,</span>&nbsp;<span class="ident" id="5641588">buf</span><span class="op" id="5641591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641594">if</span>&nbsp;<span class="ident" id="5641597">err</span>&nbsp;<span class="op" id="5641601">!=</span>&nbsp;<span class="ident" id="5641604">nil</span>&nbsp;<span class="op" id="5641608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641612">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641624">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641653">if</span>&nbsp;<span class="ident" id="5641656">_</span><span class="op" id="5641657">,</span>&nbsp;<span class="ident" id="5641659">err</span>&nbsp;<span class="op" id="5641663">=</span>&nbsp;<span class="ident" id="5641665">io</span><span class="op" id="5641667">.</span><span class="ident" id="5641668">ReadFull</span><span class="op" id="5641676">(</span><span class="ident" id="5641677">r</span><span class="op" id="5641678">,</span>&nbsp;<span class="ident" id="5641680">buf</span><span class="op" id="5641683">[</span><span class="ident" id="5641684">binary</span><span class="op" id="5641690">.</span><span class="ident" id="5641691">MaxVarintLen64</span><span class="op" id="5641705">:</span><span class="ident" id="5641706">size</span><span class="op" id="5641710">]</span><span class="op" id="5641711">)</span><span class="op" id="5641712">;</span>&nbsp;<span class="ident" id="5641714">err</span>&nbsp;<span class="op" id="5641718">!=</span>&nbsp;<span class="ident" id="5641721">nil</span>&nbsp;<span class="op" id="5641725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641729">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5641741">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641787">for</span>&nbsp;<span class="ident" id="5641791">p</span>&nbsp;<span class="op" id="5641793">:=</span>&nbsp;<span class="ident" id="5641796">binary</span><span class="op" id="5641802">.</span><span class="ident" id="5641803">MaxVarintLen64</span><span class="op" id="5641817">;</span>&nbsp;<span class="ident" id="5641819">p</span>&nbsp;<span class="op" id="5641821">&lt;</span>&nbsp;<span class="ident" id="5641823">size</span><span class="op" id="5641827">;</span>&nbsp;<span class="ident" id="5641829">n</span><span class="op" id="5641830">++</span>&nbsp;<span class="op" id="5641833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641837">x</span><span class="op" id="5641838">,</span>&nbsp;<span class="ident" id="5641840">w</span>&nbsp;<span class="op" id="5641842">:=</span>&nbsp;<span class="ident" id="5641845">binary</span><span class="op" id="5641851">.</span><span class="ident" id="5641852">Uvarint</span><span class="op" id="5641859">(</span><span class="ident" id="5641860">buf</span><span class="op" id="5641863">[</span><span class="ident" id="5641864">p</span><span class="op" id="5641865">:</span><span class="op" id="5641866">]</span><span class="op" id="5641867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641871">data</span><span class="op" id="5641875">[</span><span class="ident" id="5641876">n</span><span class="op" id="5641877">]</span>&nbsp;<span class="op" id="5641879">=</span>&nbsp;<span class="builtintype" id="5641881">int</span><span class="op" id="5641884">(</span><span class="ident" id="5641885">x</span><span class="op" id="5641886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5641890">p</span>&nbsp;<span class="op" id="5641892">+=</span>&nbsp;<span class="ident" id="5641895">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5641898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5641902">return</span><br>
<span class="lineno"></span><span class="op" id="5641909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5641912">const</span>&nbsp;<span class="ident" id="5641918">bufSize</span>&nbsp;<span class="op" id="5641926">=</span>&nbsp;<span class="num" id="5641928">16</span>&nbsp;<span class="op" id="5641931">&lt;&lt;</span>&nbsp;<span class="num" id="5641934">10</span>&nbsp;<span class="comment" id="5641937">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5641977">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5642035">func</span>&nbsp;<span class="op" id="5642040">(</span><span class="ident" id="5642041">x</span>&nbsp;<span class="op" id="5642043">*</span><span class="ident" id="5642044">Index</span><span class="op" id="5642049">)</span>&nbsp;<span class="ident" id="5642051">Read</span><span class="op" id="5642055">(</span><span class="ident" id="5642056">r</span>&nbsp;<span class="ident" id="5642058">io</span><span class="op" id="5642060">.</span><span class="ident" id="5642061">Reader</span><span class="op" id="5642067">)</span>&nbsp;<span class="builtintype" id="5642069">error</span>&nbsp;<span class="op" id="5642075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642078">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642103">buf</span>&nbsp;<span class="op" id="5642107">:=</span>&nbsp;<span class="builtinfunc" id="5642110">make</span><span class="op" id="5642114">(</span><span class="op" id="5642115">[</span><span class="op" id="5642116">]</span><span class="builtintype" id="5642117">byte</span><span class="op" id="5642121">,</span>&nbsp;<span class="ident" id="5642123">bufSize</span><span class="op" id="5642130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642134">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642150">n</span><span class="op" id="5642151">,</span>&nbsp;<span class="ident" id="5642153">err</span>&nbsp;<span class="op" id="5642157">:=</span>&nbsp;<span class="ident" id="5642160">readInt</span><span class="op" id="5642167">(</span><span class="ident" id="5642168">r</span><span class="op" id="5642169">,</span>&nbsp;<span class="ident" id="5642171">buf</span><span class="op" id="5642174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642177">if</span>&nbsp;<span class="ident" id="5642180">err</span>&nbsp;<span class="op" id="5642184">!=</span>&nbsp;<span class="ident" id="5642187">nil</span>&nbsp;<span class="op" id="5642191">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642195">return</span>&nbsp;<span class="ident" id="5642202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642211">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642230">if</span>&nbsp;<span class="num" id="5642233">2</span><span class="op" id="5642234">*</span><span class="ident" id="5642235">n</span>&nbsp;<span class="op" id="5642237">&lt;</span>&nbsp;<span class="builtinfunc" id="5642239">cap</span><span class="op" id="5642242">(</span><span class="ident" id="5642243">x</span><span class="op" id="5642244">.</span><span class="ident" id="5642245">data</span><span class="op" id="5642249">)</span>&nbsp;<span class="op" id="5642251">||</span>&nbsp;<span class="builtinfunc" id="5642254">cap</span><span class="op" id="5642257">(</span><span class="ident" id="5642258">x</span><span class="op" id="5642259">.</span><span class="ident" id="5642260">data</span><span class="op" id="5642264">)</span>&nbsp;<span class="op" id="5642266">&lt;</span>&nbsp;<span class="ident" id="5642268">n</span>&nbsp;<span class="op" id="5642270">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642274">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642328">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642370">x</span><span class="op" id="5642371">.</span><span class="ident" id="5642372">data</span>&nbsp;<span class="op" id="5642377">=</span>&nbsp;<span class="builtinfunc" id="5642379">make</span><span class="op" id="5642383">(</span><span class="op" id="5642384">[</span><span class="op" id="5642385">]</span><span class="builtintype" id="5642386">byte</span><span class="op" id="5642390">,</span>&nbsp;<span class="ident" id="5642392">n</span><span class="op" id="5642393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642397">x</span><span class="op" id="5642398">.</span><span class="ident" id="5642399">sa</span>&nbsp;<span class="op" id="5642402">=</span>&nbsp;<span class="builtinfunc" id="5642404">make</span><span class="op" id="5642408">(</span><span class="op" id="5642409">[</span><span class="op" id="5642410">]</span><span class="builtintype" id="5642411">int</span><span class="op" id="5642414">,</span>&nbsp;<span class="ident" id="5642416">n</span><span class="op" id="5642417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642420">}</span>&nbsp;<span class="keyword" id="5642422">else</span>&nbsp;<span class="op" id="5642427">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642431">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642460">x</span><span class="op" id="5642461">.</span><span class="ident" id="5642462">data</span>&nbsp;<span class="op" id="5642467">=</span>&nbsp;<span class="ident" id="5642469">x</span><span class="op" id="5642470">.</span><span class="ident" id="5642471">data</span><span class="op" id="5642475">[</span><span class="num" id="5642476">0</span><span class="op" id="5642477">:</span><span class="ident" id="5642478">n</span><span class="op" id="5642479">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642483">x</span><span class="op" id="5642484">.</span><span class="ident" id="5642485">sa</span>&nbsp;<span class="op" id="5642488">=</span>&nbsp;<span class="ident" id="5642490">x</span><span class="op" id="5642491">.</span><span class="ident" id="5642492">sa</span><span class="op" id="5642494">[</span><span class="num" id="5642495">0</span><span class="op" id="5642496">:</span><span class="ident" id="5642497">n</span><span class="op" id="5642498">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642505">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642519">if</span>&nbsp;<span class="ident" id="5642522">_</span><span class="op" id="5642523">,</span>&nbsp;<span class="ident" id="5642525">err</span>&nbsp;<span class="op" id="5642529">:=</span>&nbsp;<span class="ident" id="5642532">io</span><span class="op" id="5642534">.</span><span class="ident" id="5642535">ReadFull</span><span class="op" id="5642543">(</span><span class="ident" id="5642544">r</span><span class="op" id="5642545">,</span>&nbsp;<span class="ident" id="5642547">x</span><span class="op" id="5642548">.</span><span class="ident" id="5642549">data</span><span class="op" id="5642553">)</span><span class="op" id="5642554">;</span>&nbsp;<span class="ident" id="5642556">err</span>&nbsp;<span class="op" id="5642560">!=</span>&nbsp;<span class="ident" id="5642563">nil</span>&nbsp;<span class="op" id="5642567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642571">return</span>&nbsp;<span class="ident" id="5642578">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642587">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642602">for</span>&nbsp;<span class="ident" id="5642606">sa</span>&nbsp;<span class="op" id="5642609">:=</span>&nbsp;<span class="ident" id="5642612">x</span><span class="op" id="5642613">.</span><span class="ident" id="5642614">sa</span><span class="op" id="5642616">;</span>&nbsp;<span class="builtinfunc" id="5642618">len</span><span class="op" id="5642621">(</span><span class="ident" id="5642622">sa</span><span class="op" id="5642624">)</span>&nbsp;<span class="op" id="5642626">&gt;</span>&nbsp;<span class="num" id="5642628">0</span><span class="op" id="5642629">;</span>&nbsp;<span class="op" id="5642631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642635">n</span><span class="op" id="5642636">,</span>&nbsp;<span class="ident" id="5642638">err</span>&nbsp;<span class="op" id="5642642">:=</span>&nbsp;<span class="ident" id="5642645">readSlice</span><span class="op" id="5642654">(</span><span class="ident" id="5642655">r</span><span class="op" id="5642656">,</span>&nbsp;<span class="ident" id="5642658">buf</span><span class="op" id="5642661">,</span>&nbsp;<span class="ident" id="5642663">sa</span><span class="op" id="5642665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642669">if</span>&nbsp;<span class="ident" id="5642672">err</span>&nbsp;<span class="op" id="5642676">!=</span>&nbsp;<span class="ident" id="5642679">nil</span>&nbsp;<span class="op" id="5642683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642688">return</span>&nbsp;<span class="ident" id="5642695">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642705">sa</span>&nbsp;<span class="op" id="5642708">=</span>&nbsp;<span class="ident" id="5642710">sa</span><span class="op" id="5642712">[</span><span class="ident" id="5642713">n</span><span class="op" id="5642714">:</span><span class="op" id="5642715">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642721">return</span>&nbsp;<span class="ident" id="5642728">nil</span><br>
<span class="lineno"></span><span class="op" id="5642732">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5642735">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5642769">func</span>&nbsp;<span class="op" id="5642774">(</span><span class="ident" id="5642775">x</span>&nbsp;<span class="op" id="5642777">*</span><span class="ident" id="5642778">Index</span><span class="op" id="5642783">)</span>&nbsp;<span class="ident" id="5642785">Write</span><span class="op" id="5642790">(</span><span class="ident" id="5642791">w</span>&nbsp;<span class="ident" id="5642793">io</span><span class="op" id="5642795">.</span><span class="ident" id="5642796">Writer</span><span class="op" id="5642802">)</span>&nbsp;<span class="builtintype" id="5642804">error</span>&nbsp;<span class="op" id="5642810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642813">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5642839">buf</span>&nbsp;<span class="op" id="5642843">:=</span>&nbsp;<span class="builtinfunc" id="5642846">make</span><span class="op" id="5642850">(</span><span class="op" id="5642851">[</span><span class="op" id="5642852">]</span><span class="builtintype" id="5642853">byte</span><span class="op" id="5642857">,</span>&nbsp;<span class="ident" id="5642859">bufSize</span><span class="op" id="5642866">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642870">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642887">if</span>&nbsp;<span class="ident" id="5642890">err</span>&nbsp;<span class="op" id="5642894">:=</span>&nbsp;<span class="ident" id="5642897">writeInt</span><span class="op" id="5642905">(</span><span class="ident" id="5642906">w</span><span class="op" id="5642907">,</span>&nbsp;<span class="ident" id="5642909">buf</span><span class="op" id="5642912">,</span>&nbsp;<span class="builtinfunc" id="5642914">len</span><span class="op" id="5642917">(</span><span class="ident" id="5642918">x</span><span class="op" id="5642919">.</span><span class="ident" id="5642920">data</span><span class="op" id="5642924">)</span><span class="op" id="5642925">)</span><span class="op" id="5642926">;</span>&nbsp;<span class="ident" id="5642928">err</span>&nbsp;<span class="op" id="5642932">!=</span>&nbsp;<span class="ident" id="5642935">nil</span>&nbsp;<span class="op" id="5642939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642943">return</span>&nbsp;<span class="ident" id="5642950">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5642955">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5642959">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5642974">if</span>&nbsp;<span class="ident" id="5642977">_</span><span class="op" id="5642978">,</span>&nbsp;<span class="ident" id="5642980">err</span>&nbsp;<span class="op" id="5642984">:=</span>&nbsp;<span class="ident" id="5642987">w</span><span class="op" id="5642988">.</span><span class="ident" id="5642989">Write</span><span class="op" id="5642994">(</span><span class="ident" id="5642995">x</span><span class="op" id="5642996">.</span><span class="ident" id="5642997">data</span><span class="op" id="5643001">)</span><span class="op" id="5643002">;</span>&nbsp;<span class="ident" id="5643004">err</span>&nbsp;<span class="op" id="5643008">!=</span>&nbsp;<span class="ident" id="5643011">nil</span>&nbsp;<span class="op" id="5643015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643019">return</span>&nbsp;<span class="ident" id="5643026">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643031">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643035">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643051">for</span>&nbsp;<span class="ident" id="5643055">sa</span>&nbsp;<span class="op" id="5643058">:=</span>&nbsp;<span class="ident" id="5643061">x</span><span class="op" id="5643062">.</span><span class="ident" id="5643063">sa</span><span class="op" id="5643065">;</span>&nbsp;<span class="builtinfunc" id="5643067">len</span><span class="op" id="5643070">(</span><span class="ident" id="5643071">sa</span><span class="op" id="5643073">)</span>&nbsp;<span class="op" id="5643075">&gt;</span>&nbsp;<span class="num" id="5643077">0</span><span class="op" id="5643078">;</span>&nbsp;<span class="op" id="5643080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643084">n</span><span class="op" id="5643085">,</span>&nbsp;<span class="ident" id="5643087">err</span>&nbsp;<span class="op" id="5643091">:=</span>&nbsp;<span class="ident" id="5643094">writeSlice</span><span class="op" id="5643104">(</span><span class="ident" id="5643105">w</span><span class="op" id="5643106">,</span>&nbsp;<span class="ident" id="5643108">buf</span><span class="op" id="5643111">,</span>&nbsp;<span class="ident" id="5643113">sa</span><span class="op" id="5643115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643119">if</span>&nbsp;<span class="ident" id="5643122">err</span>&nbsp;<span class="op" id="5643126">!=</span>&nbsp;<span class="ident" id="5643129">nil</span>&nbsp;<span class="op" id="5643133">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643138">return</span>&nbsp;<span class="ident" id="5643145">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643155">sa</span>&nbsp;<span class="op" id="5643158">=</span>&nbsp;<span class="ident" id="5643160">sa</span><span class="op" id="5643162">[</span><span class="ident" id="5643163">n</span><span class="op" id="5643164">:</span><span class="op" id="5643165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5643168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643171">return</span>&nbsp;<span class="ident" id="5643178">nil</span><br>
<span class="lineno">160</span><span class="op" id="5643182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643185">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5643245">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5643273">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5643276">func</span>&nbsp;<span class="op" id="5643281">(</span><span class="ident" id="5643282">x</span>&nbsp;<span class="op" id="5643284">*</span><span class="ident" id="5643285">Index</span><span class="op" id="5643290">)</span>&nbsp;<span class="ident" id="5643292">Bytes</span><span class="op" id="5643297">(</span><span class="op" id="5643298">)</span>&nbsp;<span class="op" id="5643300">[</span><span class="op" id="5643301">]</span><span class="builtintype" id="5643302">byte</span>&nbsp;<span class="op" id="5643307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643310">return</span>&nbsp;<span class="ident" id="5643317">x</span><span class="op" id="5643318">.</span><span class="ident" id="5643319">data</span><br>
<span class="lineno"></span><span class="op" id="5643324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5643327">func</span>&nbsp;<span class="op" id="5643332">(</span><span class="ident" id="5643333">x</span>&nbsp;<span class="op" id="5643335">*</span><span class="ident" id="5643336">Index</span><span class="op" id="5643341">)</span>&nbsp;<span class="ident" id="5643343">at</span><span class="op" id="5643345">(</span><span class="ident" id="5643346">i</span>&nbsp;<span class="builtintype" id="5643348">int</span><span class="op" id="5643351">)</span>&nbsp;<span class="op" id="5643353">[</span><span class="op" id="5643354">]</span><span class="builtintype" id="5643355">byte</span>&nbsp;<span class="op" id="5643360">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643363">return</span>&nbsp;<span class="ident" id="5643370">x</span><span class="op" id="5643371">.</span><span class="ident" id="5643372">data</span><span class="op" id="5643376">[</span><span class="ident" id="5643377">x</span><span class="op" id="5643378">.</span><span class="ident" id="5643379">sa</span><span class="op" id="5643381">[</span><span class="ident" id="5643382">i</span><span class="op" id="5643383">]</span><span class="op" id="5643384">:</span><span class="op" id="5643385">]</span><br>
<span class="lineno"></span><span class="op" id="5643387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643390">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5643458">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5643494">func</span>&nbsp;<span class="op" id="5643499">(</span><span class="ident" id="5643500">x</span>&nbsp;<span class="op" id="5643502">*</span><span class="ident" id="5643503">Index</span><span class="op" id="5643508">)</span>&nbsp;<span class="ident" id="5643510">lookupAll</span><span class="op" id="5643519">(</span><span class="ident" id="5643520">s</span>&nbsp;<span class="op" id="5643522">[</span><span class="op" id="5643523">]</span><span class="builtintype" id="5643524">byte</span><span class="op" id="5643528">)</span>&nbsp;<span class="op" id="5643530">[</span><span class="op" id="5643531">]</span><span class="builtintype" id="5643532">int</span>&nbsp;<span class="op" id="5643536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643539">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643582">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643635">i</span>&nbsp;<span class="op" id="5643637">:=</span>&nbsp;<span class="ident" id="5643640">sort</span><span class="op" id="5643644">.</span><span class="ident" id="5643645">Search</span><span class="op" id="5643651">(</span><span class="builtinfunc" id="5643652">len</span><span class="op" id="5643655">(</span><span class="ident" id="5643656">x</span><span class="op" id="5643657">.</span><span class="ident" id="5643658">sa</span><span class="op" id="5643660">)</span><span class="op" id="5643661">,</span>&nbsp;<span class="keyword" id="5643663">func</span><span class="op" id="5643667">(</span><span class="ident" id="5643668">i</span>&nbsp;<span class="builtintype" id="5643670">int</span><span class="op" id="5643673">)</span>&nbsp;<span class="builtintype" id="5643675">bool</span>&nbsp;<span class="op" id="5643680">{</span>&nbsp;<span class="keyword" id="5643682">return</span>&nbsp;<span class="ident" id="5643689">bytes</span><span class="op" id="5643694">.</span><span class="ident" id="5643695">Compare</span><span class="op" id="5643702">(</span><span class="ident" id="5643703">x</span><span class="op" id="5643704">.</span><span class="ident" id="5643705">at</span><span class="op" id="5643707">(</span><span class="ident" id="5643708">i</span><span class="op" id="5643709">)</span><span class="op" id="5643710">,</span>&nbsp;<span class="ident" id="5643712">s</span><span class="op" id="5643713">)</span>&nbsp;<span class="op" id="5643715">&gt;=</span>&nbsp;<span class="num" id="5643718">0</span>&nbsp;<span class="op" id="5643720">}</span><span class="op" id="5643721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5643724">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5643791">j</span>&nbsp;<span class="op" id="5643793">:=</span>&nbsp;<span class="ident" id="5643796">i</span>&nbsp;<span class="op" id="5643798">+</span>&nbsp;<span class="ident" id="5643800">sort</span><span class="op" id="5643804">.</span><span class="ident" id="5643805">Search</span><span class="op" id="5643811">(</span><span class="builtinfunc" id="5643812">len</span><span class="op" id="5643815">(</span><span class="ident" id="5643816">x</span><span class="op" id="5643817">.</span><span class="ident" id="5643818">sa</span><span class="op" id="5643820">)</span><span class="op" id="5643821">-</span><span class="ident" id="5643822">i</span><span class="op" id="5643823">,</span>&nbsp;<span class="keyword" id="5643825">func</span><span class="op" id="5643829">(</span><span class="ident" id="5643830">j</span>&nbsp;<span class="builtintype" id="5643832">int</span><span class="op" id="5643835">)</span>&nbsp;<span class="builtintype" id="5643837">bool</span>&nbsp;<span class="op" id="5643842">{</span>&nbsp;<span class="keyword" id="5643844">return</span>&nbsp;<span class="op" id="5643851">!</span><span class="ident" id="5643852">bytes</span><span class="op" id="5643857">.</span><span class="ident" id="5643858">HasPrefix</span><span class="op" id="5643867">(</span><span class="ident" id="5643868">x</span><span class="op" id="5643869">.</span><span class="ident" id="5643870">at</span><span class="op" id="5643872">(</span><span class="ident" id="5643873">j</span><span class="op" id="5643874">+</span><span class="ident" id="5643875">i</span><span class="op" id="5643876">)</span><span class="op" id="5643877">,</span>&nbsp;<span class="ident" id="5643879">s</span><span class="op" id="5643880">)</span>&nbsp;<span class="op" id="5643882">}</span><span class="op" id="5643883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5643886">return</span>&nbsp;<span class="ident" id="5643893">x</span><span class="op" id="5643894">.</span><span class="ident" id="5643895">sa</span><span class="op" id="5643897">[</span><span class="ident" id="5643898">i</span><span class="op" id="5643899">:</span><span class="ident" id="5643900">j</span><span class="op" id="5643901">]</span><br>
<span class="lineno"></span><span class="op" id="5643903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5643906">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5643986">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5644057">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5644120">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5644184">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5644213">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5644216">func</span>&nbsp;<span class="op" id="5644221">(</span><span class="ident" id="5644222">x</span>&nbsp;<span class="op" id="5644224">*</span><span class="ident" id="5644225">Index</span><span class="op" id="5644230">)</span>&nbsp;<span class="ident" id="5644232">Lookup</span><span class="op" id="5644238">(</span><span class="ident" id="5644239">s</span>&nbsp;<span class="op" id="5644241">[</span><span class="op" id="5644242">]</span><span class="builtintype" id="5644243">byte</span><span class="op" id="5644247">,</span>&nbsp;<span class="ident" id="5644249">n</span>&nbsp;<span class="builtintype" id="5644251">int</span><span class="op" id="5644254">)</span>&nbsp;<span class="op" id="5644256">(</span><span class="ident" id="5644257">result</span>&nbsp;<span class="op" id="5644264">[</span><span class="op" id="5644265">]</span><span class="builtintype" id="5644266">int</span><span class="op" id="5644269">)</span>&nbsp;<span class="op" id="5644271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644274">if</span>&nbsp;<span class="builtinfunc" id="5644277">len</span><span class="op" id="5644280">(</span><span class="ident" id="5644281">s</span><span class="op" id="5644282">)</span>&nbsp;<span class="op" id="5644284">&gt;</span>&nbsp;<span class="num" id="5644286">0</span>&nbsp;<span class="op" id="5644288">&amp;&amp;</span>&nbsp;<span class="ident" id="5644291">n</span>&nbsp;<span class="op" id="5644293">!=</span>&nbsp;<span class="num" id="5644296">0</span>&nbsp;<span class="op" id="5644298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644302">matches</span>&nbsp;<span class="op" id="5644310">:=</span>&nbsp;<span class="ident" id="5644313">x</span><span class="op" id="5644314">.</span><span class="ident" id="5644315">lookupAll</span><span class="op" id="5644324">(</span><span class="ident" id="5644325">s</span><span class="op" id="5644326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644330">if</span>&nbsp;<span class="ident" id="5644333">n</span>&nbsp;<span class="op" id="5644335">&lt;</span>&nbsp;<span class="num" id="5644337">0</span>&nbsp;<span class="op" id="5644339">||</span>&nbsp;<span class="builtinfunc" id="5644342">len</span><span class="op" id="5644345">(</span><span class="ident" id="5644346">matches</span><span class="op" id="5644353">)</span>&nbsp;<span class="op" id="5644355">&lt;</span>&nbsp;<span class="ident" id="5644357">n</span>&nbsp;<span class="op" id="5644359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644364">n</span>&nbsp;<span class="op" id="5644366">=</span>&nbsp;<span class="builtinfunc" id="5644368">len</span><span class="op" id="5644371">(</span><span class="ident" id="5644372">matches</span><span class="op" id="5644379">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644387">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644415">if</span>&nbsp;<span class="ident" id="5644418">n</span>&nbsp;<span class="op" id="5644420">&gt;</span>&nbsp;<span class="num" id="5644422">0</span>&nbsp;<span class="op" id="5644424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5644429">result</span>&nbsp;<span class="op" id="5644436">=</span>&nbsp;<span class="builtinfunc" id="5644438">make</span><span class="op" id="5644442">(</span><span class="op" id="5644443">[</span><span class="op" id="5644444">]</span><span class="builtintype" id="5644445">int</span><span class="op" id="5644448">,</span>&nbsp;<span class="ident" id="5644450">n</span><span class="op" id="5644451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5644456">copy</span><span class="op" id="5644460">(</span><span class="ident" id="5644461">result</span><span class="op" id="5644467">,</span>&nbsp;<span class="ident" id="5644469">matches</span><span class="op" id="5644476">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5644483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5644486">return</span><br>
<span class="lineno"></span><span class="op" id="5644493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5644496">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5644568">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5644639">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5644709">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5644779">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5644853">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5644870">//</span><br>
<span class="lineno"></span><span class="keyword" id="5644873">func</span>&nbsp;<span class="op" id="5644878">(</span><span class="ident" id="5644879">x</span>&nbsp;<span class="op" id="5644881">*</span><span class="ident" id="5644882">Index</span><span class="op" id="5644887">)</span>&nbsp;<span class="ident" id="5644889">FindAllIndex</span><span class="op" id="5644901">(</span><span class="ident" id="5644902">r</span>&nbsp;<span class="op" id="5644904">*</span><span class="ident" id="5644905">regexp</span><span class="op" id="5644911">.</span><span class="ident" id="5644912">Regexp</span><span class="op" id="5644918">,</span>&nbsp;<span class="ident" id="5644920">n</span>&nbsp;<span class="builtintype" id="5644922">int</span><span class="op" id="5644925">)</span>&nbsp;<span class="op" id="5644927">(</span><span class="ident" id="5644928">result</span>&nbsp;<span class="op" id="5644935">[</span><span class="op" id="5644936">]</span><span class="op" id="5644937">[</span><span class="op" id="5644938">]</span><span class="builtintype" id="5644939">int</span><span class="op" id="5644942">)</span>&nbsp;<span class="op" id="5644944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5644947">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645008">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645044">prefix</span><span class="op" id="5645050">,</span>&nbsp;<span class="ident" id="5645052">complete</span>&nbsp;<span class="op" id="5645061">:=</span>&nbsp;<span class="ident" id="5645064">r</span><span class="op" id="5645065">.</span><span class="ident" id="5645066">LiteralPrefix</span><span class="op" id="5645079">(</span><span class="op" id="5645080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645083">lit</span>&nbsp;<span class="op" id="5645087">:=</span>&nbsp;<span class="op" id="5645090">[</span><span class="op" id="5645091">]</span><span class="builtintype" id="5645092">byte</span><span class="op" id="5645096">(</span><span class="ident" id="5645097">prefix</span><span class="op" id="5645103">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645107">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645150">if</span>&nbsp;<span class="ident" id="5645153">prefix</span>&nbsp;<span class="op" id="5645160">==</span>&nbsp;<span class="string" id="5645163">&#34;&#34;</span>&nbsp;<span class="op" id="5645166">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645170">return</span>&nbsp;<span class="ident" id="5645177">r</span><span class="op" id="5645178">.</span><span class="ident" id="5645179">FindAllIndex</span><span class="op" id="5645191">(</span><span class="ident" id="5645192">x</span><span class="op" id="5645193">.</span><span class="ident" id="5645194">data</span><span class="op" id="5645198">,</span>&nbsp;<span class="ident" id="5645200">n</span><span class="op" id="5645201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645208">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645267">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645295">if</span>&nbsp;<span class="ident" id="5645298">complete</span>&nbsp;<span class="op" id="5645307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645311">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645379">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645449">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645514">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645585">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5645654">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645682">for</span>&nbsp;<span class="ident" id="5645686">n1</span>&nbsp;<span class="op" id="5645689">:=</span>&nbsp;<span class="ident" id="5645692">n</span><span class="op" id="5645693">;</span>&nbsp;<span class="op" id="5645695">;</span>&nbsp;<span class="ident" id="5645697">n1</span>&nbsp;<span class="op" id="5645700">+=</span>&nbsp;<span class="num" id="5645703">2</span>&nbsp;<span class="op" id="5645705">*</span>&nbsp;<span class="op" id="5645707">(</span><span class="ident" id="5645708">n</span>&nbsp;<span class="op" id="5645710">-</span>&nbsp;<span class="builtinfunc" id="5645712">len</span><span class="op" id="5645715">(</span><span class="ident" id="5645716">result</span><span class="op" id="5645722">)</span><span class="op" id="5645723">)</span>&nbsp;<span class="comment" id="5645725">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5645743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645748">indices</span>&nbsp;<span class="op" id="5645756">:=</span>&nbsp;<span class="ident" id="5645759">x</span><span class="op" id="5645760">.</span><span class="ident" id="5645761">Lookup</span><span class="op" id="5645767">(</span><span class="ident" id="5645768">lit</span><span class="op" id="5645771">,</span>&nbsp;<span class="ident" id="5645773">n1</span><span class="op" id="5645775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645780">if</span>&nbsp;<span class="builtinfunc" id="5645783">len</span><span class="op" id="5645786">(</span><span class="ident" id="5645787">indices</span><span class="op" id="5645794">)</span>&nbsp;<span class="op" id="5645796">==</span>&nbsp;<span class="num" id="5645799">0</span>&nbsp;<span class="op" id="5645801">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645807">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5645817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645822">sort</span><span class="op" id="5645826">.</span><span class="ident" id="5645827">Ints</span><span class="op" id="5645831">(</span><span class="ident" id="5645832">indices</span><span class="op" id="5645839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645844">pairs</span>&nbsp;<span class="op" id="5645850">:=</span>&nbsp;<span class="builtinfunc" id="5645853">make</span><span class="op" id="5645857">(</span><span class="op" id="5645858">[</span><span class="op" id="5645859">]</span><span class="builtintype" id="5645860">int</span><span class="op" id="5645863">,</span>&nbsp;<span class="num" id="5645865">2</span><span class="op" id="5645866">*</span><span class="builtinfunc" id="5645867">len</span><span class="op" id="5645870">(</span><span class="ident" id="5645871">indices</span><span class="op" id="5645878">)</span><span class="op" id="5645879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645884">result</span>&nbsp;<span class="op" id="5645891">=</span>&nbsp;<span class="builtinfunc" id="5645893">make</span><span class="op" id="5645897">(</span><span class="op" id="5645898">[</span><span class="op" id="5645899">]</span><span class="op" id="5645900">[</span><span class="op" id="5645901">]</span><span class="builtintype" id="5645902">int</span><span class="op" id="5645905">,</span>&nbsp;<span class="builtinfunc" id="5645907">len</span><span class="op" id="5645910">(</span><span class="ident" id="5645911">indices</span><span class="op" id="5645918">)</span><span class="op" id="5645919">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645924">count</span>&nbsp;<span class="op" id="5645930">:=</span>&nbsp;<span class="num" id="5645933">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5645938">prev</span>&nbsp;<span class="op" id="5645943">:=</span>&nbsp;<span class="num" id="5645946">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645951">for</span>&nbsp;<span class="ident" id="5645955">_</span><span class="op" id="5645956">,</span>&nbsp;<span class="ident" id="5645958">i</span>&nbsp;<span class="op" id="5645960">:=</span>&nbsp;<span class="keyword" id="5645963">range</span>&nbsp;<span class="ident" id="5645969">indices</span>&nbsp;<span class="op" id="5645977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5645983">if</span>&nbsp;<span class="ident" id="5645986">count</span>&nbsp;<span class="op" id="5645992">==</span>&nbsp;<span class="ident" id="5645995">n</span>&nbsp;<span class="op" id="5645997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646004">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646020">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646073">if</span>&nbsp;<span class="ident" id="5646076">prev</span>&nbsp;<span class="op" id="5646081">&lt;=</span>&nbsp;<span class="ident" id="5646084">i</span>&nbsp;<span class="op" id="5646086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646093">j</span>&nbsp;<span class="op" id="5646095">:=</span>&nbsp;<span class="num" id="5646098">2</span>&nbsp;<span class="op" id="5646100">*</span>&nbsp;<span class="ident" id="5646102">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646113">pairs</span><span class="op" id="5646118">[</span><span class="ident" id="5646119">j</span><span class="op" id="5646120">+</span><span class="num" id="5646121">0</span><span class="op" id="5646122">]</span>&nbsp;<span class="op" id="5646124">=</span>&nbsp;<span class="ident" id="5646126">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646133">pairs</span><span class="op" id="5646138">[</span><span class="ident" id="5646139">j</span><span class="op" id="5646140">+</span><span class="num" id="5646141">1</span><span class="op" id="5646142">]</span>&nbsp;<span class="op" id="5646144">=</span>&nbsp;<span class="ident" id="5646146">i</span>&nbsp;<span class="op" id="5646148">+</span>&nbsp;<span class="builtinfunc" id="5646150">len</span><span class="op" id="5646153">(</span><span class="ident" id="5646154">lit</span><span class="op" id="5646157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646164">result</span><span class="op" id="5646170">[</span><span class="ident" id="5646171">count</span><span class="op" id="5646176">]</span>&nbsp;<span class="op" id="5646178">=</span>&nbsp;<span class="ident" id="5646180">pairs</span><span class="op" id="5646185">[</span><span class="ident" id="5646186">j</span>&nbsp;<span class="op" id="5646188">:</span>&nbsp;<span class="ident" id="5646190">j</span><span class="op" id="5646191">+</span><span class="num" id="5646192">2</span><span class="op" id="5646193">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646200">count</span><span class="op" id="5646205">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646213">prev</span>&nbsp;<span class="op" id="5646218">=</span>&nbsp;<span class="ident" id="5646220">i</span>&nbsp;<span class="op" id="5646222">+</span>&nbsp;<span class="builtinfunc" id="5646224">len</span><span class="op" id="5646227">(</span><span class="ident" id="5646228">lit</span><span class="op" id="5646231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646237">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646247">result</span>&nbsp;<span class="op" id="5646254">=</span>&nbsp;<span class="ident" id="5646256">result</span><span class="op" id="5646262">[</span><span class="num" id="5646263">0</span><span class="op" id="5646264">:</span><span class="ident" id="5646265">count</span><span class="op" id="5646270">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646275">if</span>&nbsp;<span class="builtinfunc" id="5646278">len</span><span class="op" id="5646281">(</span><span class="ident" id="5646282">result</span><span class="op" id="5646288">)</span>&nbsp;<span class="op" id="5646290">&gt;=</span>&nbsp;<span class="ident" id="5646293">n</span>&nbsp;<span class="op" id="5646295">||</span>&nbsp;<span class="builtinfunc" id="5646298">len</span><span class="op" id="5646301">(</span><span class="ident" id="5646302">indices</span><span class="op" id="5646309">)</span>&nbsp;<span class="op" id="5646311">!=</span>&nbsp;<span class="ident" id="5646314">n1</span>&nbsp;<span class="op" id="5646317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646323">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646382">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646416">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646433">if</span>&nbsp;<span class="builtinfunc" id="5646436">len</span><span class="op" id="5646439">(</span><span class="ident" id="5646440">result</span><span class="op" id="5646446">)</span>&nbsp;<span class="op" id="5646448">==</span>&nbsp;<span class="num" id="5646451">0</span>&nbsp;<span class="op" id="5646453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646458">result</span>&nbsp;<span class="op" id="5646465">=</span>&nbsp;<span class="ident" id="5646467">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646477">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646489">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646553">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646621">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646654">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646721">r</span>&nbsp;<span class="op" id="5646723">=</span>&nbsp;<span class="ident" id="5646725">regexp</span><span class="op" id="5646731">.</span><span class="ident" id="5646732">MustCompile</span><span class="op" id="5646743">(</span><span class="string" id="5646744">&#34;^&#34;</span>&nbsp;<span class="op" id="5646748">+</span>&nbsp;<span class="ident" id="5646750">r</span><span class="op" id="5646751">.</span><span class="ident" id="5646752">String</span><span class="op" id="5646758">(</span><span class="op" id="5646759">)</span><span class="op" id="5646760">)</span>&nbsp;<span class="comment" id="5646762">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5646795">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646859">for</span>&nbsp;<span class="ident" id="5646863">n1</span>&nbsp;<span class="op" id="5646866">:=</span>&nbsp;<span class="ident" id="5646869">n</span><span class="op" id="5646870">;</span>&nbsp;<span class="op" id="5646872">;</span>&nbsp;<span class="ident" id="5646874">n1</span>&nbsp;<span class="op" id="5646877">+=</span>&nbsp;<span class="num" id="5646880">2</span>&nbsp;<span class="op" id="5646882">*</span>&nbsp;<span class="op" id="5646884">(</span><span class="ident" id="5646885">n</span>&nbsp;<span class="op" id="5646887">-</span>&nbsp;<span class="builtinfunc" id="5646889">len</span><span class="op" id="5646892">(</span><span class="ident" id="5646893">result</span><span class="op" id="5646899">)</span><span class="op" id="5646900">)</span>&nbsp;<span class="comment" id="5646902">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5646920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646924">indices</span>&nbsp;<span class="op" id="5646932">:=</span>&nbsp;<span class="ident" id="5646935">x</span><span class="op" id="5646936">.</span><span class="ident" id="5646937">Lookup</span><span class="op" id="5646943">(</span><span class="ident" id="5646944">lit</span><span class="op" id="5646947">,</span>&nbsp;<span class="ident" id="5646949">n1</span><span class="op" id="5646951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646955">if</span>&nbsp;<span class="builtinfunc" id="5646958">len</span><span class="op" id="5646961">(</span><span class="ident" id="5646962">indices</span><span class="op" id="5646969">)</span>&nbsp;<span class="op" id="5646971">==</span>&nbsp;<span class="num" id="5646974">0</span>&nbsp;<span class="op" id="5646976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5646981">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5646990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5646994">sort</span><span class="op" id="5646998">.</span><span class="ident" id="5646999">Ints</span><span class="op" id="5647003">(</span><span class="ident" id="5647004">indices</span><span class="op" id="5647011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647015">result</span>&nbsp;<span class="op" id="5647022">=</span>&nbsp;<span class="ident" id="5647024">result</span><span class="op" id="5647030">[</span><span class="num" id="5647031">0</span><span class="op" id="5647032">:</span><span class="num" id="5647033">0</span><span class="op" id="5647034">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647038">prev</span>&nbsp;<span class="op" id="5647043">:=</span>&nbsp;<span class="num" id="5647046">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647050">for</span>&nbsp;<span class="ident" id="5647054">_</span><span class="op" id="5647055">,</span>&nbsp;<span class="ident" id="5647057">i</span>&nbsp;<span class="op" id="5647059">:=</span>&nbsp;<span class="keyword" id="5647062">range</span>&nbsp;<span class="ident" id="5647068">indices</span>&nbsp;<span class="op" id="5647076">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647081">if</span>&nbsp;<span class="builtinfunc" id="5647084">len</span><span class="op" id="5647087">(</span><span class="ident" id="5647088">result</span><span class="op" id="5647094">)</span>&nbsp;<span class="op" id="5647096">==</span>&nbsp;<span class="ident" id="5647099">n</span>&nbsp;<span class="op" id="5647101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647107">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647121">m</span>&nbsp;<span class="op" id="5647123">:=</span>&nbsp;<span class="ident" id="5647126">r</span><span class="op" id="5647127">.</span><span class="ident" id="5647128">FindIndex</span><span class="op" id="5647137">(</span><span class="ident" id="5647138">x</span><span class="op" id="5647139">.</span><span class="ident" id="5647140">data</span><span class="op" id="5647144">[</span><span class="ident" id="5647145">i</span><span class="op" id="5647146">:</span><span class="op" id="5647147">]</span><span class="op" id="5647148">)</span>&nbsp;<span class="comment" id="5647150">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647191">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647243">if</span>&nbsp;<span class="ident" id="5647246">m</span>&nbsp;<span class="op" id="5647248">!=</span>&nbsp;<span class="ident" id="5647251">nil</span>&nbsp;<span class="op" id="5647255">&amp;&amp;</span>&nbsp;<span class="ident" id="5647258">prev</span>&nbsp;<span class="op" id="5647263">&lt;=</span>&nbsp;<span class="ident" id="5647266">i</span>&nbsp;<span class="op" id="5647268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647274">m</span><span class="op" id="5647275">[</span><span class="num" id="5647276">0</span><span class="op" id="5647277">]</span>&nbsp;<span class="op" id="5647279">=</span>&nbsp;<span class="ident" id="5647281">i</span>&nbsp;<span class="comment" id="5647283">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647300">m</span><span class="op" id="5647301">[</span><span class="num" id="5647302">1</span><span class="op" id="5647303">]</span>&nbsp;<span class="op" id="5647305">+=</span>&nbsp;<span class="ident" id="5647308">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647314">result</span>&nbsp;<span class="op" id="5647321">=</span>&nbsp;<span class="builtinfunc" id="5647323">append</span><span class="op" id="5647329">(</span><span class="ident" id="5647330">result</span><span class="op" id="5647336">,</span>&nbsp;<span class="ident" id="5647338">m</span><span class="op" id="5647339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647345">prev</span>&nbsp;<span class="op" id="5647350">=</span>&nbsp;<span class="ident" id="5647352">m</span><span class="op" id="5647353">[</span><span class="num" id="5647354">1</span><span class="op" id="5647355">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647368">if</span>&nbsp;<span class="builtinfunc" id="5647371">len</span><span class="op" id="5647374">(</span><span class="ident" id="5647375">result</span><span class="op" id="5647381">)</span>&nbsp;<span class="op" id="5647383">&gt;=</span>&nbsp;<span class="ident" id="5647386">n</span>&nbsp;<span class="op" id="5647388">||</span>&nbsp;<span class="builtinfunc" id="5647391">len</span><span class="op" id="5647394">(</span><span class="ident" id="5647395">indices</span><span class="op" id="5647402">)</span>&nbsp;<span class="op" id="5647404">!=</span>&nbsp;<span class="ident" id="5647407">n1</span>&nbsp;<span class="op" id="5647410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647415">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5647473">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647506">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647520">if</span>&nbsp;<span class="builtinfunc" id="5647523">len</span><span class="op" id="5647526">(</span><span class="ident" id="5647527">result</span><span class="op" id="5647533">)</span>&nbsp;<span class="op" id="5647535">==</span>&nbsp;<span class="num" id="5647538">0</span>&nbsp;<span class="op" id="5647540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5647544">result</span>&nbsp;<span class="op" id="5647551">=</span>&nbsp;<span class="ident" id="5647553">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5647558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5647561">return</span><br>
<span class="lineno"></span><span class="op" id="5647568">}</span>
</div>
</body>
</html>
