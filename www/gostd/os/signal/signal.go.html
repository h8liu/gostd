<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/signal</h2>
<ul>
<li><a href="/gostd/os/signal/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/signal/signal.go.html">signal.go</a></li>
<li><a href="/gostd/os/signal/signal_test.go.html">signal_test.go</a></li>
<li><a href="/gostd/os/signal/signal_unix.go.html">signal_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5916556">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5916611">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5916665">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5916716">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5916773">package</span>&nbsp;<span class="ident" id="5916781">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5916789">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5916850">import</span>&nbsp;<span class="op" id="5916857">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5916860">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5916866">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5916873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5916876">var</span>&nbsp;<span class="ident" id="5916880">handlers</span>&nbsp;<span class="keyword" id="5916889">struct</span>&nbsp;<span class="op" id="5916896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916899">sync</span><span class="op" id="5916903">.</span><span class="ident" id="5916904">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916911">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5916915">map</span><span class="op" id="5916918">[</span><span class="keyword" id="5916919">chan</span><span class="op" id="5916923">&lt;-</span>&nbsp;<span class="ident" id="5916926">os</span><span class="op" id="5916928">.</span><span class="ident" id="5916929">Signal</span><span class="op" id="5916935">]</span><span class="op" id="5916936">*</span><span class="ident" id="5916937">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916946">ref</span>&nbsp;<span class="op" id="5916950">[</span><span class="ident" id="5916951">numSig</span><span class="op" id="5916957">]</span><span class="ident" id="5916958">int64</span><br>
<span class="lineno"></span><span class="op" id="5916964">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5916967">type</span>&nbsp;<span class="ident" id="5916972">handler</span>&nbsp;<span class="keyword" id="5916980">struct</span>&nbsp;<span class="op" id="5916987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5916990">mask</span>&nbsp;<span class="op" id="5916995">[</span><span class="op" id="5916996">(</span><span class="ident" id="5916997">numSig</span>&nbsp;<span class="op" id="5917004">+</span>&nbsp;<span class="num" id="5917006">31</span><span class="op" id="5917008">)</span>&nbsp;<span class="op" id="5917010">/</span>&nbsp;<span class="num" id="5917012">32</span><span class="op" id="5917014">]</span><span class="builtintype" id="5917015">uint32</span><br>
<span class="lineno"></span><span class="op" id="5917022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5917025">func</span>&nbsp;<span class="op" id="5917030">(</span><span class="ident" id="5917031">h</span>&nbsp;<span class="op" id="5917033">*</span><span class="ident" id="5917034">handler</span><span class="op" id="5917041">)</span>&nbsp;<span class="ident" id="5917043">want</span><span class="op" id="5917047">(</span><span class="ident" id="5917048">sig</span>&nbsp;<span class="builtintype" id="5917052">int</span><span class="op" id="5917055">)</span>&nbsp;<span class="builtintype" id="5917057">bool</span>&nbsp;<span class="op" id="5917062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5917065">return</span>&nbsp;<span class="op" id="5917072">(</span><span class="ident" id="5917073">h</span><span class="op" id="5917074">.</span><span class="ident" id="5917075">mask</span><span class="op" id="5917079">[</span><span class="ident" id="5917080">sig</span><span class="op" id="5917083">/</span><span class="num" id="5917084">32</span><span class="op" id="5917086">]</span><span class="op" id="5917087">&gt;&gt;</span><span class="builtintype" id="5917089">uint</span><span class="op" id="5917093">(</span><span class="ident" id="5917094">sig</span><span class="op" id="5917097">&amp;</span><span class="num" id="5917098">31</span><span class="op" id="5917100">)</span><span class="op" id="5917101">)</span><span class="op" id="5917102">&amp;</span><span class="num" id="5917103">1</span>&nbsp;<span class="op" id="5917105">!=</span>&nbsp;<span class="num" id="5917108">0</span><br>
<span class="lineno"></span><span class="op" id="5917110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5917113">func</span>&nbsp;<span class="op" id="5917118">(</span><span class="ident" id="5917119">h</span>&nbsp;<span class="op" id="5917121">*</span><span class="ident" id="5917122">handler</span><span class="op" id="5917129">)</span>&nbsp;<span class="ident" id="5917131">set</span><span class="op" id="5917134">(</span><span class="ident" id="5917135">sig</span>&nbsp;<span class="builtintype" id="5917139">int</span><span class="op" id="5917142">)</span>&nbsp;<span class="op" id="5917144">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5917147">h</span><span class="op" id="5917148">.</span><span class="ident" id="5917149">mask</span><span class="op" id="5917153">[</span><span class="ident" id="5917154">sig</span><span class="op" id="5917157">/</span><span class="num" id="5917158">32</span><span class="op" id="5917160">]</span>&nbsp;<span class="op" id="5917162">|=</span>&nbsp;<span class="num" id="5917165">1</span>&nbsp;<span class="op" id="5917167">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5917170">uint</span><span class="op" id="5917174">(</span><span class="ident" id="5917175">sig</span><span class="op" id="5917178">&amp;</span><span class="num" id="5917179">31</span><span class="op" id="5917181">)</span><br>
<span class="lineno"></span><span class="op" id="5917183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5917186">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5917250">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="5917322">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="5917366">//</span><br>
<span class="lineno"></span><span class="comment" id="5917369">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5917439">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5917506">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="5917585">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="5917622">//</span><br>
<span class="lineno"></span><span class="comment" id="5917625">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="5917695">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5917757">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="5917821">//</span><br>
<span class="lineno"></span><span class="comment" id="5917824">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="5917895">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5917961">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="5917987">func</span>&nbsp;<span class="ident" id="5917992">Notify</span><span class="op" id="5917998">(</span><span class="ident" id="5917999">c</span>&nbsp;<span class="keyword" id="5918001">chan</span><span class="op" id="5918005">&lt;-</span>&nbsp;<span class="ident" id="5918008">os</span><span class="op" id="5918010">.</span><span class="ident" id="5918011">Signal</span><span class="op" id="5918017">,</span>&nbsp;<span class="ident" id="5918019">sig</span>&nbsp;<span class="op" id="5918023">...</span><span class="ident" id="5918026">os</span><span class="op" id="5918028">.</span><span class="ident" id="5918029">Signal</span><span class="op" id="5918035">)</span>&nbsp;<span class="op" id="5918037">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918040">if</span>&nbsp;<span class="ident" id="5918043">c</span>&nbsp;<span class="op" id="5918045">==</span>&nbsp;<span class="ident" id="5918048">nil</span>&nbsp;<span class="op" id="5918052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5918056">panic</span><span class="op" id="5918061">(</span><span class="string" id="5918062">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="5918099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918106">handlers</span><span class="op" id="5918114">.</span><span class="ident" id="5918115">Lock</span><span class="op" id="5918119">(</span><span class="op" id="5918120">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918123">defer</span>&nbsp;<span class="ident" id="5918129">handlers</span><span class="op" id="5918137">.</span><span class="ident" id="5918138">Unlock</span><span class="op" id="5918144">(</span><span class="op" id="5918145">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918149">h</span>&nbsp;<span class="op" id="5918151">:=</span>&nbsp;<span class="ident" id="5918154">handlers</span><span class="op" id="5918162">.</span><span class="ident" id="5918163">m</span><span class="op" id="5918164">[</span><span class="ident" id="5918165">c</span><span class="op" id="5918166">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918169">if</span>&nbsp;<span class="ident" id="5918172">h</span>&nbsp;<span class="op" id="5918174">==</span>&nbsp;<span class="ident" id="5918177">nil</span>&nbsp;<span class="op" id="5918181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918185">if</span>&nbsp;<span class="ident" id="5918188">handlers</span><span class="op" id="5918196">.</span><span class="ident" id="5918197">m</span>&nbsp;<span class="op" id="5918199">==</span>&nbsp;<span class="ident" id="5918202">nil</span>&nbsp;<span class="op" id="5918206">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918211">handlers</span><span class="op" id="5918219">.</span><span class="ident" id="5918220">m</span>&nbsp;<span class="op" id="5918222">=</span>&nbsp;<span class="builtinfunc" id="5918224">make</span><span class="op" id="5918228">(</span><span class="keyword" id="5918229">map</span><span class="op" id="5918232">[</span><span class="keyword" id="5918233">chan</span><span class="op" id="5918237">&lt;-</span>&nbsp;<span class="ident" id="5918240">os</span><span class="op" id="5918242">.</span><span class="ident" id="5918243">Signal</span><span class="op" id="5918249">]</span><span class="op" id="5918250">*</span><span class="ident" id="5918251">handler</span><span class="op" id="5918258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918266">h</span>&nbsp;<span class="op" id="5918268">=</span>&nbsp;<span class="builtinfunc" id="5918270">new</span><span class="op" id="5918273">(</span><span class="ident" id="5918274">handler</span><span class="op" id="5918281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918285">handlers</span><span class="op" id="5918293">.</span><span class="ident" id="5918294">m</span><span class="op" id="5918295">[</span><span class="ident" id="5918296">c</span><span class="op" id="5918297">]</span>&nbsp;<span class="op" id="5918299">=</span>&nbsp;<span class="ident" id="5918301">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918304">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918308">add</span>&nbsp;<span class="op" id="5918312">:=</span>&nbsp;<span class="keyword" id="5918315">func</span><span class="op" id="5918319">(</span><span class="ident" id="5918320">n</span>&nbsp;<span class="builtintype" id="5918322">int</span><span class="op" id="5918325">)</span>&nbsp;<span class="op" id="5918327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918331">if</span>&nbsp;<span class="ident" id="5918334">n</span>&nbsp;<span class="op" id="5918336">&lt;</span>&nbsp;<span class="num" id="5918338">0</span>&nbsp;<span class="op" id="5918340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918354">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918358">if</span>&nbsp;<span class="op" id="5918361">!</span><span class="ident" id="5918362">h</span><span class="op" id="5918363">.</span><span class="ident" id="5918364">want</span><span class="op" id="5918368">(</span><span class="ident" id="5918369">n</span><span class="op" id="5918370">)</span>&nbsp;<span class="op" id="5918372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918377">h</span><span class="op" id="5918378">.</span><span class="ident" id="5918379">set</span><span class="op" id="5918382">(</span><span class="ident" id="5918383">n</span><span class="op" id="5918384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918389">if</span>&nbsp;<span class="ident" id="5918392">handlers</span><span class="op" id="5918400">.</span><span class="ident" id="5918401">ref</span><span class="op" id="5918404">[</span><span class="ident" id="5918405">n</span><span class="op" id="5918406">]</span>&nbsp;<span class="op" id="5918408">==</span>&nbsp;<span class="num" id="5918411">0</span>&nbsp;<span class="op" id="5918413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918419">enableSignal</span><span class="op" id="5918431">(</span><span class="ident" id="5918432">n</span><span class="op" id="5918433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918438">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918443">handlers</span><span class="op" id="5918451">.</span><span class="ident" id="5918452">ref</span><span class="op" id="5918455">[</span><span class="ident" id="5918456">n</span><span class="op" id="5918457">]</span><span class="op" id="5918458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918470">if</span>&nbsp;<span class="builtinfunc" id="5918473">len</span><span class="op" id="5918476">(</span><span class="ident" id="5918477">sig</span><span class="op" id="5918480">)</span>&nbsp;<span class="op" id="5918482">==</span>&nbsp;<span class="num" id="5918485">0</span>&nbsp;<span class="op" id="5918487">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918491">for</span>&nbsp;<span class="ident" id="5918495">n</span>&nbsp;<span class="op" id="5918497">:=</span>&nbsp;<span class="num" id="5918500">0</span><span class="op" id="5918501">;</span>&nbsp;<span class="ident" id="5918503">n</span>&nbsp;<span class="op" id="5918505">&lt;</span>&nbsp;<span class="ident" id="5918507">numSig</span><span class="op" id="5918513">;</span>&nbsp;<span class="ident" id="5918515">n</span><span class="op" id="5918516">++</span>&nbsp;<span class="op" id="5918519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918524">add</span><span class="op" id="5918527">(</span><span class="ident" id="5918528">n</span><span class="op" id="5918529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918536">}</span>&nbsp;<span class="keyword" id="5918538">else</span>&nbsp;<span class="op" id="5918543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918547">for</span>&nbsp;<span class="ident" id="5918551">_</span><span class="op" id="5918552">,</span>&nbsp;<span class="ident" id="5918554">s</span>&nbsp;<span class="op" id="5918556">:=</span>&nbsp;<span class="keyword" id="5918559">range</span>&nbsp;<span class="ident" id="5918565">sig</span>&nbsp;<span class="op" id="5918569">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918574">add</span><span class="op" id="5918577">(</span><span class="ident" id="5918578">signum</span><span class="op" id="5918584">(</span><span class="ident" id="5918585">s</span><span class="op" id="5918586">)</span><span class="op" id="5918587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918594">}</span><br>
<span class="lineno"></span><span class="op" id="5918596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5918599">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5918669">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5918731">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5918807">func</span>&nbsp;<span class="ident" id="5918812">Stop</span><span class="op" id="5918816">(</span><span class="ident" id="5918817">c</span>&nbsp;<span class="keyword" id="5918819">chan</span><span class="op" id="5918823">&lt;-</span>&nbsp;<span class="ident" id="5918826">os</span><span class="op" id="5918828">.</span><span class="ident" id="5918829">Signal</span><span class="op" id="5918835">)</span>&nbsp;<span class="op" id="5918837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918840">handlers</span><span class="op" id="5918848">.</span><span class="ident" id="5918849">Lock</span><span class="op" id="5918853">(</span><span class="op" id="5918854">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918857">defer</span>&nbsp;<span class="ident" id="5918863">handlers</span><span class="op" id="5918871">.</span><span class="ident" id="5918872">Unlock</span><span class="op" id="5918878">(</span><span class="op" id="5918879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5918883">h</span>&nbsp;<span class="op" id="5918885">:=</span>&nbsp;<span class="ident" id="5918888">handlers</span><span class="op" id="5918896">.</span><span class="ident" id="5918897">m</span><span class="op" id="5918898">[</span><span class="ident" id="5918899">c</span><span class="op" id="5918900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918903">if</span>&nbsp;<span class="ident" id="5918906">h</span>&nbsp;<span class="op" id="5918908">==</span>&nbsp;<span class="ident" id="5918911">nil</span>&nbsp;<span class="op" id="5918915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918919">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5918927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5918930">delete</span><span class="op" id="5918936">(</span><span class="ident" id="5918937">handlers</span><span class="op" id="5918945">.</span><span class="ident" id="5918946">m</span><span class="op" id="5918947">,</span>&nbsp;<span class="ident" id="5918949">c</span><span class="op" id="5918950">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918954">for</span>&nbsp;<span class="ident" id="5918958">n</span>&nbsp;<span class="op" id="5918960">:=</span>&nbsp;<span class="num" id="5918963">0</span><span class="op" id="5918964">;</span>&nbsp;<span class="ident" id="5918966">n</span>&nbsp;<span class="op" id="5918968">&lt;</span>&nbsp;<span class="ident" id="5918970">numSig</span><span class="op" id="5918976">;</span>&nbsp;<span class="ident" id="5918978">n</span><span class="op" id="5918979">++</span>&nbsp;<span class="op" id="5918982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5918986">if</span>&nbsp;<span class="ident" id="5918989">h</span><span class="op" id="5918990">.</span><span class="ident" id="5918991">want</span><span class="op" id="5918995">(</span><span class="ident" id="5918996">n</span><span class="op" id="5918997">)</span>&nbsp;<span class="op" id="5918999">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919004">handlers</span><span class="op" id="5919012">.</span><span class="ident" id="5919013">ref</span><span class="op" id="5919016">[</span><span class="ident" id="5919017">n</span><span class="op" id="5919018">]</span><span class="op" id="5919019">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919025">if</span>&nbsp;<span class="ident" id="5919028">handlers</span><span class="op" id="5919036">.</span><span class="ident" id="5919037">ref</span><span class="op" id="5919040">[</span><span class="ident" id="5919041">n</span><span class="op" id="5919042">]</span>&nbsp;<span class="op" id="5919044">==</span>&nbsp;<span class="num" id="5919047">0</span>&nbsp;<span class="op" id="5919049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919055">disableSignal</span><span class="op" id="5919068">(</span><span class="ident" id="5919069">n</span><span class="op" id="5919070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919079">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919082">}</span><br>
<span class="lineno"></span><span class="op" id="5919084">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5919087">func</span>&nbsp;<span class="ident" id="5919092">process</span><span class="op" id="5919099">(</span><span class="ident" id="5919100">sig</span>&nbsp;<span class="ident" id="5919104">os</span><span class="op" id="5919106">.</span><span class="ident" id="5919107">Signal</span><span class="op" id="5919113">)</span>&nbsp;<span class="op" id="5919115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919118">n</span>&nbsp;<span class="op" id="5919120">:=</span>&nbsp;<span class="ident" id="5919123">signum</span><span class="op" id="5919129">(</span><span class="ident" id="5919130">sig</span><span class="op" id="5919133">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919136">if</span>&nbsp;<span class="ident" id="5919139">n</span>&nbsp;<span class="op" id="5919141">&lt;</span>&nbsp;<span class="num" id="5919143">0</span>&nbsp;<span class="op" id="5919145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919149">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5919161">handlers</span><span class="op" id="5919169">.</span><span class="ident" id="5919170">Lock</span><span class="op" id="5919174">(</span><span class="op" id="5919175">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919178">defer</span>&nbsp;<span class="ident" id="5919184">handlers</span><span class="op" id="5919192">.</span><span class="ident" id="5919193">Unlock</span><span class="op" id="5919199">(</span><span class="op" id="5919200">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919204">for</span>&nbsp;<span class="ident" id="5919208">c</span><span class="op" id="5919209">,</span>&nbsp;<span class="ident" id="5919211">h</span>&nbsp;<span class="op" id="5919213">:=</span>&nbsp;<span class="keyword" id="5919216">range</span>&nbsp;<span class="ident" id="5919222">handlers</span><span class="op" id="5919230">.</span><span class="ident" id="5919231">m</span>&nbsp;<span class="op" id="5919233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919237">if</span>&nbsp;<span class="ident" id="5919240">h</span><span class="op" id="5919241">.</span><span class="ident" id="5919242">want</span><span class="op" id="5919246">(</span><span class="ident" id="5919247">n</span><span class="op" id="5919248">)</span>&nbsp;<span class="op" id="5919250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5919255">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919290">select</span>&nbsp;<span class="op" id="5919297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919302">case</span>&nbsp;<span class="ident" id="5919307">c</span>&nbsp;<span class="op" id="5919309">&lt;-</span>&nbsp;<span class="ident" id="5919312">sig</span><span class="op" id="5919315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5919320">default</span><span class="op" id="5919327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919336">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5919339">}</span><br>
<span class="lineno"></span><span class="op" id="5919341">}</span>
</div>
</body>
</html>
