<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/hmac</h2>
<ul>
<li><a href="/gostd/crypto/hmac/hmac.go.html">hmac.go</a></li>
<li><a href="/gostd/crypto/hmac/hmac_test.go.html">hmac_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4603168">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4603223">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4603277">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4603328">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4603982">package</span>&nbsp;<span class="ident" id="4603990">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4603996">import</span>&nbsp;<span class="op" id="4604003">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4604006">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4604023">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4604030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4604033">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4604046">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4604111">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4604172">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4604216">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4604260">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4604308">type</span>&nbsp;<span class="ident" id="4604313">hmac</span>&nbsp;<span class="keyword" id="4604318">struct</span>&nbsp;<span class="op" id="4604325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604328">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4604341">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604346">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4604359">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604364">key</span><span class="op" id="4604367">,</span>&nbsp;<span class="ident" id="4604369">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4604377">[</span><span class="op" id="4604378">]</span><span class="builtintype" id="4604379">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604385">outer</span><span class="op" id="4604390">,</span>&nbsp;<span class="ident" id="4604392">inner</span>&nbsp;<span class="ident" id="4604398">hash</span><span class="op" id="4604402">.</span><span class="ident" id="4604403">Hash</span><br>
<span class="lineno"></span><span class="op" id="4604408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4604411">func</span>&nbsp;<span class="op" id="4604416">(</span><span class="ident" id="4604417">h</span>&nbsp;<span class="op" id="4604419">*</span><span class="ident" id="4604420">hmac</span><span class="op" id="4604424">)</span>&nbsp;<span class="ident" id="4604426">tmpPad</span><span class="op" id="4604432">(</span><span class="ident" id="4604433">xor</span>&nbsp;<span class="builtintype" id="4604437">byte</span><span class="op" id="4604441">)</span>&nbsp;<span class="op" id="4604443">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604446">for</span>&nbsp;<span class="ident" id="4604450">i</span><span class="op" id="4604451">,</span>&nbsp;<span class="ident" id="4604453">k</span>&nbsp;<span class="op" id="4604455">:=</span>&nbsp;<span class="keyword" id="4604458">range</span>&nbsp;<span class="ident" id="4604464">h</span><span class="op" id="4604465">.</span><span class="ident" id="4604466">key</span>&nbsp;<span class="op" id="4604470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604474">h</span><span class="op" id="4604475">.</span><span class="ident" id="4604476">tmp</span><span class="op" id="4604479">[</span><span class="ident" id="4604480">i</span><span class="op" id="4604481">]</span>&nbsp;<span class="op" id="4604483">=</span>&nbsp;<span class="ident" id="4604485">xor</span>&nbsp;<span class="op" id="4604489">^</span>&nbsp;<span class="ident" id="4604491">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604497">for</span>&nbsp;<span class="ident" id="4604501">i</span>&nbsp;<span class="op" id="4604503">:=</span>&nbsp;<span class="builtinfunc" id="4604506">len</span><span class="op" id="4604509">(</span><span class="ident" id="4604510">h</span><span class="op" id="4604511">.</span><span class="ident" id="4604512">key</span><span class="op" id="4604515">)</span><span class="op" id="4604516">;</span>&nbsp;<span class="ident" id="4604518">i</span>&nbsp;<span class="op" id="4604520">&lt;</span>&nbsp;<span class="ident" id="4604522">h</span><span class="op" id="4604523">.</span><span class="ident" id="4604524">blocksize</span><span class="op" id="4604533">;</span>&nbsp;<span class="ident" id="4604535">i</span><span class="op" id="4604536">++</span>&nbsp;<span class="op" id="4604539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604543">h</span><span class="op" id="4604544">.</span><span class="ident" id="4604545">tmp</span><span class="op" id="4604548">[</span><span class="ident" id="4604549">i</span><span class="op" id="4604550">]</span>&nbsp;<span class="op" id="4604552">=</span>&nbsp;<span class="ident" id="4604554">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4604559">}</span><br>
<span class="lineno"></span><span class="op" id="4604561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4604564">func</span>&nbsp;<span class="op" id="4604569">(</span><span class="ident" id="4604570">h</span>&nbsp;<span class="op" id="4604572">*</span><span class="ident" id="4604573">hmac</span><span class="op" id="4604577">)</span>&nbsp;<span class="ident" id="4604579">Sum</span><span class="op" id="4604582">(</span><span class="ident" id="4604583">in</span>&nbsp;<span class="op" id="4604586">[</span><span class="op" id="4604587">]</span><span class="builtintype" id="4604588">byte</span><span class="op" id="4604592">)</span>&nbsp;<span class="op" id="4604594">[</span><span class="op" id="4604595">]</span><span class="builtintype" id="4604596">byte</span>&nbsp;<span class="op" id="4604601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604604">origLen</span>&nbsp;<span class="op" id="4604612">:=</span>&nbsp;<span class="builtinfunc" id="4604615">len</span><span class="op" id="4604618">(</span><span class="ident" id="4604619">in</span><span class="op" id="4604621">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604624">in</span>&nbsp;<span class="op" id="4604627">=</span>&nbsp;<span class="ident" id="4604629">h</span><span class="op" id="4604630">.</span><span class="ident" id="4604631">inner</span><span class="op" id="4604636">.</span><span class="ident" id="4604637">Sum</span><span class="op" id="4604640">(</span><span class="ident" id="4604641">in</span><span class="op" id="4604643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604646">h</span><span class="op" id="4604647">.</span><span class="ident" id="4604648">tmpPad</span><span class="op" id="4604654">(</span><span class="num" id="4604655">0x5c</span><span class="op" id="4604659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4604662">copy</span><span class="op" id="4604666">(</span><span class="ident" id="4604667">h</span><span class="op" id="4604668">.</span><span class="ident" id="4604669">tmp</span><span class="op" id="4604672">[</span><span class="ident" id="4604673">h</span><span class="op" id="4604674">.</span><span class="ident" id="4604675">blocksize</span><span class="op" id="4604684">:</span><span class="op" id="4604685">]</span><span class="op" id="4604686">,</span>&nbsp;<span class="ident" id="4604688">in</span><span class="op" id="4604690">[</span><span class="ident" id="4604691">origLen</span><span class="op" id="4604698">:</span><span class="op" id="4604699">]</span><span class="op" id="4604700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604703">h</span><span class="op" id="4604704">.</span><span class="ident" id="4604705">outer</span><span class="op" id="4604710">.</span><span class="ident" id="4604711">Reset</span><span class="op" id="4604716">(</span><span class="op" id="4604717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604720">h</span><span class="op" id="4604721">.</span><span class="ident" id="4604722">outer</span><span class="op" id="4604727">.</span><span class="ident" id="4604728">Write</span><span class="op" id="4604733">(</span><span class="ident" id="4604734">h</span><span class="op" id="4604735">.</span><span class="ident" id="4604736">tmp</span><span class="op" id="4604739">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604742">return</span>&nbsp;<span class="ident" id="4604749">h</span><span class="op" id="4604750">.</span><span class="ident" id="4604751">outer</span><span class="op" id="4604756">.</span><span class="ident" id="4604757">Sum</span><span class="op" id="4604760">(</span><span class="ident" id="4604761">in</span><span class="op" id="4604763">[</span><span class="op" id="4604764">:</span><span class="ident" id="4604765">origLen</span><span class="op" id="4604772">]</span><span class="op" id="4604773">)</span><br>
<span class="lineno"></span><span class="op" id="4604775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4604778">func</span>&nbsp;<span class="op" id="4604783">(</span><span class="ident" id="4604784">h</span>&nbsp;<span class="op" id="4604786">*</span><span class="ident" id="4604787">hmac</span><span class="op" id="4604791">)</span>&nbsp;<span class="ident" id="4604793">Write</span><span class="op" id="4604798">(</span><span class="ident" id="4604799">p</span>&nbsp;<span class="op" id="4604801">[</span><span class="op" id="4604802">]</span><span class="builtintype" id="4604803">byte</span><span class="op" id="4604807">)</span>&nbsp;<span class="op" id="4604809">(</span><span class="ident" id="4604810">n</span>&nbsp;<span class="builtintype" id="4604812">int</span><span class="op" id="4604815">,</span>&nbsp;<span class="ident" id="4604817">err</span>&nbsp;<span class="builtintype" id="4604821">error</span><span class="op" id="4604826">)</span>&nbsp;<span class="op" id="4604828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4604831">return</span>&nbsp;<span class="ident" id="4604838">h</span><span class="op" id="4604839">.</span><span class="ident" id="4604840">inner</span><span class="op" id="4604845">.</span><span class="ident" id="4604846">Write</span><span class="op" id="4604851">(</span><span class="ident" id="4604852">p</span><span class="op" id="4604853">)</span><br>
<span class="lineno">65</span><span class="op" id="4604855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4604858">func</span>&nbsp;<span class="op" id="4604863">(</span><span class="ident" id="4604864">h</span>&nbsp;<span class="op" id="4604866">*</span><span class="ident" id="4604867">hmac</span><span class="op" id="4604871">)</span>&nbsp;<span class="ident" id="4604873">Size</span><span class="op" id="4604877">(</span><span class="op" id="4604878">)</span>&nbsp;<span class="builtintype" id="4604880">int</span>&nbsp;<span class="op" id="4604884">{</span>&nbsp;<span class="keyword" id="4604886">return</span>&nbsp;<span class="ident" id="4604893">h</span><span class="op" id="4604894">.</span><span class="ident" id="4604895">size</span>&nbsp;<span class="op" id="4604900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4604903">func</span>&nbsp;<span class="op" id="4604908">(</span><span class="ident" id="4604909">h</span>&nbsp;<span class="op" id="4604911">*</span><span class="ident" id="4604912">hmac</span><span class="op" id="4604916">)</span>&nbsp;<span class="ident" id="4604918">BlockSize</span><span class="op" id="4604927">(</span><span class="op" id="4604928">)</span>&nbsp;<span class="builtintype" id="4604930">int</span>&nbsp;<span class="op" id="4604934">{</span>&nbsp;<span class="keyword" id="4604936">return</span>&nbsp;<span class="ident" id="4604943">h</span><span class="op" id="4604944">.</span><span class="ident" id="4604945">blocksize</span>&nbsp;<span class="op" id="4604955">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4604958">func</span>&nbsp;<span class="op" id="4604963">(</span><span class="ident" id="4604964">h</span>&nbsp;<span class="op" id="4604966">*</span><span class="ident" id="4604967">hmac</span><span class="op" id="4604971">)</span>&nbsp;<span class="ident" id="4604973">Reset</span><span class="op" id="4604978">(</span><span class="op" id="4604979">)</span>&nbsp;<span class="op" id="4604981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4604984">h</span><span class="op" id="4604985">.</span><span class="ident" id="4604986">inner</span><span class="op" id="4604991">.</span><span class="ident" id="4604992">Reset</span><span class="op" id="4604997">(</span><span class="op" id="4604998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605001">h</span><span class="op" id="4605002">.</span><span class="ident" id="4605003">tmpPad</span><span class="op" id="4605009">(</span><span class="num" id="4605010">0x36</span><span class="op" id="4605014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605017">h</span><span class="op" id="4605018">.</span><span class="ident" id="4605019">inner</span><span class="op" id="4605024">.</span><span class="ident" id="4605025">Write</span><span class="op" id="4605030">(</span><span class="ident" id="4605031">h</span><span class="op" id="4605032">.</span><span class="ident" id="4605033">tmp</span><span class="op" id="4605036">[</span><span class="op" id="4605037">:</span><span class="ident" id="4605038">h</span><span class="op" id="4605039">.</span><span class="ident" id="4605040">blocksize</span><span class="op" id="4605049">]</span><span class="op" id="4605050">)</span><br>
<span class="lineno">75</span><span class="op" id="4605052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4605055">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4605126">func</span>&nbsp;<span class="ident" id="4605131">New</span><span class="op" id="4605134">(</span><span class="ident" id="4605135">h</span>&nbsp;<span class="keyword" id="4605137">func</span><span class="op" id="4605141">(</span><span class="op" id="4605142">)</span>&nbsp;<span class="ident" id="4605144">hash</span><span class="op" id="4605148">.</span><span class="ident" id="4605149">Hash</span><span class="op" id="4605153">,</span>&nbsp;<span class="ident" id="4605155">key</span>&nbsp;<span class="op" id="4605159">[</span><span class="op" id="4605160">]</span><span class="builtintype" id="4605161">byte</span><span class="op" id="4605165">)</span>&nbsp;<span class="ident" id="4605167">hash</span><span class="op" id="4605171">.</span><span class="ident" id="4605172">Hash</span>&nbsp;<span class="op" id="4605177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605180">hm</span>&nbsp;<span class="op" id="4605183">:=</span>&nbsp;<span class="builtinfunc" id="4605186">new</span><span class="op" id="4605189">(</span><span class="ident" id="4605190">hmac</span><span class="op" id="4605194">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605197">hm</span><span class="op" id="4605199">.</span><span class="ident" id="4605200">outer</span>&nbsp;<span class="op" id="4605206">=</span>&nbsp;<span class="ident" id="4605208">h</span><span class="op" id="4605209">(</span><span class="op" id="4605210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605213">hm</span><span class="op" id="4605215">.</span><span class="ident" id="4605216">inner</span>&nbsp;<span class="op" id="4605222">=</span>&nbsp;<span class="ident" id="4605224">h</span><span class="op" id="4605225">(</span><span class="op" id="4605226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605229">hm</span><span class="op" id="4605231">.</span><span class="ident" id="4605232">size</span>&nbsp;<span class="op" id="4605237">=</span>&nbsp;<span class="ident" id="4605239">hm</span><span class="op" id="4605241">.</span><span class="ident" id="4605242">inner</span><span class="op" id="4605247">.</span><span class="ident" id="4605248">Size</span><span class="op" id="4605252">(</span><span class="op" id="4605253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605256">hm</span><span class="op" id="4605258">.</span><span class="ident" id="4605259">blocksize</span>&nbsp;<span class="op" id="4605269">=</span>&nbsp;<span class="ident" id="4605271">hm</span><span class="op" id="4605273">.</span><span class="ident" id="4605274">inner</span><span class="op" id="4605279">.</span><span class="ident" id="4605280">BlockSize</span><span class="op" id="4605289">(</span><span class="op" id="4605290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605293">hm</span><span class="op" id="4605295">.</span><span class="ident" id="4605296">tmp</span>&nbsp;<span class="op" id="4605300">=</span>&nbsp;<span class="builtinfunc" id="4605302">make</span><span class="op" id="4605306">(</span><span class="op" id="4605307">[</span><span class="op" id="4605308">]</span><span class="builtintype" id="4605309">byte</span><span class="op" id="4605313">,</span>&nbsp;<span class="ident" id="4605315">hm</span><span class="op" id="4605317">.</span><span class="ident" id="4605318">blocksize</span><span class="op" id="4605327">+</span><span class="ident" id="4605328">hm</span><span class="op" id="4605330">.</span><span class="ident" id="4605331">size</span><span class="op" id="4605335">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605338">if</span>&nbsp;<span class="builtinfunc" id="4605341">len</span><span class="op" id="4605344">(</span><span class="ident" id="4605345">key</span><span class="op" id="4605348">)</span>&nbsp;<span class="op" id="4605350">&gt;</span>&nbsp;<span class="ident" id="4605352">hm</span><span class="op" id="4605354">.</span><span class="ident" id="4605355">blocksize</span>&nbsp;<span class="op" id="4605365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4605369">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605402">hm</span><span class="op" id="4605404">.</span><span class="ident" id="4605405">outer</span><span class="op" id="4605410">.</span><span class="ident" id="4605411">Write</span><span class="op" id="4605416">(</span><span class="ident" id="4605417">key</span><span class="op" id="4605420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605424">key</span>&nbsp;<span class="op" id="4605428">=</span>&nbsp;<span class="ident" id="4605430">hm</span><span class="op" id="4605432">.</span><span class="ident" id="4605433">outer</span><span class="op" id="4605438">.</span><span class="ident" id="4605439">Sum</span><span class="op" id="4605442">(</span><span class="ident" id="4605443">nil</span><span class="op" id="4605446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4605449">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605452">hm</span><span class="op" id="4605454">.</span><span class="ident" id="4605455">key</span>&nbsp;<span class="op" id="4605459">=</span>&nbsp;<span class="builtinfunc" id="4605461">make</span><span class="op" id="4605465">(</span><span class="op" id="4605466">[</span><span class="op" id="4605467">]</span><span class="builtintype" id="4605468">byte</span><span class="op" id="4605472">,</span>&nbsp;<span class="builtinfunc" id="4605474">len</span><span class="op" id="4605477">(</span><span class="ident" id="4605478">key</span><span class="op" id="4605481">)</span><span class="op" id="4605482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4605485">copy</span><span class="op" id="4605489">(</span><span class="ident" id="4605490">hm</span><span class="op" id="4605492">.</span><span class="ident" id="4605493">key</span><span class="op" id="4605496">,</span>&nbsp;<span class="ident" id="4605498">key</span><span class="op" id="4605501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4605504">hm</span><span class="op" id="4605506">.</span><span class="ident" id="4605507">Reset</span><span class="op" id="4605512">(</span><span class="op" id="4605513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605516">return</span>&nbsp;<span class="ident" id="4605523">hm</span><br>
<span class="lineno"></span><span class="op" id="4605526">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4605529">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4605605">func</span>&nbsp;<span class="ident" id="4605610">Equal</span><span class="op" id="4605615">(</span><span class="ident" id="4605616">mac1</span><span class="op" id="4605620">,</span>&nbsp;<span class="ident" id="4605622">mac2</span>&nbsp;<span class="op" id="4605627">[</span><span class="op" id="4605628">]</span><span class="builtintype" id="4605629">byte</span><span class="op" id="4605633">)</span>&nbsp;<span class="builtintype" id="4605635">bool</span>&nbsp;<span class="op" id="4605640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4605643">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4605712">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4605785">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4605799">return</span>&nbsp;<span class="builtinfunc" id="4605806">len</span><span class="op" id="4605809">(</span><span class="ident" id="4605810">mac1</span><span class="op" id="4605814">)</span>&nbsp;<span class="op" id="4605816">==</span>&nbsp;<span class="builtinfunc" id="4605819">len</span><span class="op" id="4605822">(</span><span class="ident" id="4605823">mac2</span><span class="op" id="4605827">)</span>&nbsp;<span class="op" id="4605829">&amp;&amp;</span>&nbsp;<span class="ident" id="4605832">subtle</span><span class="op" id="4605838">.</span><span class="ident" id="4605839">ConstantTimeCompare</span><span class="op" id="4605858">(</span><span class="ident" id="4605859">mac1</span><span class="op" id="4605863">,</span>&nbsp;<span class="ident" id="4605865">mac2</span><span class="op" id="4605869">)</span>&nbsp;<span class="op" id="4605871">==</span>&nbsp;<span class="num" id="4605874">1</span><br>
<span class="lineno"></span><span class="op" id="4605876">}</span>
</div>
</body>
</html>
