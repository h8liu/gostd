<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2360294">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2360349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2360403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2360454">package</span>&nbsp;<span class="ident" id="2360462">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2360469">type</span>&nbsp;<span class="ident" id="2360474">serializedFile</span>&nbsp;<span class="keyword" id="2360489">struct</span>&nbsp;<span class="op" id="2360496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2360499">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360571">Name</span>&nbsp;&nbsp;<span class="builtintype" id="2360577">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360585">Base</span>&nbsp;&nbsp;<span class="builtintype" id="2360591">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360596">Size</span>&nbsp;&nbsp;<span class="builtintype" id="2360602">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360607">Lines</span>&nbsp;<span class="op" id="2360613">[</span><span class="op" id="2360614">]</span><span class="builtintype" id="2360615">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360620">Infos</span>&nbsp;<span class="op" id="2360626">[</span><span class="op" id="2360627">]</span><span class="ident" id="2360628">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="2360637">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="2360640">type</span>&nbsp;<span class="ident" id="2360645">serializedFileSet</span>&nbsp;<span class="keyword" id="2360663">struct</span>&nbsp;<span class="op" id="2360670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360673">Base</span>&nbsp;&nbsp;<span class="builtintype" id="2360679">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360684">Files</span>&nbsp;<span class="op" id="2360690">[</span><span class="op" id="2360691">]</span><span class="ident" id="2360692">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="2360707">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="2360710">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="2360784">func</span>&nbsp;<span class="op" id="2360789">(</span><span class="ident" id="2360790">s</span>&nbsp;<span class="op" id="2360792">*</span><span class="ident" id="2360793">FileSet</span><span class="op" id="2360800">)</span>&nbsp;<span class="ident" id="2360802">Read</span><span class="op" id="2360806">(</span><span class="ident" id="2360807">decode</span>&nbsp;<span class="keyword" id="2360814">func</span><span class="op" id="2360818">(</span><span class="keyword" id="2360819">interface</span><span class="op" id="2360828">{</span><span class="op" id="2360829">}</span><span class="op" id="2360830">)</span>&nbsp;<span class="builtintype" id="2360832">error</span><span class="op" id="2360837">)</span>&nbsp;<span class="builtintype" id="2360839">error</span>&nbsp;<span class="op" id="2360845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360848">var</span>&nbsp;<span class="ident" id="2360852">ss</span>&nbsp;<span class="ident" id="2360855">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360874">if</span>&nbsp;<span class="ident" id="2360877">err</span>&nbsp;<span class="op" id="2360881">:=</span>&nbsp;<span class="ident" id="2360884">decode</span><span class="op" id="2360890">(</span><span class="op" id="2360891">&amp;</span><span class="ident" id="2360892">ss</span><span class="op" id="2360894">)</span><span class="op" id="2360895">;</span>&nbsp;<span class="ident" id="2360897">err</span>&nbsp;<span class="op" id="2360901">!=</span>&nbsp;<span class="ident" id="2360904">nil</span>&nbsp;<span class="op" id="2360908">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2360912">return</span>&nbsp;<span class="ident" id="2360919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2360924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360928">s</span><span class="op" id="2360929">.</span><span class="ident" id="2360930">mutex</span><span class="op" id="2360935">.</span><span class="ident" id="2360936">Lock</span><span class="op" id="2360940">(</span><span class="op" id="2360941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360944">s</span><span class="op" id="2360945">.</span><span class="ident" id="2360946">base</span>&nbsp;<span class="op" id="2360951">=</span>&nbsp;<span class="ident" id="2360953">ss</span><span class="op" id="2360955">.</span><span class="ident" id="2360956">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2360962">files</span>&nbsp;<span class="op" id="2360968">:=</span>&nbsp;<span class="builtinfunc" id="2360971">make</span><span class="op" id="2360975">(</span><span class="op" id="2360976">[</span><span class="op" id="2360977">]</span><span class="op" id="2360978">*</span><span class="ident" id="2360979">File</span><span class="op" id="2360983">,</span>&nbsp;<span class="builtinfunc" id="2360985">len</span><span class="op" id="2360988">(</span><span class="ident" id="2360989">ss</span><span class="op" id="2360991">.</span><span class="ident" id="2360992">Files</span><span class="op" id="2360997">)</span><span class="op" id="2360998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361001">for</span>&nbsp;<span class="ident" id="2361005">i</span>&nbsp;<span class="op" id="2361007">:=</span>&nbsp;<span class="num" id="2361010">0</span><span class="op" id="2361011">;</span>&nbsp;<span class="ident" id="2361013">i</span>&nbsp;<span class="op" id="2361015">&lt;</span>&nbsp;<span class="builtinfunc" id="2361017">len</span><span class="op" id="2361020">(</span><span class="ident" id="2361021">ss</span><span class="op" id="2361023">.</span><span class="ident" id="2361024">Files</span><span class="op" id="2361029">)</span><span class="op" id="2361030">;</span>&nbsp;<span class="ident" id="2361032">i</span><span class="op" id="2361033">++</span>&nbsp;<span class="op" id="2361036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361040">f</span>&nbsp;<span class="op" id="2361042">:=</span>&nbsp;<span class="op" id="2361045">&amp;</span><span class="ident" id="2361046">ss</span><span class="op" id="2361048">.</span><span class="ident" id="2361049">Files</span><span class="op" id="2361054">[</span><span class="ident" id="2361055">i</span><span class="op" id="2361056">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361060">files</span><span class="op" id="2361065">[</span><span class="ident" id="2361066">i</span><span class="op" id="2361067">]</span>&nbsp;<span class="op" id="2361069">=</span>&nbsp;<span class="op" id="2361071">&amp;</span><span class="ident" id="2361072">File</span><span class="op" id="2361076">{</span><span class="ident" id="2361077">s</span><span class="op" id="2361078">,</span>&nbsp;<span class="ident" id="2361080">f</span><span class="op" id="2361081">.</span><span class="ident" id="2361082">Name</span><span class="op" id="2361086">,</span>&nbsp;<span class="ident" id="2361088">f</span><span class="op" id="2361089">.</span><span class="ident" id="2361090">Base</span><span class="op" id="2361094">,</span>&nbsp;<span class="ident" id="2361096">f</span><span class="op" id="2361097">.</span><span class="ident" id="2361098">Size</span><span class="op" id="2361102">,</span>&nbsp;<span class="ident" id="2361104">f</span><span class="op" id="2361105">.</span><span class="ident" id="2361106">Lines</span><span class="op" id="2361111">,</span>&nbsp;<span class="ident" id="2361113">f</span><span class="op" id="2361114">.</span><span class="ident" id="2361115">Infos</span><span class="op" id="2361120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361123">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361126">s</span><span class="op" id="2361127">.</span><span class="ident" id="2361128">files</span>&nbsp;<span class="op" id="2361134">=</span>&nbsp;<span class="ident" id="2361136">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361143">s</span><span class="op" id="2361144">.</span><span class="ident" id="2361145">last</span>&nbsp;<span class="op" id="2361150">=</span>&nbsp;<span class="ident" id="2361152">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361157">s</span><span class="op" id="2361158">.</span><span class="ident" id="2361159">mutex</span><span class="op" id="2361164">.</span><span class="ident" id="2361165">Unlock</span><span class="op" id="2361171">(</span><span class="op" id="2361172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361176">return</span>&nbsp;<span class="ident" id="2361183">nil</span><br>
<span class="lineno">40</span><span class="op" id="2361187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2361190">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2361241">func</span>&nbsp;<span class="op" id="2361246">(</span><span class="ident" id="2361247">s</span>&nbsp;<span class="op" id="2361249">*</span><span class="ident" id="2361250">FileSet</span><span class="op" id="2361257">)</span>&nbsp;<span class="ident" id="2361259">Write</span><span class="op" id="2361264">(</span><span class="ident" id="2361265">encode</span>&nbsp;<span class="keyword" id="2361272">func</span><span class="op" id="2361276">(</span><span class="keyword" id="2361277">interface</span><span class="op" id="2361286">{</span><span class="op" id="2361287">}</span><span class="op" id="2361288">)</span>&nbsp;<span class="builtintype" id="2361290">error</span><span class="op" id="2361295">)</span>&nbsp;<span class="builtintype" id="2361297">error</span>&nbsp;<span class="op" id="2361303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361306">var</span>&nbsp;<span class="ident" id="2361310">ss</span>&nbsp;<span class="ident" id="2361313">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361333">s</span><span class="op" id="2361334">.</span><span class="ident" id="2361335">mutex</span><span class="op" id="2361340">.</span><span class="ident" id="2361341">Lock</span><span class="op" id="2361345">(</span><span class="op" id="2361346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361349">ss</span><span class="op" id="2361351">.</span><span class="ident" id="2361352">Base</span>&nbsp;<span class="op" id="2361357">=</span>&nbsp;<span class="ident" id="2361359">s</span><span class="op" id="2361360">.</span><span class="ident" id="2361361">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361367">files</span>&nbsp;<span class="op" id="2361373">:=</span>&nbsp;<span class="builtinfunc" id="2361376">make</span><span class="op" id="2361380">(</span><span class="op" id="2361381">[</span><span class="op" id="2361382">]</span><span class="ident" id="2361383">serializedFile</span><span class="op" id="2361397">,</span>&nbsp;<span class="builtinfunc" id="2361399">len</span><span class="op" id="2361402">(</span><span class="ident" id="2361403">s</span><span class="op" id="2361404">.</span><span class="ident" id="2361405">files</span><span class="op" id="2361410">)</span><span class="op" id="2361411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361414">for</span>&nbsp;<span class="ident" id="2361418">i</span><span class="op" id="2361419">,</span>&nbsp;<span class="ident" id="2361421">f</span>&nbsp;<span class="op" id="2361423">:=</span>&nbsp;<span class="keyword" id="2361426">range</span>&nbsp;<span class="ident" id="2361432">s</span><span class="op" id="2361433">.</span><span class="ident" id="2361434">files</span>&nbsp;<span class="op" id="2361440">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361444">files</span><span class="op" id="2361449">[</span><span class="ident" id="2361450">i</span><span class="op" id="2361451">]</span>&nbsp;<span class="op" id="2361453">=</span>&nbsp;<span class="ident" id="2361455">serializedFile</span><span class="op" id="2361469">{</span><span class="ident" id="2361470">f</span><span class="op" id="2361471">.</span><span class="ident" id="2361472">name</span><span class="op" id="2361476">,</span>&nbsp;<span class="ident" id="2361478">f</span><span class="op" id="2361479">.</span><span class="ident" id="2361480">base</span><span class="op" id="2361484">,</span>&nbsp;<span class="ident" id="2361486">f</span><span class="op" id="2361487">.</span><span class="ident" id="2361488">size</span><span class="op" id="2361492">,</span>&nbsp;<span class="ident" id="2361494">f</span><span class="op" id="2361495">.</span><span class="ident" id="2361496">lines</span><span class="op" id="2361501">,</span>&nbsp;<span class="ident" id="2361503">f</span><span class="op" id="2361504">.</span><span class="ident" id="2361505">infos</span><span class="op" id="2361510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2361513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361516">ss</span><span class="op" id="2361518">.</span><span class="ident" id="2361519">Files</span>&nbsp;<span class="op" id="2361525">=</span>&nbsp;<span class="ident" id="2361527">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2361534">s</span><span class="op" id="2361535">.</span><span class="ident" id="2361536">mutex</span><span class="op" id="2361541">.</span><span class="ident" id="2361542">Unlock</span><span class="op" id="2361548">(</span><span class="op" id="2361549">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2361553">return</span>&nbsp;<span class="ident" id="2361560">encode</span><span class="op" id="2361566">(</span><span class="ident" id="2361567">ss</span><span class="op" id="2361569">)</span><br>
<span class="lineno"></span><span class="op" id="2361571">}</span>
</div>
</body>
</html>
