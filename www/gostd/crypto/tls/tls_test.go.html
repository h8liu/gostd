<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8175621">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8175676">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8175730">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8175781">package</span>&nbsp;<span class="ident" id="8175789">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8175794">import</span>&nbsp;<span class="op" id="8175801">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175804">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175813">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175820">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175826">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175833">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175844">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8175855">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8175862">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8175865">var</span>&nbsp;<span class="ident" id="8175869">rsaCertPEM</span>&nbsp;<span class="op" id="8175880">=</span>&nbsp;<span class="string" id="8175882">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="8176578">var</span>&nbsp;<span class="ident" id="8176582">rsaKeyPEM</span>&nbsp;<span class="op" id="8176592">=</span>&nbsp;<span class="string" id="8176594">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8177095">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="8177159">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="8177230">var</span>&nbsp;<span class="ident" id="8177234">keyPEM</span>&nbsp;<span class="op" id="8177241">=</span>&nbsp;<span class="string" id="8177243">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="8177736">var</span>&nbsp;<span class="ident" id="8177740">ecdsaCertPEM</span>&nbsp;<span class="op" id="8177753">=</span>&nbsp;<span class="string" id="8177755">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8178512">var</span>&nbsp;<span class="ident" id="8178516">ecdsaKeyPEM</span>&nbsp;<span class="op" id="8178528">=</span>&nbsp;<span class="string" id="8178530">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8178970">var</span>&nbsp;<span class="ident" id="8178974">keyPairTests</span>&nbsp;<span class="op" id="8178987">=</span>&nbsp;<span class="op" id="8178989">[</span><span class="op" id="8178990">]</span><span class="keyword" id="8178991">struct</span>&nbsp;<span class="op" id="8178998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179001">algo</span>&nbsp;<span class="builtintype" id="8179006">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179014">cert</span>&nbsp;<span class="builtintype" id="8179019">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179027">key</span>&nbsp;&nbsp;<span class="builtintype" id="8179032">string</span><br>
<span class="lineno"></span><span class="op" id="8179039">}</span><span class="op" id="8179040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179043">{</span><span class="string" id="8179044">&#34;ECDSA&#34;</span><span class="op" id="8179051">,</span>&nbsp;<span class="ident" id="8179053">ecdsaCertPEM</span><span class="op" id="8179065">,</span>&nbsp;<span class="ident" id="8179067">ecdsaKeyPEM</span><span class="op" id="8179078">}</span><span class="op" id="8179079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179082">{</span><span class="string" id="8179083">&#34;RSA&#34;</span><span class="op" id="8179088">,</span>&nbsp;<span class="ident" id="8179090">rsaCertPEM</span><span class="op" id="8179100">,</span>&nbsp;<span class="ident" id="8179102">rsaKeyPEM</span><span class="op" id="8179111">}</span><span class="op" id="8179112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179115">{</span><span class="string" id="8179116">&#34;RSA-untyped&#34;</span><span class="op" id="8179129">,</span>&nbsp;<span class="ident" id="8179131">rsaCertPEM</span><span class="op" id="8179141">,</span>&nbsp;<span class="ident" id="8179143">keyPEM</span><span class="op" id="8179149">}</span><span class="op" id="8179150">,</span>&nbsp;<span class="comment" id="8179152">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="8179177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8179180">func</span>&nbsp;<span class="ident" id="8179185">TestX509KeyPair</span><span class="op" id="8179200">(</span><span class="ident" id="8179201">t</span>&nbsp;<span class="op" id="8179203">*</span><span class="ident" id="8179204">testing</span><span class="op" id="8179211">.</span><span class="ident" id="8179212">T</span><span class="op" id="8179213">)</span>&nbsp;<span class="op" id="8179215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179218">var</span>&nbsp;<span class="ident" id="8179222">pem</span>&nbsp;<span class="op" id="8179226">[</span><span class="op" id="8179227">]</span><span class="builtintype" id="8179228">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179234">for</span>&nbsp;<span class="ident" id="8179238">_</span><span class="op" id="8179239">,</span>&nbsp;<span class="ident" id="8179241">test</span>&nbsp;<span class="op" id="8179246">:=</span>&nbsp;<span class="keyword" id="8179249">range</span>&nbsp;<span class="ident" id="8179255">keyPairTests</span>&nbsp;<span class="op" id="8179268">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179272">pem</span>&nbsp;<span class="op" id="8179276">=</span>&nbsp;<span class="op" id="8179278">[</span><span class="op" id="8179279">]</span><span class="builtintype" id="8179280">byte</span><span class="op" id="8179284">(</span><span class="ident" id="8179285">test</span><span class="op" id="8179289">.</span><span class="ident" id="8179290">cert</span>&nbsp;<span class="op" id="8179295">+</span>&nbsp;<span class="ident" id="8179297">test</span><span class="op" id="8179301">.</span><span class="ident" id="8179302">key</span><span class="op" id="8179305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179309">if</span>&nbsp;<span class="ident" id="8179312">_</span><span class="op" id="8179313">,</span>&nbsp;<span class="ident" id="8179315">err</span>&nbsp;<span class="op" id="8179319">:=</span>&nbsp;<span class="ident" id="8179322">X509KeyPair</span><span class="op" id="8179333">(</span><span class="ident" id="8179334">pem</span><span class="op" id="8179337">,</span>&nbsp;<span class="ident" id="8179339">pem</span><span class="op" id="8179342">)</span><span class="op" id="8179343">;</span>&nbsp;<span class="ident" id="8179345">err</span>&nbsp;<span class="op" id="8179349">!=</span>&nbsp;<span class="ident" id="8179352">nil</span>&nbsp;<span class="op" id="8179356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179361">t</span><span class="op" id="8179362">.</span><span class="ident" id="8179363">Errorf</span><span class="op" id="8179369">(</span><span class="string" id="8179370">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8179417">,</span>&nbsp;<span class="ident" id="8179419">test</span><span class="op" id="8179423">.</span><span class="ident" id="8179424">algo</span><span class="op" id="8179428">,</span>&nbsp;<span class="ident" id="8179430">test</span><span class="op" id="8179434">.</span><span class="ident" id="8179435">algo</span><span class="op" id="8179439">,</span>&nbsp;<span class="ident" id="8179441">err</span><span class="op" id="8179444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179452">pem</span>&nbsp;<span class="op" id="8179456">=</span>&nbsp;<span class="op" id="8179458">[</span><span class="op" id="8179459">]</span><span class="builtintype" id="8179460">byte</span><span class="op" id="8179464">(</span><span class="ident" id="8179465">test</span><span class="op" id="8179469">.</span><span class="ident" id="8179470">key</span>&nbsp;<span class="op" id="8179474">+</span>&nbsp;<span class="ident" id="8179476">test</span><span class="op" id="8179480">.</span><span class="ident" id="8179481">cert</span><span class="op" id="8179485">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179489">if</span>&nbsp;<span class="ident" id="8179492">_</span><span class="op" id="8179493">,</span>&nbsp;<span class="ident" id="8179495">err</span>&nbsp;<span class="op" id="8179499">:=</span>&nbsp;<span class="ident" id="8179502">X509KeyPair</span><span class="op" id="8179513">(</span><span class="ident" id="8179514">pem</span><span class="op" id="8179517">,</span>&nbsp;<span class="ident" id="8179519">pem</span><span class="op" id="8179522">)</span><span class="op" id="8179523">;</span>&nbsp;<span class="ident" id="8179525">err</span>&nbsp;<span class="op" id="8179529">!=</span>&nbsp;<span class="ident" id="8179532">nil</span>&nbsp;<span class="op" id="8179536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179541">t</span><span class="op" id="8179542">.</span><span class="ident" id="8179543">Errorf</span><span class="op" id="8179549">(</span><span class="string" id="8179550">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="8179597">,</span>&nbsp;<span class="ident" id="8179599">test</span><span class="op" id="8179603">.</span><span class="ident" id="8179604">algo</span><span class="op" id="8179608">,</span>&nbsp;<span class="ident" id="8179610">test</span><span class="op" id="8179614">.</span><span class="ident" id="8179615">algo</span><span class="op" id="8179619">,</span>&nbsp;<span class="ident" id="8179621">err</span><span class="op" id="8179624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179631">}</span><br>
<span class="lineno"></span><span class="op" id="8179633">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8179636">func</span>&nbsp;<span class="ident" id="8179641">TestX509MixedKeyPair</span><span class="op" id="8179661">(</span><span class="ident" id="8179662">t</span>&nbsp;<span class="op" id="8179664">*</span><span class="ident" id="8179665">testing</span><span class="op" id="8179672">.</span><span class="ident" id="8179673">T</span><span class="op" id="8179674">)</span>&nbsp;<span class="op" id="8179676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179679">if</span>&nbsp;<span class="ident" id="8179682">_</span><span class="op" id="8179683">,</span>&nbsp;<span class="ident" id="8179685">err</span>&nbsp;<span class="op" id="8179689">:=</span>&nbsp;<span class="ident" id="8179692">X509KeyPair</span><span class="op" id="8179703">(</span><span class="op" id="8179704">[</span><span class="op" id="8179705">]</span><span class="builtintype" id="8179706">byte</span><span class="op" id="8179710">(</span><span class="ident" id="8179711">rsaCertPEM</span><span class="op" id="8179721">)</span><span class="op" id="8179722">,</span>&nbsp;<span class="op" id="8179724">[</span><span class="op" id="8179725">]</span><span class="builtintype" id="8179726">byte</span><span class="op" id="8179730">(</span><span class="ident" id="8179731">ecdsaKeyPEM</span><span class="op" id="8179742">)</span><span class="op" id="8179743">)</span><span class="op" id="8179744">;</span>&nbsp;<span class="ident" id="8179746">err</span>&nbsp;<span class="op" id="8179750">==</span>&nbsp;<span class="ident" id="8179753">nil</span>&nbsp;<span class="op" id="8179757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179761">t</span><span class="op" id="8179762">.</span><span class="ident" id="8179763">Error</span><span class="op" id="8179768">(</span><span class="string" id="8179769">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="8179827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179830">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8179833">if</span>&nbsp;<span class="ident" id="8179836">_</span><span class="op" id="8179837">,</span>&nbsp;<span class="ident" id="8179839">err</span>&nbsp;<span class="op" id="8179843">:=</span>&nbsp;<span class="ident" id="8179846">X509KeyPair</span><span class="op" id="8179857">(</span><span class="op" id="8179858">[</span><span class="op" id="8179859">]</span><span class="builtintype" id="8179860">byte</span><span class="op" id="8179864">(</span><span class="ident" id="8179865">ecdsaCertPEM</span><span class="op" id="8179877">)</span><span class="op" id="8179878">,</span>&nbsp;<span class="op" id="8179880">[</span><span class="op" id="8179881">]</span><span class="builtintype" id="8179882">byte</span><span class="op" id="8179886">(</span><span class="ident" id="8179887">rsaKeyPEM</span><span class="op" id="8179896">)</span><span class="op" id="8179897">)</span><span class="op" id="8179898">;</span>&nbsp;<span class="ident" id="8179900">err</span>&nbsp;<span class="op" id="8179904">==</span>&nbsp;<span class="ident" id="8179907">nil</span>&nbsp;<span class="op" id="8179911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8179915">t</span><span class="op" id="8179916">.</span><span class="ident" id="8179917">Error</span><span class="op" id="8179922">(</span><span class="string" id="8179923">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="8179981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8179984">}</span><br>
<span class="lineno"></span><span class="op" id="8179986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="8179989">func</span>&nbsp;<span class="ident" id="8179994">newLocalListener</span><span class="op" id="8180010">(</span><span class="ident" id="8180011">t</span>&nbsp;<span class="op" id="8180013">*</span><span class="ident" id="8180014">testing</span><span class="op" id="8180021">.</span><span class="ident" id="8180022">T</span><span class="op" id="8180023">)</span>&nbsp;<span class="ident" id="8180025">net</span><span class="op" id="8180028">.</span><span class="ident" id="8180029">Listener</span>&nbsp;<span class="op" id="8180038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180041">ln</span><span class="op" id="8180043">,</span>&nbsp;<span class="ident" id="8180045">err</span>&nbsp;<span class="op" id="8180049">:=</span>&nbsp;<span class="ident" id="8180052">net</span><span class="op" id="8180055">.</span><span class="ident" id="8180056">Listen</span><span class="op" id="8180062">(</span><span class="string" id="8180063">&#34;tcp&#34;</span><span class="op" id="8180068">,</span>&nbsp;<span class="string" id="8180070">&#34;127.0.0.1:0&#34;</span><span class="op" id="8180083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180086">if</span>&nbsp;<span class="ident" id="8180089">err</span>&nbsp;<span class="op" id="8180093">!=</span>&nbsp;<span class="ident" id="8180096">nil</span>&nbsp;<span class="op" id="8180100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180104">ln</span><span class="op" id="8180106">,</span>&nbsp;<span class="ident" id="8180108">err</span>&nbsp;<span class="op" id="8180112">=</span>&nbsp;<span class="ident" id="8180114">net</span><span class="op" id="8180117">.</span><span class="ident" id="8180118">Listen</span><span class="op" id="8180124">(</span><span class="string" id="8180125">&#34;tcp6&#34;</span><span class="op" id="8180131">,</span>&nbsp;<span class="string" id="8180133">&#34;[::1]:0&#34;</span><span class="op" id="8180142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180145">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180148">if</span>&nbsp;<span class="ident" id="8180151">err</span>&nbsp;<span class="op" id="8180155">!=</span>&nbsp;<span class="ident" id="8180158">nil</span>&nbsp;<span class="op" id="8180162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180166">t</span><span class="op" id="8180167">.</span><span class="ident" id="8180168">Fatal</span><span class="op" id="8180173">(</span><span class="ident" id="8180174">err</span><span class="op" id="8180177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180183">return</span>&nbsp;<span class="ident" id="8180190">ln</span><br>
<span class="lineno"></span><span class="op" id="8180193">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8180196">func</span>&nbsp;<span class="ident" id="8180201">TestDialTimeout</span><span class="op" id="8180216">(</span><span class="ident" id="8180217">t</span>&nbsp;<span class="op" id="8180219">*</span><span class="ident" id="8180220">testing</span><span class="op" id="8180227">.</span><span class="ident" id="8180228">T</span><span class="op" id="8180229">)</span>&nbsp;<span class="op" id="8180231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180234">if</span>&nbsp;<span class="ident" id="8180237">testing</span><span class="op" id="8180244">.</span><span class="ident" id="8180245">Short</span><span class="op" id="8180250">(</span><span class="op" id="8180251">)</span>&nbsp;<span class="op" id="8180253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180257">t</span><span class="op" id="8180258">.</span><span class="ident" id="8180259">Skip</span><span class="op" id="8180263">(</span><span class="string" id="8180264">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8180288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180291">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180294">listener</span>&nbsp;<span class="op" id="8180303">:=</span>&nbsp;<span class="ident" id="8180306">newLocalListener</span><span class="op" id="8180322">(</span><span class="ident" id="8180323">t</span><span class="op" id="8180324">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180328">addr</span>&nbsp;<span class="op" id="8180333">:=</span>&nbsp;<span class="ident" id="8180336">listener</span><span class="op" id="8180344">.</span><span class="ident" id="8180345">Addr</span><span class="op" id="8180349">(</span><span class="op" id="8180350">)</span><span class="op" id="8180351">.</span><span class="ident" id="8180352">String</span><span class="op" id="8180358">(</span><span class="op" id="8180359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180362">defer</span>&nbsp;<span class="ident" id="8180368">listener</span><span class="op" id="8180376">.</span><span class="ident" id="8180377">Close</span><span class="op" id="8180382">(</span><span class="op" id="8180383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180387">complete</span>&nbsp;<span class="op" id="8180396">:=</span>&nbsp;<span class="builtinfunc" id="8180399">make</span><span class="op" id="8180403">(</span><span class="keyword" id="8180404">chan</span>&nbsp;<span class="builtintype" id="8180409">bool</span><span class="op" id="8180413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180416">defer</span>&nbsp;<span class="builtinfunc" id="8180422">close</span><span class="op" id="8180427">(</span><span class="ident" id="8180428">complete</span><span class="op" id="8180436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180440">go</span>&nbsp;<span class="keyword" id="8180443">func</span><span class="op" id="8180447">(</span><span class="op" id="8180448">)</span>&nbsp;<span class="op" id="8180450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180454">conn</span><span class="op" id="8180458">,</span>&nbsp;<span class="ident" id="8180460">err</span>&nbsp;<span class="op" id="8180464">:=</span>&nbsp;<span class="ident" id="8180467">listener</span><span class="op" id="8180475">.</span><span class="ident" id="8180476">Accept</span><span class="op" id="8180482">(</span><span class="op" id="8180483">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180487">if</span>&nbsp;<span class="ident" id="8180490">err</span>&nbsp;<span class="op" id="8180494">!=</span>&nbsp;<span class="ident" id="8180497">nil</span>&nbsp;<span class="op" id="8180501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180506">t</span><span class="op" id="8180507">.</span><span class="ident" id="8180508">Error</span><span class="op" id="8180513">(</span><span class="ident" id="8180514">err</span><span class="op" id="8180517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180522">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180535">&lt;-</span><span class="ident" id="8180537">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180548">conn</span><span class="op" id="8180552">.</span><span class="ident" id="8180553">Close</span><span class="op" id="8180558">(</span><span class="op" id="8180559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180562">}</span><span class="op" id="8180563">(</span><span class="op" id="8180564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180568">dialer</span>&nbsp;<span class="op" id="8180575">:=</span>&nbsp;<span class="op" id="8180578">&amp;</span><span class="ident" id="8180579">net</span><span class="op" id="8180582">.</span><span class="ident" id="8180583">Dialer</span><span class="op" id="8180589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180593">Timeout</span><span class="op" id="8180600">:</span>&nbsp;<span class="num" id="8180602">10</span>&nbsp;<span class="op" id="8180605">*</span>&nbsp;<span class="ident" id="8180607">time</span><span class="op" id="8180611">.</span><span class="ident" id="8180612">Millisecond</span><span class="op" id="8180623">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180630">var</span>&nbsp;<span class="ident" id="8180634">err</span>&nbsp;<span class="builtintype" id="8180638">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180645">if</span>&nbsp;<span class="ident" id="8180648">_</span><span class="op" id="8180649">,</span>&nbsp;<span class="ident" id="8180651">err</span>&nbsp;<span class="op" id="8180655">=</span>&nbsp;<span class="ident" id="8180657">DialWithDialer</span><span class="op" id="8180671">(</span><span class="ident" id="8180672">dialer</span><span class="op" id="8180678">,</span>&nbsp;<span class="string" id="8180680">&#34;tcp&#34;</span><span class="op" id="8180685">,</span>&nbsp;<span class="ident" id="8180687">addr</span><span class="op" id="8180691">,</span>&nbsp;<span class="ident" id="8180693">nil</span><span class="op" id="8180696">)</span><span class="op" id="8180697">;</span>&nbsp;<span class="ident" id="8180699">err</span>&nbsp;<span class="op" id="8180703">==</span>&nbsp;<span class="ident" id="8180706">nil</span>&nbsp;<span class="op" id="8180710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180714">t</span><span class="op" id="8180715">.</span><span class="ident" id="8180716">Fatal</span><span class="op" id="8180721">(</span><span class="string" id="8180722">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="8180762">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8180769">if</span>&nbsp;<span class="op" id="8180772">!</span><span class="ident" id="8180773">strings</span><span class="op" id="8180780">.</span><span class="ident" id="8180781">Contains</span><span class="op" id="8180789">(</span><span class="ident" id="8180790">err</span><span class="op" id="8180793">.</span><span class="ident" id="8180794">Error</span><span class="op" id="8180799">(</span><span class="op" id="8180800">)</span><span class="op" id="8180801">,</span>&nbsp;<span class="string" id="8180803">&#34;timed&nbsp;out&#34;</span><span class="op" id="8180814">)</span>&nbsp;<span class="op" id="8180816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8180820">t</span><span class="op" id="8180821">.</span><span class="ident" id="8180822">Errorf</span><span class="op" id="8180828">(</span><span class="string" id="8180829">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="8180864">,</span>&nbsp;<span class="ident" id="8180866">err</span><span class="op" id="8180869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8180872">}</span><br>
<span class="lineno">160</span><span class="op" id="8180874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8180877">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8180939">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="8181007">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="8181053">func</span>&nbsp;<span class="ident" id="8181058">TestConnReadNonzeroAndEOF</span><span class="op" id="8181083">(</span><span class="ident" id="8181084">t</span>&nbsp;<span class="op" id="8181086">*</span><span class="ident" id="8181087">testing</span><span class="op" id="8181094">.</span><span class="ident" id="8181095">T</span><span class="op" id="8181096">)</span>&nbsp;<span class="op" id="8181098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181101">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181159">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181217">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181280">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181339">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8181402">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181437">if</span>&nbsp;<span class="ident" id="8181440">testing</span><span class="op" id="8181447">.</span><span class="ident" id="8181448">Short</span><span class="op" id="8181453">(</span><span class="op" id="8181454">)</span>&nbsp;<span class="op" id="8181456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181460">t</span><span class="op" id="8181461">.</span><span class="ident" id="8181462">Skip</span><span class="op" id="8181466">(</span><span class="string" id="8181467">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8181491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181494">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181497">var</span>&nbsp;<span class="ident" id="8181501">err</span>&nbsp;<span class="builtintype" id="8181505">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181512">for</span>&nbsp;<span class="ident" id="8181516">delay</span>&nbsp;<span class="op" id="8181522">:=</span>&nbsp;<span class="ident" id="8181525">time</span><span class="op" id="8181529">.</span><span class="ident" id="8181530">Millisecond</span><span class="op" id="8181541">;</span>&nbsp;<span class="ident" id="8181543">delay</span>&nbsp;<span class="op" id="8181549">&lt;=</span>&nbsp;<span class="num" id="8181552">64</span><span class="op" id="8181554">*</span><span class="ident" id="8181555">time</span><span class="op" id="8181559">.</span><span class="ident" id="8181560">Millisecond</span><span class="op" id="8181571">;</span>&nbsp;<span class="ident" id="8181573">delay</span>&nbsp;<span class="op" id="8181579">*=</span>&nbsp;<span class="num" id="8181582">2</span>&nbsp;<span class="op" id="8181584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181588">if</span>&nbsp;<span class="ident" id="8181591">err</span>&nbsp;<span class="op" id="8181595">=</span>&nbsp;<span class="ident" id="8181597">testConnReadNonzeroAndEOF</span><span class="op" id="8181622">(</span><span class="ident" id="8181623">t</span><span class="op" id="8181624">,</span>&nbsp;<span class="ident" id="8181626">delay</span><span class="op" id="8181631">)</span><span class="op" id="8181632">;</span>&nbsp;<span class="ident" id="8181634">err</span>&nbsp;<span class="op" id="8181638">==</span>&nbsp;<span class="ident" id="8181641">nil</span>&nbsp;<span class="op" id="8181645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181650">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181659">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181665">t</span><span class="op" id="8181666">.</span><span class="ident" id="8181667">Error</span><span class="op" id="8181672">(</span><span class="ident" id="8181673">err</span><span class="op" id="8181676">)</span><br>
<span class="lineno"></span><span class="op" id="8181678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8181681">func</span>&nbsp;<span class="ident" id="8181686">testConnReadNonzeroAndEOF</span><span class="op" id="8181711">(</span><span class="ident" id="8181712">t</span>&nbsp;<span class="op" id="8181714">*</span><span class="ident" id="8181715">testing</span><span class="op" id="8181722">.</span><span class="ident" id="8181723">T</span><span class="op" id="8181724">,</span>&nbsp;<span class="ident" id="8181726">delay</span>&nbsp;<span class="ident" id="8181732">time</span><span class="op" id="8181736">.</span><span class="ident" id="8181737">Duration</span><span class="op" id="8181745">)</span>&nbsp;<span class="builtintype" id="8181747">error</span>&nbsp;<span class="op" id="8181753">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181756">ln</span>&nbsp;<span class="op" id="8181759">:=</span>&nbsp;<span class="ident" id="8181762">newLocalListener</span><span class="op" id="8181778">(</span><span class="ident" id="8181779">t</span><span class="op" id="8181780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181783">defer</span>&nbsp;<span class="ident" id="8181789">ln</span><span class="op" id="8181791">.</span><span class="ident" id="8181792">Close</span><span class="op" id="8181797">(</span><span class="op" id="8181798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181802">srvCh</span>&nbsp;<span class="op" id="8181808">:=</span>&nbsp;<span class="builtinfunc" id="8181811">make</span><span class="op" id="8181815">(</span><span class="keyword" id="8181816">chan</span>&nbsp;<span class="op" id="8181821">*</span><span class="ident" id="8181822">Conn</span><span class="op" id="8181826">,</span>&nbsp;<span class="num" id="8181828">1</span><span class="op" id="8181829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181832">var</span>&nbsp;<span class="ident" id="8181836">serr</span>&nbsp;<span class="builtintype" id="8181841">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181848">go</span>&nbsp;<span class="keyword" id="8181851">func</span><span class="op" id="8181855">(</span><span class="op" id="8181856">)</span>&nbsp;<span class="op" id="8181858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181862">sconn</span><span class="op" id="8181867">,</span>&nbsp;<span class="ident" id="8181869">err</span>&nbsp;<span class="op" id="8181873">:=</span>&nbsp;<span class="ident" id="8181876">ln</span><span class="op" id="8181878">.</span><span class="ident" id="8181879">Accept</span><span class="op" id="8181885">(</span><span class="op" id="8181886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181890">if</span>&nbsp;<span class="ident" id="8181893">err</span>&nbsp;<span class="op" id="8181897">!=</span>&nbsp;<span class="ident" id="8181900">nil</span>&nbsp;<span class="op" id="8181904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181909">serr</span>&nbsp;<span class="op" id="8181914">=</span>&nbsp;<span class="ident" id="8181916">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181923">srvCh</span>&nbsp;<span class="op" id="8181929">&lt;-</span>&nbsp;<span class="ident" id="8181932">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8181939">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8181948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181952">serverConfig</span>&nbsp;<span class="op" id="8181965">:=</span>&nbsp;<span class="op" id="8181968">*</span><span class="ident" id="8181969">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8181982">srv</span>&nbsp;<span class="op" id="8181986">:=</span>&nbsp;<span class="ident" id="8181989">Server</span><span class="op" id="8181995">(</span><span class="ident" id="8181996">sconn</span><span class="op" id="8182001">,</span>&nbsp;<span class="op" id="8182003">&amp;</span><span class="ident" id="8182004">serverConfig</span><span class="op" id="8182016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182020">if</span>&nbsp;<span class="ident" id="8182023">err</span>&nbsp;<span class="op" id="8182027">:=</span>&nbsp;<span class="ident" id="8182030">srv</span><span class="op" id="8182033">.</span><span class="ident" id="8182034">Handshake</span><span class="op" id="8182043">(</span><span class="op" id="8182044">)</span><span class="op" id="8182045">;</span>&nbsp;<span class="ident" id="8182047">err</span>&nbsp;<span class="op" id="8182051">!=</span>&nbsp;<span class="ident" id="8182054">nil</span>&nbsp;<span class="op" id="8182058">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182063">serr</span>&nbsp;<span class="op" id="8182068">=</span>&nbsp;<span class="ident" id="8182070">fmt</span><span class="op" id="8182073">.</span><span class="ident" id="8182074">Errorf</span><span class="op" id="8182080">(</span><span class="string" id="8182081">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="8182096">,</span>&nbsp;<span class="ident" id="8182098">err</span><span class="op" id="8182101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182106">srvCh</span>&nbsp;<span class="op" id="8182112">&lt;-</span>&nbsp;<span class="ident" id="8182115">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182135">srvCh</span>&nbsp;<span class="op" id="8182141">&lt;-</span>&nbsp;<span class="ident" id="8182144">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182149">}</span><span class="op" id="8182150">(</span><span class="op" id="8182151">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182155">clientConfig</span>&nbsp;<span class="op" id="8182168">:=</span>&nbsp;<span class="op" id="8182171">*</span><span class="ident" id="8182172">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182184">conn</span><span class="op" id="8182188">,</span>&nbsp;<span class="ident" id="8182190">err</span>&nbsp;<span class="op" id="8182194">:=</span>&nbsp;<span class="ident" id="8182197">Dial</span><span class="op" id="8182201">(</span><span class="string" id="8182202">&#34;tcp&#34;</span><span class="op" id="8182207">,</span>&nbsp;<span class="ident" id="8182209">ln</span><span class="op" id="8182211">.</span><span class="ident" id="8182212">Addr</span><span class="op" id="8182216">(</span><span class="op" id="8182217">)</span><span class="op" id="8182218">.</span><span class="ident" id="8182219">String</span><span class="op" id="8182225">(</span><span class="op" id="8182226">)</span><span class="op" id="8182227">,</span>&nbsp;<span class="op" id="8182229">&amp;</span><span class="ident" id="8182230">clientConfig</span><span class="op" id="8182242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182245">if</span>&nbsp;<span class="ident" id="8182248">err</span>&nbsp;<span class="op" id="8182252">!=</span>&nbsp;<span class="ident" id="8182255">nil</span>&nbsp;<span class="op" id="8182259">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182263">t</span><span class="op" id="8182264">.</span><span class="ident" id="8182265">Fatal</span><span class="op" id="8182270">(</span><span class="ident" id="8182271">err</span><span class="op" id="8182274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182280">defer</span>&nbsp;<span class="ident" id="8182286">conn</span><span class="op" id="8182290">.</span><span class="ident" id="8182291">Close</span><span class="op" id="8182296">(</span><span class="op" id="8182297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182301">srv</span>&nbsp;<span class="op" id="8182305">:=</span>&nbsp;<span class="op" id="8182308">&lt;-</span><span class="ident" id="8182310">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182317">if</span>&nbsp;<span class="ident" id="8182320">srv</span>&nbsp;<span class="op" id="8182324">==</span>&nbsp;<span class="ident" id="8182327">nil</span>&nbsp;<span class="op" id="8182331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182335">return</span>&nbsp;<span class="ident" id="8182342">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182352">buf</span>&nbsp;<span class="op" id="8182356">:=</span>&nbsp;<span class="builtinfunc" id="8182359">make</span><span class="op" id="8182363">(</span><span class="op" id="8182364">[</span><span class="op" id="8182365">]</span><span class="builtintype" id="8182366">byte</span><span class="op" id="8182370">,</span>&nbsp;<span class="num" id="8182372">6</span><span class="op" id="8182373">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182377">srv</span><span class="op" id="8182380">.</span><span class="ident" id="8182381">Write</span><span class="op" id="8182386">(</span><span class="op" id="8182387">[</span><span class="op" id="8182388">]</span><span class="builtintype" id="8182389">byte</span><span class="op" id="8182393">(</span><span class="string" id="8182394">&#34;foobar&#34;</span><span class="op" id="8182402">)</span><span class="op" id="8182403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182406">n</span><span class="op" id="8182407">,</span>&nbsp;<span class="ident" id="8182409">err</span>&nbsp;<span class="op" id="8182413">:=</span>&nbsp;<span class="ident" id="8182416">conn</span><span class="op" id="8182420">.</span><span class="ident" id="8182421">Read</span><span class="op" id="8182425">(</span><span class="ident" id="8182426">buf</span><span class="op" id="8182429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182432">if</span>&nbsp;<span class="ident" id="8182435">n</span>&nbsp;<span class="op" id="8182437">!=</span>&nbsp;<span class="num" id="8182440">6</span>&nbsp;<span class="op" id="8182442">||</span>&nbsp;<span class="ident" id="8182445">err</span>&nbsp;<span class="op" id="8182449">!=</span>&nbsp;<span class="ident" id="8182452">nil</span>&nbsp;<span class="op" id="8182456">||</span>&nbsp;<span class="builtintype" id="8182459">string</span><span class="op" id="8182465">(</span><span class="ident" id="8182466">buf</span><span class="op" id="8182469">)</span>&nbsp;<span class="op" id="8182471">!=</span>&nbsp;<span class="string" id="8182474">&#34;foobar&#34;</span>&nbsp;<span class="op" id="8182483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182487">return</span>&nbsp;<span class="ident" id="8182494">fmt</span><span class="op" id="8182497">.</span><span class="ident" id="8182498">Errorf</span><span class="op" id="8182504">(</span><span class="string" id="8182505">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="8182550">,</span>&nbsp;<span class="ident" id="8182552">n</span><span class="op" id="8182553">,</span>&nbsp;<span class="ident" id="8182555">err</span><span class="op" id="8182558">,</span>&nbsp;<span class="ident" id="8182560">buf</span><span class="op" id="8182563">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182570">srv</span><span class="op" id="8182573">.</span><span class="ident" id="8182574">Write</span><span class="op" id="8182579">(</span><span class="op" id="8182580">[</span><span class="op" id="8182581">]</span><span class="builtintype" id="8182582">byte</span><span class="op" id="8182586">(</span><span class="string" id="8182587">&#34;abcdef&#34;</span><span class="op" id="8182595">)</span><span class="op" id="8182596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182599">srv</span><span class="op" id="8182602">.</span><span class="ident" id="8182603">Close</span><span class="op" id="8182608">(</span><span class="op" id="8182609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182612">time</span><span class="op" id="8182616">.</span><span class="ident" id="8182617">Sleep</span><span class="op" id="8182622">(</span><span class="ident" id="8182623">delay</span><span class="op" id="8182628">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182631">n</span><span class="op" id="8182632">,</span>&nbsp;<span class="ident" id="8182634">err</span>&nbsp;<span class="op" id="8182638">=</span>&nbsp;<span class="ident" id="8182640">conn</span><span class="op" id="8182644">.</span><span class="ident" id="8182645">Read</span><span class="op" id="8182649">(</span><span class="ident" id="8182650">buf</span><span class="op" id="8182653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182656">if</span>&nbsp;<span class="ident" id="8182659">n</span>&nbsp;<span class="op" id="8182661">!=</span>&nbsp;<span class="num" id="8182664">6</span>&nbsp;<span class="op" id="8182666">||</span>&nbsp;<span class="builtintype" id="8182669">string</span><span class="op" id="8182675">(</span><span class="ident" id="8182676">buf</span><span class="op" id="8182679">)</span>&nbsp;<span class="op" id="8182681">!=</span>&nbsp;<span class="string" id="8182684">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="8182693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182697">return</span>&nbsp;<span class="ident" id="8182704">fmt</span><span class="op" id="8182707">.</span><span class="ident" id="8182708">Errorf</span><span class="op" id="8182714">(</span><span class="string" id="8182715">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="8182751">,</span>&nbsp;<span class="ident" id="8182753">n</span><span class="op" id="8182754">,</span>&nbsp;<span class="ident" id="8182756">buf</span><span class="op" id="8182759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182765">if</span>&nbsp;<span class="ident" id="8182768">err</span>&nbsp;<span class="op" id="8182772">!=</span>&nbsp;<span class="ident" id="8182775">io</span><span class="op" id="8182777">.</span><span class="ident" id="8182778">EOF</span>&nbsp;<span class="op" id="8182782">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182786">return</span>&nbsp;<span class="ident" id="8182793">fmt</span><span class="op" id="8182796">.</span><span class="ident" id="8182797">Errorf</span><span class="op" id="8182803">(</span><span class="string" id="8182804">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="8182841">,</span>&nbsp;<span class="ident" id="8182843">err</span><span class="op" id="8182846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8182849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182852">return</span>&nbsp;<span class="ident" id="8182859">nil</span><br>
<span class="lineno"></span><span class="op" id="8182863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8182866">func</span>&nbsp;<span class="ident" id="8182871">TestTLSUniqueMatches</span><span class="op" id="8182891">(</span><span class="ident" id="8182892">t</span>&nbsp;<span class="op" id="8182894">*</span><span class="ident" id="8182895">testing</span><span class="op" id="8182902">.</span><span class="ident" id="8182903">T</span><span class="op" id="8182904">)</span>&nbsp;<span class="op" id="8182906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182909">ln</span>&nbsp;<span class="op" id="8182912">:=</span>&nbsp;<span class="ident" id="8182915">newLocalListener</span><span class="op" id="8182931">(</span><span class="ident" id="8182932">t</span><span class="op" id="8182933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182936">defer</span>&nbsp;<span class="ident" id="8182942">ln</span><span class="op" id="8182944">.</span><span class="ident" id="8182945">Close</span><span class="op" id="8182950">(</span><span class="op" id="8182951">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8182955">serverTLSUniques</span>&nbsp;<span class="op" id="8182972">:=</span>&nbsp;<span class="builtinfunc" id="8182975">make</span><span class="op" id="8182979">(</span><span class="keyword" id="8182980">chan</span>&nbsp;<span class="op" id="8182985">[</span><span class="op" id="8182986">]</span><span class="builtintype" id="8182987">byte</span><span class="op" id="8182991">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8182994">go</span>&nbsp;<span class="keyword" id="8182997">func</span><span class="op" id="8183001">(</span><span class="op" id="8183002">)</span>&nbsp;<span class="op" id="8183004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183008">for</span>&nbsp;<span class="ident" id="8183012">i</span>&nbsp;<span class="op" id="8183014">:=</span>&nbsp;<span class="num" id="8183017">0</span><span class="op" id="8183018">;</span>&nbsp;<span class="ident" id="8183020">i</span>&nbsp;<span class="op" id="8183022">&lt;</span>&nbsp;<span class="num" id="8183024">2</span><span class="op" id="8183025">;</span>&nbsp;<span class="ident" id="8183027">i</span><span class="op" id="8183028">++</span>&nbsp;<span class="op" id="8183031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183036">sconn</span><span class="op" id="8183041">,</span>&nbsp;<span class="ident" id="8183043">err</span>&nbsp;<span class="op" id="8183047">:=</span>&nbsp;<span class="ident" id="8183050">ln</span><span class="op" id="8183052">.</span><span class="ident" id="8183053">Accept</span><span class="op" id="8183059">(</span><span class="op" id="8183060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183065">if</span>&nbsp;<span class="ident" id="8183068">err</span>&nbsp;<span class="op" id="8183072">!=</span>&nbsp;<span class="ident" id="8183075">nil</span>&nbsp;<span class="op" id="8183079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183085">t</span><span class="op" id="8183086">.</span><span class="ident" id="8183087">Fatal</span><span class="op" id="8183092">(</span><span class="ident" id="8183093">err</span><span class="op" id="8183096">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183106">serverConfig</span>&nbsp;<span class="op" id="8183119">:=</span>&nbsp;<span class="op" id="8183122">*</span><span class="ident" id="8183123">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183137">srv</span>&nbsp;<span class="op" id="8183141">:=</span>&nbsp;<span class="ident" id="8183144">Server</span><span class="op" id="8183150">(</span><span class="ident" id="8183151">sconn</span><span class="op" id="8183156">,</span>&nbsp;<span class="op" id="8183158">&amp;</span><span class="ident" id="8183159">serverConfig</span><span class="op" id="8183171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183176">if</span>&nbsp;<span class="ident" id="8183179">err</span>&nbsp;<span class="op" id="8183183">:=</span>&nbsp;<span class="ident" id="8183186">srv</span><span class="op" id="8183189">.</span><span class="ident" id="8183190">Handshake</span><span class="op" id="8183199">(</span><span class="op" id="8183200">)</span><span class="op" id="8183201">;</span>&nbsp;<span class="ident" id="8183203">err</span>&nbsp;<span class="op" id="8183207">!=</span>&nbsp;<span class="ident" id="8183210">nil</span>&nbsp;<span class="op" id="8183214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183220">t</span><span class="op" id="8183221">.</span><span class="ident" id="8183222">Fatal</span><span class="op" id="8183227">(</span><span class="ident" id="8183228">err</span><span class="op" id="8183231">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183241">serverTLSUniques</span>&nbsp;<span class="op" id="8183258">&lt;-</span>&nbsp;<span class="ident" id="8183261">srv</span><span class="op" id="8183264">.</span><span class="ident" id="8183265">ConnectionState</span><span class="op" id="8183280">(</span><span class="op" id="8183281">)</span><span class="op" id="8183282">.</span><span class="ident" id="8183283">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183298">}</span><span class="op" id="8183299">(</span><span class="op" id="8183300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183304">clientConfig</span>&nbsp;<span class="op" id="8183317">:=</span>&nbsp;<span class="op" id="8183320">*</span><span class="ident" id="8183321">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183333">clientConfig</span><span class="op" id="8183345">.</span><span class="ident" id="8183346">ClientSessionCache</span>&nbsp;<span class="op" id="8183365">=</span>&nbsp;<span class="ident" id="8183367">NewLRUClientSessionCache</span><span class="op" id="8183391">(</span><span class="num" id="8183392">1</span><span class="op" id="8183393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183396">conn</span><span class="op" id="8183400">,</span>&nbsp;<span class="ident" id="8183402">err</span>&nbsp;<span class="op" id="8183406">:=</span>&nbsp;<span class="ident" id="8183409">Dial</span><span class="op" id="8183413">(</span><span class="string" id="8183414">&#34;tcp&#34;</span><span class="op" id="8183419">,</span>&nbsp;<span class="ident" id="8183421">ln</span><span class="op" id="8183423">.</span><span class="ident" id="8183424">Addr</span><span class="op" id="8183428">(</span><span class="op" id="8183429">)</span><span class="op" id="8183430">.</span><span class="ident" id="8183431">String</span><span class="op" id="8183437">(</span><span class="op" id="8183438">)</span><span class="op" id="8183439">,</span>&nbsp;<span class="op" id="8183441">&amp;</span><span class="ident" id="8183442">clientConfig</span><span class="op" id="8183454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183457">if</span>&nbsp;<span class="ident" id="8183460">err</span>&nbsp;<span class="op" id="8183464">!=</span>&nbsp;<span class="ident" id="8183467">nil</span>&nbsp;<span class="op" id="8183471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183475">t</span><span class="op" id="8183476">.</span><span class="ident" id="8183477">Fatal</span><span class="op" id="8183482">(</span><span class="ident" id="8183483">err</span><span class="op" id="8183486">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183492">if</span>&nbsp;<span class="op" id="8183495">!</span><span class="ident" id="8183496">bytes</span><span class="op" id="8183501">.</span><span class="ident" id="8183502">Equal</span><span class="op" id="8183507">(</span><span class="ident" id="8183508">conn</span><span class="op" id="8183512">.</span><span class="ident" id="8183513">ConnectionState</span><span class="op" id="8183528">(</span><span class="op" id="8183529">)</span><span class="op" id="8183530">.</span><span class="ident" id="8183531">TLSUnique</span><span class="op" id="8183540">,</span>&nbsp;<span class="op" id="8183542">&lt;-</span><span class="ident" id="8183544">serverTLSUniques</span><span class="op" id="8183560">)</span>&nbsp;<span class="op" id="8183562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183566">t</span><span class="op" id="8183567">.</span><span class="ident" id="8183568">Error</span><span class="op" id="8183573">(</span><span class="string" id="8183574">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="8183617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183623">conn</span><span class="op" id="8183627">.</span><span class="ident" id="8183628">Close</span><span class="op" id="8183633">(</span><span class="op" id="8183634">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183638">conn</span><span class="op" id="8183642">,</span>&nbsp;<span class="ident" id="8183644">err</span>&nbsp;<span class="op" id="8183648">=</span>&nbsp;<span class="ident" id="8183650">Dial</span><span class="op" id="8183654">(</span><span class="string" id="8183655">&#34;tcp&#34;</span><span class="op" id="8183660">,</span>&nbsp;<span class="ident" id="8183662">ln</span><span class="op" id="8183664">.</span><span class="ident" id="8183665">Addr</span><span class="op" id="8183669">(</span><span class="op" id="8183670">)</span><span class="op" id="8183671">.</span><span class="ident" id="8183672">String</span><span class="op" id="8183678">(</span><span class="op" id="8183679">)</span><span class="op" id="8183680">,</span>&nbsp;<span class="op" id="8183682">&amp;</span><span class="ident" id="8183683">clientConfig</span><span class="op" id="8183695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183698">if</span>&nbsp;<span class="ident" id="8183701">err</span>&nbsp;<span class="op" id="8183705">!=</span>&nbsp;<span class="ident" id="8183708">nil</span>&nbsp;<span class="op" id="8183712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183716">t</span><span class="op" id="8183717">.</span><span class="ident" id="8183718">Fatal</span><span class="op" id="8183723">(</span><span class="ident" id="8183724">err</span><span class="op" id="8183727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183730">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183733">defer</span>&nbsp;<span class="ident" id="8183739">conn</span><span class="op" id="8183743">.</span><span class="ident" id="8183744">Close</span><span class="op" id="8183749">(</span><span class="op" id="8183750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183753">if</span>&nbsp;<span class="op" id="8183756">!</span><span class="ident" id="8183757">conn</span><span class="op" id="8183761">.</span><span class="ident" id="8183762">ConnectionState</span><span class="op" id="8183777">(</span><span class="op" id="8183778">)</span><span class="op" id="8183779">.</span><span class="ident" id="8183780">DidResume</span>&nbsp;<span class="op" id="8183790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183794">t</span><span class="op" id="8183795">.</span><span class="ident" id="8183796">Error</span><span class="op" id="8183801">(</span><span class="string" id="8183802">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="8183841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8183844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8183847">if</span>&nbsp;<span class="op" id="8183850">!</span><span class="ident" id="8183851">bytes</span><span class="op" id="8183856">.</span><span class="ident" id="8183857">Equal</span><span class="op" id="8183862">(</span><span class="ident" id="8183863">conn</span><span class="op" id="8183867">.</span><span class="ident" id="8183868">ConnectionState</span><span class="op" id="8183883">(</span><span class="op" id="8183884">)</span><span class="op" id="8183885">.</span><span class="ident" id="8183886">TLSUnique</span><span class="op" id="8183895">,</span>&nbsp;<span class="op" id="8183897">&lt;-</span><span class="ident" id="8183899">serverTLSUniques</span><span class="op" id="8183915">)</span>&nbsp;<span class="op" id="8183917">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8183921">t</span><span class="op" id="8183922">.</span><span class="ident" id="8183923">Error</span><span class="op" id="8183928">(</span><span class="string" id="8183929">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="8184004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8184007">}</span><br>
<span class="lineno"></span><span class="op" id="8184009">}</span>
</div>
</body>
</html>
