<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode</h2>
<ul>
<li><a href="/gostd/unicode/casetables.go.html">casetables.go</a></li>
<li><a href="/gostd/unicode/digit.go.html">digit.go</a></li>
<li><a href="/gostd/unicode/digit_test.go.html">digit_test.go</a></li>
<li><a href="/gostd/unicode/graphic.go.html">graphic.go</a></li>
<li><a href="/gostd/unicode/graphic_test.go.html">graphic_test.go</a></li>
<li><a href="/gostd/unicode/letter.go.html">letter.go</a></li>
<li><a href="/gostd/unicode/letter_test.go.html">letter_test.go</a></li>
<li><a href="/gostd/unicode/script_test.go.html">script_test.go</a></li>
<li><a href="/gostd/unicode/tables.go.html">tables.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1964953">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1965008">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1965062">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1965113">//&nbsp;Package&nbsp;unicode&nbsp;provides&nbsp;data&nbsp;and&nbsp;functions&nbsp;to&nbsp;test&nbsp;some&nbsp;properties&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1965187">//&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="1965211">package</span>&nbsp;<span class="ident" id="1965219">unicode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1965228">//&nbsp;Tables&nbsp;are&nbsp;regenerated&nbsp;each&nbsp;time&nbsp;we&nbsp;update&nbsp;the&nbsp;Unicode&nbsp;version.</span><br>
<span class="lineno">10</span><span class="comment" id="1965295">//go:generate&nbsp;go&nbsp;run&nbsp;maketables.go&nbsp;-tables=all&nbsp;-output&nbsp;tables.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1965361">const</span>&nbsp;<span class="op" id="1965367">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1965370">MaxRune</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1965386">=</span>&nbsp;<span class="string" id="1965388">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1965401">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1965439">ReplacementChar</span>&nbsp;<span class="op" id="1965455">=</span>&nbsp;<span class="string" id="1965457">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1965470">//&nbsp;Represents&nbsp;invalid&nbsp;code&nbsp;points.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1965506">MaxASCII</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1965522">=</span>&nbsp;<span class="string" id="1965524">&#39;\u007F&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1965537">//&nbsp;maximum&nbsp;ASCII&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1965562">MaxLatin1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1965578">=</span>&nbsp;<span class="string" id="1965580">&#39;\u00FF&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1965593">//&nbsp;maximum&nbsp;Latin-1&nbsp;value.</span><br>
<span class="lineno"></span><span class="op" id="1965619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1965622">//&nbsp;RangeTable&nbsp;defines&nbsp;a&nbsp;set&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;by&nbsp;listing&nbsp;the&nbsp;ranges&nbsp;of</span><br>
<span class="lineno">20</span><span class="comment" id="1965698">//&nbsp;code&nbsp;points&nbsp;within&nbsp;the&nbsp;set.&nbsp;The&nbsp;ranges&nbsp;are&nbsp;listed&nbsp;in&nbsp;two&nbsp;slices</span><br>
<span class="lineno"></span><span class="comment" id="1965765">//&nbsp;to&nbsp;save&nbsp;space:&nbsp;a&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges&nbsp;and&nbsp;a&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="comment" id="1965838">//&nbsp;The&nbsp;two&nbsp;slices&nbsp;must&nbsp;be&nbsp;in&nbsp;sorted&nbsp;order&nbsp;and&nbsp;non-overlapping.</span><br>
<span class="lineno"></span><span class="comment" id="1965901">//&nbsp;Also,&nbsp;R32&nbsp;should&nbsp;contain&nbsp;only&nbsp;values&nbsp;&gt;=&nbsp;0x10000&nbsp;(1&lt;&lt;16).</span><br>
<span class="lineno"></span><span class="keyword" id="1965961">type</span>&nbsp;<span class="ident" id="1965966">RangeTable</span>&nbsp;<span class="keyword" id="1965977">struct</span>&nbsp;<span class="op" id="1965984">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1965987">R16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1965999">[</span><span class="op" id="1966000">]</span><span class="ident" id="1966001">Range16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966010">R32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1966022">[</span><span class="op" id="1966023">]</span><span class="ident" id="1966024">Range32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966033">LatinOffset</span>&nbsp;<span class="builtintype" id="1966045">int</span>&nbsp;<span class="comment" id="1966049">//&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;R16&nbsp;with&nbsp;Hi&nbsp;&lt;=&nbsp;MaxLatin1</span><br>
<span class="lineno"></span><span class="op" id="1966098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="1966101">//&nbsp;Range16&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;16-bit&nbsp;Unicode&nbsp;code&nbsp;points.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno"></span><span class="comment" id="1966195">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.</span><br>
<span class="lineno"></span><span class="keyword" id="1966238">type</span>&nbsp;<span class="ident" id="1966243">Range16</span>&nbsp;<span class="keyword" id="1966251">struct</span>&nbsp;<span class="op" id="1966258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966261">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1966268">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966276">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1966283">uint16</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966291">Stride</span>&nbsp;<span class="builtintype" id="1966298">uint16</span><br>
<span class="lineno"></span><span class="op" id="1966305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1966308">//&nbsp;Range32&nbsp;represents&nbsp;of&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;and&nbsp;is&nbsp;used&nbsp;when&nbsp;one&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="1966388">//&nbsp;more&nbsp;of&nbsp;the&nbsp;values&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;16&nbsp;bits.&nbsp;&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi</span><br>
<span class="lineno">40</span><span class="comment" id="1966465">//&nbsp;inclusive&nbsp;and&nbsp;has&nbsp;the&nbsp;specified&nbsp;stride.&nbsp;Lo&nbsp;and&nbsp;Hi&nbsp;must&nbsp;always&nbsp;be&nbsp;&gt;=&nbsp;1&lt;&lt;16.</span><br>
<span class="lineno"></span><span class="keyword" id="1966543">type</span>&nbsp;<span class="ident" id="1966548">Range32</span>&nbsp;<span class="keyword" id="1966556">struct</span>&nbsp;<span class="op" id="1966563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966566">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1966573">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966581">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1966588">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1966596">Stride</span>&nbsp;<span class="builtintype" id="1966603">uint32</span><br>
<span class="lineno">45</span><span class="op" id="1966610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1966613">//&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;range&nbsp;of&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;for&nbsp;simple&nbsp;(one</span><br>
<span class="lineno"></span><span class="comment" id="1966684">//&nbsp;code&nbsp;point&nbsp;to&nbsp;one&nbsp;code&nbsp;point)&nbsp;case&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="1966734">//&nbsp;The&nbsp;range&nbsp;runs&nbsp;from&nbsp;Lo&nbsp;to&nbsp;Hi&nbsp;inclusive,&nbsp;with&nbsp;a&nbsp;fixed&nbsp;stride&nbsp;of&nbsp;1.&nbsp;&nbsp;Deltas</span><br>
<span class="lineno">50</span><span class="comment" id="1966811">//&nbsp;are&nbsp;the&nbsp;number&nbsp;to&nbsp;add&nbsp;to&nbsp;the&nbsp;code&nbsp;point&nbsp;to&nbsp;reach&nbsp;the&nbsp;code&nbsp;point&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1966884">//&nbsp;different&nbsp;case&nbsp;for&nbsp;that&nbsp;character.&nbsp;&nbsp;They&nbsp;may&nbsp;be&nbsp;negative.&nbsp;&nbsp;If&nbsp;zero,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1966958">//&nbsp;means&nbsp;the&nbsp;character&nbsp;is&nbsp;in&nbsp;the&nbsp;corresponding&nbsp;case.&nbsp;There&nbsp;is&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span><span class="comment" id="1967030">//&nbsp;case&nbsp;representing&nbsp;sequences&nbsp;of&nbsp;alternating&nbsp;corresponding&nbsp;Upper&nbsp;and&nbsp;Lower</span><br>
<span class="lineno"></span><span class="comment" id="1967106">//&nbsp;pairs.&nbsp;&nbsp;It&nbsp;appears&nbsp;with&nbsp;a&nbsp;fixed&nbsp;Delta&nbsp;of</span><br>
<span class="lineno">55</span><span class="comment" id="1967150">//&nbsp;&nbsp;&nbsp;&nbsp{UpperLower,&nbsp;UpperLower,&nbsp;UpperLower}</span><br>
<span class="lineno"></span><span class="comment" id="1967190">//&nbsp;The&nbsp;constant&nbsp;UpperLower&nbsp;has&nbsp;an&nbsp;otherwise&nbsp;impossible&nbsp;delta&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1967258">type</span>&nbsp;<span class="ident" id="1967263">CaseRange</span>&nbsp;<span class="keyword" id="1967273">struct</span>&nbsp;<span class="op" id="1967280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967283">Lo</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1967289">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967297">Hi</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1967303">uint32</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967311">Delta</span>&nbsp;<span class="ident" id="1967317">d</span><br>
<span class="lineno"></span><span class="op" id="1967319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1967322">//&nbsp;SpecialCase&nbsp;represents&nbsp;language-specific&nbsp;case&nbsp;mappings&nbsp;such&nbsp;as&nbsp;Turkish.</span><br>
<span class="lineno"></span><span class="comment" id="1967397">//&nbsp;Methods&nbsp;of&nbsp;SpecialCase&nbsp;customize&nbsp;(by&nbsp;overriding)&nbsp;the&nbsp;standard&nbsp;mappings.</span><br>
<span class="lineno">65</span><span class="keyword" id="1967472">type</span>&nbsp;<span class="ident" id="1967477">SpecialCase</span>&nbsp;<span class="op" id="1967489">[</span><span class="op" id="1967490">]</span><span class="ident" id="1967491">CaseRange</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1967502">//&nbsp;BUG(r):&nbsp;There&nbsp;is&nbsp;no&nbsp;mechanism&nbsp;for&nbsp;full&nbsp;case&nbsp;folding,&nbsp;that&nbsp;is,&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="1967571">//&nbsp;characters&nbsp;that&nbsp;involve&nbsp;multiple&nbsp;runes&nbsp;in&nbsp;the&nbsp;input&nbsp;or&nbsp;output.</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1967638">//&nbsp;Indices&nbsp;into&nbsp;the&nbsp;Delta&nbsp;arrays&nbsp;inside&nbsp;CaseRanges&nbsp;for&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1967707">const</span>&nbsp;<span class="op" id="1967713">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967716">UpperCase</span>&nbsp;<span class="op" id="1967726">=</span>&nbsp;<span class="ident" id="1967728">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967734">LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967745">TitleCase</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967756">MaxCase</span><br>
<span class="lineno"></span><span class="op" id="1967764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1967767">type</span>&nbsp;<span class="ident" id="1967772">d</span>&nbsp;<span class="op" id="1967774">[</span><span class="ident" id="1967775">MaxCase</span><span class="op" id="1967782">]</span><span class="builtintype" id="1967783">rune</span>&nbsp;<span class="comment" id="1967788">//&nbsp;to&nbsp;make&nbsp;the&nbsp;CaseRanges&nbsp;text&nbsp;shorter</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="1967828">//&nbsp;If&nbsp;the&nbsp;Delta&nbsp;field&nbsp;of&nbsp;a&nbsp;CaseRange&nbsp;is&nbsp;UpperLower,&nbsp;it&nbsp;means</span><br>
<span class="lineno"></span><span class="comment" id="1967889">//&nbsp;this&nbsp;CaseRange&nbsp;represents&nbsp;a&nbsp;sequence&nbsp;of&nbsp;the&nbsp;form&nbsp;(say)</span><br>
<span class="lineno"></span><span class="comment" id="1967947">//&nbsp;Upper&nbsp;Lower&nbsp;Upper&nbsp;Lower.</span><br>
<span class="lineno"></span><span class="keyword" id="1967975">const</span>&nbsp;<span class="op" id="1967981">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1967984">UpperLower</span>&nbsp;<span class="op" id="1967995">=</span>&nbsp;<span class="ident" id="1967997">MaxRune</span>&nbsp;<span class="op" id="1968005">+</span>&nbsp;<span class="num" id="1968007">1</span>&nbsp;<span class="comment" id="1968009">//&nbsp;(Cannot&nbsp;be&nbsp;a&nbsp;valid&nbsp;delta.)</span><br>
<span class="lineno">85</span><span class="op" id="1968039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1968042">//&nbsp;linearMax&nbsp;is&nbsp;the&nbsp;maximum&nbsp;size&nbsp;table&nbsp;for&nbsp;linear&nbsp;search&nbsp;for&nbsp;non-Latin1&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1968120">//&nbsp;Derived&nbsp;by&nbsp;running&nbsp;&#39;go&nbsp;test&nbsp;-calibrate&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="1968164">const</span>&nbsp;<span class="ident" id="1968170">linearMax</span>&nbsp;<span class="op" id="1968180">=</span>&nbsp;<span class="num" id="1968182">18</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1968186">//&nbsp;is16&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;16-bit&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword" id="1968253">func</span>&nbsp;<span class="ident" id="1968258">is16</span><span class="op" id="1968262">(</span><span class="ident" id="1968263">ranges</span>&nbsp;<span class="op" id="1968270">[</span><span class="op" id="1968271">]</span><span class="ident" id="1968272">Range16</span><span class="op" id="1968279">,</span>&nbsp;<span class="ident" id="1968281">r</span>&nbsp;<span class="builtintype" id="1968283">uint16</span><span class="op" id="1968289">)</span>&nbsp;<span class="builtintype" id="1968291">bool</span>&nbsp;<span class="op" id="1968296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968299">if</span>&nbsp;<span class="builtinfunc" id="1968302">len</span><span class="op" id="1968305">(</span><span class="ident" id="1968306">ranges</span><span class="op" id="1968312">)</span>&nbsp;<span class="op" id="1968314">&lt;=</span>&nbsp;<span class="ident" id="1968317">linearMax</span>&nbsp;<span class="op" id="1968327">||</span>&nbsp;<span class="ident" id="1968330">r</span>&nbsp;<span class="op" id="1968332">&lt;=</span>&nbsp;<span class="ident" id="1968335">MaxLatin1</span>&nbsp;<span class="op" id="1968345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968349">for</span>&nbsp;<span class="ident" id="1968353">i</span>&nbsp;<span class="op" id="1968355">:=</span>&nbsp;<span class="keyword" id="1968358">range</span>&nbsp;<span class="ident" id="1968364">ranges</span>&nbsp;<span class="op" id="1968371">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968376">range_</span>&nbsp;<span class="op" id="1968383">:=</span>&nbsp;<span class="op" id="1968386">&amp;</span><span class="ident" id="1968387">ranges</span><span class="op" id="1968393">[</span><span class="ident" id="1968394">i</span><span class="op" id="1968395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968400">if</span>&nbsp;<span class="ident" id="1968403">r</span>&nbsp;<span class="op" id="1968405">&lt;</span>&nbsp;<span class="ident" id="1968407">range_</span><span class="op" id="1968413">.</span><span class="ident" id="1968414">Lo</span>&nbsp;<span class="op" id="1968417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968423">return</span>&nbsp;<span class="builtintype" id="1968430">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968444">if</span>&nbsp;<span class="ident" id="1968447">r</span>&nbsp;<span class="op" id="1968449">&lt;=</span>&nbsp;<span class="ident" id="1968452">range_</span><span class="op" id="1968458">.</span><span class="ident" id="1968459">Hi</span>&nbsp;<span class="op" id="1968462">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968468">return</span>&nbsp;<span class="op" id="1968475">(</span><span class="ident" id="1968476">r</span><span class="op" id="1968477">-</span><span class="ident" id="1968478">range_</span><span class="op" id="1968484">.</span><span class="ident" id="1968485">Lo</span><span class="op" id="1968487">)</span><span class="op" id="1968488">%</span><span class="ident" id="1968489">range_</span><span class="op" id="1968495">.</span><span class="ident" id="1968496">Stride</span>&nbsp;<span class="op" id="1968503">==</span>&nbsp;<span class="num" id="1968506">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968519">return</span>&nbsp;<span class="builtintype" id="1968526">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968533">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1968537">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968567">lo</span>&nbsp;<span class="op" id="1968570">:=</span>&nbsp;<span class="num" id="1968573">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968576">hi</span>&nbsp;<span class="op" id="1968579">:=</span>&nbsp;<span class="builtinfunc" id="1968582">len</span><span class="op" id="1968585">(</span><span class="ident" id="1968586">ranges</span><span class="op" id="1968592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968595">for</span>&nbsp;<span class="ident" id="1968599">lo</span>&nbsp;<span class="op" id="1968602">&lt;</span>&nbsp;<span class="ident" id="1968604">hi</span>&nbsp;<span class="op" id="1968607">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968611">m</span>&nbsp;<span class="op" id="1968613">:=</span>&nbsp;<span class="ident" id="1968616">lo</span>&nbsp;<span class="op" id="1968619">+</span>&nbsp;<span class="op" id="1968621">(</span><span class="ident" id="1968622">hi</span><span class="op" id="1968624">-</span><span class="ident" id="1968625">lo</span><span class="op" id="1968627">)</span><span class="op" id="1968628">/</span><span class="num" id="1968629">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968633">range_</span>&nbsp;<span class="op" id="1968640">:=</span>&nbsp;<span class="op" id="1968643">&amp;</span><span class="ident" id="1968644">ranges</span><span class="op" id="1968650">[</span><span class="ident" id="1968651">m</span><span class="op" id="1968652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968656">if</span>&nbsp;<span class="ident" id="1968659">range_</span><span class="op" id="1968665">.</span><span class="ident" id="1968666">Lo</span>&nbsp;<span class="op" id="1968669">&lt;=</span>&nbsp;<span class="ident" id="1968672">r</span>&nbsp;<span class="op" id="1968674">&amp;&amp;</span>&nbsp;<span class="ident" id="1968677">r</span>&nbsp;<span class="op" id="1968679">&lt;=</span>&nbsp;<span class="ident" id="1968682">range_</span><span class="op" id="1968688">.</span><span class="ident" id="1968689">Hi</span>&nbsp;<span class="op" id="1968692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968697">return</span>&nbsp;<span class="op" id="1968704">(</span><span class="ident" id="1968705">r</span><span class="op" id="1968706">-</span><span class="ident" id="1968707">range_</span><span class="op" id="1968713">.</span><span class="ident" id="1968714">Lo</span><span class="op" id="1968716">)</span><span class="op" id="1968717">%</span><span class="ident" id="1968718">range_</span><span class="op" id="1968724">.</span><span class="ident" id="1968725">Stride</span>&nbsp;<span class="op" id="1968732">==</span>&nbsp;<span class="num" id="1968735">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968739">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968743">if</span>&nbsp;<span class="ident" id="1968746">r</span>&nbsp;<span class="op" id="1968748">&lt;</span>&nbsp;<span class="ident" id="1968750">range_</span><span class="op" id="1968756">.</span><span class="ident" id="1968757">Lo</span>&nbsp;<span class="op" id="1968760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968765">hi</span>&nbsp;<span class="op" id="1968768">=</span>&nbsp;<span class="ident" id="1968770">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968774">}</span>&nbsp;<span class="keyword" id="1968776">else</span>&nbsp;<span class="op" id="1968781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968786">lo</span>&nbsp;<span class="op" id="1968789">=</span>&nbsp;<span class="ident" id="1968791">m</span>&nbsp;<span class="op" id="1968793">+</span>&nbsp;<span class="num" id="1968795">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968799">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1968802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968805">return</span>&nbsp;<span class="builtintype" id="1968812">false</span><br>
<span class="lineno"></span><span class="op" id="1968818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1968821">//&nbsp;is32&nbsp;reports&nbsp;whether&nbsp;r&nbsp;is&nbsp;in&nbsp;the&nbsp;sorted&nbsp;slice&nbsp;of&nbsp;32-bit&nbsp;ranges.</span><br>
<span class="lineno">125</span><span class="keyword" id="1968888">func</span>&nbsp;<span class="ident" id="1968893">is32</span><span class="op" id="1968897">(</span><span class="ident" id="1968898">ranges</span>&nbsp;<span class="op" id="1968905">[</span><span class="op" id="1968906">]</span><span class="ident" id="1968907">Range32</span><span class="op" id="1968914">,</span>&nbsp;<span class="ident" id="1968916">r</span>&nbsp;<span class="builtintype" id="1968918">uint32</span><span class="op" id="1968924">)</span>&nbsp;<span class="builtintype" id="1968926">bool</span>&nbsp;<span class="op" id="1968931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968934">if</span>&nbsp;<span class="builtinfunc" id="1968937">len</span><span class="op" id="1968940">(</span><span class="ident" id="1968941">ranges</span><span class="op" id="1968947">)</span>&nbsp;<span class="op" id="1968949">&lt;=</span>&nbsp;<span class="ident" id="1968952">linearMax</span>&nbsp;<span class="op" id="1968962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1968966">for</span>&nbsp;<span class="ident" id="1968970">i</span>&nbsp;<span class="op" id="1968972">:=</span>&nbsp;<span class="keyword" id="1968975">range</span>&nbsp;<span class="ident" id="1968981">ranges</span>&nbsp;<span class="op" id="1968988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1968993">range_</span>&nbsp;<span class="op" id="1969000">:=</span>&nbsp;<span class="op" id="1969003">&amp;</span><span class="ident" id="1969004">ranges</span><span class="op" id="1969010">[</span><span class="ident" id="1969011">i</span><span class="op" id="1969012">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969017">if</span>&nbsp;<span class="ident" id="1969020">r</span>&nbsp;<span class="op" id="1969022">&lt;</span>&nbsp;<span class="ident" id="1969024">range_</span><span class="op" id="1969030">.</span><span class="ident" id="1969031">Lo</span>&nbsp;<span class="op" id="1969034">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969040">return</span>&nbsp;<span class="builtintype" id="1969047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969061">if</span>&nbsp;<span class="ident" id="1969064">r</span>&nbsp;<span class="op" id="1969066">&lt;=</span>&nbsp;<span class="ident" id="1969069">range_</span><span class="op" id="1969075">.</span><span class="ident" id="1969076">Hi</span>&nbsp;<span class="op" id="1969079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969085">return</span>&nbsp;<span class="op" id="1969092">(</span><span class="ident" id="1969093">r</span><span class="op" id="1969094">-</span><span class="ident" id="1969095">range_</span><span class="op" id="1969101">.</span><span class="ident" id="1969102">Lo</span><span class="op" id="1969104">)</span><span class="op" id="1969105">%</span><span class="ident" id="1969106">range_</span><span class="op" id="1969112">.</span><span class="ident" id="1969113">Stride</span>&nbsp;<span class="op" id="1969120">==</span>&nbsp;<span class="num" id="1969123">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969128">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969136">return</span>&nbsp;<span class="builtintype" id="1969143">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1969154">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969184">lo</span>&nbsp;<span class="op" id="1969187">:=</span>&nbsp;<span class="num" id="1969190">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969193">hi</span>&nbsp;<span class="op" id="1969196">:=</span>&nbsp;<span class="builtinfunc" id="1969199">len</span><span class="op" id="1969202">(</span><span class="ident" id="1969203">ranges</span><span class="op" id="1969209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969212">for</span>&nbsp;<span class="ident" id="1969216">lo</span>&nbsp;<span class="op" id="1969219">&lt;</span>&nbsp;<span class="ident" id="1969221">hi</span>&nbsp;<span class="op" id="1969224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969228">m</span>&nbsp;<span class="op" id="1969230">:=</span>&nbsp;<span class="ident" id="1969233">lo</span>&nbsp;<span class="op" id="1969236">+</span>&nbsp;<span class="op" id="1969238">(</span><span class="ident" id="1969239">hi</span><span class="op" id="1969241">-</span><span class="ident" id="1969242">lo</span><span class="op" id="1969244">)</span><span class="op" id="1969245">/</span><span class="num" id="1969246">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969250">range_</span>&nbsp;<span class="op" id="1969257">:=</span>&nbsp;<span class="ident" id="1969260">ranges</span><span class="op" id="1969266">[</span><span class="ident" id="1969267">m</span><span class="op" id="1969268">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969272">if</span>&nbsp;<span class="ident" id="1969275">range_</span><span class="op" id="1969281">.</span><span class="ident" id="1969282">Lo</span>&nbsp;<span class="op" id="1969285">&lt;=</span>&nbsp;<span class="ident" id="1969288">r</span>&nbsp;<span class="op" id="1969290">&amp;&amp;</span>&nbsp;<span class="ident" id="1969293">r</span>&nbsp;<span class="op" id="1969295">&lt;=</span>&nbsp;<span class="ident" id="1969298">range_</span><span class="op" id="1969304">.</span><span class="ident" id="1969305">Hi</span>&nbsp;<span class="op" id="1969308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969313">return</span>&nbsp;<span class="op" id="1969320">(</span><span class="ident" id="1969321">r</span><span class="op" id="1969322">-</span><span class="ident" id="1969323">range_</span><span class="op" id="1969329">.</span><span class="ident" id="1969330">Lo</span><span class="op" id="1969332">)</span><span class="op" id="1969333">%</span><span class="ident" id="1969334">range_</span><span class="op" id="1969340">.</span><span class="ident" id="1969341">Stride</span>&nbsp;<span class="op" id="1969348">==</span>&nbsp;<span class="num" id="1969351">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969359">if</span>&nbsp;<span class="ident" id="1969362">r</span>&nbsp;<span class="op" id="1969364">&lt;</span>&nbsp;<span class="ident" id="1969366">range_</span><span class="op" id="1969372">.</span><span class="ident" id="1969373">Lo</span>&nbsp;<span class="op" id="1969376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969381">hi</span>&nbsp;<span class="op" id="1969384">=</span>&nbsp;<span class="ident" id="1969386">m</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969390">}</span>&nbsp;<span class="keyword" id="1969392">else</span>&nbsp;<span class="op" id="1969397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969402">lo</span>&nbsp;<span class="op" id="1969405">=</span>&nbsp;<span class="ident" id="1969407">m</span>&nbsp;<span class="op" id="1969409">+</span>&nbsp;<span class="num" id="1969411">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969421">return</span>&nbsp;<span class="builtintype" id="1969428">false</span><br>
<span class="lineno">155</span><span class="op" id="1969434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1969437">//&nbsp;Is&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;in&nbsp;the&nbsp;specified&nbsp;table&nbsp;of&nbsp;ranges.</span><br>
<span class="lineno"></span><span class="keyword" id="1969505">func</span>&nbsp;<span class="ident" id="1969510">Is</span><span class="op" id="1969512">(</span><span class="ident" id="1969513">rangeTab</span>&nbsp;<span class="op" id="1969522">*</span><span class="ident" id="1969523">RangeTable</span><span class="op" id="1969533">,</span>&nbsp;<span class="ident" id="1969535">r</span>&nbsp;<span class="builtintype" id="1969537">rune</span><span class="op" id="1969541">)</span>&nbsp;<span class="builtintype" id="1969543">bool</span>&nbsp;<span class="op" id="1969548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969551">r16</span>&nbsp;<span class="op" id="1969555">:=</span>&nbsp;<span class="ident" id="1969558">rangeTab</span><span class="op" id="1969566">.</span><span class="ident" id="1969567">R16</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969572">if</span>&nbsp;<span class="builtinfunc" id="1969575">len</span><span class="op" id="1969578">(</span><span class="ident" id="1969579">r16</span><span class="op" id="1969582">)</span>&nbsp;<span class="op" id="1969584">&gt;</span>&nbsp;<span class="num" id="1969586">0</span>&nbsp;<span class="op" id="1969588">&amp;&amp;</span>&nbsp;<span class="ident" id="1969591">r</span>&nbsp;<span class="op" id="1969593">&lt;=</span>&nbsp;<span class="builtintype" id="1969596">rune</span><span class="op" id="1969600">(</span><span class="ident" id="1969601">r16</span><span class="op" id="1969604">[</span><span class="builtinfunc" id="1969605">len</span><span class="op" id="1969608">(</span><span class="ident" id="1969609">r16</span><span class="op" id="1969612">)</span><span class="op" id="1969613">-</span><span class="num" id="1969614">1</span><span class="op" id="1969615">]</span><span class="op" id="1969616">.</span><span class="ident" id="1969617">Hi</span><span class="op" id="1969619">)</span>&nbsp;<span class="op" id="1969621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969625">return</span>&nbsp;<span class="ident" id="1969632">is16</span><span class="op" id="1969636">(</span><span class="ident" id="1969637">r16</span><span class="op" id="1969640">,</span>&nbsp;<span class="builtintype" id="1969642">uint16</span><span class="op" id="1969648">(</span><span class="ident" id="1969649">r</span><span class="op" id="1969650">)</span><span class="op" id="1969651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969657">r32</span>&nbsp;<span class="op" id="1969661">:=</span>&nbsp;<span class="ident" id="1969664">rangeTab</span><span class="op" id="1969672">.</span><span class="ident" id="1969673">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969678">if</span>&nbsp;<span class="builtinfunc" id="1969681">len</span><span class="op" id="1969684">(</span><span class="ident" id="1969685">r32</span><span class="op" id="1969688">)</span>&nbsp;<span class="op" id="1969690">&gt;</span>&nbsp;<span class="num" id="1969692">0</span>&nbsp;<span class="op" id="1969694">&amp;&amp;</span>&nbsp;<span class="ident" id="1969697">r</span>&nbsp;<span class="op" id="1969699">&gt;=</span>&nbsp;<span class="builtintype" id="1969702">rune</span><span class="op" id="1969706">(</span><span class="ident" id="1969707">r32</span><span class="op" id="1969710">[</span><span class="num" id="1969711">0</span><span class="op" id="1969712">]</span><span class="op" id="1969713">.</span><span class="ident" id="1969714">Lo</span><span class="op" id="1969716">)</span>&nbsp;<span class="op" id="1969718">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969722">return</span>&nbsp;<span class="ident" id="1969729">is32</span><span class="op" id="1969733">(</span><span class="ident" id="1969734">r32</span><span class="op" id="1969737">,</span>&nbsp;<span class="builtintype" id="1969739">uint32</span><span class="op" id="1969745">(</span><span class="ident" id="1969746">r</span><span class="op" id="1969747">)</span><span class="op" id="1969748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969754">return</span>&nbsp;<span class="builtintype" id="1969761">false</span><br>
<span class="lineno"></span><span class="op" id="1969767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="1969770">func</span>&nbsp;<span class="ident" id="1969775">isExcludingLatin</span><span class="op" id="1969791">(</span><span class="ident" id="1969792">rangeTab</span>&nbsp;<span class="op" id="1969801">*</span><span class="ident" id="1969802">RangeTable</span><span class="op" id="1969812">,</span>&nbsp;<span class="ident" id="1969814">r</span>&nbsp;<span class="builtintype" id="1969816">rune</span><span class="op" id="1969820">)</span>&nbsp;<span class="builtintype" id="1969822">bool</span>&nbsp;<span class="op" id="1969827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969830">r16</span>&nbsp;<span class="op" id="1969834">:=</span>&nbsp;<span class="ident" id="1969837">rangeTab</span><span class="op" id="1969845">.</span><span class="ident" id="1969846">R16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969851">if</span>&nbsp;<span class="ident" id="1969854">off</span>&nbsp;<span class="op" id="1969858">:=</span>&nbsp;<span class="ident" id="1969861">rangeTab</span><span class="op" id="1969869">.</span><span class="ident" id="1969870">LatinOffset</span><span class="op" id="1969881">;</span>&nbsp;<span class="builtinfunc" id="1969883">len</span><span class="op" id="1969886">(</span><span class="ident" id="1969887">r16</span><span class="op" id="1969890">)</span>&nbsp;<span class="op" id="1969892">&gt;</span>&nbsp;<span class="ident" id="1969894">off</span>&nbsp;<span class="op" id="1969898">&amp;&amp;</span>&nbsp;<span class="ident" id="1969901">r</span>&nbsp;<span class="op" id="1969903">&lt;=</span>&nbsp;<span class="builtintype" id="1969906">rune</span><span class="op" id="1969910">(</span><span class="ident" id="1969911">r16</span><span class="op" id="1969914">[</span><span class="builtinfunc" id="1969915">len</span><span class="op" id="1969918">(</span><span class="ident" id="1969919">r16</span><span class="op" id="1969922">)</span><span class="op" id="1969923">-</span><span class="num" id="1969924">1</span><span class="op" id="1969925">]</span><span class="op" id="1969926">.</span><span class="ident" id="1969927">Hi</span><span class="op" id="1969929">)</span>&nbsp;<span class="op" id="1969931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969935">return</span>&nbsp;<span class="ident" id="1969942">is16</span><span class="op" id="1969946">(</span><span class="ident" id="1969947">r16</span><span class="op" id="1969950">[</span><span class="ident" id="1969951">off</span><span class="op" id="1969954">:</span><span class="op" id="1969955">]</span><span class="op" id="1969956">,</span>&nbsp;<span class="builtintype" id="1969958">uint16</span><span class="op" id="1969964">(</span><span class="ident" id="1969965">r</span><span class="op" id="1969966">)</span><span class="op" id="1969967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1969970">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1969973">r32</span>&nbsp;<span class="op" id="1969977">:=</span>&nbsp;<span class="ident" id="1969980">rangeTab</span><span class="op" id="1969988">.</span><span class="ident" id="1969989">R32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1969994">if</span>&nbsp;<span class="builtinfunc" id="1969997">len</span><span class="op" id="1970000">(</span><span class="ident" id="1970001">r32</span><span class="op" id="1970004">)</span>&nbsp;<span class="op" id="1970006">&gt;</span>&nbsp;<span class="num" id="1970008">0</span>&nbsp;<span class="op" id="1970010">&amp;&amp;</span>&nbsp;<span class="ident" id="1970013">r</span>&nbsp;<span class="op" id="1970015">&gt;=</span>&nbsp;<span class="builtintype" id="1970018">rune</span><span class="op" id="1970022">(</span><span class="ident" id="1970023">r32</span><span class="op" id="1970026">[</span><span class="num" id="1970027">0</span><span class="op" id="1970028">]</span><span class="op" id="1970029">.</span><span class="ident" id="1970030">Lo</span><span class="op" id="1970032">)</span>&nbsp;<span class="op" id="1970034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970038">return</span>&nbsp;<span class="ident" id="1970045">is32</span><span class="op" id="1970049">(</span><span class="ident" id="1970050">r32</span><span class="op" id="1970053">,</span>&nbsp;<span class="builtintype" id="1970055">uint32</span><span class="op" id="1970061">(</span><span class="ident" id="1970062">r</span><span class="op" id="1970063">)</span><span class="op" id="1970064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1970067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970070">return</span>&nbsp;<span class="builtintype" id="1970077">false</span><br>
<span class="lineno">180</span><span class="op" id="1970083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1970086">//&nbsp;IsUpper&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;an&nbsp;upper&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="1970147">func</span>&nbsp;<span class="ident" id="1970152">IsUpper</span><span class="op" id="1970159">(</span><span class="ident" id="1970160">r</span>&nbsp;<span class="builtintype" id="1970162">rune</span><span class="op" id="1970166">)</span>&nbsp;<span class="builtintype" id="1970168">bool</span>&nbsp;<span class="op" id="1970173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1970176">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970206">if</span>&nbsp;<span class="builtintype" id="1970209">uint32</span><span class="op" id="1970215">(</span><span class="ident" id="1970216">r</span><span class="op" id="1970217">)</span>&nbsp;<span class="op" id="1970219">&lt;=</span>&nbsp;<span class="ident" id="1970222">MaxLatin1</span>&nbsp;<span class="op" id="1970232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970236">return</span>&nbsp;<span class="ident" id="1970243">properties</span><span class="op" id="1970253">[</span><span class="builtintype" id="1970254">uint8</span><span class="op" id="1970259">(</span><span class="ident" id="1970260">r</span><span class="op" id="1970261">)</span><span class="op" id="1970262">]</span><span class="op" id="1970263">&amp;</span><span class="ident" id="1970264">pLmask</span>&nbsp;<span class="op" id="1970271">==</span>&nbsp;<span class="ident" id="1970274">pLu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1970279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970282">return</span>&nbsp;<span class="ident" id="1970289">isExcludingLatin</span><span class="op" id="1970305">(</span><span class="ident" id="1970306">Upper</span><span class="op" id="1970311">,</span>&nbsp;<span class="ident" id="1970313">r</span><span class="op" id="1970314">)</span><br>
<span class="lineno"></span><span class="op" id="1970316">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="1970319">//&nbsp;IsLower&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;lower&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="1970379">func</span>&nbsp;<span class="ident" id="1970384">IsLower</span><span class="op" id="1970391">(</span><span class="ident" id="1970392">r</span>&nbsp;<span class="builtintype" id="1970394">rune</span><span class="op" id="1970398">)</span>&nbsp;<span class="builtintype" id="1970400">bool</span>&nbsp;<span class="op" id="1970405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1970408">//&nbsp;See&nbsp;comment&nbsp;in&nbsp;IsGraphic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970438">if</span>&nbsp;<span class="builtintype" id="1970441">uint32</span><span class="op" id="1970447">(</span><span class="ident" id="1970448">r</span><span class="op" id="1970449">)</span>&nbsp;<span class="op" id="1970451">&lt;=</span>&nbsp;<span class="ident" id="1970454">MaxLatin1</span>&nbsp;<span class="op" id="1970464">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970468">return</span>&nbsp;<span class="ident" id="1970475">properties</span><span class="op" id="1970485">[</span><span class="builtintype" id="1970486">uint8</span><span class="op" id="1970491">(</span><span class="ident" id="1970492">r</span><span class="op" id="1970493">)</span><span class="op" id="1970494">]</span><span class="op" id="1970495">&amp;</span><span class="ident" id="1970496">pLmask</span>&nbsp;<span class="op" id="1970503">==</span>&nbsp;<span class="ident" id="1970506">pLl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1970511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970514">return</span>&nbsp;<span class="ident" id="1970521">isExcludingLatin</span><span class="op" id="1970537">(</span><span class="ident" id="1970538">Lower</span><span class="op" id="1970543">,</span>&nbsp;<span class="ident" id="1970545">r</span><span class="op" id="1970546">)</span><br>
<span class="lineno"></span><span class="op" id="1970548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="1970551">//&nbsp;IsTitle&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;a&nbsp;title&nbsp;case&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="1970611">func</span>&nbsp;<span class="ident" id="1970616">IsTitle</span><span class="op" id="1970623">(</span><span class="ident" id="1970624">r</span>&nbsp;<span class="builtintype" id="1970626">rune</span><span class="op" id="1970630">)</span>&nbsp;<span class="builtintype" id="1970632">bool</span>&nbsp;<span class="op" id="1970637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970640">if</span>&nbsp;<span class="ident" id="1970643">r</span>&nbsp;<span class="op" id="1970645">&lt;=</span>&nbsp;<span class="ident" id="1970648">MaxLatin1</span>&nbsp;<span class="op" id="1970658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970662">return</span>&nbsp;<span class="builtintype" id="1970669">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1970676">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970679">return</span>&nbsp;<span class="ident" id="1970686">isExcludingLatin</span><span class="op" id="1970702">(</span><span class="ident" id="1970703">Title</span><span class="op" id="1970708">,</span>&nbsp;<span class="ident" id="1970710">r</span><span class="op" id="1970711">)</span><br>
<span class="lineno"></span><span class="op" id="1970713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1970716">//&nbsp;to&nbsp;maps&nbsp;the&nbsp;rune&nbsp;using&nbsp;the&nbsp;specified&nbsp;case&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1970770">func</span>&nbsp;<span class="ident" id="1970775">to</span><span class="op" id="1970777">(</span><span class="ident" id="1970778">_case</span>&nbsp;<span class="builtintype" id="1970784">int</span><span class="op" id="1970787">,</span>&nbsp;<span class="ident" id="1970789">r</span>&nbsp;<span class="builtintype" id="1970791">rune</span><span class="op" id="1970795">,</span>&nbsp;<span class="ident" id="1970797">caseRange</span>&nbsp;<span class="op" id="1970807">[</span><span class="op" id="1970808">]</span><span class="ident" id="1970809">CaseRange</span><span class="op" id="1970818">)</span>&nbsp;<span class="builtintype" id="1970820">rune</span>&nbsp;<span class="op" id="1970825">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970828">if</span>&nbsp;<span class="ident" id="1970831">_case</span>&nbsp;<span class="op" id="1970837">&lt;</span>&nbsp;<span class="num" id="1970839">0</span>&nbsp;<span class="op" id="1970841">||</span>&nbsp;<span class="ident" id="1970844">MaxCase</span>&nbsp;<span class="op" id="1970852">&lt;=</span>&nbsp;<span class="ident" id="1970855">_case</span>&nbsp;<span class="op" id="1970861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970865">return</span>&nbsp;<span class="ident" id="1970872">ReplacementChar</span>&nbsp;<span class="comment" id="1970888">//&nbsp;as&nbsp;reasonable&nbsp;an&nbsp;error&nbsp;as&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1970922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1970925">//&nbsp;binary&nbsp;search&nbsp;over&nbsp;ranges</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1970955">lo</span>&nbsp;<span class="op" id="1970958">:=</span>&nbsp;<span class="num" id="1970961">0</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1970964">hi</span>&nbsp;<span class="op" id="1970967">:=</span>&nbsp;<span class="builtinfunc" id="1970970">len</span><span class="op" id="1970973">(</span><span class="ident" id="1970974">caseRange</span><span class="op" id="1970983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1970986">for</span>&nbsp;<span class="ident" id="1970990">lo</span>&nbsp;<span class="op" id="1970993">&lt;</span>&nbsp;<span class="ident" id="1970995">hi</span>&nbsp;<span class="op" id="1970998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1971002">m</span>&nbsp;<span class="op" id="1971004">:=</span>&nbsp;<span class="ident" id="1971007">lo</span>&nbsp;<span class="op" id="1971010">+</span>&nbsp;<span class="op" id="1971012">(</span><span class="ident" id="1971013">hi</span><span class="op" id="1971015">-</span><span class="ident" id="1971016">lo</span><span class="op" id="1971018">)</span><span class="op" id="1971019">/</span><span class="num" id="1971020">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1971024">cr</span>&nbsp;<span class="op" id="1971027">:=</span>&nbsp;<span class="ident" id="1971030">caseRange</span><span class="op" id="1971039">[</span><span class="ident" id="1971040">m</span><span class="op" id="1971041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1971045">if</span>&nbsp;<span class="builtintype" id="1971048">rune</span><span class="op" id="1971052">(</span><span class="ident" id="1971053">cr</span><span class="op" id="1971055">.</span><span class="ident" id="1971056">Lo</span><span class="op" id="1971058">)</span>&nbsp;<span class="op" id="1971060">&lt;=</span>&nbsp;<span class="ident" id="1971063">r</span>&nbsp;<span class="op" id="1971065">&amp;&amp;</span>&nbsp;<span class="ident" id="1971068">r</span>&nbsp;<span class="op" id="1971070">&lt;=</span>&nbsp;<span class="builtintype" id="1971073">rune</span><span class="op" id="1971077">(</span><span class="ident" id="1971078">cr</span><span class="op" id="1971080">.</span><span class="ident" id="1971081">Hi</span><span class="op" id="1971083">)</span>&nbsp;<span class="op" id="1971085">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1971090">delta</span>&nbsp;<span class="op" id="1971096">:=</span>&nbsp;<span class="builtintype" id="1971099">rune</span><span class="op" id="1971103">(</span><span class="ident" id="1971104">cr</span><span class="op" id="1971106">.</span><span class="ident" id="1971107">Delta</span><span class="op" id="1971112">[</span><span class="ident" id="1971113">_case</span><span class="op" id="1971118">]</span><span class="op" id="1971119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1971124">if</span>&nbsp;<span class="ident" id="1971127">delta</span>&nbsp;<span class="op" id="1971133">&gt;</span>&nbsp;<span class="ident" id="1971135">MaxRune</span>&nbsp;<span class="op" id="1971143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971149">//&nbsp;In&nbsp;an&nbsp;Upper-Lower&nbsp;sequence,&nbsp;which&nbsp;always&nbsp;starts&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971209">//&nbsp;an&nbsp;UpperCase&nbsp;letter,&nbsp;the&nbsp;real&nbsp;deltas&nbsp;always&nbsp;look&nbsp;like:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971271">//&nbsp;&nbsp;&nbsp;&nbsp{0,&nbsp;1,&nbsp;0}&nbsp;&nbsp;&nbsp;&nbsp;UpperCase&nbsp;(Lower&nbsp;is&nbsp;next)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971317">//&nbsp;&nbsp;&nbsp;&nbsp{-1,&nbsp;0,&nbsp;-1}&nbsp;&nbsp;LowerCase&nbsp;(Upper,&nbsp;Title&nbsp;are&nbsp;previous)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971375">//&nbsp;The&nbsp;characters&nbsp;at&nbsp;even&nbsp;offsets&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971439">//&nbsp;sequence&nbsp;are&nbsp;upper&nbsp;case;&nbsp;the&nbsp;ones&nbsp;at&nbsp;odd&nbsp;offsets&nbsp;are&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971506">//&nbsp;The&nbsp;correct&nbsp;mapping&nbsp;can&nbsp;be&nbsp;done&nbsp;by&nbsp;clearing&nbsp;or&nbsp;setting&nbsp;the&nbsp;low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971576">//&nbsp;bit&nbsp;in&nbsp;the&nbsp;sequence&nbsp;offset.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971611">//&nbsp;The&nbsp;constants&nbsp;UpperCase&nbsp;and&nbsp;TitleCase&nbsp;are&nbsp;even&nbsp;while&nbsp;LowerCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1971681">//&nbsp;is&nbsp;odd&nbsp;so&nbsp;we&nbsp;take&nbsp;the&nbsp;low&nbsp;bit&nbsp;from&nbsp;_case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1971730">return</span>&nbsp;<span class="builtintype" id="1971737">rune</span><span class="op" id="1971741">(</span><span class="ident" id="1971742">cr</span><span class="op" id="1971744">.</span><span class="ident" id="1971745">Lo</span><span class="op" id="1971747">)</span>&nbsp;<span class="op" id="1971749">+</span>&nbsp;<span class="op" id="1971751">(</span><span class="op" id="1971752">(</span><span class="ident" id="1971753">r</span><span class="op" id="1971754">-</span><span class="builtintype" id="1971755">rune</span><span class="op" id="1971759">(</span><span class="ident" id="1971760">cr</span><span class="op" id="1971762">.</span><span class="ident" id="1971763">Lo</span><span class="op" id="1971765">)</span><span class="op" id="1971766">)</span><span class="op" id="1971767">&amp;^</span><span class="num" id="1971769">1</span>&nbsp;<span class="op" id="1971771">|</span>&nbsp;<span class="builtintype" id="1971773">rune</span><span class="op" id="1971777">(</span><span class="ident" id="1971778">_case</span><span class="op" id="1971783">&amp;</span><span class="num" id="1971784">1</span><span class="op" id="1971785">)</span><span class="op" id="1971786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1971791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1971796">return</span>&nbsp;<span class="ident" id="1971803">r</span>&nbsp;<span class="op" id="1971805">+</span>&nbsp;<span class="ident" id="1971807">delta</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1971815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1971819">if</span>&nbsp;<span class="ident" id="1971822">r</span>&nbsp;<span class="op" id="1971824">&lt;</span>&nbsp;<span class="builtintype" id="1971826">rune</span><span class="op" id="1971830">(</span><span class="ident" id="1971831">cr</span><span class="op" id="1971833">.</span><span class="ident" id="1971834">Lo</span><span class="op" id="1971836">)</span>&nbsp;<span class="op" id="1971838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1971843">hi</span>&nbsp;<span class="op" id="1971846">=</span>&nbsp;<span class="ident" id="1971848">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1971852">}</span>&nbsp;<span class="keyword" id="1971854">else</span>&nbsp;<span class="op" id="1971859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1971864">lo</span>&nbsp;<span class="op" id="1971867">=</span>&nbsp;<span class="ident" id="1971869">m</span>&nbsp;<span class="op" id="1971871">+</span>&nbsp;<span class="num" id="1971873">1</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1971877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1971880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1971883">return</span>&nbsp;<span class="ident" id="1971890">r</span><br>
<span class="lineno"></span><span class="op" id="1971892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="1971895">//&nbsp;To&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;the&nbsp;specified&nbsp;case:&nbsp;UpperCase,&nbsp;LowerCase,&nbsp;or&nbsp;TitleCase.</span><br>
<span class="lineno"></span><span class="keyword" id="1971974">func</span>&nbsp;<span class="ident" id="1971979">To</span><span class="op" id="1971981">(</span><span class="ident" id="1971982">_case</span>&nbsp;<span class="builtintype" id="1971988">int</span><span class="op" id="1971991">,</span>&nbsp;<span class="ident" id="1971993">r</span>&nbsp;<span class="builtintype" id="1971995">rune</span><span class="op" id="1971999">)</span>&nbsp;<span class="builtintype" id="1972001">rune</span>&nbsp;<span class="op" id="1972006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972009">return</span>&nbsp;<span class="ident" id="1972016">to</span><span class="op" id="1972018">(</span><span class="ident" id="1972019">_case</span><span class="op" id="1972024">,</span>&nbsp;<span class="ident" id="1972026">r</span><span class="op" id="1972027">,</span>&nbsp;<span class="ident" id="1972029">CaseRanges</span><span class="op" id="1972039">)</span><br>
<span class="lineno"></span><span class="op" id="1972041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="1972044">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1972084">func</span>&nbsp;<span class="ident" id="1972089">ToUpper</span><span class="op" id="1972096">(</span><span class="ident" id="1972097">r</span>&nbsp;<span class="builtintype" id="1972099">rune</span><span class="op" id="1972103">)</span>&nbsp;<span class="builtintype" id="1972105">rune</span>&nbsp;<span class="op" id="1972110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972113">if</span>&nbsp;<span class="ident" id="1972116">r</span>&nbsp;<span class="op" id="1972118">&lt;=</span>&nbsp;<span class="ident" id="1972121">MaxASCII</span>&nbsp;<span class="op" id="1972130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972134">if</span>&nbsp;<span class="string" id="1972137">&#39;a&#39;</span>&nbsp;<span class="op" id="1972141">&lt;=</span>&nbsp;<span class="ident" id="1972144">r</span>&nbsp;<span class="op" id="1972146">&amp;&amp;</span>&nbsp;<span class="ident" id="1972149">r</span>&nbsp;<span class="op" id="1972151">&lt;=</span>&nbsp;<span class="string" id="1972154">&#39;z&#39;</span>&nbsp;<span class="op" id="1972158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1972163">r</span>&nbsp;<span class="op" id="1972165">-=</span>&nbsp;<span class="string" id="1972168">&#39;a&#39;</span>&nbsp;<span class="op" id="1972172">-</span>&nbsp;<span class="string" id="1972174">&#39;A&#39;</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972184">return</span>&nbsp;<span class="ident" id="1972191">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972197">return</span>&nbsp;<span class="ident" id="1972204">To</span><span class="op" id="1972206">(</span><span class="ident" id="1972207">UpperCase</span><span class="op" id="1972216">,</span>&nbsp;<span class="ident" id="1972218">r</span><span class="op" id="1972219">)</span><br>
<span class="lineno"></span><span class="op" id="1972221">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="1972224">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1972264">func</span>&nbsp;<span class="ident" id="1972269">ToLower</span><span class="op" id="1972276">(</span><span class="ident" id="1972277">r</span>&nbsp;<span class="builtintype" id="1972279">rune</span><span class="op" id="1972283">)</span>&nbsp;<span class="builtintype" id="1972285">rune</span>&nbsp;<span class="op" id="1972290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972293">if</span>&nbsp;<span class="ident" id="1972296">r</span>&nbsp;<span class="op" id="1972298">&lt;=</span>&nbsp;<span class="ident" id="1972301">MaxASCII</span>&nbsp;<span class="op" id="1972310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972314">if</span>&nbsp;<span class="string" id="1972317">&#39;A&#39;</span>&nbsp;<span class="op" id="1972321">&lt;=</span>&nbsp;<span class="ident" id="1972324">r</span>&nbsp;<span class="op" id="1972326">&amp;&amp;</span>&nbsp;<span class="ident" id="1972329">r</span>&nbsp;<span class="op" id="1972331">&lt;=</span>&nbsp;<span class="string" id="1972334">&#39;Z&#39;</span>&nbsp;<span class="op" id="1972338">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1972343">r</span>&nbsp;<span class="op" id="1972345">+=</span>&nbsp;<span class="string" id="1972348">&#39;a&#39;</span>&nbsp;<span class="op" id="1972352">-</span>&nbsp;<span class="string" id="1972354">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972364">return</span>&nbsp;<span class="ident" id="1972371">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972377">return</span>&nbsp;<span class="ident" id="1972384">To</span><span class="op" id="1972386">(</span><span class="ident" id="1972387">LowerCase</span><span class="op" id="1972396">,</span>&nbsp;<span class="ident" id="1972398">r</span><span class="op" id="1972399">)</span><br>
<span class="lineno">270</span><span class="op" id="1972401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1972404">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="1972444">func</span>&nbsp;<span class="ident" id="1972449">ToTitle</span><span class="op" id="1972456">(</span><span class="ident" id="1972457">r</span>&nbsp;<span class="builtintype" id="1972459">rune</span><span class="op" id="1972463">)</span>&nbsp;<span class="builtintype" id="1972465">rune</span>&nbsp;<span class="op" id="1972470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972473">if</span>&nbsp;<span class="ident" id="1972476">r</span>&nbsp;<span class="op" id="1972478">&lt;=</span>&nbsp;<span class="ident" id="1972481">MaxASCII</span>&nbsp;<span class="op" id="1972490">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972494">if</span>&nbsp;<span class="string" id="1972497">&#39;a&#39;</span>&nbsp;<span class="op" id="1972501">&lt;=</span>&nbsp;<span class="ident" id="1972504">r</span>&nbsp;<span class="op" id="1972506">&amp;&amp;</span>&nbsp;<span class="ident" id="1972509">r</span>&nbsp;<span class="op" id="1972511">&lt;=</span>&nbsp;<span class="string" id="1972514">&#39;z&#39;</span>&nbsp;<span class="op" id="1972518">{</span>&nbsp;<span class="comment" id="1972520">//&nbsp;title&nbsp;case&nbsp;is&nbsp;upper&nbsp;case&nbsp;for&nbsp;ASCII</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1972561">r</span>&nbsp;<span class="op" id="1972563">-=</span>&nbsp;<span class="string" id="1972566">&#39;a&#39;</span>&nbsp;<span class="op" id="1972570">-</span>&nbsp;<span class="string" id="1972572">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972582">return</span>&nbsp;<span class="ident" id="1972589">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972592">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972595">return</span>&nbsp;<span class="ident" id="1972602">To</span><span class="op" id="1972604">(</span><span class="ident" id="1972605">TitleCase</span><span class="op" id="1972614">,</span>&nbsp;<span class="ident" id="1972616">r</span><span class="op" id="1972617">)</span><br>
<span class="lineno"></span><span class="op" id="1972619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1972622">//&nbsp;ToUpper&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;upper&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1972701">func</span>&nbsp;<span class="op" id="1972706">(</span><span class="ident" id="1972707">special</span>&nbsp;<span class="ident" id="1972715">SpecialCase</span><span class="op" id="1972726">)</span>&nbsp;<span class="ident" id="1972728">ToUpper</span><span class="op" id="1972735">(</span><span class="ident" id="1972736">r</span>&nbsp;<span class="builtintype" id="1972738">rune</span><span class="op" id="1972742">)</span>&nbsp;<span class="builtintype" id="1972744">rune</span>&nbsp;<span class="op" id="1972749">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1972752">r1</span>&nbsp;<span class="op" id="1972755">:=</span>&nbsp;<span class="ident" id="1972758">to</span><span class="op" id="1972760">(</span><span class="ident" id="1972761">UpperCase</span><span class="op" id="1972770">,</span>&nbsp;<span class="ident" id="1972772">r</span><span class="op" id="1972773">,</span>&nbsp;<span class="op" id="1972775">[</span><span class="op" id="1972776">]</span><span class="ident" id="1972777">CaseRange</span><span class="op" id="1972786">(</span><span class="ident" id="1972787">special</span><span class="op" id="1972794">)</span><span class="op" id="1972795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972798">if</span>&nbsp;<span class="ident" id="1972801">r1</span>&nbsp;<span class="op" id="1972804">==</span>&nbsp;<span class="ident" id="1972807">r</span>&nbsp;<span class="op" id="1972809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1972813">r1</span>&nbsp;<span class="op" id="1972816">=</span>&nbsp;<span class="ident" id="1972818">ToUpper</span><span class="op" id="1972825">(</span><span class="ident" id="1972826">r</span><span class="op" id="1972827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1972830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1972833">return</span>&nbsp;<span class="ident" id="1972840">r1</span><br>
<span class="lineno">290</span><span class="op" id="1972843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1972846">//&nbsp;ToTitle&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;title&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1972925">func</span>&nbsp;<span class="op" id="1972930">(</span><span class="ident" id="1972931">special</span>&nbsp;<span class="ident" id="1972939">SpecialCase</span><span class="op" id="1972950">)</span>&nbsp;<span class="ident" id="1972952">ToTitle</span><span class="op" id="1972959">(</span><span class="ident" id="1972960">r</span>&nbsp;<span class="builtintype" id="1972962">rune</span><span class="op" id="1972966">)</span>&nbsp;<span class="builtintype" id="1972968">rune</span>&nbsp;<span class="op" id="1972973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1972976">r1</span>&nbsp;<span class="op" id="1972979">:=</span>&nbsp;<span class="ident" id="1972982">to</span><span class="op" id="1972984">(</span><span class="ident" id="1972985">TitleCase</span><span class="op" id="1972994">,</span>&nbsp;<span class="ident" id="1972996">r</span><span class="op" id="1972997">,</span>&nbsp;<span class="op" id="1972999">[</span><span class="op" id="1973000">]</span><span class="ident" id="1973001">CaseRange</span><span class="op" id="1973010">(</span><span class="ident" id="1973011">special</span><span class="op" id="1973018">)</span><span class="op" id="1973019">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1973022">if</span>&nbsp;<span class="ident" id="1973025">r1</span>&nbsp;<span class="op" id="1973028">==</span>&nbsp;<span class="ident" id="1973031">r</span>&nbsp;<span class="op" id="1973033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1973037">r1</span>&nbsp;<span class="op" id="1973040">=</span>&nbsp;<span class="ident" id="1973042">ToTitle</span><span class="op" id="1973049">(</span><span class="ident" id="1973050">r</span><span class="op" id="1973051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1973054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1973057">return</span>&nbsp;<span class="ident" id="1973064">r1</span><br>
<span class="lineno"></span><span class="op" id="1973067">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="1973070">//&nbsp;ToLower&nbsp;maps&nbsp;the&nbsp;rune&nbsp;to&nbsp;lower&nbsp;case&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;mapping.</span><br>
<span class="lineno"></span><span class="keyword" id="1973149">func</span>&nbsp;<span class="op" id="1973154">(</span><span class="ident" id="1973155">special</span>&nbsp;<span class="ident" id="1973163">SpecialCase</span><span class="op" id="1973174">)</span>&nbsp;<span class="ident" id="1973176">ToLower</span><span class="op" id="1973183">(</span><span class="ident" id="1973184">r</span>&nbsp;<span class="builtintype" id="1973186">rune</span><span class="op" id="1973190">)</span>&nbsp;<span class="builtintype" id="1973192">rune</span>&nbsp;<span class="op" id="1973197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1973200">r1</span>&nbsp;<span class="op" id="1973203">:=</span>&nbsp;<span class="ident" id="1973206">to</span><span class="op" id="1973208">(</span><span class="ident" id="1973209">LowerCase</span><span class="op" id="1973218">,</span>&nbsp;<span class="ident" id="1973220">r</span><span class="op" id="1973221">,</span>&nbsp;<span class="op" id="1973223">[</span><span class="op" id="1973224">]</span><span class="ident" id="1973225">CaseRange</span><span class="op" id="1973234">(</span><span class="ident" id="1973235">special</span><span class="op" id="1973242">)</span><span class="op" id="1973243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1973246">if</span>&nbsp;<span class="ident" id="1973249">r1</span>&nbsp;<span class="op" id="1973252">==</span>&nbsp;<span class="ident" id="1973255">r</span>&nbsp;<span class="op" id="1973257">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1973261">r1</span>&nbsp;<span class="op" id="1973264">=</span>&nbsp;<span class="ident" id="1973266">ToLower</span><span class="op" id="1973273">(</span><span class="ident" id="1973274">r</span><span class="op" id="1973275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1973278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1973281">return</span>&nbsp;<span class="ident" id="1973288">r1</span><br>
<span class="lineno"></span><span class="op" id="1973291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="1973294">//&nbsp;caseOrbit&nbsp;is&nbsp;defined&nbsp;in&nbsp;tables.go&nbsp;as&nbsp;[]foldPair.&nbsp;&nbsp;Right&nbsp;now&nbsp;all&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1973365">//&nbsp;entries&nbsp;fit&nbsp;in&nbsp;uint16,&nbsp;so&nbsp;use&nbsp;uint16.&nbsp;&nbsp;If&nbsp;that&nbsp;changes,&nbsp;compilation</span><br>
<span class="lineno"></span><span class="comment" id="1973436">//&nbsp;will&nbsp;fail&nbsp;(the&nbsp;constants&nbsp;in&nbsp;the&nbsp;composite&nbsp;literal&nbsp;will&nbsp;not&nbsp;fit&nbsp;in&nbsp;uint16)</span><br>
<span class="lineno"></span><span class="comment" id="1973513">//&nbsp;and&nbsp;the&nbsp;types&nbsp;here&nbsp;can&nbsp;change&nbsp;to&nbsp;uint32.</span><br>
<span class="lineno"></span><span class="keyword" id="1973557">type</span>&nbsp;<span class="ident" id="1973562">foldPair</span>&nbsp;<span class="keyword" id="1973571">struct</span>&nbsp;<span class="op" id="1973578">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1973581">From</span>&nbsp;<span class="builtintype" id="1973586">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1973594">To</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1973599">uint16</span><br>
<span class="lineno"></span><span class="op" id="1973606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1973609">//&nbsp;SimpleFold&nbsp;iterates&nbsp;over&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;equivalent&nbsp;under</span><br>
<span class="lineno">320</span><span class="comment" id="1973674">//&nbsp;the&nbsp;Unicode-defined&nbsp;simple&nbsp;case&nbsp;folding.&nbsp;&nbsp;Among&nbsp;the&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="1973741">//&nbsp;equivalent&nbsp;to&nbsp;rune&nbsp;(including&nbsp;rune&nbsp;itself),&nbsp;SimpleFold&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1973811">//&nbsp;smallest&nbsp;rune&nbsp;&gt;&nbsp;r&nbsp;if&nbsp;one&nbsp;exists,&nbsp;or&nbsp;else&nbsp;the&nbsp;smallest&nbsp;rune&nbsp;&gt;=&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1973879">//</span><br>
<span class="lineno"></span><span class="comment" id="1973882">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno">325</span><span class="comment" id="1973898">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;A&#39;)&nbsp;=&nbsp;&#39;a&#39;</span><br>
<span class="lineno"></span><span class="comment" id="1973923">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;a&#39;)&nbsp;=&nbsp;&#39;A&#39;</span><br>
<span class="lineno"></span><span class="comment" id="1973948">//</span><br>
<span class="lineno"></span><span class="comment" id="1973951">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;K&#39;)&nbsp;=&nbsp;&#39;k&#39;</span><br>
<span class="lineno"></span><span class="comment" id="1973976">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;k&#39;)&nbsp;=&nbsp;&#39;\u212A&#39;&nbsp;(Kelvin&nbsp;symbol,&nbsp;)</span><br>
<span class="lineno">330</span><span class="comment" id="1974027">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;\u212A&#39;)&nbsp;=&nbsp;&#39;K&#39;</span><br>
<span class="lineno"></span><span class="comment" id="1974057">//</span><br>
<span class="lineno"></span><span class="comment" id="1974060">//&nbsp;&nbsp;&nbsp;&nbspSimpleFold(&#39;1&#39;)&nbsp;=&nbsp;&#39;1&#39;</span><br>
<span class="lineno"></span><span class="comment" id="1974085">//</span><br>
<span class="lineno"></span><span class="keyword" id="1974088">func</span>&nbsp;<span class="ident" id="1974093">SimpleFold</span><span class="op" id="1974103">(</span><span class="ident" id="1974104">r</span>&nbsp;<span class="builtintype" id="1974106">rune</span><span class="op" id="1974110">)</span>&nbsp;<span class="builtintype" id="1974112">rune</span>&nbsp;<span class="op" id="1974117">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1974120">//&nbsp;Consult&nbsp;caseOrbit&nbsp;table&nbsp;for&nbsp;special&nbsp;cases.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1974167">lo</span>&nbsp;<span class="op" id="1974170">:=</span>&nbsp;<span class="num" id="1974173">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1974176">hi</span>&nbsp;<span class="op" id="1974179">:=</span>&nbsp;<span class="builtinfunc" id="1974182">len</span><span class="op" id="1974185">(</span><span class="ident" id="1974186">caseOrbit</span><span class="op" id="1974195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974198">for</span>&nbsp;<span class="ident" id="1974202">lo</span>&nbsp;<span class="op" id="1974205">&lt;</span>&nbsp;<span class="ident" id="1974207">hi</span>&nbsp;<span class="op" id="1974210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1974214">m</span>&nbsp;<span class="op" id="1974216">:=</span>&nbsp;<span class="ident" id="1974219">lo</span>&nbsp;<span class="op" id="1974222">+</span>&nbsp;<span class="op" id="1974224">(</span><span class="ident" id="1974225">hi</span><span class="op" id="1974227">-</span><span class="ident" id="1974228">lo</span><span class="op" id="1974230">)</span><span class="op" id="1974231">/</span><span class="num" id="1974232">2</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974236">if</span>&nbsp;<span class="builtintype" id="1974239">rune</span><span class="op" id="1974243">(</span><span class="ident" id="1974244">caseOrbit</span><span class="op" id="1974253">[</span><span class="ident" id="1974254">m</span><span class="op" id="1974255">]</span><span class="op" id="1974256">.</span><span class="ident" id="1974257">From</span><span class="op" id="1974261">)</span>&nbsp;<span class="op" id="1974263">&lt;</span>&nbsp;<span class="ident" id="1974265">r</span>&nbsp;<span class="op" id="1974267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1974272">lo</span>&nbsp;<span class="op" id="1974275">=</span>&nbsp;<span class="ident" id="1974277">m</span>&nbsp;<span class="op" id="1974279">+</span>&nbsp;<span class="num" id="1974281">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1974285">}</span>&nbsp;<span class="keyword" id="1974287">else</span>&nbsp;<span class="op" id="1974292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1974297">hi</span>&nbsp;<span class="op" id="1974300">=</span>&nbsp;<span class="ident" id="1974302">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1974306">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1974309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974312">if</span>&nbsp;<span class="ident" id="1974315">lo</span>&nbsp;<span class="op" id="1974318">&lt;</span>&nbsp;<span class="builtinfunc" id="1974320">len</span><span class="op" id="1974323">(</span><span class="ident" id="1974324">caseOrbit</span><span class="op" id="1974333">)</span>&nbsp;<span class="op" id="1974335">&amp;&amp;</span>&nbsp;<span class="builtintype" id="1974338">rune</span><span class="op" id="1974342">(</span><span class="ident" id="1974343">caseOrbit</span><span class="op" id="1974352">[</span><span class="ident" id="1974353">lo</span><span class="op" id="1974355">]</span><span class="op" id="1974356">.</span><span class="ident" id="1974357">From</span><span class="op" id="1974361">)</span>&nbsp;<span class="op" id="1974363">==</span>&nbsp;<span class="ident" id="1974366">r</span>&nbsp;<span class="op" id="1974368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974372">return</span>&nbsp;<span class="builtintype" id="1974379">rune</span><span class="op" id="1974383">(</span><span class="ident" id="1974384">caseOrbit</span><span class="op" id="1974393">[</span><span class="ident" id="1974394">lo</span><span class="op" id="1974396">]</span><span class="op" id="1974397">.</span><span class="ident" id="1974398">To</span><span class="op" id="1974400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1974403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1974407">//&nbsp;No&nbsp;folding&nbsp;specified.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;one-&nbsp;or&nbsp;two-element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1974464">//&nbsp;equivalence&nbsp;class&nbsp;containing&nbsp;rune&nbsp;and&nbsp;ToLower(rune)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1974520">//&nbsp;and&nbsp;ToUpper(rune)&nbsp;if&nbsp;they&nbsp;are&nbsp;different&nbsp;from&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974575">if</span>&nbsp;<span class="ident" id="1974578">l</span>&nbsp;<span class="op" id="1974580">:=</span>&nbsp;<span class="ident" id="1974583">ToLower</span><span class="op" id="1974590">(</span><span class="ident" id="1974591">r</span><span class="op" id="1974592">)</span><span class="op" id="1974593">;</span>&nbsp;<span class="ident" id="1974595">l</span>&nbsp;<span class="op" id="1974597">!=</span>&nbsp;<span class="ident" id="1974600">r</span>&nbsp;<span class="op" id="1974602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974606">return</span>&nbsp;<span class="ident" id="1974613">l</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1974616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1974619">return</span>&nbsp;<span class="ident" id="1974626">ToUpper</span><span class="op" id="1974633">(</span><span class="ident" id="1974634">r</span><span class="op" id="1974635">)</span><br>
<span class="lineno"></span><span class="op" id="1974637">}</span>
</div>
</body>
</html>
