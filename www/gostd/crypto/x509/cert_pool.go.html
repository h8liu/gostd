<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4608244">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4608299">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4608353">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4608404">package</span>&nbsp;<span class="ident" id="4608412">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4608418">import</span>&nbsp;<span class="op" id="4608425">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4608428">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4608443">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4608446">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4608484">type</span>&nbsp;<span class="ident" id="4608489">CertPool</span>&nbsp;<span class="keyword" id="4608498">struct</span>&nbsp;<span class="op" id="4608505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4608508">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4608523">map</span><span class="op" id="4608526">[</span><span class="builtintype" id="4608527">string</span><span class="op" id="4608533">]</span><span class="op" id="4608534">[</span><span class="op" id="4608535">]</span><span class="builtintype" id="4608536">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4608541">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4608556">map</span><span class="op" id="4608559">[</span><span class="builtintype" id="4608560">string</span><span class="op" id="4608566">]</span><span class="op" id="4608567">[</span><span class="op" id="4608568">]</span><span class="builtintype" id="4608569">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4608574">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4608589">[</span><span class="op" id="4608590">]</span><span class="op" id="4608591">*</span><span class="ident" id="4608592">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4608604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4608607">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4608653">func</span>&nbsp;<span class="ident" id="4608658">NewCertPool</span><span class="op" id="4608669">(</span><span class="op" id="4608670">)</span>&nbsp;<span class="op" id="4608672">*</span><span class="ident" id="4608673">CertPool</span>&nbsp;<span class="op" id="4608682">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4608685">return</span>&nbsp;<span class="op" id="4608692">&amp;</span><span class="ident" id="4608693">CertPool</span><span class="op" id="4608701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4608705">make</span><span class="op" id="4608709">(</span><span class="keyword" id="4608710">map</span><span class="op" id="4608713">[</span><span class="builtintype" id="4608714">string</span><span class="op" id="4608720">]</span><span class="op" id="4608721">[</span><span class="op" id="4608722">]</span><span class="builtintype" id="4608723">int</span><span class="op" id="4608726">)</span><span class="op" id="4608727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4608731">make</span><span class="op" id="4608735">(</span><span class="keyword" id="4608736">map</span><span class="op" id="4608739">[</span><span class="builtintype" id="4608740">string</span><span class="op" id="4608746">]</span><span class="op" id="4608747">[</span><span class="op" id="4608748">]</span><span class="builtintype" id="4608749">int</span><span class="op" id="4608752">)</span><span class="op" id="4608753">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4608757">nil</span><span class="op" id="4608760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4608763">}</span><br>
<span class="lineno">25</span><span class="op" id="4608765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4608768">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4608848">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4608927">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4609003">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4609016">func</span>&nbsp;<span class="op" id="4609021">(</span><span class="ident" id="4609022">s</span>&nbsp;<span class="op" id="4609024">*</span><span class="ident" id="4609025">CertPool</span><span class="op" id="4609033">)</span>&nbsp;<span class="ident" id="4609035">findVerifiedParents</span><span class="op" id="4609054">(</span><span class="ident" id="4609055">cert</span>&nbsp;<span class="op" id="4609060">*</span><span class="ident" id="4609061">Certificate</span><span class="op" id="4609072">)</span>&nbsp;<span class="op" id="4609074">(</span><span class="ident" id="4609075">parents</span>&nbsp;<span class="op" id="4609083">[</span><span class="op" id="4609084">]</span><span class="builtintype" id="4609085">int</span><span class="op" id="4609088">,</span>&nbsp;<span class="ident" id="4609090">errCert</span>&nbsp;<span class="op" id="4609098">*</span><span class="ident" id="4609099">Certificate</span><span class="op" id="4609110">,</span>&nbsp;<span class="ident" id="4609112">err</span>&nbsp;<span class="builtintype" id="4609116">error</span><span class="op" id="4609121">)</span>&nbsp;<span class="op" id="4609123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609126">if</span>&nbsp;<span class="ident" id="4609129">s</span>&nbsp;<span class="op" id="4609131">==</span>&nbsp;<span class="ident" id="4609134">nil</span>&nbsp;<span class="op" id="4609138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609142">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609150">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609153">var</span>&nbsp;<span class="ident" id="4609157">candidates</span>&nbsp;<span class="op" id="4609168">[</span><span class="op" id="4609169">]</span><span class="builtintype" id="4609170">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609176">if</span>&nbsp;<span class="builtinfunc" id="4609179">len</span><span class="op" id="4609182">(</span><span class="ident" id="4609183">cert</span><span class="op" id="4609187">.</span><span class="ident" id="4609188">AuthorityKeyId</span><span class="op" id="4609202">)</span>&nbsp;<span class="op" id="4609204">&gt;</span>&nbsp;<span class="num" id="4609206">0</span>&nbsp;<span class="op" id="4609208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609212">candidates</span>&nbsp;<span class="op" id="4609223">=</span>&nbsp;<span class="ident" id="4609225">s</span><span class="op" id="4609226">.</span><span class="ident" id="4609227">bySubjectKeyId</span><span class="op" id="4609241">[</span><span class="builtintype" id="4609242">string</span><span class="op" id="4609248">(</span><span class="ident" id="4609249">cert</span><span class="op" id="4609253">.</span><span class="ident" id="4609254">AuthorityKeyId</span><span class="op" id="4609268">)</span><span class="op" id="4609269">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609272">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609275">if</span>&nbsp;<span class="builtinfunc" id="4609278">len</span><span class="op" id="4609281">(</span><span class="ident" id="4609282">candidates</span><span class="op" id="4609292">)</span>&nbsp;<span class="op" id="4609294">==</span>&nbsp;<span class="num" id="4609297">0</span>&nbsp;<span class="op" id="4609299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609303">candidates</span>&nbsp;<span class="op" id="4609314">=</span>&nbsp;<span class="ident" id="4609316">s</span><span class="op" id="4609317">.</span><span class="ident" id="4609318">byName</span><span class="op" id="4609324">[</span><span class="builtintype" id="4609325">string</span><span class="op" id="4609331">(</span><span class="ident" id="4609332">cert</span><span class="op" id="4609336">.</span><span class="ident" id="4609337">RawIssuer</span><span class="op" id="4609346">)</span><span class="op" id="4609347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609354">for</span>&nbsp;<span class="ident" id="4609358">_</span><span class="op" id="4609359">,</span>&nbsp;<span class="ident" id="4609361">c</span>&nbsp;<span class="op" id="4609363">:=</span>&nbsp;<span class="keyword" id="4609366">range</span>&nbsp;<span class="ident" id="4609372">candidates</span>&nbsp;<span class="op" id="4609383">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609387">if</span>&nbsp;<span class="ident" id="4609390">err</span>&nbsp;<span class="op" id="4609394">=</span>&nbsp;<span class="ident" id="4609396">cert</span><span class="op" id="4609400">.</span><span class="ident" id="4609401">CheckSignatureFrom</span><span class="op" id="4609419">(</span><span class="ident" id="4609420">s</span><span class="op" id="4609421">.</span><span class="ident" id="4609422">certs</span><span class="op" id="4609427">[</span><span class="ident" id="4609428">c</span><span class="op" id="4609429">]</span><span class="op" id="4609430">)</span><span class="op" id="4609431">;</span>&nbsp;<span class="ident" id="4609433">err</span>&nbsp;<span class="op" id="4609437">==</span>&nbsp;<span class="ident" id="4609440">nil</span>&nbsp;<span class="op" id="4609444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609449">parents</span>&nbsp;<span class="op" id="4609457">=</span>&nbsp;<span class="builtinfunc" id="4609459">append</span><span class="op" id="4609465">(</span><span class="ident" id="4609466">parents</span><span class="op" id="4609473">,</span>&nbsp;<span class="ident" id="4609475">c</span><span class="op" id="4609476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609480">}</span>&nbsp;<span class="keyword" id="4609482">else</span>&nbsp;<span class="op" id="4609487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609492">errCert</span>&nbsp;<span class="op" id="4609500">=</span>&nbsp;<span class="ident" id="4609502">s</span><span class="op" id="4609503">.</span><span class="ident" id="4609504">certs</span><span class="op" id="4609509">[</span><span class="ident" id="4609510">c</span><span class="op" id="4609511">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609515">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609522">return</span><br>
<span class="lineno"></span><span class="op" id="4609529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4609532">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4609573">func</span>&nbsp;<span class="op" id="4609578">(</span><span class="ident" id="4609579">s</span>&nbsp;<span class="op" id="4609581">*</span><span class="ident" id="4609582">CertPool</span><span class="op" id="4609590">)</span>&nbsp;<span class="ident" id="4609592">AddCert</span><span class="op" id="4609599">(</span><span class="ident" id="4609600">cert</span>&nbsp;<span class="op" id="4609605">*</span><span class="ident" id="4609606">Certificate</span><span class="op" id="4609617">)</span>&nbsp;<span class="op" id="4609619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609622">if</span>&nbsp;<span class="ident" id="4609625">cert</span>&nbsp;<span class="op" id="4609630">==</span>&nbsp;<span class="ident" id="4609633">nil</span>&nbsp;<span class="op" id="4609637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4609641">panic</span><span class="op" id="4609646">(</span><span class="string" id="4609647">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4609683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609686">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4609690">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609746">for</span>&nbsp;<span class="ident" id="4609750">_</span><span class="op" id="4609751">,</span>&nbsp;<span class="ident" id="4609753">c</span>&nbsp;<span class="op" id="4609755">:=</span>&nbsp;<span class="keyword" id="4609758">range</span>&nbsp;<span class="ident" id="4609764">s</span><span class="op" id="4609765">.</span><span class="ident" id="4609766">certs</span>&nbsp;<span class="op" id="4609772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609776">if</span>&nbsp;<span class="ident" id="4609779">c</span><span class="op" id="4609780">.</span><span class="ident" id="4609781">Equal</span><span class="op" id="4609786">(</span><span class="ident" id="4609787">cert</span><span class="op" id="4609791">)</span>&nbsp;<span class="op" id="4609793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609798">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4609810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609814">n</span>&nbsp;<span class="op" id="4609816">:=</span>&nbsp;<span class="builtinfunc" id="4609819">len</span><span class="op" id="4609822">(</span><span class="ident" id="4609823">s</span><span class="op" id="4609824">.</span><span class="ident" id="4609825">certs</span><span class="op" id="4609830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609833">s</span><span class="op" id="4609834">.</span><span class="ident" id="4609835">certs</span>&nbsp;<span class="op" id="4609841">=</span>&nbsp;<span class="builtinfunc" id="4609843">append</span><span class="op" id="4609849">(</span><span class="ident" id="4609850">s</span><span class="op" id="4609851">.</span><span class="ident" id="4609852">certs</span><span class="op" id="4609857">,</span>&nbsp;<span class="ident" id="4609859">cert</span><span class="op" id="4609863">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4609867">if</span>&nbsp;<span class="builtinfunc" id="4609870">len</span><span class="op" id="4609873">(</span><span class="ident" id="4609874">cert</span><span class="op" id="4609878">.</span><span class="ident" id="4609879">SubjectKeyId</span><span class="op" id="4609891">)</span>&nbsp;<span class="op" id="4609893">&gt;</span>&nbsp;<span class="num" id="4609895">0</span>&nbsp;<span class="op" id="4609897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609901">keyId</span>&nbsp;<span class="op" id="4609907">:=</span>&nbsp;<span class="builtintype" id="4609910">string</span><span class="op" id="4609916">(</span><span class="ident" id="4609917">cert</span><span class="op" id="4609921">.</span><span class="ident" id="4609922">SubjectKeyId</span><span class="op" id="4609934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4609938">s</span><span class="op" id="4609939">.</span><span class="ident" id="4609940">bySubjectKeyId</span><span class="op" id="4609954">[</span><span class="ident" id="4609955">keyId</span><span class="op" id="4609960">]</span>&nbsp;<span class="op" id="4609962">=</span>&nbsp;<span class="builtinfunc" id="4609964">append</span><span class="op" id="4609970">(</span><span class="ident" id="4609971">s</span><span class="op" id="4609972">.</span><span class="ident" id="4609973">bySubjectKeyId</span><span class="op" id="4609987">[</span><span class="ident" id="4609988">keyId</span><span class="op" id="4609993">]</span><span class="op" id="4609994">,</span>&nbsp;<span class="ident" id="4609996">n</span><span class="op" id="4609997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4610000">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610003">name</span>&nbsp;<span class="op" id="4610008">:=</span>&nbsp;<span class="builtintype" id="4610011">string</span><span class="op" id="4610017">(</span><span class="ident" id="4610018">cert</span><span class="op" id="4610022">.</span><span class="ident" id="4610023">RawSubject</span><span class="op" id="4610033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610036">s</span><span class="op" id="4610037">.</span><span class="ident" id="4610038">byName</span><span class="op" id="4610044">[</span><span class="ident" id="4610045">name</span><span class="op" id="4610049">]</span>&nbsp;<span class="op" id="4610051">=</span>&nbsp;<span class="builtinfunc" id="4610053">append</span><span class="op" id="4610059">(</span><span class="ident" id="4610060">s</span><span class="op" id="4610061">.</span><span class="ident" id="4610062">byName</span><span class="op" id="4610068">[</span><span class="ident" id="4610069">name</span><span class="op" id="4610073">]</span><span class="op" id="4610074">,</span>&nbsp;<span class="ident" id="4610076">n</span><span class="op" id="4610077">)</span><br>
<span class="lineno"></span><span class="op" id="4610079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4610082">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4610160">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4610239">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4610268">//</span><br>
<span class="lineno"></span><span class="comment" id="4610271">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4610348">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4610403">func</span>&nbsp;<span class="op" id="4610408">(</span><span class="ident" id="4610409">s</span>&nbsp;<span class="op" id="4610411">*</span><span class="ident" id="4610412">CertPool</span><span class="op" id="4610420">)</span>&nbsp;<span class="ident" id="4610422">AppendCertsFromPEM</span><span class="op" id="4610440">(</span><span class="ident" id="4610441">pemCerts</span>&nbsp;<span class="op" id="4610450">[</span><span class="op" id="4610451">]</span><span class="builtintype" id="4610452">byte</span><span class="op" id="4610456">)</span>&nbsp;<span class="op" id="4610458">(</span><span class="ident" id="4610459">ok</span>&nbsp;<span class="builtintype" id="4610462">bool</span><span class="op" id="4610466">)</span>&nbsp;<span class="op" id="4610468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610471">for</span>&nbsp;<span class="builtinfunc" id="4610475">len</span><span class="op" id="4610478">(</span><span class="ident" id="4610479">pemCerts</span><span class="op" id="4610487">)</span>&nbsp;<span class="op" id="4610489">&gt;</span>&nbsp;<span class="num" id="4610491">0</span>&nbsp;<span class="op" id="4610493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610497">var</span>&nbsp;<span class="ident" id="4610501">block</span>&nbsp;<span class="op" id="4610507">*</span><span class="ident" id="4610508">pem</span><span class="op" id="4610511">.</span><span class="ident" id="4610512">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610520">block</span><span class="op" id="4610525">,</span>&nbsp;<span class="ident" id="4610527">pemCerts</span>&nbsp;<span class="op" id="4610536">=</span>&nbsp;<span class="ident" id="4610538">pem</span><span class="op" id="4610541">.</span><span class="ident" id="4610542">Decode</span><span class="op" id="4610548">(</span><span class="ident" id="4610549">pemCerts</span><span class="op" id="4610557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610561">if</span>&nbsp;<span class="ident" id="4610564">block</span>&nbsp;<span class="op" id="4610570">==</span>&nbsp;<span class="ident" id="4610573">nil</span>&nbsp;<span class="op" id="4610577">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610582">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4610590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610594">if</span>&nbsp;<span class="ident" id="4610597">block</span><span class="op" id="4610602">.</span><span class="ident" id="4610603">Type</span>&nbsp;<span class="op" id="4610608">!=</span>&nbsp;<span class="string" id="4610611">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4610625">||</span>&nbsp;<span class="builtinfunc" id="4610628">len</span><span class="op" id="4610631">(</span><span class="ident" id="4610632">block</span><span class="op" id="4610637">.</span><span class="ident" id="4610638">Headers</span><span class="op" id="4610645">)</span>&nbsp;<span class="op" id="4610647">!=</span>&nbsp;<span class="num" id="4610650">0</span>&nbsp;<span class="op" id="4610652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610657">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4610668">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610673">cert</span><span class="op" id="4610677">,</span>&nbsp;<span class="ident" id="4610679">err</span>&nbsp;<span class="op" id="4610683">:=</span>&nbsp;<span class="ident" id="4610686">ParseCertificate</span><span class="op" id="4610702">(</span><span class="ident" id="4610703">block</span><span class="op" id="4610708">.</span><span class="ident" id="4610709">Bytes</span><span class="op" id="4610714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610718">if</span>&nbsp;<span class="ident" id="4610721">err</span>&nbsp;<span class="op" id="4610725">!=</span>&nbsp;<span class="ident" id="4610728">nil</span>&nbsp;<span class="op" id="4610732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610737">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4610748">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610753">s</span><span class="op" id="4610754">.</span><span class="ident" id="4610755">AddCert</span><span class="op" id="4610762">(</span><span class="ident" id="4610763">cert</span><span class="op" id="4610767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610771">ok</span>&nbsp;<span class="op" id="4610774">=</span>&nbsp;<span class="builtintype" id="4610776">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4610782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610786">return</span><br>
<span class="lineno"></span><span class="op" id="4610793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4610796">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4610854">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4610894">func</span>&nbsp;<span class="op" id="4610899">(</span><span class="ident" id="4610900">s</span>&nbsp;<span class="op" id="4610902">*</span><span class="ident" id="4610903">CertPool</span><span class="op" id="4610911">)</span>&nbsp;<span class="ident" id="4610913">Subjects</span><span class="op" id="4610921">(</span><span class="op" id="4610922">)</span>&nbsp;<span class="op" id="4610924">(</span><span class="ident" id="4610925">res</span>&nbsp;<span class="op" id="4610929">[</span><span class="op" id="4610930">]</span><span class="op" id="4610931">[</span><span class="op" id="4610932">]</span><span class="builtintype" id="4610933">byte</span><span class="op" id="4610937">)</span>&nbsp;<span class="op" id="4610939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610942">res</span>&nbsp;<span class="op" id="4610946">=</span>&nbsp;<span class="builtinfunc" id="4610948">make</span><span class="op" id="4610952">(</span><span class="op" id="4610953">[</span><span class="op" id="4610954">]</span><span class="op" id="4610955">[</span><span class="op" id="4610956">]</span><span class="builtintype" id="4610957">byte</span><span class="op" id="4610961">,</span>&nbsp;<span class="builtinfunc" id="4610963">len</span><span class="op" id="4610966">(</span><span class="ident" id="4610967">s</span><span class="op" id="4610968">.</span><span class="ident" id="4610969">certs</span><span class="op" id="4610974">)</span><span class="op" id="4610975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4610978">for</span>&nbsp;<span class="ident" id="4610982">i</span><span class="op" id="4610983">,</span>&nbsp;<span class="ident" id="4610985">c</span>&nbsp;<span class="op" id="4610987">:=</span>&nbsp;<span class="keyword" id="4610990">range</span>&nbsp;<span class="ident" id="4610996">s</span><span class="op" id="4610997">.</span><span class="ident" id="4610998">certs</span>&nbsp;<span class="op" id="4611004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611008">res</span><span class="op" id="4611011">[</span><span class="ident" id="4611012">i</span><span class="op" id="4611013">]</span>&nbsp;<span class="op" id="4611015">=</span>&nbsp;<span class="ident" id="4611017">c</span><span class="op" id="4611018">.</span><span class="ident" id="4611019">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611031">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611034">return</span><br>
<span class="lineno"></span><span class="op" id="4611041">}</span>
</div>
</body>
</html>
