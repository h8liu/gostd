<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1329532">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1329587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1329641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1329692">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="1329767">package</span>&nbsp;<span class="ident" id="1329775">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329781">import</span>&nbsp;<span class="op" id="1329788">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329791">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329801">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="1329808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329811">func</span>&nbsp;<span class="ident" id="1329816">init</span><span class="op" id="1329820">(</span><span class="op" id="1329821">)</span>&nbsp;<span class="op" id="1329823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1329826">crypto</span><span class="op" id="1329832">.</span><span class="ident" id="1329833">RegisterHash</span><span class="op" id="1329845">(</span><span class="ident" id="1329846">crypto</span><span class="op" id="1329852">.</span><span class="ident" id="1329853">SHA1</span><span class="op" id="1329857">,</span>&nbsp;<span class="ident" id="1329859">New</span><span class="op" id="1329862">)</span><br>
<span class="lineno">15</span><span class="op" id="1329864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1329867">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1329908">const</span>&nbsp;<span class="ident" id="1329914">Size</span>&nbsp;<span class="op" id="1329919">=</span>&nbsp;<span class="num" id="1329921">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="1329925">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="1329960">const</span>&nbsp;<span class="ident" id="1329966">BlockSize</span>&nbsp;<span class="op" id="1329976">=</span>&nbsp;<span class="num" id="1329978">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329982">const</span>&nbsp;<span class="op" id="1329988">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1329991">chunk</span>&nbsp;<span class="op" id="1329997">=</span>&nbsp;<span class="num" id="1329999">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330003">init0</span>&nbsp;<span class="op" id="1330009">=</span>&nbsp;<span class="num" id="1330011">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330023">init1</span>&nbsp;<span class="op" id="1330029">=</span>&nbsp;<span class="num" id="1330031">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330043">init2</span>&nbsp;<span class="op" id="1330049">=</span>&nbsp;<span class="num" id="1330051">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330063">init3</span>&nbsp;<span class="op" id="1330069">=</span>&nbsp;<span class="num" id="1330071">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330083">init4</span>&nbsp;<span class="op" id="1330089">=</span>&nbsp;<span class="num" id="1330091">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="1330102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1330105">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="1330164">type</span>&nbsp;<span class="ident" id="1330169">digest</span>&nbsp;<span class="keyword" id="1330176">struct</span>&nbsp;<span class="op" id="1330183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330186">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1330190">[</span><span class="num" id="1330191">5</span><span class="op" id="1330192">]</span><span class="builtintype" id="1330193">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330201">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1330205">[</span><span class="ident" id="1330206">chunk</span><span class="op" id="1330211">]</span><span class="builtintype" id="1330212">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330218">nx</span>&nbsp;&nbsp;<span class="builtintype" id="1330222">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1330227">len</span>&nbsp;<span class="ident" id="1330231">uint64</span><br>
<span class="lineno"></span><span class="op" id="1330238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="1330241">func</span>&nbsp;<span class="op" id="1330246">(</span><span class="ident" id="1330247">d</span>&nbsp;<span class="op" id="1330249">*</span><span class="ident" id="1330250">digest</span><span class="op" id="1330256">)</span>&nbsp;<span class="ident" id="1330258">Reset</span><span class="op" id="1330263">(</span><span class="op" id="1330264">)</span>&nbsp;<span class="op" id="1330266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330269">d</span><span class="op" id="1330270">.</span><span class="ident" id="1330271">h</span><span class="op" id="1330272">[</span><span class="num" id="1330273">0</span><span class="op" id="1330274">]</span>&nbsp;<span class="op" id="1330276">=</span>&nbsp;<span class="ident" id="1330278">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330285">d</span><span class="op" id="1330286">.</span><span class="ident" id="1330287">h</span><span class="op" id="1330288">[</span><span class="num" id="1330289">1</span><span class="op" id="1330290">]</span>&nbsp;<span class="op" id="1330292">=</span>&nbsp;<span class="ident" id="1330294">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330301">d</span><span class="op" id="1330302">.</span><span class="ident" id="1330303">h</span><span class="op" id="1330304">[</span><span class="num" id="1330305">2</span><span class="op" id="1330306">]</span>&nbsp;<span class="op" id="1330308">=</span>&nbsp;<span class="ident" id="1330310">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330317">d</span><span class="op" id="1330318">.</span><span class="ident" id="1330319">h</span><span class="op" id="1330320">[</span><span class="num" id="1330321">3</span><span class="op" id="1330322">]</span>&nbsp;<span class="op" id="1330324">=</span>&nbsp;<span class="ident" id="1330326">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330333">d</span><span class="op" id="1330334">.</span><span class="ident" id="1330335">h</span><span class="op" id="1330336">[</span><span class="num" id="1330337">4</span><span class="op" id="1330338">]</span>&nbsp;<span class="op" id="1330340">=</span>&nbsp;<span class="ident" id="1330342">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330349">d</span><span class="op" id="1330350">.</span><span class="ident" id="1330351">nx</span>&nbsp;<span class="op" id="1330354">=</span>&nbsp;<span class="num" id="1330356">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330359">d</span><span class="op" id="1330360">.</span><span class="builtinfunc" id="1330361">len</span>&nbsp;<span class="op" id="1330365">=</span>&nbsp;<span class="num" id="1330367">0</span><br>
<span class="lineno"></span><span class="op" id="1330369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="1330372">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="1330432">func</span>&nbsp;<span class="ident" id="1330437">New</span><span class="op" id="1330440">(</span><span class="op" id="1330441">)</span>&nbsp;<span class="ident" id="1330443">hash</span><span class="op" id="1330447">.</span><span class="ident" id="1330448">Hash</span>&nbsp;<span class="op" id="1330453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330456">d</span>&nbsp;<span class="op" id="1330458">:=</span>&nbsp;<span class="builtinfunc" id="1330461">new</span><span class="op" id="1330464">(</span><span class="ident" id="1330465">digest</span><span class="op" id="1330471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330474">d</span><span class="op" id="1330475">.</span><span class="ident" id="1330476">Reset</span><span class="op" id="1330481">(</span><span class="op" id="1330482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330485">return</span>&nbsp;<span class="ident" id="1330492">d</span><br>
<span class="lineno">55</span><span class="op" id="1330494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330497">func</span>&nbsp;<span class="op" id="1330502">(</span><span class="ident" id="1330503">d</span>&nbsp;<span class="op" id="1330505">*</span><span class="ident" id="1330506">digest</span><span class="op" id="1330512">)</span>&nbsp;<span class="ident" id="1330514">Size</span><span class="op" id="1330518">(</span><span class="op" id="1330519">)</span>&nbsp;<span class="builtintype" id="1330521">int</span>&nbsp;<span class="op" id="1330525">{</span>&nbsp;<span class="keyword" id="1330527">return</span>&nbsp;<span class="ident" id="1330534">Size</span>&nbsp;<span class="op" id="1330539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330542">func</span>&nbsp;<span class="op" id="1330547">(</span><span class="ident" id="1330548">d</span>&nbsp;<span class="op" id="1330550">*</span><span class="ident" id="1330551">digest</span><span class="op" id="1330557">)</span>&nbsp;<span class="ident" id="1330559">BlockSize</span><span class="op" id="1330568">(</span><span class="op" id="1330569">)</span>&nbsp;<span class="builtintype" id="1330571">int</span>&nbsp;<span class="op" id="1330575">{</span>&nbsp;<span class="keyword" id="1330577">return</span>&nbsp;<span class="ident" id="1330584">BlockSize</span>&nbsp;<span class="op" id="1330594">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="1330597">func</span>&nbsp;<span class="op" id="1330602">(</span><span class="ident" id="1330603">d</span>&nbsp;<span class="op" id="1330605">*</span><span class="ident" id="1330606">digest</span><span class="op" id="1330612">)</span>&nbsp;<span class="ident" id="1330614">Write</span><span class="op" id="1330619">(</span><span class="ident" id="1330620">p</span>&nbsp;<span class="op" id="1330622">[</span><span class="op" id="1330623">]</span><span class="builtintype" id="1330624">byte</span><span class="op" id="1330628">)</span>&nbsp;<span class="op" id="1330630">(</span><span class="ident" id="1330631">nn</span>&nbsp;<span class="builtintype" id="1330634">int</span><span class="op" id="1330637">,</span>&nbsp;<span class="ident" id="1330639">err</span>&nbsp;<span class="builtintype" id="1330643">error</span><span class="op" id="1330648">)</span>&nbsp;<span class="op" id="1330650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330653">nn</span>&nbsp;<span class="op" id="1330656">=</span>&nbsp;<span class="builtinfunc" id="1330658">len</span><span class="op" id="1330661">(</span><span class="ident" id="1330662">p</span><span class="op" id="1330663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330666">d</span><span class="op" id="1330667">.</span><span class="builtinfunc" id="1330668">len</span>&nbsp;<span class="op" id="1330672">+=</span>&nbsp;<span class="ident" id="1330675">uint64</span><span class="op" id="1330681">(</span><span class="ident" id="1330682">nn</span><span class="op" id="1330684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330687">if</span>&nbsp;<span class="ident" id="1330690">d</span><span class="op" id="1330691">.</span><span class="ident" id="1330692">nx</span>&nbsp;<span class="op" id="1330695">&gt;</span>&nbsp;<span class="num" id="1330697">0</span>&nbsp;<span class="op" id="1330699">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330703">n</span>&nbsp;<span class="op" id="1330705">:=</span>&nbsp;<span class="builtinfunc" id="1330708">copy</span><span class="op" id="1330712">(</span><span class="ident" id="1330713">d</span><span class="op" id="1330714">.</span><span class="ident" id="1330715">x</span><span class="op" id="1330716">[</span><span class="ident" id="1330717">d</span><span class="op" id="1330718">.</span><span class="ident" id="1330719">nx</span><span class="op" id="1330721">:</span><span class="op" id="1330722">]</span><span class="op" id="1330723">,</span>&nbsp;<span class="ident" id="1330725">p</span><span class="op" id="1330726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330730">d</span><span class="op" id="1330731">.</span><span class="ident" id="1330732">nx</span>&nbsp;<span class="op" id="1330735">+=</span>&nbsp;<span class="ident" id="1330738">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330742">if</span>&nbsp;<span class="ident" id="1330745">d</span><span class="op" id="1330746">.</span><span class="ident" id="1330747">nx</span>&nbsp;<span class="op" id="1330750">==</span>&nbsp;<span class="ident" id="1330753">chunk</span>&nbsp;<span class="op" id="1330759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330764">block</span><span class="op" id="1330769">(</span><span class="ident" id="1330770">d</span><span class="op" id="1330771">,</span>&nbsp;<span class="ident" id="1330773">d</span><span class="op" id="1330774">.</span><span class="ident" id="1330775">x</span><span class="op" id="1330776">[</span><span class="op" id="1330777">:</span><span class="op" id="1330778">]</span><span class="op" id="1330779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330784">d</span><span class="op" id="1330785">.</span><span class="ident" id="1330786">nx</span>&nbsp;<span class="op" id="1330789">=</span>&nbsp;<span class="num" id="1330791">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1330795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330799">p</span>&nbsp;<span class="op" id="1330801">=</span>&nbsp;<span class="ident" id="1330803">p</span><span class="op" id="1330804">[</span><span class="ident" id="1330805">n</span><span class="op" id="1330806">:</span><span class="op" id="1330807">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1330810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330813">if</span>&nbsp;<span class="builtinfunc" id="1330816">len</span><span class="op" id="1330819">(</span><span class="ident" id="1330820">p</span><span class="op" id="1330821">)</span>&nbsp;<span class="op" id="1330823">&gt;=</span>&nbsp;<span class="ident" id="1330826">chunk</span>&nbsp;<span class="op" id="1330832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330836">n</span>&nbsp;<span class="op" id="1330838">:=</span>&nbsp;<span class="builtinfunc" id="1330841">len</span><span class="op" id="1330844">(</span><span class="ident" id="1330845">p</span><span class="op" id="1330846">)</span>&nbsp;<span class="op" id="1330848">&amp;^</span>&nbsp;<span class="op" id="1330851">(</span><span class="ident" id="1330852">chunk</span>&nbsp;<span class="op" id="1330858">-</span>&nbsp;<span class="num" id="1330860">1</span><span class="op" id="1330861">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330865">block</span><span class="op" id="1330870">(</span><span class="ident" id="1330871">d</span><span class="op" id="1330872">,</span>&nbsp;<span class="ident" id="1330874">p</span><span class="op" id="1330875">[</span><span class="op" id="1330876">:</span><span class="ident" id="1330877">n</span><span class="op" id="1330878">]</span><span class="op" id="1330879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330883">p</span>&nbsp;<span class="op" id="1330885">=</span>&nbsp;<span class="ident" id="1330887">p</span><span class="op" id="1330888">[</span><span class="ident" id="1330889">n</span><span class="op" id="1330890">:</span><span class="op" id="1330891">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1330894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330897">if</span>&nbsp;<span class="builtinfunc" id="1330900">len</span><span class="op" id="1330903">(</span><span class="ident" id="1330904">p</span><span class="op" id="1330905">)</span>&nbsp;<span class="op" id="1330907">&gt;</span>&nbsp;<span class="num" id="1330909">0</span>&nbsp;<span class="op" id="1330911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330915">d</span><span class="op" id="1330916">.</span><span class="ident" id="1330917">nx</span>&nbsp;<span class="op" id="1330920">=</span>&nbsp;<span class="builtinfunc" id="1330922">copy</span><span class="op" id="1330926">(</span><span class="ident" id="1330927">d</span><span class="op" id="1330928">.</span><span class="ident" id="1330929">x</span><span class="op" id="1330930">[</span><span class="op" id="1330931">:</span><span class="op" id="1330932">]</span><span class="op" id="1330933">,</span>&nbsp;<span class="ident" id="1330935">p</span><span class="op" id="1330936">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1330939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1330942">return</span><br>
<span class="lineno"></span><span class="op" id="1330949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1330952">func</span>&nbsp;<span class="op" id="1330957">(</span><span class="ident" id="1330958">d0</span>&nbsp;<span class="op" id="1330961">*</span><span class="ident" id="1330962">digest</span><span class="op" id="1330968">)</span>&nbsp;<span class="ident" id="1330970">Sum</span><span class="op" id="1330973">(</span><span class="ident" id="1330974">in</span>&nbsp;<span class="op" id="1330977">[</span><span class="op" id="1330978">]</span><span class="builtintype" id="1330979">byte</span><span class="op" id="1330983">)</span>&nbsp;<span class="op" id="1330985">[</span><span class="op" id="1330986">]</span><span class="builtintype" id="1330987">byte</span>&nbsp;<span class="op" id="1330992">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330995">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331062">d</span>&nbsp;<span class="op" id="1331064">:=</span>&nbsp;<span class="op" id="1331067">*</span><span class="ident" id="1331068">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331072">hash</span>&nbsp;<span class="op" id="1331077">:=</span>&nbsp;<span class="ident" id="1331080">d</span><span class="op" id="1331081">.</span><span class="ident" id="1331082">checkSum</span><span class="op" id="1331090">(</span><span class="op" id="1331091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331094">return</span>&nbsp;<span class="builtinfunc" id="1331101">append</span><span class="op" id="1331107">(</span><span class="ident" id="1331108">in</span><span class="op" id="1331110">,</span>&nbsp;<span class="ident" id="1331112">hash</span><span class="op" id="1331116">[</span><span class="op" id="1331117">:</span><span class="op" id="1331118">]</span><span class="op" id="1331119">...</span><span class="op" id="1331122">)</span><br>
<span class="lineno"></span><span class="op" id="1331124">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="1331127">func</span>&nbsp;<span class="op" id="1331132">(</span><span class="ident" id="1331133">d</span>&nbsp;<span class="op" id="1331135">*</span><span class="ident" id="1331136">digest</span><span class="op" id="1331142">)</span>&nbsp;<span class="ident" id="1331144">checkSum</span><span class="op" id="1331152">(</span><span class="op" id="1331153">)</span>&nbsp;<span class="op" id="1331155">[</span><span class="ident" id="1331156">Size</span><span class="op" id="1331160">]</span><span class="builtintype" id="1331161">byte</span>&nbsp;<span class="op" id="1331166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1331169">len</span>&nbsp;<span class="op" id="1331173">:=</span>&nbsp;<span class="ident" id="1331176">d</span><span class="op" id="1331177">.</span><span class="builtinfunc" id="1331178">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331183">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331243">var</span>&nbsp;<span class="ident" id="1331247">tmp</span>&nbsp;<span class="op" id="1331251">[</span><span class="num" id="1331252">64</span><span class="op" id="1331254">]</span><span class="builtintype" id="1331255">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331261">tmp</span><span class="op" id="1331264">[</span><span class="num" id="1331265">0</span><span class="op" id="1331266">]</span>&nbsp;<span class="op" id="1331268">=</span>&nbsp;<span class="num" id="1331270">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331276">if</span>&nbsp;<span class="builtinfunc" id="1331279">len</span><span class="op" id="1331282">%</span><span class="num" id="1331283">64</span>&nbsp;<span class="op" id="1331286">&lt;</span>&nbsp;<span class="num" id="1331288">56</span>&nbsp;<span class="op" id="1331291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331295">d</span><span class="op" id="1331296">.</span><span class="ident" id="1331297">Write</span><span class="op" id="1331302">(</span><span class="ident" id="1331303">tmp</span><span class="op" id="1331306">[</span><span class="num" id="1331307">0</span>&nbsp;<span class="op" id="1331309">:</span>&nbsp;<span class="num" id="1331311">56</span><span class="op" id="1331313">-</span><span class="builtinfunc" id="1331314">len</span><span class="op" id="1331317">%</span><span class="num" id="1331318">64</span><span class="op" id="1331320">]</span><span class="op" id="1331321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331324">}</span>&nbsp;<span class="keyword" id="1331326">else</span>&nbsp;<span class="op" id="1331331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331335">d</span><span class="op" id="1331336">.</span><span class="ident" id="1331337">Write</span><span class="op" id="1331342">(</span><span class="ident" id="1331343">tmp</span><span class="op" id="1331346">[</span><span class="num" id="1331347">0</span>&nbsp;<span class="op" id="1331349">:</span>&nbsp;<span class="num" id="1331351">64</span><span class="op" id="1331353">+</span><span class="num" id="1331354">56</span><span class="op" id="1331356">-</span><span class="builtinfunc" id="1331357">len</span><span class="op" id="1331360">%</span><span class="num" id="1331361">64</span><span class="op" id="1331363">]</span><span class="op" id="1331364">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331371">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1331391">len</span>&nbsp;<span class="op" id="1331395">&lt;&lt;=</span>&nbsp;<span class="num" id="1331399">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331402">for</span>&nbsp;<span class="ident" id="1331406">i</span>&nbsp;<span class="op" id="1331408">:=</span>&nbsp;<span class="builtintype" id="1331411">uint</span><span class="op" id="1331415">(</span><span class="num" id="1331416">0</span><span class="op" id="1331417">)</span><span class="op" id="1331418">;</span>&nbsp;<span class="ident" id="1331420">i</span>&nbsp;<span class="op" id="1331422">&lt;</span>&nbsp;<span class="num" id="1331424">8</span><span class="op" id="1331425">;</span>&nbsp;<span class="ident" id="1331427">i</span><span class="op" id="1331428">++</span>&nbsp;<span class="op" id="1331431">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331435">tmp</span><span class="op" id="1331438">[</span><span class="ident" id="1331439">i</span><span class="op" id="1331440">]</span>&nbsp;<span class="op" id="1331442">=</span>&nbsp;<span class="builtintype" id="1331444">byte</span><span class="op" id="1331448">(</span><span class="builtinfunc" id="1331449">len</span>&nbsp;<span class="op" id="1331453">&gt;&gt;</span>&nbsp;<span class="op" id="1331456">(</span><span class="num" id="1331457">56</span>&nbsp;<span class="op" id="1331460">-</span>&nbsp;<span class="num" id="1331462">8</span><span class="op" id="1331463">*</span><span class="ident" id="1331464">i</span><span class="op" id="1331465">)</span><span class="op" id="1331466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331472">d</span><span class="op" id="1331473">.</span><span class="ident" id="1331474">Write</span><span class="op" id="1331479">(</span><span class="ident" id="1331480">tmp</span><span class="op" id="1331483">[</span><span class="num" id="1331484">0</span><span class="op" id="1331485">:</span><span class="num" id="1331486">8</span><span class="op" id="1331487">]</span><span class="op" id="1331488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331492">if</span>&nbsp;<span class="ident" id="1331495">d</span><span class="op" id="1331496">.</span><span class="ident" id="1331497">nx</span>&nbsp;<span class="op" id="1331500">!=</span>&nbsp;<span class="num" id="1331503">0</span>&nbsp;<span class="op" id="1331505">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1331509">panic</span><span class="op" id="1331514">(</span><span class="string" id="1331515">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="1331526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331533">var</span>&nbsp;<span class="ident" id="1331537">digest</span>&nbsp;<span class="op" id="1331544">[</span><span class="ident" id="1331545">Size</span><span class="op" id="1331549">]</span><span class="builtintype" id="1331550">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331556">for</span>&nbsp;<span class="ident" id="1331560">i</span><span class="op" id="1331561">,</span>&nbsp;<span class="ident" id="1331563">s</span>&nbsp;<span class="op" id="1331565">:=</span>&nbsp;<span class="keyword" id="1331568">range</span>&nbsp;<span class="ident" id="1331574">d</span><span class="op" id="1331575">.</span><span class="ident" id="1331576">h</span>&nbsp;<span class="op" id="1331578">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331582">digest</span><span class="op" id="1331588">[</span><span class="ident" id="1331589">i</span><span class="op" id="1331590">*</span><span class="num" id="1331591">4</span><span class="op" id="1331592">]</span>&nbsp;<span class="op" id="1331594">=</span>&nbsp;<span class="builtintype" id="1331596">byte</span><span class="op" id="1331600">(</span><span class="ident" id="1331601">s</span>&nbsp;<span class="op" id="1331603">&gt;&gt;</span>&nbsp;<span class="num" id="1331606">24</span><span class="op" id="1331608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331612">digest</span><span class="op" id="1331618">[</span><span class="ident" id="1331619">i</span><span class="op" id="1331620">*</span><span class="num" id="1331621">4</span><span class="op" id="1331622">+</span><span class="num" id="1331623">1</span><span class="op" id="1331624">]</span>&nbsp;<span class="op" id="1331626">=</span>&nbsp;<span class="builtintype" id="1331628">byte</span><span class="op" id="1331632">(</span><span class="ident" id="1331633">s</span>&nbsp;<span class="op" id="1331635">&gt;&gt;</span>&nbsp;<span class="num" id="1331638">16</span><span class="op" id="1331640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331644">digest</span><span class="op" id="1331650">[</span><span class="ident" id="1331651">i</span><span class="op" id="1331652">*</span><span class="num" id="1331653">4</span><span class="op" id="1331654">+</span><span class="num" id="1331655">2</span><span class="op" id="1331656">]</span>&nbsp;<span class="op" id="1331658">=</span>&nbsp;<span class="builtintype" id="1331660">byte</span><span class="op" id="1331664">(</span><span class="ident" id="1331665">s</span>&nbsp;<span class="op" id="1331667">&gt;&gt;</span>&nbsp;<span class="num" id="1331670">8</span><span class="op" id="1331671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331675">digest</span><span class="op" id="1331681">[</span><span class="ident" id="1331682">i</span><span class="op" id="1331683">*</span><span class="num" id="1331684">4</span><span class="op" id="1331685">+</span><span class="num" id="1331686">3</span><span class="op" id="1331687">]</span>&nbsp;<span class="op" id="1331689">=</span>&nbsp;<span class="builtintype" id="1331691">byte</span><span class="op" id="1331695">(</span><span class="ident" id="1331696">s</span><span class="op" id="1331697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1331700">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331704">return</span>&nbsp;<span class="ident" id="1331711">digest</span><br>
<span class="lineno"></span><span class="op" id="1331718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1331721">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="1331767">func</span>&nbsp;<span class="ident" id="1331772">Sum</span><span class="op" id="1331775">(</span><span class="ident" id="1331776">data</span>&nbsp;<span class="op" id="1331781">[</span><span class="op" id="1331782">]</span><span class="builtintype" id="1331783">byte</span><span class="op" id="1331787">)</span>&nbsp;<span class="op" id="1331789">[</span><span class="ident" id="1331790">Size</span><span class="op" id="1331794">]</span><span class="builtintype" id="1331795">byte</span>&nbsp;<span class="op" id="1331800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331803">var</span>&nbsp;<span class="ident" id="1331807">d</span>&nbsp;<span class="ident" id="1331809">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331817">d</span><span class="op" id="1331818">.</span><span class="ident" id="1331819">Reset</span><span class="op" id="1331824">(</span><span class="op" id="1331825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331828">d</span><span class="op" id="1331829">.</span><span class="ident" id="1331830">Write</span><span class="op" id="1331835">(</span><span class="ident" id="1331836">data</span><span class="op" id="1331840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1331843">return</span>&nbsp;<span class="ident" id="1331850">d</span><span class="op" id="1331851">.</span><span class="ident" id="1331852">checkSum</span><span class="op" id="1331860">(</span><span class="op" id="1331861">)</span><br>
<span class="lineno">130</span><span class="op" id="1331863">}</span>
</div>
</body>
</html>
