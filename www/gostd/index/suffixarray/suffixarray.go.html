<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6205562">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6205617">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6205671">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6205722">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="6205799">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="6205829">//</span><br>
<span class="lineno"></span><span class="comment" id="6205832">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="6205848">//</span><br>
<span class="lineno">10</span><span class="comment" id="6205851">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6205884">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="6205918">//</span><br>
<span class="lineno"></span><span class="comment" id="6205921">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="6205947">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="6206032">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6206123">//</span><br>
<span class="lineno"></span><span class="keyword" id="6206126">package</span>&nbsp;<span class="ident" id="6206134">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6206147">import</span>&nbsp;<span class="op" id="6206154">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6206157">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6206166">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6206185">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6206191">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6206201">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6206208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206211">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="6206273">type</span>&nbsp;<span class="ident" id="6206278">Index</span>&nbsp;<span class="keyword" id="6206284">struct</span>&nbsp;<span class="op" id="6206291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206294">data</span>&nbsp;<span class="op" id="6206299">[</span><span class="op" id="6206300">]</span><span class="builtintype" id="6206301">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206307">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6206312">[</span><span class="op" id="6206313">]</span><span class="builtintype" id="6206314">int</span>&nbsp;<span class="comment" id="6206318">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="6206365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206368">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6206405">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="6206462">func</span>&nbsp;<span class="ident" id="6206467">New</span><span class="op" id="6206470">(</span><span class="ident" id="6206471">data</span>&nbsp;<span class="op" id="6206476">[</span><span class="op" id="6206477">]</span><span class="builtintype" id="6206478">byte</span><span class="op" id="6206482">)</span>&nbsp;<span class="op" id="6206484">*</span><span class="ident" id="6206485">Index</span>&nbsp;<span class="op" id="6206491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206494">return</span>&nbsp;<span class="op" id="6206501">&amp;</span><span class="ident" id="6206502">Index</span><span class="op" id="6206507">{</span><span class="ident" id="6206508">data</span><span class="op" id="6206512">,</span>&nbsp;<span class="ident" id="6206514">qsufsort</span><span class="op" id="6206522">(</span><span class="ident" id="6206523">data</span><span class="op" id="6206527">)</span><span class="op" id="6206528">}</span><br>
<span class="lineno"></span><span class="op" id="6206530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6206533">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="6206597">func</span>&nbsp;<span class="ident" id="6206602">writeInt</span><span class="op" id="6206610">(</span><span class="ident" id="6206611">w</span>&nbsp;<span class="ident" id="6206613">io</span><span class="op" id="6206615">.</span><span class="ident" id="6206616">Writer</span><span class="op" id="6206622">,</span>&nbsp;<span class="ident" id="6206624">buf</span>&nbsp;<span class="op" id="6206628">[</span><span class="op" id="6206629">]</span><span class="builtintype" id="6206630">byte</span><span class="op" id="6206634">,</span>&nbsp;<span class="ident" id="6206636">x</span>&nbsp;<span class="builtintype" id="6206638">int</span><span class="op" id="6206641">)</span>&nbsp;<span class="builtintype" id="6206643">error</span>&nbsp;<span class="op" id="6206649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206652">binary</span><span class="op" id="6206658">.</span><span class="ident" id="6206659">PutVarint</span><span class="op" id="6206668">(</span><span class="ident" id="6206669">buf</span><span class="op" id="6206672">,</span>&nbsp;<span class="ident" id="6206674">int64</span><span class="op" id="6206679">(</span><span class="ident" id="6206680">x</span><span class="op" id="6206681">)</span><span class="op" id="6206682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206685">_</span><span class="op" id="6206686">,</span>&nbsp;<span class="ident" id="6206688">err</span>&nbsp;<span class="op" id="6206692">:=</span>&nbsp;<span class="ident" id="6206695">w</span><span class="op" id="6206696">.</span><span class="ident" id="6206697">Write</span><span class="op" id="6206702">(</span><span class="ident" id="6206703">buf</span><span class="op" id="6206706">[</span><span class="num" id="6206707">0</span><span class="op" id="6206708">:</span><span class="ident" id="6206709">binary</span><span class="op" id="6206715">.</span><span class="ident" id="6206716">MaxVarintLen64</span><span class="op" id="6206730">]</span><span class="op" id="6206731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206734">return</span>&nbsp;<span class="ident" id="6206741">err</span><br>
<span class="lineno"></span><span class="op" id="6206745">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6206748">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="6206825">func</span>&nbsp;<span class="ident" id="6206830">readInt</span><span class="op" id="6206837">(</span><span class="ident" id="6206838">r</span>&nbsp;<span class="ident" id="6206840">io</span><span class="op" id="6206842">.</span><span class="ident" id="6206843">Reader</span><span class="op" id="6206849">,</span>&nbsp;<span class="ident" id="6206851">buf</span>&nbsp;<span class="op" id="6206855">[</span><span class="op" id="6206856">]</span><span class="builtintype" id="6206857">byte</span><span class="op" id="6206861">)</span>&nbsp;<span class="op" id="6206863">(</span><span class="builtintype" id="6206864">int</span><span class="op" id="6206867">,</span>&nbsp;<span class="builtintype" id="6206869">error</span><span class="op" id="6206874">)</span>&nbsp;<span class="op" id="6206876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206879">_</span><span class="op" id="6206880">,</span>&nbsp;<span class="ident" id="6206882">err</span>&nbsp;<span class="op" id="6206886">:=</span>&nbsp;<span class="ident" id="6206889">io</span><span class="op" id="6206891">.</span><span class="ident" id="6206892">ReadFull</span><span class="op" id="6206900">(</span><span class="ident" id="6206901">r</span><span class="op" id="6206902">,</span>&nbsp;<span class="ident" id="6206904">buf</span><span class="op" id="6206907">[</span><span class="num" id="6206908">0</span><span class="op" id="6206909">:</span><span class="ident" id="6206910">binary</span><span class="op" id="6206916">.</span><span class="ident" id="6206917">MaxVarintLen64</span><span class="op" id="6206931">]</span><span class="op" id="6206932">)</span>&nbsp;<span class="comment" id="6206934">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6206964">x</span><span class="op" id="6206965">,</span>&nbsp;<span class="ident" id="6206967">_</span>&nbsp;<span class="op" id="6206969">:=</span>&nbsp;<span class="ident" id="6206972">binary</span><span class="op" id="6206978">.</span><span class="ident" id="6206979">Varint</span><span class="op" id="6206985">(</span><span class="ident" id="6206986">buf</span><span class="op" id="6206989">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6206992">return</span>&nbsp;<span class="builtintype" id="6206999">int</span><span class="op" id="6207002">(</span><span class="ident" id="6207003">x</span><span class="op" id="6207004">)</span><span class="op" id="6207005">,</span>&nbsp;<span class="ident" id="6207007">err</span><br>
<span class="lineno"></span><span class="op" id="6207011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6207014">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6207064">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="6207100">func</span>&nbsp;<span class="ident" id="6207105">writeSlice</span><span class="op" id="6207115">(</span><span class="ident" id="6207116">w</span>&nbsp;<span class="ident" id="6207118">io</span><span class="op" id="6207120">.</span><span class="ident" id="6207121">Writer</span><span class="op" id="6207127">,</span>&nbsp;<span class="ident" id="6207129">buf</span>&nbsp;<span class="op" id="6207133">[</span><span class="op" id="6207134">]</span><span class="builtintype" id="6207135">byte</span><span class="op" id="6207139">,</span>&nbsp;<span class="ident" id="6207141">data</span>&nbsp;<span class="op" id="6207146">[</span><span class="op" id="6207147">]</span><span class="builtintype" id="6207148">int</span><span class="op" id="6207151">)</span>&nbsp;<span class="op" id="6207153">(</span><span class="ident" id="6207154">n</span>&nbsp;<span class="builtintype" id="6207156">int</span><span class="op" id="6207159">,</span>&nbsp;<span class="ident" id="6207161">err</span>&nbsp;<span class="builtintype" id="6207165">error</span><span class="op" id="6207170">)</span>&nbsp;<span class="op" id="6207172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207175">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207219">p</span>&nbsp;<span class="op" id="6207221">:=</span>&nbsp;<span class="ident" id="6207224">binary</span><span class="op" id="6207230">.</span><span class="ident" id="6207231">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207247">for</span>&nbsp;<span class="op" id="6207251">;</span>&nbsp;<span class="ident" id="6207253">n</span>&nbsp;<span class="op" id="6207255">&lt;</span>&nbsp;<span class="builtinfunc" id="6207257">len</span><span class="op" id="6207260">(</span><span class="ident" id="6207261">data</span><span class="op" id="6207265">)</span>&nbsp;<span class="op" id="6207267">&amp;&amp;</span>&nbsp;<span class="ident" id="6207270">p</span><span class="op" id="6207271">+</span><span class="ident" id="6207272">binary</span><span class="op" id="6207278">.</span><span class="ident" id="6207279">MaxVarintLen64</span>&nbsp;<span class="op" id="6207294">&lt;=</span>&nbsp;<span class="builtinfunc" id="6207297">len</span><span class="op" id="6207300">(</span><span class="ident" id="6207301">buf</span><span class="op" id="6207304">)</span><span class="op" id="6207305">;</span>&nbsp;<span class="ident" id="6207307">n</span><span class="op" id="6207308">++</span>&nbsp;<span class="op" id="6207311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207315">p</span>&nbsp;<span class="op" id="6207317">+=</span>&nbsp;<span class="ident" id="6207320">binary</span><span class="op" id="6207326">.</span><span class="ident" id="6207327">PutUvarint</span><span class="op" id="6207337">(</span><span class="ident" id="6207338">buf</span><span class="op" id="6207341">[</span><span class="ident" id="6207342">p</span><span class="op" id="6207343">:</span><span class="op" id="6207344">]</span><span class="op" id="6207345">,</span>&nbsp;<span class="ident" id="6207347">uint64</span><span class="op" id="6207353">(</span><span class="ident" id="6207354">data</span><span class="op" id="6207358">[</span><span class="ident" id="6207359">n</span><span class="op" id="6207360">]</span><span class="op" id="6207361">)</span><span class="op" id="6207362">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207369">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207392">binary</span><span class="op" id="6207398">.</span><span class="ident" id="6207399">PutVarint</span><span class="op" id="6207408">(</span><span class="ident" id="6207409">buf</span><span class="op" id="6207412">,</span>&nbsp;<span class="ident" id="6207414">int64</span><span class="op" id="6207419">(</span><span class="ident" id="6207420">p</span><span class="op" id="6207421">)</span><span class="op" id="6207422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207426">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207443">_</span><span class="op" id="6207444">,</span>&nbsp;<span class="ident" id="6207446">err</span>&nbsp;<span class="op" id="6207450">=</span>&nbsp;<span class="ident" id="6207452">w</span><span class="op" id="6207453">.</span><span class="ident" id="6207454">Write</span><span class="op" id="6207459">(</span><span class="ident" id="6207460">buf</span><span class="op" id="6207463">[</span><span class="num" id="6207464">0</span><span class="op" id="6207465">:</span><span class="ident" id="6207466">p</span><span class="op" id="6207467">]</span><span class="op" id="6207468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207471">return</span><br>
<span class="lineno"></span><span class="op" id="6207478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6207481">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6207531">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6207566">func</span>&nbsp;<span class="ident" id="6207571">readSlice</span><span class="op" id="6207580">(</span><span class="ident" id="6207581">r</span>&nbsp;<span class="ident" id="6207583">io</span><span class="op" id="6207585">.</span><span class="ident" id="6207586">Reader</span><span class="op" id="6207592">,</span>&nbsp;<span class="ident" id="6207594">buf</span>&nbsp;<span class="op" id="6207598">[</span><span class="op" id="6207599">]</span><span class="builtintype" id="6207600">byte</span><span class="op" id="6207604">,</span>&nbsp;<span class="ident" id="6207606">data</span>&nbsp;<span class="op" id="6207611">[</span><span class="op" id="6207612">]</span><span class="builtintype" id="6207613">int</span><span class="op" id="6207616">)</span>&nbsp;<span class="op" id="6207618">(</span><span class="ident" id="6207619">n</span>&nbsp;<span class="builtintype" id="6207621">int</span><span class="op" id="6207624">,</span>&nbsp;<span class="ident" id="6207626">err</span>&nbsp;<span class="builtintype" id="6207630">error</span><span class="op" id="6207635">)</span>&nbsp;<span class="op" id="6207637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207640">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207661">var</span>&nbsp;<span class="ident" id="6207665">size</span>&nbsp;<span class="builtintype" id="6207670">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207675">size</span><span class="op" id="6207679">,</span>&nbsp;<span class="ident" id="6207681">err</span>&nbsp;<span class="op" id="6207685">=</span>&nbsp;<span class="ident" id="6207687">readInt</span><span class="op" id="6207694">(</span><span class="ident" id="6207695">r</span><span class="op" id="6207696">,</span>&nbsp;<span class="ident" id="6207698">buf</span><span class="op" id="6207701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207704">if</span>&nbsp;<span class="ident" id="6207707">err</span>&nbsp;<span class="op" id="6207711">!=</span>&nbsp;<span class="ident" id="6207714">nil</span>&nbsp;<span class="op" id="6207718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207722">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207734">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207763">if</span>&nbsp;<span class="ident" id="6207766">_</span><span class="op" id="6207767">,</span>&nbsp;<span class="ident" id="6207769">err</span>&nbsp;<span class="op" id="6207773">=</span>&nbsp;<span class="ident" id="6207775">io</span><span class="op" id="6207777">.</span><span class="ident" id="6207778">ReadFull</span><span class="op" id="6207786">(</span><span class="ident" id="6207787">r</span><span class="op" id="6207788">,</span>&nbsp;<span class="ident" id="6207790">buf</span><span class="op" id="6207793">[</span><span class="ident" id="6207794">binary</span><span class="op" id="6207800">.</span><span class="ident" id="6207801">MaxVarintLen64</span><span class="op" id="6207815">:</span><span class="ident" id="6207816">size</span><span class="op" id="6207820">]</span><span class="op" id="6207821">)</span><span class="op" id="6207822">;</span>&nbsp;<span class="ident" id="6207824">err</span>&nbsp;<span class="op" id="6207828">!=</span>&nbsp;<span class="ident" id="6207831">nil</span>&nbsp;<span class="op" id="6207835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207839">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6207847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6207851">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6207897">for</span>&nbsp;<span class="ident" id="6207901">p</span>&nbsp;<span class="op" id="6207903">:=</span>&nbsp;<span class="ident" id="6207906">binary</span><span class="op" id="6207912">.</span><span class="ident" id="6207913">MaxVarintLen64</span><span class="op" id="6207927">;</span>&nbsp;<span class="ident" id="6207929">p</span>&nbsp;<span class="op" id="6207931">&lt;</span>&nbsp;<span class="ident" id="6207933">size</span><span class="op" id="6207937">;</span>&nbsp;<span class="ident" id="6207939">n</span><span class="op" id="6207940">++</span>&nbsp;<span class="op" id="6207943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207947">x</span><span class="op" id="6207948">,</span>&nbsp;<span class="ident" id="6207950">w</span>&nbsp;<span class="op" id="6207952">:=</span>&nbsp;<span class="ident" id="6207955">binary</span><span class="op" id="6207961">.</span><span class="ident" id="6207962">Uvarint</span><span class="op" id="6207969">(</span><span class="ident" id="6207970">buf</span><span class="op" id="6207973">[</span><span class="ident" id="6207974">p</span><span class="op" id="6207975">:</span><span class="op" id="6207976">]</span><span class="op" id="6207977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6207981">data</span><span class="op" id="6207985">[</span><span class="ident" id="6207986">n</span><span class="op" id="6207987">]</span>&nbsp;<span class="op" id="6207989">=</span>&nbsp;<span class="builtintype" id="6207991">int</span><span class="op" id="6207994">(</span><span class="ident" id="6207995">x</span><span class="op" id="6207996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208000">p</span>&nbsp;<span class="op" id="6208002">+=</span>&nbsp;<span class="ident" id="6208005">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208012">return</span><br>
<span class="lineno"></span><span class="op" id="6208019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6208022">const</span>&nbsp;<span class="ident" id="6208028">bufSize</span>&nbsp;<span class="op" id="6208036">=</span>&nbsp;<span class="num" id="6208038">16</span>&nbsp;<span class="op" id="6208041">&lt;&lt;</span>&nbsp;<span class="num" id="6208044">10</span>&nbsp;<span class="comment" id="6208047">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6208087">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6208145">func</span>&nbsp;<span class="op" id="6208150">(</span><span class="ident" id="6208151">x</span>&nbsp;<span class="op" id="6208153">*</span><span class="ident" id="6208154">Index</span><span class="op" id="6208159">)</span>&nbsp;<span class="ident" id="6208161">Read</span><span class="op" id="6208165">(</span><span class="ident" id="6208166">r</span>&nbsp;<span class="ident" id="6208168">io</span><span class="op" id="6208170">.</span><span class="ident" id="6208171">Reader</span><span class="op" id="6208177">)</span>&nbsp;<span class="builtintype" id="6208179">error</span>&nbsp;<span class="op" id="6208185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208188">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208213">buf</span>&nbsp;<span class="op" id="6208217">:=</span>&nbsp;<span class="builtinfunc" id="6208220">make</span><span class="op" id="6208224">(</span><span class="op" id="6208225">[</span><span class="op" id="6208226">]</span><span class="builtintype" id="6208227">byte</span><span class="op" id="6208231">,</span>&nbsp;<span class="ident" id="6208233">bufSize</span><span class="op" id="6208240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208244">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208260">n</span><span class="op" id="6208261">,</span>&nbsp;<span class="ident" id="6208263">err</span>&nbsp;<span class="op" id="6208267">:=</span>&nbsp;<span class="ident" id="6208270">readInt</span><span class="op" id="6208277">(</span><span class="ident" id="6208278">r</span><span class="op" id="6208279">,</span>&nbsp;<span class="ident" id="6208281">buf</span><span class="op" id="6208284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208287">if</span>&nbsp;<span class="ident" id="6208290">err</span>&nbsp;<span class="op" id="6208294">!=</span>&nbsp;<span class="ident" id="6208297">nil</span>&nbsp;<span class="op" id="6208301">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208305">return</span>&nbsp;<span class="ident" id="6208312">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208321">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208340">if</span>&nbsp;<span class="num" id="6208343">2</span><span class="op" id="6208344">*</span><span class="ident" id="6208345">n</span>&nbsp;<span class="op" id="6208347">&lt;</span>&nbsp;<span class="builtinfunc" id="6208349">cap</span><span class="op" id="6208352">(</span><span class="ident" id="6208353">x</span><span class="op" id="6208354">.</span><span class="ident" id="6208355">data</span><span class="op" id="6208359">)</span>&nbsp;<span class="op" id="6208361">||</span>&nbsp;<span class="builtinfunc" id="6208364">cap</span><span class="op" id="6208367">(</span><span class="ident" id="6208368">x</span><span class="op" id="6208369">.</span><span class="ident" id="6208370">data</span><span class="op" id="6208374">)</span>&nbsp;<span class="op" id="6208376">&lt;</span>&nbsp;<span class="ident" id="6208378">n</span>&nbsp;<span class="op" id="6208380">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208384">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208438">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208480">x</span><span class="op" id="6208481">.</span><span class="ident" id="6208482">data</span>&nbsp;<span class="op" id="6208487">=</span>&nbsp;<span class="builtinfunc" id="6208489">make</span><span class="op" id="6208493">(</span><span class="op" id="6208494">[</span><span class="op" id="6208495">]</span><span class="builtintype" id="6208496">byte</span><span class="op" id="6208500">,</span>&nbsp;<span class="ident" id="6208502">n</span><span class="op" id="6208503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208507">x</span><span class="op" id="6208508">.</span><span class="ident" id="6208509">sa</span>&nbsp;<span class="op" id="6208512">=</span>&nbsp;<span class="builtinfunc" id="6208514">make</span><span class="op" id="6208518">(</span><span class="op" id="6208519">[</span><span class="op" id="6208520">]</span><span class="builtintype" id="6208521">int</span><span class="op" id="6208524">,</span>&nbsp;<span class="ident" id="6208526">n</span><span class="op" id="6208527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208530">}</span>&nbsp;<span class="keyword" id="6208532">else</span>&nbsp;<span class="op" id="6208537">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208541">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208570">x</span><span class="op" id="6208571">.</span><span class="ident" id="6208572">data</span>&nbsp;<span class="op" id="6208577">=</span>&nbsp;<span class="ident" id="6208579">x</span><span class="op" id="6208580">.</span><span class="ident" id="6208581">data</span><span class="op" id="6208585">[</span><span class="num" id="6208586">0</span><span class="op" id="6208587">:</span><span class="ident" id="6208588">n</span><span class="op" id="6208589">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208593">x</span><span class="op" id="6208594">.</span><span class="ident" id="6208595">sa</span>&nbsp;<span class="op" id="6208598">=</span>&nbsp;<span class="ident" id="6208600">x</span><span class="op" id="6208601">.</span><span class="ident" id="6208602">sa</span><span class="op" id="6208604">[</span><span class="num" id="6208605">0</span><span class="op" id="6208606">:</span><span class="ident" id="6208607">n</span><span class="op" id="6208608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208615">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208629">if</span>&nbsp;<span class="ident" id="6208632">_</span><span class="op" id="6208633">,</span>&nbsp;<span class="ident" id="6208635">err</span>&nbsp;<span class="op" id="6208639">:=</span>&nbsp;<span class="ident" id="6208642">io</span><span class="op" id="6208644">.</span><span class="ident" id="6208645">ReadFull</span><span class="op" id="6208653">(</span><span class="ident" id="6208654">r</span><span class="op" id="6208655">,</span>&nbsp;<span class="ident" id="6208657">x</span><span class="op" id="6208658">.</span><span class="ident" id="6208659">data</span><span class="op" id="6208663">)</span><span class="op" id="6208664">;</span>&nbsp;<span class="ident" id="6208666">err</span>&nbsp;<span class="op" id="6208670">!=</span>&nbsp;<span class="ident" id="6208673">nil</span>&nbsp;<span class="op" id="6208677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208681">return</span>&nbsp;<span class="ident" id="6208688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208697">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208712">for</span>&nbsp;<span class="ident" id="6208716">sa</span>&nbsp;<span class="op" id="6208719">:=</span>&nbsp;<span class="ident" id="6208722">x</span><span class="op" id="6208723">.</span><span class="ident" id="6208724">sa</span><span class="op" id="6208726">;</span>&nbsp;<span class="builtinfunc" id="6208728">len</span><span class="op" id="6208731">(</span><span class="ident" id="6208732">sa</span><span class="op" id="6208734">)</span>&nbsp;<span class="op" id="6208736">&gt;</span>&nbsp;<span class="num" id="6208738">0</span><span class="op" id="6208739">;</span>&nbsp;<span class="op" id="6208741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208745">n</span><span class="op" id="6208746">,</span>&nbsp;<span class="ident" id="6208748">err</span>&nbsp;<span class="op" id="6208752">:=</span>&nbsp;<span class="ident" id="6208755">readSlice</span><span class="op" id="6208764">(</span><span class="ident" id="6208765">r</span><span class="op" id="6208766">,</span>&nbsp;<span class="ident" id="6208768">buf</span><span class="op" id="6208771">,</span>&nbsp;<span class="ident" id="6208773">sa</span><span class="op" id="6208775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208779">if</span>&nbsp;<span class="ident" id="6208782">err</span>&nbsp;<span class="op" id="6208786">!=</span>&nbsp;<span class="ident" id="6208789">nil</span>&nbsp;<span class="op" id="6208793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208798">return</span>&nbsp;<span class="ident" id="6208805">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208815">sa</span>&nbsp;<span class="op" id="6208818">=</span>&nbsp;<span class="ident" id="6208820">sa</span><span class="op" id="6208822">[</span><span class="ident" id="6208823">n</span><span class="op" id="6208824">:</span><span class="op" id="6208825">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6208828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208831">return</span>&nbsp;<span class="ident" id="6208838">nil</span><br>
<span class="lineno"></span><span class="op" id="6208842">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="6208845">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6208879">func</span>&nbsp;<span class="op" id="6208884">(</span><span class="ident" id="6208885">x</span>&nbsp;<span class="op" id="6208887">*</span><span class="ident" id="6208888">Index</span><span class="op" id="6208893">)</span>&nbsp;<span class="ident" id="6208895">Write</span><span class="op" id="6208900">(</span><span class="ident" id="6208901">w</span>&nbsp;<span class="ident" id="6208903">io</span><span class="op" id="6208905">.</span><span class="ident" id="6208906">Writer</span><span class="op" id="6208912">)</span>&nbsp;<span class="builtintype" id="6208914">error</span>&nbsp;<span class="op" id="6208920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208923">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208949">buf</span>&nbsp;<span class="op" id="6208953">:=</span>&nbsp;<span class="builtinfunc" id="6208956">make</span><span class="op" id="6208960">(</span><span class="op" id="6208961">[</span><span class="op" id="6208962">]</span><span class="builtintype" id="6208963">byte</span><span class="op" id="6208967">,</span>&nbsp;<span class="ident" id="6208969">bufSize</span><span class="op" id="6208976">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6208980">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6208997">if</span>&nbsp;<span class="ident" id="6209000">err</span>&nbsp;<span class="op" id="6209004">:=</span>&nbsp;<span class="ident" id="6209007">writeInt</span><span class="op" id="6209015">(</span><span class="ident" id="6209016">w</span><span class="op" id="6209017">,</span>&nbsp;<span class="ident" id="6209019">buf</span><span class="op" id="6209022">,</span>&nbsp;<span class="builtinfunc" id="6209024">len</span><span class="op" id="6209027">(</span><span class="ident" id="6209028">x</span><span class="op" id="6209029">.</span><span class="ident" id="6209030">data</span><span class="op" id="6209034">)</span><span class="op" id="6209035">)</span><span class="op" id="6209036">;</span>&nbsp;<span class="ident" id="6209038">err</span>&nbsp;<span class="op" id="6209042">!=</span>&nbsp;<span class="ident" id="6209045">nil</span>&nbsp;<span class="op" id="6209049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209053">return</span>&nbsp;<span class="ident" id="6209060">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209065">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209069">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209084">if</span>&nbsp;<span class="ident" id="6209087">_</span><span class="op" id="6209088">,</span>&nbsp;<span class="ident" id="6209090">err</span>&nbsp;<span class="op" id="6209094">:=</span>&nbsp;<span class="ident" id="6209097">w</span><span class="op" id="6209098">.</span><span class="ident" id="6209099">Write</span><span class="op" id="6209104">(</span><span class="ident" id="6209105">x</span><span class="op" id="6209106">.</span><span class="ident" id="6209107">data</span><span class="op" id="6209111">)</span><span class="op" id="6209112">;</span>&nbsp;<span class="ident" id="6209114">err</span>&nbsp;<span class="op" id="6209118">!=</span>&nbsp;<span class="ident" id="6209121">nil</span>&nbsp;<span class="op" id="6209125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209129">return</span>&nbsp;<span class="ident" id="6209136">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209141">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209145">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209161">for</span>&nbsp;<span class="ident" id="6209165">sa</span>&nbsp;<span class="op" id="6209168">:=</span>&nbsp;<span class="ident" id="6209171">x</span><span class="op" id="6209172">.</span><span class="ident" id="6209173">sa</span><span class="op" id="6209175">;</span>&nbsp;<span class="builtinfunc" id="6209177">len</span><span class="op" id="6209180">(</span><span class="ident" id="6209181">sa</span><span class="op" id="6209183">)</span>&nbsp;<span class="op" id="6209185">&gt;</span>&nbsp;<span class="num" id="6209187">0</span><span class="op" id="6209188">;</span>&nbsp;<span class="op" id="6209190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209194">n</span><span class="op" id="6209195">,</span>&nbsp;<span class="ident" id="6209197">err</span>&nbsp;<span class="op" id="6209201">:=</span>&nbsp;<span class="ident" id="6209204">writeSlice</span><span class="op" id="6209214">(</span><span class="ident" id="6209215">w</span><span class="op" id="6209216">,</span>&nbsp;<span class="ident" id="6209218">buf</span><span class="op" id="6209221">,</span>&nbsp;<span class="ident" id="6209223">sa</span><span class="op" id="6209225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209229">if</span>&nbsp;<span class="ident" id="6209232">err</span>&nbsp;<span class="op" id="6209236">!=</span>&nbsp;<span class="ident" id="6209239">nil</span>&nbsp;<span class="op" id="6209243">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209248">return</span>&nbsp;<span class="ident" id="6209255">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209265">sa</span>&nbsp;<span class="op" id="6209268">=</span>&nbsp;<span class="ident" id="6209270">sa</span><span class="op" id="6209272">[</span><span class="ident" id="6209273">n</span><span class="op" id="6209274">:</span><span class="op" id="6209275">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209281">return</span>&nbsp;<span class="ident" id="6209288">nil</span><br>
<span class="lineno">160</span><span class="op" id="6209292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6209295">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="6209355">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="6209383">//</span><br>
<span class="lineno">165</span><span class="keyword" id="6209386">func</span>&nbsp;<span class="op" id="6209391">(</span><span class="ident" id="6209392">x</span>&nbsp;<span class="op" id="6209394">*</span><span class="ident" id="6209395">Index</span><span class="op" id="6209400">)</span>&nbsp;<span class="ident" id="6209402">Bytes</span><span class="op" id="6209407">(</span><span class="op" id="6209408">)</span>&nbsp;<span class="op" id="6209410">[</span><span class="op" id="6209411">]</span><span class="builtintype" id="6209412">byte</span>&nbsp;<span class="op" id="6209417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209420">return</span>&nbsp;<span class="ident" id="6209427">x</span><span class="op" id="6209428">.</span><span class="ident" id="6209429">data</span><br>
<span class="lineno"></span><span class="op" id="6209434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209437">func</span>&nbsp;<span class="op" id="6209442">(</span><span class="ident" id="6209443">x</span>&nbsp;<span class="op" id="6209445">*</span><span class="ident" id="6209446">Index</span><span class="op" id="6209451">)</span>&nbsp;<span class="ident" id="6209453">at</span><span class="op" id="6209455">(</span><span class="ident" id="6209456">i</span>&nbsp;<span class="builtintype" id="6209458">int</span><span class="op" id="6209461">)</span>&nbsp;<span class="op" id="6209463">[</span><span class="op" id="6209464">]</span><span class="builtintype" id="6209465">byte</span>&nbsp;<span class="op" id="6209470">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209473">return</span>&nbsp;<span class="ident" id="6209480">x</span><span class="op" id="6209481">.</span><span class="ident" id="6209482">data</span><span class="op" id="6209486">[</span><span class="ident" id="6209487">x</span><span class="op" id="6209488">.</span><span class="ident" id="6209489">sa</span><span class="op" id="6209491">[</span><span class="ident" id="6209492">i</span><span class="op" id="6209493">]</span><span class="op" id="6209494">:</span><span class="op" id="6209495">]</span><br>
<span class="lineno"></span><span class="op" id="6209497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6209500">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="6209568">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="6209604">func</span>&nbsp;<span class="op" id="6209609">(</span><span class="ident" id="6209610">x</span>&nbsp;<span class="op" id="6209612">*</span><span class="ident" id="6209613">Index</span><span class="op" id="6209618">)</span>&nbsp;<span class="ident" id="6209620">lookupAll</span><span class="op" id="6209629">(</span><span class="ident" id="6209630">s</span>&nbsp;<span class="op" id="6209632">[</span><span class="op" id="6209633">]</span><span class="builtintype" id="6209634">byte</span><span class="op" id="6209638">)</span>&nbsp;<span class="op" id="6209640">[</span><span class="op" id="6209641">]</span><span class="builtintype" id="6209642">int</span>&nbsp;<span class="op" id="6209646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209649">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209692">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209745">i</span>&nbsp;<span class="op" id="6209747">:=</span>&nbsp;<span class="ident" id="6209750">sort</span><span class="op" id="6209754">.</span><span class="ident" id="6209755">Search</span><span class="op" id="6209761">(</span><span class="builtinfunc" id="6209762">len</span><span class="op" id="6209765">(</span><span class="ident" id="6209766">x</span><span class="op" id="6209767">.</span><span class="ident" id="6209768">sa</span><span class="op" id="6209770">)</span><span class="op" id="6209771">,</span>&nbsp;<span class="keyword" id="6209773">func</span><span class="op" id="6209777">(</span><span class="ident" id="6209778">i</span>&nbsp;<span class="builtintype" id="6209780">int</span><span class="op" id="6209783">)</span>&nbsp;<span class="builtintype" id="6209785">bool</span>&nbsp;<span class="op" id="6209790">{</span>&nbsp;<span class="keyword" id="6209792">return</span>&nbsp;<span class="ident" id="6209799">bytes</span><span class="op" id="6209804">.</span><span class="ident" id="6209805">Compare</span><span class="op" id="6209812">(</span><span class="ident" id="6209813">x</span><span class="op" id="6209814">.</span><span class="ident" id="6209815">at</span><span class="op" id="6209817">(</span><span class="ident" id="6209818">i</span><span class="op" id="6209819">)</span><span class="op" id="6209820">,</span>&nbsp;<span class="ident" id="6209822">s</span><span class="op" id="6209823">)</span>&nbsp;<span class="op" id="6209825">&gt;=</span>&nbsp;<span class="num" id="6209828">0</span>&nbsp;<span class="op" id="6209830">}</span><span class="op" id="6209831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209834">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209901">j</span>&nbsp;<span class="op" id="6209903">:=</span>&nbsp;<span class="ident" id="6209906">i</span>&nbsp;<span class="op" id="6209908">+</span>&nbsp;<span class="ident" id="6209910">sort</span><span class="op" id="6209914">.</span><span class="ident" id="6209915">Search</span><span class="op" id="6209921">(</span><span class="builtinfunc" id="6209922">len</span><span class="op" id="6209925">(</span><span class="ident" id="6209926">x</span><span class="op" id="6209927">.</span><span class="ident" id="6209928">sa</span><span class="op" id="6209930">)</span><span class="op" id="6209931">-</span><span class="ident" id="6209932">i</span><span class="op" id="6209933">,</span>&nbsp;<span class="keyword" id="6209935">func</span><span class="op" id="6209939">(</span><span class="ident" id="6209940">j</span>&nbsp;<span class="builtintype" id="6209942">int</span><span class="op" id="6209945">)</span>&nbsp;<span class="builtintype" id="6209947">bool</span>&nbsp;<span class="op" id="6209952">{</span>&nbsp;<span class="keyword" id="6209954">return</span>&nbsp;<span class="op" id="6209961">!</span><span class="ident" id="6209962">bytes</span><span class="op" id="6209967">.</span><span class="ident" id="6209968">HasPrefix</span><span class="op" id="6209977">(</span><span class="ident" id="6209978">x</span><span class="op" id="6209979">.</span><span class="ident" id="6209980">at</span><span class="op" id="6209982">(</span><span class="ident" id="6209983">j</span><span class="op" id="6209984">+</span><span class="ident" id="6209985">i</span><span class="op" id="6209986">)</span><span class="op" id="6209987">,</span>&nbsp;<span class="ident" id="6209989">s</span><span class="op" id="6209990">)</span>&nbsp;<span class="op" id="6209992">}</span><span class="op" id="6209993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209996">return</span>&nbsp;<span class="ident" id="6210003">x</span><span class="op" id="6210004">.</span><span class="ident" id="6210005">sa</span><span class="op" id="6210007">[</span><span class="ident" id="6210008">i</span><span class="op" id="6210009">:</span><span class="ident" id="6210010">j</span><span class="op" id="6210011">]</span><br>
<span class="lineno"></span><span class="op" id="6210013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6210016">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="6210096">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="6210167">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6210230">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6210294">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6210323">//</span><br>
<span class="lineno">190</span><span class="keyword" id="6210326">func</span>&nbsp;<span class="op" id="6210331">(</span><span class="ident" id="6210332">x</span>&nbsp;<span class="op" id="6210334">*</span><span class="ident" id="6210335">Index</span><span class="op" id="6210340">)</span>&nbsp;<span class="ident" id="6210342">Lookup</span><span class="op" id="6210348">(</span><span class="ident" id="6210349">s</span>&nbsp;<span class="op" id="6210351">[</span><span class="op" id="6210352">]</span><span class="builtintype" id="6210353">byte</span><span class="op" id="6210357">,</span>&nbsp;<span class="ident" id="6210359">n</span>&nbsp;<span class="builtintype" id="6210361">int</span><span class="op" id="6210364">)</span>&nbsp;<span class="op" id="6210366">(</span><span class="ident" id="6210367">result</span>&nbsp;<span class="op" id="6210374">[</span><span class="op" id="6210375">]</span><span class="builtintype" id="6210376">int</span><span class="op" id="6210379">)</span>&nbsp;<span class="op" id="6210381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210384">if</span>&nbsp;<span class="builtinfunc" id="6210387">len</span><span class="op" id="6210390">(</span><span class="ident" id="6210391">s</span><span class="op" id="6210392">)</span>&nbsp;<span class="op" id="6210394">&gt;</span>&nbsp;<span class="num" id="6210396">0</span>&nbsp;<span class="op" id="6210398">&amp;&amp;</span>&nbsp;<span class="ident" id="6210401">n</span>&nbsp;<span class="op" id="6210403">!=</span>&nbsp;<span class="num" id="6210406">0</span>&nbsp;<span class="op" id="6210408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210412">matches</span>&nbsp;<span class="op" id="6210420">:=</span>&nbsp;<span class="ident" id="6210423">x</span><span class="op" id="6210424">.</span><span class="ident" id="6210425">lookupAll</span><span class="op" id="6210434">(</span><span class="ident" id="6210435">s</span><span class="op" id="6210436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210440">if</span>&nbsp;<span class="ident" id="6210443">n</span>&nbsp;<span class="op" id="6210445">&lt;</span>&nbsp;<span class="num" id="6210447">0</span>&nbsp;<span class="op" id="6210449">||</span>&nbsp;<span class="builtinfunc" id="6210452">len</span><span class="op" id="6210455">(</span><span class="ident" id="6210456">matches</span><span class="op" id="6210463">)</span>&nbsp;<span class="op" id="6210465">&lt;</span>&nbsp;<span class="ident" id="6210467">n</span>&nbsp;<span class="op" id="6210469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210474">n</span>&nbsp;<span class="op" id="6210476">=</span>&nbsp;<span class="builtinfunc" id="6210478">len</span><span class="op" id="6210481">(</span><span class="ident" id="6210482">matches</span><span class="op" id="6210489">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6210497">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210525">if</span>&nbsp;<span class="ident" id="6210528">n</span>&nbsp;<span class="op" id="6210530">&gt;</span>&nbsp;<span class="num" id="6210532">0</span>&nbsp;<span class="op" id="6210534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210539">result</span>&nbsp;<span class="op" id="6210546">=</span>&nbsp;<span class="builtinfunc" id="6210548">make</span><span class="op" id="6210552">(</span><span class="op" id="6210553">[</span><span class="op" id="6210554">]</span><span class="builtintype" id="6210555">int</span><span class="op" id="6210558">,</span>&nbsp;<span class="ident" id="6210560">n</span><span class="op" id="6210561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6210566">copy</span><span class="op" id="6210570">(</span><span class="ident" id="6210571">result</span><span class="op" id="6210577">,</span>&nbsp;<span class="ident" id="6210579">matches</span><span class="op" id="6210586">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210596">return</span><br>
<span class="lineno"></span><span class="op" id="6210603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6210606">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6210678">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="6210749">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6210819">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6210889">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="6210963">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6210980">//</span><br>
<span class="lineno"></span><span class="keyword" id="6210983">func</span>&nbsp;<span class="op" id="6210988">(</span><span class="ident" id="6210989">x</span>&nbsp;<span class="op" id="6210991">*</span><span class="ident" id="6210992">Index</span><span class="op" id="6210997">)</span>&nbsp;<span class="ident" id="6210999">FindAllIndex</span><span class="op" id="6211011">(</span><span class="ident" id="6211012">r</span>&nbsp;<span class="op" id="6211014">*</span><span class="ident" id="6211015">regexp</span><span class="op" id="6211021">.</span><span class="ident" id="6211022">Regexp</span><span class="op" id="6211028">,</span>&nbsp;<span class="ident" id="6211030">n</span>&nbsp;<span class="builtintype" id="6211032">int</span><span class="op" id="6211035">)</span>&nbsp;<span class="op" id="6211037">(</span><span class="ident" id="6211038">result</span>&nbsp;<span class="op" id="6211045">[</span><span class="op" id="6211046">]</span><span class="op" id="6211047">[</span><span class="op" id="6211048">]</span><span class="builtintype" id="6211049">int</span><span class="op" id="6211052">)</span>&nbsp;<span class="op" id="6211054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211057">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211118">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211154">prefix</span><span class="op" id="6211160">,</span>&nbsp;<span class="ident" id="6211162">complete</span>&nbsp;<span class="op" id="6211171">:=</span>&nbsp;<span class="ident" id="6211174">r</span><span class="op" id="6211175">.</span><span class="ident" id="6211176">LiteralPrefix</span><span class="op" id="6211189">(</span><span class="op" id="6211190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211193">lit</span>&nbsp;<span class="op" id="6211197">:=</span>&nbsp;<span class="op" id="6211200">[</span><span class="op" id="6211201">]</span><span class="builtintype" id="6211202">byte</span><span class="op" id="6211206">(</span><span class="ident" id="6211207">prefix</span><span class="op" id="6211213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211217">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211260">if</span>&nbsp;<span class="ident" id="6211263">prefix</span>&nbsp;<span class="op" id="6211270">==</span>&nbsp;<span class="string" id="6211273">&#34;&#34;</span>&nbsp;<span class="op" id="6211276">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211280">return</span>&nbsp;<span class="ident" id="6211287">r</span><span class="op" id="6211288">.</span><span class="ident" id="6211289">FindAllIndex</span><span class="op" id="6211301">(</span><span class="ident" id="6211302">x</span><span class="op" id="6211303">.</span><span class="ident" id="6211304">data</span><span class="op" id="6211308">,</span>&nbsp;<span class="ident" id="6211310">n</span><span class="op" id="6211311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211318">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211377">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211405">if</span>&nbsp;<span class="ident" id="6211408">complete</span>&nbsp;<span class="op" id="6211417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211421">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211489">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211559">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211624">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211695">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211764">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211792">for</span>&nbsp;<span class="ident" id="6211796">n1</span>&nbsp;<span class="op" id="6211799">:=</span>&nbsp;<span class="ident" id="6211802">n</span><span class="op" id="6211803">;</span>&nbsp;<span class="op" id="6211805">;</span>&nbsp;<span class="ident" id="6211807">n1</span>&nbsp;<span class="op" id="6211810">+=</span>&nbsp;<span class="num" id="6211813">2</span>&nbsp;<span class="op" id="6211815">*</span>&nbsp;<span class="op" id="6211817">(</span><span class="ident" id="6211818">n</span>&nbsp;<span class="op" id="6211820">-</span>&nbsp;<span class="builtinfunc" id="6211822">len</span><span class="op" id="6211825">(</span><span class="ident" id="6211826">result</span><span class="op" id="6211832">)</span><span class="op" id="6211833">)</span>&nbsp;<span class="comment" id="6211835">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6211853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211858">indices</span>&nbsp;<span class="op" id="6211866">:=</span>&nbsp;<span class="ident" id="6211869">x</span><span class="op" id="6211870">.</span><span class="ident" id="6211871">Lookup</span><span class="op" id="6211877">(</span><span class="ident" id="6211878">lit</span><span class="op" id="6211881">,</span>&nbsp;<span class="ident" id="6211883">n1</span><span class="op" id="6211885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211890">if</span>&nbsp;<span class="builtinfunc" id="6211893">len</span><span class="op" id="6211896">(</span><span class="ident" id="6211897">indices</span><span class="op" id="6211904">)</span>&nbsp;<span class="op" id="6211906">==</span>&nbsp;<span class="num" id="6211909">0</span>&nbsp;<span class="op" id="6211911">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211932">sort</span><span class="op" id="6211936">.</span><span class="ident" id="6211937">Ints</span><span class="op" id="6211941">(</span><span class="ident" id="6211942">indices</span><span class="op" id="6211949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211954">pairs</span>&nbsp;<span class="op" id="6211960">:=</span>&nbsp;<span class="builtinfunc" id="6211963">make</span><span class="op" id="6211967">(</span><span class="op" id="6211968">[</span><span class="op" id="6211969">]</span><span class="builtintype" id="6211970">int</span><span class="op" id="6211973">,</span>&nbsp;<span class="num" id="6211975">2</span><span class="op" id="6211976">*</span><span class="builtinfunc" id="6211977">len</span><span class="op" id="6211980">(</span><span class="ident" id="6211981">indices</span><span class="op" id="6211988">)</span><span class="op" id="6211989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211994">result</span>&nbsp;<span class="op" id="6212001">=</span>&nbsp;<span class="builtinfunc" id="6212003">make</span><span class="op" id="6212007">(</span><span class="op" id="6212008">[</span><span class="op" id="6212009">]</span><span class="op" id="6212010">[</span><span class="op" id="6212011">]</span><span class="builtintype" id="6212012">int</span><span class="op" id="6212015">,</span>&nbsp;<span class="builtinfunc" id="6212017">len</span><span class="op" id="6212020">(</span><span class="ident" id="6212021">indices</span><span class="op" id="6212028">)</span><span class="op" id="6212029">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212034">count</span>&nbsp;<span class="op" id="6212040">:=</span>&nbsp;<span class="num" id="6212043">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212048">prev</span>&nbsp;<span class="op" id="6212053">:=</span>&nbsp;<span class="num" id="6212056">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212061">for</span>&nbsp;<span class="ident" id="6212065">_</span><span class="op" id="6212066">,</span>&nbsp;<span class="ident" id="6212068">i</span>&nbsp;<span class="op" id="6212070">:=</span>&nbsp;<span class="keyword" id="6212073">range</span>&nbsp;<span class="ident" id="6212079">indices</span>&nbsp;<span class="op" id="6212087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212093">if</span>&nbsp;<span class="ident" id="6212096">count</span>&nbsp;<span class="op" id="6212102">==</span>&nbsp;<span class="ident" id="6212105">n</span>&nbsp;<span class="op" id="6212107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212114">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212130">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212183">if</span>&nbsp;<span class="ident" id="6212186">prev</span>&nbsp;<span class="op" id="6212191">&lt;=</span>&nbsp;<span class="ident" id="6212194">i</span>&nbsp;<span class="op" id="6212196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212203">j</span>&nbsp;<span class="op" id="6212205">:=</span>&nbsp;<span class="num" id="6212208">2</span>&nbsp;<span class="op" id="6212210">*</span>&nbsp;<span class="ident" id="6212212">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212223">pairs</span><span class="op" id="6212228">[</span><span class="ident" id="6212229">j</span><span class="op" id="6212230">+</span><span class="num" id="6212231">0</span><span class="op" id="6212232">]</span>&nbsp;<span class="op" id="6212234">=</span>&nbsp;<span class="ident" id="6212236">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212243">pairs</span><span class="op" id="6212248">[</span><span class="ident" id="6212249">j</span><span class="op" id="6212250">+</span><span class="num" id="6212251">1</span><span class="op" id="6212252">]</span>&nbsp;<span class="op" id="6212254">=</span>&nbsp;<span class="ident" id="6212256">i</span>&nbsp;<span class="op" id="6212258">+</span>&nbsp;<span class="builtinfunc" id="6212260">len</span><span class="op" id="6212263">(</span><span class="ident" id="6212264">lit</span><span class="op" id="6212267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212274">result</span><span class="op" id="6212280">[</span><span class="ident" id="6212281">count</span><span class="op" id="6212286">]</span>&nbsp;<span class="op" id="6212288">=</span>&nbsp;<span class="ident" id="6212290">pairs</span><span class="op" id="6212295">[</span><span class="ident" id="6212296">j</span>&nbsp;<span class="op" id="6212298">:</span>&nbsp;<span class="ident" id="6212300">j</span><span class="op" id="6212301">+</span><span class="num" id="6212302">2</span><span class="op" id="6212303">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212310">count</span><span class="op" id="6212315">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212323">prev</span>&nbsp;<span class="op" id="6212328">=</span>&nbsp;<span class="ident" id="6212330">i</span>&nbsp;<span class="op" id="6212332">+</span>&nbsp;<span class="builtinfunc" id="6212334">len</span><span class="op" id="6212337">(</span><span class="ident" id="6212338">lit</span><span class="op" id="6212341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212347">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212357">result</span>&nbsp;<span class="op" id="6212364">=</span>&nbsp;<span class="ident" id="6212366">result</span><span class="op" id="6212372">[</span><span class="num" id="6212373">0</span><span class="op" id="6212374">:</span><span class="ident" id="6212375">count</span><span class="op" id="6212380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212385">if</span>&nbsp;<span class="builtinfunc" id="6212388">len</span><span class="op" id="6212391">(</span><span class="ident" id="6212392">result</span><span class="op" id="6212398">)</span>&nbsp;<span class="op" id="6212400">&gt;=</span>&nbsp;<span class="ident" id="6212403">n</span>&nbsp;<span class="op" id="6212405">||</span>&nbsp;<span class="builtinfunc" id="6212408">len</span><span class="op" id="6212411">(</span><span class="ident" id="6212412">indices</span><span class="op" id="6212419">)</span>&nbsp;<span class="op" id="6212421">!=</span>&nbsp;<span class="ident" id="6212424">n1</span>&nbsp;<span class="op" id="6212427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212433">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212492">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212526">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212543">if</span>&nbsp;<span class="builtinfunc" id="6212546">len</span><span class="op" id="6212549">(</span><span class="ident" id="6212550">result</span><span class="op" id="6212556">)</span>&nbsp;<span class="op" id="6212558">==</span>&nbsp;<span class="num" id="6212561">0</span>&nbsp;<span class="op" id="6212563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212568">result</span>&nbsp;<span class="op" id="6212575">=</span>&nbsp;<span class="ident" id="6212577">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212587">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212599">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212663">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212731">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212764">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212831">r</span>&nbsp;<span class="op" id="6212833">=</span>&nbsp;<span class="ident" id="6212835">regexp</span><span class="op" id="6212841">.</span><span class="ident" id="6212842">MustCompile</span><span class="op" id="6212853">(</span><span class="string" id="6212854">&#34;^&#34;</span>&nbsp;<span class="op" id="6212858">+</span>&nbsp;<span class="ident" id="6212860">r</span><span class="op" id="6212861">.</span><span class="ident" id="6212862">String</span><span class="op" id="6212868">(</span><span class="op" id="6212869">)</span><span class="op" id="6212870">)</span>&nbsp;<span class="comment" id="6212872">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212905">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212969">for</span>&nbsp;<span class="ident" id="6212973">n1</span>&nbsp;<span class="op" id="6212976">:=</span>&nbsp;<span class="ident" id="6212979">n</span><span class="op" id="6212980">;</span>&nbsp;<span class="op" id="6212982">;</span>&nbsp;<span class="ident" id="6212984">n1</span>&nbsp;<span class="op" id="6212987">+=</span>&nbsp;<span class="num" id="6212990">2</span>&nbsp;<span class="op" id="6212992">*</span>&nbsp;<span class="op" id="6212994">(</span><span class="ident" id="6212995">n</span>&nbsp;<span class="op" id="6212997">-</span>&nbsp;<span class="builtinfunc" id="6212999">len</span><span class="op" id="6213002">(</span><span class="ident" id="6213003">result</span><span class="op" id="6213009">)</span><span class="op" id="6213010">)</span>&nbsp;<span class="comment" id="6213012">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6213030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213034">indices</span>&nbsp;<span class="op" id="6213042">:=</span>&nbsp;<span class="ident" id="6213045">x</span><span class="op" id="6213046">.</span><span class="ident" id="6213047">Lookup</span><span class="op" id="6213053">(</span><span class="ident" id="6213054">lit</span><span class="op" id="6213057">,</span>&nbsp;<span class="ident" id="6213059">n1</span><span class="op" id="6213061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213065">if</span>&nbsp;<span class="builtinfunc" id="6213068">len</span><span class="op" id="6213071">(</span><span class="ident" id="6213072">indices</span><span class="op" id="6213079">)</span>&nbsp;<span class="op" id="6213081">==</span>&nbsp;<span class="num" id="6213084">0</span>&nbsp;<span class="op" id="6213086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213091">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213104">sort</span><span class="op" id="6213108">.</span><span class="ident" id="6213109">Ints</span><span class="op" id="6213113">(</span><span class="ident" id="6213114">indices</span><span class="op" id="6213121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213125">result</span>&nbsp;<span class="op" id="6213132">=</span>&nbsp;<span class="ident" id="6213134">result</span><span class="op" id="6213140">[</span><span class="num" id="6213141">0</span><span class="op" id="6213142">:</span><span class="num" id="6213143">0</span><span class="op" id="6213144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213148">prev</span>&nbsp;<span class="op" id="6213153">:=</span>&nbsp;<span class="num" id="6213156">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213160">for</span>&nbsp;<span class="ident" id="6213164">_</span><span class="op" id="6213165">,</span>&nbsp;<span class="ident" id="6213167">i</span>&nbsp;<span class="op" id="6213169">:=</span>&nbsp;<span class="keyword" id="6213172">range</span>&nbsp;<span class="ident" id="6213178">indices</span>&nbsp;<span class="op" id="6213186">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213191">if</span>&nbsp;<span class="builtinfunc" id="6213194">len</span><span class="op" id="6213197">(</span><span class="ident" id="6213198">result</span><span class="op" id="6213204">)</span>&nbsp;<span class="op" id="6213206">==</span>&nbsp;<span class="ident" id="6213209">n</span>&nbsp;<span class="op" id="6213211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213217">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213231">m</span>&nbsp;<span class="op" id="6213233">:=</span>&nbsp;<span class="ident" id="6213236">r</span><span class="op" id="6213237">.</span><span class="ident" id="6213238">FindIndex</span><span class="op" id="6213247">(</span><span class="ident" id="6213248">x</span><span class="op" id="6213249">.</span><span class="ident" id="6213250">data</span><span class="op" id="6213254">[</span><span class="ident" id="6213255">i</span><span class="op" id="6213256">:</span><span class="op" id="6213257">]</span><span class="op" id="6213258">)</span>&nbsp;<span class="comment" id="6213260">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213301">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213353">if</span>&nbsp;<span class="ident" id="6213356">m</span>&nbsp;<span class="op" id="6213358">!=</span>&nbsp;<span class="ident" id="6213361">nil</span>&nbsp;<span class="op" id="6213365">&amp;&amp;</span>&nbsp;<span class="ident" id="6213368">prev</span>&nbsp;<span class="op" id="6213373">&lt;=</span>&nbsp;<span class="ident" id="6213376">i</span>&nbsp;<span class="op" id="6213378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213384">m</span><span class="op" id="6213385">[</span><span class="num" id="6213386">0</span><span class="op" id="6213387">]</span>&nbsp;<span class="op" id="6213389">=</span>&nbsp;<span class="ident" id="6213391">i</span>&nbsp;<span class="comment" id="6213393">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213410">m</span><span class="op" id="6213411">[</span><span class="num" id="6213412">1</span><span class="op" id="6213413">]</span>&nbsp;<span class="op" id="6213415">+=</span>&nbsp;<span class="ident" id="6213418">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213424">result</span>&nbsp;<span class="op" id="6213431">=</span>&nbsp;<span class="builtinfunc" id="6213433">append</span><span class="op" id="6213439">(</span><span class="ident" id="6213440">result</span><span class="op" id="6213446">,</span>&nbsp;<span class="ident" id="6213448">m</span><span class="op" id="6213449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213455">prev</span>&nbsp;<span class="op" id="6213460">=</span>&nbsp;<span class="ident" id="6213462">m</span><span class="op" id="6213463">[</span><span class="num" id="6213464">1</span><span class="op" id="6213465">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213478">if</span>&nbsp;<span class="builtinfunc" id="6213481">len</span><span class="op" id="6213484">(</span><span class="ident" id="6213485">result</span><span class="op" id="6213491">)</span>&nbsp;<span class="op" id="6213493">&gt;=</span>&nbsp;<span class="ident" id="6213496">n</span>&nbsp;<span class="op" id="6213498">||</span>&nbsp;<span class="builtinfunc" id="6213501">len</span><span class="op" id="6213504">(</span><span class="ident" id="6213505">indices</span><span class="op" id="6213512">)</span>&nbsp;<span class="op" id="6213514">!=</span>&nbsp;<span class="ident" id="6213517">n1</span>&nbsp;<span class="op" id="6213520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213525">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213583">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213616">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213630">if</span>&nbsp;<span class="builtinfunc" id="6213633">len</span><span class="op" id="6213636">(</span><span class="ident" id="6213637">result</span><span class="op" id="6213643">)</span>&nbsp;<span class="op" id="6213645">==</span>&nbsp;<span class="num" id="6213648">0</span>&nbsp;<span class="op" id="6213650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213654">result</span>&nbsp;<span class="op" id="6213661">=</span>&nbsp;<span class="ident" id="6213663">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213671">return</span><br>
<span class="lineno"></span><span class="op" id="6213678">}</span>
</div>
</body>
</html>
