<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5466222">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5466277">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5466331">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5466382">package</span>&nbsp;<span class="ident" id="5466390">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5466397">import</span>&nbsp;<span class="string" id="5466404">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5466412">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5466488">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5466499">type</span>&nbsp;<span class="ident" id="5466504">huffmanTree</span>&nbsp;<span class="keyword" id="5466516">struct</span>&nbsp;<span class="op" id="5466523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466526">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466597">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5466670">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466726">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5466735">[</span><span class="op" id="5466736">]</span><span class="ident" id="5466737">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5466750">nextNode</span>&nbsp;<span class="builtintype" id="5466759">int</span><br>
<span class="lineno"></span><span class="op" id="5466763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5466766">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5466846">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5466926">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5466986">//</span><br>
<span class="lineno"></span><span class="comment" id="5466989">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5467066">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5467144">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5467194">type</span>&nbsp;<span class="ident" id="5467199">huffmanNode</span>&nbsp;<span class="keyword" id="5467211">struct</span>&nbsp;<span class="op" id="5467218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467221">left</span><span class="op" id="5467225">,</span>&nbsp;<span class="ident" id="5467227">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5467243">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467251">leftValue</span><span class="op" id="5467260">,</span>&nbsp;<span class="ident" id="5467262">rightValue</span>&nbsp;<span class="builtintype" id="5467273">uint16</span><br>
<span class="lineno"></span><span class="op" id="5467280">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5467283">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5467360">const</span>&nbsp;<span class="ident" id="5467366">invalidNodeValue</span>&nbsp;<span class="op" id="5467383">=</span>&nbsp;<span class="num" id="5467385">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5467393">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5467470">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5467490">func</span>&nbsp;<span class="op" id="5467495">(</span><span class="ident" id="5467496">t</span>&nbsp;<span class="op" id="5467498">*</span><span class="ident" id="5467499">huffmanTree</span><span class="op" id="5467510">)</span>&nbsp;<span class="ident" id="5467512">Decode</span><span class="op" id="5467518">(</span><span class="ident" id="5467519">br</span>&nbsp;<span class="op" id="5467522">*</span><span class="ident" id="5467523">bitReader</span><span class="op" id="5467532">)</span>&nbsp;<span class="op" id="5467534">(</span><span class="ident" id="5467535">v</span>&nbsp;<span class="builtintype" id="5467537">uint16</span><span class="op" id="5467543">)</span>&nbsp;<span class="op" id="5467545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467548">nodeIndex</span>&nbsp;<span class="op" id="5467558">:=</span>&nbsp;<span class="builtintype" id="5467561">uint16</span><span class="op" id="5467567">(</span><span class="num" id="5467568">0</span><span class="op" id="5467569">)</span>&nbsp;<span class="comment" id="5467571">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467608">for</span>&nbsp;<span class="op" id="5467612">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467616">node</span>&nbsp;<span class="op" id="5467621">:=</span>&nbsp;<span class="op" id="5467624">&amp;</span><span class="ident" id="5467625">t</span><span class="op" id="5467626">.</span><span class="ident" id="5467627">nodes</span><span class="op" id="5467632">[</span><span class="ident" id="5467633">nodeIndex</span><span class="op" id="5467642">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467646">bit</span><span class="op" id="5467649">,</span>&nbsp;<span class="ident" id="5467651">ok</span>&nbsp;<span class="op" id="5467654">:=</span>&nbsp;<span class="ident" id="5467657">br</span><span class="op" id="5467659">.</span><span class="ident" id="5467660">TryReadBit</span><span class="op" id="5467670">(</span><span class="op" id="5467671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467675">if</span>&nbsp;<span class="op" id="5467678">!</span><span class="ident" id="5467679">ok</span>&nbsp;<span class="op" id="5467682">&amp;&amp;</span>&nbsp;<span class="ident" id="5467685">br</span><span class="op" id="5467687">.</span><span class="ident" id="5467688">ReadBit</span><span class="op" id="5467695">(</span><span class="op" id="5467696">)</span>&nbsp;<span class="op" id="5467698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467703">bit</span>&nbsp;<span class="op" id="5467707">=</span>&nbsp;<span class="num" id="5467709">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467713">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467717">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467756">if</span>&nbsp;<span class="ident" id="5467759">bit</span>&nbsp;<span class="op" id="5467763">!=</span>&nbsp;<span class="num" id="5467766">0</span>&nbsp;<span class="op" id="5467768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467773">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467784">if</span>&nbsp;<span class="ident" id="5467787">node</span><span class="op" id="5467791">.</span><span class="ident" id="5467792">left</span>&nbsp;<span class="op" id="5467797">==</span>&nbsp;<span class="ident" id="5467800">invalidNodeValue</span>&nbsp;<span class="op" id="5467817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467823">return</span>&nbsp;<span class="ident" id="5467830">node</span><span class="op" id="5467834">.</span><span class="ident" id="5467835">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467853">nodeIndex</span>&nbsp;<span class="op" id="5467863">=</span>&nbsp;<span class="ident" id="5467865">node</span><span class="op" id="5467869">.</span><span class="ident" id="5467870">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467877">}</span>&nbsp;<span class="keyword" id="5467879">else</span>&nbsp;<span class="op" id="5467884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5467889">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467901">if</span>&nbsp;<span class="ident" id="5467904">node</span><span class="op" id="5467908">.</span><span class="ident" id="5467909">right</span>&nbsp;<span class="op" id="5467915">==</span>&nbsp;<span class="ident" id="5467918">invalidNodeValue</span>&nbsp;<span class="op" id="5467935">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5467941">return</span>&nbsp;<span class="ident" id="5467948">node</span><span class="op" id="5467952">.</span><span class="ident" id="5467953">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5467972">nodeIndex</span>&nbsp;<span class="op" id="5467982">=</span>&nbsp;<span class="ident" id="5467984">node</span><span class="op" id="5467988">.</span><span class="ident" id="5467989">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5467997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468000">}</span><br>
<span class="lineno">60</span><span class="op" id="5468002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5468005">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5468078">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5468141">func</span>&nbsp;<span class="ident" id="5468146">newHuffmanTree</span><span class="op" id="5468160">(</span><span class="ident" id="5468161">lengths</span>&nbsp;<span class="op" id="5468169">[</span><span class="op" id="5468170">]</span><span class="builtintype" id="5468171">uint8</span><span class="op" id="5468176">)</span>&nbsp;<span class="op" id="5468178">(</span><span class="ident" id="5468179">huffmanTree</span><span class="op" id="5468190">,</span>&nbsp;<span class="builtintype" id="5468192">error</span><span class="op" id="5468197">)</span>&nbsp;<span class="op" id="5468199">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468202">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468272">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468337">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468399">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468467">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468538">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468608">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468647">if</span>&nbsp;<span class="builtinfunc" id="5468650">len</span><span class="op" id="5468653">(</span><span class="ident" id="5468654">lengths</span><span class="op" id="5468661">)</span>&nbsp;<span class="op" id="5468663">&lt;</span>&nbsp;<span class="num" id="5468665">2</span>&nbsp;<span class="op" id="5468667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5468671">panic</span><span class="op" id="5468676">(</span><span class="string" id="5468677">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5468710">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5468713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468717">var</span>&nbsp;<span class="ident" id="5468721">t</span>&nbsp;<span class="ident" id="5468723">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468737">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5468809">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468851">pairs</span>&nbsp;<span class="op" id="5468857">:=</span>&nbsp;<span class="ident" id="5468860">huffmanSymbolLengthPairs</span><span class="op" id="5468884">(</span><span class="builtinfunc" id="5468885">make</span><span class="op" id="5468889">(</span><span class="op" id="5468890">[</span><span class="op" id="5468891">]</span><span class="ident" id="5468892">huffmanSymbolLengthPair</span><span class="op" id="5468915">,</span>&nbsp;<span class="builtinfunc" id="5468917">len</span><span class="op" id="5468920">(</span><span class="ident" id="5468921">lengths</span><span class="op" id="5468928">)</span><span class="op" id="5468929">)</span><span class="op" id="5468930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5468933">for</span>&nbsp;<span class="ident" id="5468937">i</span><span class="op" id="5468938">,</span>&nbsp;<span class="ident" id="5468940">length</span>&nbsp;<span class="op" id="5468947">:=</span>&nbsp;<span class="keyword" id="5468950">range</span>&nbsp;<span class="ident" id="5468956">lengths</span>&nbsp;<span class="op" id="5468964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468968">pairs</span><span class="op" id="5468973">[</span><span class="ident" id="5468974">i</span><span class="op" id="5468975">]</span><span class="op" id="5468976">.</span><span class="ident" id="5468977">value</span>&nbsp;<span class="op" id="5468983">=</span>&nbsp;<span class="builtintype" id="5468985">uint16</span><span class="op" id="5468991">(</span><span class="ident" id="5468992">i</span><span class="op" id="5468993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5468997">pairs</span><span class="op" id="5469002">[</span><span class="ident" id="5469003">i</span><span class="op" id="5469004">]</span><span class="op" id="5469005">.</span><span class="ident" id="5469006">length</span>&nbsp;<span class="op" id="5469013">=</span>&nbsp;<span class="ident" id="5469015">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469027">sort</span><span class="op" id="5469031">.</span><span class="ident" id="5469032">Sort</span><span class="op" id="5469036">(</span><span class="ident" id="5469037">pairs</span><span class="op" id="5469042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469046">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469118">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469191">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469263">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469284">code</span>&nbsp;<span class="op" id="5469289">:=</span>&nbsp;<span class="builtintype" id="5469292">uint32</span><span class="op" id="5469298">(</span><span class="num" id="5469299">0</span><span class="op" id="5469300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469303">length</span>&nbsp;<span class="op" id="5469310">:=</span>&nbsp;<span class="builtintype" id="5469313">uint8</span><span class="op" id="5469318">(</span><span class="num" id="5469319">32</span><span class="op" id="5469321">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469325">codes</span>&nbsp;<span class="op" id="5469331">:=</span>&nbsp;<span class="ident" id="5469334">huffmanCodes</span><span class="op" id="5469346">(</span><span class="builtinfunc" id="5469347">make</span><span class="op" id="5469351">(</span><span class="op" id="5469352">[</span><span class="op" id="5469353">]</span><span class="ident" id="5469354">huffmanCode</span><span class="op" id="5469365">,</span>&nbsp;<span class="builtinfunc" id="5469367">len</span><span class="op" id="5469370">(</span><span class="ident" id="5469371">lengths</span><span class="op" id="5469378">)</span><span class="op" id="5469379">)</span><span class="op" id="5469380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469383">for</span>&nbsp;<span class="ident" id="5469387">i</span>&nbsp;<span class="op" id="5469389">:=</span>&nbsp;<span class="builtinfunc" id="5469392">len</span><span class="op" id="5469395">(</span><span class="ident" id="5469396">pairs</span><span class="op" id="5469401">)</span>&nbsp;<span class="op" id="5469403">-</span>&nbsp;<span class="num" id="5469405">1</span><span class="op" id="5469406">;</span>&nbsp;<span class="ident" id="5469408">i</span>&nbsp;<span class="op" id="5469410">&gt;=</span>&nbsp;<span class="num" id="5469413">0</span><span class="op" id="5469414">;</span>&nbsp;<span class="ident" id="5469416">i</span><span class="op" id="5469417">--</span>&nbsp;<span class="op" id="5469420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5469424">if</span>&nbsp;<span class="ident" id="5469427">length</span>&nbsp;<span class="op" id="5469434">&gt;</span>&nbsp;<span class="ident" id="5469436">pairs</span><span class="op" id="5469441">[</span><span class="ident" id="5469442">i</span><span class="op" id="5469443">]</span><span class="op" id="5469444">.</span><span class="ident" id="5469445">length</span>&nbsp;<span class="op" id="5469452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469457">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469513">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469561">length</span>&nbsp;<span class="op" id="5469568">&gt;&gt;=</span>&nbsp;<span class="num" id="5469572">32</span>&nbsp;<span class="op" id="5469575">-</span>&nbsp;<span class="ident" id="5469577">pairs</span><span class="op" id="5469582">[</span><span class="ident" id="5469583">i</span><span class="op" id="5469584">]</span><span class="op" id="5469585">.</span><span class="ident" id="5469586">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469596">length</span>&nbsp;<span class="op" id="5469603">&lt;&lt;=</span>&nbsp;<span class="num" id="5469607">32</span>&nbsp;<span class="op" id="5469610">-</span>&nbsp;<span class="ident" id="5469612">pairs</span><span class="op" id="5469617">[</span><span class="ident" id="5469618">i</span><span class="op" id="5469619">]</span><span class="op" id="5469620">.</span><span class="ident" id="5469621">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469631">length</span>&nbsp;<span class="op" id="5469638">=</span>&nbsp;<span class="ident" id="5469640">pairs</span><span class="op" id="5469645">[</span><span class="ident" id="5469646">i</span><span class="op" id="5469647">]</span><span class="op" id="5469648">.</span><span class="ident" id="5469649">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469658">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469662">codes</span><span class="op" id="5469667">[</span><span class="ident" id="5469668">i</span><span class="op" id="5469669">]</span><span class="op" id="5469670">.</span><span class="ident" id="5469671">code</span>&nbsp;<span class="op" id="5469676">=</span>&nbsp;<span class="ident" id="5469678">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469685">codes</span><span class="op" id="5469690">[</span><span class="ident" id="5469691">i</span><span class="op" id="5469692">]</span><span class="op" id="5469693">.</span><span class="ident" id="5469694">codeLen</span>&nbsp;<span class="op" id="5469702">=</span>&nbsp;<span class="ident" id="5469704">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469713">codes</span><span class="op" id="5469718">[</span><span class="ident" id="5469719">i</span><span class="op" id="5469720">]</span><span class="op" id="5469721">.</span><span class="ident" id="5469722">value</span>&nbsp;<span class="op" id="5469728">=</span>&nbsp;<span class="ident" id="5469730">pairs</span><span class="op" id="5469735">[</span><span class="ident" id="5469736">i</span><span class="op" id="5469737">]</span><span class="op" id="5469738">.</span><span class="ident" id="5469739">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469747">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469813">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469846">code</span>&nbsp;<span class="op" id="5469851">+=</span>&nbsp;<span class="num" id="5469854">1</span>&nbsp;<span class="op" id="5469856">&lt;&lt;</span>&nbsp;<span class="op" id="5469859">(</span><span class="num" id="5469860">32</span>&nbsp;<span class="op" id="5469863">-</span>&nbsp;<span class="ident" id="5469865">length</span><span class="op" id="5469871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5469874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469878">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5469951">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5469986">sort</span><span class="op" id="5469990">.</span><span class="ident" id="5469991">Sort</span><span class="op" id="5469995">(</span><span class="ident" id="5469996">codes</span><span class="op" id="5470001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470005">t</span><span class="op" id="5470006">.</span><span class="ident" id="5470007">nodes</span>&nbsp;<span class="op" id="5470013">=</span>&nbsp;<span class="builtinfunc" id="5470015">make</span><span class="op" id="5470019">(</span><span class="op" id="5470020">[</span><span class="op" id="5470021">]</span><span class="ident" id="5470022">huffmanNode</span><span class="op" id="5470033">,</span>&nbsp;<span class="builtinfunc" id="5470035">len</span><span class="op" id="5470038">(</span><span class="ident" id="5470039">codes</span><span class="op" id="5470044">)</span><span class="op" id="5470045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470048">_</span><span class="op" id="5470049">,</span>&nbsp;<span class="ident" id="5470051">err</span>&nbsp;<span class="op" id="5470055">:=</span>&nbsp;<span class="ident" id="5470058">buildHuffmanNode</span><span class="op" id="5470074">(</span><span class="op" id="5470075">&amp;</span><span class="ident" id="5470076">t</span><span class="op" id="5470077">,</span>&nbsp;<span class="ident" id="5470079">codes</span><span class="op" id="5470084">,</span>&nbsp;<span class="num" id="5470086">0</span><span class="op" id="5470087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470090">return</span>&nbsp;<span class="ident" id="5470097">t</span><span class="op" id="5470098">,</span>&nbsp;<span class="ident" id="5470100">err</span><br>
<span class="lineno">120</span><span class="op" id="5470104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470107">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5470173">type</span>&nbsp;<span class="ident" id="5470178">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5470202">struct</span>&nbsp;<span class="op" id="5470209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470212">value</span>&nbsp;&nbsp;<span class="builtintype" id="5470219">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470227">length</span>&nbsp;<span class="builtintype" id="5470234">uint8</span><br>
<span class="lineno"></span><span class="op" id="5470240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470243">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5470315">type</span>&nbsp;<span class="ident" id="5470320">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5470345">[</span><span class="op" id="5470346">]</span><span class="ident" id="5470347">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5470372">func</span>&nbsp;<span class="op" id="5470377">(</span><span class="ident" id="5470378">h</span>&nbsp;<span class="ident" id="5470380">huffmanSymbolLengthPairs</span><span class="op" id="5470404">)</span>&nbsp;<span class="ident" id="5470406">Len</span><span class="op" id="5470409">(</span><span class="op" id="5470410">)</span>&nbsp;<span class="builtintype" id="5470412">int</span>&nbsp;<span class="op" id="5470416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470419">return</span>&nbsp;<span class="builtinfunc" id="5470426">len</span><span class="op" id="5470429">(</span><span class="ident" id="5470430">h</span><span class="op" id="5470431">)</span><br>
<span class="lineno"></span><span class="op" id="5470433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5470436">func</span>&nbsp;<span class="op" id="5470441">(</span><span class="ident" id="5470442">h</span>&nbsp;<span class="ident" id="5470444">huffmanSymbolLengthPairs</span><span class="op" id="5470468">)</span>&nbsp;<span class="ident" id="5470470">Less</span><span class="op" id="5470474">(</span><span class="ident" id="5470475">i</span><span class="op" id="5470476">,</span>&nbsp;<span class="ident" id="5470478">j</span>&nbsp;<span class="builtintype" id="5470480">int</span><span class="op" id="5470483">)</span>&nbsp;<span class="builtintype" id="5470485">bool</span>&nbsp;<span class="op" id="5470490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470493">if</span>&nbsp;<span class="ident" id="5470496">h</span><span class="op" id="5470497">[</span><span class="ident" id="5470498">i</span><span class="op" id="5470499">]</span><span class="op" id="5470500">.</span><span class="ident" id="5470501">length</span>&nbsp;<span class="op" id="5470508">&lt;</span>&nbsp;<span class="ident" id="5470510">h</span><span class="op" id="5470511">[</span><span class="ident" id="5470512">j</span><span class="op" id="5470513">]</span><span class="op" id="5470514">.</span><span class="ident" id="5470515">length</span>&nbsp;<span class="op" id="5470522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470526">return</span>&nbsp;<span class="ident" id="5470533">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470542">if</span>&nbsp;<span class="ident" id="5470545">h</span><span class="op" id="5470546">[</span><span class="ident" id="5470547">i</span><span class="op" id="5470548">]</span><span class="op" id="5470549">.</span><span class="ident" id="5470550">length</span>&nbsp;<span class="op" id="5470557">&gt;</span>&nbsp;<span class="ident" id="5470559">h</span><span class="op" id="5470560">[</span><span class="ident" id="5470561">j</span><span class="op" id="5470562">]</span><span class="op" id="5470563">.</span><span class="ident" id="5470564">length</span>&nbsp;<span class="op" id="5470571">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470575">return</span>&nbsp;<span class="ident" id="5470582">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470592">if</span>&nbsp;<span class="ident" id="5470595">h</span><span class="op" id="5470596">[</span><span class="ident" id="5470597">i</span><span class="op" id="5470598">]</span><span class="op" id="5470599">.</span><span class="ident" id="5470600">value</span>&nbsp;<span class="op" id="5470606">&lt;</span>&nbsp;<span class="ident" id="5470608">h</span><span class="op" id="5470609">[</span><span class="ident" id="5470610">j</span><span class="op" id="5470611">]</span><span class="op" id="5470612">.</span><span class="ident" id="5470613">value</span>&nbsp;<span class="op" id="5470619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470623">return</span>&nbsp;<span class="ident" id="5470630">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5470636">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470639">return</span>&nbsp;<span class="ident" id="5470646">false</span><br>
<span class="lineno"></span><span class="op" id="5470652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5470655">func</span>&nbsp;<span class="op" id="5470660">(</span><span class="ident" id="5470661">h</span>&nbsp;<span class="ident" id="5470663">huffmanSymbolLengthPairs</span><span class="op" id="5470687">)</span>&nbsp;<span class="ident" id="5470689">Swap</span><span class="op" id="5470693">(</span><span class="ident" id="5470694">i</span><span class="op" id="5470695">,</span>&nbsp;<span class="ident" id="5470697">j</span>&nbsp;<span class="builtintype" id="5470699">int</span><span class="op" id="5470702">)</span>&nbsp;<span class="op" id="5470704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470707">h</span><span class="op" id="5470708">[</span><span class="ident" id="5470709">i</span><span class="op" id="5470710">]</span><span class="op" id="5470711">,</span>&nbsp;<span class="ident" id="5470713">h</span><span class="op" id="5470714">[</span><span class="ident" id="5470715">j</span><span class="op" id="5470716">]</span>&nbsp;<span class="op" id="5470718">=</span>&nbsp;<span class="ident" id="5470720">h</span><span class="op" id="5470721">[</span><span class="ident" id="5470722">j</span><span class="op" id="5470723">]</span><span class="op" id="5470724">,</span>&nbsp;<span class="ident" id="5470726">h</span><span class="op" id="5470727">[</span><span class="ident" id="5470728">i</span><span class="op" id="5470729">]</span><br>
<span class="lineno">150</span><span class="op" id="5470731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470734">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5470794">type</span>&nbsp;<span class="ident" id="5470799">huffmanCode</span>&nbsp;<span class="keyword" id="5470811">struct</span>&nbsp;<span class="op" id="5470818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470821">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5470829">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470837">codeLen</span>&nbsp;<span class="builtintype" id="5470845">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5470852">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5470860">uint16</span><br>
<span class="lineno"></span><span class="op" id="5470867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5470870">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5470931">type</span>&nbsp;<span class="ident" id="5470936">huffmanCodes</span>&nbsp;<span class="op" id="5470949">[</span><span class="op" id="5470950">]</span><span class="ident" id="5470951">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5470964">func</span>&nbsp;<span class="op" id="5470969">(</span><span class="ident" id="5470970">n</span>&nbsp;<span class="ident" id="5470972">huffmanCodes</span><span class="op" id="5470984">)</span>&nbsp;<span class="ident" id="5470986">Len</span><span class="op" id="5470989">(</span><span class="op" id="5470990">)</span>&nbsp;<span class="builtintype" id="5470992">int</span>&nbsp;<span class="op" id="5470996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5470999">return</span>&nbsp;<span class="builtinfunc" id="5471006">len</span><span class="op" id="5471009">(</span><span class="ident" id="5471010">n</span><span class="op" id="5471011">)</span><br>
<span class="lineno"></span><span class="op" id="5471013">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5471016">func</span>&nbsp;<span class="op" id="5471021">(</span><span class="ident" id="5471022">n</span>&nbsp;<span class="ident" id="5471024">huffmanCodes</span><span class="op" id="5471036">)</span>&nbsp;<span class="ident" id="5471038">Less</span><span class="op" id="5471042">(</span><span class="ident" id="5471043">i</span><span class="op" id="5471044">,</span>&nbsp;<span class="ident" id="5471046">j</span>&nbsp;<span class="builtintype" id="5471048">int</span><span class="op" id="5471051">)</span>&nbsp;<span class="builtintype" id="5471053">bool</span>&nbsp;<span class="op" id="5471058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471061">return</span>&nbsp;<span class="ident" id="5471068">n</span><span class="op" id="5471069">[</span><span class="ident" id="5471070">i</span><span class="op" id="5471071">]</span><span class="op" id="5471072">.</span><span class="ident" id="5471073">code</span>&nbsp;<span class="op" id="5471078">&lt;</span>&nbsp;<span class="ident" id="5471080">n</span><span class="op" id="5471081">[</span><span class="ident" id="5471082">j</span><span class="op" id="5471083">]</span><span class="op" id="5471084">.</span><span class="ident" id="5471085">code</span><br>
<span class="lineno"></span><span class="op" id="5471090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5471093">func</span>&nbsp;<span class="op" id="5471098">(</span><span class="ident" id="5471099">n</span>&nbsp;<span class="ident" id="5471101">huffmanCodes</span><span class="op" id="5471113">)</span>&nbsp;<span class="ident" id="5471115">Swap</span><span class="op" id="5471119">(</span><span class="ident" id="5471120">i</span><span class="op" id="5471121">,</span>&nbsp;<span class="ident" id="5471123">j</span>&nbsp;<span class="builtintype" id="5471125">int</span><span class="op" id="5471128">)</span>&nbsp;<span class="op" id="5471130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471133">n</span><span class="op" id="5471134">[</span><span class="ident" id="5471135">i</span><span class="op" id="5471136">]</span><span class="op" id="5471137">,</span>&nbsp;<span class="ident" id="5471139">n</span><span class="op" id="5471140">[</span><span class="ident" id="5471141">j</span><span class="op" id="5471142">]</span>&nbsp;<span class="op" id="5471144">=</span>&nbsp;<span class="ident" id="5471146">n</span><span class="op" id="5471147">[</span><span class="ident" id="5471148">j</span><span class="op" id="5471149">]</span><span class="op" id="5471150">,</span>&nbsp;<span class="ident" id="5471152">n</span><span class="op" id="5471153">[</span><span class="ident" id="5471154">i</span><span class="op" id="5471155">]</span><br>
<span class="lineno"></span><span class="op" id="5471157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5471160">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5471238">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5471312">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5471333">func</span>&nbsp;<span class="ident" id="5471338">buildHuffmanNode</span><span class="op" id="5471354">(</span><span class="ident" id="5471355">t</span>&nbsp;<span class="op" id="5471357">*</span><span class="ident" id="5471358">huffmanTree</span><span class="op" id="5471369">,</span>&nbsp;<span class="ident" id="5471371">codes</span>&nbsp;<span class="op" id="5471377">[</span><span class="op" id="5471378">]</span><span class="ident" id="5471379">huffmanCode</span><span class="op" id="5471390">,</span>&nbsp;<span class="ident" id="5471392">level</span>&nbsp;<span class="builtintype" id="5471398">uint32</span><span class="op" id="5471404">)</span>&nbsp;<span class="op" id="5471406">(</span><span class="ident" id="5471407">nodeIndex</span>&nbsp;<span class="builtintype" id="5471417">uint16</span><span class="op" id="5471423">,</span>&nbsp;<span class="ident" id="5471425">err</span>&nbsp;<span class="builtintype" id="5471429">error</span><span class="op" id="5471434">)</span>&nbsp;<span class="op" id="5471436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471439">test</span>&nbsp;<span class="op" id="5471444">:=</span>&nbsp;<span class="builtintype" id="5471447">uint32</span><span class="op" id="5471453">(</span><span class="num" id="5471454">1</span><span class="op" id="5471455">)</span>&nbsp;<span class="op" id="5471457">&lt;&lt;</span>&nbsp;<span class="op" id="5471460">(</span><span class="num" id="5471461">31</span>&nbsp;<span class="op" id="5471464">-</span>&nbsp;<span class="ident" id="5471466">level</span><span class="op" id="5471471">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471475">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471568">firstRightIndex</span>&nbsp;<span class="op" id="5471584">:=</span>&nbsp;<span class="builtinfunc" id="5471587">len</span><span class="op" id="5471590">(</span><span class="ident" id="5471591">codes</span><span class="op" id="5471596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471599">for</span>&nbsp;<span class="ident" id="5471603">i</span><span class="op" id="5471604">,</span>&nbsp;<span class="ident" id="5471606">code</span>&nbsp;<span class="op" id="5471611">:=</span>&nbsp;<span class="keyword" id="5471614">range</span>&nbsp;<span class="ident" id="5471620">codes</span>&nbsp;<span class="op" id="5471626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471630">if</span>&nbsp;<span class="ident" id="5471633">code</span><span class="op" id="5471637">.</span><span class="ident" id="5471638">code</span><span class="op" id="5471642">&amp;</span><span class="ident" id="5471643">test</span>&nbsp;<span class="op" id="5471648">!=</span>&nbsp;<span class="num" id="5471651">0</span>&nbsp;<span class="op" id="5471653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471658">firstRightIndex</span>&nbsp;<span class="op" id="5471674">=</span>&nbsp;<span class="ident" id="5471676">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471681">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5471692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471696">left</span>&nbsp;<span class="op" id="5471701">:=</span>&nbsp;<span class="ident" id="5471704">codes</span><span class="op" id="5471709">[</span><span class="op" id="5471710">:</span><span class="ident" id="5471711">firstRightIndex</span><span class="op" id="5471726">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5471729">right</span>&nbsp;<span class="op" id="5471735">:=</span>&nbsp;<span class="ident" id="5471738">codes</span><span class="op" id="5471743">[</span><span class="ident" id="5471744">firstRightIndex</span><span class="op" id="5471759">:</span><span class="op" id="5471760">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5471764">if</span>&nbsp;<span class="builtinfunc" id="5471767">len</span><span class="op" id="5471770">(</span><span class="ident" id="5471771">left</span><span class="op" id="5471775">)</span>&nbsp;<span class="op" id="5471777">==</span>&nbsp;<span class="num" id="5471780">0</span>&nbsp;<span class="op" id="5471782">||</span>&nbsp;<span class="builtinfunc" id="5471785">len</span><span class="op" id="5471788">(</span><span class="ident" id="5471789">right</span><span class="op" id="5471794">)</span>&nbsp;<span class="op" id="5471796">==</span>&nbsp;<span class="num" id="5471799">0</span>&nbsp;<span class="op" id="5471801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471805">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471870">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471936">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5471968">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472031">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472094">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472142">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472147">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472212">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472278">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472340">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472395">if</span>&nbsp;<span class="builtinfunc" id="5472398">len</span><span class="op" id="5472401">(</span><span class="ident" id="5472402">codes</span><span class="op" id="5472407">)</span>&nbsp;<span class="op" id="5472409">&lt;</span>&nbsp;<span class="num" id="5472411">2</span>&nbsp;<span class="op" id="5472413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472418">return</span>&nbsp;<span class="num" id="5472425">0</span><span class="op" id="5472426">,</span>&nbsp;<span class="ident" id="5472428">StructuralError</span><span class="op" id="5472443">(</span><span class="string" id="5472444">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5472464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472473">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472538">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472597">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472613">if</span>&nbsp;<span class="ident" id="5472616">level</span>&nbsp;<span class="op" id="5472622">==</span>&nbsp;<span class="num" id="5472625">31</span>&nbsp;<span class="op" id="5472628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472633">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472690">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472749">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5472800">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472826">return</span>&nbsp;<span class="num" id="5472833">0</span><span class="op" id="5472834">,</span>&nbsp;<span class="ident" id="5472836">StructuralError</span><span class="op" id="5472851">(</span><span class="string" id="5472852">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5472883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472892">if</span>&nbsp;<span class="builtinfunc" id="5472895">len</span><span class="op" id="5472898">(</span><span class="ident" id="5472899">left</span><span class="op" id="5472903">)</span>&nbsp;<span class="op" id="5472905">==</span>&nbsp;<span class="num" id="5472908">0</span>&nbsp;<span class="op" id="5472910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472915">return</span>&nbsp;<span class="ident" id="5472922">buildHuffmanNode</span><span class="op" id="5472938">(</span><span class="ident" id="5472939">t</span><span class="op" id="5472940">,</span>&nbsp;<span class="ident" id="5472942">right</span><span class="op" id="5472947">,</span>&nbsp;<span class="ident" id="5472949">level</span><span class="op" id="5472954">+</span><span class="num" id="5472955">1</span><span class="op" id="5472956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5472960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5472964">return</span>&nbsp;<span class="ident" id="5472971">buildHuffmanNode</span><span class="op" id="5472987">(</span><span class="ident" id="5472988">t</span><span class="op" id="5472989">,</span>&nbsp;<span class="ident" id="5472991">left</span><span class="op" id="5472995">,</span>&nbsp;<span class="ident" id="5472997">level</span><span class="op" id="5473002">+</span><span class="num" id="5473003">1</span><span class="op" id="5473004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473007">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473011">nodeIndex</span>&nbsp;<span class="op" id="5473021">=</span>&nbsp;<span class="builtintype" id="5473023">uint16</span><span class="op" id="5473029">(</span><span class="ident" id="5473030">t</span><span class="op" id="5473031">.</span><span class="ident" id="5473032">nextNode</span><span class="op" id="5473040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473043">node</span>&nbsp;<span class="op" id="5473048">:=</span>&nbsp;<span class="op" id="5473051">&amp;</span><span class="ident" id="5473052">t</span><span class="op" id="5473053">.</span><span class="ident" id="5473054">nodes</span><span class="op" id="5473059">[</span><span class="ident" id="5473060">t</span><span class="op" id="5473061">.</span><span class="ident" id="5473062">nextNode</span><span class="op" id="5473070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473073">t</span><span class="op" id="5473074">.</span><span class="ident" id="5473075">nextNode</span><span class="op" id="5473083">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473088">if</span>&nbsp;<span class="builtinfunc" id="5473091">len</span><span class="op" id="5473094">(</span><span class="ident" id="5473095">left</span><span class="op" id="5473099">)</span>&nbsp;<span class="op" id="5473101">==</span>&nbsp;<span class="num" id="5473104">1</span>&nbsp;<span class="op" id="5473106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473110">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473125">node</span><span class="op" id="5473129">.</span><span class="ident" id="5473130">left</span>&nbsp;<span class="op" id="5473135">=</span>&nbsp;<span class="ident" id="5473137">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473156">node</span><span class="op" id="5473160">.</span><span class="ident" id="5473161">leftValue</span>&nbsp;<span class="op" id="5473171">=</span>&nbsp;<span class="ident" id="5473173">left</span><span class="op" id="5473177">[</span><span class="num" id="5473178">0</span><span class="op" id="5473179">]</span><span class="op" id="5473180">.</span><span class="ident" id="5473181">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473188">}</span>&nbsp;<span class="keyword" id="5473190">else</span>&nbsp;<span class="op" id="5473195">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473199">node</span><span class="op" id="5473203">.</span><span class="ident" id="5473204">left</span><span class="op" id="5473208">,</span>&nbsp;<span class="ident" id="5473210">err</span>&nbsp;<span class="op" id="5473214">=</span>&nbsp;<span class="ident" id="5473216">buildHuffmanNode</span><span class="op" id="5473232">(</span><span class="ident" id="5473233">t</span><span class="op" id="5473234">,</span>&nbsp;<span class="ident" id="5473236">left</span><span class="op" id="5473240">,</span>&nbsp;<span class="ident" id="5473242">level</span><span class="op" id="5473247">+</span><span class="num" id="5473248">1</span><span class="op" id="5473249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473256">if</span>&nbsp;<span class="ident" id="5473259">err</span>&nbsp;<span class="op" id="5473263">!=</span>&nbsp;<span class="ident" id="5473266">nil</span>&nbsp;<span class="op" id="5473270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473274">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473286">if</span>&nbsp;<span class="builtinfunc" id="5473289">len</span><span class="op" id="5473292">(</span><span class="ident" id="5473293">right</span><span class="op" id="5473298">)</span>&nbsp;<span class="op" id="5473300">==</span>&nbsp;<span class="num" id="5473303">1</span>&nbsp;<span class="op" id="5473305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5473309">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473324">node</span><span class="op" id="5473328">.</span><span class="ident" id="5473329">right</span>&nbsp;<span class="op" id="5473335">=</span>&nbsp;<span class="ident" id="5473337">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473356">node</span><span class="op" id="5473360">.</span><span class="ident" id="5473361">rightValue</span>&nbsp;<span class="op" id="5473372">=</span>&nbsp;<span class="ident" id="5473374">right</span><span class="op" id="5473379">[</span><span class="num" id="5473380">0</span><span class="op" id="5473381">]</span><span class="op" id="5473382">.</span><span class="ident" id="5473383">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473390">}</span>&nbsp;<span class="keyword" id="5473392">else</span>&nbsp;<span class="op" id="5473397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5473401">node</span><span class="op" id="5473405">.</span><span class="ident" id="5473406">right</span><span class="op" id="5473411">,</span>&nbsp;<span class="ident" id="5473413">err</span>&nbsp;<span class="op" id="5473417">=</span>&nbsp;<span class="ident" id="5473419">buildHuffmanNode</span><span class="op" id="5473435">(</span><span class="ident" id="5473436">t</span><span class="op" id="5473437">,</span>&nbsp;<span class="ident" id="5473439">right</span><span class="op" id="5473444">,</span>&nbsp;<span class="ident" id="5473446">level</span><span class="op" id="5473451">+</span><span class="num" id="5473452">1</span><span class="op" id="5473453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5473456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5473460">return</span><br>
<span class="lineno"></span><span class="op" id="5473467">}</span>
</div>
</body>
</html>
