<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html" class="current">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4669551">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4669606">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4669660">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4669711">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="4669786">package</span>&nbsp;<span class="ident" id="4669794">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4669800">import</span>&nbsp;<span class="op" id="4669807">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4669810">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4669820">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4669827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4669830">func</span>&nbsp;<span class="ident" id="4669835">init</span><span class="op" id="4669839">(</span><span class="op" id="4669840">)</span>&nbsp;<span class="op" id="4669842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4669845">crypto</span><span class="op" id="4669851">.</span><span class="ident" id="4669852">RegisterHash</span><span class="op" id="4669864">(</span><span class="ident" id="4669865">crypto</span><span class="op" id="4669871">.</span><span class="ident" id="4669872">SHA1</span><span class="op" id="4669876">,</span>&nbsp;<span class="ident" id="4669878">New</span><span class="op" id="4669881">)</span><br>
<span class="lineno">15</span><span class="op" id="4669883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4669886">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4669927">const</span>&nbsp;<span class="ident" id="4669933">Size</span>&nbsp;<span class="op" id="4669938">=</span>&nbsp;<span class="num" id="4669940">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4669944">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4669979">const</span>&nbsp;<span class="ident" id="4669985">BlockSize</span>&nbsp;<span class="op" id="4669995">=</span>&nbsp;<span class="num" id="4669997">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4670001">const</span>&nbsp;<span class="op" id="4670007">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670010">chunk</span>&nbsp;<span class="op" id="4670016">=</span>&nbsp;<span class="num" id="4670018">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670022">init0</span>&nbsp;<span class="op" id="4670028">=</span>&nbsp;<span class="num" id="4670030">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670042">init1</span>&nbsp;<span class="op" id="4670048">=</span>&nbsp;<span class="num" id="4670050">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670062">init2</span>&nbsp;<span class="op" id="4670068">=</span>&nbsp;<span class="num" id="4670070">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670082">init3</span>&nbsp;<span class="op" id="4670088">=</span>&nbsp;<span class="num" id="4670090">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670102">init4</span>&nbsp;<span class="op" id="4670108">=</span>&nbsp;<span class="num" id="4670110">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="4670121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4670124">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4670183">type</span>&nbsp;<span class="ident" id="4670188">digest</span>&nbsp;<span class="keyword" id="4670195">struct</span>&nbsp;<span class="op" id="4670202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670205">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4670209">[</span><span class="num" id="4670210">5</span><span class="op" id="4670211">]</span><span class="builtintype" id="4670212">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670220">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4670224">[</span><span class="ident" id="4670225">chunk</span><span class="op" id="4670230">]</span><span class="builtintype" id="4670231">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670237">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4670241">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4670246">len</span>&nbsp;<span class="ident" id="4670250">uint64</span><br>
<span class="lineno"></span><span class="op" id="4670257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4670260">func</span>&nbsp;<span class="op" id="4670265">(</span><span class="ident" id="4670266">d</span>&nbsp;<span class="op" id="4670268">*</span><span class="ident" id="4670269">digest</span><span class="op" id="4670275">)</span>&nbsp;<span class="ident" id="4670277">Reset</span><span class="op" id="4670282">(</span><span class="op" id="4670283">)</span>&nbsp;<span class="op" id="4670285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670288">d</span><span class="op" id="4670289">.</span><span class="ident" id="4670290">h</span><span class="op" id="4670291">[</span><span class="num" id="4670292">0</span><span class="op" id="4670293">]</span>&nbsp;<span class="op" id="4670295">=</span>&nbsp;<span class="ident" id="4670297">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670304">d</span><span class="op" id="4670305">.</span><span class="ident" id="4670306">h</span><span class="op" id="4670307">[</span><span class="num" id="4670308">1</span><span class="op" id="4670309">]</span>&nbsp;<span class="op" id="4670311">=</span>&nbsp;<span class="ident" id="4670313">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670320">d</span><span class="op" id="4670321">.</span><span class="ident" id="4670322">h</span><span class="op" id="4670323">[</span><span class="num" id="4670324">2</span><span class="op" id="4670325">]</span>&nbsp;<span class="op" id="4670327">=</span>&nbsp;<span class="ident" id="4670329">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670336">d</span><span class="op" id="4670337">.</span><span class="ident" id="4670338">h</span><span class="op" id="4670339">[</span><span class="num" id="4670340">3</span><span class="op" id="4670341">]</span>&nbsp;<span class="op" id="4670343">=</span>&nbsp;<span class="ident" id="4670345">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670352">d</span><span class="op" id="4670353">.</span><span class="ident" id="4670354">h</span><span class="op" id="4670355">[</span><span class="num" id="4670356">4</span><span class="op" id="4670357">]</span>&nbsp;<span class="op" id="4670359">=</span>&nbsp;<span class="ident" id="4670361">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670368">d</span><span class="op" id="4670369">.</span><span class="ident" id="4670370">nx</span>&nbsp;<span class="op" id="4670373">=</span>&nbsp;<span class="num" id="4670375">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670378">d</span><span class="op" id="4670379">.</span><span class="builtinfunc" id="4670380">len</span>&nbsp;<span class="op" id="4670384">=</span>&nbsp;<span class="num" id="4670386">0</span><br>
<span class="lineno"></span><span class="op" id="4670388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4670391">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4670451">func</span>&nbsp;<span class="ident" id="4670456">New</span><span class="op" id="4670459">(</span><span class="op" id="4670460">)</span>&nbsp;<span class="ident" id="4670462">hash</span><span class="op" id="4670466">.</span><span class="ident" id="4670467">Hash</span>&nbsp;<span class="op" id="4670472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670475">d</span>&nbsp;<span class="op" id="4670477">:=</span>&nbsp;<span class="builtinfunc" id="4670480">new</span><span class="op" id="4670483">(</span><span class="ident" id="4670484">digest</span><span class="op" id="4670490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670493">d</span><span class="op" id="4670494">.</span><span class="ident" id="4670495">Reset</span><span class="op" id="4670500">(</span><span class="op" id="4670501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670504">return</span>&nbsp;<span class="ident" id="4670511">d</span><br>
<span class="lineno">55</span><span class="op" id="4670513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4670516">func</span>&nbsp;<span class="op" id="4670521">(</span><span class="ident" id="4670522">d</span>&nbsp;<span class="op" id="4670524">*</span><span class="ident" id="4670525">digest</span><span class="op" id="4670531">)</span>&nbsp;<span class="ident" id="4670533">Size</span><span class="op" id="4670537">(</span><span class="op" id="4670538">)</span>&nbsp;<span class="builtintype" id="4670540">int</span>&nbsp;<span class="op" id="4670544">{</span>&nbsp;<span class="keyword" id="4670546">return</span>&nbsp;<span class="ident" id="4670553">Size</span>&nbsp;<span class="op" id="4670558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4670561">func</span>&nbsp;<span class="op" id="4670566">(</span><span class="ident" id="4670567">d</span>&nbsp;<span class="op" id="4670569">*</span><span class="ident" id="4670570">digest</span><span class="op" id="4670576">)</span>&nbsp;<span class="ident" id="4670578">BlockSize</span><span class="op" id="4670587">(</span><span class="op" id="4670588">)</span>&nbsp;<span class="builtintype" id="4670590">int</span>&nbsp;<span class="op" id="4670594">{</span>&nbsp;<span class="keyword" id="4670596">return</span>&nbsp;<span class="ident" id="4670603">BlockSize</span>&nbsp;<span class="op" id="4670613">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4670616">func</span>&nbsp;<span class="op" id="4670621">(</span><span class="ident" id="4670622">d</span>&nbsp;<span class="op" id="4670624">*</span><span class="ident" id="4670625">digest</span><span class="op" id="4670631">)</span>&nbsp;<span class="ident" id="4670633">Write</span><span class="op" id="4670638">(</span><span class="ident" id="4670639">p</span>&nbsp;<span class="op" id="4670641">[</span><span class="op" id="4670642">]</span><span class="builtintype" id="4670643">byte</span><span class="op" id="4670647">)</span>&nbsp;<span class="op" id="4670649">(</span><span class="ident" id="4670650">nn</span>&nbsp;<span class="builtintype" id="4670653">int</span><span class="op" id="4670656">,</span>&nbsp;<span class="ident" id="4670658">err</span>&nbsp;<span class="builtintype" id="4670662">error</span><span class="op" id="4670667">)</span>&nbsp;<span class="op" id="4670669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670672">nn</span>&nbsp;<span class="op" id="4670675">=</span>&nbsp;<span class="builtinfunc" id="4670677">len</span><span class="op" id="4670680">(</span><span class="ident" id="4670681">p</span><span class="op" id="4670682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670685">d</span><span class="op" id="4670686">.</span><span class="builtinfunc" id="4670687">len</span>&nbsp;<span class="op" id="4670691">+=</span>&nbsp;<span class="ident" id="4670694">uint64</span><span class="op" id="4670700">(</span><span class="ident" id="4670701">nn</span><span class="op" id="4670703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670706">if</span>&nbsp;<span class="ident" id="4670709">d</span><span class="op" id="4670710">.</span><span class="ident" id="4670711">nx</span>&nbsp;<span class="op" id="4670714">&gt;</span>&nbsp;<span class="num" id="4670716">0</span>&nbsp;<span class="op" id="4670718">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670722">n</span>&nbsp;<span class="op" id="4670724">:=</span>&nbsp;<span class="builtinfunc" id="4670727">copy</span><span class="op" id="4670731">(</span><span class="ident" id="4670732">d</span><span class="op" id="4670733">.</span><span class="ident" id="4670734">x</span><span class="op" id="4670735">[</span><span class="ident" id="4670736">d</span><span class="op" id="4670737">.</span><span class="ident" id="4670738">nx</span><span class="op" id="4670740">:</span><span class="op" id="4670741">]</span><span class="op" id="4670742">,</span>&nbsp;<span class="ident" id="4670744">p</span><span class="op" id="4670745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670749">d</span><span class="op" id="4670750">.</span><span class="ident" id="4670751">nx</span>&nbsp;<span class="op" id="4670754">+=</span>&nbsp;<span class="ident" id="4670757">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670761">if</span>&nbsp;<span class="ident" id="4670764">d</span><span class="op" id="4670765">.</span><span class="ident" id="4670766">nx</span>&nbsp;<span class="op" id="4670769">==</span>&nbsp;<span class="ident" id="4670772">chunk</span>&nbsp;<span class="op" id="4670778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670783">block</span><span class="op" id="4670788">(</span><span class="ident" id="4670789">d</span><span class="op" id="4670790">,</span>&nbsp;<span class="ident" id="4670792">d</span><span class="op" id="4670793">.</span><span class="ident" id="4670794">x</span><span class="op" id="4670795">[</span><span class="op" id="4670796">:</span><span class="op" id="4670797">]</span><span class="op" id="4670798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670803">d</span><span class="op" id="4670804">.</span><span class="ident" id="4670805">nx</span>&nbsp;<span class="op" id="4670808">=</span>&nbsp;<span class="num" id="4670810">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670818">p</span>&nbsp;<span class="op" id="4670820">=</span>&nbsp;<span class="ident" id="4670822">p</span><span class="op" id="4670823">[</span><span class="ident" id="4670824">n</span><span class="op" id="4670825">:</span><span class="op" id="4670826">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670832">if</span>&nbsp;<span class="builtinfunc" id="4670835">len</span><span class="op" id="4670838">(</span><span class="ident" id="4670839">p</span><span class="op" id="4670840">)</span>&nbsp;<span class="op" id="4670842">&gt;=</span>&nbsp;<span class="ident" id="4670845">chunk</span>&nbsp;<span class="op" id="4670851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670855">n</span>&nbsp;<span class="op" id="4670857">:=</span>&nbsp;<span class="builtinfunc" id="4670860">len</span><span class="op" id="4670863">(</span><span class="ident" id="4670864">p</span><span class="op" id="4670865">)</span>&nbsp;<span class="op" id="4670867">&amp;^</span>&nbsp;<span class="op" id="4670870">(</span><span class="ident" id="4670871">chunk</span>&nbsp;<span class="op" id="4670877">-</span>&nbsp;<span class="num" id="4670879">1</span><span class="op" id="4670880">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670884">block</span><span class="op" id="4670889">(</span><span class="ident" id="4670890">d</span><span class="op" id="4670891">,</span>&nbsp;<span class="ident" id="4670893">p</span><span class="op" id="4670894">[</span><span class="op" id="4670895">:</span><span class="ident" id="4670896">n</span><span class="op" id="4670897">]</span><span class="op" id="4670898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670902">p</span>&nbsp;<span class="op" id="4670904">=</span>&nbsp;<span class="ident" id="4670906">p</span><span class="op" id="4670907">[</span><span class="ident" id="4670908">n</span><span class="op" id="4670909">:</span><span class="op" id="4670910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670916">if</span>&nbsp;<span class="builtinfunc" id="4670919">len</span><span class="op" id="4670922">(</span><span class="ident" id="4670923">p</span><span class="op" id="4670924">)</span>&nbsp;<span class="op" id="4670926">&gt;</span>&nbsp;<span class="num" id="4670928">0</span>&nbsp;<span class="op" id="4670930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4670934">d</span><span class="op" id="4670935">.</span><span class="ident" id="4670936">nx</span>&nbsp;<span class="op" id="4670939">=</span>&nbsp;<span class="builtinfunc" id="4670941">copy</span><span class="op" id="4670945">(</span><span class="ident" id="4670946">d</span><span class="op" id="4670947">.</span><span class="ident" id="4670948">x</span><span class="op" id="4670949">[</span><span class="op" id="4670950">:</span><span class="op" id="4670951">]</span><span class="op" id="4670952">,</span>&nbsp;<span class="ident" id="4670954">p</span><span class="op" id="4670955">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4670958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4670961">return</span><br>
<span class="lineno"></span><span class="op" id="4670968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4670971">func</span>&nbsp;<span class="op" id="4670976">(</span><span class="ident" id="4670977">d0</span>&nbsp;<span class="op" id="4670980">*</span><span class="ident" id="4670981">digest</span><span class="op" id="4670987">)</span>&nbsp;<span class="ident" id="4670989">Sum</span><span class="op" id="4670992">(</span><span class="ident" id="4670993">in</span>&nbsp;<span class="op" id="4670996">[</span><span class="op" id="4670997">]</span><span class="builtintype" id="4670998">byte</span><span class="op" id="4671002">)</span>&nbsp;<span class="op" id="4671004">[</span><span class="op" id="4671005">]</span><span class="builtintype" id="4671006">byte</span>&nbsp;<span class="op" id="4671011">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671014">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671081">d</span>&nbsp;<span class="op" id="4671083">:=</span>&nbsp;<span class="op" id="4671086">*</span><span class="ident" id="4671087">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671091">hash</span>&nbsp;<span class="op" id="4671096">:=</span>&nbsp;<span class="ident" id="4671099">d</span><span class="op" id="4671100">.</span><span class="ident" id="4671101">checkSum</span><span class="op" id="4671109">(</span><span class="op" id="4671110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671113">return</span>&nbsp;<span class="builtinfunc" id="4671120">append</span><span class="op" id="4671126">(</span><span class="ident" id="4671127">in</span><span class="op" id="4671129">,</span>&nbsp;<span class="ident" id="4671131">hash</span><span class="op" id="4671135">[</span><span class="op" id="4671136">:</span><span class="op" id="4671137">]</span><span class="op" id="4671138">...</span><span class="op" id="4671141">)</span><br>
<span class="lineno"></span><span class="op" id="4671143">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4671146">func</span>&nbsp;<span class="op" id="4671151">(</span><span class="ident" id="4671152">d</span>&nbsp;<span class="op" id="4671154">*</span><span class="ident" id="4671155">digest</span><span class="op" id="4671161">)</span>&nbsp;<span class="ident" id="4671163">checkSum</span><span class="op" id="4671171">(</span><span class="op" id="4671172">)</span>&nbsp;<span class="op" id="4671174">[</span><span class="ident" id="4671175">Size</span><span class="op" id="4671179">]</span><span class="builtintype" id="4671180">byte</span>&nbsp;<span class="op" id="4671185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4671188">len</span>&nbsp;<span class="op" id="4671192">:=</span>&nbsp;<span class="ident" id="4671195">d</span><span class="op" id="4671196">.</span><span class="builtinfunc" id="4671197">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671202">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671262">var</span>&nbsp;<span class="ident" id="4671266">tmp</span>&nbsp;<span class="op" id="4671270">[</span><span class="num" id="4671271">64</span><span class="op" id="4671273">]</span><span class="builtintype" id="4671274">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671280">tmp</span><span class="op" id="4671283">[</span><span class="num" id="4671284">0</span><span class="op" id="4671285">]</span>&nbsp;<span class="op" id="4671287">=</span>&nbsp;<span class="num" id="4671289">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671295">if</span>&nbsp;<span class="builtinfunc" id="4671298">len</span><span class="op" id="4671301">%</span><span class="num" id="4671302">64</span>&nbsp;<span class="op" id="4671305">&lt;</span>&nbsp;<span class="num" id="4671307">56</span>&nbsp;<span class="op" id="4671310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671314">d</span><span class="op" id="4671315">.</span><span class="ident" id="4671316">Write</span><span class="op" id="4671321">(</span><span class="ident" id="4671322">tmp</span><span class="op" id="4671325">[</span><span class="num" id="4671326">0</span>&nbsp;<span class="op" id="4671328">:</span>&nbsp;<span class="num" id="4671330">56</span><span class="op" id="4671332">-</span><span class="builtinfunc" id="4671333">len</span><span class="op" id="4671336">%</span><span class="num" id="4671337">64</span><span class="op" id="4671339">]</span><span class="op" id="4671340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671343">}</span>&nbsp;<span class="keyword" id="4671345">else</span>&nbsp;<span class="op" id="4671350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671354">d</span><span class="op" id="4671355">.</span><span class="ident" id="4671356">Write</span><span class="op" id="4671361">(</span><span class="ident" id="4671362">tmp</span><span class="op" id="4671365">[</span><span class="num" id="4671366">0</span>&nbsp;<span class="op" id="4671368">:</span>&nbsp;<span class="num" id="4671370">64</span><span class="op" id="4671372">+</span><span class="num" id="4671373">56</span><span class="op" id="4671375">-</span><span class="builtinfunc" id="4671376">len</span><span class="op" id="4671379">%</span><span class="num" id="4671380">64</span><span class="op" id="4671382">]</span><span class="op" id="4671383">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4671390">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4671410">len</span>&nbsp;<span class="op" id="4671414">&lt;&lt;=</span>&nbsp;<span class="num" id="4671418">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671421">for</span>&nbsp;<span class="ident" id="4671425">i</span>&nbsp;<span class="op" id="4671427">:=</span>&nbsp;<span class="builtintype" id="4671430">uint</span><span class="op" id="4671434">(</span><span class="num" id="4671435">0</span><span class="op" id="4671436">)</span><span class="op" id="4671437">;</span>&nbsp;<span class="ident" id="4671439">i</span>&nbsp;<span class="op" id="4671441">&lt;</span>&nbsp;<span class="num" id="4671443">8</span><span class="op" id="4671444">;</span>&nbsp;<span class="ident" id="4671446">i</span><span class="op" id="4671447">++</span>&nbsp;<span class="op" id="4671450">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671454">tmp</span><span class="op" id="4671457">[</span><span class="ident" id="4671458">i</span><span class="op" id="4671459">]</span>&nbsp;<span class="op" id="4671461">=</span>&nbsp;<span class="builtintype" id="4671463">byte</span><span class="op" id="4671467">(</span><span class="builtinfunc" id="4671468">len</span>&nbsp;<span class="op" id="4671472">&gt;&gt;</span>&nbsp;<span class="op" id="4671475">(</span><span class="num" id="4671476">56</span>&nbsp;<span class="op" id="4671479">-</span>&nbsp;<span class="num" id="4671481">8</span><span class="op" id="4671482">*</span><span class="ident" id="4671483">i</span><span class="op" id="4671484">)</span><span class="op" id="4671485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671491">d</span><span class="op" id="4671492">.</span><span class="ident" id="4671493">Write</span><span class="op" id="4671498">(</span><span class="ident" id="4671499">tmp</span><span class="op" id="4671502">[</span><span class="num" id="4671503">0</span><span class="op" id="4671504">:</span><span class="num" id="4671505">8</span><span class="op" id="4671506">]</span><span class="op" id="4671507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671511">if</span>&nbsp;<span class="ident" id="4671514">d</span><span class="op" id="4671515">.</span><span class="ident" id="4671516">nx</span>&nbsp;<span class="op" id="4671519">!=</span>&nbsp;<span class="num" id="4671522">0</span>&nbsp;<span class="op" id="4671524">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4671528">panic</span><span class="op" id="4671533">(</span><span class="string" id="4671534">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4671545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671552">var</span>&nbsp;<span class="ident" id="4671556">digest</span>&nbsp;<span class="op" id="4671563">[</span><span class="ident" id="4671564">Size</span><span class="op" id="4671568">]</span><span class="builtintype" id="4671569">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671575">for</span>&nbsp;<span class="ident" id="4671579">i</span><span class="op" id="4671580">,</span>&nbsp;<span class="ident" id="4671582">s</span>&nbsp;<span class="op" id="4671584">:=</span>&nbsp;<span class="keyword" id="4671587">range</span>&nbsp;<span class="ident" id="4671593">d</span><span class="op" id="4671594">.</span><span class="ident" id="4671595">h</span>&nbsp;<span class="op" id="4671597">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671601">digest</span><span class="op" id="4671607">[</span><span class="ident" id="4671608">i</span><span class="op" id="4671609">*</span><span class="num" id="4671610">4</span><span class="op" id="4671611">]</span>&nbsp;<span class="op" id="4671613">=</span>&nbsp;<span class="builtintype" id="4671615">byte</span><span class="op" id="4671619">(</span><span class="ident" id="4671620">s</span>&nbsp;<span class="op" id="4671622">&gt;&gt;</span>&nbsp;<span class="num" id="4671625">24</span><span class="op" id="4671627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671631">digest</span><span class="op" id="4671637">[</span><span class="ident" id="4671638">i</span><span class="op" id="4671639">*</span><span class="num" id="4671640">4</span><span class="op" id="4671641">+</span><span class="num" id="4671642">1</span><span class="op" id="4671643">]</span>&nbsp;<span class="op" id="4671645">=</span>&nbsp;<span class="builtintype" id="4671647">byte</span><span class="op" id="4671651">(</span><span class="ident" id="4671652">s</span>&nbsp;<span class="op" id="4671654">&gt;&gt;</span>&nbsp;<span class="num" id="4671657">16</span><span class="op" id="4671659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671663">digest</span><span class="op" id="4671669">[</span><span class="ident" id="4671670">i</span><span class="op" id="4671671">*</span><span class="num" id="4671672">4</span><span class="op" id="4671673">+</span><span class="num" id="4671674">2</span><span class="op" id="4671675">]</span>&nbsp;<span class="op" id="4671677">=</span>&nbsp;<span class="builtintype" id="4671679">byte</span><span class="op" id="4671683">(</span><span class="ident" id="4671684">s</span>&nbsp;<span class="op" id="4671686">&gt;&gt;</span>&nbsp;<span class="num" id="4671689">8</span><span class="op" id="4671690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671694">digest</span><span class="op" id="4671700">[</span><span class="ident" id="4671701">i</span><span class="op" id="4671702">*</span><span class="num" id="4671703">4</span><span class="op" id="4671704">+</span><span class="num" id="4671705">3</span><span class="op" id="4671706">]</span>&nbsp;<span class="op" id="4671708">=</span>&nbsp;<span class="builtintype" id="4671710">byte</span><span class="op" id="4671714">(</span><span class="ident" id="4671715">s</span><span class="op" id="4671716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4671719">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671723">return</span>&nbsp;<span class="ident" id="4671730">digest</span><br>
<span class="lineno"></span><span class="op" id="4671737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4671740">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="4671786">func</span>&nbsp;<span class="ident" id="4671791">Sum</span><span class="op" id="4671794">(</span><span class="ident" id="4671795">data</span>&nbsp;<span class="op" id="4671800">[</span><span class="op" id="4671801">]</span><span class="builtintype" id="4671802">byte</span><span class="op" id="4671806">)</span>&nbsp;<span class="op" id="4671808">[</span><span class="ident" id="4671809">Size</span><span class="op" id="4671813">]</span><span class="builtintype" id="4671814">byte</span>&nbsp;<span class="op" id="4671819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671822">var</span>&nbsp;<span class="ident" id="4671826">d</span>&nbsp;<span class="ident" id="4671828">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671836">d</span><span class="op" id="4671837">.</span><span class="ident" id="4671838">Reset</span><span class="op" id="4671843">(</span><span class="op" id="4671844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4671847">d</span><span class="op" id="4671848">.</span><span class="ident" id="4671849">Write</span><span class="op" id="4671854">(</span><span class="ident" id="4671855">data</span><span class="op" id="4671859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4671862">return</span>&nbsp;<span class="ident" id="4671869">d</span><span class="op" id="4671870">.</span><span class="ident" id="4671871">checkSum</span><span class="op" id="4671879">(</span><span class="op" id="4671880">)</span><br>
<span class="lineno">130</span><span class="op" id="4671882">}</span>
</div>
</body>
</html>
