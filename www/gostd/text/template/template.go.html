<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4863037">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4863092">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4863146">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4863197">package</span>&nbsp;<span class="ident" id="4863205">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4863215">import</span>&nbsp;<span class="op" id="4863222">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4863225">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4863232">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4863243">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="4863265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4863268">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="4863329">type</span>&nbsp;<span class="ident" id="4863334">common</span>&nbsp;<span class="keyword" id="4863341">struct</span>&nbsp;<span class="op" id="4863348">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863351">tmpl</span>&nbsp;<span class="keyword" id="4863356">map</span><span class="op" id="4863359">[</span><span class="builtintype" id="4863360">string</span><span class="op" id="4863366">]</span><span class="op" id="4863367">*</span><span class="ident" id="4863368">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863378">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863438">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863497">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863534">parseFuncs</span>&nbsp;<span class="ident" id="4863545">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863554">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="4863565">map</span><span class="op" id="4863568">[</span><span class="builtintype" id="4863569">string</span><span class="op" id="4863575">]</span><span class="ident" id="4863576">reflect</span><span class="op" id="4863583">.</span><span class="ident" id="4863584">Value</span><br>
<span class="lineno"></span><span class="op" id="4863590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4863593">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="4863665">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="4863738">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4863777">type</span>&nbsp;<span class="ident" id="4863782">Template</span>&nbsp;<span class="keyword" id="4863791">struct</span>&nbsp;<span class="op" id="4863798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863801">name</span>&nbsp;<span class="builtintype" id="4863806">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863814">*</span><span class="ident" id="4863815">parse</span><span class="op" id="4863820">.</span><span class="ident" id="4863821">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863827">*</span><span class="ident" id="4863828">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863836">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="4863847">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863855">rightDelim</span>&nbsp;<span class="builtintype" id="4863866">string</span><br>
<span class="lineno"></span><span class="op" id="4863873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4863876">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="4863929">func</span>&nbsp;<span class="ident" id="4863934">New</span><span class="op" id="4863937">(</span><span class="ident" id="4863938">name</span>&nbsp;<span class="builtintype" id="4863943">string</span><span class="op" id="4863949">)</span>&nbsp;<span class="op" id="4863951">*</span><span class="ident" id="4863952">Template</span>&nbsp;<span class="op" id="4863961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863964">return</span>&nbsp;<span class="op" id="4863971">&amp;</span><span class="ident" id="4863972">Template</span><span class="op" id="4863980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863984">name</span><span class="op" id="4863988">:</span>&nbsp;<span class="ident" id="4863990">name</span><span class="op" id="4863994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863997">}</span><br>
<span class="lineno"></span><span class="op" id="4863999">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4864002">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="4864044">func</span>&nbsp;<span class="op" id="4864049">(</span><span class="ident" id="4864050">t</span>&nbsp;<span class="op" id="4864052">*</span><span class="ident" id="4864053">Template</span><span class="op" id="4864061">)</span>&nbsp;<span class="ident" id="4864063">Name</span><span class="op" id="4864067">(</span><span class="op" id="4864068">)</span>&nbsp;<span class="builtintype" id="4864070">string</span>&nbsp;<span class="op" id="4864077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864080">return</span>&nbsp;<span class="ident" id="4864087">t</span><span class="op" id="4864088">.</span><span class="ident" id="4864089">name</span><br>
<span class="lineno"></span><span class="op" id="4864094">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4864097">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="4864177">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4864253">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="4864299">func</span>&nbsp;<span class="op" id="4864304">(</span><span class="ident" id="4864305">t</span>&nbsp;<span class="op" id="4864307">*</span><span class="ident" id="4864308">Template</span><span class="op" id="4864316">)</span>&nbsp;<span class="ident" id="4864318">New</span><span class="op" id="4864321">(</span><span class="ident" id="4864322">name</span>&nbsp;<span class="builtintype" id="4864327">string</span><span class="op" id="4864333">)</span>&nbsp;<span class="op" id="4864335">*</span><span class="ident" id="4864336">Template</span>&nbsp;<span class="op" id="4864345">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864348">t</span><span class="op" id="4864349">.</span><span class="ident" id="4864350">init</span><span class="op" id="4864354">(</span><span class="op" id="4864355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864358">return</span>&nbsp;<span class="op" id="4864365">&amp;</span><span class="ident" id="4864366">Template</span><span class="op" id="4864374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864378">name</span><span class="op" id="4864382">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4864390">name</span><span class="op" id="4864394">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864398">common</span><span class="op" id="4864404">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4864410">t</span><span class="op" id="4864411">.</span><span class="ident" id="4864412">common</span><span class="op" id="4864418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864422">leftDelim</span><span class="op" id="4864431">:</span>&nbsp;&nbsp;<span class="ident" id="4864434">t</span><span class="op" id="4864435">.</span><span class="ident" id="4864436">leftDelim</span><span class="op" id="4864445">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864449">rightDelim</span><span class="op" id="4864459">:</span>&nbsp;<span class="ident" id="4864461">t</span><span class="op" id="4864462">.</span><span class="ident" id="4864463">rightDelim</span><span class="op" id="4864473">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864476">}</span><br>
<span class="lineno"></span><span class="op" id="4864478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4864481">func</span>&nbsp;<span class="op" id="4864486">(</span><span class="ident" id="4864487">t</span>&nbsp;<span class="op" id="4864489">*</span><span class="ident" id="4864490">Template</span><span class="op" id="4864498">)</span>&nbsp;<span class="ident" id="4864500">init</span><span class="op" id="4864504">(</span><span class="op" id="4864505">)</span>&nbsp;<span class="op" id="4864507">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864510">if</span>&nbsp;<span class="ident" id="4864513">t</span><span class="op" id="4864514">.</span><span class="ident" id="4864515">common</span>&nbsp;<span class="op" id="4864522">==</span>&nbsp;<span class="ident" id="4864525">nil</span>&nbsp;<span class="op" id="4864529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864533">t</span><span class="op" id="4864534">.</span><span class="ident" id="4864535">common</span>&nbsp;<span class="op" id="4864542">=</span>&nbsp;<span class="builtinfunc" id="4864544">new</span><span class="op" id="4864547">(</span><span class="ident" id="4864548">common</span><span class="op" id="4864554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864558">t</span><span class="op" id="4864559">.</span><span class="ident" id="4864560">tmpl</span>&nbsp;<span class="op" id="4864565">=</span>&nbsp;<span class="builtinfunc" id="4864567">make</span><span class="op" id="4864571">(</span><span class="keyword" id="4864572">map</span><span class="op" id="4864575">[</span><span class="builtintype" id="4864576">string</span><span class="op" id="4864582">]</span><span class="op" id="4864583">*</span><span class="ident" id="4864584">Template</span><span class="op" id="4864592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864596">t</span><span class="op" id="4864597">.</span><span class="ident" id="4864598">parseFuncs</span>&nbsp;<span class="op" id="4864609">=</span>&nbsp;<span class="builtinfunc" id="4864611">make</span><span class="op" id="4864615">(</span><span class="ident" id="4864616">FuncMap</span><span class="op" id="4864623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864627">t</span><span class="op" id="4864628">.</span><span class="ident" id="4864629">execFuncs</span>&nbsp;<span class="op" id="4864639">=</span>&nbsp;<span class="builtinfunc" id="4864641">make</span><span class="op" id="4864645">(</span><span class="keyword" id="4864646">map</span><span class="op" id="4864649">[</span><span class="builtintype" id="4864650">string</span><span class="op" id="4864656">]</span><span class="ident" id="4864657">reflect</span><span class="op" id="4864664">.</span><span class="ident" id="4864665">Value</span><span class="op" id="4864670">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864673">}</span><br>
<span class="lineno"></span><span class="op" id="4864675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4864678">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4864749">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="4864826">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="4864901">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="4864980">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="4865058">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="4865109">func</span>&nbsp;<span class="op" id="4865114">(</span><span class="ident" id="4865115">t</span>&nbsp;<span class="op" id="4865117">*</span><span class="ident" id="4865118">Template</span><span class="op" id="4865126">)</span>&nbsp;<span class="ident" id="4865128">Clone</span><span class="op" id="4865133">(</span><span class="op" id="4865134">)</span>&nbsp;<span class="op" id="4865136">(</span><span class="op" id="4865137">*</span><span class="ident" id="4865138">Template</span><span class="op" id="4865146">,</span>&nbsp;<span class="builtintype" id="4865148">error</span><span class="op" id="4865153">)</span>&nbsp;<span class="op" id="4865155">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865158">nt</span>&nbsp;<span class="op" id="4865161">:=</span>&nbsp;<span class="ident" id="4865164">t</span><span class="op" id="4865165">.</span><span class="builtinfunc" id="4865166">copy</span><span class="op" id="4865170">(</span><span class="ident" id="4865171">nil</span><span class="op" id="4865174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865177">nt</span><span class="op" id="4865179">.</span><span class="ident" id="4865180">init</span><span class="op" id="4865184">(</span><span class="op" id="4865185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865188">nt</span><span class="op" id="4865190">.</span><span class="ident" id="4865191">tmpl</span><span class="op" id="4865195">[</span><span class="ident" id="4865196">t</span><span class="op" id="4865197">.</span><span class="ident" id="4865198">name</span><span class="op" id="4865202">]</span>&nbsp;<span class="op" id="4865204">=</span>&nbsp;<span class="ident" id="4865206">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865210">for</span>&nbsp;<span class="ident" id="4865214">k</span><span class="op" id="4865215">,</span>&nbsp;<span class="ident" id="4865217">v</span>&nbsp;<span class="op" id="4865219">:=</span>&nbsp;<span class="keyword" id="4865222">range</span>&nbsp;<span class="ident" id="4865228">t</span><span class="op" id="4865229">.</span><span class="ident" id="4865230">tmpl</span>&nbsp;<span class="op" id="4865235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865239">if</span>&nbsp;<span class="ident" id="4865242">k</span>&nbsp;<span class="op" id="4865244">==</span>&nbsp;<span class="ident" id="4865247">t</span><span class="op" id="4865248">.</span><span class="ident" id="4865249">name</span>&nbsp;<span class="op" id="4865254">{</span>&nbsp;<span class="comment" id="4865256">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865281">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865296">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865355">tmpl</span>&nbsp;<span class="op" id="4865360">:=</span>&nbsp;<span class="ident" id="4865363">v</span><span class="op" id="4865364">.</span><span class="builtinfunc" id="4865365">copy</span><span class="op" id="4865369">(</span><span class="ident" id="4865370">nt</span><span class="op" id="4865372">.</span><span class="ident" id="4865373">common</span><span class="op" id="4865379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865383">nt</span><span class="op" id="4865385">.</span><span class="ident" id="4865386">tmpl</span><span class="op" id="4865390">[</span><span class="ident" id="4865391">k</span><span class="op" id="4865392">]</span>&nbsp;<span class="op" id="4865394">=</span>&nbsp;<span class="ident" id="4865396">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865405">for</span>&nbsp;<span class="ident" id="4865409">k</span><span class="op" id="4865410">,</span>&nbsp;<span class="ident" id="4865412">v</span>&nbsp;<span class="op" id="4865414">:=</span>&nbsp;<span class="keyword" id="4865417">range</span>&nbsp;<span class="ident" id="4865423">t</span><span class="op" id="4865424">.</span><span class="ident" id="4865425">parseFuncs</span>&nbsp;<span class="op" id="4865436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865440">nt</span><span class="op" id="4865442">.</span><span class="ident" id="4865443">parseFuncs</span><span class="op" id="4865453">[</span><span class="ident" id="4865454">k</span><span class="op" id="4865455">]</span>&nbsp;<span class="op" id="4865457">=</span>&nbsp;<span class="ident" id="4865459">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865465">for</span>&nbsp;<span class="ident" id="4865469">k</span><span class="op" id="4865470">,</span>&nbsp;<span class="ident" id="4865472">v</span>&nbsp;<span class="op" id="4865474">:=</span>&nbsp;<span class="keyword" id="4865477">range</span>&nbsp;<span class="ident" id="4865483">t</span><span class="op" id="4865484">.</span><span class="ident" id="4865485">execFuncs</span>&nbsp;<span class="op" id="4865495">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865499">nt</span><span class="op" id="4865501">.</span><span class="ident" id="4865502">execFuncs</span><span class="op" id="4865511">[</span><span class="ident" id="4865512">k</span><span class="op" id="4865513">]</span>&nbsp;<span class="op" id="4865515">=</span>&nbsp;<span class="ident" id="4865517">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865523">return</span>&nbsp;<span class="ident" id="4865530">nt</span><span class="op" id="4865532">,</span>&nbsp;<span class="ident" id="4865534">nil</span><br>
<span class="lineno"></span><span class="op" id="4865538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4865541">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4865611">func</span>&nbsp;<span class="op" id="4865616">(</span><span class="ident" id="4865617">t</span>&nbsp;<span class="op" id="4865619">*</span><span class="ident" id="4865620">Template</span><span class="op" id="4865628">)</span>&nbsp;<span class="builtinfunc" id="4865630">copy</span><span class="op" id="4865634">(</span><span class="ident" id="4865635">c</span>&nbsp;<span class="op" id="4865637">*</span><span class="ident" id="4865638">common</span><span class="op" id="4865644">)</span>&nbsp;<span class="op" id="4865646">*</span><span class="ident" id="4865647">Template</span>&nbsp;<span class="op" id="4865656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865659">nt</span>&nbsp;<span class="op" id="4865662">:=</span>&nbsp;<span class="ident" id="4865665">New</span><span class="op" id="4865668">(</span><span class="ident" id="4865669">t</span><span class="op" id="4865670">.</span><span class="ident" id="4865671">name</span><span class="op" id="4865675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865678">nt</span><span class="op" id="4865680">.</span><span class="ident" id="4865681">Tree</span>&nbsp;<span class="op" id="4865686">=</span>&nbsp;<span class="ident" id="4865688">t</span><span class="op" id="4865689">.</span><span class="ident" id="4865690">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865696">nt</span><span class="op" id="4865698">.</span><span class="ident" id="4865699">common</span>&nbsp;<span class="op" id="4865706">=</span>&nbsp;<span class="ident" id="4865708">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865711">nt</span><span class="op" id="4865713">.</span><span class="ident" id="4865714">leftDelim</span>&nbsp;<span class="op" id="4865724">=</span>&nbsp;<span class="ident" id="4865726">t</span><span class="op" id="4865727">.</span><span class="ident" id="4865728">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865739">nt</span><span class="op" id="4865741">.</span><span class="ident" id="4865742">rightDelim</span>&nbsp;<span class="op" id="4865753">=</span>&nbsp;<span class="ident" id="4865755">t</span><span class="op" id="4865756">.</span><span class="ident" id="4865757">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865769">return</span>&nbsp;<span class="ident" id="4865776">nt</span><br>
<span class="lineno"></span><span class="op" id="4865779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4865782">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="4865850">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="4865879">func</span>&nbsp;<span class="op" id="4865884">(</span><span class="ident" id="4865885">t</span>&nbsp;<span class="op" id="4865887">*</span><span class="ident" id="4865888">Template</span><span class="op" id="4865896">)</span>&nbsp;<span class="ident" id="4865898">AddParseTree</span><span class="op" id="4865910">(</span><span class="ident" id="4865911">name</span>&nbsp;<span class="builtintype" id="4865916">string</span><span class="op" id="4865922">,</span>&nbsp;<span class="ident" id="4865924">tree</span>&nbsp;<span class="op" id="4865929">*</span><span class="ident" id="4865930">parse</span><span class="op" id="4865935">.</span><span class="ident" id="4865936">Tree</span><span class="op" id="4865940">)</span>&nbsp;<span class="op" id="4865942">(</span><span class="op" id="4865943">*</span><span class="ident" id="4865944">Template</span><span class="op" id="4865952">,</span>&nbsp;<span class="builtintype" id="4865954">error</span><span class="op" id="4865959">)</span>&nbsp;<span class="op" id="4865961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865964">if</span>&nbsp;<span class="ident" id="4865967">t</span><span class="op" id="4865968">.</span><span class="ident" id="4865969">common</span>&nbsp;<span class="op" id="4865976">!=</span>&nbsp;<span class="ident" id="4865979">nil</span>&nbsp;<span class="op" id="4865983">&amp;&amp;</span>&nbsp;<span class="ident" id="4865986">t</span><span class="op" id="4865987">.</span><span class="ident" id="4865988">tmpl</span><span class="op" id="4865992">[</span><span class="ident" id="4865993">name</span><span class="op" id="4865997">]</span>&nbsp;<span class="op" id="4865999">!=</span>&nbsp;<span class="ident" id="4866002">nil</span>&nbsp;<span class="op" id="4866006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866010">return</span>&nbsp;<span class="ident" id="4866017">nil</span><span class="op" id="4866020">,</span>&nbsp;<span class="ident" id="4866022">fmt</span><span class="op" id="4866025">.</span><span class="ident" id="4866026">Errorf</span><span class="op" id="4866032">(</span><span class="string" id="4866033">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4866072">,</span>&nbsp;<span class="ident" id="4866074">name</span><span class="op" id="4866078">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866084">nt</span>&nbsp;<span class="op" id="4866087">:=</span>&nbsp;<span class="ident" id="4866090">t</span><span class="op" id="4866091">.</span><span class="ident" id="4866092">New</span><span class="op" id="4866095">(</span><span class="ident" id="4866096">name</span><span class="op" id="4866100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866103">nt</span><span class="op" id="4866105">.</span><span class="ident" id="4866106">Tree</span>&nbsp;<span class="op" id="4866111">=</span>&nbsp;<span class="ident" id="4866113">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866119">t</span><span class="op" id="4866120">.</span><span class="ident" id="4866121">tmpl</span><span class="op" id="4866125">[</span><span class="ident" id="4866126">name</span><span class="op" id="4866130">]</span>&nbsp;<span class="op" id="4866132">=</span>&nbsp;<span class="ident" id="4866134">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866138">return</span>&nbsp;<span class="ident" id="4866145">nt</span><span class="op" id="4866147">,</span>&nbsp;<span class="ident" id="4866149">nil</span><br>
<span class="lineno">115</span><span class="op" id="4866153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4866156">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="4866233">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="4866244">func</span>&nbsp;<span class="op" id="4866249">(</span><span class="ident" id="4866250">t</span>&nbsp;<span class="op" id="4866252">*</span><span class="ident" id="4866253">Template</span><span class="op" id="4866261">)</span>&nbsp;<span class="ident" id="4866263">Templates</span><span class="op" id="4866272">(</span><span class="op" id="4866273">)</span>&nbsp;<span class="op" id="4866275">[</span><span class="op" id="4866276">]</span><span class="op" id="4866277">*</span><span class="ident" id="4866278">Template</span>&nbsp;<span class="op" id="4866287">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866290">if</span>&nbsp;<span class="ident" id="4866293">t</span><span class="op" id="4866294">.</span><span class="ident" id="4866295">common</span>&nbsp;<span class="op" id="4866302">==</span>&nbsp;<span class="ident" id="4866305">nil</span>&nbsp;<span class="op" id="4866309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866313">return</span>&nbsp;<span class="ident" id="4866320">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866328">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866375">m</span>&nbsp;<span class="op" id="4866377">:=</span>&nbsp;<span class="builtinfunc" id="4866380">make</span><span class="op" id="4866384">(</span><span class="op" id="4866385">[</span><span class="op" id="4866386">]</span><span class="op" id="4866387">*</span><span class="ident" id="4866388">Template</span><span class="op" id="4866396">,</span>&nbsp;<span class="num" id="4866398">0</span><span class="op" id="4866399">,</span>&nbsp;<span class="builtinfunc" id="4866401">len</span><span class="op" id="4866404">(</span><span class="ident" id="4866405">t</span><span class="op" id="4866406">.</span><span class="ident" id="4866407">tmpl</span><span class="op" id="4866411">)</span><span class="op" id="4866412">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866415">for</span>&nbsp;<span class="ident" id="4866419">_</span><span class="op" id="4866420">,</span>&nbsp;<span class="ident" id="4866422">v</span>&nbsp;<span class="op" id="4866424">:=</span>&nbsp;<span class="keyword" id="4866427">range</span>&nbsp;<span class="ident" id="4866433">t</span><span class="op" id="4866434">.</span><span class="ident" id="4866435">tmpl</span>&nbsp;<span class="op" id="4866440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866444">m</span>&nbsp;<span class="op" id="4866446">=</span>&nbsp;<span class="builtinfunc" id="4866448">append</span><span class="op" id="4866454">(</span><span class="ident" id="4866455">m</span><span class="op" id="4866456">,</span>&nbsp;<span class="ident" id="4866458">v</span><span class="op" id="4866459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866465">return</span>&nbsp;<span class="ident" id="4866472">m</span><br>
<span class="lineno"></span><span class="op" id="4866474">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4866477">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4866554">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4866626">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4866702">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="4866738">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4866800">func</span>&nbsp;<span class="op" id="4866805">(</span><span class="ident" id="4866806">t</span>&nbsp;<span class="op" id="4866808">*</span><span class="ident" id="4866809">Template</span><span class="op" id="4866817">)</span>&nbsp;<span class="ident" id="4866819">Delims</span><span class="op" id="4866825">(</span><span class="ident" id="4866826">left</span><span class="op" id="4866830">,</span>&nbsp;<span class="ident" id="4866832">right</span>&nbsp;<span class="builtintype" id="4866838">string</span><span class="op" id="4866844">)</span>&nbsp;<span class="op" id="4866846">*</span><span class="ident" id="4866847">Template</span>&nbsp;<span class="op" id="4866856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866859">t</span><span class="op" id="4866860">.</span><span class="ident" id="4866861">leftDelim</span>&nbsp;<span class="op" id="4866871">=</span>&nbsp;<span class="ident" id="4866873">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866879">t</span><span class="op" id="4866880">.</span><span class="ident" id="4866881">rightDelim</span>&nbsp;<span class="op" id="4866892">=</span>&nbsp;<span class="ident" id="4866894">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866901">return</span>&nbsp;<span class="ident" id="4866908">t</span><br>
<span class="lineno">140</span><span class="op" id="4866910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4866913">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4866992">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4867069">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="4867144">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="4867195">func</span>&nbsp;<span class="op" id="4867200">(</span><span class="ident" id="4867201">t</span>&nbsp;<span class="op" id="4867203">*</span><span class="ident" id="4867204">Template</span><span class="op" id="4867212">)</span>&nbsp;<span class="ident" id="4867214">Funcs</span><span class="op" id="4867219">(</span><span class="ident" id="4867220">funcMap</span>&nbsp;<span class="ident" id="4867228">FuncMap</span><span class="op" id="4867235">)</span>&nbsp;<span class="op" id="4867237">*</span><span class="ident" id="4867238">Template</span>&nbsp;<span class="op" id="4867247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867250">t</span><span class="op" id="4867251">.</span><span class="ident" id="4867252">init</span><span class="op" id="4867256">(</span><span class="op" id="4867257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867260">addValueFuncs</span><span class="op" id="4867273">(</span><span class="ident" id="4867274">t</span><span class="op" id="4867275">.</span><span class="ident" id="4867276">execFuncs</span><span class="op" id="4867285">,</span>&nbsp;<span class="ident" id="4867287">funcMap</span><span class="op" id="4867294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867297">addFuncs</span><span class="op" id="4867305">(</span><span class="ident" id="4867306">t</span><span class="op" id="4867307">.</span><span class="ident" id="4867308">parseFuncs</span><span class="op" id="4867318">,</span>&nbsp;<span class="ident" id="4867320">funcMap</span><span class="op" id="4867327">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867330">return</span>&nbsp;<span class="ident" id="4867337">t</span><br>
<span class="lineno"></span><span class="op" id="4867339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4867342">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="4867420">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="4867460">func</span>&nbsp;<span class="op" id="4867465">(</span><span class="ident" id="4867466">t</span>&nbsp;<span class="op" id="4867468">*</span><span class="ident" id="4867469">Template</span><span class="op" id="4867477">)</span>&nbsp;<span class="ident" id="4867479">Lookup</span><span class="op" id="4867485">(</span><span class="ident" id="4867486">name</span>&nbsp;<span class="builtintype" id="4867491">string</span><span class="op" id="4867497">)</span>&nbsp;<span class="op" id="4867499">*</span><span class="ident" id="4867500">Template</span>&nbsp;<span class="op" id="4867509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867512">if</span>&nbsp;<span class="ident" id="4867515">t</span><span class="op" id="4867516">.</span><span class="ident" id="4867517">common</span>&nbsp;<span class="op" id="4867524">==</span>&nbsp;<span class="ident" id="4867527">nil</span>&nbsp;<span class="op" id="4867531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867535">return</span>&nbsp;<span class="ident" id="4867542">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4867547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867550">return</span>&nbsp;<span class="ident" id="4867557">t</span><span class="op" id="4867558">.</span><span class="ident" id="4867559">tmpl</span><span class="op" id="4867563">[</span><span class="ident" id="4867564">name</span><span class="op" id="4867568">]</span><br>
<span class="lineno">160</span><span class="op" id="4867570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4867573">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4867651">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="4867731">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="4867809">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="4867882">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4867957">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4868035">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="4868110">func</span>&nbsp;<span class="op" id="4868115">(</span><span class="ident" id="4868116">t</span>&nbsp;<span class="op" id="4868118">*</span><span class="ident" id="4868119">Template</span><span class="op" id="4868127">)</span>&nbsp;<span class="ident" id="4868129">Parse</span><span class="op" id="4868134">(</span><span class="ident" id="4868135">text</span>&nbsp;<span class="builtintype" id="4868140">string</span><span class="op" id="4868146">)</span>&nbsp;<span class="op" id="4868148">(</span><span class="op" id="4868149">*</span><span class="ident" id="4868150">Template</span><span class="op" id="4868158">,</span>&nbsp;<span class="builtintype" id="4868160">error</span><span class="op" id="4868165">)</span>&nbsp;<span class="op" id="4868167">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868170">t</span><span class="op" id="4868171">.</span><span class="ident" id="4868172">init</span><span class="op" id="4868176">(</span><span class="op" id="4868177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868180">trees</span><span class="op" id="4868185">,</span>&nbsp;<span class="ident" id="4868187">err</span>&nbsp;<span class="op" id="4868191">:=</span>&nbsp;<span class="ident" id="4868194">parse</span><span class="op" id="4868199">.</span><span class="ident" id="4868200">Parse</span><span class="op" id="4868205">(</span><span class="ident" id="4868206">t</span><span class="op" id="4868207">.</span><span class="ident" id="4868208">name</span><span class="op" id="4868212">,</span>&nbsp;<span class="ident" id="4868214">text</span><span class="op" id="4868218">,</span>&nbsp;<span class="ident" id="4868220">t</span><span class="op" id="4868221">.</span><span class="ident" id="4868222">leftDelim</span><span class="op" id="4868231">,</span>&nbsp;<span class="ident" id="4868233">t</span><span class="op" id="4868234">.</span><span class="ident" id="4868235">rightDelim</span><span class="op" id="4868245">,</span>&nbsp;<span class="ident" id="4868247">t</span><span class="op" id="4868248">.</span><span class="ident" id="4868249">parseFuncs</span><span class="op" id="4868259">,</span>&nbsp;<span class="ident" id="4868261">builtins</span><span class="op" id="4868269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868272">if</span>&nbsp;<span class="ident" id="4868275">err</span>&nbsp;<span class="op" id="4868279">!=</span>&nbsp;<span class="ident" id="4868282">nil</span>&nbsp;<span class="op" id="4868286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868290">return</span>&nbsp;<span class="ident" id="4868297">nil</span><span class="op" id="4868300">,</span>&nbsp;<span class="ident" id="4868302">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868307">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868310">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868394">for</span>&nbsp;<span class="ident" id="4868398">name</span><span class="op" id="4868402">,</span>&nbsp;<span class="ident" id="4868404">tree</span>&nbsp;<span class="op" id="4868409">:=</span>&nbsp;<span class="keyword" id="4868412">range</span>&nbsp;<span class="ident" id="4868418">trees</span>&nbsp;<span class="op" id="4868424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868428">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868510">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868568">tmpl</span>&nbsp;<span class="op" id="4868573">:=</span>&nbsp;<span class="ident" id="4868576">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868580">if</span>&nbsp;<span class="ident" id="4868583">name</span>&nbsp;<span class="op" id="4868588">!=</span>&nbsp;<span class="ident" id="4868591">t</span><span class="op" id="4868592">.</span><span class="ident" id="4868593">name</span>&nbsp;<span class="op" id="4868598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868603">tmpl</span>&nbsp;<span class="op" id="4868608">=</span>&nbsp;<span class="ident" id="4868610">t</span><span class="op" id="4868611">.</span><span class="ident" id="4868612">New</span><span class="op" id="4868615">(</span><span class="ident" id="4868616">name</span><span class="op" id="4868620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868628">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868698">if</span>&nbsp;<span class="ident" id="4868701">replace</span><span class="op" id="4868708">,</span>&nbsp;<span class="ident" id="4868710">err</span>&nbsp;<span class="op" id="4868714">:=</span>&nbsp;<span class="ident" id="4868717">t</span><span class="op" id="4868718">.</span><span class="ident" id="4868719">associate</span><span class="op" id="4868728">(</span><span class="ident" id="4868729">tmpl</span><span class="op" id="4868733">,</span>&nbsp;<span class="ident" id="4868735">tree</span><span class="op" id="4868739">)</span><span class="op" id="4868740">;</span>&nbsp;<span class="ident" id="4868742">err</span>&nbsp;<span class="op" id="4868746">!=</span>&nbsp;<span class="ident" id="4868749">nil</span>&nbsp;<span class="op" id="4868753">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868758">return</span>&nbsp;<span class="ident" id="4868765">nil</span><span class="op" id="4868768">,</span>&nbsp;<span class="ident" id="4868770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868776">}</span>&nbsp;<span class="keyword" id="4868778">else</span>&nbsp;<span class="keyword" id="4868783">if</span>&nbsp;<span class="ident" id="4868786">replace</span>&nbsp;<span class="op" id="4868794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868799">tmpl</span><span class="op" id="4868803">.</span><span class="ident" id="4868804">Tree</span>&nbsp;<span class="op" id="4868809">=</span>&nbsp;<span class="ident" id="4868811">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868822">tmpl</span><span class="op" id="4868826">.</span><span class="ident" id="4868827">leftDelim</span>&nbsp;<span class="op" id="4868837">=</span>&nbsp;<span class="ident" id="4868839">t</span><span class="op" id="4868840">.</span><span class="ident" id="4868841">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868853">tmpl</span><span class="op" id="4868857">.</span><span class="ident" id="4868858">rightDelim</span>&nbsp;<span class="op" id="4868869">=</span>&nbsp;<span class="ident" id="4868871">t</span><span class="op" id="4868872">.</span><span class="ident" id="4868873">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868888">return</span>&nbsp;<span class="ident" id="4868895">t</span><span class="op" id="4868896">,</span>&nbsp;<span class="ident" id="4868898">nil</span><br>
<span class="lineno"></span><span class="op" id="4868902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="4868905">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4868983">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="4869054">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4869124">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="4869197">func</span>&nbsp;<span class="op" id="4869202">(</span><span class="ident" id="4869203">t</span>&nbsp;<span class="op" id="4869205">*</span><span class="ident" id="4869206">Template</span><span class="op" id="4869214">)</span>&nbsp;<span class="ident" id="4869216">associate</span><span class="op" id="4869225">(</span><span class="builtinfunc" id="4869226">new</span>&nbsp;<span class="op" id="4869230">*</span><span class="ident" id="4869231">Template</span><span class="op" id="4869239">,</span>&nbsp;<span class="ident" id="4869241">tree</span>&nbsp;<span class="op" id="4869246">*</span><span class="ident" id="4869247">parse</span><span class="op" id="4869252">.</span><span class="ident" id="4869253">Tree</span><span class="op" id="4869257">)</span>&nbsp;<span class="op" id="4869259">(</span><span class="builtintype" id="4869260">bool</span><span class="op" id="4869264">,</span>&nbsp;<span class="builtintype" id="4869266">error</span><span class="op" id="4869271">)</span>&nbsp;<span class="op" id="4869273">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869276">if</span>&nbsp;<span class="builtinfunc" id="4869279">new</span><span class="op" id="4869282">.</span><span class="ident" id="4869283">common</span>&nbsp;<span class="op" id="4869290">!=</span>&nbsp;<span class="ident" id="4869293">t</span><span class="op" id="4869294">.</span><span class="ident" id="4869295">common</span>&nbsp;<span class="op" id="4869302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4869306">panic</span><span class="op" id="4869311">(</span><span class="string" id="4869312">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="4869350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869356">name</span>&nbsp;<span class="op" id="4869361">:=</span>&nbsp;<span class="builtinfunc" id="4869364">new</span><span class="op" id="4869367">.</span><span class="ident" id="4869368">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869374">if</span>&nbsp;<span class="ident" id="4869377">old</span>&nbsp;<span class="op" id="4869381">:=</span>&nbsp;<span class="ident" id="4869384">t</span><span class="op" id="4869385">.</span><span class="ident" id="4869386">tmpl</span><span class="op" id="4869390">[</span><span class="ident" id="4869391">name</span><span class="op" id="4869395">]</span><span class="op" id="4869396">;</span>&nbsp;<span class="ident" id="4869398">old</span>&nbsp;<span class="op" id="4869402">!=</span>&nbsp;<span class="ident" id="4869405">nil</span>&nbsp;<span class="op" id="4869409">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869413">oldIsEmpty</span>&nbsp;<span class="op" id="4869424">:=</span>&nbsp;<span class="ident" id="4869427">parse</span><span class="op" id="4869432">.</span><span class="ident" id="4869433">IsEmptyTree</span><span class="op" id="4869444">(</span><span class="ident" id="4869445">old</span><span class="op" id="4869448">.</span><span class="ident" id="4869449">Root</span><span class="op" id="4869453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869457">newIsEmpty</span>&nbsp;<span class="op" id="4869468">:=</span>&nbsp;<span class="ident" id="4869471">parse</span><span class="op" id="4869476">.</span><span class="ident" id="4869477">IsEmptyTree</span><span class="op" id="4869488">(</span><span class="ident" id="4869489">tree</span><span class="op" id="4869493">.</span><span class="ident" id="4869494">Root</span><span class="op" id="4869498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869502">if</span>&nbsp;<span class="ident" id="4869505">newIsEmpty</span>&nbsp;<span class="op" id="4869516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4869521">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869596">return</span>&nbsp;<span class="builtintype" id="4869603">false</span><span class="op" id="4869608">,</span>&nbsp;<span class="ident" id="4869610">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869620">if</span>&nbsp;<span class="op" id="4869623">!</span><span class="ident" id="4869624">oldIsEmpty</span>&nbsp;<span class="op" id="4869635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869640">return</span>&nbsp;<span class="builtintype" id="4869647">false</span><span class="op" id="4869652">,</span>&nbsp;<span class="ident" id="4869654">fmt</span><span class="op" id="4869657">.</span><span class="ident" id="4869658">Errorf</span><span class="op" id="4869664">(</span><span class="string" id="4869665">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="4869704">,</span>&nbsp;<span class="ident" id="4869706">name</span><span class="op" id="4869710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4869717">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869720">t</span><span class="op" id="4869721">.</span><span class="ident" id="4869722">tmpl</span><span class="op" id="4869726">[</span><span class="ident" id="4869727">name</span><span class="op" id="4869731">]</span>&nbsp;<span class="op" id="4869733">=</span>&nbsp;<span class="builtinfunc" id="4869735">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4869740">return</span>&nbsp;<span class="builtintype" id="4869747">true</span><span class="op" id="4869751">,</span>&nbsp;<span class="ident" id="4869753">nil</span><br>
<span class="lineno"></span><span class="op" id="4869757">}</span>
</div>
</body>
</html>
