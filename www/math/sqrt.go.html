<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2089768">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2089823">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2089877">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2089928">package</span>&nbsp;<span class="ident" id="2089936">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2089942">//&nbsp;The&nbsp;original&nbsp;C&nbsp;code&nbsp;and&nbsp;the&nbsp;long&nbsp;comment&nbsp;below&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2089996">//&nbsp;from&nbsp;FreeBSD&#39;s&nbsp;/usr/src/lib/msun/src/e_sqrt.c&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2090049">//&nbsp;came&nbsp;with&nbsp;this&nbsp;notice.&nbsp;&nbsp;The&nbsp;go&nbsp;code&nbsp;is&nbsp;a&nbsp;simplified</span><br>
<span class="lineno">10</span><span class="comment" id="2090104">//&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;C.</span><br>
<span class="lineno"></span><span class="comment" id="2090134">//</span><br>
<span class="lineno"></span><span class="comment" id="2090137">//&nbsp;====================================================</span><br>
<span class="lineno"></span><span class="comment" id="2090193">//&nbsp;Copyright&nbsp;(C)&nbsp;1993&nbsp;by&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2090262">//</span><br>
<span class="lineno">15</span><span class="comment" id="2090265">//&nbsp;Developed&nbsp;at&nbsp;SunPro,&nbsp;a&nbsp;Sun&nbsp;Microsystems,&nbsp;Inc.&nbsp;business.</span><br>
<span class="lineno"></span><span class="comment" id="2090324">//&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="2090380">//&nbsp;software&nbsp;is&nbsp;freely&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;notice</span><br>
<span class="lineno"></span><span class="comment" id="2090437">//&nbsp;is&nbsp;preserved.</span><br>
<span class="lineno"></span><span class="comment" id="2090454">//&nbsp;====================================================</span><br>
<span class="lineno">20</span><span class="comment" id="2090510">//</span><br>
<span class="lineno"></span><span class="comment" id="2090513">//&nbsp;__ieee754_sqrt(x)</span><br>
<span class="lineno"></span><span class="comment" id="2090534">//&nbsp;Return&nbsp;correctly&nbsp;rounded&nbsp;sqrt.</span><br>
<span class="lineno"></span><span class="comment" id="2090568">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2090623">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Use&nbsp;the&nbsp;hardware&nbsp;sqrt&nbsp;if&nbsp;you&nbsp;have&nbsp;one&nbsp;|</span><br>
<span class="lineno">25</span><span class="comment" id="2090678">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2090733">//&nbsp;Method:</span><br>
<span class="lineno"></span><span class="comment" id="2090744">//&nbsp;&nbsp;&nbsp;Bit&nbsp;by&nbsp;bit&nbsp;method&nbsp;using&nbsp;integer&nbsp;arithmetic.&nbsp;(Slow,&nbsp;but&nbsp;portable)</span><br>
<span class="lineno"></span><span class="comment" id="2090814">//&nbsp;&nbsp;&nbsp;1.&nbsp;Normalization</span><br>
<span class="lineno"></span><span class="comment" id="2090836">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Scale&nbsp;x&nbsp;to&nbsp;y&nbsp;in&nbsp;[1,4)&nbsp;with&nbsp;even&nbsp;powers&nbsp;of&nbsp;2:</span><br>
<span class="lineno">30</span><span class="comment" id="2090889">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;find&nbsp;an&nbsp;integer&nbsp;k&nbsp;such&nbsp;that&nbsp;&nbsp;1&nbsp;&lt;=&nbsp;(y=x*2**(2k))&nbsp;&lt;&nbsp;4,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="2090955">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sqrt(x)&nbsp;=&nbsp;2**k&nbsp;*&nbsp;sqrt(y)</span><br>
<span class="lineno"></span><span class="comment" id="2090996">//&nbsp;&nbsp;&nbsp;2.&nbsp;Bit&nbsp;by&nbsp;bit&nbsp;computation</span><br>
<span class="lineno"></span><span class="comment" id="2091027">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Let&nbsp;q&nbsp;&nbsp;=&nbsp;sqrt(y)&nbsp;truncated&nbsp;to&nbsp;i&nbsp;bit&nbsp;after&nbsp;binary&nbsp;point&nbsp;(q&nbsp;=&nbsp;1),</span><br>
<span class="lineno"></span><span class="comment" id="2091099">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno">35</span><span class="comment" id="2091166">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2091219">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;&nbsp;=&nbsp;2*q&nbsp;,&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;=&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;*&nbsp;(&nbsp;y&nbsp;-&nbsp;q&nbsp;&nbsp;).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(1)</span><br>
<span class="lineno"></span><span class="comment" id="2091288">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2091341">//</span><br>
<span class="lineno"></span><span class="comment" id="2091344">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To&nbsp;compute&nbsp;q&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;q&nbsp;,&nbsp;one&nbsp;checks&nbsp;whether</span><br>
<span class="lineno">40</span><span class="comment" id="2091396">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2091428">//</span><br>
<span class="lineno"></span><span class="comment" id="2091431">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-(i+1)&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="2091470">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(q&nbsp;+&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)&nbsp;&nbsp;&lt;=&nbsp;y.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(2)</span><br>
<span class="lineno"></span><span class="comment" id="2091539">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno">45</span><span class="comment" id="2091567">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-(i+1)</span><br>
<span class="lineno"></span><span class="comment" id="2091636">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;(2)&nbsp;is&nbsp;false,&nbsp;then&nbsp;q&nbsp;&nbsp;&nbsp;=&nbsp;q&nbsp;;&nbsp;otherwise&nbsp;q&nbsp;&nbsp;&nbsp;=&nbsp;q&nbsp;&nbsp;+&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.</span><br>
<span class="lineno"></span><span class="comment" id="2091706">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2091765">//</span><br>
<span class="lineno"></span><span class="comment" id="2091768">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;With&nbsp;some&nbsp;algebraic&nbsp;manipulation,&nbsp;it&nbsp;is&nbsp;not&nbsp;difficult&nbsp;to&nbsp;see</span><br>
<span class="lineno">50</span><span class="comment" id="2091837">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;(2)&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2091871">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-(i+1)</span><br>
<span class="lineno"></span><span class="comment" id="2091909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;&nbsp;+&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;=&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(3)</span><br>
<span class="lineno"></span><span class="comment" id="2091978">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2092022">//</span><br>
<span class="lineno">55</span><span class="comment" id="2092025">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;advantage&nbsp;of&nbsp;(3)&nbsp;is&nbsp;that&nbsp;s&nbsp;&nbsp;and&nbsp;y&nbsp;&nbsp;can&nbsp;be&nbsp;computed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2092091">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2092138">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;following&nbsp;recurrence&nbsp;formula:</span><br>
<span class="lineno"></span><span class="comment" id="2092180">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(3)&nbsp;is&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="2092208">//</span><br>
<span class="lineno">60</span><span class="comment" id="2092211">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;s&nbsp;&nbsp;,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;y&nbsp;&nbsp;&nbsp;;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(4)</span><br>
<span class="lineno"></span><span class="comment" id="2092280">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2092322">//</span><br>
<span class="lineno"></span><span class="comment" id="2092325">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;otherwise,</span><br>
<span class="lineno"></span><span class="comment" id="2092344">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-(i+1)</span><br>
<span class="lineno">65</span><span class="comment" id="2092402">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;s&nbsp;&nbsp;+&nbsp;2&nbsp;&nbsp;,&nbsp;&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;y&nbsp;&nbsp;-&nbsp;&nbsp;s&nbsp;&nbsp;-&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5)</span><br>
<span class="lineno"></span><span class="comment" id="2092471">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i+1&nbsp;&nbsp;&nbsp;&nbsp;i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i</span><br>
<span class="lineno"></span><span class="comment" id="2092519">//</span><br>
<span class="lineno"></span><span class="comment" id="2092522">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;One&nbsp;may&nbsp;easily&nbsp;use&nbsp;induction&nbsp;to&nbsp;prove&nbsp;(4)&nbsp;and&nbsp;(5).</span><br>
<span class="lineno"></span><span class="comment" id="2092581">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Note.&nbsp;Since&nbsp;the&nbsp;left&nbsp;hand&nbsp;side&nbsp;of&nbsp;(3)&nbsp;contain&nbsp;only&nbsp;i+2&nbsp;bits,</span><br>
<span class="lineno">70</span><span class="comment" id="2092650">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;does&nbsp;not&nbsp;necessary&nbsp;to&nbsp;do&nbsp;a&nbsp;full&nbsp;(53-bit)&nbsp;comparison</span><br>
<span class="lineno"></span><span class="comment" id="2092719">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;in&nbsp;(3).</span><br>
<span class="lineno"></span><span class="comment" id="2092741">//&nbsp;&nbsp;&nbsp;3.&nbsp;Final&nbsp;rounding</span><br>
<span class="lineno"></span><span class="comment" id="2092764">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;After&nbsp;generating&nbsp;the&nbsp;53&nbsp;bits&nbsp;result,&nbsp;we&nbsp;compute&nbsp;one&nbsp;more&nbsp;bit.</span><br>
<span class="lineno"></span><span class="comment" id="2092834">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Together&nbsp;with&nbsp;the&nbsp;remainder,&nbsp;we&nbsp;can&nbsp;decide&nbsp;whether&nbsp;the</span><br>
<span class="lineno">75</span><span class="comment" id="2092897">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;is&nbsp;exact,&nbsp;bigger&nbsp;than&nbsp;1/2ulp,&nbsp;or&nbsp;less&nbsp;than&nbsp;1/2ulp</span><br>
<span class="lineno"></span><span class="comment" id="2092962">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(it&nbsp;will&nbsp;never&nbsp;equal&nbsp;to&nbsp;1/2ulp).</span><br>
<span class="lineno"></span><span class="comment" id="2093003">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;rounding&nbsp;mode&nbsp;can&nbsp;be&nbsp;detected&nbsp;by&nbsp;checking&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="2093065">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;huge&nbsp;+&nbsp;tiny&nbsp;is&nbsp;equal&nbsp;to&nbsp;huge,&nbsp;and&nbsp;whether&nbsp;huge&nbsp;-&nbsp;tiny&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2093130">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;equal&nbsp;to&nbsp;huge&nbsp;for&nbsp;some&nbsp;floating&nbsp;point&nbsp;number&nbsp;&#34;huge&#34;&nbsp;and&nbsp;&#34;tiny&#34;.</span><br>
<span class="lineno">80</span><span class="comment" id="2093202">//</span><br>
<span class="lineno"></span><span class="comment" id="2093205">//</span><br>
<span class="lineno"></span><span class="comment" id="2093208">//&nbsp;Notes:&nbsp;&nbsp;Rounding&nbsp;mode&nbsp;detection&nbsp;omitted.&nbsp;&nbsp;The&nbsp;constants&nbsp;&#34;mask&#34;,&nbsp;&#34;shift&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2093284">//&nbsp;and&nbsp;&#34;bias&#34;&nbsp;are&nbsp;found&nbsp;in&nbsp;src/math/bits.go</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2093329">//&nbsp;Sqrt&nbsp;returns&nbsp;the&nbsp;square&nbsp;root&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="2093367">//</span><br>
<span class="lineno"></span><span class="comment" id="2093370">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="2093392">//&nbsp;&nbsp;&nbsp;&nbspSqrt(+Inf)&nbsp;=&nbsp;+Inf</span><br>
<span class="lineno"></span><span class="comment" id="2093413">//&nbsp;&nbsp;&nbsp;&nbspSqrt(±0)&nbsp;=&nbsp;±0</span><br>
<span class="lineno">90</span><span class="comment" id="2093432">//&nbsp;&nbsp;&nbsp;&nbspSqrt(x&nbsp;&lt;&nbsp;0)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="comment" id="2093453">//&nbsp;&nbsp;&nbsp;&nbspSqrt(NaN)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="keyword" id="2093472">func</span>&nbsp;<span class="ident" id="2093477">Sqrt</span><span class="op" id="2093481">(</span><span class="ident" id="2093482">x</span>&nbsp;<span class="builtintype" id="2093484">float64</span><span class="op" id="2093491">)</span>&nbsp;<span class="builtintype" id="2093493">float64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2093502">func</span>&nbsp;<span class="ident" id="2093507">sqrt</span><span class="op" id="2093511">(</span><span class="ident" id="2093512">x</span>&nbsp;<span class="builtintype" id="2093514">float64</span><span class="op" id="2093521">)</span>&nbsp;<span class="builtintype" id="2093523">float64</span>&nbsp;<span class="op" id="2093531">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2093534">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093552">switch</span>&nbsp;<span class="op" id="2093559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093562">case</span>&nbsp;<span class="ident" id="2093567">x</span>&nbsp;<span class="op" id="2093569">==</span>&nbsp;<span class="num" id="2093572">0</span>&nbsp;<span class="op" id="2093574">||</span>&nbsp;<span class="ident" id="2093577">IsNaN</span><span class="op" id="2093582">(</span><span class="ident" id="2093583">x</span><span class="op" id="2093584">)</span>&nbsp;<span class="op" id="2093586">||</span>&nbsp;<span class="ident" id="2093589">IsInf</span><span class="op" id="2093594">(</span><span class="ident" id="2093595">x</span><span class="op" id="2093596">,</span>&nbsp;<span class="num" id="2093598">1</span><span class="op" id="2093599">)</span><span class="op" id="2093600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093604">return</span>&nbsp;<span class="ident" id="2093611">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093614">case</span>&nbsp;<span class="ident" id="2093619">x</span>&nbsp;<span class="op" id="2093621">&lt;</span>&nbsp;<span class="num" id="2093623">0</span><span class="op" id="2093624">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093628">return</span>&nbsp;<span class="ident" id="2093635">NaN</span><span class="op" id="2093638">(</span><span class="op" id="2093639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2093642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093645">ix</span>&nbsp;<span class="op" id="2093648">:=</span>&nbsp;<span class="ident" id="2093651">Float64bits</span><span class="op" id="2093662">(</span><span class="ident" id="2093663">x</span><span class="op" id="2093664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2093667">//&nbsp;normalize&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093683">exp</span>&nbsp;<span class="op" id="2093687">:=</span>&nbsp;<span class="builtintype" id="2093690">int</span><span class="op" id="2093693">(</span><span class="op" id="2093694">(</span><span class="ident" id="2093695">ix</span>&nbsp;<span class="op" id="2093698">&gt;&gt;</span>&nbsp;<span class="ident" id="2093701">shift</span><span class="op" id="2093706">)</span>&nbsp;<span class="op" id="2093708">&amp;</span>&nbsp;<span class="ident" id="2093710">mask</span><span class="op" id="2093714">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093717">if</span>&nbsp;<span class="ident" id="2093720">exp</span>&nbsp;<span class="op" id="2093724">==</span>&nbsp;<span class="num" id="2093727">0</span>&nbsp;<span class="op" id="2093729">{</span>&nbsp;<span class="comment" id="2093731">//&nbsp;subnormal&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093748">for</span>&nbsp;<span class="ident" id="2093752">ix</span><span class="op" id="2093754">&amp;</span><span class="num" id="2093755">1</span><span class="op" id="2093756">&lt;&lt;</span><span class="ident" id="2093758">shift</span>&nbsp;<span class="op" id="2093764">==</span>&nbsp;<span class="num" id="2093767">0</span>&nbsp;<span class="op" id="2093769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093774">ix</span>&nbsp;<span class="op" id="2093777">&lt;&lt;=</span>&nbsp;<span class="num" id="2093781">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093786">exp</span><span class="op" id="2093789">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2093794">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093798">exp</span><span class="op" id="2093801">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2093805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093808">exp</span>&nbsp;<span class="op" id="2093812">-=</span>&nbsp;<span class="ident" id="2093815">bias</span>&nbsp;<span class="comment" id="2093820">//&nbsp;unbias&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093840">ix</span>&nbsp;<span class="op" id="2093843">&amp;^=</span>&nbsp;<span class="ident" id="2093847">mask</span>&nbsp;<span class="op" id="2093852">&lt;&lt;</span>&nbsp;<span class="ident" id="2093855">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093862">ix</span>&nbsp;<span class="op" id="2093865">|=</span>&nbsp;<span class="num" id="2093868">1</span>&nbsp;<span class="op" id="2093870">&lt;&lt;</span>&nbsp;<span class="ident" id="2093873">shift</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2093880">if</span>&nbsp;<span class="ident" id="2093883">exp</span><span class="op" id="2093886">&amp;</span><span class="num" id="2093887">1</span>&nbsp;<span class="op" id="2093889">==</span>&nbsp;<span class="num" id="2093892">1</span>&nbsp;<span class="op" id="2093894">{</span>&nbsp;<span class="comment" id="2093896">//&nbsp;odd&nbsp;exp,&nbsp;double&nbsp;x&nbsp;to&nbsp;make&nbsp;it&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093935">ix</span>&nbsp;<span class="op" id="2093938">&lt;&lt;=</span>&nbsp;<span class="num" id="2093942">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2093945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2093948">exp</span>&nbsp;<span class="op" id="2093952">&gt;&gt;=</span>&nbsp;<span class="num" id="2093956">1</span>&nbsp;<span class="comment" id="2093958">//&nbsp;exp&nbsp;=&nbsp;exp/2,&nbsp;exponent&nbsp;of&nbsp;square&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2093999">//&nbsp;generate&nbsp;sqrt(x)&nbsp;bit&nbsp;by&nbsp;bit</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094031">ix</span>&nbsp;<span class="op" id="2094034">&lt;&lt;=</span>&nbsp;<span class="num" id="2094038">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094041">var</span>&nbsp;<span class="ident" id="2094045">q</span><span class="op" id="2094046">,</span>&nbsp;<span class="ident" id="2094048">s</span>&nbsp;<span class="ident" id="2094050">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2094071">//&nbsp;q&nbsp;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094087">r</span>&nbsp;<span class="op" id="2094089">:=</span>&nbsp;<span class="ident" id="2094092">uint64</span><span class="op" id="2094098">(</span><span class="num" id="2094099">1</span>&nbsp;<span class="op" id="2094101">&lt;&lt;</span>&nbsp;<span class="op" id="2094104">(</span><span class="ident" id="2094105">shift</span>&nbsp;<span class="op" id="2094111">+</span>&nbsp;<span class="num" id="2094113">1</span><span class="op" id="2094114">)</span><span class="op" id="2094115">)</span>&nbsp;<span class="comment" id="2094117">//&nbsp;r&nbsp;=&nbsp;moving&nbsp;bit&nbsp;from&nbsp;MSB&nbsp;to&nbsp;LSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094152">for</span>&nbsp;<span class="ident" id="2094156">r</span>&nbsp;<span class="op" id="2094158">!=</span>&nbsp;<span class="num" id="2094161">0</span>&nbsp;<span class="op" id="2094163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094167">t</span>&nbsp;<span class="op" id="2094169">:=</span>&nbsp;<span class="ident" id="2094172">s</span>&nbsp;<span class="op" id="2094174">+</span>&nbsp;<span class="ident" id="2094176">r</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094180">if</span>&nbsp;<span class="ident" id="2094183">t</span>&nbsp;<span class="op" id="2094185">&lt;=</span>&nbsp;<span class="ident" id="2094188">ix</span>&nbsp;<span class="op" id="2094191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094196">s</span>&nbsp;<span class="op" id="2094198">=</span>&nbsp;<span class="ident" id="2094200">t</span>&nbsp;<span class="op" id="2094202">+</span>&nbsp;<span class="ident" id="2094204">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094209">ix</span>&nbsp;<span class="op" id="2094212">-=</span>&nbsp;<span class="ident" id="2094215">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094220">q</span>&nbsp;<span class="op" id="2094222">+=</span>&nbsp;<span class="ident" id="2094225">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094229">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094233">ix</span>&nbsp;<span class="op" id="2094236">&lt;&lt;=</span>&nbsp;<span class="num" id="2094240">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094244">r</span>&nbsp;<span class="op" id="2094246">&gt;&gt;=</span>&nbsp;<span class="num" id="2094250">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2094256">//&nbsp;final&nbsp;rounding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094275">if</span>&nbsp;<span class="ident" id="2094278">ix</span>&nbsp;<span class="op" id="2094281">!=</span>&nbsp;<span class="num" id="2094284">0</span>&nbsp;<span class="op" id="2094286">{</span>&nbsp;<span class="comment" id="2094288">//&nbsp;remainder,&nbsp;result&nbsp;not&nbsp;exact</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094321">q</span>&nbsp;<span class="op" id="2094323">+=</span>&nbsp;<span class="ident" id="2094326">q</span>&nbsp;<span class="op" id="2094328">&amp;</span>&nbsp;<span class="num" id="2094330">1</span>&nbsp;<span class="comment" id="2094332">//&nbsp;round&nbsp;according&nbsp;to&nbsp;extra&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2094368">ix</span>&nbsp;<span class="op" id="2094371">=</span>&nbsp;<span class="ident" id="2094373">q</span><span class="op" id="2094374">&gt;&gt;</span><span class="num" id="2094376">1</span>&nbsp;<span class="op" id="2094378">+</span>&nbsp;<span class="ident" id="2094380">uint64</span><span class="op" id="2094386">(</span><span class="ident" id="2094387">exp</span><span class="op" id="2094390">-</span><span class="num" id="2094391">1</span><span class="op" id="2094392">+</span><span class="ident" id="2094393">bias</span><span class="op" id="2094397">)</span><span class="op" id="2094398">&lt;&lt;</span><span class="ident" id="2094400">shift</span>&nbsp;<span class="comment" id="2094406">//&nbsp;significand&nbsp;+&nbsp;biased&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2094440">return</span>&nbsp;<span class="ident" id="2094447">Float64frombits</span><span class="op" id="2094462">(</span><span class="ident" id="2094463">ix</span><span class="op" id="2094465">)</span><br>
<span class="lineno"></span><span class="op" id="2094467">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="2094470">func</span>&nbsp;<span class="ident" id="2094475">sqrtC</span><span class="op" id="2094480">(</span><span class="ident" id="2094481">f</span>&nbsp;<span class="builtintype" id="2094483">float64</span><span class="op" id="2094490">,</span>&nbsp;<span class="ident" id="2094492">r</span>&nbsp;<span class="op" id="2094494">*</span><span class="builtintype" id="2094495">float64</span><span class="op" id="2094502">)</span>&nbsp;<span class="op" id="2094504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2094507">*</span><span class="ident" id="2094508">r</span>&nbsp;<span class="op" id="2094510">=</span>&nbsp;<span class="ident" id="2094512">sqrt</span><span class="op" id="2094516">(</span><span class="ident" id="2094517">f</span><span class="op" id="2094518">)</span><br>
<span class="lineno"></span><span class="op" id="2094520">}</span>
</div>
</body>
</html>
