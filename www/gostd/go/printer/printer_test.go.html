<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6432582">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6432637">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6432691">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6432742">package</span>&nbsp;<span class="ident" id="6432750">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6432759">import</span>&nbsp;<span class="op" id="6432766">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432769">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432778">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432788">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432796">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432803">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432813">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432826">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432838">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432851">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432868">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6432879">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6432886">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6432889">const</span>&nbsp;<span class="op" id="6432895">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432898">dataDir</span>&nbsp;&nbsp;<span class="op" id="6432907">=</span>&nbsp;<span class="string" id="6432909">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6432921">tabwidth</span>&nbsp;<span class="op" id="6432930">=</span>&nbsp;<span class="num" id="6432932">8</span><br>
<span class="lineno"></span><span class="op" id="6432934">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="6432937">var</span>&nbsp;<span class="ident" id="6432941">update</span>&nbsp;<span class="op" id="6432948">=</span>&nbsp;<span class="ident" id="6432950">flag</span><span class="op" id="6432954">.</span><span class="ident" id="6432955">Bool</span><span class="op" id="6432959">(</span><span class="string" id="6432960">&#34;update&#34;</span><span class="op" id="6432968">,</span>&nbsp;<span class="builtintype" id="6432970">false</span><span class="op" id="6432975">,</span>&nbsp;<span class="string" id="6432977">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="6432998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6433001">var</span>&nbsp;<span class="ident" id="6433005">fset</span>&nbsp;<span class="op" id="6433010">=</span>&nbsp;<span class="ident" id="6433012">token</span><span class="op" id="6433017">.</span><span class="ident" id="6433018">NewFileSet</span><span class="op" id="6433028">(</span><span class="op" id="6433029">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6433032">type</span>&nbsp;<span class="ident" id="6433037">checkMode</span>&nbsp;<span class="builtintype" id="6433047">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6433053">const</span>&nbsp;<span class="op" id="6433059">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433062">export</span>&nbsp;<span class="ident" id="6433069">checkMode</span>&nbsp;<span class="op" id="6433079">=</span>&nbsp;<span class="num" id="6433081">1</span>&nbsp;<span class="op" id="6433083">&lt;&lt;</span>&nbsp;<span class="ident" id="6433086">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433092">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433103">idempotent</span><br>
<span class="lineno"></span><span class="op" id="6433114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6433117">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="6433192">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="6433267">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="6433278">func</span>&nbsp;<span class="ident" id="6433283">format</span><span class="op" id="6433289">(</span><span class="ident" id="6433290">src</span>&nbsp;<span class="op" id="6433294">[</span><span class="op" id="6433295">]</span><span class="builtintype" id="6433296">byte</span><span class="op" id="6433300">,</span>&nbsp;<span class="ident" id="6433302">mode</span>&nbsp;<span class="ident" id="6433307">checkMode</span><span class="op" id="6433316">)</span>&nbsp;<span class="op" id="6433318">(</span><span class="op" id="6433319">[</span><span class="op" id="6433320">]</span><span class="builtintype" id="6433321">byte</span><span class="op" id="6433325">,</span>&nbsp;<span class="builtintype" id="6433327">error</span><span class="op" id="6433332">)</span>&nbsp;<span class="op" id="6433334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6433337">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433351">f</span><span class="op" id="6433352">,</span>&nbsp;<span class="ident" id="6433354">err</span>&nbsp;<span class="op" id="6433358">:=</span>&nbsp;<span class="ident" id="6433361">parser</span><span class="op" id="6433367">.</span><span class="ident" id="6433368">ParseFile</span><span class="op" id="6433377">(</span><span class="ident" id="6433378">fset</span><span class="op" id="6433382">,</span>&nbsp;<span class="string" id="6433384">&#34;&#34;</span><span class="op" id="6433386">,</span>&nbsp;<span class="ident" id="6433388">src</span><span class="op" id="6433391">,</span>&nbsp;<span class="ident" id="6433393">parser</span><span class="op" id="6433399">.</span><span class="ident" id="6433400">ParseComments</span><span class="op" id="6433413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433416">if</span>&nbsp;<span class="ident" id="6433419">err</span>&nbsp;<span class="op" id="6433423">!=</span>&nbsp;<span class="ident" id="6433426">nil</span>&nbsp;<span class="op" id="6433430">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433434">return</span>&nbsp;<span class="ident" id="6433441">nil</span><span class="op" id="6433444">,</span>&nbsp;<span class="ident" id="6433446">fmt</span><span class="op" id="6433449">.</span><span class="ident" id="6433450">Errorf</span><span class="op" id="6433456">(</span><span class="string" id="6433457">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="6433472">,</span>&nbsp;<span class="ident" id="6433474">err</span><span class="op" id="6433477">,</span>&nbsp;<span class="ident" id="6433479">src</span><span class="op" id="6433482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6433485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6433489">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433521">if</span>&nbsp;<span class="ident" id="6433524">mode</span><span class="op" id="6433528">&amp;</span><span class="ident" id="6433529">export</span>&nbsp;<span class="op" id="6433536">!=</span>&nbsp;<span class="num" id="6433539">0</span>&nbsp;<span class="op" id="6433541">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433545">ast</span><span class="op" id="6433548">.</span><span class="ident" id="6433549">FileExports</span><span class="op" id="6433560">(</span><span class="ident" id="6433561">f</span><span class="op" id="6433562">)</span>&nbsp;<span class="comment" id="6433564">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433583">f</span><span class="op" id="6433584">.</span><span class="ident" id="6433585">Comments</span>&nbsp;<span class="op" id="6433594">=</span>&nbsp;<span class="ident" id="6433596">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6433602">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6433647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6433651">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433687">cfg</span>&nbsp;<span class="op" id="6433691">:=</span>&nbsp;<span class="ident" id="6433694">Config</span><span class="op" id="6433700">{</span><span class="ident" id="6433701">Tabwidth</span><span class="op" id="6433709">:</span>&nbsp;<span class="ident" id="6433711">tabwidth</span><span class="op" id="6433719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433722">if</span>&nbsp;<span class="ident" id="6433725">mode</span><span class="op" id="6433729">&amp;</span><span class="ident" id="6433730">rawFormat</span>&nbsp;<span class="op" id="6433740">!=</span>&nbsp;<span class="num" id="6433743">0</span>&nbsp;<span class="op" id="6433745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433749">cfg</span><span class="op" id="6433752">.</span><span class="ident" id="6433753">Mode</span>&nbsp;<span class="op" id="6433758">|=</span>&nbsp;<span class="ident" id="6433761">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6433772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6433776">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433790">var</span>&nbsp;<span class="ident" id="6433794">buf</span>&nbsp;<span class="ident" id="6433798">bytes</span><span class="op" id="6433803">.</span><span class="ident" id="6433804">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433812">if</span>&nbsp;<span class="ident" id="6433815">err</span>&nbsp;<span class="op" id="6433819">:=</span>&nbsp;<span class="ident" id="6433822">cfg</span><span class="op" id="6433825">.</span><span class="ident" id="6433826">Fprint</span><span class="op" id="6433832">(</span><span class="op" id="6433833">&amp;</span><span class="ident" id="6433834">buf</span><span class="op" id="6433837">,</span>&nbsp;<span class="ident" id="6433839">fset</span><span class="op" id="6433843">,</span>&nbsp;<span class="ident" id="6433845">f</span><span class="op" id="6433846">)</span><span class="op" id="6433847">;</span>&nbsp;<span class="ident" id="6433849">err</span>&nbsp;<span class="op" id="6433853">!=</span>&nbsp;<span class="ident" id="6433856">nil</span>&nbsp;<span class="op" id="6433860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433864">return</span>&nbsp;<span class="ident" id="6433871">nil</span><span class="op" id="6433874">,</span>&nbsp;<span class="ident" id="6433876">fmt</span><span class="op" id="6433879">.</span><span class="ident" id="6433880">Errorf</span><span class="op" id="6433886">(</span><span class="string" id="6433887">&#34;print:&nbsp;%s&#34;</span><span class="op" id="6433898">,</span>&nbsp;<span class="ident" id="6433900">err</span><span class="op" id="6433903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6433906">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6433910">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6433966">res</span>&nbsp;<span class="op" id="6433970">:=</span>&nbsp;<span class="ident" id="6433973">buf</span><span class="op" id="6433976">.</span><span class="ident" id="6433977">Bytes</span><span class="op" id="6433982">(</span><span class="op" id="6433983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6433986">if</span>&nbsp;<span class="ident" id="6433989">_</span><span class="op" id="6433990">,</span>&nbsp;<span class="ident" id="6433992">err</span>&nbsp;<span class="op" id="6433996">:=</span>&nbsp;<span class="ident" id="6433999">parser</span><span class="op" id="6434005">.</span><span class="ident" id="6434006">ParseFile</span><span class="op" id="6434015">(</span><span class="ident" id="6434016">fset</span><span class="op" id="6434020">,</span>&nbsp;<span class="string" id="6434022">&#34;&#34;</span><span class="op" id="6434024">,</span>&nbsp;<span class="ident" id="6434026">res</span><span class="op" id="6434029">,</span>&nbsp;<span class="num" id="6434031">0</span><span class="op" id="6434032">)</span><span class="op" id="6434033">;</span>&nbsp;<span class="ident" id="6434035">err</span>&nbsp;<span class="op" id="6434039">!=</span>&nbsp;<span class="ident" id="6434042">nil</span>&nbsp;<span class="op" id="6434046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434050">return</span>&nbsp;<span class="ident" id="6434057">nil</span><span class="op" id="6434060">,</span>&nbsp;<span class="ident" id="6434062">fmt</span><span class="op" id="6434065">.</span><span class="ident" id="6434066">Errorf</span><span class="op" id="6434072">(</span><span class="string" id="6434073">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="6434091">,</span>&nbsp;<span class="ident" id="6434093">err</span><span class="op" id="6434096">,</span>&nbsp;<span class="ident" id="6434098">buf</span><span class="op" id="6434101">.</span><span class="ident" id="6434102">Bytes</span><span class="op" id="6434107">(</span><span class="op" id="6434108">)</span><span class="op" id="6434109">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6434112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434116">return</span>&nbsp;<span class="ident" id="6434123">res</span><span class="op" id="6434126">,</span>&nbsp;<span class="ident" id="6434128">nil</span><br>
<span class="lineno"></span><span class="op" id="6434132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6434135">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="6434195">func</span>&nbsp;<span class="ident" id="6434200">lineAt</span><span class="op" id="6434206">(</span><span class="ident" id="6434207">text</span>&nbsp;<span class="op" id="6434212">[</span><span class="op" id="6434213">]</span><span class="builtintype" id="6434214">byte</span><span class="op" id="6434218">,</span>&nbsp;<span class="ident" id="6434220">offs</span>&nbsp;<span class="builtintype" id="6434225">int</span><span class="op" id="6434228">)</span>&nbsp;<span class="op" id="6434230">[</span><span class="op" id="6434231">]</span><span class="builtintype" id="6434232">byte</span>&nbsp;<span class="op" id="6434237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434240">i</span>&nbsp;<span class="op" id="6434242">:=</span>&nbsp;<span class="ident" id="6434245">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434251">for</span>&nbsp;<span class="ident" id="6434255">i</span>&nbsp;<span class="op" id="6434257">&lt;</span>&nbsp;<span class="builtinfunc" id="6434259">len</span><span class="op" id="6434262">(</span><span class="ident" id="6434263">text</span><span class="op" id="6434267">)</span>&nbsp;<span class="op" id="6434269">&amp;&amp;</span>&nbsp;<span class="ident" id="6434272">text</span><span class="op" id="6434276">[</span><span class="ident" id="6434277">i</span><span class="op" id="6434278">]</span>&nbsp;<span class="op" id="6434280">!=</span>&nbsp;<span class="string" id="6434283">&#39;\n&#39;</span>&nbsp;<span class="op" id="6434288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434292">i</span><span class="op" id="6434293">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6434297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434300">return</span>&nbsp;<span class="ident" id="6434307">text</span><span class="op" id="6434311">[</span><span class="ident" id="6434312">offs</span><span class="op" id="6434316">:</span><span class="ident" id="6434317">i</span><span class="op" id="6434318">]</span><br>
<span class="lineno"></span><span class="op" id="6434320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6434323">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="6434349">func</span>&nbsp;<span class="ident" id="6434354">diff</span><span class="op" id="6434358">(</span><span class="ident" id="6434359">aname</span><span class="op" id="6434364">,</span>&nbsp;<span class="ident" id="6434366">bname</span>&nbsp;<span class="builtintype" id="6434372">string</span><span class="op" id="6434378">,</span>&nbsp;<span class="ident" id="6434380">a</span><span class="op" id="6434381">,</span>&nbsp;<span class="ident" id="6434383">b</span>&nbsp;<span class="op" id="6434385">[</span><span class="op" id="6434386">]</span><span class="builtintype" id="6434387">byte</span><span class="op" id="6434391">)</span>&nbsp;<span class="builtintype" id="6434393">error</span>&nbsp;<span class="op" id="6434399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434402">var</span>&nbsp;<span class="ident" id="6434406">buf</span>&nbsp;<span class="ident" id="6434410">bytes</span><span class="op" id="6434415">.</span><span class="ident" id="6434416">Buffer</span>&nbsp;<span class="comment" id="6434423">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6434455">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434475">if</span>&nbsp;<span class="builtinfunc" id="6434478">len</span><span class="op" id="6434481">(</span><span class="ident" id="6434482">a</span><span class="op" id="6434483">)</span>&nbsp;<span class="op" id="6434485">!=</span>&nbsp;<span class="builtinfunc" id="6434488">len</span><span class="op" id="6434491">(</span><span class="ident" id="6434492">b</span><span class="op" id="6434493">)</span>&nbsp;<span class="op" id="6434495">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434499">fmt</span><span class="op" id="6434502">.</span><span class="ident" id="6434503">Fprintf</span><span class="op" id="6434510">(</span><span class="op" id="6434511">&amp;</span><span class="ident" id="6434512">buf</span><span class="op" id="6434515">,</span>&nbsp;<span class="string" id="6434517">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6434563">,</span>&nbsp;<span class="ident" id="6434565">aname</span><span class="op" id="6434570">,</span>&nbsp;<span class="builtinfunc" id="6434572">len</span><span class="op" id="6434575">(</span><span class="ident" id="6434576">a</span><span class="op" id="6434577">)</span><span class="op" id="6434578">,</span>&nbsp;<span class="ident" id="6434580">bname</span><span class="op" id="6434585">,</span>&nbsp;<span class="builtinfunc" id="6434587">len</span><span class="op" id="6434590">(</span><span class="ident" id="6434591">b</span><span class="op" id="6434592">)</span><span class="op" id="6434593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6434596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6434600">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434621">line</span>&nbsp;<span class="op" id="6434626">:=</span>&nbsp;<span class="num" id="6434629">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434632">offs</span>&nbsp;<span class="op" id="6434637">:=</span>&nbsp;<span class="num" id="6434640">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434643">for</span>&nbsp;<span class="ident" id="6434647">i</span>&nbsp;<span class="op" id="6434649">:=</span>&nbsp;<span class="num" id="6434652">0</span><span class="op" id="6434653">;</span>&nbsp;<span class="ident" id="6434655">i</span>&nbsp;<span class="op" id="6434657">&lt;</span>&nbsp;<span class="builtinfunc" id="6434659">len</span><span class="op" id="6434662">(</span><span class="ident" id="6434663">a</span><span class="op" id="6434664">)</span>&nbsp;<span class="op" id="6434666">&amp;&amp;</span>&nbsp;<span class="ident" id="6434669">i</span>&nbsp;<span class="op" id="6434671">&lt;</span>&nbsp;<span class="builtinfunc" id="6434673">len</span><span class="op" id="6434676">(</span><span class="ident" id="6434677">b</span><span class="op" id="6434678">)</span><span class="op" id="6434679">;</span>&nbsp;<span class="ident" id="6434681">i</span><span class="op" id="6434682">++</span>&nbsp;<span class="op" id="6434685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434689">ch</span>&nbsp;<span class="op" id="6434692">:=</span>&nbsp;<span class="ident" id="6434695">a</span><span class="op" id="6434696">[</span><span class="ident" id="6434697">i</span><span class="op" id="6434698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434702">if</span>&nbsp;<span class="ident" id="6434705">ch</span>&nbsp;<span class="op" id="6434708">!=</span>&nbsp;<span class="ident" id="6434711">b</span><span class="op" id="6434712">[</span><span class="ident" id="6434713">i</span><span class="op" id="6434714">]</span>&nbsp;<span class="op" id="6434716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434721">fmt</span><span class="op" id="6434724">.</span><span class="ident" id="6434725">Fprintf</span><span class="op" id="6434732">(</span><span class="op" id="6434733">&amp;</span><span class="ident" id="6434734">buf</span><span class="op" id="6434737">,</span>&nbsp;<span class="string" id="6434739">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="6434755">,</span>&nbsp;<span class="ident" id="6434757">aname</span><span class="op" id="6434762">,</span>&nbsp;<span class="ident" id="6434764">line</span><span class="op" id="6434768">,</span>&nbsp;<span class="ident" id="6434770">i</span><span class="op" id="6434771">-</span><span class="ident" id="6434772">offs</span><span class="op" id="6434776">+</span><span class="num" id="6434777">1</span><span class="op" id="6434778">,</span>&nbsp;<span class="ident" id="6434780">lineAt</span><span class="op" id="6434786">(</span><span class="ident" id="6434787">a</span><span class="op" id="6434788">,</span>&nbsp;<span class="ident" id="6434790">offs</span><span class="op" id="6434794">)</span><span class="op" id="6434795">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434800">fmt</span><span class="op" id="6434803">.</span><span class="ident" id="6434804">Fprintf</span><span class="op" id="6434811">(</span><span class="op" id="6434812">&amp;</span><span class="ident" id="6434813">buf</span><span class="op" id="6434816">,</span>&nbsp;<span class="string" id="6434818">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="6434834">,</span>&nbsp;<span class="ident" id="6434836">bname</span><span class="op" id="6434841">,</span>&nbsp;<span class="ident" id="6434843">line</span><span class="op" id="6434847">,</span>&nbsp;<span class="ident" id="6434849">i</span><span class="op" id="6434850">-</span><span class="ident" id="6434851">offs</span><span class="op" id="6434855">+</span><span class="num" id="6434856">1</span><span class="op" id="6434857">,</span>&nbsp;<span class="ident" id="6434859">lineAt</span><span class="op" id="6434865">(</span><span class="ident" id="6434866">b</span><span class="op" id="6434867">,</span>&nbsp;<span class="ident" id="6434869">offs</span><span class="op" id="6434873">)</span><span class="op" id="6434874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434879">fmt</span><span class="op" id="6434882">.</span><span class="ident" id="6434883">Fprintf</span><span class="op" id="6434890">(</span><span class="op" id="6434891">&amp;</span><span class="ident" id="6434892">buf</span><span class="op" id="6434895">,</span>&nbsp;<span class="string" id="6434897">&#34;\n\n&#34;</span><span class="op" id="6434903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434908">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6434916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434920">if</span>&nbsp;<span class="ident" id="6434923">ch</span>&nbsp;<span class="op" id="6434926">==</span>&nbsp;<span class="string" id="6434929">&#39;\n&#39;</span>&nbsp;<span class="op" id="6434934">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434939">line</span><span class="op" id="6434943">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6434949">offs</span>&nbsp;<span class="op" id="6434954">=</span>&nbsp;<span class="ident" id="6434956">i</span>&nbsp;<span class="op" id="6434958">+</span>&nbsp;<span class="num" id="6434960">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6434964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6434967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434971">if</span>&nbsp;<span class="ident" id="6434974">buf</span><span class="op" id="6434977">.</span><span class="ident" id="6434978">Len</span><span class="op" id="6434981">(</span><span class="op" id="6434982">)</span>&nbsp;<span class="op" id="6434984">&gt;</span>&nbsp;<span class="num" id="6434986">0</span>&nbsp;<span class="op" id="6434988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6434992">return</span>&nbsp;<span class="ident" id="6434999">errors</span><span class="op" id="6435005">.</span><span class="ident" id="6435006">New</span><span class="op" id="6435009">(</span><span class="ident" id="6435010">buf</span><span class="op" id="6435013">.</span><span class="ident" id="6435014">String</span><span class="op" id="6435020">(</span><span class="op" id="6435021">)</span><span class="op" id="6435022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435028">return</span>&nbsp;<span class="ident" id="6435035">nil</span><br>
<span class="lineno"></span><span class="op" id="6435039">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="6435042">func</span>&nbsp;<span class="ident" id="6435047">runcheck</span><span class="op" id="6435055">(</span><span class="ident" id="6435056">t</span>&nbsp;<span class="op" id="6435058">*</span><span class="ident" id="6435059">testing</span><span class="op" id="6435066">.</span><span class="ident" id="6435067">T</span><span class="op" id="6435068">,</span>&nbsp;<span class="ident" id="6435070">source</span><span class="op" id="6435076">,</span>&nbsp;<span class="ident" id="6435078">golden</span>&nbsp;<span class="builtintype" id="6435085">string</span><span class="op" id="6435091">,</span>&nbsp;<span class="ident" id="6435093">mode</span>&nbsp;<span class="ident" id="6435098">checkMode</span><span class="op" id="6435107">)</span>&nbsp;<span class="op" id="6435109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435112">src</span><span class="op" id="6435115">,</span>&nbsp;<span class="ident" id="6435117">err</span>&nbsp;<span class="op" id="6435121">:=</span>&nbsp;<span class="ident" id="6435124">ioutil</span><span class="op" id="6435130">.</span><span class="ident" id="6435131">ReadFile</span><span class="op" id="6435139">(</span><span class="ident" id="6435140">source</span><span class="op" id="6435146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435149">if</span>&nbsp;<span class="ident" id="6435152">err</span>&nbsp;<span class="op" id="6435156">!=</span>&nbsp;<span class="ident" id="6435159">nil</span>&nbsp;<span class="op" id="6435163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435167">t</span><span class="op" id="6435168">.</span><span class="ident" id="6435169">Error</span><span class="op" id="6435174">(</span><span class="ident" id="6435175">err</span><span class="op" id="6435178">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435182">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435194">res</span><span class="op" id="6435197">,</span>&nbsp;<span class="ident" id="6435199">err</span>&nbsp;<span class="op" id="6435203">:=</span>&nbsp;<span class="ident" id="6435206">format</span><span class="op" id="6435212">(</span><span class="ident" id="6435213">src</span><span class="op" id="6435216">,</span>&nbsp;<span class="ident" id="6435218">mode</span><span class="op" id="6435222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435225">if</span>&nbsp;<span class="ident" id="6435228">err</span>&nbsp;<span class="op" id="6435232">!=</span>&nbsp;<span class="ident" id="6435235">nil</span>&nbsp;<span class="op" id="6435239">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435243">t</span><span class="op" id="6435244">.</span><span class="ident" id="6435245">Error</span><span class="op" id="6435250">(</span><span class="ident" id="6435251">err</span><span class="op" id="6435254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435258">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6435270">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435307">if</span>&nbsp;<span class="op" id="6435310">*</span><span class="ident" id="6435311">update</span>&nbsp;<span class="op" id="6435318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435322">if</span>&nbsp;<span class="ident" id="6435325">err</span>&nbsp;<span class="op" id="6435329">:=</span>&nbsp;<span class="ident" id="6435332">ioutil</span><span class="op" id="6435338">.</span><span class="ident" id="6435339">WriteFile</span><span class="op" id="6435348">(</span><span class="ident" id="6435349">golden</span><span class="op" id="6435355">,</span>&nbsp;<span class="ident" id="6435357">res</span><span class="op" id="6435360">,</span>&nbsp;<span class="num" id="6435362">0644</span><span class="op" id="6435366">)</span><span class="op" id="6435367">;</span>&nbsp;<span class="ident" id="6435369">err</span>&nbsp;<span class="op" id="6435373">!=</span>&nbsp;<span class="ident" id="6435376">nil</span>&nbsp;<span class="op" id="6435380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435385">t</span><span class="op" id="6435386">.</span><span class="ident" id="6435387">Error</span><span class="op" id="6435392">(</span><span class="ident" id="6435393">err</span><span class="op" id="6435396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435404">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6435416">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435431">gld</span><span class="op" id="6435434">,</span>&nbsp;<span class="ident" id="6435436">err</span>&nbsp;<span class="op" id="6435440">:=</span>&nbsp;<span class="ident" id="6435443">ioutil</span><span class="op" id="6435449">.</span><span class="ident" id="6435450">ReadFile</span><span class="op" id="6435458">(</span><span class="ident" id="6435459">golden</span><span class="op" id="6435465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435468">if</span>&nbsp;<span class="ident" id="6435471">err</span>&nbsp;<span class="op" id="6435475">!=</span>&nbsp;<span class="ident" id="6435478">nil</span>&nbsp;<span class="op" id="6435482">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435486">t</span><span class="op" id="6435487">.</span><span class="ident" id="6435488">Error</span><span class="op" id="6435493">(</span><span class="ident" id="6435494">err</span><span class="op" id="6435497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435501">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6435513">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435562">if</span>&nbsp;<span class="ident" id="6435565">err</span>&nbsp;<span class="op" id="6435569">:=</span>&nbsp;<span class="ident" id="6435572">diff</span><span class="op" id="6435576">(</span><span class="ident" id="6435577">source</span><span class="op" id="6435583">,</span>&nbsp;<span class="ident" id="6435585">golden</span><span class="op" id="6435591">,</span>&nbsp;<span class="ident" id="6435593">res</span><span class="op" id="6435596">,</span>&nbsp;<span class="ident" id="6435598">gld</span><span class="op" id="6435601">)</span><span class="op" id="6435602">;</span>&nbsp;<span class="ident" id="6435604">err</span>&nbsp;<span class="op" id="6435608">!=</span>&nbsp;<span class="ident" id="6435611">nil</span>&nbsp;<span class="op" id="6435615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435619">t</span><span class="op" id="6435620">.</span><span class="ident" id="6435621">Error</span><span class="op" id="6435626">(</span><span class="ident" id="6435627">err</span><span class="op" id="6435630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435634">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6435642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435646">if</span>&nbsp;<span class="ident" id="6435649">mode</span><span class="op" id="6435653">&amp;</span><span class="ident" id="6435654">idempotent</span>&nbsp;<span class="op" id="6435665">!=</span>&nbsp;<span class="num" id="6435668">0</span>&nbsp;<span class="op" id="6435670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6435674">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6435716">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6435779">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435841">res</span><span class="op" id="6435844">,</span>&nbsp;<span class="ident" id="6435846">err</span>&nbsp;<span class="op" id="6435850">=</span>&nbsp;<span class="ident" id="6435852">format</span><span class="op" id="6435858">(</span><span class="ident" id="6435859">gld</span><span class="op" id="6435862">,</span>&nbsp;<span class="ident" id="6435864">mode</span><span class="op" id="6435868">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6435872">if</span>&nbsp;<span class="ident" id="6435875">err</span>&nbsp;<span class="op" id="6435879">:=</span>&nbsp;<span class="ident" id="6435882">diff</span><span class="op" id="6435886">(</span><span class="ident" id="6435887">golden</span><span class="op" id="6435893">,</span>&nbsp;<span class="ident" id="6435895">fmt</span><span class="op" id="6435898">.</span><span class="ident" id="6435899">Sprintf</span><span class="op" id="6435906">(</span><span class="string" id="6435907">&#34;format(%s)&#34;</span><span class="op" id="6435919">,</span>&nbsp;<span class="ident" id="6435921">golden</span><span class="op" id="6435927">)</span><span class="op" id="6435928">,</span>&nbsp;<span class="ident" id="6435930">gld</span><span class="op" id="6435933">,</span>&nbsp;<span class="ident" id="6435935">res</span><span class="op" id="6435938">)</span><span class="op" id="6435939">;</span>&nbsp;<span class="ident" id="6435941">err</span>&nbsp;<span class="op" id="6435945">!=</span>&nbsp;<span class="ident" id="6435948">nil</span>&nbsp;<span class="op" id="6435952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6435957">t</span><span class="op" id="6435958">.</span><span class="ident" id="6435959">Errorf</span><span class="op" id="6435965">(</span><span class="string" id="6435966">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="6435996">,</span>&nbsp;<span class="ident" id="6435998">err</span><span class="op" id="6436001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436008">}</span><br>
<span class="lineno"></span><span class="op" id="6436010">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6436013">func</span>&nbsp;<span class="ident" id="6436018">check</span><span class="op" id="6436023">(</span><span class="ident" id="6436024">t</span>&nbsp;<span class="op" id="6436026">*</span><span class="ident" id="6436027">testing</span><span class="op" id="6436034">.</span><span class="ident" id="6436035">T</span><span class="op" id="6436036">,</span>&nbsp;<span class="ident" id="6436038">source</span><span class="op" id="6436044">,</span>&nbsp;<span class="ident" id="6436046">golden</span>&nbsp;<span class="builtintype" id="6436053">string</span><span class="op" id="6436059">,</span>&nbsp;<span class="ident" id="6436061">mode</span>&nbsp;<span class="ident" id="6436066">checkMode</span><span class="op" id="6436075">)</span>&nbsp;<span class="op" id="6436077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436080">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436097">cc</span>&nbsp;<span class="op" id="6436100">:=</span>&nbsp;<span class="builtinfunc" id="6436103">make</span><span class="op" id="6436107">(</span><span class="keyword" id="6436108">chan</span>&nbsp;<span class="builtintype" id="6436113">int</span><span class="op" id="6436116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6436119">go</span>&nbsp;<span class="keyword" id="6436122">func</span><span class="op" id="6436126">(</span><span class="op" id="6436127">)</span>&nbsp;<span class="op" id="6436129">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436133">runcheck</span><span class="op" id="6436141">(</span><span class="ident" id="6436142">t</span><span class="op" id="6436143">,</span>&nbsp;<span class="ident" id="6436145">source</span><span class="op" id="6436151">,</span>&nbsp;<span class="ident" id="6436153">golden</span><span class="op" id="6436159">,</span>&nbsp;<span class="ident" id="6436161">mode</span><span class="op" id="6436165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436169">cc</span>&nbsp;<span class="op" id="6436172">&lt;-</span>&nbsp;<span class="num" id="6436175">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436178">}</span><span class="op" id="6436179">(</span><span class="op" id="6436180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436184">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6436206">select</span>&nbsp;<span class="op" id="6436213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6436216">case</span>&nbsp;<span class="op" id="6436221">&lt;-</span><span class="ident" id="6436223">time</span><span class="op" id="6436227">.</span><span class="ident" id="6436228">After</span><span class="op" id="6436233">(</span><span class="num" id="6436234">10</span>&nbsp;<span class="op" id="6436237">*</span>&nbsp;<span class="ident" id="6436239">time</span><span class="op" id="6436243">.</span><span class="ident" id="6436244">Second</span><span class="op" id="6436250">)</span><span class="op" id="6436251">:</span>&nbsp;<span class="comment" id="6436253">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436313">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436345">t</span><span class="op" id="6436346">.</span><span class="ident" id="6436347">Errorf</span><span class="op" id="6436353">(</span><span class="string" id="6436354">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="6436378">,</span>&nbsp;<span class="ident" id="6436380">source</span><span class="op" id="6436386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6436389">case</span>&nbsp;<span class="op" id="6436394">&lt;-</span><span class="ident" id="6436396">cc</span><span class="op" id="6436398">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6436402">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436448">}</span><br>
<span class="lineno"></span><span class="op" id="6436450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6436453">type</span>&nbsp;<span class="ident" id="6436458">entry</span>&nbsp;<span class="keyword" id="6436464">struct</span>&nbsp;<span class="op" id="6436471">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436474">source</span><span class="op" id="6436480">,</span>&nbsp;<span class="ident" id="6436482">golden</span>&nbsp;<span class="builtintype" id="6436489">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6436497">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6436512">checkMode</span><br>
<span class="lineno"></span><span class="op" id="6436522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6436525">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="6436594">var</span>&nbsp;<span class="ident" id="6436598">data</span>&nbsp;<span class="op" id="6436603">=</span>&nbsp;<span class="op" id="6436605">[</span><span class="op" id="6436606">]</span><span class="ident" id="6436607">entry</span><span class="op" id="6436612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436615">{</span><span class="string" id="6436616">&#34;empty.input&#34;</span><span class="op" id="6436629">,</span>&nbsp;<span class="string" id="6436631">&#34;empty.golden&#34;</span><span class="op" id="6436645">,</span>&nbsp;<span class="ident" id="6436647">idempotent</span><span class="op" id="6436657">}</span><span class="op" id="6436658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436661">{</span><span class="string" id="6436662">&#34;comments.input&#34;</span><span class="op" id="6436678">,</span>&nbsp;<span class="string" id="6436680">&#34;comments.golden&#34;</span><span class="op" id="6436697">,</span>&nbsp;<span class="num" id="6436699">0</span><span class="op" id="6436700">}</span><span class="op" id="6436701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436704">{</span><span class="string" id="6436705">&#34;comments.input&#34;</span><span class="op" id="6436721">,</span>&nbsp;<span class="string" id="6436723">&#34;comments.x&#34;</span><span class="op" id="6436735">,</span>&nbsp;<span class="ident" id="6436737">export</span><span class="op" id="6436743">}</span><span class="op" id="6436744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436747">{</span><span class="string" id="6436748">&#34;comments2.input&#34;</span><span class="op" id="6436765">,</span>&nbsp;<span class="string" id="6436767">&#34;comments2.golden&#34;</span><span class="op" id="6436785">,</span>&nbsp;<span class="ident" id="6436787">idempotent</span><span class="op" id="6436797">}</span><span class="op" id="6436798">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436801">{</span><span class="string" id="6436802">&#34;linebreaks.input&#34;</span><span class="op" id="6436820">,</span>&nbsp;<span class="string" id="6436822">&#34;linebreaks.golden&#34;</span><span class="op" id="6436841">,</span>&nbsp;<span class="ident" id="6436843">idempotent</span><span class="op" id="6436853">}</span><span class="op" id="6436854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436857">{</span><span class="string" id="6436858">&#34;expressions.input&#34;</span><span class="op" id="6436877">,</span>&nbsp;<span class="string" id="6436879">&#34;expressions.golden&#34;</span><span class="op" id="6436899">,</span>&nbsp;<span class="ident" id="6436901">idempotent</span><span class="op" id="6436911">}</span><span class="op" id="6436912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436915">{</span><span class="string" id="6436916">&#34;expressions.input&#34;</span><span class="op" id="6436935">,</span>&nbsp;<span class="string" id="6436937">&#34;expressions.raw&#34;</span><span class="op" id="6436954">,</span>&nbsp;<span class="ident" id="6436956">rawFormat</span>&nbsp;<span class="op" id="6436966">|</span>&nbsp;<span class="ident" id="6436968">idempotent</span><span class="op" id="6436978">}</span><span class="op" id="6436979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6436982">{</span><span class="string" id="6436983">&#34;declarations.input&#34;</span><span class="op" id="6437003">,</span>&nbsp;<span class="string" id="6437005">&#34;declarations.golden&#34;</span><span class="op" id="6437026">,</span>&nbsp;<span class="num" id="6437028">0</span><span class="op" id="6437029">}</span><span class="op" id="6437030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6437033">{</span><span class="string" id="6437034">&#34;statements.input&#34;</span><span class="op" id="6437052">,</span>&nbsp;<span class="string" id="6437054">&#34;statements.golden&#34;</span><span class="op" id="6437073">,</span>&nbsp;<span class="num" id="6437075">0</span><span class="op" id="6437076">}</span><span class="op" id="6437077">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6437080">{</span><span class="string" id="6437081">&#34;slow.input&#34;</span><span class="op" id="6437093">,</span>&nbsp;<span class="string" id="6437095">&#34;slow.golden&#34;</span><span class="op" id="6437108">,</span>&nbsp;<span class="ident" id="6437110">idempotent</span><span class="op" id="6437120">}</span><span class="op" id="6437121">,</span><br>
<span class="lineno"></span><span class="op" id="6437123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6437126">func</span>&nbsp;<span class="ident" id="6437131">TestFiles</span><span class="op" id="6437140">(</span><span class="ident" id="6437141">t</span>&nbsp;<span class="op" id="6437143">*</span><span class="ident" id="6437144">testing</span><span class="op" id="6437151">.</span><span class="ident" id="6437152">T</span><span class="op" id="6437153">)</span>&nbsp;<span class="op" id="6437155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6437158">for</span>&nbsp;<span class="ident" id="6437162">_</span><span class="op" id="6437163">,</span>&nbsp;<span class="ident" id="6437165">e</span>&nbsp;<span class="op" id="6437167">:=</span>&nbsp;<span class="keyword" id="6437170">range</span>&nbsp;<span class="ident" id="6437176">data</span>&nbsp;<span class="op" id="6437181">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437185">source</span>&nbsp;<span class="op" id="6437192">:=</span>&nbsp;<span class="ident" id="6437195">filepath</span><span class="op" id="6437203">.</span><span class="ident" id="6437204">Join</span><span class="op" id="6437208">(</span><span class="ident" id="6437209">dataDir</span><span class="op" id="6437216">,</span>&nbsp;<span class="ident" id="6437218">e</span><span class="op" id="6437219">.</span><span class="ident" id="6437220">source</span><span class="op" id="6437226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437230">golden</span>&nbsp;<span class="op" id="6437237">:=</span>&nbsp;<span class="ident" id="6437240">filepath</span><span class="op" id="6437248">.</span><span class="ident" id="6437249">Join</span><span class="op" id="6437253">(</span><span class="ident" id="6437254">dataDir</span><span class="op" id="6437261">,</span>&nbsp;<span class="ident" id="6437263">e</span><span class="op" id="6437264">.</span><span class="ident" id="6437265">golden</span><span class="op" id="6437271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437275">check</span><span class="op" id="6437280">(</span><span class="ident" id="6437281">t</span><span class="op" id="6437282">,</span>&nbsp;<span class="ident" id="6437284">source</span><span class="op" id="6437290">,</span>&nbsp;<span class="ident" id="6437292">golden</span><span class="op" id="6437298">,</span>&nbsp;<span class="ident" id="6437300">e</span><span class="op" id="6437301">.</span><span class="ident" id="6437302">mode</span><span class="op" id="6437306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437310">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6437357">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6437393">}</span><br>
<span class="lineno"></span><span class="op" id="6437395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6437398">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="6437474">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="6437550">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="6437579">//</span><br>
<span class="lineno"></span><span class="keyword" id="6437582">func</span>&nbsp;<span class="ident" id="6437587">TestLineComments</span><span class="op" id="6437603">(</span><span class="ident" id="6437604">t</span>&nbsp;<span class="op" id="6437606">*</span><span class="ident" id="6437607">testing</span><span class="op" id="6437614">.</span><span class="ident" id="6437615">T</span><span class="op" id="6437616">)</span>&nbsp;<span class="op" id="6437618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6437621">const</span>&nbsp;<span class="ident" id="6437627">src</span>&nbsp;<span class="op" id="6437631">=</span>&nbsp;<span class="string" id="6437633">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437694">fset</span>&nbsp;<span class="op" id="6437699">:=</span>&nbsp;<span class="ident" id="6437702">token</span><span class="op" id="6437707">.</span><span class="ident" id="6437708">NewFileSet</span><span class="op" id="6437718">(</span><span class="op" id="6437719">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437722">f</span><span class="op" id="6437723">,</span>&nbsp;<span class="ident" id="6437725">err</span>&nbsp;<span class="op" id="6437729">:=</span>&nbsp;<span class="ident" id="6437732">parser</span><span class="op" id="6437738">.</span><span class="ident" id="6437739">ParseFile</span><span class="op" id="6437748">(</span><span class="ident" id="6437749">fset</span><span class="op" id="6437753">,</span>&nbsp;<span class="string" id="6437755">&#34;&#34;</span><span class="op" id="6437757">,</span>&nbsp;<span class="ident" id="6437759">src</span><span class="op" id="6437762">,</span>&nbsp;<span class="ident" id="6437764">parser</span><span class="op" id="6437770">.</span><span class="ident" id="6437771">ParseComments</span><span class="op" id="6437784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6437787">if</span>&nbsp;<span class="ident" id="6437790">err</span>&nbsp;<span class="op" id="6437794">!=</span>&nbsp;<span class="ident" id="6437797">nil</span>&nbsp;<span class="op" id="6437801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6437805">panic</span><span class="op" id="6437810">(</span><span class="ident" id="6437811">err</span><span class="op" id="6437814">)</span>&nbsp;<span class="comment" id="6437816">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6437834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6437838">var</span>&nbsp;<span class="ident" id="6437842">buf</span>&nbsp;<span class="ident" id="6437846">bytes</span><span class="op" id="6437851">.</span><span class="ident" id="6437852">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437860">fset</span>&nbsp;<span class="op" id="6437865">=</span>&nbsp;<span class="ident" id="6437867">token</span><span class="op" id="6437872">.</span><span class="ident" id="6437873">NewFileSet</span><span class="op" id="6437883">(</span><span class="op" id="6437884">)</span>&nbsp;<span class="comment" id="6437886">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437913">Fprint</span><span class="op" id="6437919">(</span><span class="op" id="6437920">&amp;</span><span class="ident" id="6437921">buf</span><span class="op" id="6437924">,</span>&nbsp;<span class="ident" id="6437926">fset</span><span class="op" id="6437930">,</span>&nbsp;<span class="ident" id="6437932">f</span><span class="op" id="6437933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6437937">nlines</span>&nbsp;<span class="op" id="6437944">:=</span>&nbsp;<span class="num" id="6437947">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6437950">for</span>&nbsp;<span class="ident" id="6437954">_</span><span class="op" id="6437955">,</span>&nbsp;<span class="ident" id="6437957">ch</span>&nbsp;<span class="op" id="6437960">:=</span>&nbsp;<span class="keyword" id="6437963">range</span>&nbsp;<span class="ident" id="6437969">buf</span><span class="op" id="6437972">.</span><span class="ident" id="6437973">Bytes</span><span class="op" id="6437978">(</span><span class="op" id="6437979">)</span>&nbsp;<span class="op" id="6437981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6437985">if</span>&nbsp;<span class="ident" id="6437988">ch</span>&nbsp;<span class="op" id="6437991">==</span>&nbsp;<span class="string" id="6437994">&#39;\n&#39;</span>&nbsp;<span class="op" id="6437999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438004">nlines</span><span class="op" id="6438010">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438018">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438022">const</span>&nbsp;<span class="ident" id="6438028">expected</span>&nbsp;<span class="op" id="6438037">=</span>&nbsp;<span class="num" id="6438039">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438042">if</span>&nbsp;<span class="ident" id="6438045">nlines</span>&nbsp;<span class="op" id="6438052">&lt;</span>&nbsp;<span class="ident" id="6438054">expected</span>&nbsp;<span class="op" id="6438063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438067">t</span><span class="op" id="6438068">.</span><span class="ident" id="6438069">Errorf</span><span class="op" id="6438075">(</span><span class="string" id="6438076">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="6438099">,</span>&nbsp;<span class="ident" id="6438101">nlines</span><span class="op" id="6438107">,</span>&nbsp;<span class="ident" id="6438109">expected</span><span class="op" id="6438117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438121">t</span><span class="op" id="6438122">.</span><span class="ident" id="6438123">Errorf</span><span class="op" id="6438129">(</span><span class="string" id="6438130">&#34;result:\n%s&#34;</span><span class="op" id="6438143">,</span>&nbsp;<span class="ident" id="6438145">buf</span><span class="op" id="6438148">.</span><span class="ident" id="6438149">Bytes</span><span class="op" id="6438154">(</span><span class="op" id="6438155">)</span><span class="op" id="6438156">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438159">}</span><br>
<span class="lineno"></span><span class="op" id="6438161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6438164">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="6438229">func</span>&nbsp;<span class="ident" id="6438234">init</span><span class="op" id="6438238">(</span><span class="op" id="6438239">)</span>&nbsp;<span class="op" id="6438241">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438244">const</span>&nbsp;<span class="ident" id="6438250">name</span>&nbsp;<span class="op" id="6438255">=</span>&nbsp;<span class="string" id="6438257">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438267">var</span>&nbsp;<span class="ident" id="6438271">buf</span>&nbsp;<span class="ident" id="6438275">bytes</span><span class="op" id="6438280">.</span><span class="ident" id="6438281">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438289">if</span>&nbsp;<span class="ident" id="6438292">err</span>&nbsp;<span class="op" id="6438296">:=</span>&nbsp;<span class="ident" id="6438299">Fprint</span><span class="op" id="6438305">(</span><span class="op" id="6438306">&amp;</span><span class="ident" id="6438307">buf</span><span class="op" id="6438310">,</span>&nbsp;<span class="ident" id="6438312">fset</span><span class="op" id="6438316">,</span>&nbsp;<span class="op" id="6438318">&amp;</span><span class="ident" id="6438319">ast</span><span class="op" id="6438322">.</span><span class="ident" id="6438323">Ident</span><span class="op" id="6438328">{</span><span class="ident" id="6438329">Name</span><span class="op" id="6438333">:</span>&nbsp;<span class="ident" id="6438335">name</span><span class="op" id="6438339">}</span><span class="op" id="6438340">)</span><span class="op" id="6438341">;</span>&nbsp;<span class="ident" id="6438343">err</span>&nbsp;<span class="op" id="6438347">!=</span>&nbsp;<span class="ident" id="6438350">nil</span>&nbsp;<span class="op" id="6438354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6438358">panic</span><span class="op" id="6438363">(</span><span class="ident" id="6438364">err</span><span class="op" id="6438367">)</span>&nbsp;<span class="comment" id="6438369">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438387">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6438390">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6438453">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438467">if</span>&nbsp;<span class="ident" id="6438470">s</span>&nbsp;<span class="op" id="6438472">:=</span>&nbsp;<span class="ident" id="6438475">buf</span><span class="op" id="6438478">.</span><span class="ident" id="6438479">String</span><span class="op" id="6438485">(</span><span class="op" id="6438486">)</span><span class="op" id="6438487">;</span>&nbsp;<span class="op" id="6438489">!</span><span class="ident" id="6438490">debug</span>&nbsp;<span class="op" id="6438496">&amp;&amp;</span>&nbsp;<span class="ident" id="6438499">s</span>&nbsp;<span class="op" id="6438501">!=</span>&nbsp;<span class="ident" id="6438504">name</span>&nbsp;<span class="op" id="6438509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6438513">panic</span><span class="op" id="6438518">(</span><span class="string" id="6438519">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="6438526">+</span>&nbsp;<span class="ident" id="6438528">s</span>&nbsp;<span class="op" id="6438530">+</span>&nbsp;<span class="string" id="6438532">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="6438542">+</span>&nbsp;<span class="ident" id="6438544">name</span><span class="op" id="6438548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438551">}</span><br>
<span class="lineno">255</span><span class="op" id="6438553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6438556">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="6438631">func</span>&nbsp;<span class="ident" id="6438636">TestBadNodes</span><span class="op" id="6438648">(</span><span class="ident" id="6438649">t</span>&nbsp;<span class="op" id="6438651">*</span><span class="ident" id="6438652">testing</span><span class="op" id="6438659">.</span><span class="ident" id="6438660">T</span><span class="op" id="6438661">)</span>&nbsp;<span class="op" id="6438663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438666">const</span>&nbsp;<span class="ident" id="6438672">src</span>&nbsp;<span class="op" id="6438676">=</span>&nbsp;<span class="string" id="6438678">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438694">const</span>&nbsp;<span class="ident" id="6438700">res</span>&nbsp;<span class="op" id="6438704">=</span>&nbsp;<span class="string" id="6438706">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438730">f</span><span class="op" id="6438731">,</span>&nbsp;<span class="ident" id="6438733">err</span>&nbsp;<span class="op" id="6438737">:=</span>&nbsp;<span class="ident" id="6438740">parser</span><span class="op" id="6438746">.</span><span class="ident" id="6438747">ParseFile</span><span class="op" id="6438756">(</span><span class="ident" id="6438757">fset</span><span class="op" id="6438761">,</span>&nbsp;<span class="string" id="6438763">&#34;&#34;</span><span class="op" id="6438765">,</span>&nbsp;<span class="ident" id="6438767">src</span><span class="op" id="6438770">,</span>&nbsp;<span class="ident" id="6438772">parser</span><span class="op" id="6438778">.</span><span class="ident" id="6438779">ParseComments</span><span class="op" id="6438792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438795">if</span>&nbsp;<span class="ident" id="6438798">err</span>&nbsp;<span class="op" id="6438802">==</span>&nbsp;<span class="ident" id="6438805">nil</span>&nbsp;<span class="op" id="6438809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438813">t</span><span class="op" id="6438814">.</span><span class="ident" id="6438815">Error</span><span class="op" id="6438820">(</span><span class="string" id="6438821">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="6438847">)</span>&nbsp;<span class="comment" id="6438849">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438867">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438870">var</span>&nbsp;<span class="ident" id="6438874">buf</span>&nbsp;<span class="ident" id="6438878">bytes</span><span class="op" id="6438883">.</span><span class="ident" id="6438884">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438892">Fprint</span><span class="op" id="6438898">(</span><span class="op" id="6438899">&amp;</span><span class="ident" id="6438900">buf</span><span class="op" id="6438903">,</span>&nbsp;<span class="ident" id="6438905">fset</span><span class="op" id="6438909">,</span>&nbsp;<span class="ident" id="6438911">f</span><span class="op" id="6438912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6438915">if</span>&nbsp;<span class="ident" id="6438918">buf</span><span class="op" id="6438921">.</span><span class="ident" id="6438922">String</span><span class="op" id="6438928">(</span><span class="op" id="6438929">)</span>&nbsp;<span class="op" id="6438931">!=</span>&nbsp;<span class="ident" id="6438934">res</span>&nbsp;<span class="op" id="6438938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6438942">t</span><span class="op" id="6438943">.</span><span class="ident" id="6438944">Errorf</span><span class="op" id="6438950">(</span><span class="string" id="6438951">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6438972">,</span>&nbsp;<span class="ident" id="6438974">buf</span><span class="op" id="6438977">.</span><span class="ident" id="6438978">String</span><span class="op" id="6438984">(</span><span class="op" id="6438985">)</span><span class="op" id="6438986">,</span>&nbsp;<span class="ident" id="6438988">res</span><span class="op" id="6438991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6438994">}</span><br>
<span class="lineno">270</span><span class="op" id="6438996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6438999">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="6439068">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6439140">func</span>&nbsp;<span class="ident" id="6439145">testComment</span><span class="op" id="6439156">(</span><span class="ident" id="6439157">t</span>&nbsp;<span class="op" id="6439159">*</span><span class="ident" id="6439160">testing</span><span class="op" id="6439167">.</span><span class="ident" id="6439168">T</span><span class="op" id="6439169">,</span>&nbsp;<span class="ident" id="6439171">f</span>&nbsp;<span class="op" id="6439173">*</span><span class="ident" id="6439174">ast</span><span class="op" id="6439177">.</span><span class="ident" id="6439178">File</span><span class="op" id="6439182">,</span>&nbsp;<span class="ident" id="6439184">srclen</span>&nbsp;<span class="builtintype" id="6439191">int</span><span class="op" id="6439194">,</span>&nbsp;<span class="ident" id="6439196">comment</span>&nbsp;<span class="op" id="6439204">*</span><span class="ident" id="6439205">ast</span><span class="op" id="6439208">.</span><span class="ident" id="6439209">Comment</span><span class="op" id="6439216">)</span>&nbsp;<span class="op" id="6439218">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439221">f</span><span class="op" id="6439222">.</span><span class="ident" id="6439223">Comments</span><span class="op" id="6439231">[</span><span class="num" id="6439232">0</span><span class="op" id="6439233">]</span><span class="op" id="6439234">.</span><span class="ident" id="6439235">List</span><span class="op" id="6439239">[</span><span class="num" id="6439240">0</span><span class="op" id="6439241">]</span>&nbsp;<span class="op" id="6439243">=</span>&nbsp;<span class="ident" id="6439245">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439254">var</span>&nbsp;<span class="ident" id="6439258">buf</span>&nbsp;<span class="ident" id="6439262">bytes</span><span class="op" id="6439267">.</span><span class="ident" id="6439268">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439276">for</span>&nbsp;<span class="ident" id="6439280">offs</span>&nbsp;<span class="op" id="6439285">:=</span>&nbsp;<span class="num" id="6439288">0</span><span class="op" id="6439289">;</span>&nbsp;<span class="ident" id="6439291">offs</span>&nbsp;<span class="op" id="6439296">&lt;=</span>&nbsp;<span class="ident" id="6439299">srclen</span><span class="op" id="6439305">;</span>&nbsp;<span class="ident" id="6439307">offs</span><span class="op" id="6439311">++</span>&nbsp;<span class="op" id="6439314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439318">buf</span><span class="op" id="6439321">.</span><span class="ident" id="6439322">Reset</span><span class="op" id="6439327">(</span><span class="op" id="6439328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6439332">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6439386">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439440">if</span>&nbsp;<span class="ident" id="6439443">err</span>&nbsp;<span class="op" id="6439447">:=</span>&nbsp;<span class="ident" id="6439450">Fprint</span><span class="op" id="6439456">(</span><span class="op" id="6439457">&amp;</span><span class="ident" id="6439458">buf</span><span class="op" id="6439461">,</span>&nbsp;<span class="ident" id="6439463">fset</span><span class="op" id="6439467">,</span>&nbsp;<span class="ident" id="6439469">f</span><span class="op" id="6439470">)</span><span class="op" id="6439471">;</span>&nbsp;<span class="ident" id="6439473">err</span>&nbsp;<span class="op" id="6439477">!=</span>&nbsp;<span class="ident" id="6439480">nil</span>&nbsp;<span class="op" id="6439484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439489">t</span><span class="op" id="6439490">.</span><span class="ident" id="6439491">Error</span><span class="op" id="6439496">(</span><span class="ident" id="6439497">err</span><span class="op" id="6439500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6439504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439508">if</span>&nbsp;<span class="ident" id="6439511">_</span><span class="op" id="6439512">,</span>&nbsp;<span class="ident" id="6439514">err</span>&nbsp;<span class="op" id="6439518">:=</span>&nbsp;<span class="ident" id="6439521">parser</span><span class="op" id="6439527">.</span><span class="ident" id="6439528">ParseFile</span><span class="op" id="6439537">(</span><span class="ident" id="6439538">fset</span><span class="op" id="6439542">,</span>&nbsp;<span class="string" id="6439544">&#34;&#34;</span><span class="op" id="6439546">,</span>&nbsp;<span class="ident" id="6439548">buf</span><span class="op" id="6439551">.</span><span class="ident" id="6439552">Bytes</span><span class="op" id="6439557">(</span><span class="op" id="6439558">)</span><span class="op" id="6439559">,</span>&nbsp;<span class="num" id="6439561">0</span><span class="op" id="6439562">)</span><span class="op" id="6439563">;</span>&nbsp;<span class="ident" id="6439565">err</span>&nbsp;<span class="op" id="6439569">!=</span>&nbsp;<span class="ident" id="6439572">nil</span>&nbsp;<span class="op" id="6439576">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439581">t</span><span class="op" id="6439582">.</span><span class="ident" id="6439583">Fatalf</span><span class="op" id="6439589">(</span><span class="string" id="6439590">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="6439627">,</span>&nbsp;<span class="ident" id="6439629">comment</span><span class="op" id="6439636">.</span><span class="ident" id="6439637">Slash</span><span class="op" id="6439642">,</span>&nbsp;<span class="ident" id="6439644">buf</span><span class="op" id="6439647">.</span><span class="ident" id="6439648">String</span><span class="op" id="6439654">(</span><span class="op" id="6439655">)</span><span class="op" id="6439656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6439660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6439664">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6439709">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6439756">comment</span><span class="op" id="6439763">.</span><span class="ident" id="6439764">Slash</span><span class="op" id="6439769">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6439773">}</span><br>
<span class="lineno"></span><span class="op" id="6439775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6439778">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="6439832">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="6439901">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="6439918">func</span>&nbsp;<span class="ident" id="6439923">TestBadComments</span><span class="op" id="6439938">(</span><span class="ident" id="6439939">t</span>&nbsp;<span class="op" id="6439941">*</span><span class="ident" id="6439942">testing</span><span class="op" id="6439949">.</span><span class="ident" id="6439950">T</span><span class="op" id="6439951">)</span>&nbsp;<span class="op" id="6439953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6439956">const</span>&nbsp;<span class="ident" id="6439962">src</span>&nbsp;<span class="op" id="6439966">=</span>&nbsp;<span class="string" id="6439968">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440222">f</span><span class="op" id="6440223">,</span>&nbsp;<span class="ident" id="6440225">err</span>&nbsp;<span class="op" id="6440229">:=</span>&nbsp;<span class="ident" id="6440232">parser</span><span class="op" id="6440238">.</span><span class="ident" id="6440239">ParseFile</span><span class="op" id="6440248">(</span><span class="ident" id="6440249">fset</span><span class="op" id="6440253">,</span>&nbsp;<span class="string" id="6440255">&#34;&#34;</span><span class="op" id="6440257">,</span>&nbsp;<span class="ident" id="6440259">src</span><span class="op" id="6440262">,</span>&nbsp;<span class="ident" id="6440264">parser</span><span class="op" id="6440270">.</span><span class="ident" id="6440271">ParseComments</span><span class="op" id="6440284">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440287">if</span>&nbsp;<span class="ident" id="6440290">err</span>&nbsp;<span class="op" id="6440294">!=</span>&nbsp;<span class="ident" id="6440297">nil</span>&nbsp;<span class="op" id="6440301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440305">t</span><span class="op" id="6440306">.</span><span class="ident" id="6440307">Error</span><span class="op" id="6440312">(</span><span class="ident" id="6440313">err</span><span class="op" id="6440316">)</span>&nbsp;<span class="comment" id="6440318">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440340">comment</span>&nbsp;<span class="op" id="6440348">:=</span>&nbsp;<span class="ident" id="6440351">f</span><span class="op" id="6440352">.</span><span class="ident" id="6440353">Comments</span><span class="op" id="6440361">[</span><span class="num" id="6440362">0</span><span class="op" id="6440363">]</span><span class="op" id="6440364">.</span><span class="ident" id="6440365">List</span><span class="op" id="6440369">[</span><span class="num" id="6440370">0</span><span class="op" id="6440371">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440374">pos</span>&nbsp;<span class="op" id="6440378">:=</span>&nbsp;<span class="ident" id="6440381">comment</span><span class="op" id="6440388">.</span><span class="ident" id="6440389">Pos</span><span class="op" id="6440392">(</span><span class="op" id="6440393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440396">if</span>&nbsp;<span class="ident" id="6440399">fset</span><span class="op" id="6440403">.</span><span class="ident" id="6440404">Position</span><span class="op" id="6440412">(</span><span class="ident" id="6440413">pos</span><span class="op" id="6440416">)</span><span class="op" id="6440417">.</span><span class="ident" id="6440418">Offset</span>&nbsp;<span class="op" id="6440425">!=</span>&nbsp;<span class="num" id="6440428">1</span>&nbsp;<span class="op" id="6440430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440434">t</span><span class="op" id="6440435">.</span><span class="ident" id="6440436">Error</span><span class="op" id="6440441">(</span><span class="string" id="6440442">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="6440461">)</span>&nbsp;<span class="comment" id="6440463">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440485">testComment</span><span class="op" id="6440496">(</span><span class="ident" id="6440497">t</span><span class="op" id="6440498">,</span>&nbsp;<span class="ident" id="6440500">f</span><span class="op" id="6440501">,</span>&nbsp;<span class="builtinfunc" id="6440503">len</span><span class="op" id="6440506">(</span><span class="ident" id="6440507">src</span><span class="op" id="6440510">)</span><span class="op" id="6440511">,</span>&nbsp;<span class="op" id="6440513">&amp;</span><span class="ident" id="6440514">ast</span><span class="op" id="6440517">.</span><span class="ident" id="6440518">Comment</span><span class="op" id="6440525">{</span><span class="ident" id="6440526">Slash</span><span class="op" id="6440531">:</span>&nbsp;<span class="ident" id="6440533">pos</span><span class="op" id="6440536">,</span>&nbsp;<span class="ident" id="6440538">Text</span><span class="op" id="6440542">:</span>&nbsp;<span class="string" id="6440544">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="6440562">}</span><span class="op" id="6440563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440566">testComment</span><span class="op" id="6440577">(</span><span class="ident" id="6440578">t</span><span class="op" id="6440579">,</span>&nbsp;<span class="ident" id="6440581">f</span><span class="op" id="6440582">,</span>&nbsp;<span class="builtinfunc" id="6440584">len</span><span class="op" id="6440587">(</span><span class="ident" id="6440588">src</span><span class="op" id="6440591">)</span><span class="op" id="6440592">,</span>&nbsp;<span class="op" id="6440594">&amp;</span><span class="ident" id="6440595">ast</span><span class="op" id="6440598">.</span><span class="ident" id="6440599">Comment</span><span class="op" id="6440606">{</span><span class="ident" id="6440607">Slash</span><span class="op" id="6440612">:</span>&nbsp;<span class="ident" id="6440614">pos</span><span class="op" id="6440617">,</span>&nbsp;<span class="ident" id="6440619">Text</span><span class="op" id="6440623">:</span>&nbsp;<span class="string" id="6440625">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="6440646">}</span><span class="op" id="6440647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440650">testComment</span><span class="op" id="6440661">(</span><span class="ident" id="6440662">t</span><span class="op" id="6440663">,</span>&nbsp;<span class="ident" id="6440665">f</span><span class="op" id="6440666">,</span>&nbsp;<span class="builtinfunc" id="6440668">len</span><span class="op" id="6440671">(</span><span class="ident" id="6440672">src</span><span class="op" id="6440675">)</span><span class="op" id="6440676">,</span>&nbsp;<span class="op" id="6440678">&amp;</span><span class="ident" id="6440679">ast</span><span class="op" id="6440682">.</span><span class="ident" id="6440683">Comment</span><span class="op" id="6440690">{</span><span class="ident" id="6440691">Slash</span><span class="op" id="6440696">:</span>&nbsp;<span class="ident" id="6440698">pos</span><span class="op" id="6440701">,</span>&nbsp;<span class="ident" id="6440703">Text</span><span class="op" id="6440707">:</span>&nbsp;<span class="string" id="6440709">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="6440733">}</span><span class="op" id="6440734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440737">testComment</span><span class="op" id="6440748">(</span><span class="ident" id="6440749">t</span><span class="op" id="6440750">,</span>&nbsp;<span class="ident" id="6440752">f</span><span class="op" id="6440753">,</span>&nbsp;<span class="builtinfunc" id="6440755">len</span><span class="op" id="6440758">(</span><span class="ident" id="6440759">src</span><span class="op" id="6440762">)</span><span class="op" id="6440763">,</span>&nbsp;<span class="op" id="6440765">&amp;</span><span class="ident" id="6440766">ast</span><span class="op" id="6440769">.</span><span class="ident" id="6440770">Comment</span><span class="op" id="6440777">{</span><span class="ident" id="6440778">Slash</span><span class="op" id="6440783">:</span>&nbsp;<span class="ident" id="6440785">pos</span><span class="op" id="6440788">,</span>&nbsp;<span class="ident" id="6440790">Text</span><span class="op" id="6440794">:</span>&nbsp;<span class="string" id="6440796">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="6440824">}</span><span class="op" id="6440825">)</span><br>
<span class="lineno"></span><span class="op" id="6440827">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="6440830">type</span>&nbsp;<span class="ident" id="6440835">visitor</span>&nbsp;<span class="keyword" id="6440843">chan</span>&nbsp;<span class="op" id="6440848">*</span><span class="ident" id="6440849">ast</span><span class="op" id="6440852">.</span><span class="ident" id="6440853">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6440860">func</span>&nbsp;<span class="op" id="6440865">(</span><span class="ident" id="6440866">v</span>&nbsp;<span class="ident" id="6440868">visitor</span><span class="op" id="6440875">)</span>&nbsp;<span class="ident" id="6440877">Visit</span><span class="op" id="6440882">(</span><span class="ident" id="6440883">n</span>&nbsp;<span class="ident" id="6440885">ast</span><span class="op" id="6440888">.</span><span class="ident" id="6440889">Node</span><span class="op" id="6440893">)</span>&nbsp;<span class="op" id="6440895">(</span><span class="ident" id="6440896">w</span>&nbsp;<span class="ident" id="6440898">ast</span><span class="op" id="6440901">.</span><span class="ident" id="6440902">Visitor</span><span class="op" id="6440909">)</span>&nbsp;<span class="op" id="6440911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440914">if</span>&nbsp;<span class="ident" id="6440917">ident</span><span class="op" id="6440922">,</span>&nbsp;<span class="ident" id="6440924">ok</span>&nbsp;<span class="op" id="6440927">:=</span>&nbsp;<span class="ident" id="6440930">n</span><span class="op" id="6440931">.</span><span class="op" id="6440932">(</span><span class="op" id="6440933">*</span><span class="ident" id="6440934">ast</span><span class="op" id="6440937">.</span><span class="ident" id="6440938">Ident</span><span class="op" id="6440943">)</span><span class="op" id="6440944">;</span>&nbsp;<span class="ident" id="6440946">ok</span>&nbsp;<span class="op" id="6440949">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6440953">v</span>&nbsp;<span class="op" id="6440955">&lt;-</span>&nbsp;<span class="ident" id="6440958">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6440965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6440968">return</span>&nbsp;<span class="ident" id="6440975">v</span><br>
<span class="lineno"></span><span class="op" id="6440977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6440980">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="6441058">func</span>&nbsp;<span class="ident" id="6441063">idents</span><span class="op" id="6441069">(</span><span class="ident" id="6441070">f</span>&nbsp;<span class="op" id="6441072">*</span><span class="ident" id="6441073">ast</span><span class="op" id="6441076">.</span><span class="ident" id="6441077">File</span><span class="op" id="6441081">)</span>&nbsp;<span class="op" id="6441083">&lt;-</span><span class="keyword" id="6441085">chan</span>&nbsp;<span class="op" id="6441090">*</span><span class="ident" id="6441091">ast</span><span class="op" id="6441094">.</span><span class="ident" id="6441095">Ident</span>&nbsp;<span class="op" id="6441101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441104">v</span>&nbsp;<span class="op" id="6441106">:=</span>&nbsp;<span class="builtinfunc" id="6441109">make</span><span class="op" id="6441113">(</span><span class="ident" id="6441114">visitor</span><span class="op" id="6441121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441124">go</span>&nbsp;<span class="keyword" id="6441127">func</span><span class="op" id="6441131">(</span><span class="op" id="6441132">)</span>&nbsp;<span class="op" id="6441134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441138">ast</span><span class="op" id="6441141">.</span><span class="ident" id="6441142">Walk</span><span class="op" id="6441146">(</span><span class="ident" id="6441147">v</span><span class="op" id="6441148">,</span>&nbsp;<span class="ident" id="6441150">f</span><span class="op" id="6441151">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6441155">close</span><span class="op" id="6441160">(</span><span class="ident" id="6441161">v</span><span class="op" id="6441162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6441165">}</span><span class="op" id="6441166">(</span><span class="op" id="6441167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441170">return</span>&nbsp;<span class="ident" id="6441177">v</span><br>
<span class="lineno"></span><span class="op" id="6441179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="6441182">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6441242">func</span>&nbsp;<span class="ident" id="6441247">identCount</span><span class="op" id="6441257">(</span><span class="ident" id="6441258">f</span>&nbsp;<span class="op" id="6441260">*</span><span class="ident" id="6441261">ast</span><span class="op" id="6441264">.</span><span class="ident" id="6441265">File</span><span class="op" id="6441269">)</span>&nbsp;<span class="builtintype" id="6441271">int</span>&nbsp;<span class="op" id="6441275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441278">n</span>&nbsp;<span class="op" id="6441280">:=</span>&nbsp;<span class="num" id="6441283">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441286">for</span>&nbsp;<span class="keyword" id="6441290">range</span>&nbsp;<span class="ident" id="6441296">idents</span><span class="op" id="6441302">(</span><span class="ident" id="6441303">f</span><span class="op" id="6441304">)</span>&nbsp;<span class="op" id="6441306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441310">n</span><span class="op" id="6441311">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6441315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441318">return</span>&nbsp;<span class="ident" id="6441325">n</span><br>
<span class="lineno"></span><span class="op" id="6441327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6441330">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="6441394">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="6441459">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="6441477">func</span>&nbsp;<span class="ident" id="6441482">TestSourcePos</span><span class="op" id="6441495">(</span><span class="ident" id="6441496">t</span>&nbsp;<span class="op" id="6441498">*</span><span class="ident" id="6441499">testing</span><span class="op" id="6441506">.</span><span class="ident" id="6441507">T</span><span class="op" id="6441508">)</span>&nbsp;<span class="op" id="6441510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441513">const</span>&nbsp;<span class="ident" id="6441519">src</span>&nbsp;<span class="op" id="6441523">=</span>&nbsp;<span class="string" id="6441525">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6441750">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441769">f1</span><span class="op" id="6441771">,</span>&nbsp;<span class="ident" id="6441773">err</span>&nbsp;<span class="op" id="6441777">:=</span>&nbsp;<span class="ident" id="6441780">parser</span><span class="op" id="6441786">.</span><span class="ident" id="6441787">ParseFile</span><span class="op" id="6441796">(</span><span class="ident" id="6441797">fset</span><span class="op" id="6441801">,</span>&nbsp;<span class="string" id="6441803">&#34;src&#34;</span><span class="op" id="6441808">,</span>&nbsp;<span class="ident" id="6441810">src</span><span class="op" id="6441813">,</span>&nbsp;<span class="ident" id="6441815">parser</span><span class="op" id="6441821">.</span><span class="ident" id="6441822">ParseComments</span><span class="op" id="6441835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441838">if</span>&nbsp;<span class="ident" id="6441841">err</span>&nbsp;<span class="op" id="6441845">!=</span>&nbsp;<span class="ident" id="6441848">nil</span>&nbsp;<span class="op" id="6441852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441856">t</span><span class="op" id="6441857">.</span><span class="ident" id="6441858">Fatal</span><span class="op" id="6441863">(</span><span class="ident" id="6441864">err</span><span class="op" id="6441867">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6441870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6441874">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6441900">var</span>&nbsp;<span class="ident" id="6441904">buf</span>&nbsp;<span class="ident" id="6441908">bytes</span><span class="op" id="6441913">.</span><span class="ident" id="6441914">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6441922">err</span>&nbsp;<span class="op" id="6441926">=</span>&nbsp;<span class="op" id="6441928">(</span><span class="op" id="6441929">&amp;</span><span class="ident" id="6441930">Config</span><span class="op" id="6441936">{</span><span class="ident" id="6441937">Mode</span><span class="op" id="6441941">:</span>&nbsp;<span class="ident" id="6441943">UseSpaces</span>&nbsp;<span class="op" id="6441953">|</span>&nbsp;<span class="ident" id="6441955">SourcePos</span><span class="op" id="6441964">,</span>&nbsp;<span class="ident" id="6441966">Tabwidth</span><span class="op" id="6441974">:</span>&nbsp;<span class="num" id="6441976">8</span><span class="op" id="6441977">}</span><span class="op" id="6441978">)</span><span class="op" id="6441979">.</span><span class="ident" id="6441980">Fprint</span><span class="op" id="6441986">(</span><span class="op" id="6441987">&amp;</span><span class="ident" id="6441988">buf</span><span class="op" id="6441991">,</span>&nbsp;<span class="ident" id="6441993">fset</span><span class="op" id="6441997">,</span>&nbsp;<span class="ident" id="6441999">f1</span><span class="op" id="6442001">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442004">if</span>&nbsp;<span class="ident" id="6442007">err</span>&nbsp;<span class="op" id="6442011">!=</span>&nbsp;<span class="ident" id="6442014">nil</span>&nbsp;<span class="op" id="6442018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442022">t</span><span class="op" id="6442023">.</span><span class="ident" id="6442024">Fatal</span><span class="op" id="6442029">(</span><span class="ident" id="6442030">err</span><span class="op" id="6442033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6442036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442040">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442074">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442150">f2</span><span class="op" id="6442152">,</span>&nbsp;<span class="ident" id="6442154">err</span>&nbsp;<span class="op" id="6442158">:=</span>&nbsp;<span class="ident" id="6442161">parser</span><span class="op" id="6442167">.</span><span class="ident" id="6442168">ParseFile</span><span class="op" id="6442177">(</span><span class="ident" id="6442178">fset</span><span class="op" id="6442182">,</span>&nbsp;<span class="string" id="6442184">&#34;&#34;</span><span class="op" id="6442186">,</span>&nbsp;<span class="ident" id="6442188">buf</span><span class="op" id="6442191">.</span><span class="ident" id="6442192">Bytes</span><span class="op" id="6442197">(</span><span class="op" id="6442198">)</span><span class="op" id="6442199">,</span>&nbsp;<span class="num" id="6442201">0</span><span class="op" id="6442202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442205">if</span>&nbsp;<span class="ident" id="6442208">err</span>&nbsp;<span class="op" id="6442212">!=</span>&nbsp;<span class="ident" id="6442215">nil</span>&nbsp;<span class="op" id="6442219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442223">t</span><span class="op" id="6442224">.</span><span class="ident" id="6442225">Fatalf</span><span class="op" id="6442231">(</span><span class="string" id="6442232">&#34;%s\n%s&#34;</span><span class="op" id="6442240">,</span>&nbsp;<span class="ident" id="6442242">err</span><span class="op" id="6442245">,</span>&nbsp;<span class="ident" id="6442247">buf</span><span class="op" id="6442250">.</span><span class="ident" id="6442251">Bytes</span><span class="op" id="6442256">(</span><span class="op" id="6442257">)</span><span class="op" id="6442258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6442261">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442265">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442336">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442408">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442479">n1</span>&nbsp;<span class="op" id="6442482">:=</span>&nbsp;<span class="ident" id="6442485">identCount</span><span class="op" id="6442495">(</span><span class="ident" id="6442496">f1</span><span class="op" id="6442498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442501">n2</span>&nbsp;<span class="op" id="6442504">:=</span>&nbsp;<span class="ident" id="6442507">identCount</span><span class="op" id="6442517">(</span><span class="ident" id="6442518">f2</span><span class="op" id="6442520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442523">if</span>&nbsp;<span class="ident" id="6442526">n1</span>&nbsp;<span class="op" id="6442529">==</span>&nbsp;<span class="num" id="6442532">0</span>&nbsp;<span class="op" id="6442534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442538">t</span><span class="op" id="6442539">.</span><span class="ident" id="6442540">Fatal</span><span class="op" id="6442545">(</span><span class="string" id="6442546">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="6442561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6442564">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442567">if</span>&nbsp;<span class="ident" id="6442570">n2</span>&nbsp;<span class="op" id="6442573">!=</span>&nbsp;<span class="ident" id="6442576">n1</span>&nbsp;<span class="op" id="6442579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442583">t</span><span class="op" id="6442584">.</span><span class="ident" id="6442585">Errorf</span><span class="op" id="6442591">(</span><span class="string" id="6442592">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6442616">,</span>&nbsp;<span class="ident" id="6442618">n2</span><span class="op" id="6442620">,</span>&nbsp;<span class="ident" id="6442622">n1</span><span class="op" id="6442624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6442627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6442631">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442693">i2range</span>&nbsp;<span class="op" id="6442701">:=</span>&nbsp;<span class="ident" id="6442704">idents</span><span class="op" id="6442710">(</span><span class="ident" id="6442711">f2</span><span class="op" id="6442713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442716">for</span>&nbsp;<span class="ident" id="6442720">i1</span>&nbsp;<span class="op" id="6442723">:=</span>&nbsp;<span class="keyword" id="6442726">range</span>&nbsp;<span class="ident" id="6442732">idents</span><span class="op" id="6442738">(</span><span class="ident" id="6442739">f1</span><span class="op" id="6442741">)</span>&nbsp;<span class="op" id="6442743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442747">i2</span>&nbsp;<span class="op" id="6442750">:=</span>&nbsp;<span class="op" id="6442753">&lt;-</span><span class="ident" id="6442755">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442766">if</span>&nbsp;<span class="ident" id="6442769">i2</span><span class="op" id="6442771">.</span><span class="ident" id="6442772">Name</span>&nbsp;<span class="op" id="6442777">!=</span>&nbsp;<span class="ident" id="6442780">i1</span><span class="op" id="6442782">.</span><span class="ident" id="6442783">Name</span>&nbsp;<span class="op" id="6442788">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442793">t</span><span class="op" id="6442794">.</span><span class="ident" id="6442795">Errorf</span><span class="op" id="6442801">(</span><span class="string" id="6442802">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6442825">,</span>&nbsp;<span class="ident" id="6442827">i2</span><span class="op" id="6442829">.</span><span class="ident" id="6442830">Name</span><span class="op" id="6442834">,</span>&nbsp;<span class="ident" id="6442836">i1</span><span class="op" id="6442838">.</span><span class="ident" id="6442839">Name</span><span class="op" id="6442843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6442847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442852">l1</span>&nbsp;<span class="op" id="6442855">:=</span>&nbsp;<span class="ident" id="6442858">fset</span><span class="op" id="6442862">.</span><span class="ident" id="6442863">Position</span><span class="op" id="6442871">(</span><span class="ident" id="6442872">i1</span><span class="op" id="6442874">.</span><span class="ident" id="6442875">Pos</span><span class="op" id="6442878">(</span><span class="op" id="6442879">)</span><span class="op" id="6442880">)</span><span class="op" id="6442881">.</span><span class="ident" id="6442882">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442889">l2</span>&nbsp;<span class="op" id="6442892">:=</span>&nbsp;<span class="ident" id="6442895">fset</span><span class="op" id="6442899">.</span><span class="ident" id="6442900">Position</span><span class="op" id="6442908">(</span><span class="ident" id="6442909">i2</span><span class="op" id="6442911">.</span><span class="ident" id="6442912">Pos</span><span class="op" id="6442915">(</span><span class="op" id="6442916">)</span><span class="op" id="6442917">)</span><span class="op" id="6442918">.</span><span class="ident" id="6442919">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6442926">if</span>&nbsp;<span class="ident" id="6442929">l2</span>&nbsp;<span class="op" id="6442932">!=</span>&nbsp;<span class="ident" id="6442935">l1</span>&nbsp;<span class="op" id="6442938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6442943">t</span><span class="op" id="6442944">.</span><span class="ident" id="6442945">Errorf</span><span class="op" id="6442951">(</span><span class="string" id="6442952">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="6442981">,</span>&nbsp;<span class="ident" id="6442983">l2</span><span class="op" id="6442985">,</span>&nbsp;<span class="ident" id="6442987">l1</span><span class="op" id="6442989">,</span>&nbsp;<span class="ident" id="6442991">i1</span><span class="op" id="6442993">.</span><span class="ident" id="6442994">Name</span><span class="op" id="6442998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443009">if</span>&nbsp;<span class="ident" id="6443012">t</span><span class="op" id="6443013">.</span><span class="ident" id="6443014">Failed</span><span class="op" id="6443020">(</span><span class="op" id="6443021">)</span>&nbsp;<span class="op" id="6443023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443027">t</span><span class="op" id="6443028">.</span><span class="ident" id="6443029">Logf</span><span class="op" id="6443033">(</span><span class="string" id="6443034">&#34;\n%s&#34;</span><span class="op" id="6443040">,</span>&nbsp;<span class="ident" id="6443042">buf</span><span class="op" id="6443045">.</span><span class="ident" id="6443046">Bytes</span><span class="op" id="6443051">(</span><span class="op" id="6443052">)</span><span class="op" id="6443053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443056">}</span><br>
<span class="lineno"></span><span class="op" id="6443058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6443061">var</span>&nbsp;<span class="ident" id="6443065">decls</span>&nbsp;<span class="op" id="6443071">=</span>&nbsp;<span class="op" id="6443073">[</span><span class="op" id="6443074">]</span><span class="builtintype" id="6443075">string</span><span class="op" id="6443081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6443084">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="6443098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6443101">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="6443153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6443156">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="6443198">,</span><br>
<span class="lineno"></span><span class="op" id="6443200">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="6443203">func</span>&nbsp;<span class="ident" id="6443208">TestDeclLists</span><span class="op" id="6443221">(</span><span class="ident" id="6443222">t</span>&nbsp;<span class="op" id="6443224">*</span><span class="ident" id="6443225">testing</span><span class="op" id="6443232">.</span><span class="ident" id="6443233">T</span><span class="op" id="6443234">)</span>&nbsp;<span class="op" id="6443236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443239">for</span>&nbsp;<span class="ident" id="6443243">_</span><span class="op" id="6443244">,</span>&nbsp;<span class="ident" id="6443246">src</span>&nbsp;<span class="op" id="6443250">:=</span>&nbsp;<span class="keyword" id="6443253">range</span>&nbsp;<span class="ident" id="6443259">decls</span>&nbsp;<span class="op" id="6443265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443269">file</span><span class="op" id="6443273">,</span>&nbsp;<span class="ident" id="6443275">err</span>&nbsp;<span class="op" id="6443279">:=</span>&nbsp;<span class="ident" id="6443282">parser</span><span class="op" id="6443288">.</span><span class="ident" id="6443289">ParseFile</span><span class="op" id="6443298">(</span><span class="ident" id="6443299">fset</span><span class="op" id="6443303">,</span>&nbsp;<span class="string" id="6443305">&#34;&#34;</span><span class="op" id="6443307">,</span>&nbsp;<span class="string" id="6443309">&#34;package&nbsp;p;&#34;</span><span class="op" id="6443321">+</span><span class="ident" id="6443322">src</span><span class="op" id="6443325">,</span>&nbsp;<span class="ident" id="6443327">parser</span><span class="op" id="6443333">.</span><span class="ident" id="6443334">ParseComments</span><span class="op" id="6443347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443351">if</span>&nbsp;<span class="ident" id="6443354">err</span>&nbsp;<span class="op" id="6443358">!=</span>&nbsp;<span class="ident" id="6443361">nil</span>&nbsp;<span class="op" id="6443365">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6443370">panic</span><span class="op" id="6443375">(</span><span class="ident" id="6443376">err</span><span class="op" id="6443379">)</span>&nbsp;<span class="comment" id="6443381">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443405">var</span>&nbsp;<span class="ident" id="6443409">buf</span>&nbsp;<span class="ident" id="6443413">bytes</span><span class="op" id="6443418">.</span><span class="ident" id="6443419">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443428">err</span>&nbsp;<span class="op" id="6443432">=</span>&nbsp;<span class="ident" id="6443434">Fprint</span><span class="op" id="6443440">(</span><span class="op" id="6443441">&amp;</span><span class="ident" id="6443442">buf</span><span class="op" id="6443445">,</span>&nbsp;<span class="ident" id="6443447">fset</span><span class="op" id="6443451">,</span>&nbsp;<span class="ident" id="6443453">file</span><span class="op" id="6443457">.</span><span class="ident" id="6443458">Decls</span><span class="op" id="6443463">)</span>&nbsp;<span class="comment" id="6443465">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443494">if</span>&nbsp;<span class="ident" id="6443497">err</span>&nbsp;<span class="op" id="6443501">!=</span>&nbsp;<span class="ident" id="6443504">nil</span>&nbsp;<span class="op" id="6443508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6443513">panic</span><span class="op" id="6443518">(</span><span class="ident" id="6443519">err</span><span class="op" id="6443522">)</span>&nbsp;<span class="comment" id="6443524">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443548">out</span>&nbsp;<span class="op" id="6443552">:=</span>&nbsp;<span class="ident" id="6443555">buf</span><span class="op" id="6443558">.</span><span class="ident" id="6443559">String</span><span class="op" id="6443565">(</span><span class="op" id="6443566">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443570">if</span>&nbsp;<span class="ident" id="6443573">out</span>&nbsp;<span class="op" id="6443577">!=</span>&nbsp;<span class="ident" id="6443580">src</span>&nbsp;<span class="op" id="6443584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443589">t</span><span class="op" id="6443590">.</span><span class="ident" id="6443591">Errorf</span><span class="op" id="6443597">(</span><span class="string" id="6443598">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6443622">,</span>&nbsp;<span class="ident" id="6443624">out</span><span class="op" id="6443627">,</span>&nbsp;<span class="ident" id="6443629">src</span><span class="op" id="6443632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443639">}</span><br>
<span class="lineno"></span><span class="op" id="6443641">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="6443644">var</span>&nbsp;<span class="ident" id="6443648">stmts</span>&nbsp;<span class="op" id="6443654">=</span>&nbsp;<span class="op" id="6443656">[</span><span class="op" id="6443657">]</span><span class="builtintype" id="6443658">string</span><span class="op" id="6443664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6443667">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="6443675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6443678">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="6443720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6443723">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="6443750">,</span><br>
<span class="lineno">460</span><span class="op" id="6443752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6443755">func</span>&nbsp;<span class="ident" id="6443760">TestStmtLists</span><span class="op" id="6443773">(</span><span class="ident" id="6443774">t</span>&nbsp;<span class="op" id="6443776">*</span><span class="ident" id="6443777">testing</span><span class="op" id="6443784">.</span><span class="ident" id="6443785">T</span><span class="op" id="6443786">)</span>&nbsp;<span class="op" id="6443788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443791">for</span>&nbsp;<span class="ident" id="6443795">_</span><span class="op" id="6443796">,</span>&nbsp;<span class="ident" id="6443798">src</span>&nbsp;<span class="op" id="6443802">:=</span>&nbsp;<span class="keyword" id="6443805">range</span>&nbsp;<span class="ident" id="6443811">stmts</span>&nbsp;<span class="op" id="6443817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443821">file</span><span class="op" id="6443825">,</span>&nbsp;<span class="ident" id="6443827">err</span>&nbsp;<span class="op" id="6443831">:=</span>&nbsp;<span class="ident" id="6443834">parser</span><span class="op" id="6443840">.</span><span class="ident" id="6443841">ParseFile</span><span class="op" id="6443850">(</span><span class="ident" id="6443851">fset</span><span class="op" id="6443855">,</span>&nbsp;<span class="string" id="6443857">&#34;&#34;</span><span class="op" id="6443859">,</span>&nbsp;<span class="string" id="6443861">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6443884">+</span><span class="ident" id="6443885">src</span><span class="op" id="6443888">+</span><span class="string" id="6443889">&#34;}&#34;</span><span class="op" id="6443892">,</span>&nbsp;<span class="ident" id="6443894">parser</span><span class="op" id="6443900">.</span><span class="ident" id="6443901">ParseComments</span><span class="op" id="6443914">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443918">if</span>&nbsp;<span class="ident" id="6443921">err</span>&nbsp;<span class="op" id="6443925">!=</span>&nbsp;<span class="ident" id="6443928">nil</span>&nbsp;<span class="op" id="6443932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6443937">panic</span><span class="op" id="6443942">(</span><span class="ident" id="6443943">err</span><span class="op" id="6443946">)</span>&nbsp;<span class="comment" id="6443948">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6443967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6443972">var</span>&nbsp;<span class="ident" id="6443976">buf</span>&nbsp;<span class="ident" id="6443980">bytes</span><span class="op" id="6443985">.</span><span class="ident" id="6443986">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6443995">err</span>&nbsp;<span class="op" id="6443999">=</span>&nbsp;<span class="ident" id="6444001">Fprint</span><span class="op" id="6444007">(</span><span class="op" id="6444008">&amp;</span><span class="ident" id="6444009">buf</span><span class="op" id="6444012">,</span>&nbsp;<span class="ident" id="6444014">fset</span><span class="op" id="6444018">,</span>&nbsp;<span class="ident" id="6444020">file</span><span class="op" id="6444024">.</span><span class="ident" id="6444025">Decls</span><span class="op" id="6444030">[</span><span class="num" id="6444031">0</span><span class="op" id="6444032">]</span><span class="op" id="6444033">.</span><span class="op" id="6444034">(</span><span class="op" id="6444035">*</span><span class="ident" id="6444036">ast</span><span class="op" id="6444039">.</span><span class="ident" id="6444040">FuncDecl</span><span class="op" id="6444048">)</span><span class="op" id="6444049">.</span><span class="ident" id="6444050">Body</span><span class="op" id="6444054">.</span><span class="ident" id="6444055">List</span><span class="op" id="6444059">)</span>&nbsp;<span class="comment" id="6444061">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444088">if</span>&nbsp;<span class="ident" id="6444091">err</span>&nbsp;<span class="op" id="6444095">!=</span>&nbsp;<span class="ident" id="6444098">nil</span>&nbsp;<span class="op" id="6444102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6444107">panic</span><span class="op" id="6444112">(</span><span class="ident" id="6444113">err</span><span class="op" id="6444116">)</span>&nbsp;<span class="comment" id="6444118">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6444137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444142">out</span>&nbsp;<span class="op" id="6444146">:=</span>&nbsp;<span class="ident" id="6444149">buf</span><span class="op" id="6444152">.</span><span class="ident" id="6444153">String</span><span class="op" id="6444159">(</span><span class="op" id="6444160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444164">if</span>&nbsp;<span class="ident" id="6444167">out</span>&nbsp;<span class="op" id="6444171">!=</span>&nbsp;<span class="ident" id="6444174">src</span>&nbsp;<span class="op" id="6444178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444183">t</span><span class="op" id="6444184">.</span><span class="ident" id="6444185">Errorf</span><span class="op" id="6444191">(</span><span class="string" id="6444192">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="6444216">,</span>&nbsp;<span class="ident" id="6444218">out</span><span class="op" id="6444221">,</span>&nbsp;<span class="ident" id="6444223">src</span><span class="op" id="6444226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6444230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6444233">}</span><br>
<span class="lineno">480</span><span class="op" id="6444235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6444238">func</span>&nbsp;<span class="ident" id="6444243">TestBaseIndent</span><span class="op" id="6444257">(</span><span class="ident" id="6444258">t</span>&nbsp;<span class="op" id="6444260">*</span><span class="ident" id="6444261">testing</span><span class="op" id="6444268">.</span><span class="ident" id="6444269">T</span><span class="op" id="6444270">)</span>&nbsp;<span class="op" id="6444272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6444275">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6444344">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6444413">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444433">const</span>&nbsp;<span class="ident" id="6444439">filename</span>&nbsp;<span class="op" id="6444448">=</span>&nbsp;<span class="string" id="6444450">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444464">src</span><span class="op" id="6444467">,</span>&nbsp;<span class="ident" id="6444469">err</span>&nbsp;<span class="op" id="6444473">:=</span>&nbsp;<span class="ident" id="6444476">ioutil</span><span class="op" id="6444482">.</span><span class="ident" id="6444483">ReadFile</span><span class="op" id="6444491">(</span><span class="ident" id="6444492">filename</span><span class="op" id="6444500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444503">if</span>&nbsp;<span class="ident" id="6444506">err</span>&nbsp;<span class="op" id="6444510">!=</span>&nbsp;<span class="ident" id="6444513">nil</span>&nbsp;<span class="op" id="6444517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6444521">panic</span><span class="op" id="6444526">(</span><span class="ident" id="6444527">err</span><span class="op" id="6444530">)</span>&nbsp;<span class="comment" id="6444532">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6444550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444554">file</span><span class="op" id="6444558">,</span>&nbsp;<span class="ident" id="6444560">err</span>&nbsp;<span class="op" id="6444564">:=</span>&nbsp;<span class="ident" id="6444567">parser</span><span class="op" id="6444573">.</span><span class="ident" id="6444574">ParseFile</span><span class="op" id="6444583">(</span><span class="ident" id="6444584">fset</span><span class="op" id="6444588">,</span>&nbsp;<span class="ident" id="6444590">filename</span><span class="op" id="6444598">,</span>&nbsp;<span class="ident" id="6444600">src</span><span class="op" id="6444603">,</span>&nbsp;<span class="num" id="6444605">0</span><span class="op" id="6444606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444609">if</span>&nbsp;<span class="ident" id="6444612">err</span>&nbsp;<span class="op" id="6444616">!=</span>&nbsp;<span class="ident" id="6444619">nil</span>&nbsp;<span class="op" id="6444623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6444627">panic</span><span class="op" id="6444632">(</span><span class="ident" id="6444633">err</span><span class="op" id="6444636">)</span>&nbsp;<span class="comment" id="6444638">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6444656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444660">var</span>&nbsp;<span class="ident" id="6444664">buf</span>&nbsp;<span class="ident" id="6444668">bytes</span><span class="op" id="6444673">.</span><span class="ident" id="6444674">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444682">for</span>&nbsp;<span class="ident" id="6444686">indent</span>&nbsp;<span class="op" id="6444693">:=</span>&nbsp;<span class="num" id="6444696">0</span><span class="op" id="6444697">;</span>&nbsp;<span class="ident" id="6444699">indent</span>&nbsp;<span class="op" id="6444706">&lt;</span>&nbsp;<span class="num" id="6444708">4</span><span class="op" id="6444709">;</span>&nbsp;<span class="ident" id="6444711">indent</span><span class="op" id="6444717">++</span>&nbsp;<span class="op" id="6444720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444724">buf</span><span class="op" id="6444727">.</span><span class="ident" id="6444728">Reset</span><span class="op" id="6444733">(</span><span class="op" id="6444734">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6444738">(</span><span class="op" id="6444739">&amp;</span><span class="ident" id="6444740">Config</span><span class="op" id="6444746">{</span><span class="ident" id="6444747">Tabwidth</span><span class="op" id="6444755">:</span>&nbsp;<span class="ident" id="6444757">tabwidth</span><span class="op" id="6444765">,</span>&nbsp;<span class="ident" id="6444767">Indent</span><span class="op" id="6444773">:</span>&nbsp;<span class="ident" id="6444775">indent</span><span class="op" id="6444781">}</span><span class="op" id="6444782">)</span><span class="op" id="6444783">.</span><span class="ident" id="6444784">Fprint</span><span class="op" id="6444790">(</span><span class="op" id="6444791">&amp;</span><span class="ident" id="6444792">buf</span><span class="op" id="6444795">,</span>&nbsp;<span class="ident" id="6444797">fset</span><span class="op" id="6444801">,</span>&nbsp;<span class="ident" id="6444803">file</span><span class="op" id="6444807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6444811">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6444868">lines</span>&nbsp;<span class="op" id="6444874">:=</span>&nbsp;<span class="ident" id="6444877">bytes</span><span class="op" id="6444882">.</span><span class="ident" id="6444883">Split</span><span class="op" id="6444888">(</span><span class="ident" id="6444889">buf</span><span class="op" id="6444892">.</span><span class="ident" id="6444893">Bytes</span><span class="op" id="6444898">(</span><span class="op" id="6444899">)</span><span class="op" id="6444900">,</span>&nbsp;<span class="op" id="6444902">[</span><span class="op" id="6444903">]</span><span class="builtintype" id="6444904">byte</span><span class="op" id="6444908">{</span><span class="string" id="6444909">&#39;\n&#39;</span><span class="op" id="6444913">}</span><span class="op" id="6444914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444918">for</span>&nbsp;<span class="ident" id="6444922">i</span><span class="op" id="6444923">,</span>&nbsp;<span class="ident" id="6444925">line</span>&nbsp;<span class="op" id="6444930">:=</span>&nbsp;<span class="keyword" id="6444933">range</span>&nbsp;<span class="ident" id="6444939">lines</span>&nbsp;<span class="op" id="6444945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444950">if</span>&nbsp;<span class="builtinfunc" id="6444953">len</span><span class="op" id="6444956">(</span><span class="ident" id="6444957">line</span><span class="op" id="6444961">)</span>&nbsp;<span class="op" id="6444963">==</span>&nbsp;<span class="num" id="6444966">0</span>&nbsp;<span class="op" id="6444968">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6444974">continue</span>&nbsp;<span class="comment" id="6444983">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445029">n</span>&nbsp;<span class="op" id="6445031">:=</span>&nbsp;<span class="num" id="6445034">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445039">for</span>&nbsp;<span class="ident" id="6445043">j</span><span class="op" id="6445044">,</span>&nbsp;<span class="ident" id="6445046">b</span>&nbsp;<span class="op" id="6445048">:=</span>&nbsp;<span class="keyword" id="6445051">range</span>&nbsp;<span class="ident" id="6445057">line</span>&nbsp;<span class="op" id="6445062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445068">if</span>&nbsp;<span class="ident" id="6445071">b</span>&nbsp;<span class="op" id="6445073">!=</span>&nbsp;<span class="string" id="6445076">&#39;\t&#39;</span>&nbsp;<span class="op" id="6445081">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6445088">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445115">n</span>&nbsp;<span class="op" id="6445117">=</span>&nbsp;<span class="ident" id="6445119">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445126">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445141">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445146">if</span>&nbsp;<span class="ident" id="6445149">n</span>&nbsp;<span class="op" id="6445151">&lt;</span>&nbsp;<span class="ident" id="6445153">indent</span>&nbsp;<span class="op" id="6445160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445166">t</span><span class="op" id="6445167">.</span><span class="ident" id="6445168">Errorf</span><span class="op" id="6445174">(</span><span class="string" id="6445175">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="6445224">,</span>&nbsp;<span class="ident" id="6445226">i</span><span class="op" id="6445227">,</span>&nbsp;<span class="ident" id="6445229">n</span><span class="op" id="6445230">,</span>&nbsp;<span class="ident" id="6445232">indent</span><span class="op" id="6445238">,</span>&nbsp;<span class="ident" id="6445240">line</span><span class="op" id="6445244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445256">}</span><br>
<span class="lineno">520</span><span class="op" id="6445258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6445261">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6445328">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="6445400">func</span>&nbsp;<span class="ident" id="6445405">TestFuncType</span><span class="op" id="6445417">(</span><span class="ident" id="6445418">t</span>&nbsp;<span class="op" id="6445420">*</span><span class="ident" id="6445421">testing</span><span class="op" id="6445428">.</span><span class="ident" id="6445429">T</span><span class="op" id="6445430">)</span>&nbsp;<span class="op" id="6445432">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445435">src</span>&nbsp;<span class="op" id="6445439">:=</span>&nbsp;<span class="op" id="6445442">&amp;</span><span class="ident" id="6445443">ast</span><span class="op" id="6445446">.</span><span class="ident" id="6445447">File</span><span class="op" id="6445451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445455">Name</span><span class="op" id="6445459">:</span>&nbsp;<span class="op" id="6445461">&amp;</span><span class="ident" id="6445462">ast</span><span class="op" id="6445465">.</span><span class="ident" id="6445466">Ident</span><span class="op" id="6445471">{</span><span class="ident" id="6445472">Name</span><span class="op" id="6445476">:</span>&nbsp;<span class="string" id="6445478">&#34;p&#34;</span><span class="op" id="6445481">}</span><span class="op" id="6445482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445486">Decls</span><span class="op" id="6445491">:</span>&nbsp;<span class="op" id="6445493">[</span><span class="op" id="6445494">]</span><span class="ident" id="6445495">ast</span><span class="op" id="6445498">.</span><span class="ident" id="6445499">Decl</span><span class="op" id="6445503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445508">&amp;</span><span class="ident" id="6445509">ast</span><span class="op" id="6445512">.</span><span class="ident" id="6445513">FuncDecl</span><span class="op" id="6445521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445527">Name</span><span class="op" id="6445531">:</span>&nbsp;<span class="op" id="6445533">&amp;</span><span class="ident" id="6445534">ast</span><span class="op" id="6445537">.</span><span class="ident" id="6445538">Ident</span><span class="op" id="6445543">{</span><span class="ident" id="6445544">Name</span><span class="op" id="6445548">:</span>&nbsp;<span class="string" id="6445550">&#34;f&#34;</span><span class="op" id="6445553">}</span><span class="op" id="6445554">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445560">Type</span><span class="op" id="6445564">:</span>&nbsp;<span class="op" id="6445566">&amp;</span><span class="ident" id="6445567">ast</span><span class="op" id="6445570">.</span><span class="ident" id="6445571">FuncType</span><span class="op" id="6445579">{</span><span class="op" id="6445580">}</span><span class="op" id="6445581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445586">}</span><span class="op" id="6445587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445591">}</span><span class="op" id="6445592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445599">var</span>&nbsp;<span class="ident" id="6445603">buf</span>&nbsp;<span class="ident" id="6445607">bytes</span><span class="op" id="6445612">.</span><span class="ident" id="6445613">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445621">if</span>&nbsp;<span class="ident" id="6445624">err</span>&nbsp;<span class="op" id="6445628">:=</span>&nbsp;<span class="ident" id="6445631">Fprint</span><span class="op" id="6445637">(</span><span class="op" id="6445638">&amp;</span><span class="ident" id="6445639">buf</span><span class="op" id="6445642">,</span>&nbsp;<span class="ident" id="6445644">fset</span><span class="op" id="6445648">,</span>&nbsp;<span class="ident" id="6445650">src</span><span class="op" id="6445653">)</span><span class="op" id="6445654">;</span>&nbsp;<span class="ident" id="6445656">err</span>&nbsp;<span class="op" id="6445660">!=</span>&nbsp;<span class="ident" id="6445663">nil</span>&nbsp;<span class="op" id="6445667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445671">t</span><span class="op" id="6445672">.</span><span class="ident" id="6445673">Fatal</span><span class="op" id="6445678">(</span><span class="ident" id="6445679">err</span><span class="op" id="6445682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445688">got</span>&nbsp;<span class="op" id="6445692">:=</span>&nbsp;<span class="ident" id="6445695">buf</span><span class="op" id="6445698">.</span><span class="ident" id="6445699">String</span><span class="op" id="6445705">(</span><span class="op" id="6445706">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445710">const</span>&nbsp;<span class="ident" id="6445716">want</span>&nbsp;<span class="op" id="6445721">=</span>&nbsp;<span class="string" id="6445723">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445748">if</span>&nbsp;<span class="ident" id="6445751">got</span>&nbsp;<span class="op" id="6445755">!=</span>&nbsp;<span class="ident" id="6445758">want</span>&nbsp;<span class="op" id="6445763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445767">t</span><span class="op" id="6445768">.</span><span class="ident" id="6445769">Fatalf</span><span class="op" id="6445775">(</span><span class="string" id="6445776">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="6445799">,</span>&nbsp;<span class="ident" id="6445801">got</span><span class="op" id="6445804">,</span>&nbsp;<span class="ident" id="6445806">want</span><span class="op" id="6445810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6445813">}</span><br>
<span class="lineno"></span><span class="op" id="6445815">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="6445818">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="6445897">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="6445915">func</span>&nbsp;<span class="ident" id="6445920">TestX</span><span class="op" id="6445925">(</span><span class="ident" id="6445926">t</span>&nbsp;<span class="op" id="6445928">*</span><span class="ident" id="6445929">testing</span><span class="op" id="6445936">.</span><span class="ident" id="6445937">T</span><span class="op" id="6445938">)</span>&nbsp;<span class="op" id="6445940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6445943">const</span>&nbsp;<span class="ident" id="6445949">src</span>&nbsp;<span class="op" id="6445953">=</span>&nbsp;<span class="string" id="6445955">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6445982">_</span><span class="op" id="6445983">,</span>&nbsp;<span class="ident" id="6445985">err</span>&nbsp;<span class="op" id="6445989">:=</span>&nbsp;<span class="ident" id="6445992">format</span><span class="op" id="6445998">(</span><span class="op" id="6445999">[</span><span class="op" id="6446000">]</span><span class="builtintype" id="6446001">byte</span><span class="op" id="6446005">(</span><span class="ident" id="6446006">src</span><span class="op" id="6446009">)</span><span class="op" id="6446010">,</span>&nbsp;<span class="num" id="6446012">0</span><span class="op" id="6446013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6446016">if</span>&nbsp;<span class="ident" id="6446019">err</span>&nbsp;<span class="op" id="6446023">!=</span>&nbsp;<span class="ident" id="6446026">nil</span>&nbsp;<span class="op" id="6446030">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6446034">t</span><span class="op" id="6446035">.</span><span class="ident" id="6446036">Error</span><span class="op" id="6446041">(</span><span class="ident" id="6446042">err</span><span class="op" id="6446045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6446048">}</span><br>
<span class="lineno"></span><span class="op" id="6446050">}</span>
</div>
</body>
</html>
