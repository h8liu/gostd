<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5005719">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5005774">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5005828">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5005879">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="5005909">//</span><br>
<span class="lineno"></span><span class="comment" id="5005912">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="5005956">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5006009">package</span>&nbsp;<span class="ident" id="5006017">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006023">import</span>&nbsp;<span class="op" id="5006030">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006033">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006052">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006062">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006069">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006075">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006088">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006095">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006106">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006117">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5006125">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5006132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5006135">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5006202">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="5006247">//</span><br>
<span class="lineno"></span><span class="comment" id="5006250">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="5006317">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="5006384">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="5006455">//</span><br>
<span class="lineno"></span><span class="comment" id="5006458">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="5006526">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5006587">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="5006601">type</span>&nbsp;<span class="ident" id="5006606">Client</span>&nbsp;<span class="keyword" id="5006613">struct</span>&nbsp;<span class="op" id="5006620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006623">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006681">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006709">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5006747">Transport</span>&nbsp;<span class="ident" id="5006757">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006772">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006835">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006895">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5006957">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007020">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007083">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007133">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007195">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007224">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007228">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007293">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007345">CheckRedirect</span>&nbsp;<span class="keyword" id="5007359">func</span><span class="op" id="5007363">(</span><span class="ident" id="5007364">req</span>&nbsp;<span class="op" id="5007368">*</span><span class="ident" id="5007369">Request</span><span class="op" id="5007376">,</span>&nbsp;<span class="ident" id="5007378">via</span>&nbsp;<span class="op" id="5007382">[</span><span class="op" id="5007383">]</span><span class="op" id="5007384">*</span><span class="ident" id="5007385">Request</span><span class="op" id="5007392">)</span>&nbsp;<span class="builtintype" id="5007394">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007402">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007436">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007500">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5007518">Jar</span>&nbsp;<span class="ident" id="5007522">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007534">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007595">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007649">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007713">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007770">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007814">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007818">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007858">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007862">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007920">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5007984">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008044">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5008101">Timeout</span>&nbsp;<span class="ident" id="5008109">time</span><span class="op" id="5008113">.</span><span class="ident" id="5008114">Duration</span><br>
<span class="lineno"></span><span class="op" id="5008123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008126">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="5008201">var</span>&nbsp;<span class="ident" id="5008205">DefaultClient</span>&nbsp;<span class="op" id="5008219">=</span>&nbsp;<span class="op" id="5008221">&amp;</span><span class="ident" id="5008222">Client</span><span class="op" id="5008228">{</span><span class="op" id="5008229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5008232">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5008302">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="5008374">//</span><br>
<span class="lineno">80</span><span class="comment" id="5008377">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="5008439">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="5008454">type</span>&nbsp;<span class="ident" id="5008459">RoundTripper</span>&nbsp;<span class="keyword" id="5008472">interface</span>&nbsp;<span class="op" id="5008482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008485">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008545">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008605">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008660">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008724">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008786">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008847">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008901">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008954">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008986">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5008990">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009046">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009107">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009164">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009181">RoundTrip</span><span class="op" id="5009190">(</span><span class="op" id="5009191">*</span><span class="ident" id="5009192">Request</span><span class="op" id="5009199">)</span>&nbsp;<span class="op" id="5009201">(</span><span class="op" id="5009202">*</span><span class="ident" id="5009203">Response</span><span class="op" id="5009211">,</span>&nbsp;<span class="builtintype" id="5009213">error</span><span class="op" id="5009218">)</span><br>
<span class="lineno"></span><span class="op" id="5009220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5009223">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="5009301">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="5009347">func</span>&nbsp;<span class="ident" id="5009352">hasPort</span><span class="op" id="5009359">(</span><span class="ident" id="5009360">s</span>&nbsp;<span class="builtintype" id="5009362">string</span><span class="op" id="5009368">)</span>&nbsp;<span class="builtintype" id="5009370">bool</span>&nbsp;<span class="op" id="5009375">{</span>&nbsp;<span class="keyword" id="5009377">return</span>&nbsp;<span class="ident" id="5009384">strings</span><span class="op" id="5009391">.</span><span class="ident" id="5009392">LastIndex</span><span class="op" id="5009401">(</span><span class="ident" id="5009402">s</span><span class="op" id="5009403">,</span>&nbsp;<span class="string" id="5009405">&#34;:&#34;</span><span class="op" id="5009408">)</span>&nbsp;<span class="op" id="5009410">&gt;</span>&nbsp;<span class="ident" id="5009412">strings</span><span class="op" id="5009419">.</span><span class="ident" id="5009420">LastIndex</span><span class="op" id="5009429">(</span><span class="ident" id="5009430">s</span><span class="op" id="5009431">,</span>&nbsp;<span class="string" id="5009433">&#34;]&#34;</span><span class="op" id="5009436">)</span>&nbsp;<span class="op" id="5009438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009441">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="5009511">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="5009584">func</span>&nbsp;<span class="ident" id="5009589">refererForURL</span><span class="op" id="5009602">(</span><span class="ident" id="5009603">lastReq</span><span class="op" id="5009610">,</span>&nbsp;<span class="ident" id="5009612">newReq</span>&nbsp;<span class="op" id="5009619">*</span><span class="ident" id="5009620">url</span><span class="op" id="5009623">.</span><span class="ident" id="5009624">URL</span><span class="op" id="5009627">)</span>&nbsp;<span class="builtintype" id="5009629">string</span>&nbsp;<span class="op" id="5009636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009639">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009693">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009755">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009814">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009858">if</span>&nbsp;<span class="ident" id="5009861">lastReq</span><span class="op" id="5009868">.</span><span class="ident" id="5009869">Scheme</span>&nbsp;<span class="op" id="5009876">==</span>&nbsp;<span class="string" id="5009879">&#34;https&#34;</span>&nbsp;<span class="op" id="5009887">&amp;&amp;</span>&nbsp;<span class="ident" id="5009890">newReq</span><span class="op" id="5009896">.</span><span class="ident" id="5009897">Scheme</span>&nbsp;<span class="op" id="5009904">==</span>&nbsp;<span class="string" id="5009907">&#34;http&#34;</span>&nbsp;<span class="op" id="5009914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009918">return</span>&nbsp;<span class="string" id="5009925">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5009929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5009932">referer</span>&nbsp;<span class="op" id="5009940">:=</span>&nbsp;<span class="ident" id="5009943">lastReq</span><span class="op" id="5009950">.</span><span class="ident" id="5009951">String</span><span class="op" id="5009957">(</span><span class="op" id="5009958">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5009961">if</span>&nbsp;<span class="ident" id="5009964">lastReq</span><span class="op" id="5009971">.</span><span class="ident" id="5009972">User</span>&nbsp;<span class="op" id="5009977">!=</span>&nbsp;<span class="ident" id="5009980">nil</span>&nbsp;<span class="op" id="5009984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5009988">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5010044">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5010061">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5010100">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5010133">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5010191">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010233">auth</span>&nbsp;<span class="op" id="5010238">:=</span>&nbsp;<span class="ident" id="5010241">lastReq</span><span class="op" id="5010248">.</span><span class="ident" id="5010249">User</span><span class="op" id="5010253">.</span><span class="ident" id="5010254">String</span><span class="op" id="5010260">(</span><span class="op" id="5010261">)</span>&nbsp;<span class="op" id="5010263">+</span>&nbsp;<span class="string" id="5010265">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010271">referer</span>&nbsp;<span class="op" id="5010279">=</span>&nbsp;<span class="ident" id="5010281">strings</span><span class="op" id="5010288">.</span><span class="ident" id="5010289">Replace</span><span class="op" id="5010296">(</span><span class="ident" id="5010297">referer</span><span class="op" id="5010304">,</span>&nbsp;<span class="ident" id="5010306">auth</span><span class="op" id="5010310">,</span>&nbsp;<span class="string" id="5010312">&#34;&#34;</span><span class="op" id="5010314">,</span>&nbsp;<span class="num" id="5010316">1</span><span class="op" id="5010317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010320">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010323">return</span>&nbsp;<span class="ident" id="5010330">referer</span><br>
<span class="lineno"></span><span class="op" id="5010338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5010341">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5010409">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="5010480">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5010503">type</span>&nbsp;<span class="ident" id="5010508">readClose</span>&nbsp;<span class="keyword" id="5010518">struct</span>&nbsp;<span class="op" id="5010525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010528">io</span><span class="op" id="5010530">.</span><span class="ident" id="5010531">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010539">io</span><span class="op" id="5010541">.</span><span class="ident" id="5010542">Closer</span><br>
<span class="lineno"></span><span class="op" id="5010549">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="5010552">func</span>&nbsp;<span class="op" id="5010557">(</span><span class="ident" id="5010558">c</span>&nbsp;<span class="op" id="5010560">*</span><span class="ident" id="5010561">Client</span><span class="op" id="5010567">)</span>&nbsp;<span class="ident" id="5010569">send</span><span class="op" id="5010573">(</span><span class="ident" id="5010574">req</span>&nbsp;<span class="op" id="5010578">*</span><span class="ident" id="5010579">Request</span><span class="op" id="5010586">)</span>&nbsp;<span class="op" id="5010588">(</span><span class="op" id="5010589">*</span><span class="ident" id="5010590">Response</span><span class="op" id="5010598">,</span>&nbsp;<span class="builtintype" id="5010600">error</span><span class="op" id="5010605">)</span>&nbsp;<span class="op" id="5010607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010610">if</span>&nbsp;<span class="ident" id="5010613">c</span><span class="op" id="5010614">.</span><span class="ident" id="5010615">Jar</span>&nbsp;<span class="op" id="5010619">!=</span>&nbsp;<span class="ident" id="5010622">nil</span>&nbsp;<span class="op" id="5010626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010630">for</span>&nbsp;<span class="ident" id="5010634">_</span><span class="op" id="5010635">,</span>&nbsp;<span class="ident" id="5010637">cookie</span>&nbsp;<span class="op" id="5010644">:=</span>&nbsp;<span class="keyword" id="5010647">range</span>&nbsp;<span class="ident" id="5010653">c</span><span class="op" id="5010654">.</span><span class="ident" id="5010655">Jar</span><span class="op" id="5010658">.</span><span class="ident" id="5010659">Cookies</span><span class="op" id="5010666">(</span><span class="ident" id="5010667">req</span><span class="op" id="5010670">.</span><span class="ident" id="5010671">URL</span><span class="op" id="5010674">)</span>&nbsp;<span class="op" id="5010676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010681">req</span><span class="op" id="5010684">.</span><span class="ident" id="5010685">AddCookie</span><span class="op" id="5010694">(</span><span class="ident" id="5010695">cookie</span><span class="op" id="5010701">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010711">resp</span><span class="op" id="5010715">,</span>&nbsp;<span class="ident" id="5010717">err</span>&nbsp;<span class="op" id="5010721">:=</span>&nbsp;<span class="ident" id="5010724">send</span><span class="op" id="5010728">(</span><span class="ident" id="5010729">req</span><span class="op" id="5010732">,</span>&nbsp;<span class="ident" id="5010734">c</span><span class="op" id="5010735">.</span><span class="ident" id="5010736">transport</span><span class="op" id="5010745">(</span><span class="op" id="5010746">)</span><span class="op" id="5010747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010750">if</span>&nbsp;<span class="ident" id="5010753">err</span>&nbsp;<span class="op" id="5010757">!=</span>&nbsp;<span class="ident" id="5010760">nil</span>&nbsp;<span class="op" id="5010764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010768">return</span>&nbsp;<span class="ident" id="5010775">nil</span><span class="op" id="5010778">,</span>&nbsp;<span class="ident" id="5010780">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010788">if</span>&nbsp;<span class="ident" id="5010791">c</span><span class="op" id="5010792">.</span><span class="ident" id="5010793">Jar</span>&nbsp;<span class="op" id="5010797">!=</span>&nbsp;<span class="ident" id="5010800">nil</span>&nbsp;<span class="op" id="5010804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010808">if</span>&nbsp;<span class="ident" id="5010811">rc</span>&nbsp;<span class="op" id="5010814">:=</span>&nbsp;<span class="ident" id="5010817">resp</span><span class="op" id="5010821">.</span><span class="ident" id="5010822">Cookies</span><span class="op" id="5010829">(</span><span class="op" id="5010830">)</span><span class="op" id="5010831">;</span>&nbsp;<span class="builtinfunc" id="5010833">len</span><span class="op" id="5010836">(</span><span class="ident" id="5010837">rc</span><span class="op" id="5010839">)</span>&nbsp;<span class="op" id="5010841">&gt;</span>&nbsp;<span class="num" id="5010843">0</span>&nbsp;<span class="op" id="5010845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5010850">c</span><span class="op" id="5010851">.</span><span class="ident" id="5010852">Jar</span><span class="op" id="5010855">.</span><span class="ident" id="5010856">SetCookies</span><span class="op" id="5010866">(</span><span class="ident" id="5010867">req</span><span class="op" id="5010870">.</span><span class="ident" id="5010871">URL</span><span class="op" id="5010874">,</span>&nbsp;<span class="ident" id="5010876">rc</span><span class="op" id="5010878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010882">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5010885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5010888">return</span>&nbsp;<span class="ident" id="5010895">resp</span><span class="op" id="5010899">,</span>&nbsp;<span class="ident" id="5010901">err</span><br>
<span class="lineno"></span><span class="op" id="5010905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5010908">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="5010976">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="5011047">//</span><br>
<span class="lineno"></span><span class="comment" id="5011050">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="5011110">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5011169">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="5011215">//</span><br>
<span class="lineno"></span><span class="comment" id="5011218">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="5011280">//</span><br>
<span class="lineno"></span><span class="comment" id="5011283">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="5011347">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="5011412">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="5011480">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5011547">//</span><br>
<span class="lineno"></span><span class="comment" id="5011550">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5011616">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="5011646">//</span><br>
<span class="lineno"></span><span class="comment" id="5011649">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="5011713">func</span>&nbsp;<span class="op" id="5011718">(</span><span class="ident" id="5011719">c</span>&nbsp;<span class="op" id="5011721">*</span><span class="ident" id="5011722">Client</span><span class="op" id="5011728">)</span>&nbsp;<span class="ident" id="5011730">Do</span><span class="op" id="5011732">(</span><span class="ident" id="5011733">req</span>&nbsp;<span class="op" id="5011737">*</span><span class="ident" id="5011738">Request</span><span class="op" id="5011745">)</span>&nbsp;<span class="op" id="5011747">(</span><span class="ident" id="5011748">resp</span>&nbsp;<span class="op" id="5011753">*</span><span class="ident" id="5011754">Response</span><span class="op" id="5011762">,</span>&nbsp;<span class="ident" id="5011764">err</span>&nbsp;<span class="builtintype" id="5011768">error</span><span class="op" id="5011773">)</span>&nbsp;<span class="op" id="5011775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011778">if</span>&nbsp;<span class="ident" id="5011781">req</span><span class="op" id="5011784">.</span><span class="ident" id="5011785">Method</span>&nbsp;<span class="op" id="5011792">==</span>&nbsp;<span class="string" id="5011795">&#34;GET&#34;</span>&nbsp;<span class="op" id="5011801">||</span>&nbsp;<span class="ident" id="5011804">req</span><span class="op" id="5011807">.</span><span class="ident" id="5011808">Method</span>&nbsp;<span class="op" id="5011815">==</span>&nbsp;<span class="string" id="5011818">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="5011825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011829">return</span>&nbsp;<span class="ident" id="5011836">c</span><span class="op" id="5011837">.</span><span class="ident" id="5011838">doFollowingRedirects</span><span class="op" id="5011858">(</span><span class="ident" id="5011859">req</span><span class="op" id="5011862">,</span>&nbsp;<span class="ident" id="5011864">shouldRedirectGet</span><span class="op" id="5011881">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011887">if</span>&nbsp;<span class="ident" id="5011890">req</span><span class="op" id="5011893">.</span><span class="ident" id="5011894">Method</span>&nbsp;<span class="op" id="5011901">==</span>&nbsp;<span class="string" id="5011904">&#34;POST&#34;</span>&nbsp;<span class="op" id="5011911">||</span>&nbsp;<span class="ident" id="5011914">req</span><span class="op" id="5011917">.</span><span class="ident" id="5011918">Method</span>&nbsp;<span class="op" id="5011925">==</span>&nbsp;<span class="string" id="5011928">&#34;PUT&#34;</span>&nbsp;<span class="op" id="5011934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011938">return</span>&nbsp;<span class="ident" id="5011945">c</span><span class="op" id="5011946">.</span><span class="ident" id="5011947">doFollowingRedirects</span><span class="op" id="5011967">(</span><span class="ident" id="5011968">req</span><span class="op" id="5011971">,</span>&nbsp;<span class="ident" id="5011973">shouldRedirectPost</span><span class="op" id="5011991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5011994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5011997">return</span>&nbsp;<span class="ident" id="5012004">c</span><span class="op" id="5012005">.</span><span class="ident" id="5012006">send</span><span class="op" id="5012010">(</span><span class="ident" id="5012011">req</span><span class="op" id="5012014">)</span><br>
<span class="lineno">180</span><span class="op" id="5012016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5012019">func</span>&nbsp;<span class="op" id="5012024">(</span><span class="ident" id="5012025">c</span>&nbsp;<span class="op" id="5012027">*</span><span class="ident" id="5012028">Client</span><span class="op" id="5012034">)</span>&nbsp;<span class="ident" id="5012036">transport</span><span class="op" id="5012045">(</span><span class="op" id="5012046">)</span>&nbsp;<span class="ident" id="5012048">RoundTripper</span>&nbsp;<span class="op" id="5012061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012064">if</span>&nbsp;<span class="ident" id="5012067">c</span><span class="op" id="5012068">.</span><span class="ident" id="5012069">Transport</span>&nbsp;<span class="op" id="5012079">!=</span>&nbsp;<span class="ident" id="5012082">nil</span>&nbsp;<span class="op" id="5012086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012090">return</span>&nbsp;<span class="ident" id="5012097">c</span><span class="op" id="5012098">.</span><span class="ident" id="5012099">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012113">return</span>&nbsp;<span class="ident" id="5012120">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="5012137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5012140">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="5012172">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5012232">func</span>&nbsp;<span class="ident" id="5012237">send</span><span class="op" id="5012241">(</span><span class="ident" id="5012242">req</span>&nbsp;<span class="op" id="5012246">*</span><span class="ident" id="5012247">Request</span><span class="op" id="5012254">,</span>&nbsp;<span class="ident" id="5012256">t</span>&nbsp;<span class="ident" id="5012258">RoundTripper</span><span class="op" id="5012270">)</span>&nbsp;<span class="op" id="5012272">(</span><span class="ident" id="5012273">resp</span>&nbsp;<span class="op" id="5012278">*</span><span class="ident" id="5012279">Response</span><span class="op" id="5012287">,</span>&nbsp;<span class="ident" id="5012289">err</span>&nbsp;<span class="builtintype" id="5012293">error</span><span class="op" id="5012298">)</span>&nbsp;<span class="op" id="5012300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012303">if</span>&nbsp;<span class="ident" id="5012306">t</span>&nbsp;<span class="op" id="5012308">==</span>&nbsp;<span class="ident" id="5012311">nil</span>&nbsp;<span class="op" id="5012315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012319">req</span><span class="op" id="5012322">.</span><span class="ident" id="5012323">closeBody</span><span class="op" id="5012332">(</span><span class="op" id="5012333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012337">return</span>&nbsp;<span class="ident" id="5012344">nil</span><span class="op" id="5012347">,</span>&nbsp;<span class="ident" id="5012349">errors</span><span class="op" id="5012355">.</span><span class="ident" id="5012356">New</span><span class="op" id="5012359">(</span><span class="string" id="5012360">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="5012407">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012414">if</span>&nbsp;<span class="ident" id="5012417">req</span><span class="op" id="5012420">.</span><span class="ident" id="5012421">URL</span>&nbsp;<span class="op" id="5012425">==</span>&nbsp;<span class="ident" id="5012428">nil</span>&nbsp;<span class="op" id="5012432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012436">req</span><span class="op" id="5012439">.</span><span class="ident" id="5012440">closeBody</span><span class="op" id="5012449">(</span><span class="op" id="5012450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012454">return</span>&nbsp;<span class="ident" id="5012461">nil</span><span class="op" id="5012464">,</span>&nbsp;<span class="ident" id="5012466">errors</span><span class="op" id="5012472">.</span><span class="ident" id="5012473">New</span><span class="op" id="5012476">(</span><span class="string" id="5012477">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="5012500">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012507">if</span>&nbsp;<span class="ident" id="5012510">req</span><span class="op" id="5012513">.</span><span class="ident" id="5012514">RequestURI</span>&nbsp;<span class="op" id="5012525">!=</span>&nbsp;<span class="string" id="5012528">&#34;&#34;</span>&nbsp;<span class="op" id="5012531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012535">req</span><span class="op" id="5012538">.</span><span class="ident" id="5012539">closeBody</span><span class="op" id="5012548">(</span><span class="op" id="5012549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012553">return</span>&nbsp;<span class="ident" id="5012560">nil</span><span class="op" id="5012563">,</span>&nbsp;<span class="ident" id="5012565">errors</span><span class="op" id="5012571">.</span><span class="ident" id="5012572">New</span><span class="op" id="5012575">(</span><span class="string" id="5012576">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="5012635">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012642">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012701">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5012761">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012815">if</span>&nbsp;<span class="ident" id="5012818">req</span><span class="op" id="5012821">.</span><span class="ident" id="5012822">Header</span>&nbsp;<span class="op" id="5012829">==</span>&nbsp;<span class="ident" id="5012832">nil</span>&nbsp;<span class="op" id="5012836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012840">req</span><span class="op" id="5012843">.</span><span class="ident" id="5012844">Header</span>&nbsp;<span class="op" id="5012851">=</span>&nbsp;<span class="builtinfunc" id="5012853">make</span><span class="op" id="5012857">(</span><span class="ident" id="5012858">Header</span><span class="op" id="5012864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5012867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5012871">if</span>&nbsp;<span class="ident" id="5012874">u</span>&nbsp;<span class="op" id="5012876">:=</span>&nbsp;<span class="ident" id="5012879">req</span><span class="op" id="5012882">.</span><span class="ident" id="5012883">URL</span><span class="op" id="5012886">.</span><span class="ident" id="5012887">User</span><span class="op" id="5012891">;</span>&nbsp;<span class="ident" id="5012893">u</span>&nbsp;<span class="op" id="5012895">!=</span>&nbsp;<span class="ident" id="5012898">nil</span>&nbsp;<span class="op" id="5012902">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012906">username</span>&nbsp;<span class="op" id="5012915">:=</span>&nbsp;<span class="ident" id="5012918">u</span><span class="op" id="5012919">.</span><span class="ident" id="5012920">Username</span><span class="op" id="5012928">(</span><span class="op" id="5012929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012933">password</span><span class="op" id="5012941">,</span>&nbsp;<span class="ident" id="5012943">_</span>&nbsp;<span class="op" id="5012945">:=</span>&nbsp;<span class="ident" id="5012948">u</span><span class="op" id="5012949">.</span><span class="ident" id="5012950">Password</span><span class="op" id="5012958">(</span><span class="op" id="5012959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5012963">req</span><span class="op" id="5012966">.</span><span class="ident" id="5012967">Header</span><span class="op" id="5012973">.</span><span class="ident" id="5012974">Set</span><span class="op" id="5012977">(</span><span class="string" id="5012978">&#34;Authorization&#34;</span><span class="op" id="5012993">,</span>&nbsp;<span class="string" id="5012995">&#34;Basic&nbsp;&#34;</span><span class="op" id="5013003">+</span><span class="ident" id="5013004">basicAuth</span><span class="op" id="5013013">(</span><span class="ident" id="5013014">username</span><span class="op" id="5013022">,</span>&nbsp;<span class="ident" id="5013024">password</span><span class="op" id="5013032">)</span><span class="op" id="5013033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013039">resp</span><span class="op" id="5013043">,</span>&nbsp;<span class="ident" id="5013045">err</span>&nbsp;<span class="op" id="5013049">=</span>&nbsp;<span class="ident" id="5013051">t</span><span class="op" id="5013052">.</span><span class="ident" id="5013053">RoundTrip</span><span class="op" id="5013062">(</span><span class="ident" id="5013063">req</span><span class="op" id="5013066">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013069">if</span>&nbsp;<span class="ident" id="5013072">err</span>&nbsp;<span class="op" id="5013076">!=</span>&nbsp;<span class="ident" id="5013079">nil</span>&nbsp;<span class="op" id="5013083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013087">if</span>&nbsp;<span class="ident" id="5013090">resp</span>&nbsp;<span class="op" id="5013095">!=</span>&nbsp;<span class="ident" id="5013098">nil</span>&nbsp;<span class="op" id="5013102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013107">log</span><span class="op" id="5013110">.</span><span class="ident" id="5013111">Printf</span><span class="op" id="5013117">(</span><span class="string" id="5013118">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="5013179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013187">return</span>&nbsp;<span class="ident" id="5013194">nil</span><span class="op" id="5013197">,</span>&nbsp;<span class="ident" id="5013199">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013207">return</span>&nbsp;<span class="ident" id="5013214">resp</span><span class="op" id="5013218">,</span>&nbsp;<span class="ident" id="5013220">nil</span><br>
<span class="lineno"></span><span class="op" id="5013224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5013227">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="5013288">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="5013360">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="5013424">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5013463">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="5013500">func</span>&nbsp;<span class="ident" id="5013505">basicAuth</span><span class="op" id="5013514">(</span><span class="ident" id="5013515">username</span><span class="op" id="5013523">,</span>&nbsp;<span class="ident" id="5013525">password</span>&nbsp;<span class="builtintype" id="5013534">string</span><span class="op" id="5013540">)</span>&nbsp;<span class="builtintype" id="5013542">string</span>&nbsp;<span class="op" id="5013549">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5013552">auth</span>&nbsp;<span class="op" id="5013557">:=</span>&nbsp;<span class="ident" id="5013560">username</span>&nbsp;<span class="op" id="5013569">+</span>&nbsp;<span class="string" id="5013571">&#34;:&#34;</span>&nbsp;<span class="op" id="5013575">+</span>&nbsp;<span class="ident" id="5013577">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013587">return</span>&nbsp;<span class="ident" id="5013594">base64</span><span class="op" id="5013600">.</span><span class="ident" id="5013601">StdEncoding</span><span class="op" id="5013612">.</span><span class="ident" id="5013613">EncodeToString</span><span class="op" id="5013627">(</span><span class="op" id="5013628">[</span><span class="op" id="5013629">]</span><span class="builtintype" id="5013630">byte</span><span class="op" id="5013634">(</span><span class="ident" id="5013635">auth</span><span class="op" id="5013639">)</span><span class="op" id="5013640">)</span><br>
<span class="lineno"></span><span class="op" id="5013642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5013645">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="5013727">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="5013754">func</span>&nbsp;<span class="ident" id="5013759">shouldRedirectGet</span><span class="op" id="5013776">(</span><span class="ident" id="5013777">statusCode</span>&nbsp;<span class="builtintype" id="5013788">int</span><span class="op" id="5013791">)</span>&nbsp;<span class="builtintype" id="5013793">bool</span>&nbsp;<span class="op" id="5013798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013801">switch</span>&nbsp;<span class="ident" id="5013808">statusCode</span>&nbsp;<span class="op" id="5013819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013822">case</span>&nbsp;<span class="ident" id="5013827">StatusMovedPermanently</span><span class="op" id="5013849">,</span>&nbsp;<span class="ident" id="5013851">StatusFound</span><span class="op" id="5013862">,</span>&nbsp;<span class="ident" id="5013864">StatusSeeOther</span><span class="op" id="5013878">,</span>&nbsp;<span class="ident" id="5013880">StatusTemporaryRedirect</span><span class="op" id="5013903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013907">return</span>&nbsp;<span class="builtintype" id="5013914">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5013920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5013923">return</span>&nbsp;<span class="builtintype" id="5013930">false</span><br>
<span class="lineno"></span><span class="op" id="5013936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5013939">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="5014022">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="5014049">func</span>&nbsp;<span class="ident" id="5014054">shouldRedirectPost</span><span class="op" id="5014072">(</span><span class="ident" id="5014073">statusCode</span>&nbsp;<span class="builtintype" id="5014084">int</span><span class="op" id="5014087">)</span>&nbsp;<span class="builtintype" id="5014089">bool</span>&nbsp;<span class="op" id="5014094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014097">switch</span>&nbsp;<span class="ident" id="5014104">statusCode</span>&nbsp;<span class="op" id="5014115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014118">case</span>&nbsp;<span class="ident" id="5014123">StatusFound</span><span class="op" id="5014134">,</span>&nbsp;<span class="ident" id="5014136">StatusSeeOther</span><span class="op" id="5014150">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014154">return</span>&nbsp;<span class="builtintype" id="5014161">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5014167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014170">return</span>&nbsp;<span class="builtintype" id="5014177">false</span><br>
<span class="lineno"></span><span class="op" id="5014183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5014186">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5014269">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="5014347">//</span><br>
<span class="lineno"></span><span class="comment" id="5014350">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="5014380">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="5014398">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="5014420">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="5014451">//</span><br>
<span class="lineno"></span><span class="comment" id="5014454">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="5014523">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5014590">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="5014600">//</span><br>
<span class="lineno"></span><span class="comment" id="5014603">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="5014665">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5014725">//</span><br>
<span class="lineno"></span><span class="comment" id="5014728">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="5014774">func</span>&nbsp;<span class="ident" id="5014779">Get</span><span class="op" id="5014782">(</span><span class="ident" id="5014783">url</span>&nbsp;<span class="builtintype" id="5014787">string</span><span class="op" id="5014793">)</span>&nbsp;<span class="op" id="5014795">(</span><span class="ident" id="5014796">resp</span>&nbsp;<span class="op" id="5014801">*</span><span class="ident" id="5014802">Response</span><span class="op" id="5014810">,</span>&nbsp;<span class="ident" id="5014812">err</span>&nbsp;<span class="builtintype" id="5014816">error</span><span class="op" id="5014821">)</span>&nbsp;<span class="op" id="5014823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5014826">return</span>&nbsp;<span class="ident" id="5014833">DefaultClient</span><span class="op" id="5014846">.</span><span class="ident" id="5014847">Get</span><span class="op" id="5014850">(</span><span class="ident" id="5014851">url</span><span class="op" id="5014854">)</span><br>
<span class="lineno"></span><span class="op" id="5014856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5014859">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="5014932">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5015004">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5015040">//</span><br>
<span class="lineno"></span><span class="comment" id="5015043">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="5015073">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="5015091">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="5015113">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="5015144">//</span><br>
<span class="lineno"></span><span class="comment" id="5015147">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="5015216">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="5015286">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5015305">//</span><br>
<span class="lineno"></span><span class="comment" id="5015308">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="5015370">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5015430">func</span>&nbsp;<span class="op" id="5015435">(</span><span class="ident" id="5015436">c</span>&nbsp;<span class="op" id="5015438">*</span><span class="ident" id="5015439">Client</span><span class="op" id="5015445">)</span>&nbsp;<span class="ident" id="5015447">Get</span><span class="op" id="5015450">(</span><span class="ident" id="5015451">url</span>&nbsp;<span class="builtintype" id="5015455">string</span><span class="op" id="5015461">)</span>&nbsp;<span class="op" id="5015463">(</span><span class="ident" id="5015464">resp</span>&nbsp;<span class="op" id="5015469">*</span><span class="ident" id="5015470">Response</span><span class="op" id="5015478">,</span>&nbsp;<span class="ident" id="5015480">err</span>&nbsp;<span class="builtintype" id="5015484">error</span><span class="op" id="5015489">)</span>&nbsp;<span class="op" id="5015491">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015494">req</span><span class="op" id="5015497">,</span>&nbsp;<span class="ident" id="5015499">err</span>&nbsp;<span class="op" id="5015503">:=</span>&nbsp;<span class="ident" id="5015506">NewRequest</span><span class="op" id="5015516">(</span><span class="string" id="5015517">&#34;GET&#34;</span><span class="op" id="5015522">,</span>&nbsp;<span class="ident" id="5015524">url</span><span class="op" id="5015527">,</span>&nbsp;<span class="ident" id="5015529">nil</span><span class="op" id="5015532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015535">if</span>&nbsp;<span class="ident" id="5015538">err</span>&nbsp;<span class="op" id="5015542">!=</span>&nbsp;<span class="ident" id="5015545">nil</span>&nbsp;<span class="op" id="5015549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015553">return</span>&nbsp;<span class="ident" id="5015560">nil</span><span class="op" id="5015563">,</span>&nbsp;<span class="ident" id="5015565">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015573">return</span>&nbsp;<span class="ident" id="5015580">c</span><span class="op" id="5015581">.</span><span class="ident" id="5015582">doFollowingRedirects</span><span class="op" id="5015602">(</span><span class="ident" id="5015603">req</span><span class="op" id="5015606">,</span>&nbsp;<span class="ident" id="5015608">shouldRedirectGet</span><span class="op" id="5015625">)</span><br>
<span class="lineno">300</span><span class="op" id="5015627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5015630">func</span>&nbsp;<span class="op" id="5015635">(</span><span class="ident" id="5015636">c</span>&nbsp;<span class="op" id="5015638">*</span><span class="ident" id="5015639">Client</span><span class="op" id="5015645">)</span>&nbsp;<span class="ident" id="5015647">doFollowingRedirects</span><span class="op" id="5015667">(</span><span class="ident" id="5015668">ireq</span>&nbsp;<span class="op" id="5015673">*</span><span class="ident" id="5015674">Request</span><span class="op" id="5015681">,</span>&nbsp;<span class="ident" id="5015683">shouldRedirect</span>&nbsp;<span class="keyword" id="5015698">func</span><span class="op" id="5015702">(</span><span class="builtintype" id="5015703">int</span><span class="op" id="5015706">)</span>&nbsp;<span class="builtintype" id="5015708">bool</span><span class="op" id="5015712">)</span>&nbsp;<span class="op" id="5015714">(</span><span class="ident" id="5015715">resp</span>&nbsp;<span class="op" id="5015720">*</span><span class="ident" id="5015721">Response</span><span class="op" id="5015729">,</span>&nbsp;<span class="ident" id="5015731">err</span>&nbsp;<span class="builtintype" id="5015735">error</span><span class="op" id="5015740">)</span>&nbsp;<span class="op" id="5015742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015745">var</span>&nbsp;<span class="ident" id="5015749">base</span>&nbsp;<span class="op" id="5015754">*</span><span class="ident" id="5015755">url</span><span class="op" id="5015758">.</span><span class="ident" id="5015759">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015764">redirectChecker</span>&nbsp;<span class="op" id="5015780">:=</span>&nbsp;<span class="ident" id="5015783">c</span><span class="op" id="5015784">.</span><span class="ident" id="5015785">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015800">if</span>&nbsp;<span class="ident" id="5015803">redirectChecker</span>&nbsp;<span class="op" id="5015819">==</span>&nbsp;<span class="ident" id="5015822">nil</span>&nbsp;<span class="op" id="5015826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015830">redirectChecker</span>&nbsp;<span class="op" id="5015846">=</span>&nbsp;<span class="ident" id="5015848">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015873">var</span>&nbsp;<span class="ident" id="5015877">via</span>&nbsp;<span class="op" id="5015881">[</span><span class="op" id="5015882">]</span><span class="op" id="5015883">*</span><span class="ident" id="5015884">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015894">if</span>&nbsp;<span class="ident" id="5015897">ireq</span><span class="op" id="5015901">.</span><span class="ident" id="5015902">URL</span>&nbsp;<span class="op" id="5015906">==</span>&nbsp;<span class="ident" id="5015909">nil</span>&nbsp;<span class="op" id="5015913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5015917">ireq</span><span class="op" id="5015921">.</span><span class="ident" id="5015922">closeBody</span><span class="op" id="5015931">(</span><span class="op" id="5015932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015936">return</span>&nbsp;<span class="ident" id="5015943">nil</span><span class="op" id="5015946">,</span>&nbsp;<span class="ident" id="5015948">errors</span><span class="op" id="5015954">.</span><span class="ident" id="5015955">New</span><span class="op" id="5015958">(</span><span class="string" id="5015959">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="5015982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5015985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5015989">var</span>&nbsp;<span class="ident" id="5015993">reqmu</span>&nbsp;<span class="ident" id="5015999">sync</span><span class="op" id="5016003">.</span><span class="ident" id="5016004">Mutex</span>&nbsp;<span class="comment" id="5016010">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016025">req</span>&nbsp;<span class="op" id="5016029">:=</span>&nbsp;<span class="ident" id="5016032">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016039">var</span>&nbsp;<span class="ident" id="5016043">timer</span>&nbsp;<span class="op" id="5016049">*</span><span class="ident" id="5016050">time</span><span class="op" id="5016054">.</span><span class="ident" id="5016055">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016062">if</span>&nbsp;<span class="ident" id="5016065">c</span><span class="op" id="5016066">.</span><span class="ident" id="5016067">Timeout</span>&nbsp;<span class="op" id="5016075">&gt;</span>&nbsp;<span class="num" id="5016077">0</span>&nbsp;<span class="op" id="5016079">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016083">type</span>&nbsp;<span class="ident" id="5016088">canceler</span>&nbsp;<span class="keyword" id="5016097">interface</span>&nbsp;<span class="op" id="5016107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016112">CancelRequest</span><span class="op" id="5016125">(</span><span class="op" id="5016126">*</span><span class="ident" id="5016127">Request</span><span class="op" id="5016134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016142">tr</span><span class="op" id="5016144">,</span>&nbsp;<span class="ident" id="5016146">ok</span>&nbsp;<span class="op" id="5016149">:=</span>&nbsp;<span class="ident" id="5016152">c</span><span class="op" id="5016153">.</span><span class="ident" id="5016154">transport</span><span class="op" id="5016163">(</span><span class="op" id="5016164">)</span><span class="op" id="5016165">.</span><span class="op" id="5016166">(</span><span class="ident" id="5016167">canceler</span><span class="op" id="5016175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016179">if</span>&nbsp;<span class="op" id="5016182">!</span><span class="ident" id="5016183">ok</span>&nbsp;<span class="op" id="5016186">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016191">return</span>&nbsp;<span class="ident" id="5016198">nil</span><span class="op" id="5016201">,</span>&nbsp;<span class="ident" id="5016203">fmt</span><span class="op" id="5016206">.</span><span class="ident" id="5016207">Errorf</span><span class="op" id="5016213">(</span><span class="string" id="5016214">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="5016306">,</span>&nbsp;<span class="ident" id="5016308">c</span><span class="op" id="5016309">.</span><span class="ident" id="5016310">transport</span><span class="op" id="5016319">(</span><span class="op" id="5016320">)</span><span class="op" id="5016321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016329">timer</span>&nbsp;<span class="op" id="5016335">=</span>&nbsp;<span class="ident" id="5016337">time</span><span class="op" id="5016341">.</span><span class="ident" id="5016342">AfterFunc</span><span class="op" id="5016351">(</span><span class="ident" id="5016352">c</span><span class="op" id="5016353">.</span><span class="ident" id="5016354">Timeout</span><span class="op" id="5016361">,</span>&nbsp;<span class="keyword" id="5016363">func</span><span class="op" id="5016367">(</span><span class="op" id="5016368">)</span>&nbsp;<span class="op" id="5016370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016375">reqmu</span><span class="op" id="5016380">.</span><span class="ident" id="5016381">Lock</span><span class="op" id="5016385">(</span><span class="op" id="5016386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016391">defer</span>&nbsp;<span class="ident" id="5016397">reqmu</span><span class="op" id="5016402">.</span><span class="ident" id="5016403">Unlock</span><span class="op" id="5016409">(</span><span class="op" id="5016410">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016415">tr</span><span class="op" id="5016417">.</span><span class="ident" id="5016418">CancelRequest</span><span class="op" id="5016431">(</span><span class="ident" id="5016432">req</span><span class="op" id="5016435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016439">}</span><span class="op" id="5016440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016447">urlStr</span>&nbsp;<span class="op" id="5016454">:=</span>&nbsp;<span class="string" id="5016457">&#34;&#34;</span>&nbsp;<span class="comment" id="5016460">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016525">redirectFailed</span>&nbsp;<span class="op" id="5016540">:=</span>&nbsp;<span class="builtintype" id="5016543">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016550">for</span>&nbsp;<span class="ident" id="5016554">redirect</span>&nbsp;<span class="op" id="5016563">:=</span>&nbsp;<span class="num" id="5016566">0</span><span class="op" id="5016567">;</span>&nbsp;<span class="op" id="5016569">;</span>&nbsp;<span class="ident" id="5016571">redirect</span><span class="op" id="5016579">++</span>&nbsp;<span class="op" id="5016582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016586">if</span>&nbsp;<span class="ident" id="5016589">redirect</span>&nbsp;<span class="op" id="5016598">!=</span>&nbsp;<span class="num" id="5016601">0</span>&nbsp;<span class="op" id="5016603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016608">nreq</span>&nbsp;<span class="op" id="5016613">:=</span>&nbsp;<span class="builtinfunc" id="5016616">new</span><span class="op" id="5016619">(</span><span class="ident" id="5016620">Request</span><span class="op" id="5016627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016632">nreq</span><span class="op" id="5016636">.</span><span class="ident" id="5016637">Method</span>&nbsp;<span class="op" id="5016644">=</span>&nbsp;<span class="ident" id="5016646">ireq</span><span class="op" id="5016650">.</span><span class="ident" id="5016651">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016661">if</span>&nbsp;<span class="ident" id="5016664">ireq</span><span class="op" id="5016668">.</span><span class="ident" id="5016669">Method</span>&nbsp;<span class="op" id="5016676">==</span>&nbsp;<span class="string" id="5016679">&#34;POST&#34;</span>&nbsp;<span class="op" id="5016686">||</span>&nbsp;<span class="ident" id="5016689">ireq</span><span class="op" id="5016693">.</span><span class="ident" id="5016694">Method</span>&nbsp;<span class="op" id="5016701">==</span>&nbsp;<span class="string" id="5016704">&#34;PUT&#34;</span>&nbsp;<span class="op" id="5016710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016716">nreq</span><span class="op" id="5016720">.</span><span class="ident" id="5016721">Method</span>&nbsp;<span class="op" id="5016728">=</span>&nbsp;<span class="string" id="5016730">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016744">nreq</span><span class="op" id="5016748">.</span><span class="ident" id="5016749">Header</span>&nbsp;<span class="op" id="5016756">=</span>&nbsp;<span class="builtinfunc" id="5016758">make</span><span class="op" id="5016762">(</span><span class="ident" id="5016763">Header</span><span class="op" id="5016769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016774">nreq</span><span class="op" id="5016778">.</span><span class="ident" id="5016779">URL</span><span class="op" id="5016782">,</span>&nbsp;<span class="ident" id="5016784">err</span>&nbsp;<span class="op" id="5016788">=</span>&nbsp;<span class="ident" id="5016790">base</span><span class="op" id="5016794">.</span><span class="ident" id="5016795">Parse</span><span class="op" id="5016800">(</span><span class="ident" id="5016801">urlStr</span><span class="op" id="5016807">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016812">if</span>&nbsp;<span class="ident" id="5016815">err</span>&nbsp;<span class="op" id="5016819">!=</span>&nbsp;<span class="ident" id="5016822">nil</span>&nbsp;<span class="op" id="5016826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016832">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5016841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016846">if</span>&nbsp;<span class="builtinfunc" id="5016849">len</span><span class="op" id="5016852">(</span><span class="ident" id="5016853">via</span><span class="op" id="5016856">)</span>&nbsp;<span class="op" id="5016858">&gt;</span>&nbsp;<span class="num" id="5016860">0</span>&nbsp;<span class="op" id="5016862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5016868">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016899">lastReq</span>&nbsp;<span class="op" id="5016907">:=</span>&nbsp;<span class="ident" id="5016910">via</span><span class="op" id="5016913">[</span><span class="builtinfunc" id="5016914">len</span><span class="op" id="5016917">(</span><span class="ident" id="5016918">via</span><span class="op" id="5016921">)</span><span class="op" id="5016922">-</span><span class="num" id="5016923">1</span><span class="op" id="5016924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5016930">if</span>&nbsp;<span class="ident" id="5016933">ref</span>&nbsp;<span class="op" id="5016937">:=</span>&nbsp;<span class="ident" id="5016940">refererForURL</span><span class="op" id="5016953">(</span><span class="ident" id="5016954">lastReq</span><span class="op" id="5016961">.</span><span class="ident" id="5016962">URL</span><span class="op" id="5016965">,</span>&nbsp;<span class="ident" id="5016967">nreq</span><span class="op" id="5016971">.</span><span class="ident" id="5016972">URL</span><span class="op" id="5016975">)</span><span class="op" id="5016976">;</span>&nbsp;<span class="ident" id="5016978">ref</span>&nbsp;<span class="op" id="5016982">!=</span>&nbsp;<span class="string" id="5016985">&#34;&#34;</span>&nbsp;<span class="op" id="5016988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5016995">nreq</span><span class="op" id="5016999">.</span><span class="ident" id="5017000">Header</span><span class="op" id="5017006">.</span><span class="ident" id="5017007">Set</span><span class="op" id="5017010">(</span><span class="string" id="5017011">&#34;Referer&#34;</span><span class="op" id="5017020">,</span>&nbsp;<span class="ident" id="5017022">ref</span><span class="op" id="5017025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017038">err</span>&nbsp;<span class="op" id="5017042">=</span>&nbsp;<span class="ident" id="5017044">redirectChecker</span><span class="op" id="5017059">(</span><span class="ident" id="5017060">nreq</span><span class="op" id="5017064">,</span>&nbsp;<span class="ident" id="5017066">via</span><span class="op" id="5017069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017075">if</span>&nbsp;<span class="ident" id="5017078">err</span>&nbsp;<span class="op" id="5017082">!=</span>&nbsp;<span class="ident" id="5017085">nil</span>&nbsp;<span class="op" id="5017089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017096">redirectFailed</span>&nbsp;<span class="op" id="5017111">=</span>&nbsp;<span class="builtintype" id="5017113">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017123">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017133">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017143">reqmu</span><span class="op" id="5017148">.</span><span class="ident" id="5017149">Lock</span><span class="op" id="5017153">(</span><span class="op" id="5017154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017159">req</span>&nbsp;<span class="op" id="5017163">=</span>&nbsp;<span class="ident" id="5017165">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017173">reqmu</span><span class="op" id="5017178">.</span><span class="ident" id="5017179">Unlock</span><span class="op" id="5017185">(</span><span class="op" id="5017186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017190">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017195">urlStr</span>&nbsp;<span class="op" id="5017202">=</span>&nbsp;<span class="ident" id="5017204">req</span><span class="op" id="5017207">.</span><span class="ident" id="5017208">URL</span><span class="op" id="5017211">.</span><span class="ident" id="5017212">String</span><span class="op" id="5017218">(</span><span class="op" id="5017219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017223">if</span>&nbsp;<span class="ident" id="5017226">resp</span><span class="op" id="5017230">,</span>&nbsp;<span class="ident" id="5017232">err</span>&nbsp;<span class="op" id="5017236">=</span>&nbsp;<span class="ident" id="5017238">c</span><span class="op" id="5017239">.</span><span class="ident" id="5017240">send</span><span class="op" id="5017244">(</span><span class="ident" id="5017245">req</span><span class="op" id="5017248">)</span><span class="op" id="5017249">;</span>&nbsp;<span class="ident" id="5017251">err</span>&nbsp;<span class="op" id="5017255">!=</span>&nbsp;<span class="ident" id="5017258">nil</span>&nbsp;<span class="op" id="5017262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017267">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017275">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017280">if</span>&nbsp;<span class="ident" id="5017283">shouldRedirect</span><span class="op" id="5017297">(</span><span class="ident" id="5017298">resp</span><span class="op" id="5017302">.</span><span class="ident" id="5017303">StatusCode</span><span class="op" id="5017313">)</span>&nbsp;<span class="op" id="5017315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017320">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5017395">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017476">const</span>&nbsp;<span class="ident" id="5017482">maxBodySlurpSize</span>&nbsp;<span class="op" id="5017499">=</span>&nbsp;<span class="num" id="5017501">2</span>&nbsp;<span class="op" id="5017503">&lt;&lt;</span>&nbsp;<span class="num" id="5017506">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017512">if</span>&nbsp;<span class="ident" id="5017515">resp</span><span class="op" id="5017519">.</span><span class="ident" id="5017520">ContentLength</span>&nbsp;<span class="op" id="5017534">==</span>&nbsp;<span class="op" id="5017537">-</span><span class="num" id="5017538">1</span>&nbsp;<span class="op" id="5017540">||</span>&nbsp;<span class="ident" id="5017543">resp</span><span class="op" id="5017547">.</span><span class="ident" id="5017548">ContentLength</span>&nbsp;<span class="op" id="5017562">&lt;=</span>&nbsp;<span class="ident" id="5017565">maxBodySlurpSize</span>&nbsp;<span class="op" id="5017582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017588">io</span><span class="op" id="5017590">.</span><span class="ident" id="5017591">CopyN</span><span class="op" id="5017596">(</span><span class="ident" id="5017597">ioutil</span><span class="op" id="5017603">.</span><span class="ident" id="5017604">Discard</span><span class="op" id="5017611">,</span>&nbsp;<span class="ident" id="5017613">resp</span><span class="op" id="5017617">.</span><span class="ident" id="5017618">Body</span><span class="op" id="5017622">,</span>&nbsp;<span class="ident" id="5017624">maxBodySlurpSize</span><span class="op" id="5017640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017650">resp</span><span class="op" id="5017654">.</span><span class="ident" id="5017655">Body</span><span class="op" id="5017659">.</span><span class="ident" id="5017660">Close</span><span class="op" id="5017665">(</span><span class="op" id="5017666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017671">if</span>&nbsp;<span class="ident" id="5017674">urlStr</span>&nbsp;<span class="op" id="5017681">=</span>&nbsp;<span class="ident" id="5017683">resp</span><span class="op" id="5017687">.</span><span class="ident" id="5017688">Header</span><span class="op" id="5017694">.</span><span class="ident" id="5017695">Get</span><span class="op" id="5017698">(</span><span class="string" id="5017699">&#34;Location&#34;</span><span class="op" id="5017709">)</span><span class="op" id="5017710">;</span>&nbsp;<span class="ident" id="5017712">urlStr</span>&nbsp;<span class="op" id="5017719">==</span>&nbsp;<span class="string" id="5017722">&#34;&#34;</span>&nbsp;<span class="op" id="5017725">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017731">err</span>&nbsp;<span class="op" id="5017735">=</span>&nbsp;<span class="ident" id="5017737">errors</span><span class="op" id="5017743">.</span><span class="ident" id="5017744">New</span><span class="op" id="5017747">(</span><span class="ident" id="5017748">fmt</span><span class="op" id="5017751">.</span><span class="ident" id="5017752">Sprintf</span><span class="op" id="5017759">(</span><span class="string" id="5017760">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="5017797">,</span>&nbsp;<span class="ident" id="5017799">resp</span><span class="op" id="5017803">.</span><span class="ident" id="5017804">StatusCode</span><span class="op" id="5017814">)</span><span class="op" id="5017815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017821">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017835">base</span>&nbsp;<span class="op" id="5017840">=</span>&nbsp;<span class="ident" id="5017842">req</span><span class="op" id="5017845">.</span><span class="ident" id="5017846">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017853">via</span>&nbsp;<span class="op" id="5017857">=</span>&nbsp;<span class="builtinfunc" id="5017859">append</span><span class="op" id="5017865">(</span><span class="ident" id="5017866">via</span><span class="op" id="5017869">,</span>&nbsp;<span class="ident" id="5017871">req</span><span class="op" id="5017874">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017894">if</span>&nbsp;<span class="ident" id="5017897">timer</span>&nbsp;<span class="op" id="5017903">!=</span>&nbsp;<span class="ident" id="5017906">nil</span>&nbsp;<span class="op" id="5017910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017915">resp</span><span class="op" id="5017919">.</span><span class="ident" id="5017920">Body</span>&nbsp;<span class="op" id="5017925">=</span>&nbsp;<span class="op" id="5017927">&amp;</span><span class="ident" id="5017928">cancelTimerBody</span><span class="op" id="5017943">{</span><span class="ident" id="5017944">timer</span><span class="op" id="5017949">,</span>&nbsp;<span class="ident" id="5017951">resp</span><span class="op" id="5017955">.</span><span class="ident" id="5017956">Body</span><span class="op" id="5017960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017964">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5017968">return</span>&nbsp;<span class="ident" id="5017975">resp</span><span class="op" id="5017979">,</span>&nbsp;<span class="ident" id="5017981">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5017986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5017990">method</span>&nbsp;<span class="op" id="5017997">:=</span>&nbsp;<span class="ident" id="5018000">ireq</span><span class="op" id="5018004">.</span><span class="ident" id="5018005">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018013">urlErr</span>&nbsp;<span class="op" id="5018020">:=</span>&nbsp;<span class="op" id="5018023">&amp;</span><span class="ident" id="5018024">url</span><span class="op" id="5018027">.</span><span class="ident" id="5018028">Error</span><span class="op" id="5018033">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018037">Op</span><span class="op" id="5018039">:</span>&nbsp;&nbsp;<span class="ident" id="5018042">method</span><span class="op" id="5018048">[</span><span class="num" id="5018049">0</span><span class="op" id="5018050">:</span><span class="num" id="5018051">1</span><span class="op" id="5018052">]</span>&nbsp;<span class="op" id="5018054">+</span>&nbsp;<span class="ident" id="5018056">strings</span><span class="op" id="5018063">.</span><span class="ident" id="5018064">ToLower</span><span class="op" id="5018071">(</span><span class="ident" id="5018072">method</span><span class="op" id="5018078">[</span><span class="num" id="5018079">1</span><span class="op" id="5018080">:</span><span class="op" id="5018081">]</span><span class="op" id="5018082">)</span><span class="op" id="5018083">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018087">URL</span><span class="op" id="5018090">:</span>&nbsp;<span class="ident" id="5018092">urlStr</span><span class="op" id="5018098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018102">Err</span><span class="op" id="5018105">:</span>&nbsp;<span class="ident" id="5018107">err</span><span class="op" id="5018110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018117">if</span>&nbsp;<span class="ident" id="5018120">redirectFailed</span>&nbsp;<span class="op" id="5018135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018139">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018206">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5018262">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018300">return</span>&nbsp;<span class="ident" id="5018307">resp</span><span class="op" id="5018311">,</span>&nbsp;<span class="ident" id="5018313">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018325">if</span>&nbsp;<span class="ident" id="5018328">resp</span>&nbsp;<span class="op" id="5018333">!=</span>&nbsp;<span class="ident" id="5018336">nil</span>&nbsp;<span class="op" id="5018340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5018344">resp</span><span class="op" id="5018348">.</span><span class="ident" id="5018349">Body</span><span class="op" id="5018353">.</span><span class="ident" id="5018354">Close</span><span class="op" id="5018359">(</span><span class="op" id="5018360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018363">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018366">return</span>&nbsp;<span class="ident" id="5018373">nil</span><span class="op" id="5018376">,</span>&nbsp;<span class="ident" id="5018378">urlErr</span><br>
<span class="lineno"></span><span class="op" id="5018385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5018388">func</span>&nbsp;<span class="ident" id="5018393">defaultCheckRedirect</span><span class="op" id="5018413">(</span><span class="ident" id="5018414">req</span>&nbsp;<span class="op" id="5018418">*</span><span class="ident" id="5018419">Request</span><span class="op" id="5018426">,</span>&nbsp;<span class="ident" id="5018428">via</span>&nbsp;<span class="op" id="5018432">[</span><span class="op" id="5018433">]</span><span class="op" id="5018434">*</span><span class="ident" id="5018435">Request</span><span class="op" id="5018442">)</span>&nbsp;<span class="builtintype" id="5018444">error</span>&nbsp;<span class="op" id="5018450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018453">if</span>&nbsp;<span class="builtinfunc" id="5018456">len</span><span class="op" id="5018459">(</span><span class="ident" id="5018460">via</span><span class="op" id="5018463">)</span>&nbsp;<span class="op" id="5018465">&gt;=</span>&nbsp;<span class="num" id="5018468">10</span>&nbsp;<span class="op" id="5018471">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018475">return</span>&nbsp;<span class="ident" id="5018482">errors</span><span class="op" id="5018488">.</span><span class="ident" id="5018489">New</span><span class="op" id="5018492">(</span><span class="string" id="5018493">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="5018521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5018524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018527">return</span>&nbsp;<span class="ident" id="5018534">nil</span><br>
<span class="lineno"></span><span class="op" id="5018538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5018541">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="5018585">//</span><br>
<span class="lineno"></span><span class="comment" id="5018588">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5018648">//</span><br>
<span class="lineno"></span><span class="comment" id="5018651">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="5018698">func</span>&nbsp;<span class="ident" id="5018703">Post</span><span class="op" id="5018707">(</span><span class="ident" id="5018708">url</span>&nbsp;<span class="builtintype" id="5018712">string</span><span class="op" id="5018718">,</span>&nbsp;<span class="ident" id="5018720">bodyType</span>&nbsp;<span class="builtintype" id="5018729">string</span><span class="op" id="5018735">,</span>&nbsp;<span class="ident" id="5018737">body</span>&nbsp;<span class="ident" id="5018742">io</span><span class="op" id="5018744">.</span><span class="ident" id="5018745">Reader</span><span class="op" id="5018751">)</span>&nbsp;<span class="op" id="5018753">(</span><span class="ident" id="5018754">resp</span>&nbsp;<span class="op" id="5018759">*</span><span class="ident" id="5018760">Response</span><span class="op" id="5018768">,</span>&nbsp;<span class="ident" id="5018770">err</span>&nbsp;<span class="builtintype" id="5018774">error</span><span class="op" id="5018779">)</span>&nbsp;<span class="op" id="5018781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5018784">return</span>&nbsp;<span class="ident" id="5018791">DefaultClient</span><span class="op" id="5018804">.</span><span class="ident" id="5018805">Post</span><span class="op" id="5018809">(</span><span class="ident" id="5018810">url</span><span class="op" id="5018813">,</span>&nbsp;<span class="ident" id="5018815">bodyType</span><span class="op" id="5018823">,</span>&nbsp;<span class="ident" id="5018825">body</span><span class="op" id="5018829">)</span><br>
<span class="lineno"></span><span class="op" id="5018831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5018834">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="5018878">//</span><br>
<span class="lineno"></span><span class="comment" id="5018881">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5018941">//</span><br>
<span class="lineno"></span><span class="comment" id="5018944">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5019013">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="5019025">func</span>&nbsp;<span class="op" id="5019030">(</span><span class="ident" id="5019031">c</span>&nbsp;<span class="op" id="5019033">*</span><span class="ident" id="5019034">Client</span><span class="op" id="5019040">)</span>&nbsp;<span class="ident" id="5019042">Post</span><span class="op" id="5019046">(</span><span class="ident" id="5019047">url</span>&nbsp;<span class="builtintype" id="5019051">string</span><span class="op" id="5019057">,</span>&nbsp;<span class="ident" id="5019059">bodyType</span>&nbsp;<span class="builtintype" id="5019068">string</span><span class="op" id="5019074">,</span>&nbsp;<span class="ident" id="5019076">body</span>&nbsp;<span class="ident" id="5019081">io</span><span class="op" id="5019083">.</span><span class="ident" id="5019084">Reader</span><span class="op" id="5019090">)</span>&nbsp;<span class="op" id="5019092">(</span><span class="ident" id="5019093">resp</span>&nbsp;<span class="op" id="5019098">*</span><span class="ident" id="5019099">Response</span><span class="op" id="5019107">,</span>&nbsp;<span class="ident" id="5019109">err</span>&nbsp;<span class="builtintype" id="5019113">error</span><span class="op" id="5019118">)</span>&nbsp;<span class="op" id="5019120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019123">req</span><span class="op" id="5019126">,</span>&nbsp;<span class="ident" id="5019128">err</span>&nbsp;<span class="op" id="5019132">:=</span>&nbsp;<span class="ident" id="5019135">NewRequest</span><span class="op" id="5019145">(</span><span class="string" id="5019146">&#34;POST&#34;</span><span class="op" id="5019152">,</span>&nbsp;<span class="ident" id="5019154">url</span><span class="op" id="5019157">,</span>&nbsp;<span class="ident" id="5019159">body</span><span class="op" id="5019163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019166">if</span>&nbsp;<span class="ident" id="5019169">err</span>&nbsp;<span class="op" id="5019173">!=</span>&nbsp;<span class="ident" id="5019176">nil</span>&nbsp;<span class="op" id="5019180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019184">return</span>&nbsp;<span class="ident" id="5019191">nil</span><span class="op" id="5019194">,</span>&nbsp;<span class="ident" id="5019196">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5019201">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5019204">req</span><span class="op" id="5019207">.</span><span class="ident" id="5019208">Header</span><span class="op" id="5019214">.</span><span class="ident" id="5019215">Set</span><span class="op" id="5019218">(</span><span class="string" id="5019219">&#34;Content-Type&#34;</span><span class="op" id="5019233">,</span>&nbsp;<span class="ident" id="5019235">bodyType</span><span class="op" id="5019243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019246">return</span>&nbsp;<span class="ident" id="5019253">c</span><span class="op" id="5019254">.</span><span class="ident" id="5019255">doFollowingRedirects</span><span class="op" id="5019275">(</span><span class="ident" id="5019276">req</span><span class="op" id="5019279">,</span>&nbsp;<span class="ident" id="5019281">shouldRedirectPost</span><span class="op" id="5019299">)</span><br>
<span class="lineno"></span><span class="op" id="5019301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5019304">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="5019373">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="5019416">//</span><br>
<span class="lineno"></span><span class="comment" id="5019419">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="5019481">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="5019541">//</span><br>
<span class="lineno">450</span><span class="comment" id="5019544">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="5019599">func</span>&nbsp;<span class="ident" id="5019604">PostForm</span><span class="op" id="5019612">(</span><span class="ident" id="5019613">url</span>&nbsp;<span class="builtintype" id="5019617">string</span><span class="op" id="5019623">,</span>&nbsp;<span class="ident" id="5019625">data</span>&nbsp;<span class="ident" id="5019630">url</span><span class="op" id="5019633">.</span><span class="ident" id="5019634">Values</span><span class="op" id="5019640">)</span>&nbsp;<span class="op" id="5019642">(</span><span class="ident" id="5019643">resp</span>&nbsp;<span class="op" id="5019648">*</span><span class="ident" id="5019649">Response</span><span class="op" id="5019657">,</span>&nbsp;<span class="ident" id="5019659">err</span>&nbsp;<span class="builtintype" id="5019663">error</span><span class="op" id="5019668">)</span>&nbsp;<span class="op" id="5019670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5019673">return</span>&nbsp;<span class="ident" id="5019680">DefaultClient</span><span class="op" id="5019693">.</span><span class="ident" id="5019694">PostForm</span><span class="op" id="5019702">(</span><span class="ident" id="5019703">url</span><span class="op" id="5019706">,</span>&nbsp;<span class="ident" id="5019708">data</span><span class="op" id="5019712">)</span><br>
<span class="lineno"></span><span class="op" id="5019714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="5019717">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="5019765">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="5019828">//</span><br>
<span class="lineno"></span><span class="comment" id="5019831">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="5019893">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="5019953">func</span>&nbsp;<span class="op" id="5019958">(</span><span class="ident" id="5019959">c</span>&nbsp;<span class="op" id="5019961">*</span><span class="ident" id="5019962">Client</span><span class="op" id="5019968">)</span>&nbsp;<span class="ident" id="5019970">PostForm</span><span class="op" id="5019978">(</span><span class="ident" id="5019979">url</span>&nbsp;<span class="builtintype" id="5019983">string</span><span class="op" id="5019989">,</span>&nbsp;<span class="ident" id="5019991">data</span>&nbsp;<span class="ident" id="5019996">url</span><span class="op" id="5019999">.</span><span class="ident" id="5020000">Values</span><span class="op" id="5020006">)</span>&nbsp;<span class="op" id="5020008">(</span><span class="ident" id="5020009">resp</span>&nbsp;<span class="op" id="5020014">*</span><span class="ident" id="5020015">Response</span><span class="op" id="5020023">,</span>&nbsp;<span class="ident" id="5020025">err</span>&nbsp;<span class="builtintype" id="5020029">error</span><span class="op" id="5020034">)</span>&nbsp;<span class="op" id="5020036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020039">return</span>&nbsp;<span class="ident" id="5020046">c</span><span class="op" id="5020047">.</span><span class="ident" id="5020048">Post</span><span class="op" id="5020052">(</span><span class="ident" id="5020053">url</span><span class="op" id="5020056">,</span>&nbsp;<span class="string" id="5020058">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="5020093">,</span>&nbsp;<span class="ident" id="5020095">strings</span><span class="op" id="5020102">.</span><span class="ident" id="5020103">NewReader</span><span class="op" id="5020112">(</span><span class="ident" id="5020113">data</span><span class="op" id="5020117">.</span><span class="ident" id="5020118">Encode</span><span class="op" id="5020124">(</span><span class="op" id="5020125">)</span><span class="op" id="5020126">)</span><span class="op" id="5020127">)</span><br>
<span class="lineno"></span><span class="op" id="5020129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020132">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="5020207">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5020280">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5020316">//</span><br>
<span class="lineno"></span><span class="comment" id="5020319">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="5020349">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="5020367">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="5020389">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="5020420">//</span><br>
<span class="lineno"></span><span class="comment" id="5020423">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="5020470">func</span>&nbsp;<span class="ident" id="5020475">Head</span><span class="op" id="5020479">(</span><span class="ident" id="5020480">url</span>&nbsp;<span class="builtintype" id="5020484">string</span><span class="op" id="5020490">)</span>&nbsp;<span class="op" id="5020492">(</span><span class="ident" id="5020493">resp</span>&nbsp;<span class="op" id="5020498">*</span><span class="ident" id="5020499">Response</span><span class="op" id="5020507">,</span>&nbsp;<span class="ident" id="5020509">err</span>&nbsp;<span class="builtintype" id="5020513">error</span><span class="op" id="5020518">)</span>&nbsp;<span class="op" id="5020520">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020523">return</span>&nbsp;<span class="ident" id="5020530">DefaultClient</span><span class="op" id="5020543">.</span><span class="ident" id="5020544">Head</span><span class="op" id="5020548">(</span><span class="ident" id="5020549">url</span><span class="op" id="5020552">)</span><br>
<span class="lineno"></span><span class="op" id="5020554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5020557">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5020632">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="5020705">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5020741">//</span><br>
<span class="lineno"></span><span class="comment" id="5020744">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="5020774">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="5020792">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="5020814">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="5020845">func</span>&nbsp;<span class="op" id="5020850">(</span><span class="ident" id="5020851">c</span>&nbsp;<span class="op" id="5020853">*</span><span class="ident" id="5020854">Client</span><span class="op" id="5020860">)</span>&nbsp;<span class="ident" id="5020862">Head</span><span class="op" id="5020866">(</span><span class="ident" id="5020867">url</span>&nbsp;<span class="builtintype" id="5020871">string</span><span class="op" id="5020877">)</span>&nbsp;<span class="op" id="5020879">(</span><span class="ident" id="5020880">resp</span>&nbsp;<span class="op" id="5020885">*</span><span class="ident" id="5020886">Response</span><span class="op" id="5020894">,</span>&nbsp;<span class="ident" id="5020896">err</span>&nbsp;<span class="builtintype" id="5020900">error</span><span class="op" id="5020905">)</span>&nbsp;<span class="op" id="5020907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5020910">req</span><span class="op" id="5020913">,</span>&nbsp;<span class="ident" id="5020915">err</span>&nbsp;<span class="op" id="5020919">:=</span>&nbsp;<span class="ident" id="5020922">NewRequest</span><span class="op" id="5020932">(</span><span class="string" id="5020933">&#34;HEAD&#34;</span><span class="op" id="5020939">,</span>&nbsp;<span class="ident" id="5020941">url</span><span class="op" id="5020944">,</span>&nbsp;<span class="ident" id="5020946">nil</span><span class="op" id="5020949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020952">if</span>&nbsp;<span class="ident" id="5020955">err</span>&nbsp;<span class="op" id="5020959">!=</span>&nbsp;<span class="ident" id="5020962">nil</span>&nbsp;<span class="op" id="5020966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020970">return</span>&nbsp;<span class="ident" id="5020977">nil</span><span class="op" id="5020980">,</span>&nbsp;<span class="ident" id="5020982">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5020987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5020990">return</span>&nbsp;<span class="ident" id="5020997">c</span><span class="op" id="5020998">.</span><span class="ident" id="5020999">doFollowingRedirects</span><span class="op" id="5021019">(</span><span class="ident" id="5021020">req</span><span class="op" id="5021023">,</span>&nbsp;<span class="ident" id="5021025">shouldRedirectGet</span><span class="op" id="5021042">)</span><br>
<span class="lineno"></span><span class="op" id="5021044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5021047">type</span>&nbsp;<span class="ident" id="5021052">cancelTimerBody</span>&nbsp;<span class="keyword" id="5021068">struct</span>&nbsp;<span class="op" id="5021075">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021078">t</span>&nbsp;&nbsp;<span class="op" id="5021081">*</span><span class="ident" id="5021082">time</span><span class="op" id="5021086">.</span><span class="ident" id="5021087">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021094">rc</span>&nbsp;<span class="ident" id="5021097">io</span><span class="op" id="5021099">.</span><span class="ident" id="5021100">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="5021111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5021114">func</span>&nbsp;<span class="op" id="5021119">(</span><span class="ident" id="5021120">b</span>&nbsp;<span class="op" id="5021122">*</span><span class="ident" id="5021123">cancelTimerBody</span><span class="op" id="5021138">)</span>&nbsp;<span class="ident" id="5021140">Read</span><span class="op" id="5021144">(</span><span class="ident" id="5021145">p</span>&nbsp;<span class="op" id="5021147">[</span><span class="op" id="5021148">]</span><span class="builtintype" id="5021149">byte</span><span class="op" id="5021153">)</span>&nbsp;<span class="op" id="5021155">(</span><span class="ident" id="5021156">n</span>&nbsp;<span class="builtintype" id="5021158">int</span><span class="op" id="5021161">,</span>&nbsp;<span class="ident" id="5021163">err</span>&nbsp;<span class="builtintype" id="5021167">error</span><span class="op" id="5021172">)</span>&nbsp;<span class="op" id="5021174">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021177">n</span><span class="op" id="5021178">,</span>&nbsp;<span class="ident" id="5021180">err</span>&nbsp;<span class="op" id="5021184">=</span>&nbsp;<span class="ident" id="5021186">b</span><span class="op" id="5021187">.</span><span class="ident" id="5021188">rc</span><span class="op" id="5021190">.</span><span class="ident" id="5021191">Read</span><span class="op" id="5021195">(</span><span class="ident" id="5021196">p</span><span class="op" id="5021197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021200">if</span>&nbsp;<span class="ident" id="5021203">err</span>&nbsp;<span class="op" id="5021207">==</span>&nbsp;<span class="ident" id="5021210">io</span><span class="op" id="5021212">.</span><span class="ident" id="5021213">EOF</span>&nbsp;<span class="op" id="5021217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021221">b</span><span class="op" id="5021222">.</span><span class="ident" id="5021223">t</span><span class="op" id="5021224">.</span><span class="ident" id="5021225">Stop</span><span class="op" id="5021229">(</span><span class="op" id="5021230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5021233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021236">return</span><br>
<span class="lineno">505</span><span class="op" id="5021243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5021246">func</span>&nbsp;<span class="op" id="5021251">(</span><span class="ident" id="5021252">b</span>&nbsp;<span class="op" id="5021254">*</span><span class="ident" id="5021255">cancelTimerBody</span><span class="op" id="5021270">)</span>&nbsp;<span class="ident" id="5021272">Close</span><span class="op" id="5021277">(</span><span class="op" id="5021278">)</span>&nbsp;<span class="builtintype" id="5021280">error</span>&nbsp;<span class="op" id="5021286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021289">err</span>&nbsp;<span class="op" id="5021293">:=</span>&nbsp;<span class="ident" id="5021296">b</span><span class="op" id="5021297">.</span><span class="ident" id="5021298">rc</span><span class="op" id="5021300">.</span><span class="ident" id="5021301">Close</span><span class="op" id="5021306">(</span><span class="op" id="5021307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5021310">b</span><span class="op" id="5021311">.</span><span class="ident" id="5021312">t</span><span class="op" id="5021313">.</span><span class="ident" id="5021314">Stop</span><span class="op" id="5021318">(</span><span class="op" id="5021319">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5021322">return</span>&nbsp;<span class="ident" id="5021329">err</span><br>
<span class="lineno"></span><span class="op" id="5021333">}</span>
</div>
</body>
</html>
