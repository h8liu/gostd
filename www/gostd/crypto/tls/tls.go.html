<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4556112">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4556167">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4556221">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4556272">//&nbsp;Package&nbsp;tls&nbsp;partially&nbsp;implements&nbsp;TLS&nbsp;1.2,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5246.</span><br>
<span class="lineno"></span><span class="keyword" id="4556343">package</span>&nbsp;<span class="ident" id="4556351">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4556356">import</span>&nbsp;<span class="op" id="4556363">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556366">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556376">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556392">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556406">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556421">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556437">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556447">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556460">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556467">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4556478">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4556485">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4556488">//&nbsp;Server&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;server&nbsp;side&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4556539">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4556582">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4556640">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno">25</span><span class="keyword" id="4556669">func</span>&nbsp;<span class="ident" id="4556674">Server</span><span class="op" id="4556680">(</span><span class="ident" id="4556681">conn</span>&nbsp;<span class="ident" id="4556686">net</span><span class="op" id="4556689">.</span><span class="ident" id="4556690">Conn</span><span class="op" id="4556694">,</span>&nbsp;<span class="ident" id="4556696">config</span>&nbsp;<span class="op" id="4556703">*</span><span class="ident" id="4556704">Config</span><span class="op" id="4556710">)</span>&nbsp;<span class="op" id="4556712">*</span><span class="ident" id="4556713">Conn</span>&nbsp;<span class="op" id="4556718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4556721">return</span>&nbsp;<span class="op" id="4556728">&amp;</span><span class="ident" id="4556729">Conn</span><span class="op" id="4556733">{</span><span class="ident" id="4556734">conn</span><span class="op" id="4556738">:</span>&nbsp;<span class="ident" id="4556740">conn</span><span class="op" id="4556744">,</span>&nbsp;<span class="ident" id="4556746">config</span><span class="op" id="4556752">:</span>&nbsp;<span class="ident" id="4556754">config</span><span class="op" id="4556760">}</span><br>
<span class="lineno"></span><span class="op" id="4556762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4556765">//&nbsp;Client&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;client&nbsp;side&nbsp;connection</span><br>
<span class="lineno">30</span><span class="comment" id="4556816">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4556859">//&nbsp;The&nbsp;config&nbsp;cannot&nbsp;be&nbsp;nil:&nbsp;users&nbsp;must&nbsp;set&nbsp;either&nbsp;ServerName&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4556924">//&nbsp;InsecureSkipVerify&nbsp;in&nbsp;the&nbsp;config.</span><br>
<span class="lineno"></span><span class="keyword" id="4556961">func</span>&nbsp;<span class="ident" id="4556966">Client</span><span class="op" id="4556972">(</span><span class="ident" id="4556973">conn</span>&nbsp;<span class="ident" id="4556978">net</span><span class="op" id="4556981">.</span><span class="ident" id="4556982">Conn</span><span class="op" id="4556986">,</span>&nbsp;<span class="ident" id="4556988">config</span>&nbsp;<span class="op" id="4556995">*</span><span class="ident" id="4556996">Config</span><span class="op" id="4557002">)</span>&nbsp;<span class="op" id="4557004">*</span><span class="ident" id="4557005">Conn</span>&nbsp;<span class="op" id="4557010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557013">return</span>&nbsp;<span class="op" id="4557020">&amp;</span><span class="ident" id="4557021">Conn</span><span class="op" id="4557025">{</span><span class="ident" id="4557026">conn</span><span class="op" id="4557030">:</span>&nbsp;<span class="ident" id="4557032">conn</span><span class="op" id="4557036">,</span>&nbsp;<span class="ident" id="4557038">config</span><span class="op" id="4557044">:</span>&nbsp;<span class="ident" id="4557046">config</span><span class="op" id="4557052">,</span>&nbsp;<span class="ident" id="4557054">isClient</span><span class="op" id="4557062">:</span>&nbsp;<span class="builtintype" id="4557064">true</span><span class="op" id="4557068">}</span><br>
<span class="lineno">35</span><span class="op" id="4557070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4557073">//&nbsp;A&nbsp;listener&nbsp;implements&nbsp;a&nbsp;network&nbsp;listener&nbsp;(net.Listener)&nbsp;for&nbsp;TLS&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="4557153">type</span>&nbsp;<span class="ident" id="4557158">listener</span>&nbsp;<span class="keyword" id="4557167">struct</span>&nbsp;<span class="op" id="4557174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557177">net</span><span class="op" id="4557180">.</span><span class="ident" id="4557181">Listener</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557191">config</span>&nbsp;<span class="op" id="4557198">*</span><span class="ident" id="4557199">Config</span><br>
<span class="lineno"></span><span class="op" id="4557206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4557209">//&nbsp;Accept&nbsp;waits&nbsp;for&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;incoming&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4557275">//&nbsp;The&nbsp;returned&nbsp;connection&nbsp;c&nbsp;is&nbsp;a&nbsp;*tls.Conn.</span><br>
<span class="lineno">45</span><span class="keyword" id="4557320">func</span>&nbsp;<span class="op" id="4557325">(</span><span class="ident" id="4557326">l</span>&nbsp;<span class="op" id="4557328">*</span><span class="ident" id="4557329">listener</span><span class="op" id="4557337">)</span>&nbsp;<span class="ident" id="4557339">Accept</span><span class="op" id="4557345">(</span><span class="op" id="4557346">)</span>&nbsp;<span class="op" id="4557348">(</span><span class="ident" id="4557349">c</span>&nbsp;<span class="ident" id="4557351">net</span><span class="op" id="4557354">.</span><span class="ident" id="4557355">Conn</span><span class="op" id="4557359">,</span>&nbsp;<span class="ident" id="4557361">err</span>&nbsp;<span class="builtintype" id="4557365">error</span><span class="op" id="4557370">)</span>&nbsp;<span class="op" id="4557372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557375">c</span><span class="op" id="4557376">,</span>&nbsp;<span class="ident" id="4557378">err</span>&nbsp;<span class="op" id="4557382">=</span>&nbsp;<span class="ident" id="4557384">l</span><span class="op" id="4557385">.</span><span class="ident" id="4557386">Listener</span><span class="op" id="4557394">.</span><span class="ident" id="4557395">Accept</span><span class="op" id="4557401">(</span><span class="op" id="4557402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557405">if</span>&nbsp;<span class="ident" id="4557408">err</span>&nbsp;<span class="op" id="4557412">!=</span>&nbsp;<span class="ident" id="4557415">nil</span>&nbsp;<span class="op" id="4557419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557423">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4557431">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557434">c</span>&nbsp;<span class="op" id="4557436">=</span>&nbsp;<span class="ident" id="4557438">Server</span><span class="op" id="4557444">(</span><span class="ident" id="4557445">c</span><span class="op" id="4557446">,</span>&nbsp;<span class="ident" id="4557448">l</span><span class="op" id="4557449">.</span><span class="ident" id="4557450">config</span><span class="op" id="4557456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557459">return</span><br>
<span class="lineno"></span><span class="op" id="4557466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4557469">//&nbsp;NewListener&nbsp;creates&nbsp;a&nbsp;Listener&nbsp;which&nbsp;accepts&nbsp;connections&nbsp;from&nbsp;an&nbsp;inner</span><br>
<span class="lineno">55</span><span class="comment" id="4557543">//&nbsp;Listener&nbsp;and&nbsp;wraps&nbsp;each&nbsp;connection&nbsp;with&nbsp;Server.</span><br>
<span class="lineno"></span><span class="comment" id="4557594">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4557652">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4557681">func</span>&nbsp;<span class="ident" id="4557686">NewListener</span><span class="op" id="4557697">(</span><span class="ident" id="4557698">inner</span>&nbsp;<span class="ident" id="4557704">net</span><span class="op" id="4557707">.</span><span class="ident" id="4557708">Listener</span><span class="op" id="4557716">,</span>&nbsp;<span class="ident" id="4557718">config</span>&nbsp;<span class="op" id="4557725">*</span><span class="ident" id="4557726">Config</span><span class="op" id="4557732">)</span>&nbsp;<span class="ident" id="4557734">net</span><span class="op" id="4557737">.</span><span class="ident" id="4557738">Listener</span>&nbsp;<span class="op" id="4557747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557750">l</span>&nbsp;<span class="op" id="4557752">:=</span>&nbsp;<span class="builtinfunc" id="4557755">new</span><span class="op" id="4557758">(</span><span class="ident" id="4557759">listener</span><span class="op" id="4557767">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557770">l</span><span class="op" id="4557771">.</span><span class="ident" id="4557772">Listener</span>&nbsp;<span class="op" id="4557781">=</span>&nbsp;<span class="ident" id="4557783">inner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4557790">l</span><span class="op" id="4557791">.</span><span class="ident" id="4557792">config</span>&nbsp;<span class="op" id="4557799">=</span>&nbsp;<span class="ident" id="4557801">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4557809">return</span>&nbsp;<span class="ident" id="4557816">l</span><br>
<span class="lineno"></span><span class="op" id="4557818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4557821">//&nbsp;Listen&nbsp;creates&nbsp;a&nbsp;TLS&nbsp;listener&nbsp;accepting&nbsp;connections&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4557883">//&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Listen.</span><br>
<span class="lineno"></span><span class="comment" id="4557926">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4557984">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4558013">func</span>&nbsp;<span class="ident" id="4558018">Listen</span><span class="op" id="4558024">(</span><span class="ident" id="4558025">network</span><span class="op" id="4558032">,</span>&nbsp;<span class="ident" id="4558034">laddr</span>&nbsp;<span class="builtintype" id="4558040">string</span><span class="op" id="4558046">,</span>&nbsp;<span class="ident" id="4558048">config</span>&nbsp;<span class="op" id="4558055">*</span><span class="ident" id="4558056">Config</span><span class="op" id="4558062">)</span>&nbsp;<span class="op" id="4558064">(</span><span class="ident" id="4558065">net</span><span class="op" id="4558068">.</span><span class="ident" id="4558069">Listener</span><span class="op" id="4558077">,</span>&nbsp;<span class="builtintype" id="4558079">error</span><span class="op" id="4558084">)</span>&nbsp;<span class="op" id="4558086">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558089">if</span>&nbsp;<span class="ident" id="4558092">config</span>&nbsp;<span class="op" id="4558099">==</span>&nbsp;<span class="ident" id="4558102">nil</span>&nbsp;<span class="op" id="4558106">||</span>&nbsp;<span class="builtinfunc" id="4558109">len</span><span class="op" id="4558112">(</span><span class="ident" id="4558113">config</span><span class="op" id="4558119">.</span><span class="ident" id="4558120">Certificates</span><span class="op" id="4558132">)</span>&nbsp;<span class="op" id="4558134">==</span>&nbsp;<span class="num" id="4558137">0</span>&nbsp;<span class="op" id="4558139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558143">return</span>&nbsp;<span class="ident" id="4558150">nil</span><span class="op" id="4558153">,</span>&nbsp;<span class="ident" id="4558155">errors</span><span class="op" id="4558161">.</span><span class="ident" id="4558162">New</span><span class="op" id="4558165">(</span><span class="string" id="4558166">&#34;tls.Listen:&nbsp;no&nbsp;certificates&nbsp;in&nbsp;configuration&#34;</span><span class="op" id="4558212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4558218">l</span><span class="op" id="4558219">,</span>&nbsp;<span class="ident" id="4558221">err</span>&nbsp;<span class="op" id="4558225">:=</span>&nbsp;<span class="ident" id="4558228">net</span><span class="op" id="4558231">.</span><span class="ident" id="4558232">Listen</span><span class="op" id="4558238">(</span><span class="ident" id="4558239">network</span><span class="op" id="4558246">,</span>&nbsp;<span class="ident" id="4558248">laddr</span><span class="op" id="4558253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558256">if</span>&nbsp;<span class="ident" id="4558259">err</span>&nbsp;<span class="op" id="4558263">!=</span>&nbsp;<span class="ident" id="4558266">nil</span>&nbsp;<span class="op" id="4558270">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558274">return</span>&nbsp;<span class="ident" id="4558281">nil</span><span class="op" id="4558284">,</span>&nbsp;<span class="ident" id="4558286">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4558291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4558294">return</span>&nbsp;<span class="ident" id="4558301">NewListener</span><span class="op" id="4558312">(</span><span class="ident" id="4558313">l</span><span class="op" id="4558314">,</span>&nbsp;<span class="ident" id="4558316">config</span><span class="op" id="4558322">)</span><span class="op" id="4558323">,</span>&nbsp;<span class="ident" id="4558325">nil</span><br>
<span class="lineno"></span><span class="op" id="4558329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4558332">type</span>&nbsp;<span class="ident" id="4558337">timeoutError</span>&nbsp;<span class="keyword" id="4558350">struct</span><span class="op" id="4558356">{</span><span class="op" id="4558357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4558360">func</span>&nbsp;<span class="op" id="4558365">(</span><span class="ident" id="4558366">timeoutError</span><span class="op" id="4558378">)</span>&nbsp;<span class="ident" id="4558380">Error</span><span class="op" id="4558385">(</span><span class="op" id="4558386">)</span>&nbsp;<span class="builtintype" id="4558388">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4558397">{</span>&nbsp;<span class="keyword" id="4558399">return</span>&nbsp;<span class="string" id="4558406">&#34;tls:&nbsp;DialWithDialer&nbsp;timed&nbsp;out&#34;</span>&nbsp;<span class="op" id="4558438">}</span><br>
<span class="lineno"></span><span class="keyword" id="4558440">func</span>&nbsp;<span class="op" id="4558445">(</span><span class="ident" id="4558446">timeoutError</span><span class="op" id="4558458">)</span>&nbsp;<span class="ident" id="4558460">Timeout</span><span class="op" id="4558467">(</span><span class="op" id="4558468">)</span>&nbsp;<span class="builtintype" id="4558470">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4558477">{</span>&nbsp;<span class="keyword" id="4558479">return</span>&nbsp;<span class="builtintype" id="4558486">true</span>&nbsp;<span class="op" id="4558491">}</span><br>
<span class="lineno"></span><span class="keyword" id="4558493">func</span>&nbsp;<span class="op" id="4558498">(</span><span class="ident" id="4558499">timeoutError</span><span class="op" id="4558511">)</span>&nbsp;<span class="ident" id="4558513">Temporary</span><span class="op" id="4558522">(</span><span class="op" id="4558523">)</span>&nbsp;<span class="builtintype" id="4558525">bool</span>&nbsp;<span class="op" id="4558530">{</span>&nbsp;<span class="keyword" id="4558532">return</span>&nbsp;<span class="builtintype" id="4558539">true</span>&nbsp;<span class="op" id="4558544">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4558547">//&nbsp;DialWithDialer&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;dialer.Dial&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4558625">//&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting&nbsp;TLS&nbsp;connection.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4558704">//&nbsp;timeout&nbsp;or&nbsp;deadline&nbsp;given&nbsp;in&nbsp;the&nbsp;dialer&nbsp;apply&nbsp;to&nbsp;connection&nbsp;and&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4558775">//&nbsp;handshake&nbsp;as&nbsp;a&nbsp;whole.</span><br>
<span class="lineno">90</span><span class="comment" id="4558800">//</span><br>
<span class="lineno"></span><span class="comment" id="4558803">//&nbsp;DialWithDialer&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4558878">//&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4558946">func</span>&nbsp;<span class="ident" id="4558951">DialWithDialer</span><span class="op" id="4558965">(</span><span class="ident" id="4558966">dialer</span>&nbsp;<span class="op" id="4558973">*</span><span class="ident" id="4558974">net</span><span class="op" id="4558977">.</span><span class="ident" id="4558978">Dialer</span><span class="op" id="4558984">,</span>&nbsp;<span class="ident" id="4558986">network</span><span class="op" id="4558993">,</span>&nbsp;<span class="ident" id="4558995">addr</span>&nbsp;<span class="builtintype" id="4559000">string</span><span class="op" id="4559006">,</span>&nbsp;<span class="ident" id="4559008">config</span>&nbsp;<span class="op" id="4559015">*</span><span class="ident" id="4559016">Config</span><span class="op" id="4559022">)</span>&nbsp;<span class="op" id="4559024">(</span><span class="op" id="4559025">*</span><span class="ident" id="4559026">Conn</span><span class="op" id="4559030">,</span>&nbsp;<span class="builtintype" id="4559032">error</span><span class="op" id="4559037">)</span>&nbsp;<span class="op" id="4559039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559042">//&nbsp;We&nbsp;want&nbsp;the&nbsp;Timeout&nbsp;and&nbsp;Deadline&nbsp;values&nbsp;from&nbsp;dialer&nbsp;to&nbsp;cover&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559111">//&nbsp;whole&nbsp;process:&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;TLS&nbsp;handshake.&nbsp;This&nbsp;means&nbsp;that&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559183">//&nbsp;also&nbsp;need&nbsp;to&nbsp;start&nbsp;our&nbsp;own&nbsp;timers&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559226">timeout</span>&nbsp;<span class="op" id="4559234">:=</span>&nbsp;<span class="ident" id="4559237">dialer</span><span class="op" id="4559243">.</span><span class="ident" id="4559244">Timeout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559254">if</span>&nbsp;<span class="op" id="4559257">!</span><span class="ident" id="4559258">dialer</span><span class="op" id="4559264">.</span><span class="ident" id="4559265">Deadline</span><span class="op" id="4559273">.</span><span class="ident" id="4559274">IsZero</span><span class="op" id="4559280">(</span><span class="op" id="4559281">)</span>&nbsp;<span class="op" id="4559283">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559287">deadlineTimeout</span>&nbsp;<span class="op" id="4559303">:=</span>&nbsp;<span class="ident" id="4559306">dialer</span><span class="op" id="4559312">.</span><span class="ident" id="4559313">Deadline</span><span class="op" id="4559321">.</span><span class="ident" id="4559322">Sub</span><span class="op" id="4559325">(</span><span class="ident" id="4559326">time</span><span class="op" id="4559330">.</span><span class="ident" id="4559331">Now</span><span class="op" id="4559334">(</span><span class="op" id="4559335">)</span><span class="op" id="4559336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559340">if</span>&nbsp;<span class="ident" id="4559343">timeout</span>&nbsp;<span class="op" id="4559351">==</span>&nbsp;<span class="num" id="4559354">0</span>&nbsp;<span class="op" id="4559356">||</span>&nbsp;<span class="ident" id="4559359">deadlineTimeout</span>&nbsp;<span class="op" id="4559375">&lt;</span>&nbsp;<span class="ident" id="4559377">timeout</span>&nbsp;<span class="op" id="4559385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559390">timeout</span>&nbsp;<span class="op" id="4559398">=</span>&nbsp;<span class="ident" id="4559400">deadlineTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559421">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559425">var</span>&nbsp;<span class="ident" id="4559429">errChannel</span>&nbsp;<span class="keyword" id="4559440">chan</span>&nbsp;<span class="builtintype" id="4559445">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559453">if</span>&nbsp;<span class="ident" id="4559456">timeout</span>&nbsp;<span class="op" id="4559464">!=</span>&nbsp;<span class="num" id="4559467">0</span>&nbsp;<span class="op" id="4559469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559473">errChannel</span>&nbsp;<span class="op" id="4559484">=</span>&nbsp;<span class="builtinfunc" id="4559486">make</span><span class="op" id="4559490">(</span><span class="keyword" id="4559491">chan</span>&nbsp;<span class="builtintype" id="4559496">error</span><span class="op" id="4559501">,</span>&nbsp;<span class="num" id="4559503">2</span><span class="op" id="4559504">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559508">time</span><span class="op" id="4559512">.</span><span class="ident" id="4559513">AfterFunc</span><span class="op" id="4559522">(</span><span class="ident" id="4559523">timeout</span><span class="op" id="4559530">,</span>&nbsp;<span class="keyword" id="4559532">func</span><span class="op" id="4559536">(</span><span class="op" id="4559537">)</span>&nbsp;<span class="op" id="4559539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559544">errChannel</span>&nbsp;<span class="op" id="4559555">&lt;-</span>&nbsp;<span class="ident" id="4559558">timeoutError</span><span class="op" id="4559570">{</span><span class="op" id="4559571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559575">}</span><span class="op" id="4559576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559583">rawConn</span><span class="op" id="4559590">,</span>&nbsp;<span class="ident" id="4559592">err</span>&nbsp;<span class="op" id="4559596">:=</span>&nbsp;<span class="ident" id="4559599">dialer</span><span class="op" id="4559605">.</span><span class="ident" id="4559606">Dial</span><span class="op" id="4559610">(</span><span class="ident" id="4559611">network</span><span class="op" id="4559618">,</span>&nbsp;<span class="ident" id="4559620">addr</span><span class="op" id="4559624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559627">if</span>&nbsp;<span class="ident" id="4559630">err</span>&nbsp;<span class="op" id="4559634">!=</span>&nbsp;<span class="ident" id="4559637">nil</span>&nbsp;<span class="op" id="4559641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559645">return</span>&nbsp;<span class="ident" id="4559652">nil</span><span class="op" id="4559655">,</span>&nbsp;<span class="ident" id="4559657">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559666">colonPos</span>&nbsp;<span class="op" id="4559675">:=</span>&nbsp;<span class="ident" id="4559678">strings</span><span class="op" id="4559685">.</span><span class="ident" id="4559686">LastIndex</span><span class="op" id="4559695">(</span><span class="ident" id="4559696">addr</span><span class="op" id="4559700">,</span>&nbsp;<span class="string" id="4559702">&#34;:&#34;</span><span class="op" id="4559705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559708">if</span>&nbsp;<span class="ident" id="4559711">colonPos</span>&nbsp;<span class="op" id="4559720">==</span>&nbsp;<span class="op" id="4559723">-</span><span class="num" id="4559724">1</span>&nbsp;<span class="op" id="4559726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559730">colonPos</span>&nbsp;<span class="op" id="4559739">=</span>&nbsp;<span class="builtinfunc" id="4559741">len</span><span class="op" id="4559744">(</span><span class="ident" id="4559745">addr</span><span class="op" id="4559749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559755">hostname</span>&nbsp;<span class="op" id="4559764">:=</span>&nbsp;<span class="ident" id="4559767">addr</span><span class="op" id="4559771">[</span><span class="op" id="4559772">:</span><span class="ident" id="4559773">colonPos</span><span class="op" id="4559781">]</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559785">if</span>&nbsp;<span class="ident" id="4559788">config</span>&nbsp;<span class="op" id="4559795">==</span>&nbsp;<span class="ident" id="4559798">nil</span>&nbsp;<span class="op" id="4559802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4559806">config</span>&nbsp;<span class="op" id="4559813">=</span>&nbsp;<span class="ident" id="4559815">defaultConfig</span><span class="op" id="4559828">(</span><span class="op" id="4559829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4559832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559835">//&nbsp;If&nbsp;no&nbsp;ServerName&nbsp;is&nbsp;set,&nbsp;infer&nbsp;the&nbsp;ServerName</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559885">//&nbsp;from&nbsp;the&nbsp;hostname&nbsp;we&#39;re&nbsp;connecting&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4559928">if</span>&nbsp;<span class="ident" id="4559931">config</span><span class="op" id="4559937">.</span><span class="ident" id="4559938">ServerName</span>&nbsp;<span class="op" id="4559949">==</span>&nbsp;<span class="string" id="4559952">&#34;&#34;</span>&nbsp;<span class="op" id="4559955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4559959">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;to&nbsp;avoid&nbsp;polluting&nbsp;argument&nbsp;or&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560016">c</span>&nbsp;<span class="op" id="4560018">:=</span>&nbsp;<span class="op" id="4560021">*</span><span class="ident" id="4560022">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560031">c</span><span class="op" id="4560032">.</span><span class="ident" id="4560033">ServerName</span>&nbsp;<span class="op" id="4560044">=</span>&nbsp;<span class="ident" id="4560046">hostname</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560057">config</span>&nbsp;<span class="op" id="4560064">=</span>&nbsp;<span class="op" id="4560066">&amp;</span><span class="ident" id="4560067">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560074">conn</span>&nbsp;<span class="op" id="4560079">:=</span>&nbsp;<span class="ident" id="4560082">Client</span><span class="op" id="4560088">(</span><span class="ident" id="4560089">rawConn</span><span class="op" id="4560096">,</span>&nbsp;<span class="ident" id="4560098">config</span><span class="op" id="4560104">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560108">if</span>&nbsp;<span class="ident" id="4560111">timeout</span>&nbsp;<span class="op" id="4560119">==</span>&nbsp;<span class="num" id="4560122">0</span>&nbsp;<span class="op" id="4560124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560128">err</span>&nbsp;<span class="op" id="4560132">=</span>&nbsp;<span class="ident" id="4560134">conn</span><span class="op" id="4560138">.</span><span class="ident" id="4560139">Handshake</span><span class="op" id="4560148">(</span><span class="op" id="4560149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560152">}</span>&nbsp;<span class="keyword" id="4560154">else</span>&nbsp;<span class="op" id="4560159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560163">go</span>&nbsp;<span class="keyword" id="4560166">func</span><span class="op" id="4560170">(</span><span class="op" id="4560171">)</span>&nbsp;<span class="op" id="4560173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560178">errChannel</span>&nbsp;<span class="op" id="4560189">&lt;-</span>&nbsp;<span class="ident" id="4560192">conn</span><span class="op" id="4560196">.</span><span class="ident" id="4560197">Handshake</span><span class="op" id="4560206">(</span><span class="op" id="4560207">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560211">}</span><span class="op" id="4560212">(</span><span class="op" id="4560213">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560218">err</span>&nbsp;<span class="op" id="4560222">=</span>&nbsp;<span class="op" id="4560224">&lt;-</span><span class="ident" id="4560226">errChannel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560242">if</span>&nbsp;<span class="ident" id="4560245">err</span>&nbsp;<span class="op" id="4560249">!=</span>&nbsp;<span class="ident" id="4560252">nil</span>&nbsp;<span class="op" id="4560256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560260">rawConn</span><span class="op" id="4560267">.</span><span class="ident" id="4560268">Close</span><span class="op" id="4560273">(</span><span class="op" id="4560274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560278">return</span>&nbsp;<span class="ident" id="4560285">nil</span><span class="op" id="4560288">,</span>&nbsp;<span class="ident" id="4560290">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4560295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560299">return</span>&nbsp;<span class="ident" id="4560306">conn</span><span class="op" id="4560310">,</span>&nbsp;<span class="ident" id="4560312">nil</span><br>
<span class="lineno"></span><span class="op" id="4560316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4560319">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno"></span><span class="comment" id="4560380">//&nbsp;and&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting</span><br>
<span class="lineno">160</span><span class="comment" id="4560443">//&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4560462">//&nbsp;Dial&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4560518">//&nbsp;the&nbsp;zero&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config</span><br>
<span class="lineno"></span><span class="comment" id="4560577">//&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4560598">func</span>&nbsp;<span class="ident" id="4560603">Dial</span><span class="op" id="4560607">(</span><span class="ident" id="4560608">network</span><span class="op" id="4560615">,</span>&nbsp;<span class="ident" id="4560617">addr</span>&nbsp;<span class="builtintype" id="4560622">string</span><span class="op" id="4560628">,</span>&nbsp;<span class="ident" id="4560630">config</span>&nbsp;<span class="op" id="4560637">*</span><span class="ident" id="4560638">Config</span><span class="op" id="4560644">)</span>&nbsp;<span class="op" id="4560646">(</span><span class="op" id="4560647">*</span><span class="ident" id="4560648">Conn</span><span class="op" id="4560652">,</span>&nbsp;<span class="builtintype" id="4560654">error</span><span class="op" id="4560659">)</span>&nbsp;<span class="op" id="4560661">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560664">return</span>&nbsp;<span class="ident" id="4560671">DialWithDialer</span><span class="op" id="4560685">(</span><span class="builtinfunc" id="4560686">new</span><span class="op" id="4560689">(</span><span class="ident" id="4560690">net</span><span class="op" id="4560693">.</span><span class="ident" id="4560694">Dialer</span><span class="op" id="4560700">)</span><span class="op" id="4560701">,</span>&nbsp;<span class="ident" id="4560703">network</span><span class="op" id="4560710">,</span>&nbsp;<span class="ident" id="4560712">addr</span><span class="op" id="4560716">,</span>&nbsp;<span class="ident" id="4560718">config</span><span class="op" id="4560724">)</span><br>
<span class="lineno"></span><span class="op" id="4560726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4560729">//&nbsp;LoadX509KeyPair&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4560806">//&nbsp;files.&nbsp;The&nbsp;files&nbsp;must&nbsp;contain&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno">170</span><span class="keyword" id="4560857">func</span>&nbsp;<span class="ident" id="4560862">LoadX509KeyPair</span><span class="op" id="4560877">(</span><span class="ident" id="4560878">certFile</span><span class="op" id="4560886">,</span>&nbsp;<span class="ident" id="4560888">keyFile</span>&nbsp;<span class="builtintype" id="4560896">string</span><span class="op" id="4560902">)</span>&nbsp;<span class="op" id="4560904">(</span><span class="ident" id="4560905">cert</span>&nbsp;<span class="ident" id="4560910">Certificate</span><span class="op" id="4560921">,</span>&nbsp;<span class="ident" id="4560923">err</span>&nbsp;<span class="builtintype" id="4560927">error</span><span class="op" id="4560932">)</span>&nbsp;<span class="op" id="4560934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4560937">certPEMBlock</span><span class="op" id="4560949">,</span>&nbsp;<span class="ident" id="4560951">err</span>&nbsp;<span class="op" id="4560955">:=</span>&nbsp;<span class="ident" id="4560958">ioutil</span><span class="op" id="4560964">.</span><span class="ident" id="4560965">ReadFile</span><span class="op" id="4560973">(</span><span class="ident" id="4560974">certFile</span><span class="op" id="4560982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4560985">if</span>&nbsp;<span class="ident" id="4560988">err</span>&nbsp;<span class="op" id="4560992">!=</span>&nbsp;<span class="ident" id="4560995">nil</span>&nbsp;<span class="op" id="4560999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561003">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561011">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561014">keyPEMBlock</span><span class="op" id="4561025">,</span>&nbsp;<span class="ident" id="4561027">err</span>&nbsp;<span class="op" id="4561031">:=</span>&nbsp;<span class="ident" id="4561034">ioutil</span><span class="op" id="4561040">.</span><span class="ident" id="4561041">ReadFile</span><span class="op" id="4561049">(</span><span class="ident" id="4561050">keyFile</span><span class="op" id="4561057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561060">if</span>&nbsp;<span class="ident" id="4561063">err</span>&nbsp;<span class="op" id="4561067">!=</span>&nbsp;<span class="ident" id="4561070">nil</span>&nbsp;<span class="op" id="4561074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561078">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561089">return</span>&nbsp;<span class="ident" id="4561096">X509KeyPair</span><span class="op" id="4561107">(</span><span class="ident" id="4561108">certPEMBlock</span><span class="op" id="4561120">,</span>&nbsp;<span class="ident" id="4561122">keyPEMBlock</span><span class="op" id="4561133">)</span><br>
<span class="lineno">180</span><span class="op" id="4561135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4561138">//&nbsp;X509KeyPair&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4561201">//&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4561222">func</span>&nbsp;<span class="ident" id="4561227">X509KeyPair</span><span class="op" id="4561238">(</span><span class="ident" id="4561239">certPEMBlock</span><span class="op" id="4561251">,</span>&nbsp;<span class="ident" id="4561253">keyPEMBlock</span>&nbsp;<span class="op" id="4561265">[</span><span class="op" id="4561266">]</span><span class="builtintype" id="4561267">byte</span><span class="op" id="4561271">)</span>&nbsp;<span class="op" id="4561273">(</span><span class="ident" id="4561274">cert</span>&nbsp;<span class="ident" id="4561279">Certificate</span><span class="op" id="4561290">,</span>&nbsp;<span class="ident" id="4561292">err</span>&nbsp;<span class="builtintype" id="4561296">error</span><span class="op" id="4561301">)</span>&nbsp;<span class="op" id="4561303">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561306">var</span>&nbsp;<span class="ident" id="4561310">certDERBlock</span>&nbsp;<span class="op" id="4561323">*</span><span class="ident" id="4561324">pem</span><span class="op" id="4561327">.</span><span class="ident" id="4561328">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561335">for</span>&nbsp;<span class="op" id="4561339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561343">certDERBlock</span><span class="op" id="4561355">,</span>&nbsp;<span class="ident" id="4561357">certPEMBlock</span>&nbsp;<span class="op" id="4561370">=</span>&nbsp;<span class="ident" id="4561372">pem</span><span class="op" id="4561375">.</span><span class="ident" id="4561376">Decode</span><span class="op" id="4561382">(</span><span class="ident" id="4561383">certPEMBlock</span><span class="op" id="4561395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561399">if</span>&nbsp;<span class="ident" id="4561402">certDERBlock</span>&nbsp;<span class="op" id="4561415">==</span>&nbsp;<span class="ident" id="4561418">nil</span>&nbsp;<span class="op" id="4561422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561427">break</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561439">if</span>&nbsp;<span class="ident" id="4561442">certDERBlock</span><span class="op" id="4561454">.</span><span class="ident" id="4561455">Type</span>&nbsp;<span class="op" id="4561460">==</span>&nbsp;<span class="string" id="4561463">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4561477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561482">cert</span><span class="op" id="4561486">.</span><span class="ident" id="4561487">Certificate</span>&nbsp;<span class="op" id="4561499">=</span>&nbsp;<span class="builtinfunc" id="4561501">append</span><span class="op" id="4561507">(</span><span class="ident" id="4561508">cert</span><span class="op" id="4561512">.</span><span class="ident" id="4561513">Certificate</span><span class="op" id="4561524">,</span>&nbsp;<span class="ident" id="4561526">certDERBlock</span><span class="op" id="4561538">.</span><span class="ident" id="4561539">Bytes</span><span class="op" id="4561544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561551">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561555">if</span>&nbsp;<span class="builtinfunc" id="4561558">len</span><span class="op" id="4561561">(</span><span class="ident" id="4561562">cert</span><span class="op" id="4561566">.</span><span class="ident" id="4561567">Certificate</span><span class="op" id="4561578">)</span>&nbsp;<span class="op" id="4561580">==</span>&nbsp;<span class="num" id="4561583">0</span>&nbsp;<span class="op" id="4561585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561589">err</span>&nbsp;<span class="op" id="4561593">=</span>&nbsp;<span class="ident" id="4561595">errors</span><span class="op" id="4561601">.</span><span class="ident" id="4561602">New</span><span class="op" id="4561605">(</span><span class="string" id="4561606">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4561656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561660">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561668">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561672">var</span>&nbsp;<span class="ident" id="4561676">keyDERBlock</span>&nbsp;<span class="op" id="4561688">*</span><span class="ident" id="4561689">pem</span><span class="op" id="4561692">.</span><span class="ident" id="4561693">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561700">for</span>&nbsp;<span class="op" id="4561704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561708">keyDERBlock</span><span class="op" id="4561719">,</span>&nbsp;<span class="ident" id="4561721">keyPEMBlock</span>&nbsp;<span class="op" id="4561733">=</span>&nbsp;<span class="ident" id="4561735">pem</span><span class="op" id="4561738">.</span><span class="ident" id="4561739">Decode</span><span class="op" id="4561745">(</span><span class="ident" id="4561746">keyPEMBlock</span><span class="op" id="4561757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561761">if</span>&nbsp;<span class="ident" id="4561764">keyDERBlock</span>&nbsp;<span class="op" id="4561776">==</span>&nbsp;<span class="ident" id="4561779">nil</span>&nbsp;<span class="op" id="4561783">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561788">err</span>&nbsp;<span class="op" id="4561792">=</span>&nbsp;<span class="ident" id="4561794">errors</span><span class="op" id="4561800">.</span><span class="ident" id="4561801">New</span><span class="op" id="4561804">(</span><span class="string" id="4561805">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;key&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4561847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561852">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561865">if</span>&nbsp;<span class="ident" id="4561868">keyDERBlock</span><span class="op" id="4561879">.</span><span class="ident" id="4561880">Type</span>&nbsp;<span class="op" id="4561885">==</span>&nbsp;<span class="string" id="4561888">&#34;PRIVATE&nbsp;KEY&#34;</span>&nbsp;<span class="op" id="4561902">||</span>&nbsp;<span class="ident" id="4561905">strings</span><span class="op" id="4561912">.</span><span class="ident" id="4561913">HasSuffix</span><span class="op" id="4561922">(</span><span class="ident" id="4561923">keyDERBlock</span><span class="op" id="4561934">.</span><span class="ident" id="4561935">Type</span><span class="op" id="4561939">,</span>&nbsp;<span class="string" id="4561941">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="4561955">)</span>&nbsp;<span class="op" id="4561957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4561962">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4561973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4561977">cert</span><span class="op" id="4561981">.</span><span class="ident" id="4561982">PrivateKey</span><span class="op" id="4561992">,</span>&nbsp;<span class="ident" id="4561994">err</span>&nbsp;<span class="op" id="4561998">=</span>&nbsp;<span class="ident" id="4562000">parsePrivateKey</span><span class="op" id="4562015">(</span><span class="ident" id="4562016">keyDERBlock</span><span class="op" id="4562027">.</span><span class="ident" id="4562028">Bytes</span><span class="op" id="4562033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562036">if</span>&nbsp;<span class="ident" id="4562039">err</span>&nbsp;<span class="op" id="4562043">!=</span>&nbsp;<span class="ident" id="4562046">nil</span>&nbsp;<span class="op" id="4562050">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562054">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4562066">//&nbsp;We&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;parse&nbsp;the&nbsp;public&nbsp;key&nbsp;for&nbsp;TLS,&nbsp;but&nbsp;we&nbsp;so&nbsp;do&nbsp;anyway</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4562137">//&nbsp;to&nbsp;check&nbsp;that&nbsp;it&nbsp;looks&nbsp;sane&nbsp;and&nbsp;matches&nbsp;the&nbsp;private&nbsp;key.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562198">x509Cert</span><span class="op" id="4562206">,</span>&nbsp;<span class="ident" id="4562208">err</span>&nbsp;<span class="op" id="4562212">:=</span>&nbsp;<span class="ident" id="4562215">x509</span><span class="op" id="4562219">.</span><span class="ident" id="4562220">ParseCertificate</span><span class="op" id="4562236">(</span><span class="ident" id="4562237">cert</span><span class="op" id="4562241">.</span><span class="ident" id="4562242">Certificate</span><span class="op" id="4562253">[</span><span class="num" id="4562254">0</span><span class="op" id="4562255">]</span><span class="op" id="4562256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562259">if</span>&nbsp;<span class="ident" id="4562262">err</span>&nbsp;<span class="op" id="4562266">!=</span>&nbsp;<span class="ident" id="4562269">nil</span>&nbsp;<span class="op" id="4562273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562277">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562289">switch</span>&nbsp;<span class="ident" id="4562296">pub</span>&nbsp;<span class="op" id="4562300">:=</span>&nbsp;<span class="ident" id="4562303">x509Cert</span><span class="op" id="4562311">.</span><span class="ident" id="4562312">PublicKey</span><span class="op" id="4562321">.</span><span class="op" id="4562322">(</span><span class="keyword" id="4562323">type</span><span class="op" id="4562327">)</span>&nbsp;<span class="op" id="4562329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562332">case</span>&nbsp;<span class="op" id="4562337">*</span><span class="ident" id="4562338">rsa</span><span class="op" id="4562341">.</span><span class="ident" id="4562342">PublicKey</span><span class="op" id="4562351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562355">priv</span><span class="op" id="4562359">,</span>&nbsp;<span class="ident" id="4562361">ok</span>&nbsp;<span class="op" id="4562364">:=</span>&nbsp;<span class="ident" id="4562367">cert</span><span class="op" id="4562371">.</span><span class="ident" id="4562372">PrivateKey</span><span class="op" id="4562382">.</span><span class="op" id="4562383">(</span><span class="op" id="4562384">*</span><span class="ident" id="4562385">rsa</span><span class="op" id="4562388">.</span><span class="ident" id="4562389">PrivateKey</span><span class="op" id="4562399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562403">if</span>&nbsp;<span class="op" id="4562406">!</span><span class="ident" id="4562407">ok</span>&nbsp;<span class="op" id="4562410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562415">err</span>&nbsp;<span class="op" id="4562419">=</span>&nbsp;<span class="ident" id="4562421">errors</span><span class="op" id="4562427">.</span><span class="ident" id="4562428">New</span><span class="op" id="4562431">(</span><span class="string" id="4562432">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4562493">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562498">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562511">if</span>&nbsp;<span class="ident" id="4562514">pub</span><span class="op" id="4562517">.</span><span class="ident" id="4562518">N</span><span class="op" id="4562519">.</span><span class="ident" id="4562520">Cmp</span><span class="op" id="4562523">(</span><span class="ident" id="4562524">priv</span><span class="op" id="4562528">.</span><span class="ident" id="4562529">N</span><span class="op" id="4562530">)</span>&nbsp;<span class="op" id="4562532">!=</span>&nbsp;<span class="num" id="4562535">0</span>&nbsp;<span class="op" id="4562537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562542">err</span>&nbsp;<span class="op" id="4562546">=</span>&nbsp;<span class="ident" id="4562548">errors</span><span class="op" id="4562554">.</span><span class="ident" id="4562555">New</span><span class="op" id="4562558">(</span><span class="string" id="4562559">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4562610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562615">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562627">case</span>&nbsp;<span class="op" id="4562632">*</span><span class="ident" id="4562633">ecdsa</span><span class="op" id="4562638">.</span><span class="ident" id="4562639">PublicKey</span><span class="op" id="4562648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562652">priv</span><span class="op" id="4562656">,</span>&nbsp;<span class="ident" id="4562658">ok</span>&nbsp;<span class="op" id="4562661">:=</span>&nbsp;<span class="ident" id="4562664">cert</span><span class="op" id="4562668">.</span><span class="ident" id="4562669">PrivateKey</span><span class="op" id="4562679">.</span><span class="op" id="4562680">(</span><span class="op" id="4562681">*</span><span class="ident" id="4562682">ecdsa</span><span class="op" id="4562687">.</span><span class="ident" id="4562688">PrivateKey</span><span class="op" id="4562698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562702">if</span>&nbsp;<span class="op" id="4562705">!</span><span class="ident" id="4562706">ok</span>&nbsp;<span class="op" id="4562709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562714">err</span>&nbsp;<span class="op" id="4562718">=</span>&nbsp;<span class="ident" id="4562720">errors</span><span class="op" id="4562726">.</span><span class="ident" id="4562727">New</span><span class="op" id="4562730">(</span><span class="string" id="4562731">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4562792">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562797">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562811">if</span>&nbsp;<span class="ident" id="4562814">pub</span><span class="op" id="4562817">.</span><span class="ident" id="4562818">X</span><span class="op" id="4562819">.</span><span class="ident" id="4562820">Cmp</span><span class="op" id="4562823">(</span><span class="ident" id="4562824">priv</span><span class="op" id="4562828">.</span><span class="ident" id="4562829">X</span><span class="op" id="4562830">)</span>&nbsp;<span class="op" id="4562832">!=</span>&nbsp;<span class="num" id="4562835">0</span>&nbsp;<span class="op" id="4562837">||</span>&nbsp;<span class="ident" id="4562840">pub</span><span class="op" id="4562843">.</span><span class="ident" id="4562844">Y</span><span class="op" id="4562845">.</span><span class="ident" id="4562846">Cmp</span><span class="op" id="4562849">(</span><span class="ident" id="4562850">priv</span><span class="op" id="4562854">.</span><span class="ident" id="4562855">Y</span><span class="op" id="4562856">)</span>&nbsp;<span class="op" id="4562858">!=</span>&nbsp;<span class="num" id="4562861">0</span>&nbsp;<span class="op" id="4562863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562868">err</span>&nbsp;<span class="op" id="4562872">=</span>&nbsp;<span class="ident" id="4562874">errors</span><span class="op" id="4562880">.</span><span class="ident" id="4562881">New</span><span class="op" id="4562884">(</span><span class="string" id="4562885">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4562936">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562941">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4562950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4562953">default</span><span class="op" id="4562960">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4562964">err</span>&nbsp;<span class="op" id="4562968">=</span>&nbsp;<span class="ident" id="4562970">errors</span><span class="op" id="4562976">.</span><span class="ident" id="4562977">New</span><span class="op" id="4562980">(</span><span class="string" id="4562981">&#34;crypto/tls:&nbsp;unknown&nbsp;public&nbsp;key&nbsp;algorithm&#34;</span><span class="op" id="4563023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563027">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563039">return</span><br>
<span class="lineno"></span><span class="op" id="4563046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4563049">//&nbsp;Attempt&nbsp;to&nbsp;parse&nbsp;the&nbsp;given&nbsp;private&nbsp;key&nbsp;DER&nbsp;block.&nbsp;OpenSSL&nbsp;0.9.8&nbsp;generates</span><br>
<span class="lineno"></span><span class="comment" id="4563126">//&nbsp;PKCS#1&nbsp;private&nbsp;keys&nbsp;by&nbsp;default,&nbsp;while&nbsp;OpenSSL&nbsp;1.0.0&nbsp;generates&nbsp;PKCS#8&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4563204">//&nbsp;OpenSSL&nbsp;ecparam&nbsp;generates&nbsp;SEC1&nbsp;EC&nbsp;private&nbsp;keys&nbsp;for&nbsp;ECDSA.&nbsp;We&nbsp;try&nbsp;all&nbsp;three.</span><br>
<span class="lineno"></span><span class="keyword" id="4563283">func</span>&nbsp;<span class="ident" id="4563288">parsePrivateKey</span><span class="op" id="4563303">(</span><span class="ident" id="4563304">der</span>&nbsp;<span class="op" id="4563308">[</span><span class="op" id="4563309">]</span><span class="builtintype" id="4563310">byte</span><span class="op" id="4563314">)</span>&nbsp;<span class="op" id="4563316">(</span><span class="ident" id="4563317">crypto</span><span class="op" id="4563323">.</span><span class="ident" id="4563324">PrivateKey</span><span class="op" id="4563334">,</span>&nbsp;<span class="builtintype" id="4563336">error</span><span class="op" id="4563341">)</span>&nbsp;<span class="op" id="4563343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563346">if</span>&nbsp;<span class="ident" id="4563349">key</span><span class="op" id="4563352">,</span>&nbsp;<span class="ident" id="4563354">err</span>&nbsp;<span class="op" id="4563358">:=</span>&nbsp;<span class="ident" id="4563361">x509</span><span class="op" id="4563365">.</span><span class="ident" id="4563366">ParsePKCS1PrivateKey</span><span class="op" id="4563386">(</span><span class="ident" id="4563387">der</span><span class="op" id="4563390">)</span><span class="op" id="4563391">;</span>&nbsp;<span class="ident" id="4563393">err</span>&nbsp;<span class="op" id="4563397">==</span>&nbsp;<span class="ident" id="4563400">nil</span>&nbsp;<span class="op" id="4563404">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563408">return</span>&nbsp;<span class="ident" id="4563415">key</span><span class="op" id="4563418">,</span>&nbsp;<span class="ident" id="4563420">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563428">if</span>&nbsp;<span class="ident" id="4563431">key</span><span class="op" id="4563434">,</span>&nbsp;<span class="ident" id="4563436">err</span>&nbsp;<span class="op" id="4563440">:=</span>&nbsp;<span class="ident" id="4563443">x509</span><span class="op" id="4563447">.</span><span class="ident" id="4563448">ParsePKCS8PrivateKey</span><span class="op" id="4563468">(</span><span class="ident" id="4563469">der</span><span class="op" id="4563472">)</span><span class="op" id="4563473">;</span>&nbsp;<span class="ident" id="4563475">err</span>&nbsp;<span class="op" id="4563479">==</span>&nbsp;<span class="ident" id="4563482">nil</span>&nbsp;<span class="op" id="4563486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563490">switch</span>&nbsp;<span class="ident" id="4563497">key</span>&nbsp;<span class="op" id="4563501">:=</span>&nbsp;<span class="ident" id="4563504">key</span><span class="op" id="4563507">.</span><span class="op" id="4563508">(</span><span class="keyword" id="4563509">type</span><span class="op" id="4563513">)</span>&nbsp;<span class="op" id="4563515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563519">case</span>&nbsp;<span class="op" id="4563524">*</span><span class="ident" id="4563525">rsa</span><span class="op" id="4563528">.</span><span class="ident" id="4563529">PrivateKey</span><span class="op" id="4563539">,</span>&nbsp;<span class="op" id="4563541">*</span><span class="ident" id="4563542">ecdsa</span><span class="op" id="4563547">.</span><span class="ident" id="4563548">PrivateKey</span><span class="op" id="4563558">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563563">return</span>&nbsp;<span class="ident" id="4563570">key</span><span class="op" id="4563573">,</span>&nbsp;<span class="ident" id="4563575">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563581">default</span><span class="op" id="4563588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563593">return</span>&nbsp;<span class="ident" id="4563600">nil</span><span class="op" id="4563603">,</span>&nbsp;<span class="ident" id="4563605">errors</span><span class="op" id="4563611">.</span><span class="ident" id="4563612">New</span><span class="op" id="4563615">(</span><span class="string" id="4563616">&#34;crypto/tls:&nbsp;found&nbsp;unknown&nbsp;private&nbsp;key&nbsp;type&nbsp;in&nbsp;PKCS#8&nbsp;wrapping&#34;</span><span class="op" id="4563679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563686">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563689">if</span>&nbsp;<span class="ident" id="4563692">key</span><span class="op" id="4563695">,</span>&nbsp;<span class="ident" id="4563697">err</span>&nbsp;<span class="op" id="4563701">:=</span>&nbsp;<span class="ident" id="4563704">x509</span><span class="op" id="4563708">.</span><span class="ident" id="4563709">ParseECPrivateKey</span><span class="op" id="4563726">(</span><span class="ident" id="4563727">der</span><span class="op" id="4563730">)</span><span class="op" id="4563731">;</span>&nbsp;<span class="ident" id="4563733">err</span>&nbsp;<span class="op" id="4563737">==</span>&nbsp;<span class="ident" id="4563740">nil</span>&nbsp;<span class="op" id="4563744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563748">return</span>&nbsp;<span class="ident" id="4563755">key</span><span class="op" id="4563758">,</span>&nbsp;<span class="ident" id="4563760">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4563765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4563769">return</span>&nbsp;<span class="ident" id="4563776">nil</span><span class="op" id="4563779">,</span>&nbsp;<span class="ident" id="4563781">errors</span><span class="op" id="4563787">.</span><span class="ident" id="4563788">New</span><span class="op" id="4563791">(</span><span class="string" id="4563792">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;private&nbsp;key&#34;</span><span class="op" id="4563833">)</span><br>
<span class="lineno">275</span><span class="op" id="4563835">}</span>
</div>
</body>
</html>
