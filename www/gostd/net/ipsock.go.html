<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html" class="current">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3785558">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3785614">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3785668">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3785719">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785756">package</span>&nbsp;<span class="ident" id="3785764">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785769">import</span>&nbsp;<span class="op" id="3785776">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3785779">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3785789">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3785796">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3785799">var</span>&nbsp;<span class="op" id="3785803">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3785806">//&nbsp;supportsIPv4&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3785866">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3785896">supportsIPv4</span>&nbsp;<span class="builtintype" id="3785909">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3785916">//&nbsp;supportsIPv6&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3785976">//&nbsp;networking&nbsp;functionality.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3786006">supportsIPv6</span>&nbsp;<span class="builtintype" id="3786019">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786026">//&nbsp;supportsIPv4map&nbsp;reports&nbsp;whether&nbsp;the&nbsp;platform&nbsp;supports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786084">//&nbsp;mapping&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;inside&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;at&nbsp;transport</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786148">//&nbsp;layer&nbsp;protocols.&nbsp;&nbsp;See&nbsp;RFC&nbsp;4291,&nbsp;RFC&nbsp;4038&nbsp;and&nbsp;RFC&nbsp;3493.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3786207">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3786223">bool</span><br>
<span class="lineno"></span><span class="op" id="3786228">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3786231">func</span>&nbsp;<span class="ident" id="3786236">init</span><span class="op" id="3786240">(</span><span class="op" id="3786241">)</span>&nbsp;<span class="op" id="3786243">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3786246">sysInit</span><span class="op" id="3786253">(</span><span class="op" id="3786254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3786257">supportsIPv4</span>&nbsp;<span class="op" id="3786270">=</span>&nbsp;<span class="ident" id="3786272">probeIPv4Stack</span><span class="op" id="3786286">(</span><span class="op" id="3786287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3786290">supportsIPv6</span><span class="op" id="3786302">,</span>&nbsp;<span class="ident" id="3786304">supportsIPv4map</span>&nbsp;<span class="op" id="3786320">=</span>&nbsp;<span class="ident" id="3786322">probeIPv6Stack</span><span class="op" id="3786336">(</span><span class="op" id="3786337">)</span><br>
<span class="lineno"></span><span class="op" id="3786339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3786342">//&nbsp;A&nbsp;netaddr&nbsp;represents&nbsp;a&nbsp;network&nbsp;endpoint&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3786406">//&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3786437">type</span>&nbsp;<span class="ident" id="3786442">netaddr</span>&nbsp;<span class="keyword" id="3786450">interface</span>&nbsp;<span class="op" id="3786460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786463">//&nbsp;toAddr&nbsp;returns&nbsp;the&nbsp;address&nbsp;represented&nbsp;in&nbsp;Addr&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786525">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;nil&nbsp;interface&nbsp;when&nbsp;the&nbsp;address&nbsp;is&nbsp;nil.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3786581">toAddr</span><span class="op" id="3786587">(</span><span class="op" id="3786588">)</span>&nbsp;<span class="ident" id="3786590">Addr</span><br>
<span class="lineno"></span><span class="op" id="3786595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3786598">//&nbsp;An&nbsp;addrList&nbsp;represents&nbsp;a&nbsp;list&nbsp;of&nbsp;network&nbsp;endpoint&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3786662">type</span>&nbsp;<span class="ident" id="3786667">addrList</span>&nbsp;<span class="op" id="3786676">[</span><span class="op" id="3786677">]</span><span class="ident" id="3786678">netaddr</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3786687">func</span>&nbsp;<span class="op" id="3786692">(</span><span class="ident" id="3786693">al</span>&nbsp;<span class="ident" id="3786696">addrList</span><span class="op" id="3786704">)</span>&nbsp;<span class="ident" id="3786706">toAddr</span><span class="op" id="3786712">(</span><span class="op" id="3786713">)</span>&nbsp;<span class="ident" id="3786715">Addr</span>&nbsp;<span class="op" id="3786720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786723">switch</span>&nbsp;<span class="builtinfunc" id="3786730">len</span><span class="op" id="3786733">(</span><span class="ident" id="3786734">al</span><span class="op" id="3786736">)</span>&nbsp;<span class="op" id="3786738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786741">case</span>&nbsp;<span class="num" id="3786746">0</span><span class="op" id="3786747">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786751">return</span>&nbsp;<span class="builtintype" id="3786758">nil</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786763">case</span>&nbsp;<span class="num" id="3786768">1</span><span class="op" id="3786769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786773">return</span>&nbsp;<span class="ident" id="3786780">al</span><span class="op" id="3786782">[</span><span class="num" id="3786783">0</span><span class="op" id="3786784">]</span><span class="op" id="3786785">.</span><span class="ident" id="3786786">toAddr</span><span class="op" id="3786792">(</span><span class="op" id="3786793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786796">default</span><span class="op" id="3786803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786807">//&nbsp;For&nbsp;now,&nbsp;we&#39;ll&nbsp;roughly&nbsp;pick&nbsp;first&nbsp;one&nbsp;without</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786858">//&nbsp;considering&nbsp;dealing&nbsp;with&nbsp;any&nbsp;preferences&nbsp;such&nbsp;as</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786912">//&nbsp;DNS&nbsp;TTL,&nbsp;transport&nbsp;path&nbsp;quality,&nbsp;network&nbsp;routing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3786966">//&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3786984">return</span>&nbsp;<span class="ident" id="3786991">al</span><span class="op" id="3786993">[</span><span class="num" id="3786994">0</span><span class="op" id="3786995">]</span><span class="op" id="3786996">.</span><span class="ident" id="3786997">toAddr</span><span class="op" id="3787003">(</span><span class="op" id="3787004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3787007">}</span><br>
<span class="lineno"></span><span class="op" id="3787009">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3787012">var</span>&nbsp;<span class="ident" id="3787016">errNoSuitableAddress</span>&nbsp;<span class="op" id="3787037">=</span>&nbsp;<span class="ident" id="3787039">errors</span><span class="op" id="3787045">.</span><span class="ident" id="3787046">New</span><span class="op" id="3787049">(</span><span class="string" id="3787050">&#34;no&nbsp;suitable&nbsp;address&nbsp;found&#34;</span><span class="op" id="3787077">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3787080">//&nbsp;firstFavoriteAddr&nbsp;returns&nbsp;an&nbsp;address&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;addresses&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3787148">//&nbsp;implement&nbsp;the&nbsp;netaddr&nbsp;interface.&nbsp;Known&nbsp;filters&nbsp;are&nbsp;nil,&nbsp;ipv4only</span><br>
<span class="lineno">65</span><span class="comment" id="3787216">//&nbsp;and&nbsp;ipv6only.&nbsp;It&nbsp;returns&nbsp;any&nbsp;address&nbsp;when&nbsp;filter&nbsp;is&nbsp;nil.&nbsp;The&nbsp;result</span><br>
<span class="lineno"></span><span class="comment" id="3787287">//&nbsp;contains&nbsp;at&nbsp;least&nbsp;one&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3787339">func</span>&nbsp;<span class="ident" id="3787344">firstFavoriteAddr</span><span class="op" id="3787361">(</span><span class="ident" id="3787362">filter</span>&nbsp;<span class="keyword" id="3787369">func</span><span class="op" id="3787373">(</span><span class="ident" id="3787374">IP</span><span class="op" id="3787376">)</span>&nbsp;<span class="ident" id="3787378">IP</span><span class="op" id="3787380">,</span>&nbsp;<span class="ident" id="3787382">ips</span>&nbsp;<span class="op" id="3787386">[</span><span class="op" id="3787387">]</span><span class="ident" id="3787388">IP</span><span class="op" id="3787390">,</span>&nbsp;<span class="ident" id="3787392">inetaddr</span>&nbsp;<span class="keyword" id="3787401">func</span><span class="op" id="3787405">(</span><span class="ident" id="3787406">IP</span><span class="op" id="3787408">)</span>&nbsp;<span class="ident" id="3787410">netaddr</span><span class="op" id="3787417">)</span>&nbsp;<span class="op" id="3787419">(</span><span class="ident" id="3787420">netaddr</span><span class="op" id="3787427">,</span>&nbsp;<span class="builtintype" id="3787429">error</span><span class="op" id="3787434">)</span>&nbsp;<span class="op" id="3787436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3787439">if</span>&nbsp;<span class="ident" id="3787442">filter</span>&nbsp;<span class="op" id="3787449">!=</span>&nbsp;<span class="builtintype" id="3787452">nil</span>&nbsp;<span class="op" id="3787456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3787460">return</span>&nbsp;<span class="ident" id="3787467">firstSupportedAddr</span><span class="op" id="3787485">(</span><span class="ident" id="3787486">filter</span><span class="op" id="3787492">,</span>&nbsp;<span class="ident" id="3787494">ips</span><span class="op" id="3787497">,</span>&nbsp;<span class="ident" id="3787499">inetaddr</span><span class="op" id="3787507">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3787510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3787513">var</span>&nbsp;<span class="op" id="3787517">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3787521">ipv4</span><span class="op" id="3787525">,</span>&nbsp;<span class="ident" id="3787527">ipv6</span><span class="op" id="3787531">,</span>&nbsp;<span class="ident" id="3787533">swap</span>&nbsp;<span class="builtintype" id="3787538">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3787545">list</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3787562">addrList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3787572">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3787575">for</span>&nbsp;<span class="ident" id="3787579">_</span><span class="op" id="3787580">,</span>&nbsp;<span class="ident" id="3787582">ip</span>&nbsp;<span class="op" id="3787585">:=</span>&nbsp;<span class="keyword" id="3787588">range</span>&nbsp;<span class="ident" id="3787594">ips</span>&nbsp;<span class="op" id="3787598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3787602">//&nbsp;We&#39;ll&nbsp;take&nbsp;any&nbsp;IP&nbsp;address,&nbsp;but&nbsp;since&nbsp;the&nbsp;dialing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3787656">//&nbsp;code&nbsp;does&nbsp;not&nbsp;yet&nbsp;try&nbsp;multiple&nbsp;addresses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3787702">//&nbsp;effectively,&nbsp;prefer&nbsp;to&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3787753">//&nbsp;possible.&nbsp;This&nbsp;is&nbsp;especially&nbsp;relevant&nbsp;if&nbsp;localhost</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3787809">//&nbsp;resolves&nbsp;to&nbsp;[ipv6-localhost,&nbsp;ipv4-localhost].&nbsp;Too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3787864">//&nbsp;much&nbsp;code&nbsp;assumes&nbsp;localhost&nbsp;==&nbsp;ipv4-localhost.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3787916">if</span>&nbsp;<span class="ident" id="3787919">ip4</span>&nbsp;<span class="op" id="3787923">:=</span>&nbsp;<span class="ident" id="3787926">ipv4only</span><span class="op" id="3787934">(</span><span class="ident" id="3787935">ip</span><span class="op" id="3787937">)</span><span class="op" id="3787938">;</span>&nbsp;<span class="ident" id="3787940">ip4</span>&nbsp;<span class="op" id="3787944">!=</span>&nbsp;<span class="builtintype" id="3787947">nil</span>&nbsp;<span class="op" id="3787951">&amp;&amp;</span>&nbsp;<span class="op" id="3787954">!</span><span class="ident" id="3787955">ipv4</span>&nbsp;<span class="op" id="3787960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3787965">list</span>&nbsp;<span class="op" id="3787970">=</span>&nbsp;<span class="builtinfunc" id="3787972">append</span><span class="op" id="3787978">(</span><span class="ident" id="3787979">list</span><span class="op" id="3787983">,</span>&nbsp;<span class="ident" id="3787985">inetaddr</span><span class="op" id="3787993">(</span><span class="ident" id="3787994">ip4</span><span class="op" id="3787997">)</span><span class="op" id="3787998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788003">ipv4</span>&nbsp;<span class="op" id="3788008">=</span>&nbsp;<span class="builtintype" id="3788010">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788018">if</span>&nbsp;<span class="ident" id="3788021">ipv6</span>&nbsp;<span class="op" id="3788026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788032">swap</span>&nbsp;<span class="op" id="3788037">=</span>&nbsp;<span class="builtintype" id="3788039">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788051">}</span>&nbsp;<span class="keyword" id="3788053">else</span>&nbsp;<span class="keyword" id="3788058">if</span>&nbsp;<span class="ident" id="3788061">ip6</span>&nbsp;<span class="op" id="3788065">:=</span>&nbsp;<span class="ident" id="3788068">ipv6only</span><span class="op" id="3788076">(</span><span class="ident" id="3788077">ip</span><span class="op" id="3788079">)</span><span class="op" id="3788080">;</span>&nbsp;<span class="ident" id="3788082">ip6</span>&nbsp;<span class="op" id="3788086">!=</span>&nbsp;<span class="builtintype" id="3788089">nil</span>&nbsp;<span class="op" id="3788093">&amp;&amp;</span>&nbsp;<span class="op" id="3788096">!</span><span class="ident" id="3788097">ipv6</span>&nbsp;<span class="op" id="3788102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788107">list</span>&nbsp;<span class="op" id="3788112">=</span>&nbsp;<span class="builtinfunc" id="3788114">append</span><span class="op" id="3788120">(</span><span class="ident" id="3788121">list</span><span class="op" id="3788125">,</span>&nbsp;<span class="ident" id="3788127">inetaddr</span><span class="op" id="3788135">(</span><span class="ident" id="3788136">ip6</span><span class="op" id="3788139">)</span><span class="op" id="3788140">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788145">ipv6</span>&nbsp;<span class="op" id="3788150">=</span>&nbsp;<span class="builtintype" id="3788152">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788163">if</span>&nbsp;<span class="ident" id="3788166">ipv4</span>&nbsp;<span class="op" id="3788171">&amp;&amp;</span>&nbsp;<span class="ident" id="3788174">ipv6</span>&nbsp;<span class="op" id="3788179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788184">if</span>&nbsp;<span class="ident" id="3788187">swap</span>&nbsp;<span class="op" id="3788192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3788198">list</span><span class="op" id="3788202">[</span><span class="num" id="3788203">0</span><span class="op" id="3788204">]</span><span class="op" id="3788205">,</span>&nbsp;<span class="ident" id="3788207">list</span><span class="op" id="3788211">[</span><span class="num" id="3788212">1</span><span class="op" id="3788213">]</span>&nbsp;<span class="op" id="3788215">=</span>&nbsp;<span class="ident" id="3788217">list</span><span class="op" id="3788221">[</span><span class="num" id="3788222">1</span><span class="op" id="3788223">]</span><span class="op" id="3788224">,</span>&nbsp;<span class="ident" id="3788226">list</span><span class="op" id="3788230">[</span><span class="num" id="3788231">0</span><span class="op" id="3788232">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788242">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788256">switch</span>&nbsp;<span class="builtinfunc" id="3788263">len</span><span class="op" id="3788266">(</span><span class="ident" id="3788267">list</span><span class="op" id="3788271">)</span>&nbsp;<span class="op" id="3788273">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788276">case</span>&nbsp;<span class="num" id="3788281">0</span><span class="op" id="3788282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788286">return</span>&nbsp;<span class="builtintype" id="3788293">nil</span><span class="op" id="3788296">,</span>&nbsp;<span class="ident" id="3788298">errNoSuitableAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788320">case</span>&nbsp;<span class="num" id="3788325">1</span><span class="op" id="3788326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788330">return</span>&nbsp;<span class="ident" id="3788337">list</span><span class="op" id="3788341">[</span><span class="num" id="3788342">0</span><span class="op" id="3788343">]</span><span class="op" id="3788344">,</span>&nbsp;<span class="builtintype" id="3788346">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788351">default</span><span class="op" id="3788358">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788362">return</span>&nbsp;<span class="ident" id="3788369">list</span><span class="op" id="3788373">,</span>&nbsp;<span class="builtintype" id="3788375">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788380">}</span><br>
<span class="lineno"></span><span class="op" id="3788382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3788385">func</span>&nbsp;<span class="ident" id="3788390">firstSupportedAddr</span><span class="op" id="3788408">(</span><span class="ident" id="3788409">filter</span>&nbsp;<span class="keyword" id="3788416">func</span><span class="op" id="3788420">(</span><span class="ident" id="3788421">IP</span><span class="op" id="3788423">)</span>&nbsp;<span class="ident" id="3788425">IP</span><span class="op" id="3788427">,</span>&nbsp;<span class="ident" id="3788429">ips</span>&nbsp;<span class="op" id="3788433">[</span><span class="op" id="3788434">]</span><span class="ident" id="3788435">IP</span><span class="op" id="3788437">,</span>&nbsp;<span class="ident" id="3788439">inetaddr</span>&nbsp;<span class="keyword" id="3788448">func</span><span class="op" id="3788452">(</span><span class="ident" id="3788453">IP</span><span class="op" id="3788455">)</span>&nbsp;<span class="ident" id="3788457">netaddr</span><span class="op" id="3788464">)</span>&nbsp;<span class="op" id="3788466">(</span><span class="ident" id="3788467">netaddr</span><span class="op" id="3788474">,</span>&nbsp;<span class="builtintype" id="3788476">error</span><span class="op" id="3788481">)</span>&nbsp;<span class="op" id="3788483">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788486">for</span>&nbsp;<span class="ident" id="3788490">_</span><span class="op" id="3788491">,</span>&nbsp;<span class="ident" id="3788493">ip</span>&nbsp;<span class="op" id="3788496">:=</span>&nbsp;<span class="keyword" id="3788499">range</span>&nbsp;<span class="ident" id="3788505">ips</span>&nbsp;<span class="op" id="3788509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788513">if</span>&nbsp;<span class="ident" id="3788516">ip</span>&nbsp;<span class="op" id="3788519">:=</span>&nbsp;<span class="ident" id="3788522">filter</span><span class="op" id="3788528">(</span><span class="ident" id="3788529">ip</span><span class="op" id="3788531">)</span><span class="op" id="3788532">;</span>&nbsp;<span class="ident" id="3788534">ip</span>&nbsp;<span class="op" id="3788537">!=</span>&nbsp;<span class="builtintype" id="3788540">nil</span>&nbsp;<span class="op" id="3788544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788549">return</span>&nbsp;<span class="ident" id="3788556">inetaddr</span><span class="op" id="3788564">(</span><span class="ident" id="3788565">ip</span><span class="op" id="3788567">)</span><span class="op" id="3788568">,</span>&nbsp;<span class="builtintype" id="3788570">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788579">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788582">return</span>&nbsp;<span class="builtintype" id="3788589">nil</span><span class="op" id="3788592">,</span>&nbsp;<span class="ident" id="3788594">errNoSuitableAddress</span><br>
<span class="lineno"></span><span class="op" id="3788615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3788618">//&nbsp;ipv4only&nbsp;returns&nbsp;IPv4&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3788687">//&nbsp;IPv4&nbsp;addressing&nbsp;modes.&nbsp;If&nbsp;ip&nbsp;is&nbsp;an&nbsp;IPv4&nbsp;address,&nbsp;ipv4only&nbsp;returns&nbsp;ip.</span><br>
<span class="lineno">120</span><span class="comment" id="3788760">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3788789">func</span>&nbsp;<span class="ident" id="3788794">ipv4only</span><span class="op" id="3788802">(</span><span class="ident" id="3788803">ip</span>&nbsp;<span class="ident" id="3788806">IP</span><span class="op" id="3788808">)</span>&nbsp;<span class="ident" id="3788810">IP</span>&nbsp;<span class="op" id="3788813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788816">if</span>&nbsp;<span class="ident" id="3788819">supportsIPv4</span>&nbsp;<span class="op" id="3788832">&amp;&amp;</span>&nbsp;<span class="ident" id="3788835">ip</span><span class="op" id="3788837">.</span><span class="ident" id="3788838">To4</span><span class="op" id="3788841">(</span><span class="op" id="3788842">)</span>&nbsp;<span class="op" id="3788844">!=</span>&nbsp;<span class="builtintype" id="3788847">nil</span>&nbsp;<span class="op" id="3788851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788855">return</span>&nbsp;<span class="ident" id="3788862">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3788866">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3788869">return</span>&nbsp;<span class="builtintype" id="3788876">nil</span><br>
<span class="lineno"></span><span class="op" id="3788880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3788883">//&nbsp;ipv6only&nbsp;returns&nbsp;IPv6&nbsp;addresses&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;with&nbsp;the&nbsp;kernel&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3788952">//&nbsp;IPv6&nbsp;addressing&nbsp;modes.&nbsp;&nbsp;It&nbsp;returns&nbsp;IPv4-mapped&nbsp;IPv6&nbsp;addresses&nbsp;as</span><br>
<span class="lineno">130</span><span class="comment" id="3789020">//&nbsp;nils&nbsp;and&nbsp;returns&nbsp;other&nbsp;IPv6&nbsp;address&nbsp;types&nbsp;as&nbsp;IPv6&nbsp;addresses.</span><br>
<span class="lineno"></span><span class="keyword" id="3789084">func</span>&nbsp;<span class="ident" id="3789089">ipv6only</span><span class="op" id="3789097">(</span><span class="ident" id="3789098">ip</span>&nbsp;<span class="ident" id="3789101">IP</span><span class="op" id="3789103">)</span>&nbsp;<span class="ident" id="3789105">IP</span>&nbsp;<span class="op" id="3789108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789111">if</span>&nbsp;<span class="ident" id="3789114">supportsIPv6</span>&nbsp;<span class="op" id="3789127">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3789130">len</span><span class="op" id="3789133">(</span><span class="ident" id="3789134">ip</span><span class="op" id="3789136">)</span>&nbsp;<span class="op" id="3789138">==</span>&nbsp;<span class="ident" id="3789141">IPv6len</span>&nbsp;<span class="op" id="3789149">&amp;&amp;</span>&nbsp;<span class="ident" id="3789152">ip</span><span class="op" id="3789154">.</span><span class="ident" id="3789155">To4</span><span class="op" id="3789158">(</span><span class="op" id="3789159">)</span>&nbsp;<span class="op" id="3789161">==</span>&nbsp;<span class="builtintype" id="3789164">nil</span>&nbsp;<span class="op" id="3789168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789172">return</span>&nbsp;<span class="ident" id="3789179">ip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789183">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789186">return</span>&nbsp;<span class="builtintype" id="3789193">nil</span><br>
<span class="lineno"></span><span class="op" id="3789197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3789200">//&nbsp;SplitHostPort&nbsp;splits&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3789267">//&nbsp;&#34;[host]:port&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:port&#34;&nbsp;into&nbsp;host&nbsp;or</span><br>
<span class="lineno">140</span><span class="comment" id="3789324">//&nbsp;ipv6-host%zone&nbsp;and&nbsp;port.&nbsp;&nbsp;A&nbsp;literal&nbsp;address&nbsp;or&nbsp;host&nbsp;name&nbsp;for&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3789393">//&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;square&nbsp;brackets,&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3789451">//&nbsp;&#34;[ipv6-host]:http&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3789499">func</span>&nbsp;<span class="ident" id="3789504">SplitHostPort</span><span class="op" id="3789517">(</span><span class="ident" id="3789518">hostport</span>&nbsp;<span class="builtintype" id="3789527">string</span><span class="op" id="3789533">)</span>&nbsp;<span class="op" id="3789535">(</span><span class="ident" id="3789536">host</span><span class="op" id="3789540">,</span>&nbsp;<span class="ident" id="3789542">port</span>&nbsp;<span class="builtintype" id="3789547">string</span><span class="op" id="3789553">,</span>&nbsp;<span class="ident" id="3789555">err</span>&nbsp;<span class="builtintype" id="3789559">error</span><span class="op" id="3789564">)</span>&nbsp;<span class="op" id="3789566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789569">j</span><span class="op" id="3789570">,</span>&nbsp;<span class="ident" id="3789572">k</span>&nbsp;<span class="op" id="3789574">:=</span>&nbsp;<span class="num" id="3789577">0</span><span class="op" id="3789578">,</span>&nbsp;<span class="num" id="3789580">0</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789584">//&nbsp;The&nbsp;port&nbsp;starts&nbsp;after&nbsp;the&nbsp;last&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789626">i</span>&nbsp;<span class="op" id="3789628">:=</span>&nbsp;<span class="ident" id="3789631">last</span><span class="op" id="3789635">(</span><span class="ident" id="3789636">hostport</span><span class="op" id="3789644">,</span>&nbsp;<span class="string" id="3789646">&#39;:&#39;</span><span class="op" id="3789649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789652">if</span>&nbsp;<span class="ident" id="3789655">i</span>&nbsp;<span class="op" id="3789657">&lt;</span>&nbsp;<span class="num" id="3789659">0</span>&nbsp;<span class="op" id="3789661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789665">goto</span>&nbsp;<span class="ident" id="3789670">missingPort</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789687">if</span>&nbsp;<span class="ident" id="3789690">hostport</span><span class="op" id="3789698">[</span><span class="num" id="3789699">0</span><span class="op" id="3789700">]</span>&nbsp;<span class="op" id="3789702">==</span>&nbsp;<span class="string" id="3789705">&#39;[&#39;</span>&nbsp;<span class="op" id="3789709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789713">//&nbsp;Expect&nbsp;the&nbsp;first&nbsp;&#39;]&#39;&nbsp;just&nbsp;before&nbsp;the&nbsp;last&nbsp;&#39;:&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789765">end</span>&nbsp;<span class="op" id="3789769">:=</span>&nbsp;<span class="ident" id="3789772">byteIndex</span><span class="op" id="3789781">(</span><span class="ident" id="3789782">hostport</span><span class="op" id="3789790">,</span>&nbsp;<span class="string" id="3789792">&#39;]&#39;</span><span class="op" id="3789795">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789799">if</span>&nbsp;<span class="ident" id="3789802">end</span>&nbsp;<span class="op" id="3789806">&lt;</span>&nbsp;<span class="num" id="3789808">0</span>&nbsp;<span class="op" id="3789810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3789815">err</span>&nbsp;<span class="op" id="3789819">=</span>&nbsp;<span class="op" id="3789821">&amp;</span><span class="ident" id="3789822">AddrError</span><span class="op" id="3789831">{</span><span class="string" id="3789832">&#34;missing&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3789856">,</span>&nbsp;<span class="ident" id="3789858">hostport</span><span class="op" id="3789866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789871">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3789880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789884">switch</span>&nbsp;<span class="ident" id="3789891">end</span>&nbsp;<span class="op" id="3789895">+</span>&nbsp;<span class="num" id="3789897">1</span>&nbsp;<span class="op" id="3789899">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789903">case</span>&nbsp;<span class="builtinfunc" id="3789908">len</span><span class="op" id="3789911">(</span><span class="ident" id="3789912">hostport</span><span class="op" id="3789920">)</span><span class="op" id="3789921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3789926">//&nbsp;There&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;:&#39;&nbsp;behind&nbsp;the&nbsp;&#39;]&#39;&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789973">goto</span>&nbsp;<span class="ident" id="3789978">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3789992">case</span>&nbsp;<span class="ident" id="3789997">i</span><span class="op" id="3789998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790003">//&nbsp;The&nbsp;expected&nbsp;result.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790029">default</span><span class="op" id="3790036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790041">//&nbsp;Either&nbsp;&#39;]&#39;&nbsp;isn&#39;t&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;or&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3790094">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon&nbsp;that&nbsp;is&nbsp;not&nbsp;the&nbsp;last&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790146">if</span>&nbsp;<span class="ident" id="3790149">hostport</span><span class="op" id="3790157">[</span><span class="ident" id="3790158">end</span><span class="op" id="3790161">+</span><span class="num" id="3790162">1</span><span class="op" id="3790163">]</span>&nbsp;<span class="op" id="3790165">==</span>&nbsp;<span class="string" id="3790168">&#39;:&#39;</span>&nbsp;<span class="op" id="3790172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790178">goto</span>&nbsp;<span class="ident" id="3790183">tooManyColons</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790205">goto</span>&nbsp;<span class="ident" id="3790210">missingPort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790228">host</span>&nbsp;<span class="op" id="3790233">=</span>&nbsp;<span class="ident" id="3790235">hostport</span><span class="op" id="3790243">[</span><span class="num" id="3790244">1</span><span class="op" id="3790245">:</span><span class="ident" id="3790246">end</span><span class="op" id="3790249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790253">j</span><span class="op" id="3790254">,</span>&nbsp;<span class="ident" id="3790256">k</span>&nbsp;<span class="op" id="3790258">=</span>&nbsp;<span class="num" id="3790260">1</span><span class="op" id="3790261">,</span>&nbsp;<span class="ident" id="3790263">end</span><span class="op" id="3790266">+</span><span class="num" id="3790267">1</span>&nbsp;<span class="comment" id="3790269">//&nbsp;there&nbsp;can&#39;t&nbsp;be&nbsp;a&nbsp;&#39;[&#39;&nbsp;resp.&nbsp;&#39;]&#39;&nbsp;before&nbsp;these&nbsp;positions</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790327">}</span>&nbsp;<span class="keyword" id="3790329">else</span>&nbsp;<span class="op" id="3790334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790338">host</span>&nbsp;<span class="op" id="3790343">=</span>&nbsp;<span class="ident" id="3790345">hostport</span><span class="op" id="3790353">[</span><span class="op" id="3790354">:</span><span class="ident" id="3790355">i</span><span class="op" id="3790356">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790360">if</span>&nbsp;<span class="ident" id="3790363">byteIndex</span><span class="op" id="3790372">(</span><span class="ident" id="3790373">host</span><span class="op" id="3790377">,</span>&nbsp;<span class="string" id="3790379">&#39;:&#39;</span><span class="op" id="3790382">)</span>&nbsp;<span class="op" id="3790384">&gt;=</span>&nbsp;<span class="num" id="3790387">0</span>&nbsp;<span class="op" id="3790389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790394">goto</span>&nbsp;<span class="ident" id="3790399">tooManyColons</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790415">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790419">if</span>&nbsp;<span class="ident" id="3790422">byteIndex</span><span class="op" id="3790431">(</span><span class="ident" id="3790432">host</span><span class="op" id="3790436">,</span>&nbsp;<span class="string" id="3790438">&#39;%&#39;</span><span class="op" id="3790441">)</span>&nbsp;<span class="op" id="3790443">&gt;=</span>&nbsp;<span class="num" id="3790446">0</span>&nbsp;<span class="op" id="3790448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790453">goto</span>&nbsp;<span class="ident" id="3790458">missingBrackets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790482">if</span>&nbsp;<span class="ident" id="3790485">byteIndex</span><span class="op" id="3790494">(</span><span class="ident" id="3790495">hostport</span><span class="op" id="3790503">[</span><span class="ident" id="3790504">j</span><span class="op" id="3790505">:</span><span class="op" id="3790506">]</span><span class="op" id="3790507">,</span>&nbsp;<span class="string" id="3790509">&#39;[&#39;</span><span class="op" id="3790512">)</span>&nbsp;<span class="op" id="3790514">&gt;=</span>&nbsp;<span class="num" id="3790517">0</span>&nbsp;<span class="op" id="3790519">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790523">err</span>&nbsp;<span class="op" id="3790527">=</span>&nbsp;<span class="op" id="3790529">&amp;</span><span class="ident" id="3790530">AddrError</span><span class="op" id="3790539">{</span><span class="string" id="3790540">&#34;unexpected&nbsp;&#39;[&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3790567">,</span>&nbsp;<span class="ident" id="3790569">hostport</span><span class="op" id="3790577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790581">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790592">if</span>&nbsp;<span class="ident" id="3790595">byteIndex</span><span class="op" id="3790604">(</span><span class="ident" id="3790605">hostport</span><span class="op" id="3790613">[</span><span class="ident" id="3790614">k</span><span class="op" id="3790615">:</span><span class="op" id="3790616">]</span><span class="op" id="3790617">,</span>&nbsp;<span class="string" id="3790619">&#39;]&#39;</span><span class="op" id="3790622">)</span>&nbsp;<span class="op" id="3790624">&gt;=</span>&nbsp;<span class="num" id="3790627">0</span>&nbsp;<span class="op" id="3790629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790633">err</span>&nbsp;<span class="op" id="3790637">=</span>&nbsp;<span class="op" id="3790639">&amp;</span><span class="ident" id="3790640">AddrError</span><span class="op" id="3790649">{</span><span class="string" id="3790650">&#34;unexpected&nbsp;&#39;]&#39;&nbsp;in&nbsp;address&#34;</span><span class="op" id="3790677">,</span>&nbsp;<span class="ident" id="3790679">hostport</span><span class="op" id="3790687">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790691">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3790699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790703">port</span>&nbsp;<span class="op" id="3790708">=</span>&nbsp;<span class="ident" id="3790710">hostport</span><span class="op" id="3790718">[</span><span class="ident" id="3790719">i</span><span class="op" id="3790720">+</span><span class="num" id="3790721">1</span><span class="op" id="3790722">:</span><span class="op" id="3790723">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790726">return</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="3790734">missingPort</span><span class="op" id="3790745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790748">err</span>&nbsp;<span class="op" id="3790752">=</span>&nbsp;<span class="op" id="3790754">&amp;</span><span class="ident" id="3790755">AddrError</span><span class="op" id="3790764">{</span><span class="string" id="3790765">&#34;missing&nbsp;port&nbsp;in&nbsp;address&#34;</span><span class="op" id="3790790">,</span>&nbsp;<span class="ident" id="3790792">hostport</span><span class="op" id="3790800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790803">return</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="3790811">tooManyColons</span><span class="op" id="3790824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790827">err</span>&nbsp;<span class="op" id="3790831">=</span>&nbsp;<span class="op" id="3790833">&amp;</span><span class="ident" id="3790834">AddrError</span><span class="op" id="3790843">{</span><span class="string" id="3790844">&#34;too&nbsp;many&nbsp;colons&nbsp;in&nbsp;address&#34;</span><span class="op" id="3790872">,</span>&nbsp;<span class="ident" id="3790874">hostport</span><span class="op" id="3790882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790885">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="3790893">missingBrackets</span><span class="op" id="3790908">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3790911">err</span>&nbsp;<span class="op" id="3790915">=</span>&nbsp;<span class="op" id="3790917">&amp;</span><span class="ident" id="3790918">AddrError</span><span class="op" id="3790927">{</span><span class="string" id="3790928">&#34;missing&nbsp;brackets&nbsp;in&nbsp;address&#34;</span><span class="op" id="3790957">,</span>&nbsp;<span class="ident" id="3790959">hostport</span><span class="op" id="3790967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3790970">return</span><br>
<span class="lineno"></span><span class="op" id="3790977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3790980">func</span>&nbsp;<span class="ident" id="3790985">splitHostZone</span><span class="op" id="3790998">(</span><span class="ident" id="3790999">s</span>&nbsp;<span class="builtintype" id="3791001">string</span><span class="op" id="3791007">)</span>&nbsp;<span class="op" id="3791009">(</span><span class="ident" id="3791010">host</span><span class="op" id="3791014">,</span>&nbsp;<span class="ident" id="3791016">zone</span>&nbsp;<span class="builtintype" id="3791021">string</span><span class="op" id="3791027">)</span>&nbsp;<span class="op" id="3791029">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3791032">//&nbsp;The&nbsp;IPv6&nbsp;scoped&nbsp;addressing&nbsp;zone&nbsp;identifier&nbsp;starts&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3791096">//&nbsp;last&nbsp;percent&nbsp;sign.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791119">if</span>&nbsp;<span class="ident" id="3791122">i</span>&nbsp;<span class="op" id="3791124">:=</span>&nbsp;<span class="ident" id="3791127">last</span><span class="op" id="3791131">(</span><span class="ident" id="3791132">s</span><span class="op" id="3791133">,</span>&nbsp;<span class="string" id="3791135">&#39;%&#39;</span><span class="op" id="3791138">)</span><span class="op" id="3791139">;</span>&nbsp;<span class="ident" id="3791141">i</span>&nbsp;<span class="op" id="3791143">&gt;</span>&nbsp;<span class="num" id="3791145">0</span>&nbsp;<span class="op" id="3791147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3791151">host</span><span class="op" id="3791155">,</span>&nbsp;<span class="ident" id="3791157">zone</span>&nbsp;<span class="op" id="3791162">=</span>&nbsp;<span class="ident" id="3791164">s</span><span class="op" id="3791165">[</span><span class="op" id="3791166">:</span><span class="ident" id="3791167">i</span><span class="op" id="3791168">]</span><span class="op" id="3791169">,</span>&nbsp;<span class="ident" id="3791171">s</span><span class="op" id="3791172">[</span><span class="ident" id="3791173">i</span><span class="op" id="3791174">+</span><span class="num" id="3791175">1</span><span class="op" id="3791176">:</span><span class="op" id="3791177">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3791180">}</span>&nbsp;<span class="keyword" id="3791182">else</span>&nbsp;<span class="op" id="3791187">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3791191">host</span>&nbsp;<span class="op" id="3791196">=</span>&nbsp;<span class="ident" id="3791198">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3791201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791204">return</span><br>
<span class="lineno"></span><span class="op" id="3791211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="3791214">//&nbsp;JoinHostPort&nbsp;combines&nbsp;host&nbsp;and&nbsp;port&nbsp;into&nbsp;a&nbsp;network&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3791283">//&nbsp;form&nbsp;&#34;host:port&#34;&nbsp;or,&nbsp;if&nbsp;host&nbsp;contains&nbsp;a&nbsp;colon&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,</span><br>
<span class="lineno"></span><span class="comment" id="3791351">//&nbsp;&#34;[host]:port&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3791369">func</span>&nbsp;<span class="ident" id="3791374">JoinHostPort</span><span class="op" id="3791386">(</span><span class="ident" id="3791387">host</span><span class="op" id="3791391">,</span>&nbsp;<span class="ident" id="3791393">port</span>&nbsp;<span class="builtintype" id="3791398">string</span><span class="op" id="3791404">)</span>&nbsp;<span class="builtintype" id="3791406">string</span>&nbsp;<span class="op" id="3791413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3791416">//&nbsp;If&nbsp;host&nbsp;has&nbsp;colons&nbsp;or&nbsp;a&nbsp;percent&nbsp;sign,&nbsp;have&nbsp;to&nbsp;bracket&nbsp;it.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791478">if</span>&nbsp;<span class="ident" id="3791481">byteIndex</span><span class="op" id="3791490">(</span><span class="ident" id="3791491">host</span><span class="op" id="3791495">,</span>&nbsp;<span class="string" id="3791497">&#39;:&#39;</span><span class="op" id="3791500">)</span>&nbsp;<span class="op" id="3791502">&gt;=</span>&nbsp;<span class="num" id="3791505">0</span>&nbsp;<span class="op" id="3791507">||</span>&nbsp;<span class="ident" id="3791510">byteIndex</span><span class="op" id="3791519">(</span><span class="ident" id="3791520">host</span><span class="op" id="3791524">,</span>&nbsp;<span class="string" id="3791526">&#39;%&#39;</span><span class="op" id="3791529">)</span>&nbsp;<span class="op" id="3791531">&gt;=</span>&nbsp;<span class="num" id="3791534">0</span>&nbsp;<span class="op" id="3791536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791540">return</span>&nbsp;<span class="string" id="3791547">&#34;[&#34;</span>&nbsp;<span class="op" id="3791551">+</span>&nbsp;<span class="ident" id="3791553">host</span>&nbsp;<span class="op" id="3791558">+</span>&nbsp;<span class="string" id="3791560">&#34;]:&#34;</span>&nbsp;<span class="op" id="3791565">+</span>&nbsp;<span class="ident" id="3791567">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3791573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3791576">return</span>&nbsp;<span class="ident" id="3791583">host</span>&nbsp;<span class="op" id="3791588">+</span>&nbsp;<span class="string" id="3791590">&#34;:&#34;</span>&nbsp;<span class="op" id="3791594">+</span>&nbsp;<span class="ident" id="3791596">port</span><br>
<span class="lineno"></span><span class="op" id="3791601">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3791604">//&nbsp;resolveInternetAddr&nbsp;resolves&nbsp;addr&nbsp;that&nbsp;is&nbsp;either&nbsp;a&nbsp;literal&nbsp;IP</span><br>
<span class="lineno"></span><span class="comment" id="3791669">//&nbsp;address&nbsp;or&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;returns&nbsp;an&nbsp;internet&nbsp;protocol&nbsp;family</span><br>
<span class="lineno"></span><span class="comment" id="3791734">//&nbsp;address.&nbsp;It&nbsp;returns&nbsp;a&nbsp;list&nbsp;that&nbsp;contains&nbsp;a&nbsp;pair&nbsp;of&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3791798">//&nbsp;address&nbsp;family&nbsp;addresses&nbsp;when&nbsp;addr&nbsp;is&nbsp;a&nbsp;DNS&nbsp;name&nbsp;and&nbsp;the&nbsp;name&nbsp;has</span><br>
<span class="lineno">235</span><span class="comment" id="3791867">//&nbsp;multiple&nbsp;address&nbsp;family&nbsp;records.&nbsp;The&nbsp;result&nbsp;contains&nbsp;at&nbsp;least&nbsp;one</span><br>
<span class="lineno"></span><span class="comment" id="3791936">//&nbsp;address&nbsp;when&nbsp;error&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3791966">func</span>&nbsp;<span class="ident" id="3791971">resolveInternetAddr</span><span class="op" id="3791990">(</span><span class="ident" id="3791991">net</span><span class="op" id="3791994">,</span>&nbsp;<span class="ident" id="3791996">addr</span>&nbsp;<span class="builtintype" id="3792001">string</span><span class="op" id="3792007">,</span>&nbsp;<span class="ident" id="3792009">deadline</span>&nbsp;<span class="ident" id="3792018">time</span><span class="op" id="3792022">.</span><span class="ident" id="3792023">Time</span><span class="op" id="3792027">)</span>&nbsp;<span class="op" id="3792029">(</span><span class="ident" id="3792030">netaddr</span><span class="op" id="3792037">,</span>&nbsp;<span class="builtintype" id="3792039">error</span><span class="op" id="3792044">)</span>&nbsp;<span class="op" id="3792046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792049">var</span>&nbsp;<span class="op" id="3792053">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792057">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3792074">error</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792082">host</span><span class="op" id="3792086">,</span>&nbsp;<span class="ident" id="3792088">port</span><span class="op" id="3792092">,</span>&nbsp;<span class="ident" id="3792094">zone</span>&nbsp;<span class="builtintype" id="3792099">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792108">portnum</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3792125">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792133">switch</span>&nbsp;<span class="ident" id="3792140">net</span>&nbsp;<span class="op" id="3792144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792147">case</span>&nbsp;<span class="string" id="3792152">&#34;tcp&#34;</span><span class="op" id="3792157">,</span>&nbsp;<span class="string" id="3792159">&#34;tcp4&#34;</span><span class="op" id="3792165">,</span>&nbsp;<span class="string" id="3792167">&#34;tcp6&#34;</span><span class="op" id="3792173">,</span>&nbsp;<span class="string" id="3792175">&#34;udp&#34;</span><span class="op" id="3792180">,</span>&nbsp;<span class="string" id="3792182">&#34;udp4&#34;</span><span class="op" id="3792188">,</span>&nbsp;<span class="string" id="3792190">&#34;udp6&#34;</span><span class="op" id="3792196">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792200">if</span>&nbsp;<span class="ident" id="3792203">addr</span>&nbsp;<span class="op" id="3792208">!=</span>&nbsp;<span class="string" id="3792211">&#34;&#34;</span>&nbsp;<span class="op" id="3792214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792219">if</span>&nbsp;<span class="ident" id="3792222">host</span><span class="op" id="3792226">,</span>&nbsp;<span class="ident" id="3792228">port</span><span class="op" id="3792232">,</span>&nbsp;<span class="ident" id="3792234">err</span>&nbsp;<span class="op" id="3792238">=</span>&nbsp;<span class="ident" id="3792240">SplitHostPort</span><span class="op" id="3792253">(</span><span class="ident" id="3792254">addr</span><span class="op" id="3792258">)</span><span class="op" id="3792259">;</span>&nbsp;<span class="ident" id="3792261">err</span>&nbsp;<span class="op" id="3792265">!=</span>&nbsp;<span class="builtintype" id="3792268">nil</span>&nbsp;<span class="op" id="3792272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792278">return</span>&nbsp;<span class="builtintype" id="3792285">nil</span><span class="op" id="3792288">,</span>&nbsp;<span class="ident" id="3792290">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792302">if</span>&nbsp;<span class="ident" id="3792305">portnum</span><span class="op" id="3792312">,</span>&nbsp;<span class="ident" id="3792314">err</span>&nbsp;<span class="op" id="3792318">=</span>&nbsp;<span class="ident" id="3792320">parsePort</span><span class="op" id="3792329">(</span><span class="ident" id="3792330">net</span><span class="op" id="3792333">,</span>&nbsp;<span class="ident" id="3792335">port</span><span class="op" id="3792339">)</span><span class="op" id="3792340">;</span>&nbsp;<span class="ident" id="3792342">err</span>&nbsp;<span class="op" id="3792346">!=</span>&nbsp;<span class="builtintype" id="3792349">nil</span>&nbsp;<span class="op" id="3792353">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792359">return</span>&nbsp;<span class="builtintype" id="3792366">nil</span><span class="op" id="3792369">,</span>&nbsp;<span class="ident" id="3792371">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792385">case</span>&nbsp;<span class="string" id="3792390">&#34;ip&#34;</span><span class="op" id="3792394">,</span>&nbsp;<span class="string" id="3792396">&#34;ip4&#34;</span><span class="op" id="3792401">,</span>&nbsp;<span class="string" id="3792403">&#34;ip6&#34;</span><span class="op" id="3792408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792412">if</span>&nbsp;<span class="ident" id="3792415">addr</span>&nbsp;<span class="op" id="3792420">!=</span>&nbsp;<span class="string" id="3792423">&#34;&#34;</span>&nbsp;<span class="op" id="3792426">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792431">host</span>&nbsp;<span class="op" id="3792436">=</span>&nbsp;<span class="ident" id="3792438">addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792448">default</span><span class="op" id="3792455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792459">return</span>&nbsp;<span class="builtintype" id="3792466">nil</span><span class="op" id="3792469">,</span>&nbsp;<span class="ident" id="3792471">UnknownNetworkError</span><span class="op" id="3792490">(</span><span class="ident" id="3792491">net</span><span class="op" id="3792494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792497">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3792500">inetaddr</span>&nbsp;<span class="op" id="3792509">:=</span>&nbsp;<span class="keyword" id="3792512">func</span><span class="op" id="3792516">(</span><span class="ident" id="3792517">ip</span>&nbsp;<span class="ident" id="3792520">IP</span><span class="op" id="3792522">)</span>&nbsp;<span class="ident" id="3792524">netaddr</span>&nbsp;<span class="op" id="3792532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792536">switch</span>&nbsp;<span class="ident" id="3792543">net</span>&nbsp;<span class="op" id="3792547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792551">case</span>&nbsp;<span class="string" id="3792556">&#34;tcp&#34;</span><span class="op" id="3792561">,</span>&nbsp;<span class="string" id="3792563">&#34;tcp4&#34;</span><span class="op" id="3792569">,</span>&nbsp;<span class="string" id="3792571">&#34;tcp6&#34;</span><span class="op" id="3792577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792582">return</span>&nbsp;<span class="op" id="3792589">&amp;</span><span class="ident" id="3792590">TCPAddr</span><span class="op" id="3792597">{</span><span class="ident" id="3792598">IP</span><span class="op" id="3792600">:</span>&nbsp;<span class="ident" id="3792602">ip</span><span class="op" id="3792604">,</span>&nbsp;<span class="ident" id="3792606">Port</span><span class="op" id="3792610">:</span>&nbsp;<span class="ident" id="3792612">portnum</span><span class="op" id="3792619">,</span>&nbsp;<span class="ident" id="3792621">Zone</span><span class="op" id="3792625">:</span>&nbsp;<span class="ident" id="3792627">zone</span><span class="op" id="3792631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792635">case</span>&nbsp;<span class="string" id="3792640">&#34;udp&#34;</span><span class="op" id="3792645">,</span>&nbsp;<span class="string" id="3792647">&#34;udp4&#34;</span><span class="op" id="3792653">,</span>&nbsp;<span class="string" id="3792655">&#34;udp6&#34;</span><span class="op" id="3792661">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792666">return</span>&nbsp;<span class="op" id="3792673">&amp;</span><span class="ident" id="3792674">UDPAddr</span><span class="op" id="3792681">{</span><span class="ident" id="3792682">IP</span><span class="op" id="3792684">:</span>&nbsp;<span class="ident" id="3792686">ip</span><span class="op" id="3792688">,</span>&nbsp;<span class="ident" id="3792690">Port</span><span class="op" id="3792694">:</span>&nbsp;<span class="ident" id="3792696">portnum</span><span class="op" id="3792703">,</span>&nbsp;<span class="ident" id="3792705">Zone</span><span class="op" id="3792709">:</span>&nbsp;<span class="ident" id="3792711">zone</span><span class="op" id="3792715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792719">case</span>&nbsp;<span class="string" id="3792724">&#34;ip&#34;</span><span class="op" id="3792728">,</span>&nbsp;<span class="string" id="3792730">&#34;ip4&#34;</span><span class="op" id="3792735">,</span>&nbsp;<span class="string" id="3792737">&#34;ip6&#34;</span><span class="op" id="3792742">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792747">return</span>&nbsp;<span class="op" id="3792754">&amp;</span><span class="ident" id="3792755">IPAddr</span><span class="op" id="3792761">{</span><span class="ident" id="3792762">IP</span><span class="op" id="3792764">:</span>&nbsp;<span class="ident" id="3792766">ip</span><span class="op" id="3792768">,</span>&nbsp;<span class="ident" id="3792770">Zone</span><span class="op" id="3792774">:</span>&nbsp;<span class="ident" id="3792776">zone</span><span class="op" id="3792780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792784">default</span><span class="op" id="3792791">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3792796">panic</span><span class="op" id="3792801">(</span><span class="string" id="3792802">&#34;unexpected&nbsp;network:&nbsp;&#34;</span>&nbsp;<span class="op" id="3792825">+</span>&nbsp;<span class="ident" id="3792827">net</span><span class="op" id="3792830">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792840">if</span>&nbsp;<span class="ident" id="3792843">host</span>&nbsp;<span class="op" id="3792848">==</span>&nbsp;<span class="string" id="3792851">&#34;&#34;</span>&nbsp;<span class="op" id="3792854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792858">return</span>&nbsp;<span class="ident" id="3792865">inetaddr</span><span class="op" id="3792873">(</span><span class="builtintype" id="3792874">nil</span><span class="op" id="3792877">)</span><span class="op" id="3792878">,</span>&nbsp;<span class="builtintype" id="3792880">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792885">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3792888">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792921">var</span>&nbsp;<span class="ident" id="3792925">ip</span>&nbsp;<span class="ident" id="3792928">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792932">if</span>&nbsp;<span class="ident" id="3792935">ip</span>&nbsp;<span class="op" id="3792938">=</span>&nbsp;<span class="ident" id="3792940">parseIPv4</span><span class="op" id="3792949">(</span><span class="ident" id="3792950">host</span><span class="op" id="3792954">)</span><span class="op" id="3792955">;</span>&nbsp;<span class="ident" id="3792957">ip</span>&nbsp;<span class="op" id="3792960">!=</span>&nbsp;<span class="builtintype" id="3792963">nil</span>&nbsp;<span class="op" id="3792967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3792971">return</span>&nbsp;<span class="ident" id="3792978">inetaddr</span><span class="op" id="3792986">(</span><span class="ident" id="3792987">ip</span><span class="op" id="3792989">)</span><span class="op" id="3792990">,</span>&nbsp;<span class="builtintype" id="3792992">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3792997">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793000">if</span>&nbsp;<span class="ident" id="3793003">ip</span><span class="op" id="3793005">,</span>&nbsp;<span class="ident" id="3793007">zone</span>&nbsp;<span class="op" id="3793012">=</span>&nbsp;<span class="ident" id="3793014">parseIPv6</span><span class="op" id="3793023">(</span><span class="ident" id="3793024">host</span><span class="op" id="3793028">,</span>&nbsp;<span class="builtintype" id="3793030">true</span><span class="op" id="3793034">)</span><span class="op" id="3793035">;</span>&nbsp;<span class="ident" id="3793037">ip</span>&nbsp;<span class="op" id="3793040">!=</span>&nbsp;<span class="builtintype" id="3793043">nil</span>&nbsp;<span class="op" id="3793047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793051">return</span>&nbsp;<span class="ident" id="3793058">inetaddr</span><span class="op" id="3793066">(</span><span class="ident" id="3793067">ip</span><span class="op" id="3793069">)</span><span class="op" id="3793070">,</span>&nbsp;<span class="builtintype" id="3793072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3793080">//&nbsp;Try&nbsp;as&nbsp;a&nbsp;DNS&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793103">host</span><span class="op" id="3793107">,</span>&nbsp;<span class="ident" id="3793109">zone</span>&nbsp;<span class="op" id="3793114">=</span>&nbsp;<span class="ident" id="3793116">splitHostZone</span><span class="op" id="3793129">(</span><span class="ident" id="3793130">host</span><span class="op" id="3793134">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793137">ips</span><span class="op" id="3793140">,</span>&nbsp;<span class="ident" id="3793142">err</span>&nbsp;<span class="op" id="3793146">:=</span>&nbsp;<span class="ident" id="3793149">lookupIPDeadline</span><span class="op" id="3793165">(</span><span class="ident" id="3793166">host</span><span class="op" id="3793170">,</span>&nbsp;<span class="ident" id="3793172">deadline</span><span class="op" id="3793180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793183">if</span>&nbsp;<span class="ident" id="3793186">err</span>&nbsp;<span class="op" id="3793190">!=</span>&nbsp;<span class="builtintype" id="3793193">nil</span>&nbsp;<span class="op" id="3793197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793201">return</span>&nbsp;<span class="builtintype" id="3793208">nil</span><span class="op" id="3793211">,</span>&nbsp;<span class="ident" id="3793213">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793221">var</span>&nbsp;<span class="ident" id="3793225">filter</span>&nbsp;<span class="keyword" id="3793232">func</span><span class="op" id="3793236">(</span><span class="ident" id="3793237">IP</span><span class="op" id="3793239">)</span>&nbsp;<span class="ident" id="3793241">IP</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793245">if</span>&nbsp;<span class="ident" id="3793248">net</span>&nbsp;<span class="op" id="3793252">!=</span>&nbsp;<span class="string" id="3793255">&#34;&#34;</span>&nbsp;<span class="op" id="3793258">&amp;&amp;</span>&nbsp;<span class="ident" id="3793261">net</span><span class="op" id="3793264">[</span><span class="builtinfunc" id="3793265">len</span><span class="op" id="3793268">(</span><span class="ident" id="3793269">net</span><span class="op" id="3793272">)</span><span class="op" id="3793273">-</span><span class="num" id="3793274">1</span><span class="op" id="3793275">]</span>&nbsp;<span class="op" id="3793277">==</span>&nbsp;<span class="string" id="3793280">&#39;4&#39;</span>&nbsp;<span class="op" id="3793284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793288">filter</span>&nbsp;<span class="op" id="3793295">=</span>&nbsp;<span class="ident" id="3793297">ipv4only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793310">if</span>&nbsp;<span class="ident" id="3793313">net</span>&nbsp;<span class="op" id="3793317">!=</span>&nbsp;<span class="string" id="3793320">&#34;&#34;</span>&nbsp;<span class="op" id="3793323">&amp;&amp;</span>&nbsp;<span class="ident" id="3793326">net</span><span class="op" id="3793329">[</span><span class="builtinfunc" id="3793330">len</span><span class="op" id="3793333">(</span><span class="ident" id="3793334">net</span><span class="op" id="3793337">)</span><span class="op" id="3793338">-</span><span class="num" id="3793339">1</span><span class="op" id="3793340">]</span>&nbsp;<span class="op" id="3793342">==</span>&nbsp;<span class="string" id="3793345">&#39;6&#39;</span>&nbsp;<span class="op" id="3793349">||</span>&nbsp;<span class="ident" id="3793352">zone</span>&nbsp;<span class="op" id="3793357">!=</span>&nbsp;<span class="string" id="3793360">&#34;&#34;</span>&nbsp;<span class="op" id="3793363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793367">filter</span>&nbsp;<span class="op" id="3793374">=</span>&nbsp;<span class="ident" id="3793376">ipv6only</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793389">return</span>&nbsp;<span class="ident" id="3793396">firstFavoriteAddr</span><span class="op" id="3793413">(</span><span class="ident" id="3793414">filter</span><span class="op" id="3793420">,</span>&nbsp;<span class="ident" id="3793422">ips</span><span class="op" id="3793425">,</span>&nbsp;<span class="ident" id="3793427">inetaddr</span><span class="op" id="3793435">)</span><br>
<span class="lineno"></span><span class="op" id="3793437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3793440">func</span>&nbsp;<span class="ident" id="3793445">zoneToString</span><span class="op" id="3793457">(</span><span class="ident" id="3793458">zone</span>&nbsp;<span class="builtintype" id="3793463">int</span><span class="op" id="3793466">)</span>&nbsp;<span class="builtintype" id="3793468">string</span>&nbsp;<span class="op" id="3793475">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793478">if</span>&nbsp;<span class="ident" id="3793481">zone</span>&nbsp;<span class="op" id="3793486">==</span>&nbsp;<span class="num" id="3793489">0</span>&nbsp;<span class="op" id="3793491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793495">return</span>&nbsp;<span class="string" id="3793502">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793509">if</span>&nbsp;<span class="ident" id="3793512">ifi</span><span class="op" id="3793515">,</span>&nbsp;<span class="ident" id="3793517">err</span>&nbsp;<span class="op" id="3793521">:=</span>&nbsp;<span class="ident" id="3793524">InterfaceByIndex</span><span class="op" id="3793540">(</span><span class="ident" id="3793541">zone</span><span class="op" id="3793545">)</span><span class="op" id="3793546">;</span>&nbsp;<span class="ident" id="3793548">err</span>&nbsp;<span class="op" id="3793552">==</span>&nbsp;<span class="builtintype" id="3793555">nil</span>&nbsp;<span class="op" id="3793559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793563">return</span>&nbsp;<span class="ident" id="3793570">ifi</span><span class="op" id="3793573">.</span><span class="ident" id="3793574">Name</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793583">return</span>&nbsp;<span class="ident" id="3793590">itod</span><span class="op" id="3793594">(</span><span class="builtintype" id="3793595">uint</span><span class="op" id="3793599">(</span><span class="ident" id="3793600">zone</span><span class="op" id="3793604">)</span><span class="op" id="3793605">)</span><br>
<span class="lineno"></span><span class="op" id="3793607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3793610">func</span>&nbsp;<span class="ident" id="3793615">zoneToInt</span><span class="op" id="3793624">(</span><span class="ident" id="3793625">zone</span>&nbsp;<span class="builtintype" id="3793630">string</span><span class="op" id="3793636">)</span>&nbsp;<span class="builtintype" id="3793638">int</span>&nbsp;<span class="op" id="3793642">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793645">if</span>&nbsp;<span class="ident" id="3793648">zone</span>&nbsp;<span class="op" id="3793653">==</span>&nbsp;<span class="string" id="3793656">&#34;&#34;</span>&nbsp;<span class="op" id="3793659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793663">return</span>&nbsp;<span class="num" id="3793670">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793676">if</span>&nbsp;<span class="ident" id="3793679">ifi</span><span class="op" id="3793682">,</span>&nbsp;<span class="ident" id="3793684">err</span>&nbsp;<span class="op" id="3793688">:=</span>&nbsp;<span class="ident" id="3793691">InterfaceByName</span><span class="op" id="3793706">(</span><span class="ident" id="3793707">zone</span><span class="op" id="3793711">)</span><span class="op" id="3793712">;</span>&nbsp;<span class="ident" id="3793714">err</span>&nbsp;<span class="op" id="3793718">==</span>&nbsp;<span class="builtintype" id="3793721">nil</span>&nbsp;<span class="op" id="3793725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793729">return</span>&nbsp;<span class="ident" id="3793736">ifi</span><span class="op" id="3793739">.</span><span class="ident" id="3793740">Index</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3793747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3793750">n</span><span class="op" id="3793751">,</span>&nbsp;<span class="ident" id="3793753">_</span><span class="op" id="3793754">,</span>&nbsp;<span class="ident" id="3793756">_</span>&nbsp;<span class="op" id="3793758">:=</span>&nbsp;<span class="ident" id="3793761">dtoi</span><span class="op" id="3793765">(</span><span class="ident" id="3793766">zone</span><span class="op" id="3793770">,</span>&nbsp;<span class="num" id="3793772">0</span><span class="op" id="3793773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3793776">return</span>&nbsp;<span class="ident" id="3793783">n</span><br>
<span class="lineno"></span><span class="op" id="3793785">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
