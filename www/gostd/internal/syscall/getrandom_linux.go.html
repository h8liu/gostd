<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>internal/syscall</h2>
<ul>
<li><a href="/gostd/internal/syscall/getrandom_linux.go.html">getrandom_linux.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3879041">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3879097">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3879151">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3879202">package</span>&nbsp;<span class="ident" id="3879210">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3879219">import</span>&nbsp;<span class="op" id="3879226">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3879229">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3879240">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879255">stdsyscall</span>&nbsp;<span class="string" id="3879266">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3879277">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3879286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3879289">var</span>&nbsp;<span class="ident" id="3879293">randomTrap</span>&nbsp;<span class="op" id="3879304">=</span>&nbsp;<span class="keyword" id="3879306">map</span><span class="op" id="3879309">[</span><span class="builtintype" id="3879310">string</span><span class="op" id="3879316">]</span><span class="builtintype" id="3879317">uintptr</span><span class="op" id="3879324">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3879327">&#34;386&#34;</span><span class="op" id="3879332">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3879336">355</span><span class="op" id="3879339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3879342">&#34;amd64&#34;</span><span class="op" id="3879349">:</span>&nbsp;<span class="num" id="3879351">318</span><span class="op" id="3879354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3879357">&#34;arm&#34;</span><span class="op" id="3879362">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3879366">384</span><span class="op" id="3879369">,</span><br>
<span class="lineno"></span><span class="op" id="3879371">}</span><span class="op" id="3879372">[</span><span class="ident" id="3879373">runtime</span><span class="op" id="3879380">.</span><span class="ident" id="3879381">GOARCH</span><span class="op" id="3879387">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3879390">var</span>&nbsp;<span class="ident" id="3879394">randomUnsupported</span>&nbsp;<span class="builtintype" id="3879412">int32</span>&nbsp;<span class="comment" id="3879418">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3879429">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3879496">type</span>&nbsp;<span class="ident" id="3879501">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3879515">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3879524">const</span>&nbsp;<span class="op" id="3879530">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879533">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879593">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3879607">GetRandomFlag</span>&nbsp;<span class="op" id="3879621">=</span>&nbsp;<span class="num" id="3879623">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3879632">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3879704">GRND_RANDOM</span>&nbsp;<span class="ident" id="3879716">GetRandomFlag</span>&nbsp;<span class="op" id="3879730">=</span>&nbsp;<span class="num" id="3879732">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3879739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3879742">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3879794">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3879917">func</span>&nbsp;<span class="ident" id="3879922">GetRandom</span><span class="op" id="3879931">(</span><span class="ident" id="3879932">p</span>&nbsp;<span class="op" id="3879934">[</span><span class="op" id="3879935">]</span><span class="builtintype" id="3879936">byte</span><span class="op" id="3879940">,</span>&nbsp;<span class="ident" id="3879942">flags</span>&nbsp;<span class="ident" id="3879948">GetRandomFlag</span><span class="op" id="3879961">)</span>&nbsp;<span class="op" id="3879963">(</span><span class="ident" id="3879964">n</span>&nbsp;<span class="builtintype" id="3879966">int</span><span class="op" id="3879969">,</span>&nbsp;<span class="ident" id="3879971">err</span>&nbsp;<span class="builtintype" id="3879975">error</span><span class="op" id="3879980">)</span>&nbsp;<span class="op" id="3879982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3879985">if</span>&nbsp;<span class="ident" id="3879988">randomTrap</span>&nbsp;<span class="op" id="3879999">==</span>&nbsp;<span class="num" id="3880002">0</span>&nbsp;<span class="op" id="3880004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880008">return</span>&nbsp;<span class="num" id="3880015">0</span><span class="op" id="3880016">,</span>&nbsp;<span class="ident" id="3880018">stdsyscall</span><span class="op" id="3880028">.</span><span class="ident" id="3880029">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880040">if</span>&nbsp;<span class="builtinfunc" id="3880043">len</span><span class="op" id="3880046">(</span><span class="ident" id="3880047">p</span><span class="op" id="3880048">)</span>&nbsp;<span class="op" id="3880050">==</span>&nbsp;<span class="num" id="3880053">0</span>&nbsp;<span class="op" id="3880055">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880059">return</span>&nbsp;<span class="num" id="3880066">0</span><span class="op" id="3880067">,</span>&nbsp;<span class="ident" id="3880069">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880077">if</span>&nbsp;<span class="ident" id="3880080">atomic</span><span class="op" id="3880086">.</span><span class="ident" id="3880087">LoadInt32</span><span class="op" id="3880096">(</span><span class="op" id="3880097">&amp;</span><span class="ident" id="3880098">randomUnsupported</span><span class="op" id="3880115">)</span>&nbsp;<span class="op" id="3880117">!=</span>&nbsp;<span class="num" id="3880120">0</span>&nbsp;<span class="op" id="3880122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880126">return</span>&nbsp;<span class="num" id="3880133">0</span><span class="op" id="3880134">,</span>&nbsp;<span class="ident" id="3880136">stdsyscall</span><span class="op" id="3880146">.</span><span class="ident" id="3880147">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880155">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880158">r1</span><span class="op" id="3880160">,</span>&nbsp;<span class="ident" id="3880162">_</span><span class="op" id="3880163">,</span>&nbsp;<span class="ident" id="3880165">errno</span>&nbsp;<span class="op" id="3880171">:=</span>&nbsp;<span class="ident" id="3880174">stdsyscall</span><span class="op" id="3880184">.</span><span class="ident" id="3880185">Syscall</span><span class="op" id="3880192">(</span><span class="ident" id="3880193">randomTrap</span><span class="op" id="3880203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3880207">uintptr</span><span class="op" id="3880214">(</span><span class="ident" id="3880215">unsafe</span><span class="op" id="3880221">.</span><span class="ident" id="3880222">Pointer</span><span class="op" id="3880229">(</span><span class="op" id="3880230">&amp;</span><span class="ident" id="3880231">p</span><span class="op" id="3880232">[</span><span class="num" id="3880233">0</span><span class="op" id="3880234">]</span><span class="op" id="3880235">)</span><span class="op" id="3880236">)</span><span class="op" id="3880237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3880241">uintptr</span><span class="op" id="3880248">(</span><span class="builtinfunc" id="3880249">len</span><span class="op" id="3880252">(</span><span class="ident" id="3880253">p</span><span class="op" id="3880254">)</span><span class="op" id="3880255">)</span><span class="op" id="3880256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3880260">uintptr</span><span class="op" id="3880267">(</span><span class="ident" id="3880268">flags</span><span class="op" id="3880273">)</span><span class="op" id="3880274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880277">if</span>&nbsp;<span class="ident" id="3880280">errno</span>&nbsp;<span class="op" id="3880286">!=</span>&nbsp;<span class="num" id="3880289">0</span>&nbsp;<span class="op" id="3880291">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880295">if</span>&nbsp;<span class="ident" id="3880298">errno</span>&nbsp;<span class="op" id="3880304">==</span>&nbsp;<span class="ident" id="3880307">stdsyscall</span><span class="op" id="3880317">.</span><span class="ident" id="3880318">ENOSYS</span>&nbsp;<span class="op" id="3880325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3880330">atomic</span><span class="op" id="3880336">.</span><span class="ident" id="3880337">StoreInt32</span><span class="op" id="3880347">(</span><span class="op" id="3880348">&amp;</span><span class="ident" id="3880349">randomUnsupported</span><span class="op" id="3880366">,</span>&nbsp;<span class="num" id="3880368">1</span><span class="op" id="3880369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880377">return</span>&nbsp;<span class="num" id="3880384">0</span><span class="op" id="3880385">,</span>&nbsp;<span class="ident" id="3880387">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3880394">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3880397">return</span>&nbsp;<span class="builtintype" id="3880404">int</span><span class="op" id="3880407">(</span><span class="ident" id="3880408">r1</span><span class="op" id="3880410">)</span><span class="op" id="3880411">,</span>&nbsp;<span class="ident" id="3880413">nil</span><br>
<span class="lineno"></span><span class="op" id="3880417">}</span>
</div>
</body>
</html>
