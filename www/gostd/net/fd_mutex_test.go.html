<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html" class="current">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6442090">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6442145">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6442199">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6442250">package</span>&nbsp;<span class="ident" id="6442258">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6442263">import</span>&nbsp;<span class="op" id="6442270">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6442273">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6442286">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6442297">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6442308">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6442315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6442318">func</span>&nbsp;<span class="ident" id="6442323">TestMutexLock</span><span class="op" id="6442336">(</span><span class="ident" id="6442337">t</span>&nbsp;<span class="op" id="6442339">*</span><span class="ident" id="6442340">testing</span><span class="op" id="6442347">.</span><span class="ident" id="6442348">T</span><span class="op" id="6442349">)</span>&nbsp;<span class="op" id="6442351">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442354">var</span>&nbsp;<span class="ident" id="6442358">mu</span>&nbsp;<span class="ident" id="6442361">fdMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442371">if</span>&nbsp;<span class="op" id="6442374">!</span><span class="ident" id="6442375">mu</span><span class="op" id="6442377">.</span><span class="ident" id="6442378">Incref</span><span class="op" id="6442384">(</span><span class="op" id="6442385">)</span>&nbsp;<span class="op" id="6442387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442391">t</span><span class="op" id="6442392">.</span><span class="ident" id="6442393">Fatal</span><span class="op" id="6442398">(</span><span class="string" id="6442399">&#34;broken&#34;</span><span class="op" id="6442407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442410">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442413">if</span>&nbsp;<span class="ident" id="6442416">mu</span><span class="op" id="6442418">.</span><span class="ident" id="6442419">Decref</span><span class="op" id="6442425">(</span><span class="op" id="6442426">)</span>&nbsp;<span class="op" id="6442428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442432">t</span><span class="op" id="6442433">.</span><span class="ident" id="6442434">Fatal</span><span class="op" id="6442439">(</span><span class="string" id="6442440">&#34;broken&#34;</span><span class="op" id="6442448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442455">if</span>&nbsp;<span class="op" id="6442458">!</span><span class="ident" id="6442459">mu</span><span class="op" id="6442461">.</span><span class="ident" id="6442462">RWLock</span><span class="op" id="6442468">(</span><span class="builtintype" id="6442469">true</span><span class="op" id="6442473">)</span>&nbsp;<span class="op" id="6442475">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442479">t</span><span class="op" id="6442480">.</span><span class="ident" id="6442481">Fatal</span><span class="op" id="6442486">(</span><span class="string" id="6442487">&#34;broken&#34;</span><span class="op" id="6442495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442501">if</span>&nbsp;<span class="ident" id="6442504">mu</span><span class="op" id="6442506">.</span><span class="ident" id="6442507">RWUnlock</span><span class="op" id="6442515">(</span><span class="builtintype" id="6442516">true</span><span class="op" id="6442520">)</span>&nbsp;<span class="op" id="6442522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442526">t</span><span class="op" id="6442527">.</span><span class="ident" id="6442528">Fatal</span><span class="op" id="6442533">(</span><span class="string" id="6442534">&#34;broken&#34;</span><span class="op" id="6442542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442545">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442549">if</span>&nbsp;<span class="op" id="6442552">!</span><span class="ident" id="6442553">mu</span><span class="op" id="6442555">.</span><span class="ident" id="6442556">RWLock</span><span class="op" id="6442562">(</span><span class="builtintype" id="6442563">false</span><span class="op" id="6442568">)</span>&nbsp;<span class="op" id="6442570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442574">t</span><span class="op" id="6442575">.</span><span class="ident" id="6442576">Fatal</span><span class="op" id="6442581">(</span><span class="string" id="6442582">&#34;broken&#34;</span><span class="op" id="6442590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442596">if</span>&nbsp;<span class="ident" id="6442599">mu</span><span class="op" id="6442601">.</span><span class="ident" id="6442602">RWUnlock</span><span class="op" id="6442610">(</span><span class="builtintype" id="6442611">false</span><span class="op" id="6442616">)</span>&nbsp;<span class="op" id="6442618">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442622">t</span><span class="op" id="6442623">.</span><span class="ident" id="6442624">Fatal</span><span class="op" id="6442629">(</span><span class="string" id="6442630">&#34;broken&#34;</span><span class="op" id="6442638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442641">}</span><br>
<span class="lineno"></span><span class="op" id="6442643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6442646">func</span>&nbsp;<span class="ident" id="6442651">TestMutexClose</span><span class="op" id="6442665">(</span><span class="ident" id="6442666">t</span>&nbsp;<span class="op" id="6442668">*</span><span class="ident" id="6442669">testing</span><span class="op" id="6442676">.</span><span class="ident" id="6442677">T</span><span class="op" id="6442678">)</span>&nbsp;<span class="op" id="6442680">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442683">var</span>&nbsp;<span class="ident" id="6442687">mu</span>&nbsp;<span class="ident" id="6442690">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442699">if</span>&nbsp;<span class="op" id="6442702">!</span><span class="ident" id="6442703">mu</span><span class="op" id="6442705">.</span><span class="ident" id="6442706">IncrefAndClose</span><span class="op" id="6442720">(</span><span class="op" id="6442721">)</span>&nbsp;<span class="op" id="6442723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442727">t</span><span class="op" id="6442728">.</span><span class="ident" id="6442729">Fatal</span><span class="op" id="6442734">(</span><span class="string" id="6442735">&#34;broken&#34;</span><span class="op" id="6442743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442750">if</span>&nbsp;<span class="ident" id="6442753">mu</span><span class="op" id="6442755">.</span><span class="ident" id="6442756">Incref</span><span class="op" id="6442762">(</span><span class="op" id="6442763">)</span>&nbsp;<span class="op" id="6442765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442769">t</span><span class="op" id="6442770">.</span><span class="ident" id="6442771">Fatal</span><span class="op" id="6442776">(</span><span class="string" id="6442777">&#34;broken&#34;</span><span class="op" id="6442785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442791">if</span>&nbsp;<span class="ident" id="6442794">mu</span><span class="op" id="6442796">.</span><span class="ident" id="6442797">RWLock</span><span class="op" id="6442803">(</span><span class="builtintype" id="6442804">true</span><span class="op" id="6442808">)</span>&nbsp;<span class="op" id="6442810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442814">t</span><span class="op" id="6442815">.</span><span class="ident" id="6442816">Fatal</span><span class="op" id="6442821">(</span><span class="string" id="6442822">&#34;broken&#34;</span><span class="op" id="6442830">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442836">if</span>&nbsp;<span class="ident" id="6442839">mu</span><span class="op" id="6442841">.</span><span class="ident" id="6442842">RWLock</span><span class="op" id="6442848">(</span><span class="builtintype" id="6442849">false</span><span class="op" id="6442854">)</span>&nbsp;<span class="op" id="6442856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442860">t</span><span class="op" id="6442861">.</span><span class="ident" id="6442862">Fatal</span><span class="op" id="6442867">(</span><span class="string" id="6442868">&#34;broken&#34;</span><span class="op" id="6442876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442882">if</span>&nbsp;<span class="ident" id="6442885">mu</span><span class="op" id="6442887">.</span><span class="ident" id="6442888">IncrefAndClose</span><span class="op" id="6442902">(</span><span class="op" id="6442903">)</span>&nbsp;<span class="op" id="6442905">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442909">t</span><span class="op" id="6442910">.</span><span class="ident" id="6442911">Fatal</span><span class="op" id="6442916">(</span><span class="string" id="6442917">&#34;broken&#34;</span><span class="op" id="6442925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6442928">}</span><br>
<span class="lineno"></span><span class="op" id="6442930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6442933">func</span>&nbsp;<span class="ident" id="6442938">TestMutexCloseUnblock</span><span class="op" id="6442959">(</span><span class="ident" id="6442960">t</span>&nbsp;<span class="op" id="6442962">*</span><span class="ident" id="6442963">testing</span><span class="op" id="6442970">.</span><span class="ident" id="6442971">T</span><span class="op" id="6442972">)</span>&nbsp;<span class="op" id="6442974">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6442977">c</span>&nbsp;<span class="op" id="6442979">:=</span>&nbsp;<span class="builtinfunc" id="6442982">make</span><span class="op" id="6442986">(</span><span class="keyword" id="6442987">chan</span>&nbsp;<span class="builtintype" id="6442992">bool</span><span class="op" id="6442996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6442999">var</span>&nbsp;<span class="ident" id="6443003">mu</span>&nbsp;<span class="ident" id="6443006">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443015">mu</span><span class="op" id="6443017">.</span><span class="ident" id="6443018">RWLock</span><span class="op" id="6443024">(</span><span class="builtintype" id="6443025">true</span><span class="op" id="6443029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443032">for</span>&nbsp;<span class="ident" id="6443036">i</span>&nbsp;<span class="op" id="6443038">:=</span>&nbsp;<span class="num" id="6443041">0</span><span class="op" id="6443042">;</span>&nbsp;<span class="ident" id="6443044">i</span>&nbsp;<span class="op" id="6443046">&lt;</span>&nbsp;<span class="num" id="6443048">4</span><span class="op" id="6443049">;</span>&nbsp;<span class="ident" id="6443051">i</span><span class="op" id="6443052">++</span>&nbsp;<span class="op" id="6443055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443059">go</span>&nbsp;<span class="keyword" id="6443062">func</span><span class="op" id="6443066">(</span><span class="op" id="6443067">)</span>&nbsp;<span class="op" id="6443069">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443074">if</span>&nbsp;<span class="ident" id="6443077">mu</span><span class="op" id="6443079">.</span><span class="ident" id="6443080">RWLock</span><span class="op" id="6443086">(</span><span class="builtintype" id="6443087">true</span><span class="op" id="6443091">)</span>&nbsp;<span class="op" id="6443093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443099">t</span><span class="op" id="6443100">.</span><span class="ident" id="6443101">Error</span><span class="op" id="6443106">(</span><span class="string" id="6443107">&#34;broken&#34;</span><span class="op" id="6443115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443121">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443136">c</span>&nbsp;<span class="op" id="6443138">&lt;-</span>&nbsp;<span class="builtintype" id="6443141">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443148">}</span><span class="op" id="6443149">(</span><span class="op" id="6443150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6443156">//&nbsp;Concurrent&nbsp;goroutines&nbsp;must&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;read&nbsp;lock&nbsp;the&nbsp;mutex.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443223">time</span><span class="op" id="6443227">.</span><span class="ident" id="6443228">Sleep</span><span class="op" id="6443233">(</span><span class="ident" id="6443234">time</span><span class="op" id="6443238">.</span><span class="ident" id="6443239">Millisecond</span><span class="op" id="6443250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443253">select</span>&nbsp;<span class="op" id="6443260">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443263">case</span>&nbsp;<span class="op" id="6443268">&lt;-</span><span class="ident" id="6443270">c</span><span class="op" id="6443271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443275">t</span><span class="op" id="6443276">.</span><span class="ident" id="6443277">Fatal</span><span class="op" id="6443282">(</span><span class="string" id="6443283">&#34;broken&#34;</span><span class="op" id="6443291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443294">default</span><span class="op" id="6443301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443307">mu</span><span class="op" id="6443309">.</span><span class="ident" id="6443310">IncrefAndClose</span><span class="op" id="6443324">(</span><span class="op" id="6443325">)</span>&nbsp;<span class="comment" id="6443327">//&nbsp;Must&nbsp;unblock&nbsp;the&nbsp;readers.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443357">for</span>&nbsp;<span class="ident" id="6443361">i</span>&nbsp;<span class="op" id="6443363">:=</span>&nbsp;<span class="num" id="6443366">0</span><span class="op" id="6443367">;</span>&nbsp;<span class="ident" id="6443369">i</span>&nbsp;<span class="op" id="6443371">&lt;</span>&nbsp;<span class="num" id="6443373">4</span><span class="op" id="6443374">;</span>&nbsp;<span class="ident" id="6443376">i</span><span class="op" id="6443377">++</span>&nbsp;<span class="op" id="6443380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443384">select</span>&nbsp;<span class="op" id="6443391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443395">case</span>&nbsp;<span class="op" id="6443400">&lt;-</span><span class="ident" id="6443402">c</span><span class="op" id="6443403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443407">case</span>&nbsp;<span class="op" id="6443412">&lt;-</span><span class="ident" id="6443414">time</span><span class="op" id="6443418">.</span><span class="ident" id="6443419">After</span><span class="op" id="6443424">(</span><span class="num" id="6443425">10</span>&nbsp;<span class="op" id="6443428">*</span>&nbsp;<span class="ident" id="6443430">time</span><span class="op" id="6443434">.</span><span class="ident" id="6443435">Second</span><span class="op" id="6443441">)</span><span class="op" id="6443442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443447">t</span><span class="op" id="6443448">.</span><span class="ident" id="6443449">Fatal</span><span class="op" id="6443454">(</span><span class="string" id="6443455">&#34;broken&#34;</span><span class="op" id="6443463">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443473">if</span>&nbsp;<span class="ident" id="6443476">mu</span><span class="op" id="6443478">.</span><span class="ident" id="6443479">Decref</span><span class="op" id="6443485">(</span><span class="op" id="6443486">)</span>&nbsp;<span class="op" id="6443488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443492">t</span><span class="op" id="6443493">.</span><span class="ident" id="6443494">Fatal</span><span class="op" id="6443499">(</span><span class="string" id="6443500">&#34;broken&#34;</span><span class="op" id="6443508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443511">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443514">if</span>&nbsp;<span class="op" id="6443517">!</span><span class="ident" id="6443518">mu</span><span class="op" id="6443520">.</span><span class="ident" id="6443521">RWUnlock</span><span class="op" id="6443529">(</span><span class="builtintype" id="6443530">true</span><span class="op" id="6443534">)</span>&nbsp;<span class="op" id="6443536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443540">t</span><span class="op" id="6443541">.</span><span class="ident" id="6443542">Fatal</span><span class="op" id="6443547">(</span><span class="string" id="6443548">&#34;broken&#34;</span><span class="op" id="6443556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443559">}</span><br>
<span class="lineno"></span><span class="op" id="6443561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6443564">func</span>&nbsp;<span class="ident" id="6443569">TestMutexPanic</span><span class="op" id="6443583">(</span><span class="ident" id="6443584">t</span>&nbsp;<span class="op" id="6443586">*</span><span class="ident" id="6443587">testing</span><span class="op" id="6443594">.</span><span class="ident" id="6443595">T</span><span class="op" id="6443596">)</span>&nbsp;<span class="op" id="6443598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443601">ensurePanics</span>&nbsp;<span class="op" id="6443614">:=</span>&nbsp;<span class="keyword" id="6443617">func</span><span class="op" id="6443621">(</span><span class="ident" id="6443622">f</span>&nbsp;<span class="keyword" id="6443624">func</span><span class="op" id="6443628">(</span><span class="op" id="6443629">)</span><span class="op" id="6443630">)</span>&nbsp;<span class="op" id="6443632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443636">defer</span>&nbsp;<span class="keyword" id="6443642">func</span><span class="op" id="6443646">(</span><span class="op" id="6443647">)</span>&nbsp;<span class="op" id="6443649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443654">if</span>&nbsp;<span class="builtinfunc" id="6443657">recover</span><span class="op" id="6443664">(</span><span class="op" id="6443665">)</span>&nbsp;<span class="op" id="6443667">==</span>&nbsp;<span class="builtintype" id="6443670">nil</span>&nbsp;<span class="op" id="6443674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443680">t</span><span class="op" id="6443681">.</span><span class="ident" id="6443682">Fatal</span><span class="op" id="6443687">(</span><span class="string" id="6443688">&#34;does&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6443704">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443713">}</span><span class="op" id="6443714">(</span><span class="op" id="6443715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443719">f</span><span class="op" id="6443720">(</span><span class="op" id="6443721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6443724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6443728">var</span>&nbsp;<span class="ident" id="6443732">mu</span>&nbsp;<span class="ident" id="6443735">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443744">ensurePanics</span><span class="op" id="6443756">(</span><span class="keyword" id="6443757">func</span><span class="op" id="6443761">(</span><span class="op" id="6443762">)</span>&nbsp;<span class="op" id="6443764">{</span>&nbsp;<span class="ident" id="6443766">mu</span><span class="op" id="6443768">.</span><span class="ident" id="6443769">Decref</span><span class="op" id="6443775">(</span><span class="op" id="6443776">)</span>&nbsp;<span class="op" id="6443778">}</span><span class="op" id="6443779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443782">ensurePanics</span><span class="op" id="6443794">(</span><span class="keyword" id="6443795">func</span><span class="op" id="6443799">(</span><span class="op" id="6443800">)</span>&nbsp;<span class="op" id="6443802">{</span>&nbsp;<span class="ident" id="6443804">mu</span><span class="op" id="6443806">.</span><span class="ident" id="6443807">RWUnlock</span><span class="op" id="6443815">(</span><span class="builtintype" id="6443816">true</span><span class="op" id="6443820">)</span>&nbsp;<span class="op" id="6443822">}</span><span class="op" id="6443823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443826">ensurePanics</span><span class="op" id="6443838">(</span><span class="keyword" id="6443839">func</span><span class="op" id="6443843">(</span><span class="op" id="6443844">)</span>&nbsp;<span class="op" id="6443846">{</span>&nbsp;<span class="ident" id="6443848">mu</span><span class="op" id="6443850">.</span><span class="ident" id="6443851">RWUnlock</span><span class="op" id="6443859">(</span><span class="builtintype" id="6443860">false</span><span class="op" id="6443865">)</span>&nbsp;<span class="op" id="6443867">}</span><span class="op" id="6443868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443872">ensurePanics</span><span class="op" id="6443884">(</span><span class="keyword" id="6443885">func</span><span class="op" id="6443889">(</span><span class="op" id="6443890">)</span>&nbsp;<span class="op" id="6443892">{</span>&nbsp;<span class="ident" id="6443894">mu</span><span class="op" id="6443896">.</span><span class="ident" id="6443897">Incref</span><span class="op" id="6443903">(</span><span class="op" id="6443904">)</span><span class="op" id="6443905">;</span>&nbsp;<span class="ident" id="6443907">mu</span><span class="op" id="6443909">.</span><span class="ident" id="6443910">Decref</span><span class="op" id="6443916">(</span><span class="op" id="6443917">)</span><span class="op" id="6443918">;</span>&nbsp;<span class="ident" id="6443920">mu</span><span class="op" id="6443922">.</span><span class="ident" id="6443923">Decref</span><span class="op" id="6443929">(</span><span class="op" id="6443930">)</span>&nbsp;<span class="op" id="6443932">}</span><span class="op" id="6443933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6443936">ensurePanics</span><span class="op" id="6443948">(</span><span class="keyword" id="6443949">func</span><span class="op" id="6443953">(</span><span class="op" id="6443954">)</span>&nbsp;<span class="op" id="6443956">{</span>&nbsp;<span class="ident" id="6443958">mu</span><span class="op" id="6443960">.</span><span class="ident" id="6443961">RWLock</span><span class="op" id="6443967">(</span><span class="builtintype" id="6443968">true</span><span class="op" id="6443972">)</span><span class="op" id="6443973">;</span>&nbsp;<span class="ident" id="6443975">mu</span><span class="op" id="6443977">.</span><span class="ident" id="6443978">RWUnlock</span><span class="op" id="6443986">(</span><span class="builtintype" id="6443987">true</span><span class="op" id="6443991">)</span><span class="op" id="6443992">;</span>&nbsp;<span class="ident" id="6443994">mu</span><span class="op" id="6443996">.</span><span class="ident" id="6443997">RWUnlock</span><span class="op" id="6444005">(</span><span class="builtintype" id="6444006">true</span><span class="op" id="6444010">)</span>&nbsp;<span class="op" id="6444012">}</span><span class="op" id="6444013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444016">ensurePanics</span><span class="op" id="6444028">(</span><span class="keyword" id="6444029">func</span><span class="op" id="6444033">(</span><span class="op" id="6444034">)</span>&nbsp;<span class="op" id="6444036">{</span>&nbsp;<span class="ident" id="6444038">mu</span><span class="op" id="6444040">.</span><span class="ident" id="6444041">RWLock</span><span class="op" id="6444047">(</span><span class="builtintype" id="6444048">false</span><span class="op" id="6444053">)</span><span class="op" id="6444054">;</span>&nbsp;<span class="ident" id="6444056">mu</span><span class="op" id="6444058">.</span><span class="ident" id="6444059">RWUnlock</span><span class="op" id="6444067">(</span><span class="builtintype" id="6444068">false</span><span class="op" id="6444073">)</span><span class="op" id="6444074">;</span>&nbsp;<span class="ident" id="6444076">mu</span><span class="op" id="6444078">.</span><span class="ident" id="6444079">RWUnlock</span><span class="op" id="6444087">(</span><span class="builtintype" id="6444088">false</span><span class="op" id="6444093">)</span>&nbsp;<span class="op" id="6444095">}</span><span class="op" id="6444096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6444100">//&nbsp;ensure&nbsp;that&nbsp;it&#39;s&nbsp;still&nbsp;not&nbsp;broken</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444138">mu</span><span class="op" id="6444140">.</span><span class="ident" id="6444141">Incref</span><span class="op" id="6444147">(</span><span class="op" id="6444148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444151">mu</span><span class="op" id="6444153">.</span><span class="ident" id="6444154">Decref</span><span class="op" id="6444160">(</span><span class="op" id="6444161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444164">mu</span><span class="op" id="6444166">.</span><span class="ident" id="6444167">RWLock</span><span class="op" id="6444173">(</span><span class="builtintype" id="6444174">true</span><span class="op" id="6444178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444181">mu</span><span class="op" id="6444183">.</span><span class="ident" id="6444184">RWUnlock</span><span class="op" id="6444192">(</span><span class="builtintype" id="6444193">true</span><span class="op" id="6444197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444200">mu</span><span class="op" id="6444202">.</span><span class="ident" id="6444203">RWLock</span><span class="op" id="6444209">(</span><span class="builtintype" id="6444210">false</span><span class="op" id="6444215">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444218">mu</span><span class="op" id="6444220">.</span><span class="ident" id="6444221">RWUnlock</span><span class="op" id="6444229">(</span><span class="builtintype" id="6444230">false</span><span class="op" id="6444235">)</span><br>
<span class="lineno"></span><span class="op" id="6444237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6444240">func</span>&nbsp;<span class="ident" id="6444245">TestMutexStress</span><span class="op" id="6444260">(</span><span class="ident" id="6444261">t</span>&nbsp;<span class="op" id="6444263">*</span><span class="ident" id="6444264">testing</span><span class="op" id="6444271">.</span><span class="ident" id="6444272">T</span><span class="op" id="6444273">)</span>&nbsp;<span class="op" id="6444275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444278">P</span>&nbsp;<span class="op" id="6444280">:=</span>&nbsp;<span class="num" id="6444283">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444286">N</span>&nbsp;<span class="op" id="6444288">:=</span>&nbsp;<span class="builtintype" id="6444291">int</span><span class="op" id="6444294">(</span><span class="num" id="6444295">1e6</span><span class="op" id="6444298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444301">if</span>&nbsp;<span class="ident" id="6444304">testing</span><span class="op" id="6444311">.</span><span class="ident" id="6444312">Short</span><span class="op" id="6444317">(</span><span class="op" id="6444318">)</span>&nbsp;<span class="op" id="6444320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444324">P</span>&nbsp;<span class="op" id="6444326">=</span>&nbsp;<span class="num" id="6444328">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444332">N</span>&nbsp;<span class="op" id="6444334">=</span>&nbsp;<span class="num" id="6444336">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6444341">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444344">defer</span>&nbsp;<span class="ident" id="6444350">runtime</span><span class="op" id="6444357">.</span><span class="ident" id="6444358">GOMAXPROCS</span><span class="op" id="6444368">(</span><span class="ident" id="6444369">runtime</span><span class="op" id="6444376">.</span><span class="ident" id="6444377">GOMAXPROCS</span><span class="op" id="6444387">(</span><span class="ident" id="6444388">P</span><span class="op" id="6444389">)</span><span class="op" id="6444390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444393">done</span>&nbsp;<span class="op" id="6444398">:=</span>&nbsp;<span class="builtinfunc" id="6444401">make</span><span class="op" id="6444405">(</span><span class="keyword" id="6444406">chan</span>&nbsp;<span class="builtintype" id="6444411">bool</span><span class="op" id="6444415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444418">var</span>&nbsp;<span class="ident" id="6444422">mu</span>&nbsp;<span class="ident" id="6444425">fdMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444434">var</span>&nbsp;<span class="ident" id="6444438">readState</span>&nbsp;<span class="op" id="6444448">[</span><span class="num" id="6444449">2</span><span class="op" id="6444450">]</span><span class="ident" id="6444451">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444459">var</span>&nbsp;<span class="ident" id="6444463">writeState</span>&nbsp;<span class="op" id="6444474">[</span><span class="num" id="6444475">2</span><span class="op" id="6444476">]</span><span class="ident" id="6444477">uint64</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444485">for</span>&nbsp;<span class="ident" id="6444489">p</span>&nbsp;<span class="op" id="6444491">:=</span>&nbsp;<span class="num" id="6444494">0</span><span class="op" id="6444495">;</span>&nbsp;<span class="ident" id="6444497">p</span>&nbsp;<span class="op" id="6444499">&lt;</span>&nbsp;<span class="ident" id="6444501">P</span><span class="op" id="6444502">;</span>&nbsp;<span class="ident" id="6444504">p</span><span class="op" id="6444505">++</span>&nbsp;<span class="op" id="6444508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444512">go</span>&nbsp;<span class="keyword" id="6444515">func</span><span class="op" id="6444519">(</span><span class="op" id="6444520">)</span>&nbsp;<span class="op" id="6444522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444527">r</span>&nbsp;<span class="op" id="6444529">:=</span>&nbsp;<span class="ident" id="6444532">rand</span><span class="op" id="6444536">.</span><span class="ident" id="6444537">New</span><span class="op" id="6444540">(</span><span class="ident" id="6444541">rand</span><span class="op" id="6444545">.</span><span class="ident" id="6444546">NewSource</span><span class="op" id="6444555">(</span><span class="ident" id="6444556">rand</span><span class="op" id="6444560">.</span><span class="ident" id="6444561">Int63</span><span class="op" id="6444566">(</span><span class="op" id="6444567">)</span><span class="op" id="6444568">)</span><span class="op" id="6444569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444574">for</span>&nbsp;<span class="ident" id="6444578">i</span>&nbsp;<span class="op" id="6444580">:=</span>&nbsp;<span class="num" id="6444583">0</span><span class="op" id="6444584">;</span>&nbsp;<span class="ident" id="6444586">i</span>&nbsp;<span class="op" id="6444588">&lt;</span>&nbsp;<span class="ident" id="6444590">N</span><span class="op" id="6444591">;</span>&nbsp;<span class="ident" id="6444593">i</span><span class="op" id="6444594">++</span>&nbsp;<span class="op" id="6444597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444603">switch</span>&nbsp;<span class="ident" id="6444610">r</span><span class="op" id="6444611">.</span><span class="ident" id="6444612">Intn</span><span class="op" id="6444616">(</span><span class="num" id="6444617">3</span><span class="op" id="6444618">)</span>&nbsp;<span class="op" id="6444620">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444626">case</span>&nbsp;<span class="num" id="6444631">0</span><span class="op" id="6444632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444639">if</span>&nbsp;<span class="op" id="6444642">!</span><span class="ident" id="6444643">mu</span><span class="op" id="6444645">.</span><span class="ident" id="6444646">Incref</span><span class="op" id="6444652">(</span><span class="op" id="6444653">)</span>&nbsp;<span class="op" id="6444655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444663">t</span><span class="op" id="6444664">.</span><span class="ident" id="6444665">Error</span><span class="op" id="6444670">(</span><span class="string" id="6444671">&#34;broken&#34;</span><span class="op" id="6444679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444687">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6444699">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444706">if</span>&nbsp;<span class="ident" id="6444709">mu</span><span class="op" id="6444711">.</span><span class="ident" id="6444712">Decref</span><span class="op" id="6444718">(</span><span class="op" id="6444719">)</span>&nbsp;<span class="op" id="6444721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444729">t</span><span class="op" id="6444730">.</span><span class="ident" id="6444731">Error</span><span class="op" id="6444736">(</span><span class="string" id="6444737">&#34;broken&#34;</span><span class="op" id="6444745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444753">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6444765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444771">case</span>&nbsp;<span class="num" id="6444776">1</span><span class="op" id="6444777">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444784">if</span>&nbsp;<span class="op" id="6444787">!</span><span class="ident" id="6444788">mu</span><span class="op" id="6444790">.</span><span class="ident" id="6444791">RWLock</span><span class="op" id="6444797">(</span><span class="builtintype" id="6444798">true</span><span class="op" id="6444802">)</span>&nbsp;<span class="op" id="6444804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444812">t</span><span class="op" id="6444813">.</span><span class="ident" id="6444814">Error</span><span class="op" id="6444819">(</span><span class="string" id="6444820">&#34;broken&#34;</span><span class="op" id="6444828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444836">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6444848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6444855">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;readers.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444917">if</span>&nbsp;<span class="ident" id="6444920">readState</span><span class="op" id="6444929">[</span><span class="num" id="6444930">0</span><span class="op" id="6444931">]</span>&nbsp;<span class="op" id="6444933">!=</span>&nbsp;<span class="ident" id="6444936">readState</span><span class="op" id="6444945">[</span><span class="num" id="6444946">1</span><span class="op" id="6444947">]</span>&nbsp;<span class="op" id="6444949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6444957">t</span><span class="op" id="6444958">.</span><span class="ident" id="6444959">Error</span><span class="op" id="6444964">(</span><span class="string" id="6444965">&#34;broken&#34;</span><span class="op" id="6444973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6444981">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6444993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445000">readState</span><span class="op" id="6445009">[</span><span class="num" id="6445010">0</span><span class="op" id="6445011">]</span><span class="op" id="6445012">++</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445020">readState</span><span class="op" id="6445029">[</span><span class="num" id="6445030">1</span><span class="op" id="6445031">]</span><span class="op" id="6445032">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445040">if</span>&nbsp;<span class="ident" id="6445043">mu</span><span class="op" id="6445045">.</span><span class="ident" id="6445046">RWUnlock</span><span class="op" id="6445054">(</span><span class="builtintype" id="6445055">true</span><span class="op" id="6445059">)</span>&nbsp;<span class="op" id="6445061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445069">t</span><span class="op" id="6445070">.</span><span class="ident" id="6445071">Error</span><span class="op" id="6445076">(</span><span class="string" id="6445077">&#34;broken&#34;</span><span class="op" id="6445085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445093">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445105">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445111">case</span>&nbsp;<span class="num" id="6445116">2</span><span class="op" id="6445117">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445124">if</span>&nbsp;<span class="op" id="6445127">!</span><span class="ident" id="6445128">mu</span><span class="op" id="6445130">.</span><span class="ident" id="6445131">RWLock</span><span class="op" id="6445137">(</span><span class="builtintype" id="6445138">false</span><span class="op" id="6445143">)</span>&nbsp;<span class="op" id="6445145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445153">t</span><span class="op" id="6445154">.</span><span class="ident" id="6445155">Error</span><span class="op" id="6445160">(</span><span class="string" id="6445161">&#34;broken&#34;</span><span class="op" id="6445169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445177">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445189">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6445196">//&nbsp;Ensure&nbsp;that&nbsp;it&nbsp;provides&nbsp;mutual&nbsp;exclusion&nbsp;for&nbsp;writers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445258">if</span>&nbsp;<span class="ident" id="6445261">writeState</span><span class="op" id="6445271">[</span><span class="num" id="6445272">0</span><span class="op" id="6445273">]</span>&nbsp;<span class="op" id="6445275">!=</span>&nbsp;<span class="ident" id="6445278">writeState</span><span class="op" id="6445288">[</span><span class="num" id="6445289">1</span><span class="op" id="6445290">]</span>&nbsp;<span class="op" id="6445292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445300">t</span><span class="op" id="6445301">.</span><span class="ident" id="6445302">Error</span><span class="op" id="6445307">(</span><span class="string" id="6445308">&#34;broken&#34;</span><span class="op" id="6445316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445324">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445336">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445343">writeState</span><span class="op" id="6445353">[</span><span class="num" id="6445354">0</span><span class="op" id="6445355">]</span><span class="op" id="6445356">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445364">writeState</span><span class="op" id="6445374">[</span><span class="num" id="6445375">1</span><span class="op" id="6445376">]</span><span class="op" id="6445377">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445385">if</span>&nbsp;<span class="ident" id="6445388">mu</span><span class="op" id="6445390">.</span><span class="ident" id="6445391">RWUnlock</span><span class="op" id="6445399">(</span><span class="builtintype" id="6445400">false</span><span class="op" id="6445405">)</span>&nbsp;<span class="op" id="6445407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445415">t</span><span class="op" id="6445416">.</span><span class="ident" id="6445417">Error</span><span class="op" id="6445422">(</span><span class="string" id="6445423">&#34;broken&#34;</span><span class="op" id="6445431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445439">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445467">done</span>&nbsp;<span class="op" id="6445472">&lt;-</span>&nbsp;<span class="builtintype" id="6445475">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445482">}</span><span class="op" id="6445483">(</span><span class="op" id="6445484">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445490">for</span>&nbsp;<span class="ident" id="6445494">p</span>&nbsp;<span class="op" id="6445496">:=</span>&nbsp;<span class="num" id="6445499">0</span><span class="op" id="6445500">;</span>&nbsp;<span class="ident" id="6445502">p</span>&nbsp;<span class="op" id="6445504">&lt;</span>&nbsp;<span class="ident" id="6445506">P</span><span class="op" id="6445507">;</span>&nbsp;<span class="ident" id="6445509">p</span><span class="op" id="6445510">++</span>&nbsp;<span class="op" id="6445513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445517">&lt;-</span><span class="ident" id="6445519">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445528">if</span>&nbsp;<span class="op" id="6445531">!</span><span class="ident" id="6445532">mu</span><span class="op" id="6445534">.</span><span class="ident" id="6445535">IncrefAndClose</span><span class="op" id="6445549">(</span><span class="op" id="6445550">)</span>&nbsp;<span class="op" id="6445552">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445556">t</span><span class="op" id="6445557">.</span><span class="ident" id="6445558">Fatal</span><span class="op" id="6445563">(</span><span class="string" id="6445564">&#34;broken&#34;</span><span class="op" id="6445572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6445578">if</span>&nbsp;<span class="op" id="6445581">!</span><span class="ident" id="6445582">mu</span><span class="op" id="6445584">.</span><span class="ident" id="6445585">Decref</span><span class="op" id="6445591">(</span><span class="op" id="6445592">)</span>&nbsp;<span class="op" id="6445594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6445598">t</span><span class="op" id="6445599">.</span><span class="ident" id="6445600">Fatal</span><span class="op" id="6445605">(</span><span class="string" id="6445606">&#34;broken&#34;</span><span class="op" id="6445614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6445617">}</span><br>
<span class="lineno">195</span><span class="op" id="6445619">}</span>
</div>
</body>
</html>
