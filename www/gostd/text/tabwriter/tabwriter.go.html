<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/tabwriter</h2>
<ul>
<li><a href="/gostd/text/tabwriter/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter.go.html" class="current">tabwriter.go</a></li>
<li><a href="/gostd/text/tabwriter/tabwriter_test.go.html">tabwriter_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4642833">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4642888">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4642942">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4642993">//&nbsp;Package&nbsp;tabwriter&nbsp;implements&nbsp;a&nbsp;write&nbsp;filter&nbsp;(tabwriter.Writer)&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4643064">//&nbsp;translates&nbsp;tabbed&nbsp;columns&nbsp;in&nbsp;input&nbsp;into&nbsp;properly&nbsp;aligned&nbsp;text.</span><br>
<span class="lineno"></span><span class="comment" id="4643130">//</span><br>
<span class="lineno"></span><span class="comment" id="4643133">//&nbsp;The&nbsp;package&nbsp;is&nbsp;using&nbsp;the&nbsp;Elastic&nbsp;Tabstops&nbsp;algorithm&nbsp;described&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="4643201">//&nbsp;http://nickgravgaard.com/elastictabstops/index.html.</span><br>
<span class="lineno">10</span><span class="comment" id="4643257">//</span><br>
<span class="lineno"></span><span class="keyword" id="4643260">package</span>&nbsp;<span class="ident" id="4643268">tabwriter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4643279">import</span>&nbsp;<span class="op" id="4643286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4643289">&#34;bytes&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4643298">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4643304">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4643319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4643322">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">20</span><span class="comment" id="4643402">//&nbsp;Filter&nbsp;implementation</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4643428">//&nbsp;A&nbsp;cell&nbsp;represents&nbsp;a&nbsp;segment&nbsp;of&nbsp;text&nbsp;terminated&nbsp;by&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks.</span><br>
<span class="lineno"></span><span class="comment" id="4643502">//&nbsp;The&nbsp;text&nbsp;itself&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;separate&nbsp;buffer;&nbsp;cell&nbsp;only&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4643577">//&nbsp;segment&#39;s&nbsp;size&nbsp;in&nbsp;bytes,&nbsp;its&nbsp;width&nbsp;in&nbsp;runes,&nbsp;and&nbsp;whether&nbsp;it&#39;s&nbsp;an&nbsp;htab</span><br>
<span class="lineno">25</span><span class="comment" id="4643650">//&nbsp;(&#39;\t&#39;)&nbsp;terminated&nbsp;cell.</span><br>
<span class="lineno"></span><span class="comment" id="4643677">//</span><br>
<span class="lineno"></span><span class="keyword" id="4643680">type</span>&nbsp;<span class="ident" id="4643685">cell</span>&nbsp;<span class="keyword" id="4643690">struct</span>&nbsp;<span class="op" id="4643697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4643700">size</span>&nbsp;&nbsp;<span class="builtintype" id="4643706">int</span>&nbsp;&nbsp;<span class="comment" id="4643711">//&nbsp;cell&nbsp;size&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4643734">width</span>&nbsp;<span class="builtintype" id="4643740">int</span>&nbsp;&nbsp;<span class="comment" id="4643745">//&nbsp;cell&nbsp;width&nbsp;in&nbsp;runes</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4643769">htab</span>&nbsp;&nbsp;<span class="builtintype" id="4643775">bool</span>&nbsp;<span class="comment" id="4643780">//&nbsp;true&nbsp;if&nbsp;the&nbsp;cell&nbsp;is&nbsp;terminated&nbsp;by&nbsp;an&nbsp;htab&nbsp;(&#39;\t&#39;)</span><br>
<span class="lineno"></span><span class="op" id="4643832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4643835">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;a&nbsp;filter&nbsp;that&nbsp;inserts&nbsp;padding&nbsp;around&nbsp;tab-delimited</span><br>
<span class="lineno"></span><span class="comment" id="4643901">//&nbsp;columns&nbsp;in&nbsp;its&nbsp;input&nbsp;to&nbsp;align&nbsp;them&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno">35</span><span class="comment" id="4643954">//</span><br>
<span class="lineno"></span><span class="comment" id="4643957">//&nbsp;The&nbsp;Writer&nbsp;treats&nbsp;incoming&nbsp;bytes&nbsp;as&nbsp;UTF-8&nbsp;encoded&nbsp;text&nbsp;consisting</span><br>
<span class="lineno"></span><span class="comment" id="4644026">//&nbsp;of&nbsp;cells&nbsp;terminated&nbsp;by&nbsp;(horizontal&nbsp;or&nbsp;vertical)&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4644090">//&nbsp;breaks&nbsp;(newline&nbsp;or&nbsp;formfeed&nbsp;characters).&nbsp;Cells&nbsp;in&nbsp;adjacent&nbsp;lines</span><br>
<span class="lineno"></span><span class="comment" id="4644158">//&nbsp;constitute&nbsp;a&nbsp;column.&nbsp;The&nbsp;Writer&nbsp;inserts&nbsp;padding&nbsp;as&nbsp;needed&nbsp;to</span><br>
<span class="lineno">40</span><span class="comment" id="4644222">//&nbsp;make&nbsp;all&nbsp;cells&nbsp;in&nbsp;a&nbsp;column&nbsp;have&nbsp;the&nbsp;same&nbsp;width,&nbsp;effectively</span><br>
<span class="lineno"></span><span class="comment" id="4644285">//&nbsp;aligning&nbsp;the&nbsp;columns.&nbsp;It&nbsp;assumes&nbsp;that&nbsp;all&nbsp;characters&nbsp;have&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4644350">//&nbsp;same&nbsp;width&nbsp;except&nbsp;for&nbsp;tabs&nbsp;for&nbsp;which&nbsp;a&nbsp;tabwidth&nbsp;must&nbsp;be&nbsp;specified.</span><br>
<span class="lineno"></span><span class="comment" id="4644420">//&nbsp;Note&nbsp;that&nbsp;cells&nbsp;are&nbsp;tab-terminated,&nbsp;not&nbsp;tab-separated:&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="4644487">//&nbsp;non-tab&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;line&nbsp;does&nbsp;not&nbsp;form&nbsp;a&nbsp;column&nbsp;cell.</span><br>
<span class="lineno">45</span><span class="comment" id="4644553">//</span><br>
<span class="lineno"></span><span class="comment" id="4644556">//&nbsp;The&nbsp;Writer&nbsp;assumes&nbsp;that&nbsp;all&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;have&nbsp;the&nbsp;same&nbsp;width;</span><br>
<span class="lineno"></span><span class="comment" id="4644628">//&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;true&nbsp;in&nbsp;some&nbsp;fonts.</span><br>
<span class="lineno"></span><span class="comment" id="4644667">//</span><br>
<span class="lineno"></span><span class="comment" id="4644670">//&nbsp;If&nbsp;DiscardEmptyColumns&nbsp;is&nbsp;set,&nbsp;empty&nbsp;columns&nbsp;that&nbsp;are&nbsp;terminated</span><br>
<span class="lineno">50</span><span class="comment" id="4644738">//&nbsp;entirely&nbsp;by&nbsp;vertical&nbsp;(or&nbsp;&#34;soft&#34;)&nbsp;tabs&nbsp;are&nbsp;discarded.&nbsp;Columns</span><br>
<span class="lineno"></span><span class="comment" id="4644802">//&nbsp;terminated&nbsp;by&nbsp;horizontal&nbsp;(or&nbsp;&#34;hard&#34;)&nbsp;tabs&nbsp;are&nbsp;not&nbsp;affected&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4644867">//&nbsp;this&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="4644881">//</span><br>
<span class="lineno"></span><span class="comment" id="4644884">//&nbsp;If&nbsp;a&nbsp;Writer&nbsp;is&nbsp;configured&nbsp;to&nbsp;filter&nbsp;HTML,&nbsp;HTML&nbsp;tags&nbsp;and&nbsp;entities</span><br>
<span class="lineno">55</span><span class="comment" id="4644952">//&nbsp;are&nbsp;passed&nbsp;through.&nbsp;The&nbsp;widths&nbsp;of&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4645011">//&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;(tags)&nbsp;and&nbsp;one&nbsp;(entities)&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4645084">//</span><br>
<span class="lineno"></span><span class="comment" id="4645087">//&nbsp;A&nbsp;segment&nbsp;of&nbsp;text&nbsp;may&nbsp;be&nbsp;escaped&nbsp;by&nbsp;bracketing&nbsp;it&nbsp;with&nbsp;Escape</span><br>
<span class="lineno"></span><span class="comment" id="4645152">//&nbsp;characters.&nbsp;The&nbsp;tabwriter&nbsp;passes&nbsp;escaped&nbsp;text&nbsp;segments&nbsp;through</span><br>
<span class="lineno">60</span><span class="comment" id="4645218">//&nbsp;unchanged.&nbsp;In&nbsp;particular,&nbsp;it&nbsp;does&nbsp;not&nbsp;interpret&nbsp;any&nbsp;tabs&nbsp;or&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4645286">//&nbsp;breaks&nbsp;within&nbsp;the&nbsp;segment.&nbsp;If&nbsp;the&nbsp;StripEscape&nbsp;flag&nbsp;is&nbsp;set,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4645352">//&nbsp;Escape&nbsp;characters&nbsp;are&nbsp;stripped&nbsp;from&nbsp;the&nbsp;output;&nbsp;otherwise&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="4645418">//&nbsp;are&nbsp;passed&nbsp;through&nbsp;as&nbsp;well.&nbsp;For&nbsp;the&nbsp;purpose&nbsp;of&nbsp;formatting,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4645484">//&nbsp;width&nbsp;of&nbsp;the&nbsp;escaped&nbsp;text&nbsp;is&nbsp;always&nbsp;computed&nbsp;excluding&nbsp;the&nbsp;Escape</span><br>
<span class="lineno">65</span><span class="comment" id="4645553">//&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4645568">//</span><br>
<span class="lineno"></span><span class="comment" id="4645571">//&nbsp;The&nbsp;formfeed&nbsp;character&nbsp;(&#39;\f&#39;)&nbsp;acts&nbsp;like&nbsp;a&nbsp;newline&nbsp;but&nbsp;it&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4645636">//&nbsp;terminates&nbsp;all&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;line&nbsp;(effectively&nbsp;calling</span><br>
<span class="lineno"></span><span class="comment" id="4645703">//&nbsp;Flush).&nbsp;Cells&nbsp;in&nbsp;the&nbsp;next&nbsp;line&nbsp;start&nbsp;new&nbsp;columns.&nbsp;Unless&nbsp;found</span><br>
<span class="lineno">70</span><span class="comment" id="4645769">//&nbsp;inside&nbsp;an&nbsp;HTML&nbsp;tag&nbsp;or&nbsp;inside&nbsp;an&nbsp;escaped&nbsp;text&nbsp;segment,&nbsp;formfeed</span><br>
<span class="lineno"></span><span class="comment" id="4645835">//&nbsp;characters&nbsp;appear&nbsp;as&nbsp;newlines&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4645883">//</span><br>
<span class="lineno"></span><span class="comment" id="4645886">//&nbsp;The&nbsp;Writer&nbsp;must&nbsp;buffer&nbsp;input&nbsp;internally,&nbsp;because&nbsp;proper&nbsp;spacing</span><br>
<span class="lineno"></span><span class="comment" id="4645953">//&nbsp;of&nbsp;one&nbsp;line&nbsp;may&nbsp;depend&nbsp;on&nbsp;the&nbsp;cells&nbsp;in&nbsp;future&nbsp;lines.&nbsp;Clients&nbsp;must</span><br>
<span class="lineno">75</span><span class="comment" id="4646022">//&nbsp;call&nbsp;Flush&nbsp;when&nbsp;done&nbsp;calling&nbsp;Write.</span><br>
<span class="lineno"></span><span class="comment" id="4646061">//</span><br>
<span class="lineno"></span><span class="keyword" id="4646064">type</span>&nbsp;<span class="ident" id="4646069">Writer</span>&nbsp;<span class="keyword" id="4646076">struct</span>&nbsp;<span class="op" id="4646083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646086">//&nbsp;configuration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646104">output</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4646113">io</span><span class="op" id="4646115">.</span><span class="ident" id="4646116">Writer</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646124">minwidth</span>&nbsp;<span class="builtintype" id="4646133">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646138">tabwidth</span>&nbsp;<span class="builtintype" id="4646147">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646152">padding</span>&nbsp;&nbsp;<span class="builtintype" id="4646161">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646166">padbytes</span>&nbsp;<span class="op" id="4646175">[</span><span class="num" id="4646176">8</span><span class="op" id="4646177">]</span><span class="builtintype" id="4646178">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646184">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4646193">uint</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646200">//&nbsp;current&nbsp;state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646218">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646226">bytes</span><span class="op" id="4646231">.</span><span class="ident" id="4646232">Buffer</span>&nbsp;<span class="comment" id="4646239">//&nbsp;collected&nbsp;text&nbsp;excluding&nbsp;tabs&nbsp;or&nbsp;line&nbsp;breaks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646288">pos</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4646296">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646309">//&nbsp;buffer&nbsp;position&nbsp;up&nbsp;to&nbsp;which&nbsp;cell.width&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;has&nbsp;been&nbsp;computed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646389">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646397">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646410">//&nbsp;current&nbsp;incomplete&nbsp;cell;&nbsp;cell.width&nbsp;is&nbsp;up&nbsp;to&nbsp;buf[pos]&nbsp;excluding&nbsp;ignored&nbsp;sections</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646495">endChar</span>&nbsp;<span class="builtintype" id="4646503">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646516">//&nbsp;terminating&nbsp;char&nbsp;of&nbsp;escaped&nbsp;sequence&nbsp;(Escape&nbsp;for&nbsp;escapes,&nbsp;&#39;&gt;&#39;,&nbsp;&#39;;&#39;&nbsp;for&nbsp;HTML&nbsp;tags/entities,&nbsp;or&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646617">lines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4646625">[</span><span class="op" id="4646626">]</span><span class="op" id="4646627">[</span><span class="op" id="4646628">]</span><span class="ident" id="4646629">cell</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646638">//&nbsp;list&nbsp;of&nbsp;lines;&nbsp;each&nbsp;line&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646686">widths</span>&nbsp;&nbsp;<span class="op" id="4646694">[</span><span class="op" id="4646695">]</span><span class="builtintype" id="4646696">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4646707">//&nbsp;list&nbsp;of&nbsp;column&nbsp;widths&nbsp;in&nbsp;runes&nbsp;-&nbsp;re-used&nbsp;during&nbsp;formatting</span><br>
<span class="lineno"></span><span class="op" id="4646769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4646772">func</span>&nbsp;<span class="op" id="4646777">(</span><span class="ident" id="4646778">b</span>&nbsp;<span class="op" id="4646780">*</span><span class="ident" id="4646781">Writer</span><span class="op" id="4646787">)</span>&nbsp;<span class="ident" id="4646789">addLine</span><span class="op" id="4646796">(</span><span class="op" id="4646797">)</span>&nbsp;<span class="op" id="4646799">{</span>&nbsp;<span class="ident" id="4646801">b</span><span class="op" id="4646802">.</span><span class="ident" id="4646803">lines</span>&nbsp;<span class="op" id="4646809">=</span>&nbsp;<span class="builtinfunc" id="4646811">append</span><span class="op" id="4646817">(</span><span class="ident" id="4646818">b</span><span class="op" id="4646819">.</span><span class="ident" id="4646820">lines</span><span class="op" id="4646825">,</span>&nbsp;<span class="op" id="4646827">[</span><span class="op" id="4646828">]</span><span class="ident" id="4646829">cell</span><span class="op" id="4646833">{</span><span class="op" id="4646834">}</span><span class="op" id="4646835">)</span>&nbsp;<span class="op" id="4646837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4646840">//&nbsp;Reset&nbsp;the&nbsp;current&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4646868">func</span>&nbsp;<span class="op" id="4646873">(</span><span class="ident" id="4646874">b</span>&nbsp;<span class="op" id="4646876">*</span><span class="ident" id="4646877">Writer</span><span class="op" id="4646883">)</span>&nbsp;<span class="ident" id="4646885">reset</span><span class="op" id="4646890">(</span><span class="op" id="4646891">)</span>&nbsp;<span class="op" id="4646893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646896">b</span><span class="op" id="4646897">.</span><span class="ident" id="4646898">buf</span><span class="op" id="4646901">.</span><span class="ident" id="4646902">Reset</span><span class="op" id="4646907">(</span><span class="op" id="4646908">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646911">b</span><span class="op" id="4646912">.</span><span class="ident" id="4646913">pos</span>&nbsp;<span class="op" id="4646917">=</span>&nbsp;<span class="num" id="4646919">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646922">b</span><span class="op" id="4646923">.</span><span class="ident" id="4646924">cell</span>&nbsp;<span class="op" id="4646929">=</span>&nbsp;<span class="ident" id="4646931">cell</span><span class="op" id="4646935">{</span><span class="op" id="4646936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646939">b</span><span class="op" id="4646940">.</span><span class="ident" id="4646941">endChar</span>&nbsp;<span class="op" id="4646949">=</span>&nbsp;<span class="num" id="4646951">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646954">b</span><span class="op" id="4646955">.</span><span class="ident" id="4646956">lines</span>&nbsp;<span class="op" id="4646962">=</span>&nbsp;<span class="ident" id="4646964">b</span><span class="op" id="4646965">.</span><span class="ident" id="4646966">lines</span><span class="op" id="4646971">[</span><span class="num" id="4646972">0</span><span class="op" id="4646973">:</span><span class="num" id="4646974">0</span><span class="op" id="4646975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4646978">b</span><span class="op" id="4646979">.</span><span class="ident" id="4646980">widths</span>&nbsp;<span class="op" id="4646987">=</span>&nbsp;<span class="ident" id="4646989">b</span><span class="op" id="4646990">.</span><span class="ident" id="4646991">widths</span><span class="op" id="4646997">[</span><span class="num" id="4646998">0</span><span class="op" id="4646999">:</span><span class="num" id="4647000">0</span><span class="op" id="4647001">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4647004">b</span><span class="op" id="4647005">.</span><span class="ident" id="4647006">addLine</span><span class="op" id="4647013">(</span><span class="op" id="4647014">)</span><br>
<span class="lineno"></span><span class="op" id="4647016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4647019">//&nbsp;Internal&nbsp;representation&nbsp;(current&nbsp;state):</span><br>
<span class="lineno"></span><span class="comment" id="4647063">//</span><br>
<span class="lineno">110</span><span class="comment" id="4647066">//&nbsp;-&nbsp;all&nbsp;text&nbsp;written&nbsp;is&nbsp;appended&nbsp;to&nbsp;buf;&nbsp;tabs&nbsp;and&nbsp;line&nbsp;breaks&nbsp;are&nbsp;stripped&nbsp;away</span><br>
<span class="lineno"></span><span class="comment" id="4647147">//&nbsp;-&nbsp;at&nbsp;any&nbsp;given&nbsp;time&nbsp;there&nbsp;is&nbsp;a&nbsp;(possibly&nbsp;empty)&nbsp;incomplete&nbsp;cell&nbsp;at&nbsp;the&nbsp;end</span><br>
<span class="lineno"></span><span class="comment" id="4647225">//&nbsp;&nbsp;&nbsp;(the&nbsp;cell&nbsp;starts&nbsp;after&nbsp;a&nbsp;tab&nbsp;or&nbsp;line&nbsp;break)</span><br>
<span class="lineno"></span><span class="comment" id="4647274">//&nbsp;-&nbsp;cell.size&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;belonging&nbsp;to&nbsp;the&nbsp;cell&nbsp;so&nbsp;far</span><br>
<span class="lineno"></span><span class="comment" id="4647341">//&nbsp;-&nbsp;cell.width&nbsp;is&nbsp;text&nbsp;width&nbsp;in&nbsp;runes&nbsp;of&nbsp;that&nbsp;cell&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;cell&nbsp;to</span><br>
<span class="lineno">115</span><span class="comment" id="4647423">//&nbsp;&nbsp;&nbsp;position&nbsp;pos;&nbsp;html&nbsp;tags&nbsp;and&nbsp;entities&nbsp;are&nbsp;excluded&nbsp;from&nbsp;this&nbsp;width&nbsp;if&nbsp;html</span><br>
<span class="lineno"></span><span class="comment" id="4647502">//&nbsp;&nbsp;&nbsp;filtering&nbsp;is&nbsp;enabled</span><br>
<span class="lineno"></span><span class="comment" id="4647528">//&nbsp;-&nbsp;the&nbsp;sizes&nbsp;and&nbsp;widths&nbsp;of&nbsp;processed&nbsp;text&nbsp;are&nbsp;kept&nbsp;in&nbsp;the&nbsp;lines&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="4647599">//&nbsp;&nbsp;&nbsp;which&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;cells&nbsp;for&nbsp;each&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4647649">//&nbsp;-&nbsp;the&nbsp;widths&nbsp;list&nbsp;is&nbsp;a&nbsp;temporary&nbsp;list&nbsp;with&nbsp;current&nbsp;widths&nbsp;used&nbsp;during</span><br>
<span class="lineno">120</span><span class="comment" id="4647722">//&nbsp;&nbsp;&nbsp;formatting;&nbsp;it&nbsp;is&nbsp;kept&nbsp;in&nbsp;Writer&nbsp;because&nbsp;it&#39;s&nbsp;re-used</span><br>
<span class="lineno"></span><span class="comment" id="4647781">//</span><br>
<span class="lineno"></span><span class="comment" id="4647784">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;----------&nbsp;size&nbsp;----------&gt;|</span><br>
<span class="lineno"></span><span class="comment" id="4647837">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4647890">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&lt;-&nbsp;width&nbsp;-&gt;|&lt;-&nbsp;ignored&nbsp;-&gt;|&nbsp;&nbsp;|</span><br>
<span class="lineno">125</span><span class="comment" id="4647943">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4647996">//&nbsp;[---processed---tab------------&lt;tag&gt;...&lt;/tag&gt;...]</span><br>
<span class="lineno"></span><span class="comment" id="4648049">//&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^</span><br>
<span class="lineno"></span><span class="comment" id="4648099">//&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span><br>
<span class="lineno"></span><span class="comment" id="4648149">//&nbsp;buf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start&nbsp;of&nbsp;incomplete&nbsp;cell&nbsp;&nbsp;pos</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4648202">//&nbsp;Formatting&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;these&nbsp;flags.</span><br>
<span class="lineno"></span><span class="keyword" id="4648252">const</span>&nbsp;<span class="op" id="4648258">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648261">//&nbsp;Ignore&nbsp;html&nbsp;tags&nbsp;and&nbsp;treat&nbsp;entities&nbsp;(starting&nbsp;with&nbsp;&#39;&amp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648320">//&nbsp;and&nbsp;ending&nbsp;in&nbsp;&#39;;&#39;)&nbsp;as&nbsp;single&nbsp;characters&nbsp;(width&nbsp;=&nbsp;1).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4648377">FilterHTML</span>&nbsp;<span class="builtintype" id="4648388">uint</span>&nbsp;<span class="op" id="4648393">=</span>&nbsp;<span class="num" id="4648395">1</span>&nbsp;<span class="op" id="4648397">&lt;&lt;</span>&nbsp;<span class="ident" id="4648400">iota</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648407">//&nbsp;Strip&nbsp;Escape&nbsp;characters&nbsp;bracketing&nbsp;escaped&nbsp;text&nbsp;segments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648468">//&nbsp;instead&nbsp;of&nbsp;passing&nbsp;them&nbsp;through&nbsp;unchanged&nbsp;with&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4648529">StripEscape</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648543">//&nbsp;Force&nbsp;right-alignment&nbsp;of&nbsp;cell&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648586">//&nbsp;Default&nbsp;is&nbsp;left-alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4648617">AlignRight</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648630">//&nbsp;Handle&nbsp;empty&nbsp;columns&nbsp;as&nbsp;if&nbsp;they&nbsp;were&nbsp;not&nbsp;present&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648686">//&nbsp;the&nbsp;input&nbsp;in&nbsp;the&nbsp;first&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4648720">DiscardEmptyColumns</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648742">//&nbsp;Always&nbsp;use&nbsp;tabs&nbsp;for&nbsp;indentation&nbsp;columns&nbsp;(i.e.,&nbsp;padding&nbsp;of</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648804">//&nbsp;leading&nbsp;empty&nbsp;cells&nbsp;on&nbsp;the&nbsp;left)&nbsp;independent&nbsp;of&nbsp;padchar.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4648865">TabIndent</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648877">//&nbsp;Print&nbsp;a&nbsp;vertical&nbsp;bar&nbsp;(&#39;|&#39;)&nbsp;between&nbsp;columns&nbsp;(after&nbsp;formatting).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4648944">//&nbsp;Discarded&nbsp;columns&nbsp;appear&nbsp;as&nbsp;zero-width&nbsp;columns&nbsp;(&#34;||&#34;).</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4649003">Debug</span><br>
<span class="lineno"></span><span class="op" id="4649009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4649012">//&nbsp;A&nbsp;Writer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Init.&nbsp;The&nbsp;first&nbsp;parameter&nbsp;(output)</span><br>
<span class="lineno"></span><span class="comment" id="4649094">//&nbsp;specifies&nbsp;the&nbsp;filter&nbsp;output.&nbsp;The&nbsp;remaining&nbsp;parameters&nbsp;control&nbsp;the&nbsp;formatting:</span><br>
<span class="lineno">160</span><span class="comment" id="4649175">//</span><br>
<span class="lineno"></span><span class="comment" id="4649178">//&nbsp;&nbsp;&nbsp;&nbsp;minwidth&nbsp;&nbsp;&nbsp;&nbsp;minimal&nbsp;cell&nbsp;width&nbsp;including&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span><span class="comment" id="4649231">//&nbsp;&nbsp;&nbsp;&nbsp;tabwidth&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;of&nbsp;tab&nbsp;characters&nbsp;(equivalent&nbsp;number&nbsp;of&nbsp;spaces)</span><br>
<span class="lineno"></span><span class="comment" id="4649297">//&nbsp;&nbsp;&nbsp;&nbsp;padding&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;padding&nbsp;added&nbsp;to&nbsp;a&nbsp;cell&nbsp;before&nbsp;computing&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4649360">//&nbsp;&nbsp;&nbsp;&nbsp;padchar&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ASCII&nbsp;char&nbsp;used&nbsp;for&nbsp;padding</span><br>
<span class="lineno">165</span><span class="comment" id="4649400">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;padchar&nbsp;==&nbsp;&#39;\t&#39;,&nbsp;the&nbsp;Writer&nbsp;will&nbsp;assume&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4649457">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;of&nbsp;a&nbsp;&#39;\t&#39;&nbsp;in&nbsp;the&nbsp;formatted&nbsp;output&nbsp;is&nbsp;tabwidth,</span><br>
<span class="lineno"></span><span class="comment" id="4649515">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;cells&nbsp;are&nbsp;left-aligned&nbsp;independent&nbsp;of&nbsp;align_left</span><br>
<span class="lineno"></span><span class="comment" id="4649573">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(for&nbsp;correct-looking&nbsp;results,&nbsp;tabwidth&nbsp;must&nbsp;correspond</span><br>
<span class="lineno"></span><span class="comment" id="4649633">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;tab&nbsp;width&nbsp;in&nbsp;the&nbsp;viewer&nbsp;displaying&nbsp;the&nbsp;result)</span><br>
<span class="lineno">170</span><span class="comment" id="4649692">//&nbsp;&nbsp;&nbsp;&nbsp;flags&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatting&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="4649721">//</span><br>
<span class="lineno"></span><span class="keyword" id="4649724">func</span>&nbsp;<span class="op" id="4649729">(</span><span class="ident" id="4649730">b</span>&nbsp;<span class="op" id="4649732">*</span><span class="ident" id="4649733">Writer</span><span class="op" id="4649739">)</span>&nbsp;<span class="ident" id="4649741">Init</span><span class="op" id="4649745">(</span><span class="ident" id="4649746">output</span>&nbsp;<span class="ident" id="4649753">io</span><span class="op" id="4649755">.</span><span class="ident" id="4649756">Writer</span><span class="op" id="4649762">,</span>&nbsp;<span class="ident" id="4649764">minwidth</span><span class="op" id="4649772">,</span>&nbsp;<span class="ident" id="4649774">tabwidth</span><span class="op" id="4649782">,</span>&nbsp;<span class="ident" id="4649784">padding</span>&nbsp;<span class="builtintype" id="4649792">int</span><span class="op" id="4649795">,</span>&nbsp;<span class="ident" id="4649797">padchar</span>&nbsp;<span class="builtintype" id="4649805">byte</span><span class="op" id="4649809">,</span>&nbsp;<span class="ident" id="4649811">flags</span>&nbsp;<span class="builtintype" id="4649817">uint</span><span class="op" id="4649821">)</span>&nbsp;<span class="op" id="4649823">*</span><span class="ident" id="4649824">Writer</span>&nbsp;<span class="op" id="4649831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4649834">if</span>&nbsp;<span class="ident" id="4649837">minwidth</span>&nbsp;<span class="op" id="4649846">&lt;</span>&nbsp;<span class="num" id="4649848">0</span>&nbsp;<span class="op" id="4649850">||</span>&nbsp;<span class="ident" id="4649853">tabwidth</span>&nbsp;<span class="op" id="4649862">&lt;</span>&nbsp;<span class="num" id="4649864">0</span>&nbsp;<span class="op" id="4649866">||</span>&nbsp;<span class="ident" id="4649869">padding</span>&nbsp;<span class="op" id="4649877">&lt;</span>&nbsp;<span class="num" id="4649879">0</span>&nbsp;<span class="op" id="4649881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4649885">panic</span><span class="op" id="4649890">(</span><span class="string" id="4649891">&#34;negative&nbsp;minwidth,&nbsp;tabwidth,&nbsp;or&nbsp;padding&#34;</span><span class="op" id="4649932">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4649935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4649938">b</span><span class="op" id="4649939">.</span><span class="ident" id="4649940">output</span>&nbsp;<span class="op" id="4649947">=</span>&nbsp;<span class="ident" id="4649949">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4649957">b</span><span class="op" id="4649958">.</span><span class="ident" id="4649959">minwidth</span>&nbsp;<span class="op" id="4649968">=</span>&nbsp;<span class="ident" id="4649970">minwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4649980">b</span><span class="op" id="4649981">.</span><span class="ident" id="4649982">tabwidth</span>&nbsp;<span class="op" id="4649991">=</span>&nbsp;<span class="ident" id="4649993">tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650003">b</span><span class="op" id="4650004">.</span><span class="ident" id="4650005">padding</span>&nbsp;<span class="op" id="4650013">=</span>&nbsp;<span class="ident" id="4650015">padding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650024">for</span>&nbsp;<span class="ident" id="4650028">i</span>&nbsp;<span class="op" id="4650030">:=</span>&nbsp;<span class="keyword" id="4650033">range</span>&nbsp;<span class="ident" id="4650039">b</span><span class="op" id="4650040">.</span><span class="ident" id="4650041">padbytes</span>&nbsp;<span class="op" id="4650050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650054">b</span><span class="op" id="4650055">.</span><span class="ident" id="4650056">padbytes</span><span class="op" id="4650064">[</span><span class="ident" id="4650065">i</span><span class="op" id="4650066">]</span>&nbsp;<span class="op" id="4650068">=</span>&nbsp;<span class="ident" id="4650070">padchar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650082">if</span>&nbsp;<span class="ident" id="4650085">padchar</span>&nbsp;<span class="op" id="4650093">==</span>&nbsp;<span class="string" id="4650096">&#39;\t&#39;</span>&nbsp;<span class="op" id="4650101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4650105">//&nbsp;tab&nbsp;padding&nbsp;enforces&nbsp;left-alignment</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650146">flags</span>&nbsp;<span class="op" id="4650152">&amp;^=</span>&nbsp;<span class="ident" id="4650156">AlignRight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650171">b</span><span class="op" id="4650172">.</span><span class="ident" id="4650173">flags</span>&nbsp;<span class="op" id="4650179">=</span>&nbsp;<span class="ident" id="4650181">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650189">b</span><span class="op" id="4650190">.</span><span class="ident" id="4650191">reset</span><span class="op" id="4650196">(</span><span class="op" id="4650197">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650201">return</span>&nbsp;<span class="ident" id="4650208">b</span><br>
<span class="lineno"></span><span class="op" id="4650210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4650213">//&nbsp;debugging&nbsp;support&nbsp;(keep&nbsp;code&nbsp;around)</span><br>
<span class="lineno">195</span><span class="keyword" id="4650253">func</span>&nbsp;<span class="op" id="4650258">(</span><span class="ident" id="4650259">b</span>&nbsp;<span class="op" id="4650261">*</span><span class="ident" id="4650262">Writer</span><span class="op" id="4650268">)</span>&nbsp;<span class="ident" id="4650270">dump</span><span class="op" id="4650274">(</span><span class="op" id="4650275">)</span>&nbsp;<span class="op" id="4650277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650280">pos</span>&nbsp;<span class="op" id="4650284">:=</span>&nbsp;<span class="num" id="4650287">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650290">for</span>&nbsp;<span class="ident" id="4650294">i</span><span class="op" id="4650295">,</span>&nbsp;<span class="ident" id="4650297">line</span>&nbsp;<span class="op" id="4650302">:=</span>&nbsp;<span class="keyword" id="4650305">range</span>&nbsp;<span class="ident" id="4650311">b</span><span class="op" id="4650312">.</span><span class="ident" id="4650313">lines</span>&nbsp;<span class="op" id="4650319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4650323">print</span><span class="op" id="4650328">(</span><span class="string" id="4650329">&#34;(&#34;</span><span class="op" id="4650332">,</span>&nbsp;<span class="ident" id="4650334">i</span><span class="op" id="4650335">,</span>&nbsp;<span class="string" id="4650337">&#34;)&nbsp;&#34;</span><span class="op" id="4650341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650345">for</span>&nbsp;<span class="ident" id="4650349">_</span><span class="op" id="4650350">,</span>&nbsp;<span class="ident" id="4650352">c</span>&nbsp;<span class="op" id="4650354">:=</span>&nbsp;<span class="keyword" id="4650357">range</span>&nbsp;<span class="ident" id="4650363">line</span>&nbsp;<span class="op" id="4650368">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4650373">print</span><span class="op" id="4650378">(</span><span class="string" id="4650379">&#34;[&#34;</span><span class="op" id="4650382">,</span>&nbsp;<span class="builtintype" id="4650384">string</span><span class="op" id="4650390">(</span><span class="ident" id="4650391">b</span><span class="op" id="4650392">.</span><span class="ident" id="4650393">buf</span><span class="op" id="4650396">.</span><span class="ident" id="4650397">Bytes</span><span class="op" id="4650402">(</span><span class="op" id="4650403">)</span><span class="op" id="4650404">[</span><span class="ident" id="4650405">pos</span><span class="op" id="4650408">:</span><span class="ident" id="4650409">pos</span><span class="op" id="4650412">+</span><span class="ident" id="4650413">c</span><span class="op" id="4650414">.</span><span class="ident" id="4650415">size</span><span class="op" id="4650419">]</span><span class="op" id="4650420">)</span><span class="op" id="4650421">,</span>&nbsp;<span class="string" id="4650423">&#34;]&#34;</span><span class="op" id="4650426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650431">pos</span>&nbsp;<span class="op" id="4650435">+=</span>&nbsp;<span class="ident" id="4650438">c</span><span class="op" id="4650439">.</span><span class="ident" id="4650440">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4650451">print</span><span class="op" id="4650456">(</span><span class="string" id="4650457">&#34;\n&#34;</span><span class="op" id="4650461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650464">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4650467">print</span><span class="op" id="4650472">(</span><span class="string" id="4650473">&#34;\n&#34;</span><span class="op" id="4650477">)</span><br>
<span class="lineno"></span><span class="op" id="4650479">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4650482">//&nbsp;local&nbsp;error&nbsp;wrapper&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish&nbsp;errors&nbsp;we&nbsp;want&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4650552">//&nbsp;as&nbsp;errors&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;(which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors)</span><br>
<span class="lineno">210</span><span class="keyword" id="4650627">type</span>&nbsp;<span class="ident" id="4650632">osError</span>&nbsp;<span class="keyword" id="4650640">struct</span>&nbsp;<span class="op" id="4650647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650650">err</span>&nbsp;<span class="builtintype" id="4650654">error</span><br>
<span class="lineno"></span><span class="op" id="4650660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4650663">func</span>&nbsp;<span class="op" id="4650668">(</span><span class="ident" id="4650669">b</span>&nbsp;<span class="op" id="4650671">*</span><span class="ident" id="4650672">Writer</span><span class="op" id="4650678">)</span>&nbsp;<span class="ident" id="4650680">write0</span><span class="op" id="4650686">(</span><span class="ident" id="4650687">buf</span>&nbsp;<span class="op" id="4650691">[</span><span class="op" id="4650692">]</span><span class="builtintype" id="4650693">byte</span><span class="op" id="4650697">)</span>&nbsp;<span class="op" id="4650699">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650702">n</span><span class="op" id="4650703">,</span>&nbsp;<span class="ident" id="4650705">err</span>&nbsp;<span class="op" id="4650709">:=</span>&nbsp;<span class="ident" id="4650712">b</span><span class="op" id="4650713">.</span><span class="ident" id="4650714">output</span><span class="op" id="4650720">.</span><span class="ident" id="4650721">Write</span><span class="op" id="4650726">(</span><span class="ident" id="4650727">buf</span><span class="op" id="4650730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650733">if</span>&nbsp;<span class="ident" id="4650736">n</span>&nbsp;<span class="op" id="4650738">!=</span>&nbsp;<span class="builtinfunc" id="4650741">len</span><span class="op" id="4650744">(</span><span class="ident" id="4650745">buf</span><span class="op" id="4650748">)</span>&nbsp;<span class="op" id="4650750">&amp;&amp;</span>&nbsp;<span class="ident" id="4650753">err</span>&nbsp;<span class="op" id="4650757">==</span>&nbsp;<span class="builtintype" id="4650760">nil</span>&nbsp;<span class="op" id="4650764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650768">err</span>&nbsp;<span class="op" id="4650772">=</span>&nbsp;<span class="ident" id="4650774">io</span><span class="op" id="4650776">.</span><span class="ident" id="4650777">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650795">if</span>&nbsp;<span class="ident" id="4650798">err</span>&nbsp;<span class="op" id="4650802">!=</span>&nbsp;<span class="builtintype" id="4650805">nil</span>&nbsp;<span class="op" id="4650809">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4650813">panic</span><span class="op" id="4650818">(</span><span class="ident" id="4650819">osError</span><span class="op" id="4650826">{</span><span class="ident" id="4650827">err</span><span class="op" id="4650830">}</span><span class="op" id="4650831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650834">}</span><br>
<span class="lineno"></span><span class="op" id="4650836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4650839">func</span>&nbsp;<span class="op" id="4650844">(</span><span class="ident" id="4650845">b</span>&nbsp;<span class="op" id="4650847">*</span><span class="ident" id="4650848">Writer</span><span class="op" id="4650854">)</span>&nbsp;<span class="ident" id="4650856">writeN</span><span class="op" id="4650862">(</span><span class="ident" id="4650863">src</span>&nbsp;<span class="op" id="4650867">[</span><span class="op" id="4650868">]</span><span class="builtintype" id="4650869">byte</span><span class="op" id="4650873">,</span>&nbsp;<span class="ident" id="4650875">n</span>&nbsp;<span class="builtintype" id="4650877">int</span><span class="op" id="4650880">)</span>&nbsp;<span class="op" id="4650882">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4650885">for</span>&nbsp;<span class="ident" id="4650889">n</span>&nbsp;<span class="op" id="4650891">&gt;</span>&nbsp;<span class="builtinfunc" id="4650893">len</span><span class="op" id="4650896">(</span><span class="ident" id="4650897">src</span><span class="op" id="4650900">)</span>&nbsp;<span class="op" id="4650902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650906">b</span><span class="op" id="4650907">.</span><span class="ident" id="4650908">write0</span><span class="op" id="4650914">(</span><span class="ident" id="4650915">src</span><span class="op" id="4650918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650922">n</span>&nbsp;<span class="op" id="4650924">-=</span>&nbsp;<span class="builtinfunc" id="4650927">len</span><span class="op" id="4650930">(</span><span class="ident" id="4650931">src</span><span class="op" id="4650934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4650937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650940">b</span><span class="op" id="4650941">.</span><span class="ident" id="4650942">write0</span><span class="op" id="4650948">(</span><span class="ident" id="4650949">src</span><span class="op" id="4650952">[</span><span class="num" id="4650953">0</span><span class="op" id="4650954">:</span><span class="ident" id="4650955">n</span><span class="op" id="4650956">]</span><span class="op" id="4650957">)</span><br>
<span class="lineno">230</span><span class="op" id="4650959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4650962">var</span>&nbsp;<span class="op" id="4650966">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650969">newline</span>&nbsp;<span class="op" id="4650977">=</span>&nbsp;<span class="op" id="4650979">[</span><span class="op" id="4650980">]</span><span class="builtintype" id="4650981">byte</span><span class="op" id="4650985">{</span><span class="string" id="4650986">&#39;\n&#39;</span><span class="op" id="4650990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4650993">tabs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4651001">=</span>&nbsp;<span class="op" id="4651003">[</span><span class="op" id="4651004">]</span><span class="builtintype" id="4651005">byte</span><span class="op" id="4651009">(</span><span class="string" id="4651010">&#34;\t\t\t\t\t\t\t\t&#34;</span><span class="op" id="4651028">)</span><br>
<span class="lineno">235</span><span class="op" id="4651030">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4651033">func</span>&nbsp;<span class="op" id="4651038">(</span><span class="ident" id="4651039">b</span>&nbsp;<span class="op" id="4651041">*</span><span class="ident" id="4651042">Writer</span><span class="op" id="4651048">)</span>&nbsp;<span class="ident" id="4651050">writePadding</span><span class="op" id="4651062">(</span><span class="ident" id="4651063">textw</span><span class="op" id="4651068">,</span>&nbsp;<span class="ident" id="4651070">cellw</span>&nbsp;<span class="builtintype" id="4651076">int</span><span class="op" id="4651079">,</span>&nbsp;<span class="ident" id="4651081">useTabs</span>&nbsp;<span class="builtintype" id="4651089">bool</span><span class="op" id="4651093">)</span>&nbsp;<span class="op" id="4651095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651098">if</span>&nbsp;<span class="ident" id="4651101">b</span><span class="op" id="4651102">.</span><span class="ident" id="4651103">padbytes</span><span class="op" id="4651111">[</span><span class="num" id="4651112">0</span><span class="op" id="4651113">]</span>&nbsp;<span class="op" id="4651115">==</span>&nbsp;<span class="string" id="4651118">&#39;\t&#39;</span>&nbsp;<span class="op" id="4651123">||</span>&nbsp;<span class="ident" id="4651126">useTabs</span>&nbsp;<span class="op" id="4651134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4651138">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;tabs</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651169">if</span>&nbsp;<span class="ident" id="4651172">b</span><span class="op" id="4651173">.</span><span class="ident" id="4651174">tabwidth</span>&nbsp;<span class="op" id="4651183">==</span>&nbsp;<span class="num" id="4651186">0</span>&nbsp;<span class="op" id="4651188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651193">return</span>&nbsp;<span class="comment" id="4651200">//&nbsp;tabs&nbsp;have&nbsp;no&nbsp;width&nbsp;-&nbsp;can&#39;t&nbsp;do&nbsp;any&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4651247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4651251">//&nbsp;make&nbsp;cellw&nbsp;the&nbsp;smallest&nbsp;multiple&nbsp;of&nbsp;b.tabwidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651303">cellw</span>&nbsp;<span class="op" id="4651309">=</span>&nbsp;<span class="op" id="4651311">(</span><span class="ident" id="4651312">cellw</span>&nbsp;<span class="op" id="4651318">+</span>&nbsp;<span class="ident" id="4651320">b</span><span class="op" id="4651321">.</span><span class="ident" id="4651322">tabwidth</span>&nbsp;<span class="op" id="4651331">-</span>&nbsp;<span class="num" id="4651333">1</span><span class="op" id="4651334">)</span>&nbsp;<span class="op" id="4651336">/</span>&nbsp;<span class="ident" id="4651338">b</span><span class="op" id="4651339">.</span><span class="ident" id="4651340">tabwidth</span>&nbsp;<span class="op" id="4651349">*</span>&nbsp;<span class="ident" id="4651351">b</span><span class="op" id="4651352">.</span><span class="ident" id="4651353">tabwidth</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651364">n</span>&nbsp;<span class="op" id="4651366">:=</span>&nbsp;<span class="ident" id="4651369">cellw</span>&nbsp;<span class="op" id="4651375">-</span>&nbsp;<span class="ident" id="4651377">textw</span>&nbsp;<span class="comment" id="4651383">//&nbsp;amount&nbsp;of&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651406">if</span>&nbsp;<span class="ident" id="4651409">n</span>&nbsp;<span class="op" id="4651411">&lt;</span>&nbsp;<span class="num" id="4651413">0</span>&nbsp;<span class="op" id="4651415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4651420">panic</span><span class="op" id="4651425">(</span><span class="string" id="4651426">&#34;internal&nbsp;error&#34;</span><span class="op" id="4651442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4651446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651450">b</span><span class="op" id="4651451">.</span><span class="ident" id="4651452">writeN</span><span class="op" id="4651458">(</span><span class="ident" id="4651459">tabs</span><span class="op" id="4651463">,</span>&nbsp;<span class="op" id="4651465">(</span><span class="ident" id="4651466">n</span><span class="op" id="4651467">+</span><span class="ident" id="4651468">b</span><span class="op" id="4651469">.</span><span class="ident" id="4651470">tabwidth</span><span class="op" id="4651478">-</span><span class="num" id="4651479">1</span><span class="op" id="4651480">)</span><span class="op" id="4651481">/</span><span class="ident" id="4651482">b</span><span class="op" id="4651483">.</span><span class="ident" id="4651484">tabwidth</span><span class="op" id="4651492">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651496">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4651504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4651508">//&nbsp;padding&nbsp;is&nbsp;done&nbsp;with&nbsp;non-tab&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651552">b</span><span class="op" id="4651553">.</span><span class="ident" id="4651554">writeN</span><span class="op" id="4651560">(</span><span class="ident" id="4651561">b</span><span class="op" id="4651562">.</span><span class="ident" id="4651563">padbytes</span><span class="op" id="4651571">[</span><span class="num" id="4651572">0</span><span class="op" id="4651573">:</span><span class="op" id="4651574">]</span><span class="op" id="4651575">,</span>&nbsp;<span class="ident" id="4651577">cellw</span><span class="op" id="4651582">-</span><span class="ident" id="4651583">textw</span><span class="op" id="4651588">)</span><br>
<span class="lineno">255</span><span class="op" id="4651590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4651593">var</span>&nbsp;<span class="ident" id="4651597">vbar</span>&nbsp;<span class="op" id="4651602">=</span>&nbsp;<span class="op" id="4651604">[</span><span class="op" id="4651605">]</span><span class="builtintype" id="4651606">byte</span><span class="op" id="4651610">{</span><span class="string" id="4651611">&#39;|&#39;</span><span class="op" id="4651614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4651617">func</span>&nbsp;<span class="op" id="4651622">(</span><span class="ident" id="4651623">b</span>&nbsp;<span class="op" id="4651625">*</span><span class="ident" id="4651626">Writer</span><span class="op" id="4651632">)</span>&nbsp;<span class="ident" id="4651634">writeLines</span><span class="op" id="4651644">(</span><span class="ident" id="4651645">pos0</span>&nbsp;<span class="builtintype" id="4651650">int</span><span class="op" id="4651653">,</span>&nbsp;<span class="ident" id="4651655">line0</span><span class="op" id="4651660">,</span>&nbsp;<span class="ident" id="4651662">line1</span>&nbsp;<span class="builtintype" id="4651668">int</span><span class="op" id="4651671">)</span>&nbsp;<span class="op" id="4651673">(</span><span class="ident" id="4651674">pos</span>&nbsp;<span class="builtintype" id="4651678">int</span><span class="op" id="4651681">)</span>&nbsp;<span class="op" id="4651683">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651686">pos</span>&nbsp;<span class="op" id="4651690">=</span>&nbsp;<span class="ident" id="4651692">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651698">for</span>&nbsp;<span class="ident" id="4651702">i</span>&nbsp;<span class="op" id="4651704">:=</span>&nbsp;<span class="ident" id="4651707">line0</span><span class="op" id="4651712">;</span>&nbsp;<span class="ident" id="4651714">i</span>&nbsp;<span class="op" id="4651716">&lt;</span>&nbsp;<span class="ident" id="4651718">line1</span><span class="op" id="4651723">;</span>&nbsp;<span class="ident" id="4651725">i</span><span class="op" id="4651726">++</span>&nbsp;<span class="op" id="4651729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651733">line</span>&nbsp;<span class="op" id="4651738">:=</span>&nbsp;<span class="ident" id="4651741">b</span><span class="op" id="4651742">.</span><span class="ident" id="4651743">lines</span><span class="op" id="4651748">[</span><span class="ident" id="4651749">i</span><span class="op" id="4651750">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4651755">//&nbsp;if&nbsp;TabIndent&nbsp;is&nbsp;set,&nbsp;use&nbsp;tabs&nbsp;to&nbsp;pad&nbsp;leading&nbsp;empty&nbsp;cells</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651817">useTabs</span>&nbsp;<span class="op" id="4651825">:=</span>&nbsp;<span class="ident" id="4651828">b</span><span class="op" id="4651829">.</span><span class="ident" id="4651830">flags</span><span class="op" id="4651835">&amp;</span><span class="ident" id="4651836">TabIndent</span>&nbsp;<span class="op" id="4651846">!=</span>&nbsp;<span class="num" id="4651849">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651854">for</span>&nbsp;<span class="ident" id="4651858">j</span><span class="op" id="4651859">,</span>&nbsp;<span class="ident" id="4651861">c</span>&nbsp;<span class="op" id="4651863">:=</span>&nbsp;<span class="keyword" id="4651866">range</span>&nbsp;<span class="ident" id="4651872">line</span>&nbsp;<span class="op" id="4651877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651882">if</span>&nbsp;<span class="ident" id="4651885">j</span>&nbsp;<span class="op" id="4651887">&gt;</span>&nbsp;<span class="num" id="4651889">0</span>&nbsp;<span class="op" id="4651891">&amp;&amp;</span>&nbsp;<span class="ident" id="4651894">b</span><span class="op" id="4651895">.</span><span class="ident" id="4651896">flags</span><span class="op" id="4651901">&amp;</span><span class="ident" id="4651902">Debug</span>&nbsp;<span class="op" id="4651908">!=</span>&nbsp;<span class="num" id="4651911">0</span>&nbsp;<span class="op" id="4651913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4651919">//&nbsp;indicate&nbsp;column&nbsp;break</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4651948">b</span><span class="op" id="4651949">.</span><span class="ident" id="4651950">write0</span><span class="op" id="4651956">(</span><span class="ident" id="4651957">vbar</span><span class="op" id="4651961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4651966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4651972">if</span>&nbsp;<span class="ident" id="4651975">c</span><span class="op" id="4651976">.</span><span class="ident" id="4651977">size</span>&nbsp;<span class="op" id="4651982">==</span>&nbsp;<span class="num" id="4651985">0</span>&nbsp;<span class="op" id="4651987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4651993">//&nbsp;empty&nbsp;cell</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4652011">if</span>&nbsp;<span class="ident" id="4652014">j</span>&nbsp;<span class="op" id="4652016">&lt;</span>&nbsp;<span class="builtinfunc" id="4652018">len</span><span class="op" id="4652021">(</span><span class="ident" id="4652022">b</span><span class="op" id="4652023">.</span><span class="ident" id="4652024">widths</span><span class="op" id="4652030">)</span>&nbsp;<span class="op" id="4652032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652039">b</span><span class="op" id="4652040">.</span><span class="ident" id="4652041">writePadding</span><span class="op" id="4652053">(</span><span class="ident" id="4652054">c</span><span class="op" id="4652055">.</span><span class="ident" id="4652056">width</span><span class="op" id="4652061">,</span>&nbsp;<span class="ident" id="4652063">b</span><span class="op" id="4652064">.</span><span class="ident" id="4652065">widths</span><span class="op" id="4652071">[</span><span class="ident" id="4652072">j</span><span class="op" id="4652073">]</span><span class="op" id="4652074">,</span>&nbsp;<span class="ident" id="4652076">useTabs</span><span class="op" id="4652083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652094">}</span>&nbsp;<span class="keyword" id="4652096">else</span>&nbsp;<span class="op" id="4652101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4652107">//&nbsp;non-empty&nbsp;cell</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652129">useTabs</span>&nbsp;<span class="op" id="4652137">=</span>&nbsp;<span class="builtintype" id="4652139">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4652149">if</span>&nbsp;<span class="ident" id="4652152">b</span><span class="op" id="4652153">.</span><span class="ident" id="4652154">flags</span><span class="op" id="4652159">&amp;</span><span class="ident" id="4652160">AlignRight</span>&nbsp;<span class="op" id="4652171">==</span>&nbsp;<span class="num" id="4652174">0</span>&nbsp;<span class="op" id="4652176">{</span>&nbsp;<span class="comment" id="4652178">//&nbsp;align&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652197">b</span><span class="op" id="4652198">.</span><span class="ident" id="4652199">write0</span><span class="op" id="4652205">(</span><span class="ident" id="4652206">b</span><span class="op" id="4652207">.</span><span class="ident" id="4652208">buf</span><span class="op" id="4652211">.</span><span class="ident" id="4652212">Bytes</span><span class="op" id="4652217">(</span><span class="op" id="4652218">)</span><span class="op" id="4652219">[</span><span class="ident" id="4652220">pos</span>&nbsp;<span class="op" id="4652224">:</span>&nbsp;<span class="ident" id="4652226">pos</span><span class="op" id="4652229">+</span><span class="ident" id="4652230">c</span><span class="op" id="4652231">.</span><span class="ident" id="4652232">size</span><span class="op" id="4652236">]</span><span class="op" id="4652237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652244">pos</span>&nbsp;<span class="op" id="4652248">+=</span>&nbsp;<span class="ident" id="4652251">c</span><span class="op" id="4652252">.</span><span class="ident" id="4652253">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4652263">if</span>&nbsp;<span class="ident" id="4652266">j</span>&nbsp;<span class="op" id="4652268">&lt;</span>&nbsp;<span class="builtinfunc" id="4652270">len</span><span class="op" id="4652273">(</span><span class="ident" id="4652274">b</span><span class="op" id="4652275">.</span><span class="ident" id="4652276">widths</span><span class="op" id="4652282">)</span>&nbsp;<span class="op" id="4652284">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652292">b</span><span class="op" id="4652293">.</span><span class="ident" id="4652294">writePadding</span><span class="op" id="4652306">(</span><span class="ident" id="4652307">c</span><span class="op" id="4652308">.</span><span class="ident" id="4652309">width</span><span class="op" id="4652314">,</span>&nbsp;<span class="ident" id="4652316">b</span><span class="op" id="4652317">.</span><span class="ident" id="4652318">widths</span><span class="op" id="4652324">[</span><span class="ident" id="4652325">j</span><span class="op" id="4652326">]</span><span class="op" id="4652327">,</span>&nbsp;<span class="builtintype" id="4652329">false</span><span class="op" id="4652334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652347">}</span>&nbsp;<span class="keyword" id="4652349">else</span>&nbsp;<span class="op" id="4652354">{</span>&nbsp;<span class="comment" id="4652356">//&nbsp;align&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4652376">if</span>&nbsp;<span class="ident" id="4652379">j</span>&nbsp;<span class="op" id="4652381">&lt;</span>&nbsp;<span class="builtinfunc" id="4652383">len</span><span class="op" id="4652386">(</span><span class="ident" id="4652387">b</span><span class="op" id="4652388">.</span><span class="ident" id="4652389">widths</span><span class="op" id="4652395">)</span>&nbsp;<span class="op" id="4652397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652405">b</span><span class="op" id="4652406">.</span><span class="ident" id="4652407">writePadding</span><span class="op" id="4652419">(</span><span class="ident" id="4652420">c</span><span class="op" id="4652421">.</span><span class="ident" id="4652422">width</span><span class="op" id="4652427">,</span>&nbsp;<span class="ident" id="4652429">b</span><span class="op" id="4652430">.</span><span class="ident" id="4652431">widths</span><span class="op" id="4652437">[</span><span class="ident" id="4652438">j</span><span class="op" id="4652439">]</span><span class="op" id="4652440">,</span>&nbsp;<span class="builtintype" id="4652442">false</span><span class="op" id="4652447">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652461">b</span><span class="op" id="4652462">.</span><span class="ident" id="4652463">write0</span><span class="op" id="4652469">(</span><span class="ident" id="4652470">b</span><span class="op" id="4652471">.</span><span class="ident" id="4652472">buf</span><span class="op" id="4652475">.</span><span class="ident" id="4652476">Bytes</span><span class="op" id="4652481">(</span><span class="op" id="4652482">)</span><span class="op" id="4652483">[</span><span class="ident" id="4652484">pos</span>&nbsp;<span class="op" id="4652488">:</span>&nbsp;<span class="ident" id="4652490">pos</span><span class="op" id="4652493">+</span><span class="ident" id="4652494">c</span><span class="op" id="4652495">.</span><span class="ident" id="4652496">size</span><span class="op" id="4652500">]</span><span class="op" id="4652501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652508">pos</span>&nbsp;<span class="op" id="4652512">+=</span>&nbsp;<span class="ident" id="4652515">c</span><span class="op" id="4652516">.</span><span class="ident" id="4652517">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652531">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4652540">if</span>&nbsp;<span class="ident" id="4652543">i</span><span class="op" id="4652544">+</span><span class="num" id="4652545">1</span>&nbsp;<span class="op" id="4652547">==</span>&nbsp;<span class="builtinfunc" id="4652550">len</span><span class="op" id="4652553">(</span><span class="ident" id="4652554">b</span><span class="op" id="4652555">.</span><span class="ident" id="4652556">lines</span><span class="op" id="4652561">)</span>&nbsp;<span class="op" id="4652563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4652568">//&nbsp;last&nbsp;buffered&nbsp;line&nbsp;-&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;newline,&nbsp;so&nbsp;just&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4652634">//&nbsp;any&nbsp;outstanding&nbsp;buffered&nbsp;data</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652670">b</span><span class="op" id="4652671">.</span><span class="ident" id="4652672">write0</span><span class="op" id="4652678">(</span><span class="ident" id="4652679">b</span><span class="op" id="4652680">.</span><span class="ident" id="4652681">buf</span><span class="op" id="4652684">.</span><span class="ident" id="4652685">Bytes</span><span class="op" id="4652690">(</span><span class="op" id="4652691">)</span><span class="op" id="4652692">[</span><span class="ident" id="4652693">pos</span>&nbsp;<span class="op" id="4652697">:</span>&nbsp;<span class="ident" id="4652699">pos</span><span class="op" id="4652702">+</span><span class="ident" id="4652703">b</span><span class="op" id="4652704">.</span><span class="ident" id="4652705">cell</span><span class="op" id="4652709">.</span><span class="ident" id="4652710">size</span><span class="op" id="4652714">]</span><span class="op" id="4652715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652720">pos</span>&nbsp;<span class="op" id="4652724">+=</span>&nbsp;<span class="ident" id="4652727">b</span><span class="op" id="4652728">.</span><span class="ident" id="4652729">cell</span><span class="op" id="4652733">.</span><span class="ident" id="4652734">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652741">}</span>&nbsp;<span class="keyword" id="4652743">else</span>&nbsp;<span class="op" id="4652748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4652753">//&nbsp;not&nbsp;the&nbsp;last&nbsp;line&nbsp;-&nbsp;write&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4652793">b</span><span class="op" id="4652794">.</span><span class="ident" id="4652795">write0</span><span class="op" id="4652801">(</span><span class="ident" id="4652802">newline</span><span class="op" id="4652809">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4652816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4652819">return</span><br>
<span class="lineno"></span><span class="op" id="4652826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="comment" id="4652829">//&nbsp;Format&nbsp;the&nbsp;text&nbsp;between&nbsp;line0&nbsp;and&nbsp;line1&nbsp;(excluding&nbsp;line1);&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="4652895">//&nbsp;is&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;line0.</span><br>
<span class="lineno"></span><span class="comment" id="4652962">//&nbsp;Returns&nbsp;the&nbsp;buffer&nbsp;position&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4653027">//&nbsp;line1&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4653058">//</span><br>
<span class="lineno">315</span><span class="keyword" id="4653061">func</span>&nbsp;<span class="op" id="4653066">(</span><span class="ident" id="4653067">b</span>&nbsp;<span class="op" id="4653069">*</span><span class="ident" id="4653070">Writer</span><span class="op" id="4653076">)</span>&nbsp;<span class="ident" id="4653078">format</span><span class="op" id="4653084">(</span><span class="ident" id="4653085">pos0</span>&nbsp;<span class="builtintype" id="4653090">int</span><span class="op" id="4653093">,</span>&nbsp;<span class="ident" id="4653095">line0</span><span class="op" id="4653100">,</span>&nbsp;<span class="ident" id="4653102">line1</span>&nbsp;<span class="builtintype" id="4653108">int</span><span class="op" id="4653111">)</span>&nbsp;<span class="op" id="4653113">(</span><span class="ident" id="4653114">pos</span>&nbsp;<span class="builtintype" id="4653118">int</span><span class="op" id="4653121">)</span>&nbsp;<span class="op" id="4653123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653126">pos</span>&nbsp;<span class="op" id="4653130">=</span>&nbsp;<span class="ident" id="4653132">pos0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653138">column</span>&nbsp;<span class="op" id="4653145">:=</span>&nbsp;<span class="builtinfunc" id="4653148">len</span><span class="op" id="4653151">(</span><span class="ident" id="4653152">b</span><span class="op" id="4653153">.</span><span class="ident" id="4653154">widths</span><span class="op" id="4653160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4653163">for</span>&nbsp;<span class="ident" id="4653167">this</span>&nbsp;<span class="op" id="4653172">:=</span>&nbsp;<span class="ident" id="4653175">line0</span><span class="op" id="4653180">;</span>&nbsp;<span class="ident" id="4653182">this</span>&nbsp;<span class="op" id="4653187">&lt;</span>&nbsp;<span class="ident" id="4653189">line1</span><span class="op" id="4653194">;</span>&nbsp;<span class="ident" id="4653196">this</span><span class="op" id="4653200">++</span>&nbsp;<span class="op" id="4653203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653207">line</span>&nbsp;<span class="op" id="4653212">:=</span>&nbsp;<span class="ident" id="4653215">b</span><span class="op" id="4653216">.</span><span class="ident" id="4653217">lines</span><span class="op" id="4653222">[</span><span class="ident" id="4653223">this</span><span class="op" id="4653227">]</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4653232">if</span>&nbsp;<span class="ident" id="4653235">column</span>&nbsp;<span class="op" id="4653242">&lt;</span>&nbsp;<span class="builtinfunc" id="4653244">len</span><span class="op" id="4653247">(</span><span class="ident" id="4653248">line</span><span class="op" id="4653252">)</span><span class="op" id="4653253">-</span><span class="num" id="4653254">1</span>&nbsp;<span class="op" id="4653256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653261">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column&nbsp;=&gt;&nbsp;this&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653307">//&nbsp;has&nbsp;more&nbsp;cells&nbsp;than&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653351">//&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;is&nbsp;ignored&nbsp;because&nbsp;cells&nbsp;are</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653410">//&nbsp;tab-terminated;&nbsp;the&nbsp;last&nbsp;cell&nbsp;per&nbsp;line&nbsp;describes&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653469">//&nbsp;text&nbsp;before&nbsp;the&nbsp;newline/formfeed&nbsp;and&nbsp;does&nbsp;not&nbsp;belong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653528">//&nbsp;to&nbsp;a&nbsp;column)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653548">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;beginning&nbsp;of&nbsp;block</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653601">pos</span>&nbsp;<span class="op" id="4653605">=</span>&nbsp;<span class="ident" id="4653607">b</span><span class="op" id="4653608">.</span><span class="ident" id="4653609">writeLines</span><span class="op" id="4653619">(</span><span class="ident" id="4653620">pos</span><span class="op" id="4653623">,</span>&nbsp;<span class="ident" id="4653625">line0</span><span class="op" id="4653630">,</span>&nbsp;<span class="ident" id="4653632">this</span><span class="op" id="4653636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653641">line0</span>&nbsp;<span class="op" id="4653647">=</span>&nbsp;<span class="ident" id="4653649">this</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653658">//&nbsp;column&nbsp;block&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653683">width</span>&nbsp;<span class="op" id="4653689">:=</span>&nbsp;<span class="ident" id="4653692">b</span><span class="op" id="4653693">.</span><span class="ident" id="4653694">minwidth</span>&nbsp;<span class="comment" id="4653703">//&nbsp;minimal&nbsp;column&nbsp;width</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653730">discardable</span>&nbsp;<span class="op" id="4653742">:=</span>&nbsp;<span class="builtintype" id="4653745">true</span>&nbsp;<span class="comment" id="4653750">//&nbsp;true&nbsp;if&nbsp;all&nbsp;cells&nbsp;in&nbsp;this&nbsp;column&nbsp;are&nbsp;empty&nbsp;and&nbsp;&#34;soft&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4653810">for</span>&nbsp;<span class="op" id="4653814">;</span>&nbsp;<span class="ident" id="4653816">this</span>&nbsp;<span class="op" id="4653821">&lt;</span>&nbsp;<span class="ident" id="4653823">line1</span><span class="op" id="4653828">;</span>&nbsp;<span class="ident" id="4653830">this</span><span class="op" id="4653834">++</span>&nbsp;<span class="op" id="4653837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653843">line</span>&nbsp;<span class="op" id="4653848">=</span>&nbsp;<span class="ident" id="4653850">b</span><span class="op" id="4653851">.</span><span class="ident" id="4653852">lines</span><span class="op" id="4653857">[</span><span class="ident" id="4653858">this</span><span class="op" id="4653862">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4653868">if</span>&nbsp;<span class="ident" id="4653871">column</span>&nbsp;<span class="op" id="4653878">&lt;</span>&nbsp;<span class="builtinfunc" id="4653880">len</span><span class="op" id="4653883">(</span><span class="ident" id="4653884">line</span><span class="op" id="4653888">)</span><span class="op" id="4653889">-</span><span class="num" id="4653890">1</span>&nbsp;<span class="op" id="4653892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653899">//&nbsp;cell&nbsp;exists&nbsp;in&nbsp;this&nbsp;column</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4653934">c</span>&nbsp;<span class="op" id="4653936">:=</span>&nbsp;<span class="ident" id="4653939">line</span><span class="op" id="4653943">[</span><span class="ident" id="4653944">column</span><span class="op" id="4653950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4653957">//&nbsp;update&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4653978">if</span>&nbsp;<span class="ident" id="4653981">w</span>&nbsp;<span class="op" id="4653983">:=</span>&nbsp;<span class="ident" id="4653986">c</span><span class="op" id="4653987">.</span><span class="ident" id="4653988">width</span>&nbsp;<span class="op" id="4653994">+</span>&nbsp;<span class="ident" id="4653996">b</span><span class="op" id="4653997">.</span><span class="ident" id="4653998">padding</span><span class="op" id="4654005">;</span>&nbsp;<span class="ident" id="4654007">w</span>&nbsp;<span class="op" id="4654009">&gt;</span>&nbsp;<span class="ident" id="4654011">width</span>&nbsp;<span class="op" id="4654017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654025">width</span>&nbsp;<span class="op" id="4654031">=</span>&nbsp;<span class="ident" id="4654033">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654040">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4654047">//&nbsp;update&nbsp;discardable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654074">if</span>&nbsp;<span class="ident" id="4654077">c</span><span class="op" id="4654078">.</span><span class="ident" id="4654079">width</span>&nbsp;<span class="op" id="4654085">&gt;</span>&nbsp;<span class="num" id="4654087">0</span>&nbsp;<span class="op" id="4654089">||</span>&nbsp;<span class="ident" id="4654092">c</span><span class="op" id="4654093">.</span><span class="ident" id="4654094">htab</span>&nbsp;<span class="op" id="4654099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654107">discardable</span>&nbsp;<span class="op" id="4654119">=</span>&nbsp;<span class="builtintype" id="4654121">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654138">}</span>&nbsp;<span class="keyword" id="4654140">else</span>&nbsp;<span class="op" id="4654145">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654152">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4654172">//&nbsp;column&nbsp;block&nbsp;end</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4654196">//&nbsp;discard&nbsp;empty&nbsp;columns&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654237">if</span>&nbsp;<span class="ident" id="4654240">discardable</span>&nbsp;<span class="op" id="4654252">&amp;&amp;</span>&nbsp;<span class="ident" id="4654255">b</span><span class="op" id="4654256">.</span><span class="ident" id="4654257">flags</span><span class="op" id="4654262">&amp;</span><span class="ident" id="4654263">DiscardEmptyColumns</span>&nbsp;<span class="op" id="4654283">!=</span>&nbsp;<span class="num" id="4654286">0</span>&nbsp;<span class="op" id="4654288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654294">width</span>&nbsp;<span class="op" id="4654300">=</span>&nbsp;<span class="num" id="4654302">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4654313">//&nbsp;format&nbsp;and&nbsp;print&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;right&nbsp;of&nbsp;this&nbsp;column</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4654376">//&nbsp;(we&nbsp;know&nbsp;the&nbsp;widths&nbsp;of&nbsp;this&nbsp;column&nbsp;and&nbsp;all&nbsp;columns&nbsp;to&nbsp;the&nbsp;left)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654446">b</span><span class="op" id="4654447">.</span><span class="ident" id="4654448">widths</span>&nbsp;<span class="op" id="4654455">=</span>&nbsp;<span class="builtinfunc" id="4654457">append</span><span class="op" id="4654463">(</span><span class="ident" id="4654464">b</span><span class="op" id="4654465">.</span><span class="ident" id="4654466">widths</span><span class="op" id="4654472">,</span>&nbsp;<span class="ident" id="4654474">width</span><span class="op" id="4654479">)</span>&nbsp;<span class="comment" id="4654481">//&nbsp;push&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654498">pos</span>&nbsp;<span class="op" id="4654502">=</span>&nbsp;<span class="ident" id="4654504">b</span><span class="op" id="4654505">.</span><span class="ident" id="4654506">format</span><span class="op" id="4654512">(</span><span class="ident" id="4654513">pos</span><span class="op" id="4654516">,</span>&nbsp;<span class="ident" id="4654518">line0</span><span class="op" id="4654523">,</span>&nbsp;<span class="ident" id="4654525">this</span><span class="op" id="4654529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654534">b</span><span class="op" id="4654535">.</span><span class="ident" id="4654536">widths</span>&nbsp;<span class="op" id="4654543">=</span>&nbsp;<span class="ident" id="4654545">b</span><span class="op" id="4654546">.</span><span class="ident" id="4654547">widths</span><span class="op" id="4654553">[</span><span class="num" id="4654554">0</span>&nbsp;<span class="op" id="4654556">:</span>&nbsp;<span class="builtinfunc" id="4654558">len</span><span class="op" id="4654561">(</span><span class="ident" id="4654562">b</span><span class="op" id="4654563">.</span><span class="ident" id="4654564">widths</span><span class="op" id="4654570">)</span><span class="op" id="4654571">-</span><span class="num" id="4654572">1</span><span class="op" id="4654573">]</span>&nbsp;<span class="comment" id="4654575">//&nbsp;pop&nbsp;width</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654591">line0</span>&nbsp;<span class="op" id="4654597">=</span>&nbsp;<span class="ident" id="4654599">this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4654609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4654613">//&nbsp;print&nbsp;unprinted&nbsp;lines&nbsp;until&nbsp;end</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4654649">return</span>&nbsp;<span class="ident" id="4654656">b</span><span class="op" id="4654657">.</span><span class="ident" id="4654658">writeLines</span><span class="op" id="4654668">(</span><span class="ident" id="4654669">pos</span><span class="op" id="4654672">,</span>&nbsp;<span class="ident" id="4654674">line0</span><span class="op" id="4654679">,</span>&nbsp;<span class="ident" id="4654681">line1</span><span class="op" id="4654686">)</span><br>
<span class="lineno"></span><span class="op" id="4654688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4654691">//&nbsp;Append&nbsp;text&nbsp;to&nbsp;current&nbsp;cell.</span><br>
<span class="lineno"></span><span class="keyword" id="4654723">func</span>&nbsp;<span class="op" id="4654728">(</span><span class="ident" id="4654729">b</span>&nbsp;<span class="op" id="4654731">*</span><span class="ident" id="4654732">Writer</span><span class="op" id="4654738">)</span>&nbsp;<span class="builtinfunc" id="4654740">append</span><span class="op" id="4654746">(</span><span class="ident" id="4654747">text</span>&nbsp;<span class="op" id="4654752">[</span><span class="op" id="4654753">]</span><span class="builtintype" id="4654754">byte</span><span class="op" id="4654758">)</span>&nbsp;<span class="op" id="4654760">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654763">b</span><span class="op" id="4654764">.</span><span class="ident" id="4654765">buf</span><span class="op" id="4654768">.</span><span class="ident" id="4654769">Write</span><span class="op" id="4654774">(</span><span class="ident" id="4654775">text</span><span class="op" id="4654779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654782">b</span><span class="op" id="4654783">.</span><span class="ident" id="4654784">cell</span><span class="op" id="4654788">.</span><span class="ident" id="4654789">size</span>&nbsp;<span class="op" id="4654794">+=</span>&nbsp;<span class="builtinfunc" id="4654797">len</span><span class="op" id="4654800">(</span><span class="ident" id="4654801">text</span><span class="op" id="4654805">)</span><br>
<span class="lineno"></span><span class="op" id="4654807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4654810">//&nbsp;Update&nbsp;the&nbsp;cell&nbsp;width.</span><br>
<span class="lineno">380</span><span class="keyword" id="4654836">func</span>&nbsp;<span class="op" id="4654841">(</span><span class="ident" id="4654842">b</span>&nbsp;<span class="op" id="4654844">*</span><span class="ident" id="4654845">Writer</span><span class="op" id="4654851">)</span>&nbsp;<span class="ident" id="4654853">updateWidth</span><span class="op" id="4654864">(</span><span class="op" id="4654865">)</span>&nbsp;<span class="op" id="4654867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654870">b</span><span class="op" id="4654871">.</span><span class="ident" id="4654872">cell</span><span class="op" id="4654876">.</span><span class="ident" id="4654877">width</span>&nbsp;<span class="op" id="4654883">+=</span>&nbsp;<span class="ident" id="4654886">utf8</span><span class="op" id="4654890">.</span><span class="ident" id="4654891">RuneCount</span><span class="op" id="4654900">(</span><span class="ident" id="4654901">b</span><span class="op" id="4654902">.</span><span class="ident" id="4654903">buf</span><span class="op" id="4654906">.</span><span class="ident" id="4654907">Bytes</span><span class="op" id="4654912">(</span><span class="op" id="4654913">)</span><span class="op" id="4654914">[</span><span class="ident" id="4654915">b</span><span class="op" id="4654916">.</span><span class="ident" id="4654917">pos</span><span class="op" id="4654920">:</span><span class="ident" id="4654921">b</span><span class="op" id="4654922">.</span><span class="ident" id="4654923">buf</span><span class="op" id="4654926">.</span><span class="ident" id="4654927">Len</span><span class="op" id="4654930">(</span><span class="op" id="4654931">)</span><span class="op" id="4654932">]</span><span class="op" id="4654933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4654936">b</span><span class="op" id="4654937">.</span><span class="ident" id="4654938">pos</span>&nbsp;<span class="op" id="4654942">=</span>&nbsp;<span class="ident" id="4654944">b</span><span class="op" id="4654945">.</span><span class="ident" id="4654946">buf</span><span class="op" id="4654949">.</span><span class="ident" id="4654950">Len</span><span class="op" id="4654953">(</span><span class="op" id="4654954">)</span><br>
<span class="lineno"></span><span class="op" id="4654956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="4654959">//&nbsp;To&nbsp;escape&nbsp;a&nbsp;text&nbsp;segment,&nbsp;bracket&nbsp;it&nbsp;with&nbsp;Escape&nbsp;characters.</span><br>
<span class="lineno"></span><span class="comment" id="4655023">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;tab&nbsp;in&nbsp;this&nbsp;string&nbsp;&#34;Ignore&nbsp;this&nbsp;tab:&nbsp;\xff\t\xff&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4655093">//&nbsp;does&nbsp;not&nbsp;terminate&nbsp;a&nbsp;cell&nbsp;and&nbsp;constitutes&nbsp;a&nbsp;single&nbsp;character&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4655160">//&nbsp;width&nbsp;one&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4655198">//</span><br>
<span class="lineno">390</span><span class="comment" id="4655201">//&nbsp;The&nbsp;value&nbsp;0xff&nbsp;was&nbsp;chosen&nbsp;because&nbsp;it&nbsp;cannot&nbsp;appear&nbsp;in&nbsp;a&nbsp;valid&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="4655282">//</span><br>
<span class="lineno"></span><span class="keyword" id="4655285">const</span>&nbsp;<span class="ident" id="4655291">Escape</span>&nbsp;<span class="op" id="4655298">=</span>&nbsp;<span class="string" id="4655300">&#39;\xff&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4655308">//&nbsp;Start&nbsp;escaped&nbsp;mode.</span><br>
<span class="lineno">395</span><span class="keyword" id="4655331">func</span>&nbsp;<span class="op" id="4655336">(</span><span class="ident" id="4655337">b</span>&nbsp;<span class="op" id="4655339">*</span><span class="ident" id="4655340">Writer</span><span class="op" id="4655346">)</span>&nbsp;<span class="ident" id="4655348">startEscape</span><span class="op" id="4655359">(</span><span class="ident" id="4655360">ch</span>&nbsp;<span class="builtintype" id="4655363">byte</span><span class="op" id="4655367">)</span>&nbsp;<span class="op" id="4655369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655372">switch</span>&nbsp;<span class="ident" id="4655379">ch</span>&nbsp;<span class="op" id="4655382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655385">case</span>&nbsp;<span class="ident" id="4655390">Escape</span><span class="op" id="4655396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655400">b</span><span class="op" id="4655401">.</span><span class="ident" id="4655402">endChar</span>&nbsp;<span class="op" id="4655410">=</span>&nbsp;<span class="ident" id="4655412">Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655420">case</span>&nbsp;<span class="string" id="4655425">&#39;&lt;&#39;</span><span class="op" id="4655428">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655432">b</span><span class="op" id="4655433">.</span><span class="ident" id="4655434">endChar</span>&nbsp;<span class="op" id="4655442">=</span>&nbsp;<span class="string" id="4655444">&#39;&gt;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655449">case</span>&nbsp;<span class="string" id="4655454">&#39;&amp;&#39;</span><span class="op" id="4655457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655461">b</span><span class="op" id="4655462">.</span><span class="ident" id="4655463">endChar</span>&nbsp;<span class="op" id="4655471">=</span>&nbsp;<span class="string" id="4655473">&#39;;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4655478">}</span><br>
<span class="lineno"></span><span class="op" id="4655480">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4655483">//&nbsp;Terminate&nbsp;escaped&nbsp;mode.&nbsp;If&nbsp;the&nbsp;escaped&nbsp;text&nbsp;was&nbsp;an&nbsp;HTML&nbsp;tag,&nbsp;its&nbsp;width</span><br>
<span class="lineno"></span><span class="comment" id="4655557">//&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;zero&nbsp;for&nbsp;formatting&nbsp;purposes;&nbsp;if&nbsp;it&nbsp;was&nbsp;an&nbsp;HTML&nbsp;entity,</span><br>
<span class="lineno"></span><span class="comment" id="4655633">//&nbsp;its&nbsp;width&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;one.&nbsp;In&nbsp;all&nbsp;other&nbsp;cases,&nbsp;the&nbsp;width&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4655705">//&nbsp;unicode&nbsp;width&nbsp;of&nbsp;the&nbsp;text.</span><br>
<span class="lineno">410</span><span class="comment" id="4655735">//</span><br>
<span class="lineno"></span><span class="keyword" id="4655738">func</span>&nbsp;<span class="op" id="4655743">(</span><span class="ident" id="4655744">b</span>&nbsp;<span class="op" id="4655746">*</span><span class="ident" id="4655747">Writer</span><span class="op" id="4655753">)</span>&nbsp;<span class="ident" id="4655755">endEscape</span><span class="op" id="4655764">(</span><span class="op" id="4655765">)</span>&nbsp;<span class="op" id="4655767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655770">switch</span>&nbsp;<span class="ident" id="4655777">b</span><span class="op" id="4655778">.</span><span class="ident" id="4655779">endChar</span>&nbsp;<span class="op" id="4655787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655790">case</span>&nbsp;<span class="ident" id="4655795">Escape</span><span class="op" id="4655801">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655805">b</span><span class="op" id="4655806">.</span><span class="ident" id="4655807">updateWidth</span><span class="op" id="4655818">(</span><span class="op" id="4655819">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655823">if</span>&nbsp;<span class="ident" id="4655826">b</span><span class="op" id="4655827">.</span><span class="ident" id="4655828">flags</span><span class="op" id="4655833">&amp;</span><span class="ident" id="4655834">StripEscape</span>&nbsp;<span class="op" id="4655846">==</span>&nbsp;<span class="num" id="4655849">0</span>&nbsp;<span class="op" id="4655851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655856">b</span><span class="op" id="4655857">.</span><span class="ident" id="4655858">cell</span><span class="op" id="4655862">.</span><span class="ident" id="4655863">width</span>&nbsp;<span class="op" id="4655869">-=</span>&nbsp;<span class="num" id="4655872">2</span>&nbsp;<span class="comment" id="4655874">//&nbsp;don&#39;t&nbsp;count&nbsp;the&nbsp;Escape&nbsp;chars</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4655908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655911">case</span>&nbsp;<span class="string" id="4655916">&#39;&gt;&#39;</span><span class="op" id="4655919">:</span>&nbsp;<span class="comment" id="4655921">//&nbsp;tag&nbsp;of&nbsp;zero&nbsp;width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4655943">case</span>&nbsp;<span class="string" id="4655948">&#39;;&#39;</span><span class="op" id="4655951">:</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4655955">b</span><span class="op" id="4655956">.</span><span class="ident" id="4655957">cell</span><span class="op" id="4655961">.</span><span class="ident" id="4655962">width</span><span class="op" id="4655967">++</span>&nbsp;<span class="comment" id="4655970">//&nbsp;entity,&nbsp;count&nbsp;as&nbsp;one&nbsp;rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656003">b</span><span class="op" id="4656004">.</span><span class="ident" id="4656005">pos</span>&nbsp;<span class="op" id="4656009">=</span>&nbsp;<span class="ident" id="4656011">b</span><span class="op" id="4656012">.</span><span class="ident" id="4656013">buf</span><span class="op" id="4656016">.</span><span class="ident" id="4656017">Len</span><span class="op" id="4656020">(</span><span class="op" id="4656021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656024">b</span><span class="op" id="4656025">.</span><span class="ident" id="4656026">endChar</span>&nbsp;<span class="op" id="4656034">=</span>&nbsp;<span class="num" id="4656036">0</span><br>
<span class="lineno"></span><span class="op" id="4656038">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span><span class="comment" id="4656041">//&nbsp;Terminate&nbsp;the&nbsp;current&nbsp;cell&nbsp;by&nbsp;adding&nbsp;it&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;cells&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4656112">//&nbsp;current&nbsp;line.&nbsp;Returns&nbsp;the&nbsp;number&nbsp;of&nbsp;cells&nbsp;in&nbsp;that&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="4656171">//</span><br>
<span class="lineno"></span><span class="keyword" id="4656174">func</span>&nbsp;<span class="op" id="4656179">(</span><span class="ident" id="4656180">b</span>&nbsp;<span class="op" id="4656182">*</span><span class="ident" id="4656183">Writer</span><span class="op" id="4656189">)</span>&nbsp;<span class="ident" id="4656191">terminateCell</span><span class="op" id="4656204">(</span><span class="ident" id="4656205">htab</span>&nbsp;<span class="builtintype" id="4656210">bool</span><span class="op" id="4656214">)</span>&nbsp;<span class="builtintype" id="4656216">int</span>&nbsp;<span class="op" id="4656220">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656223">b</span><span class="op" id="4656224">.</span><span class="ident" id="4656225">cell</span><span class="op" id="4656229">.</span><span class="ident" id="4656230">htab</span>&nbsp;<span class="op" id="4656235">=</span>&nbsp;<span class="ident" id="4656237">htab</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656243">line</span>&nbsp;<span class="op" id="4656248">:=</span>&nbsp;<span class="op" id="4656251">&amp;</span><span class="ident" id="4656252">b</span><span class="op" id="4656253">.</span><span class="ident" id="4656254">lines</span><span class="op" id="4656259">[</span><span class="builtinfunc" id="4656260">len</span><span class="op" id="4656263">(</span><span class="ident" id="4656264">b</span><span class="op" id="4656265">.</span><span class="ident" id="4656266">lines</span><span class="op" id="4656271">)</span><span class="op" id="4656272">-</span><span class="num" id="4656273">1</span><span class="op" id="4656274">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656277">*</span><span class="ident" id="4656278">line</span>&nbsp;<span class="op" id="4656283">=</span>&nbsp;<span class="builtinfunc" id="4656285">append</span><span class="op" id="4656291">(</span><span class="op" id="4656292">*</span><span class="ident" id="4656293">line</span><span class="op" id="4656297">,</span>&nbsp;<span class="ident" id="4656299">b</span><span class="op" id="4656300">.</span><span class="ident" id="4656301">cell</span><span class="op" id="4656305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4656308">b</span><span class="op" id="4656309">.</span><span class="ident" id="4656310">cell</span>&nbsp;<span class="op" id="4656315">=</span>&nbsp;<span class="ident" id="4656317">cell</span><span class="op" id="4656321">{</span><span class="op" id="4656322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656325">return</span>&nbsp;<span class="builtinfunc" id="4656332">len</span><span class="op" id="4656335">(</span><span class="op" id="4656336">*</span><span class="ident" id="4656337">line</span><span class="op" id="4656341">)</span><br>
<span class="lineno">435</span><span class="op" id="4656343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4656346">func</span>&nbsp;<span class="ident" id="4656351">handlePanic</span><span class="op" id="4656362">(</span><span class="ident" id="4656363">err</span>&nbsp;<span class="op" id="4656367">*</span><span class="builtintype" id="4656368">error</span><span class="op" id="4656373">,</span>&nbsp;<span class="ident" id="4656375">op</span>&nbsp;<span class="builtintype" id="4656378">string</span><span class="op" id="4656384">)</span>&nbsp;<span class="op" id="4656386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656389">if</span>&nbsp;<span class="ident" id="4656392">e</span>&nbsp;<span class="op" id="4656394">:=</span>&nbsp;<span class="builtinfunc" id="4656397">recover</span><span class="op" id="4656404">(</span><span class="op" id="4656405">)</span><span class="op" id="4656406">;</span>&nbsp;<span class="ident" id="4656408">e</span>&nbsp;<span class="op" id="4656410">!=</span>&nbsp;<span class="builtintype" id="4656413">nil</span>&nbsp;<span class="op" id="4656417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656421">if</span>&nbsp;<span class="ident" id="4656424">nerr</span><span class="op" id="4656428">,</span>&nbsp;<span class="ident" id="4656430">ok</span>&nbsp;<span class="op" id="4656433">:=</span>&nbsp;<span class="ident" id="4656436">e</span><span class="op" id="4656437">.</span><span class="op" id="4656438">(</span><span class="ident" id="4656439">osError</span><span class="op" id="4656446">)</span><span class="op" id="4656447">;</span>&nbsp;<span class="ident" id="4656449">ok</span>&nbsp;<span class="op" id="4656452">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656457">*</span><span class="ident" id="4656458">err</span>&nbsp;<span class="op" id="4656462">=</span>&nbsp;<span class="ident" id="4656464">nerr</span><span class="op" id="4656468">.</span><span class="ident" id="4656469">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656476">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4656489">panic</span><span class="op" id="4656494">(</span><span class="string" id="4656495">&#34;tabwriter:&nbsp;panic&nbsp;during&nbsp;&#34;</span>&nbsp;<span class="op" id="4656522">+</span>&nbsp;<span class="ident" id="4656524">op</span><span class="op" id="4656526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4656529">}</span><br>
<span class="lineno">445</span><span class="op" id="4656531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4656534">//&nbsp;Flush&nbsp;should&nbsp;be&nbsp;called&nbsp;after&nbsp;the&nbsp;last&nbsp;call&nbsp;to&nbsp;Write&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="4656599">//&nbsp;that&nbsp;any&nbsp;data&nbsp;buffered&nbsp;in&nbsp;the&nbsp;Writer&nbsp;is&nbsp;written&nbsp;to&nbsp;output.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4656665">//&nbsp;incomplete&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;end&nbsp;is&nbsp;considered</span><br>
<span class="lineno">450</span><span class="comment" id="4656720">//&nbsp;complete&nbsp;for&nbsp;formatting&nbsp;purposes.</span><br>
<span class="lineno"></span><span class="comment" id="4656757">//</span><br>
<span class="lineno"></span><span class="keyword" id="4656760">func</span>&nbsp;<span class="op" id="4656765">(</span><span class="ident" id="4656766">b</span>&nbsp;<span class="op" id="4656768">*</span><span class="ident" id="4656769">Writer</span><span class="op" id="4656775">)</span>&nbsp;<span class="ident" id="4656777">Flush</span><span class="op" id="4656782">(</span><span class="op" id="4656783">)</span>&nbsp;<span class="op" id="4656785">(</span><span class="ident" id="4656786">err</span>&nbsp;<span class="builtintype" id="4656790">error</span><span class="op" id="4656795">)</span>&nbsp;<span class="op" id="4656797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656800">defer</span>&nbsp;<span class="ident" id="4656806">b</span><span class="op" id="4656807">.</span><span class="ident" id="4656808">reset</span><span class="op" id="4656813">(</span><span class="op" id="4656814">)</span>&nbsp;<span class="comment" id="4656816">//&nbsp;even&nbsp;in&nbsp;the&nbsp;presence&nbsp;of&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656851">defer</span>&nbsp;<span class="ident" id="4656857">handlePanic</span><span class="op" id="4656868">(</span><span class="op" id="4656869">&amp;</span><span class="ident" id="4656870">err</span><span class="op" id="4656873">,</span>&nbsp;<span class="string" id="4656875">&#34;Flush&#34;</span><span class="op" id="4656882">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4656886">//&nbsp;add&nbsp;current&nbsp;cell&nbsp;if&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656920">if</span>&nbsp;<span class="ident" id="4656923">b</span><span class="op" id="4656924">.</span><span class="ident" id="4656925">cell</span><span class="op" id="4656929">.</span><span class="ident" id="4656930">size</span>&nbsp;<span class="op" id="4656935">&gt;</span>&nbsp;<span class="num" id="4656937">0</span>&nbsp;<span class="op" id="4656939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4656943">if</span>&nbsp;<span class="ident" id="4656946">b</span><span class="op" id="4656947">.</span><span class="ident" id="4656948">endChar</span>&nbsp;<span class="op" id="4656956">!=</span>&nbsp;<span class="num" id="4656959">0</span>&nbsp;<span class="op" id="4656961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4656966">//&nbsp;inside&nbsp;escape&nbsp;-&nbsp;terminate&nbsp;it&nbsp;even&nbsp;if&nbsp;incomplete</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657020">b</span><span class="op" id="4657021">.</span><span class="ident" id="4657022">endEscape</span><span class="op" id="4657031">(</span><span class="op" id="4657032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657040">b</span><span class="op" id="4657041">.</span><span class="ident" id="4657042">terminateCell</span><span class="op" id="4657055">(</span><span class="builtintype" id="4657056">false</span><span class="op" id="4657061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4657064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657068">//&nbsp;format&nbsp;contents&nbsp;of&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657098">b</span><span class="op" id="4657099">.</span><span class="ident" id="4657100">format</span><span class="op" id="4657106">(</span><span class="num" id="4657107">0</span><span class="op" id="4657108">,</span>&nbsp;<span class="num" id="4657110">0</span><span class="op" id="4657111">,</span>&nbsp;<span class="builtinfunc" id="4657113">len</span><span class="op" id="4657116">(</span><span class="ident" id="4657117">b</span><span class="op" id="4657118">.</span><span class="ident" id="4657119">lines</span><span class="op" id="4657124">)</span><span class="op" id="4657125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657129">return</span><br>
<span class="lineno"></span><span class="op" id="4657136">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="4657139">var</span>&nbsp;<span class="ident" id="4657143">hbar</span>&nbsp;<span class="op" id="4657148">=</span>&nbsp;<span class="op" id="4657150">[</span><span class="op" id="4657151">]</span><span class="builtintype" id="4657152">byte</span><span class="op" id="4657156">(</span><span class="string" id="4657157">&#34;---\n&#34;</span><span class="op" id="4657164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4657167">//&nbsp;Write&nbsp;writes&nbsp;buf&nbsp;to&nbsp;the&nbsp;writer&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="4657204">//&nbsp;The&nbsp;only&nbsp;errors&nbsp;returned&nbsp;are&nbsp;ones&nbsp;encountered</span><br>
<span class="lineno">475</span><span class="comment" id="4657253">//&nbsp;while&nbsp;writing&nbsp;to&nbsp;the&nbsp;underlying&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="4657303">//</span><br>
<span class="lineno"></span><span class="keyword" id="4657306">func</span>&nbsp;<span class="op" id="4657311">(</span><span class="ident" id="4657312">b</span>&nbsp;<span class="op" id="4657314">*</span><span class="ident" id="4657315">Writer</span><span class="op" id="4657321">)</span>&nbsp;<span class="ident" id="4657323">Write</span><span class="op" id="4657328">(</span><span class="ident" id="4657329">buf</span>&nbsp;<span class="op" id="4657333">[</span><span class="op" id="4657334">]</span><span class="builtintype" id="4657335">byte</span><span class="op" id="4657339">)</span>&nbsp;<span class="op" id="4657341">(</span><span class="ident" id="4657342">n</span>&nbsp;<span class="builtintype" id="4657344">int</span><span class="op" id="4657347">,</span>&nbsp;<span class="ident" id="4657349">err</span>&nbsp;<span class="builtintype" id="4657353">error</span><span class="op" id="4657358">)</span>&nbsp;<span class="op" id="4657360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657363">defer</span>&nbsp;<span class="ident" id="4657369">handlePanic</span><span class="op" id="4657380">(</span><span class="op" id="4657381">&amp;</span><span class="ident" id="4657382">err</span><span class="op" id="4657385">,</span>&nbsp;<span class="string" id="4657387">&#34;Write&#34;</span><span class="op" id="4657394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657398">//&nbsp;split&nbsp;text&nbsp;into&nbsp;cells</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657424">n</span>&nbsp;<span class="op" id="4657426">=</span>&nbsp;<span class="num" id="4657428">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657431">for</span>&nbsp;<span class="ident" id="4657435">i</span><span class="op" id="4657436">,</span>&nbsp;<span class="ident" id="4657438">ch</span>&nbsp;<span class="op" id="4657441">:=</span>&nbsp;<span class="keyword" id="4657444">range</span>&nbsp;<span class="ident" id="4657450">buf</span>&nbsp;<span class="op" id="4657454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657458">if</span>&nbsp;<span class="ident" id="4657461">b</span><span class="op" id="4657462">.</span><span class="ident" id="4657463">endChar</span>&nbsp;<span class="op" id="4657471">==</span>&nbsp;<span class="num" id="4657474">0</span>&nbsp;<span class="op" id="4657476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657481">//&nbsp;outside&nbsp;escape</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657502">switch</span>&nbsp;<span class="ident" id="4657509">ch</span>&nbsp;<span class="op" id="4657512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657517">case</span>&nbsp;<span class="string" id="4657522">&#39;\t&#39;</span><span class="op" id="4657526">,</span>&nbsp;<span class="string" id="4657528">&#39;\v&#39;</span><span class="op" id="4657532">,</span>&nbsp;<span class="string" id="4657534">&#39;\n&#39;</span><span class="op" id="4657538">,</span>&nbsp;<span class="string" id="4657540">&#39;\f&#39;</span><span class="op" id="4657544">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657550">//&nbsp;end&nbsp;of&nbsp;cell</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657569">b</span><span class="op" id="4657570">.</span><span class="builtinfunc" id="4657571">append</span><span class="op" id="4657577">(</span><span class="ident" id="4657578">buf</span><span class="op" id="4657581">[</span><span class="ident" id="4657582">n</span><span class="op" id="4657583">:</span><span class="ident" id="4657584">i</span><span class="op" id="4657585">]</span><span class="op" id="4657586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657592">b</span><span class="op" id="4657593">.</span><span class="ident" id="4657594">updateWidth</span><span class="op" id="4657605">(</span><span class="op" id="4657606">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657612">n</span>&nbsp;<span class="op" id="4657614">=</span>&nbsp;<span class="ident" id="4657616">i</span>&nbsp;<span class="op" id="4657618">+</span>&nbsp;<span class="num" id="4657620">1</span>&nbsp;<span class="comment" id="4657622">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657641">ncells</span>&nbsp;<span class="op" id="4657648">:=</span>&nbsp;<span class="ident" id="4657651">b</span><span class="op" id="4657652">.</span><span class="ident" id="4657653">terminateCell</span><span class="op" id="4657666">(</span><span class="ident" id="4657667">ch</span>&nbsp;<span class="op" id="4657670">==</span>&nbsp;<span class="string" id="4657673">&#39;\t&#39;</span><span class="op" id="4657677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657683">if</span>&nbsp;<span class="ident" id="4657686">ch</span>&nbsp;<span class="op" id="4657689">==</span>&nbsp;<span class="string" id="4657692">&#39;\n&#39;</span>&nbsp;<span class="op" id="4657697">||</span>&nbsp;<span class="ident" id="4657700">ch</span>&nbsp;<span class="op" id="4657703">==</span>&nbsp;<span class="string" id="4657706">&#39;\f&#39;</span>&nbsp;<span class="op" id="4657711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657718">//&nbsp;terminate&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4657741">b</span><span class="op" id="4657742">.</span><span class="ident" id="4657743">addLine</span><span class="op" id="4657750">(</span><span class="op" id="4657751">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4657758">if</span>&nbsp;<span class="ident" id="4657761">ch</span>&nbsp;<span class="op" id="4657764">==</span>&nbsp;<span class="string" id="4657767">&#39;\f&#39;</span>&nbsp;<span class="op" id="4657772">||</span>&nbsp;<span class="ident" id="4657775">ncells</span>&nbsp;<span class="op" id="4657782">==</span>&nbsp;<span class="num" id="4657785">1</span>&nbsp;<span class="op" id="4657787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657795">//&nbsp;A&nbsp;&#39;\f&#39;&nbsp;always&nbsp;forces&nbsp;a&nbsp;flush.&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;previous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657861">//&nbsp;line&nbsp;has&nbsp;only&nbsp;one&nbsp;cell&nbsp;which&nbsp;does&nbsp;not&nbsp;have&nbsp;an&nbsp;impact&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657926">//&nbsp;the&nbsp;formatting&nbsp;of&nbsp;the&nbsp;following&nbsp;lines&nbsp;(the&nbsp;last&nbsp;cell&nbsp;per</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4657992">//&nbsp;line&nbsp;is&nbsp;ignored&nbsp;by&nbsp;format()),&nbsp;thus&nbsp;we&nbsp;can&nbsp;flush&nbsp;the</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658053">//&nbsp;Writer&nbsp;contents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658079">if</span>&nbsp;<span class="ident" id="4658082">err</span>&nbsp;<span class="op" id="4658086">=</span>&nbsp;<span class="ident" id="4658088">b</span><span class="op" id="4658089">.</span><span class="ident" id="4658090">Flush</span><span class="op" id="4658095">(</span><span class="op" id="4658096">)</span><span class="op" id="4658097">;</span>&nbsp;<span class="ident" id="4658099">err</span>&nbsp;<span class="op" id="4658103">!=</span>&nbsp;<span class="builtintype" id="4658106">nil</span>&nbsp;<span class="op" id="4658110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658119">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658140">if</span>&nbsp;<span class="ident" id="4658143">ch</span>&nbsp;<span class="op" id="4658146">==</span>&nbsp;<span class="string" id="4658149">&#39;\f&#39;</span>&nbsp;<span class="op" id="4658154">&amp;&amp;</span>&nbsp;<span class="ident" id="4658157">b</span><span class="op" id="4658158">.</span><span class="ident" id="4658159">flags</span><span class="op" id="4658164">&amp;</span><span class="ident" id="4658165">Debug</span>&nbsp;<span class="op" id="4658171">!=</span>&nbsp;<span class="num" id="4658174">0</span>&nbsp;<span class="op" id="4658176">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658185">//&nbsp;indicate&nbsp;section&nbsp;break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658218">b</span><span class="op" id="4658219">.</span><span class="ident" id="4658220">write0</span><span class="op" id="4658226">(</span><span class="ident" id="4658227">hbar</span><span class="op" id="4658231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658252">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658258">case</span>&nbsp;<span class="ident" id="4658263">Escape</span><span class="op" id="4658269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658275">//&nbsp;start&nbsp;of&nbsp;escaped&nbsp;sequence</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658308">b</span><span class="op" id="4658309">.</span><span class="builtinfunc" id="4658310">append</span><span class="op" id="4658316">(</span><span class="ident" id="4658317">buf</span><span class="op" id="4658320">[</span><span class="ident" id="4658321">n</span><span class="op" id="4658322">:</span><span class="ident" id="4658323">i</span><span class="op" id="4658324">]</span><span class="op" id="4658325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658331">b</span><span class="op" id="4658332">.</span><span class="ident" id="4658333">updateWidth</span><span class="op" id="4658344">(</span><span class="op" id="4658345">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658351">n</span>&nbsp;<span class="op" id="4658353">=</span>&nbsp;<span class="ident" id="4658355">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658361">if</span>&nbsp;<span class="ident" id="4658364">b</span><span class="op" id="4658365">.</span><span class="ident" id="4658366">flags</span><span class="op" id="4658371">&amp;</span><span class="ident" id="4658372">StripEscape</span>&nbsp;<span class="op" id="4658384">!=</span>&nbsp;<span class="num" id="4658387">0</span>&nbsp;<span class="op" id="4658389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658396">n</span><span class="op" id="4658397">++</span>&nbsp;<span class="comment" id="4658400">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658426">b</span><span class="op" id="4658427">.</span><span class="ident" id="4658428">startEscape</span><span class="op" id="4658439">(</span><span class="ident" id="4658440">Escape</span><span class="op" id="4658446">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658452">case</span>&nbsp;<span class="string" id="4658457">&#39;&lt;&#39;</span><span class="op" id="4658460">,</span>&nbsp;<span class="string" id="4658462">&#39;&amp;&#39;</span><span class="op" id="4658465">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658471">//&nbsp;possibly&nbsp;an&nbsp;html&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658506">if</span>&nbsp;<span class="ident" id="4658509">b</span><span class="op" id="4658510">.</span><span class="ident" id="4658511">flags</span><span class="op" id="4658516">&amp;</span><span class="ident" id="4658517">FilterHTML</span>&nbsp;<span class="op" id="4658528">!=</span>&nbsp;<span class="num" id="4658531">0</span>&nbsp;<span class="op" id="4658533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658540">//&nbsp;begin&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658568">b</span><span class="op" id="4658569">.</span><span class="builtinfunc" id="4658570">append</span><span class="op" id="4658576">(</span><span class="ident" id="4658577">buf</span><span class="op" id="4658580">[</span><span class="ident" id="4658581">n</span><span class="op" id="4658582">:</span><span class="ident" id="4658583">i</span><span class="op" id="4658584">]</span><span class="op" id="4658585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658592">b</span><span class="op" id="4658593">.</span><span class="ident" id="4658594">updateWidth</span><span class="op" id="4658605">(</span><span class="op" id="4658606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658613">n</span>&nbsp;<span class="op" id="4658615">=</span>&nbsp;<span class="ident" id="4658617">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658624">b</span><span class="op" id="4658625">.</span><span class="ident" id="4658626">startEscape</span><span class="op" id="4658637">(</span><span class="ident" id="4658638">ch</span><span class="op" id="4658640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658646">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658656">}</span>&nbsp;<span class="keyword" id="4658658">else</span>&nbsp;<span class="op" id="4658663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658668">//&nbsp;inside&nbsp;escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658688">if</span>&nbsp;<span class="ident" id="4658691">ch</span>&nbsp;<span class="op" id="4658694">==</span>&nbsp;<span class="ident" id="4658697">b</span><span class="op" id="4658698">.</span><span class="ident" id="4658699">endChar</span>&nbsp;<span class="op" id="4658707">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658713">//&nbsp;end&nbsp;of&nbsp;tag/entity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658738">j</span>&nbsp;<span class="op" id="4658740">:=</span>&nbsp;<span class="ident" id="4658743">i</span>&nbsp;<span class="op" id="4658745">+</span>&nbsp;<span class="num" id="4658747">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658753">if</span>&nbsp;<span class="ident" id="4658756">ch</span>&nbsp;<span class="op" id="4658759">==</span>&nbsp;<span class="ident" id="4658762">Escape</span>&nbsp;<span class="op" id="4658769">&amp;&amp;</span>&nbsp;<span class="ident" id="4658772">b</span><span class="op" id="4658773">.</span><span class="ident" id="4658774">flags</span><span class="op" id="4658779">&amp;</span><span class="ident" id="4658780">StripEscape</span>&nbsp;<span class="op" id="4658792">!=</span>&nbsp;<span class="num" id="4658795">0</span>&nbsp;<span class="op" id="4658797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658804">j</span>&nbsp;<span class="op" id="4658806">=</span>&nbsp;<span class="ident" id="4658808">i</span>&nbsp;<span class="comment" id="4658810">//&nbsp;strip&nbsp;Escape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658830">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658836">b</span><span class="op" id="4658837">.</span><span class="builtinfunc" id="4658838">append</span><span class="op" id="4658844">(</span><span class="ident" id="4658845">buf</span><span class="op" id="4658848">[</span><span class="ident" id="4658849">n</span><span class="op" id="4658850">:</span><span class="ident" id="4658851">j</span><span class="op" id="4658852">]</span><span class="op" id="4658853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658859">n</span>&nbsp;<span class="op" id="4658861">=</span>&nbsp;<span class="ident" id="4658863">i</span>&nbsp;<span class="op" id="4658865">+</span>&nbsp;<span class="num" id="4658867">1</span>&nbsp;<span class="comment" id="4658869">//&nbsp;ch&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658888">b</span><span class="op" id="4658889">.</span><span class="ident" id="4658890">endEscape</span><span class="op" id="4658899">(</span><span class="op" id="4658900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658909">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4658912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4658916">//&nbsp;append&nbsp;leftover&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658941">b</span><span class="op" id="4658942">.</span><span class="builtinfunc" id="4658943">append</span><span class="op" id="4658949">(</span><span class="ident" id="4658950">buf</span><span class="op" id="4658953">[</span><span class="ident" id="4658954">n</span><span class="op" id="4658955">:</span><span class="op" id="4658956">]</span><span class="op" id="4658957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4658960">n</span>&nbsp;<span class="op" id="4658962">=</span>&nbsp;<span class="builtinfunc" id="4658964">len</span><span class="op" id="4658967">(</span><span class="ident" id="4658968">buf</span><span class="op" id="4658971">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4658974">return</span><br>
<span class="lineno"></span><span class="op" id="4658981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4658984">//&nbsp;NewWriter&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;a&nbsp;new&nbsp;tabwriter.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4659047">//&nbsp;The&nbsp;parameters&nbsp;are&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;the&nbsp;Init&nbsp;function.</span><br>
<span class="lineno">555</span><span class="comment" id="4659104">//</span><br>
<span class="lineno"></span><span class="keyword" id="4659107">func</span>&nbsp;<span class="ident" id="4659112">NewWriter</span><span class="op" id="4659121">(</span><span class="ident" id="4659122">output</span>&nbsp;<span class="ident" id="4659129">io</span><span class="op" id="4659131">.</span><span class="ident" id="4659132">Writer</span><span class="op" id="4659138">,</span>&nbsp;<span class="ident" id="4659140">minwidth</span><span class="op" id="4659148">,</span>&nbsp;<span class="ident" id="4659150">tabwidth</span><span class="op" id="4659158">,</span>&nbsp;<span class="ident" id="4659160">padding</span>&nbsp;<span class="builtintype" id="4659168">int</span><span class="op" id="4659171">,</span>&nbsp;<span class="ident" id="4659173">padchar</span>&nbsp;<span class="builtintype" id="4659181">byte</span><span class="op" id="4659185">,</span>&nbsp;<span class="ident" id="4659187">flags</span>&nbsp;<span class="builtintype" id="4659193">uint</span><span class="op" id="4659197">)</span>&nbsp;<span class="op" id="4659199">*</span><span class="ident" id="4659200">Writer</span>&nbsp;<span class="op" id="4659207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4659210">return</span>&nbsp;<span class="builtinfunc" id="4659217">new</span><span class="op" id="4659220">(</span><span class="ident" id="4659221">Writer</span><span class="op" id="4659227">)</span><span class="op" id="4659228">.</span><span class="ident" id="4659229">Init</span><span class="op" id="4659233">(</span><span class="ident" id="4659234">output</span><span class="op" id="4659240">,</span>&nbsp;<span class="ident" id="4659242">minwidth</span><span class="op" id="4659250">,</span>&nbsp;<span class="ident" id="4659252">tabwidth</span><span class="op" id="4659260">,</span>&nbsp;<span class="ident" id="4659262">padding</span><span class="op" id="4659269">,</span>&nbsp;<span class="ident" id="4659271">padchar</span><span class="op" id="4659278">,</span>&nbsp;<span class="ident" id="4659280">flags</span><span class="op" id="4659285">)</span><br>
<span class="lineno"></span><span class="op" id="4659287">}</span>
</div>
</body>
</html>
