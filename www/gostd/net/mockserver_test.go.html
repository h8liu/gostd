<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7842167">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7842222">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7842276">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7842327">package</span>&nbsp;<span class="ident" id="7842335">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7842340">import</span>&nbsp;<span class="string" id="7842347">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7842355">type</span>&nbsp;<span class="ident" id="7842360">streamListener</span>&nbsp;<span class="keyword" id="7842375">struct</span>&nbsp;<span class="op" id="7842382">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842385">net</span><span class="op" id="7842388">,</span>&nbsp;<span class="ident" id="7842390">addr</span>&nbsp;<span class="builtintype" id="7842395">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842403">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7842413">Listener</span><br>
<span class="lineno"></span><span class="op" id="7842422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7842425">type</span>&nbsp;<span class="ident" id="7842430">dualStackServer</span>&nbsp;<span class="keyword" id="7842446">struct</span>&nbsp;<span class="op" id="7842453">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842456">lnmu</span>&nbsp;<span class="ident" id="7842461">sync</span><span class="op" id="7842465">.</span><span class="ident" id="7842466">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842475">lns</span>&nbsp;&nbsp;<span class="op" id="7842480">[</span><span class="op" id="7842481">]</span><span class="ident" id="7842482">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842498">port</span>&nbsp;<span class="builtintype" id="7842503">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842512">cmu</span>&nbsp;<span class="ident" id="7842516">sync</span><span class="op" id="7842520">.</span><span class="ident" id="7842521">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842530">cs</span>&nbsp;&nbsp;<span class="op" id="7842534">[</span><span class="op" id="7842535">]</span><span class="ident" id="7842536">Conn</span>&nbsp;<span class="comment" id="7842541">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="7842593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7842596">func</span>&nbsp;<span class="op" id="7842601">(</span><span class="ident" id="7842602">dss</span>&nbsp;<span class="op" id="7842606">*</span><span class="ident" id="7842607">dualStackServer</span><span class="op" id="7842622">)</span>&nbsp;<span class="ident" id="7842624">buildup</span><span class="op" id="7842631">(</span><span class="ident" id="7842632">server</span>&nbsp;<span class="keyword" id="7842639">func</span><span class="op" id="7842643">(</span><span class="op" id="7842644">*</span><span class="ident" id="7842645">dualStackServer</span><span class="op" id="7842660">,</span>&nbsp;<span class="ident" id="7842662">Listener</span><span class="op" id="7842670">)</span><span class="op" id="7842671">)</span>&nbsp;<span class="builtintype" id="7842673">error</span>&nbsp;<span class="op" id="7842679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842682">for</span>&nbsp;<span class="ident" id="7842686">i</span>&nbsp;<span class="op" id="7842688">:=</span>&nbsp;<span class="keyword" id="7842691">range</span>&nbsp;<span class="ident" id="7842697">dss</span><span class="op" id="7842700">.</span><span class="ident" id="7842701">lns</span>&nbsp;<span class="op" id="7842705">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842709">go</span>&nbsp;<span class="ident" id="7842712">server</span><span class="op" id="7842718">(</span><span class="ident" id="7842719">dss</span><span class="op" id="7842722">,</span>&nbsp;<span class="ident" id="7842724">dss</span><span class="op" id="7842727">.</span><span class="ident" id="7842728">lns</span><span class="op" id="7842731">[</span><span class="ident" id="7842732">i</span><span class="op" id="7842733">]</span><span class="op" id="7842734">.</span><span class="ident" id="7842735">ln</span><span class="op" id="7842737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7842740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842743">return</span>&nbsp;<span class="ident" id="7842750">nil</span><br>
<span class="lineno"></span><span class="op" id="7842754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7842757">func</span>&nbsp;<span class="op" id="7842762">(</span><span class="ident" id="7842763">dss</span>&nbsp;<span class="op" id="7842767">*</span><span class="ident" id="7842768">dualStackServer</span><span class="op" id="7842783">)</span>&nbsp;<span class="ident" id="7842785">putConn</span><span class="op" id="7842792">(</span><span class="ident" id="7842793">c</span>&nbsp;<span class="ident" id="7842795">Conn</span><span class="op" id="7842799">)</span>&nbsp;<span class="builtintype" id="7842801">error</span>&nbsp;<span class="op" id="7842807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842810">dss</span><span class="op" id="7842813">.</span><span class="ident" id="7842814">cmu</span><span class="op" id="7842817">.</span><span class="ident" id="7842818">Lock</span><span class="op" id="7842822">(</span><span class="op" id="7842823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842826">dss</span><span class="op" id="7842829">.</span><span class="ident" id="7842830">cs</span>&nbsp;<span class="op" id="7842833">=</span>&nbsp;<span class="builtinfunc" id="7842835">append</span><span class="op" id="7842841">(</span><span class="ident" id="7842842">dss</span><span class="op" id="7842845">.</span><span class="ident" id="7842846">cs</span><span class="op" id="7842848">,</span>&nbsp;<span class="ident" id="7842850">c</span><span class="op" id="7842851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842854">dss</span><span class="op" id="7842857">.</span><span class="ident" id="7842858">cmu</span><span class="op" id="7842861">.</span><span class="ident" id="7842862">Unlock</span><span class="op" id="7842868">(</span><span class="op" id="7842869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842872">return</span>&nbsp;<span class="ident" id="7842879">nil</span><br>
<span class="lineno">35</span><span class="op" id="7842883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7842886">func</span>&nbsp;<span class="op" id="7842891">(</span><span class="ident" id="7842892">dss</span>&nbsp;<span class="op" id="7842896">*</span><span class="ident" id="7842897">dualStackServer</span><span class="op" id="7842912">)</span>&nbsp;<span class="ident" id="7842914">teardownNetwork</span><span class="op" id="7842929">(</span><span class="ident" id="7842930">net</span>&nbsp;<span class="builtintype" id="7842934">string</span><span class="op" id="7842940">)</span>&nbsp;<span class="builtintype" id="7842942">error</span>&nbsp;<span class="op" id="7842948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7842951">dss</span><span class="op" id="7842954">.</span><span class="ident" id="7842955">lnmu</span><span class="op" id="7842959">.</span><span class="ident" id="7842960">Lock</span><span class="op" id="7842964">(</span><span class="op" id="7842965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842968">for</span>&nbsp;<span class="ident" id="7842972">i</span>&nbsp;<span class="op" id="7842974">:=</span>&nbsp;<span class="keyword" id="7842977">range</span>&nbsp;<span class="ident" id="7842983">dss</span><span class="op" id="7842986">.</span><span class="ident" id="7842987">lns</span>&nbsp;<span class="op" id="7842991">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7842995">if</span>&nbsp;<span class="ident" id="7842998">net</span>&nbsp;<span class="op" id="7843002">==</span>&nbsp;<span class="ident" id="7843005">dss</span><span class="op" id="7843008">.</span><span class="ident" id="7843009">lns</span><span class="op" id="7843012">[</span><span class="ident" id="7843013">i</span><span class="op" id="7843014">]</span><span class="op" id="7843015">.</span><span class="ident" id="7843016">net</span>&nbsp;<span class="op" id="7843020">&amp;&amp;</span>&nbsp;<span class="ident" id="7843023">dss</span><span class="op" id="7843026">.</span><span class="ident" id="7843027">lns</span><span class="op" id="7843030">[</span><span class="ident" id="7843031">i</span><span class="op" id="7843032">]</span><span class="op" id="7843033">.</span><span class="ident" id="7843034">ln</span>&nbsp;<span class="op" id="7843037">!=</span>&nbsp;<span class="ident" id="7843040">nil</span>&nbsp;<span class="op" id="7843044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843049">dss</span><span class="op" id="7843052">.</span><span class="ident" id="7843053">lns</span><span class="op" id="7843056">[</span><span class="ident" id="7843057">i</span><span class="op" id="7843058">]</span><span class="op" id="7843059">.</span><span class="ident" id="7843060">ln</span><span class="op" id="7843062">.</span><span class="ident" id="7843063">Close</span><span class="op" id="7843068">(</span><span class="op" id="7843069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843074">dss</span><span class="op" id="7843077">.</span><span class="ident" id="7843078">lns</span><span class="op" id="7843081">[</span><span class="ident" id="7843082">i</span><span class="op" id="7843083">]</span><span class="op" id="7843084">.</span><span class="ident" id="7843085">ln</span>&nbsp;<span class="op" id="7843088">=</span>&nbsp;<span class="ident" id="7843090">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843099">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843102">dss</span><span class="op" id="7843105">.</span><span class="ident" id="7843106">lnmu</span><span class="op" id="7843110">.</span><span class="ident" id="7843111">Unlock</span><span class="op" id="7843117">(</span><span class="op" id="7843118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843121">return</span>&nbsp;<span class="ident" id="7843128">nil</span><br>
<span class="lineno"></span><span class="op" id="7843132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7843135">func</span>&nbsp;<span class="op" id="7843140">(</span><span class="ident" id="7843141">dss</span>&nbsp;<span class="op" id="7843145">*</span><span class="ident" id="7843146">dualStackServer</span><span class="op" id="7843161">)</span>&nbsp;<span class="ident" id="7843163">teardown</span><span class="op" id="7843171">(</span><span class="op" id="7843172">)</span>&nbsp;<span class="builtintype" id="7843174">error</span>&nbsp;<span class="op" id="7843180">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843183">dss</span><span class="op" id="7843186">.</span><span class="ident" id="7843187">lnmu</span><span class="op" id="7843191">.</span><span class="ident" id="7843192">Lock</span><span class="op" id="7843196">(</span><span class="op" id="7843197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843200">for</span>&nbsp;<span class="ident" id="7843204">i</span>&nbsp;<span class="op" id="7843206">:=</span>&nbsp;<span class="keyword" id="7843209">range</span>&nbsp;<span class="ident" id="7843215">dss</span><span class="op" id="7843218">.</span><span class="ident" id="7843219">lns</span>&nbsp;<span class="op" id="7843223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843227">if</span>&nbsp;<span class="ident" id="7843230">dss</span><span class="op" id="7843233">.</span><span class="ident" id="7843234">lns</span><span class="op" id="7843237">[</span><span class="ident" id="7843238">i</span><span class="op" id="7843239">]</span><span class="op" id="7843240">.</span><span class="ident" id="7843241">ln</span>&nbsp;<span class="op" id="7843244">!=</span>&nbsp;<span class="ident" id="7843247">nil</span>&nbsp;<span class="op" id="7843251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843256">dss</span><span class="op" id="7843259">.</span><span class="ident" id="7843260">lns</span><span class="op" id="7843263">[</span><span class="ident" id="7843264">i</span><span class="op" id="7843265">]</span><span class="op" id="7843266">.</span><span class="ident" id="7843267">ln</span><span class="op" id="7843269">.</span><span class="ident" id="7843270">Close</span><span class="op" id="7843275">(</span><span class="op" id="7843276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843280">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843286">dss</span><span class="op" id="7843289">.</span><span class="ident" id="7843290">lnmu</span><span class="op" id="7843294">.</span><span class="ident" id="7843295">Unlock</span><span class="op" id="7843301">(</span><span class="op" id="7843302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843305">dss</span><span class="op" id="7843308">.</span><span class="ident" id="7843309">cmu</span><span class="op" id="7843312">.</span><span class="ident" id="7843313">Lock</span><span class="op" id="7843317">(</span><span class="op" id="7843318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843321">for</span>&nbsp;<span class="ident" id="7843325">_</span><span class="op" id="7843326">,</span>&nbsp;<span class="ident" id="7843328">c</span>&nbsp;<span class="op" id="7843330">:=</span>&nbsp;<span class="keyword" id="7843333">range</span>&nbsp;<span class="ident" id="7843339">dss</span><span class="op" id="7843342">.</span><span class="ident" id="7843343">cs</span>&nbsp;<span class="op" id="7843346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843350">c</span><span class="op" id="7843351">.</span><span class="ident" id="7843352">Close</span><span class="op" id="7843357">(</span><span class="op" id="7843358">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843364">dss</span><span class="op" id="7843367">.</span><span class="ident" id="7843368">cmu</span><span class="op" id="7843371">.</span><span class="ident" id="7843372">Unlock</span><span class="op" id="7843378">(</span><span class="op" id="7843379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843382">return</span>&nbsp;<span class="ident" id="7843389">nil</span><br>
<span class="lineno"></span><span class="op" id="7843393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="7843396">func</span>&nbsp;<span class="ident" id="7843401">newDualStackServer</span><span class="op" id="7843419">(</span><span class="ident" id="7843420">lns</span>&nbsp;<span class="op" id="7843424">[</span><span class="op" id="7843425">]</span><span class="ident" id="7843426">streamListener</span><span class="op" id="7843440">)</span>&nbsp;<span class="op" id="7843442">(</span><span class="op" id="7843443">*</span><span class="ident" id="7843444">dualStackServer</span><span class="op" id="7843459">,</span>&nbsp;<span class="builtintype" id="7843461">error</span><span class="op" id="7843466">)</span>&nbsp;<span class="op" id="7843468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843471">dss</span>&nbsp;<span class="op" id="7843475">:=</span>&nbsp;<span class="op" id="7843478">&amp;</span><span class="ident" id="7843479">dualStackServer</span><span class="op" id="7843494">{</span><span class="ident" id="7843495">lns</span><span class="op" id="7843498">:</span>&nbsp;<span class="ident" id="7843500">lns</span><span class="op" id="7843503">,</span>&nbsp;<span class="ident" id="7843505">port</span><span class="op" id="7843509">:</span>&nbsp;<span class="string" id="7843511">&#34;0&#34;</span><span class="op" id="7843514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843517">for</span>&nbsp;<span class="ident" id="7843521">i</span>&nbsp;<span class="op" id="7843523">:=</span>&nbsp;<span class="keyword" id="7843526">range</span>&nbsp;<span class="ident" id="7843532">dss</span><span class="op" id="7843535">.</span><span class="ident" id="7843536">lns</span>&nbsp;<span class="op" id="7843540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843544">ln</span><span class="op" id="7843546">,</span>&nbsp;<span class="ident" id="7843548">err</span>&nbsp;<span class="op" id="7843552">:=</span>&nbsp;<span class="ident" id="7843555">Listen</span><span class="op" id="7843561">(</span><span class="ident" id="7843562">dss</span><span class="op" id="7843565">.</span><span class="ident" id="7843566">lns</span><span class="op" id="7843569">[</span><span class="ident" id="7843570">i</span><span class="op" id="7843571">]</span><span class="op" id="7843572">.</span><span class="ident" id="7843573">net</span><span class="op" id="7843576">,</span>&nbsp;<span class="ident" id="7843578">dss</span><span class="op" id="7843581">.</span><span class="ident" id="7843582">lns</span><span class="op" id="7843585">[</span><span class="ident" id="7843586">i</span><span class="op" id="7843587">]</span><span class="op" id="7843588">.</span><span class="ident" id="7843589">addr</span><span class="op" id="7843593">+</span><span class="string" id="7843594">&#34;:&#34;</span><span class="op" id="7843597">+</span><span class="ident" id="7843598">dss</span><span class="op" id="7843601">.</span><span class="ident" id="7843602">port</span><span class="op" id="7843606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843610">if</span>&nbsp;<span class="ident" id="7843613">err</span>&nbsp;<span class="op" id="7843617">!=</span>&nbsp;<span class="ident" id="7843620">nil</span>&nbsp;<span class="op" id="7843624">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843629">dss</span><span class="op" id="7843632">.</span><span class="ident" id="7843633">teardown</span><span class="op" id="7843641">(</span><span class="op" id="7843642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843647">return</span>&nbsp;<span class="ident" id="7843654">nil</span><span class="op" id="7843657">,</span>&nbsp;<span class="ident" id="7843659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843669">dss</span><span class="op" id="7843672">.</span><span class="ident" id="7843673">lns</span><span class="op" id="7843676">[</span><span class="ident" id="7843677">i</span><span class="op" id="7843678">]</span><span class="op" id="7843679">.</span><span class="ident" id="7843680">ln</span>&nbsp;<span class="op" id="7843683">=</span>&nbsp;<span class="ident" id="7843685">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843690">if</span>&nbsp;<span class="ident" id="7843693">dss</span><span class="op" id="7843696">.</span><span class="ident" id="7843697">port</span>&nbsp;<span class="op" id="7843702">==</span>&nbsp;<span class="string" id="7843705">&#34;0&#34;</span>&nbsp;<span class="op" id="7843709">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843714">if</span>&nbsp;<span class="ident" id="7843717">_</span><span class="op" id="7843718">,</span>&nbsp;<span class="ident" id="7843720">dss</span><span class="op" id="7843723">.</span><span class="ident" id="7843724">port</span><span class="op" id="7843728">,</span>&nbsp;<span class="ident" id="7843730">err</span>&nbsp;<span class="op" id="7843734">=</span>&nbsp;<span class="ident" id="7843736">SplitHostPort</span><span class="op" id="7843749">(</span><span class="ident" id="7843750">ln</span><span class="op" id="7843752">.</span><span class="ident" id="7843753">Addr</span><span class="op" id="7843757">(</span><span class="op" id="7843758">)</span><span class="op" id="7843759">.</span><span class="ident" id="7843760">String</span><span class="op" id="7843766">(</span><span class="op" id="7843767">)</span><span class="op" id="7843768">)</span><span class="op" id="7843769">;</span>&nbsp;<span class="ident" id="7843771">err</span>&nbsp;<span class="op" id="7843775">!=</span>&nbsp;<span class="ident" id="7843778">nil</span>&nbsp;<span class="op" id="7843782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7843788">dss</span><span class="op" id="7843791">.</span><span class="ident" id="7843792">teardown</span><span class="op" id="7843800">(</span><span class="op" id="7843801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843807">return</span>&nbsp;<span class="ident" id="7843814">nil</span><span class="op" id="7843817">,</span>&nbsp;<span class="ident" id="7843819">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843830">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7843833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7843836">return</span>&nbsp;<span class="ident" id="7843843">dss</span><span class="op" id="7843846">,</span>&nbsp;<span class="ident" id="7843848">nil</span><br>
<span class="lineno"></span><span class="op" id="7843852">}</span>
</div>
</body>
</html>
