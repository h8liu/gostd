<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/subtle</h2>
<ul>
<li><a href="/gostd/crypto/subtle/constant_time.go.html">constant_time.go</a></li>
<li><a href="/gostd/crypto/subtle/constant_time_test.go.html" class="current">constant_time_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6486275">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6486330">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6486384">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6486435">package</span>&nbsp;<span class="ident" id="6486443">subtle</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6486451">import</span>&nbsp;<span class="op" id="6486458">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6486461">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6486472">&#34;testing/quick&#34;</span><br>
<span class="lineno">10</span><span class="op" id="6486488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6486491">type</span>&nbsp;<span class="ident" id="6486496">TestConstantTimeCompareStruct</span>&nbsp;<span class="keyword" id="6486526">struct</span>&nbsp;<span class="op" id="6486533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486536">a</span><span class="op" id="6486537">,</span>&nbsp;<span class="ident" id="6486539">b</span>&nbsp;<span class="op" id="6486541">[</span><span class="op" id="6486542">]</span><span class="builtintype" id="6486543">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486549">out</span>&nbsp;&nbsp;<span class="builtintype" id="6486554">int</span><br>
<span class="lineno">15</span><span class="op" id="6486558">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6486561">var</span>&nbsp;<span class="ident" id="6486565">testConstantTimeCompareData</span>&nbsp;<span class="op" id="6486593">=</span>&nbsp;<span class="op" id="6486595">[</span><span class="op" id="6486596">]</span><span class="ident" id="6486597">TestConstantTimeCompareStruct</span><span class="op" id="6486626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486629">{</span><span class="op" id="6486630">[</span><span class="op" id="6486631">]</span><span class="builtintype" id="6486632">byte</span><span class="op" id="6486636">{</span><span class="op" id="6486637">}</span><span class="op" id="6486638">,</span>&nbsp;<span class="op" id="6486640">[</span><span class="op" id="6486641">]</span><span class="builtintype" id="6486642">byte</span><span class="op" id="6486646">{</span><span class="op" id="6486647">}</span><span class="op" id="6486648">,</span>&nbsp;<span class="num" id="6486650">1</span><span class="op" id="6486651">}</span><span class="op" id="6486652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486655">{</span><span class="op" id="6486656">[</span><span class="op" id="6486657">]</span><span class="builtintype" id="6486658">byte</span><span class="op" id="6486662">{</span><span class="num" id="6486663">0x11</span><span class="op" id="6486667">}</span><span class="op" id="6486668">,</span>&nbsp;<span class="op" id="6486670">[</span><span class="op" id="6486671">]</span><span class="builtintype" id="6486672">byte</span><span class="op" id="6486676">{</span><span class="num" id="6486677">0x11</span><span class="op" id="6486681">}</span><span class="op" id="6486682">,</span>&nbsp;<span class="num" id="6486684">1</span><span class="op" id="6486685">}</span><span class="op" id="6486686">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486689">{</span><span class="op" id="6486690">[</span><span class="op" id="6486691">]</span><span class="builtintype" id="6486692">byte</span><span class="op" id="6486696">{</span><span class="num" id="6486697">0x12</span><span class="op" id="6486701">}</span><span class="op" id="6486702">,</span>&nbsp;<span class="op" id="6486704">[</span><span class="op" id="6486705">]</span><span class="builtintype" id="6486706">byte</span><span class="op" id="6486710">{</span><span class="num" id="6486711">0x11</span><span class="op" id="6486715">}</span><span class="op" id="6486716">,</span>&nbsp;<span class="num" id="6486718">0</span><span class="op" id="6486719">}</span><span class="op" id="6486720">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486723">{</span><span class="op" id="6486724">[</span><span class="op" id="6486725">]</span><span class="builtintype" id="6486726">byte</span><span class="op" id="6486730">{</span><span class="num" id="6486731">0x11</span><span class="op" id="6486735">}</span><span class="op" id="6486736">,</span>&nbsp;<span class="op" id="6486738">[</span><span class="op" id="6486739">]</span><span class="builtintype" id="6486740">byte</span><span class="op" id="6486744">{</span><span class="num" id="6486745">0x11</span><span class="op" id="6486749">,</span>&nbsp;<span class="num" id="6486751">0x12</span><span class="op" id="6486755">}</span><span class="op" id="6486756">,</span>&nbsp;<span class="num" id="6486758">0</span><span class="op" id="6486759">}</span><span class="op" id="6486760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6486763">{</span><span class="op" id="6486764">[</span><span class="op" id="6486765">]</span><span class="builtintype" id="6486766">byte</span><span class="op" id="6486770">{</span><span class="num" id="6486771">0x11</span><span class="op" id="6486775">,</span>&nbsp;<span class="num" id="6486777">0x12</span><span class="op" id="6486781">}</span><span class="op" id="6486782">,</span>&nbsp;<span class="op" id="6486784">[</span><span class="op" id="6486785">]</span><span class="builtintype" id="6486786">byte</span><span class="op" id="6486790">{</span><span class="num" id="6486791">0x11</span><span class="op" id="6486795">}</span><span class="op" id="6486796">,</span>&nbsp;<span class="num" id="6486798">0</span><span class="op" id="6486799">}</span><span class="op" id="6486800">,</span><br>
<span class="lineno"></span><span class="op" id="6486802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6486805">func</span>&nbsp;<span class="ident" id="6486810">TestConstantTimeCompare</span><span class="op" id="6486833">(</span><span class="ident" id="6486834">t</span>&nbsp;<span class="op" id="6486836">*</span><span class="ident" id="6486837">testing</span><span class="op" id="6486844">.</span><span class="ident" id="6486845">T</span><span class="op" id="6486846">)</span>&nbsp;<span class="op" id="6486848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486851">for</span>&nbsp;<span class="ident" id="6486855">i</span><span class="op" id="6486856">,</span>&nbsp;<span class="ident" id="6486858">test</span>&nbsp;<span class="op" id="6486863">:=</span>&nbsp;<span class="keyword" id="6486866">range</span>&nbsp;<span class="ident" id="6486872">testConstantTimeCompareData</span>&nbsp;<span class="op" id="6486900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6486904">if</span>&nbsp;<span class="ident" id="6486907">r</span>&nbsp;<span class="op" id="6486909">:=</span>&nbsp;<span class="ident" id="6486912">ConstantTimeCompare</span><span class="op" id="6486931">(</span><span class="ident" id="6486932">test</span><span class="op" id="6486936">.</span><span class="ident" id="6486937">a</span><span class="op" id="6486938">,</span>&nbsp;<span class="ident" id="6486940">test</span><span class="op" id="6486944">.</span><span class="ident" id="6486945">b</span><span class="op" id="6486946">)</span><span class="op" id="6486947">;</span>&nbsp;<span class="ident" id="6486949">r</span>&nbsp;<span class="op" id="6486951">!=</span>&nbsp;<span class="ident" id="6486954">test</span><span class="op" id="6486958">.</span><span class="ident" id="6486959">out</span>&nbsp;<span class="op" id="6486963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6486968">t</span><span class="op" id="6486969">.</span><span class="ident" id="6486970">Errorf</span><span class="op" id="6486976">(</span><span class="string" id="6486977">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="6487011">,</span>&nbsp;<span class="ident" id="6487013">i</span><span class="op" id="6487014">,</span>&nbsp;<span class="ident" id="6487016">r</span><span class="op" id="6487017">,</span>&nbsp;<span class="ident" id="6487019">test</span><span class="op" id="6487023">.</span><span class="ident" id="6487024">out</span><span class="op" id="6487027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487031">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487034">}</span><br>
<span class="lineno"></span><span class="op" id="6487036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6487039">type</span>&nbsp;<span class="ident" id="6487044">TestConstantTimeByteEqStruct</span>&nbsp;<span class="keyword" id="6487073">struct</span>&nbsp;<span class="op" id="6487080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487083">a</span><span class="op" id="6487084">,</span>&nbsp;<span class="ident" id="6487086">b</span>&nbsp;<span class="builtintype" id="6487088">uint8</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487095">out</span>&nbsp;&nbsp;<span class="builtintype" id="6487100">int</span><br>
<span class="lineno"></span><span class="op" id="6487104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6487107">var</span>&nbsp;<span class="ident" id="6487111">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="6487138">=</span>&nbsp;<span class="op" id="6487140">[</span><span class="op" id="6487141">]</span><span class="ident" id="6487142">TestConstantTimeByteEqStruct</span><span class="op" id="6487170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487173">{</span><span class="num" id="6487174">0</span><span class="op" id="6487175">,</span>&nbsp;<span class="num" id="6487177">0</span><span class="op" id="6487178">,</span>&nbsp;<span class="num" id="6487180">1</span><span class="op" id="6487181">}</span><span class="op" id="6487182">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487185">{</span><span class="num" id="6487186">0</span><span class="op" id="6487187">,</span>&nbsp;<span class="num" id="6487189">1</span><span class="op" id="6487190">,</span>&nbsp;<span class="num" id="6487192">0</span><span class="op" id="6487193">}</span><span class="op" id="6487194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487197">{</span><span class="num" id="6487198">1</span><span class="op" id="6487199">,</span>&nbsp;<span class="num" id="6487201">0</span><span class="op" id="6487202">,</span>&nbsp;<span class="num" id="6487204">0</span><span class="op" id="6487205">}</span><span class="op" id="6487206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487209">{</span><span class="num" id="6487210">0xff</span><span class="op" id="6487214">,</span>&nbsp;<span class="num" id="6487216">0xff</span><span class="op" id="6487220">,</span>&nbsp;<span class="num" id="6487222">1</span><span class="op" id="6487223">}</span><span class="op" id="6487224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487227">{</span><span class="num" id="6487228">0xff</span><span class="op" id="6487232">,</span>&nbsp;<span class="num" id="6487234">0xfe</span><span class="op" id="6487238">,</span>&nbsp;<span class="num" id="6487240">0</span><span class="op" id="6487241">}</span><span class="op" id="6487242">,</span><br>
<span class="lineno"></span><span class="op" id="6487244">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6487247">func</span>&nbsp;<span class="ident" id="6487252">byteEq</span><span class="op" id="6487258">(</span><span class="ident" id="6487259">a</span><span class="op" id="6487260">,</span>&nbsp;<span class="ident" id="6487262">b</span>&nbsp;<span class="builtintype" id="6487264">uint8</span><span class="op" id="6487269">)</span>&nbsp;<span class="builtintype" id="6487271">int</span>&nbsp;<span class="op" id="6487275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487278">if</span>&nbsp;<span class="ident" id="6487281">a</span>&nbsp;<span class="op" id="6487283">==</span>&nbsp;<span class="ident" id="6487286">b</span>&nbsp;<span class="op" id="6487288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487292">return</span>&nbsp;<span class="num" id="6487299">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487302">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487305">return</span>&nbsp;<span class="num" id="6487312">0</span><br>
<span class="lineno"></span><span class="op" id="6487314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6487317">func</span>&nbsp;<span class="ident" id="6487322">TestConstantTimeByteEq</span><span class="op" id="6487344">(</span><span class="ident" id="6487345">t</span>&nbsp;<span class="op" id="6487347">*</span><span class="ident" id="6487348">testing</span><span class="op" id="6487355">.</span><span class="ident" id="6487356">T</span><span class="op" id="6487357">)</span>&nbsp;<span class="op" id="6487359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487362">for</span>&nbsp;<span class="ident" id="6487366">i</span><span class="op" id="6487367">,</span>&nbsp;<span class="ident" id="6487369">test</span>&nbsp;<span class="op" id="6487374">:=</span>&nbsp;<span class="keyword" id="6487377">range</span>&nbsp;<span class="ident" id="6487383">testConstandTimeByteEqData</span>&nbsp;<span class="op" id="6487410">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487414">if</span>&nbsp;<span class="ident" id="6487417">r</span>&nbsp;<span class="op" id="6487419">:=</span>&nbsp;<span class="ident" id="6487422">ConstantTimeByteEq</span><span class="op" id="6487440">(</span><span class="ident" id="6487441">test</span><span class="op" id="6487445">.</span><span class="ident" id="6487446">a</span><span class="op" id="6487447">,</span>&nbsp;<span class="ident" id="6487449">test</span><span class="op" id="6487453">.</span><span class="ident" id="6487454">b</span><span class="op" id="6487455">)</span><span class="op" id="6487456">;</span>&nbsp;<span class="ident" id="6487458">r</span>&nbsp;<span class="op" id="6487460">!=</span>&nbsp;<span class="ident" id="6487463">test</span><span class="op" id="6487467">.</span><span class="ident" id="6487468">out</span>&nbsp;<span class="op" id="6487472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487477">t</span><span class="op" id="6487478">.</span><span class="ident" id="6487479">Errorf</span><span class="op" id="6487485">(</span><span class="string" id="6487486">&#34;#%d&nbsp;bad&nbsp;result&nbsp;(got&nbsp;%x,&nbsp;want&nbsp;%x)&#34;</span><span class="op" id="6487520">,</span>&nbsp;<span class="ident" id="6487522">i</span><span class="op" id="6487523">,</span>&nbsp;<span class="ident" id="6487525">r</span><span class="op" id="6487526">,</span>&nbsp;<span class="ident" id="6487528">test</span><span class="op" id="6487532">.</span><span class="ident" id="6487533">out</span><span class="op" id="6487536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487546">err</span>&nbsp;<span class="op" id="6487550">:=</span>&nbsp;<span class="ident" id="6487553">quick</span><span class="op" id="6487558">.</span><span class="ident" id="6487559">CheckEqual</span><span class="op" id="6487569">(</span><span class="ident" id="6487570">ConstantTimeByteEq</span><span class="op" id="6487588">,</span>&nbsp;<span class="ident" id="6487590">byteEq</span><span class="op" id="6487596">,</span>&nbsp;<span class="ident" id="6487598">nil</span><span class="op" id="6487601">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487604">if</span>&nbsp;<span class="ident" id="6487607">err</span>&nbsp;<span class="op" id="6487611">!=</span>&nbsp;<span class="ident" id="6487614">nil</span>&nbsp;<span class="op" id="6487618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487622">t</span><span class="op" id="6487623">.</span><span class="ident" id="6487624">Error</span><span class="op" id="6487629">(</span><span class="ident" id="6487630">err</span><span class="op" id="6487633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487636">}</span><br>
<span class="lineno"></span><span class="op" id="6487638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6487641">func</span>&nbsp;<span class="ident" id="6487646">eq</span><span class="op" id="6487648">(</span><span class="ident" id="6487649">a</span><span class="op" id="6487650">,</span>&nbsp;<span class="ident" id="6487652">b</span>&nbsp;<span class="builtintype" id="6487654">int32</span><span class="op" id="6487659">)</span>&nbsp;<span class="builtintype" id="6487661">int</span>&nbsp;<span class="op" id="6487665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487668">if</span>&nbsp;<span class="ident" id="6487671">a</span>&nbsp;<span class="op" id="6487673">==</span>&nbsp;<span class="ident" id="6487676">b</span>&nbsp;<span class="op" id="6487678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487682">return</span>&nbsp;<span class="num" id="6487689">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487695">return</span>&nbsp;<span class="num" id="6487702">0</span><br>
<span class="lineno">70</span><span class="op" id="6487704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6487707">func</span>&nbsp;<span class="ident" id="6487712">TestConstantTimeEq</span><span class="op" id="6487730">(</span><span class="ident" id="6487731">t</span>&nbsp;<span class="op" id="6487733">*</span><span class="ident" id="6487734">testing</span><span class="op" id="6487741">.</span><span class="ident" id="6487742">T</span><span class="op" id="6487743">)</span>&nbsp;<span class="op" id="6487745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487748">err</span>&nbsp;<span class="op" id="6487752">:=</span>&nbsp;<span class="ident" id="6487755">quick</span><span class="op" id="6487760">.</span><span class="ident" id="6487761">CheckEqual</span><span class="op" id="6487771">(</span><span class="ident" id="6487772">ConstantTimeEq</span><span class="op" id="6487786">,</span>&nbsp;<span class="ident" id="6487788">eq</span><span class="op" id="6487790">,</span>&nbsp;<span class="ident" id="6487792">nil</span><span class="op" id="6487795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487798">if</span>&nbsp;<span class="ident" id="6487801">err</span>&nbsp;<span class="op" id="6487805">!=</span>&nbsp;<span class="ident" id="6487808">nil</span>&nbsp;<span class="op" id="6487812">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487816">t</span><span class="op" id="6487817">.</span><span class="ident" id="6487818">Error</span><span class="op" id="6487823">(</span><span class="ident" id="6487824">err</span><span class="op" id="6487827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487830">}</span><br>
<span class="lineno"></span><span class="op" id="6487832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6487835">func</span>&nbsp;<span class="ident" id="6487840">makeCopy</span><span class="op" id="6487848">(</span><span class="ident" id="6487849">v</span>&nbsp;<span class="builtintype" id="6487851">int</span><span class="op" id="6487854">,</span>&nbsp;<span class="ident" id="6487856">x</span><span class="op" id="6487857">,</span>&nbsp;<span class="ident" id="6487859">y</span>&nbsp;<span class="op" id="6487861">[</span><span class="op" id="6487862">]</span><span class="builtintype" id="6487863">byte</span><span class="op" id="6487867">)</span>&nbsp;<span class="op" id="6487869">[</span><span class="op" id="6487870">]</span><span class="builtintype" id="6487871">byte</span>&nbsp;<span class="op" id="6487876">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487879">if</span>&nbsp;<span class="builtinfunc" id="6487882">len</span><span class="op" id="6487885">(</span><span class="ident" id="6487886">x</span><span class="op" id="6487887">)</span>&nbsp;<span class="op" id="6487889">&gt;</span>&nbsp;<span class="builtinfunc" id="6487891">len</span><span class="op" id="6487894">(</span><span class="ident" id="6487895">y</span><span class="op" id="6487896">)</span>&nbsp;<span class="op" id="6487898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487902">x</span>&nbsp;<span class="op" id="6487904">=</span>&nbsp;<span class="ident" id="6487906">x</span><span class="op" id="6487907">[</span><span class="num" id="6487908">0</span><span class="op" id="6487909">:</span><span class="builtinfunc" id="6487910">len</span><span class="op" id="6487913">(</span><span class="ident" id="6487914">y</span><span class="op" id="6487915">)</span><span class="op" id="6487916">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487919">}</span>&nbsp;<span class="keyword" id="6487921">else</span>&nbsp;<span class="op" id="6487926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6487930">y</span>&nbsp;<span class="op" id="6487932">=</span>&nbsp;<span class="ident" id="6487934">y</span><span class="op" id="6487935">[</span><span class="num" id="6487936">0</span><span class="op" id="6487937">:</span><span class="builtinfunc" id="6487938">len</span><span class="op" id="6487941">(</span><span class="ident" id="6487942">x</span><span class="op" id="6487943">)</span><span class="op" id="6487944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487947">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487950">if</span>&nbsp;<span class="ident" id="6487953">v</span>&nbsp;<span class="op" id="6487955">==</span>&nbsp;<span class="num" id="6487958">1</span>&nbsp;<span class="op" id="6487960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6487964">copy</span><span class="op" id="6487968">(</span><span class="ident" id="6487969">x</span><span class="op" id="6487970">,</span>&nbsp;<span class="ident" id="6487972">y</span><span class="op" id="6487973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6487976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6487979">return</span>&nbsp;<span class="ident" id="6487986">x</span><br>
<span class="lineno"></span><span class="op" id="6487988">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6487991">func</span>&nbsp;<span class="ident" id="6487996">constantTimeCopyWrapper</span><span class="op" id="6488019">(</span><span class="ident" id="6488020">v</span>&nbsp;<span class="builtintype" id="6488022">int</span><span class="op" id="6488025">,</span>&nbsp;<span class="ident" id="6488027">x</span><span class="op" id="6488028">,</span>&nbsp;<span class="ident" id="6488030">y</span>&nbsp;<span class="op" id="6488032">[</span><span class="op" id="6488033">]</span><span class="builtintype" id="6488034">byte</span><span class="op" id="6488038">)</span>&nbsp;<span class="op" id="6488040">[</span><span class="op" id="6488041">]</span><span class="builtintype" id="6488042">byte</span>&nbsp;<span class="op" id="6488047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488050">if</span>&nbsp;<span class="builtinfunc" id="6488053">len</span><span class="op" id="6488056">(</span><span class="ident" id="6488057">x</span><span class="op" id="6488058">)</span>&nbsp;<span class="op" id="6488060">&gt;</span>&nbsp;<span class="builtinfunc" id="6488062">len</span><span class="op" id="6488065">(</span><span class="ident" id="6488066">y</span><span class="op" id="6488067">)</span>&nbsp;<span class="op" id="6488069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488073">x</span>&nbsp;<span class="op" id="6488075">=</span>&nbsp;<span class="ident" id="6488077">x</span><span class="op" id="6488078">[</span><span class="num" id="6488079">0</span><span class="op" id="6488080">:</span><span class="builtinfunc" id="6488081">len</span><span class="op" id="6488084">(</span><span class="ident" id="6488085">y</span><span class="op" id="6488086">)</span><span class="op" id="6488087">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488090">}</span>&nbsp;<span class="keyword" id="6488092">else</span>&nbsp;<span class="op" id="6488097">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488101">y</span>&nbsp;<span class="op" id="6488103">=</span>&nbsp;<span class="ident" id="6488105">y</span><span class="op" id="6488106">[</span><span class="num" id="6488107">0</span><span class="op" id="6488108">:</span><span class="builtinfunc" id="6488109">len</span><span class="op" id="6488112">(</span><span class="ident" id="6488113">x</span><span class="op" id="6488114">)</span><span class="op" id="6488115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488121">v</span>&nbsp;<span class="op" id="6488123">&amp;=</span>&nbsp;<span class="num" id="6488126">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488129">ConstantTimeCopy</span><span class="op" id="6488145">(</span><span class="ident" id="6488146">v</span><span class="op" id="6488147">,</span>&nbsp;<span class="ident" id="6488149">x</span><span class="op" id="6488150">,</span>&nbsp;<span class="ident" id="6488152">y</span><span class="op" id="6488153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488156">return</span>&nbsp;<span class="ident" id="6488163">x</span><br>
<span class="lineno">100</span><span class="op" id="6488165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6488168">func</span>&nbsp;<span class="ident" id="6488173">TestConstantTimeCopy</span><span class="op" id="6488193">(</span><span class="ident" id="6488194">t</span>&nbsp;<span class="op" id="6488196">*</span><span class="ident" id="6488197">testing</span><span class="op" id="6488204">.</span><span class="ident" id="6488205">T</span><span class="op" id="6488206">)</span>&nbsp;<span class="op" id="6488208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488211">err</span>&nbsp;<span class="op" id="6488215">:=</span>&nbsp;<span class="ident" id="6488218">quick</span><span class="op" id="6488223">.</span><span class="ident" id="6488224">CheckEqual</span><span class="op" id="6488234">(</span><span class="ident" id="6488235">constantTimeCopyWrapper</span><span class="op" id="6488258">,</span>&nbsp;<span class="ident" id="6488260">makeCopy</span><span class="op" id="6488268">,</span>&nbsp;<span class="ident" id="6488270">nil</span><span class="op" id="6488273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488276">if</span>&nbsp;<span class="ident" id="6488279">err</span>&nbsp;<span class="op" id="6488283">!=</span>&nbsp;<span class="ident" id="6488286">nil</span>&nbsp;<span class="op" id="6488290">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488294">t</span><span class="op" id="6488295">.</span><span class="ident" id="6488296">Error</span><span class="op" id="6488301">(</span><span class="ident" id="6488302">err</span><span class="op" id="6488305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488308">}</span><br>
<span class="lineno"></span><span class="op" id="6488310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6488313">var</span>&nbsp;<span class="ident" id="6488317">lessOrEqTests</span>&nbsp;<span class="op" id="6488331">=</span>&nbsp;<span class="op" id="6488333">[</span><span class="op" id="6488334">]</span><span class="keyword" id="6488335">struct</span>&nbsp;<span class="op" id="6488342">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488345">x</span><span class="op" id="6488346">,</span>&nbsp;<span class="ident" id="6488348">y</span><span class="op" id="6488349">,</span>&nbsp;<span class="ident" id="6488351">result</span>&nbsp;<span class="builtintype" id="6488358">int</span><br>
<span class="lineno"></span><span class="op" id="6488362">}</span><span class="op" id="6488363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488366">{</span><span class="num" id="6488367">0</span><span class="op" id="6488368">,</span>&nbsp;<span class="num" id="6488370">0</span><span class="op" id="6488371">,</span>&nbsp;<span class="num" id="6488373">1</span><span class="op" id="6488374">}</span><span class="op" id="6488375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488378">{</span><span class="num" id="6488379">1</span><span class="op" id="6488380">,</span>&nbsp;<span class="num" id="6488382">0</span><span class="op" id="6488383">,</span>&nbsp;<span class="num" id="6488385">0</span><span class="op" id="6488386">}</span><span class="op" id="6488387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488390">{</span><span class="num" id="6488391">0</span><span class="op" id="6488392">,</span>&nbsp;<span class="num" id="6488394">1</span><span class="op" id="6488395">,</span>&nbsp;<span class="num" id="6488397">1</span><span class="op" id="6488398">}</span><span class="op" id="6488399">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488402">{</span><span class="num" id="6488403">10</span><span class="op" id="6488405">,</span>&nbsp;<span class="num" id="6488407">20</span><span class="op" id="6488409">,</span>&nbsp;<span class="num" id="6488411">1</span><span class="op" id="6488412">}</span><span class="op" id="6488413">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488416">{</span><span class="num" id="6488417">20</span><span class="op" id="6488419">,</span>&nbsp;<span class="num" id="6488421">10</span><span class="op" id="6488423">,</span>&nbsp;<span class="num" id="6488425">0</span><span class="op" id="6488426">}</span><span class="op" id="6488427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488430">{</span><span class="num" id="6488431">10</span><span class="op" id="6488433">,</span>&nbsp;<span class="num" id="6488435">10</span><span class="op" id="6488437">,</span>&nbsp;<span class="num" id="6488439">1</span><span class="op" id="6488440">}</span><span class="op" id="6488441">,</span><br>
<span class="lineno"></span><span class="op" id="6488443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="6488446">func</span>&nbsp;<span class="ident" id="6488451">TestConstantTimeLessOrEq</span><span class="op" id="6488475">(</span><span class="ident" id="6488476">t</span>&nbsp;<span class="op" id="6488478">*</span><span class="ident" id="6488479">testing</span><span class="op" id="6488486">.</span><span class="ident" id="6488487">T</span><span class="op" id="6488488">)</span>&nbsp;<span class="op" id="6488490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488493">for</span>&nbsp;<span class="ident" id="6488497">i</span><span class="op" id="6488498">,</span>&nbsp;<span class="ident" id="6488500">test</span>&nbsp;<span class="op" id="6488505">:=</span>&nbsp;<span class="keyword" id="6488508">range</span>&nbsp;<span class="ident" id="6488514">lessOrEqTests</span>&nbsp;<span class="op" id="6488528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488532">result</span>&nbsp;<span class="op" id="6488539">:=</span>&nbsp;<span class="ident" id="6488542">ConstantTimeLessOrEq</span><span class="op" id="6488562">(</span><span class="ident" id="6488563">test</span><span class="op" id="6488567">.</span><span class="ident" id="6488568">x</span><span class="op" id="6488569">,</span>&nbsp;<span class="ident" id="6488571">test</span><span class="op" id="6488575">.</span><span class="ident" id="6488576">y</span><span class="op" id="6488577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6488581">if</span>&nbsp;<span class="ident" id="6488584">result</span>&nbsp;<span class="op" id="6488591">!=</span>&nbsp;<span class="ident" id="6488594">test</span><span class="op" id="6488598">.</span><span class="ident" id="6488599">result</span>&nbsp;<span class="op" id="6488606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6488611">t</span><span class="op" id="6488612">.</span><span class="ident" id="6488613">Errorf</span><span class="op" id="6488619">(</span><span class="string" id="6488620">&#34;#%d:&nbsp;%d&nbsp;&lt;=&nbsp;%d&nbsp;gave&nbsp;%d,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6488656">,</span>&nbsp;<span class="ident" id="6488658">i</span><span class="op" id="6488659">,</span>&nbsp;<span class="ident" id="6488661">test</span><span class="op" id="6488665">.</span><span class="ident" id="6488666">x</span><span class="op" id="6488667">,</span>&nbsp;<span class="ident" id="6488669">test</span><span class="op" id="6488673">.</span><span class="ident" id="6488674">y</span><span class="op" id="6488675">,</span>&nbsp;<span class="ident" id="6488677">result</span><span class="op" id="6488683">,</span>&nbsp;<span class="ident" id="6488685">test</span><span class="op" id="6488689">.</span><span class="ident" id="6488690">result</span><span class="op" id="6488696">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6488703">}</span><br>
<span class="lineno"></span><span class="op" id="6488705">}</span>
</div>
</body>
</html>
