<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword">package</span>&nbsp;<span class="ident">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">import</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/cipher&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/des&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/rc4&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;crypto/x509&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;a&nbsp;keyAgreement&nbsp;implements&nbsp;the&nbsp;client&nbsp;and&nbsp;server&nbsp;side&nbsp;of&nbsp;a&nbsp;TLS&nbsp;key&nbsp;agreement</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;protocol&nbsp;by&nbsp;generating&nbsp;and&nbsp;processing&nbsp;key&nbsp;exchange&nbsp;messages.</span><br>
<span class="lineno">20</span><span class="keyword">type</span>&nbsp;<span class="ident">keyAgreement</span>&nbsp;<span class="keyword">interface</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;On&nbsp;the&nbsp;server&nbsp;side,&nbsp;the&nbsp;first&nbsp;two&nbsp;methods&nbsp;are&nbsp;called&nbsp;in&nbsp;order.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;In&nbsp;the&nbsp;case&nbsp;that&nbsp;the&nbsp;key&nbsp;agreement&nbsp;protocol&nbsp;doesn&#39;t&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;ServerKeyExchange&nbsp;message,&nbsp;generateServerKeyExchange&nbsp;can&nbsp;return&nbsp;nil,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">generateServerKeyExchange</span><span class="op">(</span><span class="op">*</span><span class="ident">Config</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">Certificate</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">clientHelloMsg</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">serverHelloMsg</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">*</span><span class="ident">serverKeyExchangeMsg</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">processClientKeyExchange</span><span class="op">(</span><span class="op">*</span><span class="ident">Config</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">Certificate</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">clientKeyExchangeMsg</span><span class="op">,</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;On&nbsp;the&nbsp;client&nbsp;side,&nbsp;the&nbsp;next&nbsp;two&nbsp;methods&nbsp;are&nbsp;called&nbsp;in&nbsp;order.</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;This&nbsp;method&nbsp;may&nbsp;not&nbsp;be&nbsp;called&nbsp;if&nbsp;the&nbsp;server&nbsp;doesn&#39;t&nbsp;send&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;ServerKeyExchange&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">processServerKeyExchange</span><span class="op">(</span><span class="op">*</span><span class="ident">Config</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">clientHelloMsg</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">serverHelloMsg</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">x509</span><span class="op">.</span><span class="ident">Certificate</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">serverKeyExchangeMsg</span><span class="op">)</span>&nbsp;<span class="builtintype">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">generateClientKeyExchange</span><span class="op">(</span><span class="op">*</span><span class="ident">Config</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">clientHelloMsg</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">x509</span><span class="op">.</span><span class="ident">Certificate</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="op">*</span><span class="ident">clientKeyExchangeMsg</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span><br>
<span class="lineno">35</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;suiteECDH&nbsp;indicates&nbsp;that&nbsp;the&nbsp;cipher&nbsp;suite&nbsp;involves&nbsp;elliptic&nbsp;curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Diffie-Hellman.&nbsp;This&nbsp;means&nbsp;that&nbsp;it&nbsp;should&nbsp;only&nbsp;be&nbsp;selected&nbsp;when&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;client&nbsp;indicates&nbsp;that&nbsp;it&nbsp;supports&nbsp;ECC&nbsp;with&nbsp;a&nbsp;curve&nbsp;and&nbsp;point&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;that&nbsp;we&#39;re&nbsp;happy&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">suiteECDHE</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">1</span>&nbsp;<span class="op">&lt;&lt;</span>&nbsp;<span class="ident">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;suiteECDSA&nbsp;indicates&nbsp;that&nbsp;the&nbsp;cipher&nbsp;suite&nbsp;involves&nbsp;an&nbsp;ECDSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;signature&nbsp;and&nbsp;therefore&nbsp;may&nbsp;only&nbsp;be&nbsp;selected&nbsp;when&nbsp;the&nbsp;server&#39;s</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;certificate&nbsp;is&nbsp;ECDSA.&nbsp;If&nbsp;this&nbsp;is&nbsp;not&nbsp;set&nbsp;then&nbsp;the&nbsp;cipher&nbsp;suite&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;RSA&nbsp;based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">suiteECDSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;suiteTLS12&nbsp;indicates&nbsp;that&nbsp;the&nbsp;cipher&nbsp;suite&nbsp;should&nbsp;only&nbsp;be&nbsp;advertised</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;accepted&nbsp;when&nbsp;using&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">suiteTLS12</span><br>
<span class="lineno"></span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;cipherSuite&nbsp;is&nbsp;a&nbsp;specific&nbsp;combination&nbsp;of&nbsp;key&nbsp;agreement,&nbsp;cipher&nbsp;and&nbsp;MAC</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;function.&nbsp;All&nbsp;cipher&nbsp;suites&nbsp;currently&nbsp;assume&nbsp;RSA&nbsp;key&nbsp;agreement.</span><br>
<span class="lineno">55</span><span class="keyword">type</span>&nbsp;<span class="ident">cipherSuite</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">id</span>&nbsp;<span class="builtintype">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;the&nbsp;lengths,&nbsp;in&nbsp;bytes,&nbsp;of&nbsp;the&nbsp;key&nbsp;material&nbsp;needed&nbsp;for&nbsp;each&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">keyLen</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">macLen</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ivLen</span>&nbsp;&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">ka</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="ident">keyAgreement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;flags&nbsp;is&nbsp;a&nbsp;bitmask&nbsp;of&nbsp;the&nbsp;suite*&nbsp;values,&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">flags</span>&nbsp;&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cipher</span>&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">iv</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">isRead</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="keyword">interface</span><span class="op">{</span><span class="op">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mac</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">,</span>&nbsp;<span class="ident">macKey</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="ident">macFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">aead</span>&nbsp;&nbsp;&nbsp;<span class="keyword">func</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">fixedNonce</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">AEAD</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">cipherSuites</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="op">*</span><span class="ident">cipherSuite</span><span class="op">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;Ciphersuite&nbsp;order&nbsp;is&nbsp;chosen&nbsp;so&nbsp;that&nbsp;ECDHE&nbsp;comes&nbsp;before&nbsp;plain&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;and&nbsp;RC4&nbsp;comes&nbsp;before&nbsp;AES&nbsp;(because&nbsp;of&nbsp;the&nbsp;Lucky13&nbsp;attack).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">,</span>&nbsp;<span class="ident">ecdheRSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">suiteTLS12</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">aeadAESGCM</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="num">4</span><span class="op">,</span>&nbsp;<span class="ident">ecdheECDSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">suiteECDSA</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">suiteTLS12</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">,</span>&nbsp;<span class="ident">aeadAESGCM</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">ecdheRSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span><span class="op">,</span>&nbsp;<span class="ident">cipherRC4</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_ECDSA_WITH_RC4_128_SHA</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">ecdheECDSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">suiteECDSA</span><span class="op">,</span>&nbsp;<span class="ident">cipherRC4</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="ident">ecdheRSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span><span class="op">,</span>&nbsp;<span class="ident">cipherAES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="ident">ecdheECDSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">suiteECDSA</span><span class="op">,</span>&nbsp;<span class="ident">cipherAES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">32</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="ident">ecdheRSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span><span class="op">,</span>&nbsp;<span class="ident">cipherAES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">32</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="ident">ecdheECDSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span>&nbsp;<span class="op">|</span>&nbsp;<span class="ident">suiteECDSA</span><span class="op">,</span>&nbsp;<span class="ident">cipherAES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_RSA_WITH_RC4_128_SHA</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">rsaKA</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">cipherRC4</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="ident">rsaKA</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">cipherAES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_RSA_WITH_AES_256_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">32</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">16</span><span class="op">,</span>&nbsp;<span class="ident">rsaKA</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">cipherAES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">8</span><span class="op">,</span>&nbsp;<span class="ident">ecdheRSAKA</span><span class="op">,</span>&nbsp;<span class="ident">suiteECDHE</span><span class="op">,</span>&nbsp;<span class="ident">cipher3DES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">{</span><span class="ident">TLS_RSA_WITH_3DES_EDE_CBC_SHA</span><span class="op">,</span>&nbsp;<span class="num">24</span><span class="op">,</span>&nbsp;<span class="num">20</span><span class="op">,</span>&nbsp;<span class="num">8</span><span class="op">,</span>&nbsp;<span class="ident">rsaKA</span><span class="op">,</span>&nbsp;<span class="num">0</span><span class="op">,</span>&nbsp;<span class="ident">cipher3DES</span><span class="op">,</span>&nbsp;<span class="ident">macSHA1</span><span class="op">,</span>&nbsp;<span class="ident">nil</span><span class="op">}</span><span class="op">,</span><br>
<span class="lineno">85</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">cipherRC4</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">iv</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">isRead</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="keyword">interface</span><span class="op">{</span><span class="op">}</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">cipher</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">rc4</span><span class="op">.</span><span class="ident">NewCipher</span><span class="op">(</span><span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">cipher</span><br>
<span class="lineno">90</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">cipher3DES</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">iv</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">isRead</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="keyword">interface</span><span class="op">{</span><span class="op">}</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">des</span><span class="op">.</span><span class="ident">NewTripleDESCipher</span><span class="op">(</span><span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">isRead</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">NewCBCDecrypter</span><span class="op">(</span><span class="ident">block</span><span class="op">,</span>&nbsp;<span class="ident">iv</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">NewCBCEncrypter</span><span class="op">(</span><span class="ident">block</span><span class="op">,</span>&nbsp;<span class="ident">iv</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword">func</span>&nbsp;<span class="ident">cipherAES</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">iv</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="ident">isRead</span>&nbsp;<span class="builtintype">bool</span><span class="op">)</span>&nbsp;<span class="keyword">interface</span><span class="op">{</span><span class="op">}</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">block</span><span class="op">,</span>&nbsp;<span class="ident">_</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">aes</span><span class="op">.</span><span class="ident">NewCipher</span><span class="op">(</span><span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">isRead</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">NewCBCDecrypter</span><span class="op">(</span><span class="ident">block</span><span class="op">,</span>&nbsp;<span class="ident">iv</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">NewCBCEncrypter</span><span class="op">(</span><span class="ident">block</span><span class="op">,</span>&nbsp;<span class="ident">iv</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;macSHA1&nbsp;returns&nbsp;a&nbsp;macFunction&nbsp;for&nbsp;the&nbsp;given&nbsp;protocol&nbsp;version.</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">macSHA1</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">,</span>&nbsp;<span class="ident">key</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="ident">macFunction</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">version</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">VersionSSL30</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">mac</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">ssl30MAC</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span><span class="op">:</span>&nbsp;&nbsp;&nbsp;<span class="ident">sha1</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">key</span><span class="op">:</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtinfunc">len</span><span class="op">(</span><span class="ident">key</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">mac</span><span class="op">.</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">mac</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">tls10MAC</span><span class="op">{</span><span class="ident">hmac</span><span class="op">.</span><span class="ident">New</span><span class="op">(</span><span class="ident">sha1</span><span class="op">.</span><span class="ident">New</span><span class="op">,</span>&nbsp;<span class="ident">key</span><span class="op">)</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">macFunction</span>&nbsp;<span class="keyword">interface</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">Size</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">MAC</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">,</span>&nbsp;<span class="ident">seq</span><span class="op">,</span>&nbsp;<span class="ident">header</span><span class="op">,</span>&nbsp;<span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;fixedNonceAEAD&nbsp;wraps&nbsp;an&nbsp;AEAD&nbsp;and&nbsp;prefixes&nbsp;a&nbsp;fixed&nbsp;portion&nbsp;of&nbsp;the&nbsp;nonce&nbsp;to</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;each&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">fixedNonceAEAD</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;sealNonce&nbsp;and&nbsp;openNonce&nbsp;are&nbsp;buffers&nbsp;where&nbsp;the&nbsp;larger&nbsp;nonce&nbsp;will&nbsp;be</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;constructed.&nbsp;Since&nbsp;a&nbsp;seal&nbsp;and&nbsp;open&nbsp;operation&nbsp;may&nbsp;be&nbsp;running</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;concurrently,&nbsp;there&nbsp;is&nbsp;a&nbsp;separate&nbsp;buffer&nbsp;for&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sealNonce</span><span class="op">,</span>&nbsp;<span class="ident">openNonce</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">aead</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">AEAD</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">fixedNonceAEAD</span><span class="op">)</span>&nbsp;<span class="ident">NonceSize</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span>&nbsp;<span class="keyword">return</span>&nbsp;<span class="num">8</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">fixedNonceAEAD</span><span class="op">)</span>&nbsp;<span class="ident">Overhead</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;&nbsp;<span class="op">{</span>&nbsp;<span class="keyword">return</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">aead</span><span class="op">.</span><span class="ident">Overhead</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">fixedNonceAEAD</span><span class="op">)</span>&nbsp;<span class="ident">Seal</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">nonce</span><span class="op">,</span>&nbsp;<span class="ident">plaintext</span><span class="op">,</span>&nbsp;<span class="ident">additionalData</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">sealNonce</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">sealNonce</span><span class="op">)</span><span class="op">-</span><span class="num">8</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">nonce</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">aead</span><span class="op">.</span><span class="ident">Seal</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">sealNonce</span><span class="op">,</span>&nbsp;<span class="ident">plaintext</span><span class="op">,</span>&nbsp;<span class="ident">additionalData</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">f</span>&nbsp;<span class="op">*</span><span class="ident">fixedNonceAEAD</span><span class="op">)</span>&nbsp;<span class="ident">Open</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">nonce</span><span class="op">,</span>&nbsp;<span class="ident">plaintext</span><span class="op">,</span>&nbsp;<span class="ident">additionalData</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="builtintype">error</span><span class="op">)</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">openNonce</span><span class="op">[</span><span class="builtinfunc">len</span><span class="op">(</span><span class="ident">f</span><span class="op">.</span><span class="ident">openNonce</span><span class="op">)</span><span class="op">-</span><span class="num">8</span><span class="op">:</span><span class="op">]</span><span class="op">,</span>&nbsp;<span class="ident">nonce</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">aead</span><span class="op">.</span><span class="ident">Open</span><span class="op">(</span><span class="ident">out</span><span class="op">,</span>&nbsp;<span class="ident">f</span><span class="op">.</span><span class="ident">openNonce</span><span class="op">,</span>&nbsp;<span class="ident">plaintext</span><span class="op">,</span>&nbsp;<span class="ident">additionalData</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">aeadAESGCM</span><span class="op">(</span><span class="ident">key</span><span class="op">,</span>&nbsp;<span class="ident">fixedNonce</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">AEAD</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">aes</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">aes</span><span class="op">.</span><span class="ident">NewCipher</span><span class="op">(</span><span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">aead</span><span class="op">,</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="ident">cipher</span><span class="op">.</span><span class="ident">NewGCM</span><span class="op">(</span><span class="ident">aes</span><span class="op">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">err</span>&nbsp;<span class="op">!=</span>&nbsp;<span class="ident">nil</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">panic</span><span class="op">(</span><span class="ident">err</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">nonce1</span><span class="op">,</span>&nbsp;<span class="ident">nonce2</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="num">12</span><span class="op">)</span><span class="op">,</span>&nbsp;<span class="builtinfunc">make</span><span class="op">(</span><span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">,</span>&nbsp;<span class="num">12</span><span class="op">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">nonce1</span><span class="op">,</span>&nbsp;<span class="ident">fixedNonce</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc">copy</span><span class="op">(</span><span class="ident">nonce2</span><span class="op">,</span>&nbsp;<span class="ident">fixedNonce</span><span class="op">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">&amp;</span><span class="ident">fixedNonceAEAD</span><span class="op">{</span><span class="ident">nonce1</span><span class="op">,</span>&nbsp;<span class="ident">nonce2</span><span class="op">,</span>&nbsp;<span class="ident">aead</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ssl30MAC&nbsp;implements&nbsp;the&nbsp;SSLv3&nbsp;MAC&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;5.2.3.1</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">ssl30MAC</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span>&nbsp;&nbsp;&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">key</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">s</span>&nbsp;<span class="ident">ssl30MAC</span><span class="op">)</span>&nbsp;<span class="ident">Size</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Size</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">175</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">ssl30Pad1</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="num">48</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">{</span><span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">,</span>&nbsp;<span class="num">0x36</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">var</span>&nbsp;<span class="ident">ssl30Pad2</span>&nbsp;<span class="op">=</span>&nbsp;<span class="op">[</span><span class="num">48</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">{</span><span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">,</span>&nbsp;<span class="num">0x5c</span><span class="op">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">s</span>&nbsp;<span class="ident">ssl30MAC</span><span class="op">)</span>&nbsp;<span class="ident">MAC</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">,</span>&nbsp;<span class="ident">seq</span><span class="op">,</span>&nbsp;<span class="ident">header</span><span class="op">,</span>&nbsp;<span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">padLength</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="num">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Size</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="op">==</span>&nbsp;<span class="num">20</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">padLength</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">40</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">s</span><span class="op">.</span><span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">ssl30Pad1</span><span class="op">[</span><span class="op">:</span><span class="ident">padLength</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">seq</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">header</span><span class="op">[</span><span class="op">:</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">header</span><span class="op">[</span><span class="num">3</span><span class="op">:</span><span class="num">5</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">data</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">digestBuf</span>&nbsp;<span class="op">=</span>&nbsp;<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">[</span><span class="op">:</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">s</span><span class="op">.</span><span class="ident">key</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">ssl30Pad2</span><span class="op">[</span><span class="op">:</span><span class="ident">padLength</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">[</span><span class="op">:</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;tls10MAC&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;MAC&nbsp;function.&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.2.3.</span><br>
<span class="lineno"></span><span class="keyword">type</span>&nbsp;<span class="ident">tls10MAC</span>&nbsp;<span class="keyword">struct</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">h</span>&nbsp;<span class="ident">hash</span><span class="op">.</span><span class="ident">Hash</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">s</span>&nbsp;<span class="ident">tls10MAC</span><span class="op">)</span>&nbsp;<span class="ident">Size</span><span class="op">(</span><span class="op">)</span>&nbsp;<span class="builtintype">int</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Size</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno">210</span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="op">(</span><span class="ident">s</span>&nbsp;<span class="ident">tls10MAC</span><span class="op">)</span>&nbsp;<span class="ident">MAC</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">,</span>&nbsp;<span class="ident">seq</span><span class="op">,</span>&nbsp;<span class="ident">header</span><span class="op">,</span>&nbsp;<span class="ident">data</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span><span class="op">)</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">byte</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Reset</span><span class="op">(</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">seq</span><span class="op">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">header</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Write</span><span class="op">(</span><span class="ident">data</span><span class="op">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">s</span><span class="op">.</span><span class="ident">h</span><span class="op">.</span><span class="ident">Sum</span><span class="op">(</span><span class="ident">digestBuf</span><span class="op">[</span><span class="op">:</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword">func</span>&nbsp;<span class="ident">rsaKA</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="ident">keyAgreement</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">rsaKeyAgreement</span><span class="op">{</span><span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">ecdheECDSAKA</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="ident">keyAgreement</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">&amp;</span><span class="ident">ecdheKeyAgreement</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sigType</span><span class="op">:</span>&nbsp;<span class="ident">signatureECDSA</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">version</span><span class="op">:</span>&nbsp;<span class="ident">version</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword">func</span>&nbsp;<span class="ident">ecdheRSAKA</span><span class="op">(</span><span class="ident">version</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="ident">keyAgreement</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="op">&amp;</span><span class="ident">ecdheKeyAgreement</span><span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">sigType</span><span class="op">:</span>&nbsp;<span class="ident">signatureRSA</span><span class="op">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">version</span><span class="op">:</span>&nbsp;<span class="ident">version</span><span class="op">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;mutualCipherSuite&nbsp;returns&nbsp;a&nbsp;cipherSuite&nbsp;given&nbsp;a&nbsp;list&nbsp;of&nbsp;supported</span><br>
<span class="lineno"></span><span class="comment">//&nbsp;ciphersuites&nbsp;and&nbsp;the&nbsp;id&nbsp;requested&nbsp;by&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">240</span><span class="keyword">func</span>&nbsp;<span class="ident">mutualCipherSuite</span><span class="op">(</span><span class="ident">have</span>&nbsp;<span class="op">[</span><span class="op">]</span><span class="builtintype">uint16</span><span class="op">,</span>&nbsp;<span class="ident">want</span>&nbsp;<span class="builtintype">uint16</span><span class="op">)</span>&nbsp;<span class="op">*</span><span class="ident">cipherSuite</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">id</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">have</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">id</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">want</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">for</span>&nbsp;<span class="ident">_</span><span class="op">,</span>&nbsp;<span class="ident">suite</span>&nbsp;<span class="op">:=</span>&nbsp;<span class="keyword">range</span>&nbsp;<span class="ident">cipherSuites</span>&nbsp;<span class="op">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">if</span>&nbsp;<span class="ident">suite</span><span class="op">.</span><span class="ident">id</span>&nbsp;<span class="op">==</span>&nbsp;<span class="ident">want</span>&nbsp;<span class="op">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword">return</span>&nbsp;<span class="ident">nil</span><br>
<span class="lineno"></span><span class="op">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment">//&nbsp;A&nbsp;list&nbsp;of&nbsp;the&nbsp;possible&nbsp;cipher&nbsp;suite&nbsp;ids.&nbsp;Taken&nbsp;from</span><br>
<span class="lineno">255</span><span class="comment">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml</span><br>
<span class="lineno"></span><span class="keyword">const</span>&nbsp;<span class="op">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0x0005</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_RSA_WITH_3DES_EDE_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0x000a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0x002f</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_RSA_WITH_AES_256_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0x0035</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_ECDSA_WITH_RC4_128_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc007</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc009</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc00a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc011</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_RSA_WITH_3DES_EDE_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc012</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc013</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc014</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span>&nbsp;&nbsp;&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc02f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</span>&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0xc02b</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;TLS_FALLBACK_SCSV&nbsp;isn&#39;t&nbsp;a&nbsp;standard&nbsp;cipher&nbsp;suite&nbsp;but&nbsp;an&nbsp;indicator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;that&nbsp;the&nbsp;client&nbsp;is&nbsp;doing&nbsp;version&nbsp;fallback.&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment">//&nbsp;https://tools.ietf.org/html/draft-ietf-tls-downgrade-scsv-00.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident">TLS_FALLBACK_SCSV</span>&nbsp;<span class="builtintype">uint16</span>&nbsp;<span class="op">=</span>&nbsp;<span class="num">0x5600</span><br>
<span class="lineno">275</span><span class="op">)</span>
</div>
</body>
</html>
