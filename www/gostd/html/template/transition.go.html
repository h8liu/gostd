<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html" class="current">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5111339">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5111394">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5111448">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5111499">package</span>&nbsp;<span class="ident" id="5111507">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5111517">import</span>&nbsp;<span class="op" id="5111524">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111527">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5111536">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5111546">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5111549">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="5111628">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5111706">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="5111784">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5111794">var</span>&nbsp;<span class="ident" id="5111798">transitionFunc</span>&nbsp;<span class="op" id="5111813">=</span>&nbsp;<span class="op" id="5111815">[</span><span class="op" id="5111816">...</span><span class="op" id="5111819">]</span><span class="keyword" id="5111820">func</span><span class="op" id="5111824">(</span><span class="ident" id="5111825">context</span><span class="op" id="5111832">,</span>&nbsp;<span class="op" id="5111834">[</span><span class="op" id="5111835">]</span><span class="builtintype" id="5111836">byte</span><span class="op" id="5111840">)</span>&nbsp;<span class="op" id="5111842">(</span><span class="ident" id="5111843">context</span><span class="op" id="5111850">,</span>&nbsp;<span class="builtintype" id="5111852">int</span><span class="op" id="5111855">)</span><span class="op" id="5111856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111859">stateText</span><span class="op" id="5111868">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111877">tText</span><span class="op" id="5111882">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111885">stateTag</span><span class="op" id="5111893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111903">tTag</span><span class="op" id="5111907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111910">stateAttrName</span><span class="op" id="5111923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111928">tAttrName</span><span class="op" id="5111937">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111940">stateAfterName</span><span class="op" id="5111954">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5111958">tAfterName</span><span class="op" id="5111968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5111971">stateBeforeValue</span><span class="op" id="5111987">:</span>&nbsp;<span class="ident" id="5111989">tBeforeValue</span><span class="op" id="5112001">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112004">stateHTMLCmt</span><span class="op" id="5112016">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112022">tHTMLCmt</span><span class="op" id="5112030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112033">stateRCDATA</span><span class="op" id="5112044">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112051">tSpecialTagEnd</span><span class="op" id="5112065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112068">stateAttr</span><span class="op" id="5112077">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112086">tAttr</span><span class="op" id="5112091">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112094">stateURL</span><span class="op" id="5112102">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112112">tURL</span><span class="op" id="5112116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112119">stateJS</span><span class="op" id="5112126">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112137">tJS</span><span class="op" id="5112140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112143">stateJSDqStr</span><span class="op" id="5112155">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112161">tJSDelimited</span><span class="op" id="5112173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112176">stateJSSqStr</span><span class="op" id="5112188">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112194">tJSDelimited</span><span class="op" id="5112206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112209">stateJSRegexp</span><span class="op" id="5112222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112227">tJSDelimited</span><span class="op" id="5112239">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112242">stateJSBlockCmt</span><span class="op" id="5112257">:</span>&nbsp;&nbsp;<span class="ident" id="5112260">tBlockCmt</span><span class="op" id="5112269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112272">stateJSLineCmt</span><span class="op" id="5112286">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5112290">tLineCmt</span><span class="op" id="5112298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112301">stateCSS</span><span class="op" id="5112309">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112319">tCSS</span><span class="op" id="5112323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112326">stateCSSDqStr</span><span class="op" id="5112339">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112344">tCSSStr</span><span class="op" id="5112351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112354">stateCSSSqStr</span><span class="op" id="5112367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112372">tCSSStr</span><span class="op" id="5112379">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112382">stateCSSDqURL</span><span class="op" id="5112395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112400">tCSSStr</span><span class="op" id="5112407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112410">stateCSSSqURL</span><span class="op" id="5112423">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112428">tCSSStr</span><span class="op" id="5112435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112438">stateCSSURL</span><span class="op" id="5112449">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112456">tCSSStr</span><span class="op" id="5112463">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112466">stateCSSBlockCmt</span><span class="op" id="5112482">:</span>&nbsp;<span class="ident" id="5112484">tBlockCmt</span><span class="op" id="5112493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112496">stateCSSLineCmt</span><span class="op" id="5112511">:</span>&nbsp;&nbsp;<span class="ident" id="5112514">tLineCmt</span><span class="op" id="5112522">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112525">stateError</span><span class="op" id="5112535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112543">tError</span><span class="op" id="5112549">,</span><br>
<span class="lineno"></span><span class="op" id="5112551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5112554">var</span>&nbsp;<span class="ident" id="5112558">commentStart</span>&nbsp;<span class="op" id="5112571">=</span>&nbsp;<span class="op" id="5112573">[</span><span class="op" id="5112574">]</span><span class="builtintype" id="5112575">byte</span><span class="op" id="5112579">(</span><span class="string" id="5112580">&#34;&lt;!--&#34;</span><span class="op" id="5112586">)</span><br>
<span class="lineno"></span><span class="keyword" id="5112588">var</span>&nbsp;<span class="ident" id="5112592">commentEnd</span>&nbsp;<span class="op" id="5112603">=</span>&nbsp;<span class="op" id="5112605">[</span><span class="op" id="5112606">]</span><span class="builtintype" id="5112607">byte</span><span class="op" id="5112611">(</span><span class="string" id="5112612">&#34;--&gt;&#34;</span><span class="op" id="5112617">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5112620">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5112684">func</span>&nbsp;<span class="ident" id="5112689">tText</span><span class="op" id="5112694">(</span><span class="ident" id="5112695">c</span>&nbsp;<span class="ident" id="5112697">context</span><span class="op" id="5112704">,</span>&nbsp;<span class="ident" id="5112706">s</span>&nbsp;<span class="op" id="5112708">[</span><span class="op" id="5112709">]</span><span class="builtintype" id="5112710">byte</span><span class="op" id="5112714">)</span>&nbsp;<span class="op" id="5112716">(</span><span class="ident" id="5112717">context</span><span class="op" id="5112724">,</span>&nbsp;<span class="builtintype" id="5112726">int</span><span class="op" id="5112729">)</span>&nbsp;<span class="op" id="5112731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112734">k</span>&nbsp;<span class="op" id="5112736">:=</span>&nbsp;<span class="num" id="5112739">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5112742">for</span>&nbsp;<span class="op" id="5112746">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112750">i</span>&nbsp;<span class="op" id="5112752">:=</span>&nbsp;<span class="ident" id="5112755">k</span>&nbsp;<span class="op" id="5112757">+</span>&nbsp;<span class="ident" id="5112759">bytes</span><span class="op" id="5112764">.</span><span class="ident" id="5112765">IndexByte</span><span class="op" id="5112774">(</span><span class="ident" id="5112775">s</span><span class="op" id="5112776">[</span><span class="ident" id="5112777">k</span><span class="op" id="5112778">:</span><span class="op" id="5112779">]</span><span class="op" id="5112780">,</span>&nbsp;<span class="string" id="5112782">&#39;&lt;&#39;</span><span class="op" id="5112785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5112789">if</span>&nbsp;<span class="ident" id="5112792">i</span>&nbsp;<span class="op" id="5112794">&lt;</span>&nbsp;<span class="ident" id="5112796">k</span>&nbsp;<span class="op" id="5112798">||</span>&nbsp;<span class="ident" id="5112801">i</span><span class="op" id="5112802">+</span><span class="num" id="5112803">1</span>&nbsp;<span class="op" id="5112805">==</span>&nbsp;<span class="builtinfunc" id="5112808">len</span><span class="op" id="5112811">(</span><span class="ident" id="5112812">s</span><span class="op" id="5112813">)</span>&nbsp;<span class="op" id="5112815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5112820">return</span>&nbsp;<span class="ident" id="5112827">c</span><span class="op" id="5112828">,</span>&nbsp;<span class="builtinfunc" id="5112830">len</span><span class="op" id="5112833">(</span><span class="ident" id="5112834">s</span><span class="op" id="5112835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5112839">}</span>&nbsp;<span class="keyword" id="5112841">else</span>&nbsp;<span class="keyword" id="5112846">if</span>&nbsp;<span class="ident" id="5112849">i</span><span class="op" id="5112850">+</span><span class="num" id="5112851">4</span>&nbsp;<span class="op" id="5112853">&lt;=</span>&nbsp;<span class="builtinfunc" id="5112856">len</span><span class="op" id="5112859">(</span><span class="ident" id="5112860">s</span><span class="op" id="5112861">)</span>&nbsp;<span class="op" id="5112863">&amp;&amp;</span>&nbsp;<span class="ident" id="5112866">bytes</span><span class="op" id="5112871">.</span><span class="ident" id="5112872">Equal</span><span class="op" id="5112877">(</span><span class="ident" id="5112878">commentStart</span><span class="op" id="5112890">,</span>&nbsp;<span class="ident" id="5112892">s</span><span class="op" id="5112893">[</span><span class="ident" id="5112894">i</span><span class="op" id="5112895">:</span><span class="ident" id="5112896">i</span><span class="op" id="5112897">+</span><span class="num" id="5112898">4</span><span class="op" id="5112899">]</span><span class="op" id="5112900">)</span>&nbsp;<span class="op" id="5112902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5112907">return</span>&nbsp;<span class="ident" id="5112914">context</span><span class="op" id="5112921">{</span><span class="ident" id="5112922">state</span><span class="op" id="5112927">:</span>&nbsp;<span class="ident" id="5112929">stateHTMLCmt</span><span class="op" id="5112941">}</span><span class="op" id="5112942">,</span>&nbsp;<span class="ident" id="5112944">i</span>&nbsp;<span class="op" id="5112946">+</span>&nbsp;<span class="num" id="5112948">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5112952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112956">i</span><span class="op" id="5112957">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5112962">end</span>&nbsp;<span class="op" id="5112966">:=</span>&nbsp;<span class="builtintype" id="5112969">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5112977">if</span>&nbsp;<span class="ident" id="5112980">s</span><span class="op" id="5112981">[</span><span class="ident" id="5112982">i</span><span class="op" id="5112983">]</span>&nbsp;<span class="op" id="5112985">==</span>&nbsp;<span class="string" id="5112988">&#39;/&#39;</span>&nbsp;<span class="op" id="5112992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5112997">if</span>&nbsp;<span class="ident" id="5113000">i</span><span class="op" id="5113001">+</span><span class="num" id="5113002">1</span>&nbsp;<span class="op" id="5113004">==</span>&nbsp;<span class="builtinfunc" id="5113007">len</span><span class="op" id="5113010">(</span><span class="ident" id="5113011">s</span><span class="op" id="5113012">)</span>&nbsp;<span class="op" id="5113014">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113020">return</span>&nbsp;<span class="ident" id="5113027">c</span><span class="op" id="5113028">,</span>&nbsp;<span class="builtinfunc" id="5113030">len</span><span class="op" id="5113033">(</span><span class="ident" id="5113034">s</span><span class="op" id="5113035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113045">end</span><span class="op" id="5113048">,</span>&nbsp;<span class="ident" id="5113050">i</span>&nbsp;<span class="op" id="5113052">=</span>&nbsp;<span class="builtintype" id="5113054">true</span><span class="op" id="5113058">,</span>&nbsp;<span class="ident" id="5113060">i</span><span class="op" id="5113061">+</span><span class="num" id="5113062">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113070">j</span><span class="op" id="5113071">,</span>&nbsp;<span class="ident" id="5113073">e</span>&nbsp;<span class="op" id="5113075">:=</span>&nbsp;<span class="ident" id="5113078">eatTagName</span><span class="op" id="5113088">(</span><span class="ident" id="5113089">s</span><span class="op" id="5113090">,</span>&nbsp;<span class="ident" id="5113092">i</span><span class="op" id="5113093">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113097">if</span>&nbsp;<span class="ident" id="5113100">j</span>&nbsp;<span class="op" id="5113102">!=</span>&nbsp;<span class="ident" id="5113105">i</span>&nbsp;<span class="op" id="5113107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113112">if</span>&nbsp;<span class="ident" id="5113115">end</span>&nbsp;<span class="op" id="5113119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113125">e</span>&nbsp;<span class="op" id="5113127">=</span>&nbsp;<span class="ident" id="5113129">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5113149">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113180">return</span>&nbsp;<span class="ident" id="5113187">context</span><span class="op" id="5113194">{</span><span class="ident" id="5113195">state</span><span class="op" id="5113200">:</span>&nbsp;<span class="ident" id="5113202">stateTag</span><span class="op" id="5113210">,</span>&nbsp;<span class="ident" id="5113212">element</span><span class="op" id="5113219">:</span>&nbsp;<span class="ident" id="5113221">e</span><span class="op" id="5113222">}</span><span class="op" id="5113223">,</span>&nbsp;<span class="ident" id="5113225">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113233">k</span>&nbsp;<span class="op" id="5113235">=</span>&nbsp;<span class="ident" id="5113237">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113240">}</span><br>
<span class="lineno"></span><span class="op" id="5113242">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="5113245">var</span>&nbsp;<span class="ident" id="5113249">elementContentType</span>&nbsp;<span class="op" id="5113268">=</span>&nbsp;<span class="op" id="5113270">[</span><span class="op" id="5113271">...</span><span class="op" id="5113274">]</span><span class="ident" id="5113275">state</span><span class="op" id="5113280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113283">elementNone</span><span class="op" id="5113294">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113300">stateText</span><span class="op" id="5113309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113312">elementScript</span><span class="op" id="5113325">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5113329">stateJS</span><span class="op" id="5113336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113339">elementStyle</span><span class="op" id="5113351">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113356">stateCSS</span><span class="op" id="5113364">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113367">elementTextarea</span><span class="op" id="5113382">:</span>&nbsp;<span class="ident" id="5113384">stateRCDATA</span><span class="op" id="5113395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113398">elementTitle</span><span class="op" id="5113410">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113415">stateRCDATA</span><span class="op" id="5113426">,</span><br>
<span class="lineno"></span><span class="op" id="5113428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5113431">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="5113493">func</span>&nbsp;<span class="ident" id="5113498">tTag</span><span class="op" id="5113502">(</span><span class="ident" id="5113503">c</span>&nbsp;<span class="ident" id="5113505">context</span><span class="op" id="5113512">,</span>&nbsp;<span class="ident" id="5113514">s</span>&nbsp;<span class="op" id="5113516">[</span><span class="op" id="5113517">]</span><span class="builtintype" id="5113518">byte</span><span class="op" id="5113522">)</span>&nbsp;<span class="op" id="5113524">(</span><span class="ident" id="5113525">context</span><span class="op" id="5113532">,</span>&nbsp;<span class="builtintype" id="5113534">int</span><span class="op" id="5113537">)</span>&nbsp;<span class="op" id="5113539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5113542">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113571">i</span>&nbsp;<span class="op" id="5113573">:=</span>&nbsp;<span class="ident" id="5113576">eatWhiteSpace</span><span class="op" id="5113589">(</span><span class="ident" id="5113590">s</span><span class="op" id="5113591">,</span>&nbsp;<span class="num" id="5113593">0</span><span class="op" id="5113594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113597">if</span>&nbsp;<span class="ident" id="5113600">i</span>&nbsp;<span class="op" id="5113602">==</span>&nbsp;<span class="builtinfunc" id="5113605">len</span><span class="op" id="5113608">(</span><span class="ident" id="5113609">s</span><span class="op" id="5113610">)</span>&nbsp;<span class="op" id="5113612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113616">return</span>&nbsp;<span class="ident" id="5113623">c</span><span class="op" id="5113624">,</span>&nbsp;<span class="builtinfunc" id="5113626">len</span><span class="op" id="5113629">(</span><span class="ident" id="5113630">s</span><span class="op" id="5113631">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113637">if</span>&nbsp;<span class="ident" id="5113640">s</span><span class="op" id="5113641">[</span><span class="ident" id="5113642">i</span><span class="op" id="5113643">]</span>&nbsp;<span class="op" id="5113645">==</span>&nbsp;<span class="string" id="5113648">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="5113652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113656">return</span>&nbsp;<span class="ident" id="5113663">context</span><span class="op" id="5113670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113675">state</span><span class="op" id="5113680">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5113684">elementContentType</span><span class="op" id="5113702">[</span><span class="ident" id="5113703">c</span><span class="op" id="5113704">.</span><span class="ident" id="5113705">element</span><span class="op" id="5113712">]</span><span class="op" id="5113713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113718">element</span><span class="op" id="5113725">:</span>&nbsp;<span class="ident" id="5113727">c</span><span class="op" id="5113728">.</span><span class="ident" id="5113729">element</span><span class="op" id="5113736">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113740">}</span><span class="op" id="5113741">,</span>&nbsp;<span class="ident" id="5113743">i</span>&nbsp;<span class="op" id="5113745">+</span>&nbsp;<span class="num" id="5113747">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113753">j</span><span class="op" id="5113754">,</span>&nbsp;<span class="ident" id="5113756">err</span>&nbsp;<span class="op" id="5113760">:=</span>&nbsp;<span class="ident" id="5113763">eatAttrName</span><span class="op" id="5113774">(</span><span class="ident" id="5113775">s</span><span class="op" id="5113776">,</span>&nbsp;<span class="ident" id="5113778">i</span><span class="op" id="5113779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113782">if</span>&nbsp;<span class="ident" id="5113785">err</span>&nbsp;<span class="op" id="5113789">!=</span>&nbsp;<span class="ident" id="5113792">nil</span>&nbsp;<span class="op" id="5113796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113800">return</span>&nbsp;<span class="ident" id="5113807">context</span><span class="op" id="5113814">{</span><span class="ident" id="5113815">state</span><span class="op" id="5113820">:</span>&nbsp;<span class="ident" id="5113822">stateError</span><span class="op" id="5113832">,</span>&nbsp;<span class="ident" id="5113834">err</span><span class="op" id="5113837">:</span>&nbsp;<span class="ident" id="5113839">err</span><span class="op" id="5113842">}</span><span class="op" id="5113843">,</span>&nbsp;<span class="builtinfunc" id="5113845">len</span><span class="op" id="5113848">(</span><span class="ident" id="5113849">s</span><span class="op" id="5113850">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5113853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113856">state</span><span class="op" id="5113861">,</span>&nbsp;<span class="ident" id="5113863">attr</span>&nbsp;<span class="op" id="5113868">:=</span>&nbsp;<span class="ident" id="5113871">stateTag</span><span class="op" id="5113879">,</span>&nbsp;<span class="ident" id="5113881">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113891">if</span>&nbsp;<span class="ident" id="5113894">i</span>&nbsp;<span class="op" id="5113896">==</span>&nbsp;<span class="ident" id="5113899">j</span>&nbsp;<span class="op" id="5113901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5113905">return</span>&nbsp;<span class="ident" id="5113912">context</span><span class="op" id="5113919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113924">state</span><span class="op" id="5113929">:</span>&nbsp;<span class="ident" id="5113931">stateError</span><span class="op" id="5113941">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5113946">err</span><span class="op" id="5113949">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5113953">errorf</span><span class="op" id="5113959">(</span><span class="ident" id="5113960">ErrBadHTML</span><span class="op" id="5113970">,</span>&nbsp;<span class="ident" id="5113972">nil</span><span class="op" id="5113975">,</span>&nbsp;<span class="num" id="5113977">0</span><span class="op" id="5113978">,</span>&nbsp;<span class="string" id="5113980">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="5114034">,</span>&nbsp;<span class="ident" id="5114036">s</span><span class="op" id="5114037">[</span><span class="ident" id="5114038">i</span><span class="op" id="5114039">:</span><span class="op" id="5114040">]</span><span class="op" id="5114041">)</span><span class="op" id="5114042">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114046">}</span><span class="op" id="5114047">,</span>&nbsp;<span class="builtinfunc" id="5114049">len</span><span class="op" id="5114052">(</span><span class="ident" id="5114053">s</span><span class="op" id="5114054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114060">switch</span>&nbsp;<span class="ident" id="5114067">attrType</span><span class="op" id="5114075">(</span><span class="builtintype" id="5114076">string</span><span class="op" id="5114082">(</span><span class="ident" id="5114083">s</span><span class="op" id="5114084">[</span><span class="ident" id="5114085">i</span><span class="op" id="5114086">:</span><span class="ident" id="5114087">j</span><span class="op" id="5114088">]</span><span class="op" id="5114089">)</span><span class="op" id="5114090">)</span>&nbsp;<span class="op" id="5114092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114095">case</span>&nbsp;<span class="ident" id="5114100">contentTypeURL</span><span class="op" id="5114114">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114118">attr</span>&nbsp;<span class="op" id="5114123">=</span>&nbsp;<span class="ident" id="5114125">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114134">case</span>&nbsp;<span class="ident" id="5114139">contentTypeCSS</span><span class="op" id="5114153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114157">attr</span>&nbsp;<span class="op" id="5114162">=</span>&nbsp;<span class="ident" id="5114164">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114175">case</span>&nbsp;<span class="ident" id="5114180">contentTypeJS</span><span class="op" id="5114193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114197">attr</span>&nbsp;<span class="op" id="5114202">=</span>&nbsp;<span class="ident" id="5114204">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114219">if</span>&nbsp;<span class="ident" id="5114222">j</span>&nbsp;<span class="op" id="5114224">==</span>&nbsp;<span class="builtinfunc" id="5114227">len</span><span class="op" id="5114230">(</span><span class="ident" id="5114231">s</span><span class="op" id="5114232">)</span>&nbsp;<span class="op" id="5114234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114238">state</span>&nbsp;<span class="op" id="5114244">=</span>&nbsp;<span class="ident" id="5114246">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114261">}</span>&nbsp;<span class="keyword" id="5114263">else</span>&nbsp;<span class="op" id="5114268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114272">state</span>&nbsp;<span class="op" id="5114278">=</span>&nbsp;<span class="ident" id="5114280">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114299">return</span>&nbsp;<span class="ident" id="5114306">context</span><span class="op" id="5114313">{</span><span class="ident" id="5114314">state</span><span class="op" id="5114319">:</span>&nbsp;<span class="ident" id="5114321">state</span><span class="op" id="5114326">,</span>&nbsp;<span class="ident" id="5114328">element</span><span class="op" id="5114335">:</span>&nbsp;<span class="ident" id="5114337">c</span><span class="op" id="5114338">.</span><span class="ident" id="5114339">element</span><span class="op" id="5114346">,</span>&nbsp;<span class="ident" id="5114348">attr</span><span class="op" id="5114352">:</span>&nbsp;<span class="ident" id="5114354">attr</span><span class="op" id="5114358">}</span><span class="op" id="5114359">,</span>&nbsp;<span class="ident" id="5114361">j</span><br>
<span class="lineno"></span><span class="op" id="5114363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5114366">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="5114433">func</span>&nbsp;<span class="ident" id="5114438">tAttrName</span><span class="op" id="5114447">(</span><span class="ident" id="5114448">c</span>&nbsp;<span class="ident" id="5114450">context</span><span class="op" id="5114457">,</span>&nbsp;<span class="ident" id="5114459">s</span>&nbsp;<span class="op" id="5114461">[</span><span class="op" id="5114462">]</span><span class="builtintype" id="5114463">byte</span><span class="op" id="5114467">)</span>&nbsp;<span class="op" id="5114469">(</span><span class="ident" id="5114470">context</span><span class="op" id="5114477">,</span>&nbsp;<span class="builtintype" id="5114479">int</span><span class="op" id="5114482">)</span>&nbsp;<span class="op" id="5114484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114487">i</span><span class="op" id="5114488">,</span>&nbsp;<span class="ident" id="5114490">err</span>&nbsp;<span class="op" id="5114494">:=</span>&nbsp;<span class="ident" id="5114497">eatAttrName</span><span class="op" id="5114508">(</span><span class="ident" id="5114509">s</span><span class="op" id="5114510">,</span>&nbsp;<span class="num" id="5114512">0</span><span class="op" id="5114513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114516">if</span>&nbsp;<span class="ident" id="5114519">err</span>&nbsp;<span class="op" id="5114523">!=</span>&nbsp;<span class="ident" id="5114526">nil</span>&nbsp;<span class="op" id="5114530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114534">return</span>&nbsp;<span class="ident" id="5114541">context</span><span class="op" id="5114548">{</span><span class="ident" id="5114549">state</span><span class="op" id="5114554">:</span>&nbsp;<span class="ident" id="5114556">stateError</span><span class="op" id="5114566">,</span>&nbsp;<span class="ident" id="5114568">err</span><span class="op" id="5114571">:</span>&nbsp;<span class="ident" id="5114573">err</span><span class="op" id="5114576">}</span><span class="op" id="5114577">,</span>&nbsp;<span class="builtinfunc" id="5114579">len</span><span class="op" id="5114582">(</span><span class="ident" id="5114583">s</span><span class="op" id="5114584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114587">}</span>&nbsp;<span class="keyword" id="5114589">else</span>&nbsp;<span class="keyword" id="5114594">if</span>&nbsp;<span class="ident" id="5114597">i</span>&nbsp;<span class="op" id="5114599">!=</span>&nbsp;<span class="builtinfunc" id="5114602">len</span><span class="op" id="5114605">(</span><span class="ident" id="5114606">s</span><span class="op" id="5114607">)</span>&nbsp;<span class="op" id="5114609">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114613">c</span><span class="op" id="5114614">.</span><span class="ident" id="5114615">state</span>&nbsp;<span class="op" id="5114621">=</span>&nbsp;<span class="ident" id="5114623">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114642">return</span>&nbsp;<span class="ident" id="5114649">c</span><span class="op" id="5114650">,</span>&nbsp;<span class="ident" id="5114652">i</span><br>
<span class="lineno"></span><span class="op" id="5114654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5114657">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="5114726">func</span>&nbsp;<span class="ident" id="5114731">tAfterName</span><span class="op" id="5114741">(</span><span class="ident" id="5114742">c</span>&nbsp;<span class="ident" id="5114744">context</span><span class="op" id="5114751">,</span>&nbsp;<span class="ident" id="5114753">s</span>&nbsp;<span class="op" id="5114755">[</span><span class="op" id="5114756">]</span><span class="builtintype" id="5114757">byte</span><span class="op" id="5114761">)</span>&nbsp;<span class="op" id="5114763">(</span><span class="ident" id="5114764">context</span><span class="op" id="5114771">,</span>&nbsp;<span class="builtintype" id="5114773">int</span><span class="op" id="5114776">)</span>&nbsp;<span class="op" id="5114778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5114781">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114818">i</span>&nbsp;<span class="op" id="5114820">:=</span>&nbsp;<span class="ident" id="5114823">eatWhiteSpace</span><span class="op" id="5114836">(</span><span class="ident" id="5114837">s</span><span class="op" id="5114838">,</span>&nbsp;<span class="num" id="5114840">0</span><span class="op" id="5114841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114844">if</span>&nbsp;<span class="ident" id="5114847">i</span>&nbsp;<span class="op" id="5114849">==</span>&nbsp;<span class="builtinfunc" id="5114852">len</span><span class="op" id="5114855">(</span><span class="ident" id="5114856">s</span><span class="op" id="5114857">)</span>&nbsp;<span class="op" id="5114859">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114863">return</span>&nbsp;<span class="ident" id="5114870">c</span><span class="op" id="5114871">,</span>&nbsp;<span class="builtinfunc" id="5114873">len</span><span class="op" id="5114876">(</span><span class="ident" id="5114877">s</span><span class="op" id="5114878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5114881">}</span>&nbsp;<span class="keyword" id="5114883">else</span>&nbsp;<span class="keyword" id="5114888">if</span>&nbsp;<span class="ident" id="5114891">s</span><span class="op" id="5114892">[</span><span class="ident" id="5114893">i</span><span class="op" id="5114894">]</span>&nbsp;<span class="op" id="5114896">!=</span>&nbsp;<span class="string" id="5114899">&#39;=&#39;</span>&nbsp;<span class="op" id="5114903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5114907">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5114967">c</span><span class="op" id="5114968">.</span><span class="ident" id="5114969">state</span>&nbsp;<span class="op" id="5114975">=</span>&nbsp;<span class="ident" id="5114977">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5114988">return</span>&nbsp;<span class="ident" id="5114995">c</span><span class="op" id="5114996">,</span>&nbsp;<span class="ident" id="5114998">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5115001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115004">c</span><span class="op" id="5115005">.</span><span class="ident" id="5115006">state</span>&nbsp;<span class="op" id="5115012">=</span>&nbsp;<span class="ident" id="5115014">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5115032">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115053">return</span>&nbsp;<span class="ident" id="5115060">c</span><span class="op" id="5115061">,</span>&nbsp;<span class="ident" id="5115063">i</span>&nbsp;<span class="op" id="5115065">+</span>&nbsp;<span class="num" id="5115067">1</span><br>
<span class="lineno"></span><span class="op" id="5115069">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="5115072">var</span>&nbsp;<span class="ident" id="5115076">attrStartStates</span>&nbsp;<span class="op" id="5115092">=</span>&nbsp;<span class="op" id="5115094">[</span><span class="op" id="5115095">...</span><span class="op" id="5115098">]</span><span class="ident" id="5115099">state</span><span class="op" id="5115104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115107">attrNone</span><span class="op" id="5115115">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5115119">stateAttr</span><span class="op" id="5115128">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115131">attrScript</span><span class="op" id="5115141">:</span>&nbsp;<span class="ident" id="5115143">stateJS</span><span class="op" id="5115150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115153">attrStyle</span><span class="op" id="5115162">:</span>&nbsp;&nbsp;<span class="ident" id="5115165">stateCSS</span><span class="op" id="5115173">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115176">attrURL</span><span class="op" id="5115183">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115188">stateURL</span><span class="op" id="5115196">,</span><br>
<span class="lineno"></span><span class="op" id="5115198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5115201">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="5115274">func</span>&nbsp;<span class="ident" id="5115279">tBeforeValue</span><span class="op" id="5115291">(</span><span class="ident" id="5115292">c</span>&nbsp;<span class="ident" id="5115294">context</span><span class="op" id="5115301">,</span>&nbsp;<span class="ident" id="5115303">s</span>&nbsp;<span class="op" id="5115305">[</span><span class="op" id="5115306">]</span><span class="builtintype" id="5115307">byte</span><span class="op" id="5115311">)</span>&nbsp;<span class="op" id="5115313">(</span><span class="ident" id="5115314">context</span><span class="op" id="5115321">,</span>&nbsp;<span class="builtintype" id="5115323">int</span><span class="op" id="5115326">)</span>&nbsp;<span class="op" id="5115328">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115331">i</span>&nbsp;<span class="op" id="5115333">:=</span>&nbsp;<span class="ident" id="5115336">eatWhiteSpace</span><span class="op" id="5115349">(</span><span class="ident" id="5115350">s</span><span class="op" id="5115351">,</span>&nbsp;<span class="num" id="5115353">0</span><span class="op" id="5115354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115357">if</span>&nbsp;<span class="ident" id="5115360">i</span>&nbsp;<span class="op" id="5115362">==</span>&nbsp;<span class="builtinfunc" id="5115365">len</span><span class="op" id="5115368">(</span><span class="ident" id="5115369">s</span><span class="op" id="5115370">)</span>&nbsp;<span class="op" id="5115372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115376">return</span>&nbsp;<span class="ident" id="5115383">c</span><span class="op" id="5115384">,</span>&nbsp;<span class="builtinfunc" id="5115386">len</span><span class="op" id="5115389">(</span><span class="ident" id="5115390">s</span><span class="op" id="5115391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5115394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5115397">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115431">delim</span>&nbsp;<span class="op" id="5115437">:=</span>&nbsp;<span class="ident" id="5115440">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115460">switch</span>&nbsp;<span class="ident" id="5115467">s</span><span class="op" id="5115468">[</span><span class="ident" id="5115469">i</span><span class="op" id="5115470">]</span>&nbsp;<span class="op" id="5115472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115475">case</span>&nbsp;<span class="string" id="5115480">&#39;\&#39;&#39;</span><span class="op" id="5115484">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115488">delim</span><span class="op" id="5115493">,</span>&nbsp;<span class="ident" id="5115495">i</span>&nbsp;<span class="op" id="5115497">=</span>&nbsp;<span class="ident" id="5115499">delimSingleQuote</span><span class="op" id="5115515">,</span>&nbsp;<span class="ident" id="5115517">i</span><span class="op" id="5115518">+</span><span class="num" id="5115519">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115522">case</span>&nbsp;<span class="string" id="5115527">&#39;&#34;&#39;</span><span class="op" id="5115530">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115534">delim</span><span class="op" id="5115539">,</span>&nbsp;<span class="ident" id="5115541">i</span>&nbsp;<span class="op" id="5115543">=</span>&nbsp;<span class="ident" id="5115545">delimDoubleQuote</span><span class="op" id="5115561">,</span>&nbsp;<span class="ident" id="5115563">i</span><span class="op" id="5115564">+</span><span class="num" id="5115565">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5115568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5115571">c</span><span class="op" id="5115572">.</span><span class="ident" id="5115573">state</span><span class="op" id="5115578">,</span>&nbsp;<span class="ident" id="5115580">c</span><span class="op" id="5115581">.</span><span class="ident" id="5115582">delim</span><span class="op" id="5115587">,</span>&nbsp;<span class="ident" id="5115589">c</span><span class="op" id="5115590">.</span><span class="ident" id="5115591">attr</span>&nbsp;<span class="op" id="5115596">=</span>&nbsp;<span class="ident" id="5115598">attrStartStates</span><span class="op" id="5115613">[</span><span class="ident" id="5115614">c</span><span class="op" id="5115615">.</span><span class="ident" id="5115616">attr</span><span class="op" id="5115620">]</span><span class="op" id="5115621">,</span>&nbsp;<span class="ident" id="5115623">delim</span><span class="op" id="5115628">,</span>&nbsp;<span class="ident" id="5115630">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115640">return</span>&nbsp;<span class="ident" id="5115647">c</span><span class="op" id="5115648">,</span>&nbsp;<span class="ident" id="5115650">i</span><br>
<span class="lineno"></span><span class="op" id="5115652">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="5115655">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5115720">func</span>&nbsp;<span class="ident" id="5115725">tHTMLCmt</span><span class="op" id="5115733">(</span><span class="ident" id="5115734">c</span>&nbsp;<span class="ident" id="5115736">context</span><span class="op" id="5115743">,</span>&nbsp;<span class="ident" id="5115745">s</span>&nbsp;<span class="op" id="5115747">[</span><span class="op" id="5115748">]</span><span class="builtintype" id="5115749">byte</span><span class="op" id="5115753">)</span>&nbsp;<span class="op" id="5115755">(</span><span class="ident" id="5115756">context</span><span class="op" id="5115763">,</span>&nbsp;<span class="builtintype" id="5115765">int</span><span class="op" id="5115768">)</span>&nbsp;<span class="op" id="5115770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115773">if</span>&nbsp;<span class="ident" id="5115776">i</span>&nbsp;<span class="op" id="5115778">:=</span>&nbsp;<span class="ident" id="5115781">bytes</span><span class="op" id="5115786">.</span><span class="ident" id="5115787">Index</span><span class="op" id="5115792">(</span><span class="ident" id="5115793">s</span><span class="op" id="5115794">,</span>&nbsp;<span class="ident" id="5115796">commentEnd</span><span class="op" id="5115806">)</span><span class="op" id="5115807">;</span>&nbsp;<span class="ident" id="5115809">i</span>&nbsp;<span class="op" id="5115811">!=</span>&nbsp;<span class="op" id="5115814">-</span><span class="num" id="5115815">1</span>&nbsp;<span class="op" id="5115817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115821">return</span>&nbsp;<span class="ident" id="5115828">context</span><span class="op" id="5115835">{</span><span class="op" id="5115836">}</span><span class="op" id="5115837">,</span>&nbsp;<span class="ident" id="5115839">i</span>&nbsp;<span class="op" id="5115841">+</span>&nbsp;<span class="num" id="5115843">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5115846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5115849">return</span>&nbsp;<span class="ident" id="5115856">c</span><span class="op" id="5115857">,</span>&nbsp;<span class="builtinfunc" id="5115859">len</span><span class="op" id="5115862">(</span><span class="ident" id="5115863">s</span><span class="op" id="5115864">)</span><br>
<span class="lineno"></span><span class="op" id="5115866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5115869">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="5115943">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="5116006">var</span>&nbsp;<span class="ident" id="5116010">specialTagEndMarkers</span>&nbsp;<span class="op" id="5116031">=</span>&nbsp;<span class="op" id="5116033">[</span><span class="op" id="5116034">...</span><span class="op" id="5116037">]</span><span class="builtintype" id="5116038">string</span><span class="op" id="5116044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5116047">elementScript</span><span class="op" id="5116060">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5116064">&#34;&lt;/script&#34;</span><span class="op" id="5116074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5116077">elementStyle</span><span class="op" id="5116089">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5116094">&#34;&lt;/style&#34;</span><span class="op" id="5116103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5116106">elementTextarea</span><span class="op" id="5116121">:</span>&nbsp;<span class="string" id="5116123">&#34;&lt;/textarea&#34;</span><span class="op" id="5116135">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5116138">elementTitle</span><span class="op" id="5116150">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5116155">&#34;&lt;/title&#34;</span><span class="op" id="5116164">,</span><br>
<span class="lineno"></span><span class="op" id="5116166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116169">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="5116246">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="5116265">func</span>&nbsp;<span class="ident" id="5116270">tSpecialTagEnd</span><span class="op" id="5116284">(</span><span class="ident" id="5116285">c</span>&nbsp;<span class="ident" id="5116287">context</span><span class="op" id="5116294">,</span>&nbsp;<span class="ident" id="5116296">s</span>&nbsp;<span class="op" id="5116298">[</span><span class="op" id="5116299">]</span><span class="builtintype" id="5116300">byte</span><span class="op" id="5116304">)</span>&nbsp;<span class="op" id="5116306">(</span><span class="ident" id="5116307">context</span><span class="op" id="5116314">,</span>&nbsp;<span class="builtintype" id="5116316">int</span><span class="op" id="5116319">)</span>&nbsp;<span class="op" id="5116321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5116324">if</span>&nbsp;<span class="ident" id="5116327">c</span><span class="op" id="5116328">.</span><span class="ident" id="5116329">element</span>&nbsp;<span class="op" id="5116337">!=</span>&nbsp;<span class="ident" id="5116340">elementNone</span>&nbsp;<span class="op" id="5116352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5116356">if</span>&nbsp;<span class="ident" id="5116359">i</span>&nbsp;<span class="op" id="5116361">:=</span>&nbsp;<span class="ident" id="5116364">strings</span><span class="op" id="5116371">.</span><span class="ident" id="5116372">Index</span><span class="op" id="5116377">(</span><span class="ident" id="5116378">strings</span><span class="op" id="5116385">.</span><span class="ident" id="5116386">ToLower</span><span class="op" id="5116393">(</span><span class="builtintype" id="5116394">string</span><span class="op" id="5116400">(</span><span class="ident" id="5116401">s</span><span class="op" id="5116402">)</span><span class="op" id="5116403">)</span><span class="op" id="5116404">,</span>&nbsp;<span class="ident" id="5116406">specialTagEndMarkers</span><span class="op" id="5116426">[</span><span class="ident" id="5116427">c</span><span class="op" id="5116428">.</span><span class="ident" id="5116429">element</span><span class="op" id="5116436">]</span><span class="op" id="5116437">)</span><span class="op" id="5116438">;</span>&nbsp;<span class="ident" id="5116440">i</span>&nbsp;<span class="op" id="5116442">!=</span>&nbsp;<span class="op" id="5116445">-</span><span class="num" id="5116446">1</span>&nbsp;<span class="op" id="5116448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5116453">return</span>&nbsp;<span class="ident" id="5116460">context</span><span class="op" id="5116467">{</span><span class="op" id="5116468">}</span><span class="op" id="5116469">,</span>&nbsp;<span class="ident" id="5116471">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5116475">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5116478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5116481">return</span>&nbsp;<span class="ident" id="5116488">c</span><span class="op" id="5116489">,</span>&nbsp;<span class="builtinfunc" id="5116491">len</span><span class="op" id="5116494">(</span><span class="ident" id="5116495">s</span><span class="op" id="5116496">)</span><br>
<span class="lineno"></span><span class="op" id="5116498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116501">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="5116570">func</span>&nbsp;<span class="ident" id="5116575">tAttr</span><span class="op" id="5116580">(</span><span class="ident" id="5116581">c</span>&nbsp;<span class="ident" id="5116583">context</span><span class="op" id="5116590">,</span>&nbsp;<span class="ident" id="5116592">s</span>&nbsp;<span class="op" id="5116594">[</span><span class="op" id="5116595">]</span><span class="builtintype" id="5116596">byte</span><span class="op" id="5116600">)</span>&nbsp;<span class="op" id="5116602">(</span><span class="ident" id="5116603">context</span><span class="op" id="5116610">,</span>&nbsp;<span class="builtintype" id="5116612">int</span><span class="op" id="5116615">)</span>&nbsp;<span class="op" id="5116617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5116620">return</span>&nbsp;<span class="ident" id="5116627">c</span><span class="op" id="5116628">,</span>&nbsp;<span class="builtinfunc" id="5116630">len</span><span class="op" id="5116633">(</span><span class="ident" id="5116634">s</span><span class="op" id="5116635">)</span><br>
<span class="lineno"></span><span class="op" id="5116637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5116640">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="5116702">func</span>&nbsp;<span class="ident" id="5116707">tURL</span><span class="op" id="5116711">(</span><span class="ident" id="5116712">c</span>&nbsp;<span class="ident" id="5116714">context</span><span class="op" id="5116721">,</span>&nbsp;<span class="ident" id="5116723">s</span>&nbsp;<span class="op" id="5116725">[</span><span class="op" id="5116726">]</span><span class="builtintype" id="5116727">byte</span><span class="op" id="5116731">)</span>&nbsp;<span class="op" id="5116733">(</span><span class="ident" id="5116734">context</span><span class="op" id="5116741">,</span>&nbsp;<span class="builtintype" id="5116743">int</span><span class="op" id="5116746">)</span>&nbsp;<span class="op" id="5116748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5116751">if</span>&nbsp;<span class="ident" id="5116754">bytes</span><span class="op" id="5116759">.</span><span class="ident" id="5116760">IndexAny</span><span class="op" id="5116768">(</span><span class="ident" id="5116769">s</span><span class="op" id="5116770">,</span>&nbsp;<span class="string" id="5116772">&#34;#?&#34;</span><span class="op" id="5116776">)</span>&nbsp;<span class="op" id="5116778">&gt;=</span>&nbsp;<span class="num" id="5116781">0</span>&nbsp;<span class="op" id="5116783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5116787">c</span><span class="op" id="5116788">.</span><span class="ident" id="5116789">urlPart</span>&nbsp;<span class="op" id="5116797">=</span>&nbsp;<span class="ident" id="5116799">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5116819">}</span>&nbsp;<span class="keyword" id="5116821">else</span>&nbsp;<span class="keyword" id="5116826">if</span>&nbsp;<span class="builtinfunc" id="5116829">len</span><span class="op" id="5116832">(</span><span class="ident" id="5116833">s</span><span class="op" id="5116834">)</span>&nbsp;<span class="op" id="5116836">!=</span>&nbsp;<span class="ident" id="5116839">eatWhiteSpace</span><span class="op" id="5116852">(</span><span class="ident" id="5116853">s</span><span class="op" id="5116854">,</span>&nbsp;<span class="num" id="5116856">0</span><span class="op" id="5116857">)</span>&nbsp;<span class="op" id="5116859">&amp;&amp;</span>&nbsp;<span class="ident" id="5116862">c</span><span class="op" id="5116863">.</span><span class="ident" id="5116864">urlPart</span>&nbsp;<span class="op" id="5116872">==</span>&nbsp;<span class="ident" id="5116875">urlPartNone</span>&nbsp;<span class="op" id="5116887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5116891">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5116956">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117019">c</span><span class="op" id="5117020">.</span><span class="ident" id="5117021">urlPart</span>&nbsp;<span class="op" id="5117029">=</span>&nbsp;<span class="ident" id="5117031">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117051">return</span>&nbsp;<span class="ident" id="5117058">c</span><span class="op" id="5117059">,</span>&nbsp;<span class="builtinfunc" id="5117061">len</span><span class="op" id="5117064">(</span><span class="ident" id="5117065">s</span><span class="op" id="5117066">)</span><br>
<span class="lineno"></span><span class="op" id="5117068">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5117071">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5117131">func</span>&nbsp;<span class="ident" id="5117136">tJS</span><span class="op" id="5117139">(</span><span class="ident" id="5117140">c</span>&nbsp;<span class="ident" id="5117142">context</span><span class="op" id="5117149">,</span>&nbsp;<span class="ident" id="5117151">s</span>&nbsp;<span class="op" id="5117153">[</span><span class="op" id="5117154">]</span><span class="builtintype" id="5117155">byte</span><span class="op" id="5117159">)</span>&nbsp;<span class="op" id="5117161">(</span><span class="ident" id="5117162">context</span><span class="op" id="5117169">,</span>&nbsp;<span class="builtintype" id="5117171">int</span><span class="op" id="5117174">)</span>&nbsp;<span class="op" id="5117176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117179">i</span>&nbsp;<span class="op" id="5117181">:=</span>&nbsp;<span class="ident" id="5117184">bytes</span><span class="op" id="5117189">.</span><span class="ident" id="5117190">IndexAny</span><span class="op" id="5117198">(</span><span class="ident" id="5117199">s</span><span class="op" id="5117200">,</span>&nbsp;<span class="string" id="5117202">`&#34;&#39;/`</span><span class="op" id="5117207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117210">if</span>&nbsp;<span class="ident" id="5117213">i</span>&nbsp;<span class="op" id="5117215">==</span>&nbsp;<span class="op" id="5117218">-</span><span class="num" id="5117219">1</span>&nbsp;<span class="op" id="5117221">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5117225">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117282">c</span><span class="op" id="5117283">.</span><span class="ident" id="5117284">jsCtx</span>&nbsp;<span class="op" id="5117290">=</span>&nbsp;<span class="ident" id="5117292">nextJSCtx</span><span class="op" id="5117301">(</span><span class="ident" id="5117302">s</span><span class="op" id="5117303">,</span>&nbsp;<span class="ident" id="5117305">c</span><span class="op" id="5117306">.</span><span class="ident" id="5117307">jsCtx</span><span class="op" id="5117312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117316">return</span>&nbsp;<span class="ident" id="5117323">c</span><span class="op" id="5117324">,</span>&nbsp;<span class="builtinfunc" id="5117326">len</span><span class="op" id="5117329">(</span><span class="ident" id="5117330">s</span><span class="op" id="5117331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117337">c</span><span class="op" id="5117338">.</span><span class="ident" id="5117339">jsCtx</span>&nbsp;<span class="op" id="5117345">=</span>&nbsp;<span class="ident" id="5117347">nextJSCtx</span><span class="op" id="5117356">(</span><span class="ident" id="5117357">s</span><span class="op" id="5117358">[</span><span class="op" id="5117359">:</span><span class="ident" id="5117360">i</span><span class="op" id="5117361">]</span><span class="op" id="5117362">,</span>&nbsp;<span class="ident" id="5117364">c</span><span class="op" id="5117365">.</span><span class="ident" id="5117366">jsCtx</span><span class="op" id="5117371">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117374">switch</span>&nbsp;<span class="ident" id="5117381">s</span><span class="op" id="5117382">[</span><span class="ident" id="5117383">i</span><span class="op" id="5117384">]</span>&nbsp;<span class="op" id="5117386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117389">case</span>&nbsp;<span class="string" id="5117394">&#39;&#34;&#39;</span><span class="op" id="5117397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117401">c</span><span class="op" id="5117402">.</span><span class="ident" id="5117403">state</span><span class="op" id="5117408">,</span>&nbsp;<span class="ident" id="5117410">c</span><span class="op" id="5117411">.</span><span class="ident" id="5117412">jsCtx</span>&nbsp;<span class="op" id="5117418">=</span>&nbsp;<span class="ident" id="5117420">stateJSDqStr</span><span class="op" id="5117432">,</span>&nbsp;<span class="ident" id="5117434">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117447">case</span>&nbsp;<span class="string" id="5117452">&#39;\&#39;&#39;</span><span class="op" id="5117456">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117460">c</span><span class="op" id="5117461">.</span><span class="ident" id="5117462">state</span><span class="op" id="5117467">,</span>&nbsp;<span class="ident" id="5117469">c</span><span class="op" id="5117470">.</span><span class="ident" id="5117471">jsCtx</span>&nbsp;<span class="op" id="5117477">=</span>&nbsp;<span class="ident" id="5117479">stateJSSqStr</span><span class="op" id="5117491">,</span>&nbsp;<span class="ident" id="5117493">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117506">case</span>&nbsp;<span class="string" id="5117511">&#39;/&#39;</span><span class="op" id="5117514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117518">switch</span>&nbsp;<span class="op" id="5117525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117529">case</span>&nbsp;<span class="ident" id="5117534">i</span><span class="op" id="5117535">+</span><span class="num" id="5117536">1</span>&nbsp;<span class="op" id="5117538">&lt;</span>&nbsp;<span class="builtinfunc" id="5117540">len</span><span class="op" id="5117543">(</span><span class="ident" id="5117544">s</span><span class="op" id="5117545">)</span>&nbsp;<span class="op" id="5117547">&amp;&amp;</span>&nbsp;<span class="ident" id="5117550">s</span><span class="op" id="5117551">[</span><span class="ident" id="5117552">i</span><span class="op" id="5117553">+</span><span class="num" id="5117554">1</span><span class="op" id="5117555">]</span>&nbsp;<span class="op" id="5117557">==</span>&nbsp;<span class="string" id="5117560">&#39;/&#39;</span><span class="op" id="5117563">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117568">c</span><span class="op" id="5117569">.</span><span class="ident" id="5117570">state</span><span class="op" id="5117575">,</span>&nbsp;<span class="ident" id="5117577">i</span>&nbsp;<span class="op" id="5117579">=</span>&nbsp;<span class="ident" id="5117581">stateJSLineCmt</span><span class="op" id="5117595">,</span>&nbsp;<span class="ident" id="5117597">i</span><span class="op" id="5117598">+</span><span class="num" id="5117599">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117603">case</span>&nbsp;<span class="ident" id="5117608">i</span><span class="op" id="5117609">+</span><span class="num" id="5117610">1</span>&nbsp;<span class="op" id="5117612">&lt;</span>&nbsp;<span class="builtinfunc" id="5117614">len</span><span class="op" id="5117617">(</span><span class="ident" id="5117618">s</span><span class="op" id="5117619">)</span>&nbsp;<span class="op" id="5117621">&amp;&amp;</span>&nbsp;<span class="ident" id="5117624">s</span><span class="op" id="5117625">[</span><span class="ident" id="5117626">i</span><span class="op" id="5117627">+</span><span class="num" id="5117628">1</span><span class="op" id="5117629">]</span>&nbsp;<span class="op" id="5117631">==</span>&nbsp;<span class="string" id="5117634">&#39;*&#39;</span><span class="op" id="5117637">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117642">c</span><span class="op" id="5117643">.</span><span class="ident" id="5117644">state</span><span class="op" id="5117649">,</span>&nbsp;<span class="ident" id="5117651">i</span>&nbsp;<span class="op" id="5117653">=</span>&nbsp;<span class="ident" id="5117655">stateJSBlockCmt</span><span class="op" id="5117670">,</span>&nbsp;<span class="ident" id="5117672">i</span><span class="op" id="5117673">+</span><span class="num" id="5117674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117678">case</span>&nbsp;<span class="ident" id="5117683">c</span><span class="op" id="5117684">.</span><span class="ident" id="5117685">jsCtx</span>&nbsp;<span class="op" id="5117691">==</span>&nbsp;<span class="ident" id="5117694">jsCtxRegexp</span><span class="op" id="5117705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117710">c</span><span class="op" id="5117711">.</span><span class="ident" id="5117712">state</span>&nbsp;<span class="op" id="5117718">=</span>&nbsp;<span class="ident" id="5117720">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117736">case</span>&nbsp;<span class="ident" id="5117741">c</span><span class="op" id="5117742">.</span><span class="ident" id="5117743">jsCtx</span>&nbsp;<span class="op" id="5117749">==</span>&nbsp;<span class="ident" id="5117752">jsCtxDivOp</span><span class="op" id="5117762">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117767">c</span><span class="op" id="5117768">.</span><span class="ident" id="5117769">jsCtx</span>&nbsp;<span class="op" id="5117775">=</span>&nbsp;<span class="ident" id="5117777">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117791">default</span><span class="op" id="5117798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117803">return</span>&nbsp;<span class="ident" id="5117810">context</span><span class="op" id="5117817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117823">state</span><span class="op" id="5117828">:</span>&nbsp;<span class="ident" id="5117830">stateError</span><span class="op" id="5117840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5117846">err</span><span class="op" id="5117849">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5117853">errorf</span><span class="op" id="5117859">(</span><span class="ident" id="5117860">ErrSlashAmbig</span><span class="op" id="5117873">,</span>&nbsp;<span class="ident" id="5117875">nil</span><span class="op" id="5117878">,</span>&nbsp;<span class="num" id="5117880">0</span><span class="op" id="5117881">,</span>&nbsp;<span class="string" id="5117883">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="5117928">,</span>&nbsp;<span class="ident" id="5117930">s</span><span class="op" id="5117931">[</span><span class="ident" id="5117932">i</span><span class="op" id="5117933">:</span><span class="op" id="5117934">]</span><span class="op" id="5117935">)</span><span class="op" id="5117936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117941">}</span><span class="op" id="5117942">,</span>&nbsp;<span class="builtinfunc" id="5117944">len</span><span class="op" id="5117947">(</span><span class="ident" id="5117948">s</span><span class="op" id="5117949">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117956">default</span><span class="op" id="5117963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5117967">panic</span><span class="op" id="5117972">(</span><span class="string" id="5117973">&#34;unreachable&#34;</span><span class="op" id="5117986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5117989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5117992">return</span>&nbsp;<span class="ident" id="5117999">c</span><span class="op" id="5118000">,</span>&nbsp;<span class="ident" id="5118002">i</span>&nbsp;<span class="op" id="5118004">+</span>&nbsp;<span class="num" id="5118006">1</span><br>
<span class="lineno">255</span><span class="op" id="5118008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5118011">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="5118091">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5118102">func</span>&nbsp;<span class="ident" id="5118107">tJSDelimited</span><span class="op" id="5118119">(</span><span class="ident" id="5118120">c</span>&nbsp;<span class="ident" id="5118122">context</span><span class="op" id="5118129">,</span>&nbsp;<span class="ident" id="5118131">s</span>&nbsp;<span class="op" id="5118133">[</span><span class="op" id="5118134">]</span><span class="builtintype" id="5118135">byte</span><span class="op" id="5118139">)</span>&nbsp;<span class="op" id="5118141">(</span><span class="ident" id="5118142">context</span><span class="op" id="5118149">,</span>&nbsp;<span class="builtintype" id="5118151">int</span><span class="op" id="5118154">)</span>&nbsp;<span class="op" id="5118156">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118159">specials</span>&nbsp;<span class="op" id="5118168">:=</span>&nbsp;<span class="string" id="5118171">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118177">switch</span>&nbsp;<span class="ident" id="5118184">c</span><span class="op" id="5118185">.</span><span class="ident" id="5118186">state</span>&nbsp;<span class="op" id="5118192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118195">case</span>&nbsp;<span class="ident" id="5118200">stateJSSqStr</span><span class="op" id="5118212">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118216">specials</span>&nbsp;<span class="op" id="5118225">=</span>&nbsp;<span class="string" id="5118227">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118233">case</span>&nbsp;<span class="ident" id="5118238">stateJSRegexp</span><span class="op" id="5118251">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118255">specials</span>&nbsp;<span class="op" id="5118264">=</span>&nbsp;<span class="string" id="5118266">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118278">k</span><span class="op" id="5118279">,</span>&nbsp;<span class="ident" id="5118281">inCharset</span>&nbsp;<span class="op" id="5118291">:=</span>&nbsp;<span class="num" id="5118294">0</span><span class="op" id="5118295">,</span>&nbsp;<span class="builtintype" id="5118297">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118304">for</span>&nbsp;<span class="op" id="5118308">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118312">i</span>&nbsp;<span class="op" id="5118314">:=</span>&nbsp;<span class="ident" id="5118317">k</span>&nbsp;<span class="op" id="5118319">+</span>&nbsp;<span class="ident" id="5118321">bytes</span><span class="op" id="5118326">.</span><span class="ident" id="5118327">IndexAny</span><span class="op" id="5118335">(</span><span class="ident" id="5118336">s</span><span class="op" id="5118337">[</span><span class="ident" id="5118338">k</span><span class="op" id="5118339">:</span><span class="op" id="5118340">]</span><span class="op" id="5118341">,</span>&nbsp;<span class="ident" id="5118343">specials</span><span class="op" id="5118351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118355">if</span>&nbsp;<span class="ident" id="5118358">i</span>&nbsp;<span class="op" id="5118360">&lt;</span>&nbsp;<span class="ident" id="5118362">k</span>&nbsp;<span class="op" id="5118364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118369">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118381">switch</span>&nbsp;<span class="ident" id="5118388">s</span><span class="op" id="5118389">[</span><span class="ident" id="5118390">i</span><span class="op" id="5118391">]</span>&nbsp;<span class="op" id="5118393">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118397">case</span>&nbsp;<span class="string" id="5118402">&#39;\\&#39;</span><span class="op" id="5118406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118411">i</span><span class="op" id="5118412">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118418">if</span>&nbsp;<span class="ident" id="5118421">i</span>&nbsp;<span class="op" id="5118423">==</span>&nbsp;<span class="builtinfunc" id="5118426">len</span><span class="op" id="5118429">(</span><span class="ident" id="5118430">s</span><span class="op" id="5118431">)</span>&nbsp;<span class="op" id="5118433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118439">return</span>&nbsp;<span class="ident" id="5118446">context</span><span class="op" id="5118453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118460">state</span><span class="op" id="5118465">:</span>&nbsp;<span class="ident" id="5118467">stateError</span><span class="op" id="5118477">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118484">err</span><span class="op" id="5118487">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5118491">errorf</span><span class="op" id="5118497">(</span><span class="ident" id="5118498">ErrPartialEscape</span><span class="op" id="5118514">,</span>&nbsp;<span class="ident" id="5118516">nil</span><span class="op" id="5118519">,</span>&nbsp;<span class="num" id="5118521">0</span><span class="op" id="5118522">,</span>&nbsp;<span class="string" id="5118524">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5118569">,</span>&nbsp;<span class="ident" id="5118571">s</span><span class="op" id="5118572">)</span><span class="op" id="5118573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118579">}</span><span class="op" id="5118580">,</span>&nbsp;<span class="builtinfunc" id="5118582">len</span><span class="op" id="5118585">(</span><span class="ident" id="5118586">s</span><span class="op" id="5118587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118596">case</span>&nbsp;<span class="string" id="5118601">&#39;[&#39;</span><span class="op" id="5118604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118609">inCharset</span>&nbsp;<span class="op" id="5118619">=</span>&nbsp;<span class="builtintype" id="5118621">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118628">case</span>&nbsp;<span class="string" id="5118633">&#39;]&#39;</span><span class="op" id="5118636">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118641">inCharset</span>&nbsp;<span class="op" id="5118651">=</span>&nbsp;<span class="builtintype" id="5118653">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118661">default</span><span class="op" id="5118668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5118673">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118693">if</span>&nbsp;<span class="op" id="5118696">!</span><span class="ident" id="5118697">inCharset</span>&nbsp;<span class="op" id="5118707">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118713">c</span><span class="op" id="5118714">.</span><span class="ident" id="5118715">state</span><span class="op" id="5118720">,</span>&nbsp;<span class="ident" id="5118722">c</span><span class="op" id="5118723">.</span><span class="ident" id="5118724">jsCtx</span>&nbsp;<span class="op" id="5118730">=</span>&nbsp;<span class="ident" id="5118732">stateJS</span><span class="op" id="5118739">,</span>&nbsp;<span class="ident" id="5118741">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118756">return</span>&nbsp;<span class="ident" id="5118763">c</span><span class="op" id="5118764">,</span>&nbsp;<span class="ident" id="5118766">i</span>&nbsp;<span class="op" id="5118768">+</span>&nbsp;<span class="num" id="5118770">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118779">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118783">k</span>&nbsp;<span class="op" id="5118785">=</span>&nbsp;<span class="ident" id="5118787">i</span>&nbsp;<span class="op" id="5118789">+</span>&nbsp;<span class="num" id="5118791">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5118794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118798">if</span>&nbsp;<span class="ident" id="5118801">inCharset</span>&nbsp;<span class="op" id="5118811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5118815">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5118880">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5118911">return</span>&nbsp;<span class="ident" id="5118918">context</span><span class="op" id="5118925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118930">state</span><span class="op" id="5118935">:</span>&nbsp;<span class="ident" id="5118937">stateError</span><span class="op" id="5118947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5118952">err</span><span class="op" id="5118955">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5118959">errorf</span><span class="op" id="5118965">(</span><span class="ident" id="5118966">ErrPartialCharset</span><span class="op" id="5118983">,</span>&nbsp;<span class="ident" id="5118985">nil</span><span class="op" id="5118988">,</span>&nbsp;<span class="num" id="5118990">0</span><span class="op" id="5118991">,</span>&nbsp;<span class="string" id="5118993">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="5119027">,</span>&nbsp;<span class="ident" id="5119029">s</span><span class="op" id="5119030">)</span><span class="op" id="5119031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5119035">}</span><span class="op" id="5119036">,</span>&nbsp;<span class="builtinfunc" id="5119038">len</span><span class="op" id="5119041">(</span><span class="ident" id="5119042">s</span><span class="op" id="5119043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5119046">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119050">return</span>&nbsp;<span class="ident" id="5119057">c</span><span class="op" id="5119058">,</span>&nbsp;<span class="builtinfunc" id="5119060">len</span><span class="op" id="5119063">(</span><span class="ident" id="5119064">s</span><span class="op" id="5119065">)</span><br>
<span class="lineno"></span><span class="op" id="5119067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5119070">var</span>&nbsp;<span class="ident" id="5119074">blockCommentEnd</span>&nbsp;<span class="op" id="5119090">=</span>&nbsp;<span class="op" id="5119092">[</span><span class="op" id="5119093">]</span><span class="builtintype" id="5119094">byte</span><span class="op" id="5119098">(</span><span class="string" id="5119099">&#34;*/&#34;</span><span class="op" id="5119103">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="5119106">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5119178">func</span>&nbsp;<span class="ident" id="5119183">tBlockCmt</span><span class="op" id="5119192">(</span><span class="ident" id="5119193">c</span>&nbsp;<span class="ident" id="5119195">context</span><span class="op" id="5119202">,</span>&nbsp;<span class="ident" id="5119204">s</span>&nbsp;<span class="op" id="5119206">[</span><span class="op" id="5119207">]</span><span class="builtintype" id="5119208">byte</span><span class="op" id="5119212">)</span>&nbsp;<span class="op" id="5119214">(</span><span class="ident" id="5119215">context</span><span class="op" id="5119222">,</span>&nbsp;<span class="builtintype" id="5119224">int</span><span class="op" id="5119227">)</span>&nbsp;<span class="op" id="5119229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5119232">i</span>&nbsp;<span class="op" id="5119234">:=</span>&nbsp;<span class="ident" id="5119237">bytes</span><span class="op" id="5119242">.</span><span class="ident" id="5119243">Index</span><span class="op" id="5119248">(</span><span class="ident" id="5119249">s</span><span class="op" id="5119250">,</span>&nbsp;<span class="ident" id="5119252">blockCommentEnd</span><span class="op" id="5119267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119270">if</span>&nbsp;<span class="ident" id="5119273">i</span>&nbsp;<span class="op" id="5119275">==</span>&nbsp;<span class="op" id="5119278">-</span><span class="num" id="5119279">1</span>&nbsp;<span class="op" id="5119281">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119285">return</span>&nbsp;<span class="ident" id="5119292">c</span><span class="op" id="5119293">,</span>&nbsp;<span class="builtinfunc" id="5119295">len</span><span class="op" id="5119298">(</span><span class="ident" id="5119299">s</span><span class="op" id="5119300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5119303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119306">switch</span>&nbsp;<span class="ident" id="5119313">c</span><span class="op" id="5119314">.</span><span class="ident" id="5119315">state</span>&nbsp;<span class="op" id="5119321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119324">case</span>&nbsp;<span class="ident" id="5119329">stateJSBlockCmt</span><span class="op" id="5119344">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5119348">c</span><span class="op" id="5119349">.</span><span class="ident" id="5119350">state</span>&nbsp;<span class="op" id="5119356">=</span>&nbsp;<span class="ident" id="5119358">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119367">case</span>&nbsp;<span class="ident" id="5119372">stateCSSBlockCmt</span><span class="op" id="5119388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5119392">c</span><span class="op" id="5119393">.</span><span class="ident" id="5119394">state</span>&nbsp;<span class="op" id="5119400">=</span>&nbsp;<span class="ident" id="5119402">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119412">default</span><span class="op" id="5119419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5119423">panic</span><span class="op" id="5119428">(</span><span class="ident" id="5119429">c</span><span class="op" id="5119430">.</span><span class="ident" id="5119431">state</span><span class="op" id="5119436">.</span><span class="ident" id="5119437">String</span><span class="op" id="5119443">(</span><span class="op" id="5119444">)</span><span class="op" id="5119445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5119448">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119451">return</span>&nbsp;<span class="ident" id="5119458">c</span><span class="op" id="5119459">,</span>&nbsp;<span class="ident" id="5119461">i</span>&nbsp;<span class="op" id="5119463">+</span>&nbsp;<span class="num" id="5119465">2</span><br>
<span class="lineno"></span><span class="op" id="5119467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5119470">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="5119539">func</span>&nbsp;<span class="ident" id="5119544">tLineCmt</span><span class="op" id="5119552">(</span><span class="ident" id="5119553">c</span>&nbsp;<span class="ident" id="5119555">context</span><span class="op" id="5119562">,</span>&nbsp;<span class="ident" id="5119564">s</span>&nbsp;<span class="op" id="5119566">[</span><span class="op" id="5119567">]</span><span class="builtintype" id="5119568">byte</span><span class="op" id="5119572">)</span>&nbsp;<span class="op" id="5119574">(</span><span class="ident" id="5119575">context</span><span class="op" id="5119582">,</span>&nbsp;<span class="builtintype" id="5119584">int</span><span class="op" id="5119587">)</span>&nbsp;<span class="op" id="5119589">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119592">var</span>&nbsp;<span class="ident" id="5119596">lineTerminators</span>&nbsp;<span class="builtintype" id="5119612">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119620">var</span>&nbsp;<span class="ident" id="5119624">endState</span>&nbsp;<span class="ident" id="5119633">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119640">switch</span>&nbsp;<span class="ident" id="5119647">c</span><span class="op" id="5119648">.</span><span class="ident" id="5119649">state</span>&nbsp;<span class="op" id="5119655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119658">case</span>&nbsp;<span class="ident" id="5119663">stateJSLineCmt</span><span class="op" id="5119677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5119681">lineTerminators</span><span class="op" id="5119696">,</span>&nbsp;<span class="ident" id="5119698">endState</span>&nbsp;<span class="op" id="5119707">=</span>&nbsp;<span class="string" id="5119709">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="5119727">,</span>&nbsp;<span class="ident" id="5119729">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5119738">case</span>&nbsp;<span class="ident" id="5119743">stateCSSLineCmt</span><span class="op" id="5119758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5119762">lineTerminators</span><span class="op" id="5119777">,</span>&nbsp;<span class="ident" id="5119779">endState</span>&nbsp;<span class="op" id="5119788">=</span>&nbsp;<span class="string" id="5119790">&#34;\n\f\r&#34;</span><span class="op" id="5119798">,</span>&nbsp;<span class="ident" id="5119800">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5119811">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5119877">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5119921">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5119956">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5119997">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120060">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120075">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5120116">default</span><span class="op" id="5120123">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5120127">panic</span><span class="op" id="5120132">(</span><span class="ident" id="5120133">c</span><span class="op" id="5120134">.</span><span class="ident" id="5120135">state</span><span class="op" id="5120140">.</span><span class="ident" id="5120141">String</span><span class="op" id="5120147">(</span><span class="op" id="5120148">)</span><span class="op" id="5120149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5120152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5120156">i</span>&nbsp;<span class="op" id="5120158">:=</span>&nbsp;<span class="ident" id="5120161">bytes</span><span class="op" id="5120166">.</span><span class="ident" id="5120167">IndexAny</span><span class="op" id="5120175">(</span><span class="ident" id="5120176">s</span><span class="op" id="5120177">,</span>&nbsp;<span class="ident" id="5120179">lineTerminators</span><span class="op" id="5120194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5120197">if</span>&nbsp;<span class="ident" id="5120200">i</span>&nbsp;<span class="op" id="5120202">==</span>&nbsp;<span class="op" id="5120205">-</span><span class="num" id="5120206">1</span>&nbsp;<span class="op" id="5120208">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5120212">return</span>&nbsp;<span class="ident" id="5120219">c</span><span class="op" id="5120220">,</span>&nbsp;<span class="builtinfunc" id="5120222">len</span><span class="op" id="5120225">(</span><span class="ident" id="5120226">s</span><span class="op" id="5120227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5120230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5120233">c</span><span class="op" id="5120234">.</span><span class="ident" id="5120235">state</span>&nbsp;<span class="op" id="5120241">=</span>&nbsp;<span class="ident" id="5120243">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120253">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120319">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120382">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120442">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120508">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5120572">return</span>&nbsp;<span class="ident" id="5120579">c</span><span class="op" id="5120580">,</span>&nbsp;<span class="ident" id="5120582">i</span><br>
<span class="lineno"></span><span class="op" id="5120584">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="5120587">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5120649">func</span>&nbsp;<span class="ident" id="5120654">tCSS</span><span class="op" id="5120658">(</span><span class="ident" id="5120659">c</span>&nbsp;<span class="ident" id="5120661">context</span><span class="op" id="5120668">,</span>&nbsp;<span class="ident" id="5120670">s</span>&nbsp;<span class="op" id="5120672">[</span><span class="op" id="5120673">]</span><span class="builtintype" id="5120674">byte</span><span class="op" id="5120678">)</span>&nbsp;<span class="op" id="5120680">(</span><span class="ident" id="5120681">context</span><span class="op" id="5120688">,</span>&nbsp;<span class="builtintype" id="5120690">int</span><span class="op" id="5120693">)</span>&nbsp;<span class="op" id="5120695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120698">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120755">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120797">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120863">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120925">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120940">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5120993">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121039">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121090">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121151">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121167">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121224">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121294">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121298">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121361">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121396">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121400">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121454">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121523">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121595">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121616">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121684">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121754">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121815">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121886">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5121955">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5121994">k</span>&nbsp;<span class="op" id="5121996">:=</span>&nbsp;<span class="num" id="5121999">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122002">for</span>&nbsp;<span class="op" id="5122006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122010">i</span>&nbsp;<span class="op" id="5122012">:=</span>&nbsp;<span class="ident" id="5122015">k</span>&nbsp;<span class="op" id="5122017">+</span>&nbsp;<span class="ident" id="5122019">bytes</span><span class="op" id="5122024">.</span><span class="ident" id="5122025">IndexAny</span><span class="op" id="5122033">(</span><span class="ident" id="5122034">s</span><span class="op" id="5122035">[</span><span class="ident" id="5122036">k</span><span class="op" id="5122037">:</span><span class="op" id="5122038">]</span><span class="op" id="5122039">,</span>&nbsp;<span class="string" id="5122041">`(&#34;&#39;/`</span><span class="op" id="5122047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122051">if</span>&nbsp;<span class="ident" id="5122054">i</span>&nbsp;<span class="op" id="5122056">&lt;</span>&nbsp;<span class="ident" id="5122058">k</span>&nbsp;<span class="op" id="5122060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122065">return</span>&nbsp;<span class="ident" id="5122072">c</span><span class="op" id="5122073">,</span>&nbsp;<span class="builtinfunc" id="5122075">len</span><span class="op" id="5122078">(</span><span class="ident" id="5122079">s</span><span class="op" id="5122080">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122088">switch</span>&nbsp;<span class="ident" id="5122095">s</span><span class="op" id="5122096">[</span><span class="ident" id="5122097">i</span><span class="op" id="5122098">]</span>&nbsp;<span class="op" id="5122100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122104">case</span>&nbsp;<span class="string" id="5122109">&#39;(&#39;</span><span class="op" id="5122112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5122117">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122149">p</span>&nbsp;<span class="op" id="5122151">:=</span>&nbsp;<span class="ident" id="5122154">bytes</span><span class="op" id="5122159">.</span><span class="ident" id="5122160">TrimRight</span><span class="op" id="5122169">(</span><span class="ident" id="5122170">s</span><span class="op" id="5122171">[</span><span class="op" id="5122172">:</span><span class="ident" id="5122173">i</span><span class="op" id="5122174">]</span><span class="op" id="5122175">,</span>&nbsp;<span class="string" id="5122177">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5122188">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122193">if</span>&nbsp;<span class="ident" id="5122196">endsWithCSSKeyword</span><span class="op" id="5122214">(</span><span class="ident" id="5122215">p</span><span class="op" id="5122216">,</span>&nbsp;<span class="string" id="5122218">&#34;url&#34;</span><span class="op" id="5122223">)</span>&nbsp;<span class="op" id="5122225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122231">j</span>&nbsp;<span class="op" id="5122233">:=</span>&nbsp;<span class="builtinfunc" id="5122236">len</span><span class="op" id="5122239">(</span><span class="ident" id="5122240">s</span><span class="op" id="5122241">)</span>&nbsp;<span class="op" id="5122243">-</span>&nbsp;<span class="builtinfunc" id="5122245">len</span><span class="op" id="5122248">(</span><span class="ident" id="5122249">bytes</span><span class="op" id="5122254">.</span><span class="ident" id="5122255">TrimLeft</span><span class="op" id="5122263">(</span><span class="ident" id="5122264">s</span><span class="op" id="5122265">[</span><span class="ident" id="5122266">i</span><span class="op" id="5122267">+</span><span class="num" id="5122268">1</span><span class="op" id="5122269">:</span><span class="op" id="5122270">]</span><span class="op" id="5122271">,</span>&nbsp;<span class="string" id="5122273">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="5122284">)</span><span class="op" id="5122285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122291">switch</span>&nbsp;<span class="op" id="5122298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122304">case</span>&nbsp;<span class="ident" id="5122309">j</span>&nbsp;<span class="op" id="5122311">!=</span>&nbsp;<span class="builtinfunc" id="5122314">len</span><span class="op" id="5122317">(</span><span class="ident" id="5122318">s</span><span class="op" id="5122319">)</span>&nbsp;<span class="op" id="5122321">&amp;&amp;</span>&nbsp;<span class="ident" id="5122324">s</span><span class="op" id="5122325">[</span><span class="ident" id="5122326">j</span><span class="op" id="5122327">]</span>&nbsp;<span class="op" id="5122329">==</span>&nbsp;<span class="string" id="5122332">&#39;&#34;&#39;</span><span class="op" id="5122335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122342">c</span><span class="op" id="5122343">.</span><span class="ident" id="5122344">state</span><span class="op" id="5122349">,</span>&nbsp;<span class="ident" id="5122351">j</span>&nbsp;<span class="op" id="5122353">=</span>&nbsp;<span class="ident" id="5122355">stateCSSDqURL</span><span class="op" id="5122368">,</span>&nbsp;<span class="ident" id="5122370">j</span><span class="op" id="5122371">+</span><span class="num" id="5122372">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122378">case</span>&nbsp;<span class="ident" id="5122383">j</span>&nbsp;<span class="op" id="5122385">!=</span>&nbsp;<span class="builtinfunc" id="5122388">len</span><span class="op" id="5122391">(</span><span class="ident" id="5122392">s</span><span class="op" id="5122393">)</span>&nbsp;<span class="op" id="5122395">&amp;&amp;</span>&nbsp;<span class="ident" id="5122398">s</span><span class="op" id="5122399">[</span><span class="ident" id="5122400">j</span><span class="op" id="5122401">]</span>&nbsp;<span class="op" id="5122403">==</span>&nbsp;<span class="string" id="5122406">&#39;\&#39;&#39;</span><span class="op" id="5122410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122417">c</span><span class="op" id="5122418">.</span><span class="ident" id="5122419">state</span><span class="op" id="5122424">,</span>&nbsp;<span class="ident" id="5122426">j</span>&nbsp;<span class="op" id="5122428">=</span>&nbsp;<span class="ident" id="5122430">stateCSSSqURL</span><span class="op" id="5122443">,</span>&nbsp;<span class="ident" id="5122445">j</span><span class="op" id="5122446">+</span><span class="num" id="5122447">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122453">default</span><span class="op" id="5122460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122467">c</span><span class="op" id="5122468">.</span><span class="ident" id="5122469">state</span>&nbsp;<span class="op" id="5122475">=</span>&nbsp;<span class="ident" id="5122477">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122493">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122499">return</span>&nbsp;<span class="ident" id="5122506">c</span><span class="op" id="5122507">,</span>&nbsp;<span class="ident" id="5122509">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122518">case</span>&nbsp;<span class="string" id="5122523">&#39;/&#39;</span><span class="op" id="5122526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122531">if</span>&nbsp;<span class="ident" id="5122534">i</span><span class="op" id="5122535">+</span><span class="num" id="5122536">1</span>&nbsp;<span class="op" id="5122538">&lt;</span>&nbsp;<span class="builtinfunc" id="5122540">len</span><span class="op" id="5122543">(</span><span class="ident" id="5122544">s</span><span class="op" id="5122545">)</span>&nbsp;<span class="op" id="5122547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122553">switch</span>&nbsp;<span class="ident" id="5122560">s</span><span class="op" id="5122561">[</span><span class="ident" id="5122562">i</span><span class="op" id="5122563">+</span><span class="num" id="5122564">1</span><span class="op" id="5122565">]</span>&nbsp;<span class="op" id="5122567">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122573">case</span>&nbsp;<span class="string" id="5122578">&#39;/&#39;</span><span class="op" id="5122581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122588">c</span><span class="op" id="5122589">.</span><span class="ident" id="5122590">state</span>&nbsp;<span class="op" id="5122596">=</span>&nbsp;<span class="ident" id="5122598">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122619">return</span>&nbsp;<span class="ident" id="5122626">c</span><span class="op" id="5122627">,</span>&nbsp;<span class="ident" id="5122629">i</span>&nbsp;<span class="op" id="5122631">+</span>&nbsp;<span class="num" id="5122633">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122639">case</span>&nbsp;<span class="string" id="5122644">&#39;*&#39;</span><span class="op" id="5122647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122654">c</span><span class="op" id="5122655">.</span><span class="ident" id="5122656">state</span>&nbsp;<span class="op" id="5122662">=</span>&nbsp;<span class="ident" id="5122664">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122686">return</span>&nbsp;<span class="ident" id="5122693">c</span><span class="op" id="5122694">,</span>&nbsp;<span class="ident" id="5122696">i</span>&nbsp;<span class="op" id="5122698">+</span>&nbsp;<span class="num" id="5122700">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122715">case</span>&nbsp;<span class="string" id="5122720">&#39;&#34;&#39;</span><span class="op" id="5122723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122728">c</span><span class="op" id="5122729">.</span><span class="ident" id="5122730">state</span>&nbsp;<span class="op" id="5122736">=</span>&nbsp;<span class="ident" id="5122738">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122755">return</span>&nbsp;<span class="ident" id="5122762">c</span><span class="op" id="5122763">,</span>&nbsp;<span class="ident" id="5122765">i</span>&nbsp;<span class="op" id="5122767">+</span>&nbsp;<span class="num" id="5122769">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122773">case</span>&nbsp;<span class="string" id="5122778">&#39;\&#39;&#39;</span><span class="op" id="5122782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122787">c</span><span class="op" id="5122788">.</span><span class="ident" id="5122789">state</span>&nbsp;<span class="op" id="5122795">=</span>&nbsp;<span class="ident" id="5122797">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122814">return</span>&nbsp;<span class="ident" id="5122821">c</span><span class="op" id="5122822">,</span>&nbsp;<span class="ident" id="5122824">i</span>&nbsp;<span class="op" id="5122826">+</span>&nbsp;<span class="num" id="5122828">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122832">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5122836">k</span>&nbsp;<span class="op" id="5122838">=</span>&nbsp;<span class="ident" id="5122840">i</span>&nbsp;<span class="op" id="5122842">+</span>&nbsp;<span class="num" id="5122844">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5122847">}</span><br>
<span class="lineno"></span><span class="op" id="5122849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5122852">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="5122933">func</span>&nbsp;<span class="ident" id="5122938">tCSSStr</span><span class="op" id="5122945">(</span><span class="ident" id="5122946">c</span>&nbsp;<span class="ident" id="5122948">context</span><span class="op" id="5122955">,</span>&nbsp;<span class="ident" id="5122957">s</span>&nbsp;<span class="op" id="5122959">[</span><span class="op" id="5122960">]</span><span class="builtintype" id="5122961">byte</span><span class="op" id="5122965">)</span>&nbsp;<span class="op" id="5122967">(</span><span class="ident" id="5122968">context</span><span class="op" id="5122975">,</span>&nbsp;<span class="builtintype" id="5122977">int</span><span class="op" id="5122980">)</span>&nbsp;<span class="op" id="5122982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5122985">var</span>&nbsp;<span class="ident" id="5122989">endAndEsc</span>&nbsp;<span class="builtintype" id="5122999">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123007">switch</span>&nbsp;<span class="ident" id="5123014">c</span><span class="op" id="5123015">.</span><span class="ident" id="5123016">state</span>&nbsp;<span class="op" id="5123022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123025">case</span>&nbsp;<span class="ident" id="5123030">stateCSSDqStr</span><span class="op" id="5123043">,</span>&nbsp;<span class="ident" id="5123045">stateCSSDqURL</span><span class="op" id="5123058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123062">endAndEsc</span>&nbsp;<span class="op" id="5123072">=</span>&nbsp;<span class="string" id="5123074">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123080">case</span>&nbsp;<span class="ident" id="5123085">stateCSSSqStr</span><span class="op" id="5123098">,</span>&nbsp;<span class="ident" id="5123100">stateCSSSqURL</span><span class="op" id="5123113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123117">endAndEsc</span>&nbsp;<span class="op" id="5123127">=</span>&nbsp;<span class="string" id="5123129">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123135">case</span>&nbsp;<span class="ident" id="5123140">stateCSSURL</span><span class="op" id="5123151">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5123155">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5123215">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123277">endAndEsc</span>&nbsp;<span class="op" id="5123287">=</span>&nbsp;<span class="string" id="5123289">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123305">default</span><span class="op" id="5123312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5123316">panic</span><span class="op" id="5123321">(</span><span class="ident" id="5123322">c</span><span class="op" id="5123323">.</span><span class="ident" id="5123324">state</span><span class="op" id="5123329">.</span><span class="ident" id="5123330">String</span><span class="op" id="5123336">(</span><span class="op" id="5123337">)</span><span class="op" id="5123338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123345">k</span>&nbsp;<span class="op" id="5123347">:=</span>&nbsp;<span class="num" id="5123350">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123353">for</span>&nbsp;<span class="op" id="5123357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123361">i</span>&nbsp;<span class="op" id="5123363">:=</span>&nbsp;<span class="ident" id="5123366">k</span>&nbsp;<span class="op" id="5123368">+</span>&nbsp;<span class="ident" id="5123370">bytes</span><span class="op" id="5123375">.</span><span class="ident" id="5123376">IndexAny</span><span class="op" id="5123384">(</span><span class="ident" id="5123385">s</span><span class="op" id="5123386">[</span><span class="ident" id="5123387">k</span><span class="op" id="5123388">:</span><span class="op" id="5123389">]</span><span class="op" id="5123390">,</span>&nbsp;<span class="ident" id="5123392">endAndEsc</span><span class="op" id="5123401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123405">if</span>&nbsp;<span class="ident" id="5123408">i</span>&nbsp;<span class="op" id="5123410">&lt;</span>&nbsp;<span class="ident" id="5123412">k</span>&nbsp;<span class="op" id="5123414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123419">c</span><span class="op" id="5123420">,</span>&nbsp;<span class="ident" id="5123422">nread</span>&nbsp;<span class="op" id="5123428">:=</span>&nbsp;<span class="ident" id="5123431">tURL</span><span class="op" id="5123435">(</span><span class="ident" id="5123436">c</span><span class="op" id="5123437">,</span>&nbsp;<span class="ident" id="5123439">decodeCSS</span><span class="op" id="5123448">(</span><span class="ident" id="5123449">s</span><span class="op" id="5123450">[</span><span class="ident" id="5123451">k</span><span class="op" id="5123452">:</span><span class="op" id="5123453">]</span><span class="op" id="5123454">)</span><span class="op" id="5123455">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123460">return</span>&nbsp;<span class="ident" id="5123467">c</span><span class="op" id="5123468">,</span>&nbsp;<span class="ident" id="5123470">k</span>&nbsp;<span class="op" id="5123472">+</span>&nbsp;<span class="ident" id="5123474">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123486">if</span>&nbsp;<span class="ident" id="5123489">s</span><span class="op" id="5123490">[</span><span class="ident" id="5123491">i</span><span class="op" id="5123492">]</span>&nbsp;<span class="op" id="5123494">==</span>&nbsp;<span class="string" id="5123497">&#39;\\&#39;</span>&nbsp;<span class="op" id="5123502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123507">i</span><span class="op" id="5123508">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123514">if</span>&nbsp;<span class="ident" id="5123517">i</span>&nbsp;<span class="op" id="5123519">==</span>&nbsp;<span class="builtinfunc" id="5123522">len</span><span class="op" id="5123525">(</span><span class="ident" id="5123526">s</span><span class="op" id="5123527">)</span>&nbsp;<span class="op" id="5123529">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123535">return</span>&nbsp;<span class="ident" id="5123542">context</span><span class="op" id="5123549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123556">state</span><span class="op" id="5123561">:</span>&nbsp;<span class="ident" id="5123563">stateError</span><span class="op" id="5123573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123580">err</span><span class="op" id="5123583">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5123587">errorf</span><span class="op" id="5123593">(</span><span class="ident" id="5123594">ErrPartialEscape</span><span class="op" id="5123610">,</span>&nbsp;<span class="ident" id="5123612">nil</span><span class="op" id="5123615">,</span>&nbsp;<span class="num" id="5123617">0</span><span class="op" id="5123618">,</span>&nbsp;<span class="string" id="5123620">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="5123666">,</span>&nbsp;<span class="ident" id="5123668">s</span><span class="op" id="5123669">)</span><span class="op" id="5123670">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123676">}</span><span class="op" id="5123677">,</span>&nbsp;<span class="builtinfunc" id="5123679">len</span><span class="op" id="5123682">(</span><span class="ident" id="5123683">s</span><span class="op" id="5123684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123689">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123693">}</span>&nbsp;<span class="keyword" id="5123695">else</span>&nbsp;<span class="op" id="5123700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123705">c</span><span class="op" id="5123706">.</span><span class="ident" id="5123707">state</span>&nbsp;<span class="op" id="5123713">=</span>&nbsp;<span class="ident" id="5123715">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123727">return</span>&nbsp;<span class="ident" id="5123734">c</span><span class="op" id="5123735">,</span>&nbsp;<span class="ident" id="5123737">i</span>&nbsp;<span class="op" id="5123739">+</span>&nbsp;<span class="num" id="5123741">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123749">c</span><span class="op" id="5123750">,</span>&nbsp;<span class="ident" id="5123752">_</span>&nbsp;<span class="op" id="5123754">=</span>&nbsp;<span class="ident" id="5123756">tURL</span><span class="op" id="5123760">(</span><span class="ident" id="5123761">c</span><span class="op" id="5123762">,</span>&nbsp;<span class="ident" id="5123764">decodeCSS</span><span class="op" id="5123773">(</span><span class="ident" id="5123774">s</span><span class="op" id="5123775">[</span><span class="op" id="5123776">:</span><span class="ident" id="5123777">i</span><span class="op" id="5123778">+</span><span class="num" id="5123779">1</span><span class="op" id="5123780">]</span><span class="op" id="5123781">)</span><span class="op" id="5123782">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5123786">k</span>&nbsp;<span class="op" id="5123788">=</span>&nbsp;<span class="ident" id="5123790">i</span>&nbsp;<span class="op" id="5123792">+</span>&nbsp;<span class="num" id="5123794">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5123797">}</span><br>
<span class="lineno"></span><span class="op" id="5123799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5123802">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="5123868">func</span>&nbsp;<span class="ident" id="5123873">tError</span><span class="op" id="5123879">(</span><span class="ident" id="5123880">c</span>&nbsp;<span class="ident" id="5123882">context</span><span class="op" id="5123889">,</span>&nbsp;<span class="ident" id="5123891">s</span>&nbsp;<span class="op" id="5123893">[</span><span class="op" id="5123894">]</span><span class="builtintype" id="5123895">byte</span><span class="op" id="5123899">)</span>&nbsp;<span class="op" id="5123901">(</span><span class="ident" id="5123902">context</span><span class="op" id="5123909">,</span>&nbsp;<span class="builtintype" id="5123911">int</span><span class="op" id="5123914">)</span>&nbsp;<span class="op" id="5123916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5123919">return</span>&nbsp;<span class="ident" id="5123926">c</span><span class="op" id="5123927">,</span>&nbsp;<span class="builtinfunc" id="5123929">len</span><span class="op" id="5123932">(</span><span class="ident" id="5123933">s</span><span class="op" id="5123934">)</span><br>
<span class="lineno"></span><span class="op" id="5123936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5123939">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="5124015">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5124084">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="5124157">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="5124173">func</span>&nbsp;<span class="ident" id="5124178">eatAttrName</span><span class="op" id="5124189">(</span><span class="ident" id="5124190">s</span>&nbsp;<span class="op" id="5124192">[</span><span class="op" id="5124193">]</span><span class="builtintype" id="5124194">byte</span><span class="op" id="5124198">,</span>&nbsp;<span class="ident" id="5124200">i</span>&nbsp;<span class="builtintype" id="5124202">int</span><span class="op" id="5124205">)</span>&nbsp;<span class="op" id="5124207">(</span><span class="builtintype" id="5124208">int</span><span class="op" id="5124211">,</span>&nbsp;<span class="op" id="5124213">*</span><span class="ident" id="5124214">Error</span><span class="op" id="5124219">)</span>&nbsp;<span class="op" id="5124221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124224">for</span>&nbsp;<span class="ident" id="5124228">j</span>&nbsp;<span class="op" id="5124230">:=</span>&nbsp;<span class="ident" id="5124233">i</span><span class="op" id="5124234">;</span>&nbsp;<span class="ident" id="5124236">j</span>&nbsp;<span class="op" id="5124238">&lt;</span>&nbsp;<span class="builtinfunc" id="5124240">len</span><span class="op" id="5124243">(</span><span class="ident" id="5124244">s</span><span class="op" id="5124245">)</span><span class="op" id="5124246">;</span>&nbsp;<span class="ident" id="5124248">j</span><span class="op" id="5124249">++</span>&nbsp;<span class="op" id="5124252">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124256">switch</span>&nbsp;<span class="ident" id="5124263">s</span><span class="op" id="5124264">[</span><span class="ident" id="5124265">j</span><span class="op" id="5124266">]</span>&nbsp;<span class="op" id="5124268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124272">case</span>&nbsp;<span class="string" id="5124277">&#39;&nbsp;&#39;</span><span class="op" id="5124280">,</span>&nbsp;<span class="string" id="5124282">&#39;\t&#39;</span><span class="op" id="5124286">,</span>&nbsp;<span class="string" id="5124288">&#39;\n&#39;</span><span class="op" id="5124292">,</span>&nbsp;<span class="string" id="5124294">&#39;\f&#39;</span><span class="op" id="5124298">,</span>&nbsp;<span class="string" id="5124300">&#39;\r&#39;</span><span class="op" id="5124304">,</span>&nbsp;<span class="string" id="5124306">&#39;=&#39;</span><span class="op" id="5124309">,</span>&nbsp;<span class="string" id="5124311">&#39;&gt;&#39;</span><span class="op" id="5124314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124319">return</span>&nbsp;<span class="ident" id="5124326">j</span><span class="op" id="5124327">,</span>&nbsp;<span class="ident" id="5124329">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124335">case</span>&nbsp;<span class="string" id="5124340">&#39;\&#39;&#39;</span><span class="op" id="5124344">,</span>&nbsp;<span class="string" id="5124346">&#39;&#34;&#39;</span><span class="op" id="5124349">,</span>&nbsp;<span class="string" id="5124351">&#39;&lt;&#39;</span><span class="op" id="5124354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5124359">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5124414">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5124470">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124496">return</span>&nbsp;<span class="op" id="5124503">-</span><span class="num" id="5124504">1</span><span class="op" id="5124505">,</span>&nbsp;<span class="ident" id="5124507">errorf</span><span class="op" id="5124513">(</span><span class="ident" id="5124514">ErrBadHTML</span><span class="op" id="5124524">,</span>&nbsp;<span class="ident" id="5124526">nil</span><span class="op" id="5124529">,</span>&nbsp;<span class="num" id="5124531">0</span><span class="op" id="5124532">,</span>&nbsp;<span class="string" id="5124534">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="5124563">,</span>&nbsp;<span class="ident" id="5124565">s</span><span class="op" id="5124566">[</span><span class="ident" id="5124567">j</span><span class="op" id="5124568">:</span><span class="ident" id="5124569">j</span><span class="op" id="5124570">+</span><span class="num" id="5124571">1</span><span class="op" id="5124572">]</span><span class="op" id="5124573">,</span>&nbsp;<span class="ident" id="5124575">s</span><span class="op" id="5124576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124580">default</span><span class="op" id="5124587">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5124592">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5124604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5124607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124610">return</span>&nbsp;<span class="builtinfunc" id="5124617">len</span><span class="op" id="5124620">(</span><span class="ident" id="5124621">s</span><span class="op" id="5124622">)</span><span class="op" id="5124623">,</span>&nbsp;<span class="ident" id="5124625">nil</span><br>
<span class="lineno"></span><span class="op" id="5124629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="5124632">var</span>&nbsp;<span class="ident" id="5124636">elementNameMap</span>&nbsp;<span class="op" id="5124651">=</span>&nbsp;<span class="keyword" id="5124653">map</span><span class="op" id="5124656">[</span><span class="builtintype" id="5124657">string</span><span class="op" id="5124663">]</span><span class="ident" id="5124664">element</span><span class="op" id="5124671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5124674">&#34;script&#34;</span><span class="op" id="5124682">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5124686">elementScript</span><span class="op" id="5124699">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5124702">&#34;style&#34;</span><span class="op" id="5124709">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5124714">elementStyle</span><span class="op" id="5124726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5124729">&#34;textarea&#34;</span><span class="op" id="5124739">:</span>&nbsp;<span class="ident" id="5124741">elementTextarea</span><span class="op" id="5124756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5124759">&#34;title&#34;</span><span class="op" id="5124766">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5124771">elementTitle</span><span class="op" id="5124783">,</span><br>
<span class="lineno">505</span><span class="op" id="5124785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5124788">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="5124840">func</span>&nbsp;<span class="ident" id="5124845">asciiAlpha</span><span class="op" id="5124855">(</span><span class="ident" id="5124856">c</span>&nbsp;<span class="builtintype" id="5124858">byte</span><span class="op" id="5124862">)</span>&nbsp;<span class="builtintype" id="5124864">bool</span>&nbsp;<span class="op" id="5124869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5124872">return</span>&nbsp;<span class="string" id="5124879">&#39;A&#39;</span>&nbsp;<span class="op" id="5124883">&lt;=</span>&nbsp;<span class="ident" id="5124886">c</span>&nbsp;<span class="op" id="5124888">&amp;&amp;</span>&nbsp;<span class="ident" id="5124891">c</span>&nbsp;<span class="op" id="5124893">&lt;=</span>&nbsp;<span class="string" id="5124896">&#39;Z&#39;</span>&nbsp;<span class="op" id="5124900">||</span>&nbsp;<span class="string" id="5124903">&#39;a&#39;</span>&nbsp;<span class="op" id="5124907">&lt;=</span>&nbsp;<span class="ident" id="5124910">c</span>&nbsp;<span class="op" id="5124912">&amp;&amp;</span>&nbsp;<span class="ident" id="5124915">c</span>&nbsp;<span class="op" id="5124917">&lt;=</span>&nbsp;<span class="string" id="5124920">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="5124924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5124927">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="5124991">func</span>&nbsp;<span class="ident" id="5124996">asciiAlphaNum</span><span class="op" id="5125009">(</span><span class="ident" id="5125010">c</span>&nbsp;<span class="builtintype" id="5125012">byte</span><span class="op" id="5125016">)</span>&nbsp;<span class="builtintype" id="5125018">bool</span>&nbsp;<span class="op" id="5125023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125026">return</span>&nbsp;<span class="ident" id="5125033">asciiAlpha</span><span class="op" id="5125043">(</span><span class="ident" id="5125044">c</span><span class="op" id="5125045">)</span>&nbsp;<span class="op" id="5125047">||</span>&nbsp;<span class="string" id="5125050">&#39;0&#39;</span>&nbsp;<span class="op" id="5125054">&lt;=</span>&nbsp;<span class="ident" id="5125057">c</span>&nbsp;<span class="op" id="5125059">&amp;&amp;</span>&nbsp;<span class="ident" id="5125062">c</span>&nbsp;<span class="op" id="5125064">&lt;=</span>&nbsp;<span class="string" id="5125067">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="5125071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5125074">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5125159">func</span>&nbsp;<span class="ident" id="5125164">eatTagName</span><span class="op" id="5125174">(</span><span class="ident" id="5125175">s</span>&nbsp;<span class="op" id="5125177">[</span><span class="op" id="5125178">]</span><span class="builtintype" id="5125179">byte</span><span class="op" id="5125183">,</span>&nbsp;<span class="ident" id="5125185">i</span>&nbsp;<span class="builtintype" id="5125187">int</span><span class="op" id="5125190">)</span>&nbsp;<span class="op" id="5125192">(</span><span class="builtintype" id="5125193">int</span><span class="op" id="5125196">,</span>&nbsp;<span class="ident" id="5125198">element</span><span class="op" id="5125205">)</span>&nbsp;<span class="op" id="5125207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125210">if</span>&nbsp;<span class="ident" id="5125213">i</span>&nbsp;<span class="op" id="5125215">==</span>&nbsp;<span class="builtinfunc" id="5125218">len</span><span class="op" id="5125221">(</span><span class="ident" id="5125222">s</span><span class="op" id="5125223">)</span>&nbsp;<span class="op" id="5125225">||</span>&nbsp;<span class="op" id="5125228">!</span><span class="ident" id="5125229">asciiAlpha</span><span class="op" id="5125239">(</span><span class="ident" id="5125240">s</span><span class="op" id="5125241">[</span><span class="ident" id="5125242">i</span><span class="op" id="5125243">]</span><span class="op" id="5125244">)</span>&nbsp;<span class="op" id="5125246">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125250">return</span>&nbsp;<span class="ident" id="5125257">i</span><span class="op" id="5125258">,</span>&nbsp;<span class="ident" id="5125260">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5125276">j</span>&nbsp;<span class="op" id="5125278">:=</span>&nbsp;<span class="ident" id="5125281">i</span>&nbsp;<span class="op" id="5125283">+</span>&nbsp;<span class="num" id="5125285">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125288">for</span>&nbsp;<span class="ident" id="5125292">j</span>&nbsp;<span class="op" id="5125294">&lt;</span>&nbsp;<span class="builtinfunc" id="5125296">len</span><span class="op" id="5125299">(</span><span class="ident" id="5125300">s</span><span class="op" id="5125301">)</span>&nbsp;<span class="op" id="5125303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5125307">x</span>&nbsp;<span class="op" id="5125309">:=</span>&nbsp;<span class="ident" id="5125312">s</span><span class="op" id="5125313">[</span><span class="ident" id="5125314">j</span><span class="op" id="5125315">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125319">if</span>&nbsp;<span class="ident" id="5125322">asciiAlphaNum</span><span class="op" id="5125335">(</span><span class="ident" id="5125336">x</span><span class="op" id="5125337">)</span>&nbsp;<span class="op" id="5125339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5125344">j</span><span class="op" id="5125345">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125351">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5125366">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125423">if</span>&nbsp;<span class="op" id="5125426">(</span><span class="ident" id="5125427">x</span>&nbsp;<span class="op" id="5125429">==</span>&nbsp;<span class="string" id="5125432">&#39;:&#39;</span>&nbsp;<span class="op" id="5125436">||</span>&nbsp;<span class="ident" id="5125439">x</span>&nbsp;<span class="op" id="5125441">==</span>&nbsp;<span class="string" id="5125444">&#39;-&#39;</span><span class="op" id="5125447">)</span>&nbsp;<span class="op" id="5125449">&amp;&amp;</span>&nbsp;<span class="ident" id="5125452">j</span><span class="op" id="5125453">+</span><span class="num" id="5125454">1</span>&nbsp;<span class="op" id="5125456">&lt;</span>&nbsp;<span class="builtinfunc" id="5125458">len</span><span class="op" id="5125461">(</span><span class="ident" id="5125462">s</span><span class="op" id="5125463">)</span>&nbsp;<span class="op" id="5125465">&amp;&amp;</span>&nbsp;<span class="ident" id="5125468">asciiAlphaNum</span><span class="op" id="5125481">(</span><span class="ident" id="5125482">s</span><span class="op" id="5125483">[</span><span class="ident" id="5125484">j</span><span class="op" id="5125485">+</span><span class="num" id="5125486">1</span><span class="op" id="5125487">]</span><span class="op" id="5125488">)</span>&nbsp;<span class="op" id="5125490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5125495">j</span>&nbsp;<span class="op" id="5125497">+=</span>&nbsp;<span class="num" id="5125500">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125505">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125520">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125530">return</span>&nbsp;<span class="ident" id="5125537">j</span><span class="op" id="5125538">,</span>&nbsp;<span class="ident" id="5125540">elementNameMap</span><span class="op" id="5125554">[</span><span class="ident" id="5125555">strings</span><span class="op" id="5125562">.</span><span class="ident" id="5125563">ToLower</span><span class="op" id="5125570">(</span><span class="builtintype" id="5125571">string</span><span class="op" id="5125577">(</span><span class="ident" id="5125578">s</span><span class="op" id="5125579">[</span><span class="ident" id="5125580">i</span><span class="op" id="5125581">:</span><span class="ident" id="5125582">j</span><span class="op" id="5125583">]</span><span class="op" id="5125584">)</span><span class="op" id="5125585">)</span><span class="op" id="5125586">]</span><br>
<span class="lineno"></span><span class="op" id="5125588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5125591">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="5125663">func</span>&nbsp;<span class="ident" id="5125668">eatWhiteSpace</span><span class="op" id="5125681">(</span><span class="ident" id="5125682">s</span>&nbsp;<span class="op" id="5125684">[</span><span class="op" id="5125685">]</span><span class="builtintype" id="5125686">byte</span><span class="op" id="5125690">,</span>&nbsp;<span class="ident" id="5125692">i</span>&nbsp;<span class="builtintype" id="5125694">int</span><span class="op" id="5125697">)</span>&nbsp;<span class="builtintype" id="5125699">int</span>&nbsp;<span class="op" id="5125703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125706">for</span>&nbsp;<span class="ident" id="5125710">j</span>&nbsp;<span class="op" id="5125712">:=</span>&nbsp;<span class="ident" id="5125715">i</span><span class="op" id="5125716">;</span>&nbsp;<span class="ident" id="5125718">j</span>&nbsp;<span class="op" id="5125720">&lt;</span>&nbsp;<span class="builtinfunc" id="5125722">len</span><span class="op" id="5125725">(</span><span class="ident" id="5125726">s</span><span class="op" id="5125727">)</span><span class="op" id="5125728">;</span>&nbsp;<span class="ident" id="5125730">j</span><span class="op" id="5125731">++</span>&nbsp;<span class="op" id="5125734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125738">switch</span>&nbsp;<span class="ident" id="5125745">s</span><span class="op" id="5125746">[</span><span class="ident" id="5125747">j</span><span class="op" id="5125748">]</span>&nbsp;<span class="op" id="5125750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125754">case</span>&nbsp;<span class="string" id="5125759">&#39;&nbsp;&#39;</span><span class="op" id="5125762">,</span>&nbsp;<span class="string" id="5125764">&#39;\t&#39;</span><span class="op" id="5125768">,</span>&nbsp;<span class="string" id="5125770">&#39;\n&#39;</span><span class="op" id="5125774">,</span>&nbsp;<span class="string" id="5125776">&#39;\f&#39;</span><span class="op" id="5125780">,</span>&nbsp;<span class="string" id="5125782">&#39;\r&#39;</span><span class="op" id="5125786">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5125791">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125803">default</span><span class="op" id="5125810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125815">return</span>&nbsp;<span class="ident" id="5125822">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5125829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5125832">return</span>&nbsp;<span class="builtinfunc" id="5125839">len</span><span class="op" id="5125842">(</span><span class="ident" id="5125843">s</span><span class="op" id="5125844">)</span><br>
<span class="lineno">550</span><span class="op" id="5125846">}</span>
</div>
</body>
</html>
