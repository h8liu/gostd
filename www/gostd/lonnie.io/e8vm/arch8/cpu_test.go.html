<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8489742">package</span>&nbsp;<span class="ident" id="8489750">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8489757">import</span>&nbsp;<span class="op" id="8489764">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8489767">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8489777">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8489780">type</span>&nbsp;<span class="ident" id="8489785">ti1</span>&nbsp;<span class="builtintype" id="8489789">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8489794">func</span>&nbsp;<span class="op" id="8489799">(</span><span class="ident" id="8489800">i</span>&nbsp;<span class="ident" id="8489802">ti1</span><span class="op" id="8489805">)</span>&nbsp;<span class="ident" id="8489807">I</span><span class="op" id="8489808">(</span><span class="ident" id="8489809">cpu</span>&nbsp;<span class="op" id="8489813">*</span><span class="ident" id="8489814">cpu</span><span class="op" id="8489817">,</span>&nbsp;<span class="ident" id="8489819">in</span>&nbsp;<span class="builtintype" id="8489822">uint32</span><span class="op" id="8489828">)</span>&nbsp;<span class="op" id="8489830">*</span><span class="ident" id="8489831">Excep</span>&nbsp;<span class="op" id="8489837">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489840">switch</span>&nbsp;<span class="ident" id="8489847">in</span>&nbsp;<span class="op" id="8489850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489853">case</span>&nbsp;<span class="num" id="8489858">0</span><span class="op" id="8489859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489863">return</span>&nbsp;<span class="ident" id="8489870">errHalt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489879">case</span>&nbsp;<span class="num" id="8489884">1</span><span class="op" id="8489885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489889">return</span>&nbsp;<span class="ident" id="8489896">errTimeInt</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489908">case</span>&nbsp;<span class="num" id="8489913">2</span><span class="op" id="8489914">:</span>&nbsp;<span class="comment" id="8489916">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489926">if</span>&nbsp;<span class="ident" id="8489929">cpu</span><span class="op" id="8489932">.</span><span class="ident" id="8489933">UserMode</span><span class="op" id="8489941">(</span><span class="op" id="8489942">)</span>&nbsp;<span class="op" id="8489944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489949">return</span>&nbsp;<span class="ident" id="8489956">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8489973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489977">return</span>&nbsp;<span class="ident" id="8489984">cpu</span><span class="op" id="8489987">.</span><span class="ident" id="8489988">Iret</span><span class="op" id="8489992">(</span><span class="op" id="8489993">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8489996">default</span><span class="op" id="8490003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490007">return</span>&nbsp;<span class="ident" id="8490014">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490030">}</span><br>
<span class="lineno"></span><span class="op" id="8490032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8490035">func</span>&nbsp;<span class="ident" id="8490040">TestCPU</span><span class="op" id="8490047">(</span><span class="ident" id="8490048">t</span>&nbsp;<span class="op" id="8490050">*</span><span class="ident" id="8490051">testing</span><span class="op" id="8490058">.</span><span class="ident" id="8490059">T</span><span class="op" id="8490060">)</span>&nbsp;<span class="op" id="8490062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490065">as</span>&nbsp;<span class="op" id="8490068">:=</span>&nbsp;<span class="keyword" id="8490071">func</span><span class="op" id="8490075">(</span><span class="ident" id="8490076">cond</span>&nbsp;<span class="builtintype" id="8490081">bool</span><span class="op" id="8490085">,</span>&nbsp;<span class="ident" id="8490087">s</span>&nbsp;<span class="builtintype" id="8490089">string</span><span class="op" id="8490095">,</span>&nbsp;<span class="ident" id="8490097">args</span>&nbsp;<span class="op" id="8490102">...</span><span class="keyword" id="8490105">interface</span><span class="op" id="8490114">{</span><span class="op" id="8490115">}</span><span class="op" id="8490116">)</span>&nbsp;<span class="op" id="8490118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490122">if</span>&nbsp;<span class="op" id="8490125">!</span><span class="ident" id="8490126">cond</span>&nbsp;<span class="op" id="8490131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490136">t</span><span class="op" id="8490137">.</span><span class="ident" id="8490138">Fatalf</span><span class="op" id="8490144">(</span><span class="ident" id="8490145">s</span><span class="op" id="8490146">,</span>&nbsp;<span class="ident" id="8490148">args</span><span class="op" id="8490152">...</span><span class="op" id="8490155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490159">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490166">m</span>&nbsp;<span class="op" id="8490168">:=</span>&nbsp;<span class="ident" id="8490171">newPhyMemory</span><span class="op" id="8490183">(</span><span class="ident" id="8490184">PageSize</span>&nbsp;<span class="op" id="8490193">*</span>&nbsp;<span class="num" id="8490195">32</span><span class="op" id="8490197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490200">cpu</span>&nbsp;<span class="op" id="8490204">:=</span>&nbsp;<span class="ident" id="8490207">newCPU</span><span class="op" id="8490213">(</span><span class="ident" id="8490214">m</span><span class="op" id="8490215">,</span>&nbsp;<span class="ident" id="8490217">ti1</span><span class="op" id="8490220">(</span><span class="num" id="8490221">0</span><span class="op" id="8490222">)</span><span class="op" id="8490223">,</span>&nbsp;<span class="num" id="8490225">0</span><span class="op" id="8490226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490229">e</span>&nbsp;<span class="op" id="8490231">:=</span>&nbsp;<span class="ident" id="8490234">cpu</span><span class="op" id="8490237">.</span><span class="ident" id="8490238">Tick</span><span class="op" id="8490242">(</span><span class="op" id="8490243">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490246">as</span><span class="op" id="8490248">(</span><span class="ident" id="8490249">e</span>&nbsp;<span class="op" id="8490251">==</span>&nbsp;<span class="ident" id="8490254">errHalt</span><span class="op" id="8490261">,</span>&nbsp;<span class="string" id="8490263">&#34;not&nbsp;halting&#34;</span><span class="op" id="8490276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490280">cpu</span><span class="op" id="8490283">.</span><span class="ident" id="8490284">Reset</span><span class="op" id="8490289">(</span><span class="op" id="8490290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490293">m</span><span class="op" id="8490294">.</span><span class="ident" id="8490295">WriteWord</span><span class="op" id="8490304">(</span><span class="ident" id="8490305">InitPC</span><span class="op" id="8490311">,</span>&nbsp;<span class="num" id="8490313">1</span><span class="op" id="8490314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490317">e</span>&nbsp;<span class="op" id="8490319">=</span>&nbsp;<span class="ident" id="8490321">cpu</span><span class="op" id="8490324">.</span><span class="ident" id="8490325">Tick</span><span class="op" id="8490329">(</span><span class="op" id="8490330">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490333">as</span><span class="op" id="8490335">(</span><span class="ident" id="8490336">e</span>&nbsp;<span class="op" id="8490338">==</span>&nbsp;<span class="ident" id="8490341">errTimeInt</span><span class="op" id="8490351">,</span>&nbsp;<span class="string" id="8490353">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="8490373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490377">cpu</span><span class="op" id="8490380">.</span><span class="ident" id="8490381">Reset</span><span class="op" id="8490386">(</span><span class="op" id="8490387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490390">cpu</span><span class="op" id="8490393">.</span><span class="ident" id="8490394">interrupt</span><span class="op" id="8490403">.</span><span class="ident" id="8490404">Enable</span><span class="op" id="8490410">(</span><span class="op" id="8490411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490414">cpu</span><span class="op" id="8490417">.</span><span class="ident" id="8490418">interrupt</span><span class="op" id="8490427">.</span><span class="ident" id="8490428">EnableInt</span><span class="op" id="8490437">(</span><span class="ident" id="8490438">errTimeInt</span><span class="op" id="8490448">.</span><span class="ident" id="8490449">Code</span><span class="op" id="8490453">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490456">cpu</span><span class="op" id="8490459">.</span><span class="ident" id="8490460">interrupt</span><span class="op" id="8490469">.</span><span class="ident" id="8490470">writeWord</span><span class="op" id="8490479">(</span><span class="ident" id="8490480">intKernelSP</span><span class="op" id="8490491">,</span>&nbsp;<span class="num" id="8490493">0x10000</span><span class="op" id="8490500">)</span>&nbsp;&nbsp;<span class="comment" id="8490503">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490515">cpu</span><span class="op" id="8490518">.</span><span class="ident" id="8490519">interrupt</span><span class="op" id="8490528">.</span><span class="ident" id="8490529">writeWord</span><span class="op" id="8490538">(</span><span class="ident" id="8490539">intHandlerPC</span><span class="op" id="8490551">,</span>&nbsp;<span class="num" id="8490553">0x10000</span><span class="op" id="8490560">)</span>&nbsp;<span class="comment" id="8490562">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490574">cpu</span><span class="op" id="8490577">.</span><span class="ident" id="8490578">ring</span>&nbsp;<span class="op" id="8490583">=</span>&nbsp;<span class="num" id="8490585">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490589">e</span>&nbsp;<span class="op" id="8490591">=</span>&nbsp;<span class="ident" id="8490593">cpu</span><span class="op" id="8490596">.</span><span class="ident" id="8490597">Tick</span><span class="op" id="8490601">(</span><span class="op" id="8490602">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490605">as</span><span class="op" id="8490607">(</span><span class="ident" id="8490608">e</span>&nbsp;<span class="op" id="8490610">==</span>&nbsp;<span class="ident" id="8490613">nil</span><span class="op" id="8490616">,</span>&nbsp;<span class="string" id="8490618">&#34;should&nbsp;have&nbsp;no&nbsp;error&#34;</span><span class="op" id="8490640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490643">as</span><span class="op" id="8490645">(</span><span class="ident" id="8490646">cpu</span><span class="op" id="8490649">.</span><span class="ident" id="8490650">regs</span><span class="op" id="8490654">[</span><span class="ident" id="8490655">PC</span><span class="op" id="8490657">]</span>&nbsp;<span class="op" id="8490659">==</span>&nbsp;<span class="num" id="8490662">0x10000</span><span class="op" id="8490669">,</span>&nbsp;<span class="string" id="8490671">&#34;pc&nbsp;incorrect&#34;</span><span class="op" id="8490685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490688">as</span><span class="op" id="8490690">(</span><span class="ident" id="8490691">cpu</span><span class="op" id="8490694">.</span><span class="ident" id="8490695">regs</span><span class="op" id="8490699">[</span><span class="ident" id="8490700">SP</span><span class="op" id="8490702">]</span>&nbsp;<span class="op" id="8490704">==</span>&nbsp;<span class="num" id="8490707">0x10000</span><span class="op" id="8490714">,</span>&nbsp;<span class="string" id="8490716">&#34;sp&nbsp;incorrect&#34;</span><span class="op" id="8490730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490733">as</span><span class="op" id="8490735">(</span><span class="ident" id="8490736">cpu</span><span class="op" id="8490739">.</span><span class="ident" id="8490740">regs</span><span class="op" id="8490744">[</span><span class="ident" id="8490745">RET</span><span class="op" id="8490748">]</span>&nbsp;<span class="op" id="8490750">==</span>&nbsp;<span class="num" id="8490753">0x8000</span><span class="op" id="8490759">,</span>&nbsp;<span class="string" id="8490761">&#34;ret&nbsp;incorrect&#34;</span><span class="op" id="8490776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490779">as</span><span class="op" id="8490781">(</span><span class="op" id="8490782">!</span><span class="ident" id="8490783">cpu</span><span class="op" id="8490786">.</span><span class="ident" id="8490787">UserMode</span><span class="op" id="8490795">(</span><span class="op" id="8490796">)</span><span class="op" id="8490797">,</span>&nbsp;<span class="string" id="8490799">&#34;not&nbsp;in&nbsp;kernel&#34;</span><span class="op" id="8490814">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490817">b</span><span class="op" id="8490818">,</span>&nbsp;<span class="ident" id="8490820">e</span>&nbsp;<span class="op" id="8490822">:=</span>&nbsp;<span class="ident" id="8490825">m</span><span class="op" id="8490826">.</span><span class="ident" id="8490827">ReadByte</span><span class="op" id="8490835">(</span><span class="num" id="8490836">0x10000</span>&nbsp;<span class="op" id="8490844">-</span>&nbsp;<span class="ident" id="8490846">intFrameSize</span>&nbsp;<span class="op" id="8490859">+</span>&nbsp;<span class="ident" id="8490861">intFrameCode</span><span class="op" id="8490873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490876">as</span><span class="op" id="8490878">(</span><span class="ident" id="8490879">e</span>&nbsp;<span class="op" id="8490881">==</span>&nbsp;<span class="ident" id="8490884">nil</span><span class="op" id="8490887">,</span>&nbsp;<span class="string" id="8490889">&#34;read&nbsp;byte&nbsp;error&#34;</span><span class="op" id="8490906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490909">as</span><span class="op" id="8490911">(</span><span class="ident" id="8490912">b</span>&nbsp;<span class="op" id="8490914">==</span>&nbsp;<span class="ident" id="8490917">errTimeInt</span><span class="op" id="8490927">.</span><span class="ident" id="8490928">Code</span><span class="op" id="8490932">,</span>&nbsp;<span class="string" id="8490934">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="8490954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490957">b</span><span class="op" id="8490958">,</span>&nbsp;<span class="ident" id="8490960">e</span>&nbsp;<span class="op" id="8490962">=</span>&nbsp;<span class="ident" id="8490964">m</span><span class="op" id="8490965">.</span><span class="ident" id="8490966">ReadByte</span><span class="op" id="8490974">(</span><span class="num" id="8490975">0x10000</span>&nbsp;<span class="op" id="8490983">-</span>&nbsp;<span class="ident" id="8490985">intFrameSize</span>&nbsp;<span class="op" id="8490998">+</span>&nbsp;<span class="ident" id="8491000">intFrameRing</span><span class="op" id="8491012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491015">as</span><span class="op" id="8491017">(</span><span class="ident" id="8491018">b</span>&nbsp;<span class="op" id="8491020">==</span>&nbsp;<span class="num" id="8491023">1</span><span class="op" id="8491024">,</span>&nbsp;<span class="string" id="8491026">&#34;was&nbsp;not&nbsp;in&nbsp;user&#34;</span><span class="op" id="8491043">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491046">as</span><span class="op" id="8491048">(</span><span class="op" id="8491049">!</span><span class="ident" id="8491050">cpu</span><span class="op" id="8491053">.</span><span class="ident" id="8491054">interrupt</span><span class="op" id="8491063">.</span><span class="ident" id="8491064">Enabled</span><span class="op" id="8491071">(</span><span class="op" id="8491072">)</span><span class="op" id="8491073">,</span>&nbsp;<span class="string" id="8491075">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="8491099">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491103">e</span>&nbsp;<span class="op" id="8491105">=</span>&nbsp;<span class="ident" id="8491107">cpu</span><span class="op" id="8491110">.</span><span class="ident" id="8491111">Tick</span><span class="op" id="8491115">(</span><span class="op" id="8491116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491119">as</span><span class="op" id="8491121">(</span><span class="ident" id="8491122">e</span>&nbsp;<span class="op" id="8491124">==</span>&nbsp;<span class="ident" id="8491127">errHalt</span><span class="op" id="8491134">,</span>&nbsp;<span class="string" id="8491136">&#34;should&nbsp;halt&nbsp;now&#34;</span><span class="op" id="8491153">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491157">cpu</span><span class="op" id="8491160">.</span><span class="ident" id="8491161">Reset</span><span class="op" id="8491166">(</span><span class="op" id="8491167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491170">cpu</span><span class="op" id="8491173">.</span><span class="ident" id="8491174">interrupt</span><span class="op" id="8491183">.</span><span class="ident" id="8491184">Enable</span><span class="op" id="8491190">(</span><span class="op" id="8491191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491194">cpu</span><span class="op" id="8491197">.</span><span class="ident" id="8491198">ring</span>&nbsp;<span class="op" id="8491203">=</span>&nbsp;<span class="num" id="8491205">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491208">m</span><span class="op" id="8491209">.</span><span class="ident" id="8491210">WriteWord</span><span class="op" id="8491219">(</span><span class="num" id="8491220">0x10000</span><span class="op" id="8491227">,</span>&nbsp;<span class="num" id="8491229">2</span><span class="op" id="8491230">)</span>&nbsp;<span class="comment" id="8491232">//&nbsp;write&nbsp;an&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491250">e</span>&nbsp;<span class="op" id="8491252">=</span>&nbsp;<span class="ident" id="8491254">cpu</span><span class="op" id="8491257">.</span><span class="ident" id="8491258">Tick</span><span class="op" id="8491262">(</span><span class="op" id="8491263">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491266">as</span><span class="op" id="8491268">(</span><span class="ident" id="8491269">e</span>&nbsp;<span class="op" id="8491271">==</span>&nbsp;<span class="ident" id="8491274">nil</span><span class="op" id="8491277">,</span>&nbsp;<span class="string" id="8491279">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8491301">,</span>&nbsp;<span class="ident" id="8491303">e</span><span class="op" id="8491304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491307">as</span><span class="op" id="8491309">(</span><span class="op" id="8491310">!</span><span class="ident" id="8491311">cpu</span><span class="op" id="8491314">.</span><span class="ident" id="8491315">interrupt</span><span class="op" id="8491324">.</span><span class="ident" id="8491325">Enabled</span><span class="op" id="8491332">(</span><span class="op" id="8491333">)</span><span class="op" id="8491334">,</span>&nbsp;<span class="string" id="8491336">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="8491360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491363">e</span>&nbsp;<span class="op" id="8491365">=</span>&nbsp;<span class="ident" id="8491367">cpu</span><span class="op" id="8491370">.</span><span class="ident" id="8491371">Tick</span><span class="op" id="8491375">(</span><span class="op" id="8491376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491379">as</span><span class="op" id="8491381">(</span><span class="ident" id="8491382">e</span>&nbsp;<span class="op" id="8491384">==</span>&nbsp;<span class="ident" id="8491387">nil</span><span class="op" id="8491390">,</span>&nbsp;<span class="string" id="8491392">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8491414">,</span>&nbsp;<span class="ident" id="8491416">e</span><span class="op" id="8491417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491420">as</span><span class="op" id="8491422">(</span><span class="ident" id="8491423">cpu</span><span class="op" id="8491426">.</span><span class="ident" id="8491427">regs</span><span class="op" id="8491431">[</span><span class="ident" id="8491432">PC</span><span class="op" id="8491434">]</span>&nbsp;<span class="op" id="8491436">==</span>&nbsp;<span class="num" id="8491439">0x8000</span><span class="op" id="8491445">,</span>&nbsp;<span class="string" id="8491447">&#34;pc&nbsp;not&nbsp;iret&#39;ed&#34;</span><span class="op" id="8491463">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491466">as</span><span class="op" id="8491468">(</span><span class="ident" id="8491469">cpu</span><span class="op" id="8491472">.</span><span class="ident" id="8491473">regs</span><span class="op" id="8491477">[</span><span class="ident" id="8491478">SP</span><span class="op" id="8491480">]</span>&nbsp;<span class="op" id="8491482">==</span>&nbsp;<span class="num" id="8491485">0</span><span class="op" id="8491486">,</span>&nbsp;<span class="string" id="8491488">&#34;sp&nbsp;not&nbsp;restored&#34;</span><span class="op" id="8491505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491508">as</span><span class="op" id="8491510">(</span><span class="ident" id="8491511">cpu</span><span class="op" id="8491514">.</span><span class="ident" id="8491515">ring</span>&nbsp;<span class="op" id="8491520">==</span>&nbsp;<span class="num" id="8491523">1</span><span class="op" id="8491524">,</span>&nbsp;<span class="string" id="8491526">&#34;ring&nbsp;not&nbsp;restored&#34;</span><span class="op" id="8491545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491548">as</span><span class="op" id="8491550">(</span><span class="ident" id="8491551">cpu</span><span class="op" id="8491554">.</span><span class="ident" id="8491555">interrupt</span><span class="op" id="8491564">.</span><span class="ident" id="8491565">Enabled</span><span class="op" id="8491572">(</span><span class="op" id="8491573">)</span><span class="op" id="8491574">,</span>&nbsp;<span class="string" id="8491576">&#34;interrupt&nbsp;not&nbsp;enabled&nbsp;again&#34;</span><span class="op" id="8491605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491608">has</span><span class="op" id="8491611">,</span>&nbsp;<span class="ident" id="8491613">code</span>&nbsp;<span class="op" id="8491618">:=</span>&nbsp;<span class="ident" id="8491621">cpu</span><span class="op" id="8491624">.</span><span class="ident" id="8491625">interrupt</span><span class="op" id="8491634">.</span><span class="ident" id="8491635">Poll</span><span class="op" id="8491639">(</span><span class="op" id="8491640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491643">as</span><span class="op" id="8491645">(</span><span class="op" id="8491646">!</span><span class="ident" id="8491647">has</span>&nbsp;<span class="op" id="8491651">&amp;&amp;</span>&nbsp;<span class="ident" id="8491654">code</span>&nbsp;<span class="op" id="8491659">==</span>&nbsp;<span class="num" id="8491662">0</span><span class="op" id="8491663">,</span>&nbsp;<span class="string" id="8491665">&#34;interrupt&nbsp;was&nbsp;not&nbsp;cleared&#34;</span><span class="op" id="8491692">)</span><br>
<span class="lineno">80</span><span class="op" id="8491694">}</span>
</div>
</body>
</html>
