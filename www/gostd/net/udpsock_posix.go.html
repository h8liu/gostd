<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3411741">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3411797">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3411851">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3411902">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3411980">package</span>&nbsp;<span class="ident" id="3411988">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3411993">import</span>&nbsp;<span class="op" id="3412000">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3412003">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3412014">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3412021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3412024">func</span>&nbsp;<span class="ident" id="3412029">sockaddrToUDP</span><span class="op" id="3412042">(</span><span class="ident" id="3412043">sa</span>&nbsp;<span class="ident" id="3412046">syscall</span><span class="op" id="3412053">.</span><span class="ident" id="3412054">Sockaddr</span><span class="op" id="3412062">)</span>&nbsp;<span class="ident" id="3412064">Addr</span>&nbsp;<span class="op" id="3412069">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412072">switch</span>&nbsp;<span class="ident" id="3412079">sa</span>&nbsp;<span class="op" id="3412082">:=</span>&nbsp;<span class="ident" id="3412085">sa</span><span class="op" id="3412087">.</span><span class="op" id="3412088">(</span><span class="keyword" id="3412089">type</span><span class="op" id="3412093">)</span>&nbsp;<span class="op" id="3412095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412098">case</span>&nbsp;<span class="op" id="3412103">*</span><span class="ident" id="3412104">syscall</span><span class="op" id="3412111">.</span><span class="ident" id="3412112">SockaddrInet4</span><span class="op" id="3412125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412129">return</span>&nbsp;<span class="op" id="3412136">&amp;</span><span class="ident" id="3412137">UDPAddr</span><span class="op" id="3412144">{</span><span class="ident" id="3412145">IP</span><span class="op" id="3412147">:</span>&nbsp;<span class="ident" id="3412149">sa</span><span class="op" id="3412151">.</span><span class="ident" id="3412152">Addr</span><span class="op" id="3412156">[</span><span class="num" id="3412157">0</span><span class="op" id="3412158">:</span><span class="op" id="3412159">]</span><span class="op" id="3412160">,</span>&nbsp;<span class="ident" id="3412162">Port</span><span class="op" id="3412166">:</span>&nbsp;<span class="ident" id="3412168">sa</span><span class="op" id="3412170">.</span><span class="ident" id="3412171">Port</span><span class="op" id="3412175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412178">case</span>&nbsp;<span class="op" id="3412183">*</span><span class="ident" id="3412184">syscall</span><span class="op" id="3412191">.</span><span class="ident" id="3412192">SockaddrInet6</span><span class="op" id="3412205">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412209">return</span>&nbsp;<span class="op" id="3412216">&amp;</span><span class="ident" id="3412217">UDPAddr</span><span class="op" id="3412224">{</span><span class="ident" id="3412225">IP</span><span class="op" id="3412227">:</span>&nbsp;<span class="ident" id="3412229">sa</span><span class="op" id="3412231">.</span><span class="ident" id="3412232">Addr</span><span class="op" id="3412236">[</span><span class="num" id="3412237">0</span><span class="op" id="3412238">:</span><span class="op" id="3412239">]</span><span class="op" id="3412240">,</span>&nbsp;<span class="ident" id="3412242">Port</span><span class="op" id="3412246">:</span>&nbsp;<span class="ident" id="3412248">sa</span><span class="op" id="3412250">.</span><span class="ident" id="3412251">Port</span><span class="op" id="3412255">,</span>&nbsp;<span class="ident" id="3412257">Zone</span><span class="op" id="3412261">:</span>&nbsp;<span class="ident" id="3412263">zoneToString</span><span class="op" id="3412275">(</span><span class="builtintype" id="3412276">int</span><span class="op" id="3412279">(</span><span class="ident" id="3412280">sa</span><span class="op" id="3412282">.</span><span class="ident" id="3412283">ZoneId</span><span class="op" id="3412289">)</span><span class="op" id="3412290">)</span><span class="op" id="3412291">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412297">return</span>&nbsp;<span class="ident" id="3412304">nil</span><br>
<span class="lineno"></span><span class="op" id="3412308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3412311">func</span>&nbsp;<span class="op" id="3412316">(</span><span class="ident" id="3412317">a</span>&nbsp;<span class="op" id="3412319">*</span><span class="ident" id="3412320">UDPAddr</span><span class="op" id="3412327">)</span>&nbsp;<span class="ident" id="3412329">family</span><span class="op" id="3412335">(</span><span class="op" id="3412336">)</span>&nbsp;<span class="builtintype" id="3412338">int</span>&nbsp;<span class="op" id="3412342">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412345">if</span>&nbsp;<span class="ident" id="3412348">a</span>&nbsp;<span class="op" id="3412350">==</span>&nbsp;<span class="ident" id="3412353">nil</span>&nbsp;<span class="op" id="3412357">||</span>&nbsp;<span class="builtinfunc" id="3412360">len</span><span class="op" id="3412363">(</span><span class="ident" id="3412364">a</span><span class="op" id="3412365">.</span><span class="ident" id="3412366">IP</span><span class="op" id="3412368">)</span>&nbsp;<span class="op" id="3412370">&lt;=</span>&nbsp;<span class="ident" id="3412373">IPv4len</span>&nbsp;<span class="op" id="3412381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412385">return</span>&nbsp;<span class="ident" id="3412392">syscall</span><span class="op" id="3412399">.</span><span class="ident" id="3412400">AF_INET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412412">if</span>&nbsp;<span class="ident" id="3412415">a</span><span class="op" id="3412416">.</span><span class="ident" id="3412417">IP</span><span class="op" id="3412419">.</span><span class="ident" id="3412420">To4</span><span class="op" id="3412423">(</span><span class="op" id="3412424">)</span>&nbsp;<span class="op" id="3412426">!=</span>&nbsp;<span class="ident" id="3412429">nil</span>&nbsp;<span class="op" id="3412433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412437">return</span>&nbsp;<span class="ident" id="3412444">syscall</span><span class="op" id="3412451">.</span><span class="ident" id="3412452">AF_INET</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412464">return</span>&nbsp;<span class="ident" id="3412471">syscall</span><span class="op" id="3412478">.</span><span class="ident" id="3412479">AF_INET6</span><br>
<span class="lineno"></span><span class="op" id="3412488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3412491">func</span>&nbsp;<span class="op" id="3412496">(</span><span class="ident" id="3412497">a</span>&nbsp;<span class="op" id="3412499">*</span><span class="ident" id="3412500">UDPAddr</span><span class="op" id="3412507">)</span>&nbsp;<span class="ident" id="3412509">isWildcard</span><span class="op" id="3412519">(</span><span class="op" id="3412520">)</span>&nbsp;<span class="builtintype" id="3412522">bool</span>&nbsp;<span class="op" id="3412527">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412530">if</span>&nbsp;<span class="ident" id="3412533">a</span>&nbsp;<span class="op" id="3412535">==</span>&nbsp;<span class="ident" id="3412538">nil</span>&nbsp;<span class="op" id="3412542">||</span>&nbsp;<span class="ident" id="3412545">a</span><span class="op" id="3412546">.</span><span class="ident" id="3412547">IP</span>&nbsp;<span class="op" id="3412550">==</span>&nbsp;<span class="ident" id="3412553">nil</span>&nbsp;<span class="op" id="3412557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412561">return</span>&nbsp;<span class="builtintype" id="3412568">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412577">return</span>&nbsp;<span class="ident" id="3412584">a</span><span class="op" id="3412585">.</span><span class="ident" id="3412586">IP</span><span class="op" id="3412588">.</span><span class="ident" id="3412589">IsUnspecified</span><span class="op" id="3412602">(</span><span class="op" id="3412603">)</span><br>
<span class="lineno"></span><span class="op" id="3412605">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="3412608">func</span>&nbsp;<span class="op" id="3412613">(</span><span class="ident" id="3412614">a</span>&nbsp;<span class="op" id="3412616">*</span><span class="ident" id="3412617">UDPAddr</span><span class="op" id="3412624">)</span>&nbsp;<span class="ident" id="3412626">sockaddr</span><span class="op" id="3412634">(</span><span class="ident" id="3412635">family</span>&nbsp;<span class="builtintype" id="3412642">int</span><span class="op" id="3412645">)</span>&nbsp;<span class="op" id="3412647">(</span><span class="ident" id="3412648">syscall</span><span class="op" id="3412655">.</span><span class="ident" id="3412656">Sockaddr</span><span class="op" id="3412664">,</span>&nbsp;<span class="builtintype" id="3412666">error</span><span class="op" id="3412671">)</span>&nbsp;<span class="op" id="3412673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412676">if</span>&nbsp;<span class="ident" id="3412679">a</span>&nbsp;<span class="op" id="3412681">==</span>&nbsp;<span class="ident" id="3412684">nil</span>&nbsp;<span class="op" id="3412688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412692">return</span>&nbsp;<span class="ident" id="3412699">nil</span><span class="op" id="3412702">,</span>&nbsp;<span class="ident" id="3412704">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412709">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412712">return</span>&nbsp;<span class="ident" id="3412719">ipToSockaddr</span><span class="op" id="3412731">(</span><span class="ident" id="3412732">family</span><span class="op" id="3412738">,</span>&nbsp;<span class="ident" id="3412740">a</span><span class="op" id="3412741">.</span><span class="ident" id="3412742">IP</span><span class="op" id="3412744">,</span>&nbsp;<span class="ident" id="3412746">a</span><span class="op" id="3412747">.</span><span class="ident" id="3412748">Port</span><span class="op" id="3412752">,</span>&nbsp;<span class="ident" id="3412754">a</span><span class="op" id="3412755">.</span><span class="ident" id="3412756">Zone</span><span class="op" id="3412760">)</span><br>
<span class="lineno"></span><span class="op" id="3412762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3412765">//&nbsp;UDPConn&nbsp;is&nbsp;the&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;and&nbsp;PacketConn&nbsp;interfaces</span><br>
<span class="lineno"></span><span class="comment" id="3412836">//&nbsp;for&nbsp;UDP&nbsp;network&nbsp;connections.</span><br>
<span class="lineno">50</span><span class="keyword" id="3412868">type</span>&nbsp;<span class="ident" id="3412873">UDPConn</span>&nbsp;<span class="keyword" id="3412881">struct</span>&nbsp;<span class="op" id="3412888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412891">conn</span><br>
<span class="lineno"></span><span class="op" id="3412896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3412899">func</span>&nbsp;<span class="ident" id="3412904">newUDPConn</span><span class="op" id="3412914">(</span><span class="ident" id="3412915">fd</span>&nbsp;<span class="op" id="3412918">*</span><span class="ident" id="3412919">netFD</span><span class="op" id="3412924">)</span>&nbsp;<span class="op" id="3412926">*</span><span class="ident" id="3412927">UDPConn</span>&nbsp;<span class="op" id="3412935">{</span>&nbsp;<span class="keyword" id="3412937">return</span>&nbsp;<span class="op" id="3412944">&amp;</span><span class="ident" id="3412945">UDPConn</span><span class="op" id="3412952">{</span><span class="ident" id="3412953">conn</span><span class="op" id="3412957">{</span><span class="ident" id="3412958">fd</span><span class="op" id="3412960">}</span><span class="op" id="3412961">}</span>&nbsp;<span class="op" id="3412963">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="3412966">//&nbsp;ReadFromUDP&nbsp;reads&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3413036">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;return&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3413107">//&nbsp;that&nbsp;was&nbsp;on&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3413134">//</span><br>
<span class="lineno">60</span><span class="comment" id="3413137">//&nbsp;ReadFromUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3413201">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3413268">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3413288">func</span>&nbsp;<span class="op" id="3413293">(</span><span class="ident" id="3413294">c</span>&nbsp;<span class="op" id="3413296">*</span><span class="ident" id="3413297">UDPConn</span><span class="op" id="3413304">)</span>&nbsp;<span class="ident" id="3413306">ReadFromUDP</span><span class="op" id="3413317">(</span><span class="ident" id="3413318">b</span>&nbsp;<span class="op" id="3413320">[</span><span class="op" id="3413321">]</span><span class="builtintype" id="3413322">byte</span><span class="op" id="3413326">)</span>&nbsp;<span class="op" id="3413328">(</span><span class="ident" id="3413329">n</span>&nbsp;<span class="builtintype" id="3413331">int</span><span class="op" id="3413334">,</span>&nbsp;<span class="ident" id="3413336">addr</span>&nbsp;<span class="op" id="3413341">*</span><span class="ident" id="3413342">UDPAddr</span><span class="op" id="3413349">,</span>&nbsp;<span class="ident" id="3413351">err</span>&nbsp;<span class="builtintype" id="3413355">error</span><span class="op" id="3413360">)</span>&nbsp;<span class="op" id="3413362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413365">if</span>&nbsp;<span class="op" id="3413368">!</span><span class="ident" id="3413369">c</span><span class="op" id="3413370">.</span><span class="ident" id="3413371">ok</span><span class="op" id="3413373">(</span><span class="op" id="3413374">)</span>&nbsp;<span class="op" id="3413376">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413380">return</span>&nbsp;<span class="num" id="3413387">0</span><span class="op" id="3413388">,</span>&nbsp;<span class="ident" id="3413390">nil</span><span class="op" id="3413393">,</span>&nbsp;<span class="ident" id="3413395">syscall</span><span class="op" id="3413402">.</span><span class="ident" id="3413403">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413414">n</span><span class="op" id="3413415">,</span>&nbsp;<span class="ident" id="3413417">sa</span><span class="op" id="3413419">,</span>&nbsp;<span class="ident" id="3413421">err</span>&nbsp;<span class="op" id="3413425">:=</span>&nbsp;<span class="ident" id="3413428">c</span><span class="op" id="3413429">.</span><span class="ident" id="3413430">fd</span><span class="op" id="3413432">.</span><span class="ident" id="3413433">readFrom</span><span class="op" id="3413441">(</span><span class="ident" id="3413442">b</span><span class="op" id="3413443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413446">switch</span>&nbsp;<span class="ident" id="3413453">sa</span>&nbsp;<span class="op" id="3413456">:=</span>&nbsp;<span class="ident" id="3413459">sa</span><span class="op" id="3413461">.</span><span class="op" id="3413462">(</span><span class="keyword" id="3413463">type</span><span class="op" id="3413467">)</span>&nbsp;<span class="op" id="3413469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413472">case</span>&nbsp;<span class="op" id="3413477">*</span><span class="ident" id="3413478">syscall</span><span class="op" id="3413485">.</span><span class="ident" id="3413486">SockaddrInet4</span><span class="op" id="3413499">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413503">addr</span>&nbsp;<span class="op" id="3413508">=</span>&nbsp;<span class="op" id="3413510">&amp;</span><span class="ident" id="3413511">UDPAddr</span><span class="op" id="3413518">{</span><span class="ident" id="3413519">IP</span><span class="op" id="3413521">:</span>&nbsp;<span class="ident" id="3413523">sa</span><span class="op" id="3413525">.</span><span class="ident" id="3413526">Addr</span><span class="op" id="3413530">[</span><span class="num" id="3413531">0</span><span class="op" id="3413532">:</span><span class="op" id="3413533">]</span><span class="op" id="3413534">,</span>&nbsp;<span class="ident" id="3413536">Port</span><span class="op" id="3413540">:</span>&nbsp;<span class="ident" id="3413542">sa</span><span class="op" id="3413544">.</span><span class="ident" id="3413545">Port</span><span class="op" id="3413549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413552">case</span>&nbsp;<span class="op" id="3413557">*</span><span class="ident" id="3413558">syscall</span><span class="op" id="3413565">.</span><span class="ident" id="3413566">SockaddrInet6</span><span class="op" id="3413579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413583">addr</span>&nbsp;<span class="op" id="3413588">=</span>&nbsp;<span class="op" id="3413590">&amp;</span><span class="ident" id="3413591">UDPAddr</span><span class="op" id="3413598">{</span><span class="ident" id="3413599">IP</span><span class="op" id="3413601">:</span>&nbsp;<span class="ident" id="3413603">sa</span><span class="op" id="3413605">.</span><span class="ident" id="3413606">Addr</span><span class="op" id="3413610">[</span><span class="num" id="3413611">0</span><span class="op" id="3413612">:</span><span class="op" id="3413613">]</span><span class="op" id="3413614">,</span>&nbsp;<span class="ident" id="3413616">Port</span><span class="op" id="3413620">:</span>&nbsp;<span class="ident" id="3413622">sa</span><span class="op" id="3413624">.</span><span class="ident" id="3413625">Port</span><span class="op" id="3413629">,</span>&nbsp;<span class="ident" id="3413631">Zone</span><span class="op" id="3413635">:</span>&nbsp;<span class="ident" id="3413637">zoneToString</span><span class="op" id="3413649">(</span><span class="builtintype" id="3413650">int</span><span class="op" id="3413653">(</span><span class="ident" id="3413654">sa</span><span class="op" id="3413656">.</span><span class="ident" id="3413657">ZoneId</span><span class="op" id="3413663">)</span><span class="op" id="3413664">)</span><span class="op" id="3413665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413671">return</span><br>
<span class="lineno">75</span><span class="op" id="3413678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3413681">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3413736">func</span>&nbsp;<span class="op" id="3413741">(</span><span class="ident" id="3413742">c</span>&nbsp;<span class="op" id="3413744">*</span><span class="ident" id="3413745">UDPConn</span><span class="op" id="3413752">)</span>&nbsp;<span class="ident" id="3413754">ReadFrom</span><span class="op" id="3413762">(</span><span class="ident" id="3413763">b</span>&nbsp;<span class="op" id="3413765">[</span><span class="op" id="3413766">]</span><span class="builtintype" id="3413767">byte</span><span class="op" id="3413771">)</span>&nbsp;<span class="op" id="3413773">(</span><span class="builtintype" id="3413774">int</span><span class="op" id="3413777">,</span>&nbsp;<span class="ident" id="3413779">Addr</span><span class="op" id="3413783">,</span>&nbsp;<span class="builtintype" id="3413785">error</span><span class="op" id="3413790">)</span>&nbsp;<span class="op" id="3413792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413795">if</span>&nbsp;<span class="op" id="3413798">!</span><span class="ident" id="3413799">c</span><span class="op" id="3413800">.</span><span class="ident" id="3413801">ok</span><span class="op" id="3413803">(</span><span class="op" id="3413804">)</span>&nbsp;<span class="op" id="3413806">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413810">return</span>&nbsp;<span class="num" id="3413817">0</span><span class="op" id="3413818">,</span>&nbsp;<span class="ident" id="3413820">nil</span><span class="op" id="3413823">,</span>&nbsp;<span class="ident" id="3413825">syscall</span><span class="op" id="3413832">.</span><span class="ident" id="3413833">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413844">n</span><span class="op" id="3413845">,</span>&nbsp;<span class="ident" id="3413847">addr</span><span class="op" id="3413851">,</span>&nbsp;<span class="ident" id="3413853">err</span>&nbsp;<span class="op" id="3413857">:=</span>&nbsp;<span class="ident" id="3413860">c</span><span class="op" id="3413861">.</span><span class="ident" id="3413862">ReadFromUDP</span><span class="op" id="3413873">(</span><span class="ident" id="3413874">b</span><span class="op" id="3413875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413878">return</span>&nbsp;<span class="ident" id="3413885">n</span><span class="op" id="3413886">,</span>&nbsp;<span class="ident" id="3413888">addr</span><span class="op" id="3413892">.</span><span class="ident" id="3413893">toAddr</span><span class="op" id="3413899">(</span><span class="op" id="3413900">)</span><span class="op" id="3413901">,</span>&nbsp;<span class="ident" id="3413903">err</span><br>
<span class="lineno"></span><span class="op" id="3413907">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3413910">//&nbsp;ReadMsgUDP&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3413978">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="3414046">//&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3414114">//&nbsp;flags&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the</span><br>
<span class="lineno">90</span><span class="comment" id="3414181">//&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3414192">func</span>&nbsp;<span class="op" id="3414197">(</span><span class="ident" id="3414198">c</span>&nbsp;<span class="op" id="3414200">*</span><span class="ident" id="3414201">UDPConn</span><span class="op" id="3414208">)</span>&nbsp;<span class="ident" id="3414210">ReadMsgUDP</span><span class="op" id="3414220">(</span><span class="ident" id="3414221">b</span><span class="op" id="3414222">,</span>&nbsp;<span class="ident" id="3414224">oob</span>&nbsp;<span class="op" id="3414228">[</span><span class="op" id="3414229">]</span><span class="builtintype" id="3414230">byte</span><span class="op" id="3414234">)</span>&nbsp;<span class="op" id="3414236">(</span><span class="ident" id="3414237">n</span><span class="op" id="3414238">,</span>&nbsp;<span class="ident" id="3414240">oobn</span><span class="op" id="3414244">,</span>&nbsp;<span class="ident" id="3414246">flags</span>&nbsp;<span class="builtintype" id="3414252">int</span><span class="op" id="3414255">,</span>&nbsp;<span class="ident" id="3414257">addr</span>&nbsp;<span class="op" id="3414262">*</span><span class="ident" id="3414263">UDPAddr</span><span class="op" id="3414270">,</span>&nbsp;<span class="ident" id="3414272">err</span>&nbsp;<span class="builtintype" id="3414276">error</span><span class="op" id="3414281">)</span>&nbsp;<span class="op" id="3414283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414286">if</span>&nbsp;<span class="op" id="3414289">!</span><span class="ident" id="3414290">c</span><span class="op" id="3414291">.</span><span class="ident" id="3414292">ok</span><span class="op" id="3414294">(</span><span class="op" id="3414295">)</span>&nbsp;<span class="op" id="3414297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414301">return</span>&nbsp;<span class="num" id="3414308">0</span><span class="op" id="3414309">,</span>&nbsp;<span class="num" id="3414311">0</span><span class="op" id="3414312">,</span>&nbsp;<span class="num" id="3414314">0</span><span class="op" id="3414315">,</span>&nbsp;<span class="ident" id="3414317">nil</span><span class="op" id="3414320">,</span>&nbsp;<span class="ident" id="3414322">syscall</span><span class="op" id="3414329">.</span><span class="ident" id="3414330">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414338">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414341">var</span>&nbsp;<span class="ident" id="3414345">sa</span>&nbsp;<span class="ident" id="3414348">syscall</span><span class="op" id="3414355">.</span><span class="ident" id="3414356">Sockaddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414366">n</span><span class="op" id="3414367">,</span>&nbsp;<span class="ident" id="3414369">oobn</span><span class="op" id="3414373">,</span>&nbsp;<span class="ident" id="3414375">flags</span><span class="op" id="3414380">,</span>&nbsp;<span class="ident" id="3414382">sa</span><span class="op" id="3414384">,</span>&nbsp;<span class="ident" id="3414386">err</span>&nbsp;<span class="op" id="3414390">=</span>&nbsp;<span class="ident" id="3414392">c</span><span class="op" id="3414393">.</span><span class="ident" id="3414394">fd</span><span class="op" id="3414396">.</span><span class="ident" id="3414397">readMsg</span><span class="op" id="3414404">(</span><span class="ident" id="3414405">b</span><span class="op" id="3414406">,</span>&nbsp;<span class="ident" id="3414408">oob</span><span class="op" id="3414411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414414">switch</span>&nbsp;<span class="ident" id="3414421">sa</span>&nbsp;<span class="op" id="3414424">:=</span>&nbsp;<span class="ident" id="3414427">sa</span><span class="op" id="3414429">.</span><span class="op" id="3414430">(</span><span class="keyword" id="3414431">type</span><span class="op" id="3414435">)</span>&nbsp;<span class="op" id="3414437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414440">case</span>&nbsp;<span class="op" id="3414445">*</span><span class="ident" id="3414446">syscall</span><span class="op" id="3414453">.</span><span class="ident" id="3414454">SockaddrInet4</span><span class="op" id="3414467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414471">addr</span>&nbsp;<span class="op" id="3414476">=</span>&nbsp;<span class="op" id="3414478">&amp;</span><span class="ident" id="3414479">UDPAddr</span><span class="op" id="3414486">{</span><span class="ident" id="3414487">IP</span><span class="op" id="3414489">:</span>&nbsp;<span class="ident" id="3414491">sa</span><span class="op" id="3414493">.</span><span class="ident" id="3414494">Addr</span><span class="op" id="3414498">[</span><span class="num" id="3414499">0</span><span class="op" id="3414500">:</span><span class="op" id="3414501">]</span><span class="op" id="3414502">,</span>&nbsp;<span class="ident" id="3414504">Port</span><span class="op" id="3414508">:</span>&nbsp;<span class="ident" id="3414510">sa</span><span class="op" id="3414512">.</span><span class="ident" id="3414513">Port</span><span class="op" id="3414517">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414520">case</span>&nbsp;<span class="op" id="3414525">*</span><span class="ident" id="3414526">syscall</span><span class="op" id="3414533">.</span><span class="ident" id="3414534">SockaddrInet6</span><span class="op" id="3414547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414551">addr</span>&nbsp;<span class="op" id="3414556">=</span>&nbsp;<span class="op" id="3414558">&amp;</span><span class="ident" id="3414559">UDPAddr</span><span class="op" id="3414566">{</span><span class="ident" id="3414567">IP</span><span class="op" id="3414569">:</span>&nbsp;<span class="ident" id="3414571">sa</span><span class="op" id="3414573">.</span><span class="ident" id="3414574">Addr</span><span class="op" id="3414578">[</span><span class="num" id="3414579">0</span><span class="op" id="3414580">:</span><span class="op" id="3414581">]</span><span class="op" id="3414582">,</span>&nbsp;<span class="ident" id="3414584">Port</span><span class="op" id="3414588">:</span>&nbsp;<span class="ident" id="3414590">sa</span><span class="op" id="3414592">.</span><span class="ident" id="3414593">Port</span><span class="op" id="3414597">,</span>&nbsp;<span class="ident" id="3414599">Zone</span><span class="op" id="3414603">:</span>&nbsp;<span class="ident" id="3414605">zoneToString</span><span class="op" id="3414617">(</span><span class="builtintype" id="3414618">int</span><span class="op" id="3414621">(</span><span class="ident" id="3414622">sa</span><span class="op" id="3414624">.</span><span class="ident" id="3414625">ZoneId</span><span class="op" id="3414631">)</span><span class="op" id="3414632">)</span><span class="op" id="3414633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414639">return</span><br>
<span class="lineno"></span><span class="op" id="3414646">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="3414649">//&nbsp;WriteToUDP&nbsp;writes&nbsp;a&nbsp;UDP&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3414718">//&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3414729">//</span><br>
<span class="lineno"></span><span class="comment" id="3414732">//&nbsp;WriteToUDP&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">110</span><span class="comment" id="3414795">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3414862">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3414931">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3414944">func</span>&nbsp;<span class="op" id="3414949">(</span><span class="ident" id="3414950">c</span>&nbsp;<span class="op" id="3414952">*</span><span class="ident" id="3414953">UDPConn</span><span class="op" id="3414960">)</span>&nbsp;<span class="ident" id="3414962">WriteToUDP</span><span class="op" id="3414972">(</span><span class="ident" id="3414973">b</span>&nbsp;<span class="op" id="3414975">[</span><span class="op" id="3414976">]</span><span class="builtintype" id="3414977">byte</span><span class="op" id="3414981">,</span>&nbsp;<span class="ident" id="3414983">addr</span>&nbsp;<span class="op" id="3414988">*</span><span class="ident" id="3414989">UDPAddr</span><span class="op" id="3414996">)</span>&nbsp;<span class="op" id="3414998">(</span><span class="builtintype" id="3414999">int</span><span class="op" id="3415002">,</span>&nbsp;<span class="builtintype" id="3415004">error</span><span class="op" id="3415009">)</span>&nbsp;<span class="op" id="3415011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415014">if</span>&nbsp;<span class="op" id="3415017">!</span><span class="ident" id="3415018">c</span><span class="op" id="3415019">.</span><span class="ident" id="3415020">ok</span><span class="op" id="3415022">(</span><span class="op" id="3415023">)</span>&nbsp;<span class="op" id="3415025">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415029">return</span>&nbsp;<span class="num" id="3415036">0</span><span class="op" id="3415037">,</span>&nbsp;<span class="ident" id="3415039">syscall</span><span class="op" id="3415046">.</span><span class="ident" id="3415047">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415058">if</span>&nbsp;<span class="ident" id="3415061">c</span><span class="op" id="3415062">.</span><span class="ident" id="3415063">fd</span><span class="op" id="3415065">.</span><span class="ident" id="3415066">isConnected</span>&nbsp;<span class="op" id="3415078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415082">return</span>&nbsp;<span class="num" id="3415089">0</span><span class="op" id="3415090">,</span>&nbsp;<span class="op" id="3415092">&amp;</span><span class="ident" id="3415093">OpError</span><span class="op" id="3415100">{</span><span class="string" id="3415101">&#34;write&#34;</span><span class="op" id="3415108">,</span>&nbsp;<span class="ident" id="3415110">c</span><span class="op" id="3415111">.</span><span class="ident" id="3415112">fd</span><span class="op" id="3415114">.</span><span class="ident" id="3415115">net</span><span class="op" id="3415118">,</span>&nbsp;<span class="ident" id="3415120">addr</span><span class="op" id="3415124">,</span>&nbsp;<span class="ident" id="3415126">ErrWriteToConnected</span><span class="op" id="3415145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415148">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415151">if</span>&nbsp;<span class="ident" id="3415154">addr</span>&nbsp;<span class="op" id="3415159">==</span>&nbsp;<span class="ident" id="3415162">nil</span>&nbsp;<span class="op" id="3415166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415170">return</span>&nbsp;<span class="num" id="3415177">0</span><span class="op" id="3415178">,</span>&nbsp;<span class="op" id="3415180">&amp;</span><span class="ident" id="3415181">OpError</span><span class="op" id="3415188">{</span><span class="ident" id="3415189">Op</span><span class="op" id="3415191">:</span>&nbsp;<span class="string" id="3415193">&#34;write&#34;</span><span class="op" id="3415200">,</span>&nbsp;<span class="ident" id="3415202">Net</span><span class="op" id="3415205">:</span>&nbsp;<span class="ident" id="3415207">c</span><span class="op" id="3415208">.</span><span class="ident" id="3415209">fd</span><span class="op" id="3415211">.</span><span class="ident" id="3415212">net</span><span class="op" id="3415215">,</span>&nbsp;<span class="ident" id="3415217">Addr</span><span class="op" id="3415221">:</span>&nbsp;<span class="ident" id="3415223">nil</span><span class="op" id="3415226">,</span>&nbsp;<span class="ident" id="3415228">Err</span><span class="op" id="3415231">:</span>&nbsp;<span class="ident" id="3415233">errMissingAddress</span><span class="op" id="3415250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415256">sa</span><span class="op" id="3415258">,</span>&nbsp;<span class="ident" id="3415260">err</span>&nbsp;<span class="op" id="3415264">:=</span>&nbsp;<span class="ident" id="3415267">addr</span><span class="op" id="3415271">.</span><span class="ident" id="3415272">sockaddr</span><span class="op" id="3415280">(</span><span class="ident" id="3415281">c</span><span class="op" id="3415282">.</span><span class="ident" id="3415283">fd</span><span class="op" id="3415285">.</span><span class="ident" id="3415286">family</span><span class="op" id="3415292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415295">if</span>&nbsp;<span class="ident" id="3415298">err</span>&nbsp;<span class="op" id="3415302">!=</span>&nbsp;<span class="ident" id="3415305">nil</span>&nbsp;<span class="op" id="3415309">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415313">return</span>&nbsp;<span class="num" id="3415320">0</span><span class="op" id="3415321">,</span>&nbsp;<span class="op" id="3415323">&amp;</span><span class="ident" id="3415324">OpError</span><span class="op" id="3415331">{</span><span class="string" id="3415332">&#34;write&#34;</span><span class="op" id="3415339">,</span>&nbsp;<span class="ident" id="3415341">c</span><span class="op" id="3415342">.</span><span class="ident" id="3415343">fd</span><span class="op" id="3415345">.</span><span class="ident" id="3415346">net</span><span class="op" id="3415349">,</span>&nbsp;<span class="ident" id="3415351">addr</span><span class="op" id="3415355">,</span>&nbsp;<span class="ident" id="3415357">err</span><span class="op" id="3415360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415366">return</span>&nbsp;<span class="ident" id="3415373">c</span><span class="op" id="3415374">.</span><span class="ident" id="3415375">fd</span><span class="op" id="3415377">.</span><span class="ident" id="3415378">writeTo</span><span class="op" id="3415385">(</span><span class="ident" id="3415386">b</span><span class="op" id="3415387">,</span>&nbsp;<span class="ident" id="3415389">sa</span><span class="op" id="3415391">)</span><br>
<span class="lineno"></span><span class="op" id="3415393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3415396">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3415449">func</span>&nbsp;<span class="op" id="3415454">(</span><span class="ident" id="3415455">c</span>&nbsp;<span class="op" id="3415457">*</span><span class="ident" id="3415458">UDPConn</span><span class="op" id="3415465">)</span>&nbsp;<span class="ident" id="3415467">WriteTo</span><span class="op" id="3415474">(</span><span class="ident" id="3415475">b</span>&nbsp;<span class="op" id="3415477">[</span><span class="op" id="3415478">]</span><span class="builtintype" id="3415479">byte</span><span class="op" id="3415483">,</span>&nbsp;<span class="ident" id="3415485">addr</span>&nbsp;<span class="ident" id="3415490">Addr</span><span class="op" id="3415494">)</span>&nbsp;<span class="op" id="3415496">(</span><span class="builtintype" id="3415497">int</span><span class="op" id="3415500">,</span>&nbsp;<span class="builtintype" id="3415502">error</span><span class="op" id="3415507">)</span>&nbsp;<span class="op" id="3415509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415512">if</span>&nbsp;<span class="op" id="3415515">!</span><span class="ident" id="3415516">c</span><span class="op" id="3415517">.</span><span class="ident" id="3415518">ok</span><span class="op" id="3415520">(</span><span class="op" id="3415521">)</span>&nbsp;<span class="op" id="3415523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415527">return</span>&nbsp;<span class="num" id="3415534">0</span><span class="op" id="3415535">,</span>&nbsp;<span class="ident" id="3415537">syscall</span><span class="op" id="3415544">.</span><span class="ident" id="3415545">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415553">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415556">a</span><span class="op" id="3415557">,</span>&nbsp;<span class="ident" id="3415559">ok</span>&nbsp;<span class="op" id="3415562">:=</span>&nbsp;<span class="ident" id="3415565">addr</span><span class="op" id="3415569">.</span><span class="op" id="3415570">(</span><span class="op" id="3415571">*</span><span class="ident" id="3415572">UDPAddr</span><span class="op" id="3415579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415582">if</span>&nbsp;<span class="op" id="3415585">!</span><span class="ident" id="3415586">ok</span>&nbsp;<span class="op" id="3415589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415593">return</span>&nbsp;<span class="num" id="3415600">0</span><span class="op" id="3415601">,</span>&nbsp;<span class="op" id="3415603">&amp;</span><span class="ident" id="3415604">OpError</span><span class="op" id="3415611">{</span><span class="string" id="3415612">&#34;write&#34;</span><span class="op" id="3415619">,</span>&nbsp;<span class="ident" id="3415621">c</span><span class="op" id="3415622">.</span><span class="ident" id="3415623">fd</span><span class="op" id="3415625">.</span><span class="ident" id="3415626">net</span><span class="op" id="3415629">,</span>&nbsp;<span class="ident" id="3415631">addr</span><span class="op" id="3415635">,</span>&nbsp;<span class="ident" id="3415637">syscall</span><span class="op" id="3415644">.</span><span class="ident" id="3415645">EINVAL</span><span class="op" id="3415651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415657">return</span>&nbsp;<span class="ident" id="3415664">c</span><span class="op" id="3415665">.</span><span class="ident" id="3415666">WriteToUDP</span><span class="op" id="3415676">(</span><span class="ident" id="3415677">b</span><span class="op" id="3415678">,</span>&nbsp;<span class="ident" id="3415680">a</span><span class="op" id="3415681">)</span><br>
<span class="lineno">140</span><span class="op" id="3415683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3415686">//&nbsp;WriteMsgUDP&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="3415757">//&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3415824">//&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">145</span><span class="keyword" id="3415876">func</span>&nbsp;<span class="op" id="3415881">(</span><span class="ident" id="3415882">c</span>&nbsp;<span class="op" id="3415884">*</span><span class="ident" id="3415885">UDPConn</span><span class="op" id="3415892">)</span>&nbsp;<span class="ident" id="3415894">WriteMsgUDP</span><span class="op" id="3415905">(</span><span class="ident" id="3415906">b</span><span class="op" id="3415907">,</span>&nbsp;<span class="ident" id="3415909">oob</span>&nbsp;<span class="op" id="3415913">[</span><span class="op" id="3415914">]</span><span class="builtintype" id="3415915">byte</span><span class="op" id="3415919">,</span>&nbsp;<span class="ident" id="3415921">addr</span>&nbsp;<span class="op" id="3415926">*</span><span class="ident" id="3415927">UDPAddr</span><span class="op" id="3415934">)</span>&nbsp;<span class="op" id="3415936">(</span><span class="ident" id="3415937">n</span><span class="op" id="3415938">,</span>&nbsp;<span class="ident" id="3415940">oobn</span>&nbsp;<span class="builtintype" id="3415945">int</span><span class="op" id="3415948">,</span>&nbsp;<span class="ident" id="3415950">err</span>&nbsp;<span class="builtintype" id="3415954">error</span><span class="op" id="3415959">)</span>&nbsp;<span class="op" id="3415961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415964">if</span>&nbsp;<span class="op" id="3415967">!</span><span class="ident" id="3415968">c</span><span class="op" id="3415969">.</span><span class="ident" id="3415970">ok</span><span class="op" id="3415972">(</span><span class="op" id="3415973">)</span>&nbsp;<span class="op" id="3415975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415979">return</span>&nbsp;<span class="num" id="3415986">0</span><span class="op" id="3415987">,</span>&nbsp;<span class="num" id="3415989">0</span><span class="op" id="3415990">,</span>&nbsp;<span class="ident" id="3415992">syscall</span><span class="op" id="3415999">.</span><span class="ident" id="3416000">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416011">if</span>&nbsp;<span class="ident" id="3416014">c</span><span class="op" id="3416015">.</span><span class="ident" id="3416016">fd</span><span class="op" id="3416018">.</span><span class="ident" id="3416019">isConnected</span>&nbsp;<span class="op" id="3416031">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416035">return</span>&nbsp;<span class="num" id="3416042">0</span><span class="op" id="3416043">,</span>&nbsp;<span class="num" id="3416045">0</span><span class="op" id="3416046">,</span>&nbsp;<span class="op" id="3416048">&amp;</span><span class="ident" id="3416049">OpError</span><span class="op" id="3416056">{</span><span class="string" id="3416057">&#34;write&#34;</span><span class="op" id="3416064">,</span>&nbsp;<span class="ident" id="3416066">c</span><span class="op" id="3416067">.</span><span class="ident" id="3416068">fd</span><span class="op" id="3416070">.</span><span class="ident" id="3416071">net</span><span class="op" id="3416074">,</span>&nbsp;<span class="ident" id="3416076">addr</span><span class="op" id="3416080">,</span>&nbsp;<span class="ident" id="3416082">ErrWriteToConnected</span><span class="op" id="3416101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416107">if</span>&nbsp;<span class="ident" id="3416110">addr</span>&nbsp;<span class="op" id="3416115">==</span>&nbsp;<span class="ident" id="3416118">nil</span>&nbsp;<span class="op" id="3416122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416126">return</span>&nbsp;<span class="num" id="3416133">0</span><span class="op" id="3416134">,</span>&nbsp;<span class="num" id="3416136">0</span><span class="op" id="3416137">,</span>&nbsp;<span class="op" id="3416139">&amp;</span><span class="ident" id="3416140">OpError</span><span class="op" id="3416147">{</span><span class="ident" id="3416148">Op</span><span class="op" id="3416150">:</span>&nbsp;<span class="string" id="3416152">&#34;write&#34;</span><span class="op" id="3416159">,</span>&nbsp;<span class="ident" id="3416161">Net</span><span class="op" id="3416164">:</span>&nbsp;<span class="ident" id="3416166">c</span><span class="op" id="3416167">.</span><span class="ident" id="3416168">fd</span><span class="op" id="3416170">.</span><span class="ident" id="3416171">net</span><span class="op" id="3416174">,</span>&nbsp;<span class="ident" id="3416176">Addr</span><span class="op" id="3416180">:</span>&nbsp;<span class="ident" id="3416182">nil</span><span class="op" id="3416185">,</span>&nbsp;<span class="ident" id="3416187">Err</span><span class="op" id="3416190">:</span>&nbsp;<span class="ident" id="3416192">errMissingAddress</span><span class="op" id="3416209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416212">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3416215">sa</span><span class="op" id="3416217">,</span>&nbsp;<span class="ident" id="3416219">err</span>&nbsp;<span class="op" id="3416223">:=</span>&nbsp;<span class="ident" id="3416226">addr</span><span class="op" id="3416230">.</span><span class="ident" id="3416231">sockaddr</span><span class="op" id="3416239">(</span><span class="ident" id="3416240">c</span><span class="op" id="3416241">.</span><span class="ident" id="3416242">fd</span><span class="op" id="3416244">.</span><span class="ident" id="3416245">family</span><span class="op" id="3416251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416254">if</span>&nbsp;<span class="ident" id="3416257">err</span>&nbsp;<span class="op" id="3416261">!=</span>&nbsp;<span class="ident" id="3416264">nil</span>&nbsp;<span class="op" id="3416268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416272">return</span>&nbsp;<span class="num" id="3416279">0</span><span class="op" id="3416280">,</span>&nbsp;<span class="num" id="3416282">0</span><span class="op" id="3416283">,</span>&nbsp;<span class="op" id="3416285">&amp;</span><span class="ident" id="3416286">OpError</span><span class="op" id="3416293">{</span><span class="string" id="3416294">&#34;write&#34;</span><span class="op" id="3416301">,</span>&nbsp;<span class="ident" id="3416303">c</span><span class="op" id="3416304">.</span><span class="ident" id="3416305">fd</span><span class="op" id="3416307">.</span><span class="ident" id="3416308">net</span><span class="op" id="3416311">,</span>&nbsp;<span class="ident" id="3416313">addr</span><span class="op" id="3416317">,</span>&nbsp;<span class="ident" id="3416319">err</span><span class="op" id="3416322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416328">return</span>&nbsp;<span class="ident" id="3416335">c</span><span class="op" id="3416336">.</span><span class="ident" id="3416337">fd</span><span class="op" id="3416339">.</span><span class="ident" id="3416340">writeMsg</span><span class="op" id="3416348">(</span><span class="ident" id="3416349">b</span><span class="op" id="3416350">,</span>&nbsp;<span class="ident" id="3416352">oob</span><span class="op" id="3416355">,</span>&nbsp;<span class="ident" id="3416357">sa</span><span class="op" id="3416359">)</span><br>
<span class="lineno">160</span><span class="op" id="3416361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3416364">//&nbsp;DialUDP&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3416432">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not&nbsp;nil,&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3416503">//&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno">165</span><span class="keyword" id="3416552">func</span>&nbsp;<span class="ident" id="3416557">DialUDP</span><span class="op" id="3416564">(</span><span class="ident" id="3416565">net</span>&nbsp;<span class="builtintype" id="3416569">string</span><span class="op" id="3416575">,</span>&nbsp;<span class="ident" id="3416577">laddr</span><span class="op" id="3416582">,</span>&nbsp;<span class="ident" id="3416584">raddr</span>&nbsp;<span class="op" id="3416590">*</span><span class="ident" id="3416591">UDPAddr</span><span class="op" id="3416598">)</span>&nbsp;<span class="op" id="3416600">(</span><span class="op" id="3416601">*</span><span class="ident" id="3416602">UDPConn</span><span class="op" id="3416609">,</span>&nbsp;<span class="builtintype" id="3416611">error</span><span class="op" id="3416616">)</span>&nbsp;<span class="op" id="3416618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416621">switch</span>&nbsp;<span class="ident" id="3416628">net</span>&nbsp;<span class="op" id="3416632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416635">case</span>&nbsp;<span class="string" id="3416640">&#34;udp&#34;</span><span class="op" id="3416645">,</span>&nbsp;<span class="string" id="3416647">&#34;udp4&#34;</span><span class="op" id="3416653">,</span>&nbsp;<span class="string" id="3416655">&#34;udp6&#34;</span><span class="op" id="3416661">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416664">default</span><span class="op" id="3416671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416675">return</span>&nbsp;<span class="ident" id="3416682">nil</span><span class="op" id="3416685">,</span>&nbsp;<span class="op" id="3416687">&amp;</span><span class="ident" id="3416688">OpError</span><span class="op" id="3416695">{</span><span class="ident" id="3416696">Op</span><span class="op" id="3416698">:</span>&nbsp;<span class="string" id="3416700">&#34;dial&#34;</span><span class="op" id="3416706">,</span>&nbsp;<span class="ident" id="3416708">Net</span><span class="op" id="3416711">:</span>&nbsp;<span class="ident" id="3416713">net</span><span class="op" id="3416716">,</span>&nbsp;<span class="ident" id="3416718">Addr</span><span class="op" id="3416722">:</span>&nbsp;<span class="ident" id="3416724">raddr</span><span class="op" id="3416729">,</span>&nbsp;<span class="ident" id="3416731">Err</span><span class="op" id="3416734">:</span>&nbsp;<span class="ident" id="3416736">UnknownNetworkError</span><span class="op" id="3416755">(</span><span class="ident" id="3416756">net</span><span class="op" id="3416759">)</span><span class="op" id="3416760">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416766">if</span>&nbsp;<span class="ident" id="3416769">raddr</span>&nbsp;<span class="op" id="3416775">==</span>&nbsp;<span class="ident" id="3416778">nil</span>&nbsp;<span class="op" id="3416782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416786">return</span>&nbsp;<span class="ident" id="3416793">nil</span><span class="op" id="3416796">,</span>&nbsp;<span class="op" id="3416798">&amp;</span><span class="ident" id="3416799">OpError</span><span class="op" id="3416806">{</span><span class="ident" id="3416807">Op</span><span class="op" id="3416809">:</span>&nbsp;<span class="string" id="3416811">&#34;dial&#34;</span><span class="op" id="3416817">,</span>&nbsp;<span class="ident" id="3416819">Net</span><span class="op" id="3416822">:</span>&nbsp;<span class="ident" id="3416824">net</span><span class="op" id="3416827">,</span>&nbsp;<span class="ident" id="3416829">Addr</span><span class="op" id="3416833">:</span>&nbsp;<span class="ident" id="3416835">nil</span><span class="op" id="3416838">,</span>&nbsp;<span class="ident" id="3416840">Err</span><span class="op" id="3416843">:</span>&nbsp;<span class="ident" id="3416845">errMissingAddress</span><span class="op" id="3416862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3416865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3416868">return</span>&nbsp;<span class="ident" id="3416875">dialUDP</span><span class="op" id="3416882">(</span><span class="ident" id="3416883">net</span><span class="op" id="3416886">,</span>&nbsp;<span class="ident" id="3416888">laddr</span><span class="op" id="3416893">,</span>&nbsp;<span class="ident" id="3416895">raddr</span><span class="op" id="3416900">,</span>&nbsp;<span class="ident" id="3416902">noDeadline</span><span class="op" id="3416912">)</span><br>
<span class="lineno">175</span><span class="op" id="3416914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3416917">func</span>&nbsp;<span class="ident" id="3416922">dialUDP</span><span class="op" id="3416929">(</span><span class="ident" id="3416930">net</span>&nbsp;<span class="builtintype" id="3416934">string</span><span class="op" id="3416940">,</span>&nbsp;<span class="ident" id="3416942">laddr</span><span class="op" id="3416947">,</span>&nbsp;<span class="ident" id="3416949">raddr</span>&nbsp;<span class="op" id="3416955">*</span><span class="ident" id="3416956">UDPAddr</span><span class="op" id="3416963">,</span>&nbsp;<span class="ident" id="3416965">deadline</span>&nbsp;<span class="ident" id="3416974">time</span><span class="op" id="3416978">.</span><span class="ident" id="3416979">Time</span><span class="op" id="3416983">)</span>&nbsp;<span class="op" id="3416985">(</span><span class="op" id="3416986">*</span><span class="ident" id="3416987">UDPConn</span><span class="op" id="3416994">,</span>&nbsp;<span class="builtintype" id="3416996">error</span><span class="op" id="3417001">)</span>&nbsp;<span class="op" id="3417003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417006">fd</span><span class="op" id="3417008">,</span>&nbsp;<span class="ident" id="3417010">err</span>&nbsp;<span class="op" id="3417014">:=</span>&nbsp;<span class="ident" id="3417017">internetSocket</span><span class="op" id="3417031">(</span><span class="ident" id="3417032">net</span><span class="op" id="3417035">,</span>&nbsp;<span class="ident" id="3417037">laddr</span><span class="op" id="3417042">,</span>&nbsp;<span class="ident" id="3417044">raddr</span><span class="op" id="3417049">,</span>&nbsp;<span class="ident" id="3417051">deadline</span><span class="op" id="3417059">,</span>&nbsp;<span class="ident" id="3417061">syscall</span><span class="op" id="3417068">.</span><span class="ident" id="3417069">SOCK_DGRAM</span><span class="op" id="3417079">,</span>&nbsp;<span class="num" id="3417081">0</span><span class="op" id="3417082">,</span>&nbsp;<span class="string" id="3417084">&#34;dial&#34;</span><span class="op" id="3417090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417093">if</span>&nbsp;<span class="ident" id="3417096">err</span>&nbsp;<span class="op" id="3417100">!=</span>&nbsp;<span class="ident" id="3417103">nil</span>&nbsp;<span class="op" id="3417107">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417111">return</span>&nbsp;<span class="ident" id="3417118">nil</span><span class="op" id="3417121">,</span>&nbsp;<span class="op" id="3417123">&amp;</span><span class="ident" id="3417124">OpError</span><span class="op" id="3417131">{</span><span class="ident" id="3417132">Op</span><span class="op" id="3417134">:</span>&nbsp;<span class="string" id="3417136">&#34;dial&#34;</span><span class="op" id="3417142">,</span>&nbsp;<span class="ident" id="3417144">Net</span><span class="op" id="3417147">:</span>&nbsp;<span class="ident" id="3417149">net</span><span class="op" id="3417152">,</span>&nbsp;<span class="ident" id="3417154">Addr</span><span class="op" id="3417158">:</span>&nbsp;<span class="ident" id="3417160">raddr</span><span class="op" id="3417165">,</span>&nbsp;<span class="ident" id="3417167">Err</span><span class="op" id="3417170">:</span>&nbsp;<span class="ident" id="3417172">err</span><span class="op" id="3417175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417181">return</span>&nbsp;<span class="ident" id="3417188">newUDPConn</span><span class="op" id="3417198">(</span><span class="ident" id="3417199">fd</span><span class="op" id="3417201">)</span><span class="op" id="3417202">,</span>&nbsp;<span class="ident" id="3417204">nil</span><br>
<span class="lineno"></span><span class="op" id="3417208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="3417211">//&nbsp;ListenUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;UDP&nbsp;packets&nbsp;addressed&nbsp;to&nbsp;the&nbsp;local</span><br>
<span class="lineno"></span><span class="comment" id="3417280">//&nbsp;address&nbsp;laddr.&nbsp;&nbsp;Net&nbsp;must&nbsp;be&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,&nbsp;or&nbsp;&#34;udp6&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="3417351">//&nbsp;a&nbsp;port&nbsp;of&nbsp;0,&nbsp;ListenUDP&nbsp;will&nbsp;choose&nbsp;an&nbsp;available&nbsp;port.</span><br>
<span class="lineno"></span><span class="comment" id="3417408">//&nbsp;The&nbsp;LocalAddr&nbsp;method&nbsp;of&nbsp;the&nbsp;returned&nbsp;UDPConn&nbsp;can&nbsp;be&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3417471">//&nbsp;discover&nbsp;the&nbsp;port.&nbsp;&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo</span><br>
<span class="lineno">190</span><span class="comment" id="3417541">//&nbsp;methods&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;UDP&nbsp;packets&nbsp;with&nbsp;per-packet</span><br>
<span class="lineno"></span><span class="comment" id="3417612">//&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3417627">func</span>&nbsp;<span class="ident" id="3417632">ListenUDP</span><span class="op" id="3417641">(</span><span class="ident" id="3417642">net</span>&nbsp;<span class="builtintype" id="3417646">string</span><span class="op" id="3417652">,</span>&nbsp;<span class="ident" id="3417654">laddr</span>&nbsp;<span class="op" id="3417660">*</span><span class="ident" id="3417661">UDPAddr</span><span class="op" id="3417668">)</span>&nbsp;<span class="op" id="3417670">(</span><span class="op" id="3417671">*</span><span class="ident" id="3417672">UDPConn</span><span class="op" id="3417679">,</span>&nbsp;<span class="builtintype" id="3417681">error</span><span class="op" id="3417686">)</span>&nbsp;<span class="op" id="3417688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417691">switch</span>&nbsp;<span class="ident" id="3417698">net</span>&nbsp;<span class="op" id="3417702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417705">case</span>&nbsp;<span class="string" id="3417710">&#34;udp&#34;</span><span class="op" id="3417715">,</span>&nbsp;<span class="string" id="3417717">&#34;udp4&#34;</span><span class="op" id="3417723">,</span>&nbsp;<span class="string" id="3417725">&#34;udp6&#34;</span><span class="op" id="3417731">:</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417734">default</span><span class="op" id="3417741">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417745">return</span>&nbsp;<span class="ident" id="3417752">nil</span><span class="op" id="3417755">,</span>&nbsp;<span class="op" id="3417757">&amp;</span><span class="ident" id="3417758">OpError</span><span class="op" id="3417765">{</span><span class="ident" id="3417766">Op</span><span class="op" id="3417768">:</span>&nbsp;<span class="string" id="3417770">&#34;listen&#34;</span><span class="op" id="3417778">,</span>&nbsp;<span class="ident" id="3417780">Net</span><span class="op" id="3417783">:</span>&nbsp;<span class="ident" id="3417785">net</span><span class="op" id="3417788">,</span>&nbsp;<span class="ident" id="3417790">Addr</span><span class="op" id="3417794">:</span>&nbsp;<span class="ident" id="3417796">laddr</span><span class="op" id="3417801">,</span>&nbsp;<span class="ident" id="3417803">Err</span><span class="op" id="3417806">:</span>&nbsp;<span class="ident" id="3417808">UnknownNetworkError</span><span class="op" id="3417827">(</span><span class="ident" id="3417828">net</span><span class="op" id="3417831">)</span><span class="op" id="3417832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417838">if</span>&nbsp;<span class="ident" id="3417841">laddr</span>&nbsp;<span class="op" id="3417847">==</span>&nbsp;<span class="ident" id="3417850">nil</span>&nbsp;<span class="op" id="3417854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417858">laddr</span>&nbsp;<span class="op" id="3417864">=</span>&nbsp;<span class="op" id="3417866">&amp;</span><span class="ident" id="3417867">UDPAddr</span><span class="op" id="3417874">{</span><span class="op" id="3417875">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3417878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3417881">fd</span><span class="op" id="3417883">,</span>&nbsp;<span class="ident" id="3417885">err</span>&nbsp;<span class="op" id="3417889">:=</span>&nbsp;<span class="ident" id="3417892">internetSocket</span><span class="op" id="3417906">(</span><span class="ident" id="3417907">net</span><span class="op" id="3417910">,</span>&nbsp;<span class="ident" id="3417912">laddr</span><span class="op" id="3417917">,</span>&nbsp;<span class="ident" id="3417919">nil</span><span class="op" id="3417922">,</span>&nbsp;<span class="ident" id="3417924">noDeadline</span><span class="op" id="3417934">,</span>&nbsp;<span class="ident" id="3417936">syscall</span><span class="op" id="3417943">.</span><span class="ident" id="3417944">SOCK_DGRAM</span><span class="op" id="3417954">,</span>&nbsp;<span class="num" id="3417956">0</span><span class="op" id="3417957">,</span>&nbsp;<span class="string" id="3417959">&#34;listen&#34;</span><span class="op" id="3417967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417970">if</span>&nbsp;<span class="ident" id="3417973">err</span>&nbsp;<span class="op" id="3417977">!=</span>&nbsp;<span class="ident" id="3417980">nil</span>&nbsp;<span class="op" id="3417984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3417988">return</span>&nbsp;<span class="ident" id="3417995">nil</span><span class="op" id="3417998">,</span>&nbsp;<span class="op" id="3418000">&amp;</span><span class="ident" id="3418001">OpError</span><span class="op" id="3418008">{</span><span class="ident" id="3418009">Op</span><span class="op" id="3418011">:</span>&nbsp;<span class="string" id="3418013">&#34;listen&#34;</span><span class="op" id="3418021">,</span>&nbsp;<span class="ident" id="3418023">Net</span><span class="op" id="3418026">:</span>&nbsp;<span class="ident" id="3418028">net</span><span class="op" id="3418031">,</span>&nbsp;<span class="ident" id="3418033">Addr</span><span class="op" id="3418037">:</span>&nbsp;<span class="ident" id="3418039">laddr</span><span class="op" id="3418044">,</span>&nbsp;<span class="ident" id="3418046">Err</span><span class="op" id="3418049">:</span>&nbsp;<span class="ident" id="3418051">err</span><span class="op" id="3418054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418057">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418060">return</span>&nbsp;<span class="ident" id="3418067">newUDPConn</span><span class="op" id="3418077">(</span><span class="ident" id="3418078">fd</span><span class="op" id="3418080">)</span><span class="op" id="3418081">,</span>&nbsp;<span class="ident" id="3418083">nil</span><br>
<span class="lineno"></span><span class="op" id="3418087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3418090">//&nbsp;ListenMulticastUDP&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;multicast&nbsp;UDP&nbsp;packets</span><br>
<span class="lineno"></span><span class="comment" id="3418155">//&nbsp;addressed&nbsp;to&nbsp;the&nbsp;group&nbsp;address&nbsp;gaddr&nbsp;on&nbsp;ifi,&nbsp;which&nbsp;specifies&nbsp;the</span><br>
<span class="lineno">210</span><span class="comment" id="3418223">//&nbsp;interface&nbsp;to&nbsp;join.&nbsp;&nbsp;ListenMulticastUDP&nbsp;uses&nbsp;default&nbsp;multicast</span><br>
<span class="lineno"></span><span class="comment" id="3418288">//&nbsp;interface&nbsp;if&nbsp;ifi&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="3418316">func</span>&nbsp;<span class="ident" id="3418321">ListenMulticastUDP</span><span class="op" id="3418339">(</span><span class="ident" id="3418340">net</span>&nbsp;<span class="builtintype" id="3418344">string</span><span class="op" id="3418350">,</span>&nbsp;<span class="ident" id="3418352">ifi</span>&nbsp;<span class="op" id="3418356">*</span><span class="ident" id="3418357">Interface</span><span class="op" id="3418366">,</span>&nbsp;<span class="ident" id="3418368">gaddr</span>&nbsp;<span class="op" id="3418374">*</span><span class="ident" id="3418375">UDPAddr</span><span class="op" id="3418382">)</span>&nbsp;<span class="op" id="3418384">(</span><span class="op" id="3418385">*</span><span class="ident" id="3418386">UDPConn</span><span class="op" id="3418393">,</span>&nbsp;<span class="builtintype" id="3418395">error</span><span class="op" id="3418400">)</span>&nbsp;<span class="op" id="3418402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418405">switch</span>&nbsp;<span class="ident" id="3418412">net</span>&nbsp;<span class="op" id="3418416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418419">case</span>&nbsp;<span class="string" id="3418424">&#34;udp&#34;</span><span class="op" id="3418429">,</span>&nbsp;<span class="string" id="3418431">&#34;udp4&#34;</span><span class="op" id="3418437">,</span>&nbsp;<span class="string" id="3418439">&#34;udp6&#34;</span><span class="op" id="3418445">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418448">default</span><span class="op" id="3418455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418459">return</span>&nbsp;<span class="ident" id="3418466">nil</span><span class="op" id="3418469">,</span>&nbsp;<span class="op" id="3418471">&amp;</span><span class="ident" id="3418472">OpError</span><span class="op" id="3418479">{</span><span class="ident" id="3418480">Op</span><span class="op" id="3418482">:</span>&nbsp;<span class="string" id="3418484">&#34;listen&#34;</span><span class="op" id="3418492">,</span>&nbsp;<span class="ident" id="3418494">Net</span><span class="op" id="3418497">:</span>&nbsp;<span class="ident" id="3418499">net</span><span class="op" id="3418502">,</span>&nbsp;<span class="ident" id="3418504">Addr</span><span class="op" id="3418508">:</span>&nbsp;<span class="ident" id="3418510">gaddr</span><span class="op" id="3418515">,</span>&nbsp;<span class="ident" id="3418517">Err</span><span class="op" id="3418520">:</span>&nbsp;<span class="ident" id="3418522">UnknownNetworkError</span><span class="op" id="3418541">(</span><span class="ident" id="3418542">net</span><span class="op" id="3418545">)</span><span class="op" id="3418546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418552">if</span>&nbsp;<span class="ident" id="3418555">gaddr</span>&nbsp;<span class="op" id="3418561">==</span>&nbsp;<span class="ident" id="3418564">nil</span>&nbsp;<span class="op" id="3418568">||</span>&nbsp;<span class="ident" id="3418571">gaddr</span><span class="op" id="3418576">.</span><span class="ident" id="3418577">IP</span>&nbsp;<span class="op" id="3418580">==</span>&nbsp;<span class="ident" id="3418583">nil</span>&nbsp;<span class="op" id="3418587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418591">return</span>&nbsp;<span class="ident" id="3418598">nil</span><span class="op" id="3418601">,</span>&nbsp;<span class="op" id="3418603">&amp;</span><span class="ident" id="3418604">OpError</span><span class="op" id="3418611">{</span><span class="ident" id="3418612">Op</span><span class="op" id="3418614">:</span>&nbsp;<span class="string" id="3418616">&#34;listen&#34;</span><span class="op" id="3418624">,</span>&nbsp;<span class="ident" id="3418626">Net</span><span class="op" id="3418629">:</span>&nbsp;<span class="ident" id="3418631">net</span><span class="op" id="3418634">,</span>&nbsp;<span class="ident" id="3418636">Addr</span><span class="op" id="3418640">:</span>&nbsp;<span class="ident" id="3418642">nil</span><span class="op" id="3418645">,</span>&nbsp;<span class="ident" id="3418647">Err</span><span class="op" id="3418650">:</span>&nbsp;<span class="ident" id="3418652">errMissingAddress</span><span class="op" id="3418669">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418675">fd</span><span class="op" id="3418677">,</span>&nbsp;<span class="ident" id="3418679">err</span>&nbsp;<span class="op" id="3418683">:=</span>&nbsp;<span class="ident" id="3418686">internetSocket</span><span class="op" id="3418700">(</span><span class="ident" id="3418701">net</span><span class="op" id="3418704">,</span>&nbsp;<span class="ident" id="3418706">gaddr</span><span class="op" id="3418711">,</span>&nbsp;<span class="ident" id="3418713">nil</span><span class="op" id="3418716">,</span>&nbsp;<span class="ident" id="3418718">noDeadline</span><span class="op" id="3418728">,</span>&nbsp;<span class="ident" id="3418730">syscall</span><span class="op" id="3418737">.</span><span class="ident" id="3418738">SOCK_DGRAM</span><span class="op" id="3418748">,</span>&nbsp;<span class="num" id="3418750">0</span><span class="op" id="3418751">,</span>&nbsp;<span class="string" id="3418753">&#34;listen&#34;</span><span class="op" id="3418761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418764">if</span>&nbsp;<span class="ident" id="3418767">err</span>&nbsp;<span class="op" id="3418771">!=</span>&nbsp;<span class="ident" id="3418774">nil</span>&nbsp;<span class="op" id="3418778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418782">return</span>&nbsp;<span class="ident" id="3418789">nil</span><span class="op" id="3418792">,</span>&nbsp;<span class="op" id="3418794">&amp;</span><span class="ident" id="3418795">OpError</span><span class="op" id="3418802">{</span><span class="ident" id="3418803">Op</span><span class="op" id="3418805">:</span>&nbsp;<span class="string" id="3418807">&#34;listen&#34;</span><span class="op" id="3418815">,</span>&nbsp;<span class="ident" id="3418817">Net</span><span class="op" id="3418820">:</span>&nbsp;<span class="ident" id="3418822">net</span><span class="op" id="3418825">,</span>&nbsp;<span class="ident" id="3418827">Addr</span><span class="op" id="3418831">:</span>&nbsp;<span class="ident" id="3418833">gaddr</span><span class="op" id="3418838">,</span>&nbsp;<span class="ident" id="3418840">Err</span><span class="op" id="3418843">:</span>&nbsp;<span class="ident" id="3418845">err</span><span class="op" id="3418848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3418851">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418854">c</span>&nbsp;<span class="op" id="3418856">:=</span>&nbsp;<span class="ident" id="3418859">newUDPConn</span><span class="op" id="3418869">(</span><span class="ident" id="3418870">fd</span><span class="op" id="3418872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418875">if</span>&nbsp;<span class="ident" id="3418878">ip4</span>&nbsp;<span class="op" id="3418882">:=</span>&nbsp;<span class="ident" id="3418885">gaddr</span><span class="op" id="3418890">.</span><span class="ident" id="3418891">IP</span><span class="op" id="3418893">.</span><span class="ident" id="3418894">To4</span><span class="op" id="3418897">(</span><span class="op" id="3418898">)</span><span class="op" id="3418899">;</span>&nbsp;<span class="ident" id="3418901">ip4</span>&nbsp;<span class="op" id="3418905">!=</span>&nbsp;<span class="ident" id="3418908">nil</span>&nbsp;<span class="op" id="3418912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418916">if</span>&nbsp;<span class="ident" id="3418919">err</span>&nbsp;<span class="op" id="3418923">:=</span>&nbsp;<span class="ident" id="3418926">listenIPv4MulticastUDP</span><span class="op" id="3418948">(</span><span class="ident" id="3418949">c</span><span class="op" id="3418950">,</span>&nbsp;<span class="ident" id="3418952">ifi</span><span class="op" id="3418955">,</span>&nbsp;<span class="ident" id="3418957">ip4</span><span class="op" id="3418960">)</span><span class="op" id="3418961">;</span>&nbsp;<span class="ident" id="3418963">err</span>&nbsp;<span class="op" id="3418967">!=</span>&nbsp;<span class="ident" id="3418970">nil</span>&nbsp;<span class="op" id="3418974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3418979">c</span><span class="op" id="3418980">.</span><span class="ident" id="3418981">Close</span><span class="op" id="3418986">(</span><span class="op" id="3418987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3418992">return</span>&nbsp;<span class="ident" id="3418999">nil</span><span class="op" id="3419002">,</span>&nbsp;<span class="op" id="3419004">&amp;</span><span class="ident" id="3419005">OpError</span><span class="op" id="3419012">{</span><span class="ident" id="3419013">Op</span><span class="op" id="3419015">:</span>&nbsp;<span class="string" id="3419017">&#34;listen&#34;</span><span class="op" id="3419025">,</span>&nbsp;<span class="ident" id="3419027">Net</span><span class="op" id="3419030">:</span>&nbsp;<span class="ident" id="3419032">net</span><span class="op" id="3419035">,</span>&nbsp;<span class="ident" id="3419037">Addr</span><span class="op" id="3419041">:</span>&nbsp;<span class="op" id="3419043">&amp;</span><span class="ident" id="3419044">IPAddr</span><span class="op" id="3419050">{</span><span class="ident" id="3419051">IP</span><span class="op" id="3419053">:</span>&nbsp;<span class="ident" id="3419055">ip4</span><span class="op" id="3419058">}</span><span class="op" id="3419059">,</span>&nbsp;<span class="ident" id="3419061">Err</span><span class="op" id="3419064">:</span>&nbsp;<span class="ident" id="3419066">err</span><span class="op" id="3419069">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419076">}</span>&nbsp;<span class="keyword" id="3419078">else</span>&nbsp;<span class="op" id="3419083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419087">if</span>&nbsp;<span class="ident" id="3419090">err</span>&nbsp;<span class="op" id="3419094">:=</span>&nbsp;<span class="ident" id="3419097">listenIPv6MulticastUDP</span><span class="op" id="3419119">(</span><span class="ident" id="3419120">c</span><span class="op" id="3419121">,</span>&nbsp;<span class="ident" id="3419123">ifi</span><span class="op" id="3419126">,</span>&nbsp;<span class="ident" id="3419128">gaddr</span><span class="op" id="3419133">.</span><span class="ident" id="3419134">IP</span><span class="op" id="3419136">)</span><span class="op" id="3419137">;</span>&nbsp;<span class="ident" id="3419139">err</span>&nbsp;<span class="op" id="3419143">!=</span>&nbsp;<span class="ident" id="3419146">nil</span>&nbsp;<span class="op" id="3419150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3419155">c</span><span class="op" id="3419156">.</span><span class="ident" id="3419157">Close</span><span class="op" id="3419162">(</span><span class="op" id="3419163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419168">return</span>&nbsp;<span class="ident" id="3419175">nil</span><span class="op" id="3419178">,</span>&nbsp;<span class="op" id="3419180">&amp;</span><span class="ident" id="3419181">OpError</span><span class="op" id="3419188">{</span><span class="ident" id="3419189">Op</span><span class="op" id="3419191">:</span>&nbsp;<span class="string" id="3419193">&#34;listen&#34;</span><span class="op" id="3419201">,</span>&nbsp;<span class="ident" id="3419203">Net</span><span class="op" id="3419206">:</span>&nbsp;<span class="ident" id="3419208">net</span><span class="op" id="3419211">,</span>&nbsp;<span class="ident" id="3419213">Addr</span><span class="op" id="3419217">:</span>&nbsp;<span class="op" id="3419219">&amp;</span><span class="ident" id="3419220">IPAddr</span><span class="op" id="3419226">{</span><span class="ident" id="3419227">IP</span><span class="op" id="3419229">:</span>&nbsp;<span class="ident" id="3419231">gaddr</span><span class="op" id="3419236">.</span><span class="ident" id="3419237">IP</span><span class="op" id="3419239">}</span><span class="op" id="3419240">,</span>&nbsp;<span class="ident" id="3419242">Err</span><span class="op" id="3419245">:</span>&nbsp;<span class="ident" id="3419247">err</span><span class="op" id="3419250">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419260">return</span>&nbsp;<span class="ident" id="3419267">c</span><span class="op" id="3419268">,</span>&nbsp;<span class="ident" id="3419270">nil</span><br>
<span class="lineno"></span><span class="op" id="3419274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="3419277">func</span>&nbsp;<span class="ident" id="3419282">listenIPv4MulticastUDP</span><span class="op" id="3419304">(</span><span class="ident" id="3419305">c</span>&nbsp;<span class="op" id="3419307">*</span><span class="ident" id="3419308">UDPConn</span><span class="op" id="3419315">,</span>&nbsp;<span class="ident" id="3419317">ifi</span>&nbsp;<span class="op" id="3419321">*</span><span class="ident" id="3419322">Interface</span><span class="op" id="3419331">,</span>&nbsp;<span class="ident" id="3419333">ip</span>&nbsp;<span class="ident" id="3419336">IP</span><span class="op" id="3419338">)</span>&nbsp;<span class="builtintype" id="3419340">error</span>&nbsp;<span class="op" id="3419346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419349">if</span>&nbsp;<span class="ident" id="3419352">ifi</span>&nbsp;<span class="op" id="3419356">!=</span>&nbsp;<span class="ident" id="3419359">nil</span>&nbsp;<span class="op" id="3419363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419367">if</span>&nbsp;<span class="ident" id="3419370">err</span>&nbsp;<span class="op" id="3419374">:=</span>&nbsp;<span class="ident" id="3419377">setIPv4MulticastInterface</span><span class="op" id="3419402">(</span><span class="ident" id="3419403">c</span><span class="op" id="3419404">.</span><span class="ident" id="3419405">fd</span><span class="op" id="3419407">,</span>&nbsp;<span class="ident" id="3419409">ifi</span><span class="op" id="3419412">)</span><span class="op" id="3419413">;</span>&nbsp;<span class="ident" id="3419415">err</span>&nbsp;<span class="op" id="3419419">!=</span>&nbsp;<span class="ident" id="3419422">nil</span>&nbsp;<span class="op" id="3419426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419431">return</span>&nbsp;<span class="ident" id="3419438">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419444">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419450">if</span>&nbsp;<span class="ident" id="3419453">err</span>&nbsp;<span class="op" id="3419457">:=</span>&nbsp;<span class="ident" id="3419460">setIPv4MulticastLoopback</span><span class="op" id="3419484">(</span><span class="ident" id="3419485">c</span><span class="op" id="3419486">.</span><span class="ident" id="3419487">fd</span><span class="op" id="3419489">,</span>&nbsp;<span class="builtintype" id="3419491">false</span><span class="op" id="3419496">)</span><span class="op" id="3419497">;</span>&nbsp;<span class="ident" id="3419499">err</span>&nbsp;<span class="op" id="3419503">!=</span>&nbsp;<span class="ident" id="3419506">nil</span>&nbsp;<span class="op" id="3419510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419514">return</span>&nbsp;<span class="ident" id="3419521">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419529">if</span>&nbsp;<span class="ident" id="3419532">err</span>&nbsp;<span class="op" id="3419536">:=</span>&nbsp;<span class="ident" id="3419539">joinIPv4Group</span><span class="op" id="3419552">(</span><span class="ident" id="3419553">c</span><span class="op" id="3419554">.</span><span class="ident" id="3419555">fd</span><span class="op" id="3419557">,</span>&nbsp;<span class="ident" id="3419559">ifi</span><span class="op" id="3419562">,</span>&nbsp;<span class="ident" id="3419564">ip</span><span class="op" id="3419566">)</span><span class="op" id="3419567">;</span>&nbsp;<span class="ident" id="3419569">err</span>&nbsp;<span class="op" id="3419573">!=</span>&nbsp;<span class="ident" id="3419576">nil</span>&nbsp;<span class="op" id="3419580">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419584">return</span>&nbsp;<span class="ident" id="3419591">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419599">return</span>&nbsp;<span class="ident" id="3419606">nil</span><br>
<span class="lineno"></span><span class="op" id="3419610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3419613">func</span>&nbsp;<span class="ident" id="3419618">listenIPv6MulticastUDP</span><span class="op" id="3419640">(</span><span class="ident" id="3419641">c</span>&nbsp;<span class="op" id="3419643">*</span><span class="ident" id="3419644">UDPConn</span><span class="op" id="3419651">,</span>&nbsp;<span class="ident" id="3419653">ifi</span>&nbsp;<span class="op" id="3419657">*</span><span class="ident" id="3419658">Interface</span><span class="op" id="3419667">,</span>&nbsp;<span class="ident" id="3419669">ip</span>&nbsp;<span class="ident" id="3419672">IP</span><span class="op" id="3419674">)</span>&nbsp;<span class="builtintype" id="3419676">error</span>&nbsp;<span class="op" id="3419682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419685">if</span>&nbsp;<span class="ident" id="3419688">ifi</span>&nbsp;<span class="op" id="3419692">!=</span>&nbsp;<span class="ident" id="3419695">nil</span>&nbsp;<span class="op" id="3419699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419703">if</span>&nbsp;<span class="ident" id="3419706">err</span>&nbsp;<span class="op" id="3419710">:=</span>&nbsp;<span class="ident" id="3419713">setIPv6MulticastInterface</span><span class="op" id="3419738">(</span><span class="ident" id="3419739">c</span><span class="op" id="3419740">.</span><span class="ident" id="3419741">fd</span><span class="op" id="3419743">,</span>&nbsp;<span class="ident" id="3419745">ifi</span><span class="op" id="3419748">)</span><span class="op" id="3419749">;</span>&nbsp;<span class="ident" id="3419751">err</span>&nbsp;<span class="op" id="3419755">!=</span>&nbsp;<span class="ident" id="3419758">nil</span>&nbsp;<span class="op" id="3419762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419767">return</span>&nbsp;<span class="ident" id="3419774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419780">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419786">if</span>&nbsp;<span class="ident" id="3419789">err</span>&nbsp;<span class="op" id="3419793">:=</span>&nbsp;<span class="ident" id="3419796">setIPv6MulticastLoopback</span><span class="op" id="3419820">(</span><span class="ident" id="3419821">c</span><span class="op" id="3419822">.</span><span class="ident" id="3419823">fd</span><span class="op" id="3419825">,</span>&nbsp;<span class="builtintype" id="3419827">false</span><span class="op" id="3419832">)</span><span class="op" id="3419833">;</span>&nbsp;<span class="ident" id="3419835">err</span>&nbsp;<span class="op" id="3419839">!=</span>&nbsp;<span class="ident" id="3419842">nil</span>&nbsp;<span class="op" id="3419846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419850">return</span>&nbsp;<span class="ident" id="3419857">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419865">if</span>&nbsp;<span class="ident" id="3419868">err</span>&nbsp;<span class="op" id="3419872">:=</span>&nbsp;<span class="ident" id="3419875">joinIPv6Group</span><span class="op" id="3419888">(</span><span class="ident" id="3419889">c</span><span class="op" id="3419890">.</span><span class="ident" id="3419891">fd</span><span class="op" id="3419893">,</span>&nbsp;<span class="ident" id="3419895">ifi</span><span class="op" id="3419898">,</span>&nbsp;<span class="ident" id="3419900">ip</span><span class="op" id="3419902">)</span><span class="op" id="3419903">;</span>&nbsp;<span class="ident" id="3419905">err</span>&nbsp;<span class="op" id="3419909">!=</span>&nbsp;<span class="ident" id="3419912">nil</span>&nbsp;<span class="op" id="3419916">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419920">return</span>&nbsp;<span class="ident" id="3419927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3419932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3419935">return</span>&nbsp;<span class="ident" id="3419942">nil</span><br>
<span class="lineno"></span><span class="op" id="3419946">}</span>
</div>
</body>
</html>
