<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html" class="current">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3775573">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3775628">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3775682">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3775733">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3775804">package</span>&nbsp;<span class="ident" id="3775812">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3775820">import</span>&nbsp;<span class="op" id="3775827">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3775830">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3775839">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3775845">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3775856">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3775866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3775869">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3775890">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3775958">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3776026">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3776094">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3776164">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3776227">type</span>&nbsp;<span class="ident" id="3776232">Encoding</span>&nbsp;<span class="keyword" id="3776241">struct</span>&nbsp;<span class="op" id="3776248">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776251">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3776261">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776269">decodeMap</span>&nbsp;<span class="op" id="3776279">[</span><span class="num" id="3776280">256</span><span class="op" id="3776283">]</span><span class="builtintype" id="3776284">byte</span><br>
<span class="lineno"></span><span class="op" id="3776289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3776292">const</span>&nbsp;<span class="ident" id="3776298">encodeStd</span>&nbsp;<span class="op" id="3776308">=</span>&nbsp;<span class="string" id="3776310">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3776377">const</span>&nbsp;<span class="ident" id="3776383">encodeURL</span>&nbsp;<span class="op" id="3776393">=</span>&nbsp;<span class="string" id="3776395">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3776463">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3776532">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3776567">func</span>&nbsp;<span class="ident" id="3776572">NewEncoding</span><span class="op" id="3776583">(</span><span class="ident" id="3776584">encoder</span>&nbsp;<span class="builtintype" id="3776592">string</span><span class="op" id="3776598">)</span>&nbsp;<span class="op" id="3776600">*</span><span class="ident" id="3776601">Encoding</span>&nbsp;<span class="op" id="3776610">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776613">e</span>&nbsp;<span class="op" id="3776615">:=</span>&nbsp;<span class="builtinfunc" id="3776618">new</span><span class="op" id="3776621">(</span><span class="ident" id="3776622">Encoding</span><span class="op" id="3776630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776633">e</span><span class="op" id="3776634">.</span><span class="ident" id="3776635">encode</span>&nbsp;<span class="op" id="3776642">=</span>&nbsp;<span class="ident" id="3776644">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776653">for</span>&nbsp;<span class="ident" id="3776657">i</span>&nbsp;<span class="op" id="3776659">:=</span>&nbsp;<span class="num" id="3776662">0</span><span class="op" id="3776663">;</span>&nbsp;<span class="ident" id="3776665">i</span>&nbsp;<span class="op" id="3776667">&lt;</span>&nbsp;<span class="builtinfunc" id="3776669">len</span><span class="op" id="3776672">(</span><span class="ident" id="3776673">e</span><span class="op" id="3776674">.</span><span class="ident" id="3776675">decodeMap</span><span class="op" id="3776684">)</span><span class="op" id="3776685">;</span>&nbsp;<span class="ident" id="3776687">i</span><span class="op" id="3776688">++</span>&nbsp;<span class="op" id="3776691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776695">e</span><span class="op" id="3776696">.</span><span class="ident" id="3776697">decodeMap</span><span class="op" id="3776706">[</span><span class="ident" id="3776707">i</span><span class="op" id="3776708">]</span>&nbsp;<span class="op" id="3776710">=</span>&nbsp;<span class="num" id="3776712">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776718">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776721">for</span>&nbsp;<span class="ident" id="3776725">i</span>&nbsp;<span class="op" id="3776727">:=</span>&nbsp;<span class="num" id="3776730">0</span><span class="op" id="3776731">;</span>&nbsp;<span class="ident" id="3776733">i</span>&nbsp;<span class="op" id="3776735">&lt;</span>&nbsp;<span class="builtinfunc" id="3776737">len</span><span class="op" id="3776740">(</span><span class="ident" id="3776741">encoder</span><span class="op" id="3776748">)</span><span class="op" id="3776749">;</span>&nbsp;<span class="ident" id="3776751">i</span><span class="op" id="3776752">++</span>&nbsp;<span class="op" id="3776755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3776759">e</span><span class="op" id="3776760">.</span><span class="ident" id="3776761">decodeMap</span><span class="op" id="3776770">[</span><span class="ident" id="3776771">encoder</span><span class="op" id="3776778">[</span><span class="ident" id="3776779">i</span><span class="op" id="3776780">]</span><span class="op" id="3776781">]</span>&nbsp;<span class="op" id="3776783">=</span>&nbsp;<span class="builtintype" id="3776785">byte</span><span class="op" id="3776789">(</span><span class="ident" id="3776790">i</span><span class="op" id="3776791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3776794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3776797">return</span>&nbsp;<span class="ident" id="3776804">e</span><br>
<span class="lineno"></span><span class="op" id="3776806">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3776809">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3776871">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3776884">var</span>&nbsp;<span class="ident" id="3776888">StdEncoding</span>&nbsp;<span class="op" id="3776900">=</span>&nbsp;<span class="ident" id="3776902">NewEncoding</span><span class="op" id="3776913">(</span><span class="ident" id="3776914">encodeStd</span><span class="op" id="3776923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3776926">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3776995">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3777043">var</span>&nbsp;<span class="ident" id="3777047">URLEncoding</span>&nbsp;<span class="op" id="3777059">=</span>&nbsp;<span class="ident" id="3777061">NewEncoding</span><span class="op" id="3777072">(</span><span class="ident" id="3777073">encodeURL</span><span class="op" id="3777082">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3777085">var</span>&nbsp;<span class="ident" id="3777089">removeNewlinesMapper</span>&nbsp;<span class="op" id="3777110">=</span>&nbsp;<span class="keyword" id="3777112">func</span><span class="op" id="3777116">(</span><span class="ident" id="3777117">r</span>&nbsp;<span class="builtintype" id="3777119">rune</span><span class="op" id="3777123">)</span>&nbsp;<span class="builtintype" id="3777125">rune</span>&nbsp;<span class="op" id="3777130">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777133">if</span>&nbsp;<span class="ident" id="3777136">r</span>&nbsp;<span class="op" id="3777138">==</span>&nbsp;<span class="string" id="3777141">&#39;\r&#39;</span>&nbsp;<span class="op" id="3777146">||</span>&nbsp;<span class="ident" id="3777149">r</span>&nbsp;<span class="op" id="3777151">==</span>&nbsp;<span class="string" id="3777154">&#39;\n&#39;</span>&nbsp;<span class="op" id="3777159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777163">return</span>&nbsp;<span class="op" id="3777170">-</span><span class="num" id="3777171">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777177">return</span>&nbsp;<span class="ident" id="3777184">r</span><br>
<span class="lineno"></span><span class="op" id="3777186">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3777189">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3777208">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3777262">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3777300">//</span><br>
<span class="lineno"></span><span class="comment" id="3777303">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3777361">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3777422">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3777476">func</span>&nbsp;<span class="op" id="3777481">(</span><span class="ident" id="3777482">enc</span>&nbsp;<span class="op" id="3777486">*</span><span class="ident" id="3777487">Encoding</span><span class="op" id="3777495">)</span>&nbsp;<span class="ident" id="3777497">Encode</span><span class="op" id="3777503">(</span><span class="ident" id="3777504">dst</span><span class="op" id="3777507">,</span>&nbsp;<span class="ident" id="3777509">src</span>&nbsp;<span class="op" id="3777513">[</span><span class="op" id="3777514">]</span><span class="builtintype" id="3777515">byte</span><span class="op" id="3777519">)</span>&nbsp;<span class="op" id="3777521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777524">if</span>&nbsp;<span class="builtinfunc" id="3777527">len</span><span class="op" id="3777530">(</span><span class="ident" id="3777531">src</span><span class="op" id="3777534">)</span>&nbsp;<span class="op" id="3777536">==</span>&nbsp;<span class="num" id="3777539">0</span>&nbsp;<span class="op" id="3777541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777545">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777553">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777557">for</span>&nbsp;<span class="builtinfunc" id="3777561">len</span><span class="op" id="3777564">(</span><span class="ident" id="3777565">src</span><span class="op" id="3777568">)</span>&nbsp;<span class="op" id="3777570">&gt;</span>&nbsp;<span class="num" id="3777572">0</span>&nbsp;<span class="op" id="3777574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777578">var</span>&nbsp;<span class="ident" id="3777582">b0</span><span class="op" id="3777584">,</span>&nbsp;<span class="ident" id="3777586">b1</span><span class="op" id="3777588">,</span>&nbsp;<span class="ident" id="3777590">b2</span><span class="op" id="3777592">,</span>&nbsp;<span class="ident" id="3777594">b3</span>&nbsp;<span class="builtintype" id="3777597">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777605">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777654">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777679">switch</span>&nbsp;<span class="builtinfunc" id="3777686">len</span><span class="op" id="3777689">(</span><span class="ident" id="3777690">src</span><span class="op" id="3777693">)</span>&nbsp;<span class="op" id="3777695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777699">default</span><span class="op" id="3777706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777711">b3</span>&nbsp;<span class="op" id="3777714">=</span>&nbsp;<span class="ident" id="3777716">src</span><span class="op" id="3777719">[</span><span class="num" id="3777720">2</span><span class="op" id="3777721">]</span>&nbsp;<span class="op" id="3777723">&amp;</span>&nbsp;<span class="num" id="3777725">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777733">b2</span>&nbsp;<span class="op" id="3777736">=</span>&nbsp;<span class="ident" id="3777738">src</span><span class="op" id="3777741">[</span><span class="num" id="3777742">2</span><span class="op" id="3777743">]</span>&nbsp;<span class="op" id="3777745">&gt;&gt;</span>&nbsp;<span class="num" id="3777748">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777753">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777767">case</span>&nbsp;<span class="num" id="3777772">2</span><span class="op" id="3777773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777778">b2</span>&nbsp;<span class="op" id="3777781">|=</span>&nbsp;<span class="op" id="3777784">(</span><span class="ident" id="3777785">src</span><span class="op" id="3777788">[</span><span class="num" id="3777789">1</span><span class="op" id="3777790">]</span>&nbsp;<span class="op" id="3777792">&lt;&lt;</span>&nbsp;<span class="num" id="3777795">2</span><span class="op" id="3777796">)</span>&nbsp;<span class="op" id="3777798">&amp;</span>&nbsp;<span class="num" id="3777800">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777808">b1</span>&nbsp;<span class="op" id="3777811">=</span>&nbsp;<span class="ident" id="3777813">src</span><span class="op" id="3777816">[</span><span class="num" id="3777817">1</span><span class="op" id="3777818">]</span>&nbsp;<span class="op" id="3777820">&gt;&gt;</span>&nbsp;<span class="num" id="3777823">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777828">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3777842">case</span>&nbsp;<span class="num" id="3777847">1</span><span class="op" id="3777848">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777853">b1</span>&nbsp;<span class="op" id="3777856">|=</span>&nbsp;<span class="op" id="3777859">(</span><span class="ident" id="3777860">src</span><span class="op" id="3777863">[</span><span class="num" id="3777864">0</span><span class="op" id="3777865">]</span>&nbsp;<span class="op" id="3777867">&lt;&lt;</span>&nbsp;<span class="num" id="3777870">4</span><span class="op" id="3777871">)</span>&nbsp;<span class="op" id="3777873">&amp;</span>&nbsp;<span class="num" id="3777875">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777883">b0</span>&nbsp;<span class="op" id="3777886">=</span>&nbsp;<span class="ident" id="3777888">src</span><span class="op" id="3777891">[</span><span class="num" id="3777892">0</span><span class="op" id="3777893">]</span>&nbsp;<span class="op" id="3777895">&gt;&gt;</span>&nbsp;<span class="num" id="3777898">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3777902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3777907">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777958">dst</span><span class="op" id="3777961">[</span><span class="num" id="3777962">0</span><span class="op" id="3777963">]</span>&nbsp;<span class="op" id="3777965">=</span>&nbsp;<span class="ident" id="3777967">enc</span><span class="op" id="3777970">.</span><span class="ident" id="3777971">encode</span><span class="op" id="3777977">[</span><span class="ident" id="3777978">b0</span><span class="op" id="3777980">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3777984">dst</span><span class="op" id="3777987">[</span><span class="num" id="3777988">1</span><span class="op" id="3777989">]</span>&nbsp;<span class="op" id="3777991">=</span>&nbsp;<span class="ident" id="3777993">enc</span><span class="op" id="3777996">.</span><span class="ident" id="3777997">encode</span><span class="op" id="3778003">[</span><span class="ident" id="3778004">b1</span><span class="op" id="3778006">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778010">dst</span><span class="op" id="3778013">[</span><span class="num" id="3778014">2</span><span class="op" id="3778015">]</span>&nbsp;<span class="op" id="3778017">=</span>&nbsp;<span class="ident" id="3778019">enc</span><span class="op" id="3778022">.</span><span class="ident" id="3778023">encode</span><span class="op" id="3778029">[</span><span class="ident" id="3778030">b2</span><span class="op" id="3778032">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778036">dst</span><span class="op" id="3778039">[</span><span class="num" id="3778040">3</span><span class="op" id="3778041">]</span>&nbsp;<span class="op" id="3778043">=</span>&nbsp;<span class="ident" id="3778045">enc</span><span class="op" id="3778048">.</span><span class="ident" id="3778049">encode</span><span class="op" id="3778055">[</span><span class="ident" id="3778056">b3</span><span class="op" id="3778058">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778063">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778090">if</span>&nbsp;<span class="builtinfunc" id="3778093">len</span><span class="op" id="3778096">(</span><span class="ident" id="3778097">src</span><span class="op" id="3778100">)</span>&nbsp;<span class="op" id="3778102">&lt;</span>&nbsp;<span class="num" id="3778104">3</span>&nbsp;<span class="op" id="3778106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778111">dst</span><span class="op" id="3778114">[</span><span class="num" id="3778115">3</span><span class="op" id="3778116">]</span>&nbsp;<span class="op" id="3778118">=</span>&nbsp;<span class="string" id="3778120">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778127">if</span>&nbsp;<span class="builtinfunc" id="3778130">len</span><span class="op" id="3778133">(</span><span class="ident" id="3778134">src</span><span class="op" id="3778137">)</span>&nbsp;<span class="op" id="3778139">&lt;</span>&nbsp;<span class="num" id="3778141">2</span>&nbsp;<span class="op" id="3778143">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778149">dst</span><span class="op" id="3778152">[</span><span class="num" id="3778153">2</span><span class="op" id="3778154">]</span>&nbsp;<span class="op" id="3778156">=</span>&nbsp;<span class="string" id="3778158">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778170">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778183">src</span>&nbsp;<span class="op" id="3778187">=</span>&nbsp;<span class="ident" id="3778189">src</span><span class="op" id="3778192">[</span><span class="num" id="3778193">3</span><span class="op" id="3778194">:</span><span class="op" id="3778195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778199">dst</span>&nbsp;<span class="op" id="3778203">=</span>&nbsp;<span class="ident" id="3778205">dst</span><span class="op" id="3778208">[</span><span class="num" id="3778209">4</span><span class="op" id="3778210">:</span><span class="op" id="3778211">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778214">}</span><br>
<span class="lineno"></span><span class="op" id="3778216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3778219">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3778273">func</span>&nbsp;<span class="op" id="3778278">(</span><span class="ident" id="3778279">enc</span>&nbsp;<span class="op" id="3778283">*</span><span class="ident" id="3778284">Encoding</span><span class="op" id="3778292">)</span>&nbsp;<span class="ident" id="3778294">EncodeToString</span><span class="op" id="3778308">(</span><span class="ident" id="3778309">src</span>&nbsp;<span class="op" id="3778313">[</span><span class="op" id="3778314">]</span><span class="builtintype" id="3778315">byte</span><span class="op" id="3778319">)</span>&nbsp;<span class="builtintype" id="3778321">string</span>&nbsp;<span class="op" id="3778328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778331">buf</span>&nbsp;<span class="op" id="3778335">:=</span>&nbsp;<span class="builtinfunc" id="3778338">make</span><span class="op" id="3778342">(</span><span class="op" id="3778343">[</span><span class="op" id="3778344">]</span><span class="builtintype" id="3778345">byte</span><span class="op" id="3778349">,</span>&nbsp;<span class="ident" id="3778351">enc</span><span class="op" id="3778354">.</span><span class="ident" id="3778355">EncodedLen</span><span class="op" id="3778365">(</span><span class="builtinfunc" id="3778366">len</span><span class="op" id="3778369">(</span><span class="ident" id="3778370">src</span><span class="op" id="3778373">)</span><span class="op" id="3778374">)</span><span class="op" id="3778375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778378">enc</span><span class="op" id="3778381">.</span><span class="ident" id="3778382">Encode</span><span class="op" id="3778388">(</span><span class="ident" id="3778389">buf</span><span class="op" id="3778392">,</span>&nbsp;<span class="ident" id="3778394">src</span><span class="op" id="3778397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778400">return</span>&nbsp;<span class="builtintype" id="3778407">string</span><span class="op" id="3778413">(</span><span class="ident" id="3778414">buf</span><span class="op" id="3778417">)</span><br>
<span class="lineno">120</span><span class="op" id="3778419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3778422">type</span>&nbsp;<span class="ident" id="3778427">encoder</span>&nbsp;<span class="keyword" id="3778435">struct</span>&nbsp;<span class="op" id="3778442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778445">err</span>&nbsp;&nbsp;<span class="builtintype" id="3778450">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778457">enc</span>&nbsp;&nbsp;<span class="op" id="3778462">*</span><span class="ident" id="3778463">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778473">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3778478">io</span><span class="op" id="3778480">.</span><span class="ident" id="3778481">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778489">buf</span>&nbsp;&nbsp;<span class="op" id="3778494">[</span><span class="num" id="3778495">3</span><span class="op" id="3778496">]</span><span class="builtintype" id="3778497">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3778505">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778545">nbuf</span>&nbsp;<span class="builtintype" id="3778550">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3778561">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778588">out</span>&nbsp;&nbsp;<span class="op" id="3778593">[</span><span class="num" id="3778594">1024</span><span class="op" id="3778598">]</span><span class="builtintype" id="3778599">byte</span>&nbsp;<span class="comment" id="3778604">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3778621">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3778624">func</span>&nbsp;<span class="op" id="3778629">(</span><span class="ident" id="3778630">e</span>&nbsp;<span class="op" id="3778632">*</span><span class="ident" id="3778633">encoder</span><span class="op" id="3778640">)</span>&nbsp;<span class="ident" id="3778642">Write</span><span class="op" id="3778647">(</span><span class="ident" id="3778648">p</span>&nbsp;<span class="op" id="3778650">[</span><span class="op" id="3778651">]</span><span class="builtintype" id="3778652">byte</span><span class="op" id="3778656">)</span>&nbsp;<span class="op" id="3778658">(</span><span class="ident" id="3778659">n</span>&nbsp;<span class="builtintype" id="3778661">int</span><span class="op" id="3778664">,</span>&nbsp;<span class="ident" id="3778666">err</span>&nbsp;<span class="builtintype" id="3778670">error</span><span class="op" id="3778675">)</span>&nbsp;<span class="op" id="3778677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778680">if</span>&nbsp;<span class="ident" id="3778683">e</span><span class="op" id="3778684">.</span><span class="ident" id="3778685">err</span>&nbsp;<span class="op" id="3778689">!=</span>&nbsp;<span class="ident" id="3778692">nil</span>&nbsp;<span class="op" id="3778696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778700">return</span>&nbsp;<span class="num" id="3778707">0</span><span class="op" id="3778708">,</span>&nbsp;<span class="ident" id="3778710">e</span><span class="op" id="3778711">.</span><span class="ident" id="3778712">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778717">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3778721">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778741">if</span>&nbsp;<span class="ident" id="3778744">e</span><span class="op" id="3778745">.</span><span class="ident" id="3778746">nbuf</span>&nbsp;<span class="op" id="3778751">&gt;</span>&nbsp;<span class="num" id="3778753">0</span>&nbsp;<span class="op" id="3778755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778759">var</span>&nbsp;<span class="ident" id="3778763">i</span>&nbsp;<span class="builtintype" id="3778765">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778771">for</span>&nbsp;<span class="ident" id="3778775">i</span>&nbsp;<span class="op" id="3778777">=</span>&nbsp;<span class="num" id="3778779">0</span><span class="op" id="3778780">;</span>&nbsp;<span class="ident" id="3778782">i</span>&nbsp;<span class="op" id="3778784">&lt;</span>&nbsp;<span class="builtinfunc" id="3778786">len</span><span class="op" id="3778789">(</span><span class="ident" id="3778790">p</span><span class="op" id="3778791">)</span>&nbsp;<span class="op" id="3778793">&amp;&amp;</span>&nbsp;<span class="ident" id="3778796">e</span><span class="op" id="3778797">.</span><span class="ident" id="3778798">nbuf</span>&nbsp;<span class="op" id="3778803">&lt;</span>&nbsp;<span class="num" id="3778805">3</span><span class="op" id="3778806">;</span>&nbsp;<span class="ident" id="3778808">i</span><span class="op" id="3778809">++</span>&nbsp;<span class="op" id="3778812">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778817">e</span><span class="op" id="3778818">.</span><span class="ident" id="3778819">buf</span><span class="op" id="3778822">[</span><span class="ident" id="3778823">e</span><span class="op" id="3778824">.</span><span class="ident" id="3778825">nbuf</span><span class="op" id="3778829">]</span>&nbsp;<span class="op" id="3778831">=</span>&nbsp;<span class="ident" id="3778833">p</span><span class="op" id="3778834">[</span><span class="ident" id="3778835">i</span><span class="op" id="3778836">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778841">e</span><span class="op" id="3778842">.</span><span class="ident" id="3778843">nbuf</span><span class="op" id="3778847">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778856">n</span>&nbsp;<span class="op" id="3778858">+=</span>&nbsp;<span class="ident" id="3778861">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778865">p</span>&nbsp;<span class="op" id="3778867">=</span>&nbsp;<span class="ident" id="3778869">p</span><span class="op" id="3778870">[</span><span class="ident" id="3778871">i</span><span class="op" id="3778872">:</span><span class="op" id="3778873">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778877">if</span>&nbsp;<span class="ident" id="3778880">e</span><span class="op" id="3778881">.</span><span class="ident" id="3778882">nbuf</span>&nbsp;<span class="op" id="3778887">&lt;</span>&nbsp;<span class="num" id="3778889">3</span>&nbsp;<span class="op" id="3778891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778896">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3778905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3778909">e</span><span class="op" id="3778910">.</span><span class="ident" id="3778911">enc</span><span class="op" id="3778914">.</span><span class="ident" id="3778915">Encode</span><span class="op" id="3778921">(</span><span class="ident" id="3778922">e</span><span class="op" id="3778923">.</span><span class="ident" id="3778924">out</span><span class="op" id="3778927">[</span><span class="num" id="3778928">0</span><span class="op" id="3778929">:</span><span class="op" id="3778930">]</span><span class="op" id="3778931">,</span>&nbsp;<span class="ident" id="3778933">e</span><span class="op" id="3778934">.</span><span class="ident" id="3778935">buf</span><span class="op" id="3778938">[</span><span class="num" id="3778939">0</span><span class="op" id="3778940">:</span><span class="op" id="3778941">]</span><span class="op" id="3778942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3778946">if</span>&nbsp;<span class="ident" id="3778949">_</span><span class="op" id="3778950">,</span>&nbsp;<span class="ident" id="3778952">e</span><span class="op" id="3778953">.</span><span class="ident" id="3778954">err</span>&nbsp;<span class="op" id="3778958">=</span>&nbsp;<span class="ident" id="3778960">e</span><span class="op" id="3778961">.</span><span class="ident" id="3778962">w</span><span class="op" id="3778963">.</span><span class="ident" id="3778964">Write</span><span class="op" id="3778969">(</span><span class="ident" id="3778970">e</span><span class="op" id="3778971">.</span><span class="ident" id="3778972">out</span><span class="op" id="3778975">[</span><span class="num" id="3778976">0</span><span class="op" id="3778977">:</span><span class="num" id="3778978">4</span><span class="op" id="3778979">]</span><span class="op" id="3778980">)</span><span class="op" id="3778981">;</span>&nbsp;<span class="ident" id="3778983">e</span><span class="op" id="3778984">.</span><span class="ident" id="3778985">err</span>&nbsp;<span class="op" id="3778989">!=</span>&nbsp;<span class="ident" id="3778992">nil</span>&nbsp;<span class="op" id="3778996">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779001">return</span>&nbsp;<span class="ident" id="3779008">n</span><span class="op" id="3779009">,</span>&nbsp;<span class="ident" id="3779011">e</span><span class="op" id="3779012">.</span><span class="ident" id="3779013">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779023">e</span><span class="op" id="3779024">.</span><span class="ident" id="3779025">nbuf</span>&nbsp;<span class="op" id="3779030">=</span>&nbsp;<span class="num" id="3779032">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779039">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779066">for</span>&nbsp;<span class="builtinfunc" id="3779070">len</span><span class="op" id="3779073">(</span><span class="ident" id="3779074">p</span><span class="op" id="3779075">)</span>&nbsp;<span class="op" id="3779077">&gt;=</span>&nbsp;<span class="num" id="3779080">3</span>&nbsp;<span class="op" id="3779082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779086">nn</span>&nbsp;<span class="op" id="3779089">:=</span>&nbsp;<span class="builtinfunc" id="3779092">len</span><span class="op" id="3779095">(</span><span class="ident" id="3779096">e</span><span class="op" id="3779097">.</span><span class="ident" id="3779098">out</span><span class="op" id="3779101">)</span>&nbsp;<span class="op" id="3779103">/</span>&nbsp;<span class="num" id="3779105">4</span>&nbsp;<span class="op" id="3779107">*</span>&nbsp;<span class="num" id="3779109">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779113">if</span>&nbsp;<span class="ident" id="3779116">nn</span>&nbsp;<span class="op" id="3779119">&gt;</span>&nbsp;<span class="builtinfunc" id="3779121">len</span><span class="op" id="3779124">(</span><span class="ident" id="3779125">p</span><span class="op" id="3779126">)</span>&nbsp;<span class="op" id="3779128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779133">nn</span>&nbsp;<span class="op" id="3779136">=</span>&nbsp;<span class="builtinfunc" id="3779138">len</span><span class="op" id="3779141">(</span><span class="ident" id="3779142">p</span><span class="op" id="3779143">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779148">nn</span>&nbsp;<span class="op" id="3779151">-=</span>&nbsp;<span class="ident" id="3779154">nn</span>&nbsp;<span class="op" id="3779157">%</span>&nbsp;<span class="num" id="3779159">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779167">e</span><span class="op" id="3779168">.</span><span class="ident" id="3779169">enc</span><span class="op" id="3779172">.</span><span class="ident" id="3779173">Encode</span><span class="op" id="3779179">(</span><span class="ident" id="3779180">e</span><span class="op" id="3779181">.</span><span class="ident" id="3779182">out</span><span class="op" id="3779185">[</span><span class="num" id="3779186">0</span><span class="op" id="3779187">:</span><span class="op" id="3779188">]</span><span class="op" id="3779189">,</span>&nbsp;<span class="ident" id="3779191">p</span><span class="op" id="3779192">[</span><span class="num" id="3779193">0</span><span class="op" id="3779194">:</span><span class="ident" id="3779195">nn</span><span class="op" id="3779197">]</span><span class="op" id="3779198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779202">if</span>&nbsp;<span class="ident" id="3779205">_</span><span class="op" id="3779206">,</span>&nbsp;<span class="ident" id="3779208">e</span><span class="op" id="3779209">.</span><span class="ident" id="3779210">err</span>&nbsp;<span class="op" id="3779214">=</span>&nbsp;<span class="ident" id="3779216">e</span><span class="op" id="3779217">.</span><span class="ident" id="3779218">w</span><span class="op" id="3779219">.</span><span class="ident" id="3779220">Write</span><span class="op" id="3779225">(</span><span class="ident" id="3779226">e</span><span class="op" id="3779227">.</span><span class="ident" id="3779228">out</span><span class="op" id="3779231">[</span><span class="num" id="3779232">0</span>&nbsp;<span class="op" id="3779234">:</span>&nbsp;<span class="ident" id="3779236">nn</span><span class="op" id="3779238">/</span><span class="num" id="3779239">3</span><span class="op" id="3779240">*</span><span class="num" id="3779241">4</span><span class="op" id="3779242">]</span><span class="op" id="3779243">)</span><span class="op" id="3779244">;</span>&nbsp;<span class="ident" id="3779246">e</span><span class="op" id="3779247">.</span><span class="ident" id="3779248">err</span>&nbsp;<span class="op" id="3779252">!=</span>&nbsp;<span class="ident" id="3779255">nil</span>&nbsp;<span class="op" id="3779259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779264">return</span>&nbsp;<span class="ident" id="3779271">n</span><span class="op" id="3779272">,</span>&nbsp;<span class="ident" id="3779274">e</span><span class="op" id="3779275">.</span><span class="ident" id="3779276">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779286">n</span>&nbsp;<span class="op" id="3779288">+=</span>&nbsp;<span class="ident" id="3779291">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779296">p</span>&nbsp;<span class="op" id="3779298">=</span>&nbsp;<span class="ident" id="3779300">p</span><span class="op" id="3779301">[</span><span class="ident" id="3779302">nn</span><span class="op" id="3779304">:</span><span class="op" id="3779305">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779312">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779333">for</span>&nbsp;<span class="ident" id="3779337">i</span>&nbsp;<span class="op" id="3779339">:=</span>&nbsp;<span class="num" id="3779342">0</span><span class="op" id="3779343">;</span>&nbsp;<span class="ident" id="3779345">i</span>&nbsp;<span class="op" id="3779347">&lt;</span>&nbsp;<span class="builtinfunc" id="3779349">len</span><span class="op" id="3779352">(</span><span class="ident" id="3779353">p</span><span class="op" id="3779354">)</span><span class="op" id="3779355">;</span>&nbsp;<span class="ident" id="3779357">i</span><span class="op" id="3779358">++</span>&nbsp;<span class="op" id="3779361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779365">e</span><span class="op" id="3779366">.</span><span class="ident" id="3779367">buf</span><span class="op" id="3779370">[</span><span class="ident" id="3779371">i</span><span class="op" id="3779372">]</span>&nbsp;<span class="op" id="3779374">=</span>&nbsp;<span class="ident" id="3779376">p</span><span class="op" id="3779377">[</span><span class="ident" id="3779378">i</span><span class="op" id="3779379">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779385">e</span><span class="op" id="3779386">.</span><span class="ident" id="3779387">nbuf</span>&nbsp;<span class="op" id="3779392">=</span>&nbsp;<span class="builtinfunc" id="3779394">len</span><span class="op" id="3779397">(</span><span class="ident" id="3779398">p</span><span class="op" id="3779399">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779402">n</span>&nbsp;<span class="op" id="3779404">+=</span>&nbsp;<span class="builtinfunc" id="3779407">len</span><span class="op" id="3779410">(</span><span class="ident" id="3779411">p</span><span class="op" id="3779412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779415">return</span><br>
<span class="lineno"></span><span class="op" id="3779422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3779425">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3779479">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3779532">func</span>&nbsp;<span class="op" id="3779537">(</span><span class="ident" id="3779538">e</span>&nbsp;<span class="op" id="3779540">*</span><span class="ident" id="3779541">encoder</span><span class="op" id="3779548">)</span>&nbsp;<span class="ident" id="3779550">Close</span><span class="op" id="3779555">(</span><span class="op" id="3779556">)</span>&nbsp;<span class="builtintype" id="3779558">error</span>&nbsp;<span class="op" id="3779564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3779567">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779624">if</span>&nbsp;<span class="ident" id="3779627">e</span><span class="op" id="3779628">.</span><span class="ident" id="3779629">err</span>&nbsp;<span class="op" id="3779633">==</span>&nbsp;<span class="ident" id="3779636">nil</span>&nbsp;<span class="op" id="3779640">&amp;&amp;</span>&nbsp;<span class="ident" id="3779643">e</span><span class="op" id="3779644">.</span><span class="ident" id="3779645">nbuf</span>&nbsp;<span class="op" id="3779650">&gt;</span>&nbsp;<span class="num" id="3779652">0</span>&nbsp;<span class="op" id="3779654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779658">e</span><span class="op" id="3779659">.</span><span class="ident" id="3779660">enc</span><span class="op" id="3779663">.</span><span class="ident" id="3779664">Encode</span><span class="op" id="3779670">(</span><span class="ident" id="3779671">e</span><span class="op" id="3779672">.</span><span class="ident" id="3779673">out</span><span class="op" id="3779676">[</span><span class="num" id="3779677">0</span><span class="op" id="3779678">:</span><span class="op" id="3779679">]</span><span class="op" id="3779680">,</span>&nbsp;<span class="ident" id="3779682">e</span><span class="op" id="3779683">.</span><span class="ident" id="3779684">buf</span><span class="op" id="3779687">[</span><span class="num" id="3779688">0</span><span class="op" id="3779689">:</span><span class="ident" id="3779690">e</span><span class="op" id="3779691">.</span><span class="ident" id="3779692">nbuf</span><span class="op" id="3779696">]</span><span class="op" id="3779697">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779701">e</span><span class="op" id="3779702">.</span><span class="ident" id="3779703">nbuf</span>&nbsp;<span class="op" id="3779708">=</span>&nbsp;<span class="num" id="3779710">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3779714">_</span><span class="op" id="3779715">,</span>&nbsp;<span class="ident" id="3779717">e</span><span class="op" id="3779718">.</span><span class="ident" id="3779719">err</span>&nbsp;<span class="op" id="3779723">=</span>&nbsp;<span class="ident" id="3779725">e</span><span class="op" id="3779726">.</span><span class="ident" id="3779727">w</span><span class="op" id="3779728">.</span><span class="ident" id="3779729">Write</span><span class="op" id="3779734">(</span><span class="ident" id="3779735">e</span><span class="op" id="3779736">.</span><span class="ident" id="3779737">out</span><span class="op" id="3779740">[</span><span class="num" id="3779741">0</span><span class="op" id="3779742">:</span><span class="num" id="3779743">4</span><span class="op" id="3779744">]</span><span class="op" id="3779745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3779748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3779751">return</span>&nbsp;<span class="ident" id="3779758">e</span><span class="op" id="3779759">.</span><span class="ident" id="3779760">err</span><br>
<span class="lineno"></span><span class="op" id="3779764">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3779767">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3779835">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3779907">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3779967">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3780035">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3780064">func</span>&nbsp;<span class="ident" id="3780069">NewEncoder</span><span class="op" id="3780079">(</span><span class="ident" id="3780080">enc</span>&nbsp;<span class="op" id="3780084">*</span><span class="ident" id="3780085">Encoding</span><span class="op" id="3780093">,</span>&nbsp;<span class="ident" id="3780095">w</span>&nbsp;<span class="ident" id="3780097">io</span><span class="op" id="3780099">.</span><span class="ident" id="3780100">Writer</span><span class="op" id="3780106">)</span>&nbsp;<span class="ident" id="3780108">io</span><span class="op" id="3780110">.</span><span class="ident" id="3780111">WriteCloser</span>&nbsp;<span class="op" id="3780123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780126">return</span>&nbsp;<span class="op" id="3780133">&amp;</span><span class="ident" id="3780134">encoder</span><span class="op" id="3780141">{</span><span class="ident" id="3780142">enc</span><span class="op" id="3780145">:</span>&nbsp;<span class="ident" id="3780147">enc</span><span class="op" id="3780150">,</span>&nbsp;<span class="ident" id="3780152">w</span><span class="op" id="3780153">:</span>&nbsp;<span class="ident" id="3780155">w</span><span class="op" id="3780156">}</span><br>
<span class="lineno"></span><span class="op" id="3780158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3780161">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3780226">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3780261">func</span>&nbsp;<span class="op" id="3780266">(</span><span class="ident" id="3780267">enc</span>&nbsp;<span class="op" id="3780271">*</span><span class="ident" id="3780272">Encoding</span><span class="op" id="3780280">)</span>&nbsp;<span class="ident" id="3780282">EncodedLen</span><span class="op" id="3780292">(</span><span class="ident" id="3780293">n</span>&nbsp;<span class="builtintype" id="3780295">int</span><span class="op" id="3780298">)</span>&nbsp;<span class="builtintype" id="3780300">int</span>&nbsp;<span class="op" id="3780304">{</span>&nbsp;<span class="keyword" id="3780306">return</span>&nbsp;<span class="op" id="3780313">(</span><span class="ident" id="3780314">n</span>&nbsp;<span class="op" id="3780316">+</span>&nbsp;<span class="num" id="3780318">2</span><span class="op" id="3780319">)</span>&nbsp;<span class="op" id="3780321">/</span>&nbsp;<span class="num" id="3780323">3</span>&nbsp;<span class="op" id="3780325">*</span>&nbsp;<span class="num" id="3780327">4</span>&nbsp;<span class="op" id="3780329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780332">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3780351">type</span>&nbsp;<span class="ident" id="3780356">CorruptInputError</span>&nbsp;<span class="ident" id="3780374">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3780381">func</span>&nbsp;<span class="op" id="3780386">(</span><span class="ident" id="3780387">e</span>&nbsp;<span class="ident" id="3780389">CorruptInputError</span><span class="op" id="3780406">)</span>&nbsp;<span class="ident" id="3780408">Error</span><span class="op" id="3780413">(</span><span class="op" id="3780414">)</span>&nbsp;<span class="builtintype" id="3780416">string</span>&nbsp;<span class="op" id="3780423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780426">return</span>&nbsp;<span class="string" id="3780433">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3780470">+</span>&nbsp;<span class="ident" id="3780472">strconv</span><span class="op" id="3780479">.</span><span class="ident" id="3780480">FormatInt</span><span class="op" id="3780489">(</span><span class="ident" id="3780490">int64</span><span class="op" id="3780495">(</span><span class="ident" id="3780496">e</span><span class="op" id="3780497">)</span><span class="op" id="3780498">,</span>&nbsp;<span class="num" id="3780500">10</span><span class="op" id="3780502">)</span><br>
<span class="lineno"></span><span class="op" id="3780504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3780507">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3780577">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3780645">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3780715">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3780772">func</span>&nbsp;<span class="op" id="3780777">(</span><span class="ident" id="3780778">enc</span>&nbsp;<span class="op" id="3780782">*</span><span class="ident" id="3780783">Encoding</span><span class="op" id="3780791">)</span>&nbsp;<span class="ident" id="3780793">decode</span><span class="op" id="3780799">(</span><span class="ident" id="3780800">dst</span><span class="op" id="3780803">,</span>&nbsp;<span class="ident" id="3780805">src</span>&nbsp;<span class="op" id="3780809">[</span><span class="op" id="3780810">]</span><span class="builtintype" id="3780811">byte</span><span class="op" id="3780815">)</span>&nbsp;<span class="op" id="3780817">(</span><span class="ident" id="3780818">n</span>&nbsp;<span class="builtintype" id="3780820">int</span><span class="op" id="3780823">,</span>&nbsp;<span class="ident" id="3780825">end</span>&nbsp;<span class="builtintype" id="3780829">bool</span><span class="op" id="3780833">,</span>&nbsp;<span class="ident" id="3780835">err</span>&nbsp;<span class="builtintype" id="3780839">error</span><span class="op" id="3780844">)</span>&nbsp;<span class="op" id="3780846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780849">olen</span>&nbsp;<span class="op" id="3780854">:=</span>&nbsp;<span class="builtinfunc" id="3780857">len</span><span class="op" id="3780860">(</span><span class="ident" id="3780861">src</span><span class="op" id="3780864">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780867">for</span>&nbsp;<span class="builtinfunc" id="3780871">len</span><span class="op" id="3780874">(</span><span class="ident" id="3780875">src</span><span class="op" id="3780878">)</span>&nbsp;<span class="op" id="3780880">&gt;</span>&nbsp;<span class="num" id="3780882">0</span>&nbsp;<span class="op" id="3780884">&amp;&amp;</span>&nbsp;<span class="op" id="3780887">!</span><span class="ident" id="3780888">end</span>&nbsp;<span class="op" id="3780892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3780896">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780942">var</span>&nbsp;<span class="ident" id="3780946">dbuf</span>&nbsp;<span class="op" id="3780951">[</span><span class="num" id="3780952">4</span><span class="op" id="3780953">]</span><span class="builtintype" id="3780954">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3780961">dlen</span>&nbsp;<span class="op" id="3780966">:=</span>&nbsp;<span class="num" id="3780969">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780974">for</span>&nbsp;<span class="ident" id="3780978">j</span>&nbsp;<span class="op" id="3780980">:=</span>&nbsp;<span class="keyword" id="3780983">range</span>&nbsp;<span class="ident" id="3780989">dbuf</span>&nbsp;<span class="op" id="3780994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3780999">if</span>&nbsp;<span class="builtinfunc" id="3781002">len</span><span class="op" id="3781005">(</span><span class="ident" id="3781006">src</span><span class="op" id="3781009">)</span>&nbsp;<span class="op" id="3781011">==</span>&nbsp;<span class="num" id="3781014">0</span>&nbsp;<span class="op" id="3781016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781022">return</span>&nbsp;<span class="ident" id="3781029">n</span><span class="op" id="3781030">,</span>&nbsp;<span class="builtintype" id="3781032">false</span><span class="op" id="3781037">,</span>&nbsp;<span class="ident" id="3781039">CorruptInputError</span><span class="op" id="3781056">(</span><span class="ident" id="3781057">olen</span>&nbsp;<span class="op" id="3781062">-</span>&nbsp;<span class="builtinfunc" id="3781064">len</span><span class="op" id="3781067">(</span><span class="ident" id="3781068">src</span><span class="op" id="3781071">)</span>&nbsp;<span class="op" id="3781073">-</span>&nbsp;<span class="ident" id="3781075">j</span><span class="op" id="3781076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781086">in</span>&nbsp;<span class="op" id="3781089">:=</span>&nbsp;<span class="ident" id="3781092">src</span><span class="op" id="3781095">[</span><span class="num" id="3781096">0</span><span class="op" id="3781097">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781102">src</span>&nbsp;<span class="op" id="3781106">=</span>&nbsp;<span class="ident" id="3781108">src</span><span class="op" id="3781111">[</span><span class="num" id="3781112">1</span><span class="op" id="3781113">:</span><span class="op" id="3781114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781119">if</span>&nbsp;<span class="ident" id="3781122">in</span>&nbsp;<span class="op" id="3781125">==</span>&nbsp;<span class="string" id="3781128">&#39;=&#39;</span>&nbsp;<span class="op" id="3781132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781138">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781187">switch</span>&nbsp;<span class="ident" id="3781194">j</span>&nbsp;<span class="op" id="3781196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781202">case</span>&nbsp;<span class="num" id="3781207">0</span><span class="op" id="3781208">,</span>&nbsp;<span class="num" id="3781210">1</span><span class="op" id="3781211">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781218">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781244">return</span>&nbsp;<span class="ident" id="3781251">n</span><span class="op" id="3781252">,</span>&nbsp;<span class="builtintype" id="3781254">false</span><span class="op" id="3781259">,</span>&nbsp;<span class="ident" id="3781261">CorruptInputError</span><span class="op" id="3781278">(</span><span class="ident" id="3781279">olen</span>&nbsp;<span class="op" id="3781284">-</span>&nbsp;<span class="builtinfunc" id="3781286">len</span><span class="op" id="3781289">(</span><span class="ident" id="3781290">src</span><span class="op" id="3781293">)</span>&nbsp;<span class="op" id="3781295">-</span>&nbsp;<span class="num" id="3781297">1</span><span class="op" id="3781298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781304">case</span>&nbsp;<span class="num" id="3781309">2</span><span class="op" id="3781310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781317">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781378">if</span>&nbsp;<span class="builtinfunc" id="3781381">len</span><span class="op" id="3781384">(</span><span class="ident" id="3781385">src</span><span class="op" id="3781388">)</span>&nbsp;<span class="op" id="3781390">==</span>&nbsp;<span class="num" id="3781393">0</span>&nbsp;<span class="op" id="3781395">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781403">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781431">return</span>&nbsp;<span class="ident" id="3781438">n</span><span class="op" id="3781439">,</span>&nbsp;<span class="builtintype" id="3781441">false</span><span class="op" id="3781446">,</span>&nbsp;<span class="ident" id="3781448">CorruptInputError</span><span class="op" id="3781465">(</span><span class="ident" id="3781466">olen</span><span class="op" id="3781470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781484">if</span>&nbsp;<span class="ident" id="3781487">src</span><span class="op" id="3781490">[</span><span class="num" id="3781491">0</span><span class="op" id="3781492">]</span>&nbsp;<span class="op" id="3781494">!=</span>&nbsp;<span class="string" id="3781497">&#39;=&#39;</span>&nbsp;<span class="op" id="3781501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781509">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781536">return</span>&nbsp;<span class="ident" id="3781543">n</span><span class="op" id="3781544">,</span>&nbsp;<span class="builtintype" id="3781546">false</span><span class="op" id="3781551">,</span>&nbsp;<span class="ident" id="3781553">CorruptInputError</span><span class="op" id="3781570">(</span><span class="ident" id="3781571">olen</span>&nbsp;<span class="op" id="3781576">-</span>&nbsp;<span class="builtinfunc" id="3781578">len</span><span class="op" id="3781581">(</span><span class="ident" id="3781582">src</span><span class="op" id="3781585">)</span>&nbsp;<span class="op" id="3781587">-</span>&nbsp;<span class="num" id="3781589">1</span><span class="op" id="3781590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781604">src</span>&nbsp;<span class="op" id="3781608">=</span>&nbsp;<span class="ident" id="3781610">src</span><span class="op" id="3781613">[</span><span class="num" id="3781614">1</span><span class="op" id="3781615">:</span><span class="op" id="3781616">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781628">if</span>&nbsp;<span class="builtinfunc" id="3781631">len</span><span class="op" id="3781634">(</span><span class="ident" id="3781635">src</span><span class="op" id="3781638">)</span>&nbsp;<span class="op" id="3781640">&gt;</span>&nbsp;<span class="num" id="3781642">0</span>&nbsp;<span class="op" id="3781644">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781651">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781676">err</span>&nbsp;<span class="op" id="3781680">=</span>&nbsp;<span class="ident" id="3781682">CorruptInputError</span><span class="op" id="3781699">(</span><span class="ident" id="3781700">olen</span>&nbsp;<span class="op" id="3781705">-</span>&nbsp;<span class="builtinfunc" id="3781707">len</span><span class="op" id="3781710">(</span><span class="ident" id="3781711">src</span><span class="op" id="3781714">)</span><span class="op" id="3781715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781727">dlen</span><span class="op" id="3781731">,</span>&nbsp;<span class="ident" id="3781733">end</span>&nbsp;<span class="op" id="3781737">=</span>&nbsp;<span class="ident" id="3781739">j</span><span class="op" id="3781740">,</span>&nbsp;<span class="builtintype" id="3781742">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781751">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781765">dbuf</span><span class="op" id="3781769">[</span><span class="ident" id="3781770">j</span><span class="op" id="3781771">]</span>&nbsp;<span class="op" id="3781773">=</span>&nbsp;<span class="ident" id="3781775">enc</span><span class="op" id="3781778">.</span><span class="ident" id="3781779">decodeMap</span><span class="op" id="3781788">[</span><span class="ident" id="3781789">in</span><span class="op" id="3781791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781796">if</span>&nbsp;<span class="ident" id="3781799">dbuf</span><span class="op" id="3781803">[</span><span class="ident" id="3781804">j</span><span class="op" id="3781805">]</span>&nbsp;<span class="op" id="3781807">==</span>&nbsp;<span class="num" id="3781810">0xFF</span>&nbsp;<span class="op" id="3781815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781821">return</span>&nbsp;<span class="ident" id="3781828">n</span><span class="op" id="3781829">,</span>&nbsp;<span class="builtintype" id="3781831">false</span><span class="op" id="3781836">,</span>&nbsp;<span class="ident" id="3781838">CorruptInputError</span><span class="op" id="3781855">(</span><span class="ident" id="3781856">olen</span>&nbsp;<span class="op" id="3781861">-</span>&nbsp;<span class="builtinfunc" id="3781863">len</span><span class="op" id="3781866">(</span><span class="ident" id="3781867">src</span><span class="op" id="3781870">)</span>&nbsp;<span class="op" id="3781872">-</span>&nbsp;<span class="num" id="3781874">1</span><span class="op" id="3781875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781880">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3781884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781889">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3781946">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781959">switch</span>&nbsp;<span class="ident" id="3781966">dlen</span>&nbsp;<span class="op" id="3781971">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3781975">case</span>&nbsp;<span class="num" id="3781980">4</span><span class="op" id="3781981">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3781986">dst</span><span class="op" id="3781989">[</span><span class="num" id="3781990">2</span><span class="op" id="3781991">]</span>&nbsp;<span class="op" id="3781993">=</span>&nbsp;<span class="ident" id="3781995">dbuf</span><span class="op" id="3781999">[</span><span class="num" id="3782000">2</span><span class="op" id="3782001">]</span><span class="op" id="3782002">&lt;&lt;</span><span class="num" id="3782004">6</span>&nbsp;<span class="op" id="3782006">|</span>&nbsp;<span class="ident" id="3782008">dbuf</span><span class="op" id="3782012">[</span><span class="num" id="3782013">3</span><span class="op" id="3782014">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782019">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782033">case</span>&nbsp;<span class="num" id="3782038">3</span><span class="op" id="3782039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782044">dst</span><span class="op" id="3782047">[</span><span class="num" id="3782048">1</span><span class="op" id="3782049">]</span>&nbsp;<span class="op" id="3782051">=</span>&nbsp;<span class="ident" id="3782053">dbuf</span><span class="op" id="3782057">[</span><span class="num" id="3782058">1</span><span class="op" id="3782059">]</span><span class="op" id="3782060">&lt;&lt;</span><span class="num" id="3782062">4</span>&nbsp;<span class="op" id="3782064">|</span>&nbsp;<span class="ident" id="3782066">dbuf</span><span class="op" id="3782070">[</span><span class="num" id="3782071">2</span><span class="op" id="3782072">]</span><span class="op" id="3782073">&gt;&gt;</span><span class="num" id="3782075">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782080">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782094">case</span>&nbsp;<span class="num" id="3782099">2</span><span class="op" id="3782100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782105">dst</span><span class="op" id="3782108">[</span><span class="num" id="3782109">0</span><span class="op" id="3782110">]</span>&nbsp;<span class="op" id="3782112">=</span>&nbsp;<span class="ident" id="3782114">dbuf</span><span class="op" id="3782118">[</span><span class="num" id="3782119">0</span><span class="op" id="3782120">]</span><span class="op" id="3782121">&lt;&lt;</span><span class="num" id="3782123">2</span>&nbsp;<span class="op" id="3782125">|</span>&nbsp;<span class="ident" id="3782127">dbuf</span><span class="op" id="3782131">[</span><span class="num" id="3782132">1</span><span class="op" id="3782133">]</span><span class="op" id="3782134">&gt;&gt;</span><span class="num" id="3782136">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782144">dst</span>&nbsp;<span class="op" id="3782148">=</span>&nbsp;<span class="ident" id="3782150">dst</span><span class="op" id="3782153">[</span><span class="num" id="3782154">3</span><span class="op" id="3782155">:</span><span class="op" id="3782156">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782160">n</span>&nbsp;<span class="op" id="3782162">+=</span>&nbsp;<span class="ident" id="3782165">dlen</span>&nbsp;<span class="op" id="3782170">-</span>&nbsp;<span class="num" id="3782172">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3782175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782179">return</span>&nbsp;<span class="ident" id="3782186">n</span><span class="op" id="3782187">,</span>&nbsp;<span class="ident" id="3782189">end</span><span class="op" id="3782192">,</span>&nbsp;<span class="ident" id="3782194">err</span><br>
<span class="lineno"></span><span class="op" id="3782198">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3782201">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3782266">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3782335">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3782404">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3782467">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3782515">func</span>&nbsp;<span class="op" id="3782520">(</span><span class="ident" id="3782521">enc</span>&nbsp;<span class="op" id="3782525">*</span><span class="ident" id="3782526">Encoding</span><span class="op" id="3782534">)</span>&nbsp;<span class="ident" id="3782536">Decode</span><span class="op" id="3782542">(</span><span class="ident" id="3782543">dst</span><span class="op" id="3782546">,</span>&nbsp;<span class="ident" id="3782548">src</span>&nbsp;<span class="op" id="3782552">[</span><span class="op" id="3782553">]</span><span class="builtintype" id="3782554">byte</span><span class="op" id="3782558">)</span>&nbsp;<span class="op" id="3782560">(</span><span class="ident" id="3782561">n</span>&nbsp;<span class="builtintype" id="3782563">int</span><span class="op" id="3782566">,</span>&nbsp;<span class="ident" id="3782568">err</span>&nbsp;<span class="builtintype" id="3782572">error</span><span class="op" id="3782577">)</span>&nbsp;<span class="op" id="3782579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782582">src</span>&nbsp;<span class="op" id="3782586">=</span>&nbsp;<span class="ident" id="3782588">bytes</span><span class="op" id="3782593">.</span><span class="ident" id="3782594">Map</span><span class="op" id="3782597">(</span><span class="ident" id="3782598">removeNewlinesMapper</span><span class="op" id="3782618">,</span>&nbsp;<span class="ident" id="3782620">src</span><span class="op" id="3782623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782626">n</span><span class="op" id="3782627">,</span>&nbsp;<span class="ident" id="3782629">_</span><span class="op" id="3782630">,</span>&nbsp;<span class="ident" id="3782632">err</span>&nbsp;<span class="op" id="3782636">=</span>&nbsp;<span class="ident" id="3782638">enc</span><span class="op" id="3782641">.</span><span class="ident" id="3782642">decode</span><span class="op" id="3782648">(</span><span class="ident" id="3782649">dst</span><span class="op" id="3782652">,</span>&nbsp;<span class="ident" id="3782654">src</span><span class="op" id="3782657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782660">return</span><br>
<span class="lineno">290</span><span class="op" id="3782667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3782670">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3782740">func</span>&nbsp;<span class="op" id="3782745">(</span><span class="ident" id="3782746">enc</span>&nbsp;<span class="op" id="3782750">*</span><span class="ident" id="3782751">Encoding</span><span class="op" id="3782759">)</span>&nbsp;<span class="ident" id="3782761">DecodeString</span><span class="op" id="3782773">(</span><span class="ident" id="3782774">s</span>&nbsp;<span class="builtintype" id="3782776">string</span><span class="op" id="3782782">)</span>&nbsp;<span class="op" id="3782784">(</span><span class="op" id="3782785">[</span><span class="op" id="3782786">]</span><span class="builtintype" id="3782787">byte</span><span class="op" id="3782791">,</span>&nbsp;<span class="builtintype" id="3782793">error</span><span class="op" id="3782798">)</span>&nbsp;<span class="op" id="3782800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782803">s</span>&nbsp;<span class="op" id="3782805">=</span>&nbsp;<span class="ident" id="3782807">strings</span><span class="op" id="3782814">.</span><span class="ident" id="3782815">Map</span><span class="op" id="3782818">(</span><span class="ident" id="3782819">removeNewlinesMapper</span><span class="op" id="3782839">,</span>&nbsp;<span class="ident" id="3782841">s</span><span class="op" id="3782842">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782845">dbuf</span>&nbsp;<span class="op" id="3782850">:=</span>&nbsp;<span class="builtinfunc" id="3782853">make</span><span class="op" id="3782857">(</span><span class="op" id="3782858">[</span><span class="op" id="3782859">]</span><span class="builtintype" id="3782860">byte</span><span class="op" id="3782864">,</span>&nbsp;<span class="ident" id="3782866">enc</span><span class="op" id="3782869">.</span><span class="ident" id="3782870">DecodedLen</span><span class="op" id="3782880">(</span><span class="builtinfunc" id="3782881">len</span><span class="op" id="3782884">(</span><span class="ident" id="3782885">s</span><span class="op" id="3782886">)</span><span class="op" id="3782887">)</span><span class="op" id="3782888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782891">n</span><span class="op" id="3782892">,</span>&nbsp;<span class="ident" id="3782894">_</span><span class="op" id="3782895">,</span>&nbsp;<span class="ident" id="3782897">err</span>&nbsp;<span class="op" id="3782901">:=</span>&nbsp;<span class="ident" id="3782904">enc</span><span class="op" id="3782907">.</span><span class="ident" id="3782908">decode</span><span class="op" id="3782914">(</span><span class="ident" id="3782915">dbuf</span><span class="op" id="3782919">,</span>&nbsp;<span class="op" id="3782921">[</span><span class="op" id="3782922">]</span><span class="builtintype" id="3782923">byte</span><span class="op" id="3782927">(</span><span class="ident" id="3782928">s</span><span class="op" id="3782929">)</span><span class="op" id="3782930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3782933">return</span>&nbsp;<span class="ident" id="3782940">dbuf</span><span class="op" id="3782944">[</span><span class="op" id="3782945">:</span><span class="ident" id="3782946">n</span><span class="op" id="3782947">]</span><span class="op" id="3782948">,</span>&nbsp;<span class="ident" id="3782950">err</span><br>
<span class="lineno"></span><span class="op" id="3782954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3782957">type</span>&nbsp;<span class="ident" id="3782962">decoder</span>&nbsp;<span class="keyword" id="3782970">struct</span>&nbsp;<span class="op" id="3782977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782980">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3782987">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3782994">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3783001">*</span><span class="ident" id="3783002">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783012">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3783019">io</span><span class="op" id="3783021">.</span><span class="ident" id="3783022">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783030">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3783037">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3783048">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783071">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3783078">[</span><span class="num" id="3783079">1024</span><span class="op" id="3783083">]</span><span class="builtintype" id="3783084">byte</span>&nbsp;<span class="comment" id="3783089">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783108">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3783115">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783120">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3783127">[</span><span class="op" id="3783128">]</span><span class="builtintype" id="3783129">byte</span>&nbsp;<span class="comment" id="3783134">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783162">outbuf</span>&nbsp;<span class="op" id="3783169">[</span><span class="num" id="3783170">1024</span>&nbsp;<span class="op" id="3783175">/</span>&nbsp;<span class="num" id="3783177">4</span>&nbsp;<span class="op" id="3783179">*</span>&nbsp;<span class="num" id="3783181">3</span><span class="op" id="3783182">]</span><span class="builtintype" id="3783183">byte</span><br>
<span class="lineno"></span><span class="op" id="3783188">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3783191">func</span>&nbsp;<span class="op" id="3783196">(</span><span class="ident" id="3783197">d</span>&nbsp;<span class="op" id="3783199">*</span><span class="ident" id="3783200">decoder</span><span class="op" id="3783207">)</span>&nbsp;<span class="ident" id="3783209">Read</span><span class="op" id="3783213">(</span><span class="ident" id="3783214">p</span>&nbsp;<span class="op" id="3783216">[</span><span class="op" id="3783217">]</span><span class="builtintype" id="3783218">byte</span><span class="op" id="3783222">)</span>&nbsp;<span class="op" id="3783224">(</span><span class="ident" id="3783225">n</span>&nbsp;<span class="builtintype" id="3783227">int</span><span class="op" id="3783230">,</span>&nbsp;<span class="ident" id="3783232">err</span>&nbsp;<span class="builtintype" id="3783236">error</span><span class="op" id="3783241">)</span>&nbsp;<span class="op" id="3783243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783246">if</span>&nbsp;<span class="ident" id="3783249">d</span><span class="op" id="3783250">.</span><span class="ident" id="3783251">err</span>&nbsp;<span class="op" id="3783255">!=</span>&nbsp;<span class="ident" id="3783258">nil</span>&nbsp;<span class="op" id="3783262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783266">return</span>&nbsp;<span class="num" id="3783273">0</span><span class="op" id="3783274">,</span>&nbsp;<span class="ident" id="3783276">d</span><span class="op" id="3783277">.</span><span class="ident" id="3783278">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783283">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783287">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783335">if</span>&nbsp;<span class="builtinfunc" id="3783338">len</span><span class="op" id="3783341">(</span><span class="ident" id="3783342">d</span><span class="op" id="3783343">.</span><span class="ident" id="3783344">out</span><span class="op" id="3783347">)</span>&nbsp;<span class="op" id="3783349">&gt;</span>&nbsp;<span class="num" id="3783351">0</span>&nbsp;<span class="op" id="3783353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783357">n</span>&nbsp;<span class="op" id="3783359">=</span>&nbsp;<span class="builtinfunc" id="3783361">copy</span><span class="op" id="3783365">(</span><span class="ident" id="3783366">p</span><span class="op" id="3783367">,</span>&nbsp;<span class="ident" id="3783369">d</span><span class="op" id="3783370">.</span><span class="ident" id="3783371">out</span><span class="op" id="3783374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783378">d</span><span class="op" id="3783379">.</span><span class="ident" id="3783380">out</span>&nbsp;<span class="op" id="3783384">=</span>&nbsp;<span class="ident" id="3783386">d</span><span class="op" id="3783387">.</span><span class="ident" id="3783388">out</span><span class="op" id="3783391">[</span><span class="ident" id="3783392">n</span><span class="op" id="3783393">:</span><span class="op" id="3783394">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783398">return</span>&nbsp;<span class="ident" id="3783405">n</span><span class="op" id="3783406">,</span>&nbsp;<span class="ident" id="3783408">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783417">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783435">nn</span>&nbsp;<span class="op" id="3783438">:=</span>&nbsp;<span class="builtinfunc" id="3783441">len</span><span class="op" id="3783444">(</span><span class="ident" id="3783445">p</span><span class="op" id="3783446">)</span>&nbsp;<span class="op" id="3783448">/</span>&nbsp;<span class="num" id="3783450">3</span>&nbsp;<span class="op" id="3783452">*</span>&nbsp;<span class="num" id="3783454">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783457">if</span>&nbsp;<span class="ident" id="3783460">nn</span>&nbsp;<span class="op" id="3783463">&lt;</span>&nbsp;<span class="num" id="3783465">4</span>&nbsp;<span class="op" id="3783467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783471">nn</span>&nbsp;<span class="op" id="3783474">=</span>&nbsp;<span class="num" id="3783476">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783482">if</span>&nbsp;<span class="ident" id="3783485">nn</span>&nbsp;<span class="op" id="3783488">&gt;</span>&nbsp;<span class="builtinfunc" id="3783490">len</span><span class="op" id="3783493">(</span><span class="ident" id="3783494">d</span><span class="op" id="3783495">.</span><span class="ident" id="3783496">buf</span><span class="op" id="3783499">)</span>&nbsp;<span class="op" id="3783501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783505">nn</span>&nbsp;<span class="op" id="3783508">=</span>&nbsp;<span class="builtinfunc" id="3783510">len</span><span class="op" id="3783513">(</span><span class="ident" id="3783514">d</span><span class="op" id="3783515">.</span><span class="ident" id="3783516">buf</span><span class="op" id="3783519">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783525">nn</span><span class="op" id="3783527">,</span>&nbsp;<span class="ident" id="3783529">d</span><span class="op" id="3783530">.</span><span class="ident" id="3783531">err</span>&nbsp;<span class="op" id="3783535">=</span>&nbsp;<span class="ident" id="3783537">io</span><span class="op" id="3783539">.</span><span class="ident" id="3783540">ReadAtLeast</span><span class="op" id="3783551">(</span><span class="ident" id="3783552">d</span><span class="op" id="3783553">.</span><span class="ident" id="3783554">r</span><span class="op" id="3783555">,</span>&nbsp;<span class="ident" id="3783557">d</span><span class="op" id="3783558">.</span><span class="ident" id="3783559">buf</span><span class="op" id="3783562">[</span><span class="ident" id="3783563">d</span><span class="op" id="3783564">.</span><span class="ident" id="3783565">nbuf</span><span class="op" id="3783569">:</span><span class="ident" id="3783570">nn</span><span class="op" id="3783572">]</span><span class="op" id="3783573">,</span>&nbsp;<span class="num" id="3783575">4</span><span class="op" id="3783576">-</span><span class="ident" id="3783577">d</span><span class="op" id="3783578">.</span><span class="ident" id="3783579">nbuf</span><span class="op" id="3783583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783586">d</span><span class="op" id="3783587">.</span><span class="ident" id="3783588">nbuf</span>&nbsp;<span class="op" id="3783593">+=</span>&nbsp;<span class="ident" id="3783596">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783600">if</span>&nbsp;<span class="ident" id="3783603">d</span><span class="op" id="3783604">.</span><span class="ident" id="3783605">err</span>&nbsp;<span class="op" id="3783609">!=</span>&nbsp;<span class="ident" id="3783612">nil</span>&nbsp;<span class="op" id="3783616">||</span>&nbsp;<span class="ident" id="3783619">d</span><span class="op" id="3783620">.</span><span class="ident" id="3783621">nbuf</span>&nbsp;<span class="op" id="3783626">&lt;</span>&nbsp;<span class="num" id="3783628">4</span>&nbsp;<span class="op" id="3783630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783634">return</span>&nbsp;<span class="num" id="3783641">0</span><span class="op" id="3783642">,</span>&nbsp;<span class="ident" id="3783644">d</span><span class="op" id="3783645">.</span><span class="ident" id="3783646">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3783655">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783719">nr</span>&nbsp;<span class="op" id="3783722">:=</span>&nbsp;<span class="ident" id="3783725">d</span><span class="op" id="3783726">.</span><span class="ident" id="3783727">nbuf</span>&nbsp;<span class="op" id="3783732">/</span>&nbsp;<span class="num" id="3783734">4</span>&nbsp;<span class="op" id="3783736">*</span>&nbsp;<span class="num" id="3783738">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783741">nw</span>&nbsp;<span class="op" id="3783744">:=</span>&nbsp;<span class="ident" id="3783747">d</span><span class="op" id="3783748">.</span><span class="ident" id="3783749">nbuf</span>&nbsp;<span class="op" id="3783754">/</span>&nbsp;<span class="num" id="3783756">4</span>&nbsp;<span class="op" id="3783758">*</span>&nbsp;<span class="num" id="3783760">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783763">if</span>&nbsp;<span class="ident" id="3783766">nw</span>&nbsp;<span class="op" id="3783769">&gt;</span>&nbsp;<span class="builtinfunc" id="3783771">len</span><span class="op" id="3783774">(</span><span class="ident" id="3783775">p</span><span class="op" id="3783776">)</span>&nbsp;<span class="op" id="3783778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783782">nw</span><span class="op" id="3783784">,</span>&nbsp;<span class="ident" id="3783786">d</span><span class="op" id="3783787">.</span><span class="ident" id="3783788">end</span><span class="op" id="3783791">,</span>&nbsp;<span class="ident" id="3783793">d</span><span class="op" id="3783794">.</span><span class="ident" id="3783795">err</span>&nbsp;<span class="op" id="3783799">=</span>&nbsp;<span class="ident" id="3783801">d</span><span class="op" id="3783802">.</span><span class="ident" id="3783803">enc</span><span class="op" id="3783806">.</span><span class="ident" id="3783807">decode</span><span class="op" id="3783813">(</span><span class="ident" id="3783814">d</span><span class="op" id="3783815">.</span><span class="ident" id="3783816">outbuf</span><span class="op" id="3783822">[</span><span class="num" id="3783823">0</span><span class="op" id="3783824">:</span><span class="op" id="3783825">]</span><span class="op" id="3783826">,</span>&nbsp;<span class="ident" id="3783828">d</span><span class="op" id="3783829">.</span><span class="ident" id="3783830">buf</span><span class="op" id="3783833">[</span><span class="num" id="3783834">0</span><span class="op" id="3783835">:</span><span class="ident" id="3783836">nr</span><span class="op" id="3783838">]</span><span class="op" id="3783839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783843">d</span><span class="op" id="3783844">.</span><span class="ident" id="3783845">out</span>&nbsp;<span class="op" id="3783849">=</span>&nbsp;<span class="ident" id="3783851">d</span><span class="op" id="3783852">.</span><span class="ident" id="3783853">outbuf</span><span class="op" id="3783859">[</span><span class="num" id="3783860">0</span><span class="op" id="3783861">:</span><span class="ident" id="3783862">nw</span><span class="op" id="3783864">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783868">n</span>&nbsp;<span class="op" id="3783870">=</span>&nbsp;<span class="builtinfunc" id="3783872">copy</span><span class="op" id="3783876">(</span><span class="ident" id="3783877">p</span><span class="op" id="3783878">,</span>&nbsp;<span class="ident" id="3783880">d</span><span class="op" id="3783881">.</span><span class="ident" id="3783882">out</span><span class="op" id="3783885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783889">d</span><span class="op" id="3783890">.</span><span class="ident" id="3783891">out</span>&nbsp;<span class="op" id="3783895">=</span>&nbsp;<span class="ident" id="3783897">d</span><span class="op" id="3783898">.</span><span class="ident" id="3783899">out</span><span class="op" id="3783902">[</span><span class="ident" id="3783903">n</span><span class="op" id="3783904">:</span><span class="op" id="3783905">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783908">}</span>&nbsp;<span class="keyword" id="3783910">else</span>&nbsp;<span class="op" id="3783915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783919">n</span><span class="op" id="3783920">,</span>&nbsp;<span class="ident" id="3783922">d</span><span class="op" id="3783923">.</span><span class="ident" id="3783924">end</span><span class="op" id="3783927">,</span>&nbsp;<span class="ident" id="3783929">d</span><span class="op" id="3783930">.</span><span class="ident" id="3783931">err</span>&nbsp;<span class="op" id="3783935">=</span>&nbsp;<span class="ident" id="3783937">d</span><span class="op" id="3783938">.</span><span class="ident" id="3783939">enc</span><span class="op" id="3783942">.</span><span class="ident" id="3783943">decode</span><span class="op" id="3783949">(</span><span class="ident" id="3783950">p</span><span class="op" id="3783951">,</span>&nbsp;<span class="ident" id="3783953">d</span><span class="op" id="3783954">.</span><span class="ident" id="3783955">buf</span><span class="op" id="3783958">[</span><span class="num" id="3783959">0</span><span class="op" id="3783960">:</span><span class="ident" id="3783961">nr</span><span class="op" id="3783963">]</span><span class="op" id="3783964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3783967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3783970">d</span><span class="op" id="3783971">.</span><span class="ident" id="3783972">nbuf</span>&nbsp;<span class="op" id="3783977">-=</span>&nbsp;<span class="ident" id="3783980">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3783984">for</span>&nbsp;<span class="ident" id="3783988">i</span>&nbsp;<span class="op" id="3783990">:=</span>&nbsp;<span class="num" id="3783993">0</span><span class="op" id="3783994">;</span>&nbsp;<span class="ident" id="3783996">i</span>&nbsp;<span class="op" id="3783998">&lt;</span>&nbsp;<span class="ident" id="3784000">d</span><span class="op" id="3784001">.</span><span class="ident" id="3784002">nbuf</span><span class="op" id="3784006">;</span>&nbsp;<span class="ident" id="3784008">i</span><span class="op" id="3784009">++</span>&nbsp;<span class="op" id="3784012">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784016">d</span><span class="op" id="3784017">.</span><span class="ident" id="3784018">buf</span><span class="op" id="3784021">[</span><span class="ident" id="3784022">i</span><span class="op" id="3784023">]</span>&nbsp;<span class="op" id="3784025">=</span>&nbsp;<span class="ident" id="3784027">d</span><span class="op" id="3784028">.</span><span class="ident" id="3784029">buf</span><span class="op" id="3784032">[</span><span class="ident" id="3784033">i</span><span class="op" id="3784034">+</span><span class="ident" id="3784035">nr</span><span class="op" id="3784037">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784044">if</span>&nbsp;<span class="ident" id="3784047">d</span><span class="op" id="3784048">.</span><span class="ident" id="3784049">err</span>&nbsp;<span class="op" id="3784053">==</span>&nbsp;<span class="ident" id="3784056">nil</span>&nbsp;<span class="op" id="3784060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784064">d</span><span class="op" id="3784065">.</span><span class="ident" id="3784066">err</span>&nbsp;<span class="op" id="3784070">=</span>&nbsp;<span class="ident" id="3784072">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784080">return</span>&nbsp;<span class="ident" id="3784087">n</span><span class="op" id="3784088">,</span>&nbsp;<span class="ident" id="3784090">d</span><span class="op" id="3784091">.</span><span class="ident" id="3784092">err</span><br>
<span class="lineno"></span><span class="op" id="3784096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784099">type</span>&nbsp;<span class="ident" id="3784104">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3784127">struct</span>&nbsp;<span class="op" id="3784134">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784137">wrapped</span>&nbsp;<span class="ident" id="3784145">io</span><span class="op" id="3784147">.</span><span class="ident" id="3784148">Reader</span><br>
<span class="lineno"></span><span class="op" id="3784155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3784158">func</span>&nbsp;<span class="op" id="3784163">(</span><span class="ident" id="3784164">r</span>&nbsp;<span class="op" id="3784166">*</span><span class="ident" id="3784167">newlineFilteringReader</span><span class="op" id="3784189">)</span>&nbsp;<span class="ident" id="3784191">Read</span><span class="op" id="3784195">(</span><span class="ident" id="3784196">p</span>&nbsp;<span class="op" id="3784198">[</span><span class="op" id="3784199">]</span><span class="builtintype" id="3784200">byte</span><span class="op" id="3784204">)</span>&nbsp;<span class="op" id="3784206">(</span><span class="builtintype" id="3784207">int</span><span class="op" id="3784210">,</span>&nbsp;<span class="builtintype" id="3784212">error</span><span class="op" id="3784217">)</span>&nbsp;<span class="op" id="3784219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784222">n</span><span class="op" id="3784223">,</span>&nbsp;<span class="ident" id="3784225">err</span>&nbsp;<span class="op" id="3784229">:=</span>&nbsp;<span class="ident" id="3784232">r</span><span class="op" id="3784233">.</span><span class="ident" id="3784234">wrapped</span><span class="op" id="3784241">.</span><span class="ident" id="3784242">Read</span><span class="op" id="3784246">(</span><span class="ident" id="3784247">p</span><span class="op" id="3784248">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784251">for</span>&nbsp;<span class="ident" id="3784255">n</span>&nbsp;<span class="op" id="3784257">&gt;</span>&nbsp;<span class="num" id="3784259">0</span>&nbsp;<span class="op" id="3784261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784265">offset</span>&nbsp;<span class="op" id="3784272">:=</span>&nbsp;<span class="num" id="3784275">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784279">for</span>&nbsp;<span class="ident" id="3784283">i</span><span class="op" id="3784284">,</span>&nbsp;<span class="ident" id="3784286">b</span>&nbsp;<span class="op" id="3784288">:=</span>&nbsp;<span class="keyword" id="3784291">range</span>&nbsp;<span class="ident" id="3784297">p</span><span class="op" id="3784298">[</span><span class="num" id="3784299">0</span><span class="op" id="3784300">:</span><span class="ident" id="3784301">n</span><span class="op" id="3784302">]</span>&nbsp;<span class="op" id="3784304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784309">if</span>&nbsp;<span class="ident" id="3784312">b</span>&nbsp;<span class="op" id="3784314">!=</span>&nbsp;<span class="string" id="3784317">&#39;\r&#39;</span>&nbsp;<span class="op" id="3784322">&amp;&amp;</span>&nbsp;<span class="ident" id="3784325">b</span>&nbsp;<span class="op" id="3784327">!=</span>&nbsp;<span class="string" id="3784330">&#39;\n&#39;</span>&nbsp;<span class="op" id="3784335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784341">if</span>&nbsp;<span class="ident" id="3784344">i</span>&nbsp;<span class="op" id="3784346">!=</span>&nbsp;<span class="ident" id="3784349">offset</span>&nbsp;<span class="op" id="3784356">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784363">p</span><span class="op" id="3784364">[</span><span class="ident" id="3784365">offset</span><span class="op" id="3784371">]</span>&nbsp;<span class="op" id="3784373">=</span>&nbsp;<span class="ident" id="3784375">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784387">offset</span><span class="op" id="3784393">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784403">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784407">if</span>&nbsp;<span class="ident" id="3784410">offset</span>&nbsp;<span class="op" id="3784417">&gt;</span>&nbsp;<span class="num" id="3784419">0</span>&nbsp;<span class="op" id="3784421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784426">return</span>&nbsp;<span class="ident" id="3784433">offset</span><span class="op" id="3784439">,</span>&nbsp;<span class="ident" id="3784441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3784451">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3784504">n</span><span class="op" id="3784505">,</span>&nbsp;<span class="ident" id="3784507">err</span>&nbsp;<span class="op" id="3784511">=</span>&nbsp;<span class="ident" id="3784513">r</span><span class="op" id="3784514">.</span><span class="ident" id="3784515">wrapped</span><span class="op" id="3784522">.</span><span class="ident" id="3784523">Read</span><span class="op" id="3784527">(</span><span class="ident" id="3784528">p</span><span class="op" id="3784529">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3784532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784535">return</span>&nbsp;<span class="ident" id="3784542">n</span><span class="op" id="3784543">,</span>&nbsp;<span class="ident" id="3784545">err</span><br>
<span class="lineno"></span><span class="op" id="3784549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784552">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3784606">func</span>&nbsp;<span class="ident" id="3784611">NewDecoder</span><span class="op" id="3784621">(</span><span class="ident" id="3784622">enc</span>&nbsp;<span class="op" id="3784626">*</span><span class="ident" id="3784627">Encoding</span><span class="op" id="3784635">,</span>&nbsp;<span class="ident" id="3784637">r</span>&nbsp;<span class="ident" id="3784639">io</span><span class="op" id="3784641">.</span><span class="ident" id="3784642">Reader</span><span class="op" id="3784648">)</span>&nbsp;<span class="ident" id="3784650">io</span><span class="op" id="3784652">.</span><span class="ident" id="3784653">Reader</span>&nbsp;<span class="op" id="3784660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3784663">return</span>&nbsp;<span class="op" id="3784670">&amp;</span><span class="ident" id="3784671">decoder</span><span class="op" id="3784678">{</span><span class="ident" id="3784679">enc</span><span class="op" id="3784682">:</span>&nbsp;<span class="ident" id="3784684">enc</span><span class="op" id="3784687">,</span>&nbsp;<span class="ident" id="3784689">r</span><span class="op" id="3784690">:</span>&nbsp;<span class="op" id="3784692">&amp;</span><span class="ident" id="3784693">newlineFilteringReader</span><span class="op" id="3784715">{</span><span class="ident" id="3784716">r</span><span class="op" id="3784717">}</span><span class="op" id="3784718">}</span><br>
<span class="lineno"></span><span class="op" id="3784720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3784723">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3784793">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3784845">func</span>&nbsp;<span class="op" id="3784850">(</span><span class="ident" id="3784851">enc</span>&nbsp;<span class="op" id="3784855">*</span><span class="ident" id="3784856">Encoding</span><span class="op" id="3784864">)</span>&nbsp;<span class="ident" id="3784866">DecodedLen</span><span class="op" id="3784876">(</span><span class="ident" id="3784877">n</span>&nbsp;<span class="builtintype" id="3784879">int</span><span class="op" id="3784882">)</span>&nbsp;<span class="builtintype" id="3784884">int</span>&nbsp;<span class="op" id="3784888">{</span>&nbsp;<span class="keyword" id="3784890">return</span>&nbsp;<span class="ident" id="3784897">n</span>&nbsp;<span class="op" id="3784899">/</span>&nbsp;<span class="num" id="3784901">4</span>&nbsp;<span class="op" id="3784903">*</span>&nbsp;<span class="num" id="3784905">3</span>&nbsp;<span class="op" id="3784907">}</span>
</div>
</body>
</html>
