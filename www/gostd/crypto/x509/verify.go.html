<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4626694">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4626749">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4626803">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4626854">package</span>&nbsp;<span class="ident" id="4626862">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626868">import</span>&nbsp;<span class="op" id="4626875">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626878">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626885">&#34;net&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626892">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626903">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626914">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4626922">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4626937">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4626940">type</span>&nbsp;<span class="ident" id="4626945">InvalidReason</span>&nbsp;<span class="builtintype" id="4626959">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626964">const</span>&nbsp;<span class="op" id="4626970">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4626973">//&nbsp;NotAuthorizedToSign&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;is&nbsp;signed&nbsp;by&nbsp;another</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627045">//&nbsp;which&nbsp;isn&#39;t&nbsp;marked&nbsp;as&nbsp;a&nbsp;CA&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627089">NotAuthorizedToSign</span>&nbsp;<span class="ident" id="4627109">InvalidReason</span>&nbsp;<span class="op" id="4627123">=</span>&nbsp;<span class="ident" id="4627125">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627131">//&nbsp;Expired&nbsp;results&nbsp;when&nbsp;a&nbsp;certificate&nbsp;has&nbsp;expired,&nbsp;based&nbsp;on&nbsp;the&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627201">//&nbsp;given&nbsp;in&nbsp;the&nbsp;VerifyOptions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627233">Expired</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627242">//&nbsp;CANotAuthorizedForThisName&nbsp;results&nbsp;when&nbsp;an&nbsp;intermediate&nbsp;or&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627310">//&nbsp;certificate&nbsp;has&nbsp;a&nbsp;name&nbsp;constraint&nbsp;which&nbsp;doesn&#39;t&nbsp;include&nbsp;the&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627379">//&nbsp;being&nbsp;checked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627398">CANotAuthorizedForThisName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627426">//&nbsp;TooManyIntermediates&nbsp;results&nbsp;when&nbsp;a&nbsp;path&nbsp;length&nbsp;constraint&nbsp;is</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627492">//&nbsp;violated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627506">TooManyIntermediates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627528">//&nbsp;IncompatibleUsage&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&#39;s&nbsp;key&nbsp;usage&nbsp;indicates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627601">//&nbsp;that&nbsp;it&nbsp;may&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;a&nbsp;different&nbsp;purpose.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627655">IncompatibleUsage</span><br>
<span class="lineno">35</span><span class="op" id="4627673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4627676">//&nbsp;CertificateInvalidError&nbsp;results&nbsp;when&nbsp;an&nbsp;odd&nbsp;error&nbsp;occurs.&nbsp;Users&nbsp;of&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4627751">//&nbsp;library&nbsp;probably&nbsp;want&nbsp;to&nbsp;handle&nbsp;all&nbsp;these&nbsp;errors&nbsp;uniformly.</span><br>
<span class="lineno"></span><span class="keyword" id="4627814">type</span>&nbsp;<span class="ident" id="4627819">CertificateInvalidError</span>&nbsp;<span class="keyword" id="4627843">struct</span>&nbsp;<span class="op" id="4627850">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627853">Cert</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4627860">*</span><span class="ident" id="4627861">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627874">Reason</span>&nbsp;<span class="ident" id="4627881">InvalidReason</span><br>
<span class="lineno"></span><span class="op" id="4627895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4627898">func</span>&nbsp;<span class="op" id="4627903">(</span><span class="ident" id="4627904">e</span>&nbsp;<span class="ident" id="4627906">CertificateInvalidError</span><span class="op" id="4627929">)</span>&nbsp;<span class="ident" id="4627931">Error</span><span class="op" id="4627936">(</span><span class="op" id="4627937">)</span>&nbsp;<span class="builtintype" id="4627939">string</span>&nbsp;<span class="op" id="4627946">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627949">switch</span>&nbsp;<span class="ident" id="4627956">e</span><span class="op" id="4627957">.</span><span class="ident" id="4627958">Reason</span>&nbsp;<span class="op" id="4627965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627968">case</span>&nbsp;<span class="ident" id="4627973">NotAuthorizedToSign</span><span class="op" id="4627992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627996">return</span>&nbsp;<span class="string" id="4628003">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;other&nbsp;certificates&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628069">case</span>&nbsp;<span class="ident" id="4628074">Expired</span><span class="op" id="4628081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628085">return</span>&nbsp;<span class="string" id="4628092">&#34;x509:&nbsp;certificate&nbsp;has&nbsp;expired&nbsp;or&nbsp;is&nbsp;not&nbsp;yet&nbsp;valid&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628145">case</span>&nbsp;<span class="ident" id="4628150">CANotAuthorizedForThisName</span><span class="op" id="4628176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628180">return</span>&nbsp;<span class="string" id="4628187">&#34;x509:&nbsp;a&nbsp;root&nbsp;or&nbsp;intermediate&nbsp;certificate&nbsp;is&nbsp;not&nbsp;authorized&nbsp;to&nbsp;sign&nbsp;in&nbsp;this&nbsp;domain&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628272">case</span>&nbsp;<span class="ident" id="4628277">TooManyIntermediates</span><span class="op" id="4628297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628301">return</span>&nbsp;<span class="string" id="4628308">&#34;x509:&nbsp;too&nbsp;many&nbsp;intermediates&nbsp;for&nbsp;path&nbsp;length&nbsp;constraint&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628367">case</span>&nbsp;<span class="ident" id="4628372">IncompatibleUsage</span><span class="op" id="4628389">:</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628393">return</span>&nbsp;<span class="string" id="4628400">&#34;x509:&nbsp;certificate&nbsp;specifies&nbsp;an&nbsp;incompatible&nbsp;key&nbsp;usage&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628460">return</span>&nbsp;<span class="string" id="4628467">&#34;x509:&nbsp;unknown&nbsp;error&#34;</span><br>
<span class="lineno"></span><span class="op" id="4628489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4628492">//&nbsp;HostnameError&nbsp;results&nbsp;when&nbsp;the&nbsp;set&nbsp;of&nbsp;authorized&nbsp;names&nbsp;doesn&#39;t&nbsp;match&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4628568">//&nbsp;requested&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4628587">type</span>&nbsp;<span class="ident" id="4628592">HostnameError</span>&nbsp;<span class="keyword" id="4628606">struct</span>&nbsp;<span class="op" id="4628613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628616">Certificate</span>&nbsp;<span class="op" id="4628628">*</span><span class="ident" id="4628629">Certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628642">Host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4628654">string</span><br>
<span class="lineno">65</span><span class="op" id="4628661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4628664">func</span>&nbsp;<span class="op" id="4628669">(</span><span class="ident" id="4628670">h</span>&nbsp;<span class="ident" id="4628672">HostnameError</span><span class="op" id="4628685">)</span>&nbsp;<span class="ident" id="4628687">Error</span><span class="op" id="4628692">(</span><span class="op" id="4628693">)</span>&nbsp;<span class="builtintype" id="4628695">string</span>&nbsp;<span class="op" id="4628702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628705">c</span>&nbsp;<span class="op" id="4628707">:=</span>&nbsp;<span class="ident" id="4628710">h</span><span class="op" id="4628711">.</span><span class="ident" id="4628712">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628726">var</span>&nbsp;<span class="ident" id="4628730">valid</span>&nbsp;<span class="builtintype" id="4628736">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628744">if</span>&nbsp;<span class="ident" id="4628747">ip</span>&nbsp;<span class="op" id="4628750">:=</span>&nbsp;<span class="ident" id="4628753">net</span><span class="op" id="4628756">.</span><span class="ident" id="4628757">ParseIP</span><span class="op" id="4628764">(</span><span class="ident" id="4628765">h</span><span class="op" id="4628766">.</span><span class="ident" id="4628767">Host</span><span class="op" id="4628771">)</span><span class="op" id="4628772">;</span>&nbsp;<span class="ident" id="4628774">ip</span>&nbsp;<span class="op" id="4628777">!=</span>&nbsp;<span class="ident" id="4628780">nil</span>&nbsp;<span class="op" id="4628784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628788">//&nbsp;Trying&nbsp;to&nbsp;validate&nbsp;an&nbsp;IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628818">if</span>&nbsp;<span class="builtinfunc" id="4628821">len</span><span class="op" id="4628824">(</span><span class="ident" id="4628825">c</span><span class="op" id="4628826">.</span><span class="ident" id="4628827">IPAddresses</span><span class="op" id="4628838">)</span>&nbsp;<span class="op" id="4628840">==</span>&nbsp;<span class="num" id="4628843">0</span>&nbsp;<span class="op" id="4628845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628850">return</span>&nbsp;<span class="string" id="4628857">&#34;x509:&nbsp;cannot&nbsp;validate&nbsp;certificate&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4628898">+</span>&nbsp;<span class="ident" id="4628900">h</span><span class="op" id="4628901">.</span><span class="ident" id="4628902">Host</span>&nbsp;<span class="op" id="4628907">+</span>&nbsp;<span class="string" id="4628909">&#34;&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;contain&nbsp;any&nbsp;IP&nbsp;SANs&#34;</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628957">for</span>&nbsp;<span class="ident" id="4628961">_</span><span class="op" id="4628962">,</span>&nbsp;<span class="ident" id="4628964">san</span>&nbsp;<span class="op" id="4628968">:=</span>&nbsp;<span class="keyword" id="4628971">range</span>&nbsp;<span class="ident" id="4628977">c</span><span class="op" id="4628978">.</span><span class="ident" id="4628979">IPAddresses</span>&nbsp;<span class="op" id="4628991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628996">if</span>&nbsp;<span class="builtinfunc" id="4628999">len</span><span class="op" id="4629002">(</span><span class="ident" id="4629003">valid</span><span class="op" id="4629008">)</span>&nbsp;<span class="op" id="4629010">&gt;</span>&nbsp;<span class="num" id="4629012">0</span>&nbsp;<span class="op" id="4629014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629020">valid</span>&nbsp;<span class="op" id="4629026">+=</span>&nbsp;<span class="string" id="4629029">&#34;,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629037">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629042">valid</span>&nbsp;<span class="op" id="4629048">+=</span>&nbsp;<span class="ident" id="4629051">san</span><span class="op" id="4629054">.</span><span class="ident" id="4629055">String</span><span class="op" id="4629061">(</span><span class="op" id="4629062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629069">}</span>&nbsp;<span class="keyword" id="4629071">else</span>&nbsp;<span class="op" id="4629076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629080">if</span>&nbsp;<span class="builtinfunc" id="4629083">len</span><span class="op" id="4629086">(</span><span class="ident" id="4629087">c</span><span class="op" id="4629088">.</span><span class="ident" id="4629089">DNSNames</span><span class="op" id="4629097">)</span>&nbsp;<span class="op" id="4629099">&gt;</span>&nbsp;<span class="num" id="4629101">0</span>&nbsp;<span class="op" id="4629103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629108">valid</span>&nbsp;<span class="op" id="4629114">=</span>&nbsp;<span class="ident" id="4629116">strings</span><span class="op" id="4629123">.</span><span class="ident" id="4629124">Join</span><span class="op" id="4629128">(</span><span class="ident" id="4629129">c</span><span class="op" id="4629130">.</span><span class="ident" id="4629131">DNSNames</span><span class="op" id="4629139">,</span>&nbsp;<span class="string" id="4629141">&#34;,&nbsp;&#34;</span><span class="op" id="4629145">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629149">}</span>&nbsp;<span class="keyword" id="4629151">else</span>&nbsp;<span class="op" id="4629156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629161">valid</span>&nbsp;<span class="op" id="4629167">=</span>&nbsp;<span class="ident" id="4629169">c</span><span class="op" id="4629170">.</span><span class="ident" id="4629171">Subject</span><span class="op" id="4629178">.</span><span class="ident" id="4629179">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629198">return</span>&nbsp;<span class="string" id="4629205">&#34;x509:&nbsp;certificate&nbsp;is&nbsp;valid&nbsp;for&nbsp;&#34;</span>&nbsp;<span class="op" id="4629239">+</span>&nbsp;<span class="ident" id="4629241">valid</span>&nbsp;<span class="op" id="4629247">+</span>&nbsp;<span class="string" id="4629249">&#34;,&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4629258">+</span>&nbsp;<span class="ident" id="4629260">h</span><span class="op" id="4629261">.</span><span class="ident" id="4629262">Host</span><br>
<span class="lineno">90</span><span class="op" id="4629267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4629270">//&nbsp;UnknownAuthorityError&nbsp;results&nbsp;when&nbsp;the&nbsp;certificate&nbsp;issuer&nbsp;is&nbsp;unknown</span><br>
<span class="lineno"></span><span class="keyword" id="4629342">type</span>&nbsp;<span class="ident" id="4629347">UnknownAuthorityError</span>&nbsp;<span class="keyword" id="4629369">struct</span>&nbsp;<span class="op" id="4629376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629379">cert</span>&nbsp;<span class="op" id="4629384">*</span><span class="ident" id="4629385">Certificate</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629398">//&nbsp;hintErr&nbsp;contains&nbsp;an&nbsp;error&nbsp;that&nbsp;may&nbsp;be&nbsp;helpful&nbsp;in&nbsp;determining&nbsp;why&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629470">//&nbsp;authority&nbsp;wasn&#39;t&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629498">hintErr</span>&nbsp;<span class="builtintype" id="4629506">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629513">//&nbsp;hintCert&nbsp;contains&nbsp;a&nbsp;possible&nbsp;authority&nbsp;certificate&nbsp;that&nbsp;was&nbsp;rejected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629586">//&nbsp;because&nbsp;of&nbsp;the&nbsp;error&nbsp;in&nbsp;hintErr.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629623">hintCert</span>&nbsp;<span class="op" id="4629632">*</span><span class="ident" id="4629633">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4629645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4629648">func</span>&nbsp;<span class="op" id="4629653">(</span><span class="ident" id="4629654">e</span>&nbsp;<span class="ident" id="4629656">UnknownAuthorityError</span><span class="op" id="4629677">)</span>&nbsp;<span class="ident" id="4629679">Error</span><span class="op" id="4629684">(</span><span class="op" id="4629685">)</span>&nbsp;<span class="builtintype" id="4629687">string</span>&nbsp;<span class="op" id="4629694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629697">s</span>&nbsp;<span class="op" id="4629699">:=</span>&nbsp;<span class="string" id="4629702">&#34;x509:&nbsp;certificate&nbsp;signed&nbsp;by&nbsp;unknown&nbsp;authority&#34;</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629751">if</span>&nbsp;<span class="ident" id="4629754">e</span><span class="op" id="4629755">.</span><span class="ident" id="4629756">hintErr</span>&nbsp;<span class="op" id="4629764">!=</span>&nbsp;<span class="ident" id="4629767">nil</span>&nbsp;<span class="op" id="4629771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629775">certName</span>&nbsp;<span class="op" id="4629784">:=</span>&nbsp;<span class="ident" id="4629787">e</span><span class="op" id="4629788">.</span><span class="ident" id="4629789">hintCert</span><span class="op" id="4629797">.</span><span class="ident" id="4629798">Subject</span><span class="op" id="4629805">.</span><span class="ident" id="4629806">CommonName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629819">if</span>&nbsp;<span class="builtinfunc" id="4629822">len</span><span class="op" id="4629825">(</span><span class="ident" id="4629826">certName</span><span class="op" id="4629834">)</span>&nbsp;<span class="op" id="4629836">==</span>&nbsp;<span class="num" id="4629839">0</span>&nbsp;<span class="op" id="4629841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629846">if</span>&nbsp;<span class="builtinfunc" id="4629849">len</span><span class="op" id="4629852">(</span><span class="ident" id="4629853">e</span><span class="op" id="4629854">.</span><span class="ident" id="4629855">hintCert</span><span class="op" id="4629863">.</span><span class="ident" id="4629864">Subject</span><span class="op" id="4629871">.</span><span class="ident" id="4629872">Organization</span><span class="op" id="4629884">)</span>&nbsp;<span class="op" id="4629886">&gt;</span>&nbsp;<span class="num" id="4629888">0</span>&nbsp;<span class="op" id="4629890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629896">certName</span>&nbsp;<span class="op" id="4629905">=</span>&nbsp;<span class="ident" id="4629907">e</span><span class="op" id="4629908">.</span><span class="ident" id="4629909">hintCert</span><span class="op" id="4629917">.</span><span class="ident" id="4629918">Subject</span><span class="op" id="4629925">.</span><span class="ident" id="4629926">Organization</span><span class="op" id="4629938">[</span><span class="num" id="4629939">0</span><span class="op" id="4629940">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629950">certName</span>&nbsp;<span class="op" id="4629959">=</span>&nbsp;<span class="string" id="4629961">&#34;serial:&#34;</span>&nbsp;<span class="op" id="4629971">+</span>&nbsp;<span class="ident" id="4629973">e</span><span class="op" id="4629974">.</span><span class="ident" id="4629975">hintCert</span><span class="op" id="4629983">.</span><span class="ident" id="4629984">SerialNumber</span><span class="op" id="4629996">.</span><span class="ident" id="4629997">String</span><span class="op" id="4630003">(</span><span class="op" id="4630004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630012">s</span>&nbsp;<span class="op" id="4630014">+=</span>&nbsp;<span class="ident" id="4630017">fmt</span><span class="op" id="4630020">.</span><span class="ident" id="4630021">Sprintf</span><span class="op" id="4630028">(</span><span class="string" id="4630029">&#34;&nbsp;(possibly&nbsp;because&nbsp;of&nbsp;%q&nbsp;while&nbsp;trying&nbsp;to&nbsp;verify&nbsp;candidate&nbsp;authority&nbsp;certificate&nbsp;%q)&#34;</span><span class="op" id="4630114">,</span>&nbsp;<span class="ident" id="4630116">e</span><span class="op" id="4630117">.</span><span class="ident" id="4630118">hintErr</span><span class="op" id="4630125">,</span>&nbsp;<span class="ident" id="4630127">certName</span><span class="op" id="4630135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630138">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630141">return</span>&nbsp;<span class="ident" id="4630148">s</span><br>
<span class="lineno"></span><span class="op" id="4630150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4630153">//&nbsp;SystemRootsError&nbsp;results&nbsp;when&nbsp;we&nbsp;fail&nbsp;to&nbsp;load&nbsp;the&nbsp;system&nbsp;root&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4630232">type</span>&nbsp;<span class="ident" id="4630237">SystemRootsError</span>&nbsp;<span class="keyword" id="4630254">struct</span><span class="op" id="4630260">{</span><span class="op" id="4630261">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="4630264">func</span>&nbsp;<span class="op" id="4630269">(</span><span class="ident" id="4630270">SystemRootsError</span><span class="op" id="4630286">)</span>&nbsp;<span class="ident" id="4630288">Error</span><span class="op" id="4630293">(</span><span class="op" id="4630294">)</span>&nbsp;<span class="builtintype" id="4630296">string</span>&nbsp;<span class="op" id="4630303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630306">return</span>&nbsp;<span class="string" id="4630313">&#34;x509:&nbsp;failed&nbsp;to&nbsp;load&nbsp;system&nbsp;roots&nbsp;and&nbsp;no&nbsp;roots&nbsp;provided&#34;</span><br>
<span class="lineno"></span><span class="op" id="4630371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="4630374">//&nbsp;VerifyOptions&nbsp;contains&nbsp;parameters&nbsp;for&nbsp;Certificate.Verify.&nbsp;It&#39;s&nbsp;a&nbsp;structure</span><br>
<span class="lineno"></span><span class="comment" id="4630452">//&nbsp;because&nbsp;other&nbsp;PKIX&nbsp;verification&nbsp;APIs&nbsp;have&nbsp;ended&nbsp;up&nbsp;needing&nbsp;many&nbsp;options.</span><br>
<span class="lineno"></span><span class="keyword" id="4630528">type</span>&nbsp;<span class="ident" id="4630533">VerifyOptions</span>&nbsp;<span class="keyword" id="4630547">struct</span>&nbsp;<span class="op" id="4630554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630557">DNSName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4630571">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630579">Intermediates</span>&nbsp;<span class="op" id="4630593">*</span><span class="ident" id="4630594">CertPool</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630604">Roots</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4630618">*</span><span class="ident" id="4630619">CertPool</span>&nbsp;<span class="comment" id="4630628">//&nbsp;if&nbsp;nil,&nbsp;the&nbsp;system&nbsp;roots&nbsp;are&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630666">CurrentTime</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4630680">time</span><span class="op" id="4630684">.</span><span class="ident" id="4630685">Time</span>&nbsp;<span class="comment" id="4630690">//&nbsp;if&nbsp;zero,&nbsp;the&nbsp;current&nbsp;time&nbsp;is&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630728">//&nbsp;KeyUsage&nbsp;specifies&nbsp;which&nbsp;Extended&nbsp;Key&nbsp;Usage&nbsp;values&nbsp;are&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630799">//&nbsp;An&nbsp;empty&nbsp;list&nbsp;means&nbsp;ExtKeyUsageServerAuth.&nbsp;Key&nbsp;usage&nbsp;is&nbsp;considered&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630872">//&nbsp;constraint&nbsp;down&nbsp;the&nbsp;chain&nbsp;which&nbsp;mirrors&nbsp;Windows&nbsp;CryptoAPI&nbsp;behaviour,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630945">//&nbsp;but&nbsp;not&nbsp;the&nbsp;spec.&nbsp;To&nbsp;accept&nbsp;any&nbsp;key&nbsp;usage,&nbsp;include&nbsp;ExtKeyUsageAny.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631016">KeyUsages</span>&nbsp;<span class="op" id="4631026">[</span><span class="op" id="4631027">]</span><span class="ident" id="4631028">ExtKeyUsage</span><br>
<span class="lineno"></span><span class="op" id="4631040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4631043">const</span>&nbsp;<span class="op" id="4631049">(</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631052">leafCertificate</span>&nbsp;<span class="op" id="4631068">=</span>&nbsp;<span class="ident" id="4631070">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631076">intermediateCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631101">rootCertificate</span><br>
<span class="lineno"></span><span class="op" id="4631117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="4631120">//&nbsp;isValid&nbsp;performs&nbsp;validity&nbsp;checks&nbsp;on&nbsp;the&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="4631166">func</span>&nbsp;<span class="op" id="4631171">(</span><span class="ident" id="4631172">c</span>&nbsp;<span class="op" id="4631174">*</span><span class="ident" id="4631175">Certificate</span><span class="op" id="4631186">)</span>&nbsp;<span class="ident" id="4631188">isValid</span><span class="op" id="4631195">(</span><span class="ident" id="4631196">certType</span>&nbsp;<span class="builtintype" id="4631205">int</span><span class="op" id="4631208">,</span>&nbsp;<span class="ident" id="4631210">currentChain</span>&nbsp;<span class="op" id="4631223">[</span><span class="op" id="4631224">]</span><span class="op" id="4631225">*</span><span class="ident" id="4631226">Certificate</span><span class="op" id="4631237">,</span>&nbsp;<span class="ident" id="4631239">opts</span>&nbsp;<span class="op" id="4631244">*</span><span class="ident" id="4631245">VerifyOptions</span><span class="op" id="4631258">)</span>&nbsp;<span class="builtintype" id="4631260">error</span>&nbsp;<span class="op" id="4631266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631269">now</span>&nbsp;<span class="op" id="4631273">:=</span>&nbsp;<span class="ident" id="4631276">opts</span><span class="op" id="4631280">.</span><span class="ident" id="4631281">CurrentTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631294">if</span>&nbsp;<span class="ident" id="4631297">now</span><span class="op" id="4631300">.</span><span class="ident" id="4631301">IsZero</span><span class="op" id="4631307">(</span><span class="op" id="4631308">)</span>&nbsp;<span class="op" id="4631310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631314">now</span>&nbsp;<span class="op" id="4631318">=</span>&nbsp;<span class="ident" id="4631320">time</span><span class="op" id="4631324">.</span><span class="ident" id="4631325">Now</span><span class="op" id="4631328">(</span><span class="op" id="4631329">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631335">if</span>&nbsp;<span class="ident" id="4631338">now</span><span class="op" id="4631341">.</span><span class="ident" id="4631342">Before</span><span class="op" id="4631348">(</span><span class="ident" id="4631349">c</span><span class="op" id="4631350">.</span><span class="ident" id="4631351">NotBefore</span><span class="op" id="4631360">)</span>&nbsp;<span class="op" id="4631362">||</span>&nbsp;<span class="ident" id="4631365">now</span><span class="op" id="4631368">.</span><span class="ident" id="4631369">After</span><span class="op" id="4631374">(</span><span class="ident" id="4631375">c</span><span class="op" id="4631376">.</span><span class="ident" id="4631377">NotAfter</span><span class="op" id="4631385">)</span>&nbsp;<span class="op" id="4631387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631391">return</span>&nbsp;<span class="ident" id="4631398">CertificateInvalidError</span><span class="op" id="4631421">{</span><span class="ident" id="4631422">c</span><span class="op" id="4631423">,</span>&nbsp;<span class="ident" id="4631425">Expired</span><span class="op" id="4631432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631439">if</span>&nbsp;<span class="builtinfunc" id="4631442">len</span><span class="op" id="4631445">(</span><span class="ident" id="4631446">c</span><span class="op" id="4631447">.</span><span class="ident" id="4631448">PermittedDNSDomains</span><span class="op" id="4631467">)</span>&nbsp;<span class="op" id="4631469">&gt;</span>&nbsp;<span class="num" id="4631471">0</span>&nbsp;<span class="op" id="4631473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631477">ok</span>&nbsp;<span class="op" id="4631480">:=</span>&nbsp;<span class="builtintype" id="4631483">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631491">for</span>&nbsp;<span class="ident" id="4631495">_</span><span class="op" id="4631496">,</span>&nbsp;<span class="ident" id="4631498">domain</span>&nbsp;<span class="op" id="4631505">:=</span>&nbsp;<span class="keyword" id="4631508">range</span>&nbsp;<span class="ident" id="4631514">c</span><span class="op" id="4631515">.</span><span class="ident" id="4631516">PermittedDNSDomains</span>&nbsp;<span class="op" id="4631536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631541">if</span>&nbsp;<span class="ident" id="4631544">opts</span><span class="op" id="4631548">.</span><span class="ident" id="4631549">DNSName</span>&nbsp;<span class="op" id="4631557">==</span>&nbsp;<span class="ident" id="4631560">domain</span>&nbsp;<span class="op" id="4631567">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631574">(</span><span class="ident" id="4631575">strings</span><span class="op" id="4631582">.</span><span class="ident" id="4631583">HasSuffix</span><span class="op" id="4631592">(</span><span class="ident" id="4631593">opts</span><span class="op" id="4631597">.</span><span class="ident" id="4631598">DNSName</span><span class="op" id="4631605">,</span>&nbsp;<span class="ident" id="4631607">domain</span><span class="op" id="4631613">)</span>&nbsp;<span class="op" id="4631615">&amp;&amp;</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4631623">len</span><span class="op" id="4631626">(</span><span class="ident" id="4631627">opts</span><span class="op" id="4631631">.</span><span class="ident" id="4631632">DNSName</span><span class="op" id="4631639">)</span>&nbsp;<span class="op" id="4631641">&gt;=</span>&nbsp;<span class="num" id="4631644">1</span><span class="op" id="4631645">+</span><span class="builtinfunc" id="4631646">len</span><span class="op" id="4631649">(</span><span class="ident" id="4631650">domain</span><span class="op" id="4631656">)</span>&nbsp;<span class="op" id="4631658">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631666">opts</span><span class="op" id="4631670">.</span><span class="ident" id="4631671">DNSName</span><span class="op" id="4631678">[</span><span class="builtinfunc" id="4631679">len</span><span class="op" id="4631682">(</span><span class="ident" id="4631683">opts</span><span class="op" id="4631687">.</span><span class="ident" id="4631688">DNSName</span><span class="op" id="4631695">)</span><span class="op" id="4631696">-</span><span class="builtinfunc" id="4631697">len</span><span class="op" id="4631700">(</span><span class="ident" id="4631701">domain</span><span class="op" id="4631707">)</span><span class="op" id="4631708">-</span><span class="num" id="4631709">1</span><span class="op" id="4631710">]</span>&nbsp;<span class="op" id="4631712">==</span>&nbsp;<span class="string" id="4631715">&#39;.&#39;</span><span class="op" id="4631718">)</span>&nbsp;<span class="op" id="4631720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4631726">ok</span>&nbsp;<span class="op" id="4631729">=</span>&nbsp;<span class="builtintype" id="4631731">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631740">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631749">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631758">if</span>&nbsp;<span class="op" id="4631761">!</span><span class="ident" id="4631762">ok</span>&nbsp;<span class="op" id="4631765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4631770">return</span>&nbsp;<span class="ident" id="4631777">CertificateInvalidError</span><span class="op" id="4631800">{</span><span class="ident" id="4631801">c</span><span class="op" id="4631802">,</span>&nbsp;<span class="ident" id="4631804">CANotAuthorizedForThisName</span><span class="op" id="4631830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631834">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631841">//&nbsp;KeyUsage&nbsp;status&nbsp;flags&nbsp;are&nbsp;ignored.&nbsp;From&nbsp;Engineering&nbsp;Security,&nbsp;Peter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631913">//&nbsp;Gutmann:&nbsp;A&nbsp;European&nbsp;government&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signing&nbsp;certificates&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4631986">//&nbsp;being&nbsp;valid&nbsp;for&nbsp;encryption&nbsp;only,&nbsp;but&nbsp;no-one&nbsp;noticed.&nbsp;Another</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632051">//&nbsp;European&nbsp;CA&nbsp;marked&nbsp;its&nbsp;signature&nbsp;keys&nbsp;as&nbsp;not&nbsp;being&nbsp;valid&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632116">//&nbsp;signatures.&nbsp;A&nbsp;different&nbsp;CA&nbsp;marked&nbsp;its&nbsp;own&nbsp;trusted&nbsp;root&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632187">//&nbsp;as&nbsp;being&nbsp;invalid&nbsp;for&nbsp;certificate&nbsp;signing.&nbsp;&nbsp;Another&nbsp;national&nbsp;CA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632254">//&nbsp;distributed&nbsp;a&nbsp;certificate&nbsp;to&nbsp;be&nbsp;used&nbsp;to&nbsp;encrypt&nbsp;data&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632319">//&nbsp;country’s&nbsp;tax&nbsp;authority&nbsp;that&nbsp;was&nbsp;marked&nbsp;as&nbsp;only&nbsp;being&nbsp;usable&nbsp;for</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632390">//&nbsp;digital&nbsp;signatures&nbsp;but&nbsp;not&nbsp;for&nbsp;encryption.&nbsp;Yet&nbsp;another&nbsp;CA&nbsp;reversed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632461">//&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bit&nbsp;flags&nbsp;in&nbsp;the&nbsp;keyUsage&nbsp;due&nbsp;to&nbsp;confusion&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632530">//&nbsp;encoding&nbsp;endianness,&nbsp;essentially&nbsp;setting&nbsp;a&nbsp;random&nbsp;keyUsage&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632596">//&nbsp;certificates&nbsp;that&nbsp;it&nbsp;issued.&nbsp;Another&nbsp;CA&nbsp;created&nbsp;a&nbsp;self-invalidating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632668">//&nbsp;certificate&nbsp;by&nbsp;adding&nbsp;a&nbsp;certificate&nbsp;policy&nbsp;statement&nbsp;stipulating</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632737">//&nbsp;that&nbsp;the&nbsp;certificate&nbsp;had&nbsp;to&nbsp;be&nbsp;used&nbsp;strictly&nbsp;as&nbsp;specified&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632806">//&nbsp;keyUsage,&nbsp;and&nbsp;a&nbsp;keyUsage&nbsp;containing&nbsp;a&nbsp;flag&nbsp;indicating&nbsp;that&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4632877">//&nbsp;encryption&nbsp;key&nbsp;could&nbsp;only&nbsp;be&nbsp;used&nbsp;for&nbsp;Diffie-Hellman&nbsp;key&nbsp;agreement.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4632950">if</span>&nbsp;<span class="ident" id="4632953">certType</span>&nbsp;<span class="op" id="4632962">==</span>&nbsp;<span class="ident" id="4632965">intermediateCertificate</span>&nbsp;<span class="op" id="4632989">&amp;&amp;</span>&nbsp;<span class="op" id="4632992">(</span><span class="op" id="4632993">!</span><span class="ident" id="4632994">c</span><span class="op" id="4632995">.</span><span class="ident" id="4632996">BasicConstraintsValid</span>&nbsp;<span class="op" id="4633018">||</span>&nbsp;<span class="op" id="4633021">!</span><span class="ident" id="4633022">c</span><span class="op" id="4633023">.</span><span class="ident" id="4633024">IsCA</span><span class="op" id="4633028">)</span>&nbsp;<span class="op" id="4633030">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633034">return</span>&nbsp;<span class="ident" id="4633041">CertificateInvalidError</span><span class="op" id="4633064">{</span><span class="ident" id="4633065">c</span><span class="op" id="4633066">,</span>&nbsp;<span class="ident" id="4633068">NotAuthorizedToSign</span><span class="op" id="4633087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633094">if</span>&nbsp;<span class="ident" id="4633097">c</span><span class="op" id="4633098">.</span><span class="ident" id="4633099">BasicConstraintsValid</span>&nbsp;<span class="op" id="4633121">&amp;&amp;</span>&nbsp;<span class="ident" id="4633124">c</span><span class="op" id="4633125">.</span><span class="ident" id="4633126">MaxPathLen</span>&nbsp;<span class="op" id="4633137">&gt;=</span>&nbsp;<span class="num" id="4633140">0</span>&nbsp;<span class="op" id="4633142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4633146">numIntermediates</span>&nbsp;<span class="op" id="4633163">:=</span>&nbsp;<span class="builtinfunc" id="4633166">len</span><span class="op" id="4633169">(</span><span class="ident" id="4633170">currentChain</span><span class="op" id="4633182">)</span>&nbsp;<span class="op" id="4633184">-</span>&nbsp;<span class="num" id="4633186">1</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633190">if</span>&nbsp;<span class="ident" id="4633193">numIntermediates</span>&nbsp;<span class="op" id="4633210">&gt;</span>&nbsp;<span class="ident" id="4633212">c</span><span class="op" id="4633213">.</span><span class="ident" id="4633214">MaxPathLen</span>&nbsp;<span class="op" id="4633225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633230">return</span>&nbsp;<span class="ident" id="4633237">CertificateInvalidError</span><span class="op" id="4633260">{</span><span class="ident" id="4633261">c</span><span class="op" id="4633262">,</span>&nbsp;<span class="ident" id="4633264">TooManyIntermediates</span><span class="op" id="4633284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633295">return</span>&nbsp;<span class="ident" id="4633302">nil</span><br>
<span class="lineno"></span><span class="op" id="4633306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4633309">//&nbsp;Verify&nbsp;attempts&nbsp;to&nbsp;verify&nbsp;c&nbsp;by&nbsp;building&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;from&nbsp;c&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4633383">//&nbsp;certificate&nbsp;in&nbsp;opts.Roots,&nbsp;using&nbsp;certificates&nbsp;in&nbsp;opts.Intermediates&nbsp;if</span><br>
<span class="lineno">205</span><span class="comment" id="4633457">//&nbsp;needed.&nbsp;If&nbsp;successful,&nbsp;it&nbsp;returns&nbsp;one&nbsp;or&nbsp;more&nbsp;chains&nbsp;where&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="4633529">//&nbsp;element&nbsp;of&nbsp;the&nbsp;chain&nbsp;is&nbsp;c&nbsp;and&nbsp;the&nbsp;last&nbsp;element&nbsp;is&nbsp;from&nbsp;opts.Roots.</span><br>
<span class="lineno"></span><span class="comment" id="4633599">//</span><br>
<span class="lineno"></span><span class="comment" id="4633602">//&nbsp;If&nbsp;opts.Roots&nbsp;is&nbsp;nil&nbsp;and&nbsp;system&nbsp;roots&nbsp;are&nbsp;unavailable&nbsp;the&nbsp;returned&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4633678">//&nbsp;will&nbsp;be&nbsp;of&nbsp;type&nbsp;SystemRootsError.</span><br>
<span class="lineno">210</span><span class="comment" id="4633715">//</span><br>
<span class="lineno"></span><span class="comment" id="4633718">//&nbsp;WARNING:&nbsp;this&nbsp;doesn&#39;t&nbsp;do&nbsp;any&nbsp;revocation&nbsp;checking.</span><br>
<span class="lineno"></span><span class="keyword" id="4633771">func</span>&nbsp;<span class="op" id="4633776">(</span><span class="ident" id="4633777">c</span>&nbsp;<span class="op" id="4633779">*</span><span class="ident" id="4633780">Certificate</span><span class="op" id="4633791">)</span>&nbsp;<span class="ident" id="4633793">Verify</span><span class="op" id="4633799">(</span><span class="ident" id="4633800">opts</span>&nbsp;<span class="ident" id="4633805">VerifyOptions</span><span class="op" id="4633818">)</span>&nbsp;<span class="op" id="4633820">(</span><span class="ident" id="4633821">chains</span>&nbsp;<span class="op" id="4633828">[</span><span class="op" id="4633829">]</span><span class="op" id="4633830">[</span><span class="op" id="4633831">]</span><span class="op" id="4633832">*</span><span class="ident" id="4633833">Certificate</span><span class="op" id="4633844">,</span>&nbsp;<span class="ident" id="4633846">err</span>&nbsp;<span class="builtintype" id="4633850">error</span><span class="op" id="4633855">)</span>&nbsp;<span class="op" id="4633857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4633860">//&nbsp;Use&nbsp;Windows&#39;s&nbsp;own&nbsp;verification&nbsp;and&nbsp;chain&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633915">if</span>&nbsp;<span class="ident" id="4633918">opts</span><span class="op" id="4633922">.</span><span class="ident" id="4633923">Roots</span>&nbsp;<span class="op" id="4633929">==</span>&nbsp;<span class="ident" id="4633932">nil</span>&nbsp;<span class="op" id="4633936">&amp;&amp;</span>&nbsp;<span class="ident" id="4633939">runtime</span><span class="op" id="4633946">.</span><span class="ident" id="4633947">GOOS</span>&nbsp;<span class="op" id="4633952">==</span>&nbsp;<span class="string" id="4633955">&#34;windows&#34;</span>&nbsp;<span class="op" id="4633965">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4633969">return</span>&nbsp;<span class="ident" id="4633976">c</span><span class="op" id="4633977">.</span><span class="ident" id="4633978">systemVerify</span><span class="op" id="4633990">(</span><span class="op" id="4633991">&amp;</span><span class="ident" id="4633992">opts</span><span class="op" id="4633996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4633999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634003">if</span>&nbsp;<span class="ident" id="4634006">opts</span><span class="op" id="4634010">.</span><span class="ident" id="4634011">Roots</span>&nbsp;<span class="op" id="4634017">==</span>&nbsp;<span class="ident" id="4634020">nil</span>&nbsp;<span class="op" id="4634024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634028">opts</span><span class="op" id="4634032">.</span><span class="ident" id="4634033">Roots</span>&nbsp;<span class="op" id="4634039">=</span>&nbsp;<span class="ident" id="4634041">systemRootsPool</span><span class="op" id="4634056">(</span><span class="op" id="4634057">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634061">if</span>&nbsp;<span class="ident" id="4634064">opts</span><span class="op" id="4634068">.</span><span class="ident" id="4634069">Roots</span>&nbsp;<span class="op" id="4634075">==</span>&nbsp;<span class="ident" id="4634078">nil</span>&nbsp;<span class="op" id="4634082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634087">return</span>&nbsp;<span class="ident" id="4634094">nil</span><span class="op" id="4634097">,</span>&nbsp;<span class="ident" id="4634099">SystemRootsError</span><span class="op" id="4634115">{</span><span class="op" id="4634116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634127">err</span>&nbsp;<span class="op" id="4634131">=</span>&nbsp;<span class="ident" id="4634133">c</span><span class="op" id="4634134">.</span><span class="ident" id="4634135">isValid</span><span class="op" id="4634142">(</span><span class="ident" id="4634143">leafCertificate</span><span class="op" id="4634158">,</span>&nbsp;<span class="ident" id="4634160">nil</span><span class="op" id="4634163">,</span>&nbsp;<span class="op" id="4634165">&amp;</span><span class="ident" id="4634166">opts</span><span class="op" id="4634170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634173">if</span>&nbsp;<span class="ident" id="4634176">err</span>&nbsp;<span class="op" id="4634180">!=</span>&nbsp;<span class="ident" id="4634183">nil</span>&nbsp;<span class="op" id="4634187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634191">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634203">if</span>&nbsp;<span class="builtinfunc" id="4634206">len</span><span class="op" id="4634209">(</span><span class="ident" id="4634210">opts</span><span class="op" id="4634214">.</span><span class="ident" id="4634215">DNSName</span><span class="op" id="4634222">)</span>&nbsp;<span class="op" id="4634224">&gt;</span>&nbsp;<span class="num" id="4634226">0</span>&nbsp;<span class="op" id="4634228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634232">err</span>&nbsp;<span class="op" id="4634236">=</span>&nbsp;<span class="ident" id="4634238">c</span><span class="op" id="4634239">.</span><span class="ident" id="4634240">VerifyHostname</span><span class="op" id="4634254">(</span><span class="ident" id="4634255">opts</span><span class="op" id="4634259">.</span><span class="ident" id="4634260">DNSName</span><span class="op" id="4634267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634271">if</span>&nbsp;<span class="ident" id="4634274">err</span>&nbsp;<span class="op" id="4634278">!=</span>&nbsp;<span class="ident" id="4634281">nil</span>&nbsp;<span class="op" id="4634285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634290">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634299">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634306">candidateChains</span><span class="op" id="4634321">,</span>&nbsp;<span class="ident" id="4634323">err</span>&nbsp;<span class="op" id="4634327">:=</span>&nbsp;<span class="ident" id="4634330">c</span><span class="op" id="4634331">.</span><span class="ident" id="4634332">buildChains</span><span class="op" id="4634343">(</span><span class="builtinfunc" id="4634344">make</span><span class="op" id="4634348">(</span><span class="keyword" id="4634349">map</span><span class="op" id="4634352">[</span><span class="builtintype" id="4634353">int</span><span class="op" id="4634356">]</span><span class="op" id="4634357">[</span><span class="op" id="4634358">]</span><span class="op" id="4634359">[</span><span class="op" id="4634360">]</span><span class="op" id="4634361">*</span><span class="ident" id="4634362">Certificate</span><span class="op" id="4634373">)</span><span class="op" id="4634374">,</span>&nbsp;<span class="op" id="4634376">[</span><span class="op" id="4634377">]</span><span class="op" id="4634378">*</span><span class="ident" id="4634379">Certificate</span><span class="op" id="4634390">{</span><span class="ident" id="4634391">c</span><span class="op" id="4634392">}</span><span class="op" id="4634393">,</span>&nbsp;<span class="op" id="4634395">&amp;</span><span class="ident" id="4634396">opts</span><span class="op" id="4634400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634403">if</span>&nbsp;<span class="ident" id="4634406">err</span>&nbsp;<span class="op" id="4634410">!=</span>&nbsp;<span class="ident" id="4634413">nil</span>&nbsp;<span class="op" id="4634417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634421">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634433">keyUsages</span>&nbsp;<span class="op" id="4634443">:=</span>&nbsp;<span class="ident" id="4634446">opts</span><span class="op" id="4634450">.</span><span class="ident" id="4634451">KeyUsages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634462">if</span>&nbsp;<span class="builtinfunc" id="4634465">len</span><span class="op" id="4634468">(</span><span class="ident" id="4634469">keyUsages</span><span class="op" id="4634478">)</span>&nbsp;<span class="op" id="4634480">==</span>&nbsp;<span class="num" id="4634483">0</span>&nbsp;<span class="op" id="4634485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634489">keyUsages</span>&nbsp;<span class="op" id="4634499">=</span>&nbsp;<span class="op" id="4634501">[</span><span class="op" id="4634502">]</span><span class="ident" id="4634503">ExtKeyUsage</span><span class="op" id="4634514">{</span><span class="ident" id="4634515">ExtKeyUsageServerAuth</span><span class="op" id="4634536">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4634543">//&nbsp;If&nbsp;any&nbsp;key&nbsp;usage&nbsp;is&nbsp;acceptable&nbsp;then&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634595">for</span>&nbsp;<span class="ident" id="4634599">_</span><span class="op" id="4634600">,</span>&nbsp;<span class="ident" id="4634602">usage</span>&nbsp;<span class="op" id="4634608">:=</span>&nbsp;<span class="keyword" id="4634611">range</span>&nbsp;<span class="ident" id="4634617">keyUsages</span>&nbsp;<span class="op" id="4634627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634631">if</span>&nbsp;<span class="ident" id="4634634">usage</span>&nbsp;<span class="op" id="4634640">==</span>&nbsp;<span class="ident" id="4634643">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4634658">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634663">chains</span>&nbsp;<span class="op" id="4634670">=</span>&nbsp;<span class="ident" id="4634672">candidateChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634691">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634707">for</span>&nbsp;<span class="ident" id="4634711">_</span><span class="op" id="4634712">,</span>&nbsp;<span class="ident" id="4634714">candidate</span>&nbsp;<span class="op" id="4634724">:=</span>&nbsp;<span class="keyword" id="4634727">range</span>&nbsp;<span class="ident" id="4634733">candidateChains</span>&nbsp;<span class="op" id="4634749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634753">if</span>&nbsp;<span class="ident" id="4634756">checkChainForKeyUsage</span><span class="op" id="4634777">(</span><span class="ident" id="4634778">candidate</span><span class="op" id="4634787">,</span>&nbsp;<span class="ident" id="4634789">keyUsages</span><span class="op" id="4634798">)</span>&nbsp;<span class="op" id="4634800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634805">chains</span>&nbsp;<span class="op" id="4634812">=</span>&nbsp;<span class="builtinfunc" id="4634814">append</span><span class="op" id="4634820">(</span><span class="ident" id="4634821">chains</span><span class="op" id="4634827">,</span>&nbsp;<span class="ident" id="4634829">candidate</span><span class="op" id="4634838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634845">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634849">if</span>&nbsp;<span class="builtinfunc" id="4634852">len</span><span class="op" id="4634855">(</span><span class="ident" id="4634856">chains</span><span class="op" id="4634862">)</span>&nbsp;<span class="op" id="4634864">==</span>&nbsp;<span class="num" id="4634867">0</span>&nbsp;<span class="op" id="4634869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4634873">err</span>&nbsp;<span class="op" id="4634877">=</span>&nbsp;<span class="ident" id="4634879">CertificateInvalidError</span><span class="op" id="4634902">{</span><span class="ident" id="4634903">c</span><span class="op" id="4634904">,</span>&nbsp;<span class="ident" id="4634906">IncompatibleUsage</span><span class="op" id="4634923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4634926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4634930">return</span><br>
<span class="lineno"></span><span class="op" id="4634937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4634940">func</span>&nbsp;<span class="ident" id="4634945">appendToFreshChain</span><span class="op" id="4634963">(</span><span class="ident" id="4634964">chain</span>&nbsp;<span class="op" id="4634970">[</span><span class="op" id="4634971">]</span><span class="op" id="4634972">*</span><span class="ident" id="4634973">Certificate</span><span class="op" id="4634984">,</span>&nbsp;<span class="ident" id="4634986">cert</span>&nbsp;<span class="op" id="4634991">*</span><span class="ident" id="4634992">Certificate</span><span class="op" id="4635003">)</span>&nbsp;<span class="op" id="4635005">[</span><span class="op" id="4635006">]</span><span class="op" id="4635007">*</span><span class="ident" id="4635008">Certificate</span>&nbsp;<span class="op" id="4635020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635023">n</span>&nbsp;<span class="op" id="4635025">:=</span>&nbsp;<span class="builtinfunc" id="4635028">make</span><span class="op" id="4635032">(</span><span class="op" id="4635033">[</span><span class="op" id="4635034">]</span><span class="op" id="4635035">*</span><span class="ident" id="4635036">Certificate</span><span class="op" id="4635047">,</span>&nbsp;<span class="builtinfunc" id="4635049">len</span><span class="op" id="4635052">(</span><span class="ident" id="4635053">chain</span><span class="op" id="4635058">)</span><span class="op" id="4635059">+</span><span class="num" id="4635060">1</span><span class="op" id="4635061">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4635064">copy</span><span class="op" id="4635068">(</span><span class="ident" id="4635069">n</span><span class="op" id="4635070">,</span>&nbsp;<span class="ident" id="4635072">chain</span><span class="op" id="4635077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635080">n</span><span class="op" id="4635081">[</span><span class="builtinfunc" id="4635082">len</span><span class="op" id="4635085">(</span><span class="ident" id="4635086">chain</span><span class="op" id="4635091">)</span><span class="op" id="4635092">]</span>&nbsp;<span class="op" id="4635094">=</span>&nbsp;<span class="ident" id="4635096">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635102">return</span>&nbsp;<span class="ident" id="4635109">n</span><br>
<span class="lineno"></span><span class="op" id="4635111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="4635114">func</span>&nbsp;<span class="op" id="4635119">(</span><span class="ident" id="4635120">c</span>&nbsp;<span class="op" id="4635122">*</span><span class="ident" id="4635123">Certificate</span><span class="op" id="4635134">)</span>&nbsp;<span class="ident" id="4635136">buildChains</span><span class="op" id="4635147">(</span><span class="ident" id="4635148">cache</span>&nbsp;<span class="keyword" id="4635154">map</span><span class="op" id="4635157">[</span><span class="builtintype" id="4635158">int</span><span class="op" id="4635161">]</span><span class="op" id="4635162">[</span><span class="op" id="4635163">]</span><span class="op" id="4635164">[</span><span class="op" id="4635165">]</span><span class="op" id="4635166">*</span><span class="ident" id="4635167">Certificate</span><span class="op" id="4635178">,</span>&nbsp;<span class="ident" id="4635180">currentChain</span>&nbsp;<span class="op" id="4635193">[</span><span class="op" id="4635194">]</span><span class="op" id="4635195">*</span><span class="ident" id="4635196">Certificate</span><span class="op" id="4635207">,</span>&nbsp;<span class="ident" id="4635209">opts</span>&nbsp;<span class="op" id="4635214">*</span><span class="ident" id="4635215">VerifyOptions</span><span class="op" id="4635228">)</span>&nbsp;<span class="op" id="4635230">(</span><span class="ident" id="4635231">chains</span>&nbsp;<span class="op" id="4635238">[</span><span class="op" id="4635239">]</span><span class="op" id="4635240">[</span><span class="op" id="4635241">]</span><span class="op" id="4635242">*</span><span class="ident" id="4635243">Certificate</span><span class="op" id="4635254">,</span>&nbsp;<span class="ident" id="4635256">err</span>&nbsp;<span class="builtintype" id="4635260">error</span><span class="op" id="4635265">)</span>&nbsp;<span class="op" id="4635267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635270">possibleRoots</span><span class="op" id="4635283">,</span>&nbsp;<span class="ident" id="4635285">failedRoot</span><span class="op" id="4635295">,</span>&nbsp;<span class="ident" id="4635297">rootErr</span>&nbsp;<span class="op" id="4635305">:=</span>&nbsp;<span class="ident" id="4635308">opts</span><span class="op" id="4635312">.</span><span class="ident" id="4635313">Roots</span><span class="op" id="4635318">.</span><span class="ident" id="4635319">findVerifiedParents</span><span class="op" id="4635338">(</span><span class="ident" id="4635339">c</span><span class="op" id="4635340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635343">for</span>&nbsp;<span class="ident" id="4635347">_</span><span class="op" id="4635348">,</span>&nbsp;<span class="ident" id="4635350">rootNum</span>&nbsp;<span class="op" id="4635358">:=</span>&nbsp;<span class="keyword" id="4635361">range</span>&nbsp;<span class="ident" id="4635367">possibleRoots</span>&nbsp;<span class="op" id="4635381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635385">root</span>&nbsp;<span class="op" id="4635390">:=</span>&nbsp;<span class="ident" id="4635393">opts</span><span class="op" id="4635397">.</span><span class="ident" id="4635398">Roots</span><span class="op" id="4635403">.</span><span class="ident" id="4635404">certs</span><span class="op" id="4635409">[</span><span class="ident" id="4635410">rootNum</span><span class="op" id="4635417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635421">err</span>&nbsp;<span class="op" id="4635425">=</span>&nbsp;<span class="ident" id="4635427">root</span><span class="op" id="4635431">.</span><span class="ident" id="4635432">isValid</span><span class="op" id="4635439">(</span><span class="ident" id="4635440">rootCertificate</span><span class="op" id="4635455">,</span>&nbsp;<span class="ident" id="4635457">currentChain</span><span class="op" id="4635469">,</span>&nbsp;<span class="ident" id="4635471">opts</span><span class="op" id="4635475">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635479">if</span>&nbsp;<span class="ident" id="4635482">err</span>&nbsp;<span class="op" id="4635486">!=</span>&nbsp;<span class="ident" id="4635489">nil</span>&nbsp;<span class="op" id="4635493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635498">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635513">chains</span>&nbsp;<span class="op" id="4635520">=</span>&nbsp;<span class="builtinfunc" id="4635522">append</span><span class="op" id="4635528">(</span><span class="ident" id="4635529">chains</span><span class="op" id="4635535">,</span>&nbsp;<span class="ident" id="4635537">appendToFreshChain</span><span class="op" id="4635555">(</span><span class="ident" id="4635556">currentChain</span><span class="op" id="4635568">,</span>&nbsp;<span class="ident" id="4635570">root</span><span class="op" id="4635574">)</span><span class="op" id="4635575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635578">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635582">possibleIntermediates</span><span class="op" id="4635603">,</span>&nbsp;<span class="ident" id="4635605">failedIntermediate</span><span class="op" id="4635623">,</span>&nbsp;<span class="ident" id="4635625">intermediateErr</span>&nbsp;<span class="op" id="4635641">:=</span>&nbsp;<span class="ident" id="4635644">opts</span><span class="op" id="4635648">.</span><span class="ident" id="4635649">Intermediates</span><span class="op" id="4635662">.</span><span class="ident" id="4635663">findVerifiedParents</span><span class="op" id="4635682">(</span><span class="ident" id="4635683">c</span><span class="op" id="4635684">)</span><br>
<span class="lineno"></span><span class="ident" id="4635686">nextIntermediate</span><span class="op" id="4635702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635705">for</span>&nbsp;<span class="ident" id="4635709">_</span><span class="op" id="4635710">,</span>&nbsp;<span class="ident" id="4635712">intermediateNum</span>&nbsp;<span class="op" id="4635728">:=</span>&nbsp;<span class="keyword" id="4635731">range</span>&nbsp;<span class="ident" id="4635737">possibleIntermediates</span>&nbsp;<span class="op" id="4635759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635763">intermediate</span>&nbsp;<span class="op" id="4635776">:=</span>&nbsp;<span class="ident" id="4635779">opts</span><span class="op" id="4635783">.</span><span class="ident" id="4635784">Intermediates</span><span class="op" id="4635797">.</span><span class="ident" id="4635798">certs</span><span class="op" id="4635803">[</span><span class="ident" id="4635804">intermediateNum</span><span class="op" id="4635819">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635823">for</span>&nbsp;<span class="ident" id="4635827">_</span><span class="op" id="4635828">,</span>&nbsp;<span class="ident" id="4635830">cert</span>&nbsp;<span class="op" id="4635835">:=</span>&nbsp;<span class="keyword" id="4635838">range</span>&nbsp;<span class="ident" id="4635844">currentChain</span>&nbsp;<span class="op" id="4635857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635862">if</span>&nbsp;<span class="ident" id="4635865">cert</span>&nbsp;<span class="op" id="4635870">==</span>&nbsp;<span class="ident" id="4635873">intermediate</span>&nbsp;<span class="op" id="4635886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4635892">continue</span>&nbsp;<span class="ident" id="4635901">nextIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4635925">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4635929">err</span>&nbsp;<span class="op" id="4635933">=</span>&nbsp;<span class="ident" id="4635935">intermediate</span><span class="op" id="4635947">.</span><span class="ident" id="4635948">isValid</span><span class="op" id="4635955">(</span><span class="ident" id="4635956">intermediateCertificate</span><span class="op" id="4635979">,</span>&nbsp;<span class="ident" id="4635981">currentChain</span><span class="op" id="4635993">,</span>&nbsp;<span class="ident" id="4635995">opts</span><span class="op" id="4635999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636003">if</span>&nbsp;<span class="ident" id="4636006">err</span>&nbsp;<span class="op" id="4636010">!=</span>&nbsp;<span class="ident" id="4636013">nil</span>&nbsp;<span class="op" id="4636017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636022">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636037">var</span>&nbsp;<span class="ident" id="4636041">childChains</span>&nbsp;<span class="op" id="4636053">[</span><span class="op" id="4636054">]</span><span class="op" id="4636055">[</span><span class="op" id="4636056">]</span><span class="op" id="4636057">*</span><span class="ident" id="4636058">Certificate</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636072">childChains</span><span class="op" id="4636083">,</span>&nbsp;<span class="ident" id="4636085">ok</span>&nbsp;<span class="op" id="4636088">:=</span>&nbsp;<span class="ident" id="4636091">cache</span><span class="op" id="4636096">[</span><span class="ident" id="4636097">intermediateNum</span><span class="op" id="4636112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636116">if</span>&nbsp;<span class="op" id="4636119">!</span><span class="ident" id="4636120">ok</span>&nbsp;<span class="op" id="4636123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636128">childChains</span><span class="op" id="4636139">,</span>&nbsp;<span class="ident" id="4636141">err</span>&nbsp;<span class="op" id="4636145">=</span>&nbsp;<span class="ident" id="4636147">intermediate</span><span class="op" id="4636159">.</span><span class="ident" id="4636160">buildChains</span><span class="op" id="4636171">(</span><span class="ident" id="4636172">cache</span><span class="op" id="4636177">,</span>&nbsp;<span class="ident" id="4636179">appendToFreshChain</span><span class="op" id="4636197">(</span><span class="ident" id="4636198">currentChain</span><span class="op" id="4636210">,</span>&nbsp;<span class="ident" id="4636212">intermediate</span><span class="op" id="4636224">)</span><span class="op" id="4636225">,</span>&nbsp;<span class="ident" id="4636227">opts</span><span class="op" id="4636231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636236">cache</span><span class="op" id="4636241">[</span><span class="ident" id="4636242">intermediateNum</span><span class="op" id="4636257">]</span>&nbsp;<span class="op" id="4636259">=</span>&nbsp;<span class="ident" id="4636261">childChains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636275">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636279">chains</span>&nbsp;<span class="op" id="4636286">=</span>&nbsp;<span class="builtinfunc" id="4636288">append</span><span class="op" id="4636294">(</span><span class="ident" id="4636295">chains</span><span class="op" id="4636301">,</span>&nbsp;<span class="ident" id="4636303">childChains</span><span class="op" id="4636314">...</span><span class="op" id="4636317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636324">if</span>&nbsp;<span class="builtinfunc" id="4636327">len</span><span class="op" id="4636330">(</span><span class="ident" id="4636331">chains</span><span class="op" id="4636337">)</span>&nbsp;<span class="op" id="4636339">&gt;</span>&nbsp;<span class="num" id="4636341">0</span>&nbsp;<span class="op" id="4636343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636347">err</span>&nbsp;<span class="op" id="4636351">=</span>&nbsp;<span class="ident" id="4636353">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636362">if</span>&nbsp;<span class="builtinfunc" id="4636365">len</span><span class="op" id="4636368">(</span><span class="ident" id="4636369">chains</span><span class="op" id="4636375">)</span>&nbsp;<span class="op" id="4636377">==</span>&nbsp;<span class="num" id="4636380">0</span>&nbsp;<span class="op" id="4636382">&amp;&amp;</span>&nbsp;<span class="ident" id="4636385">err</span>&nbsp;<span class="op" id="4636389">==</span>&nbsp;<span class="ident" id="4636392">nil</span>&nbsp;<span class="op" id="4636396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636400">hintErr</span>&nbsp;<span class="op" id="4636408">:=</span>&nbsp;<span class="ident" id="4636411">rootErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636421">hintCert</span>&nbsp;<span class="op" id="4636430">:=</span>&nbsp;<span class="ident" id="4636433">failedRoot</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636446">if</span>&nbsp;<span class="ident" id="4636449">hintErr</span>&nbsp;<span class="op" id="4636457">==</span>&nbsp;<span class="ident" id="4636460">nil</span>&nbsp;<span class="op" id="4636464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636469">hintErr</span>&nbsp;<span class="op" id="4636477">=</span>&nbsp;<span class="ident" id="4636479">intermediateErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636498">hintCert</span>&nbsp;<span class="op" id="4636507">=</span>&nbsp;<span class="ident" id="4636509">failedIntermediate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636534">err</span>&nbsp;<span class="op" id="4636538">=</span>&nbsp;<span class="ident" id="4636540">UnknownAuthorityError</span><span class="op" id="4636561">{</span><span class="ident" id="4636562">c</span><span class="op" id="4636563">,</span>&nbsp;<span class="ident" id="4636565">hintErr</span><span class="op" id="4636572">,</span>&nbsp;<span class="ident" id="4636574">hintCert</span><span class="op" id="4636582">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636589">return</span><br>
<span class="lineno"></span><span class="op" id="4636596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="4636599">func</span>&nbsp;<span class="ident" id="4636604">matchHostnames</span><span class="op" id="4636618">(</span><span class="ident" id="4636619">pattern</span><span class="op" id="4636626">,</span>&nbsp;<span class="ident" id="4636628">host</span>&nbsp;<span class="builtintype" id="4636633">string</span><span class="op" id="4636639">)</span>&nbsp;<span class="builtintype" id="4636641">bool</span>&nbsp;<span class="op" id="4636646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636649">if</span>&nbsp;<span class="builtinfunc" id="4636652">len</span><span class="op" id="4636655">(</span><span class="ident" id="4636656">pattern</span><span class="op" id="4636663">)</span>&nbsp;<span class="op" id="4636665">==</span>&nbsp;<span class="num" id="4636668">0</span>&nbsp;<span class="op" id="4636670">||</span>&nbsp;<span class="builtinfunc" id="4636673">len</span><span class="op" id="4636676">(</span><span class="ident" id="4636677">host</span><span class="op" id="4636681">)</span>&nbsp;<span class="op" id="4636683">==</span>&nbsp;<span class="num" id="4636686">0</span>&nbsp;<span class="op" id="4636688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636692">return</span>&nbsp;<span class="builtintype" id="4636699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636710">patternParts</span>&nbsp;<span class="op" id="4636723">:=</span>&nbsp;<span class="ident" id="4636726">strings</span><span class="op" id="4636733">.</span><span class="ident" id="4636734">Split</span><span class="op" id="4636739">(</span><span class="ident" id="4636740">pattern</span><span class="op" id="4636747">,</span>&nbsp;<span class="string" id="4636749">&#34;.&#34;</span><span class="op" id="4636752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4636755">hostParts</span>&nbsp;<span class="op" id="4636765">:=</span>&nbsp;<span class="ident" id="4636768">strings</span><span class="op" id="4636775">.</span><span class="ident" id="4636776">Split</span><span class="op" id="4636781">(</span><span class="ident" id="4636782">host</span><span class="op" id="4636786">,</span>&nbsp;<span class="string" id="4636788">&#34;.&#34;</span><span class="op" id="4636791">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636795">if</span>&nbsp;<span class="builtinfunc" id="4636798">len</span><span class="op" id="4636801">(</span><span class="ident" id="4636802">patternParts</span><span class="op" id="4636814">)</span>&nbsp;<span class="op" id="4636816">!=</span>&nbsp;<span class="builtinfunc" id="4636819">len</span><span class="op" id="4636822">(</span><span class="ident" id="4636823">hostParts</span><span class="op" id="4636832">)</span>&nbsp;<span class="op" id="4636834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636838">return</span>&nbsp;<span class="builtintype" id="4636845">false</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636856">for</span>&nbsp;<span class="ident" id="4636860">i</span><span class="op" id="4636861">,</span>&nbsp;<span class="ident" id="4636863">patternPart</span>&nbsp;<span class="op" id="4636875">:=</span>&nbsp;<span class="keyword" id="4636878">range</span>&nbsp;<span class="ident" id="4636884">patternParts</span>&nbsp;<span class="op" id="4636897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636901">if</span>&nbsp;<span class="ident" id="4636904">patternPart</span>&nbsp;<span class="op" id="4636916">==</span>&nbsp;<span class="string" id="4636919">&#34;*&#34;</span>&nbsp;<span class="op" id="4636923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636928">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636943">if</span>&nbsp;<span class="ident" id="4636946">patternPart</span>&nbsp;<span class="op" id="4636958">!=</span>&nbsp;<span class="ident" id="4636961">hostParts</span><span class="op" id="4636970">[</span><span class="ident" id="4636971">i</span><span class="op" id="4636972">]</span>&nbsp;<span class="op" id="4636974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4636979">return</span>&nbsp;<span class="builtintype" id="4636986">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4636997">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637001">return</span>&nbsp;<span class="builtintype" id="4637008">true</span><br>
<span class="lineno"></span><span class="op" id="4637013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4637016">//&nbsp;toLowerCaseASCII&nbsp;returns&nbsp;a&nbsp;lower-case&nbsp;version&nbsp;of&nbsp;in.&nbsp;See&nbsp;RFC&nbsp;6125&nbsp;6.4.1.&nbsp;We&nbsp;use</span><br>
<span class="lineno">350</span><span class="comment" id="4637099">//&nbsp;an&nbsp;explicitly&nbsp;ASCII&nbsp;function&nbsp;to&nbsp;avoid&nbsp;any&nbsp;sharp&nbsp;corners&nbsp;resulting&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4637173">//&nbsp;performing&nbsp;Unicode&nbsp;operations&nbsp;on&nbsp;DNS&nbsp;labels.</span><br>
<span class="lineno"></span><span class="keyword" id="4637221">func</span>&nbsp;<span class="ident" id="4637226">toLowerCaseASCII</span><span class="op" id="4637242">(</span><span class="ident" id="4637243">in</span>&nbsp;<span class="builtintype" id="4637246">string</span><span class="op" id="4637252">)</span>&nbsp;<span class="builtintype" id="4637254">string</span>&nbsp;<span class="op" id="4637261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637264">//&nbsp;If&nbsp;the&nbsp;string&nbsp;is&nbsp;already&nbsp;lower-case&nbsp;then&nbsp;there&#39;s&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637332">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4637351">:=</span>&nbsp;<span class="builtintype" id="4637354">true</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637360">for</span>&nbsp;<span class="ident" id="4637364">_</span><span class="op" id="4637365">,</span>&nbsp;<span class="ident" id="4637367">c</span>&nbsp;<span class="op" id="4637369">:=</span>&nbsp;<span class="keyword" id="4637372">range</span>&nbsp;<span class="ident" id="4637378">in</span>&nbsp;<span class="op" id="4637381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637385">if</span>&nbsp;<span class="ident" id="4637388">c</span>&nbsp;<span class="op" id="4637390">==</span>&nbsp;<span class="ident" id="4637393">utf8</span><span class="op" id="4637397">.</span><span class="ident" id="4637398">RuneError</span>&nbsp;<span class="op" id="4637408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637413">//&nbsp;If&nbsp;we&nbsp;get&nbsp;a&nbsp;UTF-8&nbsp;error&nbsp;then&nbsp;there&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637463">//&nbsp;upper-case&nbsp;ASCII&nbsp;bytes&nbsp;in&nbsp;the&nbsp;invalid&nbsp;sequence.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637517">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4637536">=</span>&nbsp;<span class="builtintype" id="4637538">false</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637547">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637559">if</span>&nbsp;<span class="string" id="4637562">&#39;A&#39;</span>&nbsp;<span class="op" id="4637566">&lt;=</span>&nbsp;<span class="ident" id="4637569">c</span>&nbsp;<span class="op" id="4637571">&amp;&amp;</span>&nbsp;<span class="ident" id="4637574">c</span>&nbsp;<span class="op" id="4637576">&lt;=</span>&nbsp;<span class="string" id="4637579">&#39;Z&#39;</span>&nbsp;<span class="op" id="4637583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637588">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4637607">=</span>&nbsp;<span class="builtintype" id="4637609">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637618">break</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637633">if</span>&nbsp;<span class="ident" id="4637636">isAlreadyLowerCase</span>&nbsp;<span class="op" id="4637655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637659">return</span>&nbsp;<span class="ident" id="4637666">in</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637674">out</span>&nbsp;<span class="op" id="4637678">:=</span>&nbsp;<span class="op" id="4637681">[</span><span class="op" id="4637682">]</span><span class="builtintype" id="4637683">byte</span><span class="op" id="4637687">(</span><span class="ident" id="4637688">in</span><span class="op" id="4637690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637693">for</span>&nbsp;<span class="ident" id="4637697">i</span><span class="op" id="4637698">,</span>&nbsp;<span class="ident" id="4637700">c</span>&nbsp;<span class="op" id="4637702">:=</span>&nbsp;<span class="keyword" id="4637705">range</span>&nbsp;<span class="ident" id="4637711">out</span>&nbsp;<span class="op" id="4637715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637719">if</span>&nbsp;<span class="string" id="4637722">&#39;A&#39;</span>&nbsp;<span class="op" id="4637726">&lt;=</span>&nbsp;<span class="ident" id="4637729">c</span>&nbsp;<span class="op" id="4637731">&amp;&amp;</span>&nbsp;<span class="ident" id="4637734">c</span>&nbsp;<span class="op" id="4637736">&lt;=</span>&nbsp;<span class="string" id="4637739">&#39;Z&#39;</span>&nbsp;<span class="op" id="4637743">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4637748">out</span><span class="op" id="4637751">[</span><span class="ident" id="4637752">i</span><span class="op" id="4637753">]</span>&nbsp;<span class="op" id="4637755">+=</span>&nbsp;<span class="string" id="4637758">&#39;a&#39;</span>&nbsp;<span class="op" id="4637762">-</span>&nbsp;<span class="string" id="4637764">&#39;A&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4637773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4637776">return</span>&nbsp;<span class="builtintype" id="4637783">string</span><span class="op" id="4637789">(</span><span class="ident" id="4637790">out</span><span class="op" id="4637793">)</span><br>
<span class="lineno"></span><span class="op" id="4637795">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="4637798">//&nbsp;VerifyHostname&nbsp;returns&nbsp;nil&nbsp;if&nbsp;c&nbsp;is&nbsp;a&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;the&nbsp;named&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4637876">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error&nbsp;describing&nbsp;the&nbsp;mismatch.</span><br>
<span class="lineno"></span><span class="keyword" id="4637934">func</span>&nbsp;<span class="op" id="4637939">(</span><span class="ident" id="4637940">c</span>&nbsp;<span class="op" id="4637942">*</span><span class="ident" id="4637943">Certificate</span><span class="op" id="4637954">)</span>&nbsp;<span class="ident" id="4637956">VerifyHostname</span><span class="op" id="4637970">(</span><span class="ident" id="4637971">h</span>&nbsp;<span class="builtintype" id="4637973">string</span><span class="op" id="4637979">)</span>&nbsp;<span class="builtintype" id="4637981">error</span>&nbsp;<span class="op" id="4637987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4637990">//&nbsp;IP&nbsp;addresses&nbsp;may&nbsp;be&nbsp;written&nbsp;in&nbsp;[&nbsp;].</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638030">candidateIP</span>&nbsp;<span class="op" id="4638042">:=</span>&nbsp;<span class="ident" id="4638045">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638048">if</span>&nbsp;<span class="builtinfunc" id="4638051">len</span><span class="op" id="4638054">(</span><span class="ident" id="4638055">h</span><span class="op" id="4638056">)</span>&nbsp;<span class="op" id="4638058">&gt;=</span>&nbsp;<span class="num" id="4638061">3</span>&nbsp;<span class="op" id="4638063">&amp;&amp;</span>&nbsp;<span class="ident" id="4638066">h</span><span class="op" id="4638067">[</span><span class="num" id="4638068">0</span><span class="op" id="4638069">]</span>&nbsp;<span class="op" id="4638071">==</span>&nbsp;<span class="string" id="4638074">&#39;[&#39;</span>&nbsp;<span class="op" id="4638078">&amp;&amp;</span>&nbsp;<span class="ident" id="4638081">h</span><span class="op" id="4638082">[</span><span class="builtinfunc" id="4638083">len</span><span class="op" id="4638086">(</span><span class="ident" id="4638087">h</span><span class="op" id="4638088">)</span><span class="op" id="4638089">-</span><span class="num" id="4638090">1</span><span class="op" id="4638091">]</span>&nbsp;<span class="op" id="4638093">==</span>&nbsp;<span class="string" id="4638096">&#39;]&#39;</span>&nbsp;<span class="op" id="4638100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638104">candidateIP</span>&nbsp;<span class="op" id="4638116">=</span>&nbsp;<span class="ident" id="4638118">h</span><span class="op" id="4638119">[</span><span class="num" id="4638120">1</span>&nbsp;<span class="op" id="4638122">:</span>&nbsp;<span class="builtinfunc" id="4638124">len</span><span class="op" id="4638127">(</span><span class="ident" id="4638128">h</span><span class="op" id="4638129">)</span><span class="op" id="4638130">-</span><span class="num" id="4638131">1</span><span class="op" id="4638132">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638138">if</span>&nbsp;<span class="ident" id="4638141">ip</span>&nbsp;<span class="op" id="4638144">:=</span>&nbsp;<span class="ident" id="4638147">net</span><span class="op" id="4638150">.</span><span class="ident" id="4638151">ParseIP</span><span class="op" id="4638158">(</span><span class="ident" id="4638159">candidateIP</span><span class="op" id="4638170">)</span><span class="op" id="4638171">;</span>&nbsp;<span class="ident" id="4638173">ip</span>&nbsp;<span class="op" id="4638176">!=</span>&nbsp;<span class="ident" id="4638179">nil</span>&nbsp;<span class="op" id="4638183">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638187">//&nbsp;We&nbsp;only&nbsp;match&nbsp;IP&nbsp;addresses&nbsp;against&nbsp;IP&nbsp;SANs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638236">//&nbsp;https://tools.ietf.org/html/rfc6125#appendix-B.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638290">for</span>&nbsp;<span class="ident" id="4638294">_</span><span class="op" id="4638295">,</span>&nbsp;<span class="ident" id="4638297">candidate</span>&nbsp;<span class="op" id="4638307">:=</span>&nbsp;<span class="keyword" id="4638310">range</span>&nbsp;<span class="ident" id="4638316">c</span><span class="op" id="4638317">.</span><span class="ident" id="4638318">IPAddresses</span>&nbsp;<span class="op" id="4638330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638335">if</span>&nbsp;<span class="ident" id="4638338">ip</span><span class="op" id="4638340">.</span><span class="ident" id="4638341">Equal</span><span class="op" id="4638346">(</span><span class="ident" id="4638347">candidate</span><span class="op" id="4638356">)</span>&nbsp;<span class="op" id="4638358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638364">return</span>&nbsp;<span class="ident" id="4638371">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638386">return</span>&nbsp;<span class="ident" id="4638393">HostnameError</span><span class="op" id="4638406">{</span><span class="ident" id="4638407">c</span><span class="op" id="4638408">,</span>&nbsp;<span class="ident" id="4638410">candidateIP</span><span class="op" id="4638421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638428">lowered</span>&nbsp;<span class="op" id="4638436">:=</span>&nbsp;<span class="ident" id="4638439">toLowerCaseASCII</span><span class="op" id="4638455">(</span><span class="ident" id="4638456">h</span><span class="op" id="4638457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638461">if</span>&nbsp;<span class="builtinfunc" id="4638464">len</span><span class="op" id="4638467">(</span><span class="ident" id="4638468">c</span><span class="op" id="4638469">.</span><span class="ident" id="4638470">DNSNames</span><span class="op" id="4638478">)</span>&nbsp;<span class="op" id="4638480">&gt;</span>&nbsp;<span class="num" id="4638482">0</span>&nbsp;<span class="op" id="4638484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638488">for</span>&nbsp;<span class="ident" id="4638492">_</span><span class="op" id="4638493">,</span>&nbsp;<span class="ident" id="4638495">match</span>&nbsp;<span class="op" id="4638501">:=</span>&nbsp;<span class="keyword" id="4638504">range</span>&nbsp;<span class="ident" id="4638510">c</span><span class="op" id="4638511">.</span><span class="ident" id="4638512">DNSNames</span>&nbsp;<span class="op" id="4638521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638526">if</span>&nbsp;<span class="ident" id="4638529">matchHostnames</span><span class="op" id="4638543">(</span><span class="ident" id="4638544">toLowerCaseASCII</span><span class="op" id="4638560">(</span><span class="ident" id="4638561">match</span><span class="op" id="4638566">)</span><span class="op" id="4638567">,</span>&nbsp;<span class="ident" id="4638569">lowered</span><span class="op" id="4638576">)</span>&nbsp;<span class="op" id="4638578">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638584">return</span>&nbsp;<span class="ident" id="4638591">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4638606">//&nbsp;If&nbsp;Subject&nbsp;Alt&nbsp;Name&nbsp;is&nbsp;given,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;common&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638667">}</span>&nbsp;<span class="keyword" id="4638669">else</span>&nbsp;<span class="keyword" id="4638674">if</span>&nbsp;<span class="ident" id="4638677">matchHostnames</span><span class="op" id="4638691">(</span><span class="ident" id="4638692">toLowerCaseASCII</span><span class="op" id="4638708">(</span><span class="ident" id="4638709">c</span><span class="op" id="4638710">.</span><span class="ident" id="4638711">Subject</span><span class="op" id="4638718">.</span><span class="ident" id="4638719">CommonName</span><span class="op" id="4638729">)</span><span class="op" id="4638730">,</span>&nbsp;<span class="ident" id="4638732">lowered</span><span class="op" id="4638739">)</span>&nbsp;<span class="op" id="4638741">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638745">return</span>&nbsp;<span class="ident" id="4638752">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638761">return</span>&nbsp;<span class="ident" id="4638768">HostnameError</span><span class="op" id="4638781">{</span><span class="ident" id="4638782">c</span><span class="op" id="4638783">,</span>&nbsp;<span class="ident" id="4638785">h</span><span class="op" id="4638786">}</span><br>
<span class="lineno"></span><span class="op" id="4638788">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="4638791">func</span>&nbsp;<span class="ident" id="4638796">checkChainForKeyUsage</span><span class="op" id="4638817">(</span><span class="ident" id="4638818">chain</span>&nbsp;<span class="op" id="4638824">[</span><span class="op" id="4638825">]</span><span class="op" id="4638826">*</span><span class="ident" id="4638827">Certificate</span><span class="op" id="4638838">,</span>&nbsp;<span class="ident" id="4638840">keyUsages</span>&nbsp;<span class="op" id="4638850">[</span><span class="op" id="4638851">]</span><span class="ident" id="4638852">ExtKeyUsage</span><span class="op" id="4638863">)</span>&nbsp;<span class="builtintype" id="4638865">bool</span>&nbsp;<span class="op" id="4638870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638873">usages</span>&nbsp;<span class="op" id="4638880">:=</span>&nbsp;<span class="builtinfunc" id="4638883">make</span><span class="op" id="4638887">(</span><span class="op" id="4638888">[</span><span class="op" id="4638889">]</span><span class="ident" id="4638890">ExtKeyUsage</span><span class="op" id="4638901">,</span>&nbsp;<span class="builtinfunc" id="4638903">len</span><span class="op" id="4638906">(</span><span class="ident" id="4638907">keyUsages</span><span class="op" id="4638916">)</span><span class="op" id="4638917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4638920">copy</span><span class="op" id="4638924">(</span><span class="ident" id="4638925">usages</span><span class="op" id="4638931">,</span>&nbsp;<span class="ident" id="4638933">keyUsages</span><span class="op" id="4638942">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638946">if</span>&nbsp;<span class="builtinfunc" id="4638949">len</span><span class="op" id="4638952">(</span><span class="ident" id="4638953">chain</span><span class="op" id="4638958">)</span>&nbsp;<span class="op" id="4638960">==</span>&nbsp;<span class="num" id="4638963">0</span>&nbsp;<span class="op" id="4638965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4638969">return</span>&nbsp;<span class="builtintype" id="4638976">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4638983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4638987">usagesRemaining</span>&nbsp;<span class="op" id="4639003">:=</span>&nbsp;<span class="builtinfunc" id="4639006">len</span><span class="op" id="4639009">(</span><span class="ident" id="4639010">usages</span><span class="op" id="4639016">)</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639020">//&nbsp;We&nbsp;walk&nbsp;down&nbsp;the&nbsp;list&nbsp;and&nbsp;cross&nbsp;out&nbsp;any&nbsp;usages&nbsp;that&nbsp;aren&#39;t&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639093">//&nbsp;by&nbsp;each&nbsp;certificate.&nbsp;If&nbsp;we&nbsp;cross&nbsp;out&nbsp;all&nbsp;the&nbsp;usages,&nbsp;then&nbsp;the&nbsp;chain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639165">//&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="ident" id="4639186">NextCert</span><span class="op" id="4639194">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639197">for</span>&nbsp;<span class="ident" id="4639201">i</span>&nbsp;<span class="op" id="4639203">:=</span>&nbsp;<span class="builtinfunc" id="4639206">len</span><span class="op" id="4639209">(</span><span class="ident" id="4639210">chain</span><span class="op" id="4639215">)</span>&nbsp;<span class="op" id="4639217">-</span>&nbsp;<span class="num" id="4639219">1</span><span class="op" id="4639220">;</span>&nbsp;<span class="ident" id="4639222">i</span>&nbsp;<span class="op" id="4639224">&gt;=</span>&nbsp;<span class="num" id="4639227">0</span><span class="op" id="4639228">;</span>&nbsp;<span class="ident" id="4639230">i</span><span class="op" id="4639231">--</span>&nbsp;<span class="op" id="4639234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639238">cert</span>&nbsp;<span class="op" id="4639243">:=</span>&nbsp;<span class="ident" id="4639246">chain</span><span class="op" id="4639251">[</span><span class="ident" id="4639252">i</span><span class="op" id="4639253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639257">if</span>&nbsp;<span class="builtinfunc" id="4639260">len</span><span class="op" id="4639263">(</span><span class="ident" id="4639264">cert</span><span class="op" id="4639268">.</span><span class="ident" id="4639269">ExtKeyUsage</span><span class="op" id="4639280">)</span>&nbsp;<span class="op" id="4639282">==</span>&nbsp;<span class="num" id="4639285">0</span>&nbsp;<span class="op" id="4639287">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4639290">len</span><span class="op" id="4639293">(</span><span class="ident" id="4639294">cert</span><span class="op" id="4639298">.</span><span class="ident" id="4639299">UnknownExtKeyUsage</span><span class="op" id="4639317">)</span>&nbsp;<span class="op" id="4639319">==</span>&nbsp;<span class="num" id="4639322">0</span>&nbsp;<span class="op" id="4639324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639329">//&nbsp;The&nbsp;certificate&nbsp;doesn&#39;t&nbsp;have&nbsp;any&nbsp;extended&nbsp;key&nbsp;usage&nbsp;specified.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639398">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639414">for</span>&nbsp;<span class="ident" id="4639418">_</span><span class="op" id="4639419">,</span>&nbsp;<span class="ident" id="4639421">usage</span>&nbsp;<span class="op" id="4639427">:=</span>&nbsp;<span class="keyword" id="4639430">range</span>&nbsp;<span class="ident" id="4639436">cert</span><span class="op" id="4639440">.</span><span class="ident" id="4639441">ExtKeyUsage</span>&nbsp;<span class="op" id="4639453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639458">if</span>&nbsp;<span class="ident" id="4639461">usage</span>&nbsp;<span class="op" id="4639467">==</span>&nbsp;<span class="ident" id="4639470">ExtKeyUsageAny</span>&nbsp;<span class="op" id="4639485">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4639491">//&nbsp;The&nbsp;certificate&nbsp;is&nbsp;explicitly&nbsp;good&nbsp;for&nbsp;any&nbsp;usage.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639548">continue</span>&nbsp;<span class="ident" id="4639557">NextCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639578">const</span>&nbsp;<span class="ident" id="4639584">invalidUsage</span>&nbsp;<span class="ident" id="4639597">ExtKeyUsage</span>&nbsp;<span class="op" id="4639609">=</span>&nbsp;<span class="op" id="4639611">-</span><span class="num" id="4639612">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639616">NextRequestedUsage</span><span class="op" id="4639634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639638">for</span>&nbsp;<span class="ident" id="4639642">i</span><span class="op" id="4639643">,</span>&nbsp;<span class="ident" id="4639645">requestedUsage</span>&nbsp;<span class="op" id="4639660">:=</span>&nbsp;<span class="keyword" id="4639663">range</span>&nbsp;<span class="ident" id="4639669">usages</span>&nbsp;<span class="op" id="4639676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639681">if</span>&nbsp;<span class="ident" id="4639684">requestedUsage</span>&nbsp;<span class="op" id="4639699">==</span>&nbsp;<span class="ident" id="4639702">invalidUsage</span>&nbsp;<span class="op" id="4639715">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639721">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639739">for</span>&nbsp;<span class="ident" id="4639743">_</span><span class="op" id="4639744">,</span>&nbsp;<span class="ident" id="4639746">usage</span>&nbsp;<span class="op" id="4639752">:=</span>&nbsp;<span class="keyword" id="4639755">range</span>&nbsp;<span class="ident" id="4639761">cert</span><span class="op" id="4639765">.</span><span class="ident" id="4639766">ExtKeyUsage</span>&nbsp;<span class="op" id="4639778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639784">if</span>&nbsp;<span class="ident" id="4639787">requestedUsage</span>&nbsp;<span class="op" id="4639802">==</span>&nbsp;<span class="ident" id="4639805">usage</span>&nbsp;<span class="op" id="4639811">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639818">continue</span>&nbsp;<span class="ident" id="4639827">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639850">}</span>&nbsp;<span class="keyword" id="4639852">else</span>&nbsp;<span class="keyword" id="4639857">if</span>&nbsp;<span class="ident" id="4639860">requestedUsage</span>&nbsp;<span class="op" id="4639875">==</span>&nbsp;<span class="ident" id="4639878">ExtKeyUsageServerAuth</span>&nbsp;<span class="op" id="4639900">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639908">(</span><span class="ident" id="4639909">usage</span>&nbsp;<span class="op" id="4639915">==</span>&nbsp;<span class="ident" id="4639918">ExtKeyUsageNetscapeServerGatedCrypto</span>&nbsp;<span class="op" id="4639955">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639964">usage</span>&nbsp;<span class="op" id="4639970">==</span>&nbsp;<span class="ident" id="4639973">ExtKeyUsageMicrosoftServerGatedCrypto</span><span class="op" id="4640010">)</span>&nbsp;<span class="op" id="4640012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640019">//&nbsp;In&nbsp;order&nbsp;to&nbsp;support&nbsp;COMODO</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640054">//&nbsp;certificate&nbsp;chains,&nbsp;we&nbsp;have&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640093">//&nbsp;accept&nbsp;Netscape&nbsp;or&nbsp;Microsoft&nbsp;SGC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4640134">//&nbsp;usages&nbsp;as&nbsp;equal&nbsp;to&nbsp;ServerAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640173">continue</span>&nbsp;<span class="ident" id="4640182">NextRequestedUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640205">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640216">usages</span><span class="op" id="4640222">[</span><span class="ident" id="4640223">i</span><span class="op" id="4640224">]</span>&nbsp;<span class="op" id="4640226">=</span>&nbsp;<span class="ident" id="4640228">invalidUsage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640244">usagesRemaining</span><span class="op" id="4640259">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640265">if</span>&nbsp;<span class="ident" id="4640268">usagesRemaining</span>&nbsp;<span class="op" id="4640284">==</span>&nbsp;<span class="num" id="4640287">0</span>&nbsp;<span class="op" id="4640289">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640295">return</span>&nbsp;<span class="builtintype" id="4640302">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640322">return</span>&nbsp;<span class="builtintype" id="4640329">true</span><br>
<span class="lineno"></span><span class="op" id="4640334">}</span>
</div>
</body>
</html>
