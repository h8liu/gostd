<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7997088">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7997144">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7997198">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7997249">package</span>&nbsp;<span class="ident" id="7997257">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7997262">import</span>&nbsp;<span class="op" id="7997269">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7997272">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7997283">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7997294">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7997305">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7997316">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7997323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7997326">func</span>&nbsp;<span class="ident" id="7997331">TestResolveUDPAddr</span><span class="op" id="7997349">(</span><span class="ident" id="7997350">t</span>&nbsp;<span class="op" id="7997352">*</span><span class="ident" id="7997353">testing</span><span class="op" id="7997360">.</span><span class="ident" id="7997361">T</span><span class="op" id="7997362">)</span>&nbsp;<span class="op" id="7997364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997367">for</span>&nbsp;<span class="ident" id="7997371">_</span><span class="op" id="7997372">,</span>&nbsp;<span class="ident" id="7997374">tt</span>&nbsp;<span class="op" id="7997377">:=</span>&nbsp;<span class="keyword" id="7997380">range</span>&nbsp;<span class="ident" id="7997386">resolveTCPAddrTests</span>&nbsp;<span class="op" id="7997406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997410">net</span>&nbsp;<span class="op" id="7997414">:=</span>&nbsp;<span class="ident" id="7997417">strings</span><span class="op" id="7997424">.</span><span class="ident" id="7997425">Replace</span><span class="op" id="7997432">(</span><span class="ident" id="7997433">tt</span><span class="op" id="7997435">.</span><span class="ident" id="7997436">net</span><span class="op" id="7997439">,</span>&nbsp;<span class="string" id="7997441">&#34;tcp&#34;</span><span class="op" id="7997446">,</span>&nbsp;<span class="string" id="7997448">&#34;udp&#34;</span><span class="op" id="7997453">,</span>&nbsp;<span class="op" id="7997455">-</span><span class="num" id="7997456">1</span><span class="op" id="7997457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997461">addr</span><span class="op" id="7997465">,</span>&nbsp;<span class="ident" id="7997467">err</span>&nbsp;<span class="op" id="7997471">:=</span>&nbsp;<span class="ident" id="7997474">ResolveUDPAddr</span><span class="op" id="7997488">(</span><span class="ident" id="7997489">net</span><span class="op" id="7997492">,</span>&nbsp;<span class="ident" id="7997494">tt</span><span class="op" id="7997496">.</span><span class="ident" id="7997497">litAddrOrName</span><span class="op" id="7997510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997514">if</span>&nbsp;<span class="ident" id="7997517">err</span>&nbsp;<span class="op" id="7997521">!=</span>&nbsp;<span class="ident" id="7997524">tt</span><span class="op" id="7997526">.</span><span class="ident" id="7997527">err</span>&nbsp;<span class="op" id="7997531">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997536">t</span><span class="op" id="7997537">.</span><span class="ident" id="7997538">Fatalf</span><span class="op" id="7997544">(</span><span class="string" id="7997545">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7997580">,</span>&nbsp;<span class="ident" id="7997582">net</span><span class="op" id="7997585">,</span>&nbsp;<span class="ident" id="7997587">tt</span><span class="op" id="7997589">.</span><span class="ident" id="7997590">litAddrOrName</span><span class="op" id="7997603">,</span>&nbsp;<span class="ident" id="7997605">err</span><span class="op" id="7997608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997616">if</span>&nbsp;<span class="op" id="7997619">!</span><span class="ident" id="7997620">reflect</span><span class="op" id="7997627">.</span><span class="ident" id="7997628">DeepEqual</span><span class="op" id="7997637">(</span><span class="ident" id="7997638">addr</span><span class="op" id="7997642">,</span>&nbsp;<span class="op" id="7997644">(</span><span class="op" id="7997645">*</span><span class="ident" id="7997646">UDPAddr</span><span class="op" id="7997653">)</span><span class="op" id="7997654">(</span><span class="ident" id="7997655">tt</span><span class="op" id="7997657">.</span><span class="ident" id="7997658">addr</span><span class="op" id="7997662">)</span><span class="op" id="7997663">)</span>&nbsp;<span class="op" id="7997665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997670">t</span><span class="op" id="7997671">.</span><span class="ident" id="7997672">Fatalf</span><span class="op" id="7997678">(</span><span class="string" id="7997679">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7997719">,</span>&nbsp;<span class="ident" id="7997721">net</span><span class="op" id="7997724">,</span>&nbsp;<span class="ident" id="7997726">tt</span><span class="op" id="7997728">.</span><span class="ident" id="7997729">litAddrOrName</span><span class="op" id="7997742">,</span>&nbsp;<span class="ident" id="7997744">addr</span><span class="op" id="7997748">,</span>&nbsp;<span class="ident" id="7997750">tt</span><span class="op" id="7997752">.</span><span class="ident" id="7997753">addr</span><span class="op" id="7997757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997761">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997765">if</span>&nbsp;<span class="ident" id="7997768">err</span>&nbsp;<span class="op" id="7997772">==</span>&nbsp;<span class="ident" id="7997775">nil</span>&nbsp;<span class="op" id="7997779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997784">str</span>&nbsp;<span class="op" id="7997788">:=</span>&nbsp;<span class="ident" id="7997791">addr</span><span class="op" id="7997795">.</span><span class="ident" id="7997796">String</span><span class="op" id="7997802">(</span><span class="op" id="7997803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997808">addr1</span><span class="op" id="7997813">,</span>&nbsp;<span class="ident" id="7997815">err</span>&nbsp;<span class="op" id="7997819">:=</span>&nbsp;<span class="ident" id="7997822">ResolveUDPAddr</span><span class="op" id="7997836">(</span><span class="ident" id="7997837">net</span><span class="op" id="7997840">,</span>&nbsp;<span class="ident" id="7997842">str</span><span class="op" id="7997845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997850">if</span>&nbsp;<span class="ident" id="7997853">err</span>&nbsp;<span class="op" id="7997857">!=</span>&nbsp;<span class="ident" id="7997860">nil</span>&nbsp;<span class="op" id="7997864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7997870">t</span><span class="op" id="7997871">.</span><span class="ident" id="7997872">Fatalf</span><span class="op" id="7997878">(</span><span class="string" id="7997879">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]:&nbsp;%v&#34;</span><span class="op" id="7997917">,</span>&nbsp;<span class="ident" id="7997919">net</span><span class="op" id="7997922">,</span>&nbsp;<span class="ident" id="7997924">str</span><span class="op" id="7997927">,</span>&nbsp;<span class="ident" id="7997929">tt</span><span class="op" id="7997931">.</span><span class="ident" id="7997932">litAddrOrName</span><span class="op" id="7997945">,</span>&nbsp;<span class="ident" id="7997947">err</span><span class="op" id="7997950">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7997955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7997960">if</span>&nbsp;<span class="op" id="7997963">!</span><span class="ident" id="7997964">reflect</span><span class="op" id="7997971">.</span><span class="ident" id="7997972">DeepEqual</span><span class="op" id="7997981">(</span><span class="ident" id="7997982">addr1</span><span class="op" id="7997987">,</span>&nbsp;<span class="ident" id="7997989">addr</span><span class="op" id="7997993">)</span>&nbsp;<span class="op" id="7997995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998001">t</span><span class="op" id="7998002">.</span><span class="ident" id="7998003">Fatalf</span><span class="op" id="7998009">(</span><span class="string" id="7998010">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;[from&nbsp;%q]&nbsp;=&nbsp;%#v,&nbsp;want&nbsp;%#v&#34;</span><span class="op" id="7998060">,</span>&nbsp;<span class="ident" id="7998062">net</span><span class="op" id="7998065">,</span>&nbsp;<span class="ident" id="7998067">str</span><span class="op" id="7998070">,</span>&nbsp;<span class="ident" id="7998072">tt</span><span class="op" id="7998074">.</span><span class="ident" id="7998075">litAddrOrName</span><span class="op" id="7998088">,</span>&nbsp;<span class="ident" id="7998090">addr1</span><span class="op" id="7998095">,</span>&nbsp;<span class="ident" id="7998097">addr</span><span class="op" id="7998101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998110">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998113">}</span><br>
<span class="lineno"></span><span class="op" id="7998115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7998118">func</span>&nbsp;<span class="ident" id="7998123">TestReadFromUDP</span><span class="op" id="7998138">(</span><span class="ident" id="7998139">t</span>&nbsp;<span class="op" id="7998141">*</span><span class="ident" id="7998142">testing</span><span class="op" id="7998149">.</span><span class="ident" id="7998150">T</span><span class="op" id="7998151">)</span>&nbsp;<span class="op" id="7998153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998156">switch</span>&nbsp;<span class="ident" id="7998163">runtime</span><span class="op" id="7998170">.</span><span class="ident" id="7998171">GOOS</span>&nbsp;<span class="op" id="7998176">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998179">case</span>&nbsp;<span class="string" id="7998184">&#34;nacl&#34;</span><span class="op" id="7998190">,</span>&nbsp;<span class="string" id="7998192">&#34;plan9&#34;</span><span class="op" id="7998199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998203">t</span><span class="op" id="7998204">.</span><span class="ident" id="7998205">Skipf</span><span class="op" id="7998210">(</span><span class="string" id="7998211">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q,&nbsp;see&nbsp;issue&nbsp;8916&#34;</span><span class="op" id="7998248">,</span>&nbsp;<span class="ident" id="7998250">runtime</span><span class="op" id="7998257">.</span><span class="ident" id="7998258">GOOS</span><span class="op" id="7998262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998269">ra</span><span class="op" id="7998271">,</span>&nbsp;<span class="ident" id="7998273">err</span>&nbsp;<span class="op" id="7998277">:=</span>&nbsp;<span class="ident" id="7998280">ResolveUDPAddr</span><span class="op" id="7998294">(</span><span class="string" id="7998295">&#34;udp&#34;</span><span class="op" id="7998300">,</span>&nbsp;<span class="string" id="7998302">&#34;127.0.0.1:7&#34;</span><span class="op" id="7998315">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998318">if</span>&nbsp;<span class="ident" id="7998321">err</span>&nbsp;<span class="op" id="7998325">!=</span>&nbsp;<span class="ident" id="7998328">nil</span>&nbsp;<span class="op" id="7998332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998336">t</span><span class="op" id="7998337">.</span><span class="ident" id="7998338">Fatal</span><span class="op" id="7998343">(</span><span class="ident" id="7998344">err</span><span class="op" id="7998347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998354">la</span><span class="op" id="7998356">,</span>&nbsp;<span class="ident" id="7998358">err</span>&nbsp;<span class="op" id="7998362">:=</span>&nbsp;<span class="ident" id="7998365">ResolveUDPAddr</span><span class="op" id="7998379">(</span><span class="string" id="7998380">&#34;udp&#34;</span><span class="op" id="7998385">,</span>&nbsp;<span class="string" id="7998387">&#34;127.0.0.1:0&#34;</span><span class="op" id="7998400">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998403">if</span>&nbsp;<span class="ident" id="7998406">err</span>&nbsp;<span class="op" id="7998410">!=</span>&nbsp;<span class="ident" id="7998413">nil</span>&nbsp;<span class="op" id="7998417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998421">t</span><span class="op" id="7998422">.</span><span class="ident" id="7998423">Fatal</span><span class="op" id="7998428">(</span><span class="ident" id="7998429">err</span><span class="op" id="7998432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998439">c</span><span class="op" id="7998440">,</span>&nbsp;<span class="ident" id="7998442">err</span>&nbsp;<span class="op" id="7998446">:=</span>&nbsp;<span class="ident" id="7998449">ListenUDP</span><span class="op" id="7998458">(</span><span class="string" id="7998459">&#34;udp&#34;</span><span class="op" id="7998464">,</span>&nbsp;<span class="ident" id="7998466">la</span><span class="op" id="7998468">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998471">if</span>&nbsp;<span class="ident" id="7998474">err</span>&nbsp;<span class="op" id="7998478">!=</span>&nbsp;<span class="ident" id="7998481">nil</span>&nbsp;<span class="op" id="7998485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998489">t</span><span class="op" id="7998490">.</span><span class="ident" id="7998491">Fatal</span><span class="op" id="7998496">(</span><span class="ident" id="7998497">err</span><span class="op" id="7998500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998506">defer</span>&nbsp;<span class="ident" id="7998512">c</span><span class="op" id="7998513">.</span><span class="ident" id="7998514">Close</span><span class="op" id="7998519">(</span><span class="op" id="7998520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998524">_</span><span class="op" id="7998525">,</span>&nbsp;<span class="ident" id="7998527">err</span>&nbsp;<span class="op" id="7998531">=</span>&nbsp;<span class="ident" id="7998533">c</span><span class="op" id="7998534">.</span><span class="ident" id="7998535">WriteToUDP</span><span class="op" id="7998545">(</span><span class="op" id="7998546">[</span><span class="op" id="7998547">]</span><span class="builtintype" id="7998548">byte</span><span class="op" id="7998552">(</span><span class="string" id="7998553">&#34;a&#34;</span><span class="op" id="7998556">)</span><span class="op" id="7998557">,</span>&nbsp;<span class="ident" id="7998559">ra</span><span class="op" id="7998561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998564">if</span>&nbsp;<span class="ident" id="7998567">err</span>&nbsp;<span class="op" id="7998571">!=</span>&nbsp;<span class="ident" id="7998574">nil</span>&nbsp;<span class="op" id="7998578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998582">t</span><span class="op" id="7998583">.</span><span class="ident" id="7998584">Fatal</span><span class="op" id="7998589">(</span><span class="ident" id="7998590">err</span><span class="op" id="7998593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998600">err</span>&nbsp;<span class="op" id="7998604">=</span>&nbsp;<span class="ident" id="7998606">c</span><span class="op" id="7998607">.</span><span class="ident" id="7998608">SetDeadline</span><span class="op" id="7998619">(</span><span class="ident" id="7998620">time</span><span class="op" id="7998624">.</span><span class="ident" id="7998625">Now</span><span class="op" id="7998628">(</span><span class="op" id="7998629">)</span><span class="op" id="7998630">.</span><span class="ident" id="7998631">Add</span><span class="op" id="7998634">(</span><span class="num" id="7998635">100</span>&nbsp;<span class="op" id="7998639">*</span>&nbsp;<span class="ident" id="7998641">time</span><span class="op" id="7998645">.</span><span class="ident" id="7998646">Millisecond</span><span class="op" id="7998657">)</span><span class="op" id="7998658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998661">if</span>&nbsp;<span class="ident" id="7998664">err</span>&nbsp;<span class="op" id="7998668">!=</span>&nbsp;<span class="ident" id="7998671">nil</span>&nbsp;<span class="op" id="7998675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998679">t</span><span class="op" id="7998680">.</span><span class="ident" id="7998681">Fatal</span><span class="op" id="7998686">(</span><span class="ident" id="7998687">err</span><span class="op" id="7998690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998696">b</span>&nbsp;<span class="op" id="7998698">:=</span>&nbsp;<span class="builtinfunc" id="7998701">make</span><span class="op" id="7998705">(</span><span class="op" id="7998706">[</span><span class="op" id="7998707">]</span><span class="builtintype" id="7998708">byte</span><span class="op" id="7998712">,</span>&nbsp;<span class="num" id="7998714">1</span><span class="op" id="7998715">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998718">_</span><span class="op" id="7998719">,</span>&nbsp;<span class="ident" id="7998721">_</span><span class="op" id="7998722">,</span>&nbsp;<span class="ident" id="7998724">err</span>&nbsp;<span class="op" id="7998728">=</span>&nbsp;<span class="ident" id="7998730">c</span><span class="op" id="7998731">.</span><span class="ident" id="7998732">ReadFromUDP</span><span class="op" id="7998743">(</span><span class="ident" id="7998744">b</span><span class="op" id="7998745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998748">if</span>&nbsp;<span class="ident" id="7998751">err</span>&nbsp;<span class="op" id="7998755">==</span>&nbsp;<span class="ident" id="7998758">nil</span>&nbsp;<span class="op" id="7998762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998766">t</span><span class="op" id="7998767">.</span><span class="ident" id="7998768">Fatal</span><span class="op" id="7998773">(</span><span class="string" id="7998774">&#34;ReadFromUDP&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7998799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998802">}</span>&nbsp;<span class="keyword" id="7998804">else</span>&nbsp;<span class="keyword" id="7998809">if</span>&nbsp;<span class="op" id="7998812">!</span><span class="ident" id="7998813">isTimeout</span><span class="op" id="7998822">(</span><span class="ident" id="7998823">err</span><span class="op" id="7998826">)</span>&nbsp;<span class="op" id="7998828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998832">t</span><span class="op" id="7998833">.</span><span class="ident" id="7998834">Fatal</span><span class="op" id="7998839">(</span><span class="ident" id="7998840">err</span><span class="op" id="7998843">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998846">}</span><br>
<span class="lineno"></span><span class="op" id="7998848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7998851">func</span>&nbsp;<span class="ident" id="7998856">TestWriteToUDP</span><span class="op" id="7998870">(</span><span class="ident" id="7998871">t</span>&nbsp;<span class="op" id="7998873">*</span><span class="ident" id="7998874">testing</span><span class="op" id="7998881">.</span><span class="ident" id="7998882">T</span><span class="op" id="7998883">)</span>&nbsp;<span class="op" id="7998885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998888">switch</span>&nbsp;<span class="ident" id="7998895">runtime</span><span class="op" id="7998902">.</span><span class="ident" id="7998903">GOOS</span>&nbsp;<span class="op" id="7998908">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7998911">case</span>&nbsp;<span class="string" id="7998916">&#34;plan9&#34;</span><span class="op" id="7998923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998927">t</span><span class="op" id="7998928">.</span><span class="ident" id="7998929">Skipf</span><span class="op" id="7998934">(</span><span class="string" id="7998935">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7998956">,</span>&nbsp;<span class="ident" id="7998958">runtime</span><span class="op" id="7998965">.</span><span class="ident" id="7998966">GOOS</span><span class="op" id="7998970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7998973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7998977">l</span><span class="op" id="7998978">,</span>&nbsp;<span class="ident" id="7998980">err</span>&nbsp;<span class="op" id="7998984">:=</span>&nbsp;<span class="ident" id="7998987">ListenPacket</span><span class="op" id="7998999">(</span><span class="string" id="7999000">&#34;udp&#34;</span><span class="op" id="7999005">,</span>&nbsp;<span class="string" id="7999007">&#34;127.0.0.1:0&#34;</span><span class="op" id="7999020">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999023">if</span>&nbsp;<span class="ident" id="7999026">err</span>&nbsp;<span class="op" id="7999030">!=</span>&nbsp;<span class="ident" id="7999033">nil</span>&nbsp;<span class="op" id="7999037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999041">t</span><span class="op" id="7999042">.</span><span class="ident" id="7999043">Fatalf</span><span class="op" id="7999049">(</span><span class="string" id="7999050">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7999069">,</span>&nbsp;<span class="ident" id="7999071">err</span><span class="op" id="7999074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999080">defer</span>&nbsp;<span class="ident" id="7999086">l</span><span class="op" id="7999087">.</span><span class="ident" id="7999088">Close</span><span class="op" id="7999093">(</span><span class="op" id="7999094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999098">testWriteToConn</span><span class="op" id="7999113">(</span><span class="ident" id="7999114">t</span><span class="op" id="7999115">,</span>&nbsp;<span class="ident" id="7999117">l</span><span class="op" id="7999118">.</span><span class="ident" id="7999119">LocalAddr</span><span class="op" id="7999128">(</span><span class="op" id="7999129">)</span><span class="op" id="7999130">.</span><span class="ident" id="7999131">String</span><span class="op" id="7999137">(</span><span class="op" id="7999138">)</span><span class="op" id="7999139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999142">testWriteToPacketConn</span><span class="op" id="7999163">(</span><span class="ident" id="7999164">t</span><span class="op" id="7999165">,</span>&nbsp;<span class="ident" id="7999167">l</span><span class="op" id="7999168">.</span><span class="ident" id="7999169">LocalAddr</span><span class="op" id="7999178">(</span><span class="op" id="7999179">)</span><span class="op" id="7999180">.</span><span class="ident" id="7999181">String</span><span class="op" id="7999187">(</span><span class="op" id="7999188">)</span><span class="op" id="7999189">)</span><br>
<span class="lineno"></span><span class="op" id="7999191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7999194">func</span>&nbsp;<span class="ident" id="7999199">testWriteToConn</span><span class="op" id="7999214">(</span><span class="ident" id="7999215">t</span>&nbsp;<span class="op" id="7999217">*</span><span class="ident" id="7999218">testing</span><span class="op" id="7999225">.</span><span class="ident" id="7999226">T</span><span class="op" id="7999227">,</span>&nbsp;<span class="ident" id="7999229">raddr</span>&nbsp;<span class="builtintype" id="7999235">string</span><span class="op" id="7999241">)</span>&nbsp;<span class="op" id="7999243">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999246">c</span><span class="op" id="7999247">,</span>&nbsp;<span class="ident" id="7999249">err</span>&nbsp;<span class="op" id="7999253">:=</span>&nbsp;<span class="ident" id="7999256">Dial</span><span class="op" id="7999260">(</span><span class="string" id="7999261">&#34;udp&#34;</span><span class="op" id="7999266">,</span>&nbsp;<span class="ident" id="7999268">raddr</span><span class="op" id="7999273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999276">if</span>&nbsp;<span class="ident" id="7999279">err</span>&nbsp;<span class="op" id="7999283">!=</span>&nbsp;<span class="ident" id="7999286">nil</span>&nbsp;<span class="op" id="7999290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999294">t</span><span class="op" id="7999295">.</span><span class="ident" id="7999296">Fatalf</span><span class="op" id="7999302">(</span><span class="string" id="7999303">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7999320">,</span>&nbsp;<span class="ident" id="7999322">err</span><span class="op" id="7999325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999331">defer</span>&nbsp;<span class="ident" id="7999337">c</span><span class="op" id="7999338">.</span><span class="ident" id="7999339">Close</span><span class="op" id="7999344">(</span><span class="op" id="7999345">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999349">ra</span><span class="op" id="7999351">,</span>&nbsp;<span class="ident" id="7999353">err</span>&nbsp;<span class="op" id="7999357">:=</span>&nbsp;<span class="ident" id="7999360">ResolveUDPAddr</span><span class="op" id="7999374">(</span><span class="string" id="7999375">&#34;udp&#34;</span><span class="op" id="7999380">,</span>&nbsp;<span class="ident" id="7999382">raddr</span><span class="op" id="7999387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999390">if</span>&nbsp;<span class="ident" id="7999393">err</span>&nbsp;<span class="op" id="7999397">!=</span>&nbsp;<span class="ident" id="7999400">nil</span>&nbsp;<span class="op" id="7999404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999408">t</span><span class="op" id="7999409">.</span><span class="ident" id="7999410">Fatalf</span><span class="op" id="7999416">(</span><span class="string" id="7999417">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7999444">,</span>&nbsp;<span class="ident" id="7999446">err</span><span class="op" id="7999449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999452">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999456">_</span><span class="op" id="7999457">,</span>&nbsp;<span class="ident" id="7999459">err</span>&nbsp;<span class="op" id="7999463">=</span>&nbsp;<span class="ident" id="7999465">c</span><span class="op" id="7999466">.</span><span class="op" id="7999467">(</span><span class="op" id="7999468">*</span><span class="ident" id="7999469">UDPConn</span><span class="op" id="7999476">)</span><span class="op" id="7999477">.</span><span class="ident" id="7999478">WriteToUDP</span><span class="op" id="7999488">(</span><span class="op" id="7999489">[</span><span class="op" id="7999490">]</span><span class="builtintype" id="7999491">byte</span><span class="op" id="7999495">(</span><span class="string" id="7999496">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7999529">)</span><span class="op" id="7999530">,</span>&nbsp;<span class="ident" id="7999532">ra</span><span class="op" id="7999534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999537">if</span>&nbsp;<span class="ident" id="7999540">err</span>&nbsp;<span class="op" id="7999544">==</span>&nbsp;<span class="ident" id="7999547">nil</span>&nbsp;<span class="op" id="7999551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999555">t</span><span class="op" id="7999556">.</span><span class="ident" id="7999557">Fatal</span><span class="op" id="7999562">(</span><span class="string" id="7999563">&#34;WriteToUDP&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7999587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999590">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999593">if</span>&nbsp;<span class="ident" id="7999596">err</span>&nbsp;<span class="op" id="7999600">!=</span>&nbsp;<span class="ident" id="7999603">nil</span>&nbsp;<span class="op" id="7999607">&amp;&amp;</span>&nbsp;<span class="ident" id="7999610">err</span><span class="op" id="7999613">.</span><span class="op" id="7999614">(</span><span class="op" id="7999615">*</span><span class="ident" id="7999616">OpError</span><span class="op" id="7999623">)</span><span class="op" id="7999624">.</span><span class="ident" id="7999625">Err</span>&nbsp;<span class="op" id="7999629">!=</span>&nbsp;<span class="ident" id="7999632">ErrWriteToConnected</span>&nbsp;<span class="op" id="7999652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999656">t</span><span class="op" id="7999657">.</span><span class="ident" id="7999658">Fatalf</span><span class="op" id="7999664">(</span><span class="string" id="7999665">&#34;WriteToUDP&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7999716">,</span>&nbsp;<span class="ident" id="7999718">err</span><span class="op" id="7999721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999728">_</span><span class="op" id="7999729">,</span>&nbsp;<span class="ident" id="7999731">err</span>&nbsp;<span class="op" id="7999735">=</span>&nbsp;<span class="ident" id="7999737">c</span><span class="op" id="7999738">.</span><span class="op" id="7999739">(</span><span class="op" id="7999740">*</span><span class="ident" id="7999741">UDPConn</span><span class="op" id="7999748">)</span><span class="op" id="7999749">.</span><span class="ident" id="7999750">WriteTo</span><span class="op" id="7999757">(</span><span class="op" id="7999758">[</span><span class="op" id="7999759">]</span><span class="builtintype" id="7999760">byte</span><span class="op" id="7999764">(</span><span class="string" id="7999765">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="7999798">)</span><span class="op" id="7999799">,</span>&nbsp;<span class="ident" id="7999801">ra</span><span class="op" id="7999803">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999806">if</span>&nbsp;<span class="ident" id="7999809">err</span>&nbsp;<span class="op" id="7999813">==</span>&nbsp;<span class="ident" id="7999816">nil</span>&nbsp;<span class="op" id="7999820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999824">t</span><span class="op" id="7999825">.</span><span class="ident" id="7999826">Fatal</span><span class="op" id="7999831">(</span><span class="string" id="7999832">&#34;WriteTo&nbsp;should&nbsp;fail&#34;</span><span class="op" id="7999853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7999859">if</span>&nbsp;<span class="ident" id="7999862">err</span>&nbsp;<span class="op" id="7999866">!=</span>&nbsp;<span class="ident" id="7999869">nil</span>&nbsp;<span class="op" id="7999873">&amp;&amp;</span>&nbsp;<span class="ident" id="7999876">err</span><span class="op" id="7999879">.</span><span class="op" id="7999880">(</span><span class="op" id="7999881">*</span><span class="ident" id="7999882">OpError</span><span class="op" id="7999889">)</span><span class="op" id="7999890">.</span><span class="ident" id="7999891">Err</span>&nbsp;<span class="op" id="7999895">!=</span>&nbsp;<span class="ident" id="7999898">ErrWriteToConnected</span>&nbsp;<span class="op" id="7999918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999922">t</span><span class="op" id="7999923">.</span><span class="ident" id="7999924">Fatalf</span><span class="op" id="7999930">(</span><span class="string" id="7999931">&#34;WriteTo&nbsp;should&nbsp;fail&nbsp;as&nbsp;ErrWriteToConnected:&nbsp;%v&#34;</span><span class="op" id="7999979">,</span>&nbsp;<span class="ident" id="7999981">err</span><span class="op" id="7999984">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7999987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7999991">_</span><span class="op" id="7999992">,</span>&nbsp;<span class="ident" id="7999994">err</span>&nbsp;<span class="op" id="7999998">=</span>&nbsp;<span class="ident" id="8000000">c</span><span class="op" id="8000001">.</span><span class="ident" id="8000002">Write</span><span class="op" id="8000007">(</span><span class="op" id="8000008">[</span><span class="op" id="8000009">]</span><span class="builtintype" id="8000010">byte</span><span class="op" id="8000014">(</span><span class="string" id="8000015">&#34;Connection-oriented&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8000048">)</span><span class="op" id="8000049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000052">if</span>&nbsp;<span class="ident" id="8000055">err</span>&nbsp;<span class="op" id="8000059">!=</span>&nbsp;<span class="ident" id="8000062">nil</span>&nbsp;<span class="op" id="8000066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000070">t</span><span class="op" id="8000071">.</span><span class="ident" id="8000072">Fatalf</span><span class="op" id="8000078">(</span><span class="string" id="8000079">&#34;Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8000097">,</span>&nbsp;<span class="ident" id="8000099">err</span><span class="op" id="8000102">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000105">}</span><br>
<span class="lineno"></span><span class="op" id="8000107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8000110">func</span>&nbsp;<span class="ident" id="8000115">testWriteToPacketConn</span><span class="op" id="8000136">(</span><span class="ident" id="8000137">t</span>&nbsp;<span class="op" id="8000139">*</span><span class="ident" id="8000140">testing</span><span class="op" id="8000147">.</span><span class="ident" id="8000148">T</span><span class="op" id="8000149">,</span>&nbsp;<span class="ident" id="8000151">raddr</span>&nbsp;<span class="builtintype" id="8000157">string</span><span class="op" id="8000163">)</span>&nbsp;<span class="op" id="8000165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000168">c</span><span class="op" id="8000169">,</span>&nbsp;<span class="ident" id="8000171">err</span>&nbsp;<span class="op" id="8000175">:=</span>&nbsp;<span class="ident" id="8000178">ListenPacket</span><span class="op" id="8000190">(</span><span class="string" id="8000191">&#34;udp&#34;</span><span class="op" id="8000196">,</span>&nbsp;<span class="string" id="8000198">&#34;127.0.0.1:0&#34;</span><span class="op" id="8000211">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000214">if</span>&nbsp;<span class="ident" id="8000217">err</span>&nbsp;<span class="op" id="8000221">!=</span>&nbsp;<span class="ident" id="8000224">nil</span>&nbsp;<span class="op" id="8000228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000232">t</span><span class="op" id="8000233">.</span><span class="ident" id="8000234">Fatalf</span><span class="op" id="8000240">(</span><span class="string" id="8000241">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8000266">,</span>&nbsp;<span class="ident" id="8000268">err</span><span class="op" id="8000271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000277">defer</span>&nbsp;<span class="ident" id="8000283">c</span><span class="op" id="8000284">.</span><span class="ident" id="8000285">Close</span><span class="op" id="8000290">(</span><span class="op" id="8000291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000295">ra</span><span class="op" id="8000297">,</span>&nbsp;<span class="ident" id="8000299">err</span>&nbsp;<span class="op" id="8000303">:=</span>&nbsp;<span class="ident" id="8000306">ResolveUDPAddr</span><span class="op" id="8000320">(</span><span class="string" id="8000321">&#34;udp&#34;</span><span class="op" id="8000326">,</span>&nbsp;<span class="ident" id="8000328">raddr</span><span class="op" id="8000333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000336">if</span>&nbsp;<span class="ident" id="8000339">err</span>&nbsp;<span class="op" id="8000343">!=</span>&nbsp;<span class="ident" id="8000346">nil</span>&nbsp;<span class="op" id="8000350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000354">t</span><span class="op" id="8000355">.</span><span class="ident" id="8000356">Fatalf</span><span class="op" id="8000362">(</span><span class="string" id="8000363">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8000390">,</span>&nbsp;<span class="ident" id="8000392">err</span><span class="op" id="8000395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000402">_</span><span class="op" id="8000403">,</span>&nbsp;<span class="ident" id="8000405">err</span>&nbsp;<span class="op" id="8000409">=</span>&nbsp;<span class="ident" id="8000411">c</span><span class="op" id="8000412">.</span><span class="op" id="8000413">(</span><span class="op" id="8000414">*</span><span class="ident" id="8000415">UDPConn</span><span class="op" id="8000422">)</span><span class="op" id="8000423">.</span><span class="ident" id="8000424">WriteToUDP</span><span class="op" id="8000434">(</span><span class="op" id="8000435">[</span><span class="op" id="8000436">]</span><span class="builtintype" id="8000437">byte</span><span class="op" id="8000441">(</span><span class="string" id="8000442">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8000471">)</span><span class="op" id="8000472">,</span>&nbsp;<span class="ident" id="8000474">ra</span><span class="op" id="8000476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000479">if</span>&nbsp;<span class="ident" id="8000482">err</span>&nbsp;<span class="op" id="8000486">!=</span>&nbsp;<span class="ident" id="8000489">nil</span>&nbsp;<span class="op" id="8000493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000497">t</span><span class="op" id="8000498">.</span><span class="ident" id="8000499">Fatalf</span><span class="op" id="8000505">(</span><span class="string" id="8000506">&#34;WriteToUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8000529">,</span>&nbsp;<span class="ident" id="8000531">err</span><span class="op" id="8000534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000541">_</span><span class="op" id="8000542">,</span>&nbsp;<span class="ident" id="8000544">err</span>&nbsp;<span class="op" id="8000548">=</span>&nbsp;<span class="ident" id="8000550">c</span><span class="op" id="8000551">.</span><span class="ident" id="8000552">WriteTo</span><span class="op" id="8000559">(</span><span class="op" id="8000560">[</span><span class="op" id="8000561">]</span><span class="builtintype" id="8000562">byte</span><span class="op" id="8000566">(</span><span class="string" id="8000567">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8000596">)</span><span class="op" id="8000597">,</span>&nbsp;<span class="ident" id="8000599">ra</span><span class="op" id="8000601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000604">if</span>&nbsp;<span class="ident" id="8000607">err</span>&nbsp;<span class="op" id="8000611">!=</span>&nbsp;<span class="ident" id="8000614">nil</span>&nbsp;<span class="op" id="8000618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000622">t</span><span class="op" id="8000623">.</span><span class="ident" id="8000624">Fatalf</span><span class="op" id="8000630">(</span><span class="string" id="8000631">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8000651">,</span>&nbsp;<span class="ident" id="8000653">err</span><span class="op" id="8000656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000663">_</span><span class="op" id="8000664">,</span>&nbsp;<span class="ident" id="8000666">err</span>&nbsp;<span class="op" id="8000670">=</span>&nbsp;<span class="ident" id="8000672">c</span><span class="op" id="8000673">.</span><span class="op" id="8000674">(</span><span class="op" id="8000675">*</span><span class="ident" id="8000676">UDPConn</span><span class="op" id="8000683">)</span><span class="op" id="8000684">.</span><span class="ident" id="8000685">Write</span><span class="op" id="8000690">(</span><span class="op" id="8000691">[</span><span class="op" id="8000692">]</span><span class="builtintype" id="8000693">byte</span><span class="op" id="8000697">(</span><span class="string" id="8000698">&#34;Connection-less&nbsp;mode&nbsp;socket&#34;</span><span class="op" id="8000727">)</span><span class="op" id="8000728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000731">if</span>&nbsp;<span class="ident" id="8000734">err</span>&nbsp;<span class="op" id="8000738">==</span>&nbsp;<span class="ident" id="8000741">nil</span>&nbsp;<span class="op" id="8000745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000749">t</span><span class="op" id="8000750">.</span><span class="ident" id="8000751">Fatal</span><span class="op" id="8000756">(</span><span class="string" id="8000757">&#34;Write&nbsp;should&nbsp;fail&#34;</span><span class="op" id="8000776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000779">}</span><br>
<span class="lineno"></span><span class="op" id="8000781">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="8000784">var</span>&nbsp;<span class="ident" id="8000788">udpConnLocalNameTests</span>&nbsp;<span class="op" id="8000810">=</span>&nbsp;<span class="op" id="8000812">[</span><span class="op" id="8000813">]</span><span class="keyword" id="8000814">struct</span>&nbsp;<span class="op" id="8000821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000824">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8000830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8000838">laddr</span>&nbsp;<span class="op" id="8000844">*</span><span class="ident" id="8000845">UDPAddr</span><br>
<span class="lineno"></span><span class="op" id="8000853">}</span><span class="op" id="8000854">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000857">{</span><span class="string" id="8000858">&#34;udp4&#34;</span><span class="op" id="8000864">,</span>&nbsp;<span class="op" id="8000866">&amp;</span><span class="ident" id="8000867">UDPAddr</span><span class="op" id="8000874">{</span><span class="ident" id="8000875">IP</span><span class="op" id="8000877">:</span>&nbsp;<span class="ident" id="8000879">IPv4</span><span class="op" id="8000883">(</span><span class="num" id="8000884">127</span><span class="op" id="8000887">,</span>&nbsp;<span class="num" id="8000889">0</span><span class="op" id="8000890">,</span>&nbsp;<span class="num" id="8000892">0</span><span class="op" id="8000893">,</span>&nbsp;<span class="num" id="8000895">1</span><span class="op" id="8000896">)</span><span class="op" id="8000897">}</span><span class="op" id="8000898">}</span><span class="op" id="8000899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000902">{</span><span class="string" id="8000903">&#34;udp4&#34;</span><span class="op" id="8000909">,</span>&nbsp;<span class="op" id="8000911">&amp;</span><span class="ident" id="8000912">UDPAddr</span><span class="op" id="8000919">{</span><span class="op" id="8000920">}</span><span class="op" id="8000921">}</span><span class="op" id="8000922">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8000925">{</span><span class="string" id="8000926">&#34;udp4&#34;</span><span class="op" id="8000932">,</span>&nbsp;<span class="ident" id="8000934">nil</span><span class="op" id="8000937">}</span><span class="op" id="8000938">,</span><br>
<span class="lineno"></span><span class="op" id="8000940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="8000943">func</span>&nbsp;<span class="ident" id="8000948">TestUDPConnLocalName</span><span class="op" id="8000968">(</span><span class="ident" id="8000969">t</span>&nbsp;<span class="op" id="8000971">*</span><span class="ident" id="8000972">testing</span><span class="op" id="8000979">.</span><span class="ident" id="8000980">T</span><span class="op" id="8000981">)</span>&nbsp;<span class="op" id="8000983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8000986">if</span>&nbsp;<span class="ident" id="8000989">testing</span><span class="op" id="8000996">.</span><span class="ident" id="8000997">Short</span><span class="op" id="8001002">(</span><span class="op" id="8001003">)</span>&nbsp;<span class="op" id="8001005">||</span>&nbsp;<span class="op" id="8001008">!</span><span class="op" id="8001009">*</span><span class="ident" id="8001010">testExternal</span>&nbsp;<span class="op" id="8001023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001027">t</span><span class="op" id="8001028">.</span><span class="ident" id="8001029">Skip</span><span class="op" id="8001033">(</span><span class="string" id="8001034">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8001075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001082">for</span>&nbsp;<span class="ident" id="8001086">_</span><span class="op" id="8001087">,</span>&nbsp;<span class="ident" id="8001089">tt</span>&nbsp;<span class="op" id="8001092">:=</span>&nbsp;<span class="keyword" id="8001095">range</span>&nbsp;<span class="ident" id="8001101">udpConnLocalNameTests</span>&nbsp;<span class="op" id="8001123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001127">c</span><span class="op" id="8001128">,</span>&nbsp;<span class="ident" id="8001130">err</span>&nbsp;<span class="op" id="8001134">:=</span>&nbsp;<span class="ident" id="8001137">ListenUDP</span><span class="op" id="8001146">(</span><span class="ident" id="8001147">tt</span><span class="op" id="8001149">.</span><span class="ident" id="8001150">net</span><span class="op" id="8001153">,</span>&nbsp;<span class="ident" id="8001155">tt</span><span class="op" id="8001157">.</span><span class="ident" id="8001158">laddr</span><span class="op" id="8001163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001167">if</span>&nbsp;<span class="ident" id="8001170">err</span>&nbsp;<span class="op" id="8001174">!=</span>&nbsp;<span class="ident" id="8001177">nil</span>&nbsp;<span class="op" id="8001181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001186">t</span><span class="op" id="8001187">.</span><span class="ident" id="8001188">Fatalf</span><span class="op" id="8001194">(</span><span class="string" id="8001195">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8001217">,</span>&nbsp;<span class="ident" id="8001219">err</span><span class="op" id="8001222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001226">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001230">defer</span>&nbsp;<span class="ident" id="8001236">c</span><span class="op" id="8001237">.</span><span class="ident" id="8001238">Close</span><span class="op" id="8001243">(</span><span class="op" id="8001244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001248">la</span>&nbsp;<span class="op" id="8001251">:=</span>&nbsp;<span class="ident" id="8001254">c</span><span class="op" id="8001255">.</span><span class="ident" id="8001256">LocalAddr</span><span class="op" id="8001265">(</span><span class="op" id="8001266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001270">if</span>&nbsp;<span class="ident" id="8001273">a</span><span class="op" id="8001274">,</span>&nbsp;<span class="ident" id="8001276">ok</span>&nbsp;<span class="op" id="8001279">:=</span>&nbsp;<span class="ident" id="8001282">la</span><span class="op" id="8001284">.</span><span class="op" id="8001285">(</span><span class="op" id="8001286">*</span><span class="ident" id="8001287">UDPAddr</span><span class="op" id="8001294">)</span><span class="op" id="8001295">;</span>&nbsp;<span class="op" id="8001297">!</span><span class="ident" id="8001298">ok</span>&nbsp;<span class="op" id="8001301">||</span>&nbsp;<span class="ident" id="8001304">a</span><span class="op" id="8001305">.</span><span class="ident" id="8001306">Port</span>&nbsp;<span class="op" id="8001311">==</span>&nbsp;<span class="num" id="8001314">0</span>&nbsp;<span class="op" id="8001316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001321">t</span><span class="op" id="8001322">.</span><span class="ident" id="8001323">Fatalf</span><span class="op" id="8001329">(</span><span class="string" id="8001330">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="8001391">,</span>&nbsp;<span class="ident" id="8001393">la</span><span class="op" id="8001395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001399">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001402">}</span><br>
<span class="lineno"></span><span class="op" id="8001404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8001407">func</span>&nbsp;<span class="ident" id="8001412">TestUDPConnLocalAndRemoteNames</span><span class="op" id="8001442">(</span><span class="ident" id="8001443">t</span>&nbsp;<span class="op" id="8001445">*</span><span class="ident" id="8001446">testing</span><span class="op" id="8001453">.</span><span class="ident" id="8001454">T</span><span class="op" id="8001455">)</span>&nbsp;<span class="op" id="8001457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001460">for</span>&nbsp;<span class="ident" id="8001464">_</span><span class="op" id="8001465">,</span>&nbsp;<span class="ident" id="8001467">laddr</span>&nbsp;<span class="op" id="8001473">:=</span>&nbsp;<span class="keyword" id="8001476">range</span>&nbsp;<span class="op" id="8001482">[</span><span class="op" id="8001483">]</span><span class="builtintype" id="8001484">string</span><span class="op" id="8001490">{</span><span class="string" id="8001491">&#34;&#34;</span><span class="op" id="8001493">,</span>&nbsp;<span class="string" id="8001495">&#34;127.0.0.1:0&#34;</span><span class="op" id="8001508">}</span>&nbsp;<span class="op" id="8001510">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001514">c1</span><span class="op" id="8001516">,</span>&nbsp;<span class="ident" id="8001518">err</span>&nbsp;<span class="op" id="8001522">:=</span>&nbsp;<span class="ident" id="8001525">ListenPacket</span><span class="op" id="8001537">(</span><span class="string" id="8001538">&#34;udp&#34;</span><span class="op" id="8001543">,</span>&nbsp;<span class="string" id="8001545">&#34;127.0.0.1:0&#34;</span><span class="op" id="8001558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001562">if</span>&nbsp;<span class="ident" id="8001565">err</span>&nbsp;<span class="op" id="8001569">!=</span>&nbsp;<span class="ident" id="8001572">nil</span>&nbsp;<span class="op" id="8001576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001581">t</span><span class="op" id="8001582">.</span><span class="ident" id="8001583">Fatalf</span><span class="op" id="8001589">(</span><span class="string" id="8001590">&#34;ListenUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8001612">,</span>&nbsp;<span class="ident" id="8001614">err</span><span class="op" id="8001617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001625">defer</span>&nbsp;<span class="ident" id="8001631">c1</span><span class="op" id="8001633">.</span><span class="ident" id="8001634">Close</span><span class="op" id="8001639">(</span><span class="op" id="8001640">)</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001645">var</span>&nbsp;<span class="ident" id="8001649">la</span>&nbsp;<span class="op" id="8001652">*</span><span class="ident" id="8001653">UDPAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001663">if</span>&nbsp;<span class="ident" id="8001666">laddr</span>&nbsp;<span class="op" id="8001672">!=</span>&nbsp;<span class="string" id="8001675">&#34;&#34;</span>&nbsp;<span class="op" id="8001678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001683">var</span>&nbsp;<span class="ident" id="8001687">err</span>&nbsp;<span class="builtintype" id="8001691">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001700">if</span>&nbsp;<span class="ident" id="8001703">la</span><span class="op" id="8001705">,</span>&nbsp;<span class="ident" id="8001707">err</span>&nbsp;<span class="op" id="8001711">=</span>&nbsp;<span class="ident" id="8001713">ResolveUDPAddr</span><span class="op" id="8001727">(</span><span class="string" id="8001728">&#34;udp&#34;</span><span class="op" id="8001733">,</span>&nbsp;<span class="ident" id="8001735">laddr</span><span class="op" id="8001740">)</span><span class="op" id="8001741">;</span>&nbsp;<span class="ident" id="8001743">err</span>&nbsp;<span class="op" id="8001747">!=</span>&nbsp;<span class="ident" id="8001750">nil</span>&nbsp;<span class="op" id="8001754">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001760">t</span><span class="op" id="8001761">.</span><span class="ident" id="8001762">Fatalf</span><span class="op" id="8001768">(</span><span class="string" id="8001769">&#34;ResolveUDPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8001796">,</span>&nbsp;<span class="ident" id="8001798">err</span><span class="op" id="8001801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001814">c2</span><span class="op" id="8001816">,</span>&nbsp;<span class="ident" id="8001818">err</span>&nbsp;<span class="op" id="8001822">:=</span>&nbsp;<span class="ident" id="8001825">DialUDP</span><span class="op" id="8001832">(</span><span class="string" id="8001833">&#34;udp&#34;</span><span class="op" id="8001838">,</span>&nbsp;<span class="ident" id="8001840">la</span><span class="op" id="8001842">,</span>&nbsp;<span class="ident" id="8001844">c1</span><span class="op" id="8001846">.</span><span class="ident" id="8001847">LocalAddr</span><span class="op" id="8001856">(</span><span class="op" id="8001857">)</span><span class="op" id="8001858">.</span><span class="op" id="8001859">(</span><span class="op" id="8001860">*</span><span class="ident" id="8001861">UDPAddr</span><span class="op" id="8001868">)</span><span class="op" id="8001869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001873">if</span>&nbsp;<span class="ident" id="8001876">err</span>&nbsp;<span class="op" id="8001880">!=</span>&nbsp;<span class="ident" id="8001883">nil</span>&nbsp;<span class="op" id="8001887">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001892">t</span><span class="op" id="8001893">.</span><span class="ident" id="8001894">Fatalf</span><span class="op" id="8001900">(</span><span class="string" id="8001901">&#34;DialUDP&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8001921">,</span>&nbsp;<span class="ident" id="8001923">err</span><span class="op" id="8001926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8001930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001934">defer</span>&nbsp;<span class="ident" id="8001940">c2</span><span class="op" id="8001942">.</span><span class="ident" id="8001943">Close</span><span class="op" id="8001948">(</span><span class="op" id="8001949">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8001954">var</span>&nbsp;<span class="ident" id="8001958">connAddrs</span>&nbsp;<span class="op" id="8001968">=</span>&nbsp;<span class="op" id="8001970">[</span><span class="num" id="8001971">4</span><span class="op" id="8001972">]</span><span class="keyword" id="8001973">struct</span>&nbsp;<span class="op" id="8001980">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001985">got</span>&nbsp;<span class="ident" id="8001989">Addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8001997">ok</span>&nbsp;&nbsp;<span class="builtintype" id="8002001">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002008">}</span><span class="op" id="8002009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002014">{</span><span class="ident" id="8002015">c1</span><span class="op" id="8002017">.</span><span class="ident" id="8002018">LocalAddr</span><span class="op" id="8002027">(</span><span class="op" id="8002028">)</span><span class="op" id="8002029">,</span>&nbsp;<span class="builtintype" id="8002031">true</span><span class="op" id="8002035">}</span><span class="op" id="8002036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002041">{</span><span class="ident" id="8002042">c1</span><span class="op" id="8002044">.</span><span class="op" id="8002045">(</span><span class="op" id="8002046">*</span><span class="ident" id="8002047">UDPConn</span><span class="op" id="8002054">)</span><span class="op" id="8002055">.</span><span class="ident" id="8002056">RemoteAddr</span><span class="op" id="8002066">(</span><span class="op" id="8002067">)</span><span class="op" id="8002068">,</span>&nbsp;<span class="builtintype" id="8002070">false</span><span class="op" id="8002075">}</span><span class="op" id="8002076">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002081">{</span><span class="ident" id="8002082">c2</span><span class="op" id="8002084">.</span><span class="ident" id="8002085">LocalAddr</span><span class="op" id="8002094">(</span><span class="op" id="8002095">)</span><span class="op" id="8002096">,</span>&nbsp;<span class="builtintype" id="8002098">true</span><span class="op" id="8002102">}</span><span class="op" id="8002103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002108">{</span><span class="ident" id="8002109">c2</span><span class="op" id="8002111">.</span><span class="ident" id="8002112">RemoteAddr</span><span class="op" id="8002122">(</span><span class="op" id="8002123">)</span><span class="op" id="8002124">,</span>&nbsp;<span class="builtintype" id="8002126">true</span><span class="op" id="8002130">}</span><span class="op" id="8002131">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002139">for</span>&nbsp;<span class="ident" id="8002143">_</span><span class="op" id="8002144">,</span>&nbsp;<span class="ident" id="8002146">ca</span>&nbsp;<span class="op" id="8002149">:=</span>&nbsp;<span class="keyword" id="8002152">range</span>&nbsp;<span class="ident" id="8002158">connAddrs</span>&nbsp;<span class="op" id="8002168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002173">if</span>&nbsp;<span class="ident" id="8002176">a</span><span class="op" id="8002177">,</span>&nbsp;<span class="ident" id="8002179">ok</span>&nbsp;<span class="op" id="8002182">:=</span>&nbsp;<span class="ident" id="8002185">ca</span><span class="op" id="8002187">.</span><span class="ident" id="8002188">got</span><span class="op" id="8002191">.</span><span class="op" id="8002192">(</span><span class="op" id="8002193">*</span><span class="ident" id="8002194">UDPAddr</span><span class="op" id="8002201">)</span><span class="op" id="8002202">;</span>&nbsp;<span class="ident" id="8002204">ok</span>&nbsp;<span class="op" id="8002207">!=</span>&nbsp;<span class="ident" id="8002210">ca</span><span class="op" id="8002212">.</span><span class="ident" id="8002213">ok</span>&nbsp;<span class="op" id="8002216">||</span>&nbsp;<span class="ident" id="8002219">ok</span>&nbsp;<span class="op" id="8002222">&amp;&amp;</span>&nbsp;<span class="ident" id="8002225">a</span><span class="op" id="8002226">.</span><span class="ident" id="8002227">Port</span>&nbsp;<span class="op" id="8002232">==</span>&nbsp;<span class="num" id="8002235">0</span>&nbsp;<span class="op" id="8002237">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002243">t</span><span class="op" id="8002244">.</span><span class="ident" id="8002245">Fatalf</span><span class="op" id="8002251">(</span><span class="string" id="8002252">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;non-zero&nbsp;port&nbsp;number&#34;</span><span class="op" id="8002313">,</span>&nbsp;<span class="ident" id="8002315">ca</span><span class="op" id="8002317">.</span><span class="ident" id="8002318">got</span><span class="op" id="8002321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002333">}</span><br>
<span class="lineno"></span><span class="op" id="8002335">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="8002338">func</span>&nbsp;<span class="ident" id="8002343">TestIPv6LinkLocalUnicastUDP</span><span class="op" id="8002370">(</span><span class="ident" id="8002371">t</span>&nbsp;<span class="op" id="8002373">*</span><span class="ident" id="8002374">testing</span><span class="op" id="8002381">.</span><span class="ident" id="8002382">T</span><span class="op" id="8002383">)</span>&nbsp;<span class="op" id="8002385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002388">if</span>&nbsp;<span class="ident" id="8002391">testing</span><span class="op" id="8002398">.</span><span class="ident" id="8002399">Short</span><span class="op" id="8002404">(</span><span class="op" id="8002405">)</span>&nbsp;<span class="op" id="8002407">||</span>&nbsp;<span class="op" id="8002410">!</span><span class="op" id="8002411">*</span><span class="ident" id="8002412">testExternal</span>&nbsp;<span class="op" id="8002425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002429">t</span><span class="op" id="8002430">.</span><span class="ident" id="8002431">Skip</span><span class="op" id="8002435">(</span><span class="string" id="8002436">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="8002477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002480">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002483">if</span>&nbsp;<span class="op" id="8002486">!</span><span class="ident" id="8002487">supportsIPv6</span>&nbsp;<span class="op" id="8002500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002504">t</span><span class="op" id="8002505">.</span><span class="ident" id="8002506">Skip</span><span class="op" id="8002510">(</span><span class="string" id="8002511">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="8002534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002540">ifi</span>&nbsp;<span class="op" id="8002544">:=</span>&nbsp;<span class="ident" id="8002547">loopbackInterface</span><span class="op" id="8002564">(</span><span class="op" id="8002565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002568">if</span>&nbsp;<span class="ident" id="8002571">ifi</span>&nbsp;<span class="op" id="8002575">==</span>&nbsp;<span class="ident" id="8002578">nil</span>&nbsp;<span class="op" id="8002582">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002586">t</span><span class="op" id="8002587">.</span><span class="ident" id="8002588">Skip</span><span class="op" id="8002592">(</span><span class="string" id="8002593">&#34;loopback&nbsp;interface&nbsp;not&nbsp;found&#34;</span><span class="op" id="8002623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002629">laddr</span>&nbsp;<span class="op" id="8002635">:=</span>&nbsp;<span class="ident" id="8002638">ipv6LinkLocalUnicastAddr</span><span class="op" id="8002662">(</span><span class="ident" id="8002663">ifi</span><span class="op" id="8002666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002669">if</span>&nbsp;<span class="ident" id="8002672">laddr</span>&nbsp;<span class="op" id="8002678">==</span>&nbsp;<span class="string" id="8002681">&#34;&#34;</span>&nbsp;<span class="op" id="8002684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002688">t</span><span class="op" id="8002689">.</span><span class="ident" id="8002690">Skip</span><span class="op" id="8002694">(</span><span class="string" id="8002695">&#34;ipv6&nbsp;unicast&nbsp;address&nbsp;on&nbsp;loopback&nbsp;not&nbsp;found&#34;</span><span class="op" id="8002739">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002746">type</span>&nbsp;<span class="ident" id="8002751">test</span>&nbsp;<span class="keyword" id="8002756">struct</span>&nbsp;<span class="op" id="8002763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002767">net</span><span class="op" id="8002770">,</span>&nbsp;<span class="ident" id="8002772">addr</span>&nbsp;&nbsp;<span class="builtintype" id="8002778">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8002787">nameLookup</span>&nbsp;<span class="builtintype" id="8002798">bool</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8002807">var</span>&nbsp;<span class="ident" id="8002811">tests</span>&nbsp;<span class="op" id="8002817">=</span>&nbsp;<span class="op" id="8002819">[</span><span class="op" id="8002820">]</span><span class="ident" id="8002821">test</span><span class="op" id="8002825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002829">{</span><span class="string" id="8002830">&#34;udp&#34;</span><span class="op" id="8002835">,</span>&nbsp;<span class="string" id="8002837">&#34;[&#34;</span>&nbsp;<span class="op" id="8002841">+</span>&nbsp;<span class="ident" id="8002843">laddr</span>&nbsp;<span class="op" id="8002849">+</span>&nbsp;<span class="string" id="8002851">&#34;%&#34;</span>&nbsp;<span class="op" id="8002855">+</span>&nbsp;<span class="ident" id="8002857">ifi</span><span class="op" id="8002860">.</span><span class="ident" id="8002861">Name</span>&nbsp;<span class="op" id="8002866">+</span>&nbsp;<span class="string" id="8002868">&#34;]:0&#34;</span><span class="op" id="8002873">,</span>&nbsp;<span class="builtintype" id="8002875">false</span><span class="op" id="8002880">}</span><span class="op" id="8002881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002885">{</span><span class="string" id="8002886">&#34;udp6&#34;</span><span class="op" id="8002892">,</span>&nbsp;<span class="string" id="8002894">&#34;[&#34;</span>&nbsp;<span class="op" id="8002898">+</span>&nbsp;<span class="ident" id="8002900">laddr</span>&nbsp;<span class="op" id="8002906">+</span>&nbsp;<span class="string" id="8002908">&#34;%&#34;</span>&nbsp;<span class="op" id="8002912">+</span>&nbsp;<span class="ident" id="8002914">ifi</span><span class="op" id="8002917">.</span><span class="ident" id="8002918">Name</span>&nbsp;<span class="op" id="8002923">+</span>&nbsp;<span class="string" id="8002925">&#34;]:0&#34;</span><span class="op" id="8002930">,</span>&nbsp;<span class="builtintype" id="8002932">false</span><span class="op" id="8002937">}</span><span class="op" id="8002938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8002941">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8002944">//&nbsp;The&nbsp;first&nbsp;udp&nbsp;test&nbsp;fails&nbsp;on&nbsp;DragonFly&nbsp;-&nbsp;see&nbsp;issue&nbsp;7473.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003004">if</span>&nbsp;<span class="ident" id="8003007">runtime</span><span class="op" id="8003014">.</span><span class="ident" id="8003015">GOOS</span>&nbsp;<span class="op" id="8003020">==</span>&nbsp;<span class="string" id="8003023">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="8003035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003039">tests</span>&nbsp;<span class="op" id="8003045">=</span>&nbsp;<span class="ident" id="8003047">tests</span><span class="op" id="8003052">[</span><span class="num" id="8003053">1</span><span class="op" id="8003054">:</span><span class="op" id="8003055">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003061">switch</span>&nbsp;<span class="ident" id="8003068">runtime</span><span class="op" id="8003075">.</span><span class="ident" id="8003076">GOOS</span>&nbsp;<span class="op" id="8003081">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003084">case</span>&nbsp;<span class="string" id="8003089">&#34;darwin&#34;</span><span class="op" id="8003097">,</span>&nbsp;<span class="string" id="8003099">&#34;dragonfly&#34;</span><span class="op" id="8003110">,</span>&nbsp;<span class="string" id="8003112">&#34;freebsd&#34;</span><span class="op" id="8003121">,</span>&nbsp;<span class="string" id="8003123">&#34;openbsd&#34;</span><span class="op" id="8003132">,</span>&nbsp;<span class="string" id="8003134">&#34;netbsd&#34;</span><span class="op" id="8003142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003146">tests</span>&nbsp;<span class="op" id="8003152">=</span>&nbsp;<span class="builtinfunc" id="8003154">append</span><span class="op" id="8003160">(</span><span class="ident" id="8003161">tests</span><span class="op" id="8003166">,</span>&nbsp;<span class="op" id="8003168">[</span><span class="op" id="8003169">]</span><span class="ident" id="8003170">test</span><span class="op" id="8003174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003179">{</span><span class="string" id="8003180">&#34;udp&#34;</span><span class="op" id="8003185">,</span>&nbsp;<span class="string" id="8003187">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="8003201">+</span>&nbsp;<span class="ident" id="8003203">ifi</span><span class="op" id="8003206">.</span><span class="ident" id="8003207">Name</span>&nbsp;<span class="op" id="8003212">+</span>&nbsp;<span class="string" id="8003214">&#34;]:0&#34;</span><span class="op" id="8003219">,</span>&nbsp;<span class="builtintype" id="8003221">true</span><span class="op" id="8003225">}</span><span class="op" id="8003226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003231">{</span><span class="string" id="8003232">&#34;udp6&#34;</span><span class="op" id="8003238">,</span>&nbsp;<span class="string" id="8003240">&#34;[localhost%&#34;</span>&nbsp;<span class="op" id="8003254">+</span>&nbsp;<span class="ident" id="8003256">ifi</span><span class="op" id="8003259">.</span><span class="ident" id="8003260">Name</span>&nbsp;<span class="op" id="8003265">+</span>&nbsp;<span class="string" id="8003267">&#34;]:0&#34;</span><span class="op" id="8003272">,</span>&nbsp;<span class="builtintype" id="8003274">true</span><span class="op" id="8003278">}</span><span class="op" id="8003279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003283">}</span><span class="op" id="8003284">...</span><span class="op" id="8003287">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003290">case</span>&nbsp;<span class="string" id="8003295">&#34;linux&#34;</span><span class="op" id="8003302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003306">tests</span>&nbsp;<span class="op" id="8003312">=</span>&nbsp;<span class="builtinfunc" id="8003314">append</span><span class="op" id="8003320">(</span><span class="ident" id="8003321">tests</span><span class="op" id="8003326">,</span>&nbsp;<span class="op" id="8003328">[</span><span class="op" id="8003329">]</span><span class="ident" id="8003330">test</span><span class="op" id="8003334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003339">{</span><span class="string" id="8003340">&#34;udp&#34;</span><span class="op" id="8003345">,</span>&nbsp;<span class="string" id="8003347">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="8003365">+</span>&nbsp;<span class="ident" id="8003367">ifi</span><span class="op" id="8003370">.</span><span class="ident" id="8003371">Name</span>&nbsp;<span class="op" id="8003376">+</span>&nbsp;<span class="string" id="8003378">&#34;]:0&#34;</span><span class="op" id="8003383">,</span>&nbsp;<span class="builtintype" id="8003385">true</span><span class="op" id="8003389">}</span><span class="op" id="8003390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003395">{</span><span class="string" id="8003396">&#34;udp6&#34;</span><span class="op" id="8003402">,</span>&nbsp;<span class="string" id="8003404">&#34;[ip6-localhost%&#34;</span>&nbsp;<span class="op" id="8003422">+</span>&nbsp;<span class="ident" id="8003424">ifi</span><span class="op" id="8003427">.</span><span class="ident" id="8003428">Name</span>&nbsp;<span class="op" id="8003433">+</span>&nbsp;<span class="string" id="8003435">&#34;]:0&#34;</span><span class="op" id="8003440">,</span>&nbsp;<span class="builtintype" id="8003442">true</span><span class="op" id="8003446">}</span><span class="op" id="8003447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003451">}</span><span class="op" id="8003452">...</span><span class="op" id="8003455">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003461">for</span>&nbsp;<span class="ident" id="8003465">_</span><span class="op" id="8003466">,</span>&nbsp;<span class="ident" id="8003468">tt</span>&nbsp;<span class="op" id="8003471">:=</span>&nbsp;<span class="keyword" id="8003474">range</span>&nbsp;<span class="ident" id="8003480">tests</span>&nbsp;<span class="op" id="8003486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003490">c1</span><span class="op" id="8003492">,</span>&nbsp;<span class="ident" id="8003494">err</span>&nbsp;<span class="op" id="8003498">:=</span>&nbsp;<span class="ident" id="8003501">ListenPacket</span><span class="op" id="8003513">(</span><span class="ident" id="8003514">tt</span><span class="op" id="8003516">.</span><span class="ident" id="8003517">net</span><span class="op" id="8003520">,</span>&nbsp;<span class="ident" id="8003522">tt</span><span class="op" id="8003524">.</span><span class="ident" id="8003525">addr</span><span class="op" id="8003529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003533">if</span>&nbsp;<span class="ident" id="8003536">err</span>&nbsp;<span class="op" id="8003540">!=</span>&nbsp;<span class="ident" id="8003543">nil</span>&nbsp;<span class="op" id="8003547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8003552">//&nbsp;It&nbsp;might&nbsp;return&nbsp;&#34;LookupHost&nbsp;returned&nbsp;no</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8003598">//&nbsp;suitable&nbsp;address&#34;&nbsp;error&nbsp;on&nbsp;some&nbsp;platforms.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003647">t</span><span class="op" id="8003648">.</span><span class="ident" id="8003649">Logf</span><span class="op" id="8003653">(</span><span class="string" id="8003654">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8003679">,</span>&nbsp;<span class="ident" id="8003681">err</span><span class="op" id="8003684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003689">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003704">defer</span>&nbsp;<span class="ident" id="8003710">c1</span><span class="op" id="8003712">.</span><span class="ident" id="8003713">Close</span><span class="op" id="8003718">(</span><span class="op" id="8003719">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003723">if</span>&nbsp;<span class="ident" id="8003726">la</span><span class="op" id="8003728">,</span>&nbsp;<span class="ident" id="8003730">ok</span>&nbsp;<span class="op" id="8003733">:=</span>&nbsp;<span class="ident" id="8003736">c1</span><span class="op" id="8003738">.</span><span class="ident" id="8003739">LocalAddr</span><span class="op" id="8003748">(</span><span class="op" id="8003749">)</span><span class="op" id="8003750">.</span><span class="op" id="8003751">(</span><span class="op" id="8003752">*</span><span class="ident" id="8003753">UDPAddr</span><span class="op" id="8003760">)</span><span class="op" id="8003761">;</span>&nbsp;<span class="op" id="8003763">!</span><span class="ident" id="8003764">ok</span>&nbsp;<span class="op" id="8003767">||</span>&nbsp;<span class="op" id="8003770">!</span><span class="ident" id="8003771">tt</span><span class="op" id="8003773">.</span><span class="ident" id="8003774">nameLookup</span>&nbsp;<span class="op" id="8003785">&amp;&amp;</span>&nbsp;<span class="ident" id="8003788">la</span><span class="op" id="8003790">.</span><span class="ident" id="8003791">Zone</span>&nbsp;<span class="op" id="8003796">==</span>&nbsp;<span class="string" id="8003799">&#34;&#34;</span>&nbsp;<span class="op" id="8003802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003807">t</span><span class="op" id="8003808">.</span><span class="ident" id="8003809">Fatalf</span><span class="op" id="8003815">(</span><span class="string" id="8003816">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8003872">,</span>&nbsp;<span class="ident" id="8003874">la</span><span class="op" id="8003876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003885">c2</span><span class="op" id="8003887">,</span>&nbsp;<span class="ident" id="8003889">err</span>&nbsp;<span class="op" id="8003893">:=</span>&nbsp;<span class="ident" id="8003896">Dial</span><span class="op" id="8003900">(</span><span class="ident" id="8003901">tt</span><span class="op" id="8003903">.</span><span class="ident" id="8003904">net</span><span class="op" id="8003907">,</span>&nbsp;<span class="ident" id="8003909">c1</span><span class="op" id="8003911">.</span><span class="ident" id="8003912">LocalAddr</span><span class="op" id="8003921">(</span><span class="op" id="8003922">)</span><span class="op" id="8003923">.</span><span class="ident" id="8003924">String</span><span class="op" id="8003930">(</span><span class="op" id="8003931">)</span><span class="op" id="8003932">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003936">if</span>&nbsp;<span class="ident" id="8003939">err</span>&nbsp;<span class="op" id="8003943">!=</span>&nbsp;<span class="ident" id="8003946">nil</span>&nbsp;<span class="op" id="8003950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8003955">t</span><span class="op" id="8003956">.</span><span class="ident" id="8003957">Fatalf</span><span class="op" id="8003963">(</span><span class="string" id="8003964">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8003981">,</span>&nbsp;<span class="ident" id="8003983">err</span><span class="op" id="8003986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8003990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8003994">defer</span>&nbsp;<span class="ident" id="8004000">c2</span><span class="op" id="8004002">.</span><span class="ident" id="8004003">Close</span><span class="op" id="8004008">(</span><span class="op" id="8004009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004013">if</span>&nbsp;<span class="ident" id="8004016">la</span><span class="op" id="8004018">,</span>&nbsp;<span class="ident" id="8004020">ok</span>&nbsp;<span class="op" id="8004023">:=</span>&nbsp;<span class="ident" id="8004026">c2</span><span class="op" id="8004028">.</span><span class="ident" id="8004029">LocalAddr</span><span class="op" id="8004038">(</span><span class="op" id="8004039">)</span><span class="op" id="8004040">.</span><span class="op" id="8004041">(</span><span class="op" id="8004042">*</span><span class="ident" id="8004043">UDPAddr</span><span class="op" id="8004050">)</span><span class="op" id="8004051">;</span>&nbsp;<span class="op" id="8004053">!</span><span class="ident" id="8004054">ok</span>&nbsp;<span class="op" id="8004057">||</span>&nbsp;<span class="op" id="8004060">!</span><span class="ident" id="8004061">tt</span><span class="op" id="8004063">.</span><span class="ident" id="8004064">nameLookup</span>&nbsp;<span class="op" id="8004075">&amp;&amp;</span>&nbsp;<span class="ident" id="8004078">la</span><span class="op" id="8004080">.</span><span class="ident" id="8004081">Zone</span>&nbsp;<span class="op" id="8004086">==</span>&nbsp;<span class="string" id="8004089">&#34;&#34;</span>&nbsp;<span class="op" id="8004092">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004097">t</span><span class="op" id="8004098">.</span><span class="ident" id="8004099">Fatalf</span><span class="op" id="8004105">(</span><span class="string" id="8004106">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8004162">,</span>&nbsp;<span class="ident" id="8004164">la</span><span class="op" id="8004166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004174">if</span>&nbsp;<span class="ident" id="8004177">ra</span><span class="op" id="8004179">,</span>&nbsp;<span class="ident" id="8004181">ok</span>&nbsp;<span class="op" id="8004184">:=</span>&nbsp;<span class="ident" id="8004187">c2</span><span class="op" id="8004189">.</span><span class="ident" id="8004190">RemoteAddr</span><span class="op" id="8004200">(</span><span class="op" id="8004201">)</span><span class="op" id="8004202">.</span><span class="op" id="8004203">(</span><span class="op" id="8004204">*</span><span class="ident" id="8004205">UDPAddr</span><span class="op" id="8004212">)</span><span class="op" id="8004213">;</span>&nbsp;<span class="op" id="8004215">!</span><span class="ident" id="8004216">ok</span>&nbsp;<span class="op" id="8004219">||</span>&nbsp;<span class="op" id="8004222">!</span><span class="ident" id="8004223">tt</span><span class="op" id="8004225">.</span><span class="ident" id="8004226">nameLookup</span>&nbsp;<span class="op" id="8004237">&amp;&amp;</span>&nbsp;<span class="ident" id="8004240">ra</span><span class="op" id="8004242">.</span><span class="ident" id="8004243">Zone</span>&nbsp;<span class="op" id="8004248">==</span>&nbsp;<span class="string" id="8004251">&#34;&#34;</span>&nbsp;<span class="op" id="8004254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004259">t</span><span class="op" id="8004260">.</span><span class="ident" id="8004261">Fatalf</span><span class="op" id="8004267">(</span><span class="string" id="8004268">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8004324">,</span>&nbsp;<span class="ident" id="8004326">ra</span><span class="op" id="8004328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004332">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004337">if</span>&nbsp;<span class="ident" id="8004340">_</span><span class="op" id="8004341">,</span>&nbsp;<span class="ident" id="8004343">err</span>&nbsp;<span class="op" id="8004347">:=</span>&nbsp;<span class="ident" id="8004350">c2</span><span class="op" id="8004352">.</span><span class="ident" id="8004353">Write</span><span class="op" id="8004358">(</span><span class="op" id="8004359">[</span><span class="op" id="8004360">]</span><span class="builtintype" id="8004361">byte</span><span class="op" id="8004365">(</span><span class="string" id="8004366">&#34;UDP&nbsp;OVER&nbsp;IPV6&nbsp;LINKLOCAL&nbsp;TEST&#34;</span><span class="op" id="8004396">)</span><span class="op" id="8004397">)</span><span class="op" id="8004398">;</span>&nbsp;<span class="ident" id="8004400">err</span>&nbsp;<span class="op" id="8004404">!=</span>&nbsp;<span class="ident" id="8004407">nil</span>&nbsp;<span class="op" id="8004411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004416">t</span><span class="op" id="8004417">.</span><span class="ident" id="8004418">Fatalf</span><span class="op" id="8004424">(</span><span class="string" id="8004425">&#34;Conn.Write&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004448">,</span>&nbsp;<span class="ident" id="8004450">err</span><span class="op" id="8004453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004461">b</span>&nbsp;<span class="op" id="8004463">:=</span>&nbsp;<span class="builtinfunc" id="8004466">make</span><span class="op" id="8004470">(</span><span class="op" id="8004471">[</span><span class="op" id="8004472">]</span><span class="builtintype" id="8004473">byte</span><span class="op" id="8004477">,</span>&nbsp;<span class="num" id="8004479">32</span><span class="op" id="8004481">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004485">if</span>&nbsp;<span class="ident" id="8004488">_</span><span class="op" id="8004489">,</span>&nbsp;<span class="ident" id="8004491">from</span><span class="op" id="8004495">,</span>&nbsp;<span class="ident" id="8004497">err</span>&nbsp;<span class="op" id="8004501">:=</span>&nbsp;<span class="ident" id="8004504">c1</span><span class="op" id="8004506">.</span><span class="ident" id="8004507">ReadFrom</span><span class="op" id="8004515">(</span><span class="ident" id="8004516">b</span><span class="op" id="8004517">)</span><span class="op" id="8004518">;</span>&nbsp;<span class="ident" id="8004520">err</span>&nbsp;<span class="op" id="8004524">!=</span>&nbsp;<span class="ident" id="8004527">nil</span>&nbsp;<span class="op" id="8004531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004536">t</span><span class="op" id="8004537">.</span><span class="ident" id="8004538">Fatalf</span><span class="op" id="8004544">(</span><span class="string" id="8004545">&#34;PacketConn.ReadFrom&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8004577">,</span>&nbsp;<span class="ident" id="8004579">err</span><span class="op" id="8004582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004586">}</span>&nbsp;<span class="keyword" id="8004588">else</span>&nbsp;<span class="op" id="8004593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8004598">if</span>&nbsp;<span class="ident" id="8004601">ra</span><span class="op" id="8004603">,</span>&nbsp;<span class="ident" id="8004605">ok</span>&nbsp;<span class="op" id="8004608">:=</span>&nbsp;<span class="ident" id="8004611">from</span><span class="op" id="8004615">.</span><span class="op" id="8004616">(</span><span class="op" id="8004617">*</span><span class="ident" id="8004618">UDPAddr</span><span class="op" id="8004625">)</span><span class="op" id="8004626">;</span>&nbsp;<span class="op" id="8004628">!</span><span class="ident" id="8004629">ok</span>&nbsp;<span class="op" id="8004632">||</span>&nbsp;<span class="op" id="8004635">!</span><span class="ident" id="8004636">tt</span><span class="op" id="8004638">.</span><span class="ident" id="8004639">nameLookup</span>&nbsp;<span class="op" id="8004650">&amp;&amp;</span>&nbsp;<span class="ident" id="8004653">ra</span><span class="op" id="8004655">.</span><span class="ident" id="8004656">Zone</span>&nbsp;<span class="op" id="8004661">==</span>&nbsp;<span class="string" id="8004664">&#34;&#34;</span>&nbsp;<span class="op" id="8004667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8004673">t</span><span class="op" id="8004674">.</span><span class="ident" id="8004675">Fatalf</span><span class="op" id="8004681">(</span><span class="string" id="8004682">&#34;got&nbsp;%v;&nbsp;expected&nbsp;a&nbsp;proper&nbsp;address&nbsp;with&nbsp;zone&nbsp;identifier&#34;</span><span class="op" id="8004738">,</span>&nbsp;<span class="ident" id="8004740">ra</span><span class="op" id="8004742">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8004754">}</span><br>
<span class="lineno"></span><span class="op" id="8004756">}</span>
</div>
</body>
</html>
