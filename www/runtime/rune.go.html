<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1666431">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;The&nbsp;authors&nbsp;of&nbsp;this&nbsp;software&nbsp;are&nbsp;Rob&nbsp;Pike&nbsp;and&nbsp;Ken&nbsp;Thompson.<br>
<span class="lineno"></span>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;(c)&nbsp;2002&nbsp;by&nbsp;Lucent&nbsp;Technologies.<br>
<span class="lineno"></span>&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Portions&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.<br>
<span class="lineno">5</span>&nbsp;*&nbsp;Permission&nbsp;to&nbsp;use,&nbsp;copy,&nbsp;modify,&nbsp;and&nbsp;distribute&nbsp;this&nbsp;software&nbsp;for&nbsp;any<br>
<span class="lineno"></span>&nbsp;*&nbsp;purpose&nbsp;without&nbsp;fee&nbsp;is&nbsp;hereby&nbsp;granted,&nbsp;provided&nbsp;that&nbsp;this&nbsp;entire&nbsp;notice<br>
<span class="lineno"></span>&nbsp;*&nbsp;is&nbsp;included&nbsp;in&nbsp;all&nbsp;copies&nbsp;of&nbsp;any&nbsp;software&nbsp;which&nbsp;is&nbsp;or&nbsp;includes&nbsp;a&nbsp;copy<br>
<span class="lineno"></span>&nbsp;*&nbsp;or&nbsp;modification&nbsp;of&nbsp;this&nbsp;software&nbsp;and&nbsp;in&nbsp;all&nbsp;copies&nbsp;of&nbsp;the&nbsp;supporting<br>
<span class="lineno"></span>&nbsp;*&nbsp;documentation&nbsp;for&nbsp;such&nbsp;software.<br>
<span class="lineno">10</span>&nbsp;*&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;BEING&nbsp;PROVIDED&nbsp;&#34;AS&nbsp;IS&#34;,&nbsp;WITHOUT&nbsp;ANY&nbsp;EXPRESS&nbsp;OR&nbsp;IMPLIED<br>
<span class="lineno"></span>&nbsp;*&nbsp;WARRANTY.&nbsp;&nbsp;IN&nbsp;PARTICULAR,&nbsp;NEITHER&nbsp;THE&nbsp;AUTHORS&nbsp;NOR&nbsp;LUCENT&nbsp;TECHNOLOGIES&nbsp;MAKE&nbsp;ANY<br>
<span class="lineno"></span>&nbsp;*&nbsp;REPRESENTATION&nbsp;OR&nbsp;WARRANTY&nbsp;OF&nbsp;ANY&nbsp;KIND&nbsp;CONCERNING&nbsp;THE&nbsp;MERCHANTABILITY<br>
<span class="lineno"></span>&nbsp;*&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE&nbsp;OR&nbsp;ITS&nbsp;FITNESS&nbsp;FOR&nbsp;ANY&nbsp;PARTICULAR&nbsp;PURPOSE.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="1667260">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;This&nbsp;code&nbsp;is&nbsp;copied,&nbsp;with&nbsp;slight&nbsp;editing&nbsp;due&nbsp;to&nbsp;type&nbsp;differences,<br>
<span class="lineno"></span>&nbsp;*&nbsp;from&nbsp;a&nbsp;subset&nbsp;of&nbsp;../lib9/utf/rune.c<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1667376">package</span>&nbsp;<span class="ident" id="1667384">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1667393">const</span>&nbsp;<span class="op" id="1667399">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667402">bit1</span>&nbsp;<span class="op" id="1667407">=</span>&nbsp;<span class="num" id="1667409">7</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667412">bitx</span>&nbsp;<span class="op" id="1667417">=</span>&nbsp;<span class="num" id="1667419">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667422">bit2</span>&nbsp;<span class="op" id="1667427">=</span>&nbsp;<span class="num" id="1667429">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667432">bit3</span>&nbsp;<span class="op" id="1667437">=</span>&nbsp;<span class="num" id="1667439">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667442">bit4</span>&nbsp;<span class="op" id="1667447">=</span>&nbsp;<span class="num" id="1667449">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667452">bit5</span>&nbsp;<span class="op" id="1667457">=</span>&nbsp;<span class="num" id="1667459">2</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667463">t1</span>&nbsp;<span class="op" id="1667466">=</span>&nbsp;<span class="op" id="1667468">(</span><span class="op" id="1667469">(</span><span class="num" id="1667470">1</span>&nbsp;<span class="op" id="1667472">&lt;&lt;</span>&nbsp;<span class="op" id="1667475">(</span><span class="ident" id="1667476">bit1</span>&nbsp;<span class="op" id="1667481">+</span>&nbsp;<span class="num" id="1667483">1</span><span class="op" id="1667484">)</span><span class="op" id="1667485">)</span>&nbsp;<span class="op" id="1667487">-</span>&nbsp;<span class="num" id="1667489">1</span><span class="op" id="1667490">)</span>&nbsp;<span class="op" id="1667492">^</span>&nbsp;<span class="num" id="1667494">0xFF</span>&nbsp;<span class="comment" id="1667499">/*&nbsp;0000&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667516">tx</span>&nbsp;<span class="op" id="1667519">=</span>&nbsp;<span class="op" id="1667521">(</span><span class="op" id="1667522">(</span><span class="num" id="1667523">1</span>&nbsp;<span class="op" id="1667525">&lt;&lt;</span>&nbsp;<span class="op" id="1667528">(</span><span class="ident" id="1667529">bitx</span>&nbsp;<span class="op" id="1667534">+</span>&nbsp;<span class="num" id="1667536">1</span><span class="op" id="1667537">)</span><span class="op" id="1667538">)</span>&nbsp;<span class="op" id="1667540">-</span>&nbsp;<span class="num" id="1667542">1</span><span class="op" id="1667543">)</span>&nbsp;<span class="op" id="1667545">^</span>&nbsp;<span class="num" id="1667547">0xFF</span>&nbsp;<span class="comment" id="1667552">/*&nbsp;1000&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667569">t2</span>&nbsp;<span class="op" id="1667572">=</span>&nbsp;<span class="op" id="1667574">(</span><span class="op" id="1667575">(</span><span class="num" id="1667576">1</span>&nbsp;<span class="op" id="1667578">&lt;&lt;</span>&nbsp;<span class="op" id="1667581">(</span><span class="ident" id="1667582">bit2</span>&nbsp;<span class="op" id="1667587">+</span>&nbsp;<span class="num" id="1667589">1</span><span class="op" id="1667590">)</span><span class="op" id="1667591">)</span>&nbsp;<span class="op" id="1667593">-</span>&nbsp;<span class="num" id="1667595">1</span><span class="op" id="1667596">)</span>&nbsp;<span class="op" id="1667598">^</span>&nbsp;<span class="num" id="1667600">0xFF</span>&nbsp;<span class="comment" id="1667605">/*&nbsp;1100&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667622">t3</span>&nbsp;<span class="op" id="1667625">=</span>&nbsp;<span class="op" id="1667627">(</span><span class="op" id="1667628">(</span><span class="num" id="1667629">1</span>&nbsp;<span class="op" id="1667631">&lt;&lt;</span>&nbsp;<span class="op" id="1667634">(</span><span class="ident" id="1667635">bit3</span>&nbsp;<span class="op" id="1667640">+</span>&nbsp;<span class="num" id="1667642">1</span><span class="op" id="1667643">)</span><span class="op" id="1667644">)</span>&nbsp;<span class="op" id="1667646">-</span>&nbsp;<span class="num" id="1667648">1</span><span class="op" id="1667649">)</span>&nbsp;<span class="op" id="1667651">^</span>&nbsp;<span class="num" id="1667653">0xFF</span>&nbsp;<span class="comment" id="1667658">/*&nbsp;1110&nbsp;0000&nbsp;*/</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667675">t4</span>&nbsp;<span class="op" id="1667678">=</span>&nbsp;<span class="op" id="1667680">(</span><span class="op" id="1667681">(</span><span class="num" id="1667682">1</span>&nbsp;<span class="op" id="1667684">&lt;&lt;</span>&nbsp;<span class="op" id="1667687">(</span><span class="ident" id="1667688">bit4</span>&nbsp;<span class="op" id="1667693">+</span>&nbsp;<span class="num" id="1667695">1</span><span class="op" id="1667696">)</span><span class="op" id="1667697">)</span>&nbsp;<span class="op" id="1667699">-</span>&nbsp;<span class="num" id="1667701">1</span><span class="op" id="1667702">)</span>&nbsp;<span class="op" id="1667704">^</span>&nbsp;<span class="num" id="1667706">0xFF</span>&nbsp;<span class="comment" id="1667711">/*&nbsp;1111&nbsp;0000&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667728">t5</span>&nbsp;<span class="op" id="1667731">=</span>&nbsp;<span class="op" id="1667733">(</span><span class="op" id="1667734">(</span><span class="num" id="1667735">1</span>&nbsp;<span class="op" id="1667737">&lt;&lt;</span>&nbsp;<span class="op" id="1667740">(</span><span class="ident" id="1667741">bit5</span>&nbsp;<span class="op" id="1667746">+</span>&nbsp;<span class="num" id="1667748">1</span><span class="op" id="1667749">)</span><span class="op" id="1667750">)</span>&nbsp;<span class="op" id="1667752">-</span>&nbsp;<span class="num" id="1667754">1</span><span class="op" id="1667755">)</span>&nbsp;<span class="op" id="1667757">^</span>&nbsp;<span class="num" id="1667759">0xFF</span>&nbsp;<span class="comment" id="1667764">/*&nbsp;1111&nbsp;1000&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667782">rune1</span>&nbsp;<span class="op" id="1667788">=</span>&nbsp;<span class="op" id="1667790">(</span><span class="num" id="1667791">1</span>&nbsp;<span class="op" id="1667793">&lt;&lt;</span>&nbsp;<span class="op" id="1667796">(</span><span class="ident" id="1667797">bit1</span>&nbsp;<span class="op" id="1667802">+</span>&nbsp;<span class="num" id="1667804">0</span><span class="op" id="1667805">*</span><span class="ident" id="1667806">bitx</span><span class="op" id="1667810">)</span><span class="op" id="1667811">)</span>&nbsp;<span class="op" id="1667813">-</span>&nbsp;<span class="num" id="1667815">1</span>&nbsp;<span class="comment" id="1667817">/*&nbsp;0000&nbsp;0000&nbsp;0111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667844">rune2</span>&nbsp;<span class="op" id="1667850">=</span>&nbsp;<span class="op" id="1667852">(</span><span class="num" id="1667853">1</span>&nbsp;<span class="op" id="1667855">&lt;&lt;</span>&nbsp;<span class="op" id="1667858">(</span><span class="ident" id="1667859">bit2</span>&nbsp;<span class="op" id="1667864">+</span>&nbsp;<span class="num" id="1667866">1</span><span class="op" id="1667867">*</span><span class="ident" id="1667868">bitx</span><span class="op" id="1667872">)</span><span class="op" id="1667873">)</span>&nbsp;<span class="op" id="1667875">-</span>&nbsp;<span class="num" id="1667877">1</span>&nbsp;<span class="comment" id="1667879">/*&nbsp;0000&nbsp;0111&nbsp;1111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667906">rune3</span>&nbsp;<span class="op" id="1667912">=</span>&nbsp;<span class="op" id="1667914">(</span><span class="num" id="1667915">1</span>&nbsp;<span class="op" id="1667917">&lt;&lt;</span>&nbsp;<span class="op" id="1667920">(</span><span class="ident" id="1667921">bit3</span>&nbsp;<span class="op" id="1667926">+</span>&nbsp;<span class="num" id="1667928">2</span><span class="op" id="1667929">*</span><span class="ident" id="1667930">bitx</span><span class="op" id="1667934">)</span><span class="op" id="1667935">)</span>&nbsp;<span class="op" id="1667937">-</span>&nbsp;<span class="num" id="1667939">1</span>&nbsp;<span class="comment" id="1667941">/*&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1667968">rune4</span>&nbsp;<span class="op" id="1667974">=</span>&nbsp;<span class="op" id="1667976">(</span><span class="num" id="1667977">1</span>&nbsp;<span class="op" id="1667979">&lt;&lt;</span>&nbsp;<span class="op" id="1667982">(</span><span class="ident" id="1667983">bit4</span>&nbsp;<span class="op" id="1667988">+</span>&nbsp;<span class="num" id="1667990">3</span><span class="op" id="1667991">*</span><span class="ident" id="1667992">bitx</span><span class="op" id="1667996">)</span><span class="op" id="1667997">)</span>&nbsp;<span class="op" id="1667999">-</span>&nbsp;<span class="num" id="1668001">1</span>&nbsp;<span class="comment" id="1668003">/*&nbsp;0001&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668041">maskx</span>&nbsp;<span class="op" id="1668047">=</span>&nbsp;<span class="op" id="1668049">(</span><span class="num" id="1668050">1</span>&nbsp;<span class="op" id="1668052">&lt;&lt;</span>&nbsp;<span class="ident" id="1668055">bitx</span><span class="op" id="1668059">)</span>&nbsp;<span class="op" id="1668061">-</span>&nbsp;<span class="num" id="1668063">1</span>&nbsp;<span class="comment" id="1668065">/*&nbsp;0011&nbsp;1111&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668082">testx</span>&nbsp;<span class="op" id="1668088">=</span>&nbsp;<span class="ident" id="1668090">maskx</span>&nbsp;<span class="op" id="1668096">^</span>&nbsp;<span class="num" id="1668098">0xFF</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1668106">/*&nbsp;1100&nbsp;0000&nbsp;*/</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668124">runeerror</span>&nbsp;<span class="op" id="1668134">=</span>&nbsp;<span class="num" id="1668136">0xFFFD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668144">runeself</span>&nbsp;&nbsp;<span class="op" id="1668154">=</span>&nbsp;<span class="num" id="1668156">0x80</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668163">surrogateMin</span>&nbsp;<span class="op" id="1668176">=</span>&nbsp;<span class="num" id="1668178">0xD800</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668186">surrogateMax</span>&nbsp;<span class="op" id="1668199">=</span>&nbsp;<span class="num" id="1668201">0xDFFF</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668210">bad</span>&nbsp;<span class="op" id="1668214">=</span>&nbsp;<span class="ident" id="1668216">runeerror</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1668228">runemax</span>&nbsp;<span class="op" id="1668236">=</span>&nbsp;<span class="num" id="1668238">0x10FFFF</span>&nbsp;<span class="comment" id="1668247">/*&nbsp;maximum&nbsp;rune&nbsp;value&nbsp;*/</span><br>
<span class="lineno">55</span><span class="op" id="1668272">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1668275">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Modified&nbsp;by&nbsp;Wei-Hwa&nbsp;Huang,&nbsp;Google&nbsp;Inc.,&nbsp;on&nbsp;2004-09-24<br>
<span class="lineno"></span>&nbsp;*&nbsp;This&nbsp;is&nbsp;a&nbsp;slower&nbsp;but&nbsp;&#34;safe&#34;&nbsp;version&nbsp;of&nbsp;the&nbsp;old&nbsp;chartorune<br>
<span class="lineno">60</span>&nbsp;*&nbsp;that&nbsp;works&nbsp;on&nbsp;strings&nbsp;that&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;null-terminated.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;If&nbsp;you&nbsp;know&nbsp;for&nbsp;sure&nbsp;that&nbsp;your&nbsp;string&nbsp;is&nbsp;null-terminated,<br>
<span class="lineno"></span>&nbsp;*&nbsp;chartorune&nbsp;will&nbsp;be&nbsp;a&nbsp;bit&nbsp;faster.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno">65</span>&nbsp;*&nbsp;It&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to&nbsp;attempt&nbsp;to&nbsp;access&nbsp;&#34;length&#34;<br>
<span class="lineno"></span>&nbsp;*&nbsp;past&nbsp;the&nbsp;incoming&nbsp;pointer.&nbsp;&nbsp;This&nbsp;is&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>&nbsp;*&nbsp;possible&nbsp;access&nbsp;violations.&nbsp;&nbsp;If&nbsp;the&nbsp;string&nbsp;appears&nbsp;to&nbsp;be<br>
<span class="lineno"></span>&nbsp;*&nbsp;well-formed&nbsp;but&nbsp;incomplete&nbsp;(i.e.,&nbsp;to&nbsp;get&nbsp;the&nbsp;whole&nbsp;Rune<br>
<span class="lineno"></span>&nbsp;*&nbsp;we&#39;d&nbsp;need&nbsp;to&nbsp;read&nbsp;past&nbsp;str+length)&nbsp;then&nbsp;we&#39;ll&nbsp;set&nbsp;the&nbsp;Rune<br>
<span class="lineno">70</span>&nbsp;*&nbsp;to&nbsp;Bad&nbsp;and&nbsp;return&nbsp;0.<br>
<span class="lineno"></span>&nbsp;*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Note&nbsp;that&nbsp;if&nbsp;we&nbsp;have&nbsp;decoding&nbsp;problems&nbsp;for&nbsp;other<br>
<span class="lineno"></span>&nbsp;*&nbsp;reasons,&nbsp;we&nbsp;return&nbsp;1&nbsp;instead&nbsp;of&nbsp;0.<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno">75</span><span class="keyword" id="1668970">func</span>&nbsp;<span class="ident" id="1668975">charntorune</span><span class="op" id="1668986">(</span><span class="ident" id="1668987">s</span>&nbsp;<span class="builtintype" id="1668989">string</span><span class="op" id="1668995">)</span>&nbsp;<span class="op" id="1668997">(</span><span class="builtintype" id="1668998">rune</span><span class="op" id="1669002">,</span>&nbsp;<span class="builtintype" id="1669004">int</span><span class="op" id="1669007">)</span>&nbsp;<span class="op" id="1669009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669012">/*&nbsp;When&nbsp;we&#39;re&nbsp;not&nbsp;allowed&nbsp;to&nbsp;read&nbsp;anything&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669059">if</span>&nbsp;<span class="builtinfunc" id="1669062">len</span><span class="op" id="1669065">(</span><span class="ident" id="1669066">s</span><span class="op" id="1669067">)</span>&nbsp;<span class="op" id="1669069">&lt;=</span>&nbsp;<span class="num" id="1669072">0</span>&nbsp;<span class="op" id="1669074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669078">return</span>&nbsp;<span class="ident" id="1669085">bad</span><span class="op" id="1669088">,</span>&nbsp;<span class="num" id="1669090">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669093">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669097">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;one&nbsp;character&nbsp;sequence&nbsp;(7-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp00000-0007F&nbsp;=&gt;&nbsp;T1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669169">c</span>&nbsp;<span class="op" id="1669171">:=</span>&nbsp;<span class="ident" id="1669174">s</span><span class="op" id="1669175">[</span><span class="num" id="1669176">0</span><span class="op" id="1669177">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669180">if</span>&nbsp;<span class="ident" id="1669183">c</span>&nbsp;<span class="op" id="1669185">&lt;</span>&nbsp;<span class="ident" id="1669187">tx</span>&nbsp;<span class="op" id="1669190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669194">return</span>&nbsp;<span class="builtintype" id="1669201">rune</span><span class="op" id="1669205">(</span><span class="ident" id="1669206">c</span><span class="op" id="1669207">)</span><span class="op" id="1669208">,</span>&nbsp;<span class="num" id="1669210">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669217">//&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;read&nbsp;more&nbsp;than&nbsp;one&nbsp;character&nbsp;we&nbsp;must&nbsp;stop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669275">if</span>&nbsp;<span class="builtinfunc" id="1669278">len</span><span class="op" id="1669281">(</span><span class="ident" id="1669282">s</span><span class="op" id="1669283">)</span>&nbsp;<span class="op" id="1669285">&lt;=</span>&nbsp;<span class="num" id="1669288">1</span>&nbsp;<span class="op" id="1669290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669294">return</span>&nbsp;<span class="ident" id="1669301">bad</span><span class="op" id="1669304">,</span>&nbsp;<span class="num" id="1669306">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669313">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;two&nbsp;character&nbsp;sequence&nbsp;(11-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0080-07FF&nbsp;=&gt;&nbsp;t2&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669387">c1</span>&nbsp;<span class="op" id="1669390">:=</span>&nbsp;<span class="ident" id="1669393">s</span><span class="op" id="1669394">[</span><span class="num" id="1669395">1</span><span class="op" id="1669396">]</span>&nbsp;<span class="op" id="1669398">^</span>&nbsp;<span class="ident" id="1669400">tx</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669404">if</span>&nbsp;<span class="op" id="1669407">(</span><span class="ident" id="1669408">c1</span>&nbsp;<span class="op" id="1669411">&amp;</span>&nbsp;<span class="ident" id="1669413">testx</span><span class="op" id="1669418">)</span>&nbsp;<span class="op" id="1669420">!=</span>&nbsp;<span class="num" id="1669423">0</span>&nbsp;<span class="op" id="1669425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669429">return</span>&nbsp;<span class="ident" id="1669436">bad</span><span class="op" id="1669439">,</span>&nbsp;<span class="num" id="1669441">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669447">if</span>&nbsp;<span class="ident" id="1669450">c</span>&nbsp;<span class="op" id="1669452">&lt;</span>&nbsp;<span class="ident" id="1669454">t3</span>&nbsp;<span class="op" id="1669457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669461">if</span>&nbsp;<span class="ident" id="1669464">c</span>&nbsp;<span class="op" id="1669466">&lt;</span>&nbsp;<span class="ident" id="1669468">t2</span>&nbsp;<span class="op" id="1669471">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669476">return</span>&nbsp;<span class="ident" id="1669483">bad</span><span class="op" id="1669486">,</span>&nbsp;<span class="num" id="1669488">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669496">l</span>&nbsp;<span class="op" id="1669498">:=</span>&nbsp;<span class="op" id="1669501">(</span><span class="op" id="1669502">(</span><span class="builtintype" id="1669503">rune</span><span class="op" id="1669507">(</span><span class="ident" id="1669508">c</span><span class="op" id="1669509">)</span>&nbsp;<span class="op" id="1669511">&lt;&lt;</span>&nbsp;<span class="ident" id="1669514">bitx</span><span class="op" id="1669518">)</span>&nbsp;<span class="op" id="1669520">|</span>&nbsp;<span class="builtintype" id="1669522">rune</span><span class="op" id="1669526">(</span><span class="ident" id="1669527">c1</span><span class="op" id="1669529">)</span><span class="op" id="1669530">)</span>&nbsp;<span class="op" id="1669532">&amp;</span>&nbsp;<span class="ident" id="1669534">rune2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669542">if</span>&nbsp;<span class="ident" id="1669545">l</span>&nbsp;<span class="op" id="1669547">&lt;=</span>&nbsp;<span class="ident" id="1669550">rune1</span>&nbsp;<span class="op" id="1669556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669561">return</span>&nbsp;<span class="ident" id="1669568">bad</span><span class="op" id="1669571">,</span>&nbsp;<span class="num" id="1669573">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669581">return</span>&nbsp;<span class="ident" id="1669588">l</span><span class="op" id="1669589">,</span>&nbsp;<span class="num" id="1669591">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669598">//&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;read&nbsp;more&nbsp;than&nbsp;two&nbsp;characters&nbsp;we&nbsp;must&nbsp;stop</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669657">if</span>&nbsp;<span class="builtinfunc" id="1669660">len</span><span class="op" id="1669663">(</span><span class="ident" id="1669664">s</span><span class="op" id="1669665">)</span>&nbsp;<span class="op" id="1669667">&lt;=</span>&nbsp;<span class="num" id="1669670">2</span>&nbsp;<span class="op" id="1669672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669676">return</span>&nbsp;<span class="ident" id="1669683">bad</span><span class="op" id="1669686">,</span>&nbsp;<span class="num" id="1669688">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1669695">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;three&nbsp;character&nbsp;sequence&nbsp;(16-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0800-FFFF&nbsp;=&gt;&nbsp;t3&nbsp;tx&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669774">c2</span>&nbsp;<span class="op" id="1669777">:=</span>&nbsp;<span class="ident" id="1669780">s</span><span class="op" id="1669781">[</span><span class="num" id="1669782">2</span><span class="op" id="1669783">]</span>&nbsp;<span class="op" id="1669785">^</span>&nbsp;<span class="ident" id="1669787">tx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669791">if</span>&nbsp;<span class="op" id="1669794">(</span><span class="ident" id="1669795">c2</span>&nbsp;<span class="op" id="1669798">&amp;</span>&nbsp;<span class="ident" id="1669800">testx</span><span class="op" id="1669805">)</span>&nbsp;<span class="op" id="1669807">!=</span>&nbsp;<span class="num" id="1669810">0</span>&nbsp;<span class="op" id="1669812">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669816">return</span>&nbsp;<span class="ident" id="1669823">bad</span><span class="op" id="1669826">,</span>&nbsp;<span class="num" id="1669828">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669834">if</span>&nbsp;<span class="ident" id="1669837">c</span>&nbsp;<span class="op" id="1669839">&lt;</span>&nbsp;<span class="ident" id="1669841">t4</span>&nbsp;<span class="op" id="1669844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1669848">l</span>&nbsp;<span class="op" id="1669850">:=</span>&nbsp;<span class="op" id="1669853">(</span><span class="op" id="1669854">(</span><span class="op" id="1669855">(</span><span class="op" id="1669856">(</span><span class="builtintype" id="1669857">rune</span><span class="op" id="1669861">(</span><span class="ident" id="1669862">c</span><span class="op" id="1669863">)</span>&nbsp;<span class="op" id="1669865">&lt;&lt;</span>&nbsp;<span class="ident" id="1669868">bitx</span><span class="op" id="1669872">)</span>&nbsp;<span class="op" id="1669874">|</span>&nbsp;<span class="builtintype" id="1669876">rune</span><span class="op" id="1669880">(</span><span class="ident" id="1669881">c1</span><span class="op" id="1669883">)</span><span class="op" id="1669884">)</span>&nbsp;<span class="op" id="1669886">&lt;&lt;</span>&nbsp;<span class="ident" id="1669889">bitx</span><span class="op" id="1669893">)</span>&nbsp;<span class="op" id="1669895">|</span>&nbsp;<span class="builtintype" id="1669897">rune</span><span class="op" id="1669901">(</span><span class="ident" id="1669902">c2</span><span class="op" id="1669904">)</span><span class="op" id="1669905">)</span>&nbsp;<span class="op" id="1669907">&amp;</span>&nbsp;<span class="ident" id="1669909">rune3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669917">if</span>&nbsp;<span class="ident" id="1669920">l</span>&nbsp;<span class="op" id="1669922">&lt;=</span>&nbsp;<span class="ident" id="1669925">rune2</span>&nbsp;<span class="op" id="1669931">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669936">return</span>&nbsp;<span class="ident" id="1669943">bad</span><span class="op" id="1669946">,</span>&nbsp;<span class="num" id="1669948">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1669952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1669956">if</span>&nbsp;<span class="ident" id="1669959">surrogateMin</span>&nbsp;<span class="op" id="1669972">&lt;=</span>&nbsp;<span class="ident" id="1669975">l</span>&nbsp;<span class="op" id="1669977">&amp;&amp;</span>&nbsp;<span class="ident" id="1669980">l</span>&nbsp;<span class="op" id="1669982">&lt;=</span>&nbsp;<span class="ident" id="1669985">surrogateMax</span>&nbsp;<span class="op" id="1669998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670003">return</span>&nbsp;<span class="ident" id="1670010">bad</span><span class="op" id="1670013">,</span>&nbsp;<span class="num" id="1670015">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670019">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670023">return</span>&nbsp;<span class="ident" id="1670030">l</span><span class="op" id="1670031">,</span>&nbsp;<span class="num" id="1670033">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670040">if</span>&nbsp;<span class="builtinfunc" id="1670043">len</span><span class="op" id="1670046">(</span><span class="ident" id="1670047">s</span><span class="op" id="1670048">)</span>&nbsp;<span class="op" id="1670050">&lt;=</span>&nbsp;<span class="num" id="1670053">3</span>&nbsp;<span class="op" id="1670055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670059">return</span>&nbsp;<span class="ident" id="1670066">bad</span><span class="op" id="1670069">,</span>&nbsp;<span class="num" id="1670071">1</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670078">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;four&nbsp;character&nbsp;sequence&nbsp;(21-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp10000-1FFFFF&nbsp;=&gt;&nbsp;t4&nbsp;tx&nbsp;tx&nbsp;tx<br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670162">c3</span>&nbsp;<span class="op" id="1670165">:=</span>&nbsp;<span class="ident" id="1670168">s</span><span class="op" id="1670169">[</span><span class="num" id="1670170">3</span><span class="op" id="1670171">]</span>&nbsp;<span class="op" id="1670173">^</span>&nbsp;<span class="ident" id="1670175">tx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670179">if</span>&nbsp;<span class="op" id="1670182">(</span><span class="ident" id="1670183">c3</span>&nbsp;<span class="op" id="1670186">&amp;</span>&nbsp;<span class="ident" id="1670188">testx</span><span class="op" id="1670193">)</span>&nbsp;<span class="op" id="1670195">!=</span>&nbsp;<span class="num" id="1670198">0</span>&nbsp;<span class="op" id="1670200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670204">return</span>&nbsp;<span class="ident" id="1670211">bad</span><span class="op" id="1670214">,</span>&nbsp;<span class="num" id="1670216">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670219">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670222">if</span>&nbsp;<span class="ident" id="1670225">c</span>&nbsp;<span class="op" id="1670227">&lt;</span>&nbsp;<span class="ident" id="1670229">t5</span>&nbsp;<span class="op" id="1670232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670236">l</span>&nbsp;<span class="op" id="1670238">:=</span>&nbsp;<span class="op" id="1670241">(</span><span class="op" id="1670242">(</span><span class="op" id="1670243">(</span><span class="op" id="1670244">(</span><span class="op" id="1670245">(</span><span class="op" id="1670246">(</span><span class="builtintype" id="1670247">rune</span><span class="op" id="1670251">(</span><span class="ident" id="1670252">c</span><span class="op" id="1670253">)</span>&nbsp;<span class="op" id="1670255">&lt;&lt;</span>&nbsp;<span class="ident" id="1670258">bitx</span><span class="op" id="1670262">)</span>&nbsp;<span class="op" id="1670264">|</span>&nbsp;<span class="builtintype" id="1670266">rune</span><span class="op" id="1670270">(</span><span class="ident" id="1670271">c1</span><span class="op" id="1670273">)</span><span class="op" id="1670274">)</span>&nbsp;<span class="op" id="1670276">&lt;&lt;</span>&nbsp;<span class="ident" id="1670279">bitx</span><span class="op" id="1670283">)</span>&nbsp;<span class="op" id="1670285">|</span>&nbsp;<span class="builtintype" id="1670287">rune</span><span class="op" id="1670291">(</span><span class="ident" id="1670292">c2</span><span class="op" id="1670294">)</span><span class="op" id="1670295">)</span>&nbsp;<span class="op" id="1670297">&lt;&lt;</span>&nbsp;<span class="ident" id="1670300">bitx</span><span class="op" id="1670304">)</span>&nbsp;<span class="op" id="1670306">|</span>&nbsp;<span class="builtintype" id="1670308">rune</span><span class="op" id="1670312">(</span><span class="ident" id="1670313">c3</span><span class="op" id="1670315">)</span><span class="op" id="1670316">)</span>&nbsp;<span class="op" id="1670318">&amp;</span>&nbsp;<span class="ident" id="1670320">rune4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670328">if</span>&nbsp;<span class="ident" id="1670331">l</span>&nbsp;<span class="op" id="1670333">&lt;=</span>&nbsp;<span class="ident" id="1670336">rune3</span>&nbsp;<span class="op" id="1670342">||</span>&nbsp;<span class="ident" id="1670345">l</span>&nbsp;<span class="op" id="1670347">&gt;</span>&nbsp;<span class="ident" id="1670349">runemax</span>&nbsp;<span class="op" id="1670357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670362">return</span>&nbsp;<span class="ident" id="1670369">bad</span><span class="op" id="1670372">,</span>&nbsp;<span class="num" id="1670374">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670378">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670382">return</span>&nbsp;<span class="ident" id="1670389">l</span><span class="op" id="1670390">,</span>&nbsp;<span class="num" id="1670392">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670399">//&nbsp;Support&nbsp;for&nbsp;5-byte&nbsp;or&nbsp;longer&nbsp;UTF-8&nbsp;would&nbsp;go&nbsp;here,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670457">//&nbsp;since&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;that,&nbsp;we&#39;ll&nbsp;just&nbsp;return&nbsp;bad.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670510">return</span>&nbsp;<span class="ident" id="1670517">bad</span><span class="op" id="1670520">,</span>&nbsp;<span class="num" id="1670522">1</span><br>
<span class="lineno"></span><span class="op" id="1670524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1670527">//&nbsp;runetochar&nbsp;converts&nbsp;r&nbsp;to&nbsp;bytes&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;str.</span><br>
<span class="lineno"></span><span class="comment" id="1670591">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;generated.</span><br>
<span class="lineno">165</span><span class="keyword" id="1670633">func</span>&nbsp;<span class="ident" id="1670638">runetochar</span><span class="op" id="1670648">(</span><span class="ident" id="1670649">str</span>&nbsp;<span class="op" id="1670653">[</span><span class="op" id="1670654">]</span><span class="builtintype" id="1670655">byte</span><span class="op" id="1670659">,</span>&nbsp;<span class="ident" id="1670661">r</span>&nbsp;<span class="builtintype" id="1670663">rune</span><span class="op" id="1670667">)</span>&nbsp;<span class="builtintype" id="1670669">int</span>&nbsp;<span class="op" id="1670673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670676">/*&nbsp;runes&nbsp;are&nbsp;signed,&nbsp;so&nbsp;convert&nbsp;to&nbsp;unsigned&nbsp;for&nbsp;range&nbsp;check.&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670741">c</span>&nbsp;<span class="op" id="1670743">:=</span>&nbsp;<span class="builtintype" id="1670746">uint32</span><span class="op" id="1670752">(</span><span class="ident" id="1670753">r</span><span class="op" id="1670754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670757">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;one&nbsp;character&nbsp;sequence<br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp00000-0007F&nbsp;=&gt;&nbsp;00-7F<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670818">if</span>&nbsp;<span class="ident" id="1670821">c</span>&nbsp;<span class="op" id="1670823">&lt;=</span>&nbsp;<span class="ident" id="1670826">rune1</span>&nbsp;<span class="op" id="1670832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670836">str</span><span class="op" id="1670839">[</span><span class="num" id="1670840">0</span><span class="op" id="1670841">]</span>&nbsp;<span class="op" id="1670843">=</span>&nbsp;<span class="builtintype" id="1670845">byte</span><span class="op" id="1670849">(</span><span class="ident" id="1670850">c</span><span class="op" id="1670851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670855">return</span>&nbsp;<span class="num" id="1670862">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1670865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1670868">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;two&nbsp;character&nbsp;sequence<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0080-07FF&nbsp;=&gt;&nbsp;t2&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1670927">if</span>&nbsp;<span class="ident" id="1670930">c</span>&nbsp;<span class="op" id="1670932">&lt;=</span>&nbsp;<span class="ident" id="1670935">rune2</span>&nbsp;<span class="op" id="1670941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670945">str</span><span class="op" id="1670948">[</span><span class="num" id="1670949">0</span><span class="op" id="1670950">]</span>&nbsp;<span class="op" id="1670952">=</span>&nbsp;<span class="builtintype" id="1670954">byte</span><span class="op" id="1670958">(</span><span class="ident" id="1670959">t2</span>&nbsp;<span class="op" id="1670962">|</span>&nbsp;<span class="op" id="1670964">(</span><span class="ident" id="1670965">c</span>&nbsp;<span class="op" id="1670967">&gt;&gt;</span>&nbsp;<span class="op" id="1670970">(</span><span class="num" id="1670971">1</span>&nbsp;<span class="op" id="1670973">*</span>&nbsp;<span class="ident" id="1670975">bitx</span><span class="op" id="1670979">)</span><span class="op" id="1670980">)</span><span class="op" id="1670981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1670985">str</span><span class="op" id="1670988">[</span><span class="num" id="1670989">1</span><span class="op" id="1670990">]</span>&nbsp;<span class="op" id="1670992">=</span>&nbsp;<span class="builtintype" id="1670994">byte</span><span class="op" id="1670998">(</span><span class="ident" id="1670999">tx</span>&nbsp;<span class="op" id="1671002">|</span>&nbsp;<span class="op" id="1671004">(</span><span class="ident" id="1671005">c</span>&nbsp;<span class="op" id="1671007">&amp;</span>&nbsp;<span class="ident" id="1671009">maskx</span><span class="op" id="1671014">)</span><span class="op" id="1671015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671019">return</span>&nbsp;<span class="num" id="1671026">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671029">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671033">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;If&nbsp;the&nbsp;rune&nbsp;is&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half,&nbsp;convert&nbsp;it&nbsp;to&nbsp;the&nbsp;error&nbsp;rune.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Do&nbsp;this&nbsp;test&nbsp;here&nbsp;because&nbsp;the&nbsp;error&nbsp;rune&nbsp;encodes&nbsp;to&nbsp;three&nbsp;bytes.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Doing&nbsp;it&nbsp;earlier&nbsp;would&nbsp;duplicate&nbsp;work,&nbsp;since&nbsp;an&nbsp;out&nbsp;of&nbsp;range<br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;rune&nbsp;wouldn&#39;t&nbsp;have&nbsp;fit&nbsp;in&nbsp;one&nbsp;or&nbsp;two&nbsp;bytes.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671307">if</span>&nbsp;<span class="ident" id="1671310">c</span>&nbsp;<span class="op" id="1671312">&gt;</span>&nbsp;<span class="ident" id="1671314">runemax</span>&nbsp;<span class="op" id="1671322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671326">c</span>&nbsp;<span class="op" id="1671328">=</span>&nbsp;<span class="ident" id="1671330">runeerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671341">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671344">if</span>&nbsp;<span class="ident" id="1671347">surrogateMin</span>&nbsp;<span class="op" id="1671360">&lt;=</span>&nbsp;<span class="ident" id="1671363">c</span>&nbsp;<span class="op" id="1671365">&amp;&amp;</span>&nbsp;<span class="ident" id="1671368">c</span>&nbsp;<span class="op" id="1671370">&lt;=</span>&nbsp;<span class="ident" id="1671373">surrogateMax</span>&nbsp;<span class="op" id="1671386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671390">c</span>&nbsp;<span class="op" id="1671392">=</span>&nbsp;<span class="ident" id="1671394">runeerror</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671409">/*<br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;three&nbsp;character&nbsp;sequence<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp0800-FFFF&nbsp;=&gt;&nbsp;t3&nbsp;tx&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671473">if</span>&nbsp;<span class="ident" id="1671476">c</span>&nbsp;<span class="op" id="1671478">&lt;=</span>&nbsp;<span class="ident" id="1671481">rune3</span>&nbsp;<span class="op" id="1671487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671491">str</span><span class="op" id="1671494">[</span><span class="num" id="1671495">0</span><span class="op" id="1671496">]</span>&nbsp;<span class="op" id="1671498">=</span>&nbsp;<span class="builtintype" id="1671500">byte</span><span class="op" id="1671504">(</span><span class="ident" id="1671505">t3</span>&nbsp;<span class="op" id="1671508">|</span>&nbsp;<span class="op" id="1671510">(</span><span class="ident" id="1671511">c</span>&nbsp;<span class="op" id="1671513">&gt;&gt;</span>&nbsp;<span class="op" id="1671516">(</span><span class="num" id="1671517">2</span>&nbsp;<span class="op" id="1671519">*</span>&nbsp;<span class="ident" id="1671521">bitx</span><span class="op" id="1671525">)</span><span class="op" id="1671526">)</span><span class="op" id="1671527">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671531">str</span><span class="op" id="1671534">[</span><span class="num" id="1671535">1</span><span class="op" id="1671536">]</span>&nbsp;<span class="op" id="1671538">=</span>&nbsp;<span class="builtintype" id="1671540">byte</span><span class="op" id="1671544">(</span><span class="ident" id="1671545">tx</span>&nbsp;<span class="op" id="1671548">|</span>&nbsp;<span class="op" id="1671550">(</span><span class="op" id="1671551">(</span><span class="ident" id="1671552">c</span>&nbsp;<span class="op" id="1671554">&gt;&gt;</span>&nbsp;<span class="op" id="1671557">(</span><span class="num" id="1671558">1</span>&nbsp;<span class="op" id="1671560">*</span>&nbsp;<span class="ident" id="1671562">bitx</span><span class="op" id="1671566">)</span><span class="op" id="1671567">)</span>&nbsp;<span class="op" id="1671569">&amp;</span>&nbsp;<span class="ident" id="1671571">maskx</span><span class="op" id="1671576">)</span><span class="op" id="1671577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671581">str</span><span class="op" id="1671584">[</span><span class="num" id="1671585">2</span><span class="op" id="1671586">]</span>&nbsp;<span class="op" id="1671588">=</span>&nbsp;<span class="builtintype" id="1671590">byte</span><span class="op" id="1671594">(</span><span class="ident" id="1671595">tx</span>&nbsp;<span class="op" id="1671598">|</span>&nbsp;<span class="op" id="1671600">(</span><span class="ident" id="1671601">c</span>&nbsp;<span class="op" id="1671603">&amp;</span>&nbsp;<span class="ident" id="1671605">maskx</span><span class="op" id="1671610">)</span><span class="op" id="1671611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671615">return</span>&nbsp;<span class="num" id="1671622">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1671625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1671629">/*<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;four&nbsp;character&nbsp;sequence&nbsp;(21-bit&nbsp;value)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10000-1FFFFF&nbsp;=&gt;&nbsp;t4&nbsp;tx&nbsp;tx&nbsp;tx<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671717">str</span><span class="op" id="1671720">[</span><span class="num" id="1671721">0</span><span class="op" id="1671722">]</span>&nbsp;<span class="op" id="1671724">=</span>&nbsp;<span class="builtintype" id="1671726">byte</span><span class="op" id="1671730">(</span><span class="ident" id="1671731">t4</span>&nbsp;<span class="op" id="1671734">|</span>&nbsp;<span class="op" id="1671736">(</span><span class="ident" id="1671737">c</span>&nbsp;<span class="op" id="1671739">&gt;&gt;</span>&nbsp;<span class="op" id="1671742">(</span><span class="num" id="1671743">3</span>&nbsp;<span class="op" id="1671745">*</span>&nbsp;<span class="ident" id="1671747">bitx</span><span class="op" id="1671751">)</span><span class="op" id="1671752">)</span><span class="op" id="1671753">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671756">str</span><span class="op" id="1671759">[</span><span class="num" id="1671760">1</span><span class="op" id="1671761">]</span>&nbsp;<span class="op" id="1671763">=</span>&nbsp;<span class="builtintype" id="1671765">byte</span><span class="op" id="1671769">(</span><span class="ident" id="1671770">tx</span>&nbsp;<span class="op" id="1671773">|</span>&nbsp;<span class="op" id="1671775">(</span><span class="op" id="1671776">(</span><span class="ident" id="1671777">c</span>&nbsp;<span class="op" id="1671779">&gt;&gt;</span>&nbsp;<span class="op" id="1671782">(</span><span class="num" id="1671783">2</span>&nbsp;<span class="op" id="1671785">*</span>&nbsp;<span class="ident" id="1671787">bitx</span><span class="op" id="1671791">)</span><span class="op" id="1671792">)</span>&nbsp;<span class="op" id="1671794">&amp;</span>&nbsp;<span class="ident" id="1671796">maskx</span><span class="op" id="1671801">)</span><span class="op" id="1671802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671805">str</span><span class="op" id="1671808">[</span><span class="num" id="1671809">2</span><span class="op" id="1671810">]</span>&nbsp;<span class="op" id="1671812">=</span>&nbsp;<span class="builtintype" id="1671814">byte</span><span class="op" id="1671818">(</span><span class="ident" id="1671819">tx</span>&nbsp;<span class="op" id="1671822">|</span>&nbsp;<span class="op" id="1671824">(</span><span class="op" id="1671825">(</span><span class="ident" id="1671826">c</span>&nbsp;<span class="op" id="1671828">&gt;&gt;</span>&nbsp;<span class="op" id="1671831">(</span><span class="num" id="1671832">1</span>&nbsp;<span class="op" id="1671834">*</span>&nbsp;<span class="ident" id="1671836">bitx</span><span class="op" id="1671840">)</span><span class="op" id="1671841">)</span>&nbsp;<span class="op" id="1671843">&amp;</span>&nbsp;<span class="ident" id="1671845">maskx</span><span class="op" id="1671850">)</span><span class="op" id="1671851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1671854">str</span><span class="op" id="1671857">[</span><span class="num" id="1671858">3</span><span class="op" id="1671859">]</span>&nbsp;<span class="op" id="1671861">=</span>&nbsp;<span class="builtintype" id="1671863">byte</span><span class="op" id="1671867">(</span><span class="ident" id="1671868">tx</span>&nbsp;<span class="op" id="1671871">|</span>&nbsp;<span class="op" id="1671873">(</span><span class="ident" id="1671874">c</span>&nbsp;<span class="op" id="1671876">&amp;</span>&nbsp;<span class="ident" id="1671878">maskx</span><span class="op" id="1671883">)</span><span class="op" id="1671884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1671887">return</span>&nbsp;<span class="num" id="1671894">4</span><br>
<span class="lineno"></span><span class="op" id="1671896">}</span>
</div>
</body>
</html>
