<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5726925">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5726980">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5727034">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5727085">package</span>&nbsp;<span class="ident" id="5727093">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5727098">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5727117">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5727140">import</span>&nbsp;<span class="op" id="5727147">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727150">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727159">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727169">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727175">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727188">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727194">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727205">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5727216">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5727223">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5727226">var</span>&nbsp;<span class="op" id="5727230">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727233">ErrHeader</span>&nbsp;<span class="op" id="5727243">=</span>&nbsp;<span class="ident" id="5727245">errors</span><span class="op" id="5727251">.</span><span class="ident" id="5727252">New</span><span class="op" id="5727255">(</span><span class="string" id="5727256">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5727289">)</span><br>
<span class="lineno"></span><span class="op" id="5727291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5727294">const</span>&nbsp;<span class="ident" id="5727300">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5727321">=</span>&nbsp;<span class="num" id="5727323">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5727326">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5727399">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5727449">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5727532">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5727605">type</span>&nbsp;<span class="ident" id="5727610">Reader</span>&nbsp;<span class="keyword" id="5727617">struct</span>&nbsp;<span class="op" id="5727624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727627">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727635">io</span><span class="op" id="5727637">.</span><span class="ident" id="5727638">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727646">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5727654">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727661">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727669">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5727685">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727742">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727750">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5727766">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5727800">hdrBuff</span>&nbsp;<span class="op" id="5727808">[</span><span class="ident" id="5727809">blockSize</span><span class="op" id="5727818">]</span><span class="builtintype" id="5727819">byte</span>&nbsp;<span class="comment" id="5727824">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5727855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5727858">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5727939">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5727993">type</span>&nbsp;<span class="ident" id="5727998">numBytesReader</span>&nbsp;<span class="keyword" id="5728013">interface</span>&nbsp;<span class="op" id="5728023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728026">io</span><span class="op" id="5728028">.</span><span class="ident" id="5728029">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728037">numBytes</span><span class="op" id="5728045">(</span><span class="op" id="5728046">)</span>&nbsp;<span class="ident" id="5728048">int64</span><br>
<span class="lineno"></span><span class="op" id="5728054">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5728057">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5728138">type</span>&nbsp;<span class="ident" id="5728143">regFileReader</span>&nbsp;<span class="keyword" id="5728157">struct</span>&nbsp;<span class="op" id="5728164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728167">r</span>&nbsp;&nbsp;<span class="ident" id="5728170">io</span><span class="op" id="5728172">.</span><span class="ident" id="5728173">Reader</span>&nbsp;<span class="comment" id="5728180">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728202">nb</span>&nbsp;<span class="ident" id="5728205">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5728215">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5728264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5728267">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5728358">type</span>&nbsp;<span class="ident" id="5728363">sparseFileReader</span>&nbsp;<span class="keyword" id="5728380">struct</span>&nbsp;<span class="op" id="5728387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728390">rfr</span>&nbsp;<span class="op" id="5728394">*</span><span class="ident" id="5728395">regFileReader</span>&nbsp;<span class="comment" id="5728409">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728448">sp</span>&nbsp;&nbsp;<span class="op" id="5728452">[</span><span class="op" id="5728453">]</span><span class="ident" id="5728454">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5728467">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728499">pos</span>&nbsp;<span class="ident" id="5728503">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5728518">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728551">tot</span>&nbsp;<span class="ident" id="5728555">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5728570">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5728596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5728599">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5728657">const</span>&nbsp;<span class="op" id="5728663">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728666">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5728688">=</span>&nbsp;<span class="string" id="5728690">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728714">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728736">=</span>&nbsp;<span class="string" id="5728738">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728759">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5728781">=</span>&nbsp;<span class="string" id="5728783">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728806">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728828">=</span>&nbsp;<span class="string" id="5728830">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728848">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728870">=</span>&nbsp;<span class="string" id="5728872">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728891">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728913">=</span>&nbsp;<span class="string" id="5728915">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728935">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5728957">=</span>&nbsp;<span class="string" id="5728959">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5728979">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729001">=</span>&nbsp;<span class="string" id="5729003">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729022">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5729044">=</span>&nbsp;<span class="string" id="5729046">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5729068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5729071">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5729110">const</span>&nbsp;<span class="op" id="5729116">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729119">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729162">=</span>&nbsp;<span class="num" id="5729164">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729169">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729212">=</span>&nbsp;<span class="num" id="5729214">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729219">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729262">=</span>&nbsp;<span class="num" id="5729264">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729267">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5729310">=</span>&nbsp;<span class="num" id="5729312">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729317">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729360">=</span>&nbsp;<span class="num" id="5729362">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729366">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729409">=</span>&nbsp;<span class="num" id="5729411">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729415">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729458">=</span>&nbsp;<span class="num" id="5729460">12</span><br>
<span class="lineno"></span><span class="op" id="5729463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5729466">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5729516">func</span>&nbsp;<span class="ident" id="5729521">NewReader</span><span class="op" id="5729530">(</span><span class="ident" id="5729531">r</span>&nbsp;<span class="ident" id="5729533">io</span><span class="op" id="5729535">.</span><span class="ident" id="5729536">Reader</span><span class="op" id="5729542">)</span>&nbsp;<span class="op" id="5729544">*</span><span class="ident" id="5729545">Reader</span>&nbsp;<span class="op" id="5729552">{</span>&nbsp;<span class="keyword" id="5729554">return</span>&nbsp;<span class="op" id="5729561">&amp;</span><span class="ident" id="5729562">Reader</span><span class="op" id="5729568">{</span><span class="ident" id="5729569">r</span><span class="op" id="5729570">:</span>&nbsp;<span class="ident" id="5729572">r</span><span class="op" id="5729573">}</span>&nbsp;<span class="op" id="5729575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5729578">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5729633">func</span>&nbsp;<span class="op" id="5729638">(</span><span class="ident" id="5729639">tr</span>&nbsp;<span class="op" id="5729642">*</span><span class="ident" id="5729643">Reader</span><span class="op" id="5729649">)</span>&nbsp;<span class="ident" id="5729651">Next</span><span class="op" id="5729655">(</span><span class="op" id="5729656">)</span>&nbsp;<span class="op" id="5729658">(</span><span class="op" id="5729659">*</span><span class="ident" id="5729660">Header</span><span class="op" id="5729666">,</span>&nbsp;<span class="builtintype" id="5729668">error</span><span class="op" id="5729673">)</span>&nbsp;<span class="op" id="5729675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729678">var</span>&nbsp;<span class="ident" id="5729682">hdr</span>&nbsp;<span class="op" id="5729686">*</span><span class="ident" id="5729687">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729695">if</span>&nbsp;<span class="ident" id="5729698">tr</span><span class="op" id="5729700">.</span><span class="ident" id="5729701">err</span>&nbsp;<span class="op" id="5729705">==</span>&nbsp;<span class="ident" id="5729708">nil</span>&nbsp;<span class="op" id="5729712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729716">tr</span><span class="op" id="5729718">.</span><span class="ident" id="5729719">skipUnread</span><span class="op" id="5729729">(</span><span class="op" id="5729730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729736">if</span>&nbsp;<span class="ident" id="5729739">tr</span><span class="op" id="5729741">.</span><span class="ident" id="5729742">err</span>&nbsp;<span class="op" id="5729746">!=</span>&nbsp;<span class="ident" id="5729749">nil</span>&nbsp;<span class="op" id="5729753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729757">return</span>&nbsp;<span class="ident" id="5729764">hdr</span><span class="op" id="5729767">,</span>&nbsp;<span class="ident" id="5729769">tr</span><span class="op" id="5729771">.</span><span class="ident" id="5729772">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729780">hdr</span>&nbsp;<span class="op" id="5729784">=</span>&nbsp;<span class="ident" id="5729786">tr</span><span class="op" id="5729788">.</span><span class="ident" id="5729789">readHeader</span><span class="op" id="5729799">(</span><span class="op" id="5729800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729803">if</span>&nbsp;<span class="ident" id="5729806">hdr</span>&nbsp;<span class="op" id="5729810">==</span>&nbsp;<span class="ident" id="5729813">nil</span>&nbsp;<span class="op" id="5729817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729821">return</span>&nbsp;<span class="ident" id="5729828">hdr</span><span class="op" id="5729831">,</span>&nbsp;<span class="ident" id="5729833">tr</span><span class="op" id="5729835">.</span><span class="ident" id="5729836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5729841">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5729844">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729874">switch</span>&nbsp;<span class="ident" id="5729881">hdr</span><span class="op" id="5729884">.</span><span class="ident" id="5729885">Typeflag</span>&nbsp;<span class="op" id="5729894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729897">case</span>&nbsp;<span class="ident" id="5729902">TypeXHeader</span><span class="op" id="5729913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5729917">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5729943">headers</span><span class="op" id="5729950">,</span>&nbsp;<span class="ident" id="5729952">err</span>&nbsp;<span class="op" id="5729956">:=</span>&nbsp;<span class="ident" id="5729959">parsePAX</span><span class="op" id="5729967">(</span><span class="ident" id="5729968">tr</span><span class="op" id="5729970">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729974">if</span>&nbsp;<span class="ident" id="5729977">err</span>&nbsp;<span class="op" id="5729981">!=</span>&nbsp;<span class="ident" id="5729984">nil</span>&nbsp;<span class="op" id="5729988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5729993">return</span>&nbsp;<span class="ident" id="5730000">nil</span><span class="op" id="5730003">,</span>&nbsp;<span class="ident" id="5730005">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730015">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730053">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730091">tr</span><span class="op" id="5730093">.</span><span class="ident" id="5730094">skipUnread</span><span class="op" id="5730104">(</span><span class="op" id="5730105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730109">hdr</span>&nbsp;<span class="op" id="5730113">=</span>&nbsp;<span class="ident" id="5730115">tr</span><span class="op" id="5730117">.</span><span class="ident" id="5730118">readHeader</span><span class="op" id="5730128">(</span><span class="op" id="5730129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730133">mergePAX</span><span class="op" id="5730141">(</span><span class="ident" id="5730142">hdr</span><span class="op" id="5730145">,</span>&nbsp;<span class="ident" id="5730147">headers</span><span class="op" id="5730154">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730159">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730199">sp</span><span class="op" id="5730201">,</span>&nbsp;<span class="ident" id="5730203">err</span>&nbsp;<span class="op" id="5730207">:=</span>&nbsp;<span class="ident" id="5730210">tr</span><span class="op" id="5730212">.</span><span class="ident" id="5730213">checkForGNUSparsePAXHeaders</span><span class="op" id="5730240">(</span><span class="ident" id="5730241">hdr</span><span class="op" id="5730244">,</span>&nbsp;<span class="ident" id="5730246">headers</span><span class="op" id="5730253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730257">if</span>&nbsp;<span class="ident" id="5730260">err</span>&nbsp;<span class="op" id="5730264">!=</span>&nbsp;<span class="ident" id="5730267">nil</span>&nbsp;<span class="op" id="5730271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730276">tr</span><span class="op" id="5730278">.</span><span class="ident" id="5730279">err</span>&nbsp;<span class="op" id="5730283">=</span>&nbsp;<span class="ident" id="5730285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730292">return</span>&nbsp;<span class="ident" id="5730299">nil</span><span class="op" id="5730302">,</span>&nbsp;<span class="ident" id="5730304">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730310">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730314">if</span>&nbsp;<span class="ident" id="5730317">sp</span>&nbsp;<span class="op" id="5730320">!=</span>&nbsp;<span class="ident" id="5730323">nil</span>&nbsp;<span class="op" id="5730327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730332">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730384">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730443">tr</span><span class="op" id="5730445">.</span><span class="ident" id="5730446">curr</span>&nbsp;<span class="op" id="5730451">=</span>&nbsp;<span class="op" id="5730453">&amp;</span><span class="ident" id="5730454">sparseFileReader</span><span class="op" id="5730470">{</span><span class="ident" id="5730471">rfr</span><span class="op" id="5730474">:</span>&nbsp;<span class="ident" id="5730476">tr</span><span class="op" id="5730478">.</span><span class="ident" id="5730479">curr</span><span class="op" id="5730483">.</span><span class="op" id="5730484">(</span><span class="op" id="5730485">*</span><span class="ident" id="5730486">regFileReader</span><span class="op" id="5730499">)</span><span class="op" id="5730500">,</span>&nbsp;<span class="ident" id="5730502">sp</span><span class="op" id="5730504">:</span>&nbsp;<span class="ident" id="5730506">sp</span><span class="op" id="5730508">,</span>&nbsp;<span class="ident" id="5730510">tot</span><span class="op" id="5730513">:</span>&nbsp;<span class="ident" id="5730515">hdr</span><span class="op" id="5730518">.</span><span class="ident" id="5730519">Size</span><span class="op" id="5730523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730527">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730531">return</span>&nbsp;<span class="ident" id="5730538">hdr</span><span class="op" id="5730541">,</span>&nbsp;<span class="ident" id="5730543">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730548">case</span>&nbsp;<span class="ident" id="5730553">TypeGNULongName</span><span class="op" id="5730568">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730572">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730646">realname</span><span class="op" id="5730654">,</span>&nbsp;<span class="ident" id="5730656">err</span>&nbsp;<span class="op" id="5730660">:=</span>&nbsp;<span class="ident" id="5730663">ioutil</span><span class="op" id="5730669">.</span><span class="ident" id="5730670">ReadAll</span><span class="op" id="5730677">(</span><span class="ident" id="5730678">tr</span><span class="op" id="5730680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730684">if</span>&nbsp;<span class="ident" id="5730687">err</span>&nbsp;<span class="op" id="5730691">!=</span>&nbsp;<span class="ident" id="5730694">nil</span>&nbsp;<span class="op" id="5730698">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730703">return</span>&nbsp;<span class="ident" id="5730710">nil</span><span class="op" id="5730713">,</span>&nbsp;<span class="ident" id="5730715">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730725">hdr</span><span class="op" id="5730728">,</span>&nbsp;<span class="ident" id="5730730">err</span>&nbsp;<span class="op" id="5730734">:=</span>&nbsp;<span class="ident" id="5730737">tr</span><span class="op" id="5730739">.</span><span class="ident" id="5730740">Next</span><span class="op" id="5730744">(</span><span class="op" id="5730745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730749">hdr</span><span class="op" id="5730752">.</span><span class="ident" id="5730753">Name</span>&nbsp;<span class="op" id="5730758">=</span>&nbsp;<span class="ident" id="5730760">cString</span><span class="op" id="5730767">(</span><span class="ident" id="5730768">realname</span><span class="op" id="5730776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730780">return</span>&nbsp;<span class="ident" id="5730787">hdr</span><span class="op" id="5730790">,</span>&nbsp;<span class="ident" id="5730792">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730797">case</span>&nbsp;<span class="ident" id="5730802">TypeGNULongLink</span><span class="op" id="5730817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5730821">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730858">realname</span><span class="op" id="5730866">,</span>&nbsp;<span class="ident" id="5730868">err</span>&nbsp;<span class="op" id="5730872">:=</span>&nbsp;<span class="ident" id="5730875">ioutil</span><span class="op" id="5730881">.</span><span class="ident" id="5730882">ReadAll</span><span class="op" id="5730889">(</span><span class="ident" id="5730890">tr</span><span class="op" id="5730892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730896">if</span>&nbsp;<span class="ident" id="5730899">err</span>&nbsp;<span class="op" id="5730903">!=</span>&nbsp;<span class="ident" id="5730906">nil</span>&nbsp;<span class="op" id="5730910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730915">return</span>&nbsp;<span class="ident" id="5730922">nil</span><span class="op" id="5730925">,</span>&nbsp;<span class="ident" id="5730927">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5730933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730937">hdr</span><span class="op" id="5730940">,</span>&nbsp;<span class="ident" id="5730942">err</span>&nbsp;<span class="op" id="5730946">:=</span>&nbsp;<span class="ident" id="5730949">tr</span><span class="op" id="5730951">.</span><span class="ident" id="5730952">Next</span><span class="op" id="5730956">(</span><span class="op" id="5730957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5730961">hdr</span><span class="op" id="5730964">.</span><span class="ident" id="5730965">Linkname</span>&nbsp;<span class="op" id="5730974">=</span>&nbsp;<span class="ident" id="5730976">cString</span><span class="op" id="5730983">(</span><span class="ident" id="5730984">realname</span><span class="op" id="5730992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5730996">return</span>&nbsp;<span class="ident" id="5731003">hdr</span><span class="op" id="5731006">,</span>&nbsp;<span class="ident" id="5731008">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731013">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731016">return</span>&nbsp;<span class="ident" id="5731023">hdr</span><span class="op" id="5731026">,</span>&nbsp;<span class="ident" id="5731028">tr</span><span class="op" id="5731030">.</span><span class="ident" id="5731031">err</span><br>
<span class="lineno"></span><span class="op" id="5731035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5731038">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5731140">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5731250">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5731283">func</span>&nbsp;<span class="op" id="5731288">(</span><span class="ident" id="5731289">tr</span>&nbsp;<span class="op" id="5731292">*</span><span class="ident" id="5731293">Reader</span><span class="op" id="5731299">)</span>&nbsp;<span class="ident" id="5731301">checkForGNUSparsePAXHeaders</span><span class="op" id="5731328">(</span><span class="ident" id="5731329">hdr</span>&nbsp;<span class="op" id="5731333">*</span><span class="ident" id="5731334">Header</span><span class="op" id="5731340">,</span>&nbsp;<span class="ident" id="5731342">headers</span>&nbsp;<span class="keyword" id="5731350">map</span><span class="op" id="5731353">[</span><span class="builtintype" id="5731354">string</span><span class="op" id="5731360">]</span><span class="builtintype" id="5731361">string</span><span class="op" id="5731367">)</span>&nbsp;<span class="op" id="5731369">(</span><span class="op" id="5731370">[</span><span class="op" id="5731371">]</span><span class="ident" id="5731372">sparseEntry</span><span class="op" id="5731383">,</span>&nbsp;<span class="builtintype" id="5731385">error</span><span class="op" id="5731390">)</span>&nbsp;<span class="op" id="5731392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731395">var</span>&nbsp;<span class="ident" id="5731399">sparseFormat</span>&nbsp;<span class="builtintype" id="5731412">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731421">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731460">major</span><span class="op" id="5731465">,</span>&nbsp;<span class="ident" id="5731467">majorOk</span>&nbsp;<span class="op" id="5731475">:=</span>&nbsp;<span class="ident" id="5731478">headers</span><span class="op" id="5731485">[</span><span class="ident" id="5731486">paxGNUSparseMajor</span><span class="op" id="5731503">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731506">minor</span><span class="op" id="5731511">,</span>&nbsp;<span class="ident" id="5731513">minorOk</span>&nbsp;<span class="op" id="5731521">:=</span>&nbsp;<span class="ident" id="5731524">headers</span><span class="op" id="5731531">[</span><span class="ident" id="5731532">paxGNUSparseMinor</span><span class="op" id="5731549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731552">sparseName</span><span class="op" id="5731562">,</span>&nbsp;<span class="ident" id="5731564">sparseNameOk</span>&nbsp;<span class="op" id="5731577">:=</span>&nbsp;<span class="ident" id="5731580">headers</span><span class="op" id="5731587">[</span><span class="ident" id="5731588">paxGNUSparseName</span><span class="op" id="5731604">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731607">_</span><span class="op" id="5731608">,</span>&nbsp;<span class="ident" id="5731610">sparseMapOk</span>&nbsp;<span class="op" id="5731622">:=</span>&nbsp;<span class="ident" id="5731625">headers</span><span class="op" id="5731632">[</span><span class="ident" id="5731633">paxGNUSparseMap</span><span class="op" id="5731648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731651">sparseSize</span><span class="op" id="5731661">,</span>&nbsp;<span class="ident" id="5731663">sparseSizeOk</span>&nbsp;<span class="op" id="5731676">:=</span>&nbsp;<span class="ident" id="5731679">headers</span><span class="op" id="5731686">[</span><span class="ident" id="5731687">paxGNUSparseSize</span><span class="op" id="5731703">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731706">sparseRealSize</span><span class="op" id="5731720">,</span>&nbsp;<span class="ident" id="5731722">sparseRealSizeOk</span>&nbsp;<span class="op" id="5731739">:=</span>&nbsp;<span class="ident" id="5731742">headers</span><span class="op" id="5731749">[</span><span class="ident" id="5731750">paxGNUSparseRealSize</span><span class="op" id="5731770">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5731774">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5731855">if</span>&nbsp;<span class="ident" id="5731858">majorOk</span>&nbsp;<span class="op" id="5731866">&amp;&amp;</span>&nbsp;<span class="ident" id="5731869">minorOk</span>&nbsp;<span class="op" id="5731877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731881">sparseFormat</span>&nbsp;<span class="op" id="5731894">=</span>&nbsp;<span class="ident" id="5731896">major</span>&nbsp;<span class="op" id="5731902">+</span>&nbsp;<span class="string" id="5731904">&#34;.&#34;</span>&nbsp;<span class="op" id="5731908">+</span>&nbsp;<span class="ident" id="5731910">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731917">}</span>&nbsp;<span class="keyword" id="5731919">else</span>&nbsp;<span class="keyword" id="5731924">if</span>&nbsp;<span class="ident" id="5731927">sparseNameOk</span>&nbsp;<span class="op" id="5731940">&amp;&amp;</span>&nbsp;<span class="ident" id="5731943">sparseMapOk</span>&nbsp;<span class="op" id="5731955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5731959">sparseFormat</span>&nbsp;<span class="op" id="5731972">=</span>&nbsp;<span class="string" id="5731974">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5731981">}</span>&nbsp;<span class="keyword" id="5731983">else</span>&nbsp;<span class="keyword" id="5731988">if</span>&nbsp;<span class="ident" id="5731991">sparseSizeOk</span>&nbsp;<span class="op" id="5732004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732008">sparseFormat</span>&nbsp;<span class="op" id="5732021">=</span>&nbsp;<span class="string" id="5732023">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732030">}</span>&nbsp;<span class="keyword" id="5732032">else</span>&nbsp;<span class="op" id="5732037">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5732041">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732080">return</span>&nbsp;<span class="ident" id="5732087">nil</span><span class="op" id="5732090">,</span>&nbsp;<span class="ident" id="5732092">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5732101">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732137">if</span>&nbsp;<span class="ident" id="5732140">sparseFormat</span>&nbsp;<span class="op" id="5732153">!=</span>&nbsp;<span class="string" id="5732156">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5732162">&amp;&amp;</span>&nbsp;<span class="ident" id="5732165">sparseFormat</span>&nbsp;<span class="op" id="5732178">!=</span>&nbsp;<span class="string" id="5732181">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5732187">&amp;&amp;</span>&nbsp;<span class="ident" id="5732190">sparseFormat</span>&nbsp;<span class="op" id="5732203">!=</span>&nbsp;<span class="string" id="5732206">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5732212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732216">return</span>&nbsp;<span class="ident" id="5732223">nil</span><span class="op" id="5732226">,</span>&nbsp;<span class="ident" id="5732228">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5732237">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732280">if</span>&nbsp;<span class="ident" id="5732283">sparseNameOk</span>&nbsp;<span class="op" id="5732296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732300">hdr</span><span class="op" id="5732303">.</span><span class="ident" id="5732304">Name</span>&nbsp;<span class="op" id="5732309">=</span>&nbsp;<span class="ident" id="5732311">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732326">if</span>&nbsp;<span class="ident" id="5732329">sparseSizeOk</span>&nbsp;<span class="op" id="5732342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732346">realSize</span><span class="op" id="5732354">,</span>&nbsp;<span class="ident" id="5732356">err</span>&nbsp;<span class="op" id="5732360">:=</span>&nbsp;<span class="ident" id="5732363">strconv</span><span class="op" id="5732370">.</span><span class="ident" id="5732371">ParseInt</span><span class="op" id="5732379">(</span><span class="ident" id="5732380">sparseSize</span><span class="op" id="5732390">,</span>&nbsp;<span class="num" id="5732392">10</span><span class="op" id="5732394">,</span>&nbsp;<span class="num" id="5732396">0</span><span class="op" id="5732397">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732401">if</span>&nbsp;<span class="ident" id="5732404">err</span>&nbsp;<span class="op" id="5732408">!=</span>&nbsp;<span class="ident" id="5732411">nil</span>&nbsp;<span class="op" id="5732415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732420">return</span>&nbsp;<span class="ident" id="5732427">nil</span><span class="op" id="5732430">,</span>&nbsp;<span class="ident" id="5732432">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732448">hdr</span><span class="op" id="5732451">.</span><span class="ident" id="5732452">Size</span>&nbsp;<span class="op" id="5732457">=</span>&nbsp;<span class="ident" id="5732459">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732469">}</span>&nbsp;<span class="keyword" id="5732471">else</span>&nbsp;<span class="keyword" id="5732476">if</span>&nbsp;<span class="ident" id="5732479">sparseRealSizeOk</span>&nbsp;<span class="op" id="5732496">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732500">realSize</span><span class="op" id="5732508">,</span>&nbsp;<span class="ident" id="5732510">err</span>&nbsp;<span class="op" id="5732514">:=</span>&nbsp;<span class="ident" id="5732517">strconv</span><span class="op" id="5732524">.</span><span class="ident" id="5732525">ParseInt</span><span class="op" id="5732533">(</span><span class="ident" id="5732534">sparseRealSize</span><span class="op" id="5732548">,</span>&nbsp;<span class="num" id="5732550">10</span><span class="op" id="5732552">,</span>&nbsp;<span class="num" id="5732554">0</span><span class="op" id="5732555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732559">if</span>&nbsp;<span class="ident" id="5732562">err</span>&nbsp;<span class="op" id="5732566">!=</span>&nbsp;<span class="ident" id="5732569">nil</span>&nbsp;<span class="op" id="5732573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732578">return</span>&nbsp;<span class="ident" id="5732585">nil</span><span class="op" id="5732588">,</span>&nbsp;<span class="ident" id="5732590">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732606">hdr</span><span class="op" id="5732609">.</span><span class="ident" id="5732610">Size</span>&nbsp;<span class="op" id="5732615">=</span>&nbsp;<span class="ident" id="5732617">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5732631">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732707">var</span>&nbsp;<span class="ident" id="5732711">sp</span>&nbsp;<span class="op" id="5732714">[</span><span class="op" id="5732715">]</span><span class="ident" id="5732716">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732729">var</span>&nbsp;<span class="ident" id="5732733">err</span>&nbsp;<span class="builtintype" id="5732737">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732744">switch</span>&nbsp;<span class="ident" id="5732751">sparseFormat</span>&nbsp;<span class="op" id="5732764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732767">case</span>&nbsp;<span class="string" id="5732772">&#34;0.0&#34;</span><span class="op" id="5732777">,</span>&nbsp;<span class="string" id="5732779">&#34;0.1&#34;</span><span class="op" id="5732784">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732788">sp</span><span class="op" id="5732790">,</span>&nbsp;<span class="ident" id="5732792">err</span>&nbsp;<span class="op" id="5732796">=</span>&nbsp;<span class="ident" id="5732798">readGNUSparseMap0x1</span><span class="op" id="5732817">(</span><span class="ident" id="5732818">headers</span><span class="op" id="5732825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732828">case</span>&nbsp;<span class="string" id="5732833">&#34;1.0&#34;</span><span class="op" id="5732838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5732842">sp</span><span class="op" id="5732844">,</span>&nbsp;<span class="ident" id="5732846">err</span>&nbsp;<span class="op" id="5732850">=</span>&nbsp;<span class="ident" id="5732852">readGNUSparseMap1x0</span><span class="op" id="5732871">(</span><span class="ident" id="5732872">tr</span><span class="op" id="5732874">.</span><span class="ident" id="5732875">curr</span><span class="op" id="5732879">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5732882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5732885">return</span>&nbsp;<span class="ident" id="5732892">sp</span><span class="op" id="5732894">,</span>&nbsp;<span class="ident" id="5732896">err</span><br>
<span class="lineno"></span><span class="op" id="5732900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5732903">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5732968">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5733024">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5733084">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5733146">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5733179">func</span>&nbsp;<span class="ident" id="5733184">mergePAX</span><span class="op" id="5733192">(</span><span class="ident" id="5733193">hdr</span>&nbsp;<span class="op" id="5733197">*</span><span class="ident" id="5733198">Header</span><span class="op" id="5733204">,</span>&nbsp;<span class="ident" id="5733206">headers</span>&nbsp;<span class="keyword" id="5733214">map</span><span class="op" id="5733217">[</span><span class="builtintype" id="5733218">string</span><span class="op" id="5733224">]</span><span class="builtintype" id="5733225">string</span><span class="op" id="5733231">)</span>&nbsp;<span class="builtintype" id="5733233">error</span>&nbsp;<span class="op" id="5733239">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733242">for</span>&nbsp;<span class="ident" id="5733246">k</span><span class="op" id="5733247">,</span>&nbsp;<span class="ident" id="5733249">v</span>&nbsp;<span class="op" id="5733251">:=</span>&nbsp;<span class="keyword" id="5733254">range</span>&nbsp;<span class="ident" id="5733260">headers</span>&nbsp;<span class="op" id="5733268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733272">switch</span>&nbsp;<span class="ident" id="5733279">k</span>&nbsp;<span class="op" id="5733281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733285">case</span>&nbsp;<span class="ident" id="5733290">paxPath</span><span class="op" id="5733297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733302">hdr</span><span class="op" id="5733305">.</span><span class="ident" id="5733306">Name</span>&nbsp;<span class="op" id="5733311">=</span>&nbsp;<span class="ident" id="5733313">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733317">case</span>&nbsp;<span class="ident" id="5733322">paxLinkpath</span><span class="op" id="5733333">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733338">hdr</span><span class="op" id="5733341">.</span><span class="ident" id="5733342">Linkname</span>&nbsp;<span class="op" id="5733351">=</span>&nbsp;<span class="ident" id="5733353">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733357">case</span>&nbsp;<span class="ident" id="5733362">paxGname</span><span class="op" id="5733370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733375">hdr</span><span class="op" id="5733378">.</span><span class="ident" id="5733379">Gname</span>&nbsp;<span class="op" id="5733385">=</span>&nbsp;<span class="ident" id="5733387">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733391">case</span>&nbsp;<span class="ident" id="5733396">paxUname</span><span class="op" id="5733404">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733409">hdr</span><span class="op" id="5733412">.</span><span class="ident" id="5733413">Uname</span>&nbsp;<span class="op" id="5733419">=</span>&nbsp;<span class="ident" id="5733421">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733425">case</span>&nbsp;<span class="ident" id="5733430">paxUid</span><span class="op" id="5733436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733441">uid</span><span class="op" id="5733444">,</span>&nbsp;<span class="ident" id="5733446">err</span>&nbsp;<span class="op" id="5733450">:=</span>&nbsp;<span class="ident" id="5733453">strconv</span><span class="op" id="5733460">.</span><span class="ident" id="5733461">ParseInt</span><span class="op" id="5733469">(</span><span class="ident" id="5733470">v</span><span class="op" id="5733471">,</span>&nbsp;<span class="num" id="5733473">10</span><span class="op" id="5733475">,</span>&nbsp;<span class="num" id="5733477">0</span><span class="op" id="5733478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733483">if</span>&nbsp;<span class="ident" id="5733486">err</span>&nbsp;<span class="op" id="5733490">!=</span>&nbsp;<span class="ident" id="5733493">nil</span>&nbsp;<span class="op" id="5733497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733503">return</span>&nbsp;<span class="ident" id="5733510">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733517">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733522">hdr</span><span class="op" id="5733525">.</span><span class="ident" id="5733526">Uid</span>&nbsp;<span class="op" id="5733530">=</span>&nbsp;<span class="builtintype" id="5733532">int</span><span class="op" id="5733535">(</span><span class="ident" id="5733536">uid</span><span class="op" id="5733539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733543">case</span>&nbsp;<span class="ident" id="5733548">paxGid</span><span class="op" id="5733554">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733559">gid</span><span class="op" id="5733562">,</span>&nbsp;<span class="ident" id="5733564">err</span>&nbsp;<span class="op" id="5733568">:=</span>&nbsp;<span class="ident" id="5733571">strconv</span><span class="op" id="5733578">.</span><span class="ident" id="5733579">ParseInt</span><span class="op" id="5733587">(</span><span class="ident" id="5733588">v</span><span class="op" id="5733589">,</span>&nbsp;<span class="num" id="5733591">10</span><span class="op" id="5733593">,</span>&nbsp;<span class="num" id="5733595">0</span><span class="op" id="5733596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733601">if</span>&nbsp;<span class="ident" id="5733604">err</span>&nbsp;<span class="op" id="5733608">!=</span>&nbsp;<span class="ident" id="5733611">nil</span>&nbsp;<span class="op" id="5733615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733621">return</span>&nbsp;<span class="ident" id="5733628">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733640">hdr</span><span class="op" id="5733643">.</span><span class="ident" id="5733644">Gid</span>&nbsp;<span class="op" id="5733648">=</span>&nbsp;<span class="builtintype" id="5733650">int</span><span class="op" id="5733653">(</span><span class="ident" id="5733654">gid</span><span class="op" id="5733657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733661">case</span>&nbsp;<span class="ident" id="5733666">paxAtime</span><span class="op" id="5733674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733679">t</span><span class="op" id="5733680">,</span>&nbsp;<span class="ident" id="5733682">err</span>&nbsp;<span class="op" id="5733686">:=</span>&nbsp;<span class="ident" id="5733689">parsePAXTime</span><span class="op" id="5733701">(</span><span class="ident" id="5733702">v</span><span class="op" id="5733703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733708">if</span>&nbsp;<span class="ident" id="5733711">err</span>&nbsp;<span class="op" id="5733715">!=</span>&nbsp;<span class="ident" id="5733718">nil</span>&nbsp;<span class="op" id="5733722">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733728">return</span>&nbsp;<span class="ident" id="5733735">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733747">hdr</span><span class="op" id="5733750">.</span><span class="ident" id="5733751">AccessTime</span>&nbsp;<span class="op" id="5733762">=</span>&nbsp;<span class="ident" id="5733764">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733768">case</span>&nbsp;<span class="ident" id="5733773">paxMtime</span><span class="op" id="5733781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733786">t</span><span class="op" id="5733787">,</span>&nbsp;<span class="ident" id="5733789">err</span>&nbsp;<span class="op" id="5733793">:=</span>&nbsp;<span class="ident" id="5733796">parsePAXTime</span><span class="op" id="5733808">(</span><span class="ident" id="5733809">v</span><span class="op" id="5733810">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733815">if</span>&nbsp;<span class="ident" id="5733818">err</span>&nbsp;<span class="op" id="5733822">!=</span>&nbsp;<span class="ident" id="5733825">nil</span>&nbsp;<span class="op" id="5733829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733835">return</span>&nbsp;<span class="ident" id="5733842">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733854">hdr</span><span class="op" id="5733857">.</span><span class="ident" id="5733858">ModTime</span>&nbsp;<span class="op" id="5733866">=</span>&nbsp;<span class="ident" id="5733868">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733872">case</span>&nbsp;<span class="ident" id="5733877">paxCtime</span><span class="op" id="5733885">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733890">t</span><span class="op" id="5733891">,</span>&nbsp;<span class="ident" id="5733893">err</span>&nbsp;<span class="op" id="5733897">:=</span>&nbsp;<span class="ident" id="5733900">parsePAXTime</span><span class="op" id="5733912">(</span><span class="ident" id="5733913">v</span><span class="op" id="5733914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733919">if</span>&nbsp;<span class="ident" id="5733922">err</span>&nbsp;<span class="op" id="5733926">!=</span>&nbsp;<span class="ident" id="5733929">nil</span>&nbsp;<span class="op" id="5733933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733939">return</span>&nbsp;<span class="ident" id="5733946">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5733953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733958">hdr</span><span class="op" id="5733961">.</span><span class="ident" id="5733962">ChangeTime</span>&nbsp;<span class="op" id="5733973">=</span>&nbsp;<span class="ident" id="5733975">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5733979">case</span>&nbsp;<span class="ident" id="5733984">paxSize</span><span class="op" id="5733991">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5733996">size</span><span class="op" id="5734000">,</span>&nbsp;<span class="ident" id="5734002">err</span>&nbsp;<span class="op" id="5734006">:=</span>&nbsp;<span class="ident" id="5734009">strconv</span><span class="op" id="5734016">.</span><span class="ident" id="5734017">ParseInt</span><span class="op" id="5734025">(</span><span class="ident" id="5734026">v</span><span class="op" id="5734027">,</span>&nbsp;<span class="num" id="5734029">10</span><span class="op" id="5734031">,</span>&nbsp;<span class="num" id="5734033">0</span><span class="op" id="5734034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734039">if</span>&nbsp;<span class="ident" id="5734042">err</span>&nbsp;<span class="op" id="5734046">!=</span>&nbsp;<span class="ident" id="5734049">nil</span>&nbsp;<span class="op" id="5734053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734059">return</span>&nbsp;<span class="ident" id="5734066">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734073">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734078">hdr</span><span class="op" id="5734081">.</span><span class="ident" id="5734082">Size</span>&nbsp;<span class="op" id="5734087">=</span>&nbsp;<span class="ident" id="5734089">int64</span><span class="op" id="5734094">(</span><span class="ident" id="5734095">size</span><span class="op" id="5734099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734103">default</span><span class="op" id="5734110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734115">if</span>&nbsp;<span class="ident" id="5734118">strings</span><span class="op" id="5734125">.</span><span class="ident" id="5734126">HasPrefix</span><span class="op" id="5734135">(</span><span class="ident" id="5734136">k</span><span class="op" id="5734137">,</span>&nbsp;<span class="ident" id="5734139">paxXattr</span><span class="op" id="5734147">)</span>&nbsp;<span class="op" id="5734149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734155">if</span>&nbsp;<span class="ident" id="5734158">hdr</span><span class="op" id="5734161">.</span><span class="ident" id="5734162">Xattrs</span>&nbsp;<span class="op" id="5734169">==</span>&nbsp;<span class="ident" id="5734172">nil</span>&nbsp;<span class="op" id="5734176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734183">hdr</span><span class="op" id="5734186">.</span><span class="ident" id="5734187">Xattrs</span>&nbsp;<span class="op" id="5734194">=</span>&nbsp;<span class="builtinfunc" id="5734196">make</span><span class="op" id="5734200">(</span><span class="keyword" id="5734201">map</span><span class="op" id="5734204">[</span><span class="builtintype" id="5734205">string</span><span class="op" id="5734211">]</span><span class="builtintype" id="5734212">string</span><span class="op" id="5734218">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734230">hdr</span><span class="op" id="5734233">.</span><span class="ident" id="5734234">Xattrs</span><span class="op" id="5734240">[</span><span class="ident" id="5734241">k</span><span class="op" id="5734242">[</span><span class="builtinfunc" id="5734243">len</span><span class="op" id="5734246">(</span><span class="ident" id="5734247">paxXattr</span><span class="op" id="5734255">)</span><span class="op" id="5734256">:</span><span class="op" id="5734257">]</span><span class="op" id="5734258">]</span>&nbsp;<span class="op" id="5734260">=</span>&nbsp;<span class="ident" id="5734262">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734274">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734277">return</span>&nbsp;<span class="ident" id="5734284">nil</span><br>
<span class="lineno"></span><span class="op" id="5734288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5734291">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5734356">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5734382">func</span>&nbsp;<span class="ident" id="5734387">parsePAXTime</span><span class="op" id="5734399">(</span><span class="ident" id="5734400">t</span>&nbsp;<span class="builtintype" id="5734402">string</span><span class="op" id="5734408">)</span>&nbsp;<span class="op" id="5734410">(</span><span class="ident" id="5734411">time</span><span class="op" id="5734415">.</span><span class="ident" id="5734416">Time</span><span class="op" id="5734420">,</span>&nbsp;<span class="builtintype" id="5734422">error</span><span class="op" id="5734427">)</span>&nbsp;<span class="op" id="5734429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734432">buf</span>&nbsp;<span class="op" id="5734436">:=</span>&nbsp;<span class="op" id="5734439">[</span><span class="op" id="5734440">]</span><span class="builtintype" id="5734441">byte</span><span class="op" id="5734445">(</span><span class="ident" id="5734446">t</span><span class="op" id="5734447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734450">pos</span>&nbsp;<span class="op" id="5734454">:=</span>&nbsp;<span class="ident" id="5734457">bytes</span><span class="op" id="5734462">.</span><span class="ident" id="5734463">IndexByte</span><span class="op" id="5734472">(</span><span class="ident" id="5734473">buf</span><span class="op" id="5734476">,</span>&nbsp;<span class="string" id="5734478">&#39;.&#39;</span><span class="op" id="5734481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734484">var</span>&nbsp;<span class="ident" id="5734488">seconds</span><span class="op" id="5734495">,</span>&nbsp;<span class="ident" id="5734497">nanoseconds</span>&nbsp;<span class="ident" id="5734509">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734516">var</span>&nbsp;<span class="ident" id="5734520">err</span>&nbsp;<span class="builtintype" id="5734524">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734531">if</span>&nbsp;<span class="ident" id="5734534">pos</span>&nbsp;<span class="op" id="5734538">==</span>&nbsp;<span class="op" id="5734541">-</span><span class="num" id="5734542">1</span>&nbsp;<span class="op" id="5734544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734548">seconds</span><span class="op" id="5734555">,</span>&nbsp;<span class="ident" id="5734557">err</span>&nbsp;<span class="op" id="5734561">=</span>&nbsp;<span class="ident" id="5734563">strconv</span><span class="op" id="5734570">.</span><span class="ident" id="5734571">ParseInt</span><span class="op" id="5734579">(</span><span class="ident" id="5734580">t</span><span class="op" id="5734581">,</span>&nbsp;<span class="num" id="5734583">10</span><span class="op" id="5734585">,</span>&nbsp;<span class="num" id="5734587">0</span><span class="op" id="5734588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734592">if</span>&nbsp;<span class="ident" id="5734595">err</span>&nbsp;<span class="op" id="5734599">!=</span>&nbsp;<span class="ident" id="5734602">nil</span>&nbsp;<span class="op" id="5734606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734611">return</span>&nbsp;<span class="ident" id="5734618">time</span><span class="op" id="5734622">.</span><span class="ident" id="5734623">Time</span><span class="op" id="5734627">{</span><span class="op" id="5734628">}</span><span class="op" id="5734629">,</span>&nbsp;<span class="ident" id="5734631">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734637">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734640">}</span>&nbsp;<span class="keyword" id="5734642">else</span>&nbsp;<span class="op" id="5734647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734651">seconds</span><span class="op" id="5734658">,</span>&nbsp;<span class="ident" id="5734660">err</span>&nbsp;<span class="op" id="5734664">=</span>&nbsp;<span class="ident" id="5734666">strconv</span><span class="op" id="5734673">.</span><span class="ident" id="5734674">ParseInt</span><span class="op" id="5734682">(</span><span class="builtintype" id="5734683">string</span><span class="op" id="5734689">(</span><span class="ident" id="5734690">buf</span><span class="op" id="5734693">[</span><span class="op" id="5734694">:</span><span class="ident" id="5734695">pos</span><span class="op" id="5734698">]</span><span class="op" id="5734699">)</span><span class="op" id="5734700">,</span>&nbsp;<span class="num" id="5734702">10</span><span class="op" id="5734704">,</span>&nbsp;<span class="num" id="5734706">0</span><span class="op" id="5734707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734711">if</span>&nbsp;<span class="ident" id="5734714">err</span>&nbsp;<span class="op" id="5734718">!=</span>&nbsp;<span class="ident" id="5734721">nil</span>&nbsp;<span class="op" id="5734725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734730">return</span>&nbsp;<span class="ident" id="5734737">time</span><span class="op" id="5734741">.</span><span class="ident" id="5734742">Time</span><span class="op" id="5734746">{</span><span class="op" id="5734747">}</span><span class="op" id="5734748">,</span>&nbsp;<span class="ident" id="5734750">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5734756">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734760">nano_buf</span>&nbsp;<span class="op" id="5734769">:=</span>&nbsp;<span class="builtintype" id="5734772">string</span><span class="op" id="5734778">(</span><span class="ident" id="5734779">buf</span><span class="op" id="5734782">[</span><span class="ident" id="5734783">pos</span><span class="op" id="5734786">+</span><span class="num" id="5734787">1</span><span class="op" id="5734788">:</span><span class="op" id="5734789">]</span><span class="op" id="5734790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5734794">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5734845">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5734905">if</span>&nbsp;<span class="builtinfunc" id="5734908">len</span><span class="op" id="5734911">(</span><span class="ident" id="5734912">nano_buf</span><span class="op" id="5734920">)</span>&nbsp;<span class="op" id="5734922">&lt;</span>&nbsp;<span class="ident" id="5734924">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5734945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5734950">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5734966">nano_buf</span>&nbsp;<span class="op" id="5734975">+=</span>&nbsp;<span class="ident" id="5734978">strings</span><span class="op" id="5734985">.</span><span class="ident" id="5734986">Repeat</span><span class="op" id="5734992">(</span><span class="string" id="5734993">&#34;0&#34;</span><span class="op" id="5734996">,</span>&nbsp;<span class="ident" id="5734998">maxNanoSecondIntSize</span><span class="op" id="5735018">-</span><span class="builtinfunc" id="5735019">len</span><span class="op" id="5735022">(</span><span class="ident" id="5735023">nano_buf</span><span class="op" id="5735031">)</span><span class="op" id="5735032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5735036">}</span>&nbsp;<span class="keyword" id="5735038">else</span>&nbsp;<span class="keyword" id="5735043">if</span>&nbsp;<span class="builtinfunc" id="5735046">len</span><span class="op" id="5735049">(</span><span class="ident" id="5735050">nano_buf</span><span class="op" id="5735058">)</span>&nbsp;<span class="op" id="5735060">&gt;</span>&nbsp;<span class="ident" id="5735062">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5735083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735088">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5735109">nano_buf</span>&nbsp;<span class="op" id="5735118">=</span>&nbsp;<span class="ident" id="5735120">nano_buf</span><span class="op" id="5735128">[</span><span class="op" id="5735129">:</span><span class="ident" id="5735130">maxNanoSecondIntSize</span><span class="op" id="5735150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5735154">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5735158">nanoseconds</span><span class="op" id="5735169">,</span>&nbsp;<span class="ident" id="5735171">err</span>&nbsp;<span class="op" id="5735175">=</span>&nbsp;<span class="ident" id="5735177">strconv</span><span class="op" id="5735184">.</span><span class="ident" id="5735185">ParseInt</span><span class="op" id="5735193">(</span><span class="builtintype" id="5735194">string</span><span class="op" id="5735200">(</span><span class="ident" id="5735201">nano_buf</span><span class="op" id="5735209">)</span><span class="op" id="5735210">,</span>&nbsp;<span class="num" id="5735212">10</span><span class="op" id="5735214">,</span>&nbsp;<span class="num" id="5735216">0</span><span class="op" id="5735217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735221">if</span>&nbsp;<span class="ident" id="5735224">err</span>&nbsp;<span class="op" id="5735228">!=</span>&nbsp;<span class="ident" id="5735231">nil</span>&nbsp;<span class="op" id="5735235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735240">return</span>&nbsp;<span class="ident" id="5735247">time</span><span class="op" id="5735251">.</span><span class="ident" id="5735252">Time</span><span class="op" id="5735256">{</span><span class="op" id="5735257">}</span><span class="op" id="5735258">,</span>&nbsp;<span class="ident" id="5735260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5735266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5735269">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5735272">ts</span>&nbsp;<span class="op" id="5735275">:=</span>&nbsp;<span class="ident" id="5735278">time</span><span class="op" id="5735282">.</span><span class="ident" id="5735283">Unix</span><span class="op" id="5735287">(</span><span class="ident" id="5735288">seconds</span><span class="op" id="5735295">,</span>&nbsp;<span class="ident" id="5735297">nanoseconds</span><span class="op" id="5735308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735311">return</span>&nbsp;<span class="ident" id="5735318">ts</span><span class="op" id="5735320">,</span>&nbsp;<span class="ident" id="5735322">nil</span><br>
<span class="lineno"></span><span class="op" id="5735326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5735329">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="5735361">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="5735431">func</span>&nbsp;<span class="ident" id="5735436">parsePAX</span><span class="op" id="5735444">(</span><span class="ident" id="5735445">r</span>&nbsp;<span class="ident" id="5735447">io</span><span class="op" id="5735449">.</span><span class="ident" id="5735450">Reader</span><span class="op" id="5735456">)</span>&nbsp;<span class="op" id="5735458">(</span><span class="keyword" id="5735459">map</span><span class="op" id="5735462">[</span><span class="builtintype" id="5735463">string</span><span class="op" id="5735469">]</span><span class="builtintype" id="5735470">string</span><span class="op" id="5735476">,</span>&nbsp;<span class="builtintype" id="5735478">error</span><span class="op" id="5735483">)</span>&nbsp;<span class="op" id="5735485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5735488">buf</span><span class="op" id="5735491">,</span>&nbsp;<span class="ident" id="5735493">err</span>&nbsp;<span class="op" id="5735497">:=</span>&nbsp;<span class="ident" id="5735500">ioutil</span><span class="op" id="5735506">.</span><span class="ident" id="5735507">ReadAll</span><span class="op" id="5735514">(</span><span class="ident" id="5735515">r</span><span class="op" id="5735516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735519">if</span>&nbsp;<span class="ident" id="5735522">err</span>&nbsp;<span class="op" id="5735526">!=</span>&nbsp;<span class="ident" id="5735529">nil</span>&nbsp;<span class="op" id="5735533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735537">return</span>&nbsp;<span class="ident" id="5735544">nil</span><span class="op" id="5735547">,</span>&nbsp;<span class="ident" id="5735549">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5735554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735558">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735601">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735692">var</span>&nbsp;<span class="ident" id="5735696">sparseMap</span>&nbsp;<span class="ident" id="5735706">bytes</span><span class="op" id="5735711">.</span><span class="ident" id="5735712">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5735721">headers</span>&nbsp;<span class="op" id="5735729">:=</span>&nbsp;<span class="builtinfunc" id="5735732">make</span><span class="op" id="5735736">(</span><span class="keyword" id="5735737">map</span><span class="op" id="5735740">[</span><span class="builtintype" id="5735741">string</span><span class="op" id="5735747">]</span><span class="builtintype" id="5735748">string</span><span class="op" id="5735754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735757">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735791">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735836">for</span>&nbsp;<span class="builtinfunc" id="5735840">len</span><span class="op" id="5735843">(</span><span class="ident" id="5735844">buf</span><span class="op" id="5735847">)</span>&nbsp;<span class="op" id="5735849">&gt;</span>&nbsp;<span class="num" id="5735851">0</span>&nbsp;<span class="op" id="5735853">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735857">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735901">var</span>&nbsp;<span class="ident" id="5735905">sp</span>&nbsp;<span class="builtintype" id="5735908">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5735914">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5735959">sp</span>&nbsp;<span class="op" id="5735962">=</span>&nbsp;<span class="ident" id="5735964">bytes</span><span class="op" id="5735969">.</span><span class="ident" id="5735970">IndexByte</span><span class="op" id="5735979">(</span><span class="ident" id="5735980">buf</span><span class="op" id="5735983">,</span>&nbsp;<span class="string" id="5735985">&#39;&nbsp;&#39;</span><span class="op" id="5735988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5735992">if</span>&nbsp;<span class="ident" id="5735995">sp</span>&nbsp;<span class="op" id="5735998">==</span>&nbsp;<span class="op" id="5736001">-</span><span class="num" id="5736002">1</span>&nbsp;<span class="op" id="5736004">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736009">return</span>&nbsp;<span class="ident" id="5736016">nil</span><span class="op" id="5736019">,</span>&nbsp;<span class="ident" id="5736021">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5736033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736037">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736086">n</span><span class="op" id="5736087">,</span>&nbsp;<span class="ident" id="5736089">err</span>&nbsp;<span class="op" id="5736093">:=</span>&nbsp;<span class="ident" id="5736096">strconv</span><span class="op" id="5736103">.</span><span class="ident" id="5736104">ParseInt</span><span class="op" id="5736112">(</span><span class="builtintype" id="5736113">string</span><span class="op" id="5736119">(</span><span class="ident" id="5736120">buf</span><span class="op" id="5736123">[</span><span class="op" id="5736124">:</span><span class="ident" id="5736125">sp</span><span class="op" id="5736127">]</span><span class="op" id="5736128">)</span><span class="op" id="5736129">,</span>&nbsp;<span class="num" id="5736131">10</span><span class="op" id="5736133">,</span>&nbsp;<span class="num" id="5736135">0</span><span class="op" id="5736136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736140">if</span>&nbsp;<span class="ident" id="5736143">err</span>&nbsp;<span class="op" id="5736147">!=</span>&nbsp;<span class="ident" id="5736150">nil</span>&nbsp;<span class="op" id="5736154">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736159">return</span>&nbsp;<span class="ident" id="5736166">nil</span><span class="op" id="5736169">,</span>&nbsp;<span class="ident" id="5736171">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5736183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736187">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736251">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736317">var</span>&nbsp;<span class="ident" id="5736321">record</span>&nbsp;<span class="op" id="5736328">[</span><span class="op" id="5736329">]</span><span class="builtintype" id="5736330">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736337">record</span><span class="op" id="5736343">,</span>&nbsp;<span class="ident" id="5736345">buf</span>&nbsp;<span class="op" id="5736349">=</span>&nbsp;<span class="ident" id="5736351">buf</span><span class="op" id="5736354">[</span><span class="ident" id="5736355">sp</span><span class="op" id="5736357">+</span><span class="num" id="5736358">1</span><span class="op" id="5736359">:</span><span class="ident" id="5736360">n</span><span class="op" id="5736361">-</span><span class="num" id="5736362">1</span><span class="op" id="5736363">]</span><span class="op" id="5736364">,</span>&nbsp;<span class="ident" id="5736366">buf</span><span class="op" id="5736369">[</span><span class="ident" id="5736370">n</span><span class="op" id="5736371">:</span><span class="op" id="5736372">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736376">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736440">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736471">eq</span>&nbsp;<span class="op" id="5736474">:=</span>&nbsp;<span class="ident" id="5736477">bytes</span><span class="op" id="5736482">.</span><span class="ident" id="5736483">IndexByte</span><span class="op" id="5736492">(</span><span class="ident" id="5736493">record</span><span class="op" id="5736499">,</span>&nbsp;<span class="string" id="5736501">&#39;=&#39;</span><span class="op" id="5736504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736508">if</span>&nbsp;<span class="ident" id="5736511">eq</span>&nbsp;<span class="op" id="5736514">==</span>&nbsp;<span class="op" id="5736517">-</span><span class="num" id="5736518">1</span>&nbsp;<span class="op" id="5736520">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736525">return</span>&nbsp;<span class="ident" id="5736532">nil</span><span class="op" id="5736535">,</span>&nbsp;<span class="ident" id="5736537">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5736549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736553">key</span><span class="op" id="5736556">,</span>&nbsp;<span class="ident" id="5736558">value</span>&nbsp;<span class="op" id="5736564">:=</span>&nbsp;<span class="ident" id="5736567">record</span><span class="op" id="5736573">[</span><span class="op" id="5736574">:</span><span class="ident" id="5736575">eq</span><span class="op" id="5736577">]</span><span class="op" id="5736578">,</span>&nbsp;<span class="ident" id="5736580">record</span><span class="op" id="5736586">[</span><span class="ident" id="5736587">eq</span><span class="op" id="5736589">+</span><span class="num" id="5736590">1</span><span class="op" id="5736591">:</span><span class="op" id="5736592">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736597">keyStr</span>&nbsp;<span class="op" id="5736604">:=</span>&nbsp;<span class="builtintype" id="5736607">string</span><span class="op" id="5736613">(</span><span class="ident" id="5736614">key</span><span class="op" id="5736617">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736621">if</span>&nbsp;<span class="ident" id="5736624">keyStr</span>&nbsp;<span class="op" id="5736631">==</span>&nbsp;<span class="ident" id="5736634">paxGNUSparseOffset</span>&nbsp;<span class="op" id="5736653">||</span>&nbsp;<span class="ident" id="5736656">keyStr</span>&nbsp;<span class="op" id="5736663">==</span>&nbsp;<span class="ident" id="5736666">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="5736687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736692">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736786">sparseMap</span><span class="op" id="5736795">.</span><span class="ident" id="5736796">Write</span><span class="op" id="5736801">(</span><span class="ident" id="5736802">value</span><span class="op" id="5736807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736812">sparseMap</span><span class="op" id="5736821">.</span><span class="ident" id="5736822">Write</span><span class="op" id="5736827">(</span><span class="op" id="5736828">[</span><span class="op" id="5736829">]</span><span class="builtintype" id="5736830">byte</span><span class="op" id="5736834">{</span><span class="string" id="5736835">&#39;,&#39;</span><span class="op" id="5736838">}</span><span class="op" id="5736839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5736843">}</span>&nbsp;<span class="keyword" id="5736845">else</span>&nbsp;<span class="op" id="5736850">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736855">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5736907">headers</span><span class="op" id="5736914">[</span><span class="ident" id="5736915">keyStr</span><span class="op" id="5736921">]</span>&nbsp;<span class="op" id="5736923">=</span>&nbsp;<span class="builtintype" id="5736925">string</span><span class="op" id="5736931">(</span><span class="ident" id="5736932">value</span><span class="op" id="5736937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5736941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5736944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5736947">if</span>&nbsp;<span class="ident" id="5736950">sparseMap</span><span class="op" id="5736959">.</span><span class="ident" id="5736960">Len</span><span class="op" id="5736963">(</span><span class="op" id="5736964">)</span>&nbsp;<span class="op" id="5736966">!=</span>&nbsp;<span class="num" id="5736969">0</span>&nbsp;<span class="op" id="5736971">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5736975">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737037">sparseMap</span><span class="op" id="5737046">.</span><span class="ident" id="5737047">Truncate</span><span class="op" id="5737055">(</span><span class="ident" id="5737056">sparseMap</span><span class="op" id="5737065">.</span><span class="ident" id="5737066">Len</span><span class="op" id="5737069">(</span><span class="op" id="5737070">)</span>&nbsp;<span class="op" id="5737072">-</span>&nbsp;<span class="num" id="5737074">1</span><span class="op" id="5737075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737079">headers</span><span class="op" id="5737086">[</span><span class="ident" id="5737087">paxGNUSparseMap</span><span class="op" id="5737102">]</span>&nbsp;<span class="op" id="5737104">=</span>&nbsp;<span class="ident" id="5737106">sparseMap</span><span class="op" id="5737115">.</span><span class="ident" id="5737116">String</span><span class="op" id="5737122">(</span><span class="op" id="5737123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5737126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737129">return</span>&nbsp;<span class="ident" id="5737136">headers</span><span class="op" id="5737143">,</span>&nbsp;<span class="ident" id="5737145">nil</span><br>
<span class="lineno">365</span><span class="op" id="5737149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5737152">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5737212">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5737288">func</span>&nbsp;<span class="ident" id="5737293">cString</span><span class="op" id="5737300">(</span><span class="ident" id="5737301">b</span>&nbsp;<span class="op" id="5737303">[</span><span class="op" id="5737304">]</span><span class="builtintype" id="5737305">byte</span><span class="op" id="5737309">)</span>&nbsp;<span class="builtintype" id="5737311">string</span>&nbsp;<span class="op" id="5737318">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737321">n</span>&nbsp;<span class="op" id="5737323">:=</span>&nbsp;<span class="num" id="5737326">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737329">for</span>&nbsp;<span class="ident" id="5737333">n</span>&nbsp;<span class="op" id="5737335">&lt;</span>&nbsp;<span class="builtinfunc" id="5737337">len</span><span class="op" id="5737340">(</span><span class="ident" id="5737341">b</span><span class="op" id="5737342">)</span>&nbsp;<span class="op" id="5737344">&amp;&amp;</span>&nbsp;<span class="ident" id="5737347">b</span><span class="op" id="5737348">[</span><span class="ident" id="5737349">n</span><span class="op" id="5737350">]</span>&nbsp;<span class="op" id="5737352">!=</span>&nbsp;<span class="num" id="5737355">0</span>&nbsp;<span class="op" id="5737357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737361">n</span><span class="op" id="5737362">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5737366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737369">return</span>&nbsp;<span class="builtintype" id="5737376">string</span><span class="op" id="5737382">(</span><span class="ident" id="5737383">b</span><span class="op" id="5737384">[</span><span class="num" id="5737385">0</span><span class="op" id="5737386">:</span><span class="ident" id="5737387">n</span><span class="op" id="5737388">]</span><span class="op" id="5737389">)</span><br>
<span class="lineno">375</span><span class="op" id="5737391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5737394">func</span>&nbsp;<span class="op" id="5737399">(</span><span class="ident" id="5737400">tr</span>&nbsp;<span class="op" id="5737403">*</span><span class="ident" id="5737404">Reader</span><span class="op" id="5737410">)</span>&nbsp;<span class="ident" id="5737412">octal</span><span class="op" id="5737417">(</span><span class="ident" id="5737418">b</span>&nbsp;<span class="op" id="5737420">[</span><span class="op" id="5737421">]</span><span class="builtintype" id="5737422">byte</span><span class="op" id="5737426">)</span>&nbsp;<span class="ident" id="5737428">int64</span>&nbsp;<span class="op" id="5737434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5737437">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737472">if</span>&nbsp;<span class="builtinfunc" id="5737475">len</span><span class="op" id="5737478">(</span><span class="ident" id="5737479">b</span><span class="op" id="5737480">)</span>&nbsp;<span class="op" id="5737482">&gt;</span>&nbsp;<span class="num" id="5737484">0</span>&nbsp;<span class="op" id="5737486">&amp;&amp;</span>&nbsp;<span class="ident" id="5737489">b</span><span class="op" id="5737490">[</span><span class="num" id="5737491">0</span><span class="op" id="5737492">]</span><span class="op" id="5737493">&amp;</span><span class="num" id="5737494">0x80</span>&nbsp;<span class="op" id="5737499">!=</span>&nbsp;<span class="num" id="5737502">0</span>&nbsp;<span class="op" id="5737504">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737508">var</span>&nbsp;<span class="ident" id="5737512">x</span>&nbsp;<span class="ident" id="5737514">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737522">for</span>&nbsp;<span class="ident" id="5737526">i</span><span class="op" id="5737527">,</span>&nbsp;<span class="ident" id="5737529">c</span>&nbsp;<span class="op" id="5737531">:=</span>&nbsp;<span class="keyword" id="5737534">range</span>&nbsp;<span class="ident" id="5737540">b</span>&nbsp;<span class="op" id="5737542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737547">if</span>&nbsp;<span class="ident" id="5737550">i</span>&nbsp;<span class="op" id="5737552">==</span>&nbsp;<span class="num" id="5737555">0</span>&nbsp;<span class="op" id="5737557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737563">c</span>&nbsp;<span class="op" id="5737565">&amp;=</span>&nbsp;<span class="num" id="5737568">0x7f</span>&nbsp;<span class="comment" id="5737573">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5737611">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737616">x</span>&nbsp;<span class="op" id="5737618">=</span>&nbsp;<span class="ident" id="5737620">x</span><span class="op" id="5737621">&lt;&lt;</span><span class="num" id="5737623">8</span>&nbsp;<span class="op" id="5737625">|</span>&nbsp;<span class="ident" id="5737627">int64</span><span class="op" id="5737632">(</span><span class="ident" id="5737633">c</span><span class="op" id="5737634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5737638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737642">return</span>&nbsp;<span class="ident" id="5737649">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5737652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5737656">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5737712">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5737769">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5737789">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5737846">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737859">b</span>&nbsp;<span class="op" id="5737861">=</span>&nbsp;<span class="ident" id="5737863">bytes</span><span class="op" id="5737868">.</span><span class="ident" id="5737869">Trim</span><span class="op" id="5737873">(</span><span class="ident" id="5737874">b</span><span class="op" id="5737875">,</span>&nbsp;<span class="string" id="5737877">&#34;&nbsp;\x00&#34;</span><span class="op" id="5737884">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737888">if</span>&nbsp;<span class="builtinfunc" id="5737891">len</span><span class="op" id="5737894">(</span><span class="ident" id="5737895">b</span><span class="op" id="5737896">)</span>&nbsp;<span class="op" id="5737898">==</span>&nbsp;<span class="num" id="5737901">0</span>&nbsp;<span class="op" id="5737903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737907">return</span>&nbsp;<span class="num" id="5737914">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5737917">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737920">x</span><span class="op" id="5737921">,</span>&nbsp;<span class="ident" id="5737923">err</span>&nbsp;<span class="op" id="5737927">:=</span>&nbsp;<span class="ident" id="5737930">strconv</span><span class="op" id="5737937">.</span><span class="ident" id="5737938">ParseUint</span><span class="op" id="5737947">(</span><span class="ident" id="5737948">cString</span><span class="op" id="5737955">(</span><span class="ident" id="5737956">b</span><span class="op" id="5737957">)</span><span class="op" id="5737958">,</span>&nbsp;<span class="num" id="5737960">8</span><span class="op" id="5737961">,</span>&nbsp;<span class="num" id="5737963">64</span><span class="op" id="5737965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5737968">if</span>&nbsp;<span class="ident" id="5737971">err</span>&nbsp;<span class="op" id="5737975">!=</span>&nbsp;<span class="ident" id="5737978">nil</span>&nbsp;<span class="op" id="5737982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5737986">tr</span><span class="op" id="5737988">.</span><span class="ident" id="5737989">err</span>&nbsp;<span class="op" id="5737993">=</span>&nbsp;<span class="ident" id="5737995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5738000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738003">return</span>&nbsp;<span class="ident" id="5738010">int64</span><span class="op" id="5738015">(</span><span class="ident" id="5738016">x</span><span class="op" id="5738017">)</span><br>
<span class="lineno">405</span><span class="op" id="5738019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5738022">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="5738121">func</span>&nbsp;<span class="op" id="5738126">(</span><span class="ident" id="5738127">tr</span>&nbsp;<span class="op" id="5738130">*</span><span class="ident" id="5738131">Reader</span><span class="op" id="5738137">)</span>&nbsp;<span class="ident" id="5738139">skipUnread</span><span class="op" id="5738149">(</span><span class="op" id="5738150">)</span>&nbsp;<span class="op" id="5738152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5738155">nr</span>&nbsp;<span class="op" id="5738158">:=</span>&nbsp;<span class="ident" id="5738161">tr</span><span class="op" id="5738163">.</span><span class="ident" id="5738164">numBytes</span><span class="op" id="5738172">(</span><span class="op" id="5738173">)</span>&nbsp;<span class="op" id="5738175">+</span>&nbsp;<span class="ident" id="5738177">tr</span><span class="op" id="5738179">.</span><span class="ident" id="5738180">pad</span>&nbsp;<span class="comment" id="5738184">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5738212">tr</span><span class="op" id="5738214">.</span><span class="ident" id="5738215">curr</span><span class="op" id="5738219">,</span>&nbsp;<span class="ident" id="5738221">tr</span><span class="op" id="5738223">.</span><span class="ident" id="5738224">pad</span>&nbsp;<span class="op" id="5738228">=</span>&nbsp;<span class="ident" id="5738230">nil</span><span class="op" id="5738233">,</span>&nbsp;<span class="num" id="5738235">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738238">if</span>&nbsp;<span class="ident" id="5738241">sr</span><span class="op" id="5738243">,</span>&nbsp;<span class="ident" id="5738245">ok</span>&nbsp;<span class="op" id="5738248">:=</span>&nbsp;<span class="ident" id="5738251">tr</span><span class="op" id="5738253">.</span><span class="ident" id="5738254">r</span><span class="op" id="5738255">.</span><span class="op" id="5738256">(</span><span class="ident" id="5738257">io</span><span class="op" id="5738259">.</span><span class="ident" id="5738260">Seeker</span><span class="op" id="5738266">)</span><span class="op" id="5738267">;</span>&nbsp;<span class="ident" id="5738269">ok</span>&nbsp;<span class="op" id="5738272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738276">if</span>&nbsp;<span class="ident" id="5738279">_</span><span class="op" id="5738280">,</span>&nbsp;<span class="ident" id="5738282">err</span>&nbsp;<span class="op" id="5738286">:=</span>&nbsp;<span class="ident" id="5738289">sr</span><span class="op" id="5738291">.</span><span class="ident" id="5738292">Seek</span><span class="op" id="5738296">(</span><span class="ident" id="5738297">nr</span><span class="op" id="5738299">,</span>&nbsp;<span class="ident" id="5738301">os</span><span class="op" id="5738303">.</span><span class="ident" id="5738304">SEEK_CUR</span><span class="op" id="5738312">)</span><span class="op" id="5738313">;</span>&nbsp;<span class="ident" id="5738315">err</span>&nbsp;<span class="op" id="5738319">==</span>&nbsp;<span class="ident" id="5738322">nil</span>&nbsp;<span class="op" id="5738326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738331">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5738340">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5738343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5738346">_</span><span class="op" id="5738347">,</span>&nbsp;<span class="ident" id="5738349">tr</span><span class="op" id="5738351">.</span><span class="ident" id="5738352">err</span>&nbsp;<span class="op" id="5738356">=</span>&nbsp;<span class="ident" id="5738358">io</span><span class="op" id="5738360">.</span><span class="ident" id="5738361">CopyN</span><span class="op" id="5738366">(</span><span class="ident" id="5738367">ioutil</span><span class="op" id="5738373">.</span><span class="ident" id="5738374">Discard</span><span class="op" id="5738381">,</span>&nbsp;<span class="ident" id="5738383">tr</span><span class="op" id="5738385">.</span><span class="ident" id="5738386">r</span><span class="op" id="5738387">,</span>&nbsp;<span class="ident" id="5738389">nr</span><span class="op" id="5738391">)</span><br>
<span class="lineno"></span><span class="op" id="5738393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5738396">func</span>&nbsp;<span class="op" id="5738401">(</span><span class="ident" id="5738402">tr</span>&nbsp;<span class="op" id="5738405">*</span><span class="ident" id="5738406">Reader</span><span class="op" id="5738412">)</span>&nbsp;<span class="ident" id="5738414">verifyChecksum</span><span class="op" id="5738428">(</span><span class="ident" id="5738429">header</span>&nbsp;<span class="op" id="5738436">[</span><span class="op" id="5738437">]</span><span class="builtintype" id="5738438">byte</span><span class="op" id="5738442">)</span>&nbsp;<span class="builtintype" id="5738444">bool</span>&nbsp;<span class="op" id="5738449">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738452">if</span>&nbsp;<span class="ident" id="5738455">tr</span><span class="op" id="5738457">.</span><span class="ident" id="5738458">err</span>&nbsp;<span class="op" id="5738462">!=</span>&nbsp;<span class="ident" id="5738465">nil</span>&nbsp;<span class="op" id="5738469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738473">return</span>&nbsp;<span class="builtintype" id="5738480">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5738487">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5738491">given</span>&nbsp;<span class="op" id="5738497">:=</span>&nbsp;<span class="ident" id="5738500">tr</span><span class="op" id="5738502">.</span><span class="ident" id="5738503">octal</span><span class="op" id="5738508">(</span><span class="ident" id="5738509">header</span><span class="op" id="5738515">[</span><span class="num" id="5738516">148</span><span class="op" id="5738519">:</span><span class="num" id="5738520">156</span><span class="op" id="5738523">]</span><span class="op" id="5738524">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5738527">unsigned</span><span class="op" id="5738535">,</span>&nbsp;<span class="ident" id="5738537">signed</span>&nbsp;<span class="op" id="5738544">:=</span>&nbsp;<span class="ident" id="5738547">checksum</span><span class="op" id="5738555">(</span><span class="ident" id="5738556">header</span><span class="op" id="5738562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738565">return</span>&nbsp;<span class="ident" id="5738572">given</span>&nbsp;<span class="op" id="5738578">==</span>&nbsp;<span class="ident" id="5738581">unsigned</span>&nbsp;<span class="op" id="5738590">||</span>&nbsp;<span class="ident" id="5738593">given</span>&nbsp;<span class="op" id="5738599">==</span>&nbsp;<span class="ident" id="5738602">signed</span><br>
<span class="lineno"></span><span class="op" id="5738609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5738612">func</span>&nbsp;<span class="op" id="5738617">(</span><span class="ident" id="5738618">tr</span>&nbsp;<span class="op" id="5738621">*</span><span class="ident" id="5738622">Reader</span><span class="op" id="5738628">)</span>&nbsp;<span class="ident" id="5738630">readHeader</span><span class="op" id="5738640">(</span><span class="op" id="5738641">)</span>&nbsp;<span class="op" id="5738643">*</span><span class="ident" id="5738644">Header</span>&nbsp;<span class="op" id="5738651">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5738654">header</span>&nbsp;<span class="op" id="5738661">:=</span>&nbsp;<span class="ident" id="5738664">tr</span><span class="op" id="5738666">.</span><span class="ident" id="5738667">hdrBuff</span><span class="op" id="5738674">[</span><span class="op" id="5738675">:</span><span class="op" id="5738676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5738679">copy</span><span class="op" id="5738683">(</span><span class="ident" id="5738684">header</span><span class="op" id="5738690">,</span>&nbsp;<span class="ident" id="5738692">zeroBlock</span><span class="op" id="5738701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738705">if</span>&nbsp;<span class="ident" id="5738708">_</span><span class="op" id="5738709">,</span>&nbsp;<span class="ident" id="5738711">tr</span><span class="op" id="5738713">.</span><span class="ident" id="5738714">err</span>&nbsp;<span class="op" id="5738718">=</span>&nbsp;<span class="ident" id="5738720">io</span><span class="op" id="5738722">.</span><span class="ident" id="5738723">ReadFull</span><span class="op" id="5738731">(</span><span class="ident" id="5738732">tr</span><span class="op" id="5738734">.</span><span class="ident" id="5738735">r</span><span class="op" id="5738736">,</span>&nbsp;<span class="ident" id="5738738">header</span><span class="op" id="5738744">)</span><span class="op" id="5738745">;</span>&nbsp;<span class="ident" id="5738747">tr</span><span class="op" id="5738749">.</span><span class="ident" id="5738750">err</span>&nbsp;<span class="op" id="5738754">!=</span>&nbsp;<span class="ident" id="5738757">nil</span>&nbsp;<span class="op" id="5738761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738765">return</span>&nbsp;<span class="ident" id="5738772">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5738777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5738781">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738840">if</span>&nbsp;<span class="ident" id="5738843">bytes</span><span class="op" id="5738848">.</span><span class="ident" id="5738849">Equal</span><span class="op" id="5738854">(</span><span class="ident" id="5738855">header</span><span class="op" id="5738861">,</span>&nbsp;<span class="ident" id="5738863">zeroBlock</span><span class="op" id="5738872">[</span><span class="num" id="5738873">0</span><span class="op" id="5738874">:</span><span class="ident" id="5738875">blockSize</span><span class="op" id="5738884">]</span><span class="op" id="5738885">)</span>&nbsp;<span class="op" id="5738887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738891">if</span>&nbsp;<span class="ident" id="5738894">_</span><span class="op" id="5738895">,</span>&nbsp;<span class="ident" id="5738897">tr</span><span class="op" id="5738899">.</span><span class="ident" id="5738900">err</span>&nbsp;<span class="op" id="5738904">=</span>&nbsp;<span class="ident" id="5738906">io</span><span class="op" id="5738908">.</span><span class="ident" id="5738909">ReadFull</span><span class="op" id="5738917">(</span><span class="ident" id="5738918">tr</span><span class="op" id="5738920">.</span><span class="ident" id="5738921">r</span><span class="op" id="5738922">,</span>&nbsp;<span class="ident" id="5738924">header</span><span class="op" id="5738930">)</span><span class="op" id="5738931">;</span>&nbsp;<span class="ident" id="5738933">tr</span><span class="op" id="5738935">.</span><span class="ident" id="5738936">err</span>&nbsp;<span class="op" id="5738940">!=</span>&nbsp;<span class="ident" id="5738943">nil</span>&nbsp;<span class="op" id="5738947">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738952">return</span>&nbsp;<span class="ident" id="5738959">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5738965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5738969">if</span>&nbsp;<span class="ident" id="5738972">bytes</span><span class="op" id="5738977">.</span><span class="ident" id="5738978">Equal</span><span class="op" id="5738983">(</span><span class="ident" id="5738984">header</span><span class="op" id="5738990">,</span>&nbsp;<span class="ident" id="5738992">zeroBlock</span><span class="op" id="5739001">[</span><span class="num" id="5739002">0</span><span class="op" id="5739003">:</span><span class="ident" id="5739004">blockSize</span><span class="op" id="5739013">]</span><span class="op" id="5739014">)</span>&nbsp;<span class="op" id="5739016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739021">tr</span><span class="op" id="5739023">.</span><span class="ident" id="5739024">err</span>&nbsp;<span class="op" id="5739028">=</span>&nbsp;<span class="ident" id="5739030">io</span><span class="op" id="5739032">.</span><span class="ident" id="5739033">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5739039">}</span>&nbsp;<span class="keyword" id="5739041">else</span>&nbsp;<span class="op" id="5739046">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739051">tr</span><span class="op" id="5739053">.</span><span class="ident" id="5739054">err</span>&nbsp;<span class="op" id="5739058">=</span>&nbsp;<span class="ident" id="5739060">ErrHeader</span>&nbsp;<span class="comment" id="5739070">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5739110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739114">return</span>&nbsp;<span class="ident" id="5739121">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5739126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739130">if</span>&nbsp;<span class="op" id="5739133">!</span><span class="ident" id="5739134">tr</span><span class="op" id="5739136">.</span><span class="ident" id="5739137">verifyChecksum</span><span class="op" id="5739151">(</span><span class="ident" id="5739152">header</span><span class="op" id="5739158">)</span>&nbsp;<span class="op" id="5739160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739164">tr</span><span class="op" id="5739166">.</span><span class="ident" id="5739167">err</span>&nbsp;<span class="op" id="5739171">=</span>&nbsp;<span class="ident" id="5739173">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739185">return</span>&nbsp;<span class="ident" id="5739192">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5739197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5739201">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739212">hdr</span>&nbsp;<span class="op" id="5739216">:=</span>&nbsp;<span class="builtinfunc" id="5739219">new</span><span class="op" id="5739222">(</span><span class="ident" id="5739223">Header</span><span class="op" id="5739229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739232">s</span>&nbsp;<span class="op" id="5739234">:=</span>&nbsp;<span class="ident" id="5739237">slicer</span><span class="op" id="5739243">(</span><span class="ident" id="5739244">header</span><span class="op" id="5739250">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739254">hdr</span><span class="op" id="5739257">.</span><span class="ident" id="5739258">Name</span>&nbsp;<span class="op" id="5739263">=</span>&nbsp;<span class="ident" id="5739265">cString</span><span class="op" id="5739272">(</span><span class="ident" id="5739273">s</span><span class="op" id="5739274">.</span><span class="ident" id="5739275">next</span><span class="op" id="5739279">(</span><span class="num" id="5739280">100</span><span class="op" id="5739283">)</span><span class="op" id="5739284">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739287">hdr</span><span class="op" id="5739290">.</span><span class="ident" id="5739291">Mode</span>&nbsp;<span class="op" id="5739296">=</span>&nbsp;<span class="ident" id="5739298">tr</span><span class="op" id="5739300">.</span><span class="ident" id="5739301">octal</span><span class="op" id="5739306">(</span><span class="ident" id="5739307">s</span><span class="op" id="5739308">.</span><span class="ident" id="5739309">next</span><span class="op" id="5739313">(</span><span class="num" id="5739314">8</span><span class="op" id="5739315">)</span><span class="op" id="5739316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739319">hdr</span><span class="op" id="5739322">.</span><span class="ident" id="5739323">Uid</span>&nbsp;<span class="op" id="5739327">=</span>&nbsp;<span class="builtintype" id="5739329">int</span><span class="op" id="5739332">(</span><span class="ident" id="5739333">tr</span><span class="op" id="5739335">.</span><span class="ident" id="5739336">octal</span><span class="op" id="5739341">(</span><span class="ident" id="5739342">s</span><span class="op" id="5739343">.</span><span class="ident" id="5739344">next</span><span class="op" id="5739348">(</span><span class="num" id="5739349">8</span><span class="op" id="5739350">)</span><span class="op" id="5739351">)</span><span class="op" id="5739352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739355">hdr</span><span class="op" id="5739358">.</span><span class="ident" id="5739359">Gid</span>&nbsp;<span class="op" id="5739363">=</span>&nbsp;<span class="builtintype" id="5739365">int</span><span class="op" id="5739368">(</span><span class="ident" id="5739369">tr</span><span class="op" id="5739371">.</span><span class="ident" id="5739372">octal</span><span class="op" id="5739377">(</span><span class="ident" id="5739378">s</span><span class="op" id="5739379">.</span><span class="ident" id="5739380">next</span><span class="op" id="5739384">(</span><span class="num" id="5739385">8</span><span class="op" id="5739386">)</span><span class="op" id="5739387">)</span><span class="op" id="5739388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739391">hdr</span><span class="op" id="5739394">.</span><span class="ident" id="5739395">Size</span>&nbsp;<span class="op" id="5739400">=</span>&nbsp;<span class="ident" id="5739402">tr</span><span class="op" id="5739404">.</span><span class="ident" id="5739405">octal</span><span class="op" id="5739410">(</span><span class="ident" id="5739411">s</span><span class="op" id="5739412">.</span><span class="ident" id="5739413">next</span><span class="op" id="5739417">(</span><span class="num" id="5739418">12</span><span class="op" id="5739420">)</span><span class="op" id="5739421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739424">hdr</span><span class="op" id="5739427">.</span><span class="ident" id="5739428">ModTime</span>&nbsp;<span class="op" id="5739436">=</span>&nbsp;<span class="ident" id="5739438">time</span><span class="op" id="5739442">.</span><span class="ident" id="5739443">Unix</span><span class="op" id="5739447">(</span><span class="ident" id="5739448">tr</span><span class="op" id="5739450">.</span><span class="ident" id="5739451">octal</span><span class="op" id="5739456">(</span><span class="ident" id="5739457">s</span><span class="op" id="5739458">.</span><span class="ident" id="5739459">next</span><span class="op" id="5739463">(</span><span class="num" id="5739464">12</span><span class="op" id="5739466">)</span><span class="op" id="5739467">)</span><span class="op" id="5739468">,</span>&nbsp;<span class="num" id="5739470">0</span><span class="op" id="5739471">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739474">s</span><span class="op" id="5739475">.</span><span class="ident" id="5739476">next</span><span class="op" id="5739480">(</span><span class="num" id="5739481">8</span><span class="op" id="5739482">)</span>&nbsp;<span class="comment" id="5739484">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739495">hdr</span><span class="op" id="5739498">.</span><span class="ident" id="5739499">Typeflag</span>&nbsp;<span class="op" id="5739508">=</span>&nbsp;<span class="ident" id="5739510">s</span><span class="op" id="5739511">.</span><span class="ident" id="5739512">next</span><span class="op" id="5739516">(</span><span class="num" id="5739517">1</span><span class="op" id="5739518">)</span><span class="op" id="5739519">[</span><span class="num" id="5739520">0</span><span class="op" id="5739521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739524">hdr</span><span class="op" id="5739527">.</span><span class="ident" id="5739528">Linkname</span>&nbsp;<span class="op" id="5739537">=</span>&nbsp;<span class="ident" id="5739539">cString</span><span class="op" id="5739546">(</span><span class="ident" id="5739547">s</span><span class="op" id="5739548">.</span><span class="ident" id="5739549">next</span><span class="op" id="5739553">(</span><span class="num" id="5739554">100</span><span class="op" id="5739557">)</span><span class="op" id="5739558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5739562">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5739625">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5739691">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739753">magic</span>&nbsp;<span class="op" id="5739759">:=</span>&nbsp;<span class="builtintype" id="5739762">string</span><span class="op" id="5739768">(</span><span class="ident" id="5739769">s</span><span class="op" id="5739770">.</span><span class="ident" id="5739771">next</span><span class="op" id="5739775">(</span><span class="num" id="5739776">8</span><span class="op" id="5739777">)</span><span class="op" id="5739778">)</span>&nbsp;<span class="comment" id="5739780">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739816">var</span>&nbsp;<span class="ident" id="5739820">format</span>&nbsp;<span class="builtintype" id="5739827">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739835">switch</span>&nbsp;<span class="op" id="5739842">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739845">case</span>&nbsp;<span class="ident" id="5739850">magic</span><span class="op" id="5739855">[</span><span class="op" id="5739856">:</span><span class="num" id="5739857">6</span><span class="op" id="5739858">]</span>&nbsp;<span class="op" id="5739860">==</span>&nbsp;<span class="string" id="5739863">&#34;ustar\x00&#34;</span><span class="op" id="5739874">:</span>&nbsp;<span class="comment" id="5739876">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5739905">if</span>&nbsp;<span class="builtintype" id="5739908">string</span><span class="op" id="5739914">(</span><span class="ident" id="5739915">header</span><span class="op" id="5739921">[</span><span class="num" id="5739922">508</span><span class="op" id="5739925">:</span><span class="num" id="5739926">512</span><span class="op" id="5739929">]</span><span class="op" id="5739930">)</span>&nbsp;<span class="op" id="5739932">==</span>&nbsp;<span class="string" id="5739935">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="5739945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739950">format</span>&nbsp;<span class="op" id="5739957">=</span>&nbsp;<span class="string" id="5739959">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5739968">}</span>&nbsp;<span class="keyword" id="5739970">else</span>&nbsp;<span class="op" id="5739975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5739980">format</span>&nbsp;<span class="op" id="5739987">=</span>&nbsp;<span class="string" id="5739989">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5739999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740002">case</span>&nbsp;<span class="ident" id="5740007">magic</span>&nbsp;<span class="op" id="5740013">==</span>&nbsp;<span class="string" id="5740016">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5740029">:</span>&nbsp;<span class="comment" id="5740031">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740048">format</span>&nbsp;<span class="op" id="5740055">=</span>&nbsp;<span class="string" id="5740057">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5740064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740068">switch</span>&nbsp;<span class="ident" id="5740075">format</span>&nbsp;<span class="op" id="5740082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740085">case</span>&nbsp;<span class="string" id="5740090">&#34;posix&#34;</span><span class="op" id="5740097">,</span>&nbsp;<span class="string" id="5740099">&#34;gnu&#34;</span><span class="op" id="5740104">,</span>&nbsp;<span class="string" id="5740106">&#34;star&#34;</span><span class="op" id="5740112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740116">hdr</span><span class="op" id="5740119">.</span><span class="ident" id="5740120">Uname</span>&nbsp;<span class="op" id="5740126">=</span>&nbsp;<span class="ident" id="5740128">cString</span><span class="op" id="5740135">(</span><span class="ident" id="5740136">s</span><span class="op" id="5740137">.</span><span class="ident" id="5740138">next</span><span class="op" id="5740142">(</span><span class="num" id="5740143">32</span><span class="op" id="5740145">)</span><span class="op" id="5740146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740150">hdr</span><span class="op" id="5740153">.</span><span class="ident" id="5740154">Gname</span>&nbsp;<span class="op" id="5740160">=</span>&nbsp;<span class="ident" id="5740162">cString</span><span class="op" id="5740169">(</span><span class="ident" id="5740170">s</span><span class="op" id="5740171">.</span><span class="ident" id="5740172">next</span><span class="op" id="5740176">(</span><span class="num" id="5740177">32</span><span class="op" id="5740179">)</span><span class="op" id="5740180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740184">devmajor</span>&nbsp;<span class="op" id="5740193">:=</span>&nbsp;<span class="ident" id="5740196">s</span><span class="op" id="5740197">.</span><span class="ident" id="5740198">next</span><span class="op" id="5740202">(</span><span class="num" id="5740203">8</span><span class="op" id="5740204">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740208">devminor</span>&nbsp;<span class="op" id="5740217">:=</span>&nbsp;<span class="ident" id="5740220">s</span><span class="op" id="5740221">.</span><span class="ident" id="5740222">next</span><span class="op" id="5740226">(</span><span class="num" id="5740227">8</span><span class="op" id="5740228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740232">if</span>&nbsp;<span class="ident" id="5740235">hdr</span><span class="op" id="5740238">.</span><span class="ident" id="5740239">Typeflag</span>&nbsp;<span class="op" id="5740248">==</span>&nbsp;<span class="ident" id="5740251">TypeChar</span>&nbsp;<span class="op" id="5740260">||</span>&nbsp;<span class="ident" id="5740263">hdr</span><span class="op" id="5740266">.</span><span class="ident" id="5740267">Typeflag</span>&nbsp;<span class="op" id="5740276">==</span>&nbsp;<span class="ident" id="5740279">TypeBlock</span>&nbsp;<span class="op" id="5740289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740294">hdr</span><span class="op" id="5740297">.</span><span class="ident" id="5740298">Devmajor</span>&nbsp;<span class="op" id="5740307">=</span>&nbsp;<span class="ident" id="5740309">tr</span><span class="op" id="5740311">.</span><span class="ident" id="5740312">octal</span><span class="op" id="5740317">(</span><span class="ident" id="5740318">devmajor</span><span class="op" id="5740326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740331">hdr</span><span class="op" id="5740334">.</span><span class="ident" id="5740335">Devminor</span>&nbsp;<span class="op" id="5740344">=</span>&nbsp;<span class="ident" id="5740346">tr</span><span class="op" id="5740348">.</span><span class="ident" id="5740349">octal</span><span class="op" id="5740354">(</span><span class="ident" id="5740355">devminor</span><span class="op" id="5740363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5740367">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740371">var</span>&nbsp;<span class="ident" id="5740375">prefix</span>&nbsp;<span class="builtintype" id="5740382">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740391">switch</span>&nbsp;<span class="ident" id="5740398">format</span>&nbsp;<span class="op" id="5740405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740409">case</span>&nbsp;<span class="string" id="5740414">&#34;posix&#34;</span><span class="op" id="5740421">,</span>&nbsp;<span class="string" id="5740423">&#34;gnu&#34;</span><span class="op" id="5740428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740433">prefix</span>&nbsp;<span class="op" id="5740440">=</span>&nbsp;<span class="ident" id="5740442">cString</span><span class="op" id="5740449">(</span><span class="ident" id="5740450">s</span><span class="op" id="5740451">.</span><span class="ident" id="5740452">next</span><span class="op" id="5740456">(</span><span class="num" id="5740457">155</span><span class="op" id="5740460">)</span><span class="op" id="5740461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740465">case</span>&nbsp;<span class="string" id="5740470">&#34;star&#34;</span><span class="op" id="5740476">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740481">prefix</span>&nbsp;<span class="op" id="5740488">=</span>&nbsp;<span class="ident" id="5740490">cString</span><span class="op" id="5740497">(</span><span class="ident" id="5740498">s</span><span class="op" id="5740499">.</span><span class="ident" id="5740500">next</span><span class="op" id="5740504">(</span><span class="num" id="5740505">131</span><span class="op" id="5740508">)</span><span class="op" id="5740509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740514">hdr</span><span class="op" id="5740517">.</span><span class="ident" id="5740518">AccessTime</span>&nbsp;<span class="op" id="5740529">=</span>&nbsp;<span class="ident" id="5740531">time</span><span class="op" id="5740535">.</span><span class="ident" id="5740536">Unix</span><span class="op" id="5740540">(</span><span class="ident" id="5740541">tr</span><span class="op" id="5740543">.</span><span class="ident" id="5740544">octal</span><span class="op" id="5740549">(</span><span class="ident" id="5740550">s</span><span class="op" id="5740551">.</span><span class="ident" id="5740552">next</span><span class="op" id="5740556">(</span><span class="num" id="5740557">12</span><span class="op" id="5740559">)</span><span class="op" id="5740560">)</span><span class="op" id="5740561">,</span>&nbsp;<span class="num" id="5740563">0</span><span class="op" id="5740564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740569">hdr</span><span class="op" id="5740572">.</span><span class="ident" id="5740573">ChangeTime</span>&nbsp;<span class="op" id="5740584">=</span>&nbsp;<span class="ident" id="5740586">time</span><span class="op" id="5740590">.</span><span class="ident" id="5740591">Unix</span><span class="op" id="5740595">(</span><span class="ident" id="5740596">tr</span><span class="op" id="5740598">.</span><span class="ident" id="5740599">octal</span><span class="op" id="5740604">(</span><span class="ident" id="5740605">s</span><span class="op" id="5740606">.</span><span class="ident" id="5740607">next</span><span class="op" id="5740611">(</span><span class="num" id="5740612">12</span><span class="op" id="5740614">)</span><span class="op" id="5740615">)</span><span class="op" id="5740616">,</span>&nbsp;<span class="num" id="5740618">0</span><span class="op" id="5740619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5740623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740627">if</span>&nbsp;<span class="builtinfunc" id="5740630">len</span><span class="op" id="5740633">(</span><span class="ident" id="5740634">prefix</span><span class="op" id="5740640">)</span>&nbsp;<span class="op" id="5740642">&gt;</span>&nbsp;<span class="num" id="5740644">0</span>&nbsp;<span class="op" id="5740646">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740651">hdr</span><span class="op" id="5740654">.</span><span class="ident" id="5740655">Name</span>&nbsp;<span class="op" id="5740660">=</span>&nbsp;<span class="ident" id="5740662">prefix</span>&nbsp;<span class="op" id="5740669">+</span>&nbsp;<span class="string" id="5740671">&#34;/&#34;</span>&nbsp;<span class="op" id="5740675">+</span>&nbsp;<span class="ident" id="5740677">hdr</span><span class="op" id="5740680">.</span><span class="ident" id="5740681">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5740688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5740691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740695">if</span>&nbsp;<span class="ident" id="5740698">tr</span><span class="op" id="5740700">.</span><span class="ident" id="5740701">err</span>&nbsp;<span class="op" id="5740705">!=</span>&nbsp;<span class="ident" id="5740708">nil</span>&nbsp;<span class="op" id="5740712">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740716">tr</span><span class="op" id="5740718">.</span><span class="ident" id="5740719">err</span>&nbsp;<span class="op" id="5740723">=</span>&nbsp;<span class="ident" id="5740725">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5740737">return</span>&nbsp;<span class="ident" id="5740744">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5740749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5740753">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5740811">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740856">nb</span>&nbsp;<span class="op" id="5740859">:=</span>&nbsp;<span class="ident" id="5740862">int64</span><span class="op" id="5740867">(</span><span class="ident" id="5740868">hdr</span><span class="op" id="5740871">.</span><span class="ident" id="5740872">Size</span><span class="op" id="5740876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740879">tr</span><span class="op" id="5740881">.</span><span class="ident" id="5740882">pad</span>&nbsp;<span class="op" id="5740886">=</span>&nbsp;<span class="op" id="5740888">-</span><span class="ident" id="5740889">nb</span>&nbsp;<span class="op" id="5740892">&amp;</span>&nbsp;<span class="op" id="5740894">(</span><span class="ident" id="5740895">blockSize</span>&nbsp;<span class="op" id="5740905">-</span>&nbsp;<span class="num" id="5740907">1</span><span class="op" id="5740908">)</span>&nbsp;<span class="comment" id="5740910">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5740943">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5740976">tr</span><span class="op" id="5740978">.</span><span class="ident" id="5740979">curr</span>&nbsp;<span class="op" id="5740984">=</span>&nbsp;<span class="op" id="5740986">&amp;</span><span class="ident" id="5740987">regFileReader</span><span class="op" id="5741000">{</span><span class="ident" id="5741001">r</span><span class="op" id="5741002">:</span>&nbsp;<span class="ident" id="5741004">tr</span><span class="op" id="5741006">.</span><span class="ident" id="5741007">r</span><span class="op" id="5741008">,</span>&nbsp;<span class="ident" id="5741010">nb</span><span class="op" id="5741012">:</span>&nbsp;<span class="ident" id="5741014">nb</span><span class="op" id="5741016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5741020">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5741063">if</span>&nbsp;<span class="ident" id="5741066">hdr</span><span class="op" id="5741069">.</span><span class="ident" id="5741070">Typeflag</span>&nbsp;<span class="op" id="5741079">==</span>&nbsp;<span class="ident" id="5741082">TypeGNUSparse</span>&nbsp;<span class="op" id="5741096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5741100">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5741136">hdr</span><span class="op" id="5741139">.</span><span class="ident" id="5741140">Size</span>&nbsp;<span class="op" id="5741145">=</span>&nbsp;<span class="ident" id="5741147">tr</span><span class="op" id="5741149">.</span><span class="ident" id="5741150">octal</span><span class="op" id="5741155">(</span><span class="ident" id="5741156">header</span><span class="op" id="5741162">[</span><span class="num" id="5741163">483</span><span class="op" id="5741166">:</span><span class="num" id="5741167">495</span><span class="op" id="5741170">]</span><span class="op" id="5741171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5741176">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5741202">sp</span>&nbsp;<span class="op" id="5741205">:=</span>&nbsp;<span class="ident" id="5741208">tr</span><span class="op" id="5741210">.</span><span class="ident" id="5741211">readOldGNUSparseMap</span><span class="op" id="5741230">(</span><span class="ident" id="5741231">header</span><span class="op" id="5741237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5741241">if</span>&nbsp;<span class="ident" id="5741244">tr</span><span class="op" id="5741246">.</span><span class="ident" id="5741247">err</span>&nbsp;<span class="op" id="5741251">!=</span>&nbsp;<span class="ident" id="5741254">nil</span>&nbsp;<span class="op" id="5741258">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5741263">return</span>&nbsp;<span class="ident" id="5741270">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5741276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5741280">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5741352">tr</span><span class="op" id="5741354">.</span><span class="ident" id="5741355">curr</span>&nbsp;<span class="op" id="5741360">=</span>&nbsp;<span class="op" id="5741362">&amp;</span><span class="ident" id="5741363">sparseFileReader</span><span class="op" id="5741379">{</span><span class="ident" id="5741380">rfr</span><span class="op" id="5741383">:</span>&nbsp;<span class="ident" id="5741385">tr</span><span class="op" id="5741387">.</span><span class="ident" id="5741388">curr</span><span class="op" id="5741392">.</span><span class="op" id="5741393">(</span><span class="op" id="5741394">*</span><span class="ident" id="5741395">regFileReader</span><span class="op" id="5741408">)</span><span class="op" id="5741409">,</span>&nbsp;<span class="ident" id="5741411">sp</span><span class="op" id="5741413">:</span>&nbsp;<span class="ident" id="5741415">sp</span><span class="op" id="5741417">,</span>&nbsp;<span class="ident" id="5741419">tot</span><span class="op" id="5741422">:</span>&nbsp;<span class="ident" id="5741424">hdr</span><span class="op" id="5741427">.</span><span class="ident" id="5741428">Size</span><span class="op" id="5741432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5741435">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5741439">return</span>&nbsp;<span class="ident" id="5741446">hdr</span><br>
<span class="lineno"></span><span class="op" id="5741450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5741453">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="5741522">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5741592">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5741610">type</span>&nbsp;<span class="ident" id="5741615">sparseEntry</span>&nbsp;<span class="keyword" id="5741627">struct</span>&nbsp;<span class="op" id="5741634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5741637">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5741646">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5741653">numBytes</span>&nbsp;<span class="ident" id="5741662">int64</span><br>
<span class="lineno">545</span><span class="op" id="5741668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5741671">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5741755">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="5741857">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="5741941">func</span>&nbsp;<span class="op" id="5741946">(</span><span class="ident" id="5741947">tr</span>&nbsp;<span class="op" id="5741950">*</span><span class="ident" id="5741951">Reader</span><span class="op" id="5741957">)</span>&nbsp;<span class="ident" id="5741959">readOldGNUSparseMap</span><span class="op" id="5741978">(</span><span class="ident" id="5741979">header</span>&nbsp;<span class="op" id="5741986">[</span><span class="op" id="5741987">]</span><span class="builtintype" id="5741988">byte</span><span class="op" id="5741992">)</span>&nbsp;<span class="op" id="5741994">[</span><span class="op" id="5741995">]</span><span class="ident" id="5741996">sparseEntry</span>&nbsp;<span class="op" id="5742008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742011">isExtended</span>&nbsp;<span class="op" id="5742022">:=</span>&nbsp;<span class="ident" id="5742025">header</span><span class="op" id="5742031">[</span><span class="ident" id="5742032">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="5742070">]</span>&nbsp;<span class="op" id="5742072">!=</span>&nbsp;<span class="num" id="5742075">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742078">spCap</span>&nbsp;<span class="op" id="5742084">:=</span>&nbsp;<span class="ident" id="5742087">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742121">if</span>&nbsp;<span class="ident" id="5742124">isExtended</span>&nbsp;<span class="op" id="5742135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742139">spCap</span>&nbsp;<span class="op" id="5742145">+=</span>&nbsp;<span class="ident" id="5742148">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5742186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742189">sp</span>&nbsp;<span class="op" id="5742192">:=</span>&nbsp;<span class="builtinfunc" id="5742195">make</span><span class="op" id="5742199">(</span><span class="op" id="5742200">[</span><span class="op" id="5742201">]</span><span class="ident" id="5742202">sparseEntry</span><span class="op" id="5742213">,</span>&nbsp;<span class="num" id="5742215">0</span><span class="op" id="5742216">,</span>&nbsp;<span class="ident" id="5742218">spCap</span><span class="op" id="5742223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742226">s</span>&nbsp;<span class="op" id="5742228">:=</span>&nbsp;<span class="ident" id="5742231">slicer</span><span class="op" id="5742237">(</span><span class="ident" id="5742238">header</span><span class="op" id="5742244">[</span><span class="ident" id="5742245">oldGNUSparseMainHeaderOffset</span><span class="op" id="5742273">:</span><span class="op" id="5742274">]</span><span class="op" id="5742275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5742279">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742330">for</span>&nbsp;<span class="ident" id="5742334">i</span>&nbsp;<span class="op" id="5742336">:=</span>&nbsp;<span class="num" id="5742339">0</span><span class="op" id="5742340">;</span>&nbsp;<span class="ident" id="5742342">i</span>&nbsp;<span class="op" id="5742344">&lt;</span>&nbsp;<span class="ident" id="5742346">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="5742378">;</span>&nbsp;<span class="ident" id="5742380">i</span><span class="op" id="5742381">++</span>&nbsp;<span class="op" id="5742384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742388">offset</span>&nbsp;<span class="op" id="5742395">:=</span>&nbsp;<span class="ident" id="5742398">tr</span><span class="op" id="5742400">.</span><span class="ident" id="5742401">octal</span><span class="op" id="5742406">(</span><span class="ident" id="5742407">s</span><span class="op" id="5742408">.</span><span class="ident" id="5742409">next</span><span class="op" id="5742413">(</span><span class="ident" id="5742414">oldGNUSparseOffsetSize</span><span class="op" id="5742436">)</span><span class="op" id="5742437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742441">numBytes</span>&nbsp;<span class="op" id="5742450">:=</span>&nbsp;<span class="ident" id="5742453">tr</span><span class="op" id="5742455">.</span><span class="ident" id="5742456">octal</span><span class="op" id="5742461">(</span><span class="ident" id="5742462">s</span><span class="op" id="5742463">.</span><span class="ident" id="5742464">next</span><span class="op" id="5742468">(</span><span class="ident" id="5742469">oldGNUSparseNumBytesSize</span><span class="op" id="5742493">)</span><span class="op" id="5742494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742498">if</span>&nbsp;<span class="ident" id="5742501">tr</span><span class="op" id="5742503">.</span><span class="ident" id="5742504">err</span>&nbsp;<span class="op" id="5742508">!=</span>&nbsp;<span class="ident" id="5742511">nil</span>&nbsp;<span class="op" id="5742515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742520">tr</span><span class="op" id="5742522">.</span><span class="ident" id="5742523">err</span>&nbsp;<span class="op" id="5742527">=</span>&nbsp;<span class="ident" id="5742529">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742542">return</span>&nbsp;<span class="ident" id="5742549">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5742555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742559">if</span>&nbsp;<span class="ident" id="5742562">offset</span>&nbsp;<span class="op" id="5742569">==</span>&nbsp;<span class="num" id="5742572">0</span>&nbsp;<span class="op" id="5742574">&amp;&amp;</span>&nbsp;<span class="ident" id="5742577">numBytes</span>&nbsp;<span class="op" id="5742586">==</span>&nbsp;<span class="num" id="5742589">0</span>&nbsp;<span class="op" id="5742591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742596">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5742604">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742608">sp</span>&nbsp;<span class="op" id="5742611">=</span>&nbsp;<span class="builtinfunc" id="5742613">append</span><span class="op" id="5742619">(</span><span class="ident" id="5742620">sp</span><span class="op" id="5742622">,</span>&nbsp;<span class="ident" id="5742624">sparseEntry</span><span class="op" id="5742635">{</span><span class="ident" id="5742636">offset</span><span class="op" id="5742642">:</span>&nbsp;<span class="ident" id="5742644">offset</span><span class="op" id="5742650">,</span>&nbsp;<span class="ident" id="5742652">numBytes</span><span class="op" id="5742660">:</span>&nbsp;<span class="ident" id="5742662">numBytes</span><span class="op" id="5742670">}</span><span class="op" id="5742671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5742674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742678">for</span>&nbsp;<span class="ident" id="5742682">isExtended</span>&nbsp;<span class="op" id="5742693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5742697">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742774">sparseHeader</span>&nbsp;<span class="op" id="5742787">:=</span>&nbsp;<span class="builtinfunc" id="5742790">make</span><span class="op" id="5742794">(</span><span class="op" id="5742795">[</span><span class="op" id="5742796">]</span><span class="builtintype" id="5742797">byte</span><span class="op" id="5742801">,</span>&nbsp;<span class="ident" id="5742803">blockSize</span><span class="op" id="5742812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742816">if</span>&nbsp;<span class="ident" id="5742819">_</span><span class="op" id="5742820">,</span>&nbsp;<span class="ident" id="5742822">tr</span><span class="op" id="5742824">.</span><span class="ident" id="5742825">err</span>&nbsp;<span class="op" id="5742829">=</span>&nbsp;<span class="ident" id="5742831">io</span><span class="op" id="5742833">.</span><span class="ident" id="5742834">ReadFull</span><span class="op" id="5742842">(</span><span class="ident" id="5742843">tr</span><span class="op" id="5742845">.</span><span class="ident" id="5742846">r</span><span class="op" id="5742847">,</span>&nbsp;<span class="ident" id="5742849">sparseHeader</span><span class="op" id="5742861">)</span><span class="op" id="5742862">;</span>&nbsp;<span class="ident" id="5742864">tr</span><span class="op" id="5742866">.</span><span class="ident" id="5742867">err</span>&nbsp;<span class="op" id="5742871">!=</span>&nbsp;<span class="ident" id="5742874">nil</span>&nbsp;<span class="op" id="5742878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5742883">return</span>&nbsp;<span class="ident" id="5742890">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5742896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742900">isExtended</span>&nbsp;<span class="op" id="5742911">=</span>&nbsp;<span class="ident" id="5742913">sparseHeader</span><span class="op" id="5742925">[</span><span class="ident" id="5742926">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="5742968">]</span>&nbsp;<span class="op" id="5742970">!=</span>&nbsp;<span class="num" id="5742973">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5742977">s</span>&nbsp;<span class="op" id="5742979">=</span>&nbsp;<span class="ident" id="5742981">slicer</span><span class="op" id="5742987">(</span><span class="ident" id="5742988">sparseHeader</span><span class="op" id="5743000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743004">for</span>&nbsp;<span class="ident" id="5743008">i</span>&nbsp;<span class="op" id="5743010">:=</span>&nbsp;<span class="num" id="5743013">0</span><span class="op" id="5743014">;</span>&nbsp;<span class="ident" id="5743016">i</span>&nbsp;<span class="op" id="5743018">&lt;</span>&nbsp;<span class="ident" id="5743020">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="5743056">;</span>&nbsp;<span class="ident" id="5743058">i</span><span class="op" id="5743059">++</span>&nbsp;<span class="op" id="5743062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743067">offset</span>&nbsp;<span class="op" id="5743074">:=</span>&nbsp;<span class="ident" id="5743077">tr</span><span class="op" id="5743079">.</span><span class="ident" id="5743080">octal</span><span class="op" id="5743085">(</span><span class="ident" id="5743086">s</span><span class="op" id="5743087">.</span><span class="ident" id="5743088">next</span><span class="op" id="5743092">(</span><span class="ident" id="5743093">oldGNUSparseOffsetSize</span><span class="op" id="5743115">)</span><span class="op" id="5743116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743121">numBytes</span>&nbsp;<span class="op" id="5743130">:=</span>&nbsp;<span class="ident" id="5743133">tr</span><span class="op" id="5743135">.</span><span class="ident" id="5743136">octal</span><span class="op" id="5743141">(</span><span class="ident" id="5743142">s</span><span class="op" id="5743143">.</span><span class="ident" id="5743144">next</span><span class="op" id="5743148">(</span><span class="ident" id="5743149">oldGNUSparseNumBytesSize</span><span class="op" id="5743173">)</span><span class="op" id="5743174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743179">if</span>&nbsp;<span class="ident" id="5743182">tr</span><span class="op" id="5743184">.</span><span class="ident" id="5743185">err</span>&nbsp;<span class="op" id="5743189">!=</span>&nbsp;<span class="ident" id="5743192">nil</span>&nbsp;<span class="op" id="5743196">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743202">tr</span><span class="op" id="5743204">.</span><span class="ident" id="5743205">err</span>&nbsp;<span class="op" id="5743209">=</span>&nbsp;<span class="ident" id="5743211">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743225">return</span>&nbsp;<span class="ident" id="5743232">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5743239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743244">if</span>&nbsp;<span class="ident" id="5743247">offset</span>&nbsp;<span class="op" id="5743254">==</span>&nbsp;<span class="num" id="5743257">0</span>&nbsp;<span class="op" id="5743259">&amp;&amp;</span>&nbsp;<span class="ident" id="5743262">numBytes</span>&nbsp;<span class="op" id="5743271">==</span>&nbsp;<span class="num" id="5743274">0</span>&nbsp;<span class="op" id="5743276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743282">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5743291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743296">sp</span>&nbsp;<span class="op" id="5743299">=</span>&nbsp;<span class="builtinfunc" id="5743301">append</span><span class="op" id="5743307">(</span><span class="ident" id="5743308">sp</span><span class="op" id="5743310">,</span>&nbsp;<span class="ident" id="5743312">sparseEntry</span><span class="op" id="5743323">{</span><span class="ident" id="5743324">offset</span><span class="op" id="5743330">:</span>&nbsp;<span class="ident" id="5743332">offset</span><span class="op" id="5743338">,</span>&nbsp;<span class="ident" id="5743340">numBytes</span><span class="op" id="5743348">:</span>&nbsp;<span class="ident" id="5743350">numBytes</span><span class="op" id="5743358">}</span><span class="op" id="5743359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5743363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5743366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743369">return</span>&nbsp;<span class="ident" id="5743376">sp</span><br>
<span class="lineno">595</span><span class="op" id="5743379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5743382">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="5743476">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5743576">func</span>&nbsp;<span class="ident" id="5743581">readGNUSparseMap1x0</span><span class="op" id="5743600">(</span><span class="ident" id="5743601">r</span>&nbsp;<span class="ident" id="5743603">io</span><span class="op" id="5743605">.</span><span class="ident" id="5743606">Reader</span><span class="op" id="5743612">)</span>&nbsp;<span class="op" id="5743614">(</span><span class="op" id="5743615">[</span><span class="op" id="5743616">]</span><span class="ident" id="5743617">sparseEntry</span><span class="op" id="5743628">,</span>&nbsp;<span class="builtintype" id="5743630">error</span><span class="op" id="5743635">)</span>&nbsp;<span class="op" id="5743637">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743640">buf</span>&nbsp;<span class="op" id="5743644">:=</span>&nbsp;<span class="builtinfunc" id="5743647">make</span><span class="op" id="5743651">(</span><span class="op" id="5743652">[</span><span class="op" id="5743653">]</span><span class="builtintype" id="5743654">byte</span><span class="op" id="5743658">,</span>&nbsp;<span class="num" id="5743660">2</span><span class="op" id="5743661">*</span><span class="ident" id="5743662">blockSize</span><span class="op" id="5743671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743674">sparseHeader</span>&nbsp;<span class="op" id="5743687">:=</span>&nbsp;<span class="ident" id="5743690">buf</span><span class="op" id="5743693">[</span><span class="op" id="5743694">:</span><span class="ident" id="5743695">blockSize</span><span class="op" id="5743704">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5743708">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5743791">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743863">readDecimal</span>&nbsp;<span class="op" id="5743875">:=</span>&nbsp;<span class="keyword" id="5743878">func</span><span class="op" id="5743882">(</span><span class="op" id="5743883">)</span>&nbsp;<span class="op" id="5743885">(</span><span class="ident" id="5743886">int64</span><span class="op" id="5743891">,</span>&nbsp;<span class="builtintype" id="5743893">error</span><span class="op" id="5743898">)</span>&nbsp;<span class="op" id="5743900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5743904">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5743926">nl</span>&nbsp;<span class="op" id="5743929">:=</span>&nbsp;<span class="ident" id="5743932">bytes</span><span class="op" id="5743937">.</span><span class="ident" id="5743938">IndexByte</span><span class="op" id="5743947">(</span><span class="ident" id="5743948">sparseHeader</span><span class="op" id="5743960">,</span>&nbsp;<span class="string" id="5743962">&#39;\n&#39;</span><span class="op" id="5743966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743970">if</span>&nbsp;<span class="ident" id="5743973">nl</span>&nbsp;<span class="op" id="5743976">==</span>&nbsp;<span class="op" id="5743979">-</span><span class="num" id="5743980">1</span>&nbsp;<span class="op" id="5743982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5743987">if</span>&nbsp;<span class="builtinfunc" id="5743990">len</span><span class="op" id="5743993">(</span><span class="ident" id="5743994">sparseHeader</span><span class="op" id="5744006">)</span>&nbsp;<span class="op" id="5744008">&gt;=</span>&nbsp;<span class="ident" id="5744011">blockSize</span>&nbsp;<span class="op" id="5744021">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744027">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744051">return</span>&nbsp;<span class="num" id="5744058">0</span><span class="op" id="5744059">,</span>&nbsp;<span class="ident" id="5744061">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744079">oldLen</span>&nbsp;<span class="op" id="5744086">:=</span>&nbsp;<span class="builtinfunc" id="5744089">len</span><span class="op" id="5744092">(</span><span class="ident" id="5744093">sparseHeader</span><span class="op" id="5744105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744110">newLen</span>&nbsp;<span class="op" id="5744117">:=</span>&nbsp;<span class="ident" id="5744120">oldLen</span>&nbsp;<span class="op" id="5744127">+</span>&nbsp;<span class="ident" id="5744129">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744142">if</span>&nbsp;<span class="builtinfunc" id="5744145">cap</span><span class="op" id="5744148">(</span><span class="ident" id="5744149">sparseHeader</span><span class="op" id="5744161">)</span>&nbsp;<span class="op" id="5744163">&lt;</span>&nbsp;<span class="ident" id="5744165">newLen</span>&nbsp;<span class="op" id="5744172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744178">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5744250">copy</span><span class="op" id="5744254">(</span><span class="ident" id="5744255">buf</span><span class="op" id="5744258">,</span>&nbsp;<span class="ident" id="5744260">sparseHeader</span><span class="op" id="5744272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744278">sparseHeader</span>&nbsp;<span class="op" id="5744291">=</span>&nbsp;<span class="ident" id="5744293">buf</span><span class="op" id="5744296">[</span><span class="op" id="5744297">:</span><span class="ident" id="5744298">newLen</span><span class="op" id="5744304">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744309">}</span>&nbsp;<span class="keyword" id="5744311">else</span>&nbsp;<span class="op" id="5744316">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744322">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744374">sparseHeader</span>&nbsp;<span class="op" id="5744387">=</span>&nbsp;<span class="ident" id="5744389">sparseHeader</span><span class="op" id="5744401">[</span><span class="op" id="5744402">:</span><span class="ident" id="5744403">newLen</span><span class="op" id="5744409">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744420">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744481">if</span>&nbsp;<span class="ident" id="5744484">_</span><span class="op" id="5744485">,</span>&nbsp;<span class="ident" id="5744487">err</span>&nbsp;<span class="op" id="5744491">:=</span>&nbsp;<span class="ident" id="5744494">io</span><span class="op" id="5744496">.</span><span class="ident" id="5744497">ReadFull</span><span class="op" id="5744505">(</span><span class="ident" id="5744506">r</span><span class="op" id="5744507">,</span>&nbsp;<span class="ident" id="5744509">sparseHeader</span><span class="op" id="5744521">[</span><span class="ident" id="5744522">oldLen</span><span class="op" id="5744528">:</span><span class="ident" id="5744529">newLen</span><span class="op" id="5744535">]</span><span class="op" id="5744536">)</span><span class="op" id="5744537">;</span>&nbsp;<span class="ident" id="5744539">err</span>&nbsp;<span class="op" id="5744543">!=</span>&nbsp;<span class="ident" id="5744546">nil</span>&nbsp;<span class="op" id="5744550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744556">return</span>&nbsp;<span class="num" id="5744563">0</span><span class="op" id="5744564">,</span>&nbsp;<span class="ident" id="5744566">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744579">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744620">nl</span>&nbsp;<span class="op" id="5744623">=</span>&nbsp;<span class="ident" id="5744625">bytes</span><span class="op" id="5744630">.</span><span class="ident" id="5744631">IndexByte</span><span class="op" id="5744640">(</span><span class="ident" id="5744641">sparseHeader</span><span class="op" id="5744653">[</span><span class="ident" id="5744654">oldLen</span><span class="op" id="5744660">:</span><span class="ident" id="5744661">newLen</span><span class="op" id="5744667">]</span><span class="op" id="5744668">,</span>&nbsp;<span class="string" id="5744670">&#39;\n&#39;</span><span class="op" id="5744674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744679">if</span>&nbsp;<span class="ident" id="5744682">nl</span>&nbsp;<span class="op" id="5744685">==</span>&nbsp;<span class="op" id="5744688">-</span><span class="num" id="5744689">1</span>&nbsp;<span class="op" id="5744691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744697">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744721">return</span>&nbsp;<span class="num" id="5744728">0</span><span class="op" id="5744729">,</span>&nbsp;<span class="ident" id="5744731">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744744">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744749">nl</span>&nbsp;<span class="op" id="5744752">+=</span>&nbsp;<span class="ident" id="5744755">oldLen</span>&nbsp;<span class="comment" id="5744762">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744811">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5744862">n</span><span class="op" id="5744863">,</span>&nbsp;<span class="ident" id="5744865">err</span>&nbsp;<span class="op" id="5744869">:=</span>&nbsp;<span class="ident" id="5744872">strconv</span><span class="op" id="5744879">.</span><span class="ident" id="5744880">ParseInt</span><span class="op" id="5744888">(</span><span class="builtintype" id="5744889">string</span><span class="op" id="5744895">(</span><span class="ident" id="5744896">sparseHeader</span><span class="op" id="5744908">[</span><span class="op" id="5744909">:</span><span class="ident" id="5744910">nl</span><span class="op" id="5744912">]</span><span class="op" id="5744913">)</span><span class="op" id="5744914">,</span>&nbsp;<span class="num" id="5744916">10</span><span class="op" id="5744918">,</span>&nbsp;<span class="num" id="5744920">0</span><span class="op" id="5744921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744925">if</span>&nbsp;<span class="ident" id="5744928">err</span>&nbsp;<span class="op" id="5744932">!=</span>&nbsp;<span class="ident" id="5744935">nil</span>&nbsp;<span class="op" id="5744939">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5744944">return</span>&nbsp;<span class="num" id="5744951">0</span><span class="op" id="5744952">,</span>&nbsp;<span class="ident" id="5744954">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5744966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5744971">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745019">sparseHeader</span>&nbsp;<span class="op" id="5745032">=</span>&nbsp;<span class="ident" id="5745034">sparseHeader</span><span class="op" id="5745046">[</span><span class="ident" id="5745047">nl</span><span class="op" id="5745049">+</span><span class="num" id="5745050">1</span><span class="op" id="5745051">:</span><span class="op" id="5745052">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745056">return</span>&nbsp;<span class="ident" id="5745063">n</span><span class="op" id="5745064">,</span>&nbsp;<span class="ident" id="5745066">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5745071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5745075">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745100">if</span>&nbsp;<span class="ident" id="5745103">_</span><span class="op" id="5745104">,</span>&nbsp;<span class="ident" id="5745106">err</span>&nbsp;<span class="op" id="5745110">:=</span>&nbsp;<span class="ident" id="5745113">io</span><span class="op" id="5745115">.</span><span class="ident" id="5745116">ReadFull</span><span class="op" id="5745124">(</span><span class="ident" id="5745125">r</span><span class="op" id="5745126">,</span>&nbsp;<span class="ident" id="5745128">sparseHeader</span><span class="op" id="5745140">)</span><span class="op" id="5745141">;</span>&nbsp;<span class="ident" id="5745143">err</span>&nbsp;<span class="op" id="5745147">!=</span>&nbsp;<span class="ident" id="5745150">nil</span>&nbsp;<span class="op" id="5745154">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745158">return</span>&nbsp;<span class="ident" id="5745165">nil</span><span class="op" id="5745168">,</span>&nbsp;<span class="ident" id="5745170">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5745175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5745179">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745229">numEntries</span><span class="op" id="5745239">,</span>&nbsp;<span class="ident" id="5745241">err</span>&nbsp;<span class="op" id="5745245">:=</span>&nbsp;<span class="ident" id="5745248">readDecimal</span><span class="op" id="5745259">(</span><span class="op" id="5745260">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745263">if</span>&nbsp;<span class="ident" id="5745266">err</span>&nbsp;<span class="op" id="5745270">!=</span>&nbsp;<span class="ident" id="5745273">nil</span>&nbsp;<span class="op" id="5745277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745281">return</span>&nbsp;<span class="ident" id="5745288">nil</span><span class="op" id="5745291">,</span>&nbsp;<span class="ident" id="5745293">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5745298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5745302">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745327">sp</span>&nbsp;<span class="op" id="5745330">:=</span>&nbsp;<span class="builtinfunc" id="5745333">make</span><span class="op" id="5745337">(</span><span class="op" id="5745338">[</span><span class="op" id="5745339">]</span><span class="ident" id="5745340">sparseEntry</span><span class="op" id="5745351">,</span>&nbsp;<span class="num" id="5745353">0</span><span class="op" id="5745354">,</span>&nbsp;<span class="ident" id="5745356">numEntries</span><span class="op" id="5745366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745369">for</span>&nbsp;<span class="ident" id="5745373">i</span>&nbsp;<span class="op" id="5745375">:=</span>&nbsp;<span class="ident" id="5745378">int64</span><span class="op" id="5745383">(</span><span class="num" id="5745384">0</span><span class="op" id="5745385">)</span><span class="op" id="5745386">;</span>&nbsp;<span class="ident" id="5745388">i</span>&nbsp;<span class="op" id="5745390">&lt;</span>&nbsp;<span class="ident" id="5745392">numEntries</span><span class="op" id="5745402">;</span>&nbsp;<span class="ident" id="5745404">i</span><span class="op" id="5745405">++</span>&nbsp;<span class="op" id="5745408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5745412">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745433">offset</span><span class="op" id="5745439">,</span>&nbsp;<span class="ident" id="5745441">err</span>&nbsp;<span class="op" id="5745445">:=</span>&nbsp;<span class="ident" id="5745448">readDecimal</span><span class="op" id="5745459">(</span><span class="op" id="5745460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745464">if</span>&nbsp;<span class="ident" id="5745467">err</span>&nbsp;<span class="op" id="5745471">!=</span>&nbsp;<span class="ident" id="5745474">nil</span>&nbsp;<span class="op" id="5745478">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745483">return</span>&nbsp;<span class="ident" id="5745490">nil</span><span class="op" id="5745493">,</span>&nbsp;<span class="ident" id="5745495">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5745501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5745505">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745524">numBytes</span><span class="op" id="5745532">,</span>&nbsp;<span class="ident" id="5745534">err</span>&nbsp;<span class="op" id="5745538">:=</span>&nbsp;<span class="ident" id="5745541">readDecimal</span><span class="op" id="5745552">(</span><span class="op" id="5745553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745557">if</span>&nbsp;<span class="ident" id="5745560">err</span>&nbsp;<span class="op" id="5745564">!=</span>&nbsp;<span class="ident" id="5745567">nil</span>&nbsp;<span class="op" id="5745571">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745576">return</span>&nbsp;<span class="ident" id="5745583">nil</span><span class="op" id="5745586">,</span>&nbsp;<span class="ident" id="5745588">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5745594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745599">sp</span>&nbsp;<span class="op" id="5745602">=</span>&nbsp;<span class="builtinfunc" id="5745604">append</span><span class="op" id="5745610">(</span><span class="ident" id="5745611">sp</span><span class="op" id="5745613">,</span>&nbsp;<span class="ident" id="5745615">sparseEntry</span><span class="op" id="5745626">{</span><span class="ident" id="5745627">offset</span><span class="op" id="5745633">:</span>&nbsp;<span class="ident" id="5745635">offset</span><span class="op" id="5745641">,</span>&nbsp;<span class="ident" id="5745643">numBytes</span><span class="op" id="5745651">:</span>&nbsp;<span class="ident" id="5745653">numBytes</span><span class="op" id="5745661">}</span><span class="op" id="5745662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5745665">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745669">return</span>&nbsp;<span class="ident" id="5745676">sp</span><span class="op" id="5745678">,</span>&nbsp;<span class="ident" id="5745680">nil</span><br>
<span class="lineno"></span><span class="op" id="5745684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5745687">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="5745781">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5745829">func</span>&nbsp;<span class="ident" id="5745834">readGNUSparseMap0x1</span><span class="op" id="5745853">(</span><span class="ident" id="5745854">headers</span>&nbsp;<span class="keyword" id="5745862">map</span><span class="op" id="5745865">[</span><span class="builtintype" id="5745866">string</span><span class="op" id="5745872">]</span><span class="builtintype" id="5745873">string</span><span class="op" id="5745879">)</span>&nbsp;<span class="op" id="5745881">(</span><span class="op" id="5745882">[</span><span class="op" id="5745883">]</span><span class="ident" id="5745884">sparseEntry</span><span class="op" id="5745895">,</span>&nbsp;<span class="builtintype" id="5745897">error</span><span class="op" id="5745902">)</span>&nbsp;<span class="op" id="5745904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5745907">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5745933">numEntriesStr</span><span class="op" id="5745946">,</span>&nbsp;<span class="ident" id="5745948">ok</span>&nbsp;<span class="op" id="5745951">:=</span>&nbsp;<span class="ident" id="5745954">headers</span><span class="op" id="5745961">[</span><span class="ident" id="5745962">paxGNUSparseNumBlocks</span><span class="op" id="5745983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745986">if</span>&nbsp;<span class="op" id="5745989">!</span><span class="ident" id="5745990">ok</span>&nbsp;<span class="op" id="5745993">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5745997">return</span>&nbsp;<span class="ident" id="5746004">nil</span><span class="op" id="5746007">,</span>&nbsp;<span class="ident" id="5746009">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5746023">numEntries</span><span class="op" id="5746033">,</span>&nbsp;<span class="ident" id="5746035">err</span>&nbsp;<span class="op" id="5746039">:=</span>&nbsp;<span class="ident" id="5746042">strconv</span><span class="op" id="5746049">.</span><span class="ident" id="5746050">ParseInt</span><span class="op" id="5746058">(</span><span class="ident" id="5746059">numEntriesStr</span><span class="op" id="5746072">,</span>&nbsp;<span class="num" id="5746074">10</span><span class="op" id="5746076">,</span>&nbsp;<span class="num" id="5746078">0</span><span class="op" id="5746079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746082">if</span>&nbsp;<span class="ident" id="5746085">err</span>&nbsp;<span class="op" id="5746089">!=</span>&nbsp;<span class="ident" id="5746092">nil</span>&nbsp;<span class="op" id="5746096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746100">return</span>&nbsp;<span class="ident" id="5746107">nil</span><span class="op" id="5746110">,</span>&nbsp;<span class="ident" id="5746112">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5746127">sparseMap</span>&nbsp;<span class="op" id="5746137">:=</span>&nbsp;<span class="ident" id="5746140">strings</span><span class="op" id="5746147">.</span><span class="ident" id="5746148">Split</span><span class="op" id="5746153">(</span><span class="ident" id="5746154">headers</span><span class="op" id="5746161">[</span><span class="ident" id="5746162">paxGNUSparseMap</span><span class="op" id="5746177">]</span><span class="op" id="5746178">,</span>&nbsp;<span class="string" id="5746180">&#34;,&#34;</span><span class="op" id="5746183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5746187">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746247">if</span>&nbsp;<span class="ident" id="5746250">int64</span><span class="op" id="5746255">(</span><span class="builtinfunc" id="5746256">len</span><span class="op" id="5746259">(</span><span class="ident" id="5746260">sparseMap</span><span class="op" id="5746269">)</span><span class="op" id="5746270">)</span>&nbsp;<span class="op" id="5746272">!=</span>&nbsp;<span class="num" id="5746275">2</span><span class="op" id="5746276">*</span><span class="ident" id="5746277">numEntries</span>&nbsp;<span class="op" id="5746288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746292">return</span>&nbsp;<span class="ident" id="5746299">nil</span><span class="op" id="5746302">,</span>&nbsp;<span class="ident" id="5746304">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5746319">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5746366">sp</span>&nbsp;<span class="op" id="5746369">:=</span>&nbsp;<span class="builtinfunc" id="5746372">make</span><span class="op" id="5746376">(</span><span class="op" id="5746377">[</span><span class="op" id="5746378">]</span><span class="ident" id="5746379">sparseEntry</span><span class="op" id="5746390">,</span>&nbsp;<span class="num" id="5746392">0</span><span class="op" id="5746393">,</span>&nbsp;<span class="ident" id="5746395">numEntries</span><span class="op" id="5746405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746408">for</span>&nbsp;<span class="ident" id="5746412">i</span>&nbsp;<span class="op" id="5746414">:=</span>&nbsp;<span class="ident" id="5746417">int64</span><span class="op" id="5746422">(</span><span class="num" id="5746423">0</span><span class="op" id="5746424">)</span><span class="op" id="5746425">;</span>&nbsp;<span class="ident" id="5746427">i</span>&nbsp;<span class="op" id="5746429">&lt;</span>&nbsp;<span class="ident" id="5746431">numEntries</span><span class="op" id="5746441">;</span>&nbsp;<span class="ident" id="5746443">i</span><span class="op" id="5746444">++</span>&nbsp;<span class="op" id="5746447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5746451">offset</span><span class="op" id="5746457">,</span>&nbsp;<span class="ident" id="5746459">err</span>&nbsp;<span class="op" id="5746463">:=</span>&nbsp;<span class="ident" id="5746466">strconv</span><span class="op" id="5746473">.</span><span class="ident" id="5746474">ParseInt</span><span class="op" id="5746482">(</span><span class="ident" id="5746483">sparseMap</span><span class="op" id="5746492">[</span><span class="num" id="5746493">2</span><span class="op" id="5746494">*</span><span class="ident" id="5746495">i</span><span class="op" id="5746496">]</span><span class="op" id="5746497">,</span>&nbsp;<span class="num" id="5746499">10</span><span class="op" id="5746501">,</span>&nbsp;<span class="num" id="5746503">0</span><span class="op" id="5746504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746508">if</span>&nbsp;<span class="ident" id="5746511">err</span>&nbsp;<span class="op" id="5746515">!=</span>&nbsp;<span class="ident" id="5746518">nil</span>&nbsp;<span class="op" id="5746522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746527">return</span>&nbsp;<span class="ident" id="5746534">nil</span><span class="op" id="5746537">,</span>&nbsp;<span class="ident" id="5746539">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5746555">numBytes</span><span class="op" id="5746563">,</span>&nbsp;<span class="ident" id="5746565">err</span>&nbsp;<span class="op" id="5746569">:=</span>&nbsp;<span class="ident" id="5746572">strconv</span><span class="op" id="5746579">.</span><span class="ident" id="5746580">ParseInt</span><span class="op" id="5746588">(</span><span class="ident" id="5746589">sparseMap</span><span class="op" id="5746598">[</span><span class="num" id="5746599">2</span><span class="op" id="5746600">*</span><span class="ident" id="5746601">i</span><span class="op" id="5746602">+</span><span class="num" id="5746603">1</span><span class="op" id="5746604">]</span><span class="op" id="5746605">,</span>&nbsp;<span class="num" id="5746607">10</span><span class="op" id="5746609">,</span>&nbsp;<span class="num" id="5746611">0</span><span class="op" id="5746612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746616">if</span>&nbsp;<span class="ident" id="5746619">err</span>&nbsp;<span class="op" id="5746623">!=</span>&nbsp;<span class="ident" id="5746626">nil</span>&nbsp;<span class="op" id="5746630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746635">return</span>&nbsp;<span class="ident" id="5746642">nil</span><span class="op" id="5746645">,</span>&nbsp;<span class="ident" id="5746647">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746659">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5746663">sp</span>&nbsp;<span class="op" id="5746666">=</span>&nbsp;<span class="builtinfunc" id="5746668">append</span><span class="op" id="5746674">(</span><span class="ident" id="5746675">sp</span><span class="op" id="5746677">,</span>&nbsp;<span class="ident" id="5746679">sparseEntry</span><span class="op" id="5746690">{</span><span class="ident" id="5746691">offset</span><span class="op" id="5746697">:</span>&nbsp;<span class="ident" id="5746699">offset</span><span class="op" id="5746705">,</span>&nbsp;<span class="ident" id="5746707">numBytes</span><span class="op" id="5746715">:</span>&nbsp;<span class="ident" id="5746717">numBytes</span><span class="op" id="5746725">}</span><span class="op" id="5746726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746733">return</span>&nbsp;<span class="ident" id="5746740">sp</span><span class="op" id="5746742">,</span>&nbsp;<span class="ident" id="5746744">nil</span><br>
<span class="lineno"></span><span class="op" id="5746748">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="5746751">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5746832">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5746889">func</span>&nbsp;<span class="op" id="5746894">(</span><span class="ident" id="5746895">tr</span>&nbsp;<span class="op" id="5746898">*</span><span class="ident" id="5746899">Reader</span><span class="op" id="5746905">)</span>&nbsp;<span class="ident" id="5746907">numBytes</span><span class="op" id="5746915">(</span><span class="op" id="5746916">)</span>&nbsp;<span class="ident" id="5746918">int64</span>&nbsp;<span class="op" id="5746924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746927">if</span>&nbsp;<span class="ident" id="5746930">tr</span><span class="op" id="5746932">.</span><span class="ident" id="5746933">curr</span>&nbsp;<span class="op" id="5746938">==</span>&nbsp;<span class="ident" id="5746941">nil</span>&nbsp;<span class="op" id="5746945">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5746949">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746983">return</span>&nbsp;<span class="num" id="5746990">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5746993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5746996">return</span>&nbsp;<span class="ident" id="5747003">tr</span><span class="op" id="5747005">.</span><span class="ident" id="5747006">curr</span><span class="op" id="5747010">.</span><span class="ident" id="5747011">numBytes</span><span class="op" id="5747019">(</span><span class="op" id="5747020">)</span><br>
<span class="lineno"></span><span class="op" id="5747022">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5747025">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5747082">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="5747145">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="5747199">func</span>&nbsp;<span class="op" id="5747204">(</span><span class="ident" id="5747205">tr</span>&nbsp;<span class="op" id="5747208">*</span><span class="ident" id="5747209">Reader</span><span class="op" id="5747215">)</span>&nbsp;<span class="ident" id="5747217">Read</span><span class="op" id="5747221">(</span><span class="ident" id="5747222">b</span>&nbsp;<span class="op" id="5747224">[</span><span class="op" id="5747225">]</span><span class="builtintype" id="5747226">byte</span><span class="op" id="5747230">)</span>&nbsp;<span class="op" id="5747232">(</span><span class="ident" id="5747233">n</span>&nbsp;<span class="builtintype" id="5747235">int</span><span class="op" id="5747238">,</span>&nbsp;<span class="ident" id="5747240">err</span>&nbsp;<span class="builtintype" id="5747244">error</span><span class="op" id="5747249">)</span>&nbsp;<span class="op" id="5747251">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747254">if</span>&nbsp;<span class="ident" id="5747257">tr</span><span class="op" id="5747259">.</span><span class="ident" id="5747260">curr</span>&nbsp;<span class="op" id="5747265">==</span>&nbsp;<span class="ident" id="5747268">nil</span>&nbsp;<span class="op" id="5747272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747276">return</span>&nbsp;<span class="num" id="5747283">0</span><span class="op" id="5747284">,</span>&nbsp;<span class="ident" id="5747286">io</span><span class="op" id="5747288">.</span><span class="ident" id="5747289">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5747294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747297">n</span><span class="op" id="5747298">,</span>&nbsp;<span class="ident" id="5747300">err</span>&nbsp;<span class="op" id="5747304">=</span>&nbsp;<span class="ident" id="5747306">tr</span><span class="op" id="5747308">.</span><span class="ident" id="5747309">curr</span><span class="op" id="5747313">.</span><span class="ident" id="5747314">Read</span><span class="op" id="5747318">(</span><span class="ident" id="5747319">b</span><span class="op" id="5747320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747323">if</span>&nbsp;<span class="ident" id="5747326">err</span>&nbsp;<span class="op" id="5747330">!=</span>&nbsp;<span class="ident" id="5747333">nil</span>&nbsp;<span class="op" id="5747337">&amp;&amp;</span>&nbsp;<span class="ident" id="5747340">err</span>&nbsp;<span class="op" id="5747344">!=</span>&nbsp;<span class="ident" id="5747347">io</span><span class="op" id="5747349">.</span><span class="ident" id="5747350">EOF</span>&nbsp;<span class="op" id="5747354">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747358">tr</span><span class="op" id="5747360">.</span><span class="ident" id="5747361">err</span>&nbsp;<span class="op" id="5747365">=</span>&nbsp;<span class="ident" id="5747367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5747372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747375">return</span><br>
<span class="lineno"></span><span class="op" id="5747382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="5747385">func</span>&nbsp;<span class="op" id="5747390">(</span><span class="ident" id="5747391">rfr</span>&nbsp;<span class="op" id="5747395">*</span><span class="ident" id="5747396">regFileReader</span><span class="op" id="5747409">)</span>&nbsp;<span class="ident" id="5747411">Read</span><span class="op" id="5747415">(</span><span class="ident" id="5747416">b</span>&nbsp;<span class="op" id="5747418">[</span><span class="op" id="5747419">]</span><span class="builtintype" id="5747420">byte</span><span class="op" id="5747424">)</span>&nbsp;<span class="op" id="5747426">(</span><span class="ident" id="5747427">n</span>&nbsp;<span class="builtintype" id="5747429">int</span><span class="op" id="5747432">,</span>&nbsp;<span class="ident" id="5747434">err</span>&nbsp;<span class="builtintype" id="5747438">error</span><span class="op" id="5747443">)</span>&nbsp;<span class="op" id="5747445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747448">if</span>&nbsp;<span class="ident" id="5747451">rfr</span><span class="op" id="5747454">.</span><span class="ident" id="5747455">nb</span>&nbsp;<span class="op" id="5747458">==</span>&nbsp;<span class="num" id="5747461">0</span>&nbsp;<span class="op" id="5747463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5747467">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747486">return</span>&nbsp;<span class="num" id="5747493">0</span><span class="op" id="5747494">,</span>&nbsp;<span class="ident" id="5747496">io</span><span class="op" id="5747498">.</span><span class="ident" id="5747499">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5747504">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747507">if</span>&nbsp;<span class="ident" id="5747510">int64</span><span class="op" id="5747515">(</span><span class="builtinfunc" id="5747516">len</span><span class="op" id="5747519">(</span><span class="ident" id="5747520">b</span><span class="op" id="5747521">)</span><span class="op" id="5747522">)</span>&nbsp;<span class="op" id="5747524">&gt;</span>&nbsp;<span class="ident" id="5747526">rfr</span><span class="op" id="5747529">.</span><span class="ident" id="5747530">nb</span>&nbsp;<span class="op" id="5747533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747537">b</span>&nbsp;<span class="op" id="5747539">=</span>&nbsp;<span class="ident" id="5747541">b</span><span class="op" id="5747542">[</span><span class="num" id="5747543">0</span><span class="op" id="5747544">:</span><span class="ident" id="5747545">rfr</span><span class="op" id="5747548">.</span><span class="ident" id="5747549">nb</span><span class="op" id="5747551">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5747554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747557">n</span><span class="op" id="5747558">,</span>&nbsp;<span class="ident" id="5747560">err</span>&nbsp;<span class="op" id="5747564">=</span>&nbsp;<span class="ident" id="5747566">rfr</span><span class="op" id="5747569">.</span><span class="ident" id="5747570">r</span><span class="op" id="5747571">.</span><span class="ident" id="5747572">Read</span><span class="op" id="5747576">(</span><span class="ident" id="5747577">b</span><span class="op" id="5747578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747581">rfr</span><span class="op" id="5747584">.</span><span class="ident" id="5747585">nb</span>&nbsp;<span class="op" id="5747588">-=</span>&nbsp;<span class="ident" id="5747591">int64</span><span class="op" id="5747596">(</span><span class="ident" id="5747597">n</span><span class="op" id="5747598">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747602">if</span>&nbsp;<span class="ident" id="5747605">err</span>&nbsp;<span class="op" id="5747609">==</span>&nbsp;<span class="ident" id="5747612">io</span><span class="op" id="5747614">.</span><span class="ident" id="5747615">EOF</span>&nbsp;<span class="op" id="5747619">&amp;&amp;</span>&nbsp;<span class="ident" id="5747622">rfr</span><span class="op" id="5747625">.</span><span class="ident" id="5747626">nb</span>&nbsp;<span class="op" id="5747629">&gt;</span>&nbsp;<span class="num" id="5747631">0</span>&nbsp;<span class="op" id="5747633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747637">err</span>&nbsp;<span class="op" id="5747641">=</span>&nbsp;<span class="ident" id="5747643">io</span><span class="op" id="5747645">.</span><span class="ident" id="5747646">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5747664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747667">return</span><br>
<span class="lineno">755</span><span class="op" id="5747674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5747677">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5747769">func</span>&nbsp;<span class="op" id="5747774">(</span><span class="ident" id="5747775">rfr</span>&nbsp;<span class="op" id="5747779">*</span><span class="ident" id="5747780">regFileReader</span><span class="op" id="5747793">)</span>&nbsp;<span class="ident" id="5747795">numBytes</span><span class="op" id="5747803">(</span><span class="op" id="5747804">)</span>&nbsp;<span class="ident" id="5747806">int64</span>&nbsp;<span class="op" id="5747812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747815">return</span>&nbsp;<span class="ident" id="5747822">rfr</span><span class="op" id="5747825">.</span><span class="ident" id="5747826">nb</span><br>
<span class="lineno">760</span><span class="op" id="5747829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5747832">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="5747895">func</span>&nbsp;<span class="op" id="5747900">(</span><span class="ident" id="5747901">sfr</span>&nbsp;<span class="op" id="5747905">*</span><span class="ident" id="5747906">sparseFileReader</span><span class="op" id="5747922">)</span>&nbsp;<span class="ident" id="5747924">readHole</span><span class="op" id="5747932">(</span><span class="ident" id="5747933">b</span>&nbsp;<span class="op" id="5747935">[</span><span class="op" id="5747936">]</span><span class="builtintype" id="5747937">byte</span><span class="op" id="5747941">,</span>&nbsp;<span class="ident" id="5747943">toOffset</span>&nbsp;<span class="ident" id="5747952">int64</span><span class="op" id="5747957">)</span>&nbsp;<span class="builtintype" id="5747959">int</span>&nbsp;<span class="op" id="5747963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5747966">n64</span>&nbsp;<span class="op" id="5747970">:=</span>&nbsp;<span class="ident" id="5747973">toOffset</span>&nbsp;<span class="op" id="5747982">-</span>&nbsp;<span class="ident" id="5747984">sfr</span><span class="op" id="5747987">.</span><span class="ident" id="5747988">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5747993">if</span>&nbsp;<span class="ident" id="5747996">n64</span>&nbsp;<span class="op" id="5748000">&gt;</span>&nbsp;<span class="ident" id="5748002">int64</span><span class="op" id="5748007">(</span><span class="builtinfunc" id="5748008">len</span><span class="op" id="5748011">(</span><span class="ident" id="5748012">b</span><span class="op" id="5748013">)</span><span class="op" id="5748014">)</span>&nbsp;<span class="op" id="5748016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748020">n64</span>&nbsp;<span class="op" id="5748024">=</span>&nbsp;<span class="ident" id="5748026">int64</span><span class="op" id="5748031">(</span><span class="builtinfunc" id="5748032">len</span><span class="op" id="5748035">(</span><span class="ident" id="5748036">b</span><span class="op" id="5748037">)</span><span class="op" id="5748038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748044">n</span>&nbsp;<span class="op" id="5748046">:=</span>&nbsp;<span class="builtintype" id="5748049">int</span><span class="op" id="5748052">(</span><span class="ident" id="5748053">n64</span><span class="op" id="5748056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748059">for</span>&nbsp;<span class="ident" id="5748063">i</span>&nbsp;<span class="op" id="5748065">:=</span>&nbsp;<span class="num" id="5748068">0</span><span class="op" id="5748069">;</span>&nbsp;<span class="ident" id="5748071">i</span>&nbsp;<span class="op" id="5748073">&lt;</span>&nbsp;<span class="ident" id="5748075">n</span><span class="op" id="5748076">;</span>&nbsp;<span class="ident" id="5748078">i</span><span class="op" id="5748079">++</span>&nbsp;<span class="op" id="5748082">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748086">b</span><span class="op" id="5748087">[</span><span class="ident" id="5748088">i</span><span class="op" id="5748089">]</span>&nbsp;<span class="op" id="5748091">=</span>&nbsp;<span class="num" id="5748093">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748099">sfr</span><span class="op" id="5748102">.</span><span class="ident" id="5748103">pos</span>&nbsp;<span class="op" id="5748107">+=</span>&nbsp;<span class="ident" id="5748110">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748115">return</span>&nbsp;<span class="ident" id="5748122">n</span><br>
<span class="lineno"></span><span class="op" id="5748124">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="5748127">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="5748180">func</span>&nbsp;<span class="op" id="5748185">(</span><span class="ident" id="5748186">sfr</span>&nbsp;<span class="op" id="5748190">*</span><span class="ident" id="5748191">sparseFileReader</span><span class="op" id="5748207">)</span>&nbsp;<span class="ident" id="5748209">Read</span><span class="op" id="5748213">(</span><span class="ident" id="5748214">b</span>&nbsp;<span class="op" id="5748216">[</span><span class="op" id="5748217">]</span><span class="builtintype" id="5748218">byte</span><span class="op" id="5748222">)</span>&nbsp;<span class="op" id="5748224">(</span><span class="ident" id="5748225">n</span>&nbsp;<span class="builtintype" id="5748227">int</span><span class="op" id="5748230">,</span>&nbsp;<span class="ident" id="5748232">err</span>&nbsp;<span class="builtintype" id="5748236">error</span><span class="op" id="5748241">)</span>&nbsp;<span class="op" id="5748243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748246">if</span>&nbsp;<span class="builtinfunc" id="5748249">len</span><span class="op" id="5748252">(</span><span class="ident" id="5748253">sfr</span><span class="op" id="5748256">.</span><span class="ident" id="5748257">sp</span><span class="op" id="5748259">)</span>&nbsp;<span class="op" id="5748261">==</span>&nbsp;<span class="num" id="5748264">0</span>&nbsp;<span class="op" id="5748266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748270">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748312">if</span>&nbsp;<span class="ident" id="5748315">sfr</span><span class="op" id="5748318">.</span><span class="ident" id="5748319">pos</span>&nbsp;<span class="op" id="5748323">&lt;</span>&nbsp;<span class="ident" id="5748325">sfr</span><span class="op" id="5748328">.</span><span class="ident" id="5748329">tot</span>&nbsp;<span class="op" id="5748333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748338">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748367">n</span>&nbsp;<span class="op" id="5748369">=</span>&nbsp;<span class="ident" id="5748371">sfr</span><span class="op" id="5748374">.</span><span class="ident" id="5748375">readHole</span><span class="op" id="5748383">(</span><span class="ident" id="5748384">b</span><span class="op" id="5748385">,</span>&nbsp;<span class="ident" id="5748387">sfr</span><span class="op" id="5748390">.</span><span class="ident" id="5748391">tot</span><span class="op" id="5748394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748399">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748408">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748412">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748457">return</span>&nbsp;<span class="num" id="5748464">0</span><span class="op" id="5748465">,</span>&nbsp;<span class="ident" id="5748467">io</span><span class="op" id="5748469">.</span><span class="ident" id="5748470">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748478">if</span>&nbsp;<span class="ident" id="5748481">sfr</span><span class="op" id="5748484">.</span><span class="ident" id="5748485">pos</span>&nbsp;<span class="op" id="5748489">&lt;</span>&nbsp;<span class="ident" id="5748491">sfr</span><span class="op" id="5748494">.</span><span class="ident" id="5748495">sp</span><span class="op" id="5748497">[</span><span class="num" id="5748498">0</span><span class="op" id="5748499">]</span><span class="op" id="5748500">.</span><span class="ident" id="5748501">offset</span>&nbsp;<span class="op" id="5748508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748512">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748533">n</span>&nbsp;<span class="op" id="5748535">=</span>&nbsp;<span class="ident" id="5748537">sfr</span><span class="op" id="5748540">.</span><span class="ident" id="5748541">readHole</span><span class="op" id="5748549">(</span><span class="ident" id="5748550">b</span><span class="op" id="5748551">,</span>&nbsp;<span class="ident" id="5748553">sfr</span><span class="op" id="5748556">.</span><span class="ident" id="5748557">sp</span><span class="op" id="5748559">[</span><span class="num" id="5748560">0</span><span class="op" id="5748561">]</span><span class="op" id="5748562">.</span><span class="ident" id="5748563">offset</span><span class="op" id="5748569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748573">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748585">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748652">posInFragment</span>&nbsp;<span class="op" id="5748666">:=</span>&nbsp;<span class="ident" id="5748669">sfr</span><span class="op" id="5748672">.</span><span class="ident" id="5748673">pos</span>&nbsp;<span class="op" id="5748677">-</span>&nbsp;<span class="ident" id="5748679">sfr</span><span class="op" id="5748682">.</span><span class="ident" id="5748683">sp</span><span class="op" id="5748685">[</span><span class="num" id="5748686">0</span><span class="op" id="5748687">]</span><span class="op" id="5748688">.</span><span class="ident" id="5748689">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748697">bytesLeft</span>&nbsp;<span class="op" id="5748707">:=</span>&nbsp;<span class="ident" id="5748710">sfr</span><span class="op" id="5748713">.</span><span class="ident" id="5748714">sp</span><span class="op" id="5748716">[</span><span class="num" id="5748717">0</span><span class="op" id="5748718">]</span><span class="op" id="5748719">.</span><span class="ident" id="5748720">numBytes</span>&nbsp;<span class="op" id="5748729">-</span>&nbsp;<span class="ident" id="5748731">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748746">if</span>&nbsp;<span class="ident" id="5748749">int64</span><span class="op" id="5748754">(</span><span class="builtinfunc" id="5748755">len</span><span class="op" id="5748758">(</span><span class="ident" id="5748759">b</span><span class="op" id="5748760">)</span><span class="op" id="5748761">)</span>&nbsp;<span class="op" id="5748763">&gt;</span>&nbsp;<span class="ident" id="5748765">bytesLeft</span>&nbsp;<span class="op" id="5748775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748779">b</span>&nbsp;<span class="op" id="5748781">=</span>&nbsp;<span class="ident" id="5748783">b</span><span class="op" id="5748784">[</span><span class="num" id="5748785">0</span><span class="op" id="5748786">:</span><span class="ident" id="5748787">bytesLeft</span><span class="op" id="5748796">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748799">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748803">n</span><span class="op" id="5748804">,</span>&nbsp;<span class="ident" id="5748806">err</span>&nbsp;<span class="op" id="5748810">=</span>&nbsp;<span class="ident" id="5748812">sfr</span><span class="op" id="5748815">.</span><span class="ident" id="5748816">rfr</span><span class="op" id="5748819">.</span><span class="ident" id="5748820">Read</span><span class="op" id="5748824">(</span><span class="ident" id="5748825">b</span><span class="op" id="5748826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748829">sfr</span><span class="op" id="5748832">.</span><span class="ident" id="5748833">pos</span>&nbsp;<span class="op" id="5748837">+=</span>&nbsp;<span class="ident" id="5748840">int64</span><span class="op" id="5748845">(</span><span class="ident" id="5748846">n</span><span class="op" id="5748847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748851">if</span>&nbsp;<span class="ident" id="5748854">int64</span><span class="op" id="5748859">(</span><span class="ident" id="5748860">n</span><span class="op" id="5748861">)</span>&nbsp;<span class="op" id="5748863">==</span>&nbsp;<span class="ident" id="5748866">bytesLeft</span>&nbsp;<span class="op" id="5748876">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748880">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5748915">sfr</span><span class="op" id="5748918">.</span><span class="ident" id="5748919">sp</span>&nbsp;<span class="op" id="5748922">=</span>&nbsp;<span class="ident" id="5748924">sfr</span><span class="op" id="5748927">.</span><span class="ident" id="5748928">sp</span><span class="op" id="5748930">[</span><span class="num" id="5748931">1</span><span class="op" id="5748932">:</span><span class="op" id="5748933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5748936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5748940">if</span>&nbsp;<span class="ident" id="5748943">err</span>&nbsp;<span class="op" id="5748947">==</span>&nbsp;<span class="ident" id="5748950">io</span><span class="op" id="5748952">.</span><span class="ident" id="5748953">EOF</span>&nbsp;<span class="op" id="5748957">&amp;&amp;</span>&nbsp;<span class="ident" id="5748960">sfr</span><span class="op" id="5748963">.</span><span class="ident" id="5748964">pos</span>&nbsp;<span class="op" id="5748968">&lt;</span>&nbsp;<span class="ident" id="5748970">sfr</span><span class="op" id="5748973">.</span><span class="ident" id="5748974">tot</span>&nbsp;<span class="op" id="5748978">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5748982">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5749060">err</span>&nbsp;<span class="op" id="5749064">=</span>&nbsp;<span class="ident" id="5749066">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5749071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5749074">return</span><br>
<span class="lineno"></span><span class="op" id="5749081">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5749084">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5749158">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5749201">func</span>&nbsp;<span class="op" id="5749206">(</span><span class="ident" id="5749207">sfr</span>&nbsp;<span class="op" id="5749211">*</span><span class="ident" id="5749212">sparseFileReader</span><span class="op" id="5749228">)</span>&nbsp;<span class="ident" id="5749230">numBytes</span><span class="op" id="5749238">(</span><span class="op" id="5749239">)</span>&nbsp;<span class="ident" id="5749241">int64</span>&nbsp;<span class="op" id="5749247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5749250">return</span>&nbsp;<span class="ident" id="5749257">sfr</span><span class="op" id="5749260">.</span><span class="ident" id="5749261">rfr</span><span class="op" id="5749264">.</span><span class="ident" id="5749265">nb</span><br>
<span class="lineno">820</span><span class="op" id="5749268">}</span>
</div>
</body>
</html>
