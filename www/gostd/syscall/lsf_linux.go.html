<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2600513">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2600569">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2600623">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2600674">//&nbsp;Linux&nbsp;socket&nbsp;filter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2600698">package</span>&nbsp;<span class="ident" id="2600706">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2600715">import</span>&nbsp;<span class="op" id="2600722">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2600725">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2600734">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2600737">func</span>&nbsp;<span class="ident" id="2600742">LsfStmt</span><span class="op" id="2600749">(</span><span class="ident" id="2600750">code</span><span class="op" id="2600754">,</span>&nbsp;<span class="ident" id="2600756">k</span>&nbsp;<span class="builtintype" id="2600758">int</span><span class="op" id="2600761">)</span>&nbsp;<span class="op" id="2600763">*</span><span class="ident" id="2600764">SockFilter</span>&nbsp;<span class="op" id="2600775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2600778">return</span>&nbsp;<span class="op" id="2600785">&amp;</span><span class="ident" id="2600786">SockFilter</span><span class="op" id="2600796">{</span><span class="ident" id="2600797">Code</span><span class="op" id="2600801">:</span>&nbsp;<span class="builtintype" id="2600803">uint16</span><span class="op" id="2600809">(</span><span class="ident" id="2600810">code</span><span class="op" id="2600814">)</span><span class="op" id="2600815">,</span>&nbsp;<span class="ident" id="2600817">K</span><span class="op" id="2600818">:</span>&nbsp;<span class="builtintype" id="2600820">uint32</span><span class="op" id="2600826">(</span><span class="ident" id="2600827">k</span><span class="op" id="2600828">)</span><span class="op" id="2600829">}</span><br>
<span class="lineno">15</span><span class="op" id="2600831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2600834">func</span>&nbsp;<span class="ident" id="2600839">LsfJump</span><span class="op" id="2600846">(</span><span class="ident" id="2600847">code</span><span class="op" id="2600851">,</span>&nbsp;<span class="ident" id="2600853">k</span><span class="op" id="2600854">,</span>&nbsp;<span class="ident" id="2600856">jt</span><span class="op" id="2600858">,</span>&nbsp;<span class="ident" id="2600860">jf</span>&nbsp;<span class="builtintype" id="2600863">int</span><span class="op" id="2600866">)</span>&nbsp;<span class="op" id="2600868">*</span><span class="ident" id="2600869">SockFilter</span>&nbsp;<span class="op" id="2600880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2600883">return</span>&nbsp;<span class="op" id="2600890">&amp;</span><span class="ident" id="2600891">SockFilter</span><span class="op" id="2600901">{</span><span class="ident" id="2600902">Code</span><span class="op" id="2600906">:</span>&nbsp;<span class="builtintype" id="2600908">uint16</span><span class="op" id="2600914">(</span><span class="ident" id="2600915">code</span><span class="op" id="2600919">)</span><span class="op" id="2600920">,</span>&nbsp;<span class="ident" id="2600922">Jt</span><span class="op" id="2600924">:</span>&nbsp;<span class="builtintype" id="2600926">uint8</span><span class="op" id="2600931">(</span><span class="ident" id="2600932">jt</span><span class="op" id="2600934">)</span><span class="op" id="2600935">,</span>&nbsp;<span class="ident" id="2600937">Jf</span><span class="op" id="2600939">:</span>&nbsp;<span class="builtintype" id="2600941">uint8</span><span class="op" id="2600946">(</span><span class="ident" id="2600947">jf</span><span class="op" id="2600949">)</span><span class="op" id="2600950">,</span>&nbsp;<span class="ident" id="2600952">K</span><span class="op" id="2600953">:</span>&nbsp;<span class="builtintype" id="2600955">uint32</span><span class="op" id="2600961">(</span><span class="ident" id="2600962">k</span><span class="op" id="2600963">)</span><span class="op" id="2600964">}</span><br>
<span class="lineno"></span><span class="op" id="2600966">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2600969">func</span>&nbsp;<span class="ident" id="2600974">LsfSocket</span><span class="op" id="2600983">(</span><span class="ident" id="2600984">ifindex</span><span class="op" id="2600991">,</span>&nbsp;<span class="ident" id="2600993">proto</span>&nbsp;<span class="builtintype" id="2600999">int</span><span class="op" id="2601002">)</span>&nbsp;<span class="op" id="2601004">(</span><span class="builtintype" id="2601005">int</span><span class="op" id="2601008">,</span>&nbsp;<span class="builtintype" id="2601010">error</span><span class="op" id="2601015">)</span>&nbsp;<span class="op" id="2601017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601020">var</span>&nbsp;<span class="ident" id="2601024">lsall</span>&nbsp;<span class="ident" id="2601030">SockaddrLinklayer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601049">s</span><span class="op" id="2601050">,</span>&nbsp;<span class="ident" id="2601052">e</span>&nbsp;<span class="op" id="2601054">:=</span>&nbsp;<span class="ident" id="2601057">Socket</span><span class="op" id="2601063">(</span><span class="ident" id="2601064">AF_PACKET</span><span class="op" id="2601073">,</span>&nbsp;<span class="ident" id="2601075">SOCK_RAW</span><span class="op" id="2601083">,</span>&nbsp;<span class="ident" id="2601085">proto</span><span class="op" id="2601090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601093">if</span>&nbsp;<span class="ident" id="2601096">e</span>&nbsp;<span class="op" id="2601098">!=</span>&nbsp;<span class="ident" id="2601101">nil</span>&nbsp;<span class="op" id="2601105">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601109">return</span>&nbsp;<span class="num" id="2601116">0</span><span class="op" id="2601117">,</span>&nbsp;<span class="ident" id="2601119">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601125">p</span>&nbsp;<span class="op" id="2601127">:=</span>&nbsp;<span class="op" id="2601130">(</span><span class="op" id="2601131">*</span><span class="op" id="2601132">[</span><span class="num" id="2601133">2</span><span class="op" id="2601134">]</span><span class="builtintype" id="2601135">byte</span><span class="op" id="2601139">)</span><span class="op" id="2601140">(</span><span class="ident" id="2601141">unsafe</span><span class="op" id="2601147">.</span><span class="ident" id="2601148">Pointer</span><span class="op" id="2601155">(</span><span class="op" id="2601156">&amp;</span><span class="ident" id="2601157">lsall</span><span class="op" id="2601162">.</span><span class="ident" id="2601163">Protocol</span><span class="op" id="2601171">)</span><span class="op" id="2601172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601175">p</span><span class="op" id="2601176">[</span><span class="num" id="2601177">0</span><span class="op" id="2601178">]</span>&nbsp;<span class="op" id="2601180">=</span>&nbsp;<span class="builtintype" id="2601182">byte</span><span class="op" id="2601186">(</span><span class="ident" id="2601187">proto</span>&nbsp;<span class="op" id="2601193">&gt;&gt;</span>&nbsp;<span class="num" id="2601196">8</span><span class="op" id="2601197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601200">p</span><span class="op" id="2601201">[</span><span class="num" id="2601202">1</span><span class="op" id="2601203">]</span>&nbsp;<span class="op" id="2601205">=</span>&nbsp;<span class="builtintype" id="2601207">byte</span><span class="op" id="2601211">(</span><span class="ident" id="2601212">proto</span><span class="op" id="2601217">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601220">lsall</span><span class="op" id="2601225">.</span><span class="ident" id="2601226">Ifindex</span>&nbsp;<span class="op" id="2601234">=</span>&nbsp;<span class="ident" id="2601236">ifindex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601245">e</span>&nbsp;<span class="op" id="2601247">=</span>&nbsp;<span class="ident" id="2601249">Bind</span><span class="op" id="2601253">(</span><span class="ident" id="2601254">s</span><span class="op" id="2601255">,</span>&nbsp;<span class="op" id="2601257">&amp;</span><span class="ident" id="2601258">lsall</span><span class="op" id="2601263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601266">if</span>&nbsp;<span class="ident" id="2601269">e</span>&nbsp;<span class="op" id="2601271">!=</span>&nbsp;<span class="ident" id="2601274">nil</span>&nbsp;<span class="op" id="2601278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601282">Close</span><span class="op" id="2601287">(</span><span class="ident" id="2601288">s</span><span class="op" id="2601289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601293">return</span>&nbsp;<span class="num" id="2601300">0</span><span class="op" id="2601301">,</span>&nbsp;<span class="ident" id="2601303">e</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601309">return</span>&nbsp;<span class="ident" id="2601316">s</span><span class="op" id="2601317">,</span>&nbsp;<span class="ident" id="2601319">nil</span><br>
<span class="lineno"></span><span class="op" id="2601323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2601326">type</span>&nbsp;<span class="ident" id="2601331">iflags</span>&nbsp;<span class="keyword" id="2601338">struct</span>&nbsp;<span class="op" id="2601345">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601348">name</span>&nbsp;&nbsp;<span class="op" id="2601354">[</span><span class="ident" id="2601355">IFNAMSIZ</span><span class="op" id="2601363">]</span><span class="builtintype" id="2601364">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601370">flags</span>&nbsp;<span class="builtintype" id="2601376">uint16</span><br>
<span class="lineno"></span><span class="op" id="2601383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2601386">func</span>&nbsp;<span class="ident" id="2601391">SetLsfPromisc</span><span class="op" id="2601404">(</span><span class="ident" id="2601405">name</span>&nbsp;<span class="builtintype" id="2601410">string</span><span class="op" id="2601416">,</span>&nbsp;<span class="ident" id="2601418">m</span>&nbsp;<span class="builtintype" id="2601420">bool</span><span class="op" id="2601424">)</span>&nbsp;<span class="builtintype" id="2601426">error</span>&nbsp;<span class="op" id="2601432">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601435">s</span><span class="op" id="2601436">,</span>&nbsp;<span class="ident" id="2601438">e</span>&nbsp;<span class="op" id="2601440">:=</span>&nbsp;<span class="ident" id="2601443">Socket</span><span class="op" id="2601449">(</span><span class="ident" id="2601450">AF_INET</span><span class="op" id="2601457">,</span>&nbsp;<span class="ident" id="2601459">SOCK_DGRAM</span><span class="op" id="2601469">,</span>&nbsp;<span class="num" id="2601471">0</span><span class="op" id="2601472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601475">if</span>&nbsp;<span class="ident" id="2601478">e</span>&nbsp;<span class="op" id="2601480">!=</span>&nbsp;<span class="ident" id="2601483">nil</span>&nbsp;<span class="op" id="2601487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601491">return</span>&nbsp;<span class="ident" id="2601498">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601504">defer</span>&nbsp;<span class="ident" id="2601510">Close</span><span class="op" id="2601515">(</span><span class="ident" id="2601516">s</span><span class="op" id="2601517">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601520">var</span>&nbsp;<span class="ident" id="2601524">ifl</span>&nbsp;<span class="ident" id="2601528">iflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2601536">copy</span><span class="op" id="2601540">(</span><span class="ident" id="2601541">ifl</span><span class="op" id="2601544">.</span><span class="ident" id="2601545">name</span><span class="op" id="2601549">[</span><span class="op" id="2601550">:</span><span class="op" id="2601551">]</span><span class="op" id="2601552">,</span>&nbsp;<span class="op" id="2601554">[</span><span class="op" id="2601555">]</span><span class="builtintype" id="2601556">byte</span><span class="op" id="2601560">(</span><span class="ident" id="2601561">name</span><span class="op" id="2601565">)</span><span class="op" id="2601566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601569">_</span><span class="op" id="2601570">,</span>&nbsp;<span class="ident" id="2601572">_</span><span class="op" id="2601573">,</span>&nbsp;<span class="ident" id="2601575">ep</span>&nbsp;<span class="op" id="2601578">:=</span>&nbsp;<span class="ident" id="2601581">Syscall</span><span class="op" id="2601588">(</span><span class="ident" id="2601589">SYS_IOCTL</span><span class="op" id="2601598">,</span>&nbsp;<span class="builtintype" id="2601600">uintptr</span><span class="op" id="2601607">(</span><span class="ident" id="2601608">s</span><span class="op" id="2601609">)</span><span class="op" id="2601610">,</span>&nbsp;<span class="ident" id="2601612">SIOCGIFFLAGS</span><span class="op" id="2601624">,</span>&nbsp;<span class="builtintype" id="2601626">uintptr</span><span class="op" id="2601633">(</span><span class="ident" id="2601634">unsafe</span><span class="op" id="2601640">.</span><span class="ident" id="2601641">Pointer</span><span class="op" id="2601648">(</span><span class="op" id="2601649">&amp;</span><span class="ident" id="2601650">ifl</span><span class="op" id="2601653">)</span><span class="op" id="2601654">)</span><span class="op" id="2601655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601658">if</span>&nbsp;<span class="ident" id="2601661">ep</span>&nbsp;<span class="op" id="2601664">!=</span>&nbsp;<span class="num" id="2601667">0</span>&nbsp;<span class="op" id="2601669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601673">return</span>&nbsp;<span class="ident" id="2601680">Errno</span><span class="op" id="2601685">(</span><span class="ident" id="2601686">ep</span><span class="op" id="2601688">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601694">if</span>&nbsp;<span class="ident" id="2601697">m</span>&nbsp;<span class="op" id="2601699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601703">ifl</span><span class="op" id="2601706">.</span><span class="ident" id="2601707">flags</span>&nbsp;<span class="op" id="2601713">|=</span>&nbsp;<span class="builtintype" id="2601716">uint16</span><span class="op" id="2601722">(</span><span class="ident" id="2601723">IFF_PROMISC</span><span class="op" id="2601734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601737">}</span>&nbsp;<span class="keyword" id="2601739">else</span>&nbsp;<span class="op" id="2601744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601748">ifl</span><span class="op" id="2601751">.</span><span class="ident" id="2601752">flags</span>&nbsp;<span class="op" id="2601758">&amp;=</span>&nbsp;<span class="op" id="2601761">^</span><span class="builtintype" id="2601762">uint16</span><span class="op" id="2601768">(</span><span class="ident" id="2601769">IFF_PROMISC</span><span class="op" id="2601780">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601786">_</span><span class="op" id="2601787">,</span>&nbsp;<span class="ident" id="2601789">_</span><span class="op" id="2601790">,</span>&nbsp;<span class="ident" id="2601792">ep</span>&nbsp;<span class="op" id="2601795">=</span>&nbsp;<span class="ident" id="2601797">Syscall</span><span class="op" id="2601804">(</span><span class="ident" id="2601805">SYS_IOCTL</span><span class="op" id="2601814">,</span>&nbsp;<span class="builtintype" id="2601816">uintptr</span><span class="op" id="2601823">(</span><span class="ident" id="2601824">s</span><span class="op" id="2601825">)</span><span class="op" id="2601826">,</span>&nbsp;<span class="ident" id="2601828">SIOCSIFFLAGS</span><span class="op" id="2601840">,</span>&nbsp;<span class="builtintype" id="2601842">uintptr</span><span class="op" id="2601849">(</span><span class="ident" id="2601850">unsafe</span><span class="op" id="2601856">.</span><span class="ident" id="2601857">Pointer</span><span class="op" id="2601864">(</span><span class="op" id="2601865">&amp;</span><span class="ident" id="2601866">ifl</span><span class="op" id="2601869">)</span><span class="op" id="2601870">)</span><span class="op" id="2601871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601874">if</span>&nbsp;<span class="ident" id="2601877">ep</span>&nbsp;<span class="op" id="2601880">!=</span>&nbsp;<span class="num" id="2601883">0</span>&nbsp;<span class="op" id="2601885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601889">return</span>&nbsp;<span class="ident" id="2601896">Errno</span><span class="op" id="2601901">(</span><span class="ident" id="2601902">ep</span><span class="op" id="2601904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2601907">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601910">return</span>&nbsp;<span class="ident" id="2601917">nil</span><br>
<span class="lineno"></span><span class="op" id="2601921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2601924">func</span>&nbsp;<span class="ident" id="2601929">AttachLsf</span><span class="op" id="2601938">(</span><span class="ident" id="2601939">fd</span>&nbsp;<span class="builtintype" id="2601942">int</span><span class="op" id="2601945">,</span>&nbsp;<span class="ident" id="2601947">i</span>&nbsp;<span class="op" id="2601949">[</span><span class="op" id="2601950">]</span><span class="ident" id="2601951">SockFilter</span><span class="op" id="2601961">)</span>&nbsp;<span class="builtintype" id="2601963">error</span>&nbsp;<span class="op" id="2601969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2601972">var</span>&nbsp;<span class="ident" id="2601976">p</span>&nbsp;<span class="ident" id="2601978">SockFprog</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2601989">p</span><span class="op" id="2601990">.</span><span class="ident" id="2601991">Len</span>&nbsp;<span class="op" id="2601995">=</span>&nbsp;<span class="builtintype" id="2601997">uint16</span><span class="op" id="2602003">(</span><span class="builtinfunc" id="2602004">len</span><span class="op" id="2602007">(</span><span class="ident" id="2602008">i</span><span class="op" id="2602009">)</span><span class="op" id="2602010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2602013">p</span><span class="op" id="2602014">.</span><span class="ident" id="2602015">Filter</span>&nbsp;<span class="op" id="2602022">=</span>&nbsp;<span class="op" id="2602024">(</span><span class="op" id="2602025">*</span><span class="ident" id="2602026">SockFilter</span><span class="op" id="2602036">)</span><span class="op" id="2602037">(</span><span class="ident" id="2602038">unsafe</span><span class="op" id="2602044">.</span><span class="ident" id="2602045">Pointer</span><span class="op" id="2602052">(</span><span class="op" id="2602053">&amp;</span><span class="ident" id="2602054">i</span><span class="op" id="2602055">[</span><span class="num" id="2602056">0</span><span class="op" id="2602057">]</span><span class="op" id="2602058">)</span><span class="op" id="2602059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2602062">return</span>&nbsp;<span class="ident" id="2602069">setsockopt</span><span class="op" id="2602079">(</span><span class="ident" id="2602080">fd</span><span class="op" id="2602082">,</span>&nbsp;<span class="ident" id="2602084">SOL_SOCKET</span><span class="op" id="2602094">,</span>&nbsp;<span class="ident" id="2602096">SO_ATTACH_FILTER</span><span class="op" id="2602112">,</span>&nbsp;<span class="ident" id="2602114">unsafe</span><span class="op" id="2602120">.</span><span class="ident" id="2602121">Pointer</span><span class="op" id="2602128">(</span><span class="op" id="2602129">&amp;</span><span class="ident" id="2602130">p</span><span class="op" id="2602131">)</span><span class="op" id="2602132">,</span>&nbsp;<span class="ident" id="2602134">unsafe</span><span class="op" id="2602140">.</span><span class="ident" id="2602141">Sizeof</span><span class="op" id="2602147">(</span><span class="ident" id="2602148">p</span><span class="op" id="2602149">)</span><span class="op" id="2602150">)</span><br>
<span class="lineno"></span><span class="op" id="2602152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2602155">func</span>&nbsp;<span class="ident" id="2602160">DetachLsf</span><span class="op" id="2602169">(</span><span class="ident" id="2602170">fd</span>&nbsp;<span class="builtintype" id="2602173">int</span><span class="op" id="2602176">)</span>&nbsp;<span class="builtintype" id="2602178">error</span>&nbsp;<span class="op" id="2602184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2602187">var</span>&nbsp;<span class="ident" id="2602191">dummy</span>&nbsp;<span class="builtintype" id="2602197">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2602202">return</span>&nbsp;<span class="ident" id="2602209">setsockopt</span><span class="op" id="2602219">(</span><span class="ident" id="2602220">fd</span><span class="op" id="2602222">,</span>&nbsp;<span class="ident" id="2602224">SOL_SOCKET</span><span class="op" id="2602234">,</span>&nbsp;<span class="ident" id="2602236">SO_DETACH_FILTER</span><span class="op" id="2602252">,</span>&nbsp;<span class="ident" id="2602254">unsafe</span><span class="op" id="2602260">.</span><span class="ident" id="2602261">Pointer</span><span class="op" id="2602268">(</span><span class="op" id="2602269">&amp;</span><span class="ident" id="2602270">dummy</span><span class="op" id="2602275">)</span><span class="op" id="2602276">,</span>&nbsp;<span class="ident" id="2602278">unsafe</span><span class="op" id="2602284">.</span><span class="ident" id="2602285">Sizeof</span><span class="op" id="2602291">(</span><span class="ident" id="2602292">dummy</span><span class="op" id="2602297">)</span><span class="op" id="2602298">)</span><br>
<span class="lineno"></span><span class="op" id="2602300">}</span>
</div>
</body>
</html>
