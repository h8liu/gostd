<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6711709">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6711764">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6711818">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6711869">package</span>&nbsp;<span class="ident" id="6711877">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6711882">import</span>&nbsp;<span class="op" id="6711889">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6711892">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6711899">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6711905">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6711918">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6711929">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6711940">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6711947">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6711950">func</span>&nbsp;<span class="ident" id="6711955">isTimeout</span><span class="op" id="6711964">(</span><span class="ident" id="6711965">err</span>&nbsp;<span class="builtintype" id="6711969">error</span><span class="op" id="6711974">)</span>&nbsp;<span class="builtintype" id="6711976">bool</span>&nbsp;<span class="op" id="6711981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711984">e</span><span class="op" id="6711985">,</span>&nbsp;<span class="ident" id="6711987">ok</span>&nbsp;<span class="op" id="6711990">:=</span>&nbsp;<span class="ident" id="6711993">err</span><span class="op" id="6711996">.</span><span class="op" id="6711997">(</span><span class="ident" id="6711998">Error</span><span class="op" id="6712003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712006">return</span>&nbsp;<span class="ident" id="6712013">ok</span>&nbsp;<span class="op" id="6712016">&amp;&amp;</span>&nbsp;<span class="ident" id="6712019">e</span><span class="op" id="6712020">.</span><span class="ident" id="6712021">Timeout</span><span class="op" id="6712028">(</span><span class="op" id="6712029">)</span><br>
<span class="lineno"></span><span class="op" id="6712031">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6712034">type</span>&nbsp;<span class="ident" id="6712039">copyRes</span>&nbsp;<span class="keyword" id="6712047">struct</span>&nbsp;<span class="op" id="6712054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712057">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6712061">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712068">err</span>&nbsp;<span class="builtintype" id="6712072">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712079">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6712083">time</span><span class="op" id="6712087">.</span><span class="ident" id="6712088">Duration</span><br>
<span class="lineno">25</span><span class="op" id="6712097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6712100">func</span>&nbsp;<span class="ident" id="6712105">TestAcceptTimeout</span><span class="op" id="6712122">(</span><span class="ident" id="6712123">t</span>&nbsp;<span class="op" id="6712125">*</span><span class="ident" id="6712126">testing</span><span class="op" id="6712133">.</span><span class="ident" id="6712134">T</span><span class="op" id="6712135">)</span>&nbsp;<span class="op" id="6712137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712140">switch</span>&nbsp;<span class="ident" id="6712147">runtime</span><span class="op" id="6712154">.</span><span class="ident" id="6712155">GOOS</span>&nbsp;<span class="op" id="6712160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712163">case</span>&nbsp;<span class="string" id="6712168">&#34;plan9&#34;</span><span class="op" id="6712175">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712179">t</span><span class="op" id="6712180">.</span><span class="ident" id="6712181">Skipf</span><span class="op" id="6712186">(</span><span class="string" id="6712187">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6712208">,</span>&nbsp;<span class="ident" id="6712210">runtime</span><span class="op" id="6712217">.</span><span class="ident" id="6712218">GOOS</span><span class="op" id="6712222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712229">ln</span>&nbsp;<span class="op" id="6712232">:=</span>&nbsp;<span class="ident" id="6712235">newLocalListener</span><span class="op" id="6712251">(</span><span class="ident" id="6712252">t</span><span class="op" id="6712253">)</span><span class="op" id="6712254">.</span><span class="op" id="6712255">(</span><span class="op" id="6712256">*</span><span class="ident" id="6712257">TCPListener</span><span class="op" id="6712268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712271">defer</span>&nbsp;<span class="ident" id="6712277">ln</span><span class="op" id="6712279">.</span><span class="ident" id="6712280">Close</span><span class="op" id="6712285">(</span><span class="op" id="6712286">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712289">ln</span><span class="op" id="6712291">.</span><span class="ident" id="6712292">SetDeadline</span><span class="op" id="6712303">(</span><span class="ident" id="6712304">time</span><span class="op" id="6712308">.</span><span class="ident" id="6712309">Now</span><span class="op" id="6712312">(</span><span class="op" id="6712313">)</span><span class="op" id="6712314">.</span><span class="ident" id="6712315">Add</span><span class="op" id="6712318">(</span><span class="op" id="6712319">-</span><span class="num" id="6712320">1</span>&nbsp;<span class="op" id="6712322">*</span>&nbsp;<span class="ident" id="6712324">time</span><span class="op" id="6712328">.</span><span class="ident" id="6712329">Second</span><span class="op" id="6712335">)</span><span class="op" id="6712336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712339">if</span>&nbsp;<span class="ident" id="6712342">_</span><span class="op" id="6712343">,</span>&nbsp;<span class="ident" id="6712345">err</span>&nbsp;<span class="op" id="6712349">:=</span>&nbsp;<span class="ident" id="6712352">ln</span><span class="op" id="6712354">.</span><span class="ident" id="6712355">Accept</span><span class="op" id="6712361">(</span><span class="op" id="6712362">)</span><span class="op" id="6712363">;</span>&nbsp;<span class="op" id="6712365">!</span><span class="ident" id="6712366">isTimeout</span><span class="op" id="6712375">(</span><span class="ident" id="6712376">err</span><span class="op" id="6712379">)</span>&nbsp;<span class="op" id="6712381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712385">t</span><span class="op" id="6712386">.</span><span class="ident" id="6712387">Fatalf</span><span class="op" id="6712393">(</span><span class="string" id="6712394">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6712427">,</span>&nbsp;<span class="ident" id="6712429">errTimeout</span><span class="op" id="6712439">,</span>&nbsp;<span class="ident" id="6712441">err</span><span class="op" id="6712444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712450">if</span>&nbsp;<span class="ident" id="6712453">_</span><span class="op" id="6712454">,</span>&nbsp;<span class="ident" id="6712456">err</span>&nbsp;<span class="op" id="6712460">:=</span>&nbsp;<span class="ident" id="6712463">ln</span><span class="op" id="6712465">.</span><span class="ident" id="6712466">Accept</span><span class="op" id="6712472">(</span><span class="op" id="6712473">)</span><span class="op" id="6712474">;</span>&nbsp;<span class="op" id="6712476">!</span><span class="ident" id="6712477">isTimeout</span><span class="op" id="6712486">(</span><span class="ident" id="6712487">err</span><span class="op" id="6712490">)</span>&nbsp;<span class="op" id="6712492">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712496">t</span><span class="op" id="6712497">.</span><span class="ident" id="6712498">Fatalf</span><span class="op" id="6712504">(</span><span class="string" id="6712505">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6712538">,</span>&nbsp;<span class="ident" id="6712540">errTimeout</span><span class="op" id="6712550">,</span>&nbsp;<span class="ident" id="6712552">err</span><span class="op" id="6712555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712561">ln</span><span class="op" id="6712563">.</span><span class="ident" id="6712564">SetDeadline</span><span class="op" id="6712575">(</span><span class="ident" id="6712576">time</span><span class="op" id="6712580">.</span><span class="ident" id="6712581">Now</span><span class="op" id="6712584">(</span><span class="op" id="6712585">)</span><span class="op" id="6712586">.</span><span class="ident" id="6712587">Add</span><span class="op" id="6712590">(</span><span class="num" id="6712591">100</span>&nbsp;<span class="op" id="6712595">*</span>&nbsp;<span class="ident" id="6712597">time</span><span class="op" id="6712601">.</span><span class="ident" id="6712602">Millisecond</span><span class="op" id="6712613">)</span><span class="op" id="6712614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712617">if</span>&nbsp;<span class="ident" id="6712620">_</span><span class="op" id="6712621">,</span>&nbsp;<span class="ident" id="6712623">err</span>&nbsp;<span class="op" id="6712627">:=</span>&nbsp;<span class="ident" id="6712630">ln</span><span class="op" id="6712632">.</span><span class="ident" id="6712633">Accept</span><span class="op" id="6712639">(</span><span class="op" id="6712640">)</span><span class="op" id="6712641">;</span>&nbsp;<span class="op" id="6712643">!</span><span class="ident" id="6712644">isTimeout</span><span class="op" id="6712653">(</span><span class="ident" id="6712654">err</span><span class="op" id="6712657">)</span>&nbsp;<span class="op" id="6712659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712663">t</span><span class="op" id="6712664">.</span><span class="ident" id="6712665">Fatalf</span><span class="op" id="6712671">(</span><span class="string" id="6712672">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6712705">,</span>&nbsp;<span class="ident" id="6712707">errTimeout</span><span class="op" id="6712717">,</span>&nbsp;<span class="ident" id="6712719">err</span><span class="op" id="6712722">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712728">if</span>&nbsp;<span class="ident" id="6712731">_</span><span class="op" id="6712732">,</span>&nbsp;<span class="ident" id="6712734">err</span>&nbsp;<span class="op" id="6712738">:=</span>&nbsp;<span class="ident" id="6712741">ln</span><span class="op" id="6712743">.</span><span class="ident" id="6712744">Accept</span><span class="op" id="6712750">(</span><span class="op" id="6712751">)</span><span class="op" id="6712752">;</span>&nbsp;<span class="op" id="6712754">!</span><span class="ident" id="6712755">isTimeout</span><span class="op" id="6712764">(</span><span class="ident" id="6712765">err</span><span class="op" id="6712768">)</span>&nbsp;<span class="op" id="6712770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712774">t</span><span class="op" id="6712775">.</span><span class="ident" id="6712776">Fatalf</span><span class="op" id="6712782">(</span><span class="string" id="6712783">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6712816">,</span>&nbsp;<span class="ident" id="6712818">errTimeout</span><span class="op" id="6712828">,</span>&nbsp;<span class="ident" id="6712830">err</span><span class="op" id="6712833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712839">ln</span><span class="op" id="6712841">.</span><span class="ident" id="6712842">SetDeadline</span><span class="op" id="6712853">(</span><span class="ident" id="6712854">noDeadline</span><span class="op" id="6712864">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712867">errc</span>&nbsp;<span class="op" id="6712872">:=</span>&nbsp;<span class="builtinfunc" id="6712875">make</span><span class="op" id="6712879">(</span><span class="keyword" id="6712880">chan</span>&nbsp;<span class="builtintype" id="6712885">error</span><span class="op" id="6712890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712893">go</span>&nbsp;<span class="keyword" id="6712896">func</span><span class="op" id="6712900">(</span><span class="op" id="6712901">)</span>&nbsp;<span class="op" id="6712903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712907">_</span><span class="op" id="6712908">,</span>&nbsp;<span class="ident" id="6712910">err</span>&nbsp;<span class="op" id="6712914">:=</span>&nbsp;<span class="ident" id="6712917">ln</span><span class="op" id="6712919">.</span><span class="ident" id="6712920">Accept</span><span class="op" id="6712926">(</span><span class="op" id="6712927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712931">errc</span>&nbsp;<span class="op" id="6712936">&lt;-</span>&nbsp;<span class="ident" id="6712939">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712944">}</span><span class="op" id="6712945">(</span><span class="op" id="6712946">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712949">time</span><span class="op" id="6712953">.</span><span class="ident" id="6712954">Sleep</span><span class="op" id="6712959">(</span><span class="num" id="6712960">100</span>&nbsp;<span class="op" id="6712964">*</span>&nbsp;<span class="ident" id="6712966">time</span><span class="op" id="6712970">.</span><span class="ident" id="6712971">Millisecond</span><span class="op" id="6712982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712985">select</span>&nbsp;<span class="op" id="6712992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712995">case</span>&nbsp;<span class="ident" id="6713000">err</span>&nbsp;<span class="op" id="6713004">:=</span>&nbsp;<span class="op" id="6713007">&lt;-</span><span class="ident" id="6713009">errc</span><span class="op" id="6713013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713017">t</span><span class="op" id="6713018">.</span><span class="ident" id="6713019">Fatalf</span><span class="op" id="6713025">(</span><span class="string" id="6713026">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6713086">,</span>&nbsp;<span class="ident" id="6713088">err</span><span class="op" id="6713091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713094">default</span><span class="op" id="6713101">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713107">ln</span><span class="op" id="6713109">.</span><span class="ident" id="6713110">Close</span><span class="op" id="6713115">(</span><span class="op" id="6713116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713119">switch</span>&nbsp;<span class="ident" id="6713126">nerr</span>&nbsp;<span class="op" id="6713131">:=</span>&nbsp;<span class="op" id="6713134">&lt;-</span><span class="ident" id="6713136">errc</span><span class="op" id="6713140">;</span>&nbsp;<span class="ident" id="6713142">err</span>&nbsp;<span class="op" id="6713146">:=</span>&nbsp;<span class="ident" id="6713149">nerr</span><span class="op" id="6713153">.</span><span class="op" id="6713154">(</span><span class="keyword" id="6713155">type</span><span class="op" id="6713159">)</span>&nbsp;<span class="op" id="6713161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713164">case</span>&nbsp;<span class="op" id="6713169">*</span><span class="ident" id="6713170">OpError</span><span class="op" id="6713177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713181">if</span>&nbsp;<span class="ident" id="6713184">err</span><span class="op" id="6713187">.</span><span class="ident" id="6713188">Err</span>&nbsp;<span class="op" id="6713192">!=</span>&nbsp;<span class="ident" id="6713195">errClosing</span>&nbsp;<span class="op" id="6713206">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713211">t</span><span class="op" id="6713212">.</span><span class="ident" id="6713213">Fatalf</span><span class="op" id="6713219">(</span><span class="string" id="6713220">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6713253">,</span>&nbsp;<span class="ident" id="6713255">errClosing</span><span class="op" id="6713265">,</span>&nbsp;<span class="ident" id="6713267">err</span><span class="op" id="6713270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713277">default</span><span class="op" id="6713284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713288">if</span>&nbsp;<span class="ident" id="6713291">err</span>&nbsp;<span class="op" id="6713295">!=</span>&nbsp;<span class="ident" id="6713298">errClosing</span>&nbsp;<span class="op" id="6713309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713314">t</span><span class="op" id="6713315">.</span><span class="ident" id="6713316">Fatalf</span><span class="op" id="6713322">(</span><span class="string" id="6713323">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6713356">,</span>&nbsp;<span class="ident" id="6713358">errClosing</span><span class="op" id="6713368">,</span>&nbsp;<span class="ident" id="6713370">err</span><span class="op" id="6713373">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713380">}</span><br>
<span class="lineno"></span><span class="op" id="6713382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6713385">func</span>&nbsp;<span class="ident" id="6713390">TestReadTimeout</span><span class="op" id="6713405">(</span><span class="ident" id="6713406">t</span>&nbsp;<span class="op" id="6713408">*</span><span class="ident" id="6713409">testing</span><span class="op" id="6713416">.</span><span class="ident" id="6713417">T</span><span class="op" id="6713418">)</span>&nbsp;<span class="op" id="6713420">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713423">switch</span>&nbsp;<span class="ident" id="6713430">runtime</span><span class="op" id="6713437">.</span><span class="ident" id="6713438">GOOS</span>&nbsp;<span class="op" id="6713443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713446">case</span>&nbsp;<span class="string" id="6713451">&#34;plan9&#34;</span><span class="op" id="6713458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713462">t</span><span class="op" id="6713463">.</span><span class="ident" id="6713464">Skipf</span><span class="op" id="6713469">(</span><span class="string" id="6713470">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6713491">,</span>&nbsp;<span class="ident" id="6713493">runtime</span><span class="op" id="6713500">.</span><span class="ident" id="6713501">GOOS</span><span class="op" id="6713505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713512">ln</span>&nbsp;<span class="op" id="6713515">:=</span>&nbsp;<span class="ident" id="6713518">newLocalListener</span><span class="op" id="6713534">(</span><span class="ident" id="6713535">t</span><span class="op" id="6713536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713539">defer</span>&nbsp;<span class="ident" id="6713545">ln</span><span class="op" id="6713547">.</span><span class="ident" id="6713548">Close</span><span class="op" id="6713553">(</span><span class="op" id="6713554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713557">c</span><span class="op" id="6713558">,</span>&nbsp;<span class="ident" id="6713560">err</span>&nbsp;<span class="op" id="6713564">:=</span>&nbsp;<span class="ident" id="6713567">DialTCP</span><span class="op" id="6713574">(</span><span class="string" id="6713575">&#34;tcp&#34;</span><span class="op" id="6713580">,</span>&nbsp;<span class="ident" id="6713582">nil</span><span class="op" id="6713585">,</span>&nbsp;<span class="ident" id="6713587">ln</span><span class="op" id="6713589">.</span><span class="ident" id="6713590">Addr</span><span class="op" id="6713594">(</span><span class="op" id="6713595">)</span><span class="op" id="6713596">.</span><span class="op" id="6713597">(</span><span class="op" id="6713598">*</span><span class="ident" id="6713599">TCPAddr</span><span class="op" id="6713606">)</span><span class="op" id="6713607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713610">if</span>&nbsp;<span class="ident" id="6713613">err</span>&nbsp;<span class="op" id="6713617">!=</span>&nbsp;<span class="ident" id="6713620">nil</span>&nbsp;<span class="op" id="6713624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713628">t</span><span class="op" id="6713629">.</span><span class="ident" id="6713630">Fatalf</span><span class="op" id="6713636">(</span><span class="string" id="6713637">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6713650">,</span>&nbsp;<span class="ident" id="6713652">err</span><span class="op" id="6713655">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713661">defer</span>&nbsp;<span class="ident" id="6713667">c</span><span class="op" id="6713668">.</span><span class="ident" id="6713669">Close</span><span class="op" id="6713674">(</span><span class="op" id="6713675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713678">c</span><span class="op" id="6713679">.</span><span class="ident" id="6713680">SetDeadline</span><span class="op" id="6713691">(</span><span class="ident" id="6713692">time</span><span class="op" id="6713696">.</span><span class="ident" id="6713697">Now</span><span class="op" id="6713700">(</span><span class="op" id="6713701">)</span><span class="op" id="6713702">.</span><span class="ident" id="6713703">Add</span><span class="op" id="6713706">(</span><span class="ident" id="6713707">time</span><span class="op" id="6713711">.</span><span class="ident" id="6713712">Hour</span><span class="op" id="6713716">)</span><span class="op" id="6713717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713720">c</span><span class="op" id="6713721">.</span><span class="ident" id="6713722">SetReadDeadline</span><span class="op" id="6713737">(</span><span class="ident" id="6713738">time</span><span class="op" id="6713742">.</span><span class="ident" id="6713743">Now</span><span class="op" id="6713746">(</span><span class="op" id="6713747">)</span><span class="op" id="6713748">.</span><span class="ident" id="6713749">Add</span><span class="op" id="6713752">(</span><span class="op" id="6713753">-</span><span class="num" id="6713754">1</span>&nbsp;<span class="op" id="6713756">*</span>&nbsp;<span class="ident" id="6713758">time</span><span class="op" id="6713762">.</span><span class="ident" id="6713763">Second</span><span class="op" id="6713769">)</span><span class="op" id="6713770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713773">buf</span>&nbsp;<span class="op" id="6713777">:=</span>&nbsp;<span class="builtinfunc" id="6713780">make</span><span class="op" id="6713784">(</span><span class="op" id="6713785">[</span><span class="op" id="6713786">]</span><span class="builtintype" id="6713787">byte</span><span class="op" id="6713791">,</span>&nbsp;<span class="num" id="6713793">1</span><span class="op" id="6713794">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713797">if</span>&nbsp;<span class="ident" id="6713800">_</span><span class="op" id="6713801">,</span>&nbsp;<span class="ident" id="6713803">err</span>&nbsp;<span class="op" id="6713807">=</span>&nbsp;<span class="ident" id="6713809">c</span><span class="op" id="6713810">.</span><span class="ident" id="6713811">Read</span><span class="op" id="6713815">(</span><span class="ident" id="6713816">buf</span><span class="op" id="6713819">)</span><span class="op" id="6713820">;</span>&nbsp;<span class="op" id="6713822">!</span><span class="ident" id="6713823">isTimeout</span><span class="op" id="6713832">(</span><span class="ident" id="6713833">err</span><span class="op" id="6713836">)</span>&nbsp;<span class="op" id="6713838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713842">t</span><span class="op" id="6713843">.</span><span class="ident" id="6713844">Fatalf</span><span class="op" id="6713850">(</span><span class="string" id="6713851">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6713882">,</span>&nbsp;<span class="ident" id="6713884">errTimeout</span><span class="op" id="6713894">,</span>&nbsp;<span class="ident" id="6713896">err</span><span class="op" id="6713899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713905">if</span>&nbsp;<span class="ident" id="6713908">_</span><span class="op" id="6713909">,</span>&nbsp;<span class="ident" id="6713911">err</span>&nbsp;<span class="op" id="6713915">=</span>&nbsp;<span class="ident" id="6713917">c</span><span class="op" id="6713918">.</span><span class="ident" id="6713919">Read</span><span class="op" id="6713923">(</span><span class="ident" id="6713924">buf</span><span class="op" id="6713927">)</span><span class="op" id="6713928">;</span>&nbsp;<span class="op" id="6713930">!</span><span class="ident" id="6713931">isTimeout</span><span class="op" id="6713940">(</span><span class="ident" id="6713941">err</span><span class="op" id="6713944">)</span>&nbsp;<span class="op" id="6713946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713950">t</span><span class="op" id="6713951">.</span><span class="ident" id="6713952">Fatalf</span><span class="op" id="6713958">(</span><span class="string" id="6713959">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6713990">,</span>&nbsp;<span class="ident" id="6713992">errTimeout</span><span class="op" id="6714002">,</span>&nbsp;<span class="ident" id="6714004">err</span><span class="op" id="6714007">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714013">c</span><span class="op" id="6714014">.</span><span class="ident" id="6714015">SetDeadline</span><span class="op" id="6714026">(</span><span class="ident" id="6714027">time</span><span class="op" id="6714031">.</span><span class="ident" id="6714032">Now</span><span class="op" id="6714035">(</span><span class="op" id="6714036">)</span><span class="op" id="6714037">.</span><span class="ident" id="6714038">Add</span><span class="op" id="6714041">(</span><span class="num" id="6714042">100</span>&nbsp;<span class="op" id="6714046">*</span>&nbsp;<span class="ident" id="6714048">time</span><span class="op" id="6714052">.</span><span class="ident" id="6714053">Millisecond</span><span class="op" id="6714064">)</span><span class="op" id="6714065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714068">if</span>&nbsp;<span class="ident" id="6714071">_</span><span class="op" id="6714072">,</span>&nbsp;<span class="ident" id="6714074">err</span>&nbsp;<span class="op" id="6714078">=</span>&nbsp;<span class="ident" id="6714080">c</span><span class="op" id="6714081">.</span><span class="ident" id="6714082">Read</span><span class="op" id="6714086">(</span><span class="ident" id="6714087">buf</span><span class="op" id="6714090">)</span><span class="op" id="6714091">;</span>&nbsp;<span class="op" id="6714093">!</span><span class="ident" id="6714094">isTimeout</span><span class="op" id="6714103">(</span><span class="ident" id="6714104">err</span><span class="op" id="6714107">)</span>&nbsp;<span class="op" id="6714109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714113">t</span><span class="op" id="6714114">.</span><span class="ident" id="6714115">Fatalf</span><span class="op" id="6714121">(</span><span class="string" id="6714122">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6714153">,</span>&nbsp;<span class="ident" id="6714155">errTimeout</span><span class="op" id="6714165">,</span>&nbsp;<span class="ident" id="6714167">err</span><span class="op" id="6714170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714173">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714176">if</span>&nbsp;<span class="ident" id="6714179">_</span><span class="op" id="6714180">,</span>&nbsp;<span class="ident" id="6714182">err</span>&nbsp;<span class="op" id="6714186">=</span>&nbsp;<span class="ident" id="6714188">c</span><span class="op" id="6714189">.</span><span class="ident" id="6714190">Read</span><span class="op" id="6714194">(</span><span class="ident" id="6714195">buf</span><span class="op" id="6714198">)</span><span class="op" id="6714199">;</span>&nbsp;<span class="op" id="6714201">!</span><span class="ident" id="6714202">isTimeout</span><span class="op" id="6714211">(</span><span class="ident" id="6714212">err</span><span class="op" id="6714215">)</span>&nbsp;<span class="op" id="6714217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714221">t</span><span class="op" id="6714222">.</span><span class="ident" id="6714223">Fatalf</span><span class="op" id="6714229">(</span><span class="string" id="6714230">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6714261">,</span>&nbsp;<span class="ident" id="6714263">errTimeout</span><span class="op" id="6714273">,</span>&nbsp;<span class="ident" id="6714275">err</span><span class="op" id="6714278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714284">c</span><span class="op" id="6714285">.</span><span class="ident" id="6714286">SetReadDeadline</span><span class="op" id="6714301">(</span><span class="ident" id="6714302">noDeadline</span><span class="op" id="6714312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714315">c</span><span class="op" id="6714316">.</span><span class="ident" id="6714317">SetWriteDeadline</span><span class="op" id="6714333">(</span><span class="ident" id="6714334">time</span><span class="op" id="6714338">.</span><span class="ident" id="6714339">Now</span><span class="op" id="6714342">(</span><span class="op" id="6714343">)</span><span class="op" id="6714344">.</span><span class="ident" id="6714345">Add</span><span class="op" id="6714348">(</span><span class="op" id="6714349">-</span><span class="num" id="6714350">1</span>&nbsp;<span class="op" id="6714352">*</span>&nbsp;<span class="ident" id="6714354">time</span><span class="op" id="6714358">.</span><span class="ident" id="6714359">Second</span><span class="op" id="6714365">)</span><span class="op" id="6714366">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714369">errc</span>&nbsp;<span class="op" id="6714374">:=</span>&nbsp;<span class="builtinfunc" id="6714377">make</span><span class="op" id="6714381">(</span><span class="keyword" id="6714382">chan</span>&nbsp;<span class="builtintype" id="6714387">error</span><span class="op" id="6714392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714395">go</span>&nbsp;<span class="keyword" id="6714398">func</span><span class="op" id="6714402">(</span><span class="op" id="6714403">)</span>&nbsp;<span class="op" id="6714405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714409">_</span><span class="op" id="6714410">,</span>&nbsp;<span class="ident" id="6714412">err</span>&nbsp;<span class="op" id="6714416">:=</span>&nbsp;<span class="ident" id="6714419">c</span><span class="op" id="6714420">.</span><span class="ident" id="6714421">Read</span><span class="op" id="6714425">(</span><span class="ident" id="6714426">buf</span><span class="op" id="6714429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714433">errc</span>&nbsp;<span class="op" id="6714438">&lt;-</span>&nbsp;<span class="ident" id="6714441">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714446">}</span><span class="op" id="6714447">(</span><span class="op" id="6714448">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714451">time</span><span class="op" id="6714455">.</span><span class="ident" id="6714456">Sleep</span><span class="op" id="6714461">(</span><span class="num" id="6714462">100</span>&nbsp;<span class="op" id="6714466">*</span>&nbsp;<span class="ident" id="6714468">time</span><span class="op" id="6714472">.</span><span class="ident" id="6714473">Millisecond</span><span class="op" id="6714484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714487">select</span>&nbsp;<span class="op" id="6714494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714497">case</span>&nbsp;<span class="ident" id="6714502">err</span>&nbsp;<span class="op" id="6714506">:=</span>&nbsp;<span class="op" id="6714509">&lt;-</span><span class="ident" id="6714511">errc</span><span class="op" id="6714515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714519">t</span><span class="op" id="6714520">.</span><span class="ident" id="6714521">Fatalf</span><span class="op" id="6714527">(</span><span class="string" id="6714528">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6714586">,</span>&nbsp;<span class="ident" id="6714588">err</span><span class="op" id="6714591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714594">default</span><span class="op" id="6714601">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714607">c</span><span class="op" id="6714608">.</span><span class="ident" id="6714609">Close</span><span class="op" id="6714614">(</span><span class="op" id="6714615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714618">switch</span>&nbsp;<span class="ident" id="6714625">nerr</span>&nbsp;<span class="op" id="6714630">:=</span>&nbsp;<span class="op" id="6714633">&lt;-</span><span class="ident" id="6714635">errc</span><span class="op" id="6714639">;</span>&nbsp;<span class="ident" id="6714641">err</span>&nbsp;<span class="op" id="6714645">:=</span>&nbsp;<span class="ident" id="6714648">nerr</span><span class="op" id="6714652">.</span><span class="op" id="6714653">(</span><span class="keyword" id="6714654">type</span><span class="op" id="6714658">)</span>&nbsp;<span class="op" id="6714660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714663">case</span>&nbsp;<span class="op" id="6714668">*</span><span class="ident" id="6714669">OpError</span><span class="op" id="6714676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714680">if</span>&nbsp;<span class="ident" id="6714683">err</span><span class="op" id="6714686">.</span><span class="ident" id="6714687">Err</span>&nbsp;<span class="op" id="6714691">!=</span>&nbsp;<span class="ident" id="6714694">errClosing</span>&nbsp;<span class="op" id="6714705">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714710">t</span><span class="op" id="6714711">.</span><span class="ident" id="6714712">Fatalf</span><span class="op" id="6714718">(</span><span class="string" id="6714719">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6714750">,</span>&nbsp;<span class="ident" id="6714752">errClosing</span><span class="op" id="6714762">,</span>&nbsp;<span class="ident" id="6714764">err</span><span class="op" id="6714767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714774">default</span><span class="op" id="6714781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714785">if</span>&nbsp;<span class="ident" id="6714788">err</span>&nbsp;<span class="op" id="6714792">==</span>&nbsp;<span class="ident" id="6714795">io</span><span class="op" id="6714797">.</span><span class="ident" id="6714798">EOF</span>&nbsp;<span class="op" id="6714802">&amp;&amp;</span>&nbsp;<span class="ident" id="6714805">runtime</span><span class="op" id="6714812">.</span><span class="ident" id="6714813">GOOS</span>&nbsp;<span class="op" id="6714818">==</span>&nbsp;<span class="string" id="6714821">&#34;nacl&#34;</span>&nbsp;<span class="op" id="6714828">{</span>&nbsp;<span class="comment" id="6714830">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714872">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714884">if</span>&nbsp;<span class="ident" id="6714887">err</span>&nbsp;<span class="op" id="6714891">!=</span>&nbsp;<span class="ident" id="6714894">errClosing</span>&nbsp;<span class="op" id="6714905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714910">t</span><span class="op" id="6714911">.</span><span class="ident" id="6714912">Fatalf</span><span class="op" id="6714918">(</span><span class="string" id="6714919">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6714950">,</span>&nbsp;<span class="ident" id="6714952">errClosing</span><span class="op" id="6714962">,</span>&nbsp;<span class="ident" id="6714964">err</span><span class="op" id="6714967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714974">}</span><br>
<span class="lineno">130</span><span class="op" id="6714976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6714979">func</span>&nbsp;<span class="ident" id="6714984">TestWriteTimeout</span><span class="op" id="6715000">(</span><span class="ident" id="6715001">t</span>&nbsp;<span class="op" id="6715003">*</span><span class="ident" id="6715004">testing</span><span class="op" id="6715011">.</span><span class="ident" id="6715012">T</span><span class="op" id="6715013">)</span>&nbsp;<span class="op" id="6715015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715018">switch</span>&nbsp;<span class="ident" id="6715025">runtime</span><span class="op" id="6715032">.</span><span class="ident" id="6715033">GOOS</span>&nbsp;<span class="op" id="6715038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715041">case</span>&nbsp;<span class="string" id="6715046">&#34;plan9&#34;</span><span class="op" id="6715053">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715057">t</span><span class="op" id="6715058">.</span><span class="ident" id="6715059">Skipf</span><span class="op" id="6715064">(</span><span class="string" id="6715065">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6715086">,</span>&nbsp;<span class="ident" id="6715088">runtime</span><span class="op" id="6715095">.</span><span class="ident" id="6715096">GOOS</span><span class="op" id="6715100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715107">ln</span>&nbsp;<span class="op" id="6715110">:=</span>&nbsp;<span class="ident" id="6715113">newLocalListener</span><span class="op" id="6715129">(</span><span class="ident" id="6715130">t</span><span class="op" id="6715131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715134">defer</span>&nbsp;<span class="ident" id="6715140">ln</span><span class="op" id="6715142">.</span><span class="ident" id="6715143">Close</span><span class="op" id="6715148">(</span><span class="op" id="6715149">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715152">c</span><span class="op" id="6715153">,</span>&nbsp;<span class="ident" id="6715155">err</span>&nbsp;<span class="op" id="6715159">:=</span>&nbsp;<span class="ident" id="6715162">DialTCP</span><span class="op" id="6715169">(</span><span class="string" id="6715170">&#34;tcp&#34;</span><span class="op" id="6715175">,</span>&nbsp;<span class="ident" id="6715177">nil</span><span class="op" id="6715180">,</span>&nbsp;<span class="ident" id="6715182">ln</span><span class="op" id="6715184">.</span><span class="ident" id="6715185">Addr</span><span class="op" id="6715189">(</span><span class="op" id="6715190">)</span><span class="op" id="6715191">.</span><span class="op" id="6715192">(</span><span class="op" id="6715193">*</span><span class="ident" id="6715194">TCPAddr</span><span class="op" id="6715201">)</span><span class="op" id="6715202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715205">if</span>&nbsp;<span class="ident" id="6715208">err</span>&nbsp;<span class="op" id="6715212">!=</span>&nbsp;<span class="ident" id="6715215">nil</span>&nbsp;<span class="op" id="6715219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715223">t</span><span class="op" id="6715224">.</span><span class="ident" id="6715225">Fatalf</span><span class="op" id="6715231">(</span><span class="string" id="6715232">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="6715245">,</span>&nbsp;<span class="ident" id="6715247">err</span><span class="op" id="6715250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715256">defer</span>&nbsp;<span class="ident" id="6715262">c</span><span class="op" id="6715263">.</span><span class="ident" id="6715264">Close</span><span class="op" id="6715269">(</span><span class="op" id="6715270">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715273">c</span><span class="op" id="6715274">.</span><span class="ident" id="6715275">SetDeadline</span><span class="op" id="6715286">(</span><span class="ident" id="6715287">time</span><span class="op" id="6715291">.</span><span class="ident" id="6715292">Now</span><span class="op" id="6715295">(</span><span class="op" id="6715296">)</span><span class="op" id="6715297">.</span><span class="ident" id="6715298">Add</span><span class="op" id="6715301">(</span><span class="ident" id="6715302">time</span><span class="op" id="6715306">.</span><span class="ident" id="6715307">Hour</span><span class="op" id="6715311">)</span><span class="op" id="6715312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715315">c</span><span class="op" id="6715316">.</span><span class="ident" id="6715317">SetWriteDeadline</span><span class="op" id="6715333">(</span><span class="ident" id="6715334">time</span><span class="op" id="6715338">.</span><span class="ident" id="6715339">Now</span><span class="op" id="6715342">(</span><span class="op" id="6715343">)</span><span class="op" id="6715344">.</span><span class="ident" id="6715345">Add</span><span class="op" id="6715348">(</span><span class="op" id="6715349">-</span><span class="num" id="6715350">1</span>&nbsp;<span class="op" id="6715352">*</span>&nbsp;<span class="ident" id="6715354">time</span><span class="op" id="6715358">.</span><span class="ident" id="6715359">Second</span><span class="op" id="6715365">)</span><span class="op" id="6715366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715369">buf</span>&nbsp;<span class="op" id="6715373">:=</span>&nbsp;<span class="builtinfunc" id="6715376">make</span><span class="op" id="6715380">(</span><span class="op" id="6715381">[</span><span class="op" id="6715382">]</span><span class="builtintype" id="6715383">byte</span><span class="op" id="6715387">,</span>&nbsp;<span class="num" id="6715389">4096</span><span class="op" id="6715393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715396">writeUntilTimeout</span>&nbsp;<span class="op" id="6715414">:=</span>&nbsp;<span class="keyword" id="6715417">func</span><span class="op" id="6715421">(</span><span class="op" id="6715422">)</span>&nbsp;<span class="op" id="6715424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715428">for</span>&nbsp;<span class="op" id="6715432">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715437">_</span><span class="op" id="6715438">,</span>&nbsp;<span class="ident" id="6715440">err</span>&nbsp;<span class="op" id="6715444">:=</span>&nbsp;<span class="ident" id="6715447">c</span><span class="op" id="6715448">.</span><span class="ident" id="6715449">Write</span><span class="op" id="6715454">(</span><span class="ident" id="6715455">buf</span><span class="op" id="6715458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715463">if</span>&nbsp;<span class="ident" id="6715466">err</span>&nbsp;<span class="op" id="6715470">!=</span>&nbsp;<span class="ident" id="6715473">nil</span>&nbsp;<span class="op" id="6715477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715483">if</span>&nbsp;<span class="ident" id="6715486">isTimeout</span><span class="op" id="6715495">(</span><span class="ident" id="6715496">err</span><span class="op" id="6715499">)</span>&nbsp;<span class="op" id="6715501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715508">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715519">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715525">t</span><span class="op" id="6715526">.</span><span class="ident" id="6715527">Fatalf</span><span class="op" id="6715533">(</span><span class="string" id="6715534">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6715566">,</span>&nbsp;<span class="ident" id="6715568">errTimeout</span><span class="op" id="6715578">,</span>&nbsp;<span class="ident" id="6715580">err</span><span class="op" id="6715583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715598">writeUntilTimeout</span><span class="op" id="6715615">(</span><span class="op" id="6715616">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715619">c</span><span class="op" id="6715620">.</span><span class="ident" id="6715621">SetDeadline</span><span class="op" id="6715632">(</span><span class="ident" id="6715633">time</span><span class="op" id="6715637">.</span><span class="ident" id="6715638">Now</span><span class="op" id="6715641">(</span><span class="op" id="6715642">)</span><span class="op" id="6715643">.</span><span class="ident" id="6715644">Add</span><span class="op" id="6715647">(</span><span class="num" id="6715648">10</span>&nbsp;<span class="op" id="6715651">*</span>&nbsp;<span class="ident" id="6715653">time</span><span class="op" id="6715657">.</span><span class="ident" id="6715658">Millisecond</span><span class="op" id="6715669">)</span><span class="op" id="6715670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715673">writeUntilTimeout</span><span class="op" id="6715690">(</span><span class="op" id="6715691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715694">writeUntilTimeout</span><span class="op" id="6715711">(</span><span class="op" id="6715712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715715">c</span><span class="op" id="6715716">.</span><span class="ident" id="6715717">SetWriteDeadline</span><span class="op" id="6715733">(</span><span class="ident" id="6715734">noDeadline</span><span class="op" id="6715744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715747">c</span><span class="op" id="6715748">.</span><span class="ident" id="6715749">SetReadDeadline</span><span class="op" id="6715764">(</span><span class="ident" id="6715765">time</span><span class="op" id="6715769">.</span><span class="ident" id="6715770">Now</span><span class="op" id="6715773">(</span><span class="op" id="6715774">)</span><span class="op" id="6715775">.</span><span class="ident" id="6715776">Add</span><span class="op" id="6715779">(</span><span class="op" id="6715780">-</span><span class="num" id="6715781">1</span>&nbsp;<span class="op" id="6715783">*</span>&nbsp;<span class="ident" id="6715785">time</span><span class="op" id="6715789">.</span><span class="ident" id="6715790">Second</span><span class="op" id="6715796">)</span><span class="op" id="6715797">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715800">errc</span>&nbsp;<span class="op" id="6715805">:=</span>&nbsp;<span class="builtinfunc" id="6715808">make</span><span class="op" id="6715812">(</span><span class="keyword" id="6715813">chan</span>&nbsp;<span class="builtintype" id="6715818">error</span><span class="op" id="6715823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715826">go</span>&nbsp;<span class="keyword" id="6715829">func</span><span class="op" id="6715833">(</span><span class="op" id="6715834">)</span>&nbsp;<span class="op" id="6715836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715840">for</span>&nbsp;<span class="op" id="6715844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715849">_</span><span class="op" id="6715850">,</span>&nbsp;<span class="ident" id="6715852">err</span>&nbsp;<span class="op" id="6715856">:=</span>&nbsp;<span class="ident" id="6715859">c</span><span class="op" id="6715860">.</span><span class="ident" id="6715861">Write</span><span class="op" id="6715866">(</span><span class="ident" id="6715867">buf</span><span class="op" id="6715870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715875">if</span>&nbsp;<span class="ident" id="6715878">err</span>&nbsp;<span class="op" id="6715882">!=</span>&nbsp;<span class="ident" id="6715885">nil</span>&nbsp;<span class="op" id="6715889">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715895">errc</span>&nbsp;<span class="op" id="6715900">&lt;-</span>&nbsp;<span class="ident" id="6715903">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715917">}</span><span class="op" id="6715918">(</span><span class="op" id="6715919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715922">time</span><span class="op" id="6715926">.</span><span class="ident" id="6715927">Sleep</span><span class="op" id="6715932">(</span><span class="num" id="6715933">100</span>&nbsp;<span class="op" id="6715937">*</span>&nbsp;<span class="ident" id="6715939">time</span><span class="op" id="6715943">.</span><span class="ident" id="6715944">Millisecond</span><span class="op" id="6715955">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715958">select</span>&nbsp;<span class="op" id="6715965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715968">case</span>&nbsp;<span class="ident" id="6715973">err</span>&nbsp;<span class="op" id="6715977">:=</span>&nbsp;<span class="op" id="6715980">&lt;-</span><span class="ident" id="6715982">errc</span><span class="op" id="6715986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715990">t</span><span class="op" id="6715991">.</span><span class="ident" id="6715992">Fatalf</span><span class="op" id="6715998">(</span><span class="string" id="6715999">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="6716058">,</span>&nbsp;<span class="ident" id="6716060">err</span><span class="op" id="6716063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716066">default</span><span class="op" id="6716073">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716076">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716079">c</span><span class="op" id="6716080">.</span><span class="ident" id="6716081">Close</span><span class="op" id="6716086">(</span><span class="op" id="6716087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716090">switch</span>&nbsp;<span class="ident" id="6716097">nerr</span>&nbsp;<span class="op" id="6716102">:=</span>&nbsp;<span class="op" id="6716105">&lt;-</span><span class="ident" id="6716107">errc</span><span class="op" id="6716111">;</span>&nbsp;<span class="ident" id="6716113">err</span>&nbsp;<span class="op" id="6716117">:=</span>&nbsp;<span class="ident" id="6716120">nerr</span><span class="op" id="6716124">.</span><span class="op" id="6716125">(</span><span class="keyword" id="6716126">type</span><span class="op" id="6716130">)</span>&nbsp;<span class="op" id="6716132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716135">case</span>&nbsp;<span class="op" id="6716140">*</span><span class="ident" id="6716141">OpError</span><span class="op" id="6716148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716152">if</span>&nbsp;<span class="ident" id="6716155">err</span><span class="op" id="6716158">.</span><span class="ident" id="6716159">Err</span>&nbsp;<span class="op" id="6716163">!=</span>&nbsp;<span class="ident" id="6716166">errClosing</span>&nbsp;<span class="op" id="6716177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716182">t</span><span class="op" id="6716183">.</span><span class="ident" id="6716184">Fatalf</span><span class="op" id="6716190">(</span><span class="string" id="6716191">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6716223">,</span>&nbsp;<span class="ident" id="6716225">errClosing</span><span class="op" id="6716235">,</span>&nbsp;<span class="ident" id="6716237">err</span><span class="op" id="6716240">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716247">default</span><span class="op" id="6716254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716258">if</span>&nbsp;<span class="ident" id="6716261">err</span>&nbsp;<span class="op" id="6716265">!=</span>&nbsp;<span class="ident" id="6716268">errClosing</span>&nbsp;<span class="op" id="6716279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716284">t</span><span class="op" id="6716285">.</span><span class="ident" id="6716286">Fatalf</span><span class="op" id="6716292">(</span><span class="string" id="6716293">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6716325">,</span>&nbsp;<span class="ident" id="6716327">errClosing</span><span class="op" id="6716337">,</span>&nbsp;<span class="ident" id="6716339">err</span><span class="op" id="6716342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716346">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716349">}</span><br>
<span class="lineno"></span><span class="op" id="6716351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716354">func</span>&nbsp;<span class="ident" id="6716359">testTimeout</span><span class="op" id="6716370">(</span><span class="ident" id="6716371">t</span>&nbsp;<span class="op" id="6716373">*</span><span class="ident" id="6716374">testing</span><span class="op" id="6716381">.</span><span class="ident" id="6716382">T</span><span class="op" id="6716383">,</span>&nbsp;<span class="ident" id="6716385">net</span><span class="op" id="6716388">,</span>&nbsp;<span class="ident" id="6716390">addr</span>&nbsp;<span class="builtintype" id="6716395">string</span><span class="op" id="6716401">,</span>&nbsp;<span class="ident" id="6716403">readFrom</span>&nbsp;<span class="builtintype" id="6716412">bool</span><span class="op" id="6716416">)</span>&nbsp;<span class="op" id="6716418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716421">c</span><span class="op" id="6716422">,</span>&nbsp;<span class="ident" id="6716424">err</span>&nbsp;<span class="op" id="6716428">:=</span>&nbsp;<span class="ident" id="6716431">Dial</span><span class="op" id="6716435">(</span><span class="ident" id="6716436">net</span><span class="op" id="6716439">,</span>&nbsp;<span class="ident" id="6716441">addr</span><span class="op" id="6716445">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716448">if</span>&nbsp;<span class="ident" id="6716451">err</span>&nbsp;<span class="op" id="6716455">!=</span>&nbsp;<span class="ident" id="6716458">nil</span>&nbsp;<span class="op" id="6716462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716466">t</span><span class="op" id="6716467">.</span><span class="ident" id="6716468">Errorf</span><span class="op" id="6716474">(</span><span class="string" id="6716475">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6716500">,</span>&nbsp;<span class="ident" id="6716502">net</span><span class="op" id="6716505">,</span>&nbsp;<span class="ident" id="6716507">addr</span><span class="op" id="6716511">,</span>&nbsp;<span class="ident" id="6716513">err</span><span class="op" id="6716516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716531">defer</span>&nbsp;<span class="ident" id="6716537">c</span><span class="op" id="6716538">.</span><span class="ident" id="6716539">Close</span><span class="op" id="6716544">(</span><span class="op" id="6716545">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716548">what</span>&nbsp;<span class="op" id="6716553">:=</span>&nbsp;<span class="string" id="6716556">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716564">if</span>&nbsp;<span class="ident" id="6716567">readFrom</span>&nbsp;<span class="op" id="6716576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716580">what</span>&nbsp;<span class="op" id="6716585">=</span>&nbsp;<span class="string" id="6716587">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716603">errc</span>&nbsp;<span class="op" id="6716608">:=</span>&nbsp;<span class="builtinfunc" id="6716611">make</span><span class="op" id="6716615">(</span><span class="keyword" id="6716616">chan</span>&nbsp;<span class="builtintype" id="6716621">error</span><span class="op" id="6716626">,</span>&nbsp;<span class="num" id="6716628">1</span><span class="op" id="6716629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716632">go</span>&nbsp;<span class="keyword" id="6716635">func</span><span class="op" id="6716639">(</span><span class="op" id="6716640">)</span>&nbsp;<span class="op" id="6716642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716646">t0</span>&nbsp;<span class="op" id="6716649">:=</span>&nbsp;<span class="ident" id="6716652">time</span><span class="op" id="6716656">.</span><span class="ident" id="6716657">Now</span><span class="op" id="6716660">(</span><span class="op" id="6716661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716665">c</span><span class="op" id="6716666">.</span><span class="ident" id="6716667">SetReadDeadline</span><span class="op" id="6716682">(</span><span class="ident" id="6716683">time</span><span class="op" id="6716687">.</span><span class="ident" id="6716688">Now</span><span class="op" id="6716691">(</span><span class="op" id="6716692">)</span><span class="op" id="6716693">.</span><span class="ident" id="6716694">Add</span><span class="op" id="6716697">(</span><span class="num" id="6716698">100</span>&nbsp;<span class="op" id="6716702">*</span>&nbsp;<span class="ident" id="6716704">time</span><span class="op" id="6716708">.</span><span class="ident" id="6716709">Millisecond</span><span class="op" id="6716720">)</span><span class="op" id="6716721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716725">var</span>&nbsp;<span class="ident" id="6716729">b</span>&nbsp;<span class="op" id="6716731">[</span><span class="num" id="6716732">100</span><span class="op" id="6716735">]</span><span class="builtintype" id="6716736">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716743">var</span>&nbsp;<span class="ident" id="6716747">n</span>&nbsp;<span class="builtintype" id="6716749">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716755">var</span>&nbsp;<span class="ident" id="6716759">err</span>&nbsp;<span class="builtintype" id="6716763">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716771">if</span>&nbsp;<span class="ident" id="6716774">readFrom</span>&nbsp;<span class="op" id="6716783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716788">n</span><span class="op" id="6716789">,</span>&nbsp;<span class="ident" id="6716791">_</span><span class="op" id="6716792">,</span>&nbsp;<span class="ident" id="6716794">err</span>&nbsp;<span class="op" id="6716798">=</span>&nbsp;<span class="ident" id="6716800">c</span><span class="op" id="6716801">.</span><span class="op" id="6716802">(</span><span class="ident" id="6716803">PacketConn</span><span class="op" id="6716813">)</span><span class="op" id="6716814">.</span><span class="ident" id="6716815">ReadFrom</span><span class="op" id="6716823">(</span><span class="ident" id="6716824">b</span><span class="op" id="6716825">[</span><span class="num" id="6716826">0</span><span class="op" id="6716827">:</span><span class="op" id="6716828">]</span><span class="op" id="6716829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716833">}</span>&nbsp;<span class="keyword" id="6716835">else</span>&nbsp;<span class="op" id="6716840">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716845">n</span><span class="op" id="6716846">,</span>&nbsp;<span class="ident" id="6716848">err</span>&nbsp;<span class="op" id="6716852">=</span>&nbsp;<span class="ident" id="6716854">c</span><span class="op" id="6716855">.</span><span class="ident" id="6716856">Read</span><span class="op" id="6716860">(</span><span class="ident" id="6716861">b</span><span class="op" id="6716862">[</span><span class="num" id="6716863">0</span><span class="op" id="6716864">:</span><span class="op" id="6716865">]</span><span class="op" id="6716866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716874">t1</span>&nbsp;<span class="op" id="6716877">:=</span>&nbsp;<span class="ident" id="6716880">time</span><span class="op" id="6716884">.</span><span class="ident" id="6716885">Now</span><span class="op" id="6716888">(</span><span class="op" id="6716889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716893">if</span>&nbsp;<span class="ident" id="6716896">n</span>&nbsp;<span class="op" id="6716898">!=</span>&nbsp;<span class="num" id="6716901">0</span>&nbsp;<span class="op" id="6716903">||</span>&nbsp;<span class="ident" id="6716906">err</span>&nbsp;<span class="op" id="6716910">==</span>&nbsp;<span class="ident" id="6716913">nil</span>&nbsp;<span class="op" id="6716917">||</span>&nbsp;<span class="op" id="6716920">!</span><span class="ident" id="6716921">err</span><span class="op" id="6716924">.</span><span class="op" id="6716925">(</span><span class="ident" id="6716926">Error</span><span class="op" id="6716931">)</span><span class="op" id="6716932">.</span><span class="ident" id="6716933">Timeout</span><span class="op" id="6716940">(</span><span class="op" id="6716941">)</span>&nbsp;<span class="op" id="6716943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716948">errc</span>&nbsp;<span class="op" id="6716953">&lt;-</span>&nbsp;<span class="ident" id="6716956">fmt</span><span class="op" id="6716959">.</span><span class="ident" id="6716960">Errorf</span><span class="op" id="6716966">(</span><span class="string" id="6716967">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="6717013">,</span>&nbsp;<span class="ident" id="6717015">what</span><span class="op" id="6717019">,</span>&nbsp;<span class="ident" id="6717021">net</span><span class="op" id="6717024">,</span>&nbsp;<span class="ident" id="6717026">addr</span><span class="op" id="6717030">,</span>&nbsp;<span class="ident" id="6717032">n</span><span class="op" id="6717033">,</span>&nbsp;<span class="ident" id="6717035">err</span><span class="op" id="6717038">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717043">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717056">if</span>&nbsp;<span class="ident" id="6717059">dt</span>&nbsp;<span class="op" id="6717062">:=</span>&nbsp;<span class="ident" id="6717065">t1</span><span class="op" id="6717067">.</span><span class="ident" id="6717068">Sub</span><span class="op" id="6717071">(</span><span class="ident" id="6717072">t0</span><span class="op" id="6717074">)</span><span class="op" id="6717075">;</span>&nbsp;<span class="ident" id="6717077">dt</span>&nbsp;<span class="op" id="6717080">&lt;</span>&nbsp;<span class="num" id="6717082">50</span><span class="op" id="6717084">*</span><span class="ident" id="6717085">time</span><span class="op" id="6717089">.</span><span class="ident" id="6717090">Millisecond</span>&nbsp;<span class="op" id="6717102">||</span>&nbsp;<span class="op" id="6717105">!</span><span class="ident" id="6717106">testing</span><span class="op" id="6717113">.</span><span class="ident" id="6717114">Short</span><span class="op" id="6717119">(</span><span class="op" id="6717120">)</span>&nbsp;<span class="op" id="6717122">&amp;&amp;</span>&nbsp;<span class="ident" id="6717125">dt</span>&nbsp;<span class="op" id="6717128">&gt;</span>&nbsp;<span class="num" id="6717130">250</span><span class="op" id="6717133">*</span><span class="ident" id="6717134">time</span><span class="op" id="6717138">.</span><span class="ident" id="6717139">Millisecond</span>&nbsp;<span class="op" id="6717151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717156">errc</span>&nbsp;<span class="op" id="6717161">&lt;-</span>&nbsp;<span class="ident" id="6717164">fmt</span><span class="op" id="6717167">.</span><span class="ident" id="6717168">Errorf</span><span class="op" id="6717174">(</span><span class="string" id="6717175">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6717210">,</span>&nbsp;<span class="ident" id="6717212">what</span><span class="op" id="6717216">,</span>&nbsp;<span class="ident" id="6717218">net</span><span class="op" id="6717221">,</span>&nbsp;<span class="ident" id="6717223">addr</span><span class="op" id="6717227">,</span>&nbsp;<span class="ident" id="6717229">dt</span><span class="op" id="6717231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717236">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717249">errc</span>&nbsp;<span class="op" id="6717254">&lt;-</span>&nbsp;<span class="ident" id="6717257">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717262">}</span><span class="op" id="6717263">(</span><span class="op" id="6717264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717267">select</span>&nbsp;<span class="op" id="6717274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717277">case</span>&nbsp;<span class="ident" id="6717282">err</span>&nbsp;<span class="op" id="6717286">:=</span>&nbsp;<span class="op" id="6717289">&lt;-</span><span class="ident" id="6717291">errc</span><span class="op" id="6717295">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717299">if</span>&nbsp;<span class="ident" id="6717302">err</span>&nbsp;<span class="op" id="6717306">!=</span>&nbsp;<span class="ident" id="6717309">nil</span>&nbsp;<span class="op" id="6717313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717318">t</span><span class="op" id="6717319">.</span><span class="ident" id="6717320">Error</span><span class="op" id="6717325">(</span><span class="ident" id="6717326">err</span><span class="op" id="6717329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717336">case</span>&nbsp;<span class="op" id="6717341">&lt;-</span><span class="ident" id="6717343">time</span><span class="op" id="6717347">.</span><span class="ident" id="6717348">After</span><span class="op" id="6717353">(</span><span class="num" id="6717354">1</span>&nbsp;<span class="op" id="6717356">*</span>&nbsp;<span class="ident" id="6717358">time</span><span class="op" id="6717362">.</span><span class="ident" id="6717363">Second</span><span class="op" id="6717369">)</span><span class="op" id="6717370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717374">t</span><span class="op" id="6717375">.</span><span class="ident" id="6717376">Errorf</span><span class="op" id="6717382">(</span><span class="string" id="6717383">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="6717429">,</span>&nbsp;<span class="ident" id="6717431">what</span><span class="op" id="6717435">,</span>&nbsp;<span class="ident" id="6717437">net</span><span class="op" id="6717440">,</span>&nbsp;<span class="ident" id="6717442">addr</span><span class="op" id="6717446">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717449">}</span><br>
<span class="lineno"></span><span class="op" id="6717451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6717454">func</span>&nbsp;<span class="ident" id="6717459">TestTimeoutUDP</span><span class="op" id="6717473">(</span><span class="ident" id="6717474">t</span>&nbsp;<span class="op" id="6717476">*</span><span class="ident" id="6717477">testing</span><span class="op" id="6717484">.</span><span class="ident" id="6717485">T</span><span class="op" id="6717486">)</span>&nbsp;<span class="op" id="6717488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717491">switch</span>&nbsp;<span class="ident" id="6717498">runtime</span><span class="op" id="6717505">.</span><span class="ident" id="6717506">GOOS</span>&nbsp;<span class="op" id="6717511">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717514">case</span>&nbsp;<span class="string" id="6717519">&#34;plan9&#34;</span><span class="op" id="6717526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717530">t</span><span class="op" id="6717531">.</span><span class="ident" id="6717532">Skipf</span><span class="op" id="6717537">(</span><span class="string" id="6717538">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6717559">,</span>&nbsp;<span class="ident" id="6717561">runtime</span><span class="op" id="6717568">.</span><span class="ident" id="6717569">GOOS</span><span class="op" id="6717573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717580">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717623">listening</span>&nbsp;<span class="op" id="6717633">:=</span>&nbsp;<span class="builtinfunc" id="6717636">make</span><span class="op" id="6717640">(</span><span class="keyword" id="6717641">chan</span>&nbsp;<span class="builtintype" id="6717646">string</span><span class="op" id="6717652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717655">done</span>&nbsp;<span class="op" id="6717660">:=</span>&nbsp;<span class="builtinfunc" id="6717663">make</span><span class="op" id="6717667">(</span><span class="keyword" id="6717668">chan</span>&nbsp;<span class="builtintype" id="6717673">int</span><span class="op" id="6717676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717679">go</span>&nbsp;<span class="ident" id="6717682">runDatagramPacketConnServer</span><span class="op" id="6717709">(</span><span class="ident" id="6717710">t</span><span class="op" id="6717711">,</span>&nbsp;<span class="string" id="6717713">&#34;udp&#34;</span><span class="op" id="6717718">,</span>&nbsp;<span class="string" id="6717720">&#34;127.0.0.1:0&#34;</span><span class="op" id="6717733">,</span>&nbsp;<span class="ident" id="6717735">listening</span><span class="op" id="6717744">,</span>&nbsp;<span class="ident" id="6717746">done</span><span class="op" id="6717750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717753">addr</span>&nbsp;<span class="op" id="6717758">:=</span>&nbsp;<span class="op" id="6717761">&lt;-</span><span class="ident" id="6717763">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717775">testTimeout</span><span class="op" id="6717786">(</span><span class="ident" id="6717787">t</span><span class="op" id="6717788">,</span>&nbsp;<span class="string" id="6717790">&#34;udp&#34;</span><span class="op" id="6717795">,</span>&nbsp;<span class="ident" id="6717797">addr</span><span class="op" id="6717801">,</span>&nbsp;<span class="builtintype" id="6717803">false</span><span class="op" id="6717808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717811">testTimeout</span><span class="op" id="6717822">(</span><span class="ident" id="6717823">t</span><span class="op" id="6717824">,</span>&nbsp;<span class="string" id="6717826">&#34;udp&#34;</span><span class="op" id="6717831">,</span>&nbsp;<span class="ident" id="6717833">addr</span><span class="op" id="6717837">,</span>&nbsp;<span class="builtintype" id="6717839">true</span><span class="op" id="6717843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717846">&lt;-</span><span class="ident" id="6717848">done</span><br>
<span class="lineno"></span><span class="op" id="6717853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6717856">func</span>&nbsp;<span class="ident" id="6717861">TestTimeoutTCP</span><span class="op" id="6717875">(</span><span class="ident" id="6717876">t</span>&nbsp;<span class="op" id="6717878">*</span><span class="ident" id="6717879">testing</span><span class="op" id="6717886">.</span><span class="ident" id="6717887">T</span><span class="op" id="6717888">)</span>&nbsp;<span class="op" id="6717890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717893">switch</span>&nbsp;<span class="ident" id="6717900">runtime</span><span class="op" id="6717907">.</span><span class="ident" id="6717908">GOOS</span>&nbsp;<span class="op" id="6717913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6717916">case</span>&nbsp;<span class="string" id="6717921">&#34;plan9&#34;</span><span class="op" id="6717928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717932">t</span><span class="op" id="6717933">.</span><span class="ident" id="6717934">Skipf</span><span class="op" id="6717939">(</span><span class="string" id="6717940">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6717961">,</span>&nbsp;<span class="ident" id="6717963">runtime</span><span class="op" id="6717970">.</span><span class="ident" id="6717971">GOOS</span><span class="op" id="6717975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717978">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717982">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718025">listening</span>&nbsp;<span class="op" id="6718035">:=</span>&nbsp;<span class="builtinfunc" id="6718038">make</span><span class="op" id="6718042">(</span><span class="keyword" id="6718043">chan</span>&nbsp;<span class="builtintype" id="6718048">string</span><span class="op" id="6718054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718057">done</span>&nbsp;<span class="op" id="6718062">:=</span>&nbsp;<span class="builtinfunc" id="6718065">make</span><span class="op" id="6718069">(</span><span class="keyword" id="6718070">chan</span>&nbsp;<span class="builtintype" id="6718075">int</span><span class="op" id="6718078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718081">go</span>&nbsp;<span class="ident" id="6718084">runStreamConnServer</span><span class="op" id="6718103">(</span><span class="ident" id="6718104">t</span><span class="op" id="6718105">,</span>&nbsp;<span class="string" id="6718107">&#34;tcp&#34;</span><span class="op" id="6718112">,</span>&nbsp;<span class="string" id="6718114">&#34;127.0.0.1:0&#34;</span><span class="op" id="6718127">,</span>&nbsp;<span class="ident" id="6718129">listening</span><span class="op" id="6718138">,</span>&nbsp;<span class="ident" id="6718140">done</span><span class="op" id="6718144">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718147">addr</span>&nbsp;<span class="op" id="6718152">:=</span>&nbsp;<span class="op" id="6718155">&lt;-</span><span class="ident" id="6718157">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718169">testTimeout</span><span class="op" id="6718180">(</span><span class="ident" id="6718181">t</span><span class="op" id="6718182">,</span>&nbsp;<span class="string" id="6718184">&#34;tcp&#34;</span><span class="op" id="6718189">,</span>&nbsp;<span class="ident" id="6718191">addr</span><span class="op" id="6718195">,</span>&nbsp;<span class="builtintype" id="6718197">false</span><span class="op" id="6718202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718205">&lt;-</span><span class="ident" id="6718207">done</span><br>
<span class="lineno"></span><span class="op" id="6718212">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6718215">func</span>&nbsp;<span class="ident" id="6718220">TestDeadlineReset</span><span class="op" id="6718237">(</span><span class="ident" id="6718238">t</span>&nbsp;<span class="op" id="6718240">*</span><span class="ident" id="6718241">testing</span><span class="op" id="6718248">.</span><span class="ident" id="6718249">T</span><span class="op" id="6718250">)</span>&nbsp;<span class="op" id="6718252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718255">switch</span>&nbsp;<span class="ident" id="6718262">runtime</span><span class="op" id="6718269">.</span><span class="ident" id="6718270">GOOS</span>&nbsp;<span class="op" id="6718275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718278">case</span>&nbsp;<span class="string" id="6718283">&#34;plan9&#34;</span><span class="op" id="6718290">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718294">t</span><span class="op" id="6718295">.</span><span class="ident" id="6718296">Skipf</span><span class="op" id="6718301">(</span><span class="string" id="6718302">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6718323">,</span>&nbsp;<span class="ident" id="6718325">runtime</span><span class="op" id="6718332">.</span><span class="ident" id="6718333">GOOS</span><span class="op" id="6718337">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718343">ln</span><span class="op" id="6718345">,</span>&nbsp;<span class="ident" id="6718347">err</span>&nbsp;<span class="op" id="6718351">:=</span>&nbsp;<span class="ident" id="6718354">Listen</span><span class="op" id="6718360">(</span><span class="string" id="6718361">&#34;tcp&#34;</span><span class="op" id="6718366">,</span>&nbsp;<span class="string" id="6718368">&#34;127.0.0.1:0&#34;</span><span class="op" id="6718381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718384">if</span>&nbsp;<span class="ident" id="6718387">err</span>&nbsp;<span class="op" id="6718391">!=</span>&nbsp;<span class="ident" id="6718394">nil</span>&nbsp;<span class="op" id="6718398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718402">t</span><span class="op" id="6718403">.</span><span class="ident" id="6718404">Fatal</span><span class="op" id="6718409">(</span><span class="ident" id="6718410">err</span><span class="op" id="6718413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718416">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718419">defer</span>&nbsp;<span class="ident" id="6718425">ln</span><span class="op" id="6718427">.</span><span class="ident" id="6718428">Close</span><span class="op" id="6718433">(</span><span class="op" id="6718434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718437">tl</span>&nbsp;<span class="op" id="6718440">:=</span>&nbsp;<span class="ident" id="6718443">ln</span><span class="op" id="6718445">.</span><span class="op" id="6718446">(</span><span class="op" id="6718447">*</span><span class="ident" id="6718448">TCPListener</span><span class="op" id="6718459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718462">tl</span><span class="op" id="6718464">.</span><span class="ident" id="6718465">SetDeadline</span><span class="op" id="6718476">(</span><span class="ident" id="6718477">time</span><span class="op" id="6718481">.</span><span class="ident" id="6718482">Now</span><span class="op" id="6718485">(</span><span class="op" id="6718486">)</span><span class="op" id="6718487">.</span><span class="ident" id="6718488">Add</span><span class="op" id="6718491">(</span><span class="num" id="6718492">1</span>&nbsp;<span class="op" id="6718494">*</span>&nbsp;<span class="ident" id="6718496">time</span><span class="op" id="6718500">.</span><span class="ident" id="6718501">Minute</span><span class="op" id="6718507">)</span><span class="op" id="6718508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718511">tl</span><span class="op" id="6718513">.</span><span class="ident" id="6718514">SetDeadline</span><span class="op" id="6718525">(</span><span class="ident" id="6718526">noDeadline</span><span class="op" id="6718536">)</span>&nbsp;<span class="comment" id="6718538">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718551">errc</span>&nbsp;<span class="op" id="6718556">:=</span>&nbsp;<span class="builtinfunc" id="6718559">make</span><span class="op" id="6718563">(</span><span class="keyword" id="6718564">chan</span>&nbsp;<span class="builtintype" id="6718569">error</span><span class="op" id="6718574">,</span>&nbsp;<span class="num" id="6718576">1</span><span class="op" id="6718577">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718580">go</span>&nbsp;<span class="keyword" id="6718583">func</span><span class="op" id="6718587">(</span><span class="op" id="6718588">)</span>&nbsp;<span class="op" id="6718590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718594">_</span><span class="op" id="6718595">,</span>&nbsp;<span class="ident" id="6718597">err</span>&nbsp;<span class="op" id="6718601">:=</span>&nbsp;<span class="ident" id="6718604">ln</span><span class="op" id="6718606">.</span><span class="ident" id="6718607">Accept</span><span class="op" id="6718613">(</span><span class="op" id="6718614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718618">errc</span>&nbsp;<span class="op" id="6718623">&lt;-</span>&nbsp;<span class="ident" id="6718626">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718631">}</span><span class="op" id="6718632">(</span><span class="op" id="6718633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718636">select</span>&nbsp;<span class="op" id="6718643">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718646">case</span>&nbsp;<span class="op" id="6718651">&lt;-</span><span class="ident" id="6718653">time</span><span class="op" id="6718657">.</span><span class="ident" id="6718658">After</span><span class="op" id="6718663">(</span><span class="num" id="6718664">50</span>&nbsp;<span class="op" id="6718667">*</span>&nbsp;<span class="ident" id="6718669">time</span><span class="op" id="6718673">.</span><span class="ident" id="6718674">Millisecond</span><span class="op" id="6718685">)</span><span class="op" id="6718686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718690">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718700">case</span>&nbsp;<span class="ident" id="6718705">err</span>&nbsp;<span class="op" id="6718709">:=</span>&nbsp;<span class="op" id="6718712">&lt;-</span><span class="ident" id="6718714">errc</span><span class="op" id="6718718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718722">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718764">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718786">t</span><span class="op" id="6718787">.</span><span class="ident" id="6718788">Errorf</span><span class="op" id="6718794">(</span><span class="string" id="6718795">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="6718834">,</span>&nbsp;<span class="ident" id="6718836">err</span><span class="op" id="6718839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718842">}</span><br>
<span class="lineno"></span><span class="op" id="6718844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6718847">func</span>&nbsp;<span class="ident" id="6718852">TestTimeoutAccept</span><span class="op" id="6718869">(</span><span class="ident" id="6718870">t</span>&nbsp;<span class="op" id="6718872">*</span><span class="ident" id="6718873">testing</span><span class="op" id="6718880">.</span><span class="ident" id="6718881">T</span><span class="op" id="6718882">)</span>&nbsp;<span class="op" id="6718884">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718887">switch</span>&nbsp;<span class="ident" id="6718894">runtime</span><span class="op" id="6718901">.</span><span class="ident" id="6718902">GOOS</span>&nbsp;<span class="op" id="6718907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718910">case</span>&nbsp;<span class="string" id="6718915">&#34;plan9&#34;</span><span class="op" id="6718922">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718926">t</span><span class="op" id="6718927">.</span><span class="ident" id="6718928">Skipf</span><span class="op" id="6718933">(</span><span class="string" id="6718934">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6718955">,</span>&nbsp;<span class="ident" id="6718957">runtime</span><span class="op" id="6718964">.</span><span class="ident" id="6718965">GOOS</span><span class="op" id="6718969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718975">ln</span><span class="op" id="6718977">,</span>&nbsp;<span class="ident" id="6718979">err</span>&nbsp;<span class="op" id="6718983">:=</span>&nbsp;<span class="ident" id="6718986">Listen</span><span class="op" id="6718992">(</span><span class="string" id="6718993">&#34;tcp&#34;</span><span class="op" id="6718998">,</span>&nbsp;<span class="string" id="6719000">&#34;127.0.0.1:0&#34;</span><span class="op" id="6719013">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719016">if</span>&nbsp;<span class="ident" id="6719019">err</span>&nbsp;<span class="op" id="6719023">!=</span>&nbsp;<span class="ident" id="6719026">nil</span>&nbsp;<span class="op" id="6719030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719034">t</span><span class="op" id="6719035">.</span><span class="ident" id="6719036">Fatal</span><span class="op" id="6719041">(</span><span class="ident" id="6719042">err</span><span class="op" id="6719045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719051">defer</span>&nbsp;<span class="ident" id="6719057">ln</span><span class="op" id="6719059">.</span><span class="ident" id="6719060">Close</span><span class="op" id="6719065">(</span><span class="op" id="6719066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719069">tl</span>&nbsp;<span class="op" id="6719072">:=</span>&nbsp;<span class="ident" id="6719075">ln</span><span class="op" id="6719077">.</span><span class="op" id="6719078">(</span><span class="op" id="6719079">*</span><span class="ident" id="6719080">TCPListener</span><span class="op" id="6719091">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719094">tl</span><span class="op" id="6719096">.</span><span class="ident" id="6719097">SetDeadline</span><span class="op" id="6719108">(</span><span class="ident" id="6719109">time</span><span class="op" id="6719113">.</span><span class="ident" id="6719114">Now</span><span class="op" id="6719117">(</span><span class="op" id="6719118">)</span><span class="op" id="6719119">.</span><span class="ident" id="6719120">Add</span><span class="op" id="6719123">(</span><span class="num" id="6719124">100</span>&nbsp;<span class="op" id="6719128">*</span>&nbsp;<span class="ident" id="6719130">time</span><span class="op" id="6719134">.</span><span class="ident" id="6719135">Millisecond</span><span class="op" id="6719146">)</span><span class="op" id="6719147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719150">errc</span>&nbsp;<span class="op" id="6719155">:=</span>&nbsp;<span class="builtinfunc" id="6719158">make</span><span class="op" id="6719162">(</span><span class="keyword" id="6719163">chan</span>&nbsp;<span class="builtintype" id="6719168">error</span><span class="op" id="6719173">,</span>&nbsp;<span class="num" id="6719175">1</span><span class="op" id="6719176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719179">go</span>&nbsp;<span class="keyword" id="6719182">func</span><span class="op" id="6719186">(</span><span class="op" id="6719187">)</span>&nbsp;<span class="op" id="6719189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719193">_</span><span class="op" id="6719194">,</span>&nbsp;<span class="ident" id="6719196">err</span>&nbsp;<span class="op" id="6719200">:=</span>&nbsp;<span class="ident" id="6719203">ln</span><span class="op" id="6719205">.</span><span class="ident" id="6719206">Accept</span><span class="op" id="6719212">(</span><span class="op" id="6719213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719217">errc</span>&nbsp;<span class="op" id="6719222">&lt;-</span>&nbsp;<span class="ident" id="6719225">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719230">}</span><span class="op" id="6719231">(</span><span class="op" id="6719232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719235">select</span>&nbsp;<span class="op" id="6719242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719245">case</span>&nbsp;<span class="op" id="6719250">&lt;-</span><span class="ident" id="6719252">time</span><span class="op" id="6719256">.</span><span class="ident" id="6719257">After</span><span class="op" id="6719262">(</span><span class="num" id="6719263">1</span>&nbsp;<span class="op" id="6719265">*</span>&nbsp;<span class="ident" id="6719267">time</span><span class="op" id="6719271">.</span><span class="ident" id="6719272">Second</span><span class="op" id="6719278">)</span><span class="op" id="6719279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6719283">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719324">t</span><span class="op" id="6719325">.</span><span class="ident" id="6719326">Errorf</span><span class="op" id="6719332">(</span><span class="string" id="6719333">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="6719375">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719378">case</span>&nbsp;<span class="op" id="6719383">&lt;-</span><span class="ident" id="6719385">errc</span><span class="op" id="6719389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6719393">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719403">}</span><br>
<span class="lineno"></span><span class="op" id="6719405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="6719408">func</span>&nbsp;<span class="ident" id="6719413">TestReadWriteDeadline</span><span class="op" id="6719434">(</span><span class="ident" id="6719435">t</span>&nbsp;<span class="op" id="6719437">*</span><span class="ident" id="6719438">testing</span><span class="op" id="6719445">.</span><span class="ident" id="6719446">T</span><span class="op" id="6719447">)</span>&nbsp;<span class="op" id="6719449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719452">switch</span>&nbsp;<span class="ident" id="6719459">runtime</span><span class="op" id="6719466">.</span><span class="ident" id="6719467">GOOS</span>&nbsp;<span class="op" id="6719472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719475">case</span>&nbsp;<span class="string" id="6719480">&#34;plan9&#34;</span><span class="op" id="6719487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719491">t</span><span class="op" id="6719492">.</span><span class="ident" id="6719493">Skipf</span><span class="op" id="6719498">(</span><span class="string" id="6719499">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6719520">,</span>&nbsp;<span class="ident" id="6719522">runtime</span><span class="op" id="6719529">.</span><span class="ident" id="6719530">GOOS</span><span class="op" id="6719534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719537">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719541">const</span>&nbsp;<span class="op" id="6719547">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719551">readTimeout</span>&nbsp;&nbsp;<span class="op" id="6719564">=</span>&nbsp;<span class="num" id="6719566">50</span>&nbsp;<span class="op" id="6719569">*</span>&nbsp;<span class="ident" id="6719571">time</span><span class="op" id="6719575">.</span><span class="ident" id="6719576">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719590">writeTimeout</span>&nbsp;<span class="op" id="6719603">=</span>&nbsp;<span class="num" id="6719605">250</span>&nbsp;<span class="op" id="6719609">*</span>&nbsp;<span class="ident" id="6719611">time</span><span class="op" id="6719615">.</span><span class="ident" id="6719616">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719629">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719632">checkTimeout</span>&nbsp;<span class="op" id="6719645">:=</span>&nbsp;<span class="keyword" id="6719648">func</span><span class="op" id="6719652">(</span><span class="ident" id="6719653">command</span>&nbsp;<span class="builtintype" id="6719661">string</span><span class="op" id="6719667">,</span>&nbsp;<span class="ident" id="6719669">start</span>&nbsp;<span class="ident" id="6719675">time</span><span class="op" id="6719679">.</span><span class="ident" id="6719680">Time</span><span class="op" id="6719684">,</span>&nbsp;<span class="ident" id="6719686">should</span>&nbsp;<span class="ident" id="6719693">time</span><span class="op" id="6719697">.</span><span class="ident" id="6719698">Duration</span><span class="op" id="6719706">)</span>&nbsp;<span class="op" id="6719708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719712">is</span>&nbsp;<span class="op" id="6719715">:=</span>&nbsp;<span class="ident" id="6719718">time</span><span class="op" id="6719722">.</span><span class="ident" id="6719723">Now</span><span class="op" id="6719726">(</span><span class="op" id="6719727">)</span><span class="op" id="6719728">.</span><span class="ident" id="6719729">Sub</span><span class="op" id="6719732">(</span><span class="ident" id="6719733">start</span><span class="op" id="6719738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719742">d</span>&nbsp;<span class="op" id="6719744">:=</span>&nbsp;<span class="ident" id="6719747">is</span>&nbsp;<span class="op" id="6719750">-</span>&nbsp;<span class="ident" id="6719752">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719761">if</span>&nbsp;<span class="ident" id="6719764">d</span>&nbsp;<span class="op" id="6719766">&lt;</span>&nbsp;<span class="op" id="6719768">-</span><span class="num" id="6719769">30</span><span class="op" id="6719771">*</span><span class="ident" id="6719772">time</span><span class="op" id="6719776">.</span><span class="ident" id="6719777">Millisecond</span>&nbsp;<span class="op" id="6719789">||</span>&nbsp;<span class="op" id="6719792">!</span><span class="ident" id="6719793">testing</span><span class="op" id="6719800">.</span><span class="ident" id="6719801">Short</span><span class="op" id="6719806">(</span><span class="op" id="6719807">)</span>&nbsp;<span class="op" id="6719809">&amp;&amp;</span>&nbsp;<span class="num" id="6719812">150</span><span class="op" id="6719815">*</span><span class="ident" id="6719816">time</span><span class="op" id="6719820">.</span><span class="ident" id="6719821">Millisecond</span>&nbsp;<span class="op" id="6719833">&lt;</span>&nbsp;<span class="ident" id="6719835">d</span>&nbsp;<span class="op" id="6719837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719842">t</span><span class="op" id="6719843">.</span><span class="ident" id="6719844">Errorf</span><span class="op" id="6719850">(</span><span class="string" id="6719851">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="6719894">,</span>&nbsp;<span class="ident" id="6719896">command</span><span class="op" id="6719903">,</span>&nbsp;<span class="ident" id="6719905">is</span><span class="op" id="6719907">,</span>&nbsp;<span class="ident" id="6719909">should</span><span class="op" id="6719915">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719926">ln</span><span class="op" id="6719928">,</span>&nbsp;<span class="ident" id="6719930">err</span>&nbsp;<span class="op" id="6719934">:=</span>&nbsp;<span class="ident" id="6719937">Listen</span><span class="op" id="6719943">(</span><span class="string" id="6719944">&#34;tcp&#34;</span><span class="op" id="6719949">,</span>&nbsp;<span class="string" id="6719951">&#34;127.0.0.1:0&#34;</span><span class="op" id="6719964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719967">if</span>&nbsp;<span class="ident" id="6719970">err</span>&nbsp;<span class="op" id="6719974">!=</span>&nbsp;<span class="ident" id="6719977">nil</span>&nbsp;<span class="op" id="6719981">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719985">t</span><span class="op" id="6719986">.</span><span class="ident" id="6719987">Fatalf</span><span class="op" id="6719993">(</span><span class="string" id="6719994">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="6720015">,</span>&nbsp;<span class="ident" id="6720017">err</span><span class="op" id="6720020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720026">defer</span>&nbsp;<span class="ident" id="6720032">ln</span><span class="op" id="6720034">.</span><span class="ident" id="6720035">Close</span><span class="op" id="6720040">(</span><span class="op" id="6720041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720045">lnquit</span>&nbsp;<span class="op" id="6720052">:=</span>&nbsp;<span class="builtinfunc" id="6720055">make</span><span class="op" id="6720059">(</span><span class="keyword" id="6720060">chan</span>&nbsp;<span class="builtintype" id="6720065">bool</span><span class="op" id="6720069">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720073">go</span>&nbsp;<span class="keyword" id="6720076">func</span><span class="op" id="6720080">(</span><span class="op" id="6720081">)</span>&nbsp;<span class="op" id="6720083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720087">c</span><span class="op" id="6720088">,</span>&nbsp;<span class="ident" id="6720090">err</span>&nbsp;<span class="op" id="6720094">:=</span>&nbsp;<span class="ident" id="6720097">ln</span><span class="op" id="6720099">.</span><span class="ident" id="6720100">Accept</span><span class="op" id="6720106">(</span><span class="op" id="6720107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720111">if</span>&nbsp;<span class="ident" id="6720114">err</span>&nbsp;<span class="op" id="6720118">!=</span>&nbsp;<span class="ident" id="6720121">nil</span>&nbsp;<span class="op" id="6720125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720130">t</span><span class="op" id="6720131">.</span><span class="ident" id="6720132">Errorf</span><span class="op" id="6720138">(</span><span class="string" id="6720139">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6720151">,</span>&nbsp;<span class="ident" id="6720153">err</span><span class="op" id="6720156">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720161">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720174">defer</span>&nbsp;<span class="ident" id="6720180">c</span><span class="op" id="6720181">.</span><span class="ident" id="6720182">Close</span><span class="op" id="6720187">(</span><span class="op" id="6720188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720192">lnquit</span>&nbsp;<span class="op" id="6720199">&lt;-</span>&nbsp;<span class="builtintype" id="6720202">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720208">}</span><span class="op" id="6720209">(</span><span class="op" id="6720210">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720214">c</span><span class="op" id="6720215">,</span>&nbsp;<span class="ident" id="6720217">err</span>&nbsp;<span class="op" id="6720221">:=</span>&nbsp;<span class="ident" id="6720224">Dial</span><span class="op" id="6720228">(</span><span class="string" id="6720229">&#34;tcp&#34;</span><span class="op" id="6720234">,</span>&nbsp;<span class="ident" id="6720236">ln</span><span class="op" id="6720238">.</span><span class="ident" id="6720239">Addr</span><span class="op" id="6720243">(</span><span class="op" id="6720244">)</span><span class="op" id="6720245">.</span><span class="ident" id="6720246">String</span><span class="op" id="6720252">(</span><span class="op" id="6720253">)</span><span class="op" id="6720254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720257">if</span>&nbsp;<span class="ident" id="6720260">err</span>&nbsp;<span class="op" id="6720264">!=</span>&nbsp;<span class="ident" id="6720267">nil</span>&nbsp;<span class="op" id="6720271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720275">t</span><span class="op" id="6720276">.</span><span class="ident" id="6720277">Fatalf</span><span class="op" id="6720283">(</span><span class="string" id="6720284">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6720294">,</span>&nbsp;<span class="ident" id="6720296">err</span><span class="op" id="6720299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720302">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720305">defer</span>&nbsp;<span class="ident" id="6720311">c</span><span class="op" id="6720312">.</span><span class="ident" id="6720313">Close</span><span class="op" id="6720318">(</span><span class="op" id="6720319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720323">start</span>&nbsp;<span class="op" id="6720329">:=</span>&nbsp;<span class="ident" id="6720332">time</span><span class="op" id="6720336">.</span><span class="ident" id="6720337">Now</span><span class="op" id="6720340">(</span><span class="op" id="6720341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720344">err</span>&nbsp;<span class="op" id="6720348">=</span>&nbsp;<span class="ident" id="6720350">c</span><span class="op" id="6720351">.</span><span class="ident" id="6720352">SetReadDeadline</span><span class="op" id="6720367">(</span><span class="ident" id="6720368">start</span><span class="op" id="6720373">.</span><span class="ident" id="6720374">Add</span><span class="op" id="6720377">(</span><span class="ident" id="6720378">readTimeout</span><span class="op" id="6720389">)</span><span class="op" id="6720390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720393">if</span>&nbsp;<span class="ident" id="6720396">err</span>&nbsp;<span class="op" id="6720400">!=</span>&nbsp;<span class="ident" id="6720403">nil</span>&nbsp;<span class="op" id="6720407">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720411">t</span><span class="op" id="6720412">.</span><span class="ident" id="6720413">Fatalf</span><span class="op" id="6720419">(</span><span class="string" id="6720420">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="6720441">,</span>&nbsp;<span class="ident" id="6720443">err</span><span class="op" id="6720446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720452">err</span>&nbsp;<span class="op" id="6720456">=</span>&nbsp;<span class="ident" id="6720458">c</span><span class="op" id="6720459">.</span><span class="ident" id="6720460">SetWriteDeadline</span><span class="op" id="6720476">(</span><span class="ident" id="6720477">start</span><span class="op" id="6720482">.</span><span class="ident" id="6720483">Add</span><span class="op" id="6720486">(</span><span class="ident" id="6720487">writeTimeout</span><span class="op" id="6720499">)</span><span class="op" id="6720500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720503">if</span>&nbsp;<span class="ident" id="6720506">err</span>&nbsp;<span class="op" id="6720510">!=</span>&nbsp;<span class="ident" id="6720513">nil</span>&nbsp;<span class="op" id="6720517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720521">t</span><span class="op" id="6720522">.</span><span class="ident" id="6720523">Fatalf</span><span class="op" id="6720529">(</span><span class="string" id="6720530">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="6720552">,</span>&nbsp;<span class="ident" id="6720554">err</span><span class="op" id="6720557">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720564">quit</span>&nbsp;<span class="op" id="6720569">:=</span>&nbsp;<span class="builtinfunc" id="6720572">make</span><span class="op" id="6720576">(</span><span class="keyword" id="6720577">chan</span>&nbsp;<span class="builtintype" id="6720582">bool</span><span class="op" id="6720586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720590">go</span>&nbsp;<span class="keyword" id="6720593">func</span><span class="op" id="6720597">(</span><span class="op" id="6720598">)</span>&nbsp;<span class="op" id="6720600">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720604">var</span>&nbsp;<span class="ident" id="6720608">buf</span>&nbsp;<span class="op" id="6720612">[</span><span class="num" id="6720613">10</span><span class="op" id="6720615">]</span><span class="builtintype" id="6720616">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720623">_</span><span class="op" id="6720624">,</span>&nbsp;<span class="ident" id="6720626">err</span>&nbsp;<span class="op" id="6720630">:=</span>&nbsp;<span class="ident" id="6720633">c</span><span class="op" id="6720634">.</span><span class="ident" id="6720635">Read</span><span class="op" id="6720639">(</span><span class="ident" id="6720640">buf</span><span class="op" id="6720643">[</span><span class="op" id="6720644">:</span><span class="op" id="6720645">]</span><span class="op" id="6720646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720650">if</span>&nbsp;<span class="ident" id="6720653">err</span>&nbsp;<span class="op" id="6720657">==</span>&nbsp;<span class="ident" id="6720660">nil</span>&nbsp;<span class="op" id="6720664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720669">t</span><span class="op" id="6720670">.</span><span class="ident" id="6720671">Errorf</span><span class="op" id="6720677">(</span><span class="string" id="6720678">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="6720703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720707">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720711">checkTimeout</span><span class="op" id="6720723">(</span><span class="string" id="6720724">&#34;Read&#34;</span><span class="op" id="6720730">,</span>&nbsp;<span class="ident" id="6720732">start</span><span class="op" id="6720737">,</span>&nbsp;<span class="ident" id="6720739">readTimeout</span><span class="op" id="6720750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720754">quit</span>&nbsp;<span class="op" id="6720759">&lt;-</span>&nbsp;<span class="builtintype" id="6720762">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720768">}</span><span class="op" id="6720769">(</span><span class="op" id="6720770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720774">go</span>&nbsp;<span class="keyword" id="6720777">func</span><span class="op" id="6720781">(</span><span class="op" id="6720782">)</span>&nbsp;<span class="op" id="6720784">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720788">var</span>&nbsp;<span class="ident" id="6720792">buf</span>&nbsp;<span class="op" id="6720796">[</span><span class="num" id="6720797">10000</span><span class="op" id="6720802">]</span><span class="builtintype" id="6720803">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720810">for</span>&nbsp;<span class="op" id="6720814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720819">_</span><span class="op" id="6720820">,</span>&nbsp;<span class="ident" id="6720822">err</span>&nbsp;<span class="op" id="6720826">:=</span>&nbsp;<span class="ident" id="6720829">c</span><span class="op" id="6720830">.</span><span class="ident" id="6720831">Write</span><span class="op" id="6720836">(</span><span class="ident" id="6720837">buf</span><span class="op" id="6720840">[</span><span class="op" id="6720841">:</span><span class="op" id="6720842">]</span><span class="op" id="6720843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720848">if</span>&nbsp;<span class="ident" id="6720851">err</span>&nbsp;<span class="op" id="6720855">!=</span>&nbsp;<span class="ident" id="6720858">nil</span>&nbsp;<span class="op" id="6720862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720868">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720885">checkTimeout</span><span class="op" id="6720897">(</span><span class="string" id="6720898">&#34;Write&#34;</span><span class="op" id="6720905">,</span>&nbsp;<span class="ident" id="6720907">start</span><span class="op" id="6720912">,</span>&nbsp;<span class="ident" id="6720914">writeTimeout</span><span class="op" id="6720926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720930">quit</span>&nbsp;<span class="op" id="6720935">&lt;-</span>&nbsp;<span class="builtintype" id="6720938">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720944">}</span><span class="op" id="6720945">(</span><span class="op" id="6720946">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720950">&lt;-</span><span class="ident" id="6720952">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720958">&lt;-</span><span class="ident" id="6720960">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720966">&lt;-</span><span class="ident" id="6720968">lnquit</span><br>
<span class="lineno"></span><span class="op" id="6720975">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="6720978">type</span>&nbsp;<span class="ident" id="6720983">neverEnding</span>&nbsp;<span class="builtintype" id="6720995">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6721001">func</span>&nbsp;<span class="op" id="6721006">(</span><span class="ident" id="6721007">b</span>&nbsp;<span class="ident" id="6721009">neverEnding</span><span class="op" id="6721020">)</span>&nbsp;<span class="ident" id="6721022">Read</span><span class="op" id="6721026">(</span><span class="ident" id="6721027">p</span>&nbsp;<span class="op" id="6721029">[</span><span class="op" id="6721030">]</span><span class="builtintype" id="6721031">byte</span><span class="op" id="6721035">)</span>&nbsp;<span class="op" id="6721037">(</span><span class="ident" id="6721038">n</span>&nbsp;<span class="builtintype" id="6721040">int</span><span class="op" id="6721043">,</span>&nbsp;<span class="ident" id="6721045">err</span>&nbsp;<span class="builtintype" id="6721049">error</span><span class="op" id="6721054">)</span>&nbsp;<span class="op" id="6721056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721059">for</span>&nbsp;<span class="ident" id="6721063">i</span>&nbsp;<span class="op" id="6721065">:=</span>&nbsp;<span class="keyword" id="6721068">range</span>&nbsp;<span class="ident" id="6721074">p</span>&nbsp;<span class="op" id="6721076">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721080">p</span><span class="op" id="6721081">[</span><span class="ident" id="6721082">i</span><span class="op" id="6721083">]</span>&nbsp;<span class="op" id="6721085">=</span>&nbsp;<span class="builtintype" id="6721087">byte</span><span class="op" id="6721091">(</span><span class="ident" id="6721092">b</span><span class="op" id="6721093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721099">return</span>&nbsp;<span class="builtinfunc" id="6721106">len</span><span class="op" id="6721109">(</span><span class="ident" id="6721110">p</span><span class="op" id="6721111">)</span><span class="op" id="6721112">,</span>&nbsp;<span class="ident" id="6721114">nil</span><br>
<span class="lineno"></span><span class="op" id="6721118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="6721121">func</span>&nbsp;<span class="ident" id="6721126">TestVariousDeadlines1Proc</span><span class="op" id="6721151">(</span><span class="ident" id="6721152">t</span>&nbsp;<span class="op" id="6721154">*</span><span class="ident" id="6721155">testing</span><span class="op" id="6721162">.</span><span class="ident" id="6721163">T</span><span class="op" id="6721164">)</span>&nbsp;<span class="op" id="6721166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721169">testVariousDeadlines</span><span class="op" id="6721189">(</span><span class="ident" id="6721190">t</span><span class="op" id="6721191">,</span>&nbsp;<span class="num" id="6721193">1</span><span class="op" id="6721194">)</span><br>
<span class="lineno"></span><span class="op" id="6721196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6721199">func</span>&nbsp;<span class="ident" id="6721204">TestVariousDeadlines4Proc</span><span class="op" id="6721229">(</span><span class="ident" id="6721230">t</span>&nbsp;<span class="op" id="6721232">*</span><span class="ident" id="6721233">testing</span><span class="op" id="6721240">.</span><span class="ident" id="6721241">T</span><span class="op" id="6721242">)</span>&nbsp;<span class="op" id="6721244">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721247">testVariousDeadlines</span><span class="op" id="6721267">(</span><span class="ident" id="6721268">t</span><span class="op" id="6721269">,</span>&nbsp;<span class="num" id="6721271">4</span><span class="op" id="6721272">)</span><br>
<span class="lineno"></span><span class="op" id="6721274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6721277">func</span>&nbsp;<span class="ident" id="6721282">testVariousDeadlines</span><span class="op" id="6721302">(</span><span class="ident" id="6721303">t</span>&nbsp;<span class="op" id="6721305">*</span><span class="ident" id="6721306">testing</span><span class="op" id="6721313">.</span><span class="ident" id="6721314">T</span><span class="op" id="6721315">,</span>&nbsp;<span class="ident" id="6721317">maxProcs</span>&nbsp;<span class="builtintype" id="6721326">int</span><span class="op" id="6721329">)</span>&nbsp;<span class="op" id="6721331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721334">switch</span>&nbsp;<span class="ident" id="6721341">runtime</span><span class="op" id="6721348">.</span><span class="ident" id="6721349">GOOS</span>&nbsp;<span class="op" id="6721354">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721357">case</span>&nbsp;<span class="string" id="6721362">&#34;plan9&#34;</span><span class="op" id="6721369">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721373">t</span><span class="op" id="6721374">.</span><span class="ident" id="6721375">Skipf</span><span class="op" id="6721380">(</span><span class="string" id="6721381">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6721402">,</span>&nbsp;<span class="ident" id="6721404">runtime</span><span class="op" id="6721411">.</span><span class="ident" id="6721412">GOOS</span><span class="op" id="6721416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721423">defer</span>&nbsp;<span class="ident" id="6721429">runtime</span><span class="op" id="6721436">.</span><span class="ident" id="6721437">GOMAXPROCS</span><span class="op" id="6721447">(</span><span class="ident" id="6721448">runtime</span><span class="op" id="6721455">.</span><span class="ident" id="6721456">GOMAXPROCS</span><span class="op" id="6721466">(</span><span class="ident" id="6721467">maxProcs</span><span class="op" id="6721475">)</span><span class="op" id="6721476">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721479">ln</span>&nbsp;<span class="op" id="6721482">:=</span>&nbsp;<span class="ident" id="6721485">newLocalListener</span><span class="op" id="6721501">(</span><span class="ident" id="6721502">t</span><span class="op" id="6721503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721506">defer</span>&nbsp;<span class="ident" id="6721512">ln</span><span class="op" id="6721514">.</span><span class="ident" id="6721515">Close</span><span class="op" id="6721520">(</span><span class="op" id="6721521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721524">acceptc</span>&nbsp;<span class="op" id="6721532">:=</span>&nbsp;<span class="builtinfunc" id="6721535">make</span><span class="op" id="6721539">(</span><span class="keyword" id="6721540">chan</span>&nbsp;<span class="builtintype" id="6721545">error</span><span class="op" id="6721550">,</span>&nbsp;<span class="num" id="6721552">1</span><span class="op" id="6721553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6721557">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6721627">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721650">servec</span>&nbsp;<span class="op" id="6721657">:=</span>&nbsp;<span class="builtinfunc" id="6721660">make</span><span class="op" id="6721664">(</span><span class="keyword" id="6721665">chan</span>&nbsp;<span class="ident" id="6721670">copyRes</span><span class="op" id="6721677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721680">go</span>&nbsp;<span class="keyword" id="6721683">func</span><span class="op" id="6721687">(</span><span class="op" id="6721688">)</span>&nbsp;<span class="op" id="6721690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721694">for</span>&nbsp;<span class="op" id="6721698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721703">c</span><span class="op" id="6721704">,</span>&nbsp;<span class="ident" id="6721706">err</span>&nbsp;<span class="op" id="6721710">:=</span>&nbsp;<span class="ident" id="6721713">ln</span><span class="op" id="6721715">.</span><span class="ident" id="6721716">Accept</span><span class="op" id="6721722">(</span><span class="op" id="6721723">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721728">if</span>&nbsp;<span class="ident" id="6721731">err</span>&nbsp;<span class="op" id="6721735">!=</span>&nbsp;<span class="ident" id="6721738">nil</span>&nbsp;<span class="op" id="6721742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721748">acceptc</span>&nbsp;<span class="op" id="6721756">&lt;-</span>&nbsp;<span class="ident" id="6721759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721767">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721782">go</span>&nbsp;<span class="keyword" id="6721785">func</span><span class="op" id="6721789">(</span><span class="op" id="6721790">)</span>&nbsp;<span class="op" id="6721792">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721798">t0</span>&nbsp;<span class="op" id="6721801">:=</span>&nbsp;<span class="ident" id="6721804">time</span><span class="op" id="6721808">.</span><span class="ident" id="6721809">Now</span><span class="op" id="6721812">(</span><span class="op" id="6721813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721819">n</span><span class="op" id="6721820">,</span>&nbsp;<span class="ident" id="6721822">err</span>&nbsp;<span class="op" id="6721826">:=</span>&nbsp;<span class="ident" id="6721829">io</span><span class="op" id="6721831">.</span><span class="ident" id="6721832">Copy</span><span class="op" id="6721836">(</span><span class="ident" id="6721837">c</span><span class="op" id="6721838">,</span>&nbsp;<span class="ident" id="6721840">neverEnding</span><span class="op" id="6721851">(</span><span class="string" id="6721852">&#39;a&#39;</span><span class="op" id="6721855">)</span><span class="op" id="6721856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721862">d</span>&nbsp;<span class="op" id="6721864">:=</span>&nbsp;<span class="ident" id="6721867">time</span><span class="op" id="6721871">.</span><span class="ident" id="6721872">Since</span><span class="op" id="6721877">(</span><span class="ident" id="6721878">t0</span><span class="op" id="6721880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721886">c</span><span class="op" id="6721887">.</span><span class="ident" id="6721888">Close</span><span class="op" id="6721893">(</span><span class="op" id="6721894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721900">servec</span>&nbsp;<span class="op" id="6721907">&lt;-</span>&nbsp;<span class="ident" id="6721910">copyRes</span><span class="op" id="6721917">{</span><span class="ident" id="6721918">n</span><span class="op" id="6721919">,</span>&nbsp;<span class="ident" id="6721921">err</span><span class="op" id="6721924">,</span>&nbsp;<span class="ident" id="6721926">d</span><span class="op" id="6721927">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721932">}</span><span class="op" id="6721933">(</span><span class="op" id="6721934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721941">}</span><span class="op" id="6721942">(</span><span class="op" id="6721943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721947">for</span>&nbsp;<span class="ident" id="6721951">_</span><span class="op" id="6721952">,</span>&nbsp;<span class="ident" id="6721954">timeout</span>&nbsp;<span class="op" id="6721962">:=</span>&nbsp;<span class="keyword" id="6721965">range</span>&nbsp;<span class="op" id="6721971">[</span><span class="op" id="6721972">]</span><span class="ident" id="6721973">time</span><span class="op" id="6721977">.</span><span class="ident" id="6721978">Duration</span><span class="op" id="6721986">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6721990">1</span>&nbsp;<span class="op" id="6721992">*</span>&nbsp;<span class="ident" id="6721994">time</span><span class="op" id="6721998">.</span><span class="ident" id="6721999">Nanosecond</span><span class="op" id="6722009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722013">2</span>&nbsp;<span class="op" id="6722015">*</span>&nbsp;<span class="ident" id="6722017">time</span><span class="op" id="6722021">.</span><span class="ident" id="6722022">Nanosecond</span><span class="op" id="6722032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722036">5</span>&nbsp;<span class="op" id="6722038">*</span>&nbsp;<span class="ident" id="6722040">time</span><span class="op" id="6722044">.</span><span class="ident" id="6722045">Nanosecond</span><span class="op" id="6722055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722059">50</span>&nbsp;<span class="op" id="6722062">*</span>&nbsp;<span class="ident" id="6722064">time</span><span class="op" id="6722068">.</span><span class="ident" id="6722069">Nanosecond</span><span class="op" id="6722079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722083">100</span>&nbsp;<span class="op" id="6722087">*</span>&nbsp;<span class="ident" id="6722089">time</span><span class="op" id="6722093">.</span><span class="ident" id="6722094">Nanosecond</span><span class="op" id="6722104">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722108">200</span>&nbsp;<span class="op" id="6722112">*</span>&nbsp;<span class="ident" id="6722114">time</span><span class="op" id="6722118">.</span><span class="ident" id="6722119">Nanosecond</span><span class="op" id="6722129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722133">500</span>&nbsp;<span class="op" id="6722137">*</span>&nbsp;<span class="ident" id="6722139">time</span><span class="op" id="6722143">.</span><span class="ident" id="6722144">Nanosecond</span><span class="op" id="6722154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722158">750</span>&nbsp;<span class="op" id="6722162">*</span>&nbsp;<span class="ident" id="6722164">time</span><span class="op" id="6722168">.</span><span class="ident" id="6722169">Nanosecond</span><span class="op" id="6722179">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722183">1</span>&nbsp;<span class="op" id="6722185">*</span>&nbsp;<span class="ident" id="6722187">time</span><span class="op" id="6722191">.</span><span class="ident" id="6722192">Microsecond</span><span class="op" id="6722203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722207">5</span>&nbsp;<span class="op" id="6722209">*</span>&nbsp;<span class="ident" id="6722211">time</span><span class="op" id="6722215">.</span><span class="ident" id="6722216">Microsecond</span><span class="op" id="6722227">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722231">25</span>&nbsp;<span class="op" id="6722234">*</span>&nbsp;<span class="ident" id="6722236">time</span><span class="op" id="6722240">.</span><span class="ident" id="6722241">Microsecond</span><span class="op" id="6722252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722256">250</span>&nbsp;<span class="op" id="6722260">*</span>&nbsp;<span class="ident" id="6722262">time</span><span class="op" id="6722266">.</span><span class="ident" id="6722267">Microsecond</span><span class="op" id="6722278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722282">500</span>&nbsp;<span class="op" id="6722286">*</span>&nbsp;<span class="ident" id="6722288">time</span><span class="op" id="6722292">.</span><span class="ident" id="6722293">Microsecond</span><span class="op" id="6722304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722308">1</span>&nbsp;<span class="op" id="6722310">*</span>&nbsp;<span class="ident" id="6722312">time</span><span class="op" id="6722316">.</span><span class="ident" id="6722317">Millisecond</span><span class="op" id="6722328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722332">5</span>&nbsp;<span class="op" id="6722334">*</span>&nbsp;<span class="ident" id="6722336">time</span><span class="op" id="6722340">.</span><span class="ident" id="6722341">Millisecond</span><span class="op" id="6722352">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722356">100</span>&nbsp;<span class="op" id="6722360">*</span>&nbsp;<span class="ident" id="6722362">time</span><span class="op" id="6722366">.</span><span class="ident" id="6722367">Millisecond</span><span class="op" id="6722378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722382">250</span>&nbsp;<span class="op" id="6722386">*</span>&nbsp;<span class="ident" id="6722388">time</span><span class="op" id="6722392">.</span><span class="ident" id="6722393">Millisecond</span><span class="op" id="6722404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722408">500</span>&nbsp;<span class="op" id="6722412">*</span>&nbsp;<span class="ident" id="6722414">time</span><span class="op" id="6722418">.</span><span class="ident" id="6722419">Millisecond</span><span class="op" id="6722430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6722434">1</span>&nbsp;<span class="op" id="6722436">*</span>&nbsp;<span class="ident" id="6722438">time</span><span class="op" id="6722442">.</span><span class="ident" id="6722443">Second</span><span class="op" id="6722449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722452">}</span>&nbsp;<span class="op" id="6722454">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722458">numRuns</span>&nbsp;<span class="op" id="6722466">:=</span>&nbsp;<span class="num" id="6722469">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722473">if</span>&nbsp;<span class="ident" id="6722476">testing</span><span class="op" id="6722483">.</span><span class="ident" id="6722484">Short</span><span class="op" id="6722489">(</span><span class="op" id="6722490">)</span>&nbsp;<span class="op" id="6722492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722497">numRuns</span>&nbsp;<span class="op" id="6722505">=</span>&nbsp;<span class="num" id="6722507">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722512">if</span>&nbsp;<span class="ident" id="6722515">timeout</span>&nbsp;<span class="op" id="6722523">&gt;</span>&nbsp;<span class="num" id="6722525">500</span><span class="op" id="6722528">*</span><span class="ident" id="6722529">time</span><span class="op" id="6722533">.</span><span class="ident" id="6722534">Microsecond</span>&nbsp;<span class="op" id="6722546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722552">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722572">for</span>&nbsp;<span class="ident" id="6722576">run</span>&nbsp;<span class="op" id="6722580">:=</span>&nbsp;<span class="num" id="6722583">0</span><span class="op" id="6722584">;</span>&nbsp;<span class="ident" id="6722586">run</span>&nbsp;<span class="op" id="6722590">&lt;</span>&nbsp;<span class="ident" id="6722592">numRuns</span><span class="op" id="6722599">;</span>&nbsp;<span class="ident" id="6722601">run</span><span class="op" id="6722604">++</span>&nbsp;<span class="op" id="6722607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722612">name</span>&nbsp;<span class="op" id="6722617">:=</span>&nbsp;<span class="ident" id="6722620">fmt</span><span class="op" id="6722623">.</span><span class="ident" id="6722624">Sprintf</span><span class="op" id="6722631">(</span><span class="string" id="6722632">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="6722646">,</span>&nbsp;<span class="ident" id="6722648">timeout</span><span class="op" id="6722655">,</span>&nbsp;<span class="ident" id="6722657">run</span><span class="op" id="6722660">+</span><span class="num" id="6722661">1</span><span class="op" id="6722662">,</span>&nbsp;<span class="ident" id="6722664">numRuns</span><span class="op" id="6722671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722676">t</span><span class="op" id="6722677">.</span><span class="ident" id="6722678">Log</span><span class="op" id="6722681">(</span><span class="ident" id="6722682">name</span><span class="op" id="6722686">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722692">c</span><span class="op" id="6722693">,</span>&nbsp;<span class="ident" id="6722695">err</span>&nbsp;<span class="op" id="6722699">:=</span>&nbsp;<span class="ident" id="6722702">Dial</span><span class="op" id="6722706">(</span><span class="string" id="6722707">&#34;tcp&#34;</span><span class="op" id="6722712">,</span>&nbsp;<span class="ident" id="6722714">ln</span><span class="op" id="6722716">.</span><span class="ident" id="6722717">Addr</span><span class="op" id="6722721">(</span><span class="op" id="6722722">)</span><span class="op" id="6722723">.</span><span class="ident" id="6722724">String</span><span class="op" id="6722730">(</span><span class="op" id="6722731">)</span><span class="op" id="6722732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722737">if</span>&nbsp;<span class="ident" id="6722740">err</span>&nbsp;<span class="op" id="6722744">!=</span>&nbsp;<span class="ident" id="6722747">nil</span>&nbsp;<span class="op" id="6722751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722757">t</span><span class="op" id="6722758">.</span><span class="ident" id="6722759">Fatalf</span><span class="op" id="6722765">(</span><span class="string" id="6722766">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6722776">,</span>&nbsp;<span class="ident" id="6722778">err</span><span class="op" id="6722781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722786">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722791">clientc</span>&nbsp;<span class="op" id="6722799">:=</span>&nbsp;<span class="builtinfunc" id="6722802">make</span><span class="op" id="6722806">(</span><span class="keyword" id="6722807">chan</span>&nbsp;<span class="ident" id="6722812">copyRes</span><span class="op" id="6722819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722824">go</span>&nbsp;<span class="keyword" id="6722827">func</span><span class="op" id="6722831">(</span><span class="op" id="6722832">)</span>&nbsp;<span class="op" id="6722834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722840">t0</span>&nbsp;<span class="op" id="6722843">:=</span>&nbsp;<span class="ident" id="6722846">time</span><span class="op" id="6722850">.</span><span class="ident" id="6722851">Now</span><span class="op" id="6722854">(</span><span class="op" id="6722855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722861">c</span><span class="op" id="6722862">.</span><span class="ident" id="6722863">SetDeadline</span><span class="op" id="6722874">(</span><span class="ident" id="6722875">t0</span><span class="op" id="6722877">.</span><span class="ident" id="6722878">Add</span><span class="op" id="6722881">(</span><span class="ident" id="6722882">timeout</span><span class="op" id="6722889">)</span><span class="op" id="6722890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722896">n</span><span class="op" id="6722897">,</span>&nbsp;<span class="ident" id="6722899">err</span>&nbsp;<span class="op" id="6722903">:=</span>&nbsp;<span class="ident" id="6722906">io</span><span class="op" id="6722908">.</span><span class="ident" id="6722909">Copy</span><span class="op" id="6722913">(</span><span class="ident" id="6722914">ioutil</span><span class="op" id="6722920">.</span><span class="ident" id="6722921">Discard</span><span class="op" id="6722928">,</span>&nbsp;<span class="ident" id="6722930">c</span><span class="op" id="6722931">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722937">d</span>&nbsp;<span class="op" id="6722939">:=</span>&nbsp;<span class="ident" id="6722942">time</span><span class="op" id="6722946">.</span><span class="ident" id="6722947">Since</span><span class="op" id="6722952">(</span><span class="ident" id="6722953">t0</span><span class="op" id="6722955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722961">c</span><span class="op" id="6722962">.</span><span class="ident" id="6722963">Close</span><span class="op" id="6722968">(</span><span class="op" id="6722969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722975">clientc</span>&nbsp;<span class="op" id="6722983">&lt;-</span>&nbsp;<span class="ident" id="6722986">copyRes</span><span class="op" id="6722993">{</span><span class="ident" id="6722994">n</span><span class="op" id="6722995">,</span>&nbsp;<span class="ident" id="6722997">err</span><span class="op" id="6723000">,</span>&nbsp;<span class="ident" id="6723002">d</span><span class="op" id="6723003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723008">}</span><span class="op" id="6723009">(</span><span class="op" id="6723010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723016">tooLong</span>&nbsp;<span class="op" id="6723024">:=</span>&nbsp;<span class="num" id="6723027">5</span>&nbsp;<span class="op" id="6723029">*</span>&nbsp;<span class="ident" id="6723031">time</span><span class="op" id="6723035">.</span><span class="ident" id="6723036">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723046">select</span>&nbsp;<span class="op" id="6723053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723058">case</span>&nbsp;<span class="ident" id="6723063">res</span>&nbsp;<span class="op" id="6723067">:=</span>&nbsp;<span class="op" id="6723070">&lt;-</span><span class="ident" id="6723072">clientc</span><span class="op" id="6723079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723085">if</span>&nbsp;<span class="ident" id="6723088">isTimeout</span><span class="op" id="6723097">(</span><span class="ident" id="6723098">res</span><span class="op" id="6723101">.</span><span class="ident" id="6723102">err</span><span class="op" id="6723105">)</span>&nbsp;<span class="op" id="6723107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723114">t</span><span class="op" id="6723115">.</span><span class="ident" id="6723116">Logf</span><span class="op" id="6723120">(</span><span class="string" id="6723121">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6723177">,</span>&nbsp;<span class="ident" id="6723179">name</span><span class="op" id="6723183">,</span>&nbsp;<span class="ident" id="6723185">res</span><span class="op" id="6723188">.</span><span class="ident" id="6723189">d</span><span class="op" id="6723190">,</span>&nbsp;<span class="ident" id="6723192">res</span><span class="op" id="6723195">.</span><span class="ident" id="6723196">n</span><span class="op" id="6723197">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723203">}</span>&nbsp;<span class="keyword" id="6723205">else</span>&nbsp;<span class="op" id="6723210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723217">t</span><span class="op" id="6723218">.</span><span class="ident" id="6723219">Fatalf</span><span class="op" id="6723225">(</span><span class="string" id="6723226">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="6723271">,</span>&nbsp;<span class="ident" id="6723273">name</span><span class="op" id="6723277">,</span>&nbsp;<span class="ident" id="6723279">res</span><span class="op" id="6723282">.</span><span class="ident" id="6723283">n</span><span class="op" id="6723284">,</span>&nbsp;<span class="ident" id="6723286">res</span><span class="op" id="6723289">.</span><span class="ident" id="6723290">err</span><span class="op" id="6723293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723304">case</span>&nbsp;<span class="op" id="6723309">&lt;-</span><span class="ident" id="6723311">time</span><span class="op" id="6723315">.</span><span class="ident" id="6723316">After</span><span class="op" id="6723321">(</span><span class="ident" id="6723322">tooLong</span><span class="op" id="6723329">)</span><span class="op" id="6723330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723336">t</span><span class="op" id="6723337">.</span><span class="ident" id="6723338">Fatalf</span><span class="op" id="6723344">(</span><span class="string" id="6723345">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="6723410">,</span>&nbsp;<span class="ident" id="6723412">name</span><span class="op" id="6723416">,</span>&nbsp;<span class="ident" id="6723418">tooLong</span><span class="op" id="6723425">,</span>&nbsp;<span class="ident" id="6723427">timeout</span><span class="op" id="6723434">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723445">select</span>&nbsp;<span class="op" id="6723452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723457">case</span>&nbsp;<span class="ident" id="6723462">res</span>&nbsp;<span class="op" id="6723466">:=</span>&nbsp;<span class="op" id="6723469">&lt;-</span><span class="ident" id="6723471">servec</span><span class="op" id="6723477">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723483">t</span><span class="op" id="6723484">.</span><span class="ident" id="6723485">Logf</span><span class="op" id="6723489">(</span><span class="string" id="6723490">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="6723525">,</span>&nbsp;<span class="ident" id="6723527">name</span><span class="op" id="6723531">,</span>&nbsp;<span class="ident" id="6723533">res</span><span class="op" id="6723536">.</span><span class="ident" id="6723537">d</span><span class="op" id="6723538">,</span>&nbsp;<span class="ident" id="6723540">res</span><span class="op" id="6723543">.</span><span class="ident" id="6723544">n</span><span class="op" id="6723545">,</span>&nbsp;<span class="ident" id="6723547">res</span><span class="op" id="6723550">.</span><span class="ident" id="6723551">err</span><span class="op" id="6723554">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723559">case</span>&nbsp;<span class="ident" id="6723564">err</span>&nbsp;<span class="op" id="6723568">:=</span>&nbsp;<span class="op" id="6723571">&lt;-</span><span class="ident" id="6723573">acceptc</span><span class="op" id="6723580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723586">t</span><span class="op" id="6723587">.</span><span class="ident" id="6723588">Fatalf</span><span class="op" id="6723594">(</span><span class="string" id="6723595">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="6723623">,</span>&nbsp;<span class="ident" id="6723625">name</span><span class="op" id="6723629">,</span>&nbsp;<span class="ident" id="6723631">err</span><span class="op" id="6723634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723639">case</span>&nbsp;<span class="op" id="6723644">&lt;-</span><span class="ident" id="6723646">time</span><span class="op" id="6723650">.</span><span class="ident" id="6723651">After</span><span class="op" id="6723656">(</span><span class="ident" id="6723657">tooLong</span><span class="op" id="6723664">)</span><span class="op" id="6723665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723671">t</span><span class="op" id="6723672">.</span><span class="ident" id="6723673">Fatalf</span><span class="op" id="6723679">(</span><span class="string" id="6723680">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="6723734">,</span>&nbsp;<span class="ident" id="6723736">name</span><span class="op" id="6723740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723745">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723752">}</span><br>
<span class="lineno"></span><span class="op" id="6723754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6723757">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="6723827">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6723864">func</span>&nbsp;<span class="ident" id="6723869">TestReadDeadlineDataAvailable</span><span class="op" id="6723898">(</span><span class="ident" id="6723899">t</span>&nbsp;<span class="op" id="6723901">*</span><span class="ident" id="6723902">testing</span><span class="op" id="6723909">.</span><span class="ident" id="6723910">T</span><span class="op" id="6723911">)</span>&nbsp;<span class="op" id="6723913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723916">switch</span>&nbsp;<span class="ident" id="6723923">runtime</span><span class="op" id="6723930">.</span><span class="ident" id="6723931">GOOS</span>&nbsp;<span class="op" id="6723936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723939">case</span>&nbsp;<span class="string" id="6723944">&#34;plan9&#34;</span><span class="op" id="6723951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723955">t</span><span class="op" id="6723956">.</span><span class="ident" id="6723957">Skipf</span><span class="op" id="6723962">(</span><span class="string" id="6723963">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6723984">,</span>&nbsp;<span class="ident" id="6723986">runtime</span><span class="op" id="6723993">.</span><span class="ident" id="6723994">GOOS</span><span class="op" id="6723998">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724005">ln</span>&nbsp;<span class="op" id="6724008">:=</span>&nbsp;<span class="ident" id="6724011">newLocalListener</span><span class="op" id="6724027">(</span><span class="ident" id="6724028">t</span><span class="op" id="6724029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724032">defer</span>&nbsp;<span class="ident" id="6724038">ln</span><span class="op" id="6724040">.</span><span class="ident" id="6724041">Close</span><span class="op" id="6724046">(</span><span class="op" id="6724047">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724051">servec</span>&nbsp;<span class="op" id="6724058">:=</span>&nbsp;<span class="builtinfunc" id="6724061">make</span><span class="op" id="6724065">(</span><span class="keyword" id="6724066">chan</span>&nbsp;<span class="ident" id="6724071">copyRes</span><span class="op" id="6724078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724081">const</span>&nbsp;<span class="ident" id="6724087">msg</span>&nbsp;<span class="op" id="6724091">=</span>&nbsp;<span class="string" id="6724093">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724153">go</span>&nbsp;<span class="keyword" id="6724156">func</span><span class="op" id="6724160">(</span><span class="op" id="6724161">)</span>&nbsp;<span class="op" id="6724163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724167">c</span><span class="op" id="6724168">,</span>&nbsp;<span class="ident" id="6724170">err</span>&nbsp;<span class="op" id="6724174">:=</span>&nbsp;<span class="ident" id="6724177">ln</span><span class="op" id="6724179">.</span><span class="ident" id="6724180">Accept</span><span class="op" id="6724186">(</span><span class="op" id="6724187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724191">if</span>&nbsp;<span class="ident" id="6724194">err</span>&nbsp;<span class="op" id="6724198">!=</span>&nbsp;<span class="ident" id="6724201">nil</span>&nbsp;<span class="op" id="6724205">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724210">t</span><span class="op" id="6724211">.</span><span class="ident" id="6724212">Errorf</span><span class="op" id="6724218">(</span><span class="string" id="6724219">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6724231">,</span>&nbsp;<span class="ident" id="6724233">err</span><span class="op" id="6724236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724241">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724254">defer</span>&nbsp;<span class="ident" id="6724260">c</span><span class="op" id="6724261">.</span><span class="ident" id="6724262">Close</span><span class="op" id="6724267">(</span><span class="op" id="6724268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724272">n</span><span class="op" id="6724273">,</span>&nbsp;<span class="ident" id="6724275">err</span>&nbsp;<span class="op" id="6724279">:=</span>&nbsp;<span class="ident" id="6724282">c</span><span class="op" id="6724283">.</span><span class="ident" id="6724284">Write</span><span class="op" id="6724289">(</span><span class="op" id="6724290">[</span><span class="op" id="6724291">]</span><span class="builtintype" id="6724292">byte</span><span class="op" id="6724296">(</span><span class="ident" id="6724297">msg</span><span class="op" id="6724300">)</span><span class="op" id="6724301">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724305">servec</span>&nbsp;<span class="op" id="6724312">&lt;-</span>&nbsp;<span class="ident" id="6724315">copyRes</span><span class="op" id="6724322">{</span><span class="ident" id="6724323">n</span><span class="op" id="6724324">:</span>&nbsp;<span class="ident" id="6724326">int64</span><span class="op" id="6724331">(</span><span class="ident" id="6724332">n</span><span class="op" id="6724333">)</span><span class="op" id="6724334">,</span>&nbsp;<span class="ident" id="6724336">err</span><span class="op" id="6724339">:</span>&nbsp;<span class="ident" id="6724341">err</span><span class="op" id="6724344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724347">}</span><span class="op" id="6724348">(</span><span class="op" id="6724349">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724353">c</span><span class="op" id="6724354">,</span>&nbsp;<span class="ident" id="6724356">err</span>&nbsp;<span class="op" id="6724360">:=</span>&nbsp;<span class="ident" id="6724363">Dial</span><span class="op" id="6724367">(</span><span class="string" id="6724368">&#34;tcp&#34;</span><span class="op" id="6724373">,</span>&nbsp;<span class="ident" id="6724375">ln</span><span class="op" id="6724377">.</span><span class="ident" id="6724378">Addr</span><span class="op" id="6724382">(</span><span class="op" id="6724383">)</span><span class="op" id="6724384">.</span><span class="ident" id="6724385">String</span><span class="op" id="6724391">(</span><span class="op" id="6724392">)</span><span class="op" id="6724393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724396">if</span>&nbsp;<span class="ident" id="6724399">err</span>&nbsp;<span class="op" id="6724403">!=</span>&nbsp;<span class="ident" id="6724406">nil</span>&nbsp;<span class="op" id="6724410">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724414">t</span><span class="op" id="6724415">.</span><span class="ident" id="6724416">Fatalf</span><span class="op" id="6724422">(</span><span class="string" id="6724423">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6724433">,</span>&nbsp;<span class="ident" id="6724435">err</span><span class="op" id="6724438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724444">defer</span>&nbsp;<span class="ident" id="6724450">c</span><span class="op" id="6724451">.</span><span class="ident" id="6724452">Close</span><span class="op" id="6724457">(</span><span class="op" id="6724458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724461">if</span>&nbsp;<span class="ident" id="6724464">res</span>&nbsp;<span class="op" id="6724468">:=</span>&nbsp;<span class="op" id="6724471">&lt;-</span><span class="ident" id="6724473">servec</span><span class="op" id="6724479">;</span>&nbsp;<span class="ident" id="6724481">res</span><span class="op" id="6724484">.</span><span class="ident" id="6724485">err</span>&nbsp;<span class="op" id="6724489">!=</span>&nbsp;<span class="ident" id="6724492">nil</span>&nbsp;<span class="op" id="6724496">||</span>&nbsp;<span class="ident" id="6724499">res</span><span class="op" id="6724502">.</span><span class="ident" id="6724503">n</span>&nbsp;<span class="op" id="6724505">!=</span>&nbsp;<span class="ident" id="6724508">int64</span><span class="op" id="6724513">(</span><span class="builtinfunc" id="6724514">len</span><span class="op" id="6724517">(</span><span class="ident" id="6724518">msg</span><span class="op" id="6724521">)</span><span class="op" id="6724522">)</span>&nbsp;<span class="op" id="6724524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724528">t</span><span class="op" id="6724529">.</span><span class="ident" id="6724530">Fatalf</span><span class="op" id="6724536">(</span><span class="string" id="6724537">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="6724596">,</span>&nbsp;<span class="ident" id="6724598">res</span><span class="op" id="6724601">.</span><span class="ident" id="6724602">n</span><span class="op" id="6724603">,</span>&nbsp;<span class="ident" id="6724605">res</span><span class="op" id="6724608">.</span><span class="ident" id="6724609">err</span><span class="op" id="6724612">,</span>&nbsp;<span class="builtinfunc" id="6724614">len</span><span class="op" id="6724617">(</span><span class="ident" id="6724618">msg</span><span class="op" id="6724621">)</span><span class="op" id="6724622">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724628">c</span><span class="op" id="6724629">.</span><span class="ident" id="6724630">SetReadDeadline</span><span class="op" id="6724645">(</span><span class="ident" id="6724646">time</span><span class="op" id="6724650">.</span><span class="ident" id="6724651">Now</span><span class="op" id="6724654">(</span><span class="op" id="6724655">)</span><span class="op" id="6724656">.</span><span class="ident" id="6724657">Add</span><span class="op" id="6724660">(</span><span class="op" id="6724661">-</span><span class="num" id="6724662">5</span>&nbsp;<span class="op" id="6724664">*</span>&nbsp;<span class="ident" id="6724666">time</span><span class="op" id="6724670">.</span><span class="ident" id="6724671">Second</span><span class="op" id="6724677">)</span><span class="op" id="6724678">)</span>&nbsp;<span class="comment" id="6724680">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724697">buf</span>&nbsp;<span class="op" id="6724701">:=</span>&nbsp;<span class="builtinfunc" id="6724704">make</span><span class="op" id="6724708">(</span><span class="op" id="6724709">[</span><span class="op" id="6724710">]</span><span class="builtintype" id="6724711">byte</span><span class="op" id="6724715">,</span>&nbsp;<span class="builtinfunc" id="6724717">len</span><span class="op" id="6724720">(</span><span class="ident" id="6724721">msg</span><span class="op" id="6724724">)</span><span class="op" id="6724725">/</span><span class="num" id="6724726">2</span><span class="op" id="6724727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724730">n</span><span class="op" id="6724731">,</span>&nbsp;<span class="ident" id="6724733">err</span>&nbsp;<span class="op" id="6724737">:=</span>&nbsp;<span class="ident" id="6724740">c</span><span class="op" id="6724741">.</span><span class="ident" id="6724742">Read</span><span class="op" id="6724746">(</span><span class="ident" id="6724747">buf</span><span class="op" id="6724750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724753">if</span>&nbsp;<span class="ident" id="6724756">n</span>&nbsp;<span class="op" id="6724758">&gt;</span>&nbsp;<span class="num" id="6724760">0</span>&nbsp;<span class="op" id="6724762">||</span>&nbsp;<span class="op" id="6724765">!</span><span class="ident" id="6724766">isTimeout</span><span class="op" id="6724775">(</span><span class="ident" id="6724776">err</span><span class="op" id="6724779">)</span>&nbsp;<span class="op" id="6724781">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724785">t</span><span class="op" id="6724786">.</span><span class="ident" id="6724787">Fatalf</span><span class="op" id="6724793">(</span><span class="string" id="6724794">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="6724841">,</span>&nbsp;<span class="ident" id="6724843">n</span><span class="op" id="6724844">,</span>&nbsp;<span class="ident" id="6724846">buf</span><span class="op" id="6724849">[</span><span class="op" id="6724850">:</span><span class="ident" id="6724851">n</span><span class="op" id="6724852">]</span><span class="op" id="6724853">,</span>&nbsp;<span class="ident" id="6724855">err</span><span class="op" id="6724858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724861">}</span><br>
<span class="lineno"></span><span class="op" id="6724863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6724866">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="6724940">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="6724987">func</span>&nbsp;<span class="ident" id="6724992">TestWriteDeadlineBufferAvailable</span><span class="op" id="6725024">(</span><span class="ident" id="6725025">t</span>&nbsp;<span class="op" id="6725027">*</span><span class="ident" id="6725028">testing</span><span class="op" id="6725035">.</span><span class="ident" id="6725036">T</span><span class="op" id="6725037">)</span>&nbsp;<span class="op" id="6725039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725042">switch</span>&nbsp;<span class="ident" id="6725049">runtime</span><span class="op" id="6725056">.</span><span class="ident" id="6725057">GOOS</span>&nbsp;<span class="op" id="6725062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725065">case</span>&nbsp;<span class="string" id="6725070">&#34;plan9&#34;</span><span class="op" id="6725077">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725081">t</span><span class="op" id="6725082">.</span><span class="ident" id="6725083">Skipf</span><span class="op" id="6725088">(</span><span class="string" id="6725089">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6725110">,</span>&nbsp;<span class="ident" id="6725112">runtime</span><span class="op" id="6725119">.</span><span class="ident" id="6725120">GOOS</span><span class="op" id="6725124">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725131">ln</span>&nbsp;<span class="op" id="6725134">:=</span>&nbsp;<span class="ident" id="6725137">newLocalListener</span><span class="op" id="6725153">(</span><span class="ident" id="6725154">t</span><span class="op" id="6725155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725158">defer</span>&nbsp;<span class="ident" id="6725164">ln</span><span class="op" id="6725166">.</span><span class="ident" id="6725167">Close</span><span class="op" id="6725172">(</span><span class="op" id="6725173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725177">servec</span>&nbsp;<span class="op" id="6725184">:=</span>&nbsp;<span class="builtinfunc" id="6725187">make</span><span class="op" id="6725191">(</span><span class="keyword" id="6725192">chan</span>&nbsp;<span class="ident" id="6725197">copyRes</span><span class="op" id="6725204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725207">go</span>&nbsp;<span class="keyword" id="6725210">func</span><span class="op" id="6725214">(</span><span class="op" id="6725215">)</span>&nbsp;<span class="op" id="6725217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725221">c</span><span class="op" id="6725222">,</span>&nbsp;<span class="ident" id="6725224">err</span>&nbsp;<span class="op" id="6725228">:=</span>&nbsp;<span class="ident" id="6725231">ln</span><span class="op" id="6725233">.</span><span class="ident" id="6725234">Accept</span><span class="op" id="6725240">(</span><span class="op" id="6725241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725245">if</span>&nbsp;<span class="ident" id="6725248">err</span>&nbsp;<span class="op" id="6725252">!=</span>&nbsp;<span class="ident" id="6725255">nil</span>&nbsp;<span class="op" id="6725259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725264">t</span><span class="op" id="6725265">.</span><span class="ident" id="6725266">Errorf</span><span class="op" id="6725272">(</span><span class="string" id="6725273">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="6725285">,</span>&nbsp;<span class="ident" id="6725287">err</span><span class="op" id="6725290">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725295">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725308">defer</span>&nbsp;<span class="ident" id="6725314">c</span><span class="op" id="6725315">.</span><span class="ident" id="6725316">Close</span><span class="op" id="6725321">(</span><span class="op" id="6725322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725326">c</span><span class="op" id="6725327">.</span><span class="ident" id="6725328">SetWriteDeadline</span><span class="op" id="6725344">(</span><span class="ident" id="6725345">time</span><span class="op" id="6725349">.</span><span class="ident" id="6725350">Now</span><span class="op" id="6725353">(</span><span class="op" id="6725354">)</span><span class="op" id="6725355">.</span><span class="ident" id="6725356">Add</span><span class="op" id="6725359">(</span><span class="op" id="6725360">-</span><span class="num" id="6725361">5</span>&nbsp;<span class="op" id="6725363">*</span>&nbsp;<span class="ident" id="6725365">time</span><span class="op" id="6725369">.</span><span class="ident" id="6725370">Second</span><span class="op" id="6725376">)</span><span class="op" id="6725377">)</span>&nbsp;<span class="comment" id="6725379">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725396">n</span><span class="op" id="6725397">,</span>&nbsp;<span class="ident" id="6725399">err</span>&nbsp;<span class="op" id="6725403">:=</span>&nbsp;<span class="ident" id="6725406">c</span><span class="op" id="6725407">.</span><span class="ident" id="6725408">Write</span><span class="op" id="6725413">(</span><span class="op" id="6725414">[</span><span class="op" id="6725415">]</span><span class="builtintype" id="6725416">byte</span><span class="op" id="6725420">{</span><span class="string" id="6725421">&#39;x&#39;</span><span class="op" id="6725424">}</span><span class="op" id="6725425">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725429">servec</span>&nbsp;<span class="op" id="6725436">&lt;-</span>&nbsp;<span class="ident" id="6725439">copyRes</span><span class="op" id="6725446">{</span><span class="ident" id="6725447">n</span><span class="op" id="6725448">:</span>&nbsp;<span class="ident" id="6725450">int64</span><span class="op" id="6725455">(</span><span class="ident" id="6725456">n</span><span class="op" id="6725457">)</span><span class="op" id="6725458">,</span>&nbsp;<span class="ident" id="6725460">err</span><span class="op" id="6725463">:</span>&nbsp;<span class="ident" id="6725465">err</span><span class="op" id="6725468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725471">}</span><span class="op" id="6725472">(</span><span class="op" id="6725473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725477">c</span><span class="op" id="6725478">,</span>&nbsp;<span class="ident" id="6725480">err</span>&nbsp;<span class="op" id="6725484">:=</span>&nbsp;<span class="ident" id="6725487">Dial</span><span class="op" id="6725491">(</span><span class="string" id="6725492">&#34;tcp&#34;</span><span class="op" id="6725497">,</span>&nbsp;<span class="ident" id="6725499">ln</span><span class="op" id="6725501">.</span><span class="ident" id="6725502">Addr</span><span class="op" id="6725506">(</span><span class="op" id="6725507">)</span><span class="op" id="6725508">.</span><span class="ident" id="6725509">String</span><span class="op" id="6725515">(</span><span class="op" id="6725516">)</span><span class="op" id="6725517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725520">if</span>&nbsp;<span class="ident" id="6725523">err</span>&nbsp;<span class="op" id="6725527">!=</span>&nbsp;<span class="ident" id="6725530">nil</span>&nbsp;<span class="op" id="6725534">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725538">t</span><span class="op" id="6725539">.</span><span class="ident" id="6725540">Fatalf</span><span class="op" id="6725546">(</span><span class="string" id="6725547">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6725557">,</span>&nbsp;<span class="ident" id="6725559">err</span><span class="op" id="6725562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725568">defer</span>&nbsp;<span class="ident" id="6725574">c</span><span class="op" id="6725575">.</span><span class="ident" id="6725576">Close</span><span class="op" id="6725581">(</span><span class="op" id="6725582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725585">res</span>&nbsp;<span class="op" id="6725589">:=</span>&nbsp;<span class="op" id="6725592">&lt;-</span><span class="ident" id="6725594">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725602">if</span>&nbsp;<span class="ident" id="6725605">res</span><span class="op" id="6725608">.</span><span class="ident" id="6725609">n</span>&nbsp;<span class="op" id="6725611">!=</span>&nbsp;<span class="num" id="6725614">0</span>&nbsp;<span class="op" id="6725616">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725620">t</span><span class="op" id="6725621">.</span><span class="ident" id="6725622">Errorf</span><span class="op" id="6725628">(</span><span class="string" id="6725629">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="6725649">,</span>&nbsp;<span class="ident" id="6725651">res</span><span class="op" id="6725654">.</span><span class="ident" id="6725655">n</span><span class="op" id="6725656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725662">if</span>&nbsp;<span class="op" id="6725665">!</span><span class="ident" id="6725666">isTimeout</span><span class="op" id="6725675">(</span><span class="ident" id="6725676">res</span><span class="op" id="6725679">.</span><span class="ident" id="6725680">err</span><span class="op" id="6725683">)</span>&nbsp;<span class="op" id="6725685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725689">t</span><span class="op" id="6725690">.</span><span class="ident" id="6725691">Errorf</span><span class="op" id="6725697">(</span><span class="string" id="6725698">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6725730">,</span>&nbsp;<span class="ident" id="6725732">res</span><span class="op" id="6725735">.</span><span class="ident" id="6725736">err</span><span class="op" id="6725739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725742">}</span><br>
<span class="lineno">600</span><span class="op" id="6725744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6725747">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="6725827">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="6725873">func</span>&nbsp;<span class="ident" id="6725878">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="6725915">(</span><span class="ident" id="6725916">t</span>&nbsp;<span class="op" id="6725918">*</span><span class="ident" id="6725919">testing</span><span class="op" id="6725926">.</span><span class="ident" id="6725927">T</span><span class="op" id="6725928">)</span>&nbsp;<span class="op" id="6725930">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725933">switch</span>&nbsp;<span class="ident" id="6725940">runtime</span><span class="op" id="6725947">.</span><span class="ident" id="6725948">GOOS</span>&nbsp;<span class="op" id="6725953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725956">case</span>&nbsp;<span class="string" id="6725961">&#34;plan9&#34;</span><span class="op" id="6725968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725972">t</span><span class="op" id="6725973">.</span><span class="ident" id="6725974">Skipf</span><span class="op" id="6725979">(</span><span class="string" id="6725980">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6726001">,</span>&nbsp;<span class="ident" id="6726003">runtime</span><span class="op" id="6726010">.</span><span class="ident" id="6726011">GOOS</span><span class="op" id="6726015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726022">ln</span>&nbsp;<span class="op" id="6726025">:=</span>&nbsp;<span class="ident" id="6726028">newLocalListener</span><span class="op" id="6726044">(</span><span class="ident" id="6726045">t</span><span class="op" id="6726046">)</span><span class="op" id="6726047">.</span><span class="op" id="6726048">(</span><span class="op" id="6726049">*</span><span class="ident" id="6726050">TCPListener</span><span class="op" id="6726061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726064">defer</span>&nbsp;<span class="ident" id="6726070">ln</span><span class="op" id="6726072">.</span><span class="ident" id="6726073">Close</span><span class="op" id="6726078">(</span><span class="op" id="6726079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726083">go</span>&nbsp;<span class="keyword" id="6726086">func</span><span class="op" id="6726090">(</span><span class="op" id="6726091">)</span>&nbsp;<span class="op" id="6726093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726097">c</span><span class="op" id="6726098">,</span>&nbsp;<span class="ident" id="6726100">err</span>&nbsp;<span class="op" id="6726104">:=</span>&nbsp;<span class="ident" id="6726107">Dial</span><span class="op" id="6726111">(</span><span class="string" id="6726112">&#34;tcp&#34;</span><span class="op" id="6726117">,</span>&nbsp;<span class="ident" id="6726119">ln</span><span class="op" id="6726121">.</span><span class="ident" id="6726122">Addr</span><span class="op" id="6726126">(</span><span class="op" id="6726127">)</span><span class="op" id="6726128">.</span><span class="ident" id="6726129">String</span><span class="op" id="6726135">(</span><span class="op" id="6726136">)</span><span class="op" id="6726137">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726141">if</span>&nbsp;<span class="ident" id="6726144">err</span>&nbsp;<span class="op" id="6726148">!=</span>&nbsp;<span class="ident" id="6726151">nil</span>&nbsp;<span class="op" id="6726155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726160">t</span><span class="op" id="6726161">.</span><span class="ident" id="6726162">Errorf</span><span class="op" id="6726168">(</span><span class="string" id="6726169">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6726179">,</span>&nbsp;<span class="ident" id="6726181">err</span><span class="op" id="6726184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726189">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726202">defer</span>&nbsp;<span class="ident" id="6726208">c</span><span class="op" id="6726209">.</span><span class="ident" id="6726210">Close</span><span class="op" id="6726215">(</span><span class="op" id="6726216">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726220">var</span>&nbsp;<span class="ident" id="6726224">buf</span>&nbsp;<span class="op" id="6726228">[</span><span class="num" id="6726229">1</span><span class="op" id="6726230">]</span><span class="builtintype" id="6726231">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726238">c</span><span class="op" id="6726239">.</span><span class="ident" id="6726240">Read</span><span class="op" id="6726244">(</span><span class="ident" id="6726245">buf</span><span class="op" id="6726248">[</span><span class="op" id="6726249">:</span><span class="op" id="6726250">]</span><span class="op" id="6726251">)</span>&nbsp;<span class="comment" id="6726253">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726306">}</span><span class="op" id="6726307">(</span><span class="op" id="6726308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726311">time</span><span class="op" id="6726315">.</span><span class="ident" id="6726316">Sleep</span><span class="op" id="6726321">(</span><span class="num" id="6726322">10</span>&nbsp;<span class="op" id="6726325">*</span>&nbsp;<span class="ident" id="6726327">time</span><span class="op" id="6726331">.</span><span class="ident" id="6726332">Millisecond</span><span class="op" id="6726343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726346">ln</span><span class="op" id="6726348">.</span><span class="ident" id="6726349">SetDeadline</span><span class="op" id="6726360">(</span><span class="ident" id="6726361">time</span><span class="op" id="6726365">.</span><span class="ident" id="6726366">Now</span><span class="op" id="6726369">(</span><span class="op" id="6726370">)</span><span class="op" id="6726371">.</span><span class="ident" id="6726372">Add</span><span class="op" id="6726375">(</span><span class="op" id="6726376">-</span><span class="num" id="6726377">5</span>&nbsp;<span class="op" id="6726379">*</span>&nbsp;<span class="ident" id="6726381">time</span><span class="op" id="6726385">.</span><span class="ident" id="6726386">Second</span><span class="op" id="6726392">)</span><span class="op" id="6726393">)</span>&nbsp;<span class="comment" id="6726395">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726411">c</span><span class="op" id="6726412">,</span>&nbsp;<span class="ident" id="6726414">err</span>&nbsp;<span class="op" id="6726418">:=</span>&nbsp;<span class="ident" id="6726421">ln</span><span class="op" id="6726423">.</span><span class="ident" id="6726424">Accept</span><span class="op" id="6726430">(</span><span class="op" id="6726431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726434">if</span>&nbsp;<span class="ident" id="6726437">err</span>&nbsp;<span class="op" id="6726441">==</span>&nbsp;<span class="ident" id="6726444">nil</span>&nbsp;<span class="op" id="6726448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726452">defer</span>&nbsp;<span class="ident" id="6726458">c</span><span class="op" id="6726459">.</span><span class="ident" id="6726460">Close</span><span class="op" id="6726465">(</span><span class="op" id="6726466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726472">if</span>&nbsp;<span class="op" id="6726475">!</span><span class="ident" id="6726476">isTimeout</span><span class="op" id="6726485">(</span><span class="ident" id="6726486">err</span><span class="op" id="6726489">)</span>&nbsp;<span class="op" id="6726491">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726495">t</span><span class="op" id="6726496">.</span><span class="ident" id="6726497">Fatalf</span><span class="op" id="6726503">(</span><span class="string" id="6726504">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6726534">,</span>&nbsp;<span class="ident" id="6726536">err</span><span class="op" id="6726539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726542">}</span><br>
<span class="lineno"></span><span class="op" id="6726544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6726547">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="6726619">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="6726673">func</span>&nbsp;<span class="ident" id="6726678">TestConnectDeadlineInThePast</span><span class="op" id="6726706">(</span><span class="ident" id="6726707">t</span>&nbsp;<span class="op" id="6726709">*</span><span class="ident" id="6726710">testing</span><span class="op" id="6726717">.</span><span class="ident" id="6726718">T</span><span class="op" id="6726719">)</span>&nbsp;<span class="op" id="6726721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726724">switch</span>&nbsp;<span class="ident" id="6726731">runtime</span><span class="op" id="6726738">.</span><span class="ident" id="6726739">GOOS</span>&nbsp;<span class="op" id="6726744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726747">case</span>&nbsp;<span class="string" id="6726752">&#34;plan9&#34;</span><span class="op" id="6726759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726763">t</span><span class="op" id="6726764">.</span><span class="ident" id="6726765">Skipf</span><span class="op" id="6726770">(</span><span class="string" id="6726771">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6726792">,</span>&nbsp;<span class="ident" id="6726794">runtime</span><span class="op" id="6726801">.</span><span class="ident" id="6726802">GOOS</span><span class="op" id="6726806">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726813">ln</span>&nbsp;<span class="op" id="6726816">:=</span>&nbsp;<span class="ident" id="6726819">newLocalListener</span><span class="op" id="6726835">(</span><span class="ident" id="6726836">t</span><span class="op" id="6726837">)</span><span class="op" id="6726838">.</span><span class="op" id="6726839">(</span><span class="op" id="6726840">*</span><span class="ident" id="6726841">TCPListener</span><span class="op" id="6726852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726855">defer</span>&nbsp;<span class="ident" id="6726861">ln</span><span class="op" id="6726863">.</span><span class="ident" id="6726864">Close</span><span class="op" id="6726869">(</span><span class="op" id="6726870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726874">go</span>&nbsp;<span class="keyword" id="6726877">func</span><span class="op" id="6726881">(</span><span class="op" id="6726882">)</span>&nbsp;<span class="op" id="6726884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726888">c</span><span class="op" id="6726889">,</span>&nbsp;<span class="ident" id="6726891">err</span>&nbsp;<span class="op" id="6726895">:=</span>&nbsp;<span class="ident" id="6726898">ln</span><span class="op" id="6726900">.</span><span class="ident" id="6726901">Accept</span><span class="op" id="6726907">(</span><span class="op" id="6726908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726912">if</span>&nbsp;<span class="ident" id="6726915">err</span>&nbsp;<span class="op" id="6726919">==</span>&nbsp;<span class="ident" id="6726922">nil</span>&nbsp;<span class="op" id="6726926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726931">defer</span>&nbsp;<span class="ident" id="6726937">c</span><span class="op" id="6726938">.</span><span class="ident" id="6726939">Close</span><span class="op" id="6726944">(</span><span class="op" id="6726945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726949">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726952">}</span><span class="op" id="6726953">(</span><span class="op" id="6726954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726957">time</span><span class="op" id="6726961">.</span><span class="ident" id="6726962">Sleep</span><span class="op" id="6726967">(</span><span class="num" id="6726968">10</span>&nbsp;<span class="op" id="6726971">*</span>&nbsp;<span class="ident" id="6726973">time</span><span class="op" id="6726977">.</span><span class="ident" id="6726978">Millisecond</span><span class="op" id="6726989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726992">c</span><span class="op" id="6726993">,</span>&nbsp;<span class="ident" id="6726995">err</span>&nbsp;<span class="op" id="6726999">:=</span>&nbsp;<span class="ident" id="6727002">DialTimeout</span><span class="op" id="6727013">(</span><span class="string" id="6727014">&#34;tcp&#34;</span><span class="op" id="6727019">,</span>&nbsp;<span class="ident" id="6727021">ln</span><span class="op" id="6727023">.</span><span class="ident" id="6727024">Addr</span><span class="op" id="6727028">(</span><span class="op" id="6727029">)</span><span class="op" id="6727030">.</span><span class="ident" id="6727031">String</span><span class="op" id="6727037">(</span><span class="op" id="6727038">)</span><span class="op" id="6727039">,</span>&nbsp;<span class="op" id="6727041">-</span><span class="num" id="6727042">5</span><span class="op" id="6727043">*</span><span class="ident" id="6727044">time</span><span class="op" id="6727048">.</span><span class="ident" id="6727049">Second</span><span class="op" id="6727055">)</span>&nbsp;<span class="comment" id="6727057">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727073">if</span>&nbsp;<span class="ident" id="6727076">err</span>&nbsp;<span class="op" id="6727080">==</span>&nbsp;<span class="ident" id="6727083">nil</span>&nbsp;<span class="op" id="6727087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727091">defer</span>&nbsp;<span class="ident" id="6727097">c</span><span class="op" id="6727098">.</span><span class="ident" id="6727099">Close</span><span class="op" id="6727104">(</span><span class="op" id="6727105">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727111">if</span>&nbsp;<span class="op" id="6727114">!</span><span class="ident" id="6727115">isTimeout</span><span class="op" id="6727124">(</span><span class="ident" id="6727125">err</span><span class="op" id="6727128">)</span>&nbsp;<span class="op" id="6727130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727134">t</span><span class="op" id="6727135">.</span><span class="ident" id="6727136">Fatalf</span><span class="op" id="6727142">(</span><span class="string" id="6727143">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="6727178">,</span>&nbsp;<span class="ident" id="6727180">err</span><span class="op" id="6727183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727186">}</span><br>
<span class="lineno"></span><span class="op" id="6727188">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="6727191">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="6727253">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="6727295">func</span>&nbsp;<span class="ident" id="6727300">TestProlongTimeout</span><span class="op" id="6727318">(</span><span class="ident" id="6727319">t</span>&nbsp;<span class="op" id="6727321">*</span><span class="ident" id="6727322">testing</span><span class="op" id="6727329">.</span><span class="ident" id="6727330">T</span><span class="op" id="6727331">)</span>&nbsp;<span class="op" id="6727333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727336">switch</span>&nbsp;<span class="ident" id="6727343">runtime</span><span class="op" id="6727350">.</span><span class="ident" id="6727351">GOOS</span>&nbsp;<span class="op" id="6727356">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727359">case</span>&nbsp;<span class="string" id="6727364">&#34;plan9&#34;</span><span class="op" id="6727371">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727375">t</span><span class="op" id="6727376">.</span><span class="ident" id="6727377">Skipf</span><span class="op" id="6727382">(</span><span class="string" id="6727383">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6727404">,</span>&nbsp;<span class="ident" id="6727406">runtime</span><span class="op" id="6727413">.</span><span class="ident" id="6727414">GOOS</span><span class="op" id="6727418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727425">ln</span>&nbsp;<span class="op" id="6727428">:=</span>&nbsp;<span class="ident" id="6727431">newLocalListener</span><span class="op" id="6727447">(</span><span class="ident" id="6727448">t</span><span class="op" id="6727449">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727452">defer</span>&nbsp;<span class="ident" id="6727458">ln</span><span class="op" id="6727460">.</span><span class="ident" id="6727461">Close</span><span class="op" id="6727466">(</span><span class="op" id="6727467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727470">connected</span>&nbsp;<span class="op" id="6727480">:=</span>&nbsp;<span class="builtinfunc" id="6727483">make</span><span class="op" id="6727487">(</span><span class="keyword" id="6727488">chan</span>&nbsp;<span class="builtintype" id="6727493">bool</span><span class="op" id="6727497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727500">go</span>&nbsp;<span class="keyword" id="6727503">func</span><span class="op" id="6727507">(</span><span class="op" id="6727508">)</span>&nbsp;<span class="op" id="6727510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727514">s</span><span class="op" id="6727515">,</span>&nbsp;<span class="ident" id="6727517">err</span>&nbsp;<span class="op" id="6727521">:=</span>&nbsp;<span class="ident" id="6727524">ln</span><span class="op" id="6727526">.</span><span class="ident" id="6727527">Accept</span><span class="op" id="6727533">(</span><span class="op" id="6727534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727538">connected</span>&nbsp;<span class="op" id="6727548">&lt;-</span>&nbsp;<span class="builtintype" id="6727551">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727558">if</span>&nbsp;<span class="ident" id="6727561">err</span>&nbsp;<span class="op" id="6727565">!=</span>&nbsp;<span class="ident" id="6727568">nil</span>&nbsp;<span class="op" id="6727572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727577">t</span><span class="op" id="6727578">.</span><span class="ident" id="6727579">Errorf</span><span class="op" id="6727585">(</span><span class="string" id="6727586">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="6727601">,</span>&nbsp;<span class="ident" id="6727603">err</span><span class="op" id="6727606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727611">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727624">defer</span>&nbsp;<span class="ident" id="6727630">s</span><span class="op" id="6727631">.</span><span class="ident" id="6727632">Close</span><span class="op" id="6727637">(</span><span class="op" id="6727638">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727642">s</span><span class="op" id="6727643">.</span><span class="ident" id="6727644">SetDeadline</span><span class="op" id="6727655">(</span><span class="ident" id="6727656">time</span><span class="op" id="6727660">.</span><span class="ident" id="6727661">Now</span><span class="op" id="6727664">(</span><span class="op" id="6727665">)</span><span class="op" id="6727666">.</span><span class="ident" id="6727667">Add</span><span class="op" id="6727670">(</span><span class="ident" id="6727671">time</span><span class="op" id="6727675">.</span><span class="ident" id="6727676">Hour</span><span class="op" id="6727680">)</span><span class="op" id="6727681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727685">go</span>&nbsp;<span class="keyword" id="6727688">func</span><span class="op" id="6727692">(</span><span class="op" id="6727693">)</span>&nbsp;<span class="op" id="6727695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727700">var</span>&nbsp;<span class="ident" id="6727704">buf</span>&nbsp;<span class="op" id="6727708">[</span><span class="num" id="6727709">4096</span><span class="op" id="6727713">]</span><span class="builtintype" id="6727714">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727722">for</span>&nbsp;<span class="op" id="6727726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727732">_</span><span class="op" id="6727733">,</span>&nbsp;<span class="ident" id="6727735">err</span>&nbsp;<span class="op" id="6727739">:=</span>&nbsp;<span class="ident" id="6727742">s</span><span class="op" id="6727743">.</span><span class="ident" id="6727744">Write</span><span class="op" id="6727749">(</span><span class="ident" id="6727750">buf</span><span class="op" id="6727753">[</span><span class="op" id="6727754">:</span><span class="op" id="6727755">]</span><span class="op" id="6727756">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727762">if</span>&nbsp;<span class="ident" id="6727765">err</span>&nbsp;<span class="op" id="6727769">!=</span>&nbsp;<span class="ident" id="6727772">nil</span>&nbsp;<span class="op" id="6727776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727783">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727799">s</span><span class="op" id="6727800">.</span><span class="ident" id="6727801">SetDeadline</span><span class="op" id="6727812">(</span><span class="ident" id="6727813">time</span><span class="op" id="6727817">.</span><span class="ident" id="6727818">Now</span><span class="op" id="6727821">(</span><span class="op" id="6727822">)</span><span class="op" id="6727823">.</span><span class="ident" id="6727824">Add</span><span class="op" id="6727827">(</span><span class="ident" id="6727828">time</span><span class="op" id="6727832">.</span><span class="ident" id="6727833">Hour</span><span class="op" id="6727837">)</span><span class="op" id="6727838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727843">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727847">}</span><span class="op" id="6727848">(</span><span class="op" id="6727849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727853">buf</span>&nbsp;<span class="op" id="6727857">:=</span>&nbsp;<span class="builtinfunc" id="6727860">make</span><span class="op" id="6727864">(</span><span class="op" id="6727865">[</span><span class="op" id="6727866">]</span><span class="builtintype" id="6727867">byte</span><span class="op" id="6727871">,</span>&nbsp;<span class="num" id="6727873">1</span><span class="op" id="6727874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727878">for</span>&nbsp;<span class="op" id="6727882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727887">_</span><span class="op" id="6727888">,</span>&nbsp;<span class="ident" id="6727890">err</span>&nbsp;<span class="op" id="6727894">:=</span>&nbsp;<span class="ident" id="6727897">s</span><span class="op" id="6727898">.</span><span class="ident" id="6727899">Read</span><span class="op" id="6727903">(</span><span class="ident" id="6727904">buf</span><span class="op" id="6727907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727912">if</span>&nbsp;<span class="ident" id="6727915">err</span>&nbsp;<span class="op" id="6727919">!=</span>&nbsp;<span class="ident" id="6727922">nil</span>&nbsp;<span class="op" id="6727926">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727932">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727946">s</span><span class="op" id="6727947">.</span><span class="ident" id="6727948">SetDeadline</span><span class="op" id="6727959">(</span><span class="ident" id="6727960">time</span><span class="op" id="6727964">.</span><span class="ident" id="6727965">Now</span><span class="op" id="6727968">(</span><span class="op" id="6727969">)</span><span class="op" id="6727970">.</span><span class="ident" id="6727971">Add</span><span class="op" id="6727974">(</span><span class="ident" id="6727975">time</span><span class="op" id="6727979">.</span><span class="ident" id="6727980">Hour</span><span class="op" id="6727984">)</span><span class="op" id="6727985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727992">}</span><span class="op" id="6727993">(</span><span class="op" id="6727994">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727997">c</span><span class="op" id="6727998">,</span>&nbsp;<span class="ident" id="6728000">err</span>&nbsp;<span class="op" id="6728004">:=</span>&nbsp;<span class="ident" id="6728007">Dial</span><span class="op" id="6728011">(</span><span class="string" id="6728012">&#34;tcp&#34;</span><span class="op" id="6728017">,</span>&nbsp;<span class="ident" id="6728019">ln</span><span class="op" id="6728021">.</span><span class="ident" id="6728022">Addr</span><span class="op" id="6728026">(</span><span class="op" id="6728027">)</span><span class="op" id="6728028">.</span><span class="ident" id="6728029">String</span><span class="op" id="6728035">(</span><span class="op" id="6728036">)</span><span class="op" id="6728037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728040">if</span>&nbsp;<span class="ident" id="6728043">err</span>&nbsp;<span class="op" id="6728047">!=</span>&nbsp;<span class="ident" id="6728050">nil</span>&nbsp;<span class="op" id="6728054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728058">t</span><span class="op" id="6728059">.</span><span class="ident" id="6728060">Fatalf</span><span class="op" id="6728066">(</span><span class="string" id="6728067">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="6728080">,</span>&nbsp;<span class="ident" id="6728082">err</span><span class="op" id="6728085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728091">defer</span>&nbsp;<span class="ident" id="6728097">c</span><span class="op" id="6728098">.</span><span class="ident" id="6728099">Close</span><span class="op" id="6728104">(</span><span class="op" id="6728105">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728108">&lt;-</span><span class="ident" id="6728110">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728121">for</span>&nbsp;<span class="ident" id="6728125">i</span>&nbsp;<span class="op" id="6728127">:=</span>&nbsp;<span class="num" id="6728130">0</span><span class="op" id="6728131">;</span>&nbsp;<span class="ident" id="6728133">i</span>&nbsp;<span class="op" id="6728135">&lt;</span>&nbsp;<span class="num" id="6728137">1024</span><span class="op" id="6728141">;</span>&nbsp;<span class="ident" id="6728143">i</span><span class="op" id="6728144">++</span>&nbsp;<span class="op" id="6728147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728151">var</span>&nbsp;<span class="ident" id="6728155">buf</span>&nbsp;<span class="op" id="6728159">[</span><span class="num" id="6728160">1</span><span class="op" id="6728161">]</span><span class="builtintype" id="6728162">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728169">c</span><span class="op" id="6728170">.</span><span class="ident" id="6728171">Write</span><span class="op" id="6728176">(</span><span class="ident" id="6728177">buf</span><span class="op" id="6728180">[</span><span class="op" id="6728181">:</span><span class="op" id="6728182">]</span><span class="op" id="6728183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728186">}</span><br>
<span class="lineno">710</span><span class="op" id="6728188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6728191">func</span>&nbsp;<span class="ident" id="6728196">TestDeadlineRace</span><span class="op" id="6728212">(</span><span class="ident" id="6728213">t</span>&nbsp;<span class="op" id="6728215">*</span><span class="ident" id="6728216">testing</span><span class="op" id="6728223">.</span><span class="ident" id="6728224">T</span><span class="op" id="6728225">)</span>&nbsp;<span class="op" id="6728227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728230">switch</span>&nbsp;<span class="ident" id="6728237">runtime</span><span class="op" id="6728244">.</span><span class="ident" id="6728245">GOOS</span>&nbsp;<span class="op" id="6728250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728253">case</span>&nbsp;<span class="string" id="6728258">&#34;nacl&#34;</span><span class="op" id="6728264">,</span>&nbsp;<span class="string" id="6728266">&#34;plan9&#34;</span><span class="op" id="6728273">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728277">t</span><span class="op" id="6728278">.</span><span class="ident" id="6728279">Skipf</span><span class="op" id="6728284">(</span><span class="string" id="6728285">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6728306">,</span>&nbsp;<span class="ident" id="6728308">runtime</span><span class="op" id="6728315">.</span><span class="ident" id="6728316">GOOS</span><span class="op" id="6728320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728327">N</span>&nbsp;<span class="op" id="6728329">:=</span>&nbsp;<span class="num" id="6728332">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728338">if</span>&nbsp;<span class="ident" id="6728341">testing</span><span class="op" id="6728348">.</span><span class="ident" id="6728349">Short</span><span class="op" id="6728354">(</span><span class="op" id="6728355">)</span>&nbsp;<span class="op" id="6728357">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728361">N</span>&nbsp;<span class="op" id="6728363">=</span>&nbsp;<span class="num" id="6728365">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728372">defer</span>&nbsp;<span class="ident" id="6728378">runtime</span><span class="op" id="6728385">.</span><span class="ident" id="6728386">GOMAXPROCS</span><span class="op" id="6728396">(</span><span class="ident" id="6728397">runtime</span><span class="op" id="6728404">.</span><span class="ident" id="6728405">GOMAXPROCS</span><span class="op" id="6728415">(</span><span class="num" id="6728416">4</span><span class="op" id="6728417">)</span><span class="op" id="6728418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728421">ln</span>&nbsp;<span class="op" id="6728424">:=</span>&nbsp;<span class="ident" id="6728427">newLocalListener</span><span class="op" id="6728443">(</span><span class="ident" id="6728444">t</span><span class="op" id="6728445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728448">defer</span>&nbsp;<span class="ident" id="6728454">ln</span><span class="op" id="6728456">.</span><span class="ident" id="6728457">Close</span><span class="op" id="6728462">(</span><span class="op" id="6728463">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728466">c</span><span class="op" id="6728467">,</span>&nbsp;<span class="ident" id="6728469">err</span>&nbsp;<span class="op" id="6728473">:=</span>&nbsp;<span class="ident" id="6728476">Dial</span><span class="op" id="6728480">(</span><span class="string" id="6728481">&#34;tcp&#34;</span><span class="op" id="6728486">,</span>&nbsp;<span class="ident" id="6728488">ln</span><span class="op" id="6728490">.</span><span class="ident" id="6728491">Addr</span><span class="op" id="6728495">(</span><span class="op" id="6728496">)</span><span class="op" id="6728497">.</span><span class="ident" id="6728498">String</span><span class="op" id="6728504">(</span><span class="op" id="6728505">)</span><span class="op" id="6728506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728509">if</span>&nbsp;<span class="ident" id="6728512">err</span>&nbsp;<span class="op" id="6728516">!=</span>&nbsp;<span class="ident" id="6728519">nil</span>&nbsp;<span class="op" id="6728523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728527">t</span><span class="op" id="6728528">.</span><span class="ident" id="6728529">Fatalf</span><span class="op" id="6728535">(</span><span class="string" id="6728536">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="6728546">,</span>&nbsp;<span class="ident" id="6728548">err</span><span class="op" id="6728551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728557">defer</span>&nbsp;<span class="ident" id="6728563">c</span><span class="op" id="6728564">.</span><span class="ident" id="6728565">Close</span><span class="op" id="6728570">(</span><span class="op" id="6728571">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728574">done</span>&nbsp;<span class="op" id="6728579">:=</span>&nbsp;<span class="builtinfunc" id="6728582">make</span><span class="op" id="6728586">(</span><span class="keyword" id="6728587">chan</span>&nbsp;<span class="builtintype" id="6728592">bool</span><span class="op" id="6728596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728599">go</span>&nbsp;<span class="keyword" id="6728602">func</span><span class="op" id="6728606">(</span><span class="op" id="6728607">)</span>&nbsp;<span class="op" id="6728609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728613">t</span>&nbsp;<span class="op" id="6728615">:=</span>&nbsp;<span class="ident" id="6728618">time</span><span class="op" id="6728622">.</span><span class="ident" id="6728623">NewTicker</span><span class="op" id="6728632">(</span><span class="num" id="6728633">2</span>&nbsp;<span class="op" id="6728635">*</span>&nbsp;<span class="ident" id="6728637">time</span><span class="op" id="6728641">.</span><span class="ident" id="6728642">Microsecond</span><span class="op" id="6728653">)</span><span class="op" id="6728654">.</span><span class="ident" id="6728655">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728659">for</span>&nbsp;<span class="ident" id="6728663">i</span>&nbsp;<span class="op" id="6728665">:=</span>&nbsp;<span class="num" id="6728668">0</span><span class="op" id="6728669">;</span>&nbsp;<span class="ident" id="6728671">i</span>&nbsp;<span class="op" id="6728673">&lt;</span>&nbsp;<span class="ident" id="6728675">N</span><span class="op" id="6728676">;</span>&nbsp;<span class="ident" id="6728678">i</span><span class="op" id="6728679">++</span>&nbsp;<span class="op" id="6728682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728687">if</span>&nbsp;<span class="ident" id="6728690">err</span>&nbsp;<span class="op" id="6728694">:=</span>&nbsp;<span class="ident" id="6728697">c</span><span class="op" id="6728698">.</span><span class="ident" id="6728699">SetDeadline</span><span class="op" id="6728710">(</span><span class="ident" id="6728711">time</span><span class="op" id="6728715">.</span><span class="ident" id="6728716">Now</span><span class="op" id="6728719">(</span><span class="op" id="6728720">)</span><span class="op" id="6728721">.</span><span class="ident" id="6728722">Add</span><span class="op" id="6728725">(</span><span class="num" id="6728726">2</span>&nbsp;<span class="op" id="6728728">*</span>&nbsp;<span class="ident" id="6728730">time</span><span class="op" id="6728734">.</span><span class="ident" id="6728735">Microsecond</span><span class="op" id="6728746">)</span><span class="op" id="6728747">)</span><span class="op" id="6728748">;</span>&nbsp;<span class="ident" id="6728750">err</span>&nbsp;<span class="op" id="6728754">!=</span>&nbsp;<span class="ident" id="6728757">nil</span>&nbsp;<span class="op" id="6728761">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728767">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728781">&lt;-</span><span class="ident" id="6728783">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728791">done</span>&nbsp;<span class="op" id="6728796">&lt;-</span>&nbsp;<span class="builtintype" id="6728799">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728805">}</span><span class="op" id="6728806">(</span><span class="op" id="6728807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728810">var</span>&nbsp;<span class="ident" id="6728814">buf</span>&nbsp;<span class="op" id="6728818">[</span><span class="num" id="6728819">1</span><span class="op" id="6728820">]</span><span class="builtintype" id="6728821">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728827">for</span>&nbsp;<span class="ident" id="6728831">i</span>&nbsp;<span class="op" id="6728833">:=</span>&nbsp;<span class="num" id="6728836">0</span><span class="op" id="6728837">;</span>&nbsp;<span class="ident" id="6728839">i</span>&nbsp;<span class="op" id="6728841">&lt;</span>&nbsp;<span class="ident" id="6728843">N</span><span class="op" id="6728844">;</span>&nbsp;<span class="ident" id="6728846">i</span><span class="op" id="6728847">++</span>&nbsp;<span class="op" id="6728850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728854">c</span><span class="op" id="6728855">.</span><span class="ident" id="6728856">Read</span><span class="op" id="6728860">(</span><span class="ident" id="6728861">buf</span><span class="op" id="6728864">[</span><span class="op" id="6728865">:</span><span class="op" id="6728866">]</span><span class="op" id="6728867">)</span>&nbsp;<span class="comment" id="6728869">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728904">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728907">c</span><span class="op" id="6728908">.</span><span class="ident" id="6728909">Close</span><span class="op" id="6728914">(</span><span class="op" id="6728915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728918">&lt;-</span><span class="ident" id="6728920">done</span><br>
<span class="lineno"></span><span class="op" id="6728925">}</span>
</div>
</body>
</html>
