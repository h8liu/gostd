<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html" class="current">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3314709">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3314764">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3314818">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3314869">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;printing&nbsp;support&nbsp;for&nbsp;ASTs.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3314919">package</span>&nbsp;<span class="ident" id="3314927">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3314932">import</span>&nbsp;<span class="op" id="3314939">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3314942">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3314949">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3314961">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3314967">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3314973">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3314983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3314986">//&nbsp;A&nbsp;FieldFilter&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Fprint&nbsp;to&nbsp;control&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3315052">type</span>&nbsp;<span class="ident" id="3315057">FieldFilter</span>&nbsp;<span class="keyword" id="3315069">func</span><span class="op" id="3315073">(</span><span class="ident" id="3315074">name</span>&nbsp;<span class="builtintype" id="3315079">string</span><span class="op" id="3315085">,</span>&nbsp;<span class="ident" id="3315087">value</span>&nbsp;<span class="ident" id="3315093">reflect</span><span class="op" id="3315100">.</span><span class="ident" id="3315101">Value</span><span class="op" id="3315106">)</span>&nbsp;<span class="builtintype" id="3315108">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3315114">//&nbsp;NotNilFilter&nbsp;returns&nbsp;true&nbsp;for&nbsp;field&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;nil;</span><br>
<span class="lineno"></span><span class="comment" id="3315178">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3315209">func</span>&nbsp;<span class="ident" id="3315214">NotNilFilter</span><span class="op" id="3315226">(</span><span class="ident" id="3315227">_</span>&nbsp;<span class="builtintype" id="3315229">string</span><span class="op" id="3315235">,</span>&nbsp;<span class="ident" id="3315237">v</span>&nbsp;<span class="ident" id="3315239">reflect</span><span class="op" id="3315246">.</span><span class="ident" id="3315247">Value</span><span class="op" id="3315252">)</span>&nbsp;<span class="builtintype" id="3315254">bool</span>&nbsp;<span class="op" id="3315259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315262">switch</span>&nbsp;<span class="ident" id="3315269">v</span><span class="op" id="3315270">.</span><span class="ident" id="3315271">Kind</span><span class="op" id="3315275">(</span><span class="op" id="3315276">)</span>&nbsp;<span class="op" id="3315278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315281">case</span>&nbsp;<span class="ident" id="3315286">reflect</span><span class="op" id="3315293">.</span><span class="ident" id="3315294">Chan</span><span class="op" id="3315298">,</span>&nbsp;<span class="ident" id="3315300">reflect</span><span class="op" id="3315307">.</span><span class="ident" id="3315308">Func</span><span class="op" id="3315312">,</span>&nbsp;<span class="ident" id="3315314">reflect</span><span class="op" id="3315321">.</span><span class="ident" id="3315322">Interface</span><span class="op" id="3315331">,</span>&nbsp;<span class="ident" id="3315333">reflect</span><span class="op" id="3315340">.</span><span class="ident" id="3315341">Map</span><span class="op" id="3315344">,</span>&nbsp;<span class="ident" id="3315346">reflect</span><span class="op" id="3315353">.</span><span class="ident" id="3315354">Ptr</span><span class="op" id="3315357">,</span>&nbsp;<span class="ident" id="3315359">reflect</span><span class="op" id="3315366">.</span><span class="ident" id="3315367">Slice</span><span class="op" id="3315372">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315376">return</span>&nbsp;<span class="op" id="3315383">!</span><span class="ident" id="3315384">v</span><span class="op" id="3315385">.</span><span class="ident" id="3315386">IsNil</span><span class="op" id="3315391">(</span><span class="op" id="3315392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3315395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3315398">return</span>&nbsp;<span class="builtintype" id="3315405">true</span><br>
<span class="lineno"></span><span class="op" id="3315410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="3315413">//&nbsp;Fprint&nbsp;prints&nbsp;the&nbsp;(sub-)tree&nbsp;starting&nbsp;at&nbsp;AST&nbsp;node&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3315474">//&nbsp;If&nbsp;fset&nbsp;!=&nbsp;nil,&nbsp;position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative</span><br>
<span class="lineno"></span><span class="comment" id="3315538">//&nbsp;to&nbsp;that&nbsp;file&nbsp;set.&nbsp;Otherwise&nbsp;positions&nbsp;are&nbsp;printed&nbsp;as&nbsp;integer</span><br>
<span class="lineno"></span><span class="comment" id="3315602">//&nbsp;values&nbsp;(file&nbsp;set&nbsp;specific&nbsp;offsets).</span><br>
<span class="lineno"></span><span class="comment" id="3315641">//</span><br>
<span class="lineno">35</span><span class="comment" id="3315644">//&nbsp;A&nbsp;non-nil&nbsp;FieldFilter&nbsp;f&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;control&nbsp;the&nbsp;output:</span><br>
<span class="lineno"></span><span class="comment" id="3315710">//&nbsp;struct&nbsp;fields&nbsp;for&nbsp;which&nbsp;f(fieldname,&nbsp;fieldvalue)&nbsp;is&nbsp;true&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3315774">//&nbsp;printed;&nbsp;all&nbsp;others&nbsp;are&nbsp;filtered&nbsp;from&nbsp;the&nbsp;output.&nbsp;Unexported</span><br>
<span class="lineno"></span><span class="comment" id="3315838">//&nbsp;struct&nbsp;fields&nbsp;are&nbsp;never&nbsp;printed.</span><br>
<span class="lineno"></span><span class="comment" id="3315874">//</span><br>
<span class="lineno">40</span><span class="keyword" id="3315877">func</span>&nbsp;<span class="ident" id="3315882">Fprint</span><span class="op" id="3315888">(</span><span class="ident" id="3315889">w</span>&nbsp;<span class="ident" id="3315891">io</span><span class="op" id="3315893">.</span><span class="ident" id="3315894">Writer</span><span class="op" id="3315900">,</span>&nbsp;<span class="ident" id="3315902">fset</span>&nbsp;<span class="op" id="3315907">*</span><span class="ident" id="3315908">token</span><span class="op" id="3315913">.</span><span class="ident" id="3315914">FileSet</span><span class="op" id="3315921">,</span>&nbsp;<span class="ident" id="3315923">x</span>&nbsp;<span class="keyword" id="3315925">interface</span><span class="op" id="3315934">{</span><span class="op" id="3315935">}</span><span class="op" id="3315936">,</span>&nbsp;<span class="ident" id="3315938">f</span>&nbsp;<span class="ident" id="3315940">FieldFilter</span><span class="op" id="3315951">)</span>&nbsp;<span class="op" id="3315953">(</span><span class="ident" id="3315954">err</span>&nbsp;<span class="builtintype" id="3315958">error</span><span class="op" id="3315963">)</span>&nbsp;<span class="op" id="3315965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3315968">//&nbsp;setup&nbsp;printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3315986">p</span>&nbsp;<span class="op" id="3315988">:=</span>&nbsp;<span class="ident" id="3315991">printer</span><span class="op" id="3315998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316002">output</span><span class="op" id="3316008">:</span>&nbsp;<span class="ident" id="3316010">w</span><span class="op" id="3316011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316015">fset</span><span class="op" id="3316019">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3316023">fset</span><span class="op" id="3316027">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316031">filter</span><span class="op" id="3316037">:</span>&nbsp;<span class="ident" id="3316039">f</span><span class="op" id="3316040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316044">ptrmap</span><span class="op" id="3316050">:</span>&nbsp;<span class="builtinfunc" id="3316052">make</span><span class="op" id="3316056">(</span><span class="keyword" id="3316057">map</span><span class="op" id="3316060">[</span><span class="keyword" id="3316061">interface</span><span class="op" id="3316070">{</span><span class="op" id="3316071">}</span><span class="op" id="3316072">]</span><span class="builtintype" id="3316073">int</span><span class="op" id="3316076">)</span><span class="op" id="3316077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316081">last</span><span class="op" id="3316085">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="3316089">&#39;\n&#39;</span><span class="op" id="3316093">,</span>&nbsp;<span class="comment" id="3316095">//&nbsp;force&nbsp;printing&nbsp;of&nbsp;line&nbsp;number&nbsp;on&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3316143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3316147">//&nbsp;install&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316173">defer</span>&nbsp;<span class="keyword" id="3316179">func</span><span class="op" id="3316183">(</span><span class="op" id="3316184">)</span>&nbsp;<span class="op" id="3316186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316190">if</span>&nbsp;<span class="ident" id="3316193">e</span>&nbsp;<span class="op" id="3316195">:=</span>&nbsp;<span class="builtinfunc" id="3316198">recover</span><span class="op" id="3316205">(</span><span class="op" id="3316206">)</span><span class="op" id="3316207">;</span>&nbsp;<span class="ident" id="3316209">e</span>&nbsp;<span class="op" id="3316211">!=</span>&nbsp;<span class="ident" id="3316214">nil</span>&nbsp;<span class="op" id="3316218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316223">err</span>&nbsp;<span class="op" id="3316227">=</span>&nbsp;<span class="ident" id="3316229">e</span><span class="op" id="3316230">.</span><span class="op" id="3316231">(</span><span class="ident" id="3316232">localError</span><span class="op" id="3316242">)</span><span class="op" id="3316243">.</span><span class="ident" id="3316244">err</span>&nbsp;<span class="comment" id="3316248">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;localError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3316288">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3316291">}</span><span class="op" id="3316292">(</span><span class="op" id="3316293">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3316297">//&nbsp;print&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316309">if</span>&nbsp;<span class="ident" id="3316312">x</span>&nbsp;<span class="op" id="3316314">==</span>&nbsp;<span class="ident" id="3316317">nil</span>&nbsp;<span class="op" id="3316321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316325">p</span><span class="op" id="3316326">.</span><span class="ident" id="3316327">printf</span><span class="op" id="3316333">(</span><span class="string" id="3316334">&#34;nil\n&#34;</span><span class="op" id="3316341">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3316353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316356">p</span><span class="op" id="3316357">.</span><span class="builtinfunc" id="3316358">print</span><span class="op" id="3316363">(</span><span class="ident" id="3316364">reflect</span><span class="op" id="3316371">.</span><span class="ident" id="3316372">ValueOf</span><span class="op" id="3316379">(</span><span class="ident" id="3316380">x</span><span class="op" id="3316381">)</span><span class="op" id="3316382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316385">p</span><span class="op" id="3316386">.</span><span class="ident" id="3316387">printf</span><span class="op" id="3316393">(</span><span class="string" id="3316394">&#34;\n&#34;</span><span class="op" id="3316398">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316402">return</span><br>
<span class="lineno"></span><span class="op" id="3316409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3316412">//&nbsp;Print&nbsp;prints&nbsp;x&nbsp;to&nbsp;standard&nbsp;output,&nbsp;skipping&nbsp;nil&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="3316471">//&nbsp;Print(fset,&nbsp;x)&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;Fprint(os.Stdout,&nbsp;fset,&nbsp;x,&nbsp;NotNilFilter).</span><br>
<span class="lineno">70</span><span class="keyword" id="3316546">func</span>&nbsp;<span class="ident" id="3316551">Print</span><span class="op" id="3316556">(</span><span class="ident" id="3316557">fset</span>&nbsp;<span class="op" id="3316562">*</span><span class="ident" id="3316563">token</span><span class="op" id="3316568">.</span><span class="ident" id="3316569">FileSet</span><span class="op" id="3316576">,</span>&nbsp;<span class="ident" id="3316578">x</span>&nbsp;<span class="keyword" id="3316580">interface</span><span class="op" id="3316589">{</span><span class="op" id="3316590">}</span><span class="op" id="3316591">)</span>&nbsp;<span class="builtintype" id="3316593">error</span>&nbsp;<span class="op" id="3316599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3316602">return</span>&nbsp;<span class="ident" id="3316609">Fprint</span><span class="op" id="3316615">(</span><span class="ident" id="3316616">os</span><span class="op" id="3316618">.</span><span class="ident" id="3316619">Stdout</span><span class="op" id="3316625">,</span>&nbsp;<span class="ident" id="3316627">fset</span><span class="op" id="3316631">,</span>&nbsp;<span class="ident" id="3316633">x</span><span class="op" id="3316634">,</span>&nbsp;<span class="ident" id="3316636">NotNilFilter</span><span class="op" id="3316648">)</span><br>
<span class="lineno"></span><span class="op" id="3316650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3316653">type</span>&nbsp;<span class="ident" id="3316658">printer</span>&nbsp;<span class="keyword" id="3316666">struct</span>&nbsp;<span class="op" id="3316673">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316676">output</span>&nbsp;<span class="ident" id="3316683">io</span><span class="op" id="3316685">.</span><span class="ident" id="3316686">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316694">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3316701">*</span><span class="ident" id="3316702">token</span><span class="op" id="3316707">.</span><span class="ident" id="3316708">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316717">filter</span>&nbsp;<span class="ident" id="3316724">FieldFilter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316737">ptrmap</span>&nbsp;<span class="keyword" id="3316744">map</span><span class="op" id="3316747">[</span><span class="keyword" id="3316748">interface</span><span class="op" id="3316757">{</span><span class="op" id="3316758">}</span><span class="op" id="3316759">]</span><span class="builtintype" id="3316760">int</span>&nbsp;<span class="comment" id="3316764">//&nbsp;*T&nbsp;-&gt;&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316786">indent</span>&nbsp;<span class="builtintype" id="3316793">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3316813">//&nbsp;current&nbsp;indentation&nbsp;level</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316843">last</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3316850">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3316870">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;processed&nbsp;by&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3316907">line</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3316914">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3316934">//&nbsp;current&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="op" id="3316957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3316960">var</span>&nbsp;<span class="ident" id="3316964">indent</span>&nbsp;<span class="op" id="3316971">=</span>&nbsp;<span class="op" id="3316973">[</span><span class="op" id="3316974">]</span><span class="builtintype" id="3316975">byte</span><span class="op" id="3316979">(</span><span class="string" id="3316980">&#34;.&nbsp;&nbsp;&#34;</span><span class="op" id="3316985">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3316988">func</span>&nbsp;<span class="op" id="3316993">(</span><span class="ident" id="3316994">p</span>&nbsp;<span class="op" id="3316996">*</span><span class="ident" id="3316997">printer</span><span class="op" id="3317004">)</span>&nbsp;<span class="ident" id="3317006">Write</span><span class="op" id="3317011">(</span><span class="ident" id="3317012">data</span>&nbsp;<span class="op" id="3317017">[</span><span class="op" id="3317018">]</span><span class="builtintype" id="3317019">byte</span><span class="op" id="3317023">)</span>&nbsp;<span class="op" id="3317025">(</span><span class="ident" id="3317026">n</span>&nbsp;<span class="builtintype" id="3317028">int</span><span class="op" id="3317031">,</span>&nbsp;<span class="ident" id="3317033">err</span>&nbsp;<span class="builtintype" id="3317037">error</span><span class="op" id="3317042">)</span>&nbsp;<span class="op" id="3317044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317047">var</span>&nbsp;<span class="ident" id="3317051">m</span>&nbsp;<span class="builtintype" id="3317053">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317058">for</span>&nbsp;<span class="ident" id="3317062">i</span><span class="op" id="3317063">,</span>&nbsp;<span class="ident" id="3317065">b</span>&nbsp;<span class="op" id="3317067">:=</span>&nbsp;<span class="keyword" id="3317070">range</span>&nbsp;<span class="ident" id="3317076">data</span>&nbsp;<span class="op" id="3317081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3317085">//&nbsp;invariant:&nbsp;data[0:n]&nbsp;has&nbsp;been&nbsp;written</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317128">if</span>&nbsp;<span class="ident" id="3317131">b</span>&nbsp;<span class="op" id="3317133">==</span>&nbsp;<span class="string" id="3317136">&#39;\n&#39;</span>&nbsp;<span class="op" id="3317141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317146">m</span><span class="op" id="3317147">,</span>&nbsp;<span class="ident" id="3317149">err</span>&nbsp;<span class="op" id="3317153">=</span>&nbsp;<span class="ident" id="3317155">p</span><span class="op" id="3317156">.</span><span class="ident" id="3317157">output</span><span class="op" id="3317163">.</span><span class="ident" id="3317164">Write</span><span class="op" id="3317169">(</span><span class="ident" id="3317170">data</span><span class="op" id="3317174">[</span><span class="ident" id="3317175">n</span>&nbsp;<span class="op" id="3317177">:</span>&nbsp;<span class="ident" id="3317179">i</span><span class="op" id="3317180">+</span><span class="num" id="3317181">1</span><span class="op" id="3317182">]</span><span class="op" id="3317183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317188">n</span>&nbsp;<span class="op" id="3317190">+=</span>&nbsp;<span class="ident" id="3317193">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317198">if</span>&nbsp;<span class="ident" id="3317201">err</span>&nbsp;<span class="op" id="3317205">!=</span>&nbsp;<span class="ident" id="3317208">nil</span>&nbsp;<span class="op" id="3317212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317218">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317233">p</span><span class="op" id="3317234">.</span><span class="ident" id="3317235">line</span><span class="op" id="3317239">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317244">}</span>&nbsp;<span class="keyword" id="3317246">else</span>&nbsp;<span class="keyword" id="3317251">if</span>&nbsp;<span class="ident" id="3317254">p</span><span class="op" id="3317255">.</span><span class="ident" id="3317256">last</span>&nbsp;<span class="op" id="3317261">==</span>&nbsp;<span class="string" id="3317264">&#39;\n&#39;</span>&nbsp;<span class="op" id="3317269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317274">_</span><span class="op" id="3317275">,</span>&nbsp;<span class="ident" id="3317277">err</span>&nbsp;<span class="op" id="3317281">=</span>&nbsp;<span class="ident" id="3317283">fmt</span><span class="op" id="3317286">.</span><span class="ident" id="3317287">Fprintf</span><span class="op" id="3317294">(</span><span class="ident" id="3317295">p</span><span class="op" id="3317296">.</span><span class="ident" id="3317297">output</span><span class="op" id="3317303">,</span>&nbsp;<span class="string" id="3317305">&#34;%6d&nbsp;&nbsp;&#34;</span><span class="op" id="3317312">,</span>&nbsp;<span class="ident" id="3317314">p</span><span class="op" id="3317315">.</span><span class="ident" id="3317316">line</span><span class="op" id="3317320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317325">if</span>&nbsp;<span class="ident" id="3317328">err</span>&nbsp;<span class="op" id="3317332">!=</span>&nbsp;<span class="ident" id="3317335">nil</span>&nbsp;<span class="op" id="3317339">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317360">for</span>&nbsp;<span class="ident" id="3317364">j</span>&nbsp;<span class="op" id="3317366">:=</span>&nbsp;<span class="ident" id="3317369">p</span><span class="op" id="3317370">.</span><span class="ident" id="3317371">indent</span><span class="op" id="3317377">;</span>&nbsp;<span class="ident" id="3317379">j</span>&nbsp;<span class="op" id="3317381">&gt;</span>&nbsp;<span class="num" id="3317383">0</span><span class="op" id="3317384">;</span>&nbsp;<span class="ident" id="3317386">j</span><span class="op" id="3317387">--</span>&nbsp;<span class="op" id="3317390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317396">_</span><span class="op" id="3317397">,</span>&nbsp;<span class="ident" id="3317399">err</span>&nbsp;<span class="op" id="3317403">=</span>&nbsp;<span class="ident" id="3317405">p</span><span class="op" id="3317406">.</span><span class="ident" id="3317407">output</span><span class="op" id="3317413">.</span><span class="ident" id="3317414">Write</span><span class="op" id="3317419">(</span><span class="ident" id="3317420">indent</span><span class="op" id="3317426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317432">if</span>&nbsp;<span class="ident" id="3317435">err</span>&nbsp;<span class="op" id="3317439">!=</span>&nbsp;<span class="ident" id="3317442">nil</span>&nbsp;<span class="op" id="3317446">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317453">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317477">p</span><span class="op" id="3317478">.</span><span class="ident" id="3317479">last</span>&nbsp;<span class="op" id="3317484">=</span>&nbsp;<span class="ident" id="3317486">b</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317492">if</span>&nbsp;<span class="builtinfunc" id="3317495">len</span><span class="op" id="3317498">(</span><span class="ident" id="3317499">data</span><span class="op" id="3317503">)</span>&nbsp;<span class="op" id="3317505">&gt;</span>&nbsp;<span class="ident" id="3317507">n</span>&nbsp;<span class="op" id="3317509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317513">m</span><span class="op" id="3317514">,</span>&nbsp;<span class="ident" id="3317516">err</span>&nbsp;<span class="op" id="3317520">=</span>&nbsp;<span class="ident" id="3317522">p</span><span class="op" id="3317523">.</span><span class="ident" id="3317524">output</span><span class="op" id="3317530">.</span><span class="ident" id="3317531">Write</span><span class="op" id="3317536">(</span><span class="ident" id="3317537">data</span><span class="op" id="3317541">[</span><span class="ident" id="3317542">n</span><span class="op" id="3317543">:</span><span class="op" id="3317544">]</span><span class="op" id="3317545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317549">n</span>&nbsp;<span class="op" id="3317551">+=</span>&nbsp;<span class="ident" id="3317554">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317557">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317560">return</span><br>
<span class="lineno"></span><span class="op" id="3317567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317570">//&nbsp;localError&nbsp;wraps&nbsp;locally&nbsp;caught&nbsp;errors&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish</span><br>
<span class="lineno"></span><span class="comment" id="3317634">//&nbsp;them&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors.</span><br>
<span class="lineno">120</span><span class="keyword" id="3317703">type</span>&nbsp;<span class="ident" id="3317708">localError</span>&nbsp;<span class="keyword" id="3317719">struct</span>&nbsp;<span class="op" id="3317726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317729">err</span>&nbsp;<span class="builtintype" id="3317733">error</span><br>
<span class="lineno"></span><span class="op" id="3317739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317742">//&nbsp;printf&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;that&nbsp;takes&nbsp;care&nbsp;of&nbsp;print&nbsp;errors.</span><br>
<span class="lineno">125</span><span class="keyword" id="3317810">func</span>&nbsp;<span class="op" id="3317815">(</span><span class="ident" id="3317816">p</span>&nbsp;<span class="op" id="3317818">*</span><span class="ident" id="3317819">printer</span><span class="op" id="3317826">)</span>&nbsp;<span class="ident" id="3317828">printf</span><span class="op" id="3317834">(</span><span class="ident" id="3317835">format</span>&nbsp;<span class="builtintype" id="3317842">string</span><span class="op" id="3317848">,</span>&nbsp;<span class="ident" id="3317850">args</span>&nbsp;<span class="op" id="3317855">...</span><span class="keyword" id="3317858">interface</span><span class="op" id="3317867">{</span><span class="op" id="3317868">}</span><span class="op" id="3317869">)</span>&nbsp;<span class="op" id="3317871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317874">if</span>&nbsp;<span class="ident" id="3317877">_</span><span class="op" id="3317878">,</span>&nbsp;<span class="ident" id="3317880">err</span>&nbsp;<span class="op" id="3317884">:=</span>&nbsp;<span class="ident" id="3317887">fmt</span><span class="op" id="3317890">.</span><span class="ident" id="3317891">Fprintf</span><span class="op" id="3317898">(</span><span class="ident" id="3317899">p</span><span class="op" id="3317900">,</span>&nbsp;<span class="ident" id="3317902">format</span><span class="op" id="3317908">,</span>&nbsp;<span class="ident" id="3317910">args</span><span class="op" id="3317914">...</span><span class="op" id="3317917">)</span><span class="op" id="3317918">;</span>&nbsp;<span class="ident" id="3317920">err</span>&nbsp;<span class="op" id="3317924">!=</span>&nbsp;<span class="ident" id="3317927">nil</span>&nbsp;<span class="op" id="3317931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3317935">panic</span><span class="op" id="3317940">(</span><span class="ident" id="3317941">localError</span><span class="op" id="3317951">{</span><span class="ident" id="3317952">err</span><span class="op" id="3317955">}</span><span class="op" id="3317956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3317959">}</span><br>
<span class="lineno"></span><span class="op" id="3317961">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3317964">//&nbsp;Implementation&nbsp;note:&nbsp;Print&nbsp;is&nbsp;written&nbsp;for&nbsp;AST&nbsp;nodes&nbsp;but&nbsp;could&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3318032">//&nbsp;used&nbsp;to&nbsp;print&nbsp;arbitrary&nbsp;data&nbsp;structures;&nbsp;such&nbsp;a&nbsp;version&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3318098">//&nbsp;probably&nbsp;be&nbsp;in&nbsp;a&nbsp;different&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="3318137">//</span><br>
<span class="lineno">135</span><span class="comment" id="3318140">//&nbsp;Note:&nbsp;This&nbsp;code&nbsp;detects&nbsp;(some)&nbsp;cycles&nbsp;created&nbsp;via&nbsp;pointers&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="3318206">//&nbsp;not&nbsp;cycles&nbsp;that&nbsp;are&nbsp;created&nbsp;via&nbsp;slices&nbsp;or&nbsp;maps&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3318271">//&nbsp;same&nbsp;slice&nbsp;or&nbsp;map.&nbsp;Code&nbsp;for&nbsp;general&nbsp;data&nbsp;structures&nbsp;probably</span><br>
<span class="lineno"></span><span class="comment" id="3318335">//&nbsp;should&nbsp;catch&nbsp;those&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="keyword" id="3318367">func</span>&nbsp;<span class="op" id="3318372">(</span><span class="ident" id="3318373">p</span>&nbsp;<span class="op" id="3318375">*</span><span class="ident" id="3318376">printer</span><span class="op" id="3318383">)</span>&nbsp;<span class="builtinfunc" id="3318385">print</span><span class="op" id="3318390">(</span><span class="ident" id="3318391">x</span>&nbsp;<span class="ident" id="3318393">reflect</span><span class="op" id="3318400">.</span><span class="ident" id="3318401">Value</span><span class="op" id="3318406">)</span>&nbsp;<span class="op" id="3318408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318411">if</span>&nbsp;<span class="op" id="3318414">!</span><span class="ident" id="3318415">NotNilFilter</span><span class="op" id="3318427">(</span><span class="string" id="3318428">&#34;&#34;</span><span class="op" id="3318430">,</span>&nbsp;<span class="ident" id="3318432">x</span><span class="op" id="3318433">)</span>&nbsp;<span class="op" id="3318435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318439">p</span><span class="op" id="3318440">.</span><span class="ident" id="3318441">printf</span><span class="op" id="3318447">(</span><span class="string" id="3318448">&#34;nil&#34;</span><span class="op" id="3318453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318457">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318465">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318469">switch</span>&nbsp;<span class="ident" id="3318476">x</span><span class="op" id="3318477">.</span><span class="ident" id="3318478">Kind</span><span class="op" id="3318482">(</span><span class="op" id="3318483">)</span>&nbsp;<span class="op" id="3318485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318488">case</span>&nbsp;<span class="ident" id="3318493">reflect</span><span class="op" id="3318500">.</span><span class="ident" id="3318501">Interface</span><span class="op" id="3318510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318514">p</span><span class="op" id="3318515">.</span><span class="builtinfunc" id="3318516">print</span><span class="op" id="3318521">(</span><span class="ident" id="3318522">x</span><span class="op" id="3318523">.</span><span class="ident" id="3318524">Elem</span><span class="op" id="3318528">(</span><span class="op" id="3318529">)</span><span class="op" id="3318530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318534">case</span>&nbsp;<span class="ident" id="3318539">reflect</span><span class="op" id="3318546">.</span><span class="ident" id="3318547">Map</span><span class="op" id="3318550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318554">p</span><span class="op" id="3318555">.</span><span class="ident" id="3318556">printf</span><span class="op" id="3318562">(</span><span class="string" id="3318563">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="3318580">,</span>&nbsp;<span class="ident" id="3318582">x</span><span class="op" id="3318583">.</span><span class="ident" id="3318584">Type</span><span class="op" id="3318588">(</span><span class="op" id="3318589">)</span><span class="op" id="3318590">,</span>&nbsp;<span class="ident" id="3318592">x</span><span class="op" id="3318593">.</span><span class="ident" id="3318594">Len</span><span class="op" id="3318597">(</span><span class="op" id="3318598">)</span><span class="op" id="3318599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318603">if</span>&nbsp;<span class="ident" id="3318606">x</span><span class="op" id="3318607">.</span><span class="ident" id="3318608">Len</span><span class="op" id="3318611">(</span><span class="op" id="3318612">)</span>&nbsp;<span class="op" id="3318614">&gt;</span>&nbsp;<span class="num" id="3318616">0</span>&nbsp;<span class="op" id="3318618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318623">p</span><span class="op" id="3318624">.</span><span class="ident" id="3318625">indent</span><span class="op" id="3318631">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318637">p</span><span class="op" id="3318638">.</span><span class="ident" id="3318639">printf</span><span class="op" id="3318645">(</span><span class="string" id="3318646">&#34;\n&#34;</span><span class="op" id="3318650">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318655">for</span>&nbsp;<span class="ident" id="3318659">_</span><span class="op" id="3318660">,</span>&nbsp;<span class="ident" id="3318662">key</span>&nbsp;<span class="op" id="3318666">:=</span>&nbsp;<span class="keyword" id="3318669">range</span>&nbsp;<span class="ident" id="3318675">x</span><span class="op" id="3318676">.</span><span class="ident" id="3318677">MapKeys</span><span class="op" id="3318684">(</span><span class="op" id="3318685">)</span>&nbsp;<span class="op" id="3318687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318693">p</span><span class="op" id="3318694">.</span><span class="builtinfunc" id="3318695">print</span><span class="op" id="3318700">(</span><span class="ident" id="3318701">key</span><span class="op" id="3318704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318710">p</span><span class="op" id="3318711">.</span><span class="ident" id="3318712">printf</span><span class="op" id="3318718">(</span><span class="string" id="3318719">&#34;:&nbsp;&#34;</span><span class="op" id="3318723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318729">p</span><span class="op" id="3318730">.</span><span class="builtinfunc" id="3318731">print</span><span class="op" id="3318736">(</span><span class="ident" id="3318737">x</span><span class="op" id="3318738">.</span><span class="ident" id="3318739">MapIndex</span><span class="op" id="3318747">(</span><span class="ident" id="3318748">key</span><span class="op" id="3318751">)</span><span class="op" id="3318752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318758">p</span><span class="op" id="3318759">.</span><span class="ident" id="3318760">printf</span><span class="op" id="3318766">(</span><span class="string" id="3318767">&#34;\n&#34;</span><span class="op" id="3318771">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318781">p</span><span class="op" id="3318782">.</span><span class="ident" id="3318783">indent</span><span class="op" id="3318789">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318798">p</span><span class="op" id="3318799">.</span><span class="ident" id="3318800">printf</span><span class="op" id="3318806">(</span><span class="string" id="3318807">&#34;}&#34;</span><span class="op" id="3318810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318814">case</span>&nbsp;<span class="ident" id="3318819">reflect</span><span class="op" id="3318826">.</span><span class="ident" id="3318827">Ptr</span><span class="op" id="3318830">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318834">p</span><span class="op" id="3318835">.</span><span class="ident" id="3318836">printf</span><span class="op" id="3318842">(</span><span class="string" id="3318843">&#34;*&#34;</span><span class="op" id="3318846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3318850">//&nbsp;type-checked&nbsp;ASTs&nbsp;may&nbsp;contain&nbsp;cycles&nbsp;-&nbsp;use&nbsp;ptrmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3318905">//&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;objects&nbsp;that&nbsp;have&nbsp;been&nbsp;printed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3318958">//&nbsp;already&nbsp;and&nbsp;print&nbsp;the&nbsp;respective&nbsp;line&nbsp;number&nbsp;instead</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319016">ptr</span>&nbsp;<span class="op" id="3319020">:=</span>&nbsp;<span class="ident" id="3319023">x</span><span class="op" id="3319024">.</span><span class="ident" id="3319025">Interface</span><span class="op" id="3319034">(</span><span class="op" id="3319035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319039">if</span>&nbsp;<span class="ident" id="3319042">line</span><span class="op" id="3319046">,</span>&nbsp;<span class="ident" id="3319048">exists</span>&nbsp;<span class="op" id="3319055">:=</span>&nbsp;<span class="ident" id="3319058">p</span><span class="op" id="3319059">.</span><span class="ident" id="3319060">ptrmap</span><span class="op" id="3319066">[</span><span class="ident" id="3319067">ptr</span><span class="op" id="3319070">]</span><span class="op" id="3319071">;</span>&nbsp;<span class="ident" id="3319073">exists</span>&nbsp;<span class="op" id="3319080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319085">p</span><span class="op" id="3319086">.</span><span class="ident" id="3319087">printf</span><span class="op" id="3319093">(</span><span class="string" id="3319094">&#34;(obj&nbsp;@&nbsp;%d)&#34;</span><span class="op" id="3319106">,</span>&nbsp;<span class="ident" id="3319108">line</span><span class="op" id="3319112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319116">}</span>&nbsp;<span class="keyword" id="3319118">else</span>&nbsp;<span class="op" id="3319123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319128">p</span><span class="op" id="3319129">.</span><span class="ident" id="3319130">ptrmap</span><span class="op" id="3319136">[</span><span class="ident" id="3319137">ptr</span><span class="op" id="3319140">]</span>&nbsp;<span class="op" id="3319142">=</span>&nbsp;<span class="ident" id="3319144">p</span><span class="op" id="3319145">.</span><span class="ident" id="3319146">line</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319154">p</span><span class="op" id="3319155">.</span><span class="builtinfunc" id="3319156">print</span><span class="op" id="3319161">(</span><span class="ident" id="3319162">x</span><span class="op" id="3319163">.</span><span class="ident" id="3319164">Elem</span><span class="op" id="3319168">(</span><span class="op" id="3319169">)</span><span class="op" id="3319170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319178">case</span>&nbsp;<span class="ident" id="3319183">reflect</span><span class="op" id="3319190">.</span><span class="ident" id="3319191">Array</span><span class="op" id="3319196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319200">p</span><span class="op" id="3319201">.</span><span class="ident" id="3319202">printf</span><span class="op" id="3319208">(</span><span class="string" id="3319209">&#34;%s&nbsp;{&#34;</span><span class="op" id="3319215">,</span>&nbsp;<span class="ident" id="3319217">x</span><span class="op" id="3319218">.</span><span class="ident" id="3319219">Type</span><span class="op" id="3319223">(</span><span class="op" id="3319224">)</span><span class="op" id="3319225">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319229">if</span>&nbsp;<span class="ident" id="3319232">x</span><span class="op" id="3319233">.</span><span class="ident" id="3319234">Len</span><span class="op" id="3319237">(</span><span class="op" id="3319238">)</span>&nbsp;<span class="op" id="3319240">&gt;</span>&nbsp;<span class="num" id="3319242">0</span>&nbsp;<span class="op" id="3319244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319249">p</span><span class="op" id="3319250">.</span><span class="ident" id="3319251">indent</span><span class="op" id="3319257">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319263">p</span><span class="op" id="3319264">.</span><span class="ident" id="3319265">printf</span><span class="op" id="3319271">(</span><span class="string" id="3319272">&#34;\n&#34;</span><span class="op" id="3319276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319281">for</span>&nbsp;<span class="ident" id="3319285">i</span><span class="op" id="3319286">,</span>&nbsp;<span class="ident" id="3319288">n</span>&nbsp;<span class="op" id="3319290">:=</span>&nbsp;<span class="num" id="3319293">0</span><span class="op" id="3319294">,</span>&nbsp;<span class="ident" id="3319296">x</span><span class="op" id="3319297">.</span><span class="ident" id="3319298">Len</span><span class="op" id="3319301">(</span><span class="op" id="3319302">)</span><span class="op" id="3319303">;</span>&nbsp;<span class="ident" id="3319305">i</span>&nbsp;<span class="op" id="3319307">&lt;</span>&nbsp;<span class="ident" id="3319309">n</span><span class="op" id="3319310">;</span>&nbsp;<span class="ident" id="3319312">i</span><span class="op" id="3319313">++</span>&nbsp;<span class="op" id="3319316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319322">p</span><span class="op" id="3319323">.</span><span class="ident" id="3319324">printf</span><span class="op" id="3319330">(</span><span class="string" id="3319331">&#34;%d:&nbsp;&#34;</span><span class="op" id="3319337">,</span>&nbsp;<span class="ident" id="3319339">i</span><span class="op" id="3319340">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319346">p</span><span class="op" id="3319347">.</span><span class="builtinfunc" id="3319348">print</span><span class="op" id="3319353">(</span><span class="ident" id="3319354">x</span><span class="op" id="3319355">.</span><span class="ident" id="3319356">Index</span><span class="op" id="3319361">(</span><span class="ident" id="3319362">i</span><span class="op" id="3319363">)</span><span class="op" id="3319364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319370">p</span><span class="op" id="3319371">.</span><span class="ident" id="3319372">printf</span><span class="op" id="3319378">(</span><span class="string" id="3319379">&#34;\n&#34;</span><span class="op" id="3319383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319393">p</span><span class="op" id="3319394">.</span><span class="ident" id="3319395">indent</span><span class="op" id="3319401">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319406">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319410">p</span><span class="op" id="3319411">.</span><span class="ident" id="3319412">printf</span><span class="op" id="3319418">(</span><span class="string" id="3319419">&#34;}&#34;</span><span class="op" id="3319422">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319426">case</span>&nbsp;<span class="ident" id="3319431">reflect</span><span class="op" id="3319438">.</span><span class="ident" id="3319439">Slice</span><span class="op" id="3319444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319448">if</span>&nbsp;<span class="ident" id="3319451">s</span><span class="op" id="3319452">,</span>&nbsp;<span class="ident" id="3319454">ok</span>&nbsp;<span class="op" id="3319457">:=</span>&nbsp;<span class="ident" id="3319460">x</span><span class="op" id="3319461">.</span><span class="ident" id="3319462">Interface</span><span class="op" id="3319471">(</span><span class="op" id="3319472">)</span><span class="op" id="3319473">.</span><span class="op" id="3319474">(</span><span class="op" id="3319475">[</span><span class="op" id="3319476">]</span><span class="builtintype" id="3319477">byte</span><span class="op" id="3319481">)</span><span class="op" id="3319482">;</span>&nbsp;<span class="ident" id="3319484">ok</span>&nbsp;<span class="op" id="3319487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319492">p</span><span class="op" id="3319493">.</span><span class="ident" id="3319494">printf</span><span class="op" id="3319500">(</span><span class="string" id="3319501">&#34;%#q&#34;</span><span class="op" id="3319506">,</span>&nbsp;<span class="ident" id="3319508">s</span><span class="op" id="3319509">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319514">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319527">p</span><span class="op" id="3319528">.</span><span class="ident" id="3319529">printf</span><span class="op" id="3319535">(</span><span class="string" id="3319536">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="3319553">,</span>&nbsp;<span class="ident" id="3319555">x</span><span class="op" id="3319556">.</span><span class="ident" id="3319557">Type</span><span class="op" id="3319561">(</span><span class="op" id="3319562">)</span><span class="op" id="3319563">,</span>&nbsp;<span class="ident" id="3319565">x</span><span class="op" id="3319566">.</span><span class="ident" id="3319567">Len</span><span class="op" id="3319570">(</span><span class="op" id="3319571">)</span><span class="op" id="3319572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319576">if</span>&nbsp;<span class="ident" id="3319579">x</span><span class="op" id="3319580">.</span><span class="ident" id="3319581">Len</span><span class="op" id="3319584">(</span><span class="op" id="3319585">)</span>&nbsp;<span class="op" id="3319587">&gt;</span>&nbsp;<span class="num" id="3319589">0</span>&nbsp;<span class="op" id="3319591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319596">p</span><span class="op" id="3319597">.</span><span class="ident" id="3319598">indent</span><span class="op" id="3319604">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319610">p</span><span class="op" id="3319611">.</span><span class="ident" id="3319612">printf</span><span class="op" id="3319618">(</span><span class="string" id="3319619">&#34;\n&#34;</span><span class="op" id="3319623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319628">for</span>&nbsp;<span class="ident" id="3319632">i</span><span class="op" id="3319633">,</span>&nbsp;<span class="ident" id="3319635">n</span>&nbsp;<span class="op" id="3319637">:=</span>&nbsp;<span class="num" id="3319640">0</span><span class="op" id="3319641">,</span>&nbsp;<span class="ident" id="3319643">x</span><span class="op" id="3319644">.</span><span class="ident" id="3319645">Len</span><span class="op" id="3319648">(</span><span class="op" id="3319649">)</span><span class="op" id="3319650">;</span>&nbsp;<span class="ident" id="3319652">i</span>&nbsp;<span class="op" id="3319654">&lt;</span>&nbsp;<span class="ident" id="3319656">n</span><span class="op" id="3319657">;</span>&nbsp;<span class="ident" id="3319659">i</span><span class="op" id="3319660">++</span>&nbsp;<span class="op" id="3319663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319669">p</span><span class="op" id="3319670">.</span><span class="ident" id="3319671">printf</span><span class="op" id="3319677">(</span><span class="string" id="3319678">&#34;%d:&nbsp;&#34;</span><span class="op" id="3319684">,</span>&nbsp;<span class="ident" id="3319686">i</span><span class="op" id="3319687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319693">p</span><span class="op" id="3319694">.</span><span class="builtinfunc" id="3319695">print</span><span class="op" id="3319700">(</span><span class="ident" id="3319701">x</span><span class="op" id="3319702">.</span><span class="ident" id="3319703">Index</span><span class="op" id="3319708">(</span><span class="ident" id="3319709">i</span><span class="op" id="3319710">)</span><span class="op" id="3319711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319717">p</span><span class="op" id="3319718">.</span><span class="ident" id="3319719">printf</span><span class="op" id="3319725">(</span><span class="string" id="3319726">&#34;\n&#34;</span><span class="op" id="3319730">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319740">p</span><span class="op" id="3319741">.</span><span class="ident" id="3319742">indent</span><span class="op" id="3319748">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319757">p</span><span class="op" id="3319758">.</span><span class="ident" id="3319759">printf</span><span class="op" id="3319765">(</span><span class="string" id="3319766">&#34;}&#34;</span><span class="op" id="3319769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319773">case</span>&nbsp;<span class="ident" id="3319778">reflect</span><span class="op" id="3319785">.</span><span class="ident" id="3319786">Struct</span><span class="op" id="3319792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319796">t</span>&nbsp;<span class="op" id="3319798">:=</span>&nbsp;<span class="ident" id="3319801">x</span><span class="op" id="3319802">.</span><span class="ident" id="3319803">Type</span><span class="op" id="3319807">(</span><span class="op" id="3319808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319812">p</span><span class="op" id="3319813">.</span><span class="ident" id="3319814">printf</span><span class="op" id="3319820">(</span><span class="string" id="3319821">&#34;%s&nbsp;{&#34;</span><span class="op" id="3319827">,</span>&nbsp;<span class="ident" id="3319829">t</span><span class="op" id="3319830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319834">p</span><span class="op" id="3319835">.</span><span class="ident" id="3319836">indent</span><span class="op" id="3319842">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319847">first</span>&nbsp;<span class="op" id="3319853">:=</span>&nbsp;<span class="builtintype" id="3319856">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319863">for</span>&nbsp;<span class="ident" id="3319867">i</span><span class="op" id="3319868">,</span>&nbsp;<span class="ident" id="3319870">n</span>&nbsp;<span class="op" id="3319872">:=</span>&nbsp;<span class="num" id="3319875">0</span><span class="op" id="3319876">,</span>&nbsp;<span class="ident" id="3319878">t</span><span class="op" id="3319879">.</span><span class="ident" id="3319880">NumField</span><span class="op" id="3319888">(</span><span class="op" id="3319889">)</span><span class="op" id="3319890">;</span>&nbsp;<span class="ident" id="3319892">i</span>&nbsp;<span class="op" id="3319894">&lt;</span>&nbsp;<span class="ident" id="3319896">n</span><span class="op" id="3319897">;</span>&nbsp;<span class="ident" id="3319899">i</span><span class="op" id="3319900">++</span>&nbsp;<span class="op" id="3319903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3319908">//&nbsp;exclude&nbsp;non-exported&nbsp;fields&nbsp;because&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3319956">//&nbsp;values&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;via&nbsp;reflection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320003">if</span>&nbsp;<span class="ident" id="3320006">name</span>&nbsp;<span class="op" id="3320011">:=</span>&nbsp;<span class="ident" id="3320014">t</span><span class="op" id="3320015">.</span><span class="ident" id="3320016">Field</span><span class="op" id="3320021">(</span><span class="ident" id="3320022">i</span><span class="op" id="3320023">)</span><span class="op" id="3320024">.</span><span class="ident" id="3320025">Name</span><span class="op" id="3320029">;</span>&nbsp;<span class="ident" id="3320031">IsExported</span><span class="op" id="3320041">(</span><span class="ident" id="3320042">name</span><span class="op" id="3320046">)</span>&nbsp;<span class="op" id="3320048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320054">value</span>&nbsp;<span class="op" id="3320060">:=</span>&nbsp;<span class="ident" id="3320063">x</span><span class="op" id="3320064">.</span><span class="ident" id="3320065">Field</span><span class="op" id="3320070">(</span><span class="ident" id="3320071">i</span><span class="op" id="3320072">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320078">if</span>&nbsp;<span class="ident" id="3320081">p</span><span class="op" id="3320082">.</span><span class="ident" id="3320083">filter</span>&nbsp;<span class="op" id="3320090">==</span>&nbsp;<span class="ident" id="3320093">nil</span>&nbsp;<span class="op" id="3320097">||</span>&nbsp;<span class="ident" id="3320100">p</span><span class="op" id="3320101">.</span><span class="ident" id="3320102">filter</span><span class="op" id="3320108">(</span><span class="ident" id="3320109">name</span><span class="op" id="3320113">,</span>&nbsp;<span class="ident" id="3320115">value</span><span class="op" id="3320120">)</span>&nbsp;<span class="op" id="3320122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320129">if</span>&nbsp;<span class="ident" id="3320132">first</span>&nbsp;<span class="op" id="3320138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320146">p</span><span class="op" id="3320147">.</span><span class="ident" id="3320148">printf</span><span class="op" id="3320154">(</span><span class="string" id="3320155">&#34;\n&#34;</span><span class="op" id="3320159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320167">first</span>&nbsp;<span class="op" id="3320173">=</span>&nbsp;<span class="builtintype" id="3320175">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320186">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320193">p</span><span class="op" id="3320194">.</span><span class="ident" id="3320195">printf</span><span class="op" id="3320201">(</span><span class="string" id="3320202">&#34;%s:&nbsp;&#34;</span><span class="op" id="3320208">,</span>&nbsp;<span class="ident" id="3320210">name</span><span class="op" id="3320214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320221">p</span><span class="op" id="3320222">.</span><span class="builtinfunc" id="3320223">print</span><span class="op" id="3320228">(</span><span class="ident" id="3320229">value</span><span class="op" id="3320234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320241">p</span><span class="op" id="3320242">.</span><span class="ident" id="3320243">printf</span><span class="op" id="3320249">(</span><span class="string" id="3320250">&#34;\n&#34;</span><span class="op" id="3320254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320265">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320273">p</span><span class="op" id="3320274">.</span><span class="ident" id="3320275">indent</span><span class="op" id="3320281">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320286">p</span><span class="op" id="3320287">.</span><span class="ident" id="3320288">printf</span><span class="op" id="3320294">(</span><span class="string" id="3320295">&#34;}&#34;</span><span class="op" id="3320298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320302">default</span><span class="op" id="3320309">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320313">v</span>&nbsp;<span class="op" id="3320315">:=</span>&nbsp;<span class="ident" id="3320318">x</span><span class="op" id="3320319">.</span><span class="ident" id="3320320">Interface</span><span class="op" id="3320329">(</span><span class="op" id="3320330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320334">switch</span>&nbsp;<span class="ident" id="3320341">v</span>&nbsp;<span class="op" id="3320343">:=</span>&nbsp;<span class="ident" id="3320346">v</span><span class="op" id="3320347">.</span><span class="op" id="3320348">(</span><span class="keyword" id="3320349">type</span><span class="op" id="3320353">)</span>&nbsp;<span class="op" id="3320355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320359">case</span>&nbsp;<span class="builtintype" id="3320364">string</span><span class="op" id="3320370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320375">//&nbsp;print&nbsp;strings&nbsp;in&nbsp;quotes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320405">p</span><span class="op" id="3320406">.</span><span class="ident" id="3320407">printf</span><span class="op" id="3320413">(</span><span class="string" id="3320414">&#34;%q&#34;</span><span class="op" id="3320418">,</span>&nbsp;<span class="ident" id="3320420">v</span><span class="op" id="3320421">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320426">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320435">case</span>&nbsp;<span class="ident" id="3320440">token</span><span class="op" id="3320445">.</span><span class="ident" id="3320446">Pos</span><span class="op" id="3320449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320454">//&nbsp;position&nbsp;values&nbsp;can&nbsp;be&nbsp;printed&nbsp;nicely&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320520">if</span>&nbsp;<span class="ident" id="3320523">p</span><span class="op" id="3320524">.</span><span class="ident" id="3320525">fset</span>&nbsp;<span class="op" id="3320530">!=</span>&nbsp;<span class="ident" id="3320533">nil</span>&nbsp;<span class="op" id="3320537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320543">p</span><span class="op" id="3320544">.</span><span class="ident" id="3320545">printf</span><span class="op" id="3320551">(</span><span class="string" id="3320552">&#34;%s&#34;</span><span class="op" id="3320556">,</span>&nbsp;<span class="ident" id="3320558">p</span><span class="op" id="3320559">.</span><span class="ident" id="3320560">fset</span><span class="op" id="3320564">.</span><span class="ident" id="3320565">Position</span><span class="op" id="3320573">(</span><span class="ident" id="3320574">v</span><span class="op" id="3320575">)</span><span class="op" id="3320576">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3320582">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3320600">//&nbsp;default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3320613">p</span><span class="op" id="3320614">.</span><span class="ident" id="3320615">printf</span><span class="op" id="3320621">(</span><span class="string" id="3320622">&#34;%v&#34;</span><span class="op" id="3320626">,</span>&nbsp;<span class="ident" id="3320628">v</span><span class="op" id="3320629">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3320632">}</span><br>
<span class="lineno"></span><span class="op" id="3320634">}</span>
</div>
</body>
</html>
