<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3019311">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3019366">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3019420">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3019471">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3019509">package</span>&nbsp;<span class="ident" id="3019517">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3019523">import</span>&nbsp;<span class="op" id="3019530">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019533">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019542">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019551">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019565">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019584">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019594">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019601">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019607">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019620">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019628">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019646">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019663">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019674">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019685">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3019696">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="3019703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3019706">const</span>&nbsp;<span class="op" id="3019712">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019715">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3019732">=</span>&nbsp;<span class="num" id="3019734">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019740">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3019757">=</span>&nbsp;<span class="num" id="3019759">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019765">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3019782">=</span>&nbsp;<span class="num" id="3019784">4</span>&nbsp;<span class="op" id="3019786">&lt;&lt;</span>&nbsp;<span class="num" id="3019789">10</span>&nbsp;&nbsp;<span class="comment" id="3019793">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3019809">defaultMaxMemory</span>&nbsp;<span class="op" id="3019826">=</span>&nbsp;<span class="num" id="3019828">32</span>&nbsp;<span class="op" id="3019831">&lt;&lt;</span>&nbsp;<span class="num" id="3019834">20</span>&nbsp;<span class="comment" id="3019837">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="3019846">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3019849">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="3019925">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="3019986">var</span>&nbsp;<span class="ident" id="3019990">ErrMissingFile</span>&nbsp;<span class="op" id="3020005">=</span>&nbsp;<span class="ident" id="3020007">errors</span><span class="op" id="3020013">.</span><span class="ident" id="3020014">New</span><span class="op" id="3020017">(</span><span class="string" id="3020018">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="3020038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3020041">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="3020073">type</span>&nbsp;<span class="ident" id="3020078">ProtocolError</span>&nbsp;<span class="keyword" id="3020092">struct</span>&nbsp;<span class="op" id="3020099">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020102">ErrorString</span>&nbsp;<span class="builtintype" id="3020114">string</span><br>
<span class="lineno"></span><span class="op" id="3020121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3020124">func</span>&nbsp;<span class="op" id="3020129">(</span><span class="ident" id="3020130">err</span>&nbsp;<span class="op" id="3020134">*</span><span class="ident" id="3020135">ProtocolError</span><span class="op" id="3020148">)</span>&nbsp;<span class="ident" id="3020150">Error</span><span class="op" id="3020155">(</span><span class="op" id="3020156">)</span>&nbsp;<span class="builtintype" id="3020158">string</span>&nbsp;<span class="op" id="3020165">{</span>&nbsp;<span class="keyword" id="3020167">return</span>&nbsp;<span class="ident" id="3020174">err</span><span class="op" id="3020177">.</span><span class="ident" id="3020178">ErrorString</span>&nbsp;<span class="op" id="3020190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="3020193">var</span>&nbsp;<span class="op" id="3020197">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020200">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020224">=</span>&nbsp;<span class="op" id="3020226">&amp;</span><span class="ident" id="3020227">ProtocolError</span><span class="op" id="3020240">{</span><span class="string" id="3020241">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="3020258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020261">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020285">=</span>&nbsp;<span class="op" id="3020287">&amp;</span><span class="ident" id="3020288">ProtocolError</span><span class="op" id="3020301">{</span><span class="string" id="3020302">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="3020325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020328">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020352">=</span>&nbsp;<span class="op" id="3020354">&amp;</span><span class="ident" id="3020355">ProtocolError</span><span class="op" id="3020368">{</span><span class="string" id="3020369">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="3020392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020395">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020419">=</span>&nbsp;<span class="op" id="3020421">&amp;</span><span class="ident" id="3020422">ProtocolError</span><span class="op" id="3020435">{</span><span class="string" id="3020436">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="3020486">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020489">ErrMissingContentLength</span>&nbsp;<span class="op" id="3020513">=</span>&nbsp;<span class="op" id="3020515">&amp;</span><span class="ident" id="3020516">ProtocolError</span><span class="op" id="3020529">{</span><span class="string" id="3020530">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="3020570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020573">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020597">=</span>&nbsp;<span class="op" id="3020599">&amp;</span><span class="ident" id="3020600">ProtocolError</span><span class="op" id="3020613">{</span><span class="string" id="3020614">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="3020662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020665">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3020689">=</span>&nbsp;<span class="op" id="3020691">&amp;</span><span class="ident" id="3020692">ProtocolError</span><span class="op" id="3020705">{</span><span class="string" id="3020706">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="3020751">}</span><br>
<span class="lineno"></span><span class="op" id="3020753">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3020756">type</span>&nbsp;<span class="ident" id="3020761">badStringError</span>&nbsp;<span class="keyword" id="3020776">struct</span>&nbsp;<span class="op" id="3020783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020786">what</span>&nbsp;<span class="builtintype" id="3020791">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020799">str</span>&nbsp;&nbsp;<span class="builtintype" id="3020804">string</span><br>
<span class="lineno"></span><span class="op" id="3020811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3020814">func</span>&nbsp;<span class="op" id="3020819">(</span><span class="ident" id="3020820">e</span>&nbsp;<span class="op" id="3020822">*</span><span class="ident" id="3020823">badStringError</span><span class="op" id="3020837">)</span>&nbsp;<span class="ident" id="3020839">Error</span><span class="op" id="3020844">(</span><span class="op" id="3020845">)</span>&nbsp;<span class="builtintype" id="3020847">string</span>&nbsp;<span class="op" id="3020854">{</span>&nbsp;<span class="keyword" id="3020856">return</span>&nbsp;<span class="ident" id="3020863">fmt</span><span class="op" id="3020866">.</span><span class="ident" id="3020867">Sprintf</span><span class="op" id="3020874">(</span><span class="string" id="3020875">&#34;%s&nbsp;%q&#34;</span><span class="op" id="3020882">,</span>&nbsp;<span class="ident" id="3020884">e</span><span class="op" id="3020885">.</span><span class="ident" id="3020886">what</span><span class="op" id="3020890">,</span>&nbsp;<span class="ident" id="3020892">e</span><span class="op" id="3020893">.</span><span class="ident" id="3020894">str</span><span class="op" id="3020897">)</span>&nbsp;<span class="op" id="3020899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3020902">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3020970">var</span>&nbsp;<span class="ident" id="3020974">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="3020996">=</span>&nbsp;<span class="keyword" id="3020998">map</span><span class="op" id="3021001">[</span><span class="builtintype" id="3021002">string</span><span class="op" id="3021008">]</span><span class="builtintype" id="3021009">bool</span><span class="op" id="3021013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3021016">&#34;Host&#34;</span><span class="op" id="3021022">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021037">true</span><span class="op" id="3021041">,</span>&nbsp;<span class="comment" id="3021043">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3021072">&#34;User-Agent&#34;</span><span class="op" id="3021084">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021093">true</span><span class="op" id="3021097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3021100">&#34;Content-Length&#34;</span><span class="op" id="3021116">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021121">true</span><span class="op" id="3021125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3021128">&#34;Transfer-Encoding&#34;</span><span class="op" id="3021147">:</span>&nbsp;<span class="builtintype" id="3021149">true</span><span class="op" id="3021153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3021156">&#34;Trailer&#34;</span><span class="op" id="3021165">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3021177">true</span><span class="op" id="3021181">,</span><br>
<span class="lineno"></span><span class="op" id="3021183">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3021186">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="3021247">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="3021277">//</span><br>
<span class="lineno"></span><span class="comment" id="3021280">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="3021345">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3021409">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="3021462">type</span>&nbsp;<span class="ident" id="3021467">Request</span>&nbsp;<span class="keyword" id="3021475">struct</span>&nbsp;<span class="op" id="3021482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021485">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021546">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021597">Method</span>&nbsp;<span class="builtintype" id="3021604">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021613">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021674">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021732">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021736">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021791">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021854">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021917">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021958">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021962">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022026">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022084">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022140">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022153">URL</span>&nbsp;<span class="op" id="3022157">*</span><span class="ident" id="3022158">url</span><span class="op" id="3022161">.</span><span class="ident" id="3022162">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022168">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022216">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022257">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3022268">string</span>&nbsp;<span class="comment" id="3022275">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022290">ProtoMajor</span>&nbsp;<span class="builtintype" id="3022301">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3022308">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022314">ProtoMinor</span>&nbsp;<span class="builtintype" id="3022325">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3022332">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022339">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022388">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022411">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022415">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022450">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022477">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022504">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022508">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022517">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022521">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022555">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022598">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022633">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022668">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022674">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022678">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022735">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022796">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022852">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022909">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022913">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022971">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023016">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023020">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023076">Header</span>&nbsp;<span class="ident" id="3023083">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023092">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023124">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023128">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023188">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023249">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023298">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023302">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023361">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023422">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023480">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023510">Body</span>&nbsp;<span class="ident" id="3023515">io</span><span class="op" id="3023517">.</span><span class="ident" id="3023518">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023531">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023595">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023650">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023710">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023733">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023805">ContentLength</span>&nbsp;<span class="ident" id="3023819">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023827">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023895">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023957">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024022">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024088">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024112">TransferEncoding</span>&nbsp;<span class="op" id="3024129">[</span><span class="op" id="3024130">]</span><span class="builtintype" id="3024131">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024140">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024198">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024258">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024289">Close</span>&nbsp;<span class="builtintype" id="3024295">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024302">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024363">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024424">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024488">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024527">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024531">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024590">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024650">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024677">Host</span>&nbsp;<span class="builtintype" id="3024682">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024691">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024754">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024814">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024874">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024930">Form</span>&nbsp;<span class="ident" id="3024935">url</span><span class="op" id="3024938">.</span><span class="ident" id="3024939">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024948">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025008">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025029">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025089">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025149">PostForm</span>&nbsp;<span class="ident" id="3025158">url</span><span class="op" id="3025161">.</span><span class="ident" id="3025162">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025171">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025243">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025312">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025377">MultipartForm</span>&nbsp;<span class="op" id="3025391">*</span><span class="ident" id="3025392">multipart</span><span class="op" id="3025401">.</span><span class="ident" id="3025402">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025409">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025482">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025492">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025496">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025564">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025638">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025709">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025781">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025854">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025873">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025877">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025949">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026022">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026096">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026167">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026240">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026264">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026268">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026333">Trailer</span>&nbsp;<span class="ident" id="3026341">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026350">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026414">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026473">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026533">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026592">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026654">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026667">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026713">RemoteAddr</span>&nbsp;<span class="builtintype" id="3026724">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026733">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026785">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026848">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026911">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3026975">RequestURI</span>&nbsp;<span class="builtintype" id="3026986">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3026995">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027052">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027114">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027176">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027231">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027286">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3027325">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027371">TLS</span>&nbsp;<span class="op" id="3027375">*</span><span class="ident" id="3027376">tls</span><span class="op" id="3027379">.</span><span class="ident" id="3027380">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3027396">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="3027399">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3027454">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3027497">func</span>&nbsp;<span class="op" id="3027502">(</span><span class="ident" id="3027503">r</span>&nbsp;<span class="op" id="3027505">*</span><span class="ident" id="3027506">Request</span><span class="op" id="3027513">)</span>&nbsp;<span class="ident" id="3027515">ProtoAtLeast</span><span class="op" id="3027527">(</span><span class="ident" id="3027528">major</span><span class="op" id="3027533">,</span>&nbsp;<span class="ident" id="3027535">minor</span>&nbsp;<span class="builtintype" id="3027541">int</span><span class="op" id="3027544">)</span>&nbsp;<span class="builtintype" id="3027546">bool</span>&nbsp;<span class="op" id="3027551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027554">return</span>&nbsp;<span class="ident" id="3027561">r</span><span class="op" id="3027562">.</span><span class="ident" id="3027563">ProtoMajor</span>&nbsp;<span class="op" id="3027574">&gt;</span>&nbsp;<span class="ident" id="3027576">major</span>&nbsp;<span class="op" id="3027582">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3027587">r</span><span class="op" id="3027588">.</span><span class="ident" id="3027589">ProtoMajor</span>&nbsp;<span class="op" id="3027600">==</span>&nbsp;<span class="ident" id="3027603">major</span>&nbsp;<span class="op" id="3027609">&amp;&amp;</span>&nbsp;<span class="ident" id="3027612">r</span><span class="op" id="3027613">.</span><span class="ident" id="3027614">ProtoMinor</span>&nbsp;<span class="op" id="3027625">&gt;=</span>&nbsp;<span class="ident" id="3027628">minor</span><br>
<span class="lineno"></span><span class="op" id="3027634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3027637">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3027707">func</span>&nbsp;<span class="op" id="3027712">(</span><span class="ident" id="3027713">r</span>&nbsp;<span class="op" id="3027715">*</span><span class="ident" id="3027716">Request</span><span class="op" id="3027723">)</span>&nbsp;<span class="ident" id="3027725">UserAgent</span><span class="op" id="3027734">(</span><span class="op" id="3027735">)</span>&nbsp;<span class="builtintype" id="3027737">string</span>&nbsp;<span class="op" id="3027744">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027747">return</span>&nbsp;<span class="ident" id="3027754">r</span><span class="op" id="3027755">.</span><span class="ident" id="3027756">Header</span><span class="op" id="3027762">.</span><span class="ident" id="3027763">Get</span><span class="op" id="3027766">(</span><span class="string" id="3027767">&#34;User-Agent&#34;</span><span class="op" id="3027779">)</span><br>
<span class="lineno"></span><span class="op" id="3027781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3027784">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="3027854">func</span>&nbsp;<span class="op" id="3027859">(</span><span class="ident" id="3027860">r</span>&nbsp;<span class="op" id="3027862">*</span><span class="ident" id="3027863">Request</span><span class="op" id="3027870">)</span>&nbsp;<span class="ident" id="3027872">Cookies</span><span class="op" id="3027879">(</span><span class="op" id="3027880">)</span>&nbsp;<span class="op" id="3027882">[</span><span class="op" id="3027883">]</span><span class="op" id="3027884">*</span><span class="ident" id="3027885">Cookie</span>&nbsp;<span class="op" id="3027892">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3027895">return</span>&nbsp;<span class="ident" id="3027902">readCookies</span><span class="op" id="3027913">(</span><span class="ident" id="3027914">r</span><span class="op" id="3027915">.</span><span class="ident" id="3027916">Header</span><span class="op" id="3027922">,</span>&nbsp;<span class="string" id="3027924">&#34;&#34;</span><span class="op" id="3027926">)</span><br>
<span class="lineno"></span><span class="op" id="3027928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3027931">var</span>&nbsp;<span class="ident" id="3027935">ErrNoCookie</span>&nbsp;<span class="op" id="3027947">=</span>&nbsp;<span class="ident" id="3027949">errors</span><span class="op" id="3027955">.</span><span class="ident" id="3027956">New</span><span class="op" id="3027959">(</span><span class="string" id="3027960">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="3027992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3027995">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3028057">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3028086">func</span>&nbsp;<span class="op" id="3028091">(</span><span class="ident" id="3028092">r</span>&nbsp;<span class="op" id="3028094">*</span><span class="ident" id="3028095">Request</span><span class="op" id="3028102">)</span>&nbsp;<span class="ident" id="3028104">Cookie</span><span class="op" id="3028110">(</span><span class="ident" id="3028111">name</span>&nbsp;<span class="builtintype" id="3028116">string</span><span class="op" id="3028122">)</span>&nbsp;<span class="op" id="3028124">(</span><span class="op" id="3028125">*</span><span class="ident" id="3028126">Cookie</span><span class="op" id="3028132">,</span>&nbsp;<span class="builtintype" id="3028134">error</span><span class="op" id="3028139">)</span>&nbsp;<span class="op" id="3028141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028144">for</span>&nbsp;<span class="ident" id="3028148">_</span><span class="op" id="3028149">,</span>&nbsp;<span class="ident" id="3028151">c</span>&nbsp;<span class="op" id="3028153">:=</span>&nbsp;<span class="keyword" id="3028156">range</span>&nbsp;<span class="ident" id="3028162">readCookies</span><span class="op" id="3028173">(</span><span class="ident" id="3028174">r</span><span class="op" id="3028175">.</span><span class="ident" id="3028176">Header</span><span class="op" id="3028182">,</span>&nbsp;<span class="ident" id="3028184">name</span><span class="op" id="3028188">)</span>&nbsp;<span class="op" id="3028190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028194">return</span>&nbsp;<span class="ident" id="3028201">c</span><span class="op" id="3028202">,</span>&nbsp;<span class="ident" id="3028204">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028212">return</span>&nbsp;<span class="ident" id="3028219">nil</span><span class="op" id="3028222">,</span>&nbsp;<span class="ident" id="3028224">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="3028236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3028239">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="3028309">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="3028379">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="3028441">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="3028468">func</span>&nbsp;<span class="op" id="3028473">(</span><span class="ident" id="3028474">r</span>&nbsp;<span class="op" id="3028476">*</span><span class="ident" id="3028477">Request</span><span class="op" id="3028484">)</span>&nbsp;<span class="ident" id="3028486">AddCookie</span><span class="op" id="3028495">(</span><span class="ident" id="3028496">c</span>&nbsp;<span class="op" id="3028498">*</span><span class="ident" id="3028499">Cookie</span><span class="op" id="3028505">)</span>&nbsp;<span class="op" id="3028507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028510">s</span>&nbsp;<span class="op" id="3028512">:=</span>&nbsp;<span class="ident" id="3028515">fmt</span><span class="op" id="3028518">.</span><span class="ident" id="3028519">Sprintf</span><span class="op" id="3028526">(</span><span class="string" id="3028527">&#34;%s=%s&#34;</span><span class="op" id="3028534">,</span>&nbsp;<span class="ident" id="3028536">sanitizeCookieName</span><span class="op" id="3028554">(</span><span class="ident" id="3028555">c</span><span class="op" id="3028556">.</span><span class="ident" id="3028557">Name</span><span class="op" id="3028561">)</span><span class="op" id="3028562">,</span>&nbsp;<span class="ident" id="3028564">sanitizeCookieValue</span><span class="op" id="3028583">(</span><span class="ident" id="3028584">c</span><span class="op" id="3028585">.</span><span class="ident" id="3028586">Value</span><span class="op" id="3028591">)</span><span class="op" id="3028592">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3028595">if</span>&nbsp;<span class="ident" id="3028598">c</span>&nbsp;<span class="op" id="3028600">:=</span>&nbsp;<span class="ident" id="3028603">r</span><span class="op" id="3028604">.</span><span class="ident" id="3028605">Header</span><span class="op" id="3028611">.</span><span class="ident" id="3028612">Get</span><span class="op" id="3028615">(</span><span class="string" id="3028616">&#34;Cookie&#34;</span><span class="op" id="3028624">)</span><span class="op" id="3028625">;</span>&nbsp;<span class="ident" id="3028627">c</span>&nbsp;<span class="op" id="3028629">!=</span>&nbsp;<span class="string" id="3028632">&#34;&#34;</span>&nbsp;<span class="op" id="3028635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028639">r</span><span class="op" id="3028640">.</span><span class="ident" id="3028641">Header</span><span class="op" id="3028647">.</span><span class="ident" id="3028648">Set</span><span class="op" id="3028651">(</span><span class="string" id="3028652">&#34;Cookie&#34;</span><span class="op" id="3028660">,</span>&nbsp;<span class="ident" id="3028662">c</span><span class="op" id="3028663">+</span><span class="string" id="3028664">&#34;;&nbsp;&#34;</span><span class="op" id="3028668">+</span><span class="ident" id="3028669">s</span><span class="op" id="3028670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028673">}</span>&nbsp;<span class="keyword" id="3028675">else</span>&nbsp;<span class="op" id="3028680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3028684">r</span><span class="op" id="3028685">.</span><span class="ident" id="3028686">Header</span><span class="op" id="3028692">.</span><span class="ident" id="3028693">Set</span><span class="op" id="3028696">(</span><span class="string" id="3028697">&#34;Cookie&#34;</span><span class="op" id="3028705">,</span>&nbsp;<span class="ident" id="3028707">s</span><span class="op" id="3028708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3028711">}</span><br>
<span class="lineno">270</span><span class="op" id="3028713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3028716">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3028778">//</span><br>
<span class="lineno"></span><span class="comment" id="3028781">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="3028851">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3028918">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="3028989">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3029060">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="3029126">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="3029176">func</span>&nbsp;<span class="op" id="3029181">(</span><span class="ident" id="3029182">r</span>&nbsp;<span class="op" id="3029184">*</span><span class="ident" id="3029185">Request</span><span class="op" id="3029192">)</span>&nbsp;<span class="ident" id="3029194">Referer</span><span class="op" id="3029201">(</span><span class="op" id="3029202">)</span>&nbsp;<span class="builtintype" id="3029204">string</span>&nbsp;<span class="op" id="3029211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029214">return</span>&nbsp;<span class="ident" id="3029221">r</span><span class="op" id="3029222">.</span><span class="ident" id="3029223">Header</span><span class="op" id="3029229">.</span><span class="ident" id="3029230">Get</span><span class="op" id="3029233">(</span><span class="string" id="3029234">&#34;Referer&#34;</span><span class="op" id="3029243">)</span><br>
<span class="lineno"></span><span class="op" id="3029245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029248">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="3029290">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="3029369">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="3029449">var</span>&nbsp;<span class="ident" id="3029453">multipartByReader</span>&nbsp;<span class="op" id="3029471">=</span>&nbsp;<span class="op" id="3029473">&amp;</span><span class="ident" id="3029474">multipart</span><span class="op" id="3029483">.</span><span class="ident" id="3029484">Form</span><span class="op" id="3029488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029491">Value</span><span class="op" id="3029496">:</span>&nbsp;<span class="builtinfunc" id="3029498">make</span><span class="op" id="3029502">(</span><span class="keyword" id="3029503">map</span><span class="op" id="3029506">[</span><span class="builtintype" id="3029507">string</span><span class="op" id="3029513">]</span><span class="op" id="3029514">[</span><span class="op" id="3029515">]</span><span class="builtintype" id="3029516">string</span><span class="op" id="3029522">)</span><span class="op" id="3029523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3029526">File</span><span class="op" id="3029530">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3029533">make</span><span class="op" id="3029537">(</span><span class="keyword" id="3029538">map</span><span class="op" id="3029541">[</span><span class="builtintype" id="3029542">string</span><span class="op" id="3029548">]</span><span class="op" id="3029549">[</span><span class="op" id="3029550">]</span><span class="op" id="3029551">*</span><span class="ident" id="3029552">multipart</span><span class="op" id="3029561">.</span><span class="ident" id="3029562">FileHeader</span><span class="op" id="3029572">)</span><span class="op" id="3029573">,</span><br>
<span class="lineno">290</span><span class="op" id="3029575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3029578">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3029642">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3029710">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="3029764">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="3029805">func</span>&nbsp;<span class="op" id="3029810">(</span><span class="ident" id="3029811">r</span>&nbsp;<span class="op" id="3029813">*</span><span class="ident" id="3029814">Request</span><span class="op" id="3029821">)</span>&nbsp;<span class="ident" id="3029823">MultipartReader</span><span class="op" id="3029838">(</span><span class="op" id="3029839">)</span>&nbsp;<span class="op" id="3029841">(</span><span class="op" id="3029842">*</span><span class="ident" id="3029843">multipart</span><span class="op" id="3029852">.</span><span class="ident" id="3029853">Reader</span><span class="op" id="3029859">,</span>&nbsp;<span class="builtintype" id="3029861">error</span><span class="op" id="3029866">)</span>&nbsp;<span class="op" id="3029868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029871">if</span>&nbsp;<span class="ident" id="3029874">r</span><span class="op" id="3029875">.</span><span class="ident" id="3029876">MultipartForm</span>&nbsp;<span class="op" id="3029890">==</span>&nbsp;<span class="ident" id="3029893">multipartByReader</span>&nbsp;<span class="op" id="3029911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029915">return</span>&nbsp;<span class="ident" id="3029922">nil</span><span class="op" id="3029925">,</span>&nbsp;<span class="ident" id="3029927">errors</span><span class="op" id="3029933">.</span><span class="ident" id="3029934">New</span><span class="op" id="3029937">(</span><span class="string" id="3029938">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="3029974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3029977">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3029980">if</span>&nbsp;<span class="ident" id="3029983">r</span><span class="op" id="3029984">.</span><span class="ident" id="3029985">MultipartForm</span>&nbsp;<span class="op" id="3029999">!=</span>&nbsp;<span class="ident" id="3030002">nil</span>&nbsp;<span class="op" id="3030006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030010">return</span>&nbsp;<span class="ident" id="3030017">nil</span><span class="op" id="3030020">,</span>&nbsp;<span class="ident" id="3030022">errors</span><span class="op" id="3030028">.</span><span class="ident" id="3030029">New</span><span class="op" id="3030032">(</span><span class="string" id="3030033">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="3030080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030086">r</span><span class="op" id="3030087">.</span><span class="ident" id="3030088">MultipartForm</span>&nbsp;<span class="op" id="3030102">=</span>&nbsp;<span class="ident" id="3030104">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030123">return</span>&nbsp;<span class="ident" id="3030130">r</span><span class="op" id="3030131">.</span><span class="ident" id="3030132">multipartReader</span><span class="op" id="3030147">(</span><span class="op" id="3030148">)</span><br>
<span class="lineno">305</span><span class="op" id="3030150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3030153">func</span>&nbsp;<span class="op" id="3030158">(</span><span class="ident" id="3030159">r</span>&nbsp;<span class="op" id="3030161">*</span><span class="ident" id="3030162">Request</span><span class="op" id="3030169">)</span>&nbsp;<span class="ident" id="3030171">multipartReader</span><span class="op" id="3030186">(</span><span class="op" id="3030187">)</span>&nbsp;<span class="op" id="3030189">(</span><span class="op" id="3030190">*</span><span class="ident" id="3030191">multipart</span><span class="op" id="3030200">.</span><span class="ident" id="3030201">Reader</span><span class="op" id="3030207">,</span>&nbsp;<span class="builtintype" id="3030209">error</span><span class="op" id="3030214">)</span>&nbsp;<span class="op" id="3030216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030219">v</span>&nbsp;<span class="op" id="3030221">:=</span>&nbsp;<span class="ident" id="3030224">r</span><span class="op" id="3030225">.</span><span class="ident" id="3030226">Header</span><span class="op" id="3030232">.</span><span class="ident" id="3030233">Get</span><span class="op" id="3030236">(</span><span class="string" id="3030237">&#34;Content-Type&#34;</span><span class="op" id="3030251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030254">if</span>&nbsp;<span class="ident" id="3030257">v</span>&nbsp;<span class="op" id="3030259">==</span>&nbsp;<span class="string" id="3030262">&#34;&#34;</span>&nbsp;<span class="op" id="3030265">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030269">return</span>&nbsp;<span class="ident" id="3030276">nil</span><span class="op" id="3030279">,</span>&nbsp;<span class="ident" id="3030281">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030301">d</span><span class="op" id="3030302">,</span>&nbsp;<span class="ident" id="3030304">params</span><span class="op" id="3030310">,</span>&nbsp;<span class="ident" id="3030312">err</span>&nbsp;<span class="op" id="3030316">:=</span>&nbsp;<span class="ident" id="3030319">mime</span><span class="op" id="3030323">.</span><span class="ident" id="3030324">ParseMediaType</span><span class="op" id="3030338">(</span><span class="ident" id="3030339">v</span><span class="op" id="3030340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030343">if</span>&nbsp;<span class="ident" id="3030346">err</span>&nbsp;<span class="op" id="3030350">!=</span>&nbsp;<span class="ident" id="3030353">nil</span>&nbsp;<span class="op" id="3030357">||</span>&nbsp;<span class="ident" id="3030360">d</span>&nbsp;<span class="op" id="3030362">!=</span>&nbsp;<span class="string" id="3030365">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="3030387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030391">return</span>&nbsp;<span class="ident" id="3030398">nil</span><span class="op" id="3030401">,</span>&nbsp;<span class="ident" id="3030403">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3030423">boundary</span><span class="op" id="3030431">,</span>&nbsp;<span class="ident" id="3030433">ok</span>&nbsp;<span class="op" id="3030436">:=</span>&nbsp;<span class="ident" id="3030439">params</span><span class="op" id="3030445">[</span><span class="string" id="3030446">&#34;boundary&#34;</span><span class="op" id="3030456">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030459">if</span>&nbsp;<span class="op" id="3030462">!</span><span class="ident" id="3030463">ok</span>&nbsp;<span class="op" id="3030466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030470">return</span>&nbsp;<span class="ident" id="3030477">nil</span><span class="op" id="3030480">,</span>&nbsp;<span class="ident" id="3030482">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030502">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030505">return</span>&nbsp;<span class="ident" id="3030512">multipart</span><span class="op" id="3030521">.</span><span class="ident" id="3030522">NewReader</span><span class="op" id="3030531">(</span><span class="ident" id="3030532">r</span><span class="op" id="3030533">.</span><span class="ident" id="3030534">Body</span><span class="op" id="3030538">,</span>&nbsp;<span class="ident" id="3030540">boundary</span><span class="op" id="3030548">)</span><span class="op" id="3030549">,</span>&nbsp;<span class="ident" id="3030551">nil</span><br>
<span class="lineno"></span><span class="op" id="3030555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3030558">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="3030602">func</span>&nbsp;<span class="ident" id="3030607">valueOrDefault</span><span class="op" id="3030621">(</span><span class="ident" id="3030622">value</span><span class="op" id="3030627">,</span>&nbsp;<span class="ident" id="3030629">def</span>&nbsp;<span class="builtintype" id="3030633">string</span><span class="op" id="3030639">)</span>&nbsp;<span class="builtintype" id="3030641">string</span>&nbsp;<span class="op" id="3030648">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030651">if</span>&nbsp;<span class="ident" id="3030654">value</span>&nbsp;<span class="op" id="3030660">!=</span>&nbsp;<span class="string" id="3030663">&#34;&#34;</span>&nbsp;<span class="op" id="3030666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030670">return</span>&nbsp;<span class="ident" id="3030677">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3030684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3030687">return</span>&nbsp;<span class="ident" id="3030694">def</span><br>
<span class="lineno"></span><span class="op" id="3030698">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="3030701">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3030776">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3030849">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="3030922">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="3030978">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="3031025">const</span>&nbsp;<span class="ident" id="3031031">defaultUserAgent</span>&nbsp;<span class="op" id="3031048">=</span>&nbsp;<span class="string" id="3031050">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3031073">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="3031147">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="3031208">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="3031216">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="3031223">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="3031253">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="3031263">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="3031280">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3031300">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="3031308">//</span><br>
<span class="lineno"></span><span class="comment" id="3031311">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3031378">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="3031443">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3031503">func</span>&nbsp;<span class="op" id="3031508">(</span><span class="ident" id="3031509">r</span>&nbsp;<span class="op" id="3031511">*</span><span class="ident" id="3031512">Request</span><span class="op" id="3031519">)</span>&nbsp;<span class="ident" id="3031521">Write</span><span class="op" id="3031526">(</span><span class="ident" id="3031527">w</span>&nbsp;<span class="ident" id="3031529">io</span><span class="op" id="3031531">.</span><span class="ident" id="3031532">Writer</span><span class="op" id="3031538">)</span>&nbsp;<span class="builtintype" id="3031540">error</span>&nbsp;<span class="op" id="3031546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031549">return</span>&nbsp;<span class="ident" id="3031556">r</span><span class="op" id="3031557">.</span><span class="ident" id="3031558">write</span><span class="op" id="3031563">(</span><span class="ident" id="3031564">w</span><span class="op" id="3031565">,</span>&nbsp;<span class="builtintype" id="3031567">false</span><span class="op" id="3031572">,</span>&nbsp;<span class="ident" id="3031574">nil</span><span class="op" id="3031577">)</span><br>
<span class="lineno"></span><span class="op" id="3031579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="3031582">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3031645">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3031713">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="3031782">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="3031843">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="3031906">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="3031938">func</span>&nbsp;<span class="op" id="3031943">(</span><span class="ident" id="3031944">r</span>&nbsp;<span class="op" id="3031946">*</span><span class="ident" id="3031947">Request</span><span class="op" id="3031954">)</span>&nbsp;<span class="ident" id="3031956">WriteProxy</span><span class="op" id="3031966">(</span><span class="ident" id="3031967">w</span>&nbsp;<span class="ident" id="3031969">io</span><span class="op" id="3031971">.</span><span class="ident" id="3031972">Writer</span><span class="op" id="3031978">)</span>&nbsp;<span class="builtintype" id="3031980">error</span>&nbsp;<span class="op" id="3031986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3031989">return</span>&nbsp;<span class="ident" id="3031996">r</span><span class="op" id="3031997">.</span><span class="ident" id="3031998">write</span><span class="op" id="3032003">(</span><span class="ident" id="3032004">w</span><span class="op" id="3032005">,</span>&nbsp;<span class="builtintype" id="3032007">true</span><span class="op" id="3032011">,</span>&nbsp;<span class="ident" id="3032013">nil</span><span class="op" id="3032016">)</span><br>
<span class="lineno"></span><span class="op" id="3032018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="3032021">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="3032048">func</span>&nbsp;<span class="op" id="3032053">(</span><span class="ident" id="3032054">req</span>&nbsp;<span class="op" id="3032058">*</span><span class="ident" id="3032059">Request</span><span class="op" id="3032066">)</span>&nbsp;<span class="ident" id="3032068">write</span><span class="op" id="3032073">(</span><span class="ident" id="3032074">w</span>&nbsp;<span class="ident" id="3032076">io</span><span class="op" id="3032078">.</span><span class="ident" id="3032079">Writer</span><span class="op" id="3032085">,</span>&nbsp;<span class="ident" id="3032087">usingProxy</span>&nbsp;<span class="builtintype" id="3032098">bool</span><span class="op" id="3032102">,</span>&nbsp;<span class="ident" id="3032104">extraHeaders</span>&nbsp;<span class="ident" id="3032117">Header</span><span class="op" id="3032123">)</span>&nbsp;<span class="builtintype" id="3032125">error</span>&nbsp;<span class="op" id="3032131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032134">host</span>&nbsp;<span class="op" id="3032139">:=</span>&nbsp;<span class="ident" id="3032142">req</span><span class="op" id="3032145">.</span><span class="ident" id="3032146">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032152">if</span>&nbsp;<span class="ident" id="3032155">host</span>&nbsp;<span class="op" id="3032160">==</span>&nbsp;<span class="string" id="3032163">&#34;&#34;</span>&nbsp;<span class="op" id="3032166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032170">if</span>&nbsp;<span class="ident" id="3032173">req</span><span class="op" id="3032176">.</span><span class="ident" id="3032177">URL</span>&nbsp;<span class="op" id="3032181">==</span>&nbsp;<span class="ident" id="3032184">nil</span>&nbsp;<span class="op" id="3032188">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032193">return</span>&nbsp;<span class="ident" id="3032200">errors</span><span class="op" id="3032206">.</span><span class="ident" id="3032207">New</span><span class="op" id="3032210">(</span><span class="string" id="3032211">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="3032267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032275">host</span>&nbsp;<span class="op" id="3032280">=</span>&nbsp;<span class="ident" id="3032282">req</span><span class="op" id="3032285">.</span><span class="ident" id="3032286">URL</span><span class="op" id="3032289">.</span><span class="ident" id="3032290">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032300">ruri</span>&nbsp;<span class="op" id="3032305">:=</span>&nbsp;<span class="ident" id="3032308">req</span><span class="op" id="3032311">.</span><span class="ident" id="3032312">URL</span><span class="op" id="3032315">.</span><span class="ident" id="3032316">RequestURI</span><span class="op" id="3032326">(</span><span class="op" id="3032327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032330">if</span>&nbsp;<span class="ident" id="3032333">usingProxy</span>&nbsp;<span class="op" id="3032344">&amp;&amp;</span>&nbsp;<span class="ident" id="3032347">req</span><span class="op" id="3032350">.</span><span class="ident" id="3032351">URL</span><span class="op" id="3032354">.</span><span class="ident" id="3032355">Scheme</span>&nbsp;<span class="op" id="3032362">!=</span>&nbsp;<span class="string" id="3032365">&#34;&#34;</span>&nbsp;<span class="op" id="3032368">&amp;&amp;</span>&nbsp;<span class="ident" id="3032371">req</span><span class="op" id="3032374">.</span><span class="ident" id="3032375">URL</span><span class="op" id="3032378">.</span><span class="ident" id="3032379">Opaque</span>&nbsp;<span class="op" id="3032386">==</span>&nbsp;<span class="string" id="3032389">&#34;&#34;</span>&nbsp;<span class="op" id="3032392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032396">ruri</span>&nbsp;<span class="op" id="3032401">=</span>&nbsp;<span class="ident" id="3032403">req</span><span class="op" id="3032406">.</span><span class="ident" id="3032407">URL</span><span class="op" id="3032410">.</span><span class="ident" id="3032411">Scheme</span>&nbsp;<span class="op" id="3032418">+</span>&nbsp;<span class="string" id="3032420">&#34;://&#34;</span>&nbsp;<span class="op" id="3032426">+</span>&nbsp;<span class="ident" id="3032428">host</span>&nbsp;<span class="op" id="3032433">+</span>&nbsp;<span class="ident" id="3032435">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032441">}</span>&nbsp;<span class="keyword" id="3032443">else</span>&nbsp;<span class="keyword" id="3032448">if</span>&nbsp;<span class="ident" id="3032451">req</span><span class="op" id="3032454">.</span><span class="ident" id="3032455">Method</span>&nbsp;<span class="op" id="3032462">==</span>&nbsp;<span class="string" id="3032465">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3032475">&amp;&amp;</span>&nbsp;<span class="ident" id="3032478">req</span><span class="op" id="3032481">.</span><span class="ident" id="3032482">URL</span><span class="op" id="3032485">.</span><span class="ident" id="3032486">Path</span>&nbsp;<span class="op" id="3032491">==</span>&nbsp;<span class="string" id="3032494">&#34;&#34;</span>&nbsp;<span class="op" id="3032497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032501">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032577">ruri</span>&nbsp;<span class="op" id="3032582">=</span>&nbsp;<span class="ident" id="3032584">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032593">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032648">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032716">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032779">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3032841">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032851">var</span>&nbsp;<span class="ident" id="3032855">bw</span>&nbsp;<span class="op" id="3032858">*</span><span class="ident" id="3032859">bufio</span><span class="op" id="3032864">.</span><span class="ident" id="3032865">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3032873">if</span>&nbsp;<span class="ident" id="3032876">_</span><span class="op" id="3032877">,</span>&nbsp;<span class="ident" id="3032879">ok</span>&nbsp;<span class="op" id="3032882">:=</span>&nbsp;<span class="ident" id="3032885">w</span><span class="op" id="3032886">.</span><span class="op" id="3032887">(</span><span class="ident" id="3032888">io</span><span class="op" id="3032890">.</span><span class="ident" id="3032891">ByteWriter</span><span class="op" id="3032901">)</span><span class="op" id="3032902">;</span>&nbsp;<span class="op" id="3032904">!</span><span class="ident" id="3032905">ok</span>&nbsp;<span class="op" id="3032908">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032912">bw</span>&nbsp;<span class="op" id="3032915">=</span>&nbsp;<span class="ident" id="3032917">bufio</span><span class="op" id="3032922">.</span><span class="ident" id="3032923">NewWriter</span><span class="op" id="3032932">(</span><span class="ident" id="3032933">w</span><span class="op" id="3032934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032938">w</span>&nbsp;<span class="op" id="3032940">=</span>&nbsp;<span class="ident" id="3032942">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3032946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3032950">_</span><span class="op" id="3032951">,</span>&nbsp;<span class="ident" id="3032953">err</span>&nbsp;<span class="op" id="3032957">:=</span>&nbsp;<span class="ident" id="3032960">fmt</span><span class="op" id="3032963">.</span><span class="ident" id="3032964">Fprintf</span><span class="op" id="3032971">(</span><span class="ident" id="3032972">w</span><span class="op" id="3032973">,</span>&nbsp;<span class="string" id="3032975">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="3032995">,</span>&nbsp;<span class="ident" id="3032997">valueOrDefault</span><span class="op" id="3033011">(</span><span class="ident" id="3033012">req</span><span class="op" id="3033015">.</span><span class="ident" id="3033016">Method</span><span class="op" id="3033022">,</span>&nbsp;<span class="string" id="3033024">&#34;GET&#34;</span><span class="op" id="3033029">)</span><span class="op" id="3033030">,</span>&nbsp;<span class="ident" id="3033032">ruri</span><span class="op" id="3033036">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033039">if</span>&nbsp;<span class="ident" id="3033042">err</span>&nbsp;<span class="op" id="3033046">!=</span>&nbsp;<span class="ident" id="3033049">nil</span>&nbsp;<span class="op" id="3033053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033057">return</span>&nbsp;<span class="ident" id="3033064">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3033073">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033090">_</span><span class="op" id="3033091">,</span>&nbsp;<span class="ident" id="3033093">err</span>&nbsp;<span class="op" id="3033097">=</span>&nbsp;<span class="ident" id="3033099">fmt</span><span class="op" id="3033102">.</span><span class="ident" id="3033103">Fprintf</span><span class="op" id="3033110">(</span><span class="ident" id="3033111">w</span><span class="op" id="3033112">,</span>&nbsp;<span class="string" id="3033114">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="3033128">,</span>&nbsp;<span class="ident" id="3033130">host</span><span class="op" id="3033134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033137">if</span>&nbsp;<span class="ident" id="3033140">err</span>&nbsp;<span class="op" id="3033144">!=</span>&nbsp;<span class="ident" id="3033147">nil</span>&nbsp;<span class="op" id="3033151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033155">return</span>&nbsp;<span class="ident" id="3033162">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3033171">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3033238">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033279">userAgent</span>&nbsp;<span class="op" id="3033289">:=</span>&nbsp;<span class="ident" id="3033292">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033310">if</span>&nbsp;<span class="ident" id="3033313">req</span><span class="op" id="3033316">.</span><span class="ident" id="3033317">Header</span>&nbsp;<span class="op" id="3033324">!=</span>&nbsp;<span class="ident" id="3033327">nil</span>&nbsp;<span class="op" id="3033331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033335">if</span>&nbsp;<span class="ident" id="3033338">ua</span>&nbsp;<span class="op" id="3033341">:=</span>&nbsp;<span class="ident" id="3033344">req</span><span class="op" id="3033347">.</span><span class="ident" id="3033348">Header</span><span class="op" id="3033354">[</span><span class="string" id="3033355">&#34;User-Agent&#34;</span><span class="op" id="3033367">]</span><span class="op" id="3033368">;</span>&nbsp;<span class="builtinfunc" id="3033370">len</span><span class="op" id="3033373">(</span><span class="ident" id="3033374">ua</span><span class="op" id="3033376">)</span>&nbsp;<span class="op" id="3033378">&gt;</span>&nbsp;<span class="num" id="3033380">0</span>&nbsp;<span class="op" id="3033382">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033387">userAgent</span>&nbsp;<span class="op" id="3033397">=</span>&nbsp;<span class="ident" id="3033399">ua</span><span class="op" id="3033401">[</span><span class="num" id="3033402">0</span><span class="op" id="3033403">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033413">if</span>&nbsp;<span class="ident" id="3033416">userAgent</span>&nbsp;<span class="op" id="3033426">!=</span>&nbsp;<span class="string" id="3033429">&#34;&#34;</span>&nbsp;<span class="op" id="3033432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033436">_</span><span class="op" id="3033437">,</span>&nbsp;<span class="ident" id="3033439">err</span>&nbsp;<span class="op" id="3033443">=</span>&nbsp;<span class="ident" id="3033445">fmt</span><span class="op" id="3033448">.</span><span class="ident" id="3033449">Fprintf</span><span class="op" id="3033456">(</span><span class="ident" id="3033457">w</span><span class="op" id="3033458">,</span>&nbsp;<span class="string" id="3033460">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="3033480">,</span>&nbsp;<span class="ident" id="3033482">userAgent</span><span class="op" id="3033491">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033495">if</span>&nbsp;<span class="ident" id="3033498">err</span>&nbsp;<span class="op" id="3033502">!=</span>&nbsp;<span class="ident" id="3033505">nil</span>&nbsp;<span class="op" id="3033509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033514">return</span>&nbsp;<span class="ident" id="3033521">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3033534">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033579">tw</span><span class="op" id="3033581">,</span>&nbsp;<span class="ident" id="3033583">err</span>&nbsp;<span class="op" id="3033587">:=</span>&nbsp;<span class="ident" id="3033590">newTransferWriter</span><span class="op" id="3033607">(</span><span class="ident" id="3033608">req</span><span class="op" id="3033611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033614">if</span>&nbsp;<span class="ident" id="3033617">err</span>&nbsp;<span class="op" id="3033621">!=</span>&nbsp;<span class="ident" id="3033624">nil</span>&nbsp;<span class="op" id="3033628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033632">return</span>&nbsp;<span class="ident" id="3033639">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033644">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033647">err</span>&nbsp;<span class="op" id="3033651">=</span>&nbsp;<span class="ident" id="3033653">tw</span><span class="op" id="3033655">.</span><span class="ident" id="3033656">WriteHeader</span><span class="op" id="3033667">(</span><span class="ident" id="3033668">w</span><span class="op" id="3033669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033672">if</span>&nbsp;<span class="ident" id="3033675">err</span>&nbsp;<span class="op" id="3033679">!=</span>&nbsp;<span class="ident" id="3033682">nil</span>&nbsp;<span class="op" id="3033686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033690">return</span>&nbsp;<span class="ident" id="3033697">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033706">err</span>&nbsp;<span class="op" id="3033710">=</span>&nbsp;<span class="ident" id="3033712">req</span><span class="op" id="3033715">.</span><span class="ident" id="3033716">Header</span><span class="op" id="3033722">.</span><span class="ident" id="3033723">WriteSubset</span><span class="op" id="3033734">(</span><span class="ident" id="3033735">w</span><span class="op" id="3033736">,</span>&nbsp;<span class="ident" id="3033738">reqWriteExcludeHeader</span><span class="op" id="3033759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033762">if</span>&nbsp;<span class="ident" id="3033765">err</span>&nbsp;<span class="op" id="3033769">!=</span>&nbsp;<span class="ident" id="3033772">nil</span>&nbsp;<span class="op" id="3033776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033780">return</span>&nbsp;<span class="ident" id="3033787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033796">if</span>&nbsp;<span class="ident" id="3033799">extraHeaders</span>&nbsp;<span class="op" id="3033812">!=</span>&nbsp;<span class="ident" id="3033815">nil</span>&nbsp;<span class="op" id="3033819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033823">err</span>&nbsp;<span class="op" id="3033827">=</span>&nbsp;<span class="ident" id="3033829">extraHeaders</span><span class="op" id="3033841">.</span><span class="ident" id="3033842">Write</span><span class="op" id="3033847">(</span><span class="ident" id="3033848">w</span><span class="op" id="3033849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033853">if</span>&nbsp;<span class="ident" id="3033856">err</span>&nbsp;<span class="op" id="3033860">!=</span>&nbsp;<span class="ident" id="3033863">nil</span>&nbsp;<span class="op" id="3033867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033872">return</span>&nbsp;<span class="ident" id="3033879">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033885">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033892">_</span><span class="op" id="3033893">,</span>&nbsp;<span class="ident" id="3033895">err</span>&nbsp;<span class="op" id="3033899">=</span>&nbsp;<span class="ident" id="3033901">io</span><span class="op" id="3033903">.</span><span class="ident" id="3033904">WriteString</span><span class="op" id="3033915">(</span><span class="ident" id="3033916">w</span><span class="op" id="3033917">,</span>&nbsp;<span class="string" id="3033919">&#34;\r\n&#34;</span><span class="op" id="3033925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033928">if</span>&nbsp;<span class="ident" id="3033931">err</span>&nbsp;<span class="op" id="3033935">!=</span>&nbsp;<span class="ident" id="3033938">nil</span>&nbsp;<span class="op" id="3033942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3033946">return</span>&nbsp;<span class="ident" id="3033953">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3033958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3033962">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3033989">err</span>&nbsp;<span class="op" id="3033993">=</span>&nbsp;<span class="ident" id="3033995">tw</span><span class="op" id="3033997">.</span><span class="ident" id="3033998">WriteBody</span><span class="op" id="3034007">(</span><span class="ident" id="3034008">w</span><span class="op" id="3034009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034012">if</span>&nbsp;<span class="ident" id="3034015">err</span>&nbsp;<span class="op" id="3034019">!=</span>&nbsp;<span class="ident" id="3034022">nil</span>&nbsp;<span class="op" id="3034026">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034030">return</span>&nbsp;<span class="ident" id="3034037">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034046">if</span>&nbsp;<span class="ident" id="3034049">bw</span>&nbsp;<span class="op" id="3034052">!=</span>&nbsp;<span class="ident" id="3034055">nil</span>&nbsp;<span class="op" id="3034059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034063">return</span>&nbsp;<span class="ident" id="3034070">bw</span><span class="op" id="3034072">.</span><span class="ident" id="3034073">Flush</span><span class="op" id="3034078">(</span><span class="op" id="3034079">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034085">return</span>&nbsp;<span class="ident" id="3034092">nil</span><br>
<span class="lineno"></span><span class="op" id="3034096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3034099">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="3034149">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3034185">func</span>&nbsp;<span class="ident" id="3034190">ParseHTTPVersion</span><span class="op" id="3034206">(</span><span class="ident" id="3034207">vers</span>&nbsp;<span class="builtintype" id="3034212">string</span><span class="op" id="3034218">)</span>&nbsp;<span class="op" id="3034220">(</span><span class="ident" id="3034221">major</span><span class="op" id="3034226">,</span>&nbsp;<span class="ident" id="3034228">minor</span>&nbsp;<span class="builtintype" id="3034234">int</span><span class="op" id="3034237">,</span>&nbsp;<span class="ident" id="3034239">ok</span>&nbsp;<span class="builtintype" id="3034242">bool</span><span class="op" id="3034246">)</span>&nbsp;<span class="op" id="3034248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034251">const</span>&nbsp;<span class="ident" id="3034257">Big</span>&nbsp;<span class="op" id="3034261">=</span>&nbsp;<span class="num" id="3034263">1000000</span>&nbsp;<span class="comment" id="3034271">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034297">switch</span>&nbsp;<span class="ident" id="3034304">vers</span>&nbsp;<span class="op" id="3034309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034312">case</span>&nbsp;<span class="string" id="3034317">&#34;HTTP/1.1&#34;</span><span class="op" id="3034327">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034331">return</span>&nbsp;<span class="num" id="3034338">1</span><span class="op" id="3034339">,</span>&nbsp;<span class="num" id="3034341">1</span><span class="op" id="3034342">,</span>&nbsp;<span class="builtintype" id="3034344">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034350">case</span>&nbsp;<span class="string" id="3034355">&#34;HTTP/1.0&#34;</span><span class="op" id="3034365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034369">return</span>&nbsp;<span class="num" id="3034376">1</span><span class="op" id="3034377">,</span>&nbsp;<span class="num" id="3034379">0</span><span class="op" id="3034380">,</span>&nbsp;<span class="builtintype" id="3034382">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034391">if</span>&nbsp;<span class="op" id="3034394">!</span><span class="ident" id="3034395">strings</span><span class="op" id="3034402">.</span><span class="ident" id="3034403">HasPrefix</span><span class="op" id="3034412">(</span><span class="ident" id="3034413">vers</span><span class="op" id="3034417">,</span>&nbsp;<span class="string" id="3034419">&#34;HTTP/&#34;</span><span class="op" id="3034426">)</span>&nbsp;<span class="op" id="3034428">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034432">return</span>&nbsp;<span class="num" id="3034439">0</span><span class="op" id="3034440">,</span>&nbsp;<span class="num" id="3034442">0</span><span class="op" id="3034443">,</span>&nbsp;<span class="builtintype" id="3034445">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3034455">dot</span>&nbsp;<span class="op" id="3034459">:=</span>&nbsp;<span class="ident" id="3034462">strings</span><span class="op" id="3034469">.</span><span class="ident" id="3034470">Index</span><span class="op" id="3034475">(</span><span class="ident" id="3034476">vers</span><span class="op" id="3034480">,</span>&nbsp;<span class="string" id="3034482">&#34;.&#34;</span><span class="op" id="3034485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034488">if</span>&nbsp;<span class="ident" id="3034491">dot</span>&nbsp;<span class="op" id="3034495">&lt;</span>&nbsp;<span class="num" id="3034497">0</span>&nbsp;<span class="op" id="3034499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034503">return</span>&nbsp;<span class="num" id="3034510">0</span><span class="op" id="3034511">,</span>&nbsp;<span class="num" id="3034513">0</span><span class="op" id="3034514">,</span>&nbsp;<span class="builtintype" id="3034516">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3034526">major</span><span class="op" id="3034531">,</span>&nbsp;<span class="ident" id="3034533">err</span>&nbsp;<span class="op" id="3034537">:=</span>&nbsp;<span class="ident" id="3034540">strconv</span><span class="op" id="3034547">.</span><span class="ident" id="3034548">Atoi</span><span class="op" id="3034552">(</span><span class="ident" id="3034553">vers</span><span class="op" id="3034557">[</span><span class="num" id="3034558">5</span><span class="op" id="3034559">:</span><span class="ident" id="3034560">dot</span><span class="op" id="3034563">]</span><span class="op" id="3034564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034567">if</span>&nbsp;<span class="ident" id="3034570">err</span>&nbsp;<span class="op" id="3034574">!=</span>&nbsp;<span class="ident" id="3034577">nil</span>&nbsp;<span class="op" id="3034581">||</span>&nbsp;<span class="ident" id="3034584">major</span>&nbsp;<span class="op" id="3034590">&lt;</span>&nbsp;<span class="num" id="3034592">0</span>&nbsp;<span class="op" id="3034594">||</span>&nbsp;<span class="ident" id="3034597">major</span>&nbsp;<span class="op" id="3034603">&gt;</span>&nbsp;<span class="ident" id="3034605">Big</span>&nbsp;<span class="op" id="3034609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034613">return</span>&nbsp;<span class="num" id="3034620">0</span><span class="op" id="3034621">,</span>&nbsp;<span class="num" id="3034623">0</span><span class="op" id="3034624">,</span>&nbsp;<span class="builtintype" id="3034626">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034633">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3034636">minor</span><span class="op" id="3034641">,</span>&nbsp;<span class="ident" id="3034643">err</span>&nbsp;<span class="op" id="3034647">=</span>&nbsp;<span class="ident" id="3034649">strconv</span><span class="op" id="3034656">.</span><span class="ident" id="3034657">Atoi</span><span class="op" id="3034661">(</span><span class="ident" id="3034662">vers</span><span class="op" id="3034666">[</span><span class="ident" id="3034667">dot</span><span class="op" id="3034670">+</span><span class="num" id="3034671">1</span><span class="op" id="3034672">:</span><span class="op" id="3034673">]</span><span class="op" id="3034674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034677">if</span>&nbsp;<span class="ident" id="3034680">err</span>&nbsp;<span class="op" id="3034684">!=</span>&nbsp;<span class="ident" id="3034687">nil</span>&nbsp;<span class="op" id="3034691">||</span>&nbsp;<span class="ident" id="3034694">minor</span>&nbsp;<span class="op" id="3034700">&lt;</span>&nbsp;<span class="num" id="3034702">0</span>&nbsp;<span class="op" id="3034704">||</span>&nbsp;<span class="ident" id="3034707">minor</span>&nbsp;<span class="op" id="3034713">&gt;</span>&nbsp;<span class="ident" id="3034715">Big</span>&nbsp;<span class="op" id="3034719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034723">return</span>&nbsp;<span class="num" id="3034730">0</span><span class="op" id="3034731">,</span>&nbsp;<span class="num" id="3034733">0</span><span class="op" id="3034734">,</span>&nbsp;<span class="builtintype" id="3034736">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3034743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3034746">return</span>&nbsp;<span class="ident" id="3034753">major</span><span class="op" id="3034758">,</span>&nbsp;<span class="ident" id="3034760">minor</span><span class="op" id="3034765">,</span>&nbsp;<span class="builtintype" id="3034767">true</span><br>
<span class="lineno">485</span><span class="op" id="3034772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3034775">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="3034851">//</span><br>
<span class="lineno"></span><span class="comment" id="3034854">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="3034913">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="3034977">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="3035037">func</span>&nbsp;<span class="ident" id="3035042">NewRequest</span><span class="op" id="3035052">(</span><span class="ident" id="3035053">method</span><span class="op" id="3035059">,</span>&nbsp;<span class="ident" id="3035061">urlStr</span>&nbsp;<span class="builtintype" id="3035068">string</span><span class="op" id="3035074">,</span>&nbsp;<span class="ident" id="3035076">body</span>&nbsp;<span class="ident" id="3035081">io</span><span class="op" id="3035083">.</span><span class="ident" id="3035084">Reader</span><span class="op" id="3035090">)</span>&nbsp;<span class="op" id="3035092">(</span><span class="op" id="3035093">*</span><span class="ident" id="3035094">Request</span><span class="op" id="3035101">,</span>&nbsp;<span class="builtintype" id="3035103">error</span><span class="op" id="3035108">)</span>&nbsp;<span class="op" id="3035110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035113">u</span><span class="op" id="3035114">,</span>&nbsp;<span class="ident" id="3035116">err</span>&nbsp;<span class="op" id="3035120">:=</span>&nbsp;<span class="ident" id="3035123">url</span><span class="op" id="3035126">.</span><span class="ident" id="3035127">Parse</span><span class="op" id="3035132">(</span><span class="ident" id="3035133">urlStr</span><span class="op" id="3035139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035142">if</span>&nbsp;<span class="ident" id="3035145">err</span>&nbsp;<span class="op" id="3035149">!=</span>&nbsp;<span class="ident" id="3035152">nil</span>&nbsp;<span class="op" id="3035156">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035160">return</span>&nbsp;<span class="ident" id="3035167">nil</span><span class="op" id="3035170">,</span>&nbsp;<span class="ident" id="3035172">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3035177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035180">rc</span><span class="op" id="3035182">,</span>&nbsp;<span class="ident" id="3035184">ok</span>&nbsp;<span class="op" id="3035187">:=</span>&nbsp;<span class="ident" id="3035190">body</span><span class="op" id="3035194">.</span><span class="op" id="3035195">(</span><span class="ident" id="3035196">io</span><span class="op" id="3035198">.</span><span class="ident" id="3035199">ReadCloser</span><span class="op" id="3035209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035212">if</span>&nbsp;<span class="op" id="3035215">!</span><span class="ident" id="3035216">ok</span>&nbsp;<span class="op" id="3035219">&amp;&amp;</span>&nbsp;<span class="ident" id="3035222">body</span>&nbsp;<span class="op" id="3035227">!=</span>&nbsp;<span class="ident" id="3035230">nil</span>&nbsp;<span class="op" id="3035234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035238">rc</span>&nbsp;<span class="op" id="3035241">=</span>&nbsp;<span class="ident" id="3035243">ioutil</span><span class="op" id="3035249">.</span><span class="ident" id="3035250">NopCloser</span><span class="op" id="3035259">(</span><span class="ident" id="3035260">body</span><span class="op" id="3035264">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3035267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035270">req</span>&nbsp;<span class="op" id="3035274">:=</span>&nbsp;<span class="op" id="3035277">&amp;</span><span class="ident" id="3035278">Request</span><span class="op" id="3035285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035289">Method</span><span class="op" id="3035295">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035301">method</span><span class="op" id="3035307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035311">URL</span><span class="op" id="3035314">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035323">u</span><span class="op" id="3035324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035328">Proto</span><span class="op" id="3035333">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3035340">&#34;HTTP/1.1&#34;</span><span class="op" id="3035350">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035354">ProtoMajor</span><span class="op" id="3035364">:</span>&nbsp;<span class="num" id="3035366">1</span><span class="op" id="3035367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035371">ProtoMinor</span><span class="op" id="3035381">:</span>&nbsp;<span class="num" id="3035383">1</span><span class="op" id="3035384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035388">Header</span><span class="op" id="3035394">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3035400">make</span><span class="op" id="3035404">(</span><span class="ident" id="3035405">Header</span><span class="op" id="3035411">)</span><span class="op" id="3035412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035416">Body</span><span class="op" id="3035420">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035428">rc</span><span class="op" id="3035430">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035434">Host</span><span class="op" id="3035438">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3035446">u</span><span class="op" id="3035447">.</span><span class="ident" id="3035448">Host</span><span class="op" id="3035452">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3035455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035458">if</span>&nbsp;<span class="ident" id="3035461">body</span>&nbsp;<span class="op" id="3035466">!=</span>&nbsp;<span class="ident" id="3035469">nil</span>&nbsp;<span class="op" id="3035473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035477">switch</span>&nbsp;<span class="ident" id="3035484">v</span>&nbsp;<span class="op" id="3035486">:=</span>&nbsp;<span class="ident" id="3035489">body</span><span class="op" id="3035493">.</span><span class="op" id="3035494">(</span><span class="keyword" id="3035495">type</span><span class="op" id="3035499">)</span>&nbsp;<span class="op" id="3035501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035505">case</span>&nbsp;<span class="op" id="3035510">*</span><span class="ident" id="3035511">bytes</span><span class="op" id="3035516">.</span><span class="ident" id="3035517">Buffer</span><span class="op" id="3035523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035528">req</span><span class="op" id="3035531">.</span><span class="ident" id="3035532">ContentLength</span>&nbsp;<span class="op" id="3035546">=</span>&nbsp;<span class="ident" id="3035548">int64</span><span class="op" id="3035553">(</span><span class="ident" id="3035554">v</span><span class="op" id="3035555">.</span><span class="ident" id="3035556">Len</span><span class="op" id="3035559">(</span><span class="op" id="3035560">)</span><span class="op" id="3035561">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035565">case</span>&nbsp;<span class="op" id="3035570">*</span><span class="ident" id="3035571">bytes</span><span class="op" id="3035576">.</span><span class="ident" id="3035577">Reader</span><span class="op" id="3035583">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035588">req</span><span class="op" id="3035591">.</span><span class="ident" id="3035592">ContentLength</span>&nbsp;<span class="op" id="3035606">=</span>&nbsp;<span class="ident" id="3035608">int64</span><span class="op" id="3035613">(</span><span class="ident" id="3035614">v</span><span class="op" id="3035615">.</span><span class="ident" id="3035616">Len</span><span class="op" id="3035619">(</span><span class="op" id="3035620">)</span><span class="op" id="3035621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035625">case</span>&nbsp;<span class="op" id="3035630">*</span><span class="ident" id="3035631">strings</span><span class="op" id="3035638">.</span><span class="ident" id="3035639">Reader</span><span class="op" id="3035645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035650">req</span><span class="op" id="3035653">.</span><span class="ident" id="3035654">ContentLength</span>&nbsp;<span class="op" id="3035668">=</span>&nbsp;<span class="ident" id="3035670">int64</span><span class="op" id="3035675">(</span><span class="ident" id="3035676">v</span><span class="op" id="3035677">.</span><span class="ident" id="3035678">Len</span><span class="op" id="3035681">(</span><span class="op" id="3035682">)</span><span class="op" id="3035683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3035687">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3035690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035694">return</span>&nbsp;<span class="ident" id="3035701">req</span><span class="op" id="3035704">,</span>&nbsp;<span class="ident" id="3035706">nil</span><br>
<span class="lineno"></span><span class="op" id="3035710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="3035713">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3035786">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="3035858">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="3035886">func</span>&nbsp;<span class="op" id="3035891">(</span><span class="ident" id="3035892">r</span>&nbsp;<span class="op" id="3035894">*</span><span class="ident" id="3035895">Request</span><span class="op" id="3035902">)</span>&nbsp;<span class="ident" id="3035904">BasicAuth</span><span class="op" id="3035913">(</span><span class="op" id="3035914">)</span>&nbsp;<span class="op" id="3035916">(</span><span class="ident" id="3035917">username</span><span class="op" id="3035925">,</span>&nbsp;<span class="ident" id="3035927">password</span>&nbsp;<span class="builtintype" id="3035936">string</span><span class="op" id="3035942">,</span>&nbsp;<span class="ident" id="3035944">ok</span>&nbsp;<span class="builtintype" id="3035947">bool</span><span class="op" id="3035951">)</span>&nbsp;<span class="op" id="3035953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3035956">auth</span>&nbsp;<span class="op" id="3035961">:=</span>&nbsp;<span class="ident" id="3035964">r</span><span class="op" id="3035965">.</span><span class="ident" id="3035966">Header</span><span class="op" id="3035972">.</span><span class="ident" id="3035973">Get</span><span class="op" id="3035976">(</span><span class="string" id="3035977">&#34;Authorization&#34;</span><span class="op" id="3035992">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3035995">if</span>&nbsp;<span class="ident" id="3035998">auth</span>&nbsp;<span class="op" id="3036003">==</span>&nbsp;<span class="string" id="3036006">&#34;&#34;</span>&nbsp;<span class="op" id="3036009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036013">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3036021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036024">return</span>&nbsp;<span class="ident" id="3036031">parseBasicAuth</span><span class="op" id="3036045">(</span><span class="ident" id="3036046">auth</span><span class="op" id="3036050">)</span><br>
<span class="lineno"></span><span class="op" id="3036052">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="3036055">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="3036117">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="3036199">func</span>&nbsp;<span class="ident" id="3036204">parseBasicAuth</span><span class="op" id="3036218">(</span><span class="ident" id="3036219">auth</span>&nbsp;<span class="builtintype" id="3036224">string</span><span class="op" id="3036230">)</span>&nbsp;<span class="op" id="3036232">(</span><span class="ident" id="3036233">username</span><span class="op" id="3036241">,</span>&nbsp;<span class="ident" id="3036243">password</span>&nbsp;<span class="builtintype" id="3036252">string</span><span class="op" id="3036258">,</span>&nbsp;<span class="ident" id="3036260">ok</span>&nbsp;<span class="builtintype" id="3036263">bool</span><span class="op" id="3036267">)</span>&nbsp;<span class="op" id="3036269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036272">if</span>&nbsp;<span class="op" id="3036275">!</span><span class="ident" id="3036276">strings</span><span class="op" id="3036283">.</span><span class="ident" id="3036284">HasPrefix</span><span class="op" id="3036293">(</span><span class="ident" id="3036294">auth</span><span class="op" id="3036298">,</span>&nbsp;<span class="string" id="3036300">&#34;Basic&nbsp;&#34;</span><span class="op" id="3036308">)</span>&nbsp;<span class="op" id="3036310">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3036322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3036325">c</span><span class="op" id="3036326">,</span>&nbsp;<span class="ident" id="3036328">err</span>&nbsp;<span class="op" id="3036332">:=</span>&nbsp;<span class="ident" id="3036335">base64</span><span class="op" id="3036341">.</span><span class="ident" id="3036342">StdEncoding</span><span class="op" id="3036353">.</span><span class="ident" id="3036354">DecodeString</span><span class="op" id="3036366">(</span><span class="ident" id="3036367">strings</span><span class="op" id="3036374">.</span><span class="ident" id="3036375">TrimPrefix</span><span class="op" id="3036385">(</span><span class="ident" id="3036386">auth</span><span class="op" id="3036390">,</span>&nbsp;<span class="string" id="3036392">&#34;Basic&nbsp;&#34;</span><span class="op" id="3036400">)</span><span class="op" id="3036401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036404">if</span>&nbsp;<span class="ident" id="3036407">err</span>&nbsp;<span class="op" id="3036411">!=</span>&nbsp;<span class="ident" id="3036414">nil</span>&nbsp;<span class="op" id="3036418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036422">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3036430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3036433">cs</span>&nbsp;<span class="op" id="3036436">:=</span>&nbsp;<span class="builtintype" id="3036439">string</span><span class="op" id="3036445">(</span><span class="ident" id="3036446">c</span><span class="op" id="3036447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3036450">s</span>&nbsp;<span class="op" id="3036452">:=</span>&nbsp;<span class="ident" id="3036455">strings</span><span class="op" id="3036462">.</span><span class="ident" id="3036463">IndexByte</span><span class="op" id="3036472">(</span><span class="ident" id="3036473">cs</span><span class="op" id="3036475">,</span>&nbsp;<span class="string" id="3036477">&#39;:&#39;</span><span class="op" id="3036480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036483">if</span>&nbsp;<span class="ident" id="3036486">s</span>&nbsp;<span class="op" id="3036488">&lt;</span>&nbsp;<span class="num" id="3036490">0</span>&nbsp;<span class="op" id="3036492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036496">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3036504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3036507">return</span>&nbsp;<span class="ident" id="3036514">cs</span><span class="op" id="3036516">[</span><span class="op" id="3036517">:</span><span class="ident" id="3036518">s</span><span class="op" id="3036519">]</span><span class="op" id="3036520">,</span>&nbsp;<span class="ident" id="3036522">cs</span><span class="op" id="3036524">[</span><span class="ident" id="3036525">s</span><span class="op" id="3036526">+</span><span class="num" id="3036527">1</span><span class="op" id="3036528">:</span><span class="op" id="3036529">]</span><span class="op" id="3036530">,</span>&nbsp;<span class="builtintype" id="3036532">true</span><br>
<span class="lineno"></span><span class="op" id="3036537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036540">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="3036608">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="3036673">//</span><br>
<span class="lineno"></span><span class="comment" id="3036676">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="3036745">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="3036767">func</span>&nbsp;<span class="op" id="3036772">(</span><span class="ident" id="3036773">r</span>&nbsp;<span class="op" id="3036775">*</span><span class="ident" id="3036776">Request</span><span class="op" id="3036783">)</span>&nbsp;<span class="ident" id="3036785">SetBasicAuth</span><span class="op" id="3036797">(</span><span class="ident" id="3036798">username</span><span class="op" id="3036806">,</span>&nbsp;<span class="ident" id="3036808">password</span>&nbsp;<span class="builtintype" id="3036817">string</span><span class="op" id="3036823">)</span>&nbsp;<span class="op" id="3036825">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3036828">r</span><span class="op" id="3036829">.</span><span class="ident" id="3036830">Header</span><span class="op" id="3036836">.</span><span class="ident" id="3036837">Set</span><span class="op" id="3036840">(</span><span class="string" id="3036841">&#34;Authorization&#34;</span><span class="op" id="3036856">,</span>&nbsp;<span class="string" id="3036858">&#34;Basic&nbsp;&#34;</span><span class="op" id="3036866">+</span><span class="ident" id="3036867">basicAuth</span><span class="op" id="3036876">(</span><span class="ident" id="3036877">username</span><span class="op" id="3036885">,</span>&nbsp;<span class="ident" id="3036887">password</span><span class="op" id="3036895">)</span><span class="op" id="3036896">)</span><br>
<span class="lineno"></span><span class="op" id="3036898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3036901">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="3036970">func</span>&nbsp;<span class="ident" id="3036975">parseRequestLine</span><span class="op" id="3036991">(</span><span class="ident" id="3036992">line</span>&nbsp;<span class="builtintype" id="3036997">string</span><span class="op" id="3037003">)</span>&nbsp;<span class="op" id="3037005">(</span><span class="ident" id="3037006">method</span><span class="op" id="3037012">,</span>&nbsp;<span class="ident" id="3037014">requestURI</span><span class="op" id="3037024">,</span>&nbsp;<span class="ident" id="3037026">proto</span>&nbsp;<span class="builtintype" id="3037032">string</span><span class="op" id="3037038">,</span>&nbsp;<span class="ident" id="3037040">ok</span>&nbsp;<span class="builtintype" id="3037043">bool</span><span class="op" id="3037047">)</span>&nbsp;<span class="op" id="3037049">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037052">s1</span>&nbsp;<span class="op" id="3037055">:=</span>&nbsp;<span class="ident" id="3037058">strings</span><span class="op" id="3037065">.</span><span class="ident" id="3037066">Index</span><span class="op" id="3037071">(</span><span class="ident" id="3037072">line</span><span class="op" id="3037076">,</span>&nbsp;<span class="string" id="3037078">&#34;&nbsp;&#34;</span><span class="op" id="3037081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037084">s2</span>&nbsp;<span class="op" id="3037087">:=</span>&nbsp;<span class="ident" id="3037090">strings</span><span class="op" id="3037097">.</span><span class="ident" id="3037098">Index</span><span class="op" id="3037103">(</span><span class="ident" id="3037104">line</span><span class="op" id="3037108">[</span><span class="ident" id="3037109">s1</span><span class="op" id="3037111">+</span><span class="num" id="3037112">1</span><span class="op" id="3037113">:</span><span class="op" id="3037114">]</span><span class="op" id="3037115">,</span>&nbsp;<span class="string" id="3037117">&#34;&nbsp;&#34;</span><span class="op" id="3037120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037123">if</span>&nbsp;<span class="ident" id="3037126">s1</span>&nbsp;<span class="op" id="3037129">&lt;</span>&nbsp;<span class="num" id="3037131">0</span>&nbsp;<span class="op" id="3037133">||</span>&nbsp;<span class="ident" id="3037136">s2</span>&nbsp;<span class="op" id="3037139">&lt;</span>&nbsp;<span class="num" id="3037141">0</span>&nbsp;<span class="op" id="3037143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037147">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3037155">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037158">s2</span>&nbsp;<span class="op" id="3037161">+=</span>&nbsp;<span class="ident" id="3037164">s1</span>&nbsp;<span class="op" id="3037167">+</span>&nbsp;<span class="num" id="3037169">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037172">return</span>&nbsp;<span class="ident" id="3037179">line</span><span class="op" id="3037183">[</span><span class="op" id="3037184">:</span><span class="ident" id="3037185">s1</span><span class="op" id="3037187">]</span><span class="op" id="3037188">,</span>&nbsp;<span class="ident" id="3037190">line</span><span class="op" id="3037194">[</span><span class="ident" id="3037195">s1</span><span class="op" id="3037197">+</span><span class="num" id="3037198">1</span>&nbsp;<span class="op" id="3037200">:</span>&nbsp;<span class="ident" id="3037202">s2</span><span class="op" id="3037204">]</span><span class="op" id="3037205">,</span>&nbsp;<span class="ident" id="3037207">line</span><span class="op" id="3037211">[</span><span class="ident" id="3037212">s2</span><span class="op" id="3037214">+</span><span class="num" id="3037215">1</span><span class="op" id="3037216">:</span><span class="op" id="3037217">]</span><span class="op" id="3037218">,</span>&nbsp;<span class="builtintype" id="3037220">true</span><br>
<span class="lineno"></span><span class="op" id="3037225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3037228">var</span>&nbsp;<span class="ident" id="3037232">textprotoReaderPool</span>&nbsp;<span class="ident" id="3037252">sync</span><span class="op" id="3037256">.</span><span class="ident" id="3037257">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="3037263">func</span>&nbsp;<span class="ident" id="3037268">newTextprotoReader</span><span class="op" id="3037286">(</span><span class="ident" id="3037287">br</span>&nbsp;<span class="op" id="3037290">*</span><span class="ident" id="3037291">bufio</span><span class="op" id="3037296">.</span><span class="ident" id="3037297">Reader</span><span class="op" id="3037303">)</span>&nbsp;<span class="op" id="3037305">*</span><span class="ident" id="3037306">textproto</span><span class="op" id="3037315">.</span><span class="ident" id="3037316">Reader</span>&nbsp;<span class="op" id="3037323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037326">if</span>&nbsp;<span class="ident" id="3037329">v</span>&nbsp;<span class="op" id="3037331">:=</span>&nbsp;<span class="ident" id="3037334">textprotoReaderPool</span><span class="op" id="3037353">.</span><span class="ident" id="3037354">Get</span><span class="op" id="3037357">(</span><span class="op" id="3037358">)</span><span class="op" id="3037359">;</span>&nbsp;<span class="ident" id="3037361">v</span>&nbsp;<span class="op" id="3037363">!=</span>&nbsp;<span class="ident" id="3037366">nil</span>&nbsp;<span class="op" id="3037370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037374">tr</span>&nbsp;<span class="op" id="3037377">:=</span>&nbsp;<span class="ident" id="3037380">v</span><span class="op" id="3037381">.</span><span class="op" id="3037382">(</span><span class="op" id="3037383">*</span><span class="ident" id="3037384">textproto</span><span class="op" id="3037393">.</span><span class="ident" id="3037394">Reader</span><span class="op" id="3037400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037404">tr</span><span class="op" id="3037406">.</span><span class="ident" id="3037407">R</span>&nbsp;<span class="op" id="3037409">=</span>&nbsp;<span class="ident" id="3037411">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037416">return</span>&nbsp;<span class="ident" id="3037423">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3037427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037430">return</span>&nbsp;<span class="ident" id="3037437">textproto</span><span class="op" id="3037446">.</span><span class="ident" id="3037447">NewReader</span><span class="op" id="3037456">(</span><span class="ident" id="3037457">br</span><span class="op" id="3037459">)</span><br>
<span class="lineno"></span><span class="op" id="3037461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="3037464">func</span>&nbsp;<span class="ident" id="3037469">putTextprotoReader</span><span class="op" id="3037487">(</span><span class="ident" id="3037488">r</span>&nbsp;<span class="op" id="3037490">*</span><span class="ident" id="3037491">textproto</span><span class="op" id="3037500">.</span><span class="ident" id="3037501">Reader</span><span class="op" id="3037507">)</span>&nbsp;<span class="op" id="3037509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037512">r</span><span class="op" id="3037513">.</span><span class="ident" id="3037514">R</span>&nbsp;<span class="op" id="3037516">=</span>&nbsp;<span class="ident" id="3037518">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037523">textprotoReaderPool</span><span class="op" id="3037542">.</span><span class="ident" id="3037543">Put</span><span class="op" id="3037546">(</span><span class="ident" id="3037547">r</span><span class="op" id="3037548">)</span><br>
<span class="lineno"></span><span class="op" id="3037550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3037553">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="3037603">func</span>&nbsp;<span class="ident" id="3037608">ReadRequest</span><span class="op" id="3037619">(</span><span class="ident" id="3037620">b</span>&nbsp;<span class="op" id="3037622">*</span><span class="ident" id="3037623">bufio</span><span class="op" id="3037628">.</span><span class="ident" id="3037629">Reader</span><span class="op" id="3037635">)</span>&nbsp;<span class="op" id="3037637">(</span><span class="ident" id="3037638">req</span>&nbsp;<span class="op" id="3037642">*</span><span class="ident" id="3037643">Request</span><span class="op" id="3037650">,</span>&nbsp;<span class="ident" id="3037652">err</span>&nbsp;<span class="builtintype" id="3037656">error</span><span class="op" id="3037661">)</span>&nbsp;<span class="op" id="3037663">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037667">tp</span>&nbsp;<span class="op" id="3037670">:=</span>&nbsp;<span class="ident" id="3037673">newTextprotoReader</span><span class="op" id="3037691">(</span><span class="ident" id="3037692">b</span><span class="op" id="3037693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037696">req</span>&nbsp;<span class="op" id="3037700">=</span>&nbsp;<span class="builtinfunc" id="3037702">new</span><span class="op" id="3037705">(</span><span class="ident" id="3037706">Request</span><span class="op" id="3037713">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3037717">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037758">var</span>&nbsp;<span class="ident" id="3037762">s</span>&nbsp;<span class="builtintype" id="3037764">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037772">if</span>&nbsp;<span class="ident" id="3037775">s</span><span class="op" id="3037776">,</span>&nbsp;<span class="ident" id="3037778">err</span>&nbsp;<span class="op" id="3037782">=</span>&nbsp;<span class="ident" id="3037784">tp</span><span class="op" id="3037786">.</span><span class="ident" id="3037787">ReadLine</span><span class="op" id="3037795">(</span><span class="op" id="3037796">)</span><span class="op" id="3037797">;</span>&nbsp;<span class="ident" id="3037799">err</span>&nbsp;<span class="op" id="3037803">!=</span>&nbsp;<span class="ident" id="3037806">nil</span>&nbsp;<span class="op" id="3037810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037814">return</span>&nbsp;<span class="ident" id="3037821">nil</span><span class="op" id="3037824">,</span>&nbsp;<span class="ident" id="3037826">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3037831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037834">defer</span>&nbsp;<span class="keyword" id="3037840">func</span><span class="op" id="3037844">(</span><span class="op" id="3037845">)</span>&nbsp;<span class="op" id="3037847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037851">putTextprotoReader</span><span class="op" id="3037869">(</span><span class="ident" id="3037870">tp</span><span class="op" id="3037872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037876">if</span>&nbsp;<span class="ident" id="3037879">err</span>&nbsp;<span class="op" id="3037883">==</span>&nbsp;<span class="ident" id="3037886">io</span><span class="op" id="3037888">.</span><span class="ident" id="3037889">EOF</span>&nbsp;<span class="op" id="3037893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037898">err</span>&nbsp;<span class="op" id="3037902">=</span>&nbsp;<span class="ident" id="3037904">io</span><span class="op" id="3037906">.</span><span class="ident" id="3037907">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3037926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3037929">}</span><span class="op" id="3037930">(</span><span class="op" id="3037931">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3037935">var</span>&nbsp;<span class="ident" id="3037939">ok</span>&nbsp;<span class="builtintype" id="3037942">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3037948">req</span><span class="op" id="3037951">.</span><span class="ident" id="3037952">Method</span><span class="op" id="3037958">,</span>&nbsp;<span class="ident" id="3037960">req</span><span class="op" id="3037963">.</span><span class="ident" id="3037964">RequestURI</span><span class="op" id="3037974">,</span>&nbsp;<span class="ident" id="3037976">req</span><span class="op" id="3037979">.</span><span class="ident" id="3037980">Proto</span><span class="op" id="3037985">,</span>&nbsp;<span class="ident" id="3037987">ok</span>&nbsp;<span class="op" id="3037990">=</span>&nbsp;<span class="ident" id="3037992">parseRequestLine</span><span class="op" id="3038008">(</span><span class="ident" id="3038009">s</span><span class="op" id="3038010">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3038013">if</span>&nbsp;<span class="op" id="3038016">!</span><span class="ident" id="3038017">ok</span>&nbsp;<span class="op" id="3038020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3038024">return</span>&nbsp;<span class="ident" id="3038031">nil</span><span class="op" id="3038034">,</span>&nbsp;<span class="op" id="3038036">&amp;</span><span class="ident" id="3038037">badStringError</span><span class="op" id="3038051">{</span><span class="string" id="3038052">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="3038076">,</span>&nbsp;<span class="ident" id="3038078">s</span><span class="op" id="3038079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3038082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3038085">rawurl</span>&nbsp;<span class="op" id="3038092">:=</span>&nbsp;<span class="ident" id="3038095">req</span><span class="op" id="3038098">.</span><span class="ident" id="3038099">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3038111">if</span>&nbsp;<span class="ident" id="3038114">req</span><span class="op" id="3038117">.</span><span class="ident" id="3038118">ProtoMajor</span><span class="op" id="3038128">,</span>&nbsp;<span class="ident" id="3038130">req</span><span class="op" id="3038133">.</span><span class="ident" id="3038134">ProtoMinor</span><span class="op" id="3038144">,</span>&nbsp;<span class="ident" id="3038146">ok</span>&nbsp;<span class="op" id="3038149">=</span>&nbsp;<span class="ident" id="3038151">ParseHTTPVersion</span><span class="op" id="3038167">(</span><span class="ident" id="3038168">req</span><span class="op" id="3038171">.</span><span class="ident" id="3038172">Proto</span><span class="op" id="3038177">)</span><span class="op" id="3038178">;</span>&nbsp;<span class="op" id="3038180">!</span><span class="ident" id="3038181">ok</span>&nbsp;<span class="op" id="3038184">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3038188">return</span>&nbsp;<span class="ident" id="3038195">nil</span><span class="op" id="3038198">,</span>&nbsp;<span class="op" id="3038200">&amp;</span><span class="ident" id="3038201">badStringError</span><span class="op" id="3038215">{</span><span class="string" id="3038216">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3038240">,</span>&nbsp;<span class="ident" id="3038242">req</span><span class="op" id="3038245">.</span><span class="ident" id="3038246">Proto</span><span class="op" id="3038251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3038254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038258">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038337">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038400">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038478">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038563">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038567">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038644">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038720">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3038800">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3038817">justAuthority</span>&nbsp;<span class="op" id="3038831">:=</span>&nbsp;<span class="ident" id="3038834">req</span><span class="op" id="3038837">.</span><span class="ident" id="3038838">Method</span>&nbsp;<span class="op" id="3038845">==</span>&nbsp;<span class="string" id="3038848">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="3038858">&amp;&amp;</span>&nbsp;<span class="op" id="3038861">!</span><span class="ident" id="3038862">strings</span><span class="op" id="3038869">.</span><span class="ident" id="3038870">HasPrefix</span><span class="op" id="3038879">(</span><span class="ident" id="3038880">rawurl</span><span class="op" id="3038886">,</span>&nbsp;<span class="string" id="3038888">&#34;/&#34;</span><span class="op" id="3038891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3038894">if</span>&nbsp;<span class="ident" id="3038897">justAuthority</span>&nbsp;<span class="op" id="3038911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3038915">rawurl</span>&nbsp;<span class="op" id="3038922">=</span>&nbsp;<span class="string" id="3038924">&#34;http://&#34;</span>&nbsp;<span class="op" id="3038934">+</span>&nbsp;<span class="ident" id="3038936">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3038944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3038948">if</span>&nbsp;<span class="ident" id="3038951">req</span><span class="op" id="3038954">.</span><span class="ident" id="3038955">URL</span><span class="op" id="3038958">,</span>&nbsp;<span class="ident" id="3038960">err</span>&nbsp;<span class="op" id="3038964">=</span>&nbsp;<span class="ident" id="3038966">url</span><span class="op" id="3038969">.</span><span class="ident" id="3038970">ParseRequestURI</span><span class="op" id="3038985">(</span><span class="ident" id="3038986">rawurl</span><span class="op" id="3038992">)</span><span class="op" id="3038993">;</span>&nbsp;<span class="ident" id="3038995">err</span>&nbsp;<span class="op" id="3038999">!=</span>&nbsp;<span class="ident" id="3039002">nil</span>&nbsp;<span class="op" id="3039006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039010">return</span>&nbsp;<span class="ident" id="3039017">nil</span><span class="op" id="3039020">,</span>&nbsp;<span class="ident" id="3039022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039027">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039031">if</span>&nbsp;<span class="ident" id="3039034">justAuthority</span>&nbsp;<span class="op" id="3039048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039052">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039093">req</span><span class="op" id="3039096">.</span><span class="ident" id="3039097">URL</span><span class="op" id="3039100">.</span><span class="ident" id="3039101">Scheme</span>&nbsp;<span class="op" id="3039108">=</span>&nbsp;<span class="string" id="3039110">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039114">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039118">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039152">mimeHeader</span><span class="op" id="3039162">,</span>&nbsp;<span class="ident" id="3039164">err</span>&nbsp;<span class="op" id="3039168">:=</span>&nbsp;<span class="ident" id="3039171">tp</span><span class="op" id="3039173">.</span><span class="ident" id="3039174">ReadMIMEHeader</span><span class="op" id="3039188">(</span><span class="op" id="3039189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039192">if</span>&nbsp;<span class="ident" id="3039195">err</span>&nbsp;<span class="op" id="3039199">!=</span>&nbsp;<span class="ident" id="3039202">nil</span>&nbsp;<span class="op" id="3039206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039210">return</span>&nbsp;<span class="ident" id="3039217">nil</span><span class="op" id="3039220">,</span>&nbsp;<span class="ident" id="3039222">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039230">req</span><span class="op" id="3039233">.</span><span class="ident" id="3039234">Header</span>&nbsp;<span class="op" id="3039241">=</span>&nbsp;<span class="ident" id="3039243">Header</span><span class="op" id="3039249">(</span><span class="ident" id="3039250">mimeHeader</span><span class="op" id="3039260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039264">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039288">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039317">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039342">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039350">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039400">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3039423">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039484">req</span><span class="op" id="3039487">.</span><span class="ident" id="3039488">Host</span>&nbsp;<span class="op" id="3039493">=</span>&nbsp;<span class="ident" id="3039495">req</span><span class="op" id="3039498">.</span><span class="ident" id="3039499">URL</span><span class="op" id="3039502">.</span><span class="ident" id="3039503">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039509">if</span>&nbsp;<span class="ident" id="3039512">req</span><span class="op" id="3039515">.</span><span class="ident" id="3039516">Host</span>&nbsp;<span class="op" id="3039521">==</span>&nbsp;<span class="string" id="3039524">&#34;&#34;</span>&nbsp;<span class="op" id="3039527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039531">req</span><span class="op" id="3039534">.</span><span class="ident" id="3039535">Host</span>&nbsp;<span class="op" id="3039540">=</span>&nbsp;<span class="ident" id="3039542">req</span><span class="op" id="3039545">.</span><span class="ident" id="3039546">Header</span><span class="op" id="3039552">.</span><span class="ident" id="3039553">get</span><span class="op" id="3039556">(</span><span class="string" id="3039557">&#34;Host&#34;</span><span class="op" id="3039563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3039569">delete</span><span class="op" id="3039575">(</span><span class="ident" id="3039576">req</span><span class="op" id="3039579">.</span><span class="ident" id="3039580">Header</span><span class="op" id="3039586">,</span>&nbsp;<span class="string" id="3039588">&#34;Host&#34;</span><span class="op" id="3039594">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039598">fixPragmaCacheControl</span><span class="op" id="3039619">(</span><span class="ident" id="3039620">req</span><span class="op" id="3039623">.</span><span class="ident" id="3039624">Header</span><span class="op" id="3039630">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039634">err</span>&nbsp;<span class="op" id="3039638">=</span>&nbsp;<span class="ident" id="3039640">readTransfer</span><span class="op" id="3039652">(</span><span class="ident" id="3039653">req</span><span class="op" id="3039656">,</span>&nbsp;<span class="ident" id="3039658">b</span><span class="op" id="3039659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039662">if</span>&nbsp;<span class="ident" id="3039665">err</span>&nbsp;<span class="op" id="3039669">!=</span>&nbsp;<span class="ident" id="3039672">nil</span>&nbsp;<span class="op" id="3039676">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039680">return</span>&nbsp;<span class="ident" id="3039687">nil</span><span class="op" id="3039690">,</span>&nbsp;<span class="ident" id="3039692">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3039697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3039701">req</span><span class="op" id="3039704">.</span><span class="ident" id="3039705">Close</span>&nbsp;<span class="op" id="3039711">=</span>&nbsp;<span class="ident" id="3039713">shouldClose</span><span class="op" id="3039724">(</span><span class="ident" id="3039725">req</span><span class="op" id="3039728">.</span><span class="ident" id="3039729">ProtoMajor</span><span class="op" id="3039739">,</span>&nbsp;<span class="ident" id="3039741">req</span><span class="op" id="3039744">.</span><span class="ident" id="3039745">ProtoMinor</span><span class="op" id="3039755">,</span>&nbsp;<span class="ident" id="3039757">req</span><span class="op" id="3039760">.</span><span class="ident" id="3039761">Header</span><span class="op" id="3039767">,</span>&nbsp;<span class="builtintype" id="3039769">false</span><span class="op" id="3039774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3039777">return</span>&nbsp;<span class="ident" id="3039784">req</span><span class="op" id="3039787">,</span>&nbsp;<span class="ident" id="3039789">nil</span><br>
<span class="lineno">670</span><span class="op" id="3039793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3039796">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3039863">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3039927">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="3039997">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3040058">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="3040112">//</span><br>
<span class="lineno"></span><span class="comment" id="3040115">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="3040183">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="3040240">func</span>&nbsp;<span class="ident" id="3040245">MaxBytesReader</span><span class="op" id="3040259">(</span><span class="ident" id="3040260">w</span>&nbsp;<span class="ident" id="3040262">ResponseWriter</span><span class="op" id="3040276">,</span>&nbsp;<span class="ident" id="3040278">r</span>&nbsp;<span class="ident" id="3040280">io</span><span class="op" id="3040282">.</span><span class="ident" id="3040283">ReadCloser</span><span class="op" id="3040293">,</span>&nbsp;<span class="ident" id="3040295">n</span>&nbsp;<span class="ident" id="3040297">int64</span><span class="op" id="3040302">)</span>&nbsp;<span class="ident" id="3040304">io</span><span class="op" id="3040306">.</span><span class="ident" id="3040307">ReadCloser</span>&nbsp;<span class="op" id="3040318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040321">return</span>&nbsp;<span class="op" id="3040328">&amp;</span><span class="ident" id="3040329">maxBytesReader</span><span class="op" id="3040343">{</span><span class="ident" id="3040344">w</span><span class="op" id="3040345">:</span>&nbsp;<span class="ident" id="3040347">w</span><span class="op" id="3040348">,</span>&nbsp;<span class="ident" id="3040350">r</span><span class="op" id="3040351">:</span>&nbsp;<span class="ident" id="3040353">r</span><span class="op" id="3040354">,</span>&nbsp;<span class="ident" id="3040356">n</span><span class="op" id="3040357">:</span>&nbsp;<span class="ident" id="3040359">n</span><span class="op" id="3040360">}</span><br>
<span class="lineno"></span><span class="op" id="3040362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3040365">type</span>&nbsp;<span class="ident" id="3040370">maxBytesReader</span>&nbsp;<span class="keyword" id="3040385">struct</span>&nbsp;<span class="op" id="3040392">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040395">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040403">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040419">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040427">io</span><span class="op" id="3040429">.</span><span class="ident" id="3040430">ReadCloser</span>&nbsp;<span class="comment" id="3040441">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040463">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3040471">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3040485">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040509">stopped</span>&nbsp;<span class="builtintype" id="3040517">bool</span><br>
<span class="lineno"></span><span class="op" id="3040522">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="3040525">func</span>&nbsp;<span class="op" id="3040530">(</span><span class="ident" id="3040531">l</span>&nbsp;<span class="op" id="3040533">*</span><span class="ident" id="3040534">maxBytesReader</span><span class="op" id="3040548">)</span>&nbsp;<span class="ident" id="3040550">Read</span><span class="op" id="3040554">(</span><span class="ident" id="3040555">p</span>&nbsp;<span class="op" id="3040557">[</span><span class="op" id="3040558">]</span><span class="builtintype" id="3040559">byte</span><span class="op" id="3040563">)</span>&nbsp;<span class="op" id="3040565">(</span><span class="ident" id="3040566">n</span>&nbsp;<span class="builtintype" id="3040568">int</span><span class="op" id="3040571">,</span>&nbsp;<span class="ident" id="3040573">err</span>&nbsp;<span class="builtintype" id="3040577">error</span><span class="op" id="3040582">)</span>&nbsp;<span class="op" id="3040584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040587">if</span>&nbsp;<span class="ident" id="3040590">l</span><span class="op" id="3040591">.</span><span class="ident" id="3040592">n</span>&nbsp;<span class="op" id="3040594">&lt;=</span>&nbsp;<span class="num" id="3040597">0</span>&nbsp;<span class="op" id="3040599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040603">if</span>&nbsp;<span class="op" id="3040606">!</span><span class="ident" id="3040607">l</span><span class="op" id="3040608">.</span><span class="ident" id="3040609">stopped</span>&nbsp;<span class="op" id="3040617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040622">l</span><span class="op" id="3040623">.</span><span class="ident" id="3040624">stopped</span>&nbsp;<span class="op" id="3040632">=</span>&nbsp;<span class="builtintype" id="3040634">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040642">if</span>&nbsp;<span class="ident" id="3040645">res</span><span class="op" id="3040648">,</span>&nbsp;<span class="ident" id="3040650">ok</span>&nbsp;<span class="op" id="3040653">:=</span>&nbsp;<span class="ident" id="3040656">l</span><span class="op" id="3040657">.</span><span class="ident" id="3040658">w</span><span class="op" id="3040659">.</span><span class="op" id="3040660">(</span><span class="op" id="3040661">*</span><span class="ident" id="3040662">response</span><span class="op" id="3040670">)</span><span class="op" id="3040671">;</span>&nbsp;<span class="ident" id="3040673">ok</span>&nbsp;<span class="op" id="3040676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040682">res</span><span class="op" id="3040685">.</span><span class="ident" id="3040686">requestTooLarge</span><span class="op" id="3040701">(</span><span class="op" id="3040702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3040707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3040711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040715">return</span>&nbsp;<span class="num" id="3040722">0</span><span class="op" id="3040723">,</span>&nbsp;<span class="ident" id="3040725">errors</span><span class="op" id="3040731">.</span><span class="ident" id="3040732">New</span><span class="op" id="3040735">(</span><span class="string" id="3040736">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="3040766">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3040769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040772">if</span>&nbsp;<span class="ident" id="3040775">int64</span><span class="op" id="3040780">(</span><span class="builtinfunc" id="3040781">len</span><span class="op" id="3040784">(</span><span class="ident" id="3040785">p</span><span class="op" id="3040786">)</span><span class="op" id="3040787">)</span>&nbsp;<span class="op" id="3040789">&gt;</span>&nbsp;<span class="ident" id="3040791">l</span><span class="op" id="3040792">.</span><span class="ident" id="3040793">n</span>&nbsp;<span class="op" id="3040795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040799">p</span>&nbsp;<span class="op" id="3040801">=</span>&nbsp;<span class="ident" id="3040803">p</span><span class="op" id="3040804">[</span><span class="op" id="3040805">:</span><span class="ident" id="3040806">l</span><span class="op" id="3040807">.</span><span class="ident" id="3040808">n</span><span class="op" id="3040809">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3040812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040815">n</span><span class="op" id="3040816">,</span>&nbsp;<span class="ident" id="3040818">err</span>&nbsp;<span class="op" id="3040822">=</span>&nbsp;<span class="ident" id="3040824">l</span><span class="op" id="3040825">.</span><span class="ident" id="3040826">r</span><span class="op" id="3040827">.</span><span class="ident" id="3040828">Read</span><span class="op" id="3040832">(</span><span class="ident" id="3040833">p</span><span class="op" id="3040834">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3040837">l</span><span class="op" id="3040838">.</span><span class="ident" id="3040839">n</span>&nbsp;<span class="op" id="3040841">-=</span>&nbsp;<span class="ident" id="3040844">int64</span><span class="op" id="3040849">(</span><span class="ident" id="3040850">n</span><span class="op" id="3040851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040854">return</span><br>
<span class="lineno"></span><span class="op" id="3040861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3040864">func</span>&nbsp;<span class="op" id="3040869">(</span><span class="ident" id="3040870">l</span>&nbsp;<span class="op" id="3040872">*</span><span class="ident" id="3040873">maxBytesReader</span><span class="op" id="3040887">)</span>&nbsp;<span class="ident" id="3040889">Close</span><span class="op" id="3040894">(</span><span class="op" id="3040895">)</span>&nbsp;<span class="builtintype" id="3040897">error</span>&nbsp;<span class="op" id="3040903">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040906">return</span>&nbsp;<span class="ident" id="3040913">l</span><span class="op" id="3040914">.</span><span class="ident" id="3040915">r</span><span class="op" id="3040916">.</span><span class="ident" id="3040917">Close</span><span class="op" id="3040922">(</span><span class="op" id="3040923">)</span><br>
<span class="lineno"></span><span class="op" id="3040925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3040928">func</span>&nbsp;<span class="ident" id="3040933">copyValues</span><span class="op" id="3040943">(</span><span class="ident" id="3040944">dst</span><span class="op" id="3040947">,</span>&nbsp;<span class="ident" id="3040949">src</span>&nbsp;<span class="ident" id="3040953">url</span><span class="op" id="3040956">.</span><span class="ident" id="3040957">Values</span><span class="op" id="3040963">)</span>&nbsp;<span class="op" id="3040965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040968">for</span>&nbsp;<span class="ident" id="3040972">k</span><span class="op" id="3040973">,</span>&nbsp;<span class="ident" id="3040975">vs</span>&nbsp;<span class="op" id="3040978">:=</span>&nbsp;<span class="keyword" id="3040981">range</span>&nbsp;<span class="ident" id="3040987">src</span>&nbsp;<span class="op" id="3040991">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3040995">for</span>&nbsp;<span class="ident" id="3040999">_</span><span class="op" id="3041000">,</span>&nbsp;<span class="ident" id="3041002">value</span>&nbsp;<span class="op" id="3041008">:=</span>&nbsp;<span class="keyword" id="3041011">range</span>&nbsp;<span class="ident" id="3041017">vs</span>&nbsp;<span class="op" id="3041020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041025">dst</span><span class="op" id="3041028">.</span><span class="ident" id="3041029">Add</span><span class="op" id="3041032">(</span><span class="ident" id="3041033">k</span><span class="op" id="3041034">,</span>&nbsp;<span class="ident" id="3041036">value</span><span class="op" id="3041041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041048">}</span><br>
<span class="lineno"></span><span class="op" id="3041050">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="3041053">func</span>&nbsp;<span class="ident" id="3041058">parsePostForm</span><span class="op" id="3041071">(</span><span class="ident" id="3041072">r</span>&nbsp;<span class="op" id="3041074">*</span><span class="ident" id="3041075">Request</span><span class="op" id="3041082">)</span>&nbsp;<span class="op" id="3041084">(</span><span class="ident" id="3041085">vs</span>&nbsp;<span class="ident" id="3041088">url</span><span class="op" id="3041091">.</span><span class="ident" id="3041092">Values</span><span class="op" id="3041098">,</span>&nbsp;<span class="ident" id="3041100">err</span>&nbsp;<span class="builtintype" id="3041104">error</span><span class="op" id="3041109">)</span>&nbsp;<span class="op" id="3041111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041114">if</span>&nbsp;<span class="ident" id="3041117">r</span><span class="op" id="3041118">.</span><span class="ident" id="3041119">Body</span>&nbsp;<span class="op" id="3041124">==</span>&nbsp;<span class="ident" id="3041127">nil</span>&nbsp;<span class="op" id="3041131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041135">err</span>&nbsp;<span class="op" id="3041139">=</span>&nbsp;<span class="ident" id="3041141">errors</span><span class="op" id="3041147">.</span><span class="ident" id="3041148">New</span><span class="op" id="3041151">(</span><span class="string" id="3041152">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="3041171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041175">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041186">ct</span>&nbsp;<span class="op" id="3041189">:=</span>&nbsp;<span class="ident" id="3041192">r</span><span class="op" id="3041193">.</span><span class="ident" id="3041194">Header</span><span class="op" id="3041200">.</span><span class="ident" id="3041201">Get</span><span class="op" id="3041204">(</span><span class="string" id="3041205">&#34;Content-Type&#34;</span><span class="op" id="3041219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041222">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041263">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041315">if</span>&nbsp;<span class="ident" id="3041318">ct</span>&nbsp;<span class="op" id="3041321">==</span>&nbsp;<span class="string" id="3041324">&#34;&#34;</span>&nbsp;<span class="op" id="3041327">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041331">ct</span>&nbsp;<span class="op" id="3041334">=</span>&nbsp;<span class="string" id="3041336">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041367">ct</span><span class="op" id="3041369">,</span>&nbsp;<span class="ident" id="3041371">_</span><span class="op" id="3041372">,</span>&nbsp;<span class="ident" id="3041374">err</span>&nbsp;<span class="op" id="3041378">=</span>&nbsp;<span class="ident" id="3041380">mime</span><span class="op" id="3041384">.</span><span class="ident" id="3041385">ParseMediaType</span><span class="op" id="3041399">(</span><span class="ident" id="3041400">ct</span><span class="op" id="3041402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041405">switch</span>&nbsp;<span class="op" id="3041412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041415">case</span>&nbsp;<span class="ident" id="3041420">ct</span>&nbsp;<span class="op" id="3041423">==</span>&nbsp;<span class="string" id="3041426">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="3041461">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041465">var</span>&nbsp;<span class="ident" id="3041469">reader</span>&nbsp;<span class="ident" id="3041476">io</span><span class="op" id="3041478">.</span><span class="ident" id="3041479">Reader</span>&nbsp;<span class="op" id="3041486">=</span>&nbsp;<span class="ident" id="3041488">r</span><span class="op" id="3041489">.</span><span class="ident" id="3041490">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041497">maxFormSize</span>&nbsp;<span class="op" id="3041509">:=</span>&nbsp;<span class="ident" id="3041512">int64</span><span class="op" id="3041517">(</span><span class="num" id="3041518">1</span><span class="op" id="3041519">&lt;&lt;</span><span class="num" id="3041521">63</span>&nbsp;<span class="op" id="3041524">-</span>&nbsp;<span class="num" id="3041526">1</span><span class="op" id="3041527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041531">if</span>&nbsp;<span class="ident" id="3041534">_</span><span class="op" id="3041535">,</span>&nbsp;<span class="ident" id="3041537">ok</span>&nbsp;<span class="op" id="3041540">:=</span>&nbsp;<span class="ident" id="3041543">r</span><span class="op" id="3041544">.</span><span class="ident" id="3041545">Body</span><span class="op" id="3041549">.</span><span class="op" id="3041550">(</span><span class="op" id="3041551">*</span><span class="ident" id="3041552">maxBytesReader</span><span class="op" id="3041566">)</span><span class="op" id="3041567">;</span>&nbsp;<span class="op" id="3041569">!</span><span class="ident" id="3041570">ok</span>&nbsp;<span class="op" id="3041573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041578">maxFormSize</span>&nbsp;<span class="op" id="3041590">=</span>&nbsp;<span class="ident" id="3041592">int64</span><span class="op" id="3041597">(</span><span class="num" id="3041598">10</span>&nbsp;<span class="op" id="3041601">&lt;&lt;</span>&nbsp;<span class="num" id="3041604">20</span><span class="op" id="3041606">)</span>&nbsp;<span class="comment" id="3041608">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041638">reader</span>&nbsp;<span class="op" id="3041645">=</span>&nbsp;<span class="ident" id="3041647">io</span><span class="op" id="3041649">.</span><span class="ident" id="3041650">LimitReader</span><span class="op" id="3041661">(</span><span class="ident" id="3041662">r</span><span class="op" id="3041663">.</span><span class="ident" id="3041664">Body</span><span class="op" id="3041668">,</span>&nbsp;<span class="ident" id="3041670">maxFormSize</span><span class="op" id="3041681">+</span><span class="num" id="3041682">1</span><span class="op" id="3041683">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041691">b</span><span class="op" id="3041692">,</span>&nbsp;<span class="ident" id="3041694">e</span>&nbsp;<span class="op" id="3041696">:=</span>&nbsp;<span class="ident" id="3041699">ioutil</span><span class="op" id="3041705">.</span><span class="ident" id="3041706">ReadAll</span><span class="op" id="3041713">(</span><span class="ident" id="3041714">reader</span><span class="op" id="3041720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041724">if</span>&nbsp;<span class="ident" id="3041727">e</span>&nbsp;<span class="op" id="3041729">!=</span>&nbsp;<span class="ident" id="3041732">nil</span>&nbsp;<span class="op" id="3041736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041741">if</span>&nbsp;<span class="ident" id="3041744">err</span>&nbsp;<span class="op" id="3041748">==</span>&nbsp;<span class="ident" id="3041751">nil</span>&nbsp;<span class="op" id="3041755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041761">err</span>&nbsp;<span class="op" id="3041765">=</span>&nbsp;<span class="ident" id="3041767">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041777">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041789">if</span>&nbsp;<span class="ident" id="3041792">int64</span><span class="op" id="3041797">(</span><span class="builtinfunc" id="3041798">len</span><span class="op" id="3041801">(</span><span class="ident" id="3041802">b</span><span class="op" id="3041803">)</span><span class="op" id="3041804">)</span>&nbsp;<span class="op" id="3041806">&gt;</span>&nbsp;<span class="ident" id="3041808">maxFormSize</span>&nbsp;<span class="op" id="3041820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041825">err</span>&nbsp;<span class="op" id="3041829">=</span>&nbsp;<span class="ident" id="3041831">errors</span><span class="op" id="3041837">.</span><span class="ident" id="3041838">New</span><span class="op" id="3041841">(</span><span class="string" id="3041842">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="3041864">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041869">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041882">vs</span><span class="op" id="3041884">,</span>&nbsp;<span class="ident" id="3041886">e</span>&nbsp;<span class="op" id="3041888">=</span>&nbsp;<span class="ident" id="3041890">url</span><span class="op" id="3041893">.</span><span class="ident" id="3041894">ParseQuery</span><span class="op" id="3041904">(</span><span class="builtintype" id="3041905">string</span><span class="op" id="3041911">(</span><span class="ident" id="3041912">b</span><span class="op" id="3041913">)</span><span class="op" id="3041914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041918">if</span>&nbsp;<span class="ident" id="3041921">err</span>&nbsp;<span class="op" id="3041925">==</span>&nbsp;<span class="ident" id="3041928">nil</span>&nbsp;<span class="op" id="3041932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3041937">err</span>&nbsp;<span class="op" id="3041941">=</span>&nbsp;<span class="ident" id="3041943">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3041947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3041950">case</span>&nbsp;<span class="ident" id="3041955">ct</span>&nbsp;<span class="op" id="3041958">==</span>&nbsp;<span class="string" id="3041961">&#34;multipart/form-data&#34;</span><span class="op" id="3041982">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3041986">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042057">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042106">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042151">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042192">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3042241">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042291">return</span><br>
<span class="lineno">765</span><span class="op" id="3042298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3042301">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3042368">//</span><br>
<span class="lineno"></span><span class="comment" id="3042371">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="3042446">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3042498">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="3042575">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="3042589">//</span><br>
<span class="lineno"></span><span class="comment" id="3042592">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="3042670">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="3042701">//</span><br>
<span class="lineno"></span><span class="comment" id="3042704">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="3042757">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="3042778">func</span>&nbsp;<span class="op" id="3042783">(</span><span class="ident" id="3042784">r</span>&nbsp;<span class="op" id="3042786">*</span><span class="ident" id="3042787">Request</span><span class="op" id="3042794">)</span>&nbsp;<span class="ident" id="3042796">ParseForm</span><span class="op" id="3042805">(</span><span class="op" id="3042806">)</span>&nbsp;<span class="builtintype" id="3042808">error</span>&nbsp;<span class="op" id="3042814">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042817">var</span>&nbsp;<span class="ident" id="3042821">err</span>&nbsp;<span class="builtintype" id="3042825">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042832">if</span>&nbsp;<span class="ident" id="3042835">r</span><span class="op" id="3042836">.</span><span class="ident" id="3042837">PostForm</span>&nbsp;<span class="op" id="3042846">==</span>&nbsp;<span class="ident" id="3042849">nil</span>&nbsp;<span class="op" id="3042853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042857">if</span>&nbsp;<span class="ident" id="3042860">r</span><span class="op" id="3042861">.</span><span class="ident" id="3042862">Method</span>&nbsp;<span class="op" id="3042869">==</span>&nbsp;<span class="string" id="3042872">&#34;POST&#34;</span>&nbsp;<span class="op" id="3042879">||</span>&nbsp;<span class="ident" id="3042882">r</span><span class="op" id="3042883">.</span><span class="ident" id="3042884">Method</span>&nbsp;<span class="op" id="3042891">==</span>&nbsp;<span class="string" id="3042894">&#34;PUT&#34;</span>&nbsp;<span class="op" id="3042900">||</span>&nbsp;<span class="ident" id="3042903">r</span><span class="op" id="3042904">.</span><span class="ident" id="3042905">Method</span>&nbsp;<span class="op" id="3042912">==</span>&nbsp;<span class="string" id="3042915">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="3042923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042928">r</span><span class="op" id="3042929">.</span><span class="ident" id="3042930">PostForm</span><span class="op" id="3042938">,</span>&nbsp;<span class="ident" id="3042940">err</span>&nbsp;<span class="op" id="3042944">=</span>&nbsp;<span class="ident" id="3042946">parsePostForm</span><span class="op" id="3042959">(</span><span class="ident" id="3042960">r</span><span class="op" id="3042961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3042965">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3042969">if</span>&nbsp;<span class="ident" id="3042972">r</span><span class="op" id="3042973">.</span><span class="ident" id="3042974">PostForm</span>&nbsp;<span class="op" id="3042983">==</span>&nbsp;<span class="ident" id="3042986">nil</span>&nbsp;<span class="op" id="3042990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3042995">r</span><span class="op" id="3042996">.</span><span class="ident" id="3042997">PostForm</span>&nbsp;<span class="op" id="3043006">=</span>&nbsp;<span class="builtinfunc" id="3043008">make</span><span class="op" id="3043012">(</span><span class="ident" id="3043013">url</span><span class="op" id="3043016">.</span><span class="ident" id="3043017">Values</span><span class="op" id="3043023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043033">if</span>&nbsp;<span class="ident" id="3043036">r</span><span class="op" id="3043037">.</span><span class="ident" id="3043038">Form</span>&nbsp;<span class="op" id="3043043">==</span>&nbsp;<span class="ident" id="3043046">nil</span>&nbsp;<span class="op" id="3043050">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043054">if</span>&nbsp;<span class="builtinfunc" id="3043057">len</span><span class="op" id="3043060">(</span><span class="ident" id="3043061">r</span><span class="op" id="3043062">.</span><span class="ident" id="3043063">PostForm</span><span class="op" id="3043071">)</span>&nbsp;<span class="op" id="3043073">&gt;</span>&nbsp;<span class="num" id="3043075">0</span>&nbsp;<span class="op" id="3043077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043082">r</span><span class="op" id="3043083">.</span><span class="ident" id="3043084">Form</span>&nbsp;<span class="op" id="3043089">=</span>&nbsp;<span class="builtinfunc" id="3043091">make</span><span class="op" id="3043095">(</span><span class="ident" id="3043096">url</span><span class="op" id="3043099">.</span><span class="ident" id="3043100">Values</span><span class="op" id="3043106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043111">copyValues</span><span class="op" id="3043121">(</span><span class="ident" id="3043122">r</span><span class="op" id="3043123">.</span><span class="ident" id="3043124">Form</span><span class="op" id="3043128">,</span>&nbsp;<span class="ident" id="3043130">r</span><span class="op" id="3043131">.</span><span class="ident" id="3043132">PostForm</span><span class="op" id="3043140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043148">var</span>&nbsp;<span class="ident" id="3043152">newValues</span>&nbsp;<span class="ident" id="3043162">url</span><span class="op" id="3043165">.</span><span class="ident" id="3043166">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043175">if</span>&nbsp;<span class="ident" id="3043178">r</span><span class="op" id="3043179">.</span><span class="ident" id="3043180">URL</span>&nbsp;<span class="op" id="3043184">!=</span>&nbsp;<span class="ident" id="3043187">nil</span>&nbsp;<span class="op" id="3043191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043196">var</span>&nbsp;<span class="ident" id="3043200">e</span>&nbsp;<span class="builtintype" id="3043202">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043211">newValues</span><span class="op" id="3043220">,</span>&nbsp;<span class="ident" id="3043222">e</span>&nbsp;<span class="op" id="3043224">=</span>&nbsp;<span class="ident" id="3043226">url</span><span class="op" id="3043229">.</span><span class="ident" id="3043230">ParseQuery</span><span class="op" id="3043240">(</span><span class="ident" id="3043241">r</span><span class="op" id="3043242">.</span><span class="ident" id="3043243">URL</span><span class="op" id="3043246">.</span><span class="ident" id="3043247">RawQuery</span><span class="op" id="3043255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043260">if</span>&nbsp;<span class="ident" id="3043263">err</span>&nbsp;<span class="op" id="3043267">==</span>&nbsp;<span class="ident" id="3043270">nil</span>&nbsp;<span class="op" id="3043274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043280">err</span>&nbsp;<span class="op" id="3043284">=</span>&nbsp;<span class="ident" id="3043286">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043299">if</span>&nbsp;<span class="ident" id="3043302">newValues</span>&nbsp;<span class="op" id="3043312">==</span>&nbsp;<span class="ident" id="3043315">nil</span>&nbsp;<span class="op" id="3043319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043324">newValues</span>&nbsp;<span class="op" id="3043334">=</span>&nbsp;<span class="builtinfunc" id="3043336">make</span><span class="op" id="3043340">(</span><span class="ident" id="3043341">url</span><span class="op" id="3043344">.</span><span class="ident" id="3043345">Values</span><span class="op" id="3043351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043355">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043359">if</span>&nbsp;<span class="ident" id="3043362">r</span><span class="op" id="3043363">.</span><span class="ident" id="3043364">Form</span>&nbsp;<span class="op" id="3043369">==</span>&nbsp;<span class="ident" id="3043372">nil</span>&nbsp;<span class="op" id="3043376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043381">r</span><span class="op" id="3043382">.</span><span class="ident" id="3043383">Form</span>&nbsp;<span class="op" id="3043388">=</span>&nbsp;<span class="ident" id="3043390">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043402">}</span>&nbsp;<span class="keyword" id="3043404">else</span>&nbsp;<span class="op" id="3043409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3043414">copyValues</span><span class="op" id="3043424">(</span><span class="ident" id="3043425">r</span><span class="op" id="3043426">.</span><span class="ident" id="3043427">Form</span><span class="op" id="3043431">,</span>&nbsp;<span class="ident" id="3043433">newValues</span><span class="op" id="3043442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043446">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3043449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043452">return</span>&nbsp;<span class="ident" id="3043459">err</span><br>
<span class="lineno"></span><span class="op" id="3043463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3043466">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="3043534">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3043610">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3043679">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="3043707">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="3043759">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="3043833">func</span>&nbsp;<span class="op" id="3043838">(</span><span class="ident" id="3043839">r</span>&nbsp;<span class="op" id="3043841">*</span><span class="ident" id="3043842">Request</span><span class="op" id="3043849">)</span>&nbsp;<span class="ident" id="3043851">ParseMultipartForm</span><span class="op" id="3043869">(</span><span class="ident" id="3043870">maxMemory</span>&nbsp;<span class="ident" id="3043880">int64</span><span class="op" id="3043885">)</span>&nbsp;<span class="builtintype" id="3043887">error</span>&nbsp;<span class="op" id="3043893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043896">if</span>&nbsp;<span class="ident" id="3043899">r</span><span class="op" id="3043900">.</span><span class="ident" id="3043901">MultipartForm</span>&nbsp;<span class="op" id="3043915">==</span>&nbsp;<span class="ident" id="3043918">multipartByReader</span>&nbsp;<span class="op" id="3043936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3043940">return</span>&nbsp;<span class="ident" id="3043947">errors</span><span class="op" id="3043953">.</span><span class="ident" id="3043954">New</span><span class="op" id="3043957">(</span><span class="string" id="3043958">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3044002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044008">if</span>&nbsp;<span class="ident" id="3044011">r</span><span class="op" id="3044012">.</span><span class="ident" id="3044013">Form</span>&nbsp;<span class="op" id="3044018">==</span>&nbsp;<span class="ident" id="3044021">nil</span>&nbsp;<span class="op" id="3044025">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044029">err</span>&nbsp;<span class="op" id="3044033">:=</span>&nbsp;<span class="ident" id="3044036">r</span><span class="op" id="3044037">.</span><span class="ident" id="3044038">ParseForm</span><span class="op" id="3044047">(</span><span class="op" id="3044048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044052">if</span>&nbsp;<span class="ident" id="3044055">err</span>&nbsp;<span class="op" id="3044059">!=</span>&nbsp;<span class="ident" id="3044062">nil</span>&nbsp;<span class="op" id="3044066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044071">return</span>&nbsp;<span class="ident" id="3044078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044087">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044090">if</span>&nbsp;<span class="ident" id="3044093">r</span><span class="op" id="3044094">.</span><span class="ident" id="3044095">MultipartForm</span>&nbsp;<span class="op" id="3044109">!=</span>&nbsp;<span class="ident" id="3044112">nil</span>&nbsp;<span class="op" id="3044116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044120">return</span>&nbsp;<span class="ident" id="3044127">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044136">mr</span><span class="op" id="3044138">,</span>&nbsp;<span class="ident" id="3044140">err</span>&nbsp;<span class="op" id="3044144">:=</span>&nbsp;<span class="ident" id="3044147">r</span><span class="op" id="3044148">.</span><span class="ident" id="3044149">multipartReader</span><span class="op" id="3044164">(</span><span class="op" id="3044165">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044168">if</span>&nbsp;<span class="ident" id="3044171">err</span>&nbsp;<span class="op" id="3044175">!=</span>&nbsp;<span class="ident" id="3044178">nil</span>&nbsp;<span class="op" id="3044182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044186">return</span>&nbsp;<span class="ident" id="3044193">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044202">f</span><span class="op" id="3044203">,</span>&nbsp;<span class="ident" id="3044205">err</span>&nbsp;<span class="op" id="3044209">:=</span>&nbsp;<span class="ident" id="3044212">mr</span><span class="op" id="3044214">.</span><span class="ident" id="3044215">ReadForm</span><span class="op" id="3044223">(</span><span class="ident" id="3044224">maxMemory</span><span class="op" id="3044233">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044236">if</span>&nbsp;<span class="ident" id="3044239">err</span>&nbsp;<span class="op" id="3044243">!=</span>&nbsp;<span class="ident" id="3044246">nil</span>&nbsp;<span class="op" id="3044250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044254">return</span>&nbsp;<span class="ident" id="3044261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044269">for</span>&nbsp;<span class="ident" id="3044273">k</span><span class="op" id="3044274">,</span>&nbsp;<span class="ident" id="3044276">v</span>&nbsp;<span class="op" id="3044278">:=</span>&nbsp;<span class="keyword" id="3044281">range</span>&nbsp;<span class="ident" id="3044287">f</span><span class="op" id="3044288">.</span><span class="ident" id="3044289">Value</span>&nbsp;<span class="op" id="3044295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044299">r</span><span class="op" id="3044300">.</span><span class="ident" id="3044301">Form</span><span class="op" id="3044305">[</span><span class="ident" id="3044306">k</span><span class="op" id="3044307">]</span>&nbsp;<span class="op" id="3044309">=</span>&nbsp;<span class="builtinfunc" id="3044311">append</span><span class="op" id="3044317">(</span><span class="ident" id="3044318">r</span><span class="op" id="3044319">.</span><span class="ident" id="3044320">Form</span><span class="op" id="3044324">[</span><span class="ident" id="3044325">k</span><span class="op" id="3044326">]</span><span class="op" id="3044327">,</span>&nbsp;<span class="ident" id="3044329">v</span><span class="op" id="3044330">...</span><span class="op" id="3044333">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044339">r</span><span class="op" id="3044340">.</span><span class="ident" id="3044341">MultipartForm</span>&nbsp;<span class="op" id="3044355">=</span>&nbsp;<span class="ident" id="3044357">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044361">return</span>&nbsp;<span class="ident" id="3044368">nil</span><br>
<span class="lineno"></span><span class="op" id="3044372">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="3044375">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="3044450">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="3044528">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="3044605">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="3044648">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3044713">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="3044752">func</span>&nbsp;<span class="op" id="3044757">(</span><span class="ident" id="3044758">r</span>&nbsp;<span class="op" id="3044760">*</span><span class="ident" id="3044761">Request</span><span class="op" id="3044768">)</span>&nbsp;<span class="ident" id="3044770">FormValue</span><span class="op" id="3044779">(</span><span class="ident" id="3044780">key</span>&nbsp;<span class="builtintype" id="3044784">string</span><span class="op" id="3044790">)</span>&nbsp;<span class="builtintype" id="3044792">string</span>&nbsp;<span class="op" id="3044799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044802">if</span>&nbsp;<span class="ident" id="3044805">r</span><span class="op" id="3044806">.</span><span class="ident" id="3044807">Form</span>&nbsp;<span class="op" id="3044812">==</span>&nbsp;<span class="ident" id="3044815">nil</span>&nbsp;<span class="op" id="3044819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3044823">r</span><span class="op" id="3044824">.</span><span class="ident" id="3044825">ParseMultipartForm</span><span class="op" id="3044843">(</span><span class="ident" id="3044844">defaultMaxMemory</span><span class="op" id="3044860">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044866">if</span>&nbsp;<span class="ident" id="3044869">vs</span>&nbsp;<span class="op" id="3044872">:=</span>&nbsp;<span class="ident" id="3044875">r</span><span class="op" id="3044876">.</span><span class="ident" id="3044877">Form</span><span class="op" id="3044881">[</span><span class="ident" id="3044882">key</span><span class="op" id="3044885">]</span><span class="op" id="3044886">;</span>&nbsp;<span class="builtinfunc" id="3044888">len</span><span class="op" id="3044891">(</span><span class="ident" id="3044892">vs</span><span class="op" id="3044894">)</span>&nbsp;<span class="op" id="3044896">&gt;</span>&nbsp;<span class="num" id="3044898">0</span>&nbsp;<span class="op" id="3044900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044904">return</span>&nbsp;<span class="ident" id="3044911">vs</span><span class="op" id="3044913">[</span><span class="num" id="3044914">0</span><span class="op" id="3044915">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3044918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3044921">return</span>&nbsp;<span class="string" id="3044928">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="3044931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3044934">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="3045011">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="3045069">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="3045150">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="3045193">func</span>&nbsp;<span class="op" id="3045198">(</span><span class="ident" id="3045199">r</span>&nbsp;<span class="op" id="3045201">*</span><span class="ident" id="3045202">Request</span><span class="op" id="3045209">)</span>&nbsp;<span class="ident" id="3045211">PostFormValue</span><span class="op" id="3045224">(</span><span class="ident" id="3045225">key</span>&nbsp;<span class="builtintype" id="3045229">string</span><span class="op" id="3045235">)</span>&nbsp;<span class="builtintype" id="3045237">string</span>&nbsp;<span class="op" id="3045244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045247">if</span>&nbsp;<span class="ident" id="3045250">r</span><span class="op" id="3045251">.</span><span class="ident" id="3045252">PostForm</span>&nbsp;<span class="op" id="3045261">==</span>&nbsp;<span class="ident" id="3045264">nil</span>&nbsp;<span class="op" id="3045268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045272">r</span><span class="op" id="3045273">.</span><span class="ident" id="3045274">ParseMultipartForm</span><span class="op" id="3045292">(</span><span class="ident" id="3045293">defaultMaxMemory</span><span class="op" id="3045309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045312">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045315">if</span>&nbsp;<span class="ident" id="3045318">vs</span>&nbsp;<span class="op" id="3045321">:=</span>&nbsp;<span class="ident" id="3045324">r</span><span class="op" id="3045325">.</span><span class="ident" id="3045326">PostForm</span><span class="op" id="3045334">[</span><span class="ident" id="3045335">key</span><span class="op" id="3045338">]</span><span class="op" id="3045339">;</span>&nbsp;<span class="builtinfunc" id="3045341">len</span><span class="op" id="3045344">(</span><span class="ident" id="3045345">vs</span><span class="op" id="3045347">)</span>&nbsp;<span class="op" id="3045349">&gt;</span>&nbsp;<span class="num" id="3045351">0</span>&nbsp;<span class="op" id="3045353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045357">return</span>&nbsp;<span class="ident" id="3045364">vs</span><span class="op" id="3045366">[</span><span class="num" id="3045367">0</span><span class="op" id="3045368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045374">return</span>&nbsp;<span class="string" id="3045381">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3045384">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="3045387">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="3045449">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="3045514">func</span>&nbsp;<span class="op" id="3045519">(</span><span class="ident" id="3045520">r</span>&nbsp;<span class="op" id="3045522">*</span><span class="ident" id="3045523">Request</span><span class="op" id="3045530">)</span>&nbsp;<span class="ident" id="3045532">FormFile</span><span class="op" id="3045540">(</span><span class="ident" id="3045541">key</span>&nbsp;<span class="builtintype" id="3045545">string</span><span class="op" id="3045551">)</span>&nbsp;<span class="op" id="3045553">(</span><span class="ident" id="3045554">multipart</span><span class="op" id="3045563">.</span><span class="ident" id="3045564">File</span><span class="op" id="3045568">,</span>&nbsp;<span class="op" id="3045570">*</span><span class="ident" id="3045571">multipart</span><span class="op" id="3045580">.</span><span class="ident" id="3045581">FileHeader</span><span class="op" id="3045591">,</span>&nbsp;<span class="builtintype" id="3045593">error</span><span class="op" id="3045598">)</span>&nbsp;<span class="op" id="3045600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045603">if</span>&nbsp;<span class="ident" id="3045606">r</span><span class="op" id="3045607">.</span><span class="ident" id="3045608">MultipartForm</span>&nbsp;<span class="op" id="3045622">==</span>&nbsp;<span class="ident" id="3045625">multipartByReader</span>&nbsp;<span class="op" id="3045643">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045647">return</span>&nbsp;<span class="ident" id="3045654">nil</span><span class="op" id="3045657">,</span>&nbsp;<span class="ident" id="3045659">nil</span><span class="op" id="3045662">,</span>&nbsp;<span class="ident" id="3045664">errors</span><span class="op" id="3045670">.</span><span class="ident" id="3045671">New</span><span class="op" id="3045674">(</span><span class="string" id="3045675">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="3045719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045725">if</span>&nbsp;<span class="ident" id="3045728">r</span><span class="op" id="3045729">.</span><span class="ident" id="3045730">MultipartForm</span>&nbsp;<span class="op" id="3045744">==</span>&nbsp;<span class="ident" id="3045747">nil</span>&nbsp;<span class="op" id="3045751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045755">err</span>&nbsp;<span class="op" id="3045759">:=</span>&nbsp;<span class="ident" id="3045762">r</span><span class="op" id="3045763">.</span><span class="ident" id="3045764">ParseMultipartForm</span><span class="op" id="3045782">(</span><span class="ident" id="3045783">defaultMaxMemory</span><span class="op" id="3045799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045803">if</span>&nbsp;<span class="ident" id="3045806">err</span>&nbsp;<span class="op" id="3045810">!=</span>&nbsp;<span class="ident" id="3045813">nil</span>&nbsp;<span class="op" id="3045817">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045822">return</span>&nbsp;<span class="ident" id="3045829">nil</span><span class="op" id="3045832">,</span>&nbsp;<span class="ident" id="3045834">nil</span><span class="op" id="3045837">,</span>&nbsp;<span class="ident" id="3045839">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3045848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045851">if</span>&nbsp;<span class="ident" id="3045854">r</span><span class="op" id="3045855">.</span><span class="ident" id="3045856">MultipartForm</span>&nbsp;<span class="op" id="3045870">!=</span>&nbsp;<span class="ident" id="3045873">nil</span>&nbsp;<span class="op" id="3045877">&amp;&amp;</span>&nbsp;<span class="ident" id="3045880">r</span><span class="op" id="3045881">.</span><span class="ident" id="3045882">MultipartForm</span><span class="op" id="3045895">.</span><span class="ident" id="3045896">File</span>&nbsp;<span class="op" id="3045901">!=</span>&nbsp;<span class="ident" id="3045904">nil</span>&nbsp;<span class="op" id="3045908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045912">if</span>&nbsp;<span class="ident" id="3045915">fhs</span>&nbsp;<span class="op" id="3045919">:=</span>&nbsp;<span class="ident" id="3045922">r</span><span class="op" id="3045923">.</span><span class="ident" id="3045924">MultipartForm</span><span class="op" id="3045937">.</span><span class="ident" id="3045938">File</span><span class="op" id="3045942">[</span><span class="ident" id="3045943">key</span><span class="op" id="3045946">]</span><span class="op" id="3045947">;</span>&nbsp;<span class="builtinfunc" id="3045949">len</span><span class="op" id="3045952">(</span><span class="ident" id="3045953">fhs</span><span class="op" id="3045956">)</span>&nbsp;<span class="op" id="3045958">&gt;</span>&nbsp;<span class="num" id="3045960">0</span>&nbsp;<span class="op" id="3045962">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3045967">f</span><span class="op" id="3045968">,</span>&nbsp;<span class="ident" id="3045970">err</span>&nbsp;<span class="op" id="3045974">:=</span>&nbsp;<span class="ident" id="3045977">fhs</span><span class="op" id="3045980">[</span><span class="num" id="3045981">0</span><span class="op" id="3045982">]</span><span class="op" id="3045983">.</span><span class="ident" id="3045984">Open</span><span class="op" id="3045988">(</span><span class="op" id="3045989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3045994">return</span>&nbsp;<span class="ident" id="3046001">f</span><span class="op" id="3046002">,</span>&nbsp;<span class="ident" id="3046004">fhs</span><span class="op" id="3046007">[</span><span class="num" id="3046008">0</span><span class="op" id="3046009">]</span><span class="op" id="3046010">,</span>&nbsp;<span class="ident" id="3046012">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046024">return</span>&nbsp;<span class="ident" id="3046031">nil</span><span class="op" id="3046034">,</span>&nbsp;<span class="ident" id="3046036">nil</span><span class="op" id="3046039">,</span>&nbsp;<span class="ident" id="3046041">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="3046056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3046059">func</span>&nbsp;<span class="op" id="3046064">(</span><span class="ident" id="3046065">r</span>&nbsp;<span class="op" id="3046067">*</span><span class="ident" id="3046068">Request</span><span class="op" id="3046075">)</span>&nbsp;<span class="ident" id="3046077">expectsContinue</span><span class="op" id="3046092">(</span><span class="op" id="3046093">)</span>&nbsp;<span class="builtintype" id="3046095">bool</span>&nbsp;<span class="op" id="3046100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046103">return</span>&nbsp;<span class="ident" id="3046110">hasToken</span><span class="op" id="3046118">(</span><span class="ident" id="3046119">r</span><span class="op" id="3046120">.</span><span class="ident" id="3046121">Header</span><span class="op" id="3046127">.</span><span class="ident" id="3046128">get</span><span class="op" id="3046131">(</span><span class="string" id="3046132">&#34;Expect&#34;</span><span class="op" id="3046140">)</span><span class="op" id="3046141">,</span>&nbsp;<span class="string" id="3046143">&#34;100-continue&#34;</span><span class="op" id="3046157">)</span><br>
<span class="lineno"></span><span class="op" id="3046159">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="3046162">func</span>&nbsp;<span class="op" id="3046167">(</span><span class="ident" id="3046168">r</span>&nbsp;<span class="op" id="3046170">*</span><span class="ident" id="3046171">Request</span><span class="op" id="3046178">)</span>&nbsp;<span class="ident" id="3046180">wantsHttp10KeepAlive</span><span class="op" id="3046200">(</span><span class="op" id="3046201">)</span>&nbsp;<span class="builtintype" id="3046203">bool</span>&nbsp;<span class="op" id="3046208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046211">if</span>&nbsp;<span class="ident" id="3046214">r</span><span class="op" id="3046215">.</span><span class="ident" id="3046216">ProtoMajor</span>&nbsp;<span class="op" id="3046227">!=</span>&nbsp;<span class="num" id="3046230">1</span>&nbsp;<span class="op" id="3046232">||</span>&nbsp;<span class="ident" id="3046235">r</span><span class="op" id="3046236">.</span><span class="ident" id="3046237">ProtoMinor</span>&nbsp;<span class="op" id="3046248">!=</span>&nbsp;<span class="num" id="3046251">0</span>&nbsp;<span class="op" id="3046253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046257">return</span>&nbsp;<span class="builtintype" id="3046264">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046271">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046274">return</span>&nbsp;<span class="ident" id="3046281">hasToken</span><span class="op" id="3046289">(</span><span class="ident" id="3046290">r</span><span class="op" id="3046291">.</span><span class="ident" id="3046292">Header</span><span class="op" id="3046298">.</span><span class="ident" id="3046299">get</span><span class="op" id="3046302">(</span><span class="string" id="3046303">&#34;Connection&#34;</span><span class="op" id="3046315">)</span><span class="op" id="3046316">,</span>&nbsp;<span class="string" id="3046318">&#34;keep-alive&#34;</span><span class="op" id="3046330">)</span><br>
<span class="lineno"></span><span class="op" id="3046332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3046335">func</span>&nbsp;<span class="op" id="3046340">(</span><span class="ident" id="3046341">r</span>&nbsp;<span class="op" id="3046343">*</span><span class="ident" id="3046344">Request</span><span class="op" id="3046351">)</span>&nbsp;<span class="ident" id="3046353">wantsClose</span><span class="op" id="3046363">(</span><span class="op" id="3046364">)</span>&nbsp;<span class="builtintype" id="3046366">bool</span>&nbsp;<span class="op" id="3046371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046374">return</span>&nbsp;<span class="ident" id="3046381">hasToken</span><span class="op" id="3046389">(</span><span class="ident" id="3046390">r</span><span class="op" id="3046391">.</span><span class="ident" id="3046392">Header</span><span class="op" id="3046398">.</span><span class="ident" id="3046399">get</span><span class="op" id="3046402">(</span><span class="string" id="3046403">&#34;Connection&#34;</span><span class="op" id="3046415">)</span><span class="op" id="3046416">,</span>&nbsp;<span class="string" id="3046418">&#34;close&#34;</span><span class="op" id="3046425">)</span><br>
<span class="lineno">915</span><span class="op" id="3046427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3046430">func</span>&nbsp;<span class="op" id="3046435">(</span><span class="ident" id="3046436">r</span>&nbsp;<span class="op" id="3046438">*</span><span class="ident" id="3046439">Request</span><span class="op" id="3046446">)</span>&nbsp;<span class="ident" id="3046448">closeBody</span><span class="op" id="3046457">(</span><span class="op" id="3046458">)</span>&nbsp;<span class="op" id="3046460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3046463">if</span>&nbsp;<span class="ident" id="3046466">r</span><span class="op" id="3046467">.</span><span class="ident" id="3046468">Body</span>&nbsp;<span class="op" id="3046473">!=</span>&nbsp;<span class="ident" id="3046476">nil</span>&nbsp;<span class="op" id="3046480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3046484">r</span><span class="op" id="3046485">.</span><span class="ident" id="3046486">Body</span><span class="op" id="3046490">.</span><span class="ident" id="3046491">Close</span><span class="op" id="3046496">(</span><span class="op" id="3046497">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3046500">}</span><br>
<span class="lineno"></span><span class="op" id="3046502">}</span>
</div>
</body>
</html>
