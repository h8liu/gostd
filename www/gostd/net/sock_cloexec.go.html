<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4148924">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4148979">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4149033">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4149084">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;sysSocket&nbsp;and&nbsp;accept&nbsp;for&nbsp;platforms&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4149148">//&nbsp;provide&nbsp;a&nbsp;fast&nbsp;path&nbsp;for&nbsp;setting&nbsp;SetNonblock&nbsp;and&nbsp;CloseOnExec.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4149213">//&nbsp;+build&nbsp;freebsd&nbsp;linux</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4149238">package</span>&nbsp;<span class="ident" id="4149246">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4149251">import</span>&nbsp;<span class="string" id="4149258">&#34;syscall&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4149269">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;socket&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">15</span><span class="comment" id="4149339">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="4149387">func</span>&nbsp;<span class="ident" id="4149392">sysSocket</span><span class="op" id="4149401">(</span><span class="ident" id="4149402">family</span><span class="op" id="4149408">,</span>&nbsp;<span class="ident" id="4149410">sotype</span><span class="op" id="4149416">,</span>&nbsp;<span class="ident" id="4149418">proto</span>&nbsp;<span class="builtintype" id="4149424">int</span><span class="op" id="4149427">)</span>&nbsp;<span class="op" id="4149429">(</span><span class="builtintype" id="4149430">int</span><span class="op" id="4149433">,</span>&nbsp;<span class="builtintype" id="4149435">error</span><span class="op" id="4149440">)</span>&nbsp;<span class="op" id="4149442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149445">s</span><span class="op" id="4149446">,</span>&nbsp;<span class="ident" id="4149448">err</span>&nbsp;<span class="op" id="4149452">:=</span>&nbsp;<span class="ident" id="4149455">syscall</span><span class="op" id="4149462">.</span><span class="ident" id="4149463">Socket</span><span class="op" id="4149469">(</span><span class="ident" id="4149470">family</span><span class="op" id="4149476">,</span>&nbsp;<span class="ident" id="4149478">sotype</span><span class="op" id="4149484">|</span><span class="ident" id="4149485">syscall</span><span class="op" id="4149492">.</span><span class="ident" id="4149493">SOCK_NONBLOCK</span><span class="op" id="4149506">|</span><span class="ident" id="4149507">syscall</span><span class="op" id="4149514">.</span><span class="ident" id="4149515">SOCK_CLOEXEC</span><span class="op" id="4149527">,</span>&nbsp;<span class="ident" id="4149529">proto</span><span class="op" id="4149534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149537">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;SOCK_NONBLOCK&nbsp;and&nbsp;SOCK_CLOEXEC&nbsp;flags&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149596">//&nbsp;introduced&nbsp;in&nbsp;2.6.27&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;both&nbsp;flags&nbsp;were</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149659">//&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we&nbsp;get&nbsp;an&nbsp;EINVAL&nbsp;error&nbsp;on&nbsp;Linux</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149723">//&nbsp;or&nbsp;EPROTONOSUPPORT&nbsp;error&nbsp;on&nbsp;FreeBSD,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149783">//&nbsp;socket&nbsp;without&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149808">if</span>&nbsp;<span class="ident" id="4149811">err</span>&nbsp;<span class="op" id="4149815">==</span>&nbsp;<span class="ident" id="4149818">nil</span>&nbsp;<span class="op" id="4149822">||</span>&nbsp;<span class="op" id="4149825">(</span><span class="ident" id="4149826">err</span>&nbsp;<span class="op" id="4149830">!=</span>&nbsp;<span class="ident" id="4149833">syscall</span><span class="op" id="4149840">.</span><span class="ident" id="4149841">EPROTONOSUPPORT</span>&nbsp;<span class="op" id="4149857">&amp;&amp;</span>&nbsp;<span class="ident" id="4149860">err</span>&nbsp;<span class="op" id="4149864">!=</span>&nbsp;<span class="ident" id="4149867">syscall</span><span class="op" id="4149874">.</span><span class="ident" id="4149875">EINVAL</span><span class="op" id="4149881">)</span>&nbsp;<span class="op" id="4149883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4149887">return</span>&nbsp;<span class="ident" id="4149894">s</span><span class="op" id="4149895">,</span>&nbsp;<span class="ident" id="4149897">err</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4149902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4149906">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149967">syscall</span><span class="op" id="4149974">.</span><span class="ident" id="4149975">ForkLock</span><span class="op" id="4149983">.</span><span class="ident" id="4149984">RLock</span><span class="op" id="4149989">(</span><span class="op" id="4149990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4149993">s</span><span class="op" id="4149994">,</span>&nbsp;<span class="ident" id="4149996">err</span>&nbsp;<span class="op" id="4150000">=</span>&nbsp;<span class="ident" id="4150002">syscall</span><span class="op" id="4150009">.</span><span class="ident" id="4150010">Socket</span><span class="op" id="4150016">(</span><span class="ident" id="4150017">family</span><span class="op" id="4150023">,</span>&nbsp;<span class="ident" id="4150025">sotype</span><span class="op" id="4150031">,</span>&nbsp;<span class="ident" id="4150033">proto</span><span class="op" id="4150038">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150041">if</span>&nbsp;<span class="ident" id="4150044">err</span>&nbsp;<span class="op" id="4150048">==</span>&nbsp;<span class="ident" id="4150051">nil</span>&nbsp;<span class="op" id="4150055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150059">syscall</span><span class="op" id="4150066">.</span><span class="ident" id="4150067">CloseOnExec</span><span class="op" id="4150078">(</span><span class="ident" id="4150079">s</span><span class="op" id="4150080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150086">syscall</span><span class="op" id="4150093">.</span><span class="ident" id="4150094">ForkLock</span><span class="op" id="4150102">.</span><span class="ident" id="4150103">RUnlock</span><span class="op" id="4150110">(</span><span class="op" id="4150111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150114">if</span>&nbsp;<span class="ident" id="4150117">err</span>&nbsp;<span class="op" id="4150121">!=</span>&nbsp;<span class="ident" id="4150124">nil</span>&nbsp;<span class="op" id="4150128">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150132">return</span>&nbsp;<span class="op" id="4150139">-</span><span class="num" id="4150140">1</span><span class="op" id="4150141">,</span>&nbsp;<span class="ident" id="4150143">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150151">if</span>&nbsp;<span class="ident" id="4150154">err</span>&nbsp;<span class="op" id="4150158">=</span>&nbsp;<span class="ident" id="4150160">syscall</span><span class="op" id="4150167">.</span><span class="ident" id="4150168">SetNonblock</span><span class="op" id="4150179">(</span><span class="ident" id="4150180">s</span><span class="op" id="4150181">,</span>&nbsp;<span class="builtintype" id="4150183">true</span><span class="op" id="4150187">)</span><span class="op" id="4150188">;</span>&nbsp;<span class="ident" id="4150190">err</span>&nbsp;<span class="op" id="4150194">!=</span>&nbsp;<span class="ident" id="4150197">nil</span>&nbsp;<span class="op" id="4150201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150205">syscall</span><span class="op" id="4150212">.</span><span class="ident" id="4150213">Close</span><span class="op" id="4150218">(</span><span class="ident" id="4150219">s</span><span class="op" id="4150220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150224">return</span>&nbsp;<span class="op" id="4150231">-</span><span class="num" id="4150232">1</span><span class="op" id="4150233">,</span>&nbsp;<span class="ident" id="4150235">err</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4150240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150243">return</span>&nbsp;<span class="ident" id="4150250">s</span><span class="op" id="4150251">,</span>&nbsp;<span class="ident" id="4150253">nil</span><br>
<span class="lineno"></span><span class="op" id="4150257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4150260">//&nbsp;Wrapper&nbsp;around&nbsp;the&nbsp;accept&nbsp;system&nbsp;call&nbsp;that&nbsp;marks&nbsp;the&nbsp;returned&nbsp;file</span><br>
<span class="lineno">45</span><span class="comment" id="4150330">//&nbsp;descriptor&nbsp;as&nbsp;nonblocking&nbsp;and&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="keyword" id="4150378">func</span>&nbsp;<span class="ident" id="4150383">accept</span><span class="op" id="4150389">(</span><span class="ident" id="4150390">s</span>&nbsp;<span class="builtintype" id="4150392">int</span><span class="op" id="4150395">)</span>&nbsp;<span class="op" id="4150397">(</span><span class="builtintype" id="4150398">int</span><span class="op" id="4150401">,</span>&nbsp;<span class="ident" id="4150403">syscall</span><span class="op" id="4150410">.</span><span class="ident" id="4150411">Sockaddr</span><span class="op" id="4150419">,</span>&nbsp;<span class="builtintype" id="4150421">error</span><span class="op" id="4150426">)</span>&nbsp;<span class="op" id="4150428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4150431">ns</span><span class="op" id="4150433">,</span>&nbsp;<span class="ident" id="4150435">sa</span><span class="op" id="4150437">,</span>&nbsp;<span class="ident" id="4150439">err</span>&nbsp;<span class="op" id="4150443">:=</span>&nbsp;<span class="ident" id="4150446">syscall</span><span class="op" id="4150453">.</span><span class="ident" id="4150454">Accept4</span><span class="op" id="4150461">(</span><span class="ident" id="4150462">s</span><span class="op" id="4150463">,</span>&nbsp;<span class="ident" id="4150465">syscall</span><span class="op" id="4150472">.</span><span class="ident" id="4150473">SOCK_NONBLOCK</span><span class="op" id="4150486">|</span><span class="ident" id="4150487">syscall</span><span class="op" id="4150494">.</span><span class="ident" id="4150495">SOCK_CLOEXEC</span><span class="op" id="4150507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150510">//&nbsp;On&nbsp;Linux&nbsp;the&nbsp;accept4&nbsp;system&nbsp;call&nbsp;was&nbsp;introduced&nbsp;in&nbsp;2.6.28</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150572">//&nbsp;kernel&nbsp;and&nbsp;on&nbsp;FreeBSD&nbsp;it&nbsp;was&nbsp;introduced&nbsp;in&nbsp;10&nbsp;kernel.&nbsp;If&nbsp;we</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150636">//&nbsp;get&nbsp;an&nbsp;ENOSYS&nbsp;error&nbsp;on&nbsp;both&nbsp;Linux&nbsp;and&nbsp;FreeBSD,&nbsp;or&nbsp;EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4150697">//&nbsp;error&nbsp;on&nbsp;Linux,&nbsp;fall&nbsp;back&nbsp;to&nbsp;using&nbsp;accept.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150744">switch</span>&nbsp;<span class="ident" id="4150751">err</span>&nbsp;<span class="op" id="4150755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150758">default</span><span class="op" id="4150765">:</span>&nbsp;<span class="comment" id="4150767">//&nbsp;nil&nbsp;and&nbsp;errors&nbsp;other&nbsp;than&nbsp;the&nbsp;ones&nbsp;listed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150814">return</span>&nbsp;<span class="ident" id="4150821">ns</span><span class="op" id="4150823">,</span>&nbsp;<span class="ident" id="4150825">sa</span><span class="op" id="4150827">,</span>&nbsp;<span class="ident" id="4150829">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150834">case</span>&nbsp;<span class="ident" id="4150839">syscall</span><span class="op" id="4150846">.</span><span class="ident" id="4150847">ENOSYS</span><span class="op" id="4150853">:</span>&nbsp;<span class="comment" id="4150855">//&nbsp;syscall&nbsp;missing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150875">case</span>&nbsp;<span class="ident" id="4150880">syscall</span><span class="op" id="4150887">.</span><span class="ident" id="4150888">EINVAL</span><span class="op" id="4150894">:</span>&nbsp;<span class="comment" id="4150896">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4150938">case</span>&nbsp;<span class="ident" id="4150943">syscall</span><span class="op" id="4150950">.</span><span class="ident" id="4150951">EACCES</span><span class="op" id="4150957">:</span>&nbsp;<span class="comment" id="4150959">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151001">case</span>&nbsp;<span class="ident" id="4151006">syscall</span><span class="op" id="4151013">.</span><span class="ident" id="4151014">EFAULT</span><span class="op" id="4151020">:</span>&nbsp;<span class="comment" id="4151022">//&nbsp;some&nbsp;Linux&nbsp;use&nbsp;this&nbsp;instead&nbsp;of&nbsp;ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151064">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151068">//&nbsp;See&nbsp;../syscall/exec_unix.go&nbsp;for&nbsp;description&nbsp;of&nbsp;ForkLock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151129">//&nbsp;It&nbsp;is&nbsp;probably&nbsp;okay&nbsp;to&nbsp;hold&nbsp;the&nbsp;lock&nbsp;across&nbsp;syscall.Accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151192">//&nbsp;because&nbsp;we&nbsp;have&nbsp;put&nbsp;fd.sysfd&nbsp;into&nbsp;non-blocking&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151249">//&nbsp;However,&nbsp;a&nbsp;call&nbsp;to&nbsp;the&nbsp;File&nbsp;method&nbsp;will&nbsp;put&nbsp;it&nbsp;back&nbsp;into</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4151310">//&nbsp;blocking&nbsp;mode.&nbsp;We&nbsp;can&#39;t&nbsp;take&nbsp;that&nbsp;risk,&nbsp;so&nbsp;no&nbsp;use&nbsp;of&nbsp;ForkLock&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151382">ns</span><span class="op" id="4151384">,</span>&nbsp;<span class="ident" id="4151386">sa</span><span class="op" id="4151388">,</span>&nbsp;<span class="ident" id="4151390">err</span>&nbsp;<span class="op" id="4151394">=</span>&nbsp;<span class="ident" id="4151396">syscall</span><span class="op" id="4151403">.</span><span class="ident" id="4151404">Accept</span><span class="op" id="4151410">(</span><span class="ident" id="4151411">s</span><span class="op" id="4151412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151415">if</span>&nbsp;<span class="ident" id="4151418">err</span>&nbsp;<span class="op" id="4151422">==</span>&nbsp;<span class="ident" id="4151425">nil</span>&nbsp;<span class="op" id="4151429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151433">syscall</span><span class="op" id="4151440">.</span><span class="ident" id="4151441">CloseOnExec</span><span class="op" id="4151452">(</span><span class="ident" id="4151453">ns</span><span class="op" id="4151455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151458">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151461">if</span>&nbsp;<span class="ident" id="4151464">err</span>&nbsp;<span class="op" id="4151468">!=</span>&nbsp;<span class="ident" id="4151471">nil</span>&nbsp;<span class="op" id="4151475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151479">return</span>&nbsp;<span class="op" id="4151486">-</span><span class="num" id="4151487">1</span><span class="op" id="4151488">,</span>&nbsp;<span class="ident" id="4151490">nil</span><span class="op" id="4151493">,</span>&nbsp;<span class="ident" id="4151495">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151503">if</span>&nbsp;<span class="ident" id="4151506">err</span>&nbsp;<span class="op" id="4151510">=</span>&nbsp;<span class="ident" id="4151512">syscall</span><span class="op" id="4151519">.</span><span class="ident" id="4151520">SetNonblock</span><span class="op" id="4151531">(</span><span class="ident" id="4151532">ns</span><span class="op" id="4151534">,</span>&nbsp;<span class="builtintype" id="4151536">true</span><span class="op" id="4151540">)</span><span class="op" id="4151541">;</span>&nbsp;<span class="ident" id="4151543">err</span>&nbsp;<span class="op" id="4151547">!=</span>&nbsp;<span class="ident" id="4151550">nil</span>&nbsp;<span class="op" id="4151554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4151558">syscall</span><span class="op" id="4151565">.</span><span class="ident" id="4151566">Close</span><span class="op" id="4151571">(</span><span class="ident" id="4151572">ns</span><span class="op" id="4151574">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151578">return</span>&nbsp;<span class="op" id="4151585">-</span><span class="num" id="4151586">1</span><span class="op" id="4151587">,</span>&nbsp;<span class="ident" id="4151589">nil</span><span class="op" id="4151592">,</span>&nbsp;<span class="ident" id="4151594">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4151599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4151602">return</span>&nbsp;<span class="ident" id="4151609">ns</span><span class="op" id="4151611">,</span>&nbsp;<span class="ident" id="4151613">sa</span><span class="op" id="4151615">,</span>&nbsp;<span class="ident" id="4151617">nil</span><br>
<span class="lineno"></span><span class="op" id="4151621">}</span>
</div>
</body>
</html>
