<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>hash/crc32</h2>
<ul>
<li><a href="/gostd/hash/crc32/crc32.go.html" class="current">crc32.go</a></li>
<li><a href="/gostd/hash/crc32/crc32_amd64x.go.html">crc32_amd64x.go</a></li>
<li><a href="/gostd/hash/crc32/crc32_test.go.html">crc32_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4175267">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4175322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4175376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4175427">//&nbsp;Package&nbsp;crc32&nbsp;implements&nbsp;the&nbsp;32-bit&nbsp;cyclic&nbsp;redundancy&nbsp;check,&nbsp;or&nbsp;CRC-32,</span><br>
<span class="lineno"></span><span class="comment" id="4175502">//&nbsp;checksum.&nbsp;See&nbsp;http://en.wikipedia.org/wiki/Cyclic_redundancy_check&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4175576">//&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4175592">package</span>&nbsp;<span class="ident" id="4175600">crc32</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4175607">import</span>&nbsp;<span class="op" id="4175614">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4175617">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4175625">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4175632">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4175635">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;CRC-32&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4175678">const</span>&nbsp;<span class="ident" id="4175684">Size</span>&nbsp;<span class="op" id="4175689">=</span>&nbsp;<span class="num" id="4175691">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175694">//&nbsp;Predefined&nbsp;polynomials.</span><br>
<span class="lineno"></span><span class="keyword" id="4175721">const</span>&nbsp;<span class="op" id="4175727">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175730">//&nbsp;IEEE&nbsp;is&nbsp;by&nbsp;far&nbsp;and&nbsp;away&nbsp;the&nbsp;most&nbsp;common&nbsp;CRC-32&nbsp;polynomial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175793">//&nbsp;Used&nbsp;by&nbsp;ethernet&nbsp;(IEEE&nbsp;802.3),&nbsp;v.42,&nbsp;fddi,&nbsp;gzip,&nbsp;zip,&nbsp;png,&nbsp;...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4175860">IEEE</span>&nbsp;<span class="op" id="4175865">=</span>&nbsp;<span class="num" id="4175867">0xedb88320</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175880">//&nbsp;Castagnoli&#39;s&nbsp;polynomial,&nbsp;used&nbsp;in&nbsp;iSCSI.</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175924">//&nbsp;Has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4175982">//&nbsp;http://dx.doi.org/10.1109/26.231911</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176022">Castagnoli</span>&nbsp;<span class="op" id="4176033">=</span>&nbsp;<span class="num" id="4176035">0x82f63b78</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176048">//&nbsp;Koopman&#39;s&nbsp;polynomial.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176074">//&nbsp;Also&nbsp;has&nbsp;better&nbsp;error&nbsp;detection&nbsp;characteristics&nbsp;than&nbsp;IEEE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4176137">//&nbsp;http://dx.doi.org/10.1109/DSN.2002.1028931</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176184">Koopman</span>&nbsp;<span class="op" id="4176192">=</span>&nbsp;<span class="num" id="4176194">0xeb31d82e</span><br>
<span class="lineno"></span><span class="op" id="4176205">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4176208">//&nbsp;Table&nbsp;is&nbsp;a&nbsp;256-word&nbsp;table&nbsp;representing&nbsp;the&nbsp;polynomial&nbsp;for&nbsp;efficient&nbsp;processing.</span><br>
<span class="lineno"></span><span class="keyword" id="4176291">type</span>&nbsp;<span class="ident" id="4176296">Table</span>&nbsp;<span class="op" id="4176302">[</span><span class="num" id="4176303">256</span><span class="op" id="4176306">]</span><span class="builtintype" id="4176307">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4176315">//&nbsp;castagnoliTable&nbsp;points&nbsp;to&nbsp;a&nbsp;lazily&nbsp;initialized&nbsp;Table&nbsp;for&nbsp;the&nbsp;Castagnoli</span><br>
<span class="lineno"></span><span class="comment" id="4176390">//&nbsp;polynomial.&nbsp;MakeTable&nbsp;will&nbsp;always&nbsp;return&nbsp;this&nbsp;value&nbsp;when&nbsp;asked&nbsp;to&nbsp;make&nbsp;a</span><br>
<span class="lineno">40</span><span class="comment" id="4176466">//&nbsp;Castagnoli&nbsp;table&nbsp;so&nbsp;we&nbsp;can&nbsp;compare&nbsp;against&nbsp;it&nbsp;to&nbsp;find&nbsp;when&nbsp;the&nbsp;caller&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4176542">//&nbsp;using&nbsp;this&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4176568">var</span>&nbsp;<span class="ident" id="4176572">castagnoliTable</span>&nbsp;<span class="op" id="4176588">*</span><span class="ident" id="4176589">Table</span><br>
<span class="lineno"></span><span class="keyword" id="4176595">var</span>&nbsp;<span class="ident" id="4176599">castagnoliOnce</span>&nbsp;<span class="ident" id="4176614">sync</span><span class="op" id="4176618">.</span><span class="ident" id="4176619">Once</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4176625">func</span>&nbsp;<span class="ident" id="4176630">castagnoliInit</span><span class="op" id="4176644">(</span><span class="op" id="4176645">)</span>&nbsp;<span class="op" id="4176647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176650">castagnoliTable</span>&nbsp;<span class="op" id="4176666">=</span>&nbsp;<span class="ident" id="4176668">makeTable</span><span class="op" id="4176677">(</span><span class="ident" id="4176678">Castagnoli</span><span class="op" id="4176688">)</span><br>
<span class="lineno"></span><span class="op" id="4176690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4176693">//&nbsp;IEEETable&nbsp;is&nbsp;the&nbsp;table&nbsp;for&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">50</span><span class="keyword" id="4176744">var</span>&nbsp;<span class="ident" id="4176748">IEEETable</span>&nbsp;<span class="op" id="4176758">=</span>&nbsp;<span class="ident" id="4176760">makeTable</span><span class="op" id="4176769">(</span><span class="ident" id="4176770">IEEE</span><span class="op" id="4176774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4176777">//&nbsp;MakeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4176851">func</span>&nbsp;<span class="ident" id="4176856">MakeTable</span><span class="op" id="4176865">(</span><span class="ident" id="4176866">poly</span>&nbsp;<span class="builtintype" id="4176871">uint32</span><span class="op" id="4176877">)</span>&nbsp;<span class="op" id="4176879">*</span><span class="ident" id="4176880">Table</span>&nbsp;<span class="op" id="4176886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176889">switch</span>&nbsp;<span class="ident" id="4176896">poly</span>&nbsp;<span class="op" id="4176901">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176904">case</span>&nbsp;<span class="ident" id="4176909">IEEE</span><span class="op" id="4176913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176917">return</span>&nbsp;<span class="ident" id="4176924">IEEETable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176935">case</span>&nbsp;<span class="ident" id="4176940">Castagnoli</span><span class="op" id="4176950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4176954">castagnoliOnce</span><span class="op" id="4176968">.</span><span class="ident" id="4176969">Do</span><span class="op" id="4176971">(</span><span class="ident" id="4176972">castagnoliInit</span><span class="op" id="4176986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4176990">return</span>&nbsp;<span class="ident" id="4176997">castagnoliTable</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177017">return</span>&nbsp;<span class="ident" id="4177024">makeTable</span><span class="op" id="4177033">(</span><span class="ident" id="4177034">poly</span><span class="op" id="4177038">)</span><br>
<span class="lineno"></span><span class="op" id="4177040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177043">//&nbsp;makeTable&nbsp;returns&nbsp;the&nbsp;Table&nbsp;constructed&nbsp;from&nbsp;the&nbsp;specified&nbsp;polynomial.</span><br>
<span class="lineno">65</span><span class="keyword" id="4177117">func</span>&nbsp;<span class="ident" id="4177122">makeTable</span><span class="op" id="4177131">(</span><span class="ident" id="4177132">poly</span>&nbsp;<span class="builtintype" id="4177137">uint32</span><span class="op" id="4177143">)</span>&nbsp;<span class="op" id="4177145">*</span><span class="ident" id="4177146">Table</span>&nbsp;<span class="op" id="4177152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177155">t</span>&nbsp;<span class="op" id="4177157">:=</span>&nbsp;<span class="builtinfunc" id="4177160">new</span><span class="op" id="4177163">(</span><span class="ident" id="4177164">Table</span><span class="op" id="4177169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177172">for</span>&nbsp;<span class="ident" id="4177176">i</span>&nbsp;<span class="op" id="4177178">:=</span>&nbsp;<span class="num" id="4177181">0</span><span class="op" id="4177182">;</span>&nbsp;<span class="ident" id="4177184">i</span>&nbsp;<span class="op" id="4177186">&lt;</span>&nbsp;<span class="num" id="4177188">256</span><span class="op" id="4177191">;</span>&nbsp;<span class="ident" id="4177193">i</span><span class="op" id="4177194">++</span>&nbsp;<span class="op" id="4177197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177201">crc</span>&nbsp;<span class="op" id="4177205">:=</span>&nbsp;<span class="builtintype" id="4177208">uint32</span><span class="op" id="4177214">(</span><span class="ident" id="4177215">i</span><span class="op" id="4177216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177220">for</span>&nbsp;<span class="ident" id="4177224">j</span>&nbsp;<span class="op" id="4177226">:=</span>&nbsp;<span class="num" id="4177229">0</span><span class="op" id="4177230">;</span>&nbsp;<span class="ident" id="4177232">j</span>&nbsp;<span class="op" id="4177234">&lt;</span>&nbsp;<span class="num" id="4177236">8</span><span class="op" id="4177237">;</span>&nbsp;<span class="ident" id="4177239">j</span><span class="op" id="4177240">++</span>&nbsp;<span class="op" id="4177243">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177248">if</span>&nbsp;<span class="ident" id="4177251">crc</span><span class="op" id="4177254">&amp;</span><span class="num" id="4177255">1</span>&nbsp;<span class="op" id="4177257">==</span>&nbsp;<span class="num" id="4177260">1</span>&nbsp;<span class="op" id="4177262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177268">crc</span>&nbsp;<span class="op" id="4177272">=</span>&nbsp;<span class="op" id="4177274">(</span><span class="ident" id="4177275">crc</span>&nbsp;<span class="op" id="4177279">&gt;&gt;</span>&nbsp;<span class="num" id="4177282">1</span><span class="op" id="4177283">)</span>&nbsp;<span class="op" id="4177285">^</span>&nbsp;<span class="ident" id="4177287">poly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177295">}</span>&nbsp;<span class="keyword" id="4177297">else</span>&nbsp;<span class="op" id="4177302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177308">crc</span>&nbsp;<span class="op" id="4177312">&gt;&gt;=</span>&nbsp;<span class="num" id="4177316">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177321">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177329">t</span><span class="op" id="4177330">[</span><span class="ident" id="4177331">i</span><span class="op" id="4177332">]</span>&nbsp;<span class="op" id="4177334">=</span>&nbsp;<span class="ident" id="4177336">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4177341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177344">return</span>&nbsp;<span class="ident" id="4177351">t</span><br>
<span class="lineno"></span><span class="op" id="4177353">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4177356">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4177415">type</span>&nbsp;<span class="ident" id="4177420">digest</span>&nbsp;<span class="keyword" id="4177427">struct</span>&nbsp;<span class="op" id="4177434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177437">crc</span>&nbsp;<span class="builtintype" id="4177441">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177449">tab</span>&nbsp;<span class="op" id="4177453">*</span><span class="ident" id="4177454">Table</span><br>
<span class="lineno">85</span><span class="op" id="4177460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177463">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4177526">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4177576">func</span>&nbsp;<span class="ident" id="4177581">New</span><span class="op" id="4177584">(</span><span class="ident" id="4177585">tab</span>&nbsp;<span class="op" id="4177589">*</span><span class="ident" id="4177590">Table</span><span class="op" id="4177595">)</span>&nbsp;<span class="ident" id="4177597">hash</span><span class="op" id="4177601">.</span><span class="ident" id="4177602">Hash32</span>&nbsp;<span class="op" id="4177609">{</span>&nbsp;<span class="keyword" id="4177611">return</span>&nbsp;<span class="op" id="4177618">&amp;</span><span class="ident" id="4177619">digest</span><span class="op" id="4177625">{</span><span class="num" id="4177626">0</span><span class="op" id="4177627">,</span>&nbsp;<span class="ident" id="4177629">tab</span><span class="op" id="4177632">}</span>&nbsp;<span class="op" id="4177634">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4177637">//&nbsp;NewIEEE&nbsp;creates&nbsp;a&nbsp;new&nbsp;hash.Hash32&nbsp;computing&nbsp;the&nbsp;CRC-32&nbsp;checksum</span><br>
<span class="lineno"></span><span class="comment" id="4177704">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno"></span><span class="keyword" id="4177734">func</span>&nbsp;<span class="ident" id="4177739">NewIEEE</span><span class="op" id="4177746">(</span><span class="op" id="4177747">)</span>&nbsp;<span class="ident" id="4177749">hash</span><span class="op" id="4177753">.</span><span class="ident" id="4177754">Hash32</span>&nbsp;<span class="op" id="4177761">{</span>&nbsp;<span class="keyword" id="4177763">return</span>&nbsp;<span class="ident" id="4177770">New</span><span class="op" id="4177773">(</span><span class="ident" id="4177774">IEEETable</span><span class="op" id="4177783">)</span>&nbsp;<span class="op" id="4177785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="4177788">func</span>&nbsp;<span class="op" id="4177793">(</span><span class="ident" id="4177794">d</span>&nbsp;<span class="op" id="4177796">*</span><span class="ident" id="4177797">digest</span><span class="op" id="4177803">)</span>&nbsp;<span class="ident" id="4177805">Size</span><span class="op" id="4177809">(</span><span class="op" id="4177810">)</span>&nbsp;<span class="builtintype" id="4177812">int</span>&nbsp;<span class="op" id="4177816">{</span>&nbsp;<span class="keyword" id="4177818">return</span>&nbsp;<span class="ident" id="4177825">Size</span>&nbsp;<span class="op" id="4177830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4177833">func</span>&nbsp;<span class="op" id="4177838">(</span><span class="ident" id="4177839">d</span>&nbsp;<span class="op" id="4177841">*</span><span class="ident" id="4177842">digest</span><span class="op" id="4177848">)</span>&nbsp;<span class="ident" id="4177850">BlockSize</span><span class="op" id="4177859">(</span><span class="op" id="4177860">)</span>&nbsp;<span class="builtintype" id="4177862">int</span>&nbsp;<span class="op" id="4177866">{</span>&nbsp;<span class="keyword" id="4177868">return</span>&nbsp;<span class="num" id="4177875">1</span>&nbsp;<span class="op" id="4177877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4177880">func</span>&nbsp;<span class="op" id="4177885">(</span><span class="ident" id="4177886">d</span>&nbsp;<span class="op" id="4177888">*</span><span class="ident" id="4177889">digest</span><span class="op" id="4177895">)</span>&nbsp;<span class="ident" id="4177897">Reset</span><span class="op" id="4177902">(</span><span class="op" id="4177903">)</span>&nbsp;<span class="op" id="4177905">{</span>&nbsp;<span class="ident" id="4177907">d</span><span class="op" id="4177908">.</span><span class="ident" id="4177909">crc</span>&nbsp;<span class="op" id="4177913">=</span>&nbsp;<span class="num" id="4177915">0</span>&nbsp;<span class="op" id="4177917">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="4177920">func</span>&nbsp;<span class="ident" id="4177925">update</span><span class="op" id="4177931">(</span><span class="ident" id="4177932">crc</span>&nbsp;<span class="builtintype" id="4177936">uint32</span><span class="op" id="4177942">,</span>&nbsp;<span class="ident" id="4177944">tab</span>&nbsp;<span class="op" id="4177948">*</span><span class="ident" id="4177949">Table</span><span class="op" id="4177954">,</span>&nbsp;<span class="ident" id="4177956">p</span>&nbsp;<span class="op" id="4177958">[</span><span class="op" id="4177959">]</span><span class="builtintype" id="4177960">byte</span><span class="op" id="4177964">)</span>&nbsp;<span class="builtintype" id="4177966">uint32</span>&nbsp;<span class="op" id="4177973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4177976">crc</span>&nbsp;<span class="op" id="4177980">=</span>&nbsp;<span class="op" id="4177982">^</span><span class="ident" id="4177983">crc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4177988">for</span>&nbsp;<span class="ident" id="4177992">_</span><span class="op" id="4177993">,</span>&nbsp;<span class="ident" id="4177995">v</span>&nbsp;<span class="op" id="4177997">:=</span>&nbsp;<span class="keyword" id="4178000">range</span>&nbsp;<span class="ident" id="4178006">p</span>&nbsp;<span class="op" id="4178008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178012">crc</span>&nbsp;<span class="op" id="4178016">=</span>&nbsp;<span class="ident" id="4178018">tab</span><span class="op" id="4178021">[</span><span class="builtintype" id="4178022">byte</span><span class="op" id="4178026">(</span><span class="ident" id="4178027">crc</span><span class="op" id="4178030">)</span><span class="op" id="4178031">^</span><span class="ident" id="4178032">v</span><span class="op" id="4178033">]</span>&nbsp;<span class="op" id="4178035">^</span>&nbsp;<span class="op" id="4178037">(</span><span class="ident" id="4178038">crc</span>&nbsp;<span class="op" id="4178042">&gt;&gt;</span>&nbsp;<span class="num" id="4178045">8</span><span class="op" id="4178046">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178052">return</span>&nbsp;<span class="op" id="4178059">^</span><span class="ident" id="4178060">crc</span><br>
<span class="lineno"></span><span class="op" id="4178064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4178067">//&nbsp;Update&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;adding&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;to&nbsp;the&nbsp;crc.</span><br>
<span class="lineno">110</span><span class="keyword" id="4178133">func</span>&nbsp;<span class="ident" id="4178138">Update</span><span class="op" id="4178144">(</span><span class="ident" id="4178145">crc</span>&nbsp;<span class="builtintype" id="4178149">uint32</span><span class="op" id="4178155">,</span>&nbsp;<span class="ident" id="4178157">tab</span>&nbsp;<span class="op" id="4178161">*</span><span class="ident" id="4178162">Table</span><span class="op" id="4178167">,</span>&nbsp;<span class="ident" id="4178169">p</span>&nbsp;<span class="op" id="4178171">[</span><span class="op" id="4178172">]</span><span class="builtintype" id="4178173">byte</span><span class="op" id="4178177">)</span>&nbsp;<span class="builtintype" id="4178179">uint32</span>&nbsp;<span class="op" id="4178186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178189">if</span>&nbsp;<span class="ident" id="4178192">tab</span>&nbsp;<span class="op" id="4178196">==</span>&nbsp;<span class="ident" id="4178199">castagnoliTable</span>&nbsp;<span class="op" id="4178215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178219">return</span>&nbsp;<span class="ident" id="4178226">updateCastagnoli</span><span class="op" id="4178242">(</span><span class="ident" id="4178243">crc</span><span class="op" id="4178246">,</span>&nbsp;<span class="ident" id="4178248">p</span><span class="op" id="4178249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4178252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178255">return</span>&nbsp;<span class="ident" id="4178262">update</span><span class="op" id="4178268">(</span><span class="ident" id="4178269">crc</span><span class="op" id="4178272">,</span>&nbsp;<span class="ident" id="4178274">tab</span><span class="op" id="4178277">,</span>&nbsp;<span class="ident" id="4178279">p</span><span class="op" id="4178280">)</span><br>
<span class="lineno">115</span><span class="op" id="4178282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178285">func</span>&nbsp;<span class="op" id="4178290">(</span><span class="ident" id="4178291">d</span>&nbsp;<span class="op" id="4178293">*</span><span class="ident" id="4178294">digest</span><span class="op" id="4178300">)</span>&nbsp;<span class="ident" id="4178302">Write</span><span class="op" id="4178307">(</span><span class="ident" id="4178308">p</span>&nbsp;<span class="op" id="4178310">[</span><span class="op" id="4178311">]</span><span class="builtintype" id="4178312">byte</span><span class="op" id="4178316">)</span>&nbsp;<span class="op" id="4178318">(</span><span class="ident" id="4178319">n</span>&nbsp;<span class="builtintype" id="4178321">int</span><span class="op" id="4178324">,</span>&nbsp;<span class="ident" id="4178326">err</span>&nbsp;<span class="builtintype" id="4178330">error</span><span class="op" id="4178335">)</span>&nbsp;<span class="op" id="4178337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178340">d</span><span class="op" id="4178341">.</span><span class="ident" id="4178342">crc</span>&nbsp;<span class="op" id="4178346">=</span>&nbsp;<span class="ident" id="4178348">Update</span><span class="op" id="4178354">(</span><span class="ident" id="4178355">d</span><span class="op" id="4178356">.</span><span class="ident" id="4178357">crc</span><span class="op" id="4178360">,</span>&nbsp;<span class="ident" id="4178362">d</span><span class="op" id="4178363">.</span><span class="ident" id="4178364">tab</span><span class="op" id="4178367">,</span>&nbsp;<span class="ident" id="4178369">p</span><span class="op" id="4178370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178373">return</span>&nbsp;<span class="builtinfunc" id="4178380">len</span><span class="op" id="4178383">(</span><span class="ident" id="4178384">p</span><span class="op" id="4178385">)</span><span class="op" id="4178386">,</span>&nbsp;<span class="ident" id="4178388">nil</span><br>
<span class="lineno">120</span><span class="op" id="4178392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178395">func</span>&nbsp;<span class="op" id="4178400">(</span><span class="ident" id="4178401">d</span>&nbsp;<span class="op" id="4178403">*</span><span class="ident" id="4178404">digest</span><span class="op" id="4178410">)</span>&nbsp;<span class="ident" id="4178412">Sum32</span><span class="op" id="4178417">(</span><span class="op" id="4178418">)</span>&nbsp;<span class="builtintype" id="4178420">uint32</span>&nbsp;<span class="op" id="4178427">{</span>&nbsp;<span class="keyword" id="4178429">return</span>&nbsp;<span class="ident" id="4178436">d</span><span class="op" id="4178437">.</span><span class="ident" id="4178438">crc</span>&nbsp;<span class="op" id="4178442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178445">func</span>&nbsp;<span class="op" id="4178450">(</span><span class="ident" id="4178451">d</span>&nbsp;<span class="op" id="4178453">*</span><span class="ident" id="4178454">digest</span><span class="op" id="4178460">)</span>&nbsp;<span class="ident" id="4178462">Sum</span><span class="op" id="4178465">(</span><span class="ident" id="4178466">in</span>&nbsp;<span class="op" id="4178469">[</span><span class="op" id="4178470">]</span><span class="builtintype" id="4178471">byte</span><span class="op" id="4178475">)</span>&nbsp;<span class="op" id="4178477">[</span><span class="op" id="4178478">]</span><span class="builtintype" id="4178479">byte</span>&nbsp;<span class="op" id="4178484">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4178487">s</span>&nbsp;<span class="op" id="4178489">:=</span>&nbsp;<span class="ident" id="4178492">d</span><span class="op" id="4178493">.</span><span class="ident" id="4178494">Sum32</span><span class="op" id="4178499">(</span><span class="op" id="4178500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4178503">return</span>&nbsp;<span class="builtinfunc" id="4178510">append</span><span class="op" id="4178516">(</span><span class="ident" id="4178517">in</span><span class="op" id="4178519">,</span>&nbsp;<span class="builtintype" id="4178521">byte</span><span class="op" id="4178525">(</span><span class="ident" id="4178526">s</span><span class="op" id="4178527">&gt;&gt;</span><span class="num" id="4178529">24</span><span class="op" id="4178531">)</span><span class="op" id="4178532">,</span>&nbsp;<span class="builtintype" id="4178534">byte</span><span class="op" id="4178538">(</span><span class="ident" id="4178539">s</span><span class="op" id="4178540">&gt;&gt;</span><span class="num" id="4178542">16</span><span class="op" id="4178544">)</span><span class="op" id="4178545">,</span>&nbsp;<span class="builtintype" id="4178547">byte</span><span class="op" id="4178551">(</span><span class="ident" id="4178552">s</span><span class="op" id="4178553">&gt;&gt;</span><span class="num" id="4178555">8</span><span class="op" id="4178556">)</span><span class="op" id="4178557">,</span>&nbsp;<span class="builtintype" id="4178559">byte</span><span class="op" id="4178563">(</span><span class="ident" id="4178564">s</span><span class="op" id="4178565">)</span><span class="op" id="4178566">)</span><br>
<span class="lineno"></span><span class="op" id="4178568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4178571">//&nbsp;Checksum&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno">130</span><span class="comment" id="4178619">//&nbsp;using&nbsp;the&nbsp;polynomial&nbsp;represented&nbsp;by&nbsp;the&nbsp;Table.</span><br>
<span class="lineno"></span><span class="keyword" id="4178669">func</span>&nbsp;<span class="ident" id="4178674">Checksum</span><span class="op" id="4178682">(</span><span class="ident" id="4178683">data</span>&nbsp;<span class="op" id="4178688">[</span><span class="op" id="4178689">]</span><span class="builtintype" id="4178690">byte</span><span class="op" id="4178694">,</span>&nbsp;<span class="ident" id="4178696">tab</span>&nbsp;<span class="op" id="4178700">*</span><span class="ident" id="4178701">Table</span><span class="op" id="4178706">)</span>&nbsp;<span class="builtintype" id="4178708">uint32</span>&nbsp;<span class="op" id="4178715">{</span>&nbsp;<span class="keyword" id="4178717">return</span>&nbsp;<span class="ident" id="4178724">Update</span><span class="op" id="4178730">(</span><span class="num" id="4178731">0</span><span class="op" id="4178732">,</span>&nbsp;<span class="ident" id="4178734">tab</span><span class="op" id="4178737">,</span>&nbsp;<span class="ident" id="4178739">data</span><span class="op" id="4178743">)</span>&nbsp;<span class="op" id="4178745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4178748">//&nbsp;ChecksumIEEE&nbsp;returns&nbsp;the&nbsp;CRC-32&nbsp;checksum&nbsp;of&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4178800">//&nbsp;using&nbsp;the&nbsp;IEEE&nbsp;polynomial.</span><br>
<span class="lineno">135</span><span class="keyword" id="4178830">func</span>&nbsp;<span class="ident" id="4178835">ChecksumIEEE</span><span class="op" id="4178847">(</span><span class="ident" id="4178848">data</span>&nbsp;<span class="op" id="4178853">[</span><span class="op" id="4178854">]</span><span class="builtintype" id="4178855">byte</span><span class="op" id="4178859">)</span>&nbsp;<span class="builtintype" id="4178861">uint32</span>&nbsp;<span class="op" id="4178868">{</span>&nbsp;<span class="keyword" id="4178870">return</span>&nbsp;<span class="ident" id="4178877">update</span><span class="op" id="4178883">(</span><span class="num" id="4178884">0</span><span class="op" id="4178885">,</span>&nbsp;<span class="ident" id="4178887">IEEETable</span><span class="op" id="4178896">,</span>&nbsp;<span class="ident" id="4178898">data</span><span class="op" id="4178902">)</span>&nbsp;<span class="op" id="4178904">}</span>
</div>
</body>
</html>
