<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8529970">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8530025">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8530079">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8530130">package</span>&nbsp;<span class="ident" id="8530138">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8530143">import</span>&nbsp;<span class="op" id="8530150">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530153">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530162">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530169">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530178">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530193">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8530206">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8530216">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8530219">func</span>&nbsp;<span class="ident" id="8530224">diff</span><span class="op" id="8530228">(</span><span class="ident" id="8530229">m0</span><span class="op" id="8530231">,</span>&nbsp;<span class="ident" id="8530233">m1</span>&nbsp;<span class="ident" id="8530236">image</span><span class="op" id="8530241">.</span><span class="ident" id="8530242">Image</span><span class="op" id="8530247">)</span>&nbsp;<span class="builtintype" id="8530249">error</span>&nbsp;<span class="op" id="8530255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530258">b0</span><span class="op" id="8530260">,</span>&nbsp;<span class="ident" id="8530262">b1</span>&nbsp;<span class="op" id="8530265">:=</span>&nbsp;<span class="ident" id="8530268">m0</span><span class="op" id="8530270">.</span><span class="ident" id="8530271">Bounds</span><span class="op" id="8530277">(</span><span class="op" id="8530278">)</span><span class="op" id="8530279">,</span>&nbsp;<span class="ident" id="8530281">m1</span><span class="op" id="8530283">.</span><span class="ident" id="8530284">Bounds</span><span class="op" id="8530290">(</span><span class="op" id="8530291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530294">if</span>&nbsp;<span class="op" id="8530297">!</span><span class="ident" id="8530298">b0</span><span class="op" id="8530300">.</span><span class="ident" id="8530301">Size</span><span class="op" id="8530305">(</span><span class="op" id="8530306">)</span><span class="op" id="8530307">.</span><span class="ident" id="8530308">Eq</span><span class="op" id="8530310">(</span><span class="ident" id="8530311">b1</span><span class="op" id="8530313">.</span><span class="ident" id="8530314">Size</span><span class="op" id="8530318">(</span><span class="op" id="8530319">)</span><span class="op" id="8530320">)</span>&nbsp;<span class="op" id="8530322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530326">return</span>&nbsp;<span class="ident" id="8530333">fmt</span><span class="op" id="8530336">.</span><span class="ident" id="8530337">Errorf</span><span class="op" id="8530343">(</span><span class="string" id="8530344">&#34;dimensions&nbsp;differ:&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="8530373">,</span>&nbsp;<span class="ident" id="8530375">b0</span><span class="op" id="8530377">,</span>&nbsp;<span class="ident" id="8530379">b1</span><span class="op" id="8530381">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530387">dx</span>&nbsp;<span class="op" id="8530390">:=</span>&nbsp;<span class="ident" id="8530393">b1</span><span class="op" id="8530395">.</span><span class="ident" id="8530396">Min</span><span class="op" id="8530399">.</span><span class="ident" id="8530400">X</span>&nbsp;<span class="op" id="8530402">-</span>&nbsp;<span class="ident" id="8530404">b0</span><span class="op" id="8530406">.</span><span class="ident" id="8530407">Min</span><span class="op" id="8530410">.</span><span class="ident" id="8530411">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530414">dy</span>&nbsp;<span class="op" id="8530417">:=</span>&nbsp;<span class="ident" id="8530420">b1</span><span class="op" id="8530422">.</span><span class="ident" id="8530423">Min</span><span class="op" id="8530426">.</span><span class="ident" id="8530427">Y</span>&nbsp;<span class="op" id="8530429">-</span>&nbsp;<span class="ident" id="8530431">b0</span><span class="op" id="8530433">.</span><span class="ident" id="8530434">Min</span><span class="op" id="8530437">.</span><span class="ident" id="8530438">Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530441">for</span>&nbsp;<span class="ident" id="8530445">y</span>&nbsp;<span class="op" id="8530447">:=</span>&nbsp;<span class="ident" id="8530450">b0</span><span class="op" id="8530452">.</span><span class="ident" id="8530453">Min</span><span class="op" id="8530456">.</span><span class="ident" id="8530457">Y</span><span class="op" id="8530458">;</span>&nbsp;<span class="ident" id="8530460">y</span>&nbsp;<span class="op" id="8530462">&lt;</span>&nbsp;<span class="ident" id="8530464">b0</span><span class="op" id="8530466">.</span><span class="ident" id="8530467">Max</span><span class="op" id="8530470">.</span><span class="ident" id="8530471">Y</span><span class="op" id="8530472">;</span>&nbsp;<span class="ident" id="8530474">y</span><span class="op" id="8530475">++</span>&nbsp;<span class="op" id="8530478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530482">for</span>&nbsp;<span class="ident" id="8530486">x</span>&nbsp;<span class="op" id="8530488">:=</span>&nbsp;<span class="ident" id="8530491">b0</span><span class="op" id="8530493">.</span><span class="ident" id="8530494">Min</span><span class="op" id="8530497">.</span><span class="ident" id="8530498">X</span><span class="op" id="8530499">;</span>&nbsp;<span class="ident" id="8530501">x</span>&nbsp;<span class="op" id="8530503">&lt;</span>&nbsp;<span class="ident" id="8530505">b0</span><span class="op" id="8530507">.</span><span class="ident" id="8530508">Max</span><span class="op" id="8530511">.</span><span class="ident" id="8530512">X</span><span class="op" id="8530513">;</span>&nbsp;<span class="ident" id="8530515">x</span><span class="op" id="8530516">++</span>&nbsp;<span class="op" id="8530519">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530524">c0</span>&nbsp;<span class="op" id="8530527">:=</span>&nbsp;<span class="ident" id="8530530">m0</span><span class="op" id="8530532">.</span><span class="ident" id="8530533">At</span><span class="op" id="8530535">(</span><span class="ident" id="8530536">x</span><span class="op" id="8530537">,</span>&nbsp;<span class="ident" id="8530539">y</span><span class="op" id="8530540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530545">c1</span>&nbsp;<span class="op" id="8530548">:=</span>&nbsp;<span class="ident" id="8530551">m1</span><span class="op" id="8530553">.</span><span class="ident" id="8530554">At</span><span class="op" id="8530556">(</span><span class="ident" id="8530557">x</span><span class="op" id="8530558">+</span><span class="ident" id="8530559">dx</span><span class="op" id="8530561">,</span>&nbsp;<span class="ident" id="8530563">y</span><span class="op" id="8530564">+</span><span class="ident" id="8530565">dy</span><span class="op" id="8530567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530572">r0</span><span class="op" id="8530574">,</span>&nbsp;<span class="ident" id="8530576">g0</span><span class="op" id="8530578">,</span>&nbsp;<span class="ident" id="8530580">b0</span><span class="op" id="8530582">,</span>&nbsp;<span class="ident" id="8530584">a0</span>&nbsp;<span class="op" id="8530587">:=</span>&nbsp;<span class="ident" id="8530590">c0</span><span class="op" id="8530592">.</span><span class="ident" id="8530593">RGBA</span><span class="op" id="8530597">(</span><span class="op" id="8530598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530603">r1</span><span class="op" id="8530605">,</span>&nbsp;<span class="ident" id="8530607">g1</span><span class="op" id="8530609">,</span>&nbsp;<span class="ident" id="8530611">b1</span><span class="op" id="8530613">,</span>&nbsp;<span class="ident" id="8530615">a1</span>&nbsp;<span class="op" id="8530618">:=</span>&nbsp;<span class="ident" id="8530621">c1</span><span class="op" id="8530623">.</span><span class="ident" id="8530624">RGBA</span><span class="op" id="8530628">(</span><span class="op" id="8530629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530634">if</span>&nbsp;<span class="ident" id="8530637">r0</span>&nbsp;<span class="op" id="8530640">!=</span>&nbsp;<span class="ident" id="8530643">r1</span>&nbsp;<span class="op" id="8530646">||</span>&nbsp;<span class="ident" id="8530649">g0</span>&nbsp;<span class="op" id="8530652">!=</span>&nbsp;<span class="ident" id="8530655">g1</span>&nbsp;<span class="op" id="8530658">||</span>&nbsp;<span class="ident" id="8530661">b0</span>&nbsp;<span class="op" id="8530664">!=</span>&nbsp;<span class="ident" id="8530667">b1</span>&nbsp;<span class="op" id="8530670">||</span>&nbsp;<span class="ident" id="8530673">a0</span>&nbsp;<span class="op" id="8530676">!=</span>&nbsp;<span class="ident" id="8530679">a1</span>&nbsp;<span class="op" id="8530682">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530688">return</span>&nbsp;<span class="ident" id="8530695">fmt</span><span class="op" id="8530698">.</span><span class="ident" id="8530699">Errorf</span><span class="op" id="8530705">(</span><span class="string" id="8530706">&#34;colors&nbsp;differ&nbsp;at&nbsp;(%d,&nbsp;%d):&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="8530743">,</span>&nbsp;<span class="ident" id="8530745">x</span><span class="op" id="8530746">,</span>&nbsp;<span class="ident" id="8530748">y</span><span class="op" id="8530749">,</span>&nbsp;<span class="ident" id="8530751">c0</span><span class="op" id="8530753">,</span>&nbsp;<span class="ident" id="8530755">c1</span><span class="op" id="8530757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530772">return</span>&nbsp;<span class="builtintype" id="8530779">nil</span><br>
<span class="lineno">35</span><span class="op" id="8530783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8530786">func</span>&nbsp;<span class="ident" id="8530791">encodeDecode</span><span class="op" id="8530803">(</span><span class="ident" id="8530804">m</span>&nbsp;<span class="ident" id="8530806">image</span><span class="op" id="8530811">.</span><span class="ident" id="8530812">Image</span><span class="op" id="8530817">)</span>&nbsp;<span class="op" id="8530819">(</span><span class="ident" id="8530820">image</span><span class="op" id="8530825">.</span><span class="ident" id="8530826">Image</span><span class="op" id="8530831">,</span>&nbsp;<span class="builtintype" id="8530833">error</span><span class="op" id="8530838">)</span>&nbsp;<span class="op" id="8530840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530843">var</span>&nbsp;<span class="ident" id="8530847">b</span>&nbsp;<span class="ident" id="8530849">bytes</span><span class="op" id="8530854">.</span><span class="ident" id="8530855">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8530863">err</span>&nbsp;<span class="op" id="8530867">:=</span>&nbsp;<span class="ident" id="8530870">Encode</span><span class="op" id="8530876">(</span><span class="op" id="8530877">&amp;</span><span class="ident" id="8530878">b</span><span class="op" id="8530879">,</span>&nbsp;<span class="ident" id="8530881">m</span><span class="op" id="8530882">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530885">if</span>&nbsp;<span class="ident" id="8530888">err</span>&nbsp;<span class="op" id="8530892">!=</span>&nbsp;<span class="builtintype" id="8530895">nil</span>&nbsp;<span class="op" id="8530899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530903">return</span>&nbsp;<span class="builtintype" id="8530910">nil</span><span class="op" id="8530913">,</span>&nbsp;<span class="ident" id="8530915">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8530920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8530923">return</span>&nbsp;<span class="ident" id="8530930">Decode</span><span class="op" id="8530936">(</span><span class="op" id="8530937">&amp;</span><span class="ident" id="8530938">b</span><span class="op" id="8530939">)</span><br>
<span class="lineno"></span><span class="op" id="8530941">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8530944">func</span>&nbsp;<span class="ident" id="8530949">TestWriter</span><span class="op" id="8530959">(</span><span class="ident" id="8530960">t</span>&nbsp;<span class="op" id="8530962">*</span><span class="ident" id="8530963">testing</span><span class="op" id="8530970">.</span><span class="ident" id="8530971">T</span><span class="op" id="8530972">)</span>&nbsp;<span class="op" id="8530974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8530977">//&nbsp;The&nbsp;filenames&nbsp;variable&nbsp;is&nbsp;declared&nbsp;in&nbsp;reader_test.go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531035">names</span>&nbsp;<span class="op" id="8531041">:=</span>&nbsp;<span class="ident" id="8531044">filenames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531055">if</span>&nbsp;<span class="ident" id="8531058">testing</span><span class="op" id="8531065">.</span><span class="ident" id="8531066">Short</span><span class="op" id="8531071">(</span><span class="op" id="8531072">)</span>&nbsp;<span class="op" id="8531074">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531078">names</span>&nbsp;<span class="op" id="8531084">=</span>&nbsp;<span class="ident" id="8531086">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531105">for</span>&nbsp;<span class="ident" id="8531109">_</span><span class="op" id="8531110">,</span>&nbsp;<span class="ident" id="8531112">fn</span>&nbsp;<span class="op" id="8531115">:=</span>&nbsp;<span class="keyword" id="8531118">range</span>&nbsp;<span class="ident" id="8531124">names</span>&nbsp;<span class="op" id="8531130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531134">qfn</span>&nbsp;<span class="op" id="8531138">:=</span>&nbsp;<span class="string" id="8531141">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="8531162">+</span>&nbsp;<span class="ident" id="8531164">fn</span>&nbsp;<span class="op" id="8531167">+</span>&nbsp;<span class="string" id="8531169">&#34;.png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8531178">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531199">m0</span><span class="op" id="8531201">,</span>&nbsp;<span class="ident" id="8531203">err</span>&nbsp;<span class="op" id="8531207">:=</span>&nbsp;<span class="ident" id="8531210">readPNG</span><span class="op" id="8531217">(</span><span class="ident" id="8531218">qfn</span><span class="op" id="8531221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531225">if</span>&nbsp;<span class="ident" id="8531228">err</span>&nbsp;<span class="op" id="8531232">!=</span>&nbsp;<span class="builtintype" id="8531235">nil</span>&nbsp;<span class="op" id="8531239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531244">t</span><span class="op" id="8531245">.</span><span class="ident" id="8531246">Error</span><span class="op" id="8531251">(</span><span class="ident" id="8531252">fn</span><span class="op" id="8531254">,</span>&nbsp;<span class="ident" id="8531256">err</span><span class="op" id="8531259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531264">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531275">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8531279">//&nbsp;Read&nbsp;the&nbsp;image&nbsp;again,&nbsp;encode&nbsp;it,&nbsp;and&nbsp;decode&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531332">m1</span><span class="op" id="8531334">,</span>&nbsp;<span class="ident" id="8531336">err</span>&nbsp;<span class="op" id="8531340">:=</span>&nbsp;<span class="ident" id="8531343">readPNG</span><span class="op" id="8531350">(</span><span class="ident" id="8531351">qfn</span><span class="op" id="8531354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531358">if</span>&nbsp;<span class="ident" id="8531361">err</span>&nbsp;<span class="op" id="8531365">!=</span>&nbsp;<span class="builtintype" id="8531368">nil</span>&nbsp;<span class="op" id="8531372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531377">t</span><span class="op" id="8531378">.</span><span class="ident" id="8531379">Error</span><span class="op" id="8531384">(</span><span class="ident" id="8531385">fn</span><span class="op" id="8531387">,</span>&nbsp;<span class="ident" id="8531389">err</span><span class="op" id="8531392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531397">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531410">m2</span><span class="op" id="8531412">,</span>&nbsp;<span class="ident" id="8531414">err</span>&nbsp;<span class="op" id="8531418">:=</span>&nbsp;<span class="ident" id="8531421">encodeDecode</span><span class="op" id="8531433">(</span><span class="ident" id="8531434">m1</span><span class="op" id="8531436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531440">if</span>&nbsp;<span class="ident" id="8531443">err</span>&nbsp;<span class="op" id="8531447">!=</span>&nbsp;<span class="builtintype" id="8531450">nil</span>&nbsp;<span class="op" id="8531454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531459">t</span><span class="op" id="8531460">.</span><span class="ident" id="8531461">Error</span><span class="op" id="8531466">(</span><span class="ident" id="8531467">fn</span><span class="op" id="8531469">,</span>&nbsp;<span class="ident" id="8531471">err</span><span class="op" id="8531474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531479">return</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8531492">//&nbsp;Compare&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531514">err</span>&nbsp;<span class="op" id="8531518">=</span>&nbsp;<span class="ident" id="8531520">diff</span><span class="op" id="8531524">(</span><span class="ident" id="8531525">m0</span><span class="op" id="8531527">,</span>&nbsp;<span class="ident" id="8531529">m2</span><span class="op" id="8531531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531535">if</span>&nbsp;<span class="ident" id="8531538">err</span>&nbsp;<span class="op" id="8531542">!=</span>&nbsp;<span class="builtintype" id="8531545">nil</span>&nbsp;<span class="op" id="8531549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531554">t</span><span class="op" id="8531555">.</span><span class="ident" id="8531556">Error</span><span class="op" id="8531561">(</span><span class="ident" id="8531562">fn</span><span class="op" id="8531564">,</span>&nbsp;<span class="ident" id="8531566">err</span><span class="op" id="8531569">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531574">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531588">}</span><br>
<span class="lineno"></span><span class="op" id="8531590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8531593">func</span>&nbsp;<span class="ident" id="8531598">TestWriterLevels</span><span class="op" id="8531614">(</span><span class="ident" id="8531615">t</span>&nbsp;<span class="op" id="8531617">*</span><span class="ident" id="8531618">testing</span><span class="op" id="8531625">.</span><span class="ident" id="8531626">T</span><span class="op" id="8531627">)</span>&nbsp;<span class="op" id="8531629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531632">m</span>&nbsp;<span class="op" id="8531634">:=</span>&nbsp;<span class="ident" id="8531637">image</span><span class="op" id="8531642">.</span><span class="ident" id="8531643">NewNRGBA</span><span class="op" id="8531651">(</span><span class="ident" id="8531652">image</span><span class="op" id="8531657">.</span><span class="ident" id="8531658">Rect</span><span class="op" id="8531662">(</span><span class="num" id="8531663">0</span><span class="op" id="8531664">,</span>&nbsp;<span class="num" id="8531666">0</span><span class="op" id="8531667">,</span>&nbsp;<span class="num" id="8531669">100</span><span class="op" id="8531672">,</span>&nbsp;<span class="num" id="8531674">100</span><span class="op" id="8531677">)</span><span class="op" id="8531678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531682">var</span>&nbsp;<span class="ident" id="8531686">b1</span><span class="op" id="8531688">,</span>&nbsp;<span class="ident" id="8531690">b2</span>&nbsp;<span class="ident" id="8531693">bytes</span><span class="op" id="8531698">.</span><span class="ident" id="8531699">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531707">if</span>&nbsp;<span class="ident" id="8531710">err</span>&nbsp;<span class="op" id="8531714">:=</span>&nbsp;<span class="op" id="8531717">(</span><span class="op" id="8531718">&amp;</span><span class="ident" id="8531719">Encoder</span><span class="op" id="8531726">{</span><span class="op" id="8531727">}</span><span class="op" id="8531728">)</span><span class="op" id="8531729">.</span><span class="ident" id="8531730">Encode</span><span class="op" id="8531736">(</span><span class="op" id="8531737">&amp;</span><span class="ident" id="8531738">b1</span><span class="op" id="8531740">,</span>&nbsp;<span class="ident" id="8531742">m</span><span class="op" id="8531743">)</span><span class="op" id="8531744">;</span>&nbsp;<span class="ident" id="8531746">err</span>&nbsp;<span class="op" id="8531750">!=</span>&nbsp;<span class="builtintype" id="8531753">nil</span>&nbsp;<span class="op" id="8531757">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531761">t</span><span class="op" id="8531762">.</span><span class="ident" id="8531763">Fatal</span><span class="op" id="8531768">(</span><span class="ident" id="8531769">err</span><span class="op" id="8531772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531778">noenc</span>&nbsp;<span class="op" id="8531784">:=</span>&nbsp;<span class="op" id="8531787">&amp;</span><span class="ident" id="8531788">Encoder</span><span class="op" id="8531795">{</span><span class="ident" id="8531796">CompressionLevel</span><span class="op" id="8531812">:</span>&nbsp;<span class="ident" id="8531814">NoCompression</span><span class="op" id="8531827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531830">if</span>&nbsp;<span class="ident" id="8531833">err</span>&nbsp;<span class="op" id="8531837">:=</span>&nbsp;<span class="ident" id="8531840">noenc</span><span class="op" id="8531845">.</span><span class="ident" id="8531846">Encode</span><span class="op" id="8531852">(</span><span class="op" id="8531853">&amp;</span><span class="ident" id="8531854">b2</span><span class="op" id="8531856">,</span>&nbsp;<span class="ident" id="8531858">m</span><span class="op" id="8531859">)</span><span class="op" id="8531860">;</span>&nbsp;<span class="ident" id="8531862">err</span>&nbsp;<span class="op" id="8531866">!=</span>&nbsp;<span class="builtintype" id="8531869">nil</span>&nbsp;<span class="op" id="8531873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531877">t</span><span class="op" id="8531878">.</span><span class="ident" id="8531879">Fatal</span><span class="op" id="8531884">(</span><span class="ident" id="8531885">err</span><span class="op" id="8531888">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8531891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8531895">if</span>&nbsp;<span class="ident" id="8531898">b2</span><span class="op" id="8531900">.</span><span class="ident" id="8531901">Len</span><span class="op" id="8531904">(</span><span class="op" id="8531905">)</span>&nbsp;<span class="op" id="8531907">&lt;=</span>&nbsp;<span class="ident" id="8531910">b1</span><span class="op" id="8531912">.</span><span class="ident" id="8531913">Len</span><span class="op" id="8531916">(</span><span class="op" id="8531917">)</span>&nbsp;<span class="op" id="8531919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8531923">t</span><span class="op" id="8531924">.</span><span class="ident" id="8531925">Error</span><span class="op" id="8531930">(</span><span class="string" id="8531931">&#34;DefaultCompression&nbsp;encoding&nbsp;was&nbsp;larger&nbsp;than&nbsp;NoCompression&nbsp;encoding&#34;</span><span class="op" id="8531999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532002">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532005">if</span>&nbsp;<span class="ident" id="8532008">_</span><span class="op" id="8532009">,</span>&nbsp;<span class="ident" id="8532011">err</span>&nbsp;<span class="op" id="8532015">:=</span>&nbsp;<span class="ident" id="8532018">Decode</span><span class="op" id="8532024">(</span><span class="op" id="8532025">&amp;</span><span class="ident" id="8532026">b1</span><span class="op" id="8532028">)</span><span class="op" id="8532029">;</span>&nbsp;<span class="ident" id="8532031">err</span>&nbsp;<span class="op" id="8532035">!=</span>&nbsp;<span class="builtintype" id="8532038">nil</span>&nbsp;<span class="op" id="8532042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532046">t</span><span class="op" id="8532047">.</span><span class="ident" id="8532048">Error</span><span class="op" id="8532053">(</span><span class="string" id="8532054">&#34;cannot&nbsp;decode&nbsp;DefaultCompression&#34;</span><span class="op" id="8532088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532094">if</span>&nbsp;<span class="ident" id="8532097">_</span><span class="op" id="8532098">,</span>&nbsp;<span class="ident" id="8532100">err</span>&nbsp;<span class="op" id="8532104">:=</span>&nbsp;<span class="ident" id="8532107">Decode</span><span class="op" id="8532113">(</span><span class="op" id="8532114">&amp;</span><span class="ident" id="8532115">b2</span><span class="op" id="8532117">)</span><span class="op" id="8532118">;</span>&nbsp;<span class="ident" id="8532120">err</span>&nbsp;<span class="op" id="8532124">!=</span>&nbsp;<span class="builtintype" id="8532127">nil</span>&nbsp;<span class="op" id="8532131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532135">t</span><span class="op" id="8532136">.</span><span class="ident" id="8532137">Error</span><span class="op" id="8532142">(</span><span class="string" id="8532143">&#34;cannot&nbsp;decode&nbsp;NoCompression&#34;</span><span class="op" id="8532172">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532175">}</span><br>
<span class="lineno"></span><span class="op" id="8532177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8532180">func</span>&nbsp;<span class="ident" id="8532185">TestSubImage</span><span class="op" id="8532197">(</span><span class="ident" id="8532198">t</span>&nbsp;<span class="op" id="8532200">*</span><span class="ident" id="8532201">testing</span><span class="op" id="8532208">.</span><span class="ident" id="8532209">T</span><span class="op" id="8532210">)</span>&nbsp;<span class="op" id="8532212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532215">m0</span>&nbsp;<span class="op" id="8532218">:=</span>&nbsp;<span class="ident" id="8532221">image</span><span class="op" id="8532226">.</span><span class="ident" id="8532227">NewRGBA</span><span class="op" id="8532234">(</span><span class="ident" id="8532235">image</span><span class="op" id="8532240">.</span><span class="ident" id="8532241">Rect</span><span class="op" id="8532245">(</span><span class="num" id="8532246">0</span><span class="op" id="8532247">,</span>&nbsp;<span class="num" id="8532249">0</span><span class="op" id="8532250">,</span>&nbsp;<span class="num" id="8532252">256</span><span class="op" id="8532255">,</span>&nbsp;<span class="num" id="8532257">256</span><span class="op" id="8532260">)</span><span class="op" id="8532261">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532264">for</span>&nbsp;<span class="ident" id="8532268">y</span>&nbsp;<span class="op" id="8532270">:=</span>&nbsp;<span class="num" id="8532273">0</span><span class="op" id="8532274">;</span>&nbsp;<span class="ident" id="8532276">y</span>&nbsp;<span class="op" id="8532278">&lt;</span>&nbsp;<span class="num" id="8532280">256</span><span class="op" id="8532283">;</span>&nbsp;<span class="ident" id="8532285">y</span><span class="op" id="8532286">++</span>&nbsp;<span class="op" id="8532289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532293">for</span>&nbsp;<span class="ident" id="8532297">x</span>&nbsp;<span class="op" id="8532299">:=</span>&nbsp;<span class="num" id="8532302">0</span><span class="op" id="8532303">;</span>&nbsp;<span class="ident" id="8532305">x</span>&nbsp;<span class="op" id="8532307">&lt;</span>&nbsp;<span class="num" id="8532309">256</span><span class="op" id="8532312">;</span>&nbsp;<span class="ident" id="8532314">x</span><span class="op" id="8532315">++</span>&nbsp;<span class="op" id="8532318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532323">m0</span><span class="op" id="8532325">.</span><span class="ident" id="8532326">Set</span><span class="op" id="8532329">(</span><span class="ident" id="8532330">x</span><span class="op" id="8532331">,</span>&nbsp;<span class="ident" id="8532333">y</span><span class="op" id="8532334">,</span>&nbsp;<span class="ident" id="8532336">color</span><span class="op" id="8532341">.</span><span class="ident" id="8532342">RGBA</span><span class="op" id="8532346">{</span><span class="builtintype" id="8532347">uint8</span><span class="op" id="8532352">(</span><span class="ident" id="8532353">x</span><span class="op" id="8532354">)</span><span class="op" id="8532355">,</span>&nbsp;<span class="builtintype" id="8532357">uint8</span><span class="op" id="8532362">(</span><span class="ident" id="8532363">y</span><span class="op" id="8532364">)</span><span class="op" id="8532365">,</span>&nbsp;<span class="num" id="8532367">0</span><span class="op" id="8532368">,</span>&nbsp;<span class="num" id="8532370">255</span><span class="op" id="8532373">}</span><span class="op" id="8532374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532381">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532384">m0</span>&nbsp;<span class="op" id="8532387">=</span>&nbsp;<span class="ident" id="8532389">m0</span><span class="op" id="8532391">.</span><span class="ident" id="8532392">SubImage</span><span class="op" id="8532400">(</span><span class="ident" id="8532401">image</span><span class="op" id="8532406">.</span><span class="ident" id="8532407">Rect</span><span class="op" id="8532411">(</span><span class="num" id="8532412">50</span><span class="op" id="8532414">,</span>&nbsp;<span class="num" id="8532416">30</span><span class="op" id="8532418">,</span>&nbsp;<span class="num" id="8532420">250</span><span class="op" id="8532423">,</span>&nbsp;<span class="num" id="8532425">130</span><span class="op" id="8532428">)</span><span class="op" id="8532429">)</span><span class="op" id="8532430">.</span><span class="op" id="8532431">(</span><span class="op" id="8532432">*</span><span class="ident" id="8532433">image</span><span class="op" id="8532438">.</span><span class="ident" id="8532439">RGBA</span><span class="op" id="8532443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532446">m1</span><span class="op" id="8532448">,</span>&nbsp;<span class="ident" id="8532450">err</span>&nbsp;<span class="op" id="8532454">:=</span>&nbsp;<span class="ident" id="8532457">encodeDecode</span><span class="op" id="8532469">(</span><span class="ident" id="8532470">m0</span><span class="op" id="8532472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532475">if</span>&nbsp;<span class="ident" id="8532478">err</span>&nbsp;<span class="op" id="8532482">!=</span>&nbsp;<span class="builtintype" id="8532485">nil</span>&nbsp;<span class="op" id="8532489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532493">t</span><span class="op" id="8532494">.</span><span class="ident" id="8532495">Error</span><span class="op" id="8532500">(</span><span class="ident" id="8532501">err</span><span class="op" id="8532504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532508">return</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532519">err</span>&nbsp;<span class="op" id="8532523">=</span>&nbsp;<span class="ident" id="8532525">diff</span><span class="op" id="8532529">(</span><span class="ident" id="8532530">m0</span><span class="op" id="8532532">,</span>&nbsp;<span class="ident" id="8532534">m1</span><span class="op" id="8532536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532539">if</span>&nbsp;<span class="ident" id="8532542">err</span>&nbsp;<span class="op" id="8532546">!=</span>&nbsp;<span class="builtintype" id="8532549">nil</span>&nbsp;<span class="op" id="8532553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532557">t</span><span class="op" id="8532558">.</span><span class="ident" id="8532559">Error</span><span class="op" id="8532564">(</span><span class="ident" id="8532565">err</span><span class="op" id="8532568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532572">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532580">}</span><br>
<span class="lineno"></span><span class="op" id="8532582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8532585">func</span>&nbsp;<span class="ident" id="8532590">BenchmarkEncodeGray</span><span class="op" id="8532609">(</span><span class="ident" id="8532610">b</span>&nbsp;<span class="op" id="8532612">*</span><span class="ident" id="8532613">testing</span><span class="op" id="8532620">.</span><span class="ident" id="8532621">B</span><span class="op" id="8532622">)</span>&nbsp;<span class="op" id="8532624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532627">b</span><span class="op" id="8532628">.</span><span class="ident" id="8532629">StopTimer</span><span class="op" id="8532638">(</span><span class="op" id="8532639">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532642">img</span>&nbsp;<span class="op" id="8532646">:=</span>&nbsp;<span class="ident" id="8532649">image</span><span class="op" id="8532654">.</span><span class="ident" id="8532655">NewGray</span><span class="op" id="8532662">(</span><span class="ident" id="8532663">image</span><span class="op" id="8532668">.</span><span class="ident" id="8532669">Rect</span><span class="op" id="8532673">(</span><span class="num" id="8532674">0</span><span class="op" id="8532675">,</span>&nbsp;<span class="num" id="8532677">0</span><span class="op" id="8532678">,</span>&nbsp;<span class="num" id="8532680">640</span><span class="op" id="8532683">,</span>&nbsp;<span class="num" id="8532685">480</span><span class="op" id="8532688">)</span><span class="op" id="8532689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532692">b</span><span class="op" id="8532693">.</span><span class="ident" id="8532694">SetBytes</span><span class="op" id="8532702">(</span><span class="num" id="8532703">640</span>&nbsp;<span class="op" id="8532707">*</span>&nbsp;<span class="num" id="8532709">480</span>&nbsp;<span class="op" id="8532713">*</span>&nbsp;<span class="num" id="8532715">1</span><span class="op" id="8532716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532719">b</span><span class="op" id="8532720">.</span><span class="ident" id="8532721">StartTimer</span><span class="op" id="8532731">(</span><span class="op" id="8532732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532735">for</span>&nbsp;<span class="ident" id="8532739">i</span>&nbsp;<span class="op" id="8532741">:=</span>&nbsp;<span class="num" id="8532744">0</span><span class="op" id="8532745">;</span>&nbsp;<span class="ident" id="8532747">i</span>&nbsp;<span class="op" id="8532749">&lt;</span>&nbsp;<span class="ident" id="8532751">b</span><span class="op" id="8532752">.</span><span class="ident" id="8532753">N</span><span class="op" id="8532754">;</span>&nbsp;<span class="ident" id="8532756">i</span><span class="op" id="8532757">++</span>&nbsp;<span class="op" id="8532760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532764">Encode</span><span class="op" id="8532770">(</span><span class="ident" id="8532771">ioutil</span><span class="op" id="8532777">.</span><span class="ident" id="8532778">Discard</span><span class="op" id="8532785">,</span>&nbsp;<span class="ident" id="8532787">img</span><span class="op" id="8532790">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8532793">}</span><br>
<span class="lineno"></span><span class="op" id="8532795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8532798">func</span>&nbsp;<span class="ident" id="8532803">BenchmarkEncodeNRGBOpaque</span><span class="op" id="8532828">(</span><span class="ident" id="8532829">b</span>&nbsp;<span class="op" id="8532831">*</span><span class="ident" id="8532832">testing</span><span class="op" id="8532839">.</span><span class="ident" id="8532840">B</span><span class="op" id="8532841">)</span>&nbsp;<span class="op" id="8532843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532846">b</span><span class="op" id="8532847">.</span><span class="ident" id="8532848">StopTimer</span><span class="op" id="8532857">(</span><span class="op" id="8532858">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532861">img</span>&nbsp;<span class="op" id="8532865">:=</span>&nbsp;<span class="ident" id="8532868">image</span><span class="op" id="8532873">.</span><span class="ident" id="8532874">NewNRGBA</span><span class="op" id="8532882">(</span><span class="ident" id="8532883">image</span><span class="op" id="8532888">.</span><span class="ident" id="8532889">Rect</span><span class="op" id="8532893">(</span><span class="num" id="8532894">0</span><span class="op" id="8532895">,</span>&nbsp;<span class="num" id="8532897">0</span><span class="op" id="8532898">,</span>&nbsp;<span class="num" id="8532900">640</span><span class="op" id="8532903">,</span>&nbsp;<span class="num" id="8532905">480</span><span class="op" id="8532908">)</span><span class="op" id="8532909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8532912">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8532967">bo</span>&nbsp;<span class="op" id="8532970">:=</span>&nbsp;<span class="ident" id="8532973">img</span><span class="op" id="8532976">.</span><span class="ident" id="8532977">Bounds</span><span class="op" id="8532983">(</span><span class="op" id="8532984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8532987">for</span>&nbsp;<span class="ident" id="8532991">y</span>&nbsp;<span class="op" id="8532993">:=</span>&nbsp;<span class="ident" id="8532996">bo</span><span class="op" id="8532998">.</span><span class="ident" id="8532999">Min</span><span class="op" id="8533002">.</span><span class="ident" id="8533003">Y</span><span class="op" id="8533004">;</span>&nbsp;<span class="ident" id="8533006">y</span>&nbsp;<span class="op" id="8533008">&lt;</span>&nbsp;<span class="ident" id="8533010">bo</span><span class="op" id="8533012">.</span><span class="ident" id="8533013">Max</span><span class="op" id="8533016">.</span><span class="ident" id="8533017">Y</span><span class="op" id="8533018">;</span>&nbsp;<span class="ident" id="8533020">y</span><span class="op" id="8533021">++</span>&nbsp;<span class="op" id="8533024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533028">for</span>&nbsp;<span class="ident" id="8533032">x</span>&nbsp;<span class="op" id="8533034">:=</span>&nbsp;<span class="ident" id="8533037">bo</span><span class="op" id="8533039">.</span><span class="ident" id="8533040">Min</span><span class="op" id="8533043">.</span><span class="ident" id="8533044">X</span><span class="op" id="8533045">;</span>&nbsp;<span class="ident" id="8533047">x</span>&nbsp;<span class="op" id="8533049">&lt;</span>&nbsp;<span class="ident" id="8533051">bo</span><span class="op" id="8533053">.</span><span class="ident" id="8533054">Max</span><span class="op" id="8533057">.</span><span class="ident" id="8533058">X</span><span class="op" id="8533059">;</span>&nbsp;<span class="ident" id="8533061">x</span><span class="op" id="8533062">++</span>&nbsp;<span class="op" id="8533065">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533070">img</span><span class="op" id="8533073">.</span><span class="ident" id="8533074">Set</span><span class="op" id="8533077">(</span><span class="ident" id="8533078">x</span><span class="op" id="8533079">,</span>&nbsp;<span class="ident" id="8533081">y</span><span class="op" id="8533082">,</span>&nbsp;<span class="ident" id="8533084">color</span><span class="op" id="8533089">.</span><span class="ident" id="8533090">NRGBA</span><span class="op" id="8533095">{</span><span class="num" id="8533096">0</span><span class="op" id="8533097">,</span>&nbsp;<span class="num" id="8533099">0</span><span class="op" id="8533100">,</span>&nbsp;<span class="num" id="8533102">0</span><span class="op" id="8533103">,</span>&nbsp;<span class="num" id="8533105">255</span><span class="op" id="8533108">}</span><span class="op" id="8533109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533119">if</span>&nbsp;<span class="op" id="8533122">!</span><span class="ident" id="8533123">img</span><span class="op" id="8533126">.</span><span class="ident" id="8533127">Opaque</span><span class="op" id="8533133">(</span><span class="op" id="8533134">)</span>&nbsp;<span class="op" id="8533136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533140">b</span><span class="op" id="8533141">.</span><span class="ident" id="8533142">Fatal</span><span class="op" id="8533147">(</span><span class="string" id="8533148">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="8533177">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533183">b</span><span class="op" id="8533184">.</span><span class="ident" id="8533185">SetBytes</span><span class="op" id="8533193">(</span><span class="num" id="8533194">640</span>&nbsp;<span class="op" id="8533198">*</span>&nbsp;<span class="num" id="8533200">480</span>&nbsp;<span class="op" id="8533204">*</span>&nbsp;<span class="num" id="8533206">4</span><span class="op" id="8533207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533210">b</span><span class="op" id="8533211">.</span><span class="ident" id="8533212">StartTimer</span><span class="op" id="8533222">(</span><span class="op" id="8533223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533226">for</span>&nbsp;<span class="ident" id="8533230">i</span>&nbsp;<span class="op" id="8533232">:=</span>&nbsp;<span class="num" id="8533235">0</span><span class="op" id="8533236">;</span>&nbsp;<span class="ident" id="8533238">i</span>&nbsp;<span class="op" id="8533240">&lt;</span>&nbsp;<span class="ident" id="8533242">b</span><span class="op" id="8533243">.</span><span class="ident" id="8533244">N</span><span class="op" id="8533245">;</span>&nbsp;<span class="ident" id="8533247">i</span><span class="op" id="8533248">++</span>&nbsp;<span class="op" id="8533251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533255">Encode</span><span class="op" id="8533261">(</span><span class="ident" id="8533262">ioutil</span><span class="op" id="8533268">.</span><span class="ident" id="8533269">Discard</span><span class="op" id="8533276">,</span>&nbsp;<span class="ident" id="8533278">img</span><span class="op" id="8533281">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533284">}</span><br>
<span class="lineno"></span><span class="op" id="8533286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8533289">func</span>&nbsp;<span class="ident" id="8533294">BenchmarkEncodeNRGBA</span><span class="op" id="8533314">(</span><span class="ident" id="8533315">b</span>&nbsp;<span class="op" id="8533317">*</span><span class="ident" id="8533318">testing</span><span class="op" id="8533325">.</span><span class="ident" id="8533326">B</span><span class="op" id="8533327">)</span>&nbsp;<span class="op" id="8533329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533332">b</span><span class="op" id="8533333">.</span><span class="ident" id="8533334">StopTimer</span><span class="op" id="8533343">(</span><span class="op" id="8533344">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533347">img</span>&nbsp;<span class="op" id="8533351">:=</span>&nbsp;<span class="ident" id="8533354">image</span><span class="op" id="8533359">.</span><span class="ident" id="8533360">NewNRGBA</span><span class="op" id="8533368">(</span><span class="ident" id="8533369">image</span><span class="op" id="8533374">.</span><span class="ident" id="8533375">Rect</span><span class="op" id="8533379">(</span><span class="num" id="8533380">0</span><span class="op" id="8533381">,</span>&nbsp;<span class="num" id="8533383">0</span><span class="op" id="8533384">,</span>&nbsp;<span class="num" id="8533386">640</span><span class="op" id="8533389">,</span>&nbsp;<span class="num" id="8533391">480</span><span class="op" id="8533394">)</span><span class="op" id="8533395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533398">if</span>&nbsp;<span class="ident" id="8533401">img</span><span class="op" id="8533404">.</span><span class="ident" id="8533405">Opaque</span><span class="op" id="8533411">(</span><span class="op" id="8533412">)</span>&nbsp;<span class="op" id="8533414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533418">b</span><span class="op" id="8533419">.</span><span class="ident" id="8533420">Fatal</span><span class="op" id="8533425">(</span><span class="string" id="8533426">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="8533459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533465">b</span><span class="op" id="8533466">.</span><span class="ident" id="8533467">SetBytes</span><span class="op" id="8533475">(</span><span class="num" id="8533476">640</span>&nbsp;<span class="op" id="8533480">*</span>&nbsp;<span class="num" id="8533482">480</span>&nbsp;<span class="op" id="8533486">*</span>&nbsp;<span class="num" id="8533488">4</span><span class="op" id="8533489">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533492">b</span><span class="op" id="8533493">.</span><span class="ident" id="8533494">StartTimer</span><span class="op" id="8533504">(</span><span class="op" id="8533505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533508">for</span>&nbsp;<span class="ident" id="8533512">i</span>&nbsp;<span class="op" id="8533514">:=</span>&nbsp;<span class="num" id="8533517">0</span><span class="op" id="8533518">;</span>&nbsp;<span class="ident" id="8533520">i</span>&nbsp;<span class="op" id="8533522">&lt;</span>&nbsp;<span class="ident" id="8533524">b</span><span class="op" id="8533525">.</span><span class="ident" id="8533526">N</span><span class="op" id="8533527">;</span>&nbsp;<span class="ident" id="8533529">i</span><span class="op" id="8533530">++</span>&nbsp;<span class="op" id="8533533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533537">Encode</span><span class="op" id="8533543">(</span><span class="ident" id="8533544">ioutil</span><span class="op" id="8533550">.</span><span class="ident" id="8533551">Discard</span><span class="op" id="8533558">,</span>&nbsp;<span class="ident" id="8533560">img</span><span class="op" id="8533563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533566">}</span><br>
<span class="lineno"></span><span class="op" id="8533568">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="8533571">func</span>&nbsp;<span class="ident" id="8533576">BenchmarkEncodePaletted</span><span class="op" id="8533599">(</span><span class="ident" id="8533600">b</span>&nbsp;<span class="op" id="8533602">*</span><span class="ident" id="8533603">testing</span><span class="op" id="8533610">.</span><span class="ident" id="8533611">B</span><span class="op" id="8533612">)</span>&nbsp;<span class="op" id="8533614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533617">b</span><span class="op" id="8533618">.</span><span class="ident" id="8533619">StopTimer</span><span class="op" id="8533628">(</span><span class="op" id="8533629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533632">img</span>&nbsp;<span class="op" id="8533636">:=</span>&nbsp;<span class="ident" id="8533639">image</span><span class="op" id="8533644">.</span><span class="ident" id="8533645">NewPaletted</span><span class="op" id="8533656">(</span><span class="ident" id="8533657">image</span><span class="op" id="8533662">.</span><span class="ident" id="8533663">Rect</span><span class="op" id="8533667">(</span><span class="num" id="8533668">0</span><span class="op" id="8533669">,</span>&nbsp;<span class="num" id="8533671">0</span><span class="op" id="8533672">,</span>&nbsp;<span class="num" id="8533674">640</span><span class="op" id="8533677">,</span>&nbsp;<span class="num" id="8533679">480</span><span class="op" id="8533682">)</span><span class="op" id="8533683">,</span>&nbsp;<span class="ident" id="8533685">color</span><span class="op" id="8533690">.</span><span class="ident" id="8533691">Palette</span><span class="op" id="8533698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533702">color</span><span class="op" id="8533707">.</span><span class="ident" id="8533708">RGBA</span><span class="op" id="8533712">{</span><span class="num" id="8533713">0</span><span class="op" id="8533714">,</span>&nbsp;<span class="num" id="8533716">0</span><span class="op" id="8533717">,</span>&nbsp;<span class="num" id="8533719">0</span><span class="op" id="8533720">,</span>&nbsp;<span class="num" id="8533722">255</span><span class="op" id="8533725">}</span><span class="op" id="8533726">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533730">color</span><span class="op" id="8533735">.</span><span class="ident" id="8533736">RGBA</span><span class="op" id="8533740">{</span><span class="num" id="8533741">255</span><span class="op" id="8533744">,</span>&nbsp;<span class="num" id="8533746">255</span><span class="op" id="8533749">,</span>&nbsp;<span class="num" id="8533751">255</span><span class="op" id="8533754">,</span>&nbsp;<span class="num" id="8533756">255</span><span class="op" id="8533759">}</span><span class="op" id="8533760">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533763">}</span><span class="op" id="8533764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533767">b</span><span class="op" id="8533768">.</span><span class="ident" id="8533769">SetBytes</span><span class="op" id="8533777">(</span><span class="num" id="8533778">640</span>&nbsp;<span class="op" id="8533782">*</span>&nbsp;<span class="num" id="8533784">480</span>&nbsp;<span class="op" id="8533788">*</span>&nbsp;<span class="num" id="8533790">1</span><span class="op" id="8533791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533794">b</span><span class="op" id="8533795">.</span><span class="ident" id="8533796">StartTimer</span><span class="op" id="8533806">(</span><span class="op" id="8533807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8533810">for</span>&nbsp;<span class="ident" id="8533814">i</span>&nbsp;<span class="op" id="8533816">:=</span>&nbsp;<span class="num" id="8533819">0</span><span class="op" id="8533820">;</span>&nbsp;<span class="ident" id="8533822">i</span>&nbsp;<span class="op" id="8533824">&lt;</span>&nbsp;<span class="ident" id="8533826">b</span><span class="op" id="8533827">.</span><span class="ident" id="8533828">N</span><span class="op" id="8533829">;</span>&nbsp;<span class="ident" id="8533831">i</span><span class="op" id="8533832">++</span>&nbsp;<span class="op" id="8533835">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533839">Encode</span><span class="op" id="8533845">(</span><span class="ident" id="8533846">ioutil</span><span class="op" id="8533852">.</span><span class="ident" id="8533853">Discard</span><span class="op" id="8533860">,</span>&nbsp;<span class="ident" id="8533862">img</span><span class="op" id="8533865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8533868">}</span><br>
<span class="lineno"></span><span class="op" id="8533870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8533873">func</span>&nbsp;<span class="ident" id="8533878">BenchmarkEncodeRGBOpaque</span><span class="op" id="8533902">(</span><span class="ident" id="8533903">b</span>&nbsp;<span class="op" id="8533905">*</span><span class="ident" id="8533906">testing</span><span class="op" id="8533913">.</span><span class="ident" id="8533914">B</span><span class="op" id="8533915">)</span>&nbsp;<span class="op" id="8533917">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533920">b</span><span class="op" id="8533921">.</span><span class="ident" id="8533922">StopTimer</span><span class="op" id="8533931">(</span><span class="op" id="8533932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8533935">img</span>&nbsp;<span class="op" id="8533939">:=</span>&nbsp;<span class="ident" id="8533942">image</span><span class="op" id="8533947">.</span><span class="ident" id="8533948">NewRGBA</span><span class="op" id="8533955">(</span><span class="ident" id="8533956">image</span><span class="op" id="8533961">.</span><span class="ident" id="8533962">Rect</span><span class="op" id="8533966">(</span><span class="num" id="8533967">0</span><span class="op" id="8533968">,</span>&nbsp;<span class="num" id="8533970">0</span><span class="op" id="8533971">,</span>&nbsp;<span class="num" id="8533973">640</span><span class="op" id="8533976">,</span>&nbsp;<span class="num" id="8533978">480</span><span class="op" id="8533981">)</span><span class="op" id="8533982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8533985">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534040">bo</span>&nbsp;<span class="op" id="8534043">:=</span>&nbsp;<span class="ident" id="8534046">img</span><span class="op" id="8534049">.</span><span class="ident" id="8534050">Bounds</span><span class="op" id="8534056">(</span><span class="op" id="8534057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534060">for</span>&nbsp;<span class="ident" id="8534064">y</span>&nbsp;<span class="op" id="8534066">:=</span>&nbsp;<span class="ident" id="8534069">bo</span><span class="op" id="8534071">.</span><span class="ident" id="8534072">Min</span><span class="op" id="8534075">.</span><span class="ident" id="8534076">Y</span><span class="op" id="8534077">;</span>&nbsp;<span class="ident" id="8534079">y</span>&nbsp;<span class="op" id="8534081">&lt;</span>&nbsp;<span class="ident" id="8534083">bo</span><span class="op" id="8534085">.</span><span class="ident" id="8534086">Max</span><span class="op" id="8534089">.</span><span class="ident" id="8534090">Y</span><span class="op" id="8534091">;</span>&nbsp;<span class="ident" id="8534093">y</span><span class="op" id="8534094">++</span>&nbsp;<span class="op" id="8534097">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534101">for</span>&nbsp;<span class="ident" id="8534105">x</span>&nbsp;<span class="op" id="8534107">:=</span>&nbsp;<span class="ident" id="8534110">bo</span><span class="op" id="8534112">.</span><span class="ident" id="8534113">Min</span><span class="op" id="8534116">.</span><span class="ident" id="8534117">X</span><span class="op" id="8534118">;</span>&nbsp;<span class="ident" id="8534120">x</span>&nbsp;<span class="op" id="8534122">&lt;</span>&nbsp;<span class="ident" id="8534124">bo</span><span class="op" id="8534126">.</span><span class="ident" id="8534127">Max</span><span class="op" id="8534130">.</span><span class="ident" id="8534131">X</span><span class="op" id="8534132">;</span>&nbsp;<span class="ident" id="8534134">x</span><span class="op" id="8534135">++</span>&nbsp;<span class="op" id="8534138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534143">img</span><span class="op" id="8534146">.</span><span class="ident" id="8534147">Set</span><span class="op" id="8534150">(</span><span class="ident" id="8534151">x</span><span class="op" id="8534152">,</span>&nbsp;<span class="ident" id="8534154">y</span><span class="op" id="8534155">,</span>&nbsp;<span class="ident" id="8534157">color</span><span class="op" id="8534162">.</span><span class="ident" id="8534163">RGBA</span><span class="op" id="8534167">{</span><span class="num" id="8534168">0</span><span class="op" id="8534169">,</span>&nbsp;<span class="num" id="8534171">0</span><span class="op" id="8534172">,</span>&nbsp;<span class="num" id="8534174">0</span><span class="op" id="8534175">,</span>&nbsp;<span class="num" id="8534177">255</span><span class="op" id="8534180">}</span><span class="op" id="8534181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534191">if</span>&nbsp;<span class="op" id="8534194">!</span><span class="ident" id="8534195">img</span><span class="op" id="8534198">.</span><span class="ident" id="8534199">Opaque</span><span class="op" id="8534205">(</span><span class="op" id="8534206">)</span>&nbsp;<span class="op" id="8534208">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534212">b</span><span class="op" id="8534213">.</span><span class="ident" id="8534214">Fatal</span><span class="op" id="8534219">(</span><span class="string" id="8534220">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="8534249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534255">b</span><span class="op" id="8534256">.</span><span class="ident" id="8534257">SetBytes</span><span class="op" id="8534265">(</span><span class="num" id="8534266">640</span>&nbsp;<span class="op" id="8534270">*</span>&nbsp;<span class="num" id="8534272">480</span>&nbsp;<span class="op" id="8534276">*</span>&nbsp;<span class="num" id="8534278">4</span><span class="op" id="8534279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534282">b</span><span class="op" id="8534283">.</span><span class="ident" id="8534284">StartTimer</span><span class="op" id="8534294">(</span><span class="op" id="8534295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534298">for</span>&nbsp;<span class="ident" id="8534302">i</span>&nbsp;<span class="op" id="8534304">:=</span>&nbsp;<span class="num" id="8534307">0</span><span class="op" id="8534308">;</span>&nbsp;<span class="ident" id="8534310">i</span>&nbsp;<span class="op" id="8534312">&lt;</span>&nbsp;<span class="ident" id="8534314">b</span><span class="op" id="8534315">.</span><span class="ident" id="8534316">N</span><span class="op" id="8534317">;</span>&nbsp;<span class="ident" id="8534319">i</span><span class="op" id="8534320">++</span>&nbsp;<span class="op" id="8534323">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534327">Encode</span><span class="op" id="8534333">(</span><span class="ident" id="8534334">ioutil</span><span class="op" id="8534340">.</span><span class="ident" id="8534341">Discard</span><span class="op" id="8534348">,</span>&nbsp;<span class="ident" id="8534350">img</span><span class="op" id="8534353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534356">}</span><br>
<span class="lineno"></span><span class="op" id="8534358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8534361">func</span>&nbsp;<span class="ident" id="8534366">BenchmarkEncodeRGBA</span><span class="op" id="8534385">(</span><span class="ident" id="8534386">b</span>&nbsp;<span class="op" id="8534388">*</span><span class="ident" id="8534389">testing</span><span class="op" id="8534396">.</span><span class="ident" id="8534397">B</span><span class="op" id="8534398">)</span>&nbsp;<span class="op" id="8534400">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534403">b</span><span class="op" id="8534404">.</span><span class="ident" id="8534405">StopTimer</span><span class="op" id="8534414">(</span><span class="op" id="8534415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534418">img</span>&nbsp;<span class="op" id="8534422">:=</span>&nbsp;<span class="ident" id="8534425">image</span><span class="op" id="8534430">.</span><span class="ident" id="8534431">NewRGBA</span><span class="op" id="8534438">(</span><span class="ident" id="8534439">image</span><span class="op" id="8534444">.</span><span class="ident" id="8534445">Rect</span><span class="op" id="8534449">(</span><span class="num" id="8534450">0</span><span class="op" id="8534451">,</span>&nbsp;<span class="num" id="8534453">0</span><span class="op" id="8534454">,</span>&nbsp;<span class="num" id="8534456">640</span><span class="op" id="8534459">,</span>&nbsp;<span class="num" id="8534461">480</span><span class="op" id="8534464">)</span><span class="op" id="8534465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534468">if</span>&nbsp;<span class="ident" id="8534471">img</span><span class="op" id="8534474">.</span><span class="ident" id="8534475">Opaque</span><span class="op" id="8534481">(</span><span class="op" id="8534482">)</span>&nbsp;<span class="op" id="8534484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534488">b</span><span class="op" id="8534489">.</span><span class="ident" id="8534490">Fatal</span><span class="op" id="8534495">(</span><span class="string" id="8534496">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="8534529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534532">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534535">b</span><span class="op" id="8534536">.</span><span class="ident" id="8534537">SetBytes</span><span class="op" id="8534545">(</span><span class="num" id="8534546">640</span>&nbsp;<span class="op" id="8534550">*</span>&nbsp;<span class="num" id="8534552">480</span>&nbsp;<span class="op" id="8534556">*</span>&nbsp;<span class="num" id="8534558">4</span><span class="op" id="8534559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534562">b</span><span class="op" id="8534563">.</span><span class="ident" id="8534564">StartTimer</span><span class="op" id="8534574">(</span><span class="op" id="8534575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8534578">for</span>&nbsp;<span class="ident" id="8534582">i</span>&nbsp;<span class="op" id="8534584">:=</span>&nbsp;<span class="num" id="8534587">0</span><span class="op" id="8534588">;</span>&nbsp;<span class="ident" id="8534590">i</span>&nbsp;<span class="op" id="8534592">&lt;</span>&nbsp;<span class="ident" id="8534594">b</span><span class="op" id="8534595">.</span><span class="ident" id="8534596">N</span><span class="op" id="8534597">;</span>&nbsp;<span class="ident" id="8534599">i</span><span class="op" id="8534600">++</span>&nbsp;<span class="op" id="8534603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8534607">Encode</span><span class="op" id="8534613">(</span><span class="ident" id="8534614">ioutil</span><span class="op" id="8534620">.</span><span class="ident" id="8534621">Discard</span><span class="op" id="8534628">,</span>&nbsp;<span class="ident" id="8534630">img</span><span class="op" id="8534633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8534636">}</span><br>
<span class="lineno">210</span><span class="op" id="8534638">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
