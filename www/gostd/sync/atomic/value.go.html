<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1390624">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1390679">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1390733">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1390784">package</span>&nbsp;<span class="ident" id="1390792">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1390800">import</span>&nbsp;<span class="op" id="1390807">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1390810">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1390819">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1390822">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1390898">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1390957">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1391010">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1391069">type</span>&nbsp;<span class="ident" id="1391074">Value</span>&nbsp;<span class="keyword" id="1391080">struct</span>&nbsp;<span class="op" id="1391087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391090">v</span>&nbsp;<span class="keyword" id="1391092">interface</span><span class="op" id="1391101">{</span><span class="op" id="1391102">}</span><br>
<span class="lineno"></span><span class="op" id="1391104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1391107">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1391161">type</span>&nbsp;<span class="ident" id="1391166">ifaceWords</span>&nbsp;<span class="keyword" id="1391177">struct</span>&nbsp;<span class="op" id="1391184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391187">typ</span>&nbsp;&nbsp;<span class="ident" id="1391192">unsafe</span><span class="op" id="1391198">.</span><span class="ident" id="1391199">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391208">data</span>&nbsp;<span class="ident" id="1391213">unsafe</span><span class="op" id="1391219">.</span><span class="ident" id="1391220">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1391228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1391231">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1391287">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1391356">func</span>&nbsp;<span class="op" id="1391361">(</span><span class="ident" id="1391362">v</span>&nbsp;<span class="op" id="1391364">*</span><span class="ident" id="1391365">Value</span><span class="op" id="1391370">)</span>&nbsp;<span class="ident" id="1391372">Load</span><span class="op" id="1391376">(</span><span class="op" id="1391377">)</span>&nbsp;<span class="op" id="1391379">(</span><span class="ident" id="1391380">x</span>&nbsp;<span class="keyword" id="1391382">interface</span><span class="op" id="1391391">{</span><span class="op" id="1391392">}</span><span class="op" id="1391393">)</span>&nbsp;<span class="op" id="1391395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391398">vp</span>&nbsp;<span class="op" id="1391401">:=</span>&nbsp;<span class="op" id="1391404">(</span><span class="op" id="1391405">*</span><span class="ident" id="1391406">ifaceWords</span><span class="op" id="1391416">)</span><span class="op" id="1391417">(</span><span class="ident" id="1391418">unsafe</span><span class="op" id="1391424">.</span><span class="ident" id="1391425">Pointer</span><span class="op" id="1391432">(</span><span class="ident" id="1391433">v</span><span class="op" id="1391434">)</span><span class="op" id="1391435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391438">typ</span>&nbsp;<span class="op" id="1391442">:=</span>&nbsp;<span class="ident" id="1391445">LoadPointer</span><span class="op" id="1391456">(</span><span class="op" id="1391457">&amp;</span><span class="ident" id="1391458">vp</span><span class="op" id="1391460">.</span><span class="ident" id="1391461">typ</span><span class="op" id="1391464">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391467">if</span>&nbsp;<span class="ident" id="1391470">typ</span>&nbsp;<span class="op" id="1391474">==</span>&nbsp;<span class="ident" id="1391477">nil</span>&nbsp;<span class="op" id="1391481">||</span>&nbsp;<span class="builtintype" id="1391484">uintptr</span><span class="op" id="1391491">(</span><span class="ident" id="1391492">typ</span><span class="op" id="1391495">)</span>&nbsp;<span class="op" id="1391497">==</span>&nbsp;<span class="op" id="1391500">^</span><span class="builtintype" id="1391501">uintptr</span><span class="op" id="1391508">(</span><span class="num" id="1391509">0</span><span class="op" id="1391510">)</span>&nbsp;<span class="op" id="1391512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1391516">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391552">return</span>&nbsp;<span class="ident" id="1391559">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1391564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391567">data</span>&nbsp;<span class="op" id="1391572">:=</span>&nbsp;<span class="ident" id="1391575">LoadPointer</span><span class="op" id="1391586">(</span><span class="op" id="1391587">&amp;</span><span class="ident" id="1391588">vp</span><span class="op" id="1391590">.</span><span class="ident" id="1391591">data</span><span class="op" id="1391595">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391598">xp</span>&nbsp;<span class="op" id="1391601">:=</span>&nbsp;<span class="op" id="1391604">(</span><span class="op" id="1391605">*</span><span class="ident" id="1391606">ifaceWords</span><span class="op" id="1391616">)</span><span class="op" id="1391617">(</span><span class="ident" id="1391618">unsafe</span><span class="op" id="1391624">.</span><span class="ident" id="1391625">Pointer</span><span class="op" id="1391632">(</span><span class="op" id="1391633">&amp;</span><span class="ident" id="1391634">x</span><span class="op" id="1391635">)</span><span class="op" id="1391636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391639">xp</span><span class="op" id="1391641">.</span><span class="ident" id="1391642">typ</span>&nbsp;<span class="op" id="1391646">=</span>&nbsp;<span class="ident" id="1391648">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391653">xp</span><span class="op" id="1391655">.</span><span class="ident" id="1391656">data</span>&nbsp;<span class="op" id="1391661">=</span>&nbsp;<span class="ident" id="1391663">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391669">return</span><br>
<span class="lineno"></span><span class="op" id="1391676">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1391679">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1391722">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1391805">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1391866">func</span>&nbsp;<span class="op" id="1391871">(</span><span class="ident" id="1391872">v</span>&nbsp;<span class="op" id="1391874">*</span><span class="ident" id="1391875">Value</span><span class="op" id="1391880">)</span>&nbsp;<span class="ident" id="1391882">Store</span><span class="op" id="1391887">(</span><span class="ident" id="1391888">x</span>&nbsp;<span class="keyword" id="1391890">interface</span><span class="op" id="1391899">{</span><span class="op" id="1391900">}</span><span class="op" id="1391901">)</span>&nbsp;<span class="op" id="1391903">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1391906">if</span>&nbsp;<span class="ident" id="1391909">x</span>&nbsp;<span class="op" id="1391911">==</span>&nbsp;<span class="ident" id="1391914">nil</span>&nbsp;<span class="op" id="1391918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1391922">panic</span><span class="op" id="1391927">(</span><span class="string" id="1391928">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1391972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1391975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1391978">vp</span>&nbsp;<span class="op" id="1391981">:=</span>&nbsp;<span class="op" id="1391984">(</span><span class="op" id="1391985">*</span><span class="ident" id="1391986">ifaceWords</span><span class="op" id="1391996">)</span><span class="op" id="1391997">(</span><span class="ident" id="1391998">unsafe</span><span class="op" id="1392004">.</span><span class="ident" id="1392005">Pointer</span><span class="op" id="1392012">(</span><span class="ident" id="1392013">v</span><span class="op" id="1392014">)</span><span class="op" id="1392015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392018">xp</span>&nbsp;<span class="op" id="1392021">:=</span>&nbsp;<span class="op" id="1392024">(</span><span class="op" id="1392025">*</span><span class="ident" id="1392026">ifaceWords</span><span class="op" id="1392036">)</span><span class="op" id="1392037">(</span><span class="ident" id="1392038">unsafe</span><span class="op" id="1392044">.</span><span class="ident" id="1392045">Pointer</span><span class="op" id="1392052">(</span><span class="op" id="1392053">&amp;</span><span class="ident" id="1392054">x</span><span class="op" id="1392055">)</span><span class="op" id="1392056">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392059">for</span>&nbsp;<span class="op" id="1392063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392067">typ</span>&nbsp;<span class="op" id="1392071">:=</span>&nbsp;<span class="ident" id="1392074">LoadPointer</span><span class="op" id="1392085">(</span><span class="op" id="1392086">&amp;</span><span class="ident" id="1392087">vp</span><span class="op" id="1392089">.</span><span class="ident" id="1392090">typ</span><span class="op" id="1392093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392097">if</span>&nbsp;<span class="ident" id="1392100">typ</span>&nbsp;<span class="op" id="1392104">==</span>&nbsp;<span class="ident" id="1392107">nil</span>&nbsp;<span class="op" id="1392111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392116">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392152">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392210">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392269">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392319">runtime_procPin</span><span class="op" id="1392334">(</span><span class="op" id="1392335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392340">if</span>&nbsp;<span class="op" id="1392343">!</span><span class="ident" id="1392344">CompareAndSwapPointer</span><span class="op" id="1392365">(</span><span class="op" id="1392366">&amp;</span><span class="ident" id="1392367">vp</span><span class="op" id="1392369">.</span><span class="ident" id="1392370">typ</span><span class="op" id="1392373">,</span>&nbsp;<span class="ident" id="1392375">nil</span><span class="op" id="1392378">,</span>&nbsp;<span class="ident" id="1392380">unsafe</span><span class="op" id="1392386">.</span><span class="ident" id="1392387">Pointer</span><span class="op" id="1392394">(</span><span class="op" id="1392395">^</span><span class="builtintype" id="1392396">uintptr</span><span class="op" id="1392403">(</span><span class="num" id="1392404">0</span><span class="op" id="1392405">)</span><span class="op" id="1392406">)</span><span class="op" id="1392407">)</span>&nbsp;<span class="op" id="1392409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392415">runtime_procUnpin</span><span class="op" id="1392432">(</span><span class="op" id="1392433">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392439">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392456">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392484">StorePointer</span><span class="op" id="1392496">(</span><span class="op" id="1392497">&amp;</span><span class="ident" id="1392498">vp</span><span class="op" id="1392500">.</span><span class="ident" id="1392501">data</span><span class="op" id="1392505">,</span>&nbsp;<span class="ident" id="1392507">xp</span><span class="op" id="1392509">.</span><span class="ident" id="1392510">data</span><span class="op" id="1392514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392519">StorePointer</span><span class="op" id="1392531">(</span><span class="op" id="1392532">&amp;</span><span class="ident" id="1392533">vp</span><span class="op" id="1392535">.</span><span class="ident" id="1392536">typ</span><span class="op" id="1392539">,</span>&nbsp;<span class="ident" id="1392541">xp</span><span class="op" id="1392543">.</span><span class="ident" id="1392544">typ</span><span class="op" id="1392547">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392552">runtime_procUnpin</span><span class="op" id="1392569">(</span><span class="op" id="1392570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392575">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392588">if</span>&nbsp;<span class="builtintype" id="1392591">uintptr</span><span class="op" id="1392598">(</span><span class="ident" id="1392599">typ</span><span class="op" id="1392602">)</span>&nbsp;<span class="op" id="1392604">==</span>&nbsp;<span class="op" id="1392607">^</span><span class="builtintype" id="1392608">uintptr</span><span class="op" id="1392615">(</span><span class="num" id="1392616">0</span><span class="op" id="1392617">)</span>&nbsp;<span class="op" id="1392619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392624">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392661">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392719">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392759">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1392774">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392833">if</span>&nbsp;<span class="ident" id="1392836">typ</span>&nbsp;<span class="op" id="1392840">!=</span>&nbsp;<span class="ident" id="1392843">xp</span><span class="op" id="1392845">.</span><span class="ident" id="1392846">typ</span>&nbsp;<span class="op" id="1392850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1392855">panic</span><span class="op" id="1392860">(</span><span class="string" id="1392861">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1392922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1392930">StorePointer</span><span class="op" id="1392942">(</span><span class="op" id="1392943">&amp;</span><span class="ident" id="1392944">vp</span><span class="op" id="1392946">.</span><span class="ident" id="1392947">data</span><span class="op" id="1392951">,</span>&nbsp;<span class="ident" id="1392953">xp</span><span class="op" id="1392955">.</span><span class="ident" id="1392956">data</span><span class="op" id="1392960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1392964">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1392972">}</span><br>
<span class="lineno"></span><span class="op" id="1392974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1392977">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1393031">func</span>&nbsp;<span class="ident" id="1393036">runtime_procPin</span><span class="op" id="1393051">(</span><span class="op" id="1393052">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1393054">func</span>&nbsp;<span class="ident" id="1393059">runtime_procUnpin</span><span class="op" id="1393076">(</span><span class="op" id="1393077">)</span>
</div>
</body>
</html>
