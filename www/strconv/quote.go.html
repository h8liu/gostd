<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2171226">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2171281">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2171335">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2171386">//go:generate&nbsp;go&nbsp;run&nbsp;makeisprint.go&nbsp;-output&nbsp;isprint.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2171442">package</span>&nbsp;<span class="ident" id="2171450">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2171459">import</span>&nbsp;<span class="op" id="2171466">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2171469">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2171484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2171487">const</span>&nbsp;<span class="ident" id="2171493">lowerhex</span>&nbsp;<span class="op" id="2171502">=</span>&nbsp;<span class="string" id="2171504">&#34;0123456789abcdef&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2171524">func</span>&nbsp;<span class="ident" id="2171529">quoteWith</span><span class="op" id="2171538">(</span><span class="ident" id="2171539">s</span>&nbsp;<span class="builtintype" id="2171541">string</span><span class="op" id="2171547">,</span>&nbsp;<span class="ident" id="2171549">quote</span>&nbsp;<span class="builtintype" id="2171555">byte</span><span class="op" id="2171559">,</span>&nbsp;<span class="ident" id="2171561">ASCIIonly</span>&nbsp;<span class="builtintype" id="2171571">bool</span><span class="op" id="2171575">)</span>&nbsp;<span class="builtintype" id="2171577">string</span>&nbsp;<span class="op" id="2171584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171587">var</span>&nbsp;<span class="ident" id="2171591">runeTmp</span>&nbsp;<span class="op" id="2171599">[</span><span class="ident" id="2171600">utf8</span><span class="op" id="2171604">.</span><span class="ident" id="2171605">UTFMax</span><span class="op" id="2171611">]</span><span class="builtintype" id="2171612">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171618">buf</span>&nbsp;<span class="op" id="2171622">:=</span>&nbsp;<span class="builtinfunc" id="2171625">make</span><span class="op" id="2171629">(</span><span class="op" id="2171630">[</span><span class="op" id="2171631">]</span><span class="builtintype" id="2171632">byte</span><span class="op" id="2171636">,</span>&nbsp;<span class="num" id="2171638">0</span><span class="op" id="2171639">,</span>&nbsp;<span class="num" id="2171641">3</span><span class="op" id="2171642">*</span><span class="builtinfunc" id="2171643">len</span><span class="op" id="2171646">(</span><span class="ident" id="2171647">s</span><span class="op" id="2171648">)</span><span class="op" id="2171649">/</span><span class="num" id="2171650">2</span><span class="op" id="2171651">)</span>&nbsp;<span class="comment" id="2171653">//&nbsp;Try&nbsp;to&nbsp;avoid&nbsp;more&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171688">buf</span>&nbsp;<span class="op" id="2171692">=</span>&nbsp;<span class="builtinfunc" id="2171694">append</span><span class="op" id="2171700">(</span><span class="ident" id="2171701">buf</span><span class="op" id="2171704">,</span>&nbsp;<span class="ident" id="2171706">quote</span><span class="op" id="2171711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171714">for</span>&nbsp;<span class="ident" id="2171718">width</span>&nbsp;<span class="op" id="2171724">:=</span>&nbsp;<span class="num" id="2171727">0</span><span class="op" id="2171728">;</span>&nbsp;<span class="builtinfunc" id="2171730">len</span><span class="op" id="2171733">(</span><span class="ident" id="2171734">s</span><span class="op" id="2171735">)</span>&nbsp;<span class="op" id="2171737">&gt;</span>&nbsp;<span class="num" id="2171739">0</span><span class="op" id="2171740">;</span>&nbsp;<span class="ident" id="2171742">s</span>&nbsp;<span class="op" id="2171744">=</span>&nbsp;<span class="ident" id="2171746">s</span><span class="op" id="2171747">[</span><span class="ident" id="2171748">width</span><span class="op" id="2171753">:</span><span class="op" id="2171754">]</span>&nbsp;<span class="op" id="2171756">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171760">r</span>&nbsp;<span class="op" id="2171762">:=</span>&nbsp;<span class="builtintype" id="2171765">rune</span><span class="op" id="2171769">(</span><span class="ident" id="2171770">s</span><span class="op" id="2171771">[</span><span class="num" id="2171772">0</span><span class="op" id="2171773">]</span><span class="op" id="2171774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171778">width</span>&nbsp;<span class="op" id="2171784">=</span>&nbsp;<span class="num" id="2171786">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171790">if</span>&nbsp;<span class="ident" id="2171793">r</span>&nbsp;<span class="op" id="2171795">&gt;=</span>&nbsp;<span class="ident" id="2171798">utf8</span><span class="op" id="2171802">.</span><span class="ident" id="2171803">RuneSelf</span>&nbsp;<span class="op" id="2171812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171817">r</span><span class="op" id="2171818">,</span>&nbsp;<span class="ident" id="2171820">width</span>&nbsp;<span class="op" id="2171826">=</span>&nbsp;<span class="ident" id="2171828">utf8</span><span class="op" id="2171832">.</span><span class="ident" id="2171833">DecodeRuneInString</span><span class="op" id="2171851">(</span><span class="ident" id="2171852">s</span><span class="op" id="2171853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2171857">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2171861">if</span>&nbsp;<span class="ident" id="2171864">width</span>&nbsp;<span class="op" id="2171870">==</span>&nbsp;<span class="num" id="2171873">1</span>&nbsp;<span class="op" id="2171875">&amp;&amp;</span>&nbsp;<span class="ident" id="2171878">r</span>&nbsp;<span class="op" id="2171880">==</span>&nbsp;<span class="ident" id="2171883">utf8</span><span class="op" id="2171887">.</span><span class="ident" id="2171888">RuneError</span>&nbsp;<span class="op" id="2171898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171903">buf</span>&nbsp;<span class="op" id="2171907">=</span>&nbsp;<span class="builtinfunc" id="2171909">append</span><span class="op" id="2171915">(</span><span class="ident" id="2171916">buf</span><span class="op" id="2171919">,</span>&nbsp;<span class="string" id="2171921">`\x`</span><span class="op" id="2171925">...</span><span class="op" id="2171928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171933">buf</span>&nbsp;<span class="op" id="2171937">=</span>&nbsp;<span class="builtinfunc" id="2171939">append</span><span class="op" id="2171945">(</span><span class="ident" id="2171946">buf</span><span class="op" id="2171949">,</span>&nbsp;<span class="ident" id="2171951">lowerhex</span><span class="op" id="2171959">[</span><span class="ident" id="2171960">s</span><span class="op" id="2171961">[</span><span class="num" id="2171962">0</span><span class="op" id="2171963">]</span><span class="op" id="2171964">&gt;&gt;</span><span class="num" id="2171966">4</span><span class="op" id="2171967">]</span><span class="op" id="2171968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2171973">buf</span>&nbsp;<span class="op" id="2171977">=</span>&nbsp;<span class="builtinfunc" id="2171979">append</span><span class="op" id="2171985">(</span><span class="ident" id="2171986">buf</span><span class="op" id="2171989">,</span>&nbsp;<span class="ident" id="2171991">lowerhex</span><span class="op" id="2171999">[</span><span class="ident" id="2172000">s</span><span class="op" id="2172001">[</span><span class="num" id="2172002">0</span><span class="op" id="2172003">]</span><span class="op" id="2172004">&amp;</span><span class="num" id="2172005">0xF</span><span class="op" id="2172008">]</span><span class="op" id="2172009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172014">continue</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172029">if</span>&nbsp;<span class="ident" id="2172032">r</span>&nbsp;<span class="op" id="2172034">==</span>&nbsp;<span class="builtintype" id="2172037">rune</span><span class="op" id="2172041">(</span><span class="ident" id="2172042">quote</span><span class="op" id="2172047">)</span>&nbsp;<span class="op" id="2172049">||</span>&nbsp;<span class="ident" id="2172052">r</span>&nbsp;<span class="op" id="2172054">==</span>&nbsp;<span class="string" id="2172057">&#39;\\&#39;</span>&nbsp;<span class="op" id="2172062">{</span>&nbsp;<span class="comment" id="2172064">//&nbsp;always&nbsp;backslashed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172089">buf</span>&nbsp;<span class="op" id="2172093">=</span>&nbsp;<span class="builtinfunc" id="2172095">append</span><span class="op" id="2172101">(</span><span class="ident" id="2172102">buf</span><span class="op" id="2172105">,</span>&nbsp;<span class="string" id="2172107">&#39;\\&#39;</span><span class="op" id="2172111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172116">buf</span>&nbsp;<span class="op" id="2172120">=</span>&nbsp;<span class="builtinfunc" id="2172122">append</span><span class="op" id="2172128">(</span><span class="ident" id="2172129">buf</span><span class="op" id="2172132">,</span>&nbsp;<span class="builtintype" id="2172134">byte</span><span class="op" id="2172138">(</span><span class="ident" id="2172139">r</span><span class="op" id="2172140">)</span><span class="op" id="2172141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172146">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172161">if</span>&nbsp;<span class="ident" id="2172164">ASCIIonly</span>&nbsp;<span class="op" id="2172174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172179">if</span>&nbsp;<span class="ident" id="2172182">r</span>&nbsp;<span class="op" id="2172184">&lt;</span>&nbsp;<span class="ident" id="2172186">utf8</span><span class="op" id="2172190">.</span><span class="ident" id="2172191">RuneSelf</span>&nbsp;<span class="op" id="2172200">&amp;&amp;</span>&nbsp;<span class="ident" id="2172203">IsPrint</span><span class="op" id="2172210">(</span><span class="ident" id="2172211">r</span><span class="op" id="2172212">)</span>&nbsp;<span class="op" id="2172214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172220">buf</span>&nbsp;<span class="op" id="2172224">=</span>&nbsp;<span class="builtinfunc" id="2172226">append</span><span class="op" id="2172232">(</span><span class="ident" id="2172233">buf</span><span class="op" id="2172236">,</span>&nbsp;<span class="builtintype" id="2172238">byte</span><span class="op" id="2172242">(</span><span class="ident" id="2172243">r</span><span class="op" id="2172244">)</span><span class="op" id="2172245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172251">continue</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172267">}</span>&nbsp;<span class="keyword" id="2172269">else</span>&nbsp;<span class="keyword" id="2172274">if</span>&nbsp;<span class="ident" id="2172277">IsPrint</span><span class="op" id="2172284">(</span><span class="ident" id="2172285">r</span><span class="op" id="2172286">)</span>&nbsp;<span class="op" id="2172288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172293">n</span>&nbsp;<span class="op" id="2172295">:=</span>&nbsp;<span class="ident" id="2172298">utf8</span><span class="op" id="2172302">.</span><span class="ident" id="2172303">EncodeRune</span><span class="op" id="2172313">(</span><span class="ident" id="2172314">runeTmp</span><span class="op" id="2172321">[</span><span class="op" id="2172322">:</span><span class="op" id="2172323">]</span><span class="op" id="2172324">,</span>&nbsp;<span class="ident" id="2172326">r</span><span class="op" id="2172327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172332">buf</span>&nbsp;<span class="op" id="2172336">=</span>&nbsp;<span class="builtinfunc" id="2172338">append</span><span class="op" id="2172344">(</span><span class="ident" id="2172345">buf</span><span class="op" id="2172348">,</span>&nbsp;<span class="ident" id="2172350">runeTmp</span><span class="op" id="2172357">[</span><span class="op" id="2172358">:</span><span class="ident" id="2172359">n</span><span class="op" id="2172360">]</span><span class="op" id="2172361">...</span><span class="op" id="2172364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172369">continue</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2172380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172384">switch</span>&nbsp;<span class="ident" id="2172391">r</span>&nbsp;<span class="op" id="2172393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172397">case</span>&nbsp;<span class="string" id="2172402">&#39;\a&#39;</span><span class="op" id="2172406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172411">buf</span>&nbsp;<span class="op" id="2172415">=</span>&nbsp;<span class="builtinfunc" id="2172417">append</span><span class="op" id="2172423">(</span><span class="ident" id="2172424">buf</span><span class="op" id="2172427">,</span>&nbsp;<span class="string" id="2172429">`\a`</span><span class="op" id="2172433">...</span><span class="op" id="2172436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172440">case</span>&nbsp;<span class="string" id="2172445">&#39;\b&#39;</span><span class="op" id="2172449">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172454">buf</span>&nbsp;<span class="op" id="2172458">=</span>&nbsp;<span class="builtinfunc" id="2172460">append</span><span class="op" id="2172466">(</span><span class="ident" id="2172467">buf</span><span class="op" id="2172470">,</span>&nbsp;<span class="string" id="2172472">`\b`</span><span class="op" id="2172476">...</span><span class="op" id="2172479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172483">case</span>&nbsp;<span class="string" id="2172488">&#39;\f&#39;</span><span class="op" id="2172492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172497">buf</span>&nbsp;<span class="op" id="2172501">=</span>&nbsp;<span class="builtinfunc" id="2172503">append</span><span class="op" id="2172509">(</span><span class="ident" id="2172510">buf</span><span class="op" id="2172513">,</span>&nbsp;<span class="string" id="2172515">`\f`</span><span class="op" id="2172519">...</span><span class="op" id="2172522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172526">case</span>&nbsp;<span class="string" id="2172531">&#39;\n&#39;</span><span class="op" id="2172535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172540">buf</span>&nbsp;<span class="op" id="2172544">=</span>&nbsp;<span class="builtinfunc" id="2172546">append</span><span class="op" id="2172552">(</span><span class="ident" id="2172553">buf</span><span class="op" id="2172556">,</span>&nbsp;<span class="string" id="2172558">`\n`</span><span class="op" id="2172562">...</span><span class="op" id="2172565">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172569">case</span>&nbsp;<span class="string" id="2172574">&#39;\r&#39;</span><span class="op" id="2172578">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172583">buf</span>&nbsp;<span class="op" id="2172587">=</span>&nbsp;<span class="builtinfunc" id="2172589">append</span><span class="op" id="2172595">(</span><span class="ident" id="2172596">buf</span><span class="op" id="2172599">,</span>&nbsp;<span class="string" id="2172601">`\r`</span><span class="op" id="2172605">...</span><span class="op" id="2172608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172612">case</span>&nbsp;<span class="string" id="2172617">&#39;\t&#39;</span><span class="op" id="2172621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172626">buf</span>&nbsp;<span class="op" id="2172630">=</span>&nbsp;<span class="builtinfunc" id="2172632">append</span><span class="op" id="2172638">(</span><span class="ident" id="2172639">buf</span><span class="op" id="2172642">,</span>&nbsp;<span class="string" id="2172644">`\t`</span><span class="op" id="2172648">...</span><span class="op" id="2172651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172655">case</span>&nbsp;<span class="string" id="2172660">&#39;\v&#39;</span><span class="op" id="2172664">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172669">buf</span>&nbsp;<span class="op" id="2172673">=</span>&nbsp;<span class="builtinfunc" id="2172675">append</span><span class="op" id="2172681">(</span><span class="ident" id="2172682">buf</span><span class="op" id="2172685">,</span>&nbsp;<span class="string" id="2172687">`\v`</span><span class="op" id="2172691">...</span><span class="op" id="2172694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172698">default</span><span class="op" id="2172705">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172710">switch</span>&nbsp;<span class="op" id="2172717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172722">case</span>&nbsp;<span class="ident" id="2172727">r</span>&nbsp;<span class="op" id="2172729">&lt;</span>&nbsp;<span class="string" id="2172731">&#39;&nbsp;&#39;</span><span class="op" id="2172734">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172740">buf</span>&nbsp;<span class="op" id="2172744">=</span>&nbsp;<span class="builtinfunc" id="2172746">append</span><span class="op" id="2172752">(</span><span class="ident" id="2172753">buf</span><span class="op" id="2172756">,</span>&nbsp;<span class="string" id="2172758">`\x`</span><span class="op" id="2172762">...</span><span class="op" id="2172765">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172771">buf</span>&nbsp;<span class="op" id="2172775">=</span>&nbsp;<span class="builtinfunc" id="2172777">append</span><span class="op" id="2172783">(</span><span class="ident" id="2172784">buf</span><span class="op" id="2172787">,</span>&nbsp;<span class="ident" id="2172789">lowerhex</span><span class="op" id="2172797">[</span><span class="ident" id="2172798">s</span><span class="op" id="2172799">[</span><span class="num" id="2172800">0</span><span class="op" id="2172801">]</span><span class="op" id="2172802">&gt;&gt;</span><span class="num" id="2172804">4</span><span class="op" id="2172805">]</span><span class="op" id="2172806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172812">buf</span>&nbsp;<span class="op" id="2172816">=</span>&nbsp;<span class="builtinfunc" id="2172818">append</span><span class="op" id="2172824">(</span><span class="ident" id="2172825">buf</span><span class="op" id="2172828">,</span>&nbsp;<span class="ident" id="2172830">lowerhex</span><span class="op" id="2172838">[</span><span class="ident" id="2172839">s</span><span class="op" id="2172840">[</span><span class="num" id="2172841">0</span><span class="op" id="2172842">]</span><span class="op" id="2172843">&amp;</span><span class="num" id="2172844">0xF</span><span class="op" id="2172847">]</span><span class="op" id="2172848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172853">case</span>&nbsp;<span class="ident" id="2172858">r</span>&nbsp;<span class="op" id="2172860">&gt;</span>&nbsp;<span class="ident" id="2172862">utf8</span><span class="op" id="2172866">.</span><span class="ident" id="2172867">MaxRune</span><span class="op" id="2172874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172880">r</span>&nbsp;<span class="op" id="2172882">=</span>&nbsp;<span class="num" id="2172884">0xFFFD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172895">fallthrough</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172910">case</span>&nbsp;<span class="ident" id="2172915">r</span>&nbsp;<span class="op" id="2172917">&lt;</span>&nbsp;<span class="num" id="2172919">0x10000</span><span class="op" id="2172926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172932">buf</span>&nbsp;<span class="op" id="2172936">=</span>&nbsp;<span class="builtinfunc" id="2172938">append</span><span class="op" id="2172944">(</span><span class="ident" id="2172945">buf</span><span class="op" id="2172948">,</span>&nbsp;<span class="string" id="2172950">`\u`</span><span class="op" id="2172954">...</span><span class="op" id="2172957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2172963">for</span>&nbsp;<span class="ident" id="2172967">s</span>&nbsp;<span class="op" id="2172969">:=</span>&nbsp;<span class="num" id="2172972">12</span><span class="op" id="2172974">;</span>&nbsp;<span class="ident" id="2172976">s</span>&nbsp;<span class="op" id="2172978">&gt;=</span>&nbsp;<span class="num" id="2172981">0</span><span class="op" id="2172982">;</span>&nbsp;<span class="ident" id="2172984">s</span>&nbsp;<span class="op" id="2172986">-=</span>&nbsp;<span class="num" id="2172989">4</span>&nbsp;<span class="op" id="2172991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2172998">buf</span>&nbsp;<span class="op" id="2173002">=</span>&nbsp;<span class="builtinfunc" id="2173004">append</span><span class="op" id="2173010">(</span><span class="ident" id="2173011">buf</span><span class="op" id="2173014">,</span>&nbsp;<span class="ident" id="2173016">lowerhex</span><span class="op" id="2173024">[</span><span class="ident" id="2173025">r</span><span class="op" id="2173026">&gt;&gt;</span><span class="builtintype" id="2173028">uint</span><span class="op" id="2173032">(</span><span class="ident" id="2173033">s</span><span class="op" id="2173034">)</span><span class="op" id="2173035">&amp;</span><span class="num" id="2173036">0xF</span><span class="op" id="2173039">]</span><span class="op" id="2173040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173046">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173051">default</span><span class="op" id="2173058">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173064">buf</span>&nbsp;<span class="op" id="2173068">=</span>&nbsp;<span class="builtinfunc" id="2173070">append</span><span class="op" id="2173076">(</span><span class="ident" id="2173077">buf</span><span class="op" id="2173080">,</span>&nbsp;<span class="string" id="2173082">`\U`</span><span class="op" id="2173086">...</span><span class="op" id="2173089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173095">for</span>&nbsp;<span class="ident" id="2173099">s</span>&nbsp;<span class="op" id="2173101">:=</span>&nbsp;<span class="num" id="2173104">28</span><span class="op" id="2173106">;</span>&nbsp;<span class="ident" id="2173108">s</span>&nbsp;<span class="op" id="2173110">&gt;=</span>&nbsp;<span class="num" id="2173113">0</span><span class="op" id="2173114">;</span>&nbsp;<span class="ident" id="2173116">s</span>&nbsp;<span class="op" id="2173118">-=</span>&nbsp;<span class="num" id="2173121">4</span>&nbsp;<span class="op" id="2173123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173130">buf</span>&nbsp;<span class="op" id="2173134">=</span>&nbsp;<span class="builtinfunc" id="2173136">append</span><span class="op" id="2173142">(</span><span class="ident" id="2173143">buf</span><span class="op" id="2173146">,</span>&nbsp;<span class="ident" id="2173148">lowerhex</span><span class="op" id="2173156">[</span><span class="ident" id="2173157">r</span><span class="op" id="2173158">&gt;&gt;</span><span class="builtintype" id="2173160">uint</span><span class="op" id="2173164">(</span><span class="ident" id="2173165">s</span><span class="op" id="2173166">)</span><span class="op" id="2173167">&amp;</span><span class="num" id="2173168">0xF</span><span class="op" id="2173171">]</span><span class="op" id="2173172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173178">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2173190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2173193">buf</span>&nbsp;<span class="op" id="2173197">=</span>&nbsp;<span class="builtinfunc" id="2173199">append</span><span class="op" id="2173205">(</span><span class="ident" id="2173206">buf</span><span class="op" id="2173209">,</span>&nbsp;<span class="ident" id="2173211">quote</span><span class="op" id="2173216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173219">return</span>&nbsp;<span class="builtintype" id="2173226">string</span><span class="op" id="2173232">(</span><span class="ident" id="2173233">buf</span><span class="op" id="2173236">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="op" id="2173239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2173242">//&nbsp;Quote&nbsp;returns&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="2173314">//&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,&nbsp;\u0100)&nbsp;for</span><br>
<span class="lineno">90</span><span class="comment" id="2173385">//&nbsp;control&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2173450">//&nbsp;IsPrint.</span><br>
<span class="lineno"></span><span class="keyword" id="2173462">func</span>&nbsp;<span class="ident" id="2173467">Quote</span><span class="op" id="2173472">(</span><span class="ident" id="2173473">s</span>&nbsp;<span class="builtintype" id="2173475">string</span><span class="op" id="2173481">)</span>&nbsp;<span class="builtintype" id="2173483">string</span>&nbsp;<span class="op" id="2173490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173493">return</span>&nbsp;<span class="ident" id="2173500">quoteWith</span><span class="op" id="2173509">(</span><span class="ident" id="2173510">s</span><span class="op" id="2173511">,</span>&nbsp;<span class="string" id="2173513">&#39;&#34;&#39;</span><span class="op" id="2173516">,</span>&nbsp;<span class="ident" id="2173518">false</span><span class="op" id="2173523">)</span><br>
<span class="lineno"></span><span class="op" id="2173525">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="2173528">//&nbsp;AppendQuote&nbsp;appends&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s,</span><br>
<span class="lineno"></span><span class="comment" id="2173601">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;Quote,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2173667">func</span>&nbsp;<span class="ident" id="2173672">AppendQuote</span><span class="op" id="2173683">(</span><span class="ident" id="2173684">dst</span>&nbsp;<span class="op" id="2173688">[</span><span class="op" id="2173689">]</span><span class="builtintype" id="2173690">byte</span><span class="op" id="2173694">,</span>&nbsp;<span class="ident" id="2173696">s</span>&nbsp;<span class="builtintype" id="2173698">string</span><span class="op" id="2173704">)</span>&nbsp;<span class="op" id="2173706">[</span><span class="op" id="2173707">]</span><span class="builtintype" id="2173708">byte</span>&nbsp;<span class="op" id="2173713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2173716">return</span>&nbsp;<span class="builtinfunc" id="2173723">append</span><span class="op" id="2173729">(</span><span class="ident" id="2173730">dst</span><span class="op" id="2173733">,</span>&nbsp;<span class="ident" id="2173735">Quote</span><span class="op" id="2173740">(</span><span class="ident" id="2173741">s</span><span class="op" id="2173742">)</span><span class="op" id="2173743">...</span><span class="op" id="2173746">)</span><br>
<span class="lineno">100</span><span class="op" id="2173748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2173751">//&nbsp;QuoteToASCII&nbsp;returns&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s.</span><br>
<span class="lineno"></span><span class="comment" id="2173825">//&nbsp;The&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,&nbsp;\u0100)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2173900">//&nbsp;non-ASCII&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined&nbsp;by&nbsp;IsPrint.</span><br>
<span class="lineno">105</span><span class="keyword" id="2173976">func</span>&nbsp;<span class="ident" id="2173981">QuoteToASCII</span><span class="op" id="2173993">(</span><span class="ident" id="2173994">s</span>&nbsp;<span class="builtintype" id="2173996">string</span><span class="op" id="2174002">)</span>&nbsp;<span class="builtintype" id="2174004">string</span>&nbsp;<span class="op" id="2174011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174014">return</span>&nbsp;<span class="ident" id="2174021">quoteWith</span><span class="op" id="2174030">(</span><span class="ident" id="2174031">s</span><span class="op" id="2174032">,</span>&nbsp;<span class="string" id="2174034">&#39;&#34;&#39;</span><span class="op" id="2174037">,</span>&nbsp;<span class="ident" id="2174039">true</span><span class="op" id="2174043">)</span><br>
<span class="lineno"></span><span class="op" id="2174045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2174048">//&nbsp;AppendQuoteToASCII&nbsp;appends&nbsp;a&nbsp;double-quoted&nbsp;Go&nbsp;string&nbsp;literal&nbsp;representing&nbsp;s,</span><br>
<span class="lineno">110</span><span class="comment" id="2174128">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;QuoteToASCII,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2174201">func</span>&nbsp;<span class="ident" id="2174206">AppendQuoteToASCII</span><span class="op" id="2174224">(</span><span class="ident" id="2174225">dst</span>&nbsp;<span class="op" id="2174229">[</span><span class="op" id="2174230">]</span><span class="builtintype" id="2174231">byte</span><span class="op" id="2174235">,</span>&nbsp;<span class="ident" id="2174237">s</span>&nbsp;<span class="builtintype" id="2174239">string</span><span class="op" id="2174245">)</span>&nbsp;<span class="op" id="2174247">[</span><span class="op" id="2174248">]</span><span class="builtintype" id="2174249">byte</span>&nbsp;<span class="op" id="2174254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174257">return</span>&nbsp;<span class="builtinfunc" id="2174264">append</span><span class="op" id="2174270">(</span><span class="ident" id="2174271">dst</span><span class="op" id="2174274">,</span>&nbsp;<span class="ident" id="2174276">QuoteToASCII</span><span class="op" id="2174288">(</span><span class="ident" id="2174289">s</span><span class="op" id="2174290">)</span><span class="op" id="2174291">...</span><span class="op" id="2174294">)</span><br>
<span class="lineno"></span><span class="op" id="2174296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="2174299">//&nbsp;QuoteRune&nbsp;returns&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2174374">//&nbsp;rune.&nbsp;&nbsp;The&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,&nbsp;\u0100)</span><br>
<span class="lineno"></span><span class="comment" id="2174452">//&nbsp;for&nbsp;control&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined&nbsp;by&nbsp;IsPrint.</span><br>
<span class="lineno"></span><span class="keyword" id="2174530">func</span>&nbsp;<span class="ident" id="2174535">QuoteRune</span><span class="op" id="2174544">(</span><span class="ident" id="2174545">r</span>&nbsp;<span class="builtintype" id="2174547">rune</span><span class="op" id="2174551">)</span>&nbsp;<span class="builtintype" id="2174553">string</span>&nbsp;<span class="op" id="2174560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2174563">//&nbsp;TODO:&nbsp;avoid&nbsp;the&nbsp;allocation&nbsp;here.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174600">return</span>&nbsp;<span class="ident" id="2174607">quoteWith</span><span class="op" id="2174616">(</span><span class="builtintype" id="2174617">string</span><span class="op" id="2174623">(</span><span class="ident" id="2174624">r</span><span class="op" id="2174625">)</span><span class="op" id="2174626">,</span>&nbsp;<span class="string" id="2174628">&#39;\&#39;&#39;</span><span class="op" id="2174632">,</span>&nbsp;<span class="ident" id="2174634">false</span><span class="op" id="2174639">)</span><br>
<span class="lineno"></span><span class="op" id="2174641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2174644">//&nbsp;AppendQuoteRune&nbsp;appends&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing&nbsp;the&nbsp;rune,</span><br>
<span class="lineno"></span><span class="comment" id="2174731">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;QuoteRune,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">125</span><span class="keyword" id="2174801">func</span>&nbsp;<span class="ident" id="2174806">AppendQuoteRune</span><span class="op" id="2174821">(</span><span class="ident" id="2174822">dst</span>&nbsp;<span class="op" id="2174826">[</span><span class="op" id="2174827">]</span><span class="builtintype" id="2174828">byte</span><span class="op" id="2174832">,</span>&nbsp;<span class="ident" id="2174834">r</span>&nbsp;<span class="builtintype" id="2174836">rune</span><span class="op" id="2174840">)</span>&nbsp;<span class="op" id="2174842">[</span><span class="op" id="2174843">]</span><span class="builtintype" id="2174844">byte</span>&nbsp;<span class="op" id="2174849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2174852">return</span>&nbsp;<span class="builtinfunc" id="2174859">append</span><span class="op" id="2174865">(</span><span class="ident" id="2174866">dst</span><span class="op" id="2174869">,</span>&nbsp;<span class="ident" id="2174871">QuoteRune</span><span class="op" id="2174880">(</span><span class="ident" id="2174881">r</span><span class="op" id="2174882">)</span><span class="op" id="2174883">...</span><span class="op" id="2174886">)</span><br>
<span class="lineno"></span><span class="op" id="2174888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2174891">//&nbsp;QuoteRuneToASCII&nbsp;returns&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing</span><br>
<span class="lineno">130</span><span class="comment" id="2174969">//&nbsp;the&nbsp;rune.&nbsp;&nbsp;The&nbsp;returned&nbsp;string&nbsp;uses&nbsp;Go&nbsp;escape&nbsp;sequences&nbsp;(\t,&nbsp;\n,&nbsp;\xFF,</span><br>
<span class="lineno"></span><span class="comment" id="2175043">//&nbsp;\u0100)&nbsp;for&nbsp;non-ASCII&nbsp;characters&nbsp;and&nbsp;non-printable&nbsp;characters&nbsp;as&nbsp;defined</span><br>
<span class="lineno"></span><span class="comment" id="2175119">//&nbsp;by&nbsp;IsPrint.</span><br>
<span class="lineno"></span><span class="keyword" id="2175134">func</span>&nbsp;<span class="ident" id="2175139">QuoteRuneToASCII</span><span class="op" id="2175155">(</span><span class="ident" id="2175156">r</span>&nbsp;<span class="builtintype" id="2175158">rune</span><span class="op" id="2175162">)</span>&nbsp;<span class="builtintype" id="2175164">string</span>&nbsp;<span class="op" id="2175171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2175174">//&nbsp;TODO:&nbsp;avoid&nbsp;the&nbsp;allocation&nbsp;here.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175211">return</span>&nbsp;<span class="ident" id="2175218">quoteWith</span><span class="op" id="2175227">(</span><span class="builtintype" id="2175228">string</span><span class="op" id="2175234">(</span><span class="ident" id="2175235">r</span><span class="op" id="2175236">)</span><span class="op" id="2175237">,</span>&nbsp;<span class="string" id="2175239">&#39;\&#39;&#39;</span><span class="op" id="2175243">,</span>&nbsp;<span class="ident" id="2175245">true</span><span class="op" id="2175249">)</span><br>
<span class="lineno"></span><span class="op" id="2175251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2175254">//&nbsp;AppendQuoteRuneToASCII&nbsp;appends&nbsp;a&nbsp;single-quoted&nbsp;Go&nbsp;character&nbsp;literal&nbsp;representing&nbsp;the&nbsp;rune,</span><br>
<span class="lineno"></span><span class="comment" id="2175348">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;QuoteRuneToASCII,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">140</span><span class="keyword" id="2175425">func</span>&nbsp;<span class="ident" id="2175430">AppendQuoteRuneToASCII</span><span class="op" id="2175452">(</span><span class="ident" id="2175453">dst</span>&nbsp;<span class="op" id="2175457">[</span><span class="op" id="2175458">]</span><span class="builtintype" id="2175459">byte</span><span class="op" id="2175463">,</span>&nbsp;<span class="ident" id="2175465">r</span>&nbsp;<span class="builtintype" id="2175467">rune</span><span class="op" id="2175471">)</span>&nbsp;<span class="op" id="2175473">[</span><span class="op" id="2175474">]</span><span class="builtintype" id="2175475">byte</span>&nbsp;<span class="op" id="2175480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175483">return</span>&nbsp;<span class="builtinfunc" id="2175490">append</span><span class="op" id="2175496">(</span><span class="ident" id="2175497">dst</span><span class="op" id="2175500">,</span>&nbsp;<span class="ident" id="2175502">QuoteRuneToASCII</span><span class="op" id="2175518">(</span><span class="ident" id="2175519">r</span><span class="op" id="2175520">)</span><span class="op" id="2175521">...</span><span class="op" id="2175524">)</span><br>
<span class="lineno"></span><span class="op" id="2175526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2175529">//&nbsp;CanBackquote&nbsp;reports&nbsp;whether&nbsp;the&nbsp;string&nbsp;s&nbsp;can&nbsp;be&nbsp;represented</span><br>
<span class="lineno">145</span><span class="comment" id="2175593">//&nbsp;unchanged&nbsp;as&nbsp;a&nbsp;single-line&nbsp;backquoted&nbsp;string&nbsp;without&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2175657">//&nbsp;characters&nbsp;other&nbsp;than&nbsp;tab.</span><br>
<span class="lineno"></span><span class="keyword" id="2175687">func</span>&nbsp;<span class="ident" id="2175692">CanBackquote</span><span class="op" id="2175704">(</span><span class="ident" id="2175705">s</span>&nbsp;<span class="builtintype" id="2175707">string</span><span class="op" id="2175713">)</span>&nbsp;<span class="builtintype" id="2175715">bool</span>&nbsp;<span class="op" id="2175720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175723">for</span>&nbsp;<span class="builtinfunc" id="2175727">len</span><span class="op" id="2175730">(</span><span class="ident" id="2175731">s</span><span class="op" id="2175732">)</span>&nbsp;<span class="op" id="2175734">&gt;</span>&nbsp;<span class="num" id="2175736">0</span>&nbsp;<span class="op" id="2175738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2175742">r</span><span class="op" id="2175743">,</span>&nbsp;<span class="ident" id="2175745">wid</span>&nbsp;<span class="op" id="2175749">:=</span>&nbsp;<span class="ident" id="2175752">utf8</span><span class="op" id="2175756">.</span><span class="ident" id="2175757">DecodeRuneInString</span><span class="op" id="2175775">(</span><span class="ident" id="2175776">s</span><span class="op" id="2175777">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2175781">s</span>&nbsp;<span class="op" id="2175783">=</span>&nbsp;<span class="ident" id="2175785">s</span><span class="op" id="2175786">[</span><span class="ident" id="2175787">wid</span><span class="op" id="2175790">:</span><span class="op" id="2175791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175795">if</span>&nbsp;<span class="ident" id="2175798">wid</span>&nbsp;<span class="op" id="2175802">&gt;</span>&nbsp;<span class="num" id="2175804">1</span>&nbsp;<span class="op" id="2175806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175811">if</span>&nbsp;<span class="ident" id="2175814">r</span>&nbsp;<span class="op" id="2175816">==</span>&nbsp;<span class="string" id="2175819">&#39;\ufeff&#39;</span>&nbsp;<span class="op" id="2175828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175834">return</span>&nbsp;<span class="ident" id="2175841">false</span>&nbsp;<span class="comment" id="2175847">//&nbsp;BOMs&nbsp;are&nbsp;invisible&nbsp;and&nbsp;should&nbsp;not&nbsp;be&nbsp;quoted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2175898">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175903">continue</span>&nbsp;<span class="comment" id="2175912">//&nbsp;All&nbsp;other&nbsp;multibyte&nbsp;runes&nbsp;are&nbsp;correctly&nbsp;encoded&nbsp;and&nbsp;assumed&nbsp;printable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2175988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2175992">if</span>&nbsp;<span class="ident" id="2175995">r</span>&nbsp;<span class="op" id="2175997">==</span>&nbsp;<span class="ident" id="2176000">utf8</span><span class="op" id="2176004">.</span><span class="ident" id="2176005">RuneError</span>&nbsp;<span class="op" id="2176015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176020">return</span>&nbsp;<span class="ident" id="2176027">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176035">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176039">if</span>&nbsp;<span class="op" id="2176042">(</span><span class="ident" id="2176043">r</span>&nbsp;<span class="op" id="2176045">&lt;</span>&nbsp;<span class="string" id="2176047">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="2176051">&amp;&amp;</span>&nbsp;<span class="ident" id="2176054">r</span>&nbsp;<span class="op" id="2176056">!=</span>&nbsp;<span class="string" id="2176059">&#39;\t&#39;</span><span class="op" id="2176063">)</span>&nbsp;<span class="op" id="2176065">||</span>&nbsp;<span class="ident" id="2176068">r</span>&nbsp;<span class="op" id="2176070">==</span>&nbsp;<span class="string" id="2176073">&#39;`&#39;</span>&nbsp;<span class="op" id="2176077">||</span>&nbsp;<span class="ident" id="2176080">r</span>&nbsp;<span class="op" id="2176082">==</span>&nbsp;<span class="string" id="2176085">&#39;\u007F&#39;</span>&nbsp;<span class="op" id="2176094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176099">return</span>&nbsp;<span class="ident" id="2176106">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176120">return</span>&nbsp;<span class="ident" id="2176127">true</span><br>
<span class="lineno">165</span><span class="op" id="2176132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2176135">func</span>&nbsp;<span class="ident" id="2176140">unhex</span><span class="op" id="2176145">(</span><span class="ident" id="2176146">b</span>&nbsp;<span class="builtintype" id="2176148">byte</span><span class="op" id="2176152">)</span>&nbsp;<span class="op" id="2176154">(</span><span class="ident" id="2176155">v</span>&nbsp;<span class="builtintype" id="2176157">rune</span><span class="op" id="2176161">,</span>&nbsp;<span class="ident" id="2176163">ok</span>&nbsp;<span class="builtintype" id="2176166">bool</span><span class="op" id="2176170">)</span>&nbsp;<span class="op" id="2176172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2176175">c</span>&nbsp;<span class="op" id="2176177">:=</span>&nbsp;<span class="builtintype" id="2176180">rune</span><span class="op" id="2176184">(</span><span class="ident" id="2176185">b</span><span class="op" id="2176186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176189">switch</span>&nbsp;<span class="op" id="2176196">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176199">case</span>&nbsp;<span class="string" id="2176204">&#39;0&#39;</span>&nbsp;<span class="op" id="2176208">&lt;=</span>&nbsp;<span class="ident" id="2176211">c</span>&nbsp;<span class="op" id="2176213">&amp;&amp;</span>&nbsp;<span class="ident" id="2176216">c</span>&nbsp;<span class="op" id="2176218">&lt;=</span>&nbsp;<span class="string" id="2176221">&#39;9&#39;</span><span class="op" id="2176224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176228">return</span>&nbsp;<span class="ident" id="2176235">c</span>&nbsp;<span class="op" id="2176237">-</span>&nbsp;<span class="string" id="2176239">&#39;0&#39;</span><span class="op" id="2176242">,</span>&nbsp;<span class="ident" id="2176244">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176250">case</span>&nbsp;<span class="string" id="2176255">&#39;a&#39;</span>&nbsp;<span class="op" id="2176259">&lt;=</span>&nbsp;<span class="ident" id="2176262">c</span>&nbsp;<span class="op" id="2176264">&amp;&amp;</span>&nbsp;<span class="ident" id="2176267">c</span>&nbsp;<span class="op" id="2176269">&lt;=</span>&nbsp;<span class="string" id="2176272">&#39;f&#39;</span><span class="op" id="2176275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176279">return</span>&nbsp;<span class="ident" id="2176286">c</span>&nbsp;<span class="op" id="2176288">-</span>&nbsp;<span class="string" id="2176290">&#39;a&#39;</span>&nbsp;<span class="op" id="2176294">+</span>&nbsp;<span class="num" id="2176296">10</span><span class="op" id="2176298">,</span>&nbsp;<span class="ident" id="2176300">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176306">case</span>&nbsp;<span class="string" id="2176311">&#39;A&#39;</span>&nbsp;<span class="op" id="2176315">&lt;=</span>&nbsp;<span class="ident" id="2176318">c</span>&nbsp;<span class="op" id="2176320">&amp;&amp;</span>&nbsp;<span class="ident" id="2176323">c</span>&nbsp;<span class="op" id="2176325">&lt;=</span>&nbsp;<span class="string" id="2176328">&#39;F&#39;</span><span class="op" id="2176331">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176335">return</span>&nbsp;<span class="ident" id="2176342">c</span>&nbsp;<span class="op" id="2176344">-</span>&nbsp;<span class="string" id="2176346">&#39;A&#39;</span>&nbsp;<span class="op" id="2176350">+</span>&nbsp;<span class="num" id="2176352">10</span><span class="op" id="2176354">,</span>&nbsp;<span class="ident" id="2176356">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2176362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2176365">return</span><br>
<span class="lineno"></span><span class="op" id="2176372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2176375">//&nbsp;UnquoteChar&nbsp;decodes&nbsp;the&nbsp;first&nbsp;character&nbsp;or&nbsp;byte&nbsp;in&nbsp;the&nbsp;escaped&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="2176448">//&nbsp;or&nbsp;character&nbsp;literal&nbsp;represented&nbsp;by&nbsp;the&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="comment" id="2176501">//&nbsp;It&nbsp;returns&nbsp;four&nbsp;values:</span><br>
<span class="lineno"></span><span class="comment" id="2176528">//</span><br>
<span class="lineno"></span><span class="comment" id="2176531">//&nbsp;&nbsp;&nbsp;&nbsp1)&nbsp;value,&nbsp;the&nbsp;decoded&nbsp;Unicode&nbsp;code&nbsp;point&nbsp;or&nbsp;byte&nbsp;value;</span><br>
<span class="lineno">185</span><span class="comment" id="2176590">//&nbsp;&nbsp;&nbsp;&nbsp2)&nbsp;multibyte,&nbsp;a&nbsp;boolean&nbsp;indicating&nbsp;whether&nbsp;the&nbsp;decoded&nbsp;character&nbsp;requires&nbsp;a&nbsp;multibyte&nbsp;UTF-8&nbsp;representation;</span><br>
<span class="lineno"></span><span class="comment" id="2176701">//&nbsp;&nbsp;&nbsp;&nbsp3)&nbsp;tail,&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string&nbsp;after&nbsp;the&nbsp;character;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2176766">//&nbsp;&nbsp;&nbsp;&nbsp4)&nbsp;an&nbsp;error&nbsp;that&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;character&nbsp;is&nbsp;syntactically&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="2176839">//</span><br>
<span class="lineno"></span><span class="comment" id="2176842">//&nbsp;The&nbsp;second&nbsp;argument,&nbsp;quote,&nbsp;specifies&nbsp;the&nbsp;type&nbsp;of&nbsp;literal&nbsp;being&nbsp;parsed</span><br>
<span class="lineno">190</span><span class="comment" id="2176916">//&nbsp;and&nbsp;therefore&nbsp;which&nbsp;escaped&nbsp;quote&nbsp;character&nbsp;is&nbsp;permitted.</span><br>
<span class="lineno"></span><span class="comment" id="2176977">//&nbsp;If&nbsp;set&nbsp;to&nbsp;a&nbsp;single&nbsp;quote,&nbsp;it&nbsp;permits&nbsp;the&nbsp;sequence&nbsp;\&#39;&nbsp;and&nbsp;disallows&nbsp;unescaped&nbsp;&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="2177060">//&nbsp;If&nbsp;set&nbsp;to&nbsp;a&nbsp;double&nbsp;quote,&nbsp;it&nbsp;permits&nbsp;\&#34;&nbsp;and&nbsp;disallows&nbsp;unescaped&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2177130">//&nbsp;If&nbsp;set&nbsp;to&nbsp;zero,&nbsp;it&nbsp;does&nbsp;not&nbsp;permit&nbsp;either&nbsp;escape&nbsp;and&nbsp;allows&nbsp;both&nbsp;quote&nbsp;characters&nbsp;to&nbsp;appear&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="2177236">func</span>&nbsp;<span class="ident" id="2177241">UnquoteChar</span><span class="op" id="2177252">(</span><span class="ident" id="2177253">s</span>&nbsp;<span class="builtintype" id="2177255">string</span><span class="op" id="2177261">,</span>&nbsp;<span class="ident" id="2177263">quote</span>&nbsp;<span class="builtintype" id="2177269">byte</span><span class="op" id="2177273">)</span>&nbsp;<span class="op" id="2177275">(</span><span class="ident" id="2177276">value</span>&nbsp;<span class="builtintype" id="2177282">rune</span><span class="op" id="2177286">,</span>&nbsp;<span class="ident" id="2177288">multibyte</span>&nbsp;<span class="builtintype" id="2177298">bool</span><span class="op" id="2177302">,</span>&nbsp;<span class="ident" id="2177304">tail</span>&nbsp;<span class="builtintype" id="2177309">string</span><span class="op" id="2177315">,</span>&nbsp;<span class="ident" id="2177317">err</span>&nbsp;<span class="builtintype" id="2177321">error</span><span class="op" id="2177326">)</span>&nbsp;<span class="op" id="2177328">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2177331">//&nbsp;easy&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177346">switch</span>&nbsp;<span class="ident" id="2177353">c</span>&nbsp;<span class="op" id="2177355">:=</span>&nbsp;<span class="ident" id="2177358">s</span><span class="op" id="2177359">[</span><span class="num" id="2177360">0</span><span class="op" id="2177361">]</span><span class="op" id="2177362">;</span>&nbsp;<span class="op" id="2177364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177367">case</span>&nbsp;<span class="ident" id="2177372">c</span>&nbsp;<span class="op" id="2177374">==</span>&nbsp;<span class="ident" id="2177377">quote</span>&nbsp;<span class="op" id="2177383">&amp;&amp;</span>&nbsp;<span class="op" id="2177386">(</span><span class="ident" id="2177387">quote</span>&nbsp;<span class="op" id="2177393">==</span>&nbsp;<span class="string" id="2177396">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2177401">||</span>&nbsp;<span class="ident" id="2177404">quote</span>&nbsp;<span class="op" id="2177410">==</span>&nbsp;<span class="string" id="2177413">&#39;&#34;&#39;</span><span class="op" id="2177416">)</span><span class="op" id="2177417">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177421">err</span>&nbsp;<span class="op" id="2177425">=</span>&nbsp;<span class="ident" id="2177427">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177439">return</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177447">case</span>&nbsp;<span class="ident" id="2177452">c</span>&nbsp;<span class="op" id="2177454">&gt;=</span>&nbsp;<span class="ident" id="2177457">utf8</span><span class="op" id="2177461">.</span><span class="ident" id="2177462">RuneSelf</span><span class="op" id="2177470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177474">r</span><span class="op" id="2177475">,</span>&nbsp;<span class="ident" id="2177477">size</span>&nbsp;<span class="op" id="2177482">:=</span>&nbsp;<span class="ident" id="2177485">utf8</span><span class="op" id="2177489">.</span><span class="ident" id="2177490">DecodeRuneInString</span><span class="op" id="2177508">(</span><span class="ident" id="2177509">s</span><span class="op" id="2177510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177514">return</span>&nbsp;<span class="ident" id="2177521">r</span><span class="op" id="2177522">,</span>&nbsp;<span class="ident" id="2177524">true</span><span class="op" id="2177528">,</span>&nbsp;<span class="ident" id="2177530">s</span><span class="op" id="2177531">[</span><span class="ident" id="2177532">size</span><span class="op" id="2177536">:</span><span class="op" id="2177537">]</span><span class="op" id="2177538">,</span>&nbsp;<span class="ident" id="2177540">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177545">case</span>&nbsp;<span class="ident" id="2177550">c</span>&nbsp;<span class="op" id="2177552">!=</span>&nbsp;<span class="string" id="2177555">&#39;\\&#39;</span><span class="op" id="2177559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177563">return</span>&nbsp;<span class="builtintype" id="2177570">rune</span><span class="op" id="2177574">(</span><span class="ident" id="2177575">s</span><span class="op" id="2177576">[</span><span class="num" id="2177577">0</span><span class="op" id="2177578">]</span><span class="op" id="2177579">)</span><span class="op" id="2177580">,</span>&nbsp;<span class="ident" id="2177582">false</span><span class="op" id="2177587">,</span>&nbsp;<span class="ident" id="2177589">s</span><span class="op" id="2177590">[</span><span class="num" id="2177591">1</span><span class="op" id="2177592">:</span><span class="op" id="2177593">]</span><span class="op" id="2177594">,</span>&nbsp;<span class="ident" id="2177596">nil</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2177601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2177605">//&nbsp;hard&nbsp;case:&nbsp;c&nbsp;is&nbsp;backslash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177635">if</span>&nbsp;<span class="builtinfunc" id="2177638">len</span><span class="op" id="2177641">(</span><span class="ident" id="2177642">s</span><span class="op" id="2177643">)</span>&nbsp;<span class="op" id="2177645">&lt;=</span>&nbsp;<span class="num" id="2177648">1</span>&nbsp;<span class="op" id="2177650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177654">err</span>&nbsp;<span class="op" id="2177658">=</span>&nbsp;<span class="ident" id="2177660">ErrSyntax</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2177680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177683">c</span>&nbsp;<span class="op" id="2177685">:=</span>&nbsp;<span class="ident" id="2177688">s</span><span class="op" id="2177689">[</span><span class="num" id="2177690">1</span><span class="op" id="2177691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177694">s</span>&nbsp;<span class="op" id="2177696">=</span>&nbsp;<span class="ident" id="2177698">s</span><span class="op" id="2177699">[</span><span class="num" id="2177700">2</span><span class="op" id="2177701">:</span><span class="op" id="2177702">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177706">switch</span>&nbsp;<span class="ident" id="2177713">c</span>&nbsp;<span class="op" id="2177715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177718">case</span>&nbsp;<span class="string" id="2177723">&#39;a&#39;</span><span class="op" id="2177726">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177730">value</span>&nbsp;<span class="op" id="2177736">=</span>&nbsp;<span class="string" id="2177738">&#39;\a&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177744">case</span>&nbsp;<span class="string" id="2177749">&#39;b&#39;</span><span class="op" id="2177752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177756">value</span>&nbsp;<span class="op" id="2177762">=</span>&nbsp;<span class="string" id="2177764">&#39;\b&#39;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177770">case</span>&nbsp;<span class="string" id="2177775">&#39;f&#39;</span><span class="op" id="2177778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177782">value</span>&nbsp;<span class="op" id="2177788">=</span>&nbsp;<span class="string" id="2177790">&#39;\f&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177796">case</span>&nbsp;<span class="string" id="2177801">&#39;n&#39;</span><span class="op" id="2177804">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177808">value</span>&nbsp;<span class="op" id="2177814">=</span>&nbsp;<span class="string" id="2177816">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177822">case</span>&nbsp;<span class="string" id="2177827">&#39;r&#39;</span><span class="op" id="2177830">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177834">value</span>&nbsp;<span class="op" id="2177840">=</span>&nbsp;<span class="string" id="2177842">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177848">case</span>&nbsp;<span class="string" id="2177853">&#39;t&#39;</span><span class="op" id="2177856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177860">value</span>&nbsp;<span class="op" id="2177866">=</span>&nbsp;<span class="string" id="2177868">&#39;\t&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177874">case</span>&nbsp;<span class="string" id="2177879">&#39;v&#39;</span><span class="op" id="2177882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177886">value</span>&nbsp;<span class="op" id="2177892">=</span>&nbsp;<span class="string" id="2177894">&#39;\v&#39;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177900">case</span>&nbsp;<span class="string" id="2177905">&#39;x&#39;</span><span class="op" id="2177908">,</span>&nbsp;<span class="string" id="2177910">&#39;u&#39;</span><span class="op" id="2177913">,</span>&nbsp;<span class="string" id="2177915">&#39;U&#39;</span><span class="op" id="2177918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177922">n</span>&nbsp;<span class="op" id="2177924">:=</span>&nbsp;<span class="num" id="2177927">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177931">switch</span>&nbsp;<span class="ident" id="2177938">c</span>&nbsp;<span class="op" id="2177940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177944">case</span>&nbsp;<span class="string" id="2177949">&#39;x&#39;</span><span class="op" id="2177952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177957">n</span>&nbsp;<span class="op" id="2177959">=</span>&nbsp;<span class="num" id="2177961">2</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177965">case</span>&nbsp;<span class="string" id="2177970">&#39;u&#39;</span><span class="op" id="2177973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177978">n</span>&nbsp;<span class="op" id="2177980">=</span>&nbsp;<span class="num" id="2177982">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2177986">case</span>&nbsp;<span class="string" id="2177991">&#39;U&#39;</span><span class="op" id="2177994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2177999">n</span>&nbsp;<span class="op" id="2178001">=</span>&nbsp;<span class="num" id="2178003">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178007">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178011">var</span>&nbsp;<span class="ident" id="2178015">v</span>&nbsp;<span class="builtintype" id="2178017">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178024">if</span>&nbsp;<span class="builtinfunc" id="2178027">len</span><span class="op" id="2178030">(</span><span class="ident" id="2178031">s</span><span class="op" id="2178032">)</span>&nbsp;<span class="op" id="2178034">&lt;</span>&nbsp;<span class="ident" id="2178036">n</span>&nbsp;<span class="op" id="2178038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178043">err</span>&nbsp;<span class="op" id="2178047">=</span>&nbsp;<span class="ident" id="2178049">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178062">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178071">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178075">for</span>&nbsp;<span class="ident" id="2178079">j</span>&nbsp;<span class="op" id="2178081">:=</span>&nbsp;<span class="num" id="2178084">0</span><span class="op" id="2178085">;</span>&nbsp;<span class="ident" id="2178087">j</span>&nbsp;<span class="op" id="2178089">&lt;</span>&nbsp;<span class="ident" id="2178091">n</span><span class="op" id="2178092">;</span>&nbsp;<span class="ident" id="2178094">j</span><span class="op" id="2178095">++</span>&nbsp;<span class="op" id="2178098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178103">x</span><span class="op" id="2178104">,</span>&nbsp;<span class="ident" id="2178106">ok</span>&nbsp;<span class="op" id="2178109">:=</span>&nbsp;<span class="ident" id="2178112">unhex</span><span class="op" id="2178117">(</span><span class="ident" id="2178118">s</span><span class="op" id="2178119">[</span><span class="ident" id="2178120">j</span><span class="op" id="2178121">]</span><span class="op" id="2178122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178127">if</span>&nbsp;<span class="op" id="2178130">!</span><span class="ident" id="2178131">ok</span>&nbsp;<span class="op" id="2178134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178140">err</span>&nbsp;<span class="op" id="2178144">=</span>&nbsp;<span class="ident" id="2178146">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178160">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178175">v</span>&nbsp;<span class="op" id="2178177">=</span>&nbsp;<span class="ident" id="2178179">v</span><span class="op" id="2178180">&lt;&lt;</span><span class="num" id="2178182">4</span>&nbsp;<span class="op" id="2178184">|</span>&nbsp;<span class="ident" id="2178186">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178194">s</span>&nbsp;<span class="op" id="2178196">=</span>&nbsp;<span class="ident" id="2178198">s</span><span class="op" id="2178199">[</span><span class="ident" id="2178200">n</span><span class="op" id="2178201">:</span><span class="op" id="2178202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178206">if</span>&nbsp;<span class="ident" id="2178209">c</span>&nbsp;<span class="op" id="2178211">==</span>&nbsp;<span class="string" id="2178214">&#39;x&#39;</span>&nbsp;<span class="op" id="2178218">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2178223">//&nbsp;single-byte&nbsp;string,&nbsp;possibly&nbsp;not&nbsp;UTF-8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178268">value</span>&nbsp;<span class="op" id="2178274">=</span>&nbsp;<span class="ident" id="2178276">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178281">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178293">if</span>&nbsp;<span class="ident" id="2178296">v</span>&nbsp;<span class="op" id="2178298">&gt;</span>&nbsp;<span class="ident" id="2178300">utf8</span><span class="op" id="2178304">.</span><span class="ident" id="2178305">MaxRune</span>&nbsp;<span class="op" id="2178313">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178318">err</span>&nbsp;<span class="op" id="2178322">=</span>&nbsp;<span class="ident" id="2178324">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178337">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178350">value</span>&nbsp;<span class="op" id="2178356">=</span>&nbsp;<span class="ident" id="2178358">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178362">multibyte</span>&nbsp;<span class="op" id="2178372">=</span>&nbsp;<span class="ident" id="2178374">true</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178380">case</span>&nbsp;<span class="string" id="2178385">&#39;0&#39;</span><span class="op" id="2178388">,</span>&nbsp;<span class="string" id="2178390">&#39;1&#39;</span><span class="op" id="2178393">,</span>&nbsp;<span class="string" id="2178395">&#39;2&#39;</span><span class="op" id="2178398">,</span>&nbsp;<span class="string" id="2178400">&#39;3&#39;</span><span class="op" id="2178403">,</span>&nbsp;<span class="string" id="2178405">&#39;4&#39;</span><span class="op" id="2178408">,</span>&nbsp;<span class="string" id="2178410">&#39;5&#39;</span><span class="op" id="2178413">,</span>&nbsp;<span class="string" id="2178415">&#39;6&#39;</span><span class="op" id="2178418">,</span>&nbsp;<span class="string" id="2178420">&#39;7&#39;</span><span class="op" id="2178423">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178427">v</span>&nbsp;<span class="op" id="2178429">:=</span>&nbsp;<span class="builtintype" id="2178432">rune</span><span class="op" id="2178436">(</span><span class="ident" id="2178437">c</span><span class="op" id="2178438">)</span>&nbsp;<span class="op" id="2178440">-</span>&nbsp;<span class="string" id="2178442">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178448">if</span>&nbsp;<span class="builtinfunc" id="2178451">len</span><span class="op" id="2178454">(</span><span class="ident" id="2178455">s</span><span class="op" id="2178456">)</span>&nbsp;<span class="op" id="2178458">&lt;</span>&nbsp;<span class="num" id="2178460">2</span>&nbsp;<span class="op" id="2178462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178467">err</span>&nbsp;<span class="op" id="2178471">=</span>&nbsp;<span class="ident" id="2178473">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178486">return</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178499">for</span>&nbsp;<span class="ident" id="2178503">j</span>&nbsp;<span class="op" id="2178505">:=</span>&nbsp;<span class="num" id="2178508">0</span><span class="op" id="2178509">;</span>&nbsp;<span class="ident" id="2178511">j</span>&nbsp;<span class="op" id="2178513">&lt;</span>&nbsp;<span class="num" id="2178515">2</span><span class="op" id="2178516">;</span>&nbsp;<span class="ident" id="2178518">j</span><span class="op" id="2178519">++</span>&nbsp;<span class="op" id="2178522">{</span>&nbsp;<span class="comment" id="2178524">//&nbsp;one&nbsp;digit&nbsp;already;&nbsp;two&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178558">x</span>&nbsp;<span class="op" id="2178560">:=</span>&nbsp;<span class="builtintype" id="2178563">rune</span><span class="op" id="2178567">(</span><span class="ident" id="2178568">s</span><span class="op" id="2178569">[</span><span class="ident" id="2178570">j</span><span class="op" id="2178571">]</span><span class="op" id="2178572">)</span>&nbsp;<span class="op" id="2178574">-</span>&nbsp;<span class="string" id="2178576">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178583">if</span>&nbsp;<span class="ident" id="2178586">x</span>&nbsp;<span class="op" id="2178588">&lt;</span>&nbsp;<span class="num" id="2178590">0</span>&nbsp;<span class="op" id="2178592">||</span>&nbsp;<span class="ident" id="2178595">x</span>&nbsp;<span class="op" id="2178597">&gt;</span>&nbsp;<span class="num" id="2178599">7</span>&nbsp;<span class="op" id="2178601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178607">err</span>&nbsp;<span class="op" id="2178611">=</span>&nbsp;<span class="ident" id="2178613">ErrSyntax</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178627">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178642">v</span>&nbsp;<span class="op" id="2178644">=</span>&nbsp;<span class="op" id="2178646">(</span><span class="ident" id="2178647">v</span>&nbsp;<span class="op" id="2178649">&lt;&lt;</span>&nbsp;<span class="num" id="2178652">3</span><span class="op" id="2178653">)</span>&nbsp;<span class="op" id="2178655">|</span>&nbsp;<span class="ident" id="2178657">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178665">s</span>&nbsp;<span class="op" id="2178667">=</span>&nbsp;<span class="ident" id="2178669">s</span><span class="op" id="2178670">[</span><span class="num" id="2178671">2</span><span class="op" id="2178672">:</span><span class="op" id="2178673">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178677">if</span>&nbsp;<span class="ident" id="2178680">v</span>&nbsp;<span class="op" id="2178682">&gt;</span>&nbsp;<span class="num" id="2178684">255</span>&nbsp;<span class="op" id="2178688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178693">err</span>&nbsp;<span class="op" id="2178697">=</span>&nbsp;<span class="ident" id="2178699">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178712">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178725">value</span>&nbsp;<span class="op" id="2178731">=</span>&nbsp;<span class="ident" id="2178733">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178736">case</span>&nbsp;<span class="string" id="2178741">&#39;\\&#39;</span><span class="op" id="2178745">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178749">value</span>&nbsp;<span class="op" id="2178755">=</span>&nbsp;<span class="string" id="2178757">&#39;\\&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178763">case</span>&nbsp;<span class="string" id="2178768">&#39;\&#39;&#39;</span><span class="op" id="2178772">,</span>&nbsp;<span class="string" id="2178774">&#39;&#34;&#39;</span><span class="op" id="2178777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178781">if</span>&nbsp;<span class="ident" id="2178784">c</span>&nbsp;<span class="op" id="2178786">!=</span>&nbsp;<span class="ident" id="2178789">quote</span>&nbsp;<span class="op" id="2178795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178800">err</span>&nbsp;<span class="op" id="2178804">=</span>&nbsp;<span class="ident" id="2178806">ErrSyntax</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178819">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178832">value</span>&nbsp;<span class="op" id="2178838">=</span>&nbsp;<span class="builtintype" id="2178840">rune</span><span class="op" id="2178844">(</span><span class="ident" id="2178845">c</span><span class="op" id="2178846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178849">default</span><span class="op" id="2178856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178860">err</span>&nbsp;<span class="op" id="2178864">=</span>&nbsp;<span class="ident" id="2178866">ErrSyntax</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178878">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2178886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2178889">tail</span>&nbsp;<span class="op" id="2178894">=</span>&nbsp;<span class="ident" id="2178896">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2178899">return</span><br>
<span class="lineno"></span><span class="op" id="2178906">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="comment" id="2178909">//&nbsp;Unquote&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;single-quoted,&nbsp;double-quoted,</span><br>
<span class="lineno"></span><span class="comment" id="2178968">//&nbsp;or&nbsp;backquoted&nbsp;Go&nbsp;string&nbsp;literal,&nbsp;returning&nbsp;the&nbsp;string&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="2179031">//&nbsp;that&nbsp;s&nbsp;quotes.&nbsp;&nbsp;(If&nbsp;s&nbsp;is&nbsp;single-quoted,&nbsp;it&nbsp;would&nbsp;be&nbsp;a&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="2179091">//&nbsp;character&nbsp;literal;&nbsp;Unquote&nbsp;returns&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno">305</span><span class="comment" id="2179147">//&nbsp;one-character&nbsp;string.)</span><br>
<span class="lineno"></span><span class="keyword" id="2179173">func</span>&nbsp;<span class="ident" id="2179178">Unquote</span><span class="op" id="2179185">(</span><span class="ident" id="2179186">s</span>&nbsp;<span class="builtintype" id="2179188">string</span><span class="op" id="2179194">)</span>&nbsp;<span class="op" id="2179196">(</span><span class="ident" id="2179197">t</span>&nbsp;<span class="builtintype" id="2179199">string</span><span class="op" id="2179205">,</span>&nbsp;<span class="ident" id="2179207">err</span>&nbsp;<span class="builtintype" id="2179211">error</span><span class="op" id="2179216">)</span>&nbsp;<span class="op" id="2179218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2179221">n</span>&nbsp;<span class="op" id="2179223">:=</span>&nbsp;<span class="builtinfunc" id="2179226">len</span><span class="op" id="2179229">(</span><span class="ident" id="2179230">s</span><span class="op" id="2179231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179234">if</span>&nbsp;<span class="ident" id="2179237">n</span>&nbsp;<span class="op" id="2179239">&lt;</span>&nbsp;<span class="num" id="2179241">2</span>&nbsp;<span class="op" id="2179243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179247">return</span>&nbsp;<span class="string" id="2179254">&#34;&#34;</span><span class="op" id="2179256">,</span>&nbsp;<span class="ident" id="2179258">ErrSyntax</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2179272">quote</span>&nbsp;<span class="op" id="2179278">:=</span>&nbsp;<span class="ident" id="2179281">s</span><span class="op" id="2179282">[</span><span class="num" id="2179283">0</span><span class="op" id="2179284">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179287">if</span>&nbsp;<span class="ident" id="2179290">quote</span>&nbsp;<span class="op" id="2179296">!=</span>&nbsp;<span class="ident" id="2179299">s</span><span class="op" id="2179300">[</span><span class="ident" id="2179301">n</span><span class="op" id="2179302">-</span><span class="num" id="2179303">1</span><span class="op" id="2179304">]</span>&nbsp;<span class="op" id="2179306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179310">return</span>&nbsp;<span class="string" id="2179317">&#34;&#34;</span><span class="op" id="2179319">,</span>&nbsp;<span class="ident" id="2179321">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179332">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2179335">s</span>&nbsp;<span class="op" id="2179337">=</span>&nbsp;<span class="ident" id="2179339">s</span><span class="op" id="2179340">[</span><span class="num" id="2179341">1</span>&nbsp;<span class="op" id="2179343">:</span>&nbsp;<span class="ident" id="2179345">n</span><span class="op" id="2179346">-</span><span class="num" id="2179347">1</span><span class="op" id="2179348">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179352">if</span>&nbsp;<span class="ident" id="2179355">quote</span>&nbsp;<span class="op" id="2179361">==</span>&nbsp;<span class="string" id="2179364">&#39;`&#39;</span>&nbsp;<span class="op" id="2179368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179372">if</span>&nbsp;<span class="ident" id="2179375">contains</span><span class="op" id="2179383">(</span><span class="ident" id="2179384">s</span><span class="op" id="2179385">,</span>&nbsp;<span class="string" id="2179387">&#39;`&#39;</span><span class="op" id="2179390">)</span>&nbsp;<span class="op" id="2179392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179397">return</span>&nbsp;<span class="string" id="2179404">&#34;&#34;</span><span class="op" id="2179406">,</span>&nbsp;<span class="ident" id="2179408">ErrSyntax</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179424">return</span>&nbsp;<span class="ident" id="2179431">s</span><span class="op" id="2179432">,</span>&nbsp;<span class="ident" id="2179434">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179442">if</span>&nbsp;<span class="ident" id="2179445">quote</span>&nbsp;<span class="op" id="2179451">!=</span>&nbsp;<span class="string" id="2179454">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="2179458">&amp;&amp;</span>&nbsp;<span class="ident" id="2179461">quote</span>&nbsp;<span class="op" id="2179467">!=</span>&nbsp;<span class="string" id="2179470">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2179475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179479">return</span>&nbsp;<span class="string" id="2179486">&#34;&#34;</span><span class="op" id="2179488">,</span>&nbsp;<span class="ident" id="2179490">ErrSyntax</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179504">if</span>&nbsp;<span class="ident" id="2179507">contains</span><span class="op" id="2179515">(</span><span class="ident" id="2179516">s</span><span class="op" id="2179517">,</span>&nbsp;<span class="string" id="2179519">&#39;\n&#39;</span><span class="op" id="2179523">)</span>&nbsp;<span class="op" id="2179525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179529">return</span>&nbsp;<span class="string" id="2179536">&#34;&#34;</span><span class="op" id="2179538">,</span>&nbsp;<span class="ident" id="2179540">ErrSyntax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2179555">//&nbsp;Is&nbsp;it&nbsp;trivial?&nbsp;&nbsp;Avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179593">if</span>&nbsp;<span class="op" id="2179596">!</span><span class="ident" id="2179597">contains</span><span class="op" id="2179605">(</span><span class="ident" id="2179606">s</span><span class="op" id="2179607">,</span>&nbsp;<span class="string" id="2179609">&#39;\\&#39;</span><span class="op" id="2179613">)</span>&nbsp;<span class="op" id="2179615">&amp;&amp;</span>&nbsp;<span class="op" id="2179618">!</span><span class="ident" id="2179619">contains</span><span class="op" id="2179627">(</span><span class="ident" id="2179628">s</span><span class="op" id="2179629">,</span>&nbsp;<span class="ident" id="2179631">quote</span><span class="op" id="2179636">)</span>&nbsp;<span class="op" id="2179638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179642">switch</span>&nbsp;<span class="ident" id="2179649">quote</span>&nbsp;<span class="op" id="2179655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179659">case</span>&nbsp;<span class="string" id="2179664">&#39;&#34;&#39;</span><span class="op" id="2179667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179672">return</span>&nbsp;<span class="ident" id="2179679">s</span><span class="op" id="2179680">,</span>&nbsp;<span class="ident" id="2179682">nil</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179688">case</span>&nbsp;<span class="string" id="2179693">&#39;\&#39;&#39;</span><span class="op" id="2179697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2179702">r</span><span class="op" id="2179703">,</span>&nbsp;<span class="ident" id="2179705">size</span>&nbsp;<span class="op" id="2179710">:=</span>&nbsp;<span class="ident" id="2179713">utf8</span><span class="op" id="2179717">.</span><span class="ident" id="2179718">DecodeRuneInString</span><span class="op" id="2179736">(</span><span class="ident" id="2179737">s</span><span class="op" id="2179738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179743">if</span>&nbsp;<span class="ident" id="2179746">size</span>&nbsp;<span class="op" id="2179751">==</span>&nbsp;<span class="builtinfunc" id="2179754">len</span><span class="op" id="2179757">(</span><span class="ident" id="2179758">s</span><span class="op" id="2179759">)</span>&nbsp;<span class="op" id="2179761">&amp;&amp;</span>&nbsp;<span class="op" id="2179764">(</span><span class="ident" id="2179765">r</span>&nbsp;<span class="op" id="2179767">!=</span>&nbsp;<span class="ident" id="2179770">utf8</span><span class="op" id="2179774">.</span><span class="ident" id="2179775">RuneError</span>&nbsp;<span class="op" id="2179785">||</span>&nbsp;<span class="ident" id="2179788">size</span>&nbsp;<span class="op" id="2179793">!=</span>&nbsp;<span class="num" id="2179796">1</span><span class="op" id="2179797">)</span>&nbsp;<span class="op" id="2179799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179805">return</span>&nbsp;<span class="ident" id="2179812">s</span><span class="op" id="2179813">,</span>&nbsp;<span class="ident" id="2179815">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179822">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2179829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179833">var</span>&nbsp;<span class="ident" id="2179837">runeTmp</span>&nbsp;<span class="op" id="2179845">[</span><span class="ident" id="2179846">utf8</span><span class="op" id="2179850">.</span><span class="ident" id="2179851">UTFMax</span><span class="op" id="2179857">]</span><span class="builtintype" id="2179858">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2179864">buf</span>&nbsp;<span class="op" id="2179868">:=</span>&nbsp;<span class="builtinfunc" id="2179871">make</span><span class="op" id="2179875">(</span><span class="op" id="2179876">[</span><span class="op" id="2179877">]</span><span class="builtintype" id="2179878">byte</span><span class="op" id="2179882">,</span>&nbsp;<span class="num" id="2179884">0</span><span class="op" id="2179885">,</span>&nbsp;<span class="num" id="2179887">3</span><span class="op" id="2179888">*</span><span class="builtinfunc" id="2179889">len</span><span class="op" id="2179892">(</span><span class="ident" id="2179893">s</span><span class="op" id="2179894">)</span><span class="op" id="2179895">/</span><span class="num" id="2179896">2</span><span class="op" id="2179897">)</span>&nbsp;<span class="comment" id="2179899">//&nbsp;Try&nbsp;to&nbsp;avoid&nbsp;more&nbsp;allocations.</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2179934">for</span>&nbsp;<span class="builtinfunc" id="2179938">len</span><span class="op" id="2179941">(</span><span class="ident" id="2179942">s</span><span class="op" id="2179943">)</span>&nbsp;<span class="op" id="2179945">&gt;</span>&nbsp;<span class="num" id="2179947">0</span>&nbsp;<span class="op" id="2179949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2179953">c</span><span class="op" id="2179954">,</span>&nbsp;<span class="ident" id="2179956">multibyte</span><span class="op" id="2179965">,</span>&nbsp;<span class="ident" id="2179967">ss</span><span class="op" id="2179969">,</span>&nbsp;<span class="ident" id="2179971">err</span>&nbsp;<span class="op" id="2179975">:=</span>&nbsp;<span class="ident" id="2179978">UnquoteChar</span><span class="op" id="2179989">(</span><span class="ident" id="2179990">s</span><span class="op" id="2179991">,</span>&nbsp;<span class="ident" id="2179993">quote</span><span class="op" id="2179998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180002">if</span>&nbsp;<span class="ident" id="2180005">err</span>&nbsp;<span class="op" id="2180009">!=</span>&nbsp;<span class="ident" id="2180012">nil</span>&nbsp;<span class="op" id="2180016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180021">return</span>&nbsp;<span class="string" id="2180028">&#34;&#34;</span><span class="op" id="2180030">,</span>&nbsp;<span class="ident" id="2180032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180038">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180042">s</span>&nbsp;<span class="op" id="2180044">=</span>&nbsp;<span class="ident" id="2180046">ss</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180051">if</span>&nbsp;<span class="ident" id="2180054">c</span>&nbsp;<span class="op" id="2180056">&lt;</span>&nbsp;<span class="ident" id="2180058">utf8</span><span class="op" id="2180062">.</span><span class="ident" id="2180063">RuneSelf</span>&nbsp;<span class="op" id="2180072">||</span>&nbsp;<span class="op" id="2180075">!</span><span class="ident" id="2180076">multibyte</span>&nbsp;<span class="op" id="2180086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180091">buf</span>&nbsp;<span class="op" id="2180095">=</span>&nbsp;<span class="builtinfunc" id="2180097">append</span><span class="op" id="2180103">(</span><span class="ident" id="2180104">buf</span><span class="op" id="2180107">,</span>&nbsp;<span class="builtintype" id="2180109">byte</span><span class="op" id="2180113">(</span><span class="ident" id="2180114">c</span><span class="op" id="2180115">)</span><span class="op" id="2180116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180120">}</span>&nbsp;<span class="keyword" id="2180122">else</span>&nbsp;<span class="op" id="2180127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180132">n</span>&nbsp;<span class="op" id="2180134">:=</span>&nbsp;<span class="ident" id="2180137">utf8</span><span class="op" id="2180141">.</span><span class="ident" id="2180142">EncodeRune</span><span class="op" id="2180152">(</span><span class="ident" id="2180153">runeTmp</span><span class="op" id="2180160">[</span><span class="op" id="2180161">:</span><span class="op" id="2180162">]</span><span class="op" id="2180163">,</span>&nbsp;<span class="ident" id="2180165">c</span><span class="op" id="2180166">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180171">buf</span>&nbsp;<span class="op" id="2180175">=</span>&nbsp;<span class="builtinfunc" id="2180177">append</span><span class="op" id="2180183">(</span><span class="ident" id="2180184">buf</span><span class="op" id="2180187">,</span>&nbsp;<span class="ident" id="2180189">runeTmp</span><span class="op" id="2180196">[</span><span class="op" id="2180197">:</span><span class="ident" id="2180198">n</span><span class="op" id="2180199">]</span><span class="op" id="2180200">...</span><span class="op" id="2180203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180211">if</span>&nbsp;<span class="ident" id="2180214">quote</span>&nbsp;<span class="op" id="2180220">==</span>&nbsp;<span class="string" id="2180223">&#39;\&#39;&#39;</span>&nbsp;<span class="op" id="2180228">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2180231">len</span><span class="op" id="2180234">(</span><span class="ident" id="2180235">s</span><span class="op" id="2180236">)</span>&nbsp;<span class="op" id="2180238">!=</span>&nbsp;<span class="num" id="2180241">0</span>&nbsp;<span class="op" id="2180243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2180248">//&nbsp;single-quoted&nbsp;must&nbsp;be&nbsp;single&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180293">return</span>&nbsp;<span class="string" id="2180300">&#34;&#34;</span><span class="op" id="2180302">,</span>&nbsp;<span class="ident" id="2180304">ErrSyntax</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180322">return</span>&nbsp;<span class="builtintype" id="2180329">string</span><span class="op" id="2180335">(</span><span class="ident" id="2180336">buf</span><span class="op" id="2180339">)</span><span class="op" id="2180340">,</span>&nbsp;<span class="ident" id="2180342">nil</span><br>
<span class="lineno"></span><span class="op" id="2180346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="2180349">//&nbsp;contains&nbsp;reports&nbsp;whether&nbsp;the&nbsp;string&nbsp;contains&nbsp;the&nbsp;byte&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="2180409">func</span>&nbsp;<span class="ident" id="2180414">contains</span><span class="op" id="2180422">(</span><span class="ident" id="2180423">s</span>&nbsp;<span class="builtintype" id="2180425">string</span><span class="op" id="2180431">,</span>&nbsp;<span class="ident" id="2180433">c</span>&nbsp;<span class="builtintype" id="2180435">byte</span><span class="op" id="2180439">)</span>&nbsp;<span class="builtintype" id="2180441">bool</span>&nbsp;<span class="op" id="2180446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180449">for</span>&nbsp;<span class="ident" id="2180453">i</span>&nbsp;<span class="op" id="2180455">:=</span>&nbsp;<span class="num" id="2180458">0</span><span class="op" id="2180459">;</span>&nbsp;<span class="ident" id="2180461">i</span>&nbsp;<span class="op" id="2180463">&lt;</span>&nbsp;<span class="builtinfunc" id="2180465">len</span><span class="op" id="2180468">(</span><span class="ident" id="2180469">s</span><span class="op" id="2180470">)</span><span class="op" id="2180471">;</span>&nbsp;<span class="ident" id="2180473">i</span><span class="op" id="2180474">++</span>&nbsp;<span class="op" id="2180477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180481">if</span>&nbsp;<span class="ident" id="2180484">s</span><span class="op" id="2180485">[</span><span class="ident" id="2180486">i</span><span class="op" id="2180487">]</span>&nbsp;<span class="op" id="2180489">==</span>&nbsp;<span class="ident" id="2180492">c</span>&nbsp;<span class="op" id="2180494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180499">return</span>&nbsp;<span class="ident" id="2180506">true</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180519">return</span>&nbsp;<span class="ident" id="2180526">false</span><br>
<span class="lineno"></span><span class="op" id="2180532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="2180535">//&nbsp;bsearch16&nbsp;returns&nbsp;the&nbsp;smallest&nbsp;i&nbsp;such&nbsp;that&nbsp;a[i]&nbsp;&gt;=&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="2180592">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;i,&nbsp;bsearch16&nbsp;returns&nbsp;len(a).</span><br>
<span class="lineno"></span><span class="keyword" id="2180644">func</span>&nbsp;<span class="ident" id="2180649">bsearch16</span><span class="op" id="2180658">(</span><span class="ident" id="2180659">a</span>&nbsp;<span class="op" id="2180661">[</span><span class="op" id="2180662">]</span><span class="builtintype" id="2180663">uint16</span><span class="op" id="2180669">,</span>&nbsp;<span class="ident" id="2180671">x</span>&nbsp;<span class="builtintype" id="2180673">uint16</span><span class="op" id="2180679">)</span>&nbsp;<span class="builtintype" id="2180681">int</span>&nbsp;<span class="op" id="2180685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180688">i</span><span class="op" id="2180689">,</span>&nbsp;<span class="ident" id="2180691">j</span>&nbsp;<span class="op" id="2180693">:=</span>&nbsp;<span class="num" id="2180696">0</span><span class="op" id="2180697">,</span>&nbsp;<span class="builtinfunc" id="2180699">len</span><span class="op" id="2180702">(</span><span class="ident" id="2180703">a</span><span class="op" id="2180704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180707">for</span>&nbsp;<span class="ident" id="2180711">i</span>&nbsp;<span class="op" id="2180713">&lt;</span>&nbsp;<span class="ident" id="2180715">j</span>&nbsp;<span class="op" id="2180717">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180721">h</span>&nbsp;<span class="op" id="2180723">:=</span>&nbsp;<span class="ident" id="2180726">i</span>&nbsp;<span class="op" id="2180728">+</span>&nbsp;<span class="op" id="2180730">(</span><span class="ident" id="2180731">j</span><span class="op" id="2180732">-</span><span class="ident" id="2180733">i</span><span class="op" id="2180734">)</span><span class="op" id="2180735">/</span><span class="num" id="2180736">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180740">if</span>&nbsp;<span class="ident" id="2180743">a</span><span class="op" id="2180744">[</span><span class="ident" id="2180745">h</span><span class="op" id="2180746">]</span>&nbsp;<span class="op" id="2180748">&lt;</span>&nbsp;<span class="ident" id="2180750">x</span>&nbsp;<span class="op" id="2180752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180757">i</span>&nbsp;<span class="op" id="2180759">=</span>&nbsp;<span class="ident" id="2180761">h</span>&nbsp;<span class="op" id="2180763">+</span>&nbsp;<span class="num" id="2180765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180769">}</span>&nbsp;<span class="keyword" id="2180771">else</span>&nbsp;<span class="op" id="2180776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180781">j</span>&nbsp;<span class="op" id="2180783">=</span>&nbsp;<span class="ident" id="2180785">h</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2180792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180795">return</span>&nbsp;<span class="ident" id="2180802">i</span><br>
<span class="lineno"></span><span class="op" id="2180804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="comment" id="2180807">//&nbsp;bsearch32&nbsp;returns&nbsp;the&nbsp;smallest&nbsp;i&nbsp;such&nbsp;that&nbsp;a[i]&nbsp;&gt;=&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="2180864">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;i,&nbsp;bsearch32&nbsp;returns&nbsp;len(a).</span><br>
<span class="lineno"></span><span class="keyword" id="2180916">func</span>&nbsp;<span class="ident" id="2180921">bsearch32</span><span class="op" id="2180930">(</span><span class="ident" id="2180931">a</span>&nbsp;<span class="op" id="2180933">[</span><span class="op" id="2180934">]</span><span class="builtintype" id="2180935">uint32</span><span class="op" id="2180941">,</span>&nbsp;<span class="ident" id="2180943">x</span>&nbsp;<span class="builtintype" id="2180945">uint32</span><span class="op" id="2180951">)</span>&nbsp;<span class="builtintype" id="2180953">int</span>&nbsp;<span class="op" id="2180957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180960">i</span><span class="op" id="2180961">,</span>&nbsp;<span class="ident" id="2180963">j</span>&nbsp;<span class="op" id="2180965">:=</span>&nbsp;<span class="num" id="2180968">0</span><span class="op" id="2180969">,</span>&nbsp;<span class="builtinfunc" id="2180971">len</span><span class="op" id="2180974">(</span><span class="ident" id="2180975">a</span><span class="op" id="2180976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2180979">for</span>&nbsp;<span class="ident" id="2180983">i</span>&nbsp;<span class="op" id="2180985">&lt;</span>&nbsp;<span class="ident" id="2180987">j</span>&nbsp;<span class="op" id="2180989">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2180993">h</span>&nbsp;<span class="op" id="2180995">:=</span>&nbsp;<span class="ident" id="2180998">i</span>&nbsp;<span class="op" id="2181000">+</span>&nbsp;<span class="op" id="2181002">(</span><span class="ident" id="2181003">j</span><span class="op" id="2181004">-</span><span class="ident" id="2181005">i</span><span class="op" id="2181006">)</span><span class="op" id="2181007">/</span><span class="num" id="2181008">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181012">if</span>&nbsp;<span class="ident" id="2181015">a</span><span class="op" id="2181016">[</span><span class="ident" id="2181017">h</span><span class="op" id="2181018">]</span>&nbsp;<span class="op" id="2181020">&lt;</span>&nbsp;<span class="ident" id="2181022">x</span>&nbsp;<span class="op" id="2181024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2181029">i</span>&nbsp;<span class="op" id="2181031">=</span>&nbsp;<span class="ident" id="2181033">h</span>&nbsp;<span class="op" id="2181035">+</span>&nbsp;<span class="num" id="2181037">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2181041">}</span>&nbsp;<span class="keyword" id="2181043">else</span>&nbsp;<span class="op" id="2181048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2181053">j</span>&nbsp;<span class="op" id="2181055">=</span>&nbsp;<span class="ident" id="2181057">h</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2181061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2181064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181067">return</span>&nbsp;<span class="ident" id="2181074">i</span><br>
<span class="lineno"></span><span class="op" id="2181076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="2181079">//&nbsp;TODO:&nbsp;IsPrint&nbsp;is&nbsp;a&nbsp;local&nbsp;implementation&nbsp;of&nbsp;unicode.IsPrint,&nbsp;verified&nbsp;by&nbsp;the&nbsp;tests</span><br>
<span class="lineno"></span><span class="comment" id="2181164">//&nbsp;to&nbsp;give&nbsp;the&nbsp;same&nbsp;answer.&nbsp;It&nbsp;allows&nbsp;this&nbsp;package&nbsp;not&nbsp;to&nbsp;depend&nbsp;on&nbsp;unicode,</span><br>
<span class="lineno"></span><span class="comment" id="2181241">//&nbsp;and&nbsp;therefore&nbsp;not&nbsp;pull&nbsp;in&nbsp;all&nbsp;the&nbsp;Unicode&nbsp;tables.&nbsp;If&nbsp;the&nbsp;linker&nbsp;were&nbsp;better</span><br>
<span class="lineno"></span><span class="comment" id="2181320">//&nbsp;at&nbsp;tossing&nbsp;unused&nbsp;tables,&nbsp;we&nbsp;could&nbsp;get&nbsp;rid&nbsp;of&nbsp;this&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="2181390">//&nbsp;That&nbsp;would&nbsp;be&nbsp;nice.</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="2181414">//&nbsp;IsPrint&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;is&nbsp;defined&nbsp;as&nbsp;printable&nbsp;by&nbsp;Go,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2181486">//&nbsp;the&nbsp;same&nbsp;definition&nbsp;as&nbsp;unicode.IsPrint:&nbsp;letters,&nbsp;numbers,&nbsp;punctuation,</span><br>
<span class="lineno"></span><span class="comment" id="2181560">//&nbsp;symbols&nbsp;and&nbsp;ASCII&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2181588">func</span>&nbsp;<span class="ident" id="2181593">IsPrint</span><span class="op" id="2181600">(</span><span class="ident" id="2181601">r</span>&nbsp;<span class="builtintype" id="2181603">rune</span><span class="op" id="2181607">)</span>&nbsp;<span class="builtintype" id="2181609">bool</span>&nbsp;<span class="op" id="2181614">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2181617">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;Latin-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181644">if</span>&nbsp;<span class="ident" id="2181647">r</span>&nbsp;<span class="op" id="2181649">&lt;=</span>&nbsp;<span class="num" id="2181652">0xFF</span>&nbsp;<span class="op" id="2181657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181661">if</span>&nbsp;<span class="num" id="2181664">0x20</span>&nbsp;<span class="op" id="2181669">&lt;=</span>&nbsp;<span class="ident" id="2181672">r</span>&nbsp;<span class="op" id="2181674">&amp;&amp;</span>&nbsp;<span class="ident" id="2181677">r</span>&nbsp;<span class="op" id="2181679">&lt;=</span>&nbsp;<span class="num" id="2181682">0x7E</span>&nbsp;<span class="op" id="2181687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2181692">//&nbsp;All&nbsp;the&nbsp;ASCII&nbsp;is&nbsp;printable&nbsp;from&nbsp;space&nbsp;through&nbsp;DEL-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181751">return</span>&nbsp;<span class="ident" id="2181758">true</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2181765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181769">if</span>&nbsp;<span class="num" id="2181772">0xA1</span>&nbsp;<span class="op" id="2181777">&lt;=</span>&nbsp;<span class="ident" id="2181780">r</span>&nbsp;<span class="op" id="2181782">&amp;&amp;</span>&nbsp;<span class="ident" id="2181785">r</span>&nbsp;<span class="op" id="2181787">&lt;=</span>&nbsp;<span class="num" id="2181790">0xFF</span>&nbsp;<span class="op" id="2181795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2181800">//&nbsp;Similarly&nbsp;for&nbsp;¡&nbsp;through&nbsp;ÿ...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181837">return</span>&nbsp;<span class="ident" id="2181844">r</span>&nbsp;<span class="op" id="2181846">!=</span>&nbsp;<span class="num" id="2181849">0xAD</span>&nbsp;<span class="comment" id="2181854">//&nbsp;...except&nbsp;for&nbsp;the&nbsp;bizarre&nbsp;soft&nbsp;hyphen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2181898">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2181902">return</span>&nbsp;<span class="ident" id="2181909">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2181916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2181920">//&nbsp;Same&nbsp;algorithm,&nbsp;either&nbsp;on&nbsp;uint16&nbsp;or&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2181974">//&nbsp;First,&nbsp;find&nbsp;first&nbsp;i&nbsp;such&nbsp;that&nbsp;isPrint[i]&nbsp;&gt;=&nbsp;x.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2182025">//&nbsp;This&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;either&nbsp;the&nbsp;start&nbsp;or&nbsp;end&nbsp;of&nbsp;a&nbsp;pair&nbsp;that&nbsp;might&nbsp;span&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2182103">//&nbsp;The&nbsp;start&nbsp;is&nbsp;even&nbsp;(isPrint[i&amp;^1])&nbsp;and&nbsp;the&nbsp;end&nbsp;is&nbsp;odd&nbsp;(isPrint[i|1]).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2182176">//&nbsp;If&nbsp;we&nbsp;find&nbsp;x&nbsp;in&nbsp;a&nbsp;range,&nbsp;make&nbsp;sure&nbsp;x&nbsp;is&nbsp;not&nbsp;in&nbsp;isNotPrint&nbsp;list.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182245">if</span>&nbsp;<span class="num" id="2182248">0</span>&nbsp;<span class="op" id="2182250">&lt;=</span>&nbsp;<span class="ident" id="2182253">r</span>&nbsp;<span class="op" id="2182255">&amp;&amp;</span>&nbsp;<span class="ident" id="2182258">r</span>&nbsp;<span class="op" id="2182260">&lt;</span>&nbsp;<span class="num" id="2182262">1</span><span class="op" id="2182263">&lt;&lt;</span><span class="num" id="2182265">16</span>&nbsp;<span class="op" id="2182268">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182272">rr</span><span class="op" id="2182274">,</span>&nbsp;<span class="ident" id="2182276">isPrint</span><span class="op" id="2182283">,</span>&nbsp;<span class="ident" id="2182285">isNotPrint</span>&nbsp;<span class="op" id="2182296">:=</span>&nbsp;<span class="builtintype" id="2182299">uint16</span><span class="op" id="2182305">(</span><span class="ident" id="2182306">r</span><span class="op" id="2182307">)</span><span class="op" id="2182308">,</span>&nbsp;<span class="ident" id="2182310">isPrint16</span><span class="op" id="2182319">,</span>&nbsp;<span class="ident" id="2182321">isNotPrint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182336">i</span>&nbsp;<span class="op" id="2182338">:=</span>&nbsp;<span class="ident" id="2182341">bsearch16</span><span class="op" id="2182350">(</span><span class="ident" id="2182351">isPrint</span><span class="op" id="2182358">,</span>&nbsp;<span class="ident" id="2182360">rr</span><span class="op" id="2182362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182366">if</span>&nbsp;<span class="ident" id="2182369">i</span>&nbsp;<span class="op" id="2182371">&gt;=</span>&nbsp;<span class="builtinfunc" id="2182374">len</span><span class="op" id="2182377">(</span><span class="ident" id="2182378">isPrint</span><span class="op" id="2182385">)</span>&nbsp;<span class="op" id="2182387">||</span>&nbsp;<span class="ident" id="2182390">rr</span>&nbsp;<span class="op" id="2182393">&lt;</span>&nbsp;<span class="ident" id="2182395">isPrint</span><span class="op" id="2182402">[</span><span class="ident" id="2182403">i</span><span class="op" id="2182404">&amp;^</span><span class="num" id="2182406">1</span><span class="op" id="2182407">]</span>&nbsp;<span class="op" id="2182409">||</span>&nbsp;<span class="ident" id="2182412">isPrint</span><span class="op" id="2182419">[</span><span class="ident" id="2182420">i</span><span class="op" id="2182421">|</span><span class="num" id="2182422">1</span><span class="op" id="2182423">]</span>&nbsp;<span class="op" id="2182425">&lt;</span>&nbsp;<span class="ident" id="2182427">rr</span>&nbsp;<span class="op" id="2182430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182435">return</span>&nbsp;<span class="ident" id="2182442">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2182450">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182454">j</span>&nbsp;<span class="op" id="2182456">:=</span>&nbsp;<span class="ident" id="2182459">bsearch16</span><span class="op" id="2182468">(</span><span class="ident" id="2182469">isNotPrint</span><span class="op" id="2182479">,</span>&nbsp;<span class="ident" id="2182481">rr</span><span class="op" id="2182483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182487">return</span>&nbsp;<span class="ident" id="2182494">j</span>&nbsp;<span class="op" id="2182496">&gt;=</span>&nbsp;<span class="builtinfunc" id="2182499">len</span><span class="op" id="2182502">(</span><span class="ident" id="2182503">isNotPrint</span><span class="op" id="2182513">)</span>&nbsp;<span class="op" id="2182515">||</span>&nbsp;<span class="ident" id="2182518">isNotPrint</span><span class="op" id="2182528">[</span><span class="ident" id="2182529">j</span><span class="op" id="2182530">]</span>&nbsp;<span class="op" id="2182532">!=</span>&nbsp;<span class="ident" id="2182535">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2182539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182543">rr</span><span class="op" id="2182545">,</span>&nbsp;<span class="ident" id="2182547">isPrint</span><span class="op" id="2182554">,</span>&nbsp;<span class="ident" id="2182556">isNotPrint</span>&nbsp;<span class="op" id="2182567">:=</span>&nbsp;<span class="builtintype" id="2182570">uint32</span><span class="op" id="2182576">(</span><span class="ident" id="2182577">r</span><span class="op" id="2182578">)</span><span class="op" id="2182579">,</span>&nbsp;<span class="ident" id="2182581">isPrint32</span><span class="op" id="2182590">,</span>&nbsp;<span class="ident" id="2182592">isNotPrint32</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182606">i</span>&nbsp;<span class="op" id="2182608">:=</span>&nbsp;<span class="ident" id="2182611">bsearch32</span><span class="op" id="2182620">(</span><span class="ident" id="2182621">isPrint</span><span class="op" id="2182628">,</span>&nbsp;<span class="ident" id="2182630">rr</span><span class="op" id="2182632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182635">if</span>&nbsp;<span class="ident" id="2182638">i</span>&nbsp;<span class="op" id="2182640">&gt;=</span>&nbsp;<span class="builtinfunc" id="2182643">len</span><span class="op" id="2182646">(</span><span class="ident" id="2182647">isPrint</span><span class="op" id="2182654">)</span>&nbsp;<span class="op" id="2182656">||</span>&nbsp;<span class="ident" id="2182659">rr</span>&nbsp;<span class="op" id="2182662">&lt;</span>&nbsp;<span class="ident" id="2182664">isPrint</span><span class="op" id="2182671">[</span><span class="ident" id="2182672">i</span><span class="op" id="2182673">&amp;^</span><span class="num" id="2182675">1</span><span class="op" id="2182676">]</span>&nbsp;<span class="op" id="2182678">||</span>&nbsp;<span class="ident" id="2182681">isPrint</span><span class="op" id="2182688">[</span><span class="ident" id="2182689">i</span><span class="op" id="2182690">|</span><span class="num" id="2182691">1</span><span class="op" id="2182692">]</span>&nbsp;<span class="op" id="2182694">&lt;</span>&nbsp;<span class="ident" id="2182696">rr</span>&nbsp;<span class="op" id="2182699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182703">return</span>&nbsp;<span class="ident" id="2182710">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2182717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182720">if</span>&nbsp;<span class="ident" id="2182723">r</span>&nbsp;<span class="op" id="2182725">&gt;=</span>&nbsp;<span class="num" id="2182728">0x20000</span>&nbsp;<span class="op" id="2182736">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182740">return</span>&nbsp;<span class="ident" id="2182747">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2182753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182756">r</span>&nbsp;<span class="op" id="2182758">-=</span>&nbsp;<span class="num" id="2182761">0x10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2182770">j</span>&nbsp;<span class="op" id="2182772">:=</span>&nbsp;<span class="ident" id="2182775">bsearch16</span><span class="op" id="2182784">(</span><span class="ident" id="2182785">isNotPrint</span><span class="op" id="2182795">,</span>&nbsp;<span class="builtintype" id="2182797">uint16</span><span class="op" id="2182803">(</span><span class="ident" id="2182804">r</span><span class="op" id="2182805">)</span><span class="op" id="2182806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2182809">return</span>&nbsp;<span class="ident" id="2182816">j</span>&nbsp;<span class="op" id="2182818">&gt;=</span>&nbsp;<span class="builtinfunc" id="2182821">len</span><span class="op" id="2182824">(</span><span class="ident" id="2182825">isNotPrint</span><span class="op" id="2182835">)</span>&nbsp;<span class="op" id="2182837">||</span>&nbsp;<span class="ident" id="2182840">isNotPrint</span><span class="op" id="2182850">[</span><span class="ident" id="2182851">j</span><span class="op" id="2182852">]</span>&nbsp;<span class="op" id="2182854">!=</span>&nbsp;<span class="builtintype" id="2182857">uint16</span><span class="op" id="2182863">(</span><span class="ident" id="2182864">r</span><span class="op" id="2182865">)</span><br>
<span class="lineno">455</span><span class="op" id="2182867">}</span>
</div>
</body>
</html>
