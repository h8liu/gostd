<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/pprof</h2>
<ul>
<li><a href="/gostd/runtime/pprof/mprof_test.go.html">mprof_test.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof.go.html" class="current">pprof.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof_test.go.html">pprof_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4981215">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4981271">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4981325">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4981376">//&nbsp;Package&nbsp;pprof&nbsp;writes&nbsp;runtime&nbsp;profiling&nbsp;data&nbsp;in&nbsp;the&nbsp;format&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="4981446">//&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="4981482">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="4981523">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="keyword" id="4981570">package</span>&nbsp;<span class="ident" id="4981578">pprof</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4981585">import</span>&nbsp;<span class="op" id="4981592">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981595">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981604">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981613">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981620">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981626">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981637">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981645">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981656">&#34;sync&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4981664">&#34;text/tabwriter&#34;</span><br>
<span class="lineno"></span><span class="op" id="4981681">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4981684">//&nbsp;BUG(rsc):&nbsp;Profiles&nbsp;are&nbsp;incomplete&nbsp;and&nbsp;inaccurate&nbsp;on&nbsp;NetBSD&nbsp;and&nbsp;OS&nbsp;X.</span><br>
<span class="lineno"></span><span class="comment" id="4981756">//&nbsp;See&nbsp;http://golang.org/issue/6047&nbsp;for&nbsp;details.</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="4981806">//&nbsp;A&nbsp;Profile&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;stack&nbsp;traces&nbsp;showing&nbsp;the&nbsp;call&nbsp;sequences</span><br>
<span class="lineno"></span><span class="comment" id="4981878">//&nbsp;that&nbsp;led&nbsp;to&nbsp;instances&nbsp;of&nbsp;a&nbsp;particular&nbsp;event,&nbsp;such&nbsp;as&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="comment" id="4981946">//&nbsp;Packages&nbsp;can&nbsp;create&nbsp;and&nbsp;maintain&nbsp;their&nbsp;own&nbsp;profiles;&nbsp;the&nbsp;most&nbsp;common</span><br>
<span class="lineno"></span><span class="comment" id="4982018">//&nbsp;use&nbsp;is&nbsp;for&nbsp;tracking&nbsp;resources&nbsp;that&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;closed,&nbsp;such&nbsp;as&nbsp;files</span><br>
<span class="lineno">30</span><span class="comment" id="4982097">//&nbsp;or&nbsp;network&nbsp;connections.</span><br>
<span class="lineno"></span><span class="comment" id="4982124">//</span><br>
<span class="lineno"></span><span class="comment" id="4982127">//&nbsp;A&nbsp;Profile&#39;s&nbsp;methods&nbsp;can&nbsp;be&nbsp;called&nbsp;from&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="comment" id="4982205">//</span><br>
<span class="lineno"></span><span class="comment" id="4982208">//&nbsp;Each&nbsp;Profile&nbsp;has&nbsp;a&nbsp;unique&nbsp;name.&nbsp;&nbsp;A&nbsp;few&nbsp;profiles&nbsp;are&nbsp;predefined:</span><br>
<span class="lineno">35</span><span class="comment" id="4982275">//</span><br>
<span class="lineno"></span><span class="comment" id="4982278">//&nbsp;&nbsp;&nbsp;&nbsp;goroutine&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;of&nbsp;all&nbsp;current&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="4982335">//&nbsp;&nbsp;&nbsp;&nbsp;heap&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;sampling&nbsp;of&nbsp;all&nbsp;heap&nbsp;allocations</span><br>
<span class="lineno"></span><span class="comment" id="4982388">//&nbsp;&nbsp;&nbsp;&nbsp;threadcreate&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;the&nbsp;creation&nbsp;of&nbsp;new&nbsp;OS&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="4982462">//&nbsp;&nbsp;&nbsp;&nbsp;block&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;stack&nbsp;traces&nbsp;that&nbsp;led&nbsp;to&nbsp;blocking&nbsp;on&nbsp;synchronization&nbsp;primitives</span><br>
<span class="lineno">40</span><span class="comment" id="4982544">//</span><br>
<span class="lineno"></span><span class="comment" id="4982547">//&nbsp;These&nbsp;predefined&nbsp;profiles&nbsp;maintain&nbsp;themselves&nbsp;and&nbsp;panic&nbsp;on&nbsp;an&nbsp;explicit</span><br>
<span class="lineno"></span><span class="comment" id="4982621">//&nbsp;Add&nbsp;or&nbsp;Remove&nbsp;method&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="4982651">//</span><br>
<span class="lineno"></span><span class="comment" id="4982654">//&nbsp;The&nbsp;CPU&nbsp;profile&nbsp;is&nbsp;not&nbsp;available&nbsp;as&nbsp;a&nbsp;Profile.&nbsp;&nbsp;It&nbsp;has&nbsp;a&nbsp;special&nbsp;API,</span><br>
<span class="lineno">45</span><span class="comment" id="4982727">//&nbsp;the&nbsp;StartCPUProfile&nbsp;and&nbsp;StopCPUProfile&nbsp;functions,&nbsp;because&nbsp;it&nbsp;streams</span><br>
<span class="lineno"></span><span class="comment" id="4982799">//&nbsp;output&nbsp;to&nbsp;a&nbsp;writer&nbsp;during&nbsp;profiling.</span><br>
<span class="lineno"></span><span class="comment" id="4982839">//</span><br>
<span class="lineno"></span><span class="keyword" id="4982842">type</span>&nbsp;<span class="ident" id="4982847">Profile</span>&nbsp;<span class="keyword" id="4982855">struct</span>&nbsp;<span class="op" id="4982862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4982865">name</span>&nbsp;&nbsp;<span class="builtintype" id="4982871">string</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4982879">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4982885">sync</span><span class="op" id="4982889">.</span><span class="ident" id="4982890">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4982897">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4982903">map</span><span class="op" id="4982906">[</span><span class="keyword" id="4982907">interface</span><span class="op" id="4982916">{</span><span class="op" id="4982917">}</span><span class="op" id="4982918">]</span><span class="op" id="4982919">[</span><span class="op" id="4982920">]</span><span class="builtintype" id="4982921">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4982930">count</span>&nbsp;<span class="keyword" id="4982936">func</span><span class="op" id="4982940">(</span><span class="op" id="4982941">)</span>&nbsp;<span class="builtintype" id="4982943">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4982948">write</span>&nbsp;<span class="keyword" id="4982954">func</span><span class="op" id="4982958">(</span><span class="ident" id="4982959">io</span><span class="op" id="4982961">.</span><span class="ident" id="4982962">Writer</span><span class="op" id="4982968">,</span>&nbsp;<span class="builtintype" id="4982970">int</span><span class="op" id="4982973">)</span>&nbsp;<span class="builtintype" id="4982975">error</span><br>
<span class="lineno"></span><span class="op" id="4982981">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4982984">//&nbsp;profiles&nbsp;records&nbsp;all&nbsp;registered&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="4983029">var</span>&nbsp;<span class="ident" id="4983033">profiles</span>&nbsp;<span class="keyword" id="4983042">struct</span>&nbsp;<span class="op" id="4983049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983052">mu</span>&nbsp;<span class="ident" id="4983055">sync</span><span class="op" id="4983059">.</span><span class="ident" id="4983060">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983067">m</span>&nbsp;&nbsp;<span class="keyword" id="4983070">map</span><span class="op" id="4983073">[</span><span class="builtintype" id="4983074">string</span><span class="op" id="4983080">]</span><span class="op" id="4983081">*</span><span class="ident" id="4983082">Profile</span><br>
<span class="lineno">60</span><span class="op" id="4983090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4983093">var</span>&nbsp;<span class="ident" id="4983097">goroutineProfile</span>&nbsp;<span class="op" id="4983114">=</span>&nbsp;<span class="op" id="4983116">&amp;</span><span class="ident" id="4983117">Profile</span><span class="op" id="4983124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983127">name</span><span class="op" id="4983131">:</span>&nbsp;&nbsp;<span class="string" id="4983134">&#34;goroutine&#34;</span><span class="op" id="4983145">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983148">count</span><span class="op" id="4983153">:</span>&nbsp;<span class="ident" id="4983155">countGoroutine</span><span class="op" id="4983169">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983172">write</span><span class="op" id="4983177">:</span>&nbsp;<span class="ident" id="4983179">writeGoroutine</span><span class="op" id="4983193">,</span><br>
<span class="lineno"></span><span class="op" id="4983195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4983198">var</span>&nbsp;<span class="ident" id="4983202">threadcreateProfile</span>&nbsp;<span class="op" id="4983222">=</span>&nbsp;<span class="op" id="4983224">&amp;</span><span class="ident" id="4983225">Profile</span><span class="op" id="4983232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983235">name</span><span class="op" id="4983239">:</span>&nbsp;&nbsp;<span class="string" id="4983242">&#34;threadcreate&#34;</span><span class="op" id="4983256">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983259">count</span><span class="op" id="4983264">:</span>&nbsp;<span class="ident" id="4983266">countThreadCreate</span><span class="op" id="4983283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983286">write</span><span class="op" id="4983291">:</span>&nbsp;<span class="ident" id="4983293">writeThreadCreate</span><span class="op" id="4983310">,</span><br>
<span class="lineno"></span><span class="op" id="4983312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4983315">var</span>&nbsp;<span class="ident" id="4983319">heapProfile</span>&nbsp;<span class="op" id="4983331">=</span>&nbsp;<span class="op" id="4983333">&amp;</span><span class="ident" id="4983334">Profile</span><span class="op" id="4983341">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983344">name</span><span class="op" id="4983348">:</span>&nbsp;&nbsp;<span class="string" id="4983351">&#34;heap&#34;</span><span class="op" id="4983357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983360">count</span><span class="op" id="4983365">:</span>&nbsp;<span class="ident" id="4983367">countHeap</span><span class="op" id="4983376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983379">write</span><span class="op" id="4983384">:</span>&nbsp;<span class="ident" id="4983386">writeHeap</span><span class="op" id="4983395">,</span><br>
<span class="lineno"></span><span class="op" id="4983397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4983400">var</span>&nbsp;<span class="ident" id="4983404">blockProfile</span>&nbsp;<span class="op" id="4983417">=</span>&nbsp;<span class="op" id="4983419">&amp;</span><span class="ident" id="4983420">Profile</span><span class="op" id="4983427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983430">name</span><span class="op" id="4983434">:</span>&nbsp;&nbsp;<span class="string" id="4983437">&#34;block&#34;</span><span class="op" id="4983444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983447">count</span><span class="op" id="4983452">:</span>&nbsp;<span class="ident" id="4983454">countBlock</span><span class="op" id="4983464">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983467">write</span><span class="op" id="4983472">:</span>&nbsp;<span class="ident" id="4983474">writeBlock</span><span class="op" id="4983484">,</span><br>
<span class="lineno"></span><span class="op" id="4983486">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4983489">func</span>&nbsp;<span class="ident" id="4983494">lockProfiles</span><span class="op" id="4983506">(</span><span class="op" id="4983507">)</span>&nbsp;<span class="op" id="4983509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983512">profiles</span><span class="op" id="4983520">.</span><span class="ident" id="4983521">mu</span><span class="op" id="4983523">.</span><span class="ident" id="4983524">Lock</span><span class="op" id="4983528">(</span><span class="op" id="4983529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4983532">if</span>&nbsp;<span class="ident" id="4983535">profiles</span><span class="op" id="4983543">.</span><span class="ident" id="4983544">m</span>&nbsp;<span class="op" id="4983546">==</span>&nbsp;<span class="builtintype" id="4983549">nil</span>&nbsp;<span class="op" id="4983553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4983557">//&nbsp;Initial&nbsp;built-in&nbsp;profiles.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983589">profiles</span><span class="op" id="4983597">.</span><span class="ident" id="4983598">m</span>&nbsp;<span class="op" id="4983600">=</span>&nbsp;<span class="keyword" id="4983602">map</span><span class="op" id="4983605">[</span><span class="builtintype" id="4983606">string</span><span class="op" id="4983612">]</span><span class="op" id="4983613">*</span><span class="ident" id="4983614">Profile</span><span class="op" id="4983621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4983626">&#34;goroutine&#34;</span><span class="op" id="4983637">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983642">goroutineProfile</span><span class="op" id="4983658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4983663">&#34;threadcreate&#34;</span><span class="op" id="4983677">:</span>&nbsp;<span class="ident" id="4983679">threadcreateProfile</span><span class="op" id="4983698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4983703">&#34;heap&#34;</span><span class="op" id="4983709">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983719">heapProfile</span><span class="op" id="4983730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4983735">&#34;block&#34;</span><span class="op" id="4983742">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983751">blockProfile</span><span class="op" id="4983763">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4983767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4983770">}</span><br>
<span class="lineno"></span><span class="op" id="4983772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4983775">func</span>&nbsp;<span class="ident" id="4983780">unlockProfiles</span><span class="op" id="4983794">(</span><span class="op" id="4983795">)</span>&nbsp;<span class="op" id="4983797">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4983800">profiles</span><span class="op" id="4983808">.</span><span class="ident" id="4983809">mu</span><span class="op" id="4983811">.</span><span class="ident" id="4983812">Unlock</span><span class="op" id="4983818">(</span><span class="op" id="4983819">)</span><br>
<span class="lineno"></span><span class="op" id="4983821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4983824">//&nbsp;NewProfile&nbsp;creates&nbsp;a&nbsp;new&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="4983881">//&nbsp;If&nbsp;a&nbsp;profile&nbsp;with&nbsp;that&nbsp;name&nbsp;already&nbsp;exists,&nbsp;NewProfile&nbsp;panics.</span><br>
<span class="lineno">105</span><span class="comment" id="4983947">//&nbsp;The&nbsp;convention&nbsp;is&nbsp;to&nbsp;use&nbsp;a&nbsp;&#39;import/path.&#39;&nbsp;prefix&nbsp;to&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="4984009">//&nbsp;separate&nbsp;name&nbsp;spaces&nbsp;for&nbsp;each&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4984051">func</span>&nbsp;<span class="ident" id="4984056">NewProfile</span><span class="op" id="4984066">(</span><span class="ident" id="4984067">name</span>&nbsp;<span class="builtintype" id="4984072">string</span><span class="op" id="4984078">)</span>&nbsp;<span class="op" id="4984080">*</span><span class="ident" id="4984081">Profile</span>&nbsp;<span class="op" id="4984089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984092">lockProfiles</span><span class="op" id="4984104">(</span><span class="op" id="4984105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984108">defer</span>&nbsp;<span class="ident" id="4984114">unlockProfiles</span><span class="op" id="4984128">(</span><span class="op" id="4984129">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984132">if</span>&nbsp;<span class="ident" id="4984135">name</span>&nbsp;<span class="op" id="4984140">==</span>&nbsp;<span class="string" id="4984143">&#34;&#34;</span>&nbsp;<span class="op" id="4984146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4984150">panic</span><span class="op" id="4984155">(</span><span class="string" id="4984156">&#34;pprof:&nbsp;NewProfile&nbsp;with&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4984191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984197">if</span>&nbsp;<span class="ident" id="4984200">profiles</span><span class="op" id="4984208">.</span><span class="ident" id="4984209">m</span><span class="op" id="4984210">[</span><span class="ident" id="4984211">name</span><span class="op" id="4984215">]</span>&nbsp;<span class="op" id="4984217">!=</span>&nbsp;<span class="builtintype" id="4984220">nil</span>&nbsp;<span class="op" id="4984224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4984228">panic</span><span class="op" id="4984233">(</span><span class="string" id="4984234">&#34;pprof:&nbsp;NewProfile&nbsp;name&nbsp;already&nbsp;in&nbsp;use:&nbsp;&#34;</span>&nbsp;<span class="op" id="4984276">+</span>&nbsp;<span class="ident" id="4984278">name</span><span class="op" id="4984282">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984288">p</span>&nbsp;<span class="op" id="4984290">:=</span>&nbsp;<span class="op" id="4984293">&amp;</span><span class="ident" id="4984294">Profile</span><span class="op" id="4984301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984305">name</span><span class="op" id="4984309">:</span>&nbsp;<span class="ident" id="4984311">name</span><span class="op" id="4984315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984319">m</span><span class="op" id="4984320">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984325">map</span><span class="op" id="4984328">[</span><span class="keyword" id="4984329">interface</span><span class="op" id="4984338">{</span><span class="op" id="4984339">}</span><span class="op" id="4984340">]</span><span class="op" id="4984341">[</span><span class="op" id="4984342">]</span><span class="builtintype" id="4984343">uintptr</span><span class="op" id="4984350">{</span><span class="op" id="4984351">}</span><span class="op" id="4984352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984355">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984358">profiles</span><span class="op" id="4984366">.</span><span class="ident" id="4984367">m</span><span class="op" id="4984368">[</span><span class="ident" id="4984369">name</span><span class="op" id="4984373">]</span>&nbsp;<span class="op" id="4984375">=</span>&nbsp;<span class="ident" id="4984377">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984380">return</span>&nbsp;<span class="ident" id="4984387">p</span><br>
<span class="lineno"></span><span class="op" id="4984389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4984392">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;profile&nbsp;with&nbsp;the&nbsp;given&nbsp;name,&nbsp;or&nbsp;nil&nbsp;if&nbsp;no&nbsp;such&nbsp;profile&nbsp;exists.</span><br>
<span class="lineno">125</span><span class="keyword" id="4984477">func</span>&nbsp;<span class="ident" id="4984482">Lookup</span><span class="op" id="4984488">(</span><span class="ident" id="4984489">name</span>&nbsp;<span class="builtintype" id="4984494">string</span><span class="op" id="4984500">)</span>&nbsp;<span class="op" id="4984502">*</span><span class="ident" id="4984503">Profile</span>&nbsp;<span class="op" id="4984511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984514">lockProfiles</span><span class="op" id="4984526">(</span><span class="op" id="4984527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984530">defer</span>&nbsp;<span class="ident" id="4984536">unlockProfiles</span><span class="op" id="4984550">(</span><span class="op" id="4984551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984554">return</span>&nbsp;<span class="ident" id="4984561">profiles</span><span class="op" id="4984569">.</span><span class="ident" id="4984570">m</span><span class="op" id="4984571">[</span><span class="ident" id="4984572">name</span><span class="op" id="4984576">]</span><br>
<span class="lineno"></span><span class="op" id="4984578">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4984581">//&nbsp;Profiles&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;all&nbsp;the&nbsp;known&nbsp;profiles,&nbsp;sorted&nbsp;by&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4984652">func</span>&nbsp;<span class="ident" id="4984657">Profiles</span><span class="op" id="4984665">(</span><span class="op" id="4984666">)</span>&nbsp;<span class="op" id="4984668">[</span><span class="op" id="4984669">]</span><span class="op" id="4984670">*</span><span class="ident" id="4984671">Profile</span>&nbsp;<span class="op" id="4984679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984682">lockProfiles</span><span class="op" id="4984694">(</span><span class="op" id="4984695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984698">defer</span>&nbsp;<span class="ident" id="4984704">unlockProfiles</span><span class="op" id="4984718">(</span><span class="op" id="4984719">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984723">var</span>&nbsp;<span class="ident" id="4984727">all</span>&nbsp;<span class="op" id="4984731">[</span><span class="op" id="4984732">]</span><span class="op" id="4984733">*</span><span class="ident" id="4984734">Profile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984743">for</span>&nbsp;<span class="ident" id="4984747">_</span><span class="op" id="4984748">,</span>&nbsp;<span class="ident" id="4984750">p</span>&nbsp;<span class="op" id="4984752">:=</span>&nbsp;<span class="keyword" id="4984755">range</span>&nbsp;<span class="ident" id="4984761">profiles</span><span class="op" id="4984769">.</span><span class="ident" id="4984770">m</span>&nbsp;<span class="op" id="4984772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984776">all</span>&nbsp;<span class="op" id="4984780">=</span>&nbsp;<span class="builtinfunc" id="4984782">append</span><span class="op" id="4984788">(</span><span class="ident" id="4984789">all</span><span class="op" id="4984792">,</span>&nbsp;<span class="ident" id="4984794">p</span><span class="op" id="4984795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984798">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4984802">sort</span><span class="op" id="4984806">.</span><span class="ident" id="4984807">Sort</span><span class="op" id="4984811">(</span><span class="ident" id="4984812">byName</span><span class="op" id="4984818">(</span><span class="ident" id="4984819">all</span><span class="op" id="4984822">)</span><span class="op" id="4984823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4984826">return</span>&nbsp;<span class="ident" id="4984833">all</span><br>
<span class="lineno"></span><span class="op" id="4984837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="4984840">type</span>&nbsp;<span class="ident" id="4984845">byName</span>&nbsp;<span class="op" id="4984852">[</span><span class="op" id="4984853">]</span><span class="op" id="4984854">*</span><span class="ident" id="4984855">Profile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4984864">func</span>&nbsp;<span class="op" id="4984869">(</span><span class="ident" id="4984870">x</span>&nbsp;<span class="ident" id="4984872">byName</span><span class="op" id="4984878">)</span>&nbsp;<span class="ident" id="4984880">Len</span><span class="op" id="4984883">(</span><span class="op" id="4984884">)</span>&nbsp;<span class="builtintype" id="4984886">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984900">{</span>&nbsp;<span class="keyword" id="4984902">return</span>&nbsp;<span class="builtinfunc" id="4984909">len</span><span class="op" id="4984912">(</span><span class="ident" id="4984913">x</span><span class="op" id="4984914">)</span>&nbsp;<span class="op" id="4984916">}</span><br>
<span class="lineno"></span><span class="keyword" id="4984918">func</span>&nbsp;<span class="op" id="4984923">(</span><span class="ident" id="4984924">x</span>&nbsp;<span class="ident" id="4984926">byName</span><span class="op" id="4984932">)</span>&nbsp;<span class="ident" id="4984934">Swap</span><span class="op" id="4984938">(</span><span class="ident" id="4984939">i</span><span class="op" id="4984940">,</span>&nbsp;<span class="ident" id="4984942">j</span>&nbsp;<span class="builtintype" id="4984944">int</span><span class="op" id="4984947">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4984954">{</span>&nbsp;<span class="ident" id="4984956">x</span><span class="op" id="4984957">[</span><span class="ident" id="4984958">i</span><span class="op" id="4984959">]</span><span class="op" id="4984960">,</span>&nbsp;<span class="ident" id="4984962">x</span><span class="op" id="4984963">[</span><span class="ident" id="4984964">j</span><span class="op" id="4984965">]</span>&nbsp;<span class="op" id="4984967">=</span>&nbsp;<span class="ident" id="4984969">x</span><span class="op" id="4984970">[</span><span class="ident" id="4984971">j</span><span class="op" id="4984972">]</span><span class="op" id="4984973">,</span>&nbsp;<span class="ident" id="4984975">x</span><span class="op" id="4984976">[</span><span class="ident" id="4984977">i</span><span class="op" id="4984978">]</span>&nbsp;<span class="op" id="4984980">}</span><br>
<span class="lineno"></span><span class="keyword" id="4984982">func</span>&nbsp;<span class="op" id="4984987">(</span><span class="ident" id="4984988">x</span>&nbsp;<span class="ident" id="4984990">byName</span><span class="op" id="4984996">)</span>&nbsp;<span class="ident" id="4984998">Less</span><span class="op" id="4985002">(</span><span class="ident" id="4985003">i</span><span class="op" id="4985004">,</span>&nbsp;<span class="ident" id="4985006">j</span>&nbsp;<span class="builtintype" id="4985008">int</span><span class="op" id="4985011">)</span>&nbsp;<span class="builtintype" id="4985013">bool</span>&nbsp;<span class="op" id="4985018">{</span>&nbsp;<span class="keyword" id="4985020">return</span>&nbsp;<span class="ident" id="4985027">x</span><span class="op" id="4985028">[</span><span class="ident" id="4985029">i</span><span class="op" id="4985030">]</span><span class="op" id="4985031">.</span><span class="ident" id="4985032">name</span>&nbsp;<span class="op" id="4985037">&lt;</span>&nbsp;<span class="ident" id="4985039">x</span><span class="op" id="4985040">[</span><span class="ident" id="4985041">j</span><span class="op" id="4985042">]</span><span class="op" id="4985043">.</span><span class="ident" id="4985044">name</span>&nbsp;<span class="op" id="4985049">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="4985052">//&nbsp;Name&nbsp;returns&nbsp;this&nbsp;profile&#39;s&nbsp;name,&nbsp;which&nbsp;can&nbsp;be&nbsp;passed&nbsp;to&nbsp;Lookup&nbsp;to&nbsp;reobtain&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4985144">func</span>&nbsp;<span class="op" id="4985149">(</span><span class="ident" id="4985150">p</span>&nbsp;<span class="op" id="4985152">*</span><span class="ident" id="4985153">Profile</span><span class="op" id="4985160">)</span>&nbsp;<span class="ident" id="4985162">Name</span><span class="op" id="4985166">(</span><span class="op" id="4985167">)</span>&nbsp;<span class="builtintype" id="4985169">string</span>&nbsp;<span class="op" id="4985176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4985179">return</span>&nbsp;<span class="ident" id="4985186">p</span><span class="op" id="4985187">.</span><span class="ident" id="4985188">name</span><br>
<span class="lineno"></span><span class="op" id="4985193">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="4985196">//&nbsp;Count&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;execution&nbsp;stacks&nbsp;currently&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4985270">func</span>&nbsp;<span class="op" id="4985275">(</span><span class="ident" id="4985276">p</span>&nbsp;<span class="op" id="4985278">*</span><span class="ident" id="4985279">Profile</span><span class="op" id="4985286">)</span>&nbsp;<span class="ident" id="4985288">Count</span><span class="op" id="4985293">(</span><span class="op" id="4985294">)</span>&nbsp;<span class="builtintype" id="4985296">int</span>&nbsp;<span class="op" id="4985300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4985303">p</span><span class="op" id="4985304">.</span><span class="ident" id="4985305">mu</span><span class="op" id="4985307">.</span><span class="ident" id="4985308">Lock</span><span class="op" id="4985312">(</span><span class="op" id="4985313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4985316">defer</span>&nbsp;<span class="ident" id="4985322">p</span><span class="op" id="4985323">.</span><span class="ident" id="4985324">mu</span><span class="op" id="4985326">.</span><span class="ident" id="4985327">Unlock</span><span class="op" id="4985333">(</span><span class="op" id="4985334">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4985337">if</span>&nbsp;<span class="ident" id="4985340">p</span><span class="op" id="4985341">.</span><span class="ident" id="4985342">count</span>&nbsp;<span class="op" id="4985348">!=</span>&nbsp;<span class="builtintype" id="4985351">nil</span>&nbsp;<span class="op" id="4985355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4985359">return</span>&nbsp;<span class="ident" id="4985366">p</span><span class="op" id="4985367">.</span><span class="ident" id="4985368">count</span><span class="op" id="4985373">(</span><span class="op" id="4985374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4985377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4985380">return</span>&nbsp;<span class="builtinfunc" id="4985387">len</span><span class="op" id="4985390">(</span><span class="ident" id="4985391">p</span><span class="op" id="4985392">.</span><span class="ident" id="4985393">m</span><span class="op" id="4985394">)</span><br>
<span class="lineno"></span><span class="op" id="4985396">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="4985399">//&nbsp;Add&nbsp;adds&nbsp;the&nbsp;current&nbsp;execution&nbsp;stack&nbsp;to&nbsp;the&nbsp;profile,&nbsp;associated&nbsp;with&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4985478">//&nbsp;Add&nbsp;stores&nbsp;value&nbsp;in&nbsp;an&nbsp;internal&nbsp;map,&nbsp;so&nbsp;value&nbsp;must&nbsp;be&nbsp;suitable&nbsp;for&nbsp;use&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4985555">//&nbsp;a&nbsp;map&nbsp;key&nbsp;and&nbsp;will&nbsp;not&nbsp;be&nbsp;garbage&nbsp;collected&nbsp;until&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="4985626">//&nbsp;call&nbsp;to&nbsp;Remove.&nbsp;&nbsp;Add&nbsp;panics&nbsp;if&nbsp;the&nbsp;profile&nbsp;already&nbsp;contains&nbsp;a&nbsp;stack&nbsp;for&nbsp;value.</span><br>
<span class="lineno">170</span><span class="comment" id="4985708">//</span><br>
<span class="lineno"></span><span class="comment" id="4985711">//&nbsp;The&nbsp;skip&nbsp;parameter&nbsp;has&nbsp;the&nbsp;same&nbsp;meaning&nbsp;as&nbsp;runtime.Caller&#39;s&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4985779">//&nbsp;and&nbsp;controls&nbsp;where&nbsp;the&nbsp;stack&nbsp;trace&nbsp;begins.&nbsp;&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4985852">//&nbsp;trace&nbsp;in&nbsp;the&nbsp;function&nbsp;calling&nbsp;Add.&nbsp;&nbsp;For&nbsp;example,&nbsp;given&nbsp;this</span><br>
<span class="lineno"></span><span class="comment" id="4985915">//&nbsp;execution&nbsp;stack:</span><br>
<span class="lineno">175</span><span class="comment" id="4985935">//</span><br>
<span class="lineno"></span><span class="comment" id="4985938">//&nbsp;&nbsp;&nbsp;&nbsp;Add</span><br>
<span class="lineno"></span><span class="comment" id="4985945">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;rpc.NewClient</span><br>
<span class="lineno"></span><span class="comment" id="4985974">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;mypkg.Run</span><br>
<span class="lineno"></span><span class="comment" id="4985999">//&nbsp;&nbsp;&nbsp;&nbsp;called&nbsp;from&nbsp;main.main</span><br>
<span class="lineno">180</span><span class="comment" id="4986024">//</span><br>
<span class="lineno"></span><span class="comment" id="4986027">//&nbsp;Passing&nbsp;skip=0&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;Add&nbsp;inside&nbsp;rpc.NewClient.</span><br>
<span class="lineno"></span><span class="comment" id="4986109">//&nbsp;Passing&nbsp;skip=1&nbsp;begins&nbsp;the&nbsp;stack&nbsp;trace&nbsp;at&nbsp;the&nbsp;call&nbsp;to&nbsp;NewClient&nbsp;inside&nbsp;mypkg.Run.</span><br>
<span class="lineno"></span><span class="comment" id="4986193">//</span><br>
<span class="lineno"></span><span class="keyword" id="4986196">func</span>&nbsp;<span class="op" id="4986201">(</span><span class="ident" id="4986202">p</span>&nbsp;<span class="op" id="4986204">*</span><span class="ident" id="4986205">Profile</span><span class="op" id="4986212">)</span>&nbsp;<span class="ident" id="4986214">Add</span><span class="op" id="4986217">(</span><span class="ident" id="4986218">value</span>&nbsp;<span class="keyword" id="4986224">interface</span><span class="op" id="4986233">{</span><span class="op" id="4986234">}</span><span class="op" id="4986235">,</span>&nbsp;<span class="ident" id="4986237">skip</span>&nbsp;<span class="builtintype" id="4986242">int</span><span class="op" id="4986245">)</span>&nbsp;<span class="op" id="4986247">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4986250">if</span>&nbsp;<span class="ident" id="4986253">p</span><span class="op" id="4986254">.</span><span class="ident" id="4986255">name</span>&nbsp;<span class="op" id="4986260">==</span>&nbsp;<span class="string" id="4986263">&#34;&#34;</span>&nbsp;<span class="op" id="4986266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4986270">panic</span><span class="op" id="4986275">(</span><span class="string" id="4986276">&#34;pprof:&nbsp;use&nbsp;of&nbsp;uninitialized&nbsp;Profile&#34;</span><span class="op" id="4986313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4986316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4986319">if</span>&nbsp;<span class="ident" id="4986322">p</span><span class="op" id="4986323">.</span><span class="ident" id="4986324">write</span>&nbsp;<span class="op" id="4986330">!=</span>&nbsp;<span class="builtintype" id="4986333">nil</span>&nbsp;<span class="op" id="4986337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4986341">panic</span><span class="op" id="4986346">(</span><span class="string" id="4986347">&#34;pprof:&nbsp;Add&nbsp;called&nbsp;on&nbsp;built-in&nbsp;Profile&nbsp;&#34;</span>&nbsp;<span class="op" id="4986388">+</span>&nbsp;<span class="ident" id="4986390">p</span><span class="op" id="4986391">.</span><span class="ident" id="4986392">name</span><span class="op" id="4986396">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4986399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4986403">stk</span>&nbsp;<span class="op" id="4986407">:=</span>&nbsp;<span class="builtinfunc" id="4986410">make</span><span class="op" id="4986414">(</span><span class="op" id="4986415">[</span><span class="op" id="4986416">]</span><span class="builtintype" id="4986417">uintptr</span><span class="op" id="4986424">,</span>&nbsp;<span class="num" id="4986426">32</span><span class="op" id="4986428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4986431">n</span>&nbsp;<span class="op" id="4986433">:=</span>&nbsp;<span class="ident" id="4986436">runtime</span><span class="op" id="4986443">.</span><span class="ident" id="4986444">Callers</span><span class="op" id="4986451">(</span><span class="ident" id="4986452">skip</span><span class="op" id="4986456">+</span><span class="num" id="4986457">1</span><span class="op" id="4986458">,</span>&nbsp;<span class="ident" id="4986460">stk</span><span class="op" id="4986463">[</span><span class="op" id="4986464">:</span><span class="op" id="4986465">]</span><span class="op" id="4986466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4986470">p</span><span class="op" id="4986471">.</span><span class="ident" id="4986472">mu</span><span class="op" id="4986474">.</span><span class="ident" id="4986475">Lock</span><span class="op" id="4986479">(</span><span class="op" id="4986480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4986483">defer</span>&nbsp;<span class="ident" id="4986489">p</span><span class="op" id="4986490">.</span><span class="ident" id="4986491">mu</span><span class="op" id="4986493">.</span><span class="ident" id="4986494">Unlock</span><span class="op" id="4986500">(</span><span class="op" id="4986501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4986504">if</span>&nbsp;<span class="ident" id="4986507">p</span><span class="op" id="4986508">.</span><span class="ident" id="4986509">m</span><span class="op" id="4986510">[</span><span class="ident" id="4986511">value</span><span class="op" id="4986516">]</span>&nbsp;<span class="op" id="4986518">!=</span>&nbsp;<span class="builtintype" id="4986521">nil</span>&nbsp;<span class="op" id="4986525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4986529">panic</span><span class="op" id="4986534">(</span><span class="string" id="4986535">&#34;pprof:&nbsp;Profile.Add&nbsp;of&nbsp;duplicate&nbsp;value&#34;</span><span class="op" id="4986574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4986577">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4986580">p</span><span class="op" id="4986581">.</span><span class="ident" id="4986582">m</span><span class="op" id="4986583">[</span><span class="ident" id="4986584">value</span><span class="op" id="4986589">]</span>&nbsp;<span class="op" id="4986591">=</span>&nbsp;<span class="ident" id="4986593">stk</span><span class="op" id="4986596">[</span><span class="op" id="4986597">:</span><span class="ident" id="4986598">n</span><span class="op" id="4986599">]</span><br>
<span class="lineno"></span><span class="op" id="4986601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986604">//&nbsp;Remove&nbsp;removes&nbsp;the&nbsp;execution&nbsp;stack&nbsp;associated&nbsp;with&nbsp;value&nbsp;from&nbsp;the&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="4986682">//&nbsp;It&nbsp;is&nbsp;a&nbsp;no-op&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;profile.</span><br>
<span class="lineno">205</span><span class="keyword" id="4986735">func</span>&nbsp;<span class="op" id="4986740">(</span><span class="ident" id="4986741">p</span>&nbsp;<span class="op" id="4986743">*</span><span class="ident" id="4986744">Profile</span><span class="op" id="4986751">)</span>&nbsp;<span class="ident" id="4986753">Remove</span><span class="op" id="4986759">(</span><span class="ident" id="4986760">value</span>&nbsp;<span class="keyword" id="4986766">interface</span><span class="op" id="4986775">{</span><span class="op" id="4986776">}</span><span class="op" id="4986777">)</span>&nbsp;<span class="op" id="4986779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4986782">p</span><span class="op" id="4986783">.</span><span class="ident" id="4986784">mu</span><span class="op" id="4986786">.</span><span class="ident" id="4986787">Lock</span><span class="op" id="4986791">(</span><span class="op" id="4986792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4986795">defer</span>&nbsp;<span class="ident" id="4986801">p</span><span class="op" id="4986802">.</span><span class="ident" id="4986803">mu</span><span class="op" id="4986805">.</span><span class="ident" id="4986806">Unlock</span><span class="op" id="4986812">(</span><span class="op" id="4986813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4986816">delete</span><span class="op" id="4986822">(</span><span class="ident" id="4986823">p</span><span class="op" id="4986824">.</span><span class="ident" id="4986825">m</span><span class="op" id="4986826">,</span>&nbsp;<span class="ident" id="4986828">value</span><span class="op" id="4986833">)</span><br>
<span class="lineno"></span><span class="op" id="4986835">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="comment" id="4986838">//&nbsp;WriteTo&nbsp;writes&nbsp;a&nbsp;pprof-formatted&nbsp;snapshot&nbsp;of&nbsp;the&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4986904">//&nbsp;If&nbsp;a&nbsp;write&nbsp;to&nbsp;w&nbsp;returns&nbsp;an&nbsp;error,&nbsp;WriteTo&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4986969">//&nbsp;Otherwise,&nbsp;WriteTo&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4987004">//</span><br>
<span class="lineno">215</span><span class="comment" id="4987007">//&nbsp;The&nbsp;debug&nbsp;parameter&nbsp;enables&nbsp;additional&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="4987057">//&nbsp;Passing&nbsp;debug=0&nbsp;prints&nbsp;only&nbsp;the&nbsp;hexadecimal&nbsp;addresses&nbsp;that&nbsp;pprof&nbsp;needs.</span><br>
<span class="lineno"></span><span class="comment" id="4987132">//&nbsp;Passing&nbsp;debug=1&nbsp;adds&nbsp;comments&nbsp;translating&nbsp;addresses&nbsp;to&nbsp;function&nbsp;names</span><br>
<span class="lineno"></span><span class="comment" id="4987205">//&nbsp;and&nbsp;line&nbsp;numbers,&nbsp;so&nbsp;that&nbsp;a&nbsp;programmer&nbsp;can&nbsp;read&nbsp;the&nbsp;profile&nbsp;without&nbsp;tools.</span><br>
<span class="lineno"></span><span class="comment" id="4987283">//</span><br>
<span class="lineno">220</span><span class="comment" id="4987286">//&nbsp;The&nbsp;predefined&nbsp;profiles&nbsp;may&nbsp;assign&nbsp;meaning&nbsp;to&nbsp;other&nbsp;debug&nbsp;values;</span><br>
<span class="lineno"></span><span class="comment" id="4987355">//&nbsp;for&nbsp;example,&nbsp;when&nbsp;printing&nbsp;the&nbsp;&#34;goroutine&#34;&nbsp;profile,&nbsp;debug=2&nbsp;means&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4987427">//&nbsp;print&nbsp;the&nbsp;goroutine&nbsp;stacks&nbsp;in&nbsp;the&nbsp;same&nbsp;form&nbsp;that&nbsp;a&nbsp;Go&nbsp;program&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="4987497">//&nbsp;when&nbsp;dying&nbsp;due&nbsp;to&nbsp;an&nbsp;unrecovered&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="4987540">func</span>&nbsp;<span class="op" id="4987545">(</span><span class="ident" id="4987546">p</span>&nbsp;<span class="op" id="4987548">*</span><span class="ident" id="4987549">Profile</span><span class="op" id="4987556">)</span>&nbsp;<span class="ident" id="4987558">WriteTo</span><span class="op" id="4987565">(</span><span class="ident" id="4987566">w</span>&nbsp;<span class="ident" id="4987568">io</span><span class="op" id="4987570">.</span><span class="ident" id="4987571">Writer</span><span class="op" id="4987577">,</span>&nbsp;<span class="ident" id="4987579">debug</span>&nbsp;<span class="builtintype" id="4987585">int</span><span class="op" id="4987588">)</span>&nbsp;<span class="builtintype" id="4987590">error</span>&nbsp;<span class="op" id="4987596">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4987599">if</span>&nbsp;<span class="ident" id="4987602">p</span><span class="op" id="4987603">.</span><span class="ident" id="4987604">name</span>&nbsp;<span class="op" id="4987609">==</span>&nbsp;<span class="string" id="4987612">&#34;&#34;</span>&nbsp;<span class="op" id="4987615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4987619">panic</span><span class="op" id="4987624">(</span><span class="string" id="4987625">&#34;pprof:&nbsp;use&nbsp;of&nbsp;zero&nbsp;Profile&#34;</span><span class="op" id="4987653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4987656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4987659">if</span>&nbsp;<span class="ident" id="4987662">p</span><span class="op" id="4987663">.</span><span class="ident" id="4987664">write</span>&nbsp;<span class="op" id="4987670">!=</span>&nbsp;<span class="builtintype" id="4987673">nil</span>&nbsp;<span class="op" id="4987677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4987681">return</span>&nbsp;<span class="ident" id="4987688">p</span><span class="op" id="4987689">.</span><span class="ident" id="4987690">write</span><span class="op" id="4987695">(</span><span class="ident" id="4987696">w</span><span class="op" id="4987697">,</span>&nbsp;<span class="ident" id="4987699">debug</span><span class="op" id="4987704">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4987707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987711">//&nbsp;Obtain&nbsp;consistent&nbsp;snapshot&nbsp;under&nbsp;lock;&nbsp;then&nbsp;process&nbsp;without&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4987781">var</span>&nbsp;<span class="ident" id="4987785">all</span>&nbsp;<span class="op" id="4987789">[</span><span class="op" id="4987790">]</span><span class="op" id="4987791">[</span><span class="op" id="4987792">]</span><span class="builtintype" id="4987793">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987802">p</span><span class="op" id="4987803">.</span><span class="ident" id="4987804">mu</span><span class="op" id="4987806">.</span><span class="ident" id="4987807">Lock</span><span class="op" id="4987811">(</span><span class="op" id="4987812">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4987815">for</span>&nbsp;<span class="ident" id="4987819">_</span><span class="op" id="4987820">,</span>&nbsp;<span class="ident" id="4987822">stk</span>&nbsp;<span class="op" id="4987826">:=</span>&nbsp;<span class="keyword" id="4987829">range</span>&nbsp;<span class="ident" id="4987835">p</span><span class="op" id="4987836">.</span><span class="ident" id="4987837">m</span>&nbsp;<span class="op" id="4987839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987843">all</span>&nbsp;<span class="op" id="4987847">=</span>&nbsp;<span class="builtinfunc" id="4987849">append</span><span class="op" id="4987855">(</span><span class="ident" id="4987856">all</span><span class="op" id="4987859">,</span>&nbsp;<span class="ident" id="4987861">stk</span><span class="op" id="4987864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4987867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987870">p</span><span class="op" id="4987871">.</span><span class="ident" id="4987872">mu</span><span class="op" id="4987874">.</span><span class="ident" id="4987875">Unlock</span><span class="op" id="4987881">(</span><span class="op" id="4987882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987886">//&nbsp;Map&nbsp;order&nbsp;is&nbsp;non-deterministic;&nbsp;make&nbsp;output&nbsp;deterministic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987949">sort</span><span class="op" id="4987953">.</span><span class="ident" id="4987954">Sort</span><span class="op" id="4987958">(</span><span class="ident" id="4987959">stackProfile</span><span class="op" id="4987971">(</span><span class="ident" id="4987972">all</span><span class="op" id="4987975">)</span><span class="op" id="4987976">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4987980">return</span>&nbsp;<span class="ident" id="4987987">printCountProfile</span><span class="op" id="4988004">(</span><span class="ident" id="4988005">w</span><span class="op" id="4988006">,</span>&nbsp;<span class="ident" id="4988008">debug</span><span class="op" id="4988013">,</span>&nbsp;<span class="ident" id="4988015">p</span><span class="op" id="4988016">.</span><span class="ident" id="4988017">name</span><span class="op" id="4988021">,</span>&nbsp;<span class="ident" id="4988023">stackProfile</span><span class="op" id="4988035">(</span><span class="ident" id="4988036">all</span><span class="op" id="4988039">)</span><span class="op" id="4988040">)</span><br>
<span class="lineno"></span><span class="op" id="4988042">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4988045">type</span>&nbsp;<span class="ident" id="4988050">stackProfile</span>&nbsp;<span class="op" id="4988063">[</span><span class="op" id="4988064">]</span><span class="op" id="4988065">[</span><span class="op" id="4988066">]</span><span class="builtintype" id="4988067">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4988076">func</span>&nbsp;<span class="op" id="4988081">(</span><span class="ident" id="4988082">x</span>&nbsp;<span class="ident" id="4988084">stackProfile</span><span class="op" id="4988096">)</span>&nbsp;<span class="ident" id="4988098">Len</span><span class="op" id="4988101">(</span><span class="op" id="4988102">)</span>&nbsp;<span class="builtintype" id="4988104">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4988121">{</span>&nbsp;<span class="keyword" id="4988123">return</span>&nbsp;<span class="builtinfunc" id="4988130">len</span><span class="op" id="4988133">(</span><span class="ident" id="4988134">x</span><span class="op" id="4988135">)</span>&nbsp;<span class="op" id="4988137">}</span><br>
<span class="lineno"></span><span class="keyword" id="4988139">func</span>&nbsp;<span class="op" id="4988144">(</span><span class="ident" id="4988145">x</span>&nbsp;<span class="ident" id="4988147">stackProfile</span><span class="op" id="4988159">)</span>&nbsp;<span class="ident" id="4988161">Stack</span><span class="op" id="4988166">(</span><span class="ident" id="4988167">i</span>&nbsp;<span class="builtintype" id="4988169">int</span><span class="op" id="4988172">)</span>&nbsp;<span class="op" id="4988174">[</span><span class="op" id="4988175">]</span><span class="builtintype" id="4988176">uintptr</span>&nbsp;<span class="op" id="4988184">{</span>&nbsp;<span class="keyword" id="4988186">return</span>&nbsp;<span class="ident" id="4988193">x</span><span class="op" id="4988194">[</span><span class="ident" id="4988195">i</span><span class="op" id="4988196">]</span>&nbsp;<span class="op" id="4988198">}</span><br>
<span class="lineno">250</span><span class="keyword" id="4988200">func</span>&nbsp;<span class="op" id="4988205">(</span><span class="ident" id="4988206">x</span>&nbsp;<span class="ident" id="4988208">stackProfile</span><span class="op" id="4988220">)</span>&nbsp;<span class="ident" id="4988222">Swap</span><span class="op" id="4988226">(</span><span class="ident" id="4988227">i</span><span class="op" id="4988228">,</span>&nbsp;<span class="ident" id="4988230">j</span>&nbsp;<span class="builtintype" id="4988232">int</span><span class="op" id="4988235">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4988245">{</span>&nbsp;<span class="ident" id="4988247">x</span><span class="op" id="4988248">[</span><span class="ident" id="4988249">i</span><span class="op" id="4988250">]</span><span class="op" id="4988251">,</span>&nbsp;<span class="ident" id="4988253">x</span><span class="op" id="4988254">[</span><span class="ident" id="4988255">j</span><span class="op" id="4988256">]</span>&nbsp;<span class="op" id="4988258">=</span>&nbsp;<span class="ident" id="4988260">x</span><span class="op" id="4988261">[</span><span class="ident" id="4988262">j</span><span class="op" id="4988263">]</span><span class="op" id="4988264">,</span>&nbsp;<span class="ident" id="4988266">x</span><span class="op" id="4988267">[</span><span class="ident" id="4988268">i</span><span class="op" id="4988269">]</span>&nbsp;<span class="op" id="4988271">}</span><br>
<span class="lineno"></span><span class="keyword" id="4988273">func</span>&nbsp;<span class="op" id="4988278">(</span><span class="ident" id="4988279">x</span>&nbsp;<span class="ident" id="4988281">stackProfile</span><span class="op" id="4988293">)</span>&nbsp;<span class="ident" id="4988295">Less</span><span class="op" id="4988299">(</span><span class="ident" id="4988300">i</span><span class="op" id="4988301">,</span>&nbsp;<span class="ident" id="4988303">j</span>&nbsp;<span class="builtintype" id="4988305">int</span><span class="op" id="4988308">)</span>&nbsp;<span class="builtintype" id="4988310">bool</span>&nbsp;<span class="op" id="4988315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988318">t</span><span class="op" id="4988319">,</span>&nbsp;<span class="ident" id="4988321">u</span>&nbsp;<span class="op" id="4988323">:=</span>&nbsp;<span class="ident" id="4988326">x</span><span class="op" id="4988327">[</span><span class="ident" id="4988328">i</span><span class="op" id="4988329">]</span><span class="op" id="4988330">,</span>&nbsp;<span class="ident" id="4988332">x</span><span class="op" id="4988333">[</span><span class="ident" id="4988334">j</span><span class="op" id="4988335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988338">for</span>&nbsp;<span class="ident" id="4988342">k</span>&nbsp;<span class="op" id="4988344">:=</span>&nbsp;<span class="num" id="4988347">0</span><span class="op" id="4988348">;</span>&nbsp;<span class="ident" id="4988350">k</span>&nbsp;<span class="op" id="4988352">&lt;</span>&nbsp;<span class="builtinfunc" id="4988354">len</span><span class="op" id="4988357">(</span><span class="ident" id="4988358">t</span><span class="op" id="4988359">)</span>&nbsp;<span class="op" id="4988361">&amp;&amp;</span>&nbsp;<span class="ident" id="4988364">k</span>&nbsp;<span class="op" id="4988366">&lt;</span>&nbsp;<span class="builtinfunc" id="4988368">len</span><span class="op" id="4988371">(</span><span class="ident" id="4988372">u</span><span class="op" id="4988373">)</span><span class="op" id="4988374">;</span>&nbsp;<span class="ident" id="4988376">k</span><span class="op" id="4988377">++</span>&nbsp;<span class="op" id="4988380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988384">if</span>&nbsp;<span class="ident" id="4988387">t</span><span class="op" id="4988388">[</span><span class="ident" id="4988389">k</span><span class="op" id="4988390">]</span>&nbsp;<span class="op" id="4988392">!=</span>&nbsp;<span class="ident" id="4988395">u</span><span class="op" id="4988396">[</span><span class="ident" id="4988397">k</span><span class="op" id="4988398">]</span>&nbsp;<span class="op" id="4988400">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988405">return</span>&nbsp;<span class="ident" id="4988412">t</span><span class="op" id="4988413">[</span><span class="ident" id="4988414">k</span><span class="op" id="4988415">]</span>&nbsp;<span class="op" id="4988417">&lt;</span>&nbsp;<span class="ident" id="4988419">u</span><span class="op" id="4988420">[</span><span class="ident" id="4988421">k</span><span class="op" id="4988422">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4988426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4988429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988432">return</span>&nbsp;<span class="builtinfunc" id="4988439">len</span><span class="op" id="4988442">(</span><span class="ident" id="4988443">t</span><span class="op" id="4988444">)</span>&nbsp;<span class="op" id="4988446">&lt;</span>&nbsp;<span class="builtinfunc" id="4988448">len</span><span class="op" id="4988451">(</span><span class="ident" id="4988452">u</span><span class="op" id="4988453">)</span><br>
<span class="lineno"></span><span class="op" id="4988455">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4988458">//&nbsp;A&nbsp;countProfile&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;stack&nbsp;traces&nbsp;to&nbsp;be&nbsp;printed&nbsp;as&nbsp;counts</span><br>
<span class="lineno"></span><span class="comment" id="4988525">//&nbsp;grouped&nbsp;by&nbsp;stack&nbsp;trace.&nbsp;&nbsp;There&nbsp;are&nbsp;multiple&nbsp;implementations:</span><br>
<span class="lineno"></span><span class="comment" id="4988589">//&nbsp;all&nbsp;that&nbsp;matters&nbsp;is&nbsp;that&nbsp;we&nbsp;can&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;traces&nbsp;there&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4988659">//&nbsp;and&nbsp;obtain&nbsp;each&nbsp;trace&nbsp;in&nbsp;turn.</span><br>
<span class="lineno">265</span><span class="keyword" id="4988693">type</span>&nbsp;<span class="ident" id="4988698">countProfile</span>&nbsp;<span class="keyword" id="4988711">interface</span>&nbsp;<span class="op" id="4988721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988724">Len</span><span class="op" id="4988727">(</span><span class="op" id="4988728">)</span>&nbsp;<span class="builtintype" id="4988730">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988735">Stack</span><span class="op" id="4988740">(</span><span class="ident" id="4988741">i</span>&nbsp;<span class="builtintype" id="4988743">int</span><span class="op" id="4988746">)</span>&nbsp;<span class="op" id="4988748">[</span><span class="op" id="4988749">]</span><span class="builtintype" id="4988750">uintptr</span><br>
<span class="lineno"></span><span class="op" id="4988758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4988761">//&nbsp;printCountProfile&nbsp;prints&nbsp;a&nbsp;countProfile&nbsp;at&nbsp;the&nbsp;specified&nbsp;debug&nbsp;level.</span><br>
<span class="lineno"></span><span class="keyword" id="4988834">func</span>&nbsp;<span class="ident" id="4988839">printCountProfile</span><span class="op" id="4988856">(</span><span class="ident" id="4988857">w</span>&nbsp;<span class="ident" id="4988859">io</span><span class="op" id="4988861">.</span><span class="ident" id="4988862">Writer</span><span class="op" id="4988868">,</span>&nbsp;<span class="ident" id="4988870">debug</span>&nbsp;<span class="builtintype" id="4988876">int</span><span class="op" id="4988879">,</span>&nbsp;<span class="ident" id="4988881">name</span>&nbsp;<span class="builtintype" id="4988886">string</span><span class="op" id="4988892">,</span>&nbsp;<span class="ident" id="4988894">p</span>&nbsp;<span class="ident" id="4988896">countProfile</span><span class="op" id="4988908">)</span>&nbsp;<span class="builtintype" id="4988910">error</span>&nbsp;<span class="op" id="4988916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988919">b</span>&nbsp;<span class="op" id="4988921">:=</span>&nbsp;<span class="ident" id="4988924">bufio</span><span class="op" id="4988929">.</span><span class="ident" id="4988930">NewWriter</span><span class="op" id="4988939">(</span><span class="ident" id="4988940">w</span><span class="op" id="4988941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988944">var</span>&nbsp;<span class="ident" id="4988948">tw</span>&nbsp;<span class="op" id="4988951">*</span><span class="ident" id="4988952">tabwriter</span><span class="op" id="4988961">.</span><span class="ident" id="4988962">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988970">w</span>&nbsp;<span class="op" id="4988972">=</span>&nbsp;<span class="ident" id="4988974">b</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988977">if</span>&nbsp;<span class="ident" id="4988980">debug</span>&nbsp;<span class="op" id="4988986">&gt;</span>&nbsp;<span class="num" id="4988988">0</span>&nbsp;<span class="op" id="4988990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988994">tw</span>&nbsp;<span class="op" id="4988997">=</span>&nbsp;<span class="ident" id="4988999">tabwriter</span><span class="op" id="4989008">.</span><span class="ident" id="4989009">NewWriter</span><span class="op" id="4989018">(</span><span class="ident" id="4989019">w</span><span class="op" id="4989020">,</span>&nbsp;<span class="num" id="4989022">1</span><span class="op" id="4989023">,</span>&nbsp;<span class="num" id="4989025">8</span><span class="op" id="4989026">,</span>&nbsp;<span class="num" id="4989028">1</span><span class="op" id="4989029">,</span>&nbsp;<span class="string" id="4989031">&#39;\t&#39;</span><span class="op" id="4989035">,</span>&nbsp;<span class="num" id="4989037">0</span><span class="op" id="4989038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989042">w</span>&nbsp;<span class="op" id="4989044">=</span>&nbsp;<span class="ident" id="4989046">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989054">fmt</span><span class="op" id="4989057">.</span><span class="ident" id="4989058">Fprintf</span><span class="op" id="4989065">(</span><span class="ident" id="4989066">w</span><span class="op" id="4989067">,</span>&nbsp;<span class="string" id="4989069">&#34;%s&nbsp;profile:&nbsp;total&nbsp;%d\n&#34;</span><span class="op" id="4989093">,</span>&nbsp;<span class="ident" id="4989095">name</span><span class="op" id="4989099">,</span>&nbsp;<span class="ident" id="4989101">p</span><span class="op" id="4989102">.</span><span class="ident" id="4989103">Len</span><span class="op" id="4989106">(</span><span class="op" id="4989107">)</span><span class="op" id="4989108">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989112">//&nbsp;Build&nbsp;count&nbsp;of&nbsp;each&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989143">var</span>&nbsp;<span class="ident" id="4989147">buf</span>&nbsp;<span class="ident" id="4989151">bytes</span><span class="op" id="4989156">.</span><span class="ident" id="4989157">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989165">key</span>&nbsp;<span class="op" id="4989169">:=</span>&nbsp;<span class="keyword" id="4989172">func</span><span class="op" id="4989176">(</span><span class="ident" id="4989177">stk</span>&nbsp;<span class="op" id="4989181">[</span><span class="op" id="4989182">]</span><span class="builtintype" id="4989183">uintptr</span><span class="op" id="4989190">)</span>&nbsp;<span class="builtintype" id="4989192">string</span>&nbsp;<span class="op" id="4989199">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989203">buf</span><span class="op" id="4989206">.</span><span class="ident" id="4989207">Reset</span><span class="op" id="4989212">(</span><span class="op" id="4989213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989217">fmt</span><span class="op" id="4989220">.</span><span class="ident" id="4989221">Fprintf</span><span class="op" id="4989228">(</span><span class="op" id="4989229">&amp;</span><span class="ident" id="4989230">buf</span><span class="op" id="4989233">,</span>&nbsp;<span class="string" id="4989235">&#34;@&#34;</span><span class="op" id="4989238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989242">for</span>&nbsp;<span class="ident" id="4989246">_</span><span class="op" id="4989247">,</span>&nbsp;<span class="ident" id="4989249">pc</span>&nbsp;<span class="op" id="4989252">:=</span>&nbsp;<span class="keyword" id="4989255">range</span>&nbsp;<span class="ident" id="4989261">stk</span>&nbsp;<span class="op" id="4989265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989270">fmt</span><span class="op" id="4989273">.</span><span class="ident" id="4989274">Fprintf</span><span class="op" id="4989281">(</span><span class="op" id="4989282">&amp;</span><span class="ident" id="4989283">buf</span><span class="op" id="4989286">,</span>&nbsp;<span class="string" id="4989288">&#34;&nbsp;%#x&#34;</span><span class="op" id="4989294">,</span>&nbsp;<span class="ident" id="4989296">pc</span><span class="op" id="4989298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989302">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989306">return</span>&nbsp;<span class="ident" id="4989313">buf</span><span class="op" id="4989316">.</span><span class="ident" id="4989317">String</span><span class="op" id="4989323">(</span><span class="op" id="4989324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989330">m</span>&nbsp;<span class="op" id="4989332">:=</span>&nbsp;<span class="keyword" id="4989335">map</span><span class="op" id="4989338">[</span><span class="builtintype" id="4989339">string</span><span class="op" id="4989345">]</span><span class="builtintype" id="4989346">int</span><span class="op" id="4989349">{</span><span class="op" id="4989350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989353">n</span>&nbsp;<span class="op" id="4989355">:=</span>&nbsp;<span class="ident" id="4989358">p</span><span class="op" id="4989359">.</span><span class="ident" id="4989360">Len</span><span class="op" id="4989363">(</span><span class="op" id="4989364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989367">for</span>&nbsp;<span class="ident" id="4989371">i</span>&nbsp;<span class="op" id="4989373">:=</span>&nbsp;<span class="num" id="4989376">0</span><span class="op" id="4989377">;</span>&nbsp;<span class="ident" id="4989379">i</span>&nbsp;<span class="op" id="4989381">&lt;</span>&nbsp;<span class="ident" id="4989383">n</span><span class="op" id="4989384">;</span>&nbsp;<span class="ident" id="4989386">i</span><span class="op" id="4989387">++</span>&nbsp;<span class="op" id="4989390">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989394">m</span><span class="op" id="4989395">[</span><span class="ident" id="4989396">key</span><span class="op" id="4989399">(</span><span class="ident" id="4989400">p</span><span class="op" id="4989401">.</span><span class="ident" id="4989402">Stack</span><span class="op" id="4989407">(</span><span class="ident" id="4989408">i</span><span class="op" id="4989409">)</span><span class="op" id="4989410">)</span><span class="op" id="4989411">]</span><span class="op" id="4989412">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989420">//&nbsp;Print&nbsp;stacks,&nbsp;listing&nbsp;count&nbsp;on&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;a&nbsp;unique&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989491">for</span>&nbsp;<span class="ident" id="4989495">i</span>&nbsp;<span class="op" id="4989497">:=</span>&nbsp;<span class="num" id="4989500">0</span><span class="op" id="4989501">;</span>&nbsp;<span class="ident" id="4989503">i</span>&nbsp;<span class="op" id="4989505">&lt;</span>&nbsp;<span class="ident" id="4989507">n</span><span class="op" id="4989508">;</span>&nbsp;<span class="ident" id="4989510">i</span><span class="op" id="4989511">++</span>&nbsp;<span class="op" id="4989514">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989518">stk</span>&nbsp;<span class="op" id="4989522">:=</span>&nbsp;<span class="ident" id="4989525">p</span><span class="op" id="4989526">.</span><span class="ident" id="4989527">Stack</span><span class="op" id="4989532">(</span><span class="ident" id="4989533">i</span><span class="op" id="4989534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989538">s</span>&nbsp;<span class="op" id="4989540">:=</span>&nbsp;<span class="ident" id="4989543">key</span><span class="op" id="4989546">(</span><span class="ident" id="4989547">stk</span><span class="op" id="4989550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989554">if</span>&nbsp;<span class="ident" id="4989557">count</span>&nbsp;<span class="op" id="4989563">:=</span>&nbsp;<span class="ident" id="4989566">m</span><span class="op" id="4989567">[</span><span class="ident" id="4989568">s</span><span class="op" id="4989569">]</span><span class="op" id="4989570">;</span>&nbsp;<span class="ident" id="4989572">count</span>&nbsp;<span class="op" id="4989578">!=</span>&nbsp;<span class="num" id="4989581">0</span>&nbsp;<span class="op" id="4989583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989588">fmt</span><span class="op" id="4989591">.</span><span class="ident" id="4989592">Fprintf</span><span class="op" id="4989599">(</span><span class="ident" id="4989600">w</span><span class="op" id="4989601">,</span>&nbsp;<span class="string" id="4989603">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="4989612">,</span>&nbsp;<span class="ident" id="4989614">count</span><span class="op" id="4989619">,</span>&nbsp;<span class="ident" id="4989621">s</span><span class="op" id="4989622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989627">if</span>&nbsp;<span class="ident" id="4989630">debug</span>&nbsp;<span class="op" id="4989636">&gt;</span>&nbsp;<span class="num" id="4989638">0</span>&nbsp;<span class="op" id="4989640">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989646">printStackRecord</span><span class="op" id="4989662">(</span><span class="ident" id="4989663">w</span><span class="op" id="4989664">,</span>&nbsp;<span class="ident" id="4989666">stk</span><span class="op" id="4989669">,</span>&nbsp;<span class="builtintype" id="4989671">false</span><span class="op" id="4989676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4989686">delete</span><span class="op" id="4989692">(</span><span class="ident" id="4989693">m</span><span class="op" id="4989694">,</span>&nbsp;<span class="ident" id="4989696">s</span><span class="op" id="4989697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989704">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989708">if</span>&nbsp;<span class="ident" id="4989711">tw</span>&nbsp;<span class="op" id="4989714">!=</span>&nbsp;<span class="builtintype" id="4989717">nil</span>&nbsp;<span class="op" id="4989721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989725">tw</span><span class="op" id="4989727">.</span><span class="ident" id="4989728">Flush</span><span class="op" id="4989733">(</span><span class="op" id="4989734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989740">return</span>&nbsp;<span class="ident" id="4989747">b</span><span class="op" id="4989748">.</span><span class="ident" id="4989749">Flush</span><span class="op" id="4989754">(</span><span class="op" id="4989755">)</span><br>
<span class="lineno">315</span><span class="op" id="4989757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4989760">//&nbsp;printStackRecord&nbsp;prints&nbsp;the&nbsp;function&nbsp;+&nbsp;source&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4989826">//&nbsp;for&nbsp;a&nbsp;single&nbsp;stack&nbsp;trace.</span><br>
<span class="lineno"></span><span class="keyword" id="4989855">func</span>&nbsp;<span class="ident" id="4989860">printStackRecord</span><span class="op" id="4989876">(</span><span class="ident" id="4989877">w</span>&nbsp;<span class="ident" id="4989879">io</span><span class="op" id="4989881">.</span><span class="ident" id="4989882">Writer</span><span class="op" id="4989888">,</span>&nbsp;<span class="ident" id="4989890">stk</span>&nbsp;<span class="op" id="4989894">[</span><span class="op" id="4989895">]</span><span class="builtintype" id="4989896">uintptr</span><span class="op" id="4989903">,</span>&nbsp;<span class="ident" id="4989905">allFrames</span>&nbsp;<span class="builtintype" id="4989915">bool</span><span class="op" id="4989919">)</span>&nbsp;<span class="op" id="4989921">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989924">show</span>&nbsp;<span class="op" id="4989929">:=</span>&nbsp;<span class="ident" id="4989932">allFrames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989943">wasPanic</span>&nbsp;<span class="op" id="4989952">:=</span>&nbsp;<span class="builtintype" id="4989955">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989962">for</span>&nbsp;<span class="ident" id="4989966">i</span><span class="op" id="4989967">,</span>&nbsp;<span class="ident" id="4989969">pc</span>&nbsp;<span class="op" id="4989972">:=</span>&nbsp;<span class="keyword" id="4989975">range</span>&nbsp;<span class="ident" id="4989981">stk</span>&nbsp;<span class="op" id="4989985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989989">f</span>&nbsp;<span class="op" id="4989991">:=</span>&nbsp;<span class="ident" id="4989994">runtime</span><span class="op" id="4990001">.</span><span class="ident" id="4990002">FuncForPC</span><span class="op" id="4990011">(</span><span class="ident" id="4990012">pc</span><span class="op" id="4990014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990018">if</span>&nbsp;<span class="ident" id="4990021">f</span>&nbsp;<span class="op" id="4990023">==</span>&nbsp;<span class="builtintype" id="4990026">nil</span>&nbsp;<span class="op" id="4990030">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990035">show</span>&nbsp;<span class="op" id="4990040">=</span>&nbsp;<span class="builtintype" id="4990042">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990050">fmt</span><span class="op" id="4990053">.</span><span class="ident" id="4990054">Fprintf</span><span class="op" id="4990061">(</span><span class="ident" id="4990062">w</span><span class="op" id="4990063">,</span>&nbsp;<span class="string" id="4990065">&#34;#\t%#x\n&#34;</span><span class="op" id="4990075">,</span>&nbsp;<span class="ident" id="4990077">pc</span><span class="op" id="4990079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990084">wasPanic</span>&nbsp;<span class="op" id="4990093">=</span>&nbsp;<span class="builtintype" id="4990095">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990103">}</span>&nbsp;<span class="keyword" id="4990105">else</span>&nbsp;<span class="op" id="4990110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990115">tracepc</span>&nbsp;<span class="op" id="4990123">:=</span>&nbsp;<span class="ident" id="4990126">pc</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990132">//&nbsp;Back&nbsp;up&nbsp;to&nbsp;call&nbsp;instruction.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990167">if</span>&nbsp;<span class="ident" id="4990170">i</span>&nbsp;<span class="op" id="4990172">&gt;</span>&nbsp;<span class="num" id="4990174">0</span>&nbsp;<span class="op" id="4990176">&amp;&amp;</span>&nbsp;<span class="ident" id="4990179">pc</span>&nbsp;<span class="op" id="4990182">&gt;</span>&nbsp;<span class="ident" id="4990184">f</span><span class="op" id="4990185">.</span><span class="ident" id="4990186">Entry</span><span class="op" id="4990191">(</span><span class="op" id="4990192">)</span>&nbsp;<span class="op" id="4990194">&amp;&amp;</span>&nbsp;<span class="op" id="4990197">!</span><span class="ident" id="4990198">wasPanic</span>&nbsp;<span class="op" id="4990207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990213">if</span>&nbsp;<span class="ident" id="4990216">runtime</span><span class="op" id="4990223">.</span><span class="ident" id="4990224">GOARCH</span>&nbsp;<span class="op" id="4990231">==</span>&nbsp;<span class="string" id="4990234">&#34;386&#34;</span>&nbsp;<span class="op" id="4990240">||</span>&nbsp;<span class="ident" id="4990243">runtime</span><span class="op" id="4990250">.</span><span class="ident" id="4990251">GOARCH</span>&nbsp;<span class="op" id="4990258">==</span>&nbsp;<span class="string" id="4990261">&#34;amd64&#34;</span>&nbsp;<span class="op" id="4990269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990276">tracepc</span><span class="op" id="4990283">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990290">}</span>&nbsp;<span class="keyword" id="4990292">else</span>&nbsp;<span class="op" id="4990297">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990304">tracepc</span>&nbsp;<span class="op" id="4990312">-=</span>&nbsp;<span class="num" id="4990315">4</span>&nbsp;<span class="comment" id="4990317">//&nbsp;arm,&nbsp;etc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990343">file</span><span class="op" id="4990347">,</span>&nbsp;<span class="ident" id="4990349">line</span>&nbsp;<span class="op" id="4990354">:=</span>&nbsp;<span class="ident" id="4990357">f</span><span class="op" id="4990358">.</span><span class="ident" id="4990359">FileLine</span><span class="op" id="4990367">(</span><span class="ident" id="4990368">tracepc</span><span class="op" id="4990375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990380">name</span>&nbsp;<span class="op" id="4990385">:=</span>&nbsp;<span class="ident" id="4990388">f</span><span class="op" id="4990389">.</span><span class="ident" id="4990390">Name</span><span class="op" id="4990394">(</span><span class="op" id="4990395">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990400">//&nbsp;Hide&nbsp;runtime.goexit&nbsp;and&nbsp;any&nbsp;runtime&nbsp;functions&nbsp;at&nbsp;the&nbsp;beginning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990470">//&nbsp;This&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;for&nbsp;allocation&nbsp;traces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990521">wasPanic</span>&nbsp;<span class="op" id="4990530">=</span>&nbsp;<span class="ident" id="4990532">name</span>&nbsp;<span class="op" id="4990537">==</span>&nbsp;<span class="string" id="4990540">&#34;runtime.panic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990559">if</span>&nbsp;<span class="ident" id="4990562">name</span>&nbsp;<span class="op" id="4990567">==</span>&nbsp;<span class="string" id="4990570">&#34;runtime.goexit&#34;</span>&nbsp;<span class="op" id="4990587">||</span>&nbsp;<span class="op" id="4990590">!</span><span class="ident" id="4990591">show</span>&nbsp;<span class="op" id="4990596">&amp;&amp;</span>&nbsp;<span class="ident" id="4990599">strings</span><span class="op" id="4990606">.</span><span class="ident" id="4990607">HasPrefix</span><span class="op" id="4990616">(</span><span class="ident" id="4990617">name</span><span class="op" id="4990621">,</span>&nbsp;<span class="string" id="4990623">&#34;runtime.&#34;</span><span class="op" id="4990633">)</span>&nbsp;<span class="op" id="4990635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990641">continue</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990658">show</span>&nbsp;<span class="op" id="4990663">=</span>&nbsp;<span class="builtintype" id="4990665">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990673">fmt</span><span class="op" id="4990676">.</span><span class="ident" id="4990677">Fprintf</span><span class="op" id="4990684">(</span><span class="ident" id="4990685">w</span><span class="op" id="4990686">,</span>&nbsp;<span class="string" id="4990688">&#34;#\t%#x\t%s+%#x\t%s:%d\n&#34;</span><span class="op" id="4990713">,</span>&nbsp;<span class="ident" id="4990715">pc</span><span class="op" id="4990717">,</span>&nbsp;<span class="ident" id="4990719">name</span><span class="op" id="4990723">,</span>&nbsp;<span class="ident" id="4990725">pc</span><span class="op" id="4990727">-</span><span class="ident" id="4990728">f</span><span class="op" id="4990729">.</span><span class="ident" id="4990730">Entry</span><span class="op" id="4990735">(</span><span class="op" id="4990736">)</span><span class="op" id="4990737">,</span>&nbsp;<span class="ident" id="4990739">file</span><span class="op" id="4990743">,</span>&nbsp;<span class="ident" id="4990745">line</span><span class="op" id="4990749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990756">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990759">if</span>&nbsp;<span class="op" id="4990762">!</span><span class="ident" id="4990763">show</span>&nbsp;<span class="op" id="4990768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990772">//&nbsp;We&nbsp;didn&#39;t&nbsp;print&nbsp;anything;&nbsp;do&nbsp;it&nbsp;again,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990816">//&nbsp;and&nbsp;this&nbsp;time&nbsp;include&nbsp;runtime&nbsp;functions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990862">printStackRecord</span><span class="op" id="4990878">(</span><span class="ident" id="4990879">w</span><span class="op" id="4990880">,</span>&nbsp;<span class="ident" id="4990882">stk</span><span class="op" id="4990885">,</span>&nbsp;<span class="builtintype" id="4990887">true</span><span class="op" id="4990891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990895">return</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990906">fmt</span><span class="op" id="4990909">.</span><span class="ident" id="4990910">Fprintf</span><span class="op" id="4990917">(</span><span class="ident" id="4990918">w</span><span class="op" id="4990919">,</span>&nbsp;<span class="string" id="4990921">&#34;\n&#34;</span><span class="op" id="4990925">)</span><br>
<span class="lineno"></span><span class="op" id="4990927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4990930">//&nbsp;Interface&nbsp;to&nbsp;system&nbsp;profiles.</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="keyword" id="4990964">type</span>&nbsp;<span class="ident" id="4990969">byInUseBytes</span>&nbsp;<span class="op" id="4990982">[</span><span class="op" id="4990983">]</span><span class="ident" id="4990984">runtime</span><span class="op" id="4990991">.</span><span class="ident" id="4990992">MemProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4991010">func</span>&nbsp;<span class="op" id="4991015">(</span><span class="ident" id="4991016">x</span>&nbsp;<span class="ident" id="4991018">byInUseBytes</span><span class="op" id="4991030">)</span>&nbsp;<span class="ident" id="4991032">Len</span><span class="op" id="4991035">(</span><span class="op" id="4991036">)</span>&nbsp;<span class="builtintype" id="4991038">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991052">{</span>&nbsp;<span class="keyword" id="4991054">return</span>&nbsp;<span class="builtinfunc" id="4991061">len</span><span class="op" id="4991064">(</span><span class="ident" id="4991065">x</span><span class="op" id="4991066">)</span>&nbsp;<span class="op" id="4991068">}</span><br>
<span class="lineno"></span><span class="keyword" id="4991070">func</span>&nbsp;<span class="op" id="4991075">(</span><span class="ident" id="4991076">x</span>&nbsp;<span class="ident" id="4991078">byInUseBytes</span><span class="op" id="4991090">)</span>&nbsp;<span class="ident" id="4991092">Swap</span><span class="op" id="4991096">(</span><span class="ident" id="4991097">i</span><span class="op" id="4991098">,</span>&nbsp;<span class="ident" id="4991100">j</span>&nbsp;<span class="builtintype" id="4991102">int</span><span class="op" id="4991105">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991112">{</span>&nbsp;<span class="ident" id="4991114">x</span><span class="op" id="4991115">[</span><span class="ident" id="4991116">i</span><span class="op" id="4991117">]</span><span class="op" id="4991118">,</span>&nbsp;<span class="ident" id="4991120">x</span><span class="op" id="4991121">[</span><span class="ident" id="4991122">j</span><span class="op" id="4991123">]</span>&nbsp;<span class="op" id="4991125">=</span>&nbsp;<span class="ident" id="4991127">x</span><span class="op" id="4991128">[</span><span class="ident" id="4991129">j</span><span class="op" id="4991130">]</span><span class="op" id="4991131">,</span>&nbsp;<span class="ident" id="4991133">x</span><span class="op" id="4991134">[</span><span class="ident" id="4991135">i</span><span class="op" id="4991136">]</span>&nbsp;<span class="op" id="4991138">}</span><br>
<span class="lineno">365</span><span class="keyword" id="4991140">func</span>&nbsp;<span class="op" id="4991145">(</span><span class="ident" id="4991146">x</span>&nbsp;<span class="ident" id="4991148">byInUseBytes</span><span class="op" id="4991160">)</span>&nbsp;<span class="ident" id="4991162">Less</span><span class="op" id="4991166">(</span><span class="ident" id="4991167">i</span><span class="op" id="4991168">,</span>&nbsp;<span class="ident" id="4991170">j</span>&nbsp;<span class="builtintype" id="4991172">int</span><span class="op" id="4991175">)</span>&nbsp;<span class="builtintype" id="4991177">bool</span>&nbsp;<span class="op" id="4991182">{</span>&nbsp;<span class="keyword" id="4991184">return</span>&nbsp;<span class="ident" id="4991191">x</span><span class="op" id="4991192">[</span><span class="ident" id="4991193">i</span><span class="op" id="4991194">]</span><span class="op" id="4991195">.</span><span class="ident" id="4991196">InUseBytes</span><span class="op" id="4991206">(</span><span class="op" id="4991207">)</span>&nbsp;<span class="op" id="4991209">&gt;</span>&nbsp;<span class="ident" id="4991211">x</span><span class="op" id="4991212">[</span><span class="ident" id="4991213">j</span><span class="op" id="4991214">]</span><span class="op" id="4991215">.</span><span class="ident" id="4991216">InUseBytes</span><span class="op" id="4991226">(</span><span class="op" id="4991227">)</span>&nbsp;<span class="op" id="4991229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4991232">//&nbsp;WriteHeapProfile&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Lookup(&#34;heap&#34;).WriteTo(w,&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="4991299">//&nbsp;It&nbsp;is&nbsp;preserved&nbsp;for&nbsp;backwards&nbsp;compatibility.</span><br>
<span class="lineno"></span><span class="keyword" id="4991347">func</span>&nbsp;<span class="ident" id="4991352">WriteHeapProfile</span><span class="op" id="4991368">(</span><span class="ident" id="4991369">w</span>&nbsp;<span class="ident" id="4991371">io</span><span class="op" id="4991373">.</span><span class="ident" id="4991374">Writer</span><span class="op" id="4991380">)</span>&nbsp;<span class="builtintype" id="4991382">error</span>&nbsp;<span class="op" id="4991388">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991391">return</span>&nbsp;<span class="ident" id="4991398">writeHeap</span><span class="op" id="4991407">(</span><span class="ident" id="4991408">w</span><span class="op" id="4991409">,</span>&nbsp;<span class="num" id="4991411">0</span><span class="op" id="4991412">)</span><br>
<span class="lineno"></span><span class="op" id="4991414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4991417">//&nbsp;countHeap&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;heap&nbsp;profile.</span><br>
<span class="lineno"></span><span class="keyword" id="4991481">func</span>&nbsp;<span class="ident" id="4991486">countHeap</span><span class="op" id="4991495">(</span><span class="op" id="4991496">)</span>&nbsp;<span class="builtintype" id="4991498">int</span>&nbsp;<span class="op" id="4991502">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4991505">n</span><span class="op" id="4991506">,</span>&nbsp;<span class="ident" id="4991508">_</span>&nbsp;<span class="op" id="4991510">:=</span>&nbsp;<span class="ident" id="4991513">runtime</span><span class="op" id="4991520">.</span><span class="ident" id="4991521">MemProfile</span><span class="op" id="4991531">(</span><span class="builtintype" id="4991532">nil</span><span class="op" id="4991535">,</span>&nbsp;<span class="builtintype" id="4991537">true</span><span class="op" id="4991541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991544">return</span>&nbsp;<span class="ident" id="4991551">n</span><br>
<span class="lineno"></span><span class="op" id="4991553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4991556">//&nbsp;writeHeap&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;heap&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno">380</span><span class="keyword" id="4991615">func</span>&nbsp;<span class="ident" id="4991620">writeHeap</span><span class="op" id="4991629">(</span><span class="ident" id="4991630">w</span>&nbsp;<span class="ident" id="4991632">io</span><span class="op" id="4991634">.</span><span class="ident" id="4991635">Writer</span><span class="op" id="4991641">,</span>&nbsp;<span class="ident" id="4991643">debug</span>&nbsp;<span class="builtintype" id="4991649">int</span><span class="op" id="4991652">)</span>&nbsp;<span class="builtintype" id="4991654">error</span>&nbsp;<span class="op" id="4991660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991663">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(MemProfile(nil,&nbsp;true)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991728">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991778">//&nbsp;There&#39;s&nbsp;a&nbsp;race—more&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991835">//&nbsp;the&nbsp;two&nbsp;calls—so&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991898">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991944">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992011">var</span>&nbsp;<span class="ident" id="4992015">p</span>&nbsp;<span class="op" id="4992017">[</span><span class="op" id="4992018">]</span><span class="ident" id="4992019">runtime</span><span class="op" id="4992026">.</span><span class="ident" id="4992027">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992045">n</span><span class="op" id="4992046">,</span>&nbsp;<span class="ident" id="4992048">ok</span>&nbsp;<span class="op" id="4992051">:=</span>&nbsp;<span class="ident" id="4992054">runtime</span><span class="op" id="4992061">.</span><span class="ident" id="4992062">MemProfile</span><span class="op" id="4992072">(</span><span class="builtintype" id="4992073">nil</span><span class="op" id="4992076">,</span>&nbsp;<span class="builtintype" id="4992078">true</span><span class="op" id="4992082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992085">for</span>&nbsp;<span class="op" id="4992089">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992093">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992143">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992191">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;MemProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992226">p</span>&nbsp;<span class="op" id="4992228">=</span>&nbsp;<span class="builtinfunc" id="4992230">make</span><span class="op" id="4992234">(</span><span class="op" id="4992235">[</span><span class="op" id="4992236">]</span><span class="ident" id="4992237">runtime</span><span class="op" id="4992244">.</span><span class="ident" id="4992245">MemProfileRecord</span><span class="op" id="4992261">,</span>&nbsp;<span class="ident" id="4992263">n</span><span class="op" id="4992264">+</span><span class="num" id="4992265">50</span><span class="op" id="4992267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992271">n</span><span class="op" id="4992272">,</span>&nbsp;<span class="ident" id="4992274">ok</span>&nbsp;<span class="op" id="4992277">=</span>&nbsp;<span class="ident" id="4992279">runtime</span><span class="op" id="4992286">.</span><span class="ident" id="4992287">MemProfile</span><span class="op" id="4992297">(</span><span class="ident" id="4992298">p</span><span class="op" id="4992299">,</span>&nbsp;<span class="builtintype" id="4992301">true</span><span class="op" id="4992305">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992309">if</span>&nbsp;<span class="ident" id="4992312">ok</span>&nbsp;<span class="op" id="4992315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992320">p</span>&nbsp;<span class="op" id="4992322">=</span>&nbsp;<span class="ident" id="4992324">p</span><span class="op" id="4992325">[</span><span class="num" id="4992326">0</span><span class="op" id="4992327">:</span><span class="ident" id="4992328">n</span><span class="op" id="4992329">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992334">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4992342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992346">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4992375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992379">sort</span><span class="op" id="4992383">.</span><span class="ident" id="4992384">Sort</span><span class="op" id="4992388">(</span><span class="ident" id="4992389">byInUseBytes</span><span class="op" id="4992401">(</span><span class="ident" id="4992402">p</span><span class="op" id="4992403">)</span><span class="op" id="4992404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992408">b</span>&nbsp;<span class="op" id="4992410">:=</span>&nbsp;<span class="ident" id="4992413">bufio</span><span class="op" id="4992418">.</span><span class="ident" id="4992419">NewWriter</span><span class="op" id="4992428">(</span><span class="ident" id="4992429">w</span><span class="op" id="4992430">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992433">var</span>&nbsp;<span class="ident" id="4992437">tw</span>&nbsp;<span class="op" id="4992440">*</span><span class="ident" id="4992441">tabwriter</span><span class="op" id="4992450">.</span><span class="ident" id="4992451">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992459">w</span>&nbsp;<span class="op" id="4992461">=</span>&nbsp;<span class="ident" id="4992463">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992466">if</span>&nbsp;<span class="ident" id="4992469">debug</span>&nbsp;<span class="op" id="4992475">&gt;</span>&nbsp;<span class="num" id="4992477">0</span>&nbsp;<span class="op" id="4992479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992483">tw</span>&nbsp;<span class="op" id="4992486">=</span>&nbsp;<span class="ident" id="4992488">tabwriter</span><span class="op" id="4992497">.</span><span class="ident" id="4992498">NewWriter</span><span class="op" id="4992507">(</span><span class="ident" id="4992508">w</span><span class="op" id="4992509">,</span>&nbsp;<span class="num" id="4992511">1</span><span class="op" id="4992512">,</span>&nbsp;<span class="num" id="4992514">8</span><span class="op" id="4992515">,</span>&nbsp;<span class="num" id="4992517">1</span><span class="op" id="4992518">,</span>&nbsp;<span class="string" id="4992520">&#39;\t&#39;</span><span class="op" id="4992524">,</span>&nbsp;<span class="num" id="4992526">0</span><span class="op" id="4992527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992531">w</span>&nbsp;<span class="op" id="4992533">=</span>&nbsp;<span class="ident" id="4992535">tw</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4992539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992543">var</span>&nbsp;<span class="ident" id="4992547">total</span>&nbsp;<span class="ident" id="4992553">runtime</span><span class="op" id="4992560">.</span><span class="ident" id="4992561">MemProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992579">for</span>&nbsp;<span class="ident" id="4992583">i</span>&nbsp;<span class="op" id="4992585">:=</span>&nbsp;<span class="keyword" id="4992588">range</span>&nbsp;<span class="ident" id="4992594">p</span>&nbsp;<span class="op" id="4992596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992600">r</span>&nbsp;<span class="op" id="4992602">:=</span>&nbsp;<span class="op" id="4992605">&amp;</span><span class="ident" id="4992606">p</span><span class="op" id="4992607">[</span><span class="ident" id="4992608">i</span><span class="op" id="4992609">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992613">total</span><span class="op" id="4992618">.</span><span class="ident" id="4992619">AllocBytes</span>&nbsp;<span class="op" id="4992630">+=</span>&nbsp;<span class="ident" id="4992633">r</span><span class="op" id="4992634">.</span><span class="ident" id="4992635">AllocBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992648">total</span><span class="op" id="4992653">.</span><span class="ident" id="4992654">AllocObjects</span>&nbsp;<span class="op" id="4992667">+=</span>&nbsp;<span class="ident" id="4992670">r</span><span class="op" id="4992671">.</span><span class="ident" id="4992672">AllocObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992687">total</span><span class="op" id="4992692">.</span><span class="ident" id="4992693">FreeBytes</span>&nbsp;<span class="op" id="4992703">+=</span>&nbsp;<span class="ident" id="4992706">r</span><span class="op" id="4992707">.</span><span class="ident" id="4992708">FreeBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992720">total</span><span class="op" id="4992725">.</span><span class="ident" id="4992726">FreeObjects</span>&nbsp;<span class="op" id="4992738">+=</span>&nbsp;<span class="ident" id="4992741">r</span><span class="op" id="4992742">.</span><span class="ident" id="4992743">FreeObjects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4992756">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992760">//&nbsp;Technically&nbsp;the&nbsp;rate&nbsp;is&nbsp;MemProfileRate&nbsp;not&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992825">//&nbsp;but&nbsp;early&nbsp;versions&nbsp;of&nbsp;the&nbsp;C++&nbsp;heap&nbsp;profiler&nbsp;reported&nbsp;2*MemProfileRate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992900">//&nbsp;so&nbsp;that&#39;s&nbsp;what&nbsp;pprof&nbsp;has&nbsp;come&nbsp;to&nbsp;expect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992945">fmt</span><span class="op" id="4992948">.</span><span class="ident" id="4992949">Fprintf</span><span class="op" id="4992956">(</span><span class="ident" id="4992957">w</span><span class="op" id="4992958">,</span>&nbsp;<span class="string" id="4992960">&#34;heap&nbsp;profile:&nbsp;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&nbsp;heap/%d\n&#34;</span><span class="op" id="4993003">,</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993007">total</span><span class="op" id="4993012">.</span><span class="ident" id="4993013">InUseObjects</span><span class="op" id="4993025">(</span><span class="op" id="4993026">)</span><span class="op" id="4993027">,</span>&nbsp;<span class="ident" id="4993029">total</span><span class="op" id="4993034">.</span><span class="ident" id="4993035">InUseBytes</span><span class="op" id="4993045">(</span><span class="op" id="4993046">)</span><span class="op" id="4993047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993051">total</span><span class="op" id="4993056">.</span><span class="ident" id="4993057">AllocObjects</span><span class="op" id="4993069">,</span>&nbsp;<span class="ident" id="4993071">total</span><span class="op" id="4993076">.</span><span class="ident" id="4993077">AllocBytes</span><span class="op" id="4993087">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4993091">2</span><span class="op" id="4993092">*</span><span class="ident" id="4993093">runtime</span><span class="op" id="4993100">.</span><span class="ident" id="4993101">MemProfileRate</span><span class="op" id="4993115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993119">for</span>&nbsp;<span class="ident" id="4993123">i</span>&nbsp;<span class="op" id="4993125">:=</span>&nbsp;<span class="keyword" id="4993128">range</span>&nbsp;<span class="ident" id="4993134">p</span>&nbsp;<span class="op" id="4993136">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993140">r</span>&nbsp;<span class="op" id="4993142">:=</span>&nbsp;<span class="op" id="4993145">&amp;</span><span class="ident" id="4993146">p</span><span class="op" id="4993147">[</span><span class="ident" id="4993148">i</span><span class="op" id="4993149">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993153">fmt</span><span class="op" id="4993156">.</span><span class="ident" id="4993157">Fprintf</span><span class="op" id="4993164">(</span><span class="ident" id="4993165">w</span><span class="op" id="4993166">,</span>&nbsp;<span class="string" id="4993168">&#34;%d:&nbsp;%d&nbsp;[%d:&nbsp;%d]&nbsp;@&#34;</span><span class="op" id="4993187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993192">r</span><span class="op" id="4993193">.</span><span class="ident" id="4993194">InUseObjects</span><span class="op" id="4993206">(</span><span class="op" id="4993207">)</span><span class="op" id="4993208">,</span>&nbsp;<span class="ident" id="4993210">r</span><span class="op" id="4993211">.</span><span class="ident" id="4993212">InUseBytes</span><span class="op" id="4993222">(</span><span class="op" id="4993223">)</span><span class="op" id="4993224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993229">r</span><span class="op" id="4993230">.</span><span class="ident" id="4993231">AllocObjects</span><span class="op" id="4993243">,</span>&nbsp;<span class="ident" id="4993245">r</span><span class="op" id="4993246">.</span><span class="ident" id="4993247">AllocBytes</span><span class="op" id="4993257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993261">for</span>&nbsp;<span class="ident" id="4993265">_</span><span class="op" id="4993266">,</span>&nbsp;<span class="ident" id="4993268">pc</span>&nbsp;<span class="op" id="4993271">:=</span>&nbsp;<span class="keyword" id="4993274">range</span>&nbsp;<span class="ident" id="4993280">r</span><span class="op" id="4993281">.</span><span class="ident" id="4993282">Stack</span><span class="op" id="4993287">(</span><span class="op" id="4993288">)</span>&nbsp;<span class="op" id="4993290">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993295">fmt</span><span class="op" id="4993298">.</span><span class="ident" id="4993299">Fprintf</span><span class="op" id="4993306">(</span><span class="ident" id="4993307">w</span><span class="op" id="4993308">,</span>&nbsp;<span class="string" id="4993310">&#34;&nbsp;%#x&#34;</span><span class="op" id="4993316">,</span>&nbsp;<span class="ident" id="4993318">pc</span><span class="op" id="4993320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993328">fmt</span><span class="op" id="4993331">.</span><span class="ident" id="4993332">Fprintf</span><span class="op" id="4993339">(</span><span class="ident" id="4993340">w</span><span class="op" id="4993341">,</span>&nbsp;<span class="string" id="4993343">&#34;\n&#34;</span><span class="op" id="4993347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993351">if</span>&nbsp;<span class="ident" id="4993354">debug</span>&nbsp;<span class="op" id="4993360">&gt;</span>&nbsp;<span class="num" id="4993362">0</span>&nbsp;<span class="op" id="4993364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993369">printStackRecord</span><span class="op" id="4993385">(</span><span class="ident" id="4993386">w</span><span class="op" id="4993387">,</span>&nbsp;<span class="ident" id="4993389">r</span><span class="op" id="4993390">.</span><span class="ident" id="4993391">Stack</span><span class="op" id="4993396">(</span><span class="op" id="4993397">)</span><span class="op" id="4993398">,</span>&nbsp;<span class="builtintype" id="4993400">false</span><span class="op" id="4993405">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4993416">//&nbsp;Print&nbsp;memstats&nbsp;information&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4993452">//&nbsp;Pprof&nbsp;will&nbsp;ignore,&nbsp;but&nbsp;useful&nbsp;for&nbsp;people</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993497">if</span>&nbsp;<span class="ident" id="4993500">debug</span>&nbsp;<span class="op" id="4993506">&gt;</span>&nbsp;<span class="num" id="4993508">0</span>&nbsp;<span class="op" id="4993510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993514">s</span>&nbsp;<span class="op" id="4993516">:=</span>&nbsp;<span class="builtinfunc" id="4993519">new</span><span class="op" id="4993522">(</span><span class="ident" id="4993523">runtime</span><span class="op" id="4993530">.</span><span class="ident" id="4993531">MemStats</span><span class="op" id="4993539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993543">runtime</span><span class="op" id="4993550">.</span><span class="ident" id="4993551">ReadMemStats</span><span class="op" id="4993563">(</span><span class="ident" id="4993564">s</span><span class="op" id="4993565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993569">fmt</span><span class="op" id="4993572">.</span><span class="ident" id="4993573">Fprintf</span><span class="op" id="4993580">(</span><span class="ident" id="4993581">w</span><span class="op" id="4993582">,</span>&nbsp;<span class="string" id="4993584">&#34;\n#&nbsp;runtime.MemStats\n&#34;</span><span class="op" id="4993608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993612">fmt</span><span class="op" id="4993615">.</span><span class="ident" id="4993616">Fprintf</span><span class="op" id="4993623">(</span><span class="ident" id="4993624">w</span><span class="op" id="4993625">,</span>&nbsp;<span class="string" id="4993627">&#34;#&nbsp;Alloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993643">,</span>&nbsp;<span class="ident" id="4993645">s</span><span class="op" id="4993646">.</span><span class="ident" id="4993647">Alloc</span><span class="op" id="4993652">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993656">fmt</span><span class="op" id="4993659">.</span><span class="ident" id="4993660">Fprintf</span><span class="op" id="4993667">(</span><span class="ident" id="4993668">w</span><span class="op" id="4993669">,</span>&nbsp;<span class="string" id="4993671">&#34;#&nbsp;TotalAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993692">,</span>&nbsp;<span class="ident" id="4993694">s</span><span class="op" id="4993695">.</span><span class="ident" id="4993696">TotalAlloc</span><span class="op" id="4993706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993710">fmt</span><span class="op" id="4993713">.</span><span class="ident" id="4993714">Fprintf</span><span class="op" id="4993721">(</span><span class="ident" id="4993722">w</span><span class="op" id="4993723">,</span>&nbsp;<span class="string" id="4993725">&#34;#&nbsp;Sys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993739">,</span>&nbsp;<span class="ident" id="4993741">s</span><span class="op" id="4993742">.</span><span class="ident" id="4993743">Sys</span><span class="op" id="4993746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993750">fmt</span><span class="op" id="4993753">.</span><span class="ident" id="4993754">Fprintf</span><span class="op" id="4993761">(</span><span class="ident" id="4993762">w</span><span class="op" id="4993763">,</span>&nbsp;<span class="string" id="4993765">&#34;#&nbsp;Lookups&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993783">,</span>&nbsp;<span class="ident" id="4993785">s</span><span class="op" id="4993786">.</span><span class="ident" id="4993787">Lookups</span><span class="op" id="4993794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993798">fmt</span><span class="op" id="4993801">.</span><span class="ident" id="4993802">Fprintf</span><span class="op" id="4993809">(</span><span class="ident" id="4993810">w</span><span class="op" id="4993811">,</span>&nbsp;<span class="string" id="4993813">&#34;#&nbsp;Mallocs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993831">,</span>&nbsp;<span class="ident" id="4993833">s</span><span class="op" id="4993834">.</span><span class="ident" id="4993835">Mallocs</span><span class="op" id="4993842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993846">fmt</span><span class="op" id="4993849">.</span><span class="ident" id="4993850">Fprintf</span><span class="op" id="4993857">(</span><span class="ident" id="4993858">w</span><span class="op" id="4993859">,</span>&nbsp;<span class="string" id="4993861">&#34;#&nbsp;Frees&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993877">,</span>&nbsp;<span class="ident" id="4993879">s</span><span class="op" id="4993880">.</span><span class="ident" id="4993881">Frees</span><span class="op" id="4993886">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993891">fmt</span><span class="op" id="4993894">.</span><span class="ident" id="4993895">Fprintf</span><span class="op" id="4993902">(</span><span class="ident" id="4993903">w</span><span class="op" id="4993904">,</span>&nbsp;<span class="string" id="4993906">&#34;#&nbsp;HeapAlloc&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993926">,</span>&nbsp;<span class="ident" id="4993928">s</span><span class="op" id="4993929">.</span><span class="ident" id="4993930">HeapAlloc</span><span class="op" id="4993939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993943">fmt</span><span class="op" id="4993946">.</span><span class="ident" id="4993947">Fprintf</span><span class="op" id="4993954">(</span><span class="ident" id="4993955">w</span><span class="op" id="4993956">,</span>&nbsp;<span class="string" id="4993958">&#34;#&nbsp;HeapSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4993976">,</span>&nbsp;<span class="ident" id="4993978">s</span><span class="op" id="4993979">.</span><span class="ident" id="4993980">HeapSys</span><span class="op" id="4993987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993991">fmt</span><span class="op" id="4993994">.</span><span class="ident" id="4993995">Fprintf</span><span class="op" id="4994002">(</span><span class="ident" id="4994003">w</span><span class="op" id="4994004">,</span>&nbsp;<span class="string" id="4994006">&#34;#&nbsp;HeapIdle&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994025">,</span>&nbsp;<span class="ident" id="4994027">s</span><span class="op" id="4994028">.</span><span class="ident" id="4994029">HeapIdle</span><span class="op" id="4994037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994041">fmt</span><span class="op" id="4994044">.</span><span class="ident" id="4994045">Fprintf</span><span class="op" id="4994052">(</span><span class="ident" id="4994053">w</span><span class="op" id="4994054">,</span>&nbsp;<span class="string" id="4994056">&#34;#&nbsp;HeapInuse&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994076">,</span>&nbsp;<span class="ident" id="4994078">s</span><span class="op" id="4994079">.</span><span class="ident" id="4994080">HeapInuse</span><span class="op" id="4994089">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994093">fmt</span><span class="op" id="4994096">.</span><span class="ident" id="4994097">Fprintf</span><span class="op" id="4994104">(</span><span class="ident" id="4994105">w</span><span class="op" id="4994106">,</span>&nbsp;<span class="string" id="4994108">&#34;#&nbsp;HeapReleased&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994131">,</span>&nbsp;<span class="ident" id="4994133">s</span><span class="op" id="4994134">.</span><span class="ident" id="4994135">HeapReleased</span><span class="op" id="4994147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994151">fmt</span><span class="op" id="4994154">.</span><span class="ident" id="4994155">Fprintf</span><span class="op" id="4994162">(</span><span class="ident" id="4994163">w</span><span class="op" id="4994164">,</span>&nbsp;<span class="string" id="4994166">&#34;#&nbsp;HeapObjects&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994188">,</span>&nbsp;<span class="ident" id="4994190">s</span><span class="op" id="4994191">.</span><span class="ident" id="4994192">HeapObjects</span><span class="op" id="4994203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994208">fmt</span><span class="op" id="4994211">.</span><span class="ident" id="4994212">Fprintf</span><span class="op" id="4994219">(</span><span class="ident" id="4994220">w</span><span class="op" id="4994221">,</span>&nbsp;<span class="string" id="4994223">&#34;#&nbsp;Stack&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4994244">,</span>&nbsp;<span class="ident" id="4994246">s</span><span class="op" id="4994247">.</span><span class="ident" id="4994248">StackInuse</span><span class="op" id="4994258">,</span>&nbsp;<span class="ident" id="4994260">s</span><span class="op" id="4994261">.</span><span class="ident" id="4994262">StackSys</span><span class="op" id="4994270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994274">fmt</span><span class="op" id="4994277">.</span><span class="ident" id="4994278">Fprintf</span><span class="op" id="4994285">(</span><span class="ident" id="4994286">w</span><span class="op" id="4994287">,</span>&nbsp;<span class="string" id="4994289">&#34;#&nbsp;MSpan&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4994310">,</span>&nbsp;<span class="ident" id="4994312">s</span><span class="op" id="4994313">.</span><span class="ident" id="4994314">MSpanInuse</span><span class="op" id="4994324">,</span>&nbsp;<span class="ident" id="4994326">s</span><span class="op" id="4994327">.</span><span class="ident" id="4994328">MSpanSys</span><span class="op" id="4994336">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994340">fmt</span><span class="op" id="4994343">.</span><span class="ident" id="4994344">Fprintf</span><span class="op" id="4994351">(</span><span class="ident" id="4994352">w</span><span class="op" id="4994353">,</span>&nbsp;<span class="string" id="4994355">&#34;#&nbsp;MCache&nbsp;=&nbsp;%d&nbsp;/&nbsp;%d\n&#34;</span><span class="op" id="4994377">,</span>&nbsp;<span class="ident" id="4994379">s</span><span class="op" id="4994380">.</span><span class="ident" id="4994381">MCacheInuse</span><span class="op" id="4994392">,</span>&nbsp;<span class="ident" id="4994394">s</span><span class="op" id="4994395">.</span><span class="ident" id="4994396">MCacheSys</span><span class="op" id="4994405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994409">fmt</span><span class="op" id="4994412">.</span><span class="ident" id="4994413">Fprintf</span><span class="op" id="4994420">(</span><span class="ident" id="4994421">w</span><span class="op" id="4994422">,</span>&nbsp;<span class="string" id="4994424">&#34;#&nbsp;BuckHashSys&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994446">,</span>&nbsp;<span class="ident" id="4994448">s</span><span class="op" id="4994449">.</span><span class="ident" id="4994450">BuckHashSys</span><span class="op" id="4994461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994466">fmt</span><span class="op" id="4994469">.</span><span class="ident" id="4994470">Fprintf</span><span class="op" id="4994477">(</span><span class="ident" id="4994478">w</span><span class="op" id="4994479">,</span>&nbsp;<span class="string" id="4994481">&#34;#&nbsp;NextGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994498">,</span>&nbsp;<span class="ident" id="4994500">s</span><span class="op" id="4994501">.</span><span class="ident" id="4994502">NextGC</span><span class="op" id="4994508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994512">fmt</span><span class="op" id="4994515">.</span><span class="ident" id="4994516">Fprintf</span><span class="op" id="4994523">(</span><span class="ident" id="4994524">w</span><span class="op" id="4994525">,</span>&nbsp;<span class="string" id="4994527">&#34;#&nbsp;PauseNs&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994545">,</span>&nbsp;<span class="ident" id="4994547">s</span><span class="op" id="4994548">.</span><span class="ident" id="4994549">PauseNs</span><span class="op" id="4994556">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994560">fmt</span><span class="op" id="4994563">.</span><span class="ident" id="4994564">Fprintf</span><span class="op" id="4994571">(</span><span class="ident" id="4994572">w</span><span class="op" id="4994573">,</span>&nbsp;<span class="string" id="4994575">&#34;#&nbsp;NumGC&nbsp;=&nbsp;%d\n&#34;</span><span class="op" id="4994591">,</span>&nbsp;<span class="ident" id="4994593">s</span><span class="op" id="4994594">.</span><span class="ident" id="4994595">NumGC</span><span class="op" id="4994600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994604">fmt</span><span class="op" id="4994607">.</span><span class="ident" id="4994608">Fprintf</span><span class="op" id="4994615">(</span><span class="ident" id="4994616">w</span><span class="op" id="4994617">,</span>&nbsp;<span class="string" id="4994619">&#34;#&nbsp;EnableGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4994638">,</span>&nbsp;<span class="ident" id="4994640">s</span><span class="op" id="4994641">.</span><span class="ident" id="4994642">EnableGC</span><span class="op" id="4994650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994654">fmt</span><span class="op" id="4994657">.</span><span class="ident" id="4994658">Fprintf</span><span class="op" id="4994665">(</span><span class="ident" id="4994666">w</span><span class="op" id="4994667">,</span>&nbsp;<span class="string" id="4994669">&#34;#&nbsp;DebugGC&nbsp;=&nbsp;%v\n&#34;</span><span class="op" id="4994687">,</span>&nbsp;<span class="ident" id="4994689">s</span><span class="op" id="4994690">.</span><span class="ident" id="4994691">DebugGC</span><span class="op" id="4994698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994705">if</span>&nbsp;<span class="ident" id="4994708">tw</span>&nbsp;<span class="op" id="4994711">!=</span>&nbsp;<span class="builtintype" id="4994714">nil</span>&nbsp;<span class="op" id="4994718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994722">tw</span><span class="op" id="4994724">.</span><span class="ident" id="4994725">Flush</span><span class="op" id="4994730">(</span><span class="op" id="4994731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994737">return</span>&nbsp;<span class="ident" id="4994744">b</span><span class="op" id="4994745">.</span><span class="ident" id="4994746">Flush</span><span class="op" id="4994751">(</span><span class="op" id="4994752">)</span><br>
<span class="lineno"></span><span class="op" id="4994754">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="4994757">//&nbsp;countThreadCreate&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;current&nbsp;ThreadCreateProfile.</span><br>
<span class="lineno"></span><span class="keyword" id="4994831">func</span>&nbsp;<span class="ident" id="4994836">countThreadCreate</span><span class="op" id="4994853">(</span><span class="op" id="4994854">)</span>&nbsp;<span class="builtintype" id="4994856">int</span>&nbsp;<span class="op" id="4994860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994863">n</span><span class="op" id="4994864">,</span>&nbsp;<span class="ident" id="4994866">_</span>&nbsp;<span class="op" id="4994868">:=</span>&nbsp;<span class="ident" id="4994871">runtime</span><span class="op" id="4994878">.</span><span class="ident" id="4994879">ThreadCreateProfile</span><span class="op" id="4994898">(</span><span class="builtintype" id="4994899">nil</span><span class="op" id="4994902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4994905">return</span>&nbsp;<span class="ident" id="4994912">n</span><br>
<span class="lineno">485</span><span class="op" id="4994914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4994917">//&nbsp;writeThreadCreate&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;ThreadCreateProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4994991">func</span>&nbsp;<span class="ident" id="4994996">writeThreadCreate</span><span class="op" id="4995013">(</span><span class="ident" id="4995014">w</span>&nbsp;<span class="ident" id="4995016">io</span><span class="op" id="4995018">.</span><span class="ident" id="4995019">Writer</span><span class="op" id="4995025">,</span>&nbsp;<span class="ident" id="4995027">debug</span>&nbsp;<span class="builtintype" id="4995033">int</span><span class="op" id="4995036">)</span>&nbsp;<span class="builtintype" id="4995038">error</span>&nbsp;<span class="op" id="4995044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995047">return</span>&nbsp;<span class="ident" id="4995054">writeRuntimeProfile</span><span class="op" id="4995073">(</span><span class="ident" id="4995074">w</span><span class="op" id="4995075">,</span>&nbsp;<span class="ident" id="4995077">debug</span><span class="op" id="4995082">,</span>&nbsp;<span class="string" id="4995084">&#34;threadcreate&#34;</span><span class="op" id="4995098">,</span>&nbsp;<span class="ident" id="4995100">runtime</span><span class="op" id="4995107">.</span><span class="ident" id="4995108">ThreadCreateProfile</span><span class="op" id="4995127">)</span><br>
<span class="lineno">490</span><span class="op" id="4995129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4995132">//&nbsp;countGoroutine&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4995184">func</span>&nbsp;<span class="ident" id="4995189">countGoroutine</span><span class="op" id="4995203">(</span><span class="op" id="4995204">)</span>&nbsp;<span class="builtintype" id="4995206">int</span>&nbsp;<span class="op" id="4995210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995213">return</span>&nbsp;<span class="ident" id="4995220">runtime</span><span class="op" id="4995227">.</span><span class="ident" id="4995228">NumGoroutine</span><span class="op" id="4995240">(</span><span class="op" id="4995241">)</span><br>
<span class="lineno">495</span><span class="op" id="4995243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4995246">//&nbsp;writeGoroutine&nbsp;writes&nbsp;the&nbsp;current&nbsp;runtime&nbsp;GoroutineProfile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4995314">func</span>&nbsp;<span class="ident" id="4995319">writeGoroutine</span><span class="op" id="4995333">(</span><span class="ident" id="4995334">w</span>&nbsp;<span class="ident" id="4995336">io</span><span class="op" id="4995338">.</span><span class="ident" id="4995339">Writer</span><span class="op" id="4995345">,</span>&nbsp;<span class="ident" id="4995347">debug</span>&nbsp;<span class="builtintype" id="4995353">int</span><span class="op" id="4995356">)</span>&nbsp;<span class="builtintype" id="4995358">error</span>&nbsp;<span class="op" id="4995364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995367">if</span>&nbsp;<span class="ident" id="4995370">debug</span>&nbsp;<span class="op" id="4995376">&gt;=</span>&nbsp;<span class="num" id="4995379">2</span>&nbsp;<span class="op" id="4995381">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995385">return</span>&nbsp;<span class="ident" id="4995392">writeGoroutineStacks</span><span class="op" id="4995412">(</span><span class="ident" id="4995413">w</span><span class="op" id="4995414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995420">return</span>&nbsp;<span class="ident" id="4995427">writeRuntimeProfile</span><span class="op" id="4995446">(</span><span class="ident" id="4995447">w</span><span class="op" id="4995448">,</span>&nbsp;<span class="ident" id="4995450">debug</span><span class="op" id="4995455">,</span>&nbsp;<span class="string" id="4995457">&#34;goroutine&#34;</span><span class="op" id="4995468">,</span>&nbsp;<span class="ident" id="4995470">runtime</span><span class="op" id="4995477">.</span><span class="ident" id="4995478">GoroutineProfile</span><span class="op" id="4995494">)</span><br>
<span class="lineno"></span><span class="op" id="4995496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="4995499">func</span>&nbsp;<span class="ident" id="4995504">writeGoroutineStacks</span><span class="op" id="4995524">(</span><span class="ident" id="4995525">w</span>&nbsp;<span class="ident" id="4995527">io</span><span class="op" id="4995529">.</span><span class="ident" id="4995530">Writer</span><span class="op" id="4995536">)</span>&nbsp;<span class="builtintype" id="4995538">error</span>&nbsp;<span class="op" id="4995544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995547">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;big&nbsp;the&nbsp;buffer&nbsp;needs&nbsp;to&nbsp;be&nbsp;to&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995607">//&nbsp;all&nbsp;the&nbsp;goroutines.&nbsp;&nbsp;Start&nbsp;with&nbsp;1&nbsp;MB&nbsp;and&nbsp;try&nbsp;a&nbsp;few&nbsp;times,&nbsp;doubling&nbsp;each&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995689">//&nbsp;Give&nbsp;up&nbsp;and&nbsp;use&nbsp;a&nbsp;truncated&nbsp;trace&nbsp;if&nbsp;64&nbsp;MB&nbsp;is&nbsp;not&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995751">buf</span>&nbsp;<span class="op" id="4995755">:=</span>&nbsp;<span class="builtinfunc" id="4995758">make</span><span class="op" id="4995762">(</span><span class="op" id="4995763">[</span><span class="op" id="4995764">]</span><span class="builtintype" id="4995765">byte</span><span class="op" id="4995769">,</span>&nbsp;<span class="num" id="4995771">1</span><span class="op" id="4995772">&lt;&lt;</span><span class="num" id="4995774">20</span><span class="op" id="4995776">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995779">for</span>&nbsp;<span class="ident" id="4995783">i</span>&nbsp;<span class="op" id="4995785">:=</span>&nbsp;<span class="num" id="4995788">0</span><span class="op" id="4995789">;</span>&nbsp;<span class="op" id="4995791">;</span>&nbsp;<span class="ident" id="4995793">i</span><span class="op" id="4995794">++</span>&nbsp;<span class="op" id="4995797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995801">n</span>&nbsp;<span class="op" id="4995803">:=</span>&nbsp;<span class="ident" id="4995806">runtime</span><span class="op" id="4995813">.</span><span class="ident" id="4995814">Stack</span><span class="op" id="4995819">(</span><span class="ident" id="4995820">buf</span><span class="op" id="4995823">,</span>&nbsp;<span class="builtintype" id="4995825">true</span><span class="op" id="4995829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995833">if</span>&nbsp;<span class="ident" id="4995836">n</span>&nbsp;<span class="op" id="4995838">&lt;</span>&nbsp;<span class="builtinfunc" id="4995840">len</span><span class="op" id="4995843">(</span><span class="ident" id="4995844">buf</span><span class="op" id="4995847">)</span>&nbsp;<span class="op" id="4995849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995854">buf</span>&nbsp;<span class="op" id="4995858">=</span>&nbsp;<span class="ident" id="4995860">buf</span><span class="op" id="4995863">[</span><span class="op" id="4995864">:</span><span class="ident" id="4995865">n</span><span class="op" id="4995866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995871">break</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995883">if</span>&nbsp;<span class="builtinfunc" id="4995886">len</span><span class="op" id="4995889">(</span><span class="ident" id="4995890">buf</span><span class="op" id="4995893">)</span>&nbsp;<span class="op" id="4995895">&gt;=</span>&nbsp;<span class="num" id="4995898">64</span><span class="op" id="4995900">&lt;&lt;</span><span class="num" id="4995902">20</span>&nbsp;<span class="op" id="4995905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995910">//&nbsp;Filled&nbsp;64&nbsp;MB&nbsp;-&nbsp;stop&nbsp;there.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4995943">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995951">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995955">buf</span>&nbsp;<span class="op" id="4995959">=</span>&nbsp;<span class="builtinfunc" id="4995961">make</span><span class="op" id="4995965">(</span><span class="op" id="4995966">[</span><span class="op" id="4995967">]</span><span class="builtintype" id="4995968">byte</span><span class="op" id="4995972">,</span>&nbsp;<span class="num" id="4995974">2</span><span class="op" id="4995975">*</span><span class="builtinfunc" id="4995976">len</span><span class="op" id="4995979">(</span><span class="ident" id="4995980">buf</span><span class="op" id="4995983">)</span><span class="op" id="4995984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4995987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995990">_</span><span class="op" id="4995991">,</span>&nbsp;<span class="ident" id="4995993">err</span>&nbsp;<span class="op" id="4995997">:=</span>&nbsp;<span class="ident" id="4996000">w</span><span class="op" id="4996001">.</span><span class="ident" id="4996002">Write</span><span class="op" id="4996007">(</span><span class="ident" id="4996008">buf</span><span class="op" id="4996011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996014">return</span>&nbsp;<span class="ident" id="4996021">err</span><br>
<span class="lineno"></span><span class="op" id="4996025">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span><span class="keyword" id="4996028">func</span>&nbsp;<span class="ident" id="4996033">writeRuntimeProfile</span><span class="op" id="4996052">(</span><span class="ident" id="4996053">w</span>&nbsp;<span class="ident" id="4996055">io</span><span class="op" id="4996057">.</span><span class="ident" id="4996058">Writer</span><span class="op" id="4996064">,</span>&nbsp;<span class="ident" id="4996066">debug</span>&nbsp;<span class="builtintype" id="4996072">int</span><span class="op" id="4996075">,</span>&nbsp;<span class="ident" id="4996077">name</span>&nbsp;<span class="builtintype" id="4996082">string</span><span class="op" id="4996088">,</span>&nbsp;<span class="ident" id="4996090">fetch</span>&nbsp;<span class="keyword" id="4996096">func</span><span class="op" id="4996100">(</span><span class="op" id="4996101">[</span><span class="op" id="4996102">]</span><span class="ident" id="4996103">runtime</span><span class="op" id="4996110">.</span><span class="ident" id="4996111">StackRecord</span><span class="op" id="4996122">)</span>&nbsp;<span class="op" id="4996124">(</span><span class="builtintype" id="4996125">int</span><span class="op" id="4996128">,</span>&nbsp;<span class="builtintype" id="4996130">bool</span><span class="op" id="4996134">)</span><span class="op" id="4996135">)</span>&nbsp;<span class="builtintype" id="4996137">error</span>&nbsp;<span class="op" id="4996143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996146">//&nbsp;Find&nbsp;out&nbsp;how&nbsp;many&nbsp;records&nbsp;there&nbsp;are&nbsp;(fetch(nil)),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996200">//&nbsp;allocate&nbsp;that&nbsp;many&nbsp;records,&nbsp;and&nbsp;get&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996250">//&nbsp;There&#39;s&nbsp;a&nbsp;race—more&nbsp;records&nbsp;might&nbsp;be&nbsp;added&nbsp;between</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996307">//&nbsp;the&nbsp;two&nbsp;calls—so&nbsp;allocate&nbsp;a&nbsp;few&nbsp;extra&nbsp;records&nbsp;for&nbsp;safety</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996370">//&nbsp;and&nbsp;also&nbsp;try&nbsp;again&nbsp;if&nbsp;we&#39;re&nbsp;very&nbsp;unlucky.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996416">//&nbsp;The&nbsp;loop&nbsp;should&nbsp;only&nbsp;execute&nbsp;one&nbsp;iteration&nbsp;in&nbsp;the&nbsp;common&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996483">var</span>&nbsp;<span class="ident" id="4996487">p</span>&nbsp;<span class="op" id="4996489">[</span><span class="op" id="4996490">]</span><span class="ident" id="4996491">runtime</span><span class="op" id="4996498">.</span><span class="ident" id="4996499">StackRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996512">n</span><span class="op" id="4996513">,</span>&nbsp;<span class="ident" id="4996515">ok</span>&nbsp;<span class="op" id="4996518">:=</span>&nbsp;<span class="ident" id="4996521">fetch</span><span class="op" id="4996526">(</span><span class="builtintype" id="4996527">nil</span><span class="op" id="4996530">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996533">for</span>&nbsp;<span class="op" id="4996537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996541">//&nbsp;Allocate&nbsp;room&nbsp;for&nbsp;a&nbsp;slightly&nbsp;bigger&nbsp;profile,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996591">//&nbsp;in&nbsp;case&nbsp;a&nbsp;few&nbsp;more&nbsp;entries&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996639">//&nbsp;since&nbsp;the&nbsp;call&nbsp;to&nbsp;ThreadProfile.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996677">p</span>&nbsp;<span class="op" id="4996679">=</span>&nbsp;<span class="builtinfunc" id="4996681">make</span><span class="op" id="4996685">(</span><span class="op" id="4996686">[</span><span class="op" id="4996687">]</span><span class="ident" id="4996688">runtime</span><span class="op" id="4996695">.</span><span class="ident" id="4996696">StackRecord</span><span class="op" id="4996707">,</span>&nbsp;<span class="ident" id="4996709">n</span><span class="op" id="4996710">+</span><span class="num" id="4996711">10</span><span class="op" id="4996713">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996717">n</span><span class="op" id="4996718">,</span>&nbsp;<span class="ident" id="4996720">ok</span>&nbsp;<span class="op" id="4996723">=</span>&nbsp;<span class="ident" id="4996725">fetch</span><span class="op" id="4996730">(</span><span class="ident" id="4996731">p</span><span class="op" id="4996732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996736">if</span>&nbsp;<span class="ident" id="4996739">ok</span>&nbsp;<span class="op" id="4996742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996747">p</span>&nbsp;<span class="op" id="4996749">=</span>&nbsp;<span class="ident" id="4996751">p</span><span class="op" id="4996752">[</span><span class="num" id="4996753">0</span><span class="op" id="4996754">:</span><span class="ident" id="4996755">n</span><span class="op" id="4996756">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996761">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996769">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996773">//&nbsp;Profile&nbsp;grew;&nbsp;try&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996806">return</span>&nbsp;<span class="ident" id="4996813">printCountProfile</span><span class="op" id="4996830">(</span><span class="ident" id="4996831">w</span><span class="op" id="4996832">,</span>&nbsp;<span class="ident" id="4996834">debug</span><span class="op" id="4996839">,</span>&nbsp;<span class="ident" id="4996841">name</span><span class="op" id="4996845">,</span>&nbsp;<span class="ident" id="4996847">runtimeProfile</span><span class="op" id="4996861">(</span><span class="ident" id="4996862">p</span><span class="op" id="4996863">)</span><span class="op" id="4996864">)</span><br>
<span class="lineno"></span><span class="op" id="4996866">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="keyword" id="4996869">type</span>&nbsp;<span class="ident" id="4996874">runtimeProfile</span>&nbsp;<span class="op" id="4996889">[</span><span class="op" id="4996890">]</span><span class="ident" id="4996891">runtime</span><span class="op" id="4996898">.</span><span class="ident" id="4996899">StackRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4996912">func</span>&nbsp;<span class="op" id="4996917">(</span><span class="ident" id="4996918">p</span>&nbsp;<span class="ident" id="4996920">runtimeProfile</span><span class="op" id="4996934">)</span>&nbsp;<span class="ident" id="4996936">Len</span><span class="op" id="4996939">(</span><span class="op" id="4996940">)</span>&nbsp;<span class="builtintype" id="4996942">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996959">{</span>&nbsp;<span class="keyword" id="4996961">return</span>&nbsp;<span class="builtinfunc" id="4996968">len</span><span class="op" id="4996971">(</span><span class="ident" id="4996972">p</span><span class="op" id="4996973">)</span>&nbsp;<span class="op" id="4996975">}</span><br>
<span class="lineno"></span><span class="keyword" id="4996977">func</span>&nbsp;<span class="op" id="4996982">(</span><span class="ident" id="4996983">p</span>&nbsp;<span class="ident" id="4996985">runtimeProfile</span><span class="op" id="4996999">)</span>&nbsp;<span class="ident" id="4997001">Stack</span><span class="op" id="4997006">(</span><span class="ident" id="4997007">i</span>&nbsp;<span class="builtintype" id="4997009">int</span><span class="op" id="4997012">)</span>&nbsp;<span class="op" id="4997014">[</span><span class="op" id="4997015">]</span><span class="builtintype" id="4997016">uintptr</span>&nbsp;<span class="op" id="4997024">{</span>&nbsp;<span class="keyword" id="4997026">return</span>&nbsp;<span class="ident" id="4997033">p</span><span class="op" id="4997034">[</span><span class="ident" id="4997035">i</span><span class="op" id="4997036">]</span><span class="op" id="4997037">.</span><span class="ident" id="4997038">Stack</span><span class="op" id="4997043">(</span><span class="op" id="4997044">)</span>&nbsp;<span class="op" id="4997046">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="4997049">var</span>&nbsp;<span class="ident" id="4997053">cpu</span>&nbsp;<span class="keyword" id="4997057">struct</span>&nbsp;<span class="op" id="4997064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997067">sync</span><span class="op" id="4997071">.</span><span class="ident" id="4997072">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997079">profiling</span>&nbsp;<span class="builtintype" id="4997089">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997095">done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997105">chan</span>&nbsp;<span class="builtintype" id="4997110">bool</span><br>
<span class="lineno">560</span><span class="op" id="4997115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4997118">//&nbsp;StartCPUProfile&nbsp;enables&nbsp;CPU&nbsp;profiling&nbsp;for&nbsp;the&nbsp;current&nbsp;process.</span><br>
<span class="lineno"></span><span class="comment" id="4997184">//&nbsp;While&nbsp;profiling,&nbsp;the&nbsp;profile&nbsp;will&nbsp;be&nbsp;buffered&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4997251">//&nbsp;StartCPUProfile&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;profiling&nbsp;is&nbsp;already&nbsp;enabled.</span><br>
<span class="lineno">565</span><span class="keyword" id="4997320">func</span>&nbsp;<span class="ident" id="4997325">StartCPUProfile</span><span class="op" id="4997340">(</span><span class="ident" id="4997341">w</span>&nbsp;<span class="ident" id="4997343">io</span><span class="op" id="4997345">.</span><span class="ident" id="4997346">Writer</span><span class="op" id="4997352">)</span>&nbsp;<span class="builtintype" id="4997354">error</span>&nbsp;<span class="op" id="4997360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997363">//&nbsp;The&nbsp;runtime&nbsp;routines&nbsp;allow&nbsp;a&nbsp;variable&nbsp;profiling&nbsp;rate,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997421">//&nbsp;but&nbsp;in&nbsp;practice&nbsp;operating&nbsp;systems&nbsp;cannot&nbsp;trigger&nbsp;signals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997482">//&nbsp;at&nbsp;more&nbsp;than&nbsp;about&nbsp;500&nbsp;Hz,&nbsp;and&nbsp;our&nbsp;processing&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997539">//&nbsp;signal&nbsp;is&nbsp;not&nbsp;cheap&nbsp;(mostly&nbsp;getting&nbsp;the&nbsp;stack&nbsp;trace).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997597">//&nbsp;100&nbsp;Hz&nbsp;is&nbsp;a&nbsp;reasonable&nbsp;choice:&nbsp;it&nbsp;is&nbsp;frequent&nbsp;enough&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997657">//&nbsp;produce&nbsp;useful&nbsp;data,&nbsp;rare&nbsp;enough&nbsp;not&nbsp;to&nbsp;bog&nbsp;down&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997714">//&nbsp;system,&nbsp;and&nbsp;a&nbsp;nice&nbsp;round&nbsp;number&nbsp;to&nbsp;make&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997769">//&nbsp;convert&nbsp;sample&nbsp;counts&nbsp;to&nbsp;seconds.&nbsp;&nbsp;Instead&nbsp;of&nbsp;requiring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997829">//&nbsp;each&nbsp;client&nbsp;to&nbsp;specify&nbsp;the&nbsp;frequency,&nbsp;we&nbsp;hard&nbsp;code&nbsp;it.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997888">const</span>&nbsp;<span class="ident" id="4997894">hz</span>&nbsp;<span class="op" id="4997897">=</span>&nbsp;<span class="num" id="4997899">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997905">cpu</span><span class="op" id="4997908">.</span><span class="ident" id="4997909">Lock</span><span class="op" id="4997913">(</span><span class="op" id="4997914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997917">defer</span>&nbsp;<span class="ident" id="4997923">cpu</span><span class="op" id="4997926">.</span><span class="ident" id="4997927">Unlock</span><span class="op" id="4997933">(</span><span class="op" id="4997934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997937">if</span>&nbsp;<span class="ident" id="4997940">cpu</span><span class="op" id="4997943">.</span><span class="ident" id="4997944">done</span>&nbsp;<span class="op" id="4997949">==</span>&nbsp;<span class="builtintype" id="4997952">nil</span>&nbsp;<span class="op" id="4997956">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997960">cpu</span><span class="op" id="4997963">.</span><span class="ident" id="4997964">done</span>&nbsp;<span class="op" id="4997969">=</span>&nbsp;<span class="builtinfunc" id="4997971">make</span><span class="op" id="4997975">(</span><span class="keyword" id="4997976">chan</span>&nbsp;<span class="builtintype" id="4997981">bool</span><span class="op" id="4997985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4997988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997991">//&nbsp;Double-check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998009">if</span>&nbsp;<span class="ident" id="4998012">cpu</span><span class="op" id="4998015">.</span><span class="ident" id="4998016">profiling</span>&nbsp;<span class="op" id="4998026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998030">return</span>&nbsp;<span class="ident" id="4998037">fmt</span><span class="op" id="4998040">.</span><span class="ident" id="4998041">Errorf</span><span class="op" id="4998047">(</span><span class="string" id="4998048">&#34;cpu&nbsp;profiling&nbsp;already&nbsp;in&nbsp;use&#34;</span><span class="op" id="4998078">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998084">cpu</span><span class="op" id="4998087">.</span><span class="ident" id="4998088">profiling</span>&nbsp;<span class="op" id="4998098">=</span>&nbsp;<span class="builtintype" id="4998100">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998106">runtime</span><span class="op" id="4998113">.</span><span class="ident" id="4998114">SetCPUProfileRate</span><span class="op" id="4998131">(</span><span class="ident" id="4998132">hz</span><span class="op" id="4998134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998137">go</span>&nbsp;<span class="ident" id="4998140">profileWriter</span><span class="op" id="4998153">(</span><span class="ident" id="4998154">w</span><span class="op" id="4998155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998158">return</span>&nbsp;<span class="builtintype" id="4998165">nil</span><br>
<span class="lineno">590</span><span class="op" id="4998169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998172">func</span>&nbsp;<span class="ident" id="4998177">profileWriter</span><span class="op" id="4998190">(</span><span class="ident" id="4998191">w</span>&nbsp;<span class="ident" id="4998193">io</span><span class="op" id="4998195">.</span><span class="ident" id="4998196">Writer</span><span class="op" id="4998202">)</span>&nbsp;<span class="op" id="4998204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998207">for</span>&nbsp;<span class="op" id="4998211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998215">data</span>&nbsp;<span class="op" id="4998220">:=</span>&nbsp;<span class="ident" id="4998223">runtime</span><span class="op" id="4998230">.</span><span class="ident" id="4998231">CPUProfile</span><span class="op" id="4998241">(</span><span class="op" id="4998242">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998246">if</span>&nbsp;<span class="ident" id="4998249">data</span>&nbsp;<span class="op" id="4998254">==</span>&nbsp;<span class="builtintype" id="4998257">nil</span>&nbsp;<span class="op" id="4998261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998266">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998278">w</span><span class="op" id="4998279">.</span><span class="ident" id="4998280">Write</span><span class="op" id="4998285">(</span><span class="ident" id="4998286">data</span><span class="op" id="4998290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998293">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998296">cpu</span><span class="op" id="4998299">.</span><span class="ident" id="4998300">done</span>&nbsp;<span class="op" id="4998305">&lt;-</span>&nbsp;<span class="builtintype" id="4998308">true</span><br>
<span class="lineno"></span><span class="op" id="4998313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4998316">//&nbsp;StopCPUProfile&nbsp;stops&nbsp;the&nbsp;current&nbsp;CPU&nbsp;profile,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="comment" id="4998373">//&nbsp;StopCPUProfile&nbsp;only&nbsp;returns&nbsp;after&nbsp;all&nbsp;the&nbsp;writes&nbsp;for&nbsp;the</span><br>
<span class="lineno">605</span><span class="comment" id="4998433">//&nbsp;profile&nbsp;have&nbsp;completed.</span><br>
<span class="lineno"></span><span class="keyword" id="4998460">func</span>&nbsp;<span class="ident" id="4998465">StopCPUProfile</span><span class="op" id="4998479">(</span><span class="op" id="4998480">)</span>&nbsp;<span class="op" id="4998482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998485">cpu</span><span class="op" id="4998488">.</span><span class="ident" id="4998489">Lock</span><span class="op" id="4998493">(</span><span class="op" id="4998494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998497">defer</span>&nbsp;<span class="ident" id="4998503">cpu</span><span class="op" id="4998506">.</span><span class="ident" id="4998507">Unlock</span><span class="op" id="4998513">(</span><span class="op" id="4998514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998518">if</span>&nbsp;<span class="op" id="4998521">!</span><span class="ident" id="4998522">cpu</span><span class="op" id="4998525">.</span><span class="ident" id="4998526">profiling</span>&nbsp;<span class="op" id="4998536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998540">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998551">cpu</span><span class="op" id="4998554">.</span><span class="ident" id="4998555">profiling</span>&nbsp;<span class="op" id="4998565">=</span>&nbsp;<span class="builtintype" id="4998567">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998574">runtime</span><span class="op" id="4998581">.</span><span class="ident" id="4998582">SetCPUProfileRate</span><span class="op" id="4998599">(</span><span class="num" id="4998600">0</span><span class="op" id="4998601">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998604">&lt;-</span><span class="ident" id="4998606">cpu</span><span class="op" id="4998609">.</span><span class="ident" id="4998610">done</span><br>
<span class="lineno"></span><span class="op" id="4998615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998618">type</span>&nbsp;<span class="ident" id="4998623">byCycles</span>&nbsp;<span class="op" id="4998632">[</span><span class="op" id="4998633">]</span><span class="ident" id="4998634">runtime</span><span class="op" id="4998641">.</span><span class="ident" id="4998642">BlockProfileRecord</span><br>
<span class="lineno"></span><br>
<span class="lineno">620</span><span class="keyword" id="4998662">func</span>&nbsp;<span class="op" id="4998667">(</span><span class="ident" id="4998668">x</span>&nbsp;<span class="ident" id="4998670">byCycles</span><span class="op" id="4998678">)</span>&nbsp;<span class="ident" id="4998680">Len</span><span class="op" id="4998683">(</span><span class="op" id="4998684">)</span>&nbsp;<span class="builtintype" id="4998686">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998700">{</span>&nbsp;<span class="keyword" id="4998702">return</span>&nbsp;<span class="builtinfunc" id="4998709">len</span><span class="op" id="4998712">(</span><span class="ident" id="4998713">x</span><span class="op" id="4998714">)</span>&nbsp;<span class="op" id="4998716">}</span><br>
<span class="lineno"></span><span class="keyword" id="4998718">func</span>&nbsp;<span class="op" id="4998723">(</span><span class="ident" id="4998724">x</span>&nbsp;<span class="ident" id="4998726">byCycles</span><span class="op" id="4998734">)</span>&nbsp;<span class="ident" id="4998736">Swap</span><span class="op" id="4998740">(</span><span class="ident" id="4998741">i</span><span class="op" id="4998742">,</span>&nbsp;<span class="ident" id="4998744">j</span>&nbsp;<span class="builtintype" id="4998746">int</span><span class="op" id="4998749">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998756">{</span>&nbsp;<span class="ident" id="4998758">x</span><span class="op" id="4998759">[</span><span class="ident" id="4998760">i</span><span class="op" id="4998761">]</span><span class="op" id="4998762">,</span>&nbsp;<span class="ident" id="4998764">x</span><span class="op" id="4998765">[</span><span class="ident" id="4998766">j</span><span class="op" id="4998767">]</span>&nbsp;<span class="op" id="4998769">=</span>&nbsp;<span class="ident" id="4998771">x</span><span class="op" id="4998772">[</span><span class="ident" id="4998773">j</span><span class="op" id="4998774">]</span><span class="op" id="4998775">,</span>&nbsp;<span class="ident" id="4998777">x</span><span class="op" id="4998778">[</span><span class="ident" id="4998779">i</span><span class="op" id="4998780">]</span>&nbsp;<span class="op" id="4998782">}</span><br>
<span class="lineno"></span><span class="keyword" id="4998784">func</span>&nbsp;<span class="op" id="4998789">(</span><span class="ident" id="4998790">x</span>&nbsp;<span class="ident" id="4998792">byCycles</span><span class="op" id="4998800">)</span>&nbsp;<span class="ident" id="4998802">Less</span><span class="op" id="4998806">(</span><span class="ident" id="4998807">i</span><span class="op" id="4998808">,</span>&nbsp;<span class="ident" id="4998810">j</span>&nbsp;<span class="builtintype" id="4998812">int</span><span class="op" id="4998815">)</span>&nbsp;<span class="builtintype" id="4998817">bool</span>&nbsp;<span class="op" id="4998822">{</span>&nbsp;<span class="keyword" id="4998824">return</span>&nbsp;<span class="ident" id="4998831">x</span><span class="op" id="4998832">[</span><span class="ident" id="4998833">i</span><span class="op" id="4998834">]</span><span class="op" id="4998835">.</span><span class="ident" id="4998836">Cycles</span>&nbsp;<span class="op" id="4998843">&gt;</span>&nbsp;<span class="ident" id="4998845">x</span><span class="op" id="4998846">[</span><span class="ident" id="4998847">j</span><span class="op" id="4998848">]</span><span class="op" id="4998849">.</span><span class="ident" id="4998850">Cycles</span>&nbsp;<span class="op" id="4998857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4998860">//&nbsp;countBlock&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;records&nbsp;in&nbsp;the&nbsp;blocking&nbsp;profile.</span><br>
<span class="lineno">625</span><span class="keyword" id="4998929">func</span>&nbsp;<span class="ident" id="4998934">countBlock</span><span class="op" id="4998944">(</span><span class="op" id="4998945">)</span>&nbsp;<span class="builtintype" id="4998947">int</span>&nbsp;<span class="op" id="4998951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998954">n</span><span class="op" id="4998955">,</span>&nbsp;<span class="ident" id="4998957">_</span>&nbsp;<span class="op" id="4998959">:=</span>&nbsp;<span class="ident" id="4998962">runtime</span><span class="op" id="4998969">.</span><span class="ident" id="4998970">BlockProfile</span><span class="op" id="4998982">(</span><span class="builtintype" id="4998983">nil</span><span class="op" id="4998986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998989">return</span>&nbsp;<span class="ident" id="4998996">n</span><br>
<span class="lineno"></span><span class="op" id="4998998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="comment" id="4999001">//&nbsp;writeBlock&nbsp;writes&nbsp;the&nbsp;current&nbsp;blocking&nbsp;profile&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4999057">func</span>&nbsp;<span class="ident" id="4999062">writeBlock</span><span class="op" id="4999072">(</span><span class="ident" id="4999073">w</span>&nbsp;<span class="ident" id="4999075">io</span><span class="op" id="4999077">.</span><span class="ident" id="4999078">Writer</span><span class="op" id="4999084">,</span>&nbsp;<span class="ident" id="4999086">debug</span>&nbsp;<span class="builtintype" id="4999092">int</span><span class="op" id="4999095">)</span>&nbsp;<span class="builtintype" id="4999097">error</span>&nbsp;<span class="op" id="4999103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999106">var</span>&nbsp;<span class="ident" id="4999110">p</span>&nbsp;<span class="op" id="4999112">[</span><span class="op" id="4999113">]</span><span class="ident" id="4999114">runtime</span><span class="op" id="4999121">.</span><span class="ident" id="4999122">BlockProfileRecord</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999142">n</span><span class="op" id="4999143">,</span>&nbsp;<span class="ident" id="4999145">ok</span>&nbsp;<span class="op" id="4999148">:=</span>&nbsp;<span class="ident" id="4999151">runtime</span><span class="op" id="4999158">.</span><span class="ident" id="4999159">BlockProfile</span><span class="op" id="4999171">(</span><span class="builtintype" id="4999172">nil</span><span class="op" id="4999175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999178">for</span>&nbsp;<span class="op" id="4999182">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999186">p</span>&nbsp;<span class="op" id="4999188">=</span>&nbsp;<span class="builtinfunc" id="4999190">make</span><span class="op" id="4999194">(</span><span class="op" id="4999195">[</span><span class="op" id="4999196">]</span><span class="ident" id="4999197">runtime</span><span class="op" id="4999204">.</span><span class="ident" id="4999205">BlockProfileRecord</span><span class="op" id="4999223">,</span>&nbsp;<span class="ident" id="4999225">n</span><span class="op" id="4999226">+</span><span class="num" id="4999227">50</span><span class="op" id="4999229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999233">n</span><span class="op" id="4999234">,</span>&nbsp;<span class="ident" id="4999236">ok</span>&nbsp;<span class="op" id="4999239">=</span>&nbsp;<span class="ident" id="4999241">runtime</span><span class="op" id="4999248">.</span><span class="ident" id="4999249">BlockProfile</span><span class="op" id="4999261">(</span><span class="ident" id="4999262">p</span><span class="op" id="4999263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999267">if</span>&nbsp;<span class="ident" id="4999270">ok</span>&nbsp;<span class="op" id="4999273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999278">p</span>&nbsp;<span class="op" id="4999280">=</span>&nbsp;<span class="ident" id="4999282">p</span><span class="op" id="4999283">[</span><span class="op" id="4999284">:</span><span class="ident" id="4999285">n</span><span class="op" id="4999286">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999291">break</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999306">sort</span><span class="op" id="4999310">.</span><span class="ident" id="4999311">Sort</span><span class="op" id="4999315">(</span><span class="ident" id="4999316">byCycles</span><span class="op" id="4999324">(</span><span class="ident" id="4999325">p</span><span class="op" id="4999326">)</span><span class="op" id="4999327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999331">b</span>&nbsp;<span class="op" id="4999333">:=</span>&nbsp;<span class="ident" id="4999336">bufio</span><span class="op" id="4999341">.</span><span class="ident" id="4999342">NewWriter</span><span class="op" id="4999351">(</span><span class="ident" id="4999352">w</span><span class="op" id="4999353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999356">var</span>&nbsp;<span class="ident" id="4999360">tw</span>&nbsp;<span class="op" id="4999363">*</span><span class="ident" id="4999364">tabwriter</span><span class="op" id="4999373">.</span><span class="ident" id="4999374">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999382">w</span>&nbsp;<span class="op" id="4999384">=</span>&nbsp;<span class="ident" id="4999386">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999389">if</span>&nbsp;<span class="ident" id="4999392">debug</span>&nbsp;<span class="op" id="4999398">&gt;</span>&nbsp;<span class="num" id="4999400">0</span>&nbsp;<span class="op" id="4999402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999406">tw</span>&nbsp;<span class="op" id="4999409">=</span>&nbsp;<span class="ident" id="4999411">tabwriter</span><span class="op" id="4999420">.</span><span class="ident" id="4999421">NewWriter</span><span class="op" id="4999430">(</span><span class="ident" id="4999431">w</span><span class="op" id="4999432">,</span>&nbsp;<span class="num" id="4999434">1</span><span class="op" id="4999435">,</span>&nbsp;<span class="num" id="4999437">8</span><span class="op" id="4999438">,</span>&nbsp;<span class="num" id="4999440">1</span><span class="op" id="4999441">,</span>&nbsp;<span class="string" id="4999443">&#39;\t&#39;</span><span class="op" id="4999447">,</span>&nbsp;<span class="num" id="4999449">0</span><span class="op" id="4999450">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999454">w</span>&nbsp;<span class="op" id="4999456">=</span>&nbsp;<span class="ident" id="4999458">tw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999466">fmt</span><span class="op" id="4999469">.</span><span class="ident" id="4999470">Fprintf</span><span class="op" id="4999477">(</span><span class="ident" id="4999478">w</span><span class="op" id="4999479">,</span>&nbsp;<span class="string" id="4999481">&#34;---&nbsp;contention:\n&#34;</span><span class="op" id="4999500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999503">fmt</span><span class="op" id="4999506">.</span><span class="ident" id="4999507">Fprintf</span><span class="op" id="4999514">(</span><span class="ident" id="4999515">w</span><span class="op" id="4999516">,</span>&nbsp;<span class="string" id="4999518">&#34;cycles/second=%v\n&#34;</span><span class="op" id="4999538">,</span>&nbsp;<span class="ident" id="4999540">runtime_cyclesPerSecond</span><span class="op" id="4999563">(</span><span class="op" id="4999564">)</span><span class="op" id="4999565">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999568">for</span>&nbsp;<span class="ident" id="4999572">i</span>&nbsp;<span class="op" id="4999574">:=</span>&nbsp;<span class="keyword" id="4999577">range</span>&nbsp;<span class="ident" id="4999583">p</span>&nbsp;<span class="op" id="4999585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999589">r</span>&nbsp;<span class="op" id="4999591">:=</span>&nbsp;<span class="op" id="4999594">&amp;</span><span class="ident" id="4999595">p</span><span class="op" id="4999596">[</span><span class="ident" id="4999597">i</span><span class="op" id="4999598">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999602">fmt</span><span class="op" id="4999605">.</span><span class="ident" id="4999606">Fprintf</span><span class="op" id="4999613">(</span><span class="ident" id="4999614">w</span><span class="op" id="4999615">,</span>&nbsp;<span class="string" id="4999617">&#34;%v&nbsp;%v&nbsp;@&#34;</span><span class="op" id="4999626">,</span>&nbsp;<span class="ident" id="4999628">r</span><span class="op" id="4999629">.</span><span class="ident" id="4999630">Cycles</span><span class="op" id="4999636">,</span>&nbsp;<span class="ident" id="4999638">r</span><span class="op" id="4999639">.</span><span class="ident" id="4999640">Count</span><span class="op" id="4999645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999649">for</span>&nbsp;<span class="ident" id="4999653">_</span><span class="op" id="4999654">,</span>&nbsp;<span class="ident" id="4999656">pc</span>&nbsp;<span class="op" id="4999659">:=</span>&nbsp;<span class="keyword" id="4999662">range</span>&nbsp;<span class="ident" id="4999668">r</span><span class="op" id="4999669">.</span><span class="ident" id="4999670">Stack</span><span class="op" id="4999675">(</span><span class="op" id="4999676">)</span>&nbsp;<span class="op" id="4999678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999683">fmt</span><span class="op" id="4999686">.</span><span class="ident" id="4999687">Fprintf</span><span class="op" id="4999694">(</span><span class="ident" id="4999695">w</span><span class="op" id="4999696">,</span>&nbsp;<span class="string" id="4999698">&#34;&nbsp;%#x&#34;</span><span class="op" id="4999704">,</span>&nbsp;<span class="ident" id="4999706">pc</span><span class="op" id="4999708">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999716">fmt</span><span class="op" id="4999719">.</span><span class="ident" id="4999720">Fprint</span><span class="op" id="4999726">(</span><span class="ident" id="4999727">w</span><span class="op" id="4999728">,</span>&nbsp;<span class="string" id="4999730">&#34;\n&#34;</span><span class="op" id="4999734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999738">if</span>&nbsp;<span class="ident" id="4999741">debug</span>&nbsp;<span class="op" id="4999747">&gt;</span>&nbsp;<span class="num" id="4999749">0</span>&nbsp;<span class="op" id="4999751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999756">printStackRecord</span><span class="op" id="4999772">(</span><span class="ident" id="4999773">w</span><span class="op" id="4999774">,</span>&nbsp;<span class="ident" id="4999776">r</span><span class="op" id="4999777">.</span><span class="ident" id="4999778">Stack</span><span class="op" id="4999783">(</span><span class="op" id="4999784">)</span><span class="op" id="4999785">,</span>&nbsp;<span class="builtintype" id="4999787">true</span><span class="op" id="4999791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999795">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999802">if</span>&nbsp;<span class="ident" id="4999805">tw</span>&nbsp;<span class="op" id="4999808">!=</span>&nbsp;<span class="builtintype" id="4999811">nil</span>&nbsp;<span class="op" id="4999815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999819">tw</span><span class="op" id="4999821">.</span><span class="ident" id="4999822">Flush</span><span class="op" id="4999827">(</span><span class="op" id="4999828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999831">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999834">return</span>&nbsp;<span class="ident" id="4999841">b</span><span class="op" id="4999842">.</span><span class="ident" id="4999843">Flush</span><span class="op" id="4999848">(</span><span class="op" id="4999849">)</span><br>
<span class="lineno"></span><span class="op" id="4999851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4999854">func</span>&nbsp;<span class="ident" id="4999859">runtime_cyclesPerSecond</span><span class="op" id="4999882">(</span><span class="op" id="4999883">)</span>&nbsp;<span class="ident" id="4999885">int64</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
