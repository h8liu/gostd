<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8159556">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8159611">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8159665">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8159716">package</span>&nbsp;<span class="ident" id="8159724">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8159729">import</span>&nbsp;<span class="op" id="8159736">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159739">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159748">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159764">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159778">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159793">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159809">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159816">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159822">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159829">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159835">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159846">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159863">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159874">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8159885">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8159892">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8159895">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="8159970">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8159986">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="8160063">type</span>&nbsp;<span class="ident" id="8160068">blockingSource</span>&nbsp;<span class="keyword" id="8160083">chan</span>&nbsp;<span class="builtintype" id="8160088">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8160094">func</span>&nbsp;<span class="op" id="8160099">(</span><span class="ident" id="8160100">b</span>&nbsp;<span class="ident" id="8160102">blockingSource</span><span class="op" id="8160116">)</span>&nbsp;<span class="ident" id="8160118">Read</span><span class="op" id="8160122">(</span><span class="op" id="8160123">[</span><span class="op" id="8160124">]</span><span class="builtintype" id="8160125">byte</span><span class="op" id="8160129">)</span>&nbsp;<span class="op" id="8160131">(</span><span class="ident" id="8160132">n</span>&nbsp;<span class="builtintype" id="8160134">int</span><span class="op" id="8160137">,</span>&nbsp;<span class="ident" id="8160139">err</span>&nbsp;<span class="builtintype" id="8160143">error</span><span class="op" id="8160148">)</span>&nbsp;<span class="op" id="8160150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8160153">&lt;-</span><span class="ident" id="8160155">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8160158">return</span>&nbsp;<span class="num" id="8160165">0</span><span class="op" id="8160166">,</span>&nbsp;<span class="ident" id="8160168">io</span><span class="op" id="8160170">.</span><span class="ident" id="8160171">EOF</span><br>
<span class="lineno"></span><span class="op" id="8160175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="8160178">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8160258">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8160277">type</span>&nbsp;<span class="ident" id="8160282">clientTest</span>&nbsp;<span class="keyword" id="8160293">struct</span>&nbsp;<span class="op" id="8160300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160303">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160376">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160417">name</span>&nbsp;<span class="builtintype" id="8160422">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160430">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160496">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160541">command</span>&nbsp;<span class="op" id="8160549">[</span><span class="op" id="8160550">]</span><span class="builtintype" id="8160551">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160559">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160630">config</span>&nbsp;<span class="op" id="8160637">*</span><span class="ident" id="8160638">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160646">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160713">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160735">cert</span>&nbsp;<span class="op" id="8160740">[</span><span class="op" id="8160741">]</span><span class="builtintype" id="8160742">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160748">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160806">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8160879">key</span>&nbsp;<span class="keyword" id="8160883">interface</span><span class="op" id="8160892">{</span><span class="op" id="8160893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160896">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8160965">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8161035">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161085">validate</span>&nbsp;<span class="keyword" id="8161094">func</span><span class="op" id="8161098">(</span><span class="ident" id="8161099">ConnectionState</span><span class="op" id="8161114">)</span>&nbsp;<span class="builtintype" id="8161116">error</span><br>
<span class="lineno"></span><span class="op" id="8161122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8161125">var</span>&nbsp;<span class="ident" id="8161129">defaultServerCommand</span>&nbsp;<span class="op" id="8161150">=</span>&nbsp;<span class="op" id="8161152">[</span><span class="op" id="8161153">]</span><span class="builtintype" id="8161154">string</span><span class="op" id="8161160">{</span><span class="string" id="8161161">&#34;openssl&#34;</span><span class="op" id="8161170">,</span>&nbsp;<span class="string" id="8161172">&#34;s_server&#34;</span><span class="op" id="8161182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8161185">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8161260">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="8161335">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="8161414">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="8161436">func</span>&nbsp;<span class="op" id="8161441">(</span><span class="ident" id="8161442">test</span>&nbsp;<span class="op" id="8161447">*</span><span class="ident" id="8161448">clientTest</span><span class="op" id="8161458">)</span>&nbsp;<span class="ident" id="8161460">connFromCommand</span><span class="op" id="8161475">(</span><span class="op" id="8161476">)</span>&nbsp;<span class="op" id="8161478">(</span><span class="ident" id="8161479">conn</span>&nbsp;<span class="op" id="8161484">*</span><span class="ident" id="8161485">recordingConn</span><span class="op" id="8161498">,</span>&nbsp;<span class="ident" id="8161500">child</span>&nbsp;<span class="op" id="8161506">*</span><span class="ident" id="8161507">exec</span><span class="op" id="8161511">.</span><span class="ident" id="8161512">Cmd</span><span class="op" id="8161515">,</span>&nbsp;<span class="ident" id="8161517">stdin</span>&nbsp;<span class="ident" id="8161523">blockingSource</span><span class="op" id="8161537">,</span>&nbsp;<span class="ident" id="8161539">err</span>&nbsp;<span class="builtintype" id="8161543">error</span><span class="op" id="8161548">)</span>&nbsp;<span class="op" id="8161550">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161553">cert</span>&nbsp;<span class="op" id="8161558">:=</span>&nbsp;<span class="ident" id="8161561">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161581">if</span>&nbsp;<span class="builtinfunc" id="8161584">len</span><span class="op" id="8161587">(</span><span class="ident" id="8161588">test</span><span class="op" id="8161592">.</span><span class="ident" id="8161593">cert</span><span class="op" id="8161597">)</span>&nbsp;<span class="op" id="8161599">&gt;</span>&nbsp;<span class="num" id="8161601">0</span>&nbsp;<span class="op" id="8161603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161607">cert</span>&nbsp;<span class="op" id="8161612">=</span>&nbsp;<span class="ident" id="8161614">test</span><span class="op" id="8161618">.</span><span class="ident" id="8161619">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8161625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161628">certPath</span>&nbsp;<span class="op" id="8161637">:=</span>&nbsp;<span class="ident" id="8161640">tempFile</span><span class="op" id="8161648">(</span><span class="builtintype" id="8161649">string</span><span class="op" id="8161655">(</span><span class="ident" id="8161656">cert</span><span class="op" id="8161660">)</span><span class="op" id="8161661">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161664">defer</span>&nbsp;<span class="ident" id="8161670">os</span><span class="op" id="8161672">.</span><span class="ident" id="8161673">Remove</span><span class="op" id="8161679">(</span><span class="ident" id="8161680">certPath</span><span class="op" id="8161688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161692">var</span>&nbsp;<span class="ident" id="8161696">key</span>&nbsp;<span class="keyword" id="8161700">interface</span><span class="op" id="8161709">{</span><span class="op" id="8161710">}</span>&nbsp;<span class="op" id="8161712">=</span>&nbsp;<span class="ident" id="8161714">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161733">if</span>&nbsp;<span class="ident" id="8161736">test</span><span class="op" id="8161740">.</span><span class="ident" id="8161741">key</span>&nbsp;<span class="op" id="8161745">!=</span>&nbsp;<span class="ident" id="8161748">nil</span>&nbsp;<span class="op" id="8161752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161756">key</span>&nbsp;<span class="op" id="8161760">=</span>&nbsp;<span class="ident" id="8161762">test</span><span class="op" id="8161766">.</span><span class="ident" id="8161767">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8161772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161775">var</span>&nbsp;<span class="ident" id="8161779">pemType</span>&nbsp;<span class="builtintype" id="8161787">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161795">var</span>&nbsp;<span class="ident" id="8161799">derBytes</span>&nbsp;<span class="op" id="8161808">[</span><span class="op" id="8161809">]</span><span class="builtintype" id="8161810">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161816">switch</span>&nbsp;<span class="ident" id="8161823">key</span>&nbsp;<span class="op" id="8161827">:=</span>&nbsp;<span class="ident" id="8161830">key</span><span class="op" id="8161833">.</span><span class="op" id="8161834">(</span><span class="keyword" id="8161835">type</span><span class="op" id="8161839">)</span>&nbsp;<span class="op" id="8161841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161844">case</span>&nbsp;<span class="op" id="8161849">*</span><span class="ident" id="8161850">rsa</span><span class="op" id="8161853">.</span><span class="ident" id="8161854">PrivateKey</span><span class="op" id="8161864">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161868">pemType</span>&nbsp;<span class="op" id="8161876">=</span>&nbsp;<span class="string" id="8161878">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161886">derBytes</span>&nbsp;<span class="op" id="8161895">=</span>&nbsp;<span class="ident" id="8161897">x509</span><span class="op" id="8161901">.</span><span class="ident" id="8161902">MarshalPKCS1PrivateKey</span><span class="op" id="8161924">(</span><span class="ident" id="8161925">key</span><span class="op" id="8161928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161931">case</span>&nbsp;<span class="op" id="8161936">*</span><span class="ident" id="8161937">ecdsa</span><span class="op" id="8161942">.</span><span class="ident" id="8161943">PrivateKey</span><span class="op" id="8161953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161957">pemType</span>&nbsp;<span class="op" id="8161965">=</span>&nbsp;<span class="string" id="8161967">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8161974">var</span>&nbsp;<span class="ident" id="8161978">err</span>&nbsp;<span class="builtintype" id="8161982">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8161990">derBytes</span><span class="op" id="8161998">,</span>&nbsp;<span class="ident" id="8162000">err</span>&nbsp;<span class="op" id="8162004">=</span>&nbsp;<span class="ident" id="8162006">x509</span><span class="op" id="8162010">.</span><span class="ident" id="8162011">MarshalECPrivateKey</span><span class="op" id="8162030">(</span><span class="ident" id="8162031">key</span><span class="op" id="8162034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162038">if</span>&nbsp;<span class="ident" id="8162041">err</span>&nbsp;<span class="op" id="8162045">!=</span>&nbsp;<span class="ident" id="8162048">nil</span>&nbsp;<span class="op" id="8162052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8162057">panic</span><span class="op" id="8162062">(</span><span class="ident" id="8162063">err</span><span class="op" id="8162066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8162070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162073">default</span><span class="op" id="8162080">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8162084">panic</span><span class="op" id="8162089">(</span><span class="string" id="8162090">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="8162108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8162111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162115">var</span>&nbsp;<span class="ident" id="8162119">pemOut</span>&nbsp;<span class="ident" id="8162126">bytes</span><span class="op" id="8162131">.</span><span class="ident" id="8162132">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162140">pem</span><span class="op" id="8162143">.</span><span class="ident" id="8162144">Encode</span><span class="op" id="8162150">(</span><span class="op" id="8162151">&amp;</span><span class="ident" id="8162152">pemOut</span><span class="op" id="8162158">,</span>&nbsp;<span class="op" id="8162160">&amp;</span><span class="ident" id="8162161">pem</span><span class="op" id="8162164">.</span><span class="ident" id="8162165">Block</span><span class="op" id="8162170">{</span><span class="ident" id="8162171">Type</span><span class="op" id="8162175">:</span>&nbsp;<span class="ident" id="8162177">pemType</span>&nbsp;<span class="op" id="8162185">+</span>&nbsp;<span class="string" id="8162187">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="8162201">,</span>&nbsp;<span class="ident" id="8162203">Bytes</span><span class="op" id="8162208">:</span>&nbsp;<span class="ident" id="8162210">derBytes</span><span class="op" id="8162218">}</span><span class="op" id="8162219">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162223">keyPath</span>&nbsp;<span class="op" id="8162231">:=</span>&nbsp;<span class="ident" id="8162234">tempFile</span><span class="op" id="8162242">(</span><span class="builtintype" id="8162243">string</span><span class="op" id="8162249">(</span><span class="ident" id="8162250">pemOut</span><span class="op" id="8162256">.</span><span class="ident" id="8162257">Bytes</span><span class="op" id="8162262">(</span><span class="op" id="8162263">)</span><span class="op" id="8162264">)</span><span class="op" id="8162265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162268">defer</span>&nbsp;<span class="ident" id="8162274">os</span><span class="op" id="8162276">.</span><span class="ident" id="8162277">Remove</span><span class="op" id="8162283">(</span><span class="ident" id="8162284">keyPath</span><span class="op" id="8162291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162295">var</span>&nbsp;<span class="ident" id="8162299">command</span>&nbsp;<span class="op" id="8162307">[</span><span class="op" id="8162308">]</span><span class="builtintype" id="8162309">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162317">if</span>&nbsp;<span class="builtinfunc" id="8162320">len</span><span class="op" id="8162323">(</span><span class="ident" id="8162324">test</span><span class="op" id="8162328">.</span><span class="ident" id="8162329">command</span><span class="op" id="8162336">)</span>&nbsp;<span class="op" id="8162338">&gt;</span>&nbsp;<span class="num" id="8162340">0</span>&nbsp;<span class="op" id="8162342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162346">command</span>&nbsp;<span class="op" id="8162354">=</span>&nbsp;<span class="builtinfunc" id="8162356">append</span><span class="op" id="8162362">(</span><span class="ident" id="8162363">command</span><span class="op" id="8162370">,</span>&nbsp;<span class="ident" id="8162372">test</span><span class="op" id="8162376">.</span><span class="ident" id="8162377">command</span><span class="op" id="8162384">...</span><span class="op" id="8162387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8162390">}</span>&nbsp;<span class="keyword" id="8162392">else</span>&nbsp;<span class="op" id="8162397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162401">command</span>&nbsp;<span class="op" id="8162409">=</span>&nbsp;<span class="builtinfunc" id="8162411">append</span><span class="op" id="8162417">(</span><span class="ident" id="8162418">command</span><span class="op" id="8162425">,</span>&nbsp;<span class="ident" id="8162427">defaultServerCommand</span><span class="op" id="8162447">...</span><span class="op" id="8162450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8162453">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162456">command</span>&nbsp;<span class="op" id="8162464">=</span>&nbsp;<span class="builtinfunc" id="8162466">append</span><span class="op" id="8162472">(</span><span class="ident" id="8162473">command</span><span class="op" id="8162480">,</span>&nbsp;<span class="string" id="8162482">&#34;-cert&#34;</span><span class="op" id="8162489">,</span>&nbsp;<span class="ident" id="8162491">certPath</span><span class="op" id="8162499">,</span>&nbsp;<span class="string" id="8162501">&#34;-certform&#34;</span><span class="op" id="8162512">,</span>&nbsp;<span class="string" id="8162514">&#34;DER&#34;</span><span class="op" id="8162519">,</span>&nbsp;<span class="string" id="8162521">&#34;-key&#34;</span><span class="op" id="8162527">,</span>&nbsp;<span class="ident" id="8162529">keyPath</span><span class="op" id="8162536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8162539">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8162609">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8162680">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8162749">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8162818">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8162848">const</span>&nbsp;<span class="ident" id="8162854">serverPort</span>&nbsp;<span class="op" id="8162865">=</span>&nbsp;<span class="num" id="8162867">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162874">command</span>&nbsp;<span class="op" id="8162882">=</span>&nbsp;<span class="builtinfunc" id="8162884">append</span><span class="op" id="8162890">(</span><span class="ident" id="8162891">command</span><span class="op" id="8162898">,</span>&nbsp;<span class="string" id="8162900">&#34;-accept&#34;</span><span class="op" id="8162909">,</span>&nbsp;<span class="ident" id="8162911">strconv</span><span class="op" id="8162918">.</span><span class="ident" id="8162919">Itoa</span><span class="op" id="8162923">(</span><span class="ident" id="8162924">serverPort</span><span class="op" id="8162934">)</span><span class="op" id="8162935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162939">cmd</span>&nbsp;<span class="op" id="8162943">:=</span>&nbsp;<span class="ident" id="8162946">exec</span><span class="op" id="8162950">.</span><span class="ident" id="8162951">Command</span><span class="op" id="8162958">(</span><span class="ident" id="8162959">command</span><span class="op" id="8162966">[</span><span class="num" id="8162967">0</span><span class="op" id="8162968">]</span><span class="op" id="8162969">,</span>&nbsp;<span class="ident" id="8162971">command</span><span class="op" id="8162978">[</span><span class="num" id="8162979">1</span><span class="op" id="8162980">:</span><span class="op" id="8162981">]</span><span class="op" id="8162982">...</span><span class="op" id="8162985">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8162988">stdin</span>&nbsp;<span class="op" id="8162994">=</span>&nbsp;<span class="ident" id="8162996">blockingSource</span><span class="op" id="8163010">(</span><span class="builtinfunc" id="8163011">make</span><span class="op" id="8163015">(</span><span class="keyword" id="8163016">chan</span>&nbsp;<span class="builtintype" id="8163021">bool</span><span class="op" id="8163025">)</span><span class="op" id="8163026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163029">cmd</span><span class="op" id="8163032">.</span><span class="ident" id="8163033">Stdin</span>&nbsp;<span class="op" id="8163039">=</span>&nbsp;<span class="ident" id="8163041">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163048">var</span>&nbsp;<span class="ident" id="8163052">out</span>&nbsp;<span class="ident" id="8163056">bytes</span><span class="op" id="8163061">.</span><span class="ident" id="8163062">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163070">cmd</span><span class="op" id="8163073">.</span><span class="ident" id="8163074">Stdout</span>&nbsp;<span class="op" id="8163081">=</span>&nbsp;<span class="op" id="8163083">&amp;</span><span class="ident" id="8163084">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163089">cmd</span><span class="op" id="8163092">.</span><span class="ident" id="8163093">Stderr</span>&nbsp;<span class="op" id="8163100">=</span>&nbsp;<span class="op" id="8163102">&amp;</span><span class="ident" id="8163103">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163108">if</span>&nbsp;<span class="ident" id="8163111">err</span>&nbsp;<span class="op" id="8163115">:=</span>&nbsp;<span class="ident" id="8163118">cmd</span><span class="op" id="8163121">.</span><span class="ident" id="8163122">Start</span><span class="op" id="8163127">(</span><span class="op" id="8163128">)</span><span class="op" id="8163129">;</span>&nbsp;<span class="ident" id="8163131">err</span>&nbsp;<span class="op" id="8163135">!=</span>&nbsp;<span class="ident" id="8163138">nil</span>&nbsp;<span class="op" id="8163142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163146">return</span>&nbsp;<span class="ident" id="8163153">nil</span><span class="op" id="8163156">,</span>&nbsp;<span class="ident" id="8163158">nil</span><span class="op" id="8163161">,</span>&nbsp;<span class="ident" id="8163163">nil</span><span class="op" id="8163166">,</span>&nbsp;<span class="ident" id="8163168">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8163177">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8163244">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8163316">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8163385">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163401">var</span>&nbsp;<span class="ident" id="8163405">tcpConn</span>&nbsp;<span class="ident" id="8163413">net</span><span class="op" id="8163416">.</span><span class="ident" id="8163417">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163423">for</span>&nbsp;<span class="ident" id="8163427">i</span>&nbsp;<span class="op" id="8163429">:=</span>&nbsp;<span class="builtintype" id="8163432">uint</span><span class="op" id="8163436">(</span><span class="num" id="8163437">0</span><span class="op" id="8163438">)</span><span class="op" id="8163439">;</span>&nbsp;<span class="ident" id="8163441">i</span>&nbsp;<span class="op" id="8163443">&lt;</span>&nbsp;<span class="num" id="8163445">5</span><span class="op" id="8163446">;</span>&nbsp;<span class="ident" id="8163448">i</span><span class="op" id="8163449">++</span>&nbsp;<span class="op" id="8163452">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163456">var</span>&nbsp;<span class="ident" id="8163460">err</span>&nbsp;<span class="builtintype" id="8163464">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163472">tcpConn</span><span class="op" id="8163479">,</span>&nbsp;<span class="ident" id="8163481">err</span>&nbsp;<span class="op" id="8163485">=</span>&nbsp;<span class="ident" id="8163487">net</span><span class="op" id="8163490">.</span><span class="ident" id="8163491">DialTCP</span><span class="op" id="8163498">(</span><span class="string" id="8163499">&#34;tcp&#34;</span><span class="op" id="8163504">,</span>&nbsp;<span class="ident" id="8163506">nil</span><span class="op" id="8163509">,</span>&nbsp;<span class="op" id="8163511">&amp;</span><span class="ident" id="8163512">net</span><span class="op" id="8163515">.</span><span class="ident" id="8163516">TCPAddr</span><span class="op" id="8163523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163528">IP</span><span class="op" id="8163530">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8163534">net</span><span class="op" id="8163537">.</span><span class="ident" id="8163538">IPv4</span><span class="op" id="8163542">(</span><span class="num" id="8163543">127</span><span class="op" id="8163546">,</span>&nbsp;<span class="num" id="8163548">0</span><span class="op" id="8163549">,</span>&nbsp;<span class="num" id="8163551">0</span><span class="op" id="8163552">,</span>&nbsp;<span class="num" id="8163554">1</span><span class="op" id="8163555">)</span><span class="op" id="8163556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163561">Port</span><span class="op" id="8163565">:</span>&nbsp;<span class="ident" id="8163567">serverPort</span><span class="op" id="8163577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163581">}</span><span class="op" id="8163582">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163586">if</span>&nbsp;<span class="ident" id="8163589">err</span>&nbsp;<span class="op" id="8163593">==</span>&nbsp;<span class="ident" id="8163596">nil</span>&nbsp;<span class="op" id="8163600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163605">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163617">time</span><span class="op" id="8163621">.</span><span class="ident" id="8163622">Sleep</span><span class="op" id="8163627">(</span><span class="op" id="8163628">(</span><span class="num" id="8163629">1</span>&nbsp;<span class="op" id="8163631">&lt;&lt;</span>&nbsp;<span class="ident" id="8163634">i</span><span class="op" id="8163635">)</span>&nbsp;<span class="op" id="8163637">*</span>&nbsp;<span class="num" id="8163639">5</span>&nbsp;<span class="op" id="8163641">*</span>&nbsp;<span class="ident" id="8163643">time</span><span class="op" id="8163647">.</span><span class="ident" id="8163648">Millisecond</span><span class="op" id="8163659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163662">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163665">if</span>&nbsp;<span class="ident" id="8163668">tcpConn</span>&nbsp;<span class="op" id="8163676">==</span>&nbsp;<span class="ident" id="8163679">nil</span>&nbsp;<span class="op" id="8163683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8163687">close</span><span class="op" id="8163692">(</span><span class="ident" id="8163693">stdin</span><span class="op" id="8163698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163702">out</span><span class="op" id="8163705">.</span><span class="ident" id="8163706">WriteTo</span><span class="op" id="8163713">(</span><span class="ident" id="8163714">os</span><span class="op" id="8163716">.</span><span class="ident" id="8163717">Stdout</span><span class="op" id="8163723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163727">cmd</span><span class="op" id="8163730">.</span><span class="ident" id="8163731">Process</span><span class="op" id="8163738">.</span><span class="ident" id="8163739">Kill</span><span class="op" id="8163743">(</span><span class="op" id="8163744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163748">return</span>&nbsp;<span class="ident" id="8163755">nil</span><span class="op" id="8163758">,</span>&nbsp;<span class="ident" id="8163760">nil</span><span class="op" id="8163763">,</span>&nbsp;<span class="ident" id="8163765">nil</span><span class="op" id="8163768">,</span>&nbsp;<span class="ident" id="8163770">cmd</span><span class="op" id="8163773">.</span><span class="ident" id="8163774">Wait</span><span class="op" id="8163778">(</span><span class="op" id="8163779">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163786">record</span>&nbsp;<span class="op" id="8163793">:=</span>&nbsp;<span class="op" id="8163796">&amp;</span><span class="ident" id="8163797">recordingConn</span><span class="op" id="8163810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8163814">Conn</span><span class="op" id="8163818">:</span>&nbsp;<span class="ident" id="8163820">tcpConn</span><span class="op" id="8163827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8163830">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163834">return</span>&nbsp;<span class="ident" id="8163841">record</span><span class="op" id="8163847">,</span>&nbsp;<span class="ident" id="8163849">cmd</span><span class="op" id="8163852">,</span>&nbsp;<span class="ident" id="8163854">stdin</span><span class="op" id="8163859">,</span>&nbsp;<span class="ident" id="8163861">nil</span><br>
<span class="lineno"></span><span class="op" id="8163865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163868">func</span>&nbsp;<span class="op" id="8163873">(</span><span class="ident" id="8163874">test</span>&nbsp;<span class="op" id="8163879">*</span><span class="ident" id="8163880">clientTest</span><span class="op" id="8163890">)</span>&nbsp;<span class="ident" id="8163892">dataPath</span><span class="op" id="8163900">(</span><span class="op" id="8163901">)</span>&nbsp;<span class="builtintype" id="8163903">string</span>&nbsp;<span class="op" id="8163910">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8163913">return</span>&nbsp;<span class="ident" id="8163920">filepath</span><span class="op" id="8163928">.</span><span class="ident" id="8163929">Join</span><span class="op" id="8163933">(</span><span class="string" id="8163934">&#34;testdata&#34;</span><span class="op" id="8163944">,</span>&nbsp;<span class="string" id="8163946">&#34;Client-&#34;</span><span class="op" id="8163955">+</span><span class="ident" id="8163956">test</span><span class="op" id="8163960">.</span><span class="ident" id="8163961">name</span><span class="op" id="8163965">)</span><br>
<span class="lineno"></span><span class="op" id="8163967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8163970">func</span>&nbsp;<span class="op" id="8163975">(</span><span class="ident" id="8163976">test</span>&nbsp;<span class="op" id="8163981">*</span><span class="ident" id="8163982">clientTest</span><span class="op" id="8163992">)</span>&nbsp;<span class="ident" id="8163994">loadData</span><span class="op" id="8164002">(</span><span class="op" id="8164003">)</span>&nbsp;<span class="op" id="8164005">(</span><span class="ident" id="8164006">flows</span>&nbsp;<span class="op" id="8164012">[</span><span class="op" id="8164013">]</span><span class="op" id="8164014">[</span><span class="op" id="8164015">]</span><span class="builtintype" id="8164016">byte</span><span class="op" id="8164020">,</span>&nbsp;<span class="ident" id="8164022">err</span>&nbsp;<span class="builtintype" id="8164026">error</span><span class="op" id="8164031">)</span>&nbsp;<span class="op" id="8164033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164036">in</span><span class="op" id="8164038">,</span>&nbsp;<span class="ident" id="8164040">err</span>&nbsp;<span class="op" id="8164044">:=</span>&nbsp;<span class="ident" id="8164047">os</span><span class="op" id="8164049">.</span><span class="ident" id="8164050">Open</span><span class="op" id="8164054">(</span><span class="ident" id="8164055">test</span><span class="op" id="8164059">.</span><span class="ident" id="8164060">dataPath</span><span class="op" id="8164068">(</span><span class="op" id="8164069">)</span><span class="op" id="8164070">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164073">if</span>&nbsp;<span class="ident" id="8164076">err</span>&nbsp;<span class="op" id="8164080">!=</span>&nbsp;<span class="ident" id="8164083">nil</span>&nbsp;<span class="op" id="8164087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164091">return</span>&nbsp;<span class="ident" id="8164098">nil</span><span class="op" id="8164101">,</span>&nbsp;<span class="ident" id="8164103">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164111">defer</span>&nbsp;<span class="ident" id="8164117">in</span><span class="op" id="8164119">.</span><span class="ident" id="8164120">Close</span><span class="op" id="8164125">(</span><span class="op" id="8164126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164129">return</span>&nbsp;<span class="ident" id="8164136">parseTestData</span><span class="op" id="8164149">(</span><span class="ident" id="8164150">in</span><span class="op" id="8164152">)</span><br>
<span class="lineno">165</span><span class="op" id="8164154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8164157">func</span>&nbsp;<span class="op" id="8164162">(</span><span class="ident" id="8164163">test</span>&nbsp;<span class="op" id="8164168">*</span><span class="ident" id="8164169">clientTest</span><span class="op" id="8164179">)</span>&nbsp;<span class="ident" id="8164181">run</span><span class="op" id="8164184">(</span><span class="ident" id="8164185">t</span>&nbsp;<span class="op" id="8164187">*</span><span class="ident" id="8164188">testing</span><span class="op" id="8164195">.</span><span class="ident" id="8164196">T</span><span class="op" id="8164197">,</span>&nbsp;<span class="ident" id="8164199">write</span>&nbsp;<span class="builtintype" id="8164205">bool</span><span class="op" id="8164209">)</span>&nbsp;<span class="op" id="8164211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164214">var</span>&nbsp;<span class="ident" id="8164218">clientConn</span><span class="op" id="8164228">,</span>&nbsp;<span class="ident" id="8164230">serverConn</span>&nbsp;<span class="ident" id="8164241">net</span><span class="op" id="8164244">.</span><span class="ident" id="8164245">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164251">var</span>&nbsp;<span class="ident" id="8164255">recordingConn</span>&nbsp;<span class="op" id="8164269">*</span><span class="ident" id="8164270">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164285">var</span>&nbsp;<span class="ident" id="8164289">childProcess</span>&nbsp;<span class="op" id="8164302">*</span><span class="ident" id="8164303">exec</span><span class="op" id="8164307">.</span><span class="ident" id="8164308">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164313">var</span>&nbsp;<span class="ident" id="8164317">stdin</span>&nbsp;<span class="ident" id="8164323">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164340">if</span>&nbsp;<span class="ident" id="8164343">write</span>&nbsp;<span class="op" id="8164349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164353">var</span>&nbsp;<span class="ident" id="8164357">err</span>&nbsp;<span class="builtintype" id="8164361">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164369">recordingConn</span><span class="op" id="8164382">,</span>&nbsp;<span class="ident" id="8164384">childProcess</span><span class="op" id="8164396">,</span>&nbsp;<span class="ident" id="8164398">stdin</span><span class="op" id="8164403">,</span>&nbsp;<span class="ident" id="8164405">err</span>&nbsp;<span class="op" id="8164409">=</span>&nbsp;<span class="ident" id="8164411">test</span><span class="op" id="8164415">.</span><span class="ident" id="8164416">connFromCommand</span><span class="op" id="8164431">(</span><span class="op" id="8164432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164436">if</span>&nbsp;<span class="ident" id="8164439">err</span>&nbsp;<span class="op" id="8164443">!=</span>&nbsp;<span class="ident" id="8164446">nil</span>&nbsp;<span class="op" id="8164450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164455">t</span><span class="op" id="8164456">.</span><span class="ident" id="8164457">Fatalf</span><span class="op" id="8164463">(</span><span class="string" id="8164464">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8164496">,</span>&nbsp;<span class="ident" id="8164498">err</span><span class="op" id="8164501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164509">clientConn</span>&nbsp;<span class="op" id="8164520">=</span>&nbsp;<span class="ident" id="8164522">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164537">}</span>&nbsp;<span class="keyword" id="8164539">else</span>&nbsp;<span class="op" id="8164544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164548">clientConn</span><span class="op" id="8164558">,</span>&nbsp;<span class="ident" id="8164560">serverConn</span>&nbsp;<span class="op" id="8164571">=</span>&nbsp;<span class="ident" id="8164573">net</span><span class="op" id="8164576">.</span><span class="ident" id="8164577">Pipe</span><span class="op" id="8164581">(</span><span class="op" id="8164582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164589">config</span>&nbsp;<span class="op" id="8164596">:=</span>&nbsp;<span class="ident" id="8164599">test</span><span class="op" id="8164603">.</span><span class="ident" id="8164604">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164612">if</span>&nbsp;<span class="ident" id="8164615">config</span>&nbsp;<span class="op" id="8164622">==</span>&nbsp;<span class="ident" id="8164625">nil</span>&nbsp;<span class="op" id="8164629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164633">config</span>&nbsp;<span class="op" id="8164640">=</span>&nbsp;<span class="ident" id="8164642">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164657">client</span>&nbsp;<span class="op" id="8164664">:=</span>&nbsp;<span class="ident" id="8164667">Client</span><span class="op" id="8164673">(</span><span class="ident" id="8164674">clientConn</span><span class="op" id="8164684">,</span>&nbsp;<span class="ident" id="8164686">config</span><span class="op" id="8164692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164696">doneChan</span>&nbsp;<span class="op" id="8164705">:=</span>&nbsp;<span class="builtinfunc" id="8164708">make</span><span class="op" id="8164712">(</span><span class="keyword" id="8164713">chan</span>&nbsp;<span class="builtintype" id="8164718">bool</span><span class="op" id="8164722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164725">go</span>&nbsp;<span class="keyword" id="8164728">func</span><span class="op" id="8164732">(</span><span class="op" id="8164733">)</span>&nbsp;<span class="op" id="8164735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164739">if</span>&nbsp;<span class="ident" id="8164742">_</span><span class="op" id="8164743">,</span>&nbsp;<span class="ident" id="8164745">err</span>&nbsp;<span class="op" id="8164749">:=</span>&nbsp;<span class="ident" id="8164752">client</span><span class="op" id="8164758">.</span><span class="ident" id="8164759">Write</span><span class="op" id="8164764">(</span><span class="op" id="8164765">[</span><span class="op" id="8164766">]</span><span class="builtintype" id="8164767">byte</span><span class="op" id="8164771">(</span><span class="string" id="8164772">&#34;hello\n&#34;</span><span class="op" id="8164781">)</span><span class="op" id="8164782">)</span><span class="op" id="8164783">;</span>&nbsp;<span class="ident" id="8164785">err</span>&nbsp;<span class="op" id="8164789">!=</span>&nbsp;<span class="ident" id="8164792">nil</span>&nbsp;<span class="op" id="8164796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164801">t</span><span class="op" id="8164802">.</span><span class="ident" id="8164803">Logf</span><span class="op" id="8164807">(</span><span class="string" id="8164808">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8164833">,</span>&nbsp;<span class="ident" id="8164835">err</span><span class="op" id="8164838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164842">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164846">if</span>&nbsp;<span class="ident" id="8164849">test</span><span class="op" id="8164853">.</span><span class="ident" id="8164854">validate</span>&nbsp;<span class="op" id="8164863">!=</span>&nbsp;<span class="ident" id="8164866">nil</span>&nbsp;<span class="op" id="8164870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8164875">if</span>&nbsp;<span class="ident" id="8164878">err</span>&nbsp;<span class="op" id="8164882">:=</span>&nbsp;<span class="ident" id="8164885">test</span><span class="op" id="8164889">.</span><span class="ident" id="8164890">validate</span><span class="op" id="8164898">(</span><span class="ident" id="8164899">client</span><span class="op" id="8164905">.</span><span class="ident" id="8164906">ConnectionState</span><span class="op" id="8164921">(</span><span class="op" id="8164922">)</span><span class="op" id="8164923">)</span><span class="op" id="8164924">;</span>&nbsp;<span class="ident" id="8164926">err</span>&nbsp;<span class="op" id="8164930">!=</span>&nbsp;<span class="ident" id="8164933">nil</span>&nbsp;<span class="op" id="8164937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8164943">t</span><span class="op" id="8164944">.</span><span class="ident" id="8164945">Logf</span><span class="op" id="8164949">(</span><span class="string" id="8164950">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8164988">,</span>&nbsp;<span class="ident" id="8164990">err</span><span class="op" id="8164993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8164998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165002">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165006">client</span><span class="op" id="8165012">.</span><span class="ident" id="8165013">Close</span><span class="op" id="8165018">(</span><span class="op" id="8165019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165023">clientConn</span><span class="op" id="8165033">.</span><span class="ident" id="8165034">Close</span><span class="op" id="8165039">(</span><span class="op" id="8165040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165044">doneChan</span>&nbsp;<span class="op" id="8165053">&lt;-</span>&nbsp;<span class="builtintype" id="8165056">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165062">}</span><span class="op" id="8165063">(</span><span class="op" id="8165064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165068">if</span>&nbsp;<span class="op" id="8165071">!</span><span class="ident" id="8165072">write</span>&nbsp;<span class="op" id="8165078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165082">flows</span><span class="op" id="8165087">,</span>&nbsp;<span class="ident" id="8165089">err</span>&nbsp;<span class="op" id="8165093">:=</span>&nbsp;<span class="ident" id="8165096">test</span><span class="op" id="8165100">.</span><span class="ident" id="8165101">loadData</span><span class="op" id="8165109">(</span><span class="op" id="8165110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165114">if</span>&nbsp;<span class="ident" id="8165117">err</span>&nbsp;<span class="op" id="8165121">!=</span>&nbsp;<span class="ident" id="8165124">nil</span>&nbsp;<span class="op" id="8165128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165133">t</span><span class="op" id="8165134">.</span><span class="ident" id="8165135">Fatalf</span><span class="op" id="8165141">(</span><span class="string" id="8165142">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="8165179">,</span>&nbsp;<span class="ident" id="8165181">test</span><span class="op" id="8165185">.</span><span class="ident" id="8165186">name</span><span class="op" id="8165190">,</span>&nbsp;<span class="ident" id="8165192">test</span><span class="op" id="8165196">.</span><span class="ident" id="8165197">dataPath</span><span class="op" id="8165205">(</span><span class="op" id="8165206">)</span><span class="op" id="8165207">,</span>&nbsp;<span class="ident" id="8165209">err</span><span class="op" id="8165212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165216">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165220">for</span>&nbsp;<span class="ident" id="8165224">i</span><span class="op" id="8165225">,</span>&nbsp;<span class="ident" id="8165227">b</span>&nbsp;<span class="op" id="8165229">:=</span>&nbsp;<span class="keyword" id="8165232">range</span>&nbsp;<span class="ident" id="8165238">flows</span>&nbsp;<span class="op" id="8165244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165249">if</span>&nbsp;<span class="ident" id="8165252">i</span><span class="op" id="8165253">%</span><span class="num" id="8165254">2</span>&nbsp;<span class="op" id="8165256">==</span>&nbsp;<span class="num" id="8165259">1</span>&nbsp;<span class="op" id="8165261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165267">serverConn</span><span class="op" id="8165277">.</span><span class="ident" id="8165278">Write</span><span class="op" id="8165283">(</span><span class="ident" id="8165284">b</span><span class="op" id="8165285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165291">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165303">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165308">bb</span>&nbsp;<span class="op" id="8165311">:=</span>&nbsp;<span class="builtinfunc" id="8165314">make</span><span class="op" id="8165318">(</span><span class="op" id="8165319">[</span><span class="op" id="8165320">]</span><span class="builtintype" id="8165321">byte</span><span class="op" id="8165325">,</span>&nbsp;<span class="builtinfunc" id="8165327">len</span><span class="op" id="8165330">(</span><span class="ident" id="8165331">b</span><span class="op" id="8165332">)</span><span class="op" id="8165333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165338">_</span><span class="op" id="8165339">,</span>&nbsp;<span class="ident" id="8165341">err</span>&nbsp;<span class="op" id="8165345">:=</span>&nbsp;<span class="ident" id="8165348">io</span><span class="op" id="8165350">.</span><span class="ident" id="8165351">ReadFull</span><span class="op" id="8165359">(</span><span class="ident" id="8165360">serverConn</span><span class="op" id="8165370">,</span>&nbsp;<span class="ident" id="8165372">bb</span><span class="op" id="8165374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165379">if</span>&nbsp;<span class="ident" id="8165382">err</span>&nbsp;<span class="op" id="8165386">!=</span>&nbsp;<span class="ident" id="8165389">nil</span>&nbsp;<span class="op" id="8165393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165399">t</span><span class="op" id="8165400">.</span><span class="ident" id="8165401">Fatalf</span><span class="op" id="8165407">(</span><span class="string" id="8165408">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="8165420">,</span>&nbsp;<span class="ident" id="8165422">test</span><span class="op" id="8165426">.</span><span class="ident" id="8165427">name</span><span class="op" id="8165431">,</span>&nbsp;<span class="ident" id="8165433">i</span><span class="op" id="8165434">,</span>&nbsp;<span class="ident" id="8165436">err</span><span class="op" id="8165439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165444">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165449">if</span>&nbsp;<span class="op" id="8165452">!</span><span class="ident" id="8165453">bytes</span><span class="op" id="8165458">.</span><span class="ident" id="8165459">Equal</span><span class="op" id="8165464">(</span><span class="ident" id="8165465">b</span><span class="op" id="8165466">,</span>&nbsp;<span class="ident" id="8165468">bb</span><span class="op" id="8165470">)</span>&nbsp;<span class="op" id="8165472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165478">t</span><span class="op" id="8165479">.</span><span class="ident" id="8165480">Fatalf</span><span class="op" id="8165486">(</span><span class="string" id="8165487">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8165529">,</span>&nbsp;<span class="ident" id="8165531">test</span><span class="op" id="8165535">.</span><span class="ident" id="8165536">name</span><span class="op" id="8165540">,</span>&nbsp;<span class="ident" id="8165542">i</span><span class="op" id="8165543">,</span>&nbsp;<span class="ident" id="8165545">bb</span><span class="op" id="8165547">,</span>&nbsp;<span class="ident" id="8165549">b</span><span class="op" id="8165550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165563">serverConn</span><span class="op" id="8165573">.</span><span class="ident" id="8165574">Close</span><span class="op" id="8165579">(</span><span class="op" id="8165580">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165587">&lt;-</span><span class="ident" id="8165589">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165600">if</span>&nbsp;<span class="ident" id="8165603">write</span>&nbsp;<span class="op" id="8165609">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165613">path</span>&nbsp;<span class="op" id="8165618">:=</span>&nbsp;<span class="ident" id="8165621">test</span><span class="op" id="8165625">.</span><span class="ident" id="8165626">dataPath</span><span class="op" id="8165634">(</span><span class="op" id="8165635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165639">out</span><span class="op" id="8165642">,</span>&nbsp;<span class="ident" id="8165644">err</span>&nbsp;<span class="op" id="8165648">:=</span>&nbsp;<span class="ident" id="8165651">os</span><span class="op" id="8165653">.</span><span class="ident" id="8165654">OpenFile</span><span class="op" id="8165662">(</span><span class="ident" id="8165663">path</span><span class="op" id="8165667">,</span>&nbsp;<span class="ident" id="8165669">os</span><span class="op" id="8165671">.</span><span class="ident" id="8165672">O_WRONLY</span><span class="op" id="8165680">|</span><span class="ident" id="8165681">os</span><span class="op" id="8165683">.</span><span class="ident" id="8165684">O_CREATE</span><span class="op" id="8165692">|</span><span class="ident" id="8165693">os</span><span class="op" id="8165695">.</span><span class="ident" id="8165696">O_TRUNC</span><span class="op" id="8165703">,</span>&nbsp;<span class="num" id="8165705">0644</span><span class="op" id="8165709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165713">if</span>&nbsp;<span class="ident" id="8165716">err</span>&nbsp;<span class="op" id="8165720">!=</span>&nbsp;<span class="ident" id="8165723">nil</span>&nbsp;<span class="op" id="8165727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165732">t</span><span class="op" id="8165733">.</span><span class="ident" id="8165734">Fatalf</span><span class="op" id="8165740">(</span><span class="string" id="8165741">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8165775">,</span>&nbsp;<span class="ident" id="8165777">err</span><span class="op" id="8165780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8165784">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165788">defer</span>&nbsp;<span class="ident" id="8165794">out</span><span class="op" id="8165797">.</span><span class="ident" id="8165798">Close</span><span class="op" id="8165803">(</span><span class="op" id="8165804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165808">recordingConn</span><span class="op" id="8165821">.</span><span class="ident" id="8165822">Close</span><span class="op" id="8165827">(</span><span class="op" id="8165828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8165832">close</span><span class="op" id="8165837">(</span><span class="ident" id="8165838">stdin</span><span class="op" id="8165843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165847">childProcess</span><span class="op" id="8165859">.</span><span class="ident" id="8165860">Process</span><span class="op" id="8165867">.</span><span class="ident" id="8165868">Kill</span><span class="op" id="8165872">(</span><span class="op" id="8165873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165877">childProcess</span><span class="op" id="8165889">.</span><span class="ident" id="8165890">Wait</span><span class="op" id="8165894">(</span><span class="op" id="8165895">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8165899">if</span>&nbsp;<span class="builtinfunc" id="8165902">len</span><span class="op" id="8165905">(</span><span class="ident" id="8165906">recordingConn</span><span class="op" id="8165919">.</span><span class="ident" id="8165920">flows</span><span class="op" id="8165925">)</span>&nbsp;<span class="op" id="8165927">&lt;</span>&nbsp;<span class="num" id="8165929">3</span>&nbsp;<span class="op" id="8165931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165936">childProcess</span><span class="op" id="8165948">.</span><span class="ident" id="8165949">Stdout</span><span class="op" id="8165955">.</span><span class="op" id="8165956">(</span><span class="op" id="8165957">*</span><span class="ident" id="8165958">bytes</span><span class="op" id="8165963">.</span><span class="ident" id="8165964">Buffer</span><span class="op" id="8165970">)</span><span class="op" id="8165971">.</span><span class="ident" id="8165972">WriteTo</span><span class="op" id="8165979">(</span><span class="ident" id="8165980">os</span><span class="op" id="8165982">.</span><span class="ident" id="8165983">Stdout</span><span class="op" id="8165989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8165994">t</span><span class="op" id="8165995">.</span><span class="ident" id="8165996">Fatalf</span><span class="op" id="8166002">(</span><span class="string" id="8166003">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="8166034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166042">recordingConn</span><span class="op" id="8166055">.</span><span class="ident" id="8166056">WriteTo</span><span class="op" id="8166063">(</span><span class="ident" id="8166064">out</span><span class="op" id="8166067">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166071">fmt</span><span class="op" id="8166074">.</span><span class="ident" id="8166075">Printf</span><span class="op" id="8166081">(</span><span class="string" id="8166082">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8166094">,</span>&nbsp;<span class="ident" id="8166096">path</span><span class="op" id="8166100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166103">}</span><br>
<span class="lineno"></span><span class="op" id="8166105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8166108">func</span>&nbsp;<span class="ident" id="8166113">runClientTestForVersion</span><span class="op" id="8166136">(</span><span class="ident" id="8166137">t</span>&nbsp;<span class="op" id="8166139">*</span><span class="ident" id="8166140">testing</span><span class="op" id="8166147">.</span><span class="ident" id="8166148">T</span><span class="op" id="8166149">,</span>&nbsp;<span class="ident" id="8166151">template</span>&nbsp;<span class="op" id="8166160">*</span><span class="ident" id="8166161">clientTest</span><span class="op" id="8166171">,</span>&nbsp;<span class="ident" id="8166173">prefix</span><span class="op" id="8166179">,</span>&nbsp;<span class="ident" id="8166181">option</span>&nbsp;<span class="builtintype" id="8166188">string</span><span class="op" id="8166194">)</span>&nbsp;<span class="op" id="8166196">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166199">test</span>&nbsp;<span class="op" id="8166204">:=</span>&nbsp;<span class="op" id="8166207">*</span><span class="ident" id="8166208">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166218">test</span><span class="op" id="8166222">.</span><span class="ident" id="8166223">name</span>&nbsp;<span class="op" id="8166228">=</span>&nbsp;<span class="ident" id="8166230">prefix</span>&nbsp;<span class="op" id="8166237">+</span>&nbsp;<span class="ident" id="8166239">test</span><span class="op" id="8166243">.</span><span class="ident" id="8166244">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8166250">if</span>&nbsp;<span class="builtinfunc" id="8166253">len</span><span class="op" id="8166256">(</span><span class="ident" id="8166257">test</span><span class="op" id="8166261">.</span><span class="ident" id="8166262">command</span><span class="op" id="8166269">)</span>&nbsp;<span class="op" id="8166271">==</span>&nbsp;<span class="num" id="8166274">0</span>&nbsp;<span class="op" id="8166276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166280">test</span><span class="op" id="8166284">.</span><span class="ident" id="8166285">command</span>&nbsp;<span class="op" id="8166293">=</span>&nbsp;<span class="ident" id="8166295">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166317">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166320">test</span><span class="op" id="8166324">.</span><span class="ident" id="8166325">command</span>&nbsp;<span class="op" id="8166333">=</span>&nbsp;<span class="builtinfunc" id="8166335">append</span><span class="op" id="8166341">(</span><span class="op" id="8166342">[</span><span class="op" id="8166343">]</span><span class="builtintype" id="8166344">string</span><span class="op" id="8166350">(</span><span class="ident" id="8166351">nil</span><span class="op" id="8166354">)</span><span class="op" id="8166355">,</span>&nbsp;<span class="ident" id="8166357">test</span><span class="op" id="8166361">.</span><span class="ident" id="8166362">command</span><span class="op" id="8166369">...</span><span class="op" id="8166372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166375">test</span><span class="op" id="8166379">.</span><span class="ident" id="8166380">command</span>&nbsp;<span class="op" id="8166388">=</span>&nbsp;<span class="builtinfunc" id="8166390">append</span><span class="op" id="8166396">(</span><span class="ident" id="8166397">test</span><span class="op" id="8166401">.</span><span class="ident" id="8166402">command</span><span class="op" id="8166409">,</span>&nbsp;<span class="ident" id="8166411">option</span><span class="op" id="8166417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166420">test</span><span class="op" id="8166424">.</span><span class="ident" id="8166425">run</span><span class="op" id="8166428">(</span><span class="ident" id="8166429">t</span><span class="op" id="8166430">,</span>&nbsp;<span class="op" id="8166432">*</span><span class="ident" id="8166433">update</span><span class="op" id="8166439">)</span><br>
<span class="lineno"></span><span class="op" id="8166441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="8166444">func</span>&nbsp;<span class="ident" id="8166449">runClientTestTLS10</span><span class="op" id="8166467">(</span><span class="ident" id="8166468">t</span>&nbsp;<span class="op" id="8166470">*</span><span class="ident" id="8166471">testing</span><span class="op" id="8166478">.</span><span class="ident" id="8166479">T</span><span class="op" id="8166480">,</span>&nbsp;<span class="ident" id="8166482">template</span>&nbsp;<span class="op" id="8166491">*</span><span class="ident" id="8166492">clientTest</span><span class="op" id="8166502">)</span>&nbsp;<span class="op" id="8166504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166507">runClientTestForVersion</span><span class="op" id="8166530">(</span><span class="ident" id="8166531">t</span><span class="op" id="8166532">,</span>&nbsp;<span class="ident" id="8166534">template</span><span class="op" id="8166542">,</span>&nbsp;<span class="string" id="8166544">&#34;TLSv10-&#34;</span><span class="op" id="8166553">,</span>&nbsp;<span class="string" id="8166555">&#34;-tls1&#34;</span><span class="op" id="8166562">)</span><br>
<span class="lineno"></span><span class="op" id="8166564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8166567">func</span>&nbsp;<span class="ident" id="8166572">runClientTestTLS11</span><span class="op" id="8166590">(</span><span class="ident" id="8166591">t</span>&nbsp;<span class="op" id="8166593">*</span><span class="ident" id="8166594">testing</span><span class="op" id="8166601">.</span><span class="ident" id="8166602">T</span><span class="op" id="8166603">,</span>&nbsp;<span class="ident" id="8166605">template</span>&nbsp;<span class="op" id="8166614">*</span><span class="ident" id="8166615">clientTest</span><span class="op" id="8166625">)</span>&nbsp;<span class="op" id="8166627">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166630">runClientTestForVersion</span><span class="op" id="8166653">(</span><span class="ident" id="8166654">t</span><span class="op" id="8166655">,</span>&nbsp;<span class="ident" id="8166657">template</span><span class="op" id="8166665">,</span>&nbsp;<span class="string" id="8166667">&#34;TLSv11-&#34;</span><span class="op" id="8166676">,</span>&nbsp;<span class="string" id="8166678">&#34;-tls1_1&#34;</span><span class="op" id="8166687">)</span><br>
<span class="lineno"></span><span class="op" id="8166689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8166692">func</span>&nbsp;<span class="ident" id="8166697">runClientTestTLS12</span><span class="op" id="8166715">(</span><span class="ident" id="8166716">t</span>&nbsp;<span class="op" id="8166718">*</span><span class="ident" id="8166719">testing</span><span class="op" id="8166726">.</span><span class="ident" id="8166727">T</span><span class="op" id="8166728">,</span>&nbsp;<span class="ident" id="8166730">template</span>&nbsp;<span class="op" id="8166739">*</span><span class="ident" id="8166740">clientTest</span><span class="op" id="8166750">)</span>&nbsp;<span class="op" id="8166752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166755">runClientTestForVersion</span><span class="op" id="8166778">(</span><span class="ident" id="8166779">t</span><span class="op" id="8166780">,</span>&nbsp;<span class="ident" id="8166782">template</span><span class="op" id="8166790">,</span>&nbsp;<span class="string" id="8166792">&#34;TLSv12-&#34;</span><span class="op" id="8166801">,</span>&nbsp;<span class="string" id="8166803">&#34;-tls1_2&#34;</span><span class="op" id="8166812">)</span><br>
<span class="lineno">270</span><span class="op" id="8166814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8166817">func</span>&nbsp;<span class="ident" id="8166822">TestHandshakeClientRSARC4</span><span class="op" id="8166847">(</span><span class="ident" id="8166848">t</span>&nbsp;<span class="op" id="8166850">*</span><span class="ident" id="8166851">testing</span><span class="op" id="8166858">.</span><span class="ident" id="8166859">T</span><span class="op" id="8166860">)</span>&nbsp;<span class="op" id="8166862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166865">test</span>&nbsp;<span class="op" id="8166870">:=</span>&nbsp;<span class="op" id="8166873">&amp;</span><span class="ident" id="8166874">clientTest</span><span class="op" id="8166884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166888">name</span><span class="op" id="8166892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8166897">&#34;RSA-RC4&#34;</span><span class="op" id="8166906">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166910">command</span><span class="op" id="8166917">:</span>&nbsp;<span class="op" id="8166919">[</span><span class="op" id="8166920">]</span><span class="builtintype" id="8166921">string</span><span class="op" id="8166927">{</span><span class="string" id="8166928">&#34;openssl&#34;</span><span class="op" id="8166937">,</span>&nbsp;<span class="string" id="8166939">&#34;s_server&#34;</span><span class="op" id="8166949">,</span>&nbsp;<span class="string" id="8166951">&#34;-cipher&#34;</span><span class="op" id="8166960">,</span>&nbsp;<span class="string" id="8166962">&#34;RC4-SHA&#34;</span><span class="op" id="8166971">}</span><span class="op" id="8166972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8166975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8166978">runClientTestTLS10</span><span class="op" id="8166996">(</span><span class="ident" id="8166997">t</span><span class="op" id="8166998">,</span>&nbsp;<span class="ident" id="8167000">test</span><span class="op" id="8167004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167007">runClientTestTLS11</span><span class="op" id="8167025">(</span><span class="ident" id="8167026">t</span><span class="op" id="8167027">,</span>&nbsp;<span class="ident" id="8167029">test</span><span class="op" id="8167033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167036">runClientTestTLS12</span><span class="op" id="8167054">(</span><span class="ident" id="8167055">t</span><span class="op" id="8167056">,</span>&nbsp;<span class="ident" id="8167058">test</span><span class="op" id="8167062">)</span><br>
<span class="lineno">280</span><span class="op" id="8167064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8167067">func</span>&nbsp;<span class="ident" id="8167072">TestHandshakeClientECDHERSAAES</span><span class="op" id="8167102">(</span><span class="ident" id="8167103">t</span>&nbsp;<span class="op" id="8167105">*</span><span class="ident" id="8167106">testing</span><span class="op" id="8167113">.</span><span class="ident" id="8167114">T</span><span class="op" id="8167115">)</span>&nbsp;<span class="op" id="8167117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167120">test</span>&nbsp;<span class="op" id="8167125">:=</span>&nbsp;<span class="op" id="8167128">&amp;</span><span class="ident" id="8167129">clientTest</span><span class="op" id="8167139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167143">name</span><span class="op" id="8167147">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8167152">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="8167167">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167171">command</span><span class="op" id="8167178">:</span>&nbsp;<span class="op" id="8167180">[</span><span class="op" id="8167181">]</span><span class="builtintype" id="8167182">string</span><span class="op" id="8167188">{</span><span class="string" id="8167189">&#34;openssl&#34;</span><span class="op" id="8167198">,</span>&nbsp;<span class="string" id="8167200">&#34;s_server&#34;</span><span class="op" id="8167210">,</span>&nbsp;<span class="string" id="8167212">&#34;-cipher&#34;</span><span class="op" id="8167221">,</span>&nbsp;<span class="string" id="8167223">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="8167245">}</span><span class="op" id="8167246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8167249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167252">runClientTestTLS10</span><span class="op" id="8167270">(</span><span class="ident" id="8167271">t</span><span class="op" id="8167272">,</span>&nbsp;<span class="ident" id="8167274">test</span><span class="op" id="8167278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167281">runClientTestTLS11</span><span class="op" id="8167299">(</span><span class="ident" id="8167300">t</span><span class="op" id="8167301">,</span>&nbsp;<span class="ident" id="8167303">test</span><span class="op" id="8167307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167310">runClientTestTLS12</span><span class="op" id="8167328">(</span><span class="ident" id="8167329">t</span><span class="op" id="8167330">,</span>&nbsp;<span class="ident" id="8167332">test</span><span class="op" id="8167336">)</span><br>
<span class="lineno">290</span><span class="op" id="8167338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8167341">func</span>&nbsp;<span class="ident" id="8167346">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="8167378">(</span><span class="ident" id="8167379">t</span>&nbsp;<span class="op" id="8167381">*</span><span class="ident" id="8167382">testing</span><span class="op" id="8167389">.</span><span class="ident" id="8167390">T</span><span class="op" id="8167391">)</span>&nbsp;<span class="op" id="8167393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167396">test</span>&nbsp;<span class="op" id="8167401">:=</span>&nbsp;<span class="op" id="8167404">&amp;</span><span class="ident" id="8167405">clientTest</span><span class="op" id="8167415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167419">name</span><span class="op" id="8167423">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8167428">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8167445">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167449">command</span><span class="op" id="8167456">:</span>&nbsp;<span class="op" id="8167458">[</span><span class="op" id="8167459">]</span><span class="builtintype" id="8167460">string</span><span class="op" id="8167466">{</span><span class="string" id="8167467">&#34;openssl&#34;</span><span class="op" id="8167476">,</span>&nbsp;<span class="string" id="8167478">&#34;s_server&#34;</span><span class="op" id="8167488">,</span>&nbsp;<span class="string" id="8167490">&#34;-cipher&#34;</span><span class="op" id="8167499">,</span>&nbsp;<span class="string" id="8167501">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8167525">}</span><span class="op" id="8167526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167530">cert</span><span class="op" id="8167534">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167539">testECDSACertificate</span><span class="op" id="8167559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167563">key</span><span class="op" id="8167566">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167572">testECDSAPrivateKey</span><span class="op" id="8167591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8167594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167597">runClientTestTLS10</span><span class="op" id="8167615">(</span><span class="ident" id="8167616">t</span><span class="op" id="8167617">,</span>&nbsp;<span class="ident" id="8167619">test</span><span class="op" id="8167623">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167626">runClientTestTLS11</span><span class="op" id="8167644">(</span><span class="ident" id="8167645">t</span><span class="op" id="8167646">,</span>&nbsp;<span class="ident" id="8167648">test</span><span class="op" id="8167652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167655">runClientTestTLS12</span><span class="op" id="8167673">(</span><span class="ident" id="8167674">t</span><span class="op" id="8167675">,</span>&nbsp;<span class="ident" id="8167677">test</span><span class="op" id="8167681">)</span><br>
<span class="lineno"></span><span class="op" id="8167683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8167686">func</span>&nbsp;<span class="ident" id="8167691">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="8167726">(</span><span class="ident" id="8167727">t</span>&nbsp;<span class="op" id="8167729">*</span><span class="ident" id="8167730">testing</span><span class="op" id="8167737">.</span><span class="ident" id="8167738">T</span><span class="op" id="8167739">)</span>&nbsp;<span class="op" id="8167741">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167744">test</span>&nbsp;<span class="op" id="8167749">:=</span>&nbsp;<span class="op" id="8167752">&amp;</span><span class="ident" id="8167753">clientTest</span><span class="op" id="8167763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167767">name</span><span class="op" id="8167771">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8167776">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="8167797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167801">command</span><span class="op" id="8167808">:</span>&nbsp;<span class="op" id="8167810">[</span><span class="op" id="8167811">]</span><span class="builtintype" id="8167812">string</span><span class="op" id="8167818">{</span><span class="string" id="8167819">&#34;openssl&#34;</span><span class="op" id="8167828">,</span>&nbsp;<span class="string" id="8167830">&#34;s_server&#34;</span><span class="op" id="8167840">,</span>&nbsp;<span class="string" id="8167842">&#34;-cipher&#34;</span><span class="op" id="8167851">,</span>&nbsp;<span class="string" id="8167853">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8167884">}</span><span class="op" id="8167885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167889">cert</span><span class="op" id="8167893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167898">testECDSACertificate</span><span class="op" id="8167918">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167922">key</span><span class="op" id="8167925">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8167931">testECDSAPrivateKey</span><span class="op" id="8167950">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8167953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167956">runClientTestTLS12</span><span class="op" id="8167974">(</span><span class="ident" id="8167975">t</span><span class="op" id="8167976">,</span>&nbsp;<span class="ident" id="8167978">test</span><span class="op" id="8167982">)</span><br>
<span class="lineno"></span><span class="op" id="8167984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8167987">func</span>&nbsp;<span class="ident" id="8167992">TestHandshakeClientCertRSA</span><span class="op" id="8168018">(</span><span class="ident" id="8168019">t</span>&nbsp;<span class="op" id="8168021">*</span><span class="ident" id="8168022">testing</span><span class="op" id="8168029">.</span><span class="ident" id="8168030">T</span><span class="op" id="8168031">)</span>&nbsp;<span class="op" id="8168033">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168036">config</span>&nbsp;<span class="op" id="8168043">:=</span>&nbsp;<span class="op" id="8168046">*</span><span class="ident" id="8168047">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168059">cert</span><span class="op" id="8168063">,</span>&nbsp;<span class="ident" id="8168065">_</span>&nbsp;<span class="op" id="8168067">:=</span>&nbsp;<span class="ident" id="8168070">X509KeyPair</span><span class="op" id="8168081">(</span><span class="op" id="8168082">[</span><span class="op" id="8168083">]</span><span class="builtintype" id="8168084">byte</span><span class="op" id="8168088">(</span><span class="ident" id="8168089">clientCertificatePEM</span><span class="op" id="8168109">)</span><span class="op" id="8168110">,</span>&nbsp;<span class="op" id="8168112">[</span><span class="op" id="8168113">]</span><span class="builtintype" id="8168114">byte</span><span class="op" id="8168118">(</span><span class="ident" id="8168119">clientKeyPEM</span><span class="op" id="8168131">)</span><span class="op" id="8168132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168135">config</span><span class="op" id="8168141">.</span><span class="ident" id="8168142">Certificates</span>&nbsp;<span class="op" id="8168155">=</span>&nbsp;<span class="op" id="8168157">[</span><span class="op" id="8168158">]</span><span class="ident" id="8168159">Certificate</span><span class="op" id="8168170">{</span><span class="ident" id="8168171">cert</span><span class="op" id="8168175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168179">test</span>&nbsp;<span class="op" id="8168184">:=</span>&nbsp;<span class="op" id="8168187">&amp;</span><span class="ident" id="8168188">clientTest</span><span class="op" id="8168198">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168202">name</span><span class="op" id="8168206">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168211">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="8168231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168235">command</span><span class="op" id="8168242">:</span>&nbsp;<span class="op" id="8168244">[</span><span class="op" id="8168245">]</span><span class="builtintype" id="8168246">string</span><span class="op" id="8168252">{</span><span class="string" id="8168253">&#34;openssl&#34;</span><span class="op" id="8168262">,</span>&nbsp;<span class="string" id="8168264">&#34;s_server&#34;</span><span class="op" id="8168274">,</span>&nbsp;<span class="string" id="8168276">&#34;-cipher&#34;</span><span class="op" id="8168285">,</span>&nbsp;<span class="string" id="8168287">&#34;RC4-SHA&#34;</span><span class="op" id="8168296">,</span>&nbsp;<span class="string" id="8168298">&#34;-verify&#34;</span><span class="op" id="8168307">,</span>&nbsp;<span class="string" id="8168309">&#34;1&#34;</span><span class="op" id="8168312">}</span><span class="op" id="8168313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168317">config</span><span class="op" id="8168323">:</span>&nbsp;&nbsp;<span class="op" id="8168326">&amp;</span><span class="ident" id="8168327">config</span><span class="op" id="8168333">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168340">runClientTestTLS10</span><span class="op" id="8168358">(</span><span class="ident" id="8168359">t</span><span class="op" id="8168360">,</span>&nbsp;<span class="ident" id="8168362">test</span><span class="op" id="8168366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168369">runClientTestTLS12</span><span class="op" id="8168387">(</span><span class="ident" id="8168388">t</span><span class="op" id="8168389">,</span>&nbsp;<span class="ident" id="8168391">test</span><span class="op" id="8168395">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168399">test</span>&nbsp;<span class="op" id="8168404">=</span>&nbsp;<span class="op" id="8168406">&amp;</span><span class="ident" id="8168407">clientTest</span><span class="op" id="8168417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168421">name</span><span class="op" id="8168425">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168430">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="8168452">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168456">command</span><span class="op" id="8168463">:</span>&nbsp;<span class="op" id="8168465">[</span><span class="op" id="8168466">]</span><span class="builtintype" id="8168467">string</span><span class="op" id="8168473">{</span><span class="string" id="8168474">&#34;openssl&#34;</span><span class="op" id="8168483">,</span>&nbsp;<span class="string" id="8168485">&#34;s_server&#34;</span><span class="op" id="8168495">,</span>&nbsp;<span class="string" id="8168497">&#34;-cipher&#34;</span><span class="op" id="8168506">,</span>&nbsp;<span class="string" id="8168508">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8168532">,</span>&nbsp;<span class="string" id="8168534">&#34;-verify&#34;</span><span class="op" id="8168543">,</span>&nbsp;<span class="string" id="8168545">&#34;1&#34;</span><span class="op" id="8168548">}</span><span class="op" id="8168549">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168553">config</span><span class="op" id="8168559">:</span>&nbsp;&nbsp;<span class="op" id="8168562">&amp;</span><span class="ident" id="8168563">config</span><span class="op" id="8168569">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168573">cert</span><span class="op" id="8168577">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168582">testECDSACertificate</span><span class="op" id="8168602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168606">key</span><span class="op" id="8168609">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8168615">testECDSAPrivateKey</span><span class="op" id="8168634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168637">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168641">runClientTestTLS10</span><span class="op" id="8168659">(</span><span class="ident" id="8168660">t</span><span class="op" id="8168661">,</span>&nbsp;<span class="ident" id="8168663">test</span><span class="op" id="8168667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168670">runClientTestTLS12</span><span class="op" id="8168688">(</span><span class="ident" id="8168689">t</span><span class="op" id="8168690">,</span>&nbsp;<span class="ident" id="8168692">test</span><span class="op" id="8168696">)</span><br>
<span class="lineno"></span><span class="op" id="8168698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8168701">func</span>&nbsp;<span class="ident" id="8168706">TestHandshakeClientCertECDSA</span><span class="op" id="8168734">(</span><span class="ident" id="8168735">t</span>&nbsp;<span class="op" id="8168737">*</span><span class="ident" id="8168738">testing</span><span class="op" id="8168745">.</span><span class="ident" id="8168746">T</span><span class="op" id="8168747">)</span>&nbsp;<span class="op" id="8168749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168752">config</span>&nbsp;<span class="op" id="8168759">:=</span>&nbsp;<span class="op" id="8168762">*</span><span class="ident" id="8168763">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168775">cert</span><span class="op" id="8168779">,</span>&nbsp;<span class="ident" id="8168781">_</span>&nbsp;<span class="op" id="8168783">:=</span>&nbsp;<span class="ident" id="8168786">X509KeyPair</span><span class="op" id="8168797">(</span><span class="op" id="8168798">[</span><span class="op" id="8168799">]</span><span class="builtintype" id="8168800">byte</span><span class="op" id="8168804">(</span><span class="ident" id="8168805">clientECDSACertificatePEM</span><span class="op" id="8168830">)</span><span class="op" id="8168831">,</span>&nbsp;<span class="op" id="8168833">[</span><span class="op" id="8168834">]</span><span class="builtintype" id="8168835">byte</span><span class="op" id="8168839">(</span><span class="ident" id="8168840">clientECDSAKeyPEM</span><span class="op" id="8168857">)</span><span class="op" id="8168858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168861">config</span><span class="op" id="8168867">.</span><span class="ident" id="8168868">Certificates</span>&nbsp;<span class="op" id="8168881">=</span>&nbsp;<span class="op" id="8168883">[</span><span class="op" id="8168884">]</span><span class="ident" id="8168885">Certificate</span><span class="op" id="8168896">{</span><span class="ident" id="8168897">cert</span><span class="op" id="8168901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168905">test</span>&nbsp;<span class="op" id="8168910">:=</span>&nbsp;<span class="op" id="8168913">&amp;</span><span class="ident" id="8168914">clientTest</span><span class="op" id="8168924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168928">name</span><span class="op" id="8168932">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8168937">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="8168959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168963">command</span><span class="op" id="8168970">:</span>&nbsp;<span class="op" id="8168972">[</span><span class="op" id="8168973">]</span><span class="builtintype" id="8168974">string</span><span class="op" id="8168980">{</span><span class="string" id="8168981">&#34;openssl&#34;</span><span class="op" id="8168990">,</span>&nbsp;<span class="string" id="8168992">&#34;s_server&#34;</span><span class="op" id="8169002">,</span>&nbsp;<span class="string" id="8169004">&#34;-cipher&#34;</span><span class="op" id="8169013">,</span>&nbsp;<span class="string" id="8169015">&#34;RC4-SHA&#34;</span><span class="op" id="8169024">,</span>&nbsp;<span class="string" id="8169026">&#34;-verify&#34;</span><span class="op" id="8169035">,</span>&nbsp;<span class="string" id="8169037">&#34;1&#34;</span><span class="op" id="8169040">}</span><span class="op" id="8169041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169045">config</span><span class="op" id="8169051">:</span>&nbsp;&nbsp;<span class="op" id="8169054">&amp;</span><span class="ident" id="8169055">config</span><span class="op" id="8169061">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169064">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169068">runClientTestTLS10</span><span class="op" id="8169086">(</span><span class="ident" id="8169087">t</span><span class="op" id="8169088">,</span>&nbsp;<span class="ident" id="8169090">test</span><span class="op" id="8169094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169097">runClientTestTLS12</span><span class="op" id="8169115">(</span><span class="ident" id="8169116">t</span><span class="op" id="8169117">,</span>&nbsp;<span class="ident" id="8169119">test</span><span class="op" id="8169123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169127">test</span>&nbsp;<span class="op" id="8169132">=</span>&nbsp;<span class="op" id="8169134">&amp;</span><span class="ident" id="8169135">clientTest</span><span class="op" id="8169145">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169149">name</span><span class="op" id="8169153">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8169158">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="8169182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169186">command</span><span class="op" id="8169193">:</span>&nbsp;<span class="op" id="8169195">[</span><span class="op" id="8169196">]</span><span class="builtintype" id="8169197">string</span><span class="op" id="8169203">{</span><span class="string" id="8169204">&#34;openssl&#34;</span><span class="op" id="8169213">,</span>&nbsp;<span class="string" id="8169215">&#34;s_server&#34;</span><span class="op" id="8169225">,</span>&nbsp;<span class="string" id="8169227">&#34;-cipher&#34;</span><span class="op" id="8169236">,</span>&nbsp;<span class="string" id="8169238">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8169262">,</span>&nbsp;<span class="string" id="8169264">&#34;-verify&#34;</span><span class="op" id="8169273">,</span>&nbsp;<span class="string" id="8169275">&#34;1&#34;</span><span class="op" id="8169278">}</span><span class="op" id="8169279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169283">config</span><span class="op" id="8169289">:</span>&nbsp;&nbsp;<span class="op" id="8169292">&amp;</span><span class="ident" id="8169293">config</span><span class="op" id="8169299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169303">cert</span><span class="op" id="8169307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169312">testECDSACertificate</span><span class="op" id="8169332">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169336">key</span><span class="op" id="8169339">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8169345">testECDSAPrivateKey</span><span class="op" id="8169364">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169371">runClientTestTLS10</span><span class="op" id="8169389">(</span><span class="ident" id="8169390">t</span><span class="op" id="8169391">,</span>&nbsp;<span class="ident" id="8169393">test</span><span class="op" id="8169397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169400">runClientTestTLS12</span><span class="op" id="8169418">(</span><span class="ident" id="8169419">t</span><span class="op" id="8169420">,</span>&nbsp;<span class="ident" id="8169422">test</span><span class="op" id="8169426">)</span><br>
<span class="lineno"></span><span class="op" id="8169428">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8169431">func</span>&nbsp;<span class="ident" id="8169436">TestClientResumption</span><span class="op" id="8169456">(</span><span class="ident" id="8169457">t</span>&nbsp;<span class="op" id="8169459">*</span><span class="ident" id="8169460">testing</span><span class="op" id="8169467">.</span><span class="ident" id="8169468">T</span><span class="op" id="8169469">)</span>&nbsp;<span class="op" id="8169471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169474">serverConfig</span>&nbsp;<span class="op" id="8169487">:=</span>&nbsp;<span class="op" id="8169490">&amp;</span><span class="ident" id="8169491">Config</span><span class="op" id="8169497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169501">CipherSuites</span><span class="op" id="8169513">:</span>&nbsp;<span class="op" id="8169515">[</span><span class="op" id="8169516">]</span><span class="builtintype" id="8169517">uint16</span><span class="op" id="8169523">{</span><span class="ident" id="8169524">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8169548">,</span>&nbsp;<span class="ident" id="8169550">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8169580">}</span><span class="op" id="8169581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169585">Certificates</span><span class="op" id="8169597">:</span>&nbsp;<span class="ident" id="8169599">testConfig</span><span class="op" id="8169609">.</span><span class="ident" id="8169610">Certificates</span><span class="op" id="8169622">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169628">clientConfig</span>&nbsp;<span class="op" id="8169641">:=</span>&nbsp;<span class="op" id="8169644">&amp;</span><span class="ident" id="8169645">Config</span><span class="op" id="8169651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169655">CipherSuites</span><span class="op" id="8169667">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8169675">[</span><span class="op" id="8169676">]</span><span class="builtintype" id="8169677">uint16</span><span class="op" id="8169683">{</span><span class="ident" id="8169684">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8169708">}</span><span class="op" id="8169709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169713">InsecureSkipVerify</span><span class="op" id="8169731">:</span>&nbsp;<span class="builtintype" id="8169733">true</span><span class="op" id="8169737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169741">ClientSessionCache</span><span class="op" id="8169759">:</span>&nbsp;<span class="ident" id="8169761">NewLRUClientSessionCache</span><span class="op" id="8169785">(</span><span class="num" id="8169786">32</span><span class="op" id="8169788">)</span><span class="op" id="8169789">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169796">testResumeState</span>&nbsp;<span class="op" id="8169812">:=</span>&nbsp;<span class="keyword" id="8169815">func</span><span class="op" id="8169819">(</span><span class="ident" id="8169820">test</span>&nbsp;<span class="builtintype" id="8169825">string</span><span class="op" id="8169831">,</span>&nbsp;<span class="ident" id="8169833">didResume</span>&nbsp;<span class="builtintype" id="8169843">bool</span><span class="op" id="8169847">)</span>&nbsp;<span class="op" id="8169849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169853">hs</span><span class="op" id="8169855">,</span>&nbsp;<span class="ident" id="8169857">err</span>&nbsp;<span class="op" id="8169861">:=</span>&nbsp;<span class="ident" id="8169864">testHandshake</span><span class="op" id="8169877">(</span><span class="ident" id="8169878">clientConfig</span><span class="op" id="8169890">,</span>&nbsp;<span class="ident" id="8169892">serverConfig</span><span class="op" id="8169904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169908">if</span>&nbsp;<span class="ident" id="8169911">err</span>&nbsp;<span class="op" id="8169915">!=</span>&nbsp;<span class="ident" id="8169918">nil</span>&nbsp;<span class="op" id="8169922">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169927">t</span><span class="op" id="8169928">.</span><span class="ident" id="8169929">Fatalf</span><span class="op" id="8169935">(</span><span class="string" id="8169936">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8169962">,</span>&nbsp;<span class="ident" id="8169964">test</span><span class="op" id="8169968">,</span>&nbsp;<span class="ident" id="8169970">err</span><span class="op" id="8169973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169981">if</span>&nbsp;<span class="ident" id="8169984">hs</span><span class="op" id="8169986">.</span><span class="ident" id="8169987">DidResume</span>&nbsp;<span class="op" id="8169997">!=</span>&nbsp;<span class="ident" id="8170000">didResume</span>&nbsp;<span class="op" id="8170010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170015">t</span><span class="op" id="8170016">.</span><span class="ident" id="8170017">Fatalf</span><span class="op" id="8170023">(</span><span class="string" id="8170024">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="8170054">,</span>&nbsp;<span class="ident" id="8170056">test</span><span class="op" id="8170060">,</span>&nbsp;<span class="ident" id="8170062">hs</span><span class="op" id="8170064">.</span><span class="ident" id="8170065">DidResume</span><span class="op" id="8170074">,</span>&nbsp;<span class="ident" id="8170076">didResume</span><span class="op" id="8170085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170089">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170096">testResumeState</span><span class="op" id="8170111">(</span><span class="string" id="8170112">&#34;Handshake&#34;</span><span class="op" id="8170123">,</span>&nbsp;<span class="builtintype" id="8170125">false</span><span class="op" id="8170130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170133">testResumeState</span><span class="op" id="8170148">(</span><span class="string" id="8170149">&#34;Resume&#34;</span><span class="op" id="8170157">,</span>&nbsp;<span class="builtintype" id="8170159">true</span><span class="op" id="8170163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170167">if</span>&nbsp;<span class="ident" id="8170170">_</span><span class="op" id="8170171">,</span>&nbsp;<span class="ident" id="8170173">err</span>&nbsp;<span class="op" id="8170177">:=</span>&nbsp;<span class="ident" id="8170180">io</span><span class="op" id="8170182">.</span><span class="ident" id="8170183">ReadFull</span><span class="op" id="8170191">(</span><span class="ident" id="8170192">serverConfig</span><span class="op" id="8170204">.</span><span class="ident" id="8170205">rand</span><span class="op" id="8170209">(</span><span class="op" id="8170210">)</span><span class="op" id="8170211">,</span>&nbsp;<span class="ident" id="8170213">serverConfig</span><span class="op" id="8170225">.</span><span class="ident" id="8170226">SessionTicketKey</span><span class="op" id="8170242">[</span><span class="op" id="8170243">:</span><span class="op" id="8170244">]</span><span class="op" id="8170245">)</span><span class="op" id="8170246">;</span>&nbsp;<span class="ident" id="8170248">err</span>&nbsp;<span class="op" id="8170252">!=</span>&nbsp;<span class="ident" id="8170255">nil</span>&nbsp;<span class="op" id="8170259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170263">t</span><span class="op" id="8170264">.</span><span class="ident" id="8170265">Fatalf</span><span class="op" id="8170271">(</span><span class="string" id="8170272">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="8170311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170317">testResumeState</span><span class="op" id="8170332">(</span><span class="string" id="8170333">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="8170358">,</span>&nbsp;<span class="builtintype" id="8170360">false</span><span class="op" id="8170365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170368">testResumeState</span><span class="op" id="8170383">(</span><span class="string" id="8170384">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="8170420">,</span>&nbsp;<span class="builtintype" id="8170422">true</span><span class="op" id="8170426">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170430">clientConfig</span><span class="op" id="8170442">.</span><span class="ident" id="8170443">CipherSuites</span>&nbsp;<span class="op" id="8170456">=</span>&nbsp;<span class="op" id="8170458">[</span><span class="op" id="8170459">]</span><span class="builtintype" id="8170460">uint16</span><span class="op" id="8170466">{</span><span class="ident" id="8170467">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8170497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170500">testResumeState</span><span class="op" id="8170515">(</span><span class="string" id="8170516">&#34;DifferentCipherSuite&#34;</span><span class="op" id="8170538">,</span>&nbsp;<span class="builtintype" id="8170540">false</span><span class="op" id="8170545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170548">testResumeState</span><span class="op" id="8170563">(</span><span class="string" id="8170564">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="8170594">,</span>&nbsp;<span class="builtintype" id="8170596">true</span><span class="op" id="8170600">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170604">clientConfig</span><span class="op" id="8170616">.</span><span class="ident" id="8170617">ClientSessionCache</span>&nbsp;<span class="op" id="8170636">=</span>&nbsp;<span class="ident" id="8170638">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170643">testResumeState</span><span class="op" id="8170658">(</span><span class="string" id="8170659">&#34;WithoutSessionCache&#34;</span><span class="op" id="8170680">,</span>&nbsp;<span class="builtintype" id="8170682">false</span><span class="op" id="8170687">)</span><br>
<span class="lineno"></span><span class="op" id="8170689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8170692">func</span>&nbsp;<span class="ident" id="8170697">TestLRUClientSessionCache</span><span class="op" id="8170722">(</span><span class="ident" id="8170723">t</span>&nbsp;<span class="op" id="8170725">*</span><span class="ident" id="8170726">testing</span><span class="op" id="8170733">.</span><span class="ident" id="8170734">T</span><span class="op" id="8170735">)</span>&nbsp;<span class="op" id="8170737">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8170740">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170776">cache</span>&nbsp;<span class="op" id="8170782">:=</span>&nbsp;<span class="ident" id="8170785">NewLRUClientSessionCache</span><span class="op" id="8170809">(</span><span class="num" id="8170810">4</span><span class="op" id="8170811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170814">cs</span>&nbsp;<span class="op" id="8170817">:=</span>&nbsp;<span class="builtinfunc" id="8170820">make</span><span class="op" id="8170824">(</span><span class="op" id="8170825">[</span><span class="op" id="8170826">]</span><span class="ident" id="8170827">ClientSessionState</span><span class="op" id="8170845">,</span>&nbsp;<span class="num" id="8170847">6</span><span class="op" id="8170848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170851">keys</span>&nbsp;<span class="op" id="8170856">:=</span>&nbsp;<span class="op" id="8170859">[</span><span class="op" id="8170860">]</span><span class="builtintype" id="8170861">string</span><span class="op" id="8170867">{</span><span class="string" id="8170868">&#34;0&#34;</span><span class="op" id="8170871">,</span>&nbsp;<span class="string" id="8170873">&#34;1&#34;</span><span class="op" id="8170876">,</span>&nbsp;<span class="string" id="8170878">&#34;2&#34;</span><span class="op" id="8170881">,</span>&nbsp;<span class="string" id="8170883">&#34;3&#34;</span><span class="op" id="8170886">,</span>&nbsp;<span class="string" id="8170888">&#34;4&#34;</span><span class="op" id="8170891">,</span>&nbsp;<span class="string" id="8170893">&#34;5&#34;</span><span class="op" id="8170896">,</span>&nbsp;<span class="string" id="8170898">&#34;6&#34;</span><span class="op" id="8170901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8170905">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170954">for</span>&nbsp;<span class="ident" id="8170958">i</span>&nbsp;<span class="op" id="8170960">:=</span>&nbsp;<span class="num" id="8170963">0</span><span class="op" id="8170964">;</span>&nbsp;<span class="ident" id="8170966">i</span>&nbsp;<span class="op" id="8170968">&lt;</span>&nbsp;<span class="num" id="8170970">4</span><span class="op" id="8170971">;</span>&nbsp;<span class="ident" id="8170973">i</span><span class="op" id="8170974">++</span>&nbsp;<span class="op" id="8170977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170981">cache</span><span class="op" id="8170986">.</span><span class="ident" id="8170987">Put</span><span class="op" id="8170990">(</span><span class="ident" id="8170991">keys</span><span class="op" id="8170995">[</span><span class="ident" id="8170996">i</span><span class="op" id="8170997">]</span><span class="op" id="8170998">,</span>&nbsp;<span class="op" id="8171000">&amp;</span><span class="ident" id="8171001">cs</span><span class="op" id="8171003">[</span><span class="ident" id="8171004">i</span><span class="op" id="8171005">]</span><span class="op" id="8171006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171012">for</span>&nbsp;<span class="ident" id="8171016">i</span>&nbsp;<span class="op" id="8171018">:=</span>&nbsp;<span class="num" id="8171021">0</span><span class="op" id="8171022">;</span>&nbsp;<span class="ident" id="8171024">i</span>&nbsp;<span class="op" id="8171026">&lt;</span>&nbsp;<span class="num" id="8171028">4</span><span class="op" id="8171029">;</span>&nbsp;<span class="ident" id="8171031">i</span><span class="op" id="8171032">++</span>&nbsp;<span class="op" id="8171035">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171039">if</span>&nbsp;<span class="ident" id="8171042">s</span><span class="op" id="8171043">,</span>&nbsp;<span class="ident" id="8171045">ok</span>&nbsp;<span class="op" id="8171048">:=</span>&nbsp;<span class="ident" id="8171051">cache</span><span class="op" id="8171056">.</span><span class="ident" id="8171057">Get</span><span class="op" id="8171060">(</span><span class="ident" id="8171061">keys</span><span class="op" id="8171065">[</span><span class="ident" id="8171066">i</span><span class="op" id="8171067">]</span><span class="op" id="8171068">)</span><span class="op" id="8171069">;</span>&nbsp;<span class="op" id="8171071">!</span><span class="ident" id="8171072">ok</span>&nbsp;<span class="op" id="8171075">||</span>&nbsp;<span class="ident" id="8171078">s</span>&nbsp;<span class="op" id="8171080">!=</span>&nbsp;<span class="op" id="8171083">&amp;</span><span class="ident" id="8171084">cs</span><span class="op" id="8171086">[</span><span class="ident" id="8171087">i</span><span class="op" id="8171088">]</span>&nbsp;<span class="op" id="8171090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171095">t</span><span class="op" id="8171096">.</span><span class="ident" id="8171097">Fatalf</span><span class="op" id="8171103">(</span><span class="string" id="8171104">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8171151">,</span>&nbsp;<span class="ident" id="8171153">keys</span><span class="op" id="8171157">[</span><span class="ident" id="8171158">i</span><span class="op" id="8171159">]</span><span class="op" id="8171160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8171171">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171235">for</span>&nbsp;<span class="ident" id="8171239">i</span>&nbsp;<span class="op" id="8171241">:=</span>&nbsp;<span class="num" id="8171244">4</span><span class="op" id="8171245">;</span>&nbsp;<span class="ident" id="8171247">i</span>&nbsp;<span class="op" id="8171249">&lt;</span>&nbsp;<span class="num" id="8171251">6</span><span class="op" id="8171252">;</span>&nbsp;<span class="ident" id="8171254">i</span><span class="op" id="8171255">++</span>&nbsp;<span class="op" id="8171258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171262">cache</span><span class="op" id="8171267">.</span><span class="ident" id="8171268">Put</span><span class="op" id="8171271">(</span><span class="ident" id="8171272">keys</span><span class="op" id="8171276">[</span><span class="ident" id="8171277">i</span><span class="op" id="8171278">]</span><span class="op" id="8171279">,</span>&nbsp;<span class="op" id="8171281">&amp;</span><span class="ident" id="8171282">cs</span><span class="op" id="8171284">[</span><span class="ident" id="8171285">i</span><span class="op" id="8171286">]</span><span class="op" id="8171287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171293">for</span>&nbsp;<span class="ident" id="8171297">i</span>&nbsp;<span class="op" id="8171299">:=</span>&nbsp;<span class="num" id="8171302">0</span><span class="op" id="8171303">;</span>&nbsp;<span class="ident" id="8171305">i</span>&nbsp;<span class="op" id="8171307">&lt;</span>&nbsp;<span class="num" id="8171309">2</span><span class="op" id="8171310">;</span>&nbsp;<span class="ident" id="8171312">i</span><span class="op" id="8171313">++</span>&nbsp;<span class="op" id="8171316">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171320">if</span>&nbsp;<span class="ident" id="8171323">s</span><span class="op" id="8171324">,</span>&nbsp;<span class="ident" id="8171326">ok</span>&nbsp;<span class="op" id="8171329">:=</span>&nbsp;<span class="ident" id="8171332">cache</span><span class="op" id="8171337">.</span><span class="ident" id="8171338">Get</span><span class="op" id="8171341">(</span><span class="ident" id="8171342">keys</span><span class="op" id="8171346">[</span><span class="ident" id="8171347">i</span><span class="op" id="8171348">]</span><span class="op" id="8171349">)</span><span class="op" id="8171350">;</span>&nbsp;<span class="ident" id="8171352">ok</span>&nbsp;<span class="op" id="8171355">||</span>&nbsp;<span class="ident" id="8171358">s</span>&nbsp;<span class="op" id="8171360">!=</span>&nbsp;<span class="ident" id="8171363">nil</span>&nbsp;<span class="op" id="8171367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171372">t</span><span class="op" id="8171373">.</span><span class="ident" id="8171374">Fatalf</span><span class="op" id="8171380">(</span><span class="string" id="8171381">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8171424">,</span>&nbsp;<span class="ident" id="8171426">keys</span><span class="op" id="8171430">[</span><span class="ident" id="8171431">i</span><span class="op" id="8171432">]</span><span class="op" id="8171433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8171444">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171488">cache</span><span class="op" id="8171493">.</span><span class="ident" id="8171494">Get</span><span class="op" id="8171497">(</span><span class="ident" id="8171498">keys</span><span class="op" id="8171502">[</span><span class="num" id="8171503">2</span><span class="op" id="8171504">]</span><span class="op" id="8171505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171508">cache</span><span class="op" id="8171513">.</span><span class="ident" id="8171514">Put</span><span class="op" id="8171517">(</span><span class="ident" id="8171518">keys</span><span class="op" id="8171522">[</span><span class="num" id="8171523">0</span><span class="op" id="8171524">]</span><span class="op" id="8171525">,</span>&nbsp;<span class="op" id="8171527">&amp;</span><span class="ident" id="8171528">cs</span><span class="op" id="8171530">[</span><span class="num" id="8171531">0</span><span class="op" id="8171532">]</span><span class="op" id="8171533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171536">if</span>&nbsp;<span class="ident" id="8171539">s</span><span class="op" id="8171540">,</span>&nbsp;<span class="ident" id="8171542">ok</span>&nbsp;<span class="op" id="8171545">:=</span>&nbsp;<span class="ident" id="8171548">cache</span><span class="op" id="8171553">.</span><span class="ident" id="8171554">Get</span><span class="op" id="8171557">(</span><span class="ident" id="8171558">keys</span><span class="op" id="8171562">[</span><span class="num" id="8171563">3</span><span class="op" id="8171564">]</span><span class="op" id="8171565">)</span><span class="op" id="8171566">;</span>&nbsp;<span class="ident" id="8171568">ok</span>&nbsp;<span class="op" id="8171571">||</span>&nbsp;<span class="ident" id="8171574">s</span>&nbsp;<span class="op" id="8171576">!=</span>&nbsp;<span class="ident" id="8171579">nil</span>&nbsp;<span class="op" id="8171583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171587">t</span><span class="op" id="8171588">.</span><span class="ident" id="8171589">Fatalf</span><span class="op" id="8171595">(</span><span class="string" id="8171596">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="8171637">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8171644">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171673">cache</span><span class="op" id="8171678">.</span><span class="ident" id="8171679">Put</span><span class="op" id="8171682">(</span><span class="ident" id="8171683">keys</span><span class="op" id="8171687">[</span><span class="num" id="8171688">0</span><span class="op" id="8171689">]</span><span class="op" id="8171690">,</span>&nbsp;<span class="op" id="8171692">&amp;</span><span class="ident" id="8171693">cs</span><span class="op" id="8171695">[</span><span class="num" id="8171696">3</span><span class="op" id="8171697">]</span><span class="op" id="8171698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171701">if</span>&nbsp;<span class="ident" id="8171704">s</span><span class="op" id="8171705">,</span>&nbsp;<span class="ident" id="8171707">ok</span>&nbsp;<span class="op" id="8171710">:=</span>&nbsp;<span class="ident" id="8171713">cache</span><span class="op" id="8171718">.</span><span class="ident" id="8171719">Get</span><span class="op" id="8171722">(</span><span class="ident" id="8171723">keys</span><span class="op" id="8171727">[</span><span class="num" id="8171728">0</span><span class="op" id="8171729">]</span><span class="op" id="8171730">)</span><span class="op" id="8171731">;</span>&nbsp;<span class="op" id="8171733">!</span><span class="ident" id="8171734">ok</span>&nbsp;<span class="op" id="8171737">||</span>&nbsp;<span class="ident" id="8171740">s</span>&nbsp;<span class="op" id="8171742">!=</span>&nbsp;<span class="op" id="8171745">&amp;</span><span class="ident" id="8171746">cs</span><span class="op" id="8171748">[</span><span class="num" id="8171749">3</span><span class="op" id="8171750">]</span>&nbsp;<span class="op" id="8171752">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171756">t</span><span class="op" id="8171757">.</span><span class="ident" id="8171758">Fatalf</span><span class="op" id="8171764">(</span><span class="string" id="8171765">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="8171804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8171811">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171844">cache</span><span class="op" id="8171849">.</span><span class="ident" id="8171850">Put</span><span class="op" id="8171853">(</span><span class="ident" id="8171854">keys</span><span class="op" id="8171858">[</span><span class="num" id="8171859">0</span><span class="op" id="8171860">]</span><span class="op" id="8171861">,</span>&nbsp;<span class="ident" id="8171863">nil</span><span class="op" id="8171866">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8171869">if</span>&nbsp;<span class="ident" id="8171872">s</span><span class="op" id="8171873">,</span>&nbsp;<span class="ident" id="8171875">ok</span>&nbsp;<span class="op" id="8171878">:=</span>&nbsp;<span class="ident" id="8171881">cache</span><span class="op" id="8171886">.</span><span class="ident" id="8171887">Get</span><span class="op" id="8171890">(</span><span class="ident" id="8171891">keys</span><span class="op" id="8171895">[</span><span class="num" id="8171896">0</span><span class="op" id="8171897">]</span><span class="op" id="8171898">)</span><span class="op" id="8171899">;</span>&nbsp;<span class="op" id="8171901">!</span><span class="ident" id="8171902">ok</span>&nbsp;<span class="op" id="8171905">||</span>&nbsp;<span class="ident" id="8171908">s</span>&nbsp;<span class="op" id="8171910">!=</span>&nbsp;<span class="ident" id="8171913">nil</span>&nbsp;<span class="op" id="8171917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8171921">t</span><span class="op" id="8171922">.</span><span class="ident" id="8171923">Fatalf</span><span class="op" id="8171929">(</span><span class="string" id="8171930">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="8171964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8171967">}</span><br>
<span class="lineno"></span><span class="op" id="8171969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8171972">func</span>&nbsp;<span class="ident" id="8171977">TestHandshakeClientALPNMatch</span><span class="op" id="8172005">(</span><span class="ident" id="8172006">t</span>&nbsp;<span class="op" id="8172008">*</span><span class="ident" id="8172009">testing</span><span class="op" id="8172016">.</span><span class="ident" id="8172017">T</span><span class="op" id="8172018">)</span>&nbsp;<span class="op" id="8172020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172023">config</span>&nbsp;<span class="op" id="8172030">:=</span>&nbsp;<span class="op" id="8172033">*</span><span class="ident" id="8172034">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172046">config</span><span class="op" id="8172052">.</span><span class="ident" id="8172053">NextProtos</span>&nbsp;<span class="op" id="8172064">=</span>&nbsp;<span class="op" id="8172066">[</span><span class="op" id="8172067">]</span><span class="builtintype" id="8172068">string</span><span class="op" id="8172074">{</span><span class="string" id="8172075">&#34;proto2&#34;</span><span class="op" id="8172083">,</span>&nbsp;<span class="string" id="8172085">&#34;proto1&#34;</span><span class="op" id="8172093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172097">test</span>&nbsp;<span class="op" id="8172102">:=</span>&nbsp;<span class="op" id="8172105">&amp;</span><span class="ident" id="8172106">clientTest</span><span class="op" id="8172116">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172120">name</span><span class="op" id="8172124">:</span>&nbsp;<span class="string" id="8172126">&#34;ALPN&#34;</span><span class="op" id="8172132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8172136">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8172202">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172245">command</span><span class="op" id="8172252">:</span>&nbsp;<span class="op" id="8172254">[</span><span class="op" id="8172255">]</span><span class="builtintype" id="8172256">string</span><span class="op" id="8172262">{</span><span class="string" id="8172263">&#34;openssl&#34;</span><span class="op" id="8172272">,</span>&nbsp;<span class="string" id="8172274">&#34;s_server&#34;</span><span class="op" id="8172284">,</span>&nbsp;<span class="string" id="8172286">&#34;-alpn&#34;</span><span class="op" id="8172293">,</span>&nbsp;<span class="string" id="8172295">&#34;proto1,proto2&#34;</span><span class="op" id="8172310">}</span><span class="op" id="8172311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172315">config</span><span class="op" id="8172321">:</span>&nbsp;&nbsp;<span class="op" id="8172324">&amp;</span><span class="ident" id="8172325">config</span><span class="op" id="8172331">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172335">validate</span><span class="op" id="8172343">:</span>&nbsp;<span class="keyword" id="8172345">func</span><span class="op" id="8172349">(</span><span class="ident" id="8172350">state</span>&nbsp;<span class="ident" id="8172356">ConnectionState</span><span class="op" id="8172371">)</span>&nbsp;<span class="builtintype" id="8172373">error</span>&nbsp;<span class="op" id="8172379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8172384">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8172443">if</span>&nbsp;<span class="ident" id="8172446">state</span><span class="op" id="8172451">.</span><span class="ident" id="8172452">NegotiatedProtocol</span>&nbsp;<span class="op" id="8172471">!=</span>&nbsp;<span class="string" id="8172474">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8172483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8172489">return</span>&nbsp;<span class="ident" id="8172496">fmt</span><span class="op" id="8172499">.</span><span class="ident" id="8172500">Errorf</span><span class="op" id="8172506">(</span><span class="string" id="8172507">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8172539">,</span>&nbsp;<span class="ident" id="8172541">state</span><span class="op" id="8172546">.</span><span class="ident" id="8172547">NegotiatedProtocol</span><span class="op" id="8172565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8172570">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8172575">return</span>&nbsp;<span class="ident" id="8172582">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8172588">}</span><span class="op" id="8172589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8172592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172595">runClientTestTLS12</span><span class="op" id="8172613">(</span><span class="ident" id="8172614">t</span><span class="op" id="8172615">,</span>&nbsp;<span class="ident" id="8172617">test</span><span class="op" id="8172621">)</span><br>
<span class="lineno"></span><span class="op" id="8172623">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="8172626">func</span>&nbsp;<span class="ident" id="8172631">TestHandshakeClientALPNNoMatch</span><span class="op" id="8172661">(</span><span class="ident" id="8172662">t</span>&nbsp;<span class="op" id="8172664">*</span><span class="ident" id="8172665">testing</span><span class="op" id="8172672">.</span><span class="ident" id="8172673">T</span><span class="op" id="8172674">)</span>&nbsp;<span class="op" id="8172676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172679">config</span>&nbsp;<span class="op" id="8172686">:=</span>&nbsp;<span class="op" id="8172689">*</span><span class="ident" id="8172690">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172702">config</span><span class="op" id="8172708">.</span><span class="ident" id="8172709">NextProtos</span>&nbsp;<span class="op" id="8172720">=</span>&nbsp;<span class="op" id="8172722">[</span><span class="op" id="8172723">]</span><span class="builtintype" id="8172724">string</span><span class="op" id="8172730">{</span><span class="string" id="8172731">&#34;proto3&#34;</span><span class="op" id="8172739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172743">test</span>&nbsp;<span class="op" id="8172748">:=</span>&nbsp;<span class="op" id="8172751">&amp;</span><span class="ident" id="8172752">clientTest</span><span class="op" id="8172762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172766">name</span><span class="op" id="8172770">:</span>&nbsp;<span class="string" id="8172772">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8172786">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8172790">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8172856">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172899">command</span><span class="op" id="8172906">:</span>&nbsp;<span class="op" id="8172908">[</span><span class="op" id="8172909">]</span><span class="builtintype" id="8172910">string</span><span class="op" id="8172916">{</span><span class="string" id="8172917">&#34;openssl&#34;</span><span class="op" id="8172926">,</span>&nbsp;<span class="string" id="8172928">&#34;s_server&#34;</span><span class="op" id="8172938">,</span>&nbsp;<span class="string" id="8172940">&#34;-alpn&#34;</span><span class="op" id="8172947">,</span>&nbsp;<span class="string" id="8172949">&#34;proto1,proto2&#34;</span><span class="op" id="8172964">}</span><span class="op" id="8172965">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172969">config</span><span class="op" id="8172975">:</span>&nbsp;&nbsp;<span class="op" id="8172978">&amp;</span><span class="ident" id="8172979">config</span><span class="op" id="8172985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8172989">validate</span><span class="op" id="8172997">:</span>&nbsp;<span class="keyword" id="8172999">func</span><span class="op" id="8173003">(</span><span class="ident" id="8173004">state</span>&nbsp;<span class="ident" id="8173010">ConnectionState</span><span class="op" id="8173025">)</span>&nbsp;<span class="builtintype" id="8173027">error</span>&nbsp;<span class="op" id="8173033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8173038">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8173102">if</span>&nbsp;<span class="ident" id="8173105">state</span><span class="op" id="8173110">.</span><span class="ident" id="8173111">NegotiatedProtocol</span>&nbsp;<span class="op" id="8173130">!=</span>&nbsp;<span class="string" id="8173133">&#34;&#34;</span>&nbsp;<span class="op" id="8173136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8173142">return</span>&nbsp;<span class="ident" id="8173149">fmt</span><span class="op" id="8173152">.</span><span class="ident" id="8173153">Errorf</span><span class="op" id="8173159">(</span><span class="string" id="8173160">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8173188">,</span>&nbsp;<span class="ident" id="8173190">state</span><span class="op" id="8173195">.</span><span class="ident" id="8173196">NegotiatedProtocol</span><span class="op" id="8173214">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8173219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8173224">return</span>&nbsp;<span class="ident" id="8173231">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8173237">}</span><span class="op" id="8173238">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8173241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8173244">runClientTestTLS12</span><span class="op" id="8173262">(</span><span class="ident" id="8173263">t</span><span class="op" id="8173264">,</span>&nbsp;<span class="ident" id="8173266">test</span><span class="op" id="8173270">)</span><br>
<span class="lineno">490</span><span class="op" id="8173272">}</span>
</div>
</body>
</html>
