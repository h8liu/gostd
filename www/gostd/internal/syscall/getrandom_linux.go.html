<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>internal/syscall</h2>
<ul>
<li><a href="/gostd/internal/syscall/getrandom_linux.go.html" class="current">getrandom_linux.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3075330">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3075386">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3075440">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3075491">package</span>&nbsp;<span class="ident" id="3075499">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3075508">import</span>&nbsp;<span class="op" id="3075515">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3075518">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3075529">&#34;sync/atomic&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075544">stdsyscall</span>&nbsp;<span class="string" id="3075555">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3075566">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="3075575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3075578">var</span>&nbsp;<span class="ident" id="3075582">randomTrap</span>&nbsp;<span class="op" id="3075593">=</span>&nbsp;<span class="keyword" id="3075595">map</span><span class="op" id="3075598">[</span><span class="builtintype" id="3075599">string</span><span class="op" id="3075605">]</span><span class="builtintype" id="3075606">uintptr</span><span class="op" id="3075613">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3075616">&#34;386&#34;</span><span class="op" id="3075621">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3075625">355</span><span class="op" id="3075628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3075631">&#34;amd64&#34;</span><span class="op" id="3075638">:</span>&nbsp;<span class="num" id="3075640">318</span><span class="op" id="3075643">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3075646">&#34;arm&#34;</span><span class="op" id="3075651">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3075655">384</span><span class="op" id="3075658">,</span><br>
<span class="lineno"></span><span class="op" id="3075660">}</span><span class="op" id="3075661">[</span><span class="ident" id="3075662">runtime</span><span class="op" id="3075669">.</span><span class="ident" id="3075670">GOARCH</span><span class="op" id="3075676">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3075679">var</span>&nbsp;<span class="ident" id="3075683">randomUnsupported</span>&nbsp;<span class="builtintype" id="3075701">int32</span>&nbsp;<span class="comment" id="3075707">//&nbsp;atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3075718">//&nbsp;GetRandomFlag&nbsp;is&nbsp;a&nbsp;flag&nbsp;supported&nbsp;by&nbsp;the&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="3075785">type</span>&nbsp;<span class="ident" id="3075790">GetRandomFlag</span>&nbsp;<span class="builtintype" id="3075804">uintptr</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3075813">const</span>&nbsp;<span class="op" id="3075819">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075822">//&nbsp;GRND_NONBLOCK&nbsp;means&nbsp;return&nbsp;EAGAIN&nbsp;rather&nbsp;than&nbsp;blocking.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075882">GRND_NONBLOCK</span>&nbsp;<span class="ident" id="3075896">GetRandomFlag</span>&nbsp;<span class="op" id="3075910">=</span>&nbsp;<span class="num" id="3075912">0x0001</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3075921">//&nbsp;GRND_RANDOM&nbsp;means&nbsp;use&nbsp;the&nbsp;/dev/random&nbsp;pool&nbsp;instead&nbsp;of&nbsp;/dev/urandom.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3075993">GRND_RANDOM</span>&nbsp;<span class="ident" id="3076005">GetRandomFlag</span>&nbsp;<span class="op" id="3076019">=</span>&nbsp;<span class="num" id="3076021">0x0002</span><br>
<span class="lineno"></span><span class="op" id="3076028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3076031">//&nbsp;GetRandom&nbsp;calls&nbsp;the&nbsp;Linux&nbsp;getrandom&nbsp;system&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="3076083">//&nbsp;See&nbsp;https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c6e9d6f38894798696f23c8084ca7edbf16ee895</span><br>
<span class="lineno">35</span><span class="keyword" id="3076206">func</span>&nbsp;<span class="ident" id="3076211">GetRandom</span><span class="op" id="3076220">(</span><span class="ident" id="3076221">p</span>&nbsp;<span class="op" id="3076223">[</span><span class="op" id="3076224">]</span><span class="builtintype" id="3076225">byte</span><span class="op" id="3076229">,</span>&nbsp;<span class="ident" id="3076231">flags</span>&nbsp;<span class="ident" id="3076237">GetRandomFlag</span><span class="op" id="3076250">)</span>&nbsp;<span class="op" id="3076252">(</span><span class="ident" id="3076253">n</span>&nbsp;<span class="builtintype" id="3076255">int</span><span class="op" id="3076258">,</span>&nbsp;<span class="ident" id="3076260">err</span>&nbsp;<span class="builtintype" id="3076264">error</span><span class="op" id="3076269">)</span>&nbsp;<span class="op" id="3076271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076274">if</span>&nbsp;<span class="ident" id="3076277">randomTrap</span>&nbsp;<span class="op" id="3076288">==</span>&nbsp;<span class="num" id="3076291">0</span>&nbsp;<span class="op" id="3076293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076297">return</span>&nbsp;<span class="num" id="3076304">0</span><span class="op" id="3076305">,</span>&nbsp;<span class="ident" id="3076307">stdsyscall</span><span class="op" id="3076317">.</span><span class="ident" id="3076318">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076326">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076329">if</span>&nbsp;<span class="builtinfunc" id="3076332">len</span><span class="op" id="3076335">(</span><span class="ident" id="3076336">p</span><span class="op" id="3076337">)</span>&nbsp;<span class="op" id="3076339">==</span>&nbsp;<span class="num" id="3076342">0</span>&nbsp;<span class="op" id="3076344">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076348">return</span>&nbsp;<span class="num" id="3076355">0</span><span class="op" id="3076356">,</span>&nbsp;<span class="builtintype" id="3076358">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076366">if</span>&nbsp;<span class="ident" id="3076369">atomic</span><span class="op" id="3076375">.</span><span class="ident" id="3076376">LoadInt32</span><span class="op" id="3076385">(</span><span class="op" id="3076386">&amp;</span><span class="ident" id="3076387">randomUnsupported</span><span class="op" id="3076404">)</span>&nbsp;<span class="op" id="3076406">!=</span>&nbsp;<span class="num" id="3076409">0</span>&nbsp;<span class="op" id="3076411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076415">return</span>&nbsp;<span class="num" id="3076422">0</span><span class="op" id="3076423">,</span>&nbsp;<span class="ident" id="3076425">stdsyscall</span><span class="op" id="3076435">.</span><span class="ident" id="3076436">ENOSYS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076444">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076447">r1</span><span class="op" id="3076449">,</span>&nbsp;<span class="ident" id="3076451">_</span><span class="op" id="3076452">,</span>&nbsp;<span class="ident" id="3076454">errno</span>&nbsp;<span class="op" id="3076460">:=</span>&nbsp;<span class="ident" id="3076463">stdsyscall</span><span class="op" id="3076473">.</span><span class="ident" id="3076474">Syscall</span><span class="op" id="3076481">(</span><span class="ident" id="3076482">randomTrap</span><span class="op" id="3076492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3076496">uintptr</span><span class="op" id="3076503">(</span><span class="ident" id="3076504">unsafe</span><span class="op" id="3076510">.</span><span class="ident" id="3076511">Pointer</span><span class="op" id="3076518">(</span><span class="op" id="3076519">&amp;</span><span class="ident" id="3076520">p</span><span class="op" id="3076521">[</span><span class="num" id="3076522">0</span><span class="op" id="3076523">]</span><span class="op" id="3076524">)</span><span class="op" id="3076525">)</span><span class="op" id="3076526">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3076530">uintptr</span><span class="op" id="3076537">(</span><span class="builtinfunc" id="3076538">len</span><span class="op" id="3076541">(</span><span class="ident" id="3076542">p</span><span class="op" id="3076543">)</span><span class="op" id="3076544">)</span><span class="op" id="3076545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3076549">uintptr</span><span class="op" id="3076556">(</span><span class="ident" id="3076557">flags</span><span class="op" id="3076562">)</span><span class="op" id="3076563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076566">if</span>&nbsp;<span class="ident" id="3076569">errno</span>&nbsp;<span class="op" id="3076575">!=</span>&nbsp;<span class="num" id="3076578">0</span>&nbsp;<span class="op" id="3076580">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076584">if</span>&nbsp;<span class="ident" id="3076587">errno</span>&nbsp;<span class="op" id="3076593">==</span>&nbsp;<span class="ident" id="3076596">stdsyscall</span><span class="op" id="3076606">.</span><span class="ident" id="3076607">ENOSYS</span>&nbsp;<span class="op" id="3076614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3076619">atomic</span><span class="op" id="3076625">.</span><span class="ident" id="3076626">StoreInt32</span><span class="op" id="3076636">(</span><span class="op" id="3076637">&amp;</span><span class="ident" id="3076638">randomUnsupported</span><span class="op" id="3076655">,</span>&nbsp;<span class="num" id="3076657">1</span><span class="op" id="3076658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076666">return</span>&nbsp;<span class="num" id="3076673">0</span><span class="op" id="3076674">,</span>&nbsp;<span class="ident" id="3076676">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3076683">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3076686">return</span>&nbsp;<span class="builtintype" id="3076693">int</span><span class="op" id="3076696">(</span><span class="ident" id="3076697">r1</span><span class="op" id="3076699">)</span><span class="op" id="3076700">,</span>&nbsp;<span class="builtintype" id="3076702">nil</span><br>
<span class="lineno"></span><span class="op" id="3076706">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
